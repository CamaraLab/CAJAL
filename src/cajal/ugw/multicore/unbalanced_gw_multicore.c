// Generated by Futhark 0.26.0 (prerelease - include info below when reporting bugs).
// Compiled with GHC 9.4.7.

// We need to define _GNU_SOURCE before
// _any_ headers files are imported to get
// the usage statistics of a thread (i.e. have RUSAGE_THREAD) on GNU/Linux
// https://manpages.courier-mta.org/htmlman2/getrusage.2.html
#ifndef _GNU_SOURCE // Avoid possible double-definition warning.
#define _GNU_SOURCE
#endif

#ifdef __clang__
#pragma clang diagnostic ignored "-Wunused-function"
#pragma clang diagnostic ignored "-Wunused-variable"
#pragma clang diagnostic ignored "-Wunused-const-variable"
#pragma clang diagnostic ignored "-Wparentheses"
#pragma clang diagnostic ignored "-Wunused-label"
#pragma clang diagnostic ignored "-Wunused-but-set-variable"
#elif __GNUC__
#pragma GCC diagnostic ignored "-Wunused-function"
#pragma GCC diagnostic ignored "-Wunused-variable"
#pragma GCC diagnostic ignored "-Wunused-const-variable"
#pragma GCC diagnostic ignored "-Wparentheses"
#pragma GCC diagnostic ignored "-Wunused-label"
#pragma GCC diagnostic ignored "-Wunused-but-set-variable"
#endif

// Headers
#include <stdint.h>
#include <stddef.h>
#include <stdbool.h>
#include <stdio.h>
#include <float.h>

#ifdef __cplusplus
extern "C" {
#endif

// Initialisation
struct futhark_context_config;
struct futhark_context_config *futhark_context_config_new(void);
void futhark_context_config_free(struct futhark_context_config *cfg);
int futhark_context_config_set_tuning_param(struct futhark_context_config *cfg, const char *param_name, size_t new_value);
struct futhark_context;
struct futhark_context *futhark_context_new(struct futhark_context_config *cfg);
void futhark_context_free(struct futhark_context *cfg);
void futhark_context_config_set_num_threads(struct futhark_context_config *cfg, int n);
void futhark_context_config_set_debugging(struct futhark_context_config *cfg, int flag);
void futhark_context_config_set_profiling(struct futhark_context_config *cfg, int flag);
void futhark_context_config_set_logging(struct futhark_context_config *cfg, int flag);
int futhark_get_tuning_param_count(void);
const char *futhark_get_tuning_param_name(int);
const char *futhark_get_tuning_param_class(int);

// Arrays
struct futhark_f64_1d;
struct futhark_f64_1d *futhark_new_f64_1d(struct futhark_context *ctx, const double *data, int64_t dim0);
struct futhark_f64_1d *futhark_new_raw_f64_1d(struct futhark_context *ctx, unsigned char *data, int64_t dim0);
int futhark_free_f64_1d(struct futhark_context *ctx, struct futhark_f64_1d *arr);
int futhark_values_f64_1d(struct futhark_context *ctx, struct futhark_f64_1d *arr, double *data);
int futhark_index_f64_1d(struct futhark_context *ctx, double *out, struct futhark_f64_1d *arr, int64_t i0);
unsigned char *futhark_values_raw_f64_1d(struct futhark_context *ctx, struct futhark_f64_1d *arr);
const int64_t *futhark_shape_f64_1d(struct futhark_context *ctx, struct futhark_f64_1d *arr);
struct futhark_f64_2d;
struct futhark_f64_2d *futhark_new_f64_2d(struct futhark_context *ctx, const double *data, int64_t dim0, int64_t dim1);
struct futhark_f64_2d *futhark_new_raw_f64_2d(struct futhark_context *ctx, unsigned char *data, int64_t dim0, int64_t dim1);
int futhark_free_f64_2d(struct futhark_context *ctx, struct futhark_f64_2d *arr);
int futhark_values_f64_2d(struct futhark_context *ctx, struct futhark_f64_2d *arr, double *data);
int futhark_index_f64_2d(struct futhark_context *ctx, double *out, struct futhark_f64_2d *arr, int64_t i0, int64_t i1);
unsigned char *futhark_values_raw_f64_2d(struct futhark_context *ctx, struct futhark_f64_2d *arr);
const int64_t *futhark_shape_f64_2d(struct futhark_context *ctx, struct futhark_f64_2d *arr);
struct futhark_f64_3d;
struct futhark_f64_3d *futhark_new_f64_3d(struct futhark_context *ctx, const double *data, int64_t dim0, int64_t dim1, int64_t dim2);
struct futhark_f64_3d *futhark_new_raw_f64_3d(struct futhark_context *ctx, unsigned char *data, int64_t dim0, int64_t dim1, int64_t dim2);
int futhark_free_f64_3d(struct futhark_context *ctx, struct futhark_f64_3d *arr);
int futhark_values_f64_3d(struct futhark_context *ctx, struct futhark_f64_3d *arr, double *data);
int futhark_index_f64_3d(struct futhark_context *ctx, double *out, struct futhark_f64_3d *arr, int64_t i0, int64_t i1, int64_t i2);
unsigned char *futhark_values_raw_f64_3d(struct futhark_context *ctx, struct futhark_f64_3d *arr);
const int64_t *futhark_shape_f64_3d(struct futhark_context *ctx, struct futhark_f64_3d *arr);

// Opaque values



// Entry points
int futhark_entry_ugw_armijo(struct futhark_context *ctx, struct futhark_f64_1d **out0, const double in0, const double in1, const double in2, const struct futhark_f64_2d *in3, const struct futhark_f64_1d *in4, const struct futhark_f64_2d *in5, const struct futhark_f64_1d *in6, const double in7, const double in8, const double in9, const double in10);
int futhark_entry_ugw_armijo_euclidean(struct futhark_context *ctx, struct futhark_f64_2d **out0, const double in0, const double in1, const double in2, const struct futhark_f64_3d *in3, const double in4, const double in5, const double in6, const double in7);
int futhark_entry_ugw_armijo_pairwise(struct futhark_context *ctx, struct futhark_f64_2d **out0, const double in0, const double in1, const double in2, const struct futhark_f64_3d *in3, const struct futhark_f64_2d *in4, const double in5, const double in6, const double in7, const double in8);
int futhark_entry_ugw_armijo_pairwise_unif(struct futhark_context *ctx, struct futhark_f64_2d **out0, const double in0, const double in1, const double in2, const struct futhark_f64_3d *in3, const double in4, const double in5, const double in6, const double in7);

// Miscellaneous
int futhark_context_sync(struct futhark_context *ctx);
void futhark_context_config_set_cache_file(struct futhark_context_config *cfg, const char *f);
char *futhark_context_get_error(struct futhark_context *ctx);
void futhark_context_set_logging_file(struct futhark_context *ctx, FILE *f);
void futhark_context_pause_profiling(struct futhark_context *ctx);
void futhark_context_unpause_profiling(struct futhark_context *ctx);
char *futhark_context_report(struct futhark_context *ctx);
int futhark_context_clear_caches(struct futhark_context *ctx);
#define FUTHARK_BACKEND_multicore
#define FUTHARK_SUCCESS 0
#define FUTHARK_PROGRAM_ERROR 2
#define FUTHARK_OUT_OF_MEMORY 3

#ifdef __cplusplus
}
#endif

#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>
#include <math.h>
#include <stdint.h>
// If NDEBUG is set, the assert() macro will do nothing. Since Futhark
// (unfortunately) makes use of assert() for error detection (and even some
// side effects), we want to avoid that.
#undef NDEBUG
#include <assert.h>
#include <stdarg.h>
#define SCALAR_FUN_ATTR static inline
// Start of util.h.
//
// Various helper functions that are useful in all generated C code.

#include <errno.h>
#include <string.h>

static const char *fut_progname = "(embedded Futhark)";

static void futhark_panic(int eval, const char *fmt, ...) __attribute__((noreturn));
static char* msgprintf(const char *s, ...);
static void* slurp_file(const char *filename, size_t *size);
static int dump_file(const char *file, const void *buf, size_t n);
struct str_builder;
static void str_builder_init(struct str_builder *b);
static void str_builder(struct str_builder *b, const char *s, ...);
static char *strclone(const char *str);

static void futhark_panic(int eval, const char *fmt, ...) {
  va_list ap;
  va_start(ap, fmt);
  fprintf(stderr, "%s: ", fut_progname);
  vfprintf(stderr, fmt, ap);
  va_end(ap);
  exit(eval);
}

// For generating arbitrary-sized error messages.  It is the callers
// responsibility to free the buffer at some point.
static char* msgprintf(const char *s, ...) {
  va_list vl;
  va_start(vl, s);
  size_t needed = 1 + (size_t)vsnprintf(NULL, 0, s, vl);
  char *buffer = (char*) malloc(needed);
  va_start(vl, s); // Must re-init.
  vsnprintf(buffer, needed, s, vl);
  return buffer;
}

static inline void check_err(int errval, int sets_errno, const char *fun, int line,
                             const char *msg, ...) {
  if (errval) {
    char errnum[10];

    va_list vl;
    va_start(vl, msg);

    fprintf(stderr, "ERROR: ");
    vfprintf(stderr, msg, vl);
    fprintf(stderr, " in %s() at line %d with error code %s\n",
            fun, line,
            sets_errno ? strerror(errno) : errnum);
    exit(errval);
  }
}

#define CHECK_ERR(err, ...) check_err(err, 0, __func__, __LINE__, __VA_ARGS__)
#define CHECK_ERRNO(err, ...) check_err(err, 1, __func__, __LINE__, __VA_ARGS__)

// Read the rest of an open file into a NUL-terminated string; returns
// NULL on error.
static void* fslurp_file(FILE *f, size_t *size) {
  long start = ftell(f);
  fseek(f, 0, SEEK_END);
  long src_size = ftell(f)-start;
  fseek(f, start, SEEK_SET);
  unsigned char *s = (unsigned char*) malloc((size_t)src_size + 1);
  if (fread(s, 1, (size_t)src_size, f) != (size_t)src_size) {
    free(s);
    s = NULL;
  } else {
    s[src_size] = '\0';
  }

  if (size) {
    *size = (size_t)src_size;
  }

  return s;
}

// Read a file into a NUL-terminated string; returns NULL on error.
static void* slurp_file(const char *filename, size_t *size) {
  FILE *f = fopen(filename, "rb"); // To avoid Windows messing with linebreaks.
  if (f == NULL) return NULL;
  unsigned char *s = fslurp_file(f, size);
  fclose(f);
  return s;
}

// Dump 'n' bytes from 'buf' into the file at the designated location.
// Returns 0 on success.
static int dump_file(const char *file, const void *buf, size_t n) {
  FILE *f = fopen(file, "w");

  if (f == NULL) {
    return 1;
  }

  if (fwrite(buf, sizeof(char), n, f) != n) {
    return 1;
  }

  if (fclose(f) != 0) {
    return 1;
  }

  return 0;
}

struct str_builder {
  char *str;
  size_t capacity; // Size of buffer.
  size_t used; // Bytes used, *not* including final zero.
};

static void str_builder_init(struct str_builder *b) {
  b->capacity = 10;
  b->used = 0;
  b->str = malloc(b->capacity);
  b->str[0] = 0;
}

static void str_builder(struct str_builder *b, const char *s, ...) {
  va_list vl;
  va_start(vl, s);
  size_t needed = (size_t)vsnprintf(NULL, 0, s, vl);

  while (b->capacity < b->used + needed + 1) {
    b->capacity *= 2;
    b->str = realloc(b->str, b->capacity);
  }

  va_start(vl, s); // Must re-init.
  vsnprintf(b->str+b->used, b->capacity-b->used, s, vl);
  b->used += needed;
}

static void str_builder_str(struct str_builder *b, const char *s) {
  size_t needed = strlen(s);
  if (b->capacity < b->used + needed + 1) {
    b->capacity *= 2;
    b->str = realloc(b->str, b->capacity);
  }
  strcpy(b->str+b->used, s);
  b->used += needed;
}

static void str_builder_char(struct str_builder *b, char c) {
  size_t needed = 1;
  if (b->capacity < b->used + needed + 1) {
    b->capacity *= 2;
    b->str = realloc(b->str, b->capacity);
  }
  b->str[b->used] = c;
  b->str[b->used+1] = 0;
  b->used += needed;
}

static void str_builder_json_str(struct str_builder* sb, const char* s) {
  str_builder_char(sb, '"');
  for (int j = 0; s[j]; j++) {
    char c = s[j];
    switch (c) {
    case '\n':
      str_builder_str(sb, "\\n");
      break;
    case '"':
      str_builder_str(sb, "\\\"");
      break;
    default:
      str_builder_char(sb, c);
    }
  }
  str_builder_char(sb, '"');
}

static char *strclone(const char *str) {
  size_t size = strlen(str) + 1;
  char *copy = (char*) malloc(size);
  if (copy == NULL) {
    return NULL;
  }

  memcpy(copy, str, size);
  return copy;
}

// Assumes NULL-terminated.
static char *strconcat(const char *src_fragments[]) {
  size_t src_len = 0;
  const char **p;

  for (p = src_fragments; *p; p++) {
    src_len += strlen(*p);
  }

  char *src = (char*) malloc(src_len + 1);
  size_t n = 0;
  for (p = src_fragments; *p; p++) {
    strcpy(src + n, *p);
    n += strlen(*p);
  }

  return src;
}

// End of util.h.
// Start of cache.h

#define CACHE_HASH_SIZE 8 // In 32-bit words.

struct cache_hash {
  uint32_t hash[CACHE_HASH_SIZE];
};

// Initialise a blank cache.
static void cache_hash_init(struct cache_hash *c);

// Hash some bytes and add them to the accumulated hash.
static void cache_hash(struct cache_hash *out, const char *in, size_t n);

// Try to restore cache contents from a file with the given name.
// Assumes the cache is invalid if it contains the given hash.
// Allocates memory and reads the cache conents, which is returned in
// *buf with size *buflen.  If the cache is successfully loaded, this
// function returns 0.  Otherwise it returns nonzero.  Errno is set if
// the failure to load the cache is due to anything except invalid
// cache conents.  Note that failing to restore the cache is not
// necessarily a problem: it might just be invalid or not created yet.
static int cache_restore(const char *fname, const struct cache_hash *hash,
                         unsigned char **buf, size_t *buflen);

// Store cache contents in the given file, with the given hash.
static int cache_store(const char *fname, const struct cache_hash *hash,
                       const unsigned char *buf, size_t buflen);

// Now for the implementation.

static void cache_hash_init(struct cache_hash *c) {
  memset(c->hash, 0, CACHE_HASH_SIZE * sizeof(uint32_t));
}

static void cache_hash(struct cache_hash *out, const char *in, size_t n) {
  // Adaptation of djb2 for larger output size by storing intermediate
  // states.
  uint32_t hash = 5381;
  for (size_t i = 0; i < n; i++) {
    hash = ((hash << 5) + hash) + in[i];
    out->hash[i % CACHE_HASH_SIZE] ^= hash;
  }
}

#define CACHE_HEADER_SIZE 8
static const char cache_header[CACHE_HEADER_SIZE] = "FUTHARK\0";

static int cache_restore(const char *fname, const struct cache_hash *hash,
                         unsigned char **buf, size_t *buflen) {
  FILE *f = fopen(fname, "rb");

  if (f == NULL) {
    return 1;
  }

  char f_header[CACHE_HEADER_SIZE];

  if (fread(f_header, sizeof(char), CACHE_HEADER_SIZE, f) != CACHE_HEADER_SIZE) {
    goto error;
  }

  if (memcmp(f_header, cache_header, CACHE_HEADER_SIZE) != 0) {
    goto error;
  }

  if (fseek(f, 0, SEEK_END) != 0) {
    goto error;
  }
  int64_t f_size = (int64_t)ftell(f);
  if (fseek(f, CACHE_HEADER_SIZE, SEEK_SET) != 0) {
    goto error;
  }

  int64_t expected_size;

  if (fread(&expected_size, sizeof(int64_t), 1, f) != 1) {
    goto error;
  }

  if (f_size != expected_size) {
    errno = 0;
    goto error;
  }

  int32_t f_hash[CACHE_HASH_SIZE];

  if (fread(f_hash, sizeof(int32_t), CACHE_HASH_SIZE, f) != CACHE_HASH_SIZE) {
    goto error;
  }

  if (memcmp(f_hash, hash->hash, CACHE_HASH_SIZE) != 0) {
    errno = 0;
    goto error;
  }

  *buflen = f_size - CACHE_HEADER_SIZE - sizeof(int64_t) - CACHE_HASH_SIZE*sizeof(int32_t);
  *buf = malloc(*buflen);
  if (fread(*buf, sizeof(char), *buflen, f) != *buflen) {
    free(*buf);
    goto error;
  }

  fclose(f);

  return 0;

 error:
  fclose(f);
  return 1;
}

static int cache_store(const char *fname, const struct cache_hash *hash,
                       const unsigned char *buf, size_t buflen) {
  FILE *f = fopen(fname, "wb");

  if (f == NULL) {
    return 1;
  }

  if (fwrite(cache_header, CACHE_HEADER_SIZE, 1, f) != 1) {
    goto error;
  }

  int64_t size = CACHE_HEADER_SIZE + sizeof(int64_t) + CACHE_HASH_SIZE*sizeof(int32_t) + buflen;

  if (fwrite(&size, sizeof(size), 1, f) != 1) {
    goto error;
  }

  if (fwrite(hash->hash, sizeof(int32_t), CACHE_HASH_SIZE, f) != CACHE_HASH_SIZE) {
    goto error;
  }

  if (fwrite(buf, sizeof(unsigned char), buflen, f) != buflen) {
    goto error;
  }

  fclose(f);

  return 0;

 error:
  fclose(f);
  return 1;
}

// End of cache.h
// Start of half.h.

// Conversion functions are from http://half.sourceforge.net/, but
// translated to C.
//
// Copyright (c) 2012-2021 Christian Rau
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.

#ifndef __OPENCL_VERSION__
#define __constant
#endif

__constant static const uint16_t base_table[512] = {
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0001, 0x0002, 0x0004, 0x0008, 0x0010, 0x0020, 0x0040, 0x0080, 0x0100,
  0x0200, 0x0400, 0x0800, 0x0C00, 0x1000, 0x1400, 0x1800, 0x1C00, 0x2000, 0x2400, 0x2800, 0x2C00, 0x3000, 0x3400, 0x3800, 0x3C00,
  0x4000, 0x4400, 0x4800, 0x4C00, 0x5000, 0x5400, 0x5800, 0x5C00, 0x6000, 0x6400, 0x6800, 0x6C00, 0x7000, 0x7400, 0x7800, 0x7C00,
  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,
  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,
  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,
  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,
  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,
  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,
  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,
  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,
  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,
  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,
  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,
  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,
  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,
  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8001, 0x8002, 0x8004, 0x8008, 0x8010, 0x8020, 0x8040, 0x8080, 0x8100,
  0x8200, 0x8400, 0x8800, 0x8C00, 0x9000, 0x9400, 0x9800, 0x9C00, 0xA000, 0xA400, 0xA800, 0xAC00, 0xB000, 0xB400, 0xB800, 0xBC00,
  0xC000, 0xC400, 0xC800, 0xCC00, 0xD000, 0xD400, 0xD800, 0xDC00, 0xE000, 0xE400, 0xE800, 0xEC00, 0xF000, 0xF400, 0xF800, 0xFC00,
  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,
  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,
  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,
  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,
  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,
  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,
  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00 };

__constant static const unsigned char shift_table[512] = {
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 23, 22, 21, 20, 19, 18, 17, 16, 15, 14, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13,
  13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 13,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 23, 22, 21, 20, 19, 18, 17, 16, 15, 14, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13,
  13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 13 };

__constant static const uint32_t mantissa_table[2048] = {
  0x00000000, 0x33800000, 0x34000000, 0x34400000, 0x34800000, 0x34A00000, 0x34C00000, 0x34E00000, 0x35000000, 0x35100000, 0x35200000, 0x35300000, 0x35400000, 0x35500000, 0x35600000, 0x35700000,
  0x35800000, 0x35880000, 0x35900000, 0x35980000, 0x35A00000, 0x35A80000, 0x35B00000, 0x35B80000, 0x35C00000, 0x35C80000, 0x35D00000, 0x35D80000, 0x35E00000, 0x35E80000, 0x35F00000, 0x35F80000,
  0x36000000, 0x36040000, 0x36080000, 0x360C0000, 0x36100000, 0x36140000, 0x36180000, 0x361C0000, 0x36200000, 0x36240000, 0x36280000, 0x362C0000, 0x36300000, 0x36340000, 0x36380000, 0x363C0000,
  0x36400000, 0x36440000, 0x36480000, 0x364C0000, 0x36500000, 0x36540000, 0x36580000, 0x365C0000, 0x36600000, 0x36640000, 0x36680000, 0x366C0000, 0x36700000, 0x36740000, 0x36780000, 0x367C0000,
  0x36800000, 0x36820000, 0x36840000, 0x36860000, 0x36880000, 0x368A0000, 0x368C0000, 0x368E0000, 0x36900000, 0x36920000, 0x36940000, 0x36960000, 0x36980000, 0x369A0000, 0x369C0000, 0x369E0000,
  0x36A00000, 0x36A20000, 0x36A40000, 0x36A60000, 0x36A80000, 0x36AA0000, 0x36AC0000, 0x36AE0000, 0x36B00000, 0x36B20000, 0x36B40000, 0x36B60000, 0x36B80000, 0x36BA0000, 0x36BC0000, 0x36BE0000,
  0x36C00000, 0x36C20000, 0x36C40000, 0x36C60000, 0x36C80000, 0x36CA0000, 0x36CC0000, 0x36CE0000, 0x36D00000, 0x36D20000, 0x36D40000, 0x36D60000, 0x36D80000, 0x36DA0000, 0x36DC0000, 0x36DE0000,
  0x36E00000, 0x36E20000, 0x36E40000, 0x36E60000, 0x36E80000, 0x36EA0000, 0x36EC0000, 0x36EE0000, 0x36F00000, 0x36F20000, 0x36F40000, 0x36F60000, 0x36F80000, 0x36FA0000, 0x36FC0000, 0x36FE0000,
  0x37000000, 0x37010000, 0x37020000, 0x37030000, 0x37040000, 0x37050000, 0x37060000, 0x37070000, 0x37080000, 0x37090000, 0x370A0000, 0x370B0000, 0x370C0000, 0x370D0000, 0x370E0000, 0x370F0000,
  0x37100000, 0x37110000, 0x37120000, 0x37130000, 0x37140000, 0x37150000, 0x37160000, 0x37170000, 0x37180000, 0x37190000, 0x371A0000, 0x371B0000, 0x371C0000, 0x371D0000, 0x371E0000, 0x371F0000,
  0x37200000, 0x37210000, 0x37220000, 0x37230000, 0x37240000, 0x37250000, 0x37260000, 0x37270000, 0x37280000, 0x37290000, 0x372A0000, 0x372B0000, 0x372C0000, 0x372D0000, 0x372E0000, 0x372F0000,
  0x37300000, 0x37310000, 0x37320000, 0x37330000, 0x37340000, 0x37350000, 0x37360000, 0x37370000, 0x37380000, 0x37390000, 0x373A0000, 0x373B0000, 0x373C0000, 0x373D0000, 0x373E0000, 0x373F0000,
  0x37400000, 0x37410000, 0x37420000, 0x37430000, 0x37440000, 0x37450000, 0x37460000, 0x37470000, 0x37480000, 0x37490000, 0x374A0000, 0x374B0000, 0x374C0000, 0x374D0000, 0x374E0000, 0x374F0000,
  0x37500000, 0x37510000, 0x37520000, 0x37530000, 0x37540000, 0x37550000, 0x37560000, 0x37570000, 0x37580000, 0x37590000, 0x375A0000, 0x375B0000, 0x375C0000, 0x375D0000, 0x375E0000, 0x375F0000,
  0x37600000, 0x37610000, 0x37620000, 0x37630000, 0x37640000, 0x37650000, 0x37660000, 0x37670000, 0x37680000, 0x37690000, 0x376A0000, 0x376B0000, 0x376C0000, 0x376D0000, 0x376E0000, 0x376F0000,
  0x37700000, 0x37710000, 0x37720000, 0x37730000, 0x37740000, 0x37750000, 0x37760000, 0x37770000, 0x37780000, 0x37790000, 0x377A0000, 0x377B0000, 0x377C0000, 0x377D0000, 0x377E0000, 0x377F0000,
  0x37800000, 0x37808000, 0x37810000, 0x37818000, 0x37820000, 0x37828000, 0x37830000, 0x37838000, 0x37840000, 0x37848000, 0x37850000, 0x37858000, 0x37860000, 0x37868000, 0x37870000, 0x37878000,
  0x37880000, 0x37888000, 0x37890000, 0x37898000, 0x378A0000, 0x378A8000, 0x378B0000, 0x378B8000, 0x378C0000, 0x378C8000, 0x378D0000, 0x378D8000, 0x378E0000, 0x378E8000, 0x378F0000, 0x378F8000,
  0x37900000, 0x37908000, 0x37910000, 0x37918000, 0x37920000, 0x37928000, 0x37930000, 0x37938000, 0x37940000, 0x37948000, 0x37950000, 0x37958000, 0x37960000, 0x37968000, 0x37970000, 0x37978000,
  0x37980000, 0x37988000, 0x37990000, 0x37998000, 0x379A0000, 0x379A8000, 0x379B0000, 0x379B8000, 0x379C0000, 0x379C8000, 0x379D0000, 0x379D8000, 0x379E0000, 0x379E8000, 0x379F0000, 0x379F8000,
  0x37A00000, 0x37A08000, 0x37A10000, 0x37A18000, 0x37A20000, 0x37A28000, 0x37A30000, 0x37A38000, 0x37A40000, 0x37A48000, 0x37A50000, 0x37A58000, 0x37A60000, 0x37A68000, 0x37A70000, 0x37A78000,
  0x37A80000, 0x37A88000, 0x37A90000, 0x37A98000, 0x37AA0000, 0x37AA8000, 0x37AB0000, 0x37AB8000, 0x37AC0000, 0x37AC8000, 0x37AD0000, 0x37AD8000, 0x37AE0000, 0x37AE8000, 0x37AF0000, 0x37AF8000,
  0x37B00000, 0x37B08000, 0x37B10000, 0x37B18000, 0x37B20000, 0x37B28000, 0x37B30000, 0x37B38000, 0x37B40000, 0x37B48000, 0x37B50000, 0x37B58000, 0x37B60000, 0x37B68000, 0x37B70000, 0x37B78000,
  0x37B80000, 0x37B88000, 0x37B90000, 0x37B98000, 0x37BA0000, 0x37BA8000, 0x37BB0000, 0x37BB8000, 0x37BC0000, 0x37BC8000, 0x37BD0000, 0x37BD8000, 0x37BE0000, 0x37BE8000, 0x37BF0000, 0x37BF8000,
  0x37C00000, 0x37C08000, 0x37C10000, 0x37C18000, 0x37C20000, 0x37C28000, 0x37C30000, 0x37C38000, 0x37C40000, 0x37C48000, 0x37C50000, 0x37C58000, 0x37C60000, 0x37C68000, 0x37C70000, 0x37C78000,
  0x37C80000, 0x37C88000, 0x37C90000, 0x37C98000, 0x37CA0000, 0x37CA8000, 0x37CB0000, 0x37CB8000, 0x37CC0000, 0x37CC8000, 0x37CD0000, 0x37CD8000, 0x37CE0000, 0x37CE8000, 0x37CF0000, 0x37CF8000,
  0x37D00000, 0x37D08000, 0x37D10000, 0x37D18000, 0x37D20000, 0x37D28000, 0x37D30000, 0x37D38000, 0x37D40000, 0x37D48000, 0x37D50000, 0x37D58000, 0x37D60000, 0x37D68000, 0x37D70000, 0x37D78000,
  0x37D80000, 0x37D88000, 0x37D90000, 0x37D98000, 0x37DA0000, 0x37DA8000, 0x37DB0000, 0x37DB8000, 0x37DC0000, 0x37DC8000, 0x37DD0000, 0x37DD8000, 0x37DE0000, 0x37DE8000, 0x37DF0000, 0x37DF8000,
  0x37E00000, 0x37E08000, 0x37E10000, 0x37E18000, 0x37E20000, 0x37E28000, 0x37E30000, 0x37E38000, 0x37E40000, 0x37E48000, 0x37E50000, 0x37E58000, 0x37E60000, 0x37E68000, 0x37E70000, 0x37E78000,
  0x37E80000, 0x37E88000, 0x37E90000, 0x37E98000, 0x37EA0000, 0x37EA8000, 0x37EB0000, 0x37EB8000, 0x37EC0000, 0x37EC8000, 0x37ED0000, 0x37ED8000, 0x37EE0000, 0x37EE8000, 0x37EF0000, 0x37EF8000,
  0x37F00000, 0x37F08000, 0x37F10000, 0x37F18000, 0x37F20000, 0x37F28000, 0x37F30000, 0x37F38000, 0x37F40000, 0x37F48000, 0x37F50000, 0x37F58000, 0x37F60000, 0x37F68000, 0x37F70000, 0x37F78000,
  0x37F80000, 0x37F88000, 0x37F90000, 0x37F98000, 0x37FA0000, 0x37FA8000, 0x37FB0000, 0x37FB8000, 0x37FC0000, 0x37FC8000, 0x37FD0000, 0x37FD8000, 0x37FE0000, 0x37FE8000, 0x37FF0000, 0x37FF8000,
  0x38000000, 0x38004000, 0x38008000, 0x3800C000, 0x38010000, 0x38014000, 0x38018000, 0x3801C000, 0x38020000, 0x38024000, 0x38028000, 0x3802C000, 0x38030000, 0x38034000, 0x38038000, 0x3803C000,
  0x38040000, 0x38044000, 0x38048000, 0x3804C000, 0x38050000, 0x38054000, 0x38058000, 0x3805C000, 0x38060000, 0x38064000, 0x38068000, 0x3806C000, 0x38070000, 0x38074000, 0x38078000, 0x3807C000,
  0x38080000, 0x38084000, 0x38088000, 0x3808C000, 0x38090000, 0x38094000, 0x38098000, 0x3809C000, 0x380A0000, 0x380A4000, 0x380A8000, 0x380AC000, 0x380B0000, 0x380B4000, 0x380B8000, 0x380BC000,
  0x380C0000, 0x380C4000, 0x380C8000, 0x380CC000, 0x380D0000, 0x380D4000, 0x380D8000, 0x380DC000, 0x380E0000, 0x380E4000, 0x380E8000, 0x380EC000, 0x380F0000, 0x380F4000, 0x380F8000, 0x380FC000,
  0x38100000, 0x38104000, 0x38108000, 0x3810C000, 0x38110000, 0x38114000, 0x38118000, 0x3811C000, 0x38120000, 0x38124000, 0x38128000, 0x3812C000, 0x38130000, 0x38134000, 0x38138000, 0x3813C000,
  0x38140000, 0x38144000, 0x38148000, 0x3814C000, 0x38150000, 0x38154000, 0x38158000, 0x3815C000, 0x38160000, 0x38164000, 0x38168000, 0x3816C000, 0x38170000, 0x38174000, 0x38178000, 0x3817C000,
  0x38180000, 0x38184000, 0x38188000, 0x3818C000, 0x38190000, 0x38194000, 0x38198000, 0x3819C000, 0x381A0000, 0x381A4000, 0x381A8000, 0x381AC000, 0x381B0000, 0x381B4000, 0x381B8000, 0x381BC000,
  0x381C0000, 0x381C4000, 0x381C8000, 0x381CC000, 0x381D0000, 0x381D4000, 0x381D8000, 0x381DC000, 0x381E0000, 0x381E4000, 0x381E8000, 0x381EC000, 0x381F0000, 0x381F4000, 0x381F8000, 0x381FC000,
  0x38200000, 0x38204000, 0x38208000, 0x3820C000, 0x38210000, 0x38214000, 0x38218000, 0x3821C000, 0x38220000, 0x38224000, 0x38228000, 0x3822C000, 0x38230000, 0x38234000, 0x38238000, 0x3823C000,
  0x38240000, 0x38244000, 0x38248000, 0x3824C000, 0x38250000, 0x38254000, 0x38258000, 0x3825C000, 0x38260000, 0x38264000, 0x38268000, 0x3826C000, 0x38270000, 0x38274000, 0x38278000, 0x3827C000,
  0x38280000, 0x38284000, 0x38288000, 0x3828C000, 0x38290000, 0x38294000, 0x38298000, 0x3829C000, 0x382A0000, 0x382A4000, 0x382A8000, 0x382AC000, 0x382B0000, 0x382B4000, 0x382B8000, 0x382BC000,
  0x382C0000, 0x382C4000, 0x382C8000, 0x382CC000, 0x382D0000, 0x382D4000, 0x382D8000, 0x382DC000, 0x382E0000, 0x382E4000, 0x382E8000, 0x382EC000, 0x382F0000, 0x382F4000, 0x382F8000, 0x382FC000,
  0x38300000, 0x38304000, 0x38308000, 0x3830C000, 0x38310000, 0x38314000, 0x38318000, 0x3831C000, 0x38320000, 0x38324000, 0x38328000, 0x3832C000, 0x38330000, 0x38334000, 0x38338000, 0x3833C000,
  0x38340000, 0x38344000, 0x38348000, 0x3834C000, 0x38350000, 0x38354000, 0x38358000, 0x3835C000, 0x38360000, 0x38364000, 0x38368000, 0x3836C000, 0x38370000, 0x38374000, 0x38378000, 0x3837C000,
  0x38380000, 0x38384000, 0x38388000, 0x3838C000, 0x38390000, 0x38394000, 0x38398000, 0x3839C000, 0x383A0000, 0x383A4000, 0x383A8000, 0x383AC000, 0x383B0000, 0x383B4000, 0x383B8000, 0x383BC000,
  0x383C0000, 0x383C4000, 0x383C8000, 0x383CC000, 0x383D0000, 0x383D4000, 0x383D8000, 0x383DC000, 0x383E0000, 0x383E4000, 0x383E8000, 0x383EC000, 0x383F0000, 0x383F4000, 0x383F8000, 0x383FC000,
  0x38400000, 0x38404000, 0x38408000, 0x3840C000, 0x38410000, 0x38414000, 0x38418000, 0x3841C000, 0x38420000, 0x38424000, 0x38428000, 0x3842C000, 0x38430000, 0x38434000, 0x38438000, 0x3843C000,
  0x38440000, 0x38444000, 0x38448000, 0x3844C000, 0x38450000, 0x38454000, 0x38458000, 0x3845C000, 0x38460000, 0x38464000, 0x38468000, 0x3846C000, 0x38470000, 0x38474000, 0x38478000, 0x3847C000,
  0x38480000, 0x38484000, 0x38488000, 0x3848C000, 0x38490000, 0x38494000, 0x38498000, 0x3849C000, 0x384A0000, 0x384A4000, 0x384A8000, 0x384AC000, 0x384B0000, 0x384B4000, 0x384B8000, 0x384BC000,
  0x384C0000, 0x384C4000, 0x384C8000, 0x384CC000, 0x384D0000, 0x384D4000, 0x384D8000, 0x384DC000, 0x384E0000, 0x384E4000, 0x384E8000, 0x384EC000, 0x384F0000, 0x384F4000, 0x384F8000, 0x384FC000,
  0x38500000, 0x38504000, 0x38508000, 0x3850C000, 0x38510000, 0x38514000, 0x38518000, 0x3851C000, 0x38520000, 0x38524000, 0x38528000, 0x3852C000, 0x38530000, 0x38534000, 0x38538000, 0x3853C000,
  0x38540000, 0x38544000, 0x38548000, 0x3854C000, 0x38550000, 0x38554000, 0x38558000, 0x3855C000, 0x38560000, 0x38564000, 0x38568000, 0x3856C000, 0x38570000, 0x38574000, 0x38578000, 0x3857C000,
  0x38580000, 0x38584000, 0x38588000, 0x3858C000, 0x38590000, 0x38594000, 0x38598000, 0x3859C000, 0x385A0000, 0x385A4000, 0x385A8000, 0x385AC000, 0x385B0000, 0x385B4000, 0x385B8000, 0x385BC000,
  0x385C0000, 0x385C4000, 0x385C8000, 0x385CC000, 0x385D0000, 0x385D4000, 0x385D8000, 0x385DC000, 0x385E0000, 0x385E4000, 0x385E8000, 0x385EC000, 0x385F0000, 0x385F4000, 0x385F8000, 0x385FC000,
  0x38600000, 0x38604000, 0x38608000, 0x3860C000, 0x38610000, 0x38614000, 0x38618000, 0x3861C000, 0x38620000, 0x38624000, 0x38628000, 0x3862C000, 0x38630000, 0x38634000, 0x38638000, 0x3863C000,
  0x38640000, 0x38644000, 0x38648000, 0x3864C000, 0x38650000, 0x38654000, 0x38658000, 0x3865C000, 0x38660000, 0x38664000, 0x38668000, 0x3866C000, 0x38670000, 0x38674000, 0x38678000, 0x3867C000,
  0x38680000, 0x38684000, 0x38688000, 0x3868C000, 0x38690000, 0x38694000, 0x38698000, 0x3869C000, 0x386A0000, 0x386A4000, 0x386A8000, 0x386AC000, 0x386B0000, 0x386B4000, 0x386B8000, 0x386BC000,
  0x386C0000, 0x386C4000, 0x386C8000, 0x386CC000, 0x386D0000, 0x386D4000, 0x386D8000, 0x386DC000, 0x386E0000, 0x386E4000, 0x386E8000, 0x386EC000, 0x386F0000, 0x386F4000, 0x386F8000, 0x386FC000,
  0x38700000, 0x38704000, 0x38708000, 0x3870C000, 0x38710000, 0x38714000, 0x38718000, 0x3871C000, 0x38720000, 0x38724000, 0x38728000, 0x3872C000, 0x38730000, 0x38734000, 0x38738000, 0x3873C000,
  0x38740000, 0x38744000, 0x38748000, 0x3874C000, 0x38750000, 0x38754000, 0x38758000, 0x3875C000, 0x38760000, 0x38764000, 0x38768000, 0x3876C000, 0x38770000, 0x38774000, 0x38778000, 0x3877C000,
  0x38780000, 0x38784000, 0x38788000, 0x3878C000, 0x38790000, 0x38794000, 0x38798000, 0x3879C000, 0x387A0000, 0x387A4000, 0x387A8000, 0x387AC000, 0x387B0000, 0x387B4000, 0x387B8000, 0x387BC000,
  0x387C0000, 0x387C4000, 0x387C8000, 0x387CC000, 0x387D0000, 0x387D4000, 0x387D8000, 0x387DC000, 0x387E0000, 0x387E4000, 0x387E8000, 0x387EC000, 0x387F0000, 0x387F4000, 0x387F8000, 0x387FC000,
  0x38000000, 0x38002000, 0x38004000, 0x38006000, 0x38008000, 0x3800A000, 0x3800C000, 0x3800E000, 0x38010000, 0x38012000, 0x38014000, 0x38016000, 0x38018000, 0x3801A000, 0x3801C000, 0x3801E000,
  0x38020000, 0x38022000, 0x38024000, 0x38026000, 0x38028000, 0x3802A000, 0x3802C000, 0x3802E000, 0x38030000, 0x38032000, 0x38034000, 0x38036000, 0x38038000, 0x3803A000, 0x3803C000, 0x3803E000,
  0x38040000, 0x38042000, 0x38044000, 0x38046000, 0x38048000, 0x3804A000, 0x3804C000, 0x3804E000, 0x38050000, 0x38052000, 0x38054000, 0x38056000, 0x38058000, 0x3805A000, 0x3805C000, 0x3805E000,
  0x38060000, 0x38062000, 0x38064000, 0x38066000, 0x38068000, 0x3806A000, 0x3806C000, 0x3806E000, 0x38070000, 0x38072000, 0x38074000, 0x38076000, 0x38078000, 0x3807A000, 0x3807C000, 0x3807E000,
  0x38080000, 0x38082000, 0x38084000, 0x38086000, 0x38088000, 0x3808A000, 0x3808C000, 0x3808E000, 0x38090000, 0x38092000, 0x38094000, 0x38096000, 0x38098000, 0x3809A000, 0x3809C000, 0x3809E000,
  0x380A0000, 0x380A2000, 0x380A4000, 0x380A6000, 0x380A8000, 0x380AA000, 0x380AC000, 0x380AE000, 0x380B0000, 0x380B2000, 0x380B4000, 0x380B6000, 0x380B8000, 0x380BA000, 0x380BC000, 0x380BE000,
  0x380C0000, 0x380C2000, 0x380C4000, 0x380C6000, 0x380C8000, 0x380CA000, 0x380CC000, 0x380CE000, 0x380D0000, 0x380D2000, 0x380D4000, 0x380D6000, 0x380D8000, 0x380DA000, 0x380DC000, 0x380DE000,
  0x380E0000, 0x380E2000, 0x380E4000, 0x380E6000, 0x380E8000, 0x380EA000, 0x380EC000, 0x380EE000, 0x380F0000, 0x380F2000, 0x380F4000, 0x380F6000, 0x380F8000, 0x380FA000, 0x380FC000, 0x380FE000,
  0x38100000, 0x38102000, 0x38104000, 0x38106000, 0x38108000, 0x3810A000, 0x3810C000, 0x3810E000, 0x38110000, 0x38112000, 0x38114000, 0x38116000, 0x38118000, 0x3811A000, 0x3811C000, 0x3811E000,
  0x38120000, 0x38122000, 0x38124000, 0x38126000, 0x38128000, 0x3812A000, 0x3812C000, 0x3812E000, 0x38130000, 0x38132000, 0x38134000, 0x38136000, 0x38138000, 0x3813A000, 0x3813C000, 0x3813E000,
  0x38140000, 0x38142000, 0x38144000, 0x38146000, 0x38148000, 0x3814A000, 0x3814C000, 0x3814E000, 0x38150000, 0x38152000, 0x38154000, 0x38156000, 0x38158000, 0x3815A000, 0x3815C000, 0x3815E000,
  0x38160000, 0x38162000, 0x38164000, 0x38166000, 0x38168000, 0x3816A000, 0x3816C000, 0x3816E000, 0x38170000, 0x38172000, 0x38174000, 0x38176000, 0x38178000, 0x3817A000, 0x3817C000, 0x3817E000,
  0x38180000, 0x38182000, 0x38184000, 0x38186000, 0x38188000, 0x3818A000, 0x3818C000, 0x3818E000, 0x38190000, 0x38192000, 0x38194000, 0x38196000, 0x38198000, 0x3819A000, 0x3819C000, 0x3819E000,
  0x381A0000, 0x381A2000, 0x381A4000, 0x381A6000, 0x381A8000, 0x381AA000, 0x381AC000, 0x381AE000, 0x381B0000, 0x381B2000, 0x381B4000, 0x381B6000, 0x381B8000, 0x381BA000, 0x381BC000, 0x381BE000,
  0x381C0000, 0x381C2000, 0x381C4000, 0x381C6000, 0x381C8000, 0x381CA000, 0x381CC000, 0x381CE000, 0x381D0000, 0x381D2000, 0x381D4000, 0x381D6000, 0x381D8000, 0x381DA000, 0x381DC000, 0x381DE000,
  0x381E0000, 0x381E2000, 0x381E4000, 0x381E6000, 0x381E8000, 0x381EA000, 0x381EC000, 0x381EE000, 0x381F0000, 0x381F2000, 0x381F4000, 0x381F6000, 0x381F8000, 0x381FA000, 0x381FC000, 0x381FE000,
  0x38200000, 0x38202000, 0x38204000, 0x38206000, 0x38208000, 0x3820A000, 0x3820C000, 0x3820E000, 0x38210000, 0x38212000, 0x38214000, 0x38216000, 0x38218000, 0x3821A000, 0x3821C000, 0x3821E000,
  0x38220000, 0x38222000, 0x38224000, 0x38226000, 0x38228000, 0x3822A000, 0x3822C000, 0x3822E000, 0x38230000, 0x38232000, 0x38234000, 0x38236000, 0x38238000, 0x3823A000, 0x3823C000, 0x3823E000,
  0x38240000, 0x38242000, 0x38244000, 0x38246000, 0x38248000, 0x3824A000, 0x3824C000, 0x3824E000, 0x38250000, 0x38252000, 0x38254000, 0x38256000, 0x38258000, 0x3825A000, 0x3825C000, 0x3825E000,
  0x38260000, 0x38262000, 0x38264000, 0x38266000, 0x38268000, 0x3826A000, 0x3826C000, 0x3826E000, 0x38270000, 0x38272000, 0x38274000, 0x38276000, 0x38278000, 0x3827A000, 0x3827C000, 0x3827E000,
  0x38280000, 0x38282000, 0x38284000, 0x38286000, 0x38288000, 0x3828A000, 0x3828C000, 0x3828E000, 0x38290000, 0x38292000, 0x38294000, 0x38296000, 0x38298000, 0x3829A000, 0x3829C000, 0x3829E000,
  0x382A0000, 0x382A2000, 0x382A4000, 0x382A6000, 0x382A8000, 0x382AA000, 0x382AC000, 0x382AE000, 0x382B0000, 0x382B2000, 0x382B4000, 0x382B6000, 0x382B8000, 0x382BA000, 0x382BC000, 0x382BE000,
  0x382C0000, 0x382C2000, 0x382C4000, 0x382C6000, 0x382C8000, 0x382CA000, 0x382CC000, 0x382CE000, 0x382D0000, 0x382D2000, 0x382D4000, 0x382D6000, 0x382D8000, 0x382DA000, 0x382DC000, 0x382DE000,
  0x382E0000, 0x382E2000, 0x382E4000, 0x382E6000, 0x382E8000, 0x382EA000, 0x382EC000, 0x382EE000, 0x382F0000, 0x382F2000, 0x382F4000, 0x382F6000, 0x382F8000, 0x382FA000, 0x382FC000, 0x382FE000,
  0x38300000, 0x38302000, 0x38304000, 0x38306000, 0x38308000, 0x3830A000, 0x3830C000, 0x3830E000, 0x38310000, 0x38312000, 0x38314000, 0x38316000, 0x38318000, 0x3831A000, 0x3831C000, 0x3831E000,
  0x38320000, 0x38322000, 0x38324000, 0x38326000, 0x38328000, 0x3832A000, 0x3832C000, 0x3832E000, 0x38330000, 0x38332000, 0x38334000, 0x38336000, 0x38338000, 0x3833A000, 0x3833C000, 0x3833E000,
  0x38340000, 0x38342000, 0x38344000, 0x38346000, 0x38348000, 0x3834A000, 0x3834C000, 0x3834E000, 0x38350000, 0x38352000, 0x38354000, 0x38356000, 0x38358000, 0x3835A000, 0x3835C000, 0x3835E000,
  0x38360000, 0x38362000, 0x38364000, 0x38366000, 0x38368000, 0x3836A000, 0x3836C000, 0x3836E000, 0x38370000, 0x38372000, 0x38374000, 0x38376000, 0x38378000, 0x3837A000, 0x3837C000, 0x3837E000,
  0x38380000, 0x38382000, 0x38384000, 0x38386000, 0x38388000, 0x3838A000, 0x3838C000, 0x3838E000, 0x38390000, 0x38392000, 0x38394000, 0x38396000, 0x38398000, 0x3839A000, 0x3839C000, 0x3839E000,
  0x383A0000, 0x383A2000, 0x383A4000, 0x383A6000, 0x383A8000, 0x383AA000, 0x383AC000, 0x383AE000, 0x383B0000, 0x383B2000, 0x383B4000, 0x383B6000, 0x383B8000, 0x383BA000, 0x383BC000, 0x383BE000,
  0x383C0000, 0x383C2000, 0x383C4000, 0x383C6000, 0x383C8000, 0x383CA000, 0x383CC000, 0x383CE000, 0x383D0000, 0x383D2000, 0x383D4000, 0x383D6000, 0x383D8000, 0x383DA000, 0x383DC000, 0x383DE000,
  0x383E0000, 0x383E2000, 0x383E4000, 0x383E6000, 0x383E8000, 0x383EA000, 0x383EC000, 0x383EE000, 0x383F0000, 0x383F2000, 0x383F4000, 0x383F6000, 0x383F8000, 0x383FA000, 0x383FC000, 0x383FE000,
  0x38400000, 0x38402000, 0x38404000, 0x38406000, 0x38408000, 0x3840A000, 0x3840C000, 0x3840E000, 0x38410000, 0x38412000, 0x38414000, 0x38416000, 0x38418000, 0x3841A000, 0x3841C000, 0x3841E000,
  0x38420000, 0x38422000, 0x38424000, 0x38426000, 0x38428000, 0x3842A000, 0x3842C000, 0x3842E000, 0x38430000, 0x38432000, 0x38434000, 0x38436000, 0x38438000, 0x3843A000, 0x3843C000, 0x3843E000,
  0x38440000, 0x38442000, 0x38444000, 0x38446000, 0x38448000, 0x3844A000, 0x3844C000, 0x3844E000, 0x38450000, 0x38452000, 0x38454000, 0x38456000, 0x38458000, 0x3845A000, 0x3845C000, 0x3845E000,
  0x38460000, 0x38462000, 0x38464000, 0x38466000, 0x38468000, 0x3846A000, 0x3846C000, 0x3846E000, 0x38470000, 0x38472000, 0x38474000, 0x38476000, 0x38478000, 0x3847A000, 0x3847C000, 0x3847E000,
  0x38480000, 0x38482000, 0x38484000, 0x38486000, 0x38488000, 0x3848A000, 0x3848C000, 0x3848E000, 0x38490000, 0x38492000, 0x38494000, 0x38496000, 0x38498000, 0x3849A000, 0x3849C000, 0x3849E000,
  0x384A0000, 0x384A2000, 0x384A4000, 0x384A6000, 0x384A8000, 0x384AA000, 0x384AC000, 0x384AE000, 0x384B0000, 0x384B2000, 0x384B4000, 0x384B6000, 0x384B8000, 0x384BA000, 0x384BC000, 0x384BE000,
  0x384C0000, 0x384C2000, 0x384C4000, 0x384C6000, 0x384C8000, 0x384CA000, 0x384CC000, 0x384CE000, 0x384D0000, 0x384D2000, 0x384D4000, 0x384D6000, 0x384D8000, 0x384DA000, 0x384DC000, 0x384DE000,
  0x384E0000, 0x384E2000, 0x384E4000, 0x384E6000, 0x384E8000, 0x384EA000, 0x384EC000, 0x384EE000, 0x384F0000, 0x384F2000, 0x384F4000, 0x384F6000, 0x384F8000, 0x384FA000, 0x384FC000, 0x384FE000,
  0x38500000, 0x38502000, 0x38504000, 0x38506000, 0x38508000, 0x3850A000, 0x3850C000, 0x3850E000, 0x38510000, 0x38512000, 0x38514000, 0x38516000, 0x38518000, 0x3851A000, 0x3851C000, 0x3851E000,
  0x38520000, 0x38522000, 0x38524000, 0x38526000, 0x38528000, 0x3852A000, 0x3852C000, 0x3852E000, 0x38530000, 0x38532000, 0x38534000, 0x38536000, 0x38538000, 0x3853A000, 0x3853C000, 0x3853E000,
  0x38540000, 0x38542000, 0x38544000, 0x38546000, 0x38548000, 0x3854A000, 0x3854C000, 0x3854E000, 0x38550000, 0x38552000, 0x38554000, 0x38556000, 0x38558000, 0x3855A000, 0x3855C000, 0x3855E000,
  0x38560000, 0x38562000, 0x38564000, 0x38566000, 0x38568000, 0x3856A000, 0x3856C000, 0x3856E000, 0x38570000, 0x38572000, 0x38574000, 0x38576000, 0x38578000, 0x3857A000, 0x3857C000, 0x3857E000,
  0x38580000, 0x38582000, 0x38584000, 0x38586000, 0x38588000, 0x3858A000, 0x3858C000, 0x3858E000, 0x38590000, 0x38592000, 0x38594000, 0x38596000, 0x38598000, 0x3859A000, 0x3859C000, 0x3859E000,
  0x385A0000, 0x385A2000, 0x385A4000, 0x385A6000, 0x385A8000, 0x385AA000, 0x385AC000, 0x385AE000, 0x385B0000, 0x385B2000, 0x385B4000, 0x385B6000, 0x385B8000, 0x385BA000, 0x385BC000, 0x385BE000,
  0x385C0000, 0x385C2000, 0x385C4000, 0x385C6000, 0x385C8000, 0x385CA000, 0x385CC000, 0x385CE000, 0x385D0000, 0x385D2000, 0x385D4000, 0x385D6000, 0x385D8000, 0x385DA000, 0x385DC000, 0x385DE000,
  0x385E0000, 0x385E2000, 0x385E4000, 0x385E6000, 0x385E8000, 0x385EA000, 0x385EC000, 0x385EE000, 0x385F0000, 0x385F2000, 0x385F4000, 0x385F6000, 0x385F8000, 0x385FA000, 0x385FC000, 0x385FE000,
  0x38600000, 0x38602000, 0x38604000, 0x38606000, 0x38608000, 0x3860A000, 0x3860C000, 0x3860E000, 0x38610000, 0x38612000, 0x38614000, 0x38616000, 0x38618000, 0x3861A000, 0x3861C000, 0x3861E000,
  0x38620000, 0x38622000, 0x38624000, 0x38626000, 0x38628000, 0x3862A000, 0x3862C000, 0x3862E000, 0x38630000, 0x38632000, 0x38634000, 0x38636000, 0x38638000, 0x3863A000, 0x3863C000, 0x3863E000,
  0x38640000, 0x38642000, 0x38644000, 0x38646000, 0x38648000, 0x3864A000, 0x3864C000, 0x3864E000, 0x38650000, 0x38652000, 0x38654000, 0x38656000, 0x38658000, 0x3865A000, 0x3865C000, 0x3865E000,
  0x38660000, 0x38662000, 0x38664000, 0x38666000, 0x38668000, 0x3866A000, 0x3866C000, 0x3866E000, 0x38670000, 0x38672000, 0x38674000, 0x38676000, 0x38678000, 0x3867A000, 0x3867C000, 0x3867E000,
  0x38680000, 0x38682000, 0x38684000, 0x38686000, 0x38688000, 0x3868A000, 0x3868C000, 0x3868E000, 0x38690000, 0x38692000, 0x38694000, 0x38696000, 0x38698000, 0x3869A000, 0x3869C000, 0x3869E000,
  0x386A0000, 0x386A2000, 0x386A4000, 0x386A6000, 0x386A8000, 0x386AA000, 0x386AC000, 0x386AE000, 0x386B0000, 0x386B2000, 0x386B4000, 0x386B6000, 0x386B8000, 0x386BA000, 0x386BC000, 0x386BE000,
  0x386C0000, 0x386C2000, 0x386C4000, 0x386C6000, 0x386C8000, 0x386CA000, 0x386CC000, 0x386CE000, 0x386D0000, 0x386D2000, 0x386D4000, 0x386D6000, 0x386D8000, 0x386DA000, 0x386DC000, 0x386DE000,
  0x386E0000, 0x386E2000, 0x386E4000, 0x386E6000, 0x386E8000, 0x386EA000, 0x386EC000, 0x386EE000, 0x386F0000, 0x386F2000, 0x386F4000, 0x386F6000, 0x386F8000, 0x386FA000, 0x386FC000, 0x386FE000,
  0x38700000, 0x38702000, 0x38704000, 0x38706000, 0x38708000, 0x3870A000, 0x3870C000, 0x3870E000, 0x38710000, 0x38712000, 0x38714000, 0x38716000, 0x38718000, 0x3871A000, 0x3871C000, 0x3871E000,
  0x38720000, 0x38722000, 0x38724000, 0x38726000, 0x38728000, 0x3872A000, 0x3872C000, 0x3872E000, 0x38730000, 0x38732000, 0x38734000, 0x38736000, 0x38738000, 0x3873A000, 0x3873C000, 0x3873E000,
  0x38740000, 0x38742000, 0x38744000, 0x38746000, 0x38748000, 0x3874A000, 0x3874C000, 0x3874E000, 0x38750000, 0x38752000, 0x38754000, 0x38756000, 0x38758000, 0x3875A000, 0x3875C000, 0x3875E000,
  0x38760000, 0x38762000, 0x38764000, 0x38766000, 0x38768000, 0x3876A000, 0x3876C000, 0x3876E000, 0x38770000, 0x38772000, 0x38774000, 0x38776000, 0x38778000, 0x3877A000, 0x3877C000, 0x3877E000,
  0x38780000, 0x38782000, 0x38784000, 0x38786000, 0x38788000, 0x3878A000, 0x3878C000, 0x3878E000, 0x38790000, 0x38792000, 0x38794000, 0x38796000, 0x38798000, 0x3879A000, 0x3879C000, 0x3879E000,
  0x387A0000, 0x387A2000, 0x387A4000, 0x387A6000, 0x387A8000, 0x387AA000, 0x387AC000, 0x387AE000, 0x387B0000, 0x387B2000, 0x387B4000, 0x387B6000, 0x387B8000, 0x387BA000, 0x387BC000, 0x387BE000,
  0x387C0000, 0x387C2000, 0x387C4000, 0x387C6000, 0x387C8000, 0x387CA000, 0x387CC000, 0x387CE000, 0x387D0000, 0x387D2000, 0x387D4000, 0x387D6000, 0x387D8000, 0x387DA000, 0x387DC000, 0x387DE000,
  0x387E0000, 0x387E2000, 0x387E4000, 0x387E6000, 0x387E8000, 0x387EA000, 0x387EC000, 0x387EE000, 0x387F0000, 0x387F2000, 0x387F4000, 0x387F6000, 0x387F8000, 0x387FA000, 0x387FC000, 0x387FE000 };
__constant static const uint32_t exponent_table[64] = {
  0x00000000, 0x00800000, 0x01000000, 0x01800000, 0x02000000, 0x02800000, 0x03000000, 0x03800000, 0x04000000, 0x04800000, 0x05000000, 0x05800000, 0x06000000, 0x06800000, 0x07000000, 0x07800000,
  0x08000000, 0x08800000, 0x09000000, 0x09800000, 0x0A000000, 0x0A800000, 0x0B000000, 0x0B800000, 0x0C000000, 0x0C800000, 0x0D000000, 0x0D800000, 0x0E000000, 0x0E800000, 0x0F000000, 0x47800000,
  0x80000000, 0x80800000, 0x81000000, 0x81800000, 0x82000000, 0x82800000, 0x83000000, 0x83800000, 0x84000000, 0x84800000, 0x85000000, 0x85800000, 0x86000000, 0x86800000, 0x87000000, 0x87800000,
  0x88000000, 0x88800000, 0x89000000, 0x89800000, 0x8A000000, 0x8A800000, 0x8B000000, 0x8B800000, 0x8C000000, 0x8C800000, 0x8D000000, 0x8D800000, 0x8E000000, 0x8E800000, 0x8F000000, 0xC7800000 };
__constant static const unsigned short offset_table[64] = {
  0, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024,
  0, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024 };

SCALAR_FUN_ATTR uint16_t float2halfbits(float value) {
  union { float x; uint32_t y; } u;
  u.x = value;
  uint32_t bits = u.y;

  uint16_t hbits = base_table[bits>>23] + (uint16_t)((bits&0x7FFFFF)>>shift_table[bits>>23]);;

  return hbits;
}

SCALAR_FUN_ATTR float halfbits2float(uint16_t value) {
  uint32_t bits = mantissa_table[offset_table[value>>10]+(value&0x3FF)] + exponent_table[value>>10];

  union { uint32_t x; float y; } u;
  u.x = bits;
  return u.y;
}

SCALAR_FUN_ATTR uint16_t halfbitsnextafter(uint16_t from, uint16_t to) {
  int fabs = from & 0x7FFF, tabs = to & 0x7FFF;
  if(fabs > 0x7C00 || tabs > 0x7C00) {
    return ((from&0x7FFF)>0x7C00) ? (from|0x200) : (to|0x200);
  }
  if(from == to || !(fabs|tabs)) {
    return to;
  }
  if(!fabs) {
    return (to&0x8000)+1;
  }
  unsigned int out =
    from +
    (((from>>15)^(unsigned int)((from^(0x8000|(0x8000-(from>>15))))<(to^(0x8000|(0x8000-(to>>15))))))<<1)
    - 1;
  return out;
}

// End of half.h.
// Start of timing.h.

// The function get_wall_time() returns the wall time in microseconds
// (with an unspecified offset).

#ifdef _WIN32

#include <windows.h>

static int64_t get_wall_time(void) {
  LARGE_INTEGER time,freq;
  assert(QueryPerformanceFrequency(&freq));
  assert(QueryPerformanceCounter(&time));
  return ((double)time.QuadPart / freq.QuadPart) * 1000000;
}

#else
// Assuming POSIX

#include <time.h>
#include <sys/time.h>

static int64_t get_wall_time(void) {
  struct timeval time;
  assert(gettimeofday(&time,NULL) == 0);
  return time.tv_sec * 1000000 + time.tv_usec;
}

static int64_t get_wall_time_ns(void) {
  struct timespec time;
  assert(clock_gettime(CLOCK_REALTIME, &time) == 0);
  return time.tv_sec * 1000000000 + time.tv_nsec;
}

#endif

// End of timing.h.
// Start of lock.h.

// A very simple cross-platform implementation of locks.  Uses
// pthreads on Unix and some Windows thing there.  Futhark's
// host-level code is not multithreaded, but user code may be, so we
// need some mechanism for ensuring atomic access to API functions.
// This is that mechanism.  It is not exposed to user code at all, so
// we do not have to worry about name collisions.

#ifdef _WIN32

typedef HANDLE lock_t;

static void create_lock(lock_t *lock) {
  *lock = CreateMutex(NULL,  // Default security attributes.
                      FALSE, // Initially unlocked.
                      NULL); // Unnamed.
}

static void lock_lock(lock_t *lock) {
  assert(WaitForSingleObject(*lock, INFINITE) == WAIT_OBJECT_0);
}

static void lock_unlock(lock_t *lock) {
  assert(ReleaseMutex(*lock));
}

static void free_lock(lock_t *lock) {
  CloseHandle(*lock);
}

#else
// Assuming POSIX

#include <pthread.h>

typedef pthread_mutex_t lock_t;

static void create_lock(lock_t *lock) {
  int r = pthread_mutex_init(lock, NULL);
  assert(r == 0);
}

static void lock_lock(lock_t *lock) {
  int r = pthread_mutex_lock(lock);
  assert(r == 0);
}

static void lock_unlock(lock_t *lock) {
  int r = pthread_mutex_unlock(lock);
  assert(r == 0);
}

static void free_lock(lock_t *lock) {
  // Nothing to do for pthreads.
  (void)lock;
}

#endif

// End of lock.h.
// Start of free_list.h.

typedef uintptr_t fl_mem;

// An entry in the free list.  May be invalid, to avoid having to
// deallocate entries as soon as they are removed.  There is also a
// tag, to help with memory reuse.
struct free_list_entry {
  size_t size;
  fl_mem mem;
  const char *tag;
  unsigned char valid;
};

struct free_list {
  struct free_list_entry *entries; // Pointer to entries.
  int capacity;                    // Number of entries.
  int used;                        // Number of valid entries.
  lock_t lock;                     // Thread safety.
};

static void free_list_init(struct free_list *l) {
  l->capacity = 30; // Picked arbitrarily.
  l->used = 0;
  l->entries = (struct free_list_entry*) malloc(sizeof(struct free_list_entry) * l->capacity);
  for (int i = 0; i < l->capacity; i++) {
    l->entries[i].valid = 0;
  }
  create_lock(&l->lock);
}

// Remove invalid entries from the free list.
static void free_list_pack(struct free_list *l) {
  lock_lock(&l->lock);
  int p = 0;
  for (int i = 0; i < l->capacity; i++) {
    if (l->entries[i].valid) {
      l->entries[p] = l->entries[i];
      if (i > p) {
        l->entries[i].valid = 0;
      }
      p++;
    }
  }

  // Now p is the number of used elements.  We don't want it to go
  // less than the default capacity (although in practice it's OK as
  // long as it doesn't become 1).
  if (p < 30) {
    p = 30;
  }
  l->entries = realloc(l->entries, p * sizeof(struct free_list_entry));
  l->capacity = p;
  lock_unlock(&l->lock);
}

static void free_list_destroy(struct free_list *l) {
  assert(l->used == 0);
  free(l->entries);
  free_lock(&l->lock);
}

// Not part of the interface, so no locking.
static int free_list_find_invalid(struct free_list *l) {
  int i;
  for (i = 0; i < l->capacity; i++) {
    if (!l->entries[i].valid) {
      break;
    }
  }
  return i;
}

static void free_list_insert(struct free_list *l, size_t size, fl_mem mem, const char *tag) {
  lock_lock(&l->lock);
  int i = free_list_find_invalid(l);

  if (i == l->capacity) {
    // List is full; so we have to grow it.
    int new_capacity = l->capacity * 2 * sizeof(struct free_list_entry);
    l->entries = realloc(l->entries, new_capacity);
    for (int j = 0; j < l->capacity; j++) {
      l->entries[j+l->capacity].valid = 0;
    }
    l->capacity *= 2;
  }

  // Now 'i' points to the first invalid entry.
  l->entries[i].valid = 1;
  l->entries[i].size = size;
  l->entries[i].mem = mem;
  l->entries[i].tag = tag;

  l->used++;
  lock_unlock(&l->lock);
}

// Determine whether this entry in the free list is acceptable for
// satisfying the request.  Not public, so no locking.
static bool free_list_acceptable(size_t size, const char* tag, struct free_list_entry *entry) {
  // We check not just the hard requirement (is the entry acceptable
  // and big enough?) but also put a cap on how much wasted space
  // (internal fragmentation) we allow.  This is necessarily a
  // heuristic, and a crude one.

  if (!entry->valid) {
    return false;
  }

  if (size > entry->size) {
    return false;
  }

  // We know the block fits.  Now the question is whether it is too
  // big.  Our policy is as follows:
  //
  // 1) We don't care about wasted space below 4096 bytes (to avoid
  // churn in tiny allocations).
  //
  // 2) If the tag matches, we allow _any_ amount of wasted space.
  //
  // 3) Otherwise we allow up to 50% wasted space.

  if (entry->size < 4096) {
    return true;
  }

  if (entry->tag == tag) {
    return true;
  }

  if (entry->size < size * 2) {
    return true;
  }

  return false;
}

// Find and remove a memory block of the indicated tag, or if that
// does not exist, another memory block with exactly the desired size.
// Returns 0 on success.
static int free_list_find(struct free_list *l, size_t size, const char *tag,
                          size_t *size_out, fl_mem *mem_out) {
  lock_lock(&l->lock);
  int size_match = -1;
  int i;
  int ret = 1;
  for (i = 0; i < l->capacity; i++) {
    if (free_list_acceptable(size, tag, &l->entries[i]) &&
        (size_match < 0 || l->entries[i].size < l->entries[size_match].size)) {
      // If this entry is valid, has sufficient size, and is smaller than the
      // best entry found so far, use this entry.
      size_match = i;
    }
  }

  if (size_match >= 0) {
    l->entries[size_match].valid = 0;
    *size_out = l->entries[size_match].size;
    *mem_out = l->entries[size_match].mem;
    l->used--;
    ret = 0;
  }
  lock_unlock(&l->lock);
  return ret;
}

// Remove the first block in the free list.  Returns 0 if a block was
// removed, and nonzero if the free list was already empty.
static int free_list_first(struct free_list *l, fl_mem *mem_out) {
  lock_lock(&l->lock);
  int ret = 1;
  for (int i = 0; i < l->capacity; i++) {
    if (l->entries[i].valid) {
      l->entries[i].valid = 0;
      *mem_out = l->entries[i].mem;
      l->used--;
      ret = 0;
      break;
    }
  }
  lock_unlock(&l->lock);
  return ret;
}

// End of free_list.h.
// Start of event_list.h

typedef int (*event_report_fn)(struct str_builder*, void*);

struct event {
  void* data;
  event_report_fn f;
  const char* name;
  char *description;
};

struct event_list {
  struct event *events;
  int num_events;
  int capacity;
};

static void event_list_init(struct event_list *l) {
  l->capacity = 100;
  l->num_events = 0;
  l->events = calloc(l->capacity, sizeof(struct event));
}

static void event_list_free(struct event_list *l) {
  free(l->events);
}

static void add_event_to_list(struct event_list *l,
                              const char* name,
                              char* description,
                              void* data,
                              event_report_fn f) {
  if (l->num_events == l->capacity) {
    l->capacity *= 2;
    l->events = realloc(l->events, l->capacity * sizeof(struct event));
  }
  l->events[l->num_events].name = name;
  l->events[l->num_events].description = description;
  l->events[l->num_events].data = data;
  l->events[l->num_events].f = f;
  l->num_events++;
}

static int report_events_in_list(struct event_list *l,
                                 struct str_builder* sb) {
  int ret = 0;
  for (int i = 0; i < l->num_events; i++) {
    if (i != 0) {
      str_builder_str(sb, ",");
    }
    str_builder_str(sb, "{\"name\":");
    str_builder_json_str(sb, l->events[i].name);
    str_builder_str(sb, ",\"description\":");
    str_builder_json_str(sb, l->events[i].description);
    free(l->events[i].description);
    if (l->events[i].f(sb, l->events[i].data) != 0) {
      ret = 1;
      break;
    }
    str_builder(sb, "}");
  }
  event_list_free(l);
  event_list_init(l);
  return ret;
}

// End of event_list.h

#ifdef _MSC_VER
#define inline __inline
#endif
#include <string.h>
#include <string.h>
#include <errno.h>
#include <assert.h>
#include <ctype.h>



#define FUTHARK_F64_ENABLED

// Start of scalar.h.

// Implementation of the primitive scalar operations.  Very
// repetitive.  This code is inserted directly into both CUDA and
// OpenCL programs, as well as the CPU code, so it has some #ifdefs to
// work everywhere.  Some operations are defined as macros because
// this allows us to use them as constant expressions in things like
// array sizes and static initialisers.

// Some of the #ifdefs are because OpenCL uses type-generic functions
// for some operations (e.g. sqrt), while C and CUDA sensibly use
// distinct functions for different precisions (e.g. sqrtf() and
// sqrt()).  This is quite annoying.  Due to C's unfortunate casting
// rules, it is also really easy to accidentally implement
// floating-point functions in the wrong precision, so be careful.

// Double-precision definitions are only included if the preprocessor
// macro FUTHARK_F64_ENABLED is set.

SCALAR_FUN_ATTR int32_t futrts_to_bits32(float x);
SCALAR_FUN_ATTR float futrts_from_bits32(int32_t x);

SCALAR_FUN_ATTR uint8_t add8(uint8_t x, uint8_t y) {
  return x + y;
}

SCALAR_FUN_ATTR uint16_t add16(uint16_t x, uint16_t y) {
  return x + y;
}

SCALAR_FUN_ATTR uint32_t add32(uint32_t x, uint32_t y) {
  return x + y;
}

SCALAR_FUN_ATTR uint64_t add64(uint64_t x, uint64_t y) {
  return x + y;
}

SCALAR_FUN_ATTR uint8_t sub8(uint8_t x, uint8_t y) {
  return x - y;
}

SCALAR_FUN_ATTR uint16_t sub16(uint16_t x, uint16_t y) {
  return x - y;
}

SCALAR_FUN_ATTR uint32_t sub32(uint32_t x, uint32_t y) {
  return x - y;
}

SCALAR_FUN_ATTR uint64_t sub64(uint64_t x, uint64_t y) {
  return x - y;
}

SCALAR_FUN_ATTR uint8_t mul8(uint8_t x, uint8_t y) {
  return x * y;
}

SCALAR_FUN_ATTR uint16_t mul16(uint16_t x, uint16_t y) {
  return x * y;
}

SCALAR_FUN_ATTR uint32_t mul32(uint32_t x, uint32_t y) {
  return x * y;
}

SCALAR_FUN_ATTR uint64_t mul64(uint64_t x, uint64_t y) {
  return x * y;
}

#if ISPC

SCALAR_FUN_ATTR uint8_t udiv8(uint8_t x, uint8_t y) {
  // This strange pattern is used to prevent the ISPC compiler from
  // causing SIGFPEs and bogus results on divisions where inactive lanes
  // have 0-valued divisors. It ensures that any inactive lane instead
  // has a divisor of 1. https://github.com/ispc/ispc/issues/2292
  uint8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x / ys;
}

SCALAR_FUN_ATTR uint16_t udiv16(uint16_t x, uint16_t y) {
  uint16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x / ys;
}

SCALAR_FUN_ATTR uint32_t udiv32(uint32_t x, uint32_t y) {
  uint32_t ys = 1;
  foreach_active(i){
    ys = y;
  }


  return x / ys;
}

SCALAR_FUN_ATTR uint64_t udiv64(uint64_t x, uint64_t y) {
  uint64_t ys = 1;
  foreach_active(i){
    ys = y;
  }


  return x / ys;
}

SCALAR_FUN_ATTR uint8_t udiv_up8(uint8_t x, uint8_t y) {
  uint8_t ys = 1;
  foreach_active(i){
    ys = y;
  }


  return (x + y - 1) / ys;
}

SCALAR_FUN_ATTR uint16_t udiv_up16(uint16_t x, uint16_t y) {
  uint16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return (x + y - 1) / ys;
}

SCALAR_FUN_ATTR uint32_t udiv_up32(uint32_t x, uint32_t y) {
  uint32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return (x + y - 1) / ys;
}

SCALAR_FUN_ATTR uint64_t udiv_up64(uint64_t x, uint64_t y) {
  uint64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return (x + y - 1) / ys;
}

SCALAR_FUN_ATTR uint8_t umod8(uint8_t x, uint8_t y) {
  uint8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x % ys;
}

SCALAR_FUN_ATTR uint16_t umod16(uint16_t x, uint16_t y) {
  uint16_t ys = 1;
  foreach_active(i){
    ys = y;
  }


  return x % ys;
}

SCALAR_FUN_ATTR uint32_t umod32(uint32_t x, uint32_t y) {
  uint32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x % ys;
}

SCALAR_FUN_ATTR uint64_t umod64(uint64_t x, uint64_t y) {
  uint64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x % ys;
}

SCALAR_FUN_ATTR uint8_t udiv_safe8(uint8_t x, uint8_t y) {
  uint8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x / ys;
}

SCALAR_FUN_ATTR uint16_t udiv_safe16(uint16_t x, uint16_t y) {
  uint16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x / ys;
}

SCALAR_FUN_ATTR uint32_t udiv_safe32(uint32_t x, uint32_t y) {
  uint32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x / ys;
}

SCALAR_FUN_ATTR uint64_t udiv_safe64(uint64_t x, uint64_t y) {
  uint64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x / ys;
}

SCALAR_FUN_ATTR uint8_t udiv_up_safe8(uint8_t x, uint8_t y) {
  uint8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : (x + y - 1) / ys;
}

SCALAR_FUN_ATTR uint16_t udiv_up_safe16(uint16_t x, uint16_t y) {
  uint16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : (x + y - 1) / ys;
}

SCALAR_FUN_ATTR uint32_t udiv_up_safe32(uint32_t x, uint32_t y) {
  uint32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : (x + y - 1) / ys;
}

SCALAR_FUN_ATTR uint64_t udiv_up_safe64(uint64_t x, uint64_t y) {
  uint64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : (x + y - 1) / ys;
}

SCALAR_FUN_ATTR uint8_t umod_safe8(uint8_t x, uint8_t y) {
  uint8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x % ys;
}

SCALAR_FUN_ATTR uint16_t umod_safe16(uint16_t x, uint16_t y) {
  uint16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x % ys;
}

SCALAR_FUN_ATTR uint32_t umod_safe32(uint32_t x, uint32_t y) {
  uint32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x % ys;
}

SCALAR_FUN_ATTR uint64_t umod_safe64(uint64_t x, uint64_t y) {
  uint64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x % ys;
}

SCALAR_FUN_ATTR int8_t sdiv8(int8_t x, int8_t y) {
  int8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  int8_t q = x / ys;
  int8_t r = x % ys;

  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}

SCALAR_FUN_ATTR int16_t sdiv16(int16_t x, int16_t y) {
  int16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  int16_t q = x / ys;
  int16_t r = x % ys;

  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}

SCALAR_FUN_ATTR int32_t sdiv32(int32_t x, int32_t y) {
  int32_t ys = 1;
  foreach_active(i){
    ys = y;
  }
  int32_t q = x / ys;
  int32_t r = x % ys;

  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}

SCALAR_FUN_ATTR int64_t sdiv64(int64_t x, int64_t y) {
  int64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  int64_t q = x / ys;
  int64_t r = x % ys;

  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}

SCALAR_FUN_ATTR int8_t sdiv_up8(int8_t x, int8_t y) {
  return sdiv8(x + y - 1, y);
}

SCALAR_FUN_ATTR int16_t sdiv_up16(int16_t x, int16_t y) {
  return sdiv16(x + y - 1, y);
}

SCALAR_FUN_ATTR int32_t sdiv_up32(int32_t x, int32_t y) {
  return sdiv32(x + y - 1, y);
}

SCALAR_FUN_ATTR int64_t sdiv_up64(int64_t x, int64_t y) {
  return sdiv64(x + y - 1, y);
}

SCALAR_FUN_ATTR int8_t smod8(int8_t x, int8_t y) {
  int8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  int8_t r = x % ys;

  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}

SCALAR_FUN_ATTR int16_t smod16(int16_t x, int16_t y) {
  int16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  int16_t r = x % ys;

  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}

SCALAR_FUN_ATTR int32_t smod32(int32_t x, int32_t y) {
  int32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  int32_t r = x % ys;

  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}

SCALAR_FUN_ATTR int64_t smod64(int64_t x, int64_t y) {
  int64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  int64_t r = x % ys;

  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}

SCALAR_FUN_ATTR int8_t sdiv_safe8(int8_t x, int8_t y) {
  return y == 0 ? 0 : sdiv8(x, y);
}

SCALAR_FUN_ATTR int16_t sdiv_safe16(int16_t x, int16_t y) {
  return y == 0 ? 0 : sdiv16(x, y);
}

SCALAR_FUN_ATTR int32_t sdiv_safe32(int32_t x, int32_t y) {
  return y == 0 ? 0 : sdiv32(x, y);
}

SCALAR_FUN_ATTR int64_t sdiv_safe64(int64_t x, int64_t y) {
  return y == 0 ? 0 : sdiv64(x, y);
}

SCALAR_FUN_ATTR int8_t sdiv_up_safe8(int8_t x, int8_t y) {
  return sdiv_safe8(x + y - 1, y);
}

SCALAR_FUN_ATTR int16_t sdiv_up_safe16(int16_t x, int16_t y) {
  return sdiv_safe16(x + y - 1, y);
}

SCALAR_FUN_ATTR int32_t sdiv_up_safe32(int32_t x, int32_t y) {
  return sdiv_safe32(x + y - 1, y);
}

SCALAR_FUN_ATTR int64_t sdiv_up_safe64(int64_t x, int64_t y) {
  return sdiv_safe64(x + y - 1, y);
}

SCALAR_FUN_ATTR int8_t smod_safe8(int8_t x, int8_t y) {
  return y == 0 ? 0 : smod8(x, y);
}

SCALAR_FUN_ATTR int16_t smod_safe16(int16_t x, int16_t y) {
  return y == 0 ? 0 : smod16(x, y);
}

SCALAR_FUN_ATTR int32_t smod_safe32(int32_t x, int32_t y) {
  return y == 0 ? 0 : smod32(x, y);
}

SCALAR_FUN_ATTR int64_t smod_safe64(int64_t x, int64_t y) {
  return y == 0 ? 0 : smod64(x, y);
}

SCALAR_FUN_ATTR int8_t squot8(int8_t x, int8_t y) {
  int8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x / ys;
}

SCALAR_FUN_ATTR int16_t squot16(int16_t x, int16_t y) {
  int16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x / ys;
}

SCALAR_FUN_ATTR int32_t squot32(int32_t x, int32_t y) {
  int32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x / ys;
}

SCALAR_FUN_ATTR int64_t squot64(int64_t x, int64_t y) {
  int64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x / ys;
}

SCALAR_FUN_ATTR int8_t srem8(int8_t x, int8_t y) {
  int8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x % ys;
}

SCALAR_FUN_ATTR int16_t srem16(int16_t x, int16_t y) {
  int16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x % ys;
}

SCALAR_FUN_ATTR int32_t srem32(int32_t x, int32_t y) {
  int32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x % ys;
}

SCALAR_FUN_ATTR int64_t srem64(int64_t x, int64_t y) {
  int8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x % ys;
}

SCALAR_FUN_ATTR int8_t squot_safe8(int8_t x, int8_t y) {
  int8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x / ys;
}

SCALAR_FUN_ATTR int16_t squot_safe16(int16_t x, int16_t y) {
  int16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x / ys;
}

SCALAR_FUN_ATTR int32_t squot_safe32(int32_t x, int32_t y) {
  int32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x / ys;
}

SCALAR_FUN_ATTR int64_t squot_safe64(int64_t x, int64_t y) {
  int64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x / ys;
}

SCALAR_FUN_ATTR int8_t srem_safe8(int8_t x, int8_t y) {
  int8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x % ys;
}

SCALAR_FUN_ATTR int16_t srem_safe16(int16_t x, int16_t y) {
  int16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x % ys;
}

SCALAR_FUN_ATTR int32_t srem_safe32(int32_t x, int32_t y) {
  int32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x % ys;
}

SCALAR_FUN_ATTR int64_t srem_safe64(int64_t x, int64_t y) {
  int64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x % ys;
}

#else

SCALAR_FUN_ATTR uint8_t udiv8(uint8_t x, uint8_t y) {
  return x / y;
}

SCALAR_FUN_ATTR uint16_t udiv16(uint16_t x, uint16_t y) {
  return x / y;
}

SCALAR_FUN_ATTR uint32_t udiv32(uint32_t x, uint32_t y) {
  return x / y;
}

SCALAR_FUN_ATTR uint64_t udiv64(uint64_t x, uint64_t y) {
  return x / y;
}

SCALAR_FUN_ATTR uint8_t udiv_up8(uint8_t x, uint8_t y) {
  return (x + y - 1) / y;
}

SCALAR_FUN_ATTR uint16_t udiv_up16(uint16_t x, uint16_t y) {
  return (x + y - 1) / y;
}

SCALAR_FUN_ATTR uint32_t udiv_up32(uint32_t x, uint32_t y) {
  return (x + y - 1) / y;
}

SCALAR_FUN_ATTR uint64_t udiv_up64(uint64_t x, uint64_t y) {
  return (x + y - 1) / y;
}

SCALAR_FUN_ATTR uint8_t umod8(uint8_t x, uint8_t y) {
  return x % y;
}

SCALAR_FUN_ATTR uint16_t umod16(uint16_t x, uint16_t y) {
  return x % y;
}

SCALAR_FUN_ATTR uint32_t umod32(uint32_t x, uint32_t y) {
  return x % y;
}

SCALAR_FUN_ATTR uint64_t umod64(uint64_t x, uint64_t y) {
  return x % y;
}

SCALAR_FUN_ATTR uint8_t udiv_safe8(uint8_t x, uint8_t y) {
  return y == 0 ? 0 : x / y;
}

SCALAR_FUN_ATTR uint16_t udiv_safe16(uint16_t x, uint16_t y) {
  return y == 0 ? 0 : x / y;
}

SCALAR_FUN_ATTR uint32_t udiv_safe32(uint32_t x, uint32_t y) {
  return y == 0 ? 0 : x / y;
}

SCALAR_FUN_ATTR uint64_t udiv_safe64(uint64_t x, uint64_t y) {
  return y == 0 ? 0 : x / y;
}

SCALAR_FUN_ATTR uint8_t udiv_up_safe8(uint8_t x, uint8_t y) {
  return y == 0 ? 0 : (x + y - 1) / y;
}

SCALAR_FUN_ATTR uint16_t udiv_up_safe16(uint16_t x, uint16_t y) {
  return y == 0 ? 0 : (x + y - 1) / y;
}

SCALAR_FUN_ATTR uint32_t udiv_up_safe32(uint32_t x, uint32_t y) {
  return y == 0 ? 0 : (x + y - 1) / y;
}

SCALAR_FUN_ATTR uint64_t udiv_up_safe64(uint64_t x, uint64_t y) {
  return y == 0 ? 0 : (x + y - 1) / y;
}

SCALAR_FUN_ATTR uint8_t umod_safe8(uint8_t x, uint8_t y) {
  return y == 0 ? 0 : x % y;
}

SCALAR_FUN_ATTR uint16_t umod_safe16(uint16_t x, uint16_t y) {
  return y == 0 ? 0 : x % y;
}

SCALAR_FUN_ATTR uint32_t umod_safe32(uint32_t x, uint32_t y) {
  return y == 0 ? 0 : x % y;
}

SCALAR_FUN_ATTR uint64_t umod_safe64(uint64_t x, uint64_t y) {
  return y == 0 ? 0 : x % y;
}

SCALAR_FUN_ATTR int8_t sdiv8(int8_t x, int8_t y) {
  int8_t q = x / y;
  int8_t r = x % y;

  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}

SCALAR_FUN_ATTR int16_t sdiv16(int16_t x, int16_t y) {
  int16_t q = x / y;
  int16_t r = x % y;

  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}

SCALAR_FUN_ATTR int32_t sdiv32(int32_t x, int32_t y) {
  int32_t q = x / y;
  int32_t r = x % y;

  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}

SCALAR_FUN_ATTR int64_t sdiv64(int64_t x, int64_t y) {
  int64_t q = x / y;
  int64_t r = x % y;

  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}

SCALAR_FUN_ATTR int8_t sdiv_up8(int8_t x, int8_t y) {
  return sdiv8(x + y - 1, y);
}

SCALAR_FUN_ATTR int16_t sdiv_up16(int16_t x, int16_t y) {
  return sdiv16(x + y - 1, y);
}

SCALAR_FUN_ATTR int32_t sdiv_up32(int32_t x, int32_t y) {
  return sdiv32(x + y - 1, y);
}

SCALAR_FUN_ATTR int64_t sdiv_up64(int64_t x, int64_t y) {
  return sdiv64(x + y - 1, y);
}

SCALAR_FUN_ATTR int8_t smod8(int8_t x, int8_t y) {
  int8_t r = x % y;

  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}

SCALAR_FUN_ATTR int16_t smod16(int16_t x, int16_t y) {
  int16_t r = x % y;

  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}

SCALAR_FUN_ATTR int32_t smod32(int32_t x, int32_t y) {
  int32_t r = x % y;

  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}

SCALAR_FUN_ATTR int64_t smod64(int64_t x, int64_t y) {
  int64_t r = x % y;

  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}

SCALAR_FUN_ATTR int8_t sdiv_safe8(int8_t x, int8_t y) {
  return y == 0 ? 0 : sdiv8(x, y);
}

SCALAR_FUN_ATTR int16_t sdiv_safe16(int16_t x, int16_t y) {
  return y == 0 ? 0 : sdiv16(x, y);
}

SCALAR_FUN_ATTR int32_t sdiv_safe32(int32_t x, int32_t y) {
  return y == 0 ? 0 : sdiv32(x, y);
}

SCALAR_FUN_ATTR int64_t sdiv_safe64(int64_t x, int64_t y) {
  return y == 0 ? 0 : sdiv64(x, y);
}

SCALAR_FUN_ATTR int8_t sdiv_up_safe8(int8_t x, int8_t y) {
  return sdiv_safe8(x + y - 1, y);
}

SCALAR_FUN_ATTR int16_t sdiv_up_safe16(int16_t x, int16_t y) {
  return sdiv_safe16(x + y - 1, y);
}

SCALAR_FUN_ATTR int32_t sdiv_up_safe32(int32_t x, int32_t y) {
  return sdiv_safe32(x + y - 1, y);
}

SCALAR_FUN_ATTR int64_t sdiv_up_safe64(int64_t x, int64_t y) {
  return sdiv_safe64(x + y - 1, y);
}

SCALAR_FUN_ATTR int8_t smod_safe8(int8_t x, int8_t y) {
  return y == 0 ? 0 : smod8(x, y);
}

SCALAR_FUN_ATTR int16_t smod_safe16(int16_t x, int16_t y) {
  return y == 0 ? 0 : smod16(x, y);
}

SCALAR_FUN_ATTR int32_t smod_safe32(int32_t x, int32_t y) {
  return y == 0 ? 0 : smod32(x, y);
}

SCALAR_FUN_ATTR int64_t smod_safe64(int64_t x, int64_t y) {
  return y == 0 ? 0 : smod64(x, y);
}

SCALAR_FUN_ATTR int8_t squot8(int8_t x, int8_t y) {
  return x / y;
}

SCALAR_FUN_ATTR int16_t squot16(int16_t x, int16_t y) {
  return x / y;
}

SCALAR_FUN_ATTR int32_t squot32(int32_t x, int32_t y) {
  return x / y;
}

SCALAR_FUN_ATTR int64_t squot64(int64_t x, int64_t y) {
  return x / y;
}

SCALAR_FUN_ATTR int8_t srem8(int8_t x, int8_t y) {
  return x % y;
}

SCALAR_FUN_ATTR int16_t srem16(int16_t x, int16_t y) {
  return x % y;
}

SCALAR_FUN_ATTR int32_t srem32(int32_t x, int32_t y) {
  return x % y;
}

SCALAR_FUN_ATTR int64_t srem64(int64_t x, int64_t y) {
  return x % y;
}

SCALAR_FUN_ATTR int8_t squot_safe8(int8_t x, int8_t y) {
  return y == 0 ? 0 : x / y;
}

SCALAR_FUN_ATTR int16_t squot_safe16(int16_t x, int16_t y) {
  return y == 0 ? 0 : x / y;
}

SCALAR_FUN_ATTR int32_t squot_safe32(int32_t x, int32_t y) {
  return y == 0 ? 0 : x / y;
}

SCALAR_FUN_ATTR int64_t squot_safe64(int64_t x, int64_t y) {
  return y == 0 ? 0 : x / y;
}

SCALAR_FUN_ATTR int8_t srem_safe8(int8_t x, int8_t y) {
  return y == 0 ? 0 : x % y;
}

SCALAR_FUN_ATTR int16_t srem_safe16(int16_t x, int16_t y) {
  return y == 0 ? 0 : x % y;
}

SCALAR_FUN_ATTR int32_t srem_safe32(int32_t x, int32_t y) {
  return y == 0 ? 0 : x % y;
}

SCALAR_FUN_ATTR int64_t srem_safe64(int64_t x, int64_t y) {
  return y == 0 ? 0 : x % y;
}

#endif

SCALAR_FUN_ATTR int8_t smin8(int8_t x, int8_t y) {
  return x < y ? x : y;
}

SCALAR_FUN_ATTR int16_t smin16(int16_t x, int16_t y) {
  return x < y ? x : y;
}

SCALAR_FUN_ATTR int32_t smin32(int32_t x, int32_t y) {
  return x < y ? x : y;
}

SCALAR_FUN_ATTR int64_t smin64(int64_t x, int64_t y) {
  return x < y ? x : y;
}

SCALAR_FUN_ATTR uint8_t umin8(uint8_t x, uint8_t y) {
  return x < y ? x : y;
}

SCALAR_FUN_ATTR uint16_t umin16(uint16_t x, uint16_t y) {
  return x < y ? x : y;
}

SCALAR_FUN_ATTR uint32_t umin32(uint32_t x, uint32_t y) {
  return x < y ? x : y;
}

SCALAR_FUN_ATTR uint64_t umin64(uint64_t x, uint64_t y) {
  return x < y ? x : y;
}

SCALAR_FUN_ATTR int8_t smax8(int8_t x, int8_t y) {
  return x < y ? y : x;
}

SCALAR_FUN_ATTR int16_t smax16(int16_t x, int16_t y) {
  return x < y ? y : x;
}

SCALAR_FUN_ATTR int32_t smax32(int32_t x, int32_t y) {
  return x < y ? y : x;
}

SCALAR_FUN_ATTR int64_t smax64(int64_t x, int64_t y) {
  return x < y ? y : x;
}

SCALAR_FUN_ATTR uint8_t umax8(uint8_t x, uint8_t y) {
  return x < y ? y : x;
}

SCALAR_FUN_ATTR uint16_t umax16(uint16_t x, uint16_t y) {
  return x < y ? y : x;
}

SCALAR_FUN_ATTR uint32_t umax32(uint32_t x, uint32_t y) {
  return x < y ? y : x;
}

SCALAR_FUN_ATTR uint64_t umax64(uint64_t x, uint64_t y) {
  return x < y ? y : x;
}

SCALAR_FUN_ATTR uint8_t shl8(uint8_t x, uint8_t y) {
  return (uint8_t)(x << y);
}

SCALAR_FUN_ATTR uint16_t shl16(uint16_t x, uint16_t y) {
  return (uint16_t)(x << y);
}

SCALAR_FUN_ATTR uint32_t shl32(uint32_t x, uint32_t y) {
  return x << y;
}

SCALAR_FUN_ATTR uint64_t shl64(uint64_t x, uint64_t y) {
  return x << y;
}

SCALAR_FUN_ATTR uint8_t lshr8(uint8_t x, uint8_t y) {
  return x >> y;
}

SCALAR_FUN_ATTR uint16_t lshr16(uint16_t x, uint16_t y) {
  return x >> y;
}

SCALAR_FUN_ATTR uint32_t lshr32(uint32_t x, uint32_t y) {
  return x >> y;
}

SCALAR_FUN_ATTR uint64_t lshr64(uint64_t x, uint64_t y) {
  return x >> y;
}

SCALAR_FUN_ATTR int8_t ashr8(int8_t x, int8_t y) {
  return x >> y;
}

SCALAR_FUN_ATTR int16_t ashr16(int16_t x, int16_t y) {
  return x >> y;
}

SCALAR_FUN_ATTR int32_t ashr32(int32_t x, int32_t y) {
  return x >> y;
}

SCALAR_FUN_ATTR int64_t ashr64(int64_t x, int64_t y) {
  return x >> y;
}

SCALAR_FUN_ATTR uint8_t and8(uint8_t x, uint8_t y) {
  return x & y;
}

SCALAR_FUN_ATTR uint16_t and16(uint16_t x, uint16_t y) {
  return x & y;
}

SCALAR_FUN_ATTR uint32_t and32(uint32_t x, uint32_t y) {
  return x & y;
}

SCALAR_FUN_ATTR uint64_t and64(uint64_t x, uint64_t y) {
  return x & y;
}

SCALAR_FUN_ATTR uint8_t or8(uint8_t x, uint8_t y) {
  return x | y;
}

SCALAR_FUN_ATTR uint16_t or16(uint16_t x, uint16_t y) {
  return x | y;
}

SCALAR_FUN_ATTR uint32_t or32(uint32_t x, uint32_t y) {
  return x | y;
}

SCALAR_FUN_ATTR uint64_t or64(uint64_t x, uint64_t y) {
  return x | y;
}

SCALAR_FUN_ATTR uint8_t xor8(uint8_t x, uint8_t y) {
  return x ^ y;
}

SCALAR_FUN_ATTR uint16_t xor16(uint16_t x, uint16_t y) {
  return x ^ y;
}

SCALAR_FUN_ATTR uint32_t xor32(uint32_t x, uint32_t y) {
  return x ^ y;
}

SCALAR_FUN_ATTR uint64_t xor64(uint64_t x, uint64_t y) {
  return x ^ y;
}

SCALAR_FUN_ATTR bool ult8(uint8_t x, uint8_t y) {
  return x < y;
}

SCALAR_FUN_ATTR bool ult16(uint16_t x, uint16_t y) {
  return x < y;
}

SCALAR_FUN_ATTR bool ult32(uint32_t x, uint32_t y) {
  return x < y;
}

SCALAR_FUN_ATTR bool ult64(uint64_t x, uint64_t y) {
  return x < y;
}

SCALAR_FUN_ATTR bool ule8(uint8_t x, uint8_t y) {
  return x <= y;
}

SCALAR_FUN_ATTR bool ule16(uint16_t x, uint16_t y) {
  return x <= y;
}

SCALAR_FUN_ATTR bool ule32(uint32_t x, uint32_t y) {
  return x <= y;
}

SCALAR_FUN_ATTR bool ule64(uint64_t x, uint64_t y) {
  return x <= y;
}

SCALAR_FUN_ATTR bool slt8(int8_t x, int8_t y) {
  return x < y;
}

SCALAR_FUN_ATTR bool slt16(int16_t x, int16_t y) {
  return x < y;
}

SCALAR_FUN_ATTR bool slt32(int32_t x, int32_t y) {
  return x < y;
}

SCALAR_FUN_ATTR bool slt64(int64_t x, int64_t y) {
  return x < y;
}

SCALAR_FUN_ATTR bool sle8(int8_t x, int8_t y) {
  return x <= y;
}

SCALAR_FUN_ATTR bool sle16(int16_t x, int16_t y) {
  return x <= y;
}

SCALAR_FUN_ATTR bool sle32(int32_t x, int32_t y) {
  return x <= y;
}

SCALAR_FUN_ATTR bool sle64(int64_t x, int64_t y) {
  return x <= y;
}

SCALAR_FUN_ATTR uint8_t pow8(uint8_t x, uint8_t y) {
  uint8_t res = 1, rem = y;

  while (rem != 0) {
    if (rem & 1)
      res *= x;
    rem >>= 1;
    x *= x;
  }
  return res;
}

SCALAR_FUN_ATTR uint16_t pow16(uint16_t x, uint16_t y) {
  uint16_t res = 1, rem = y;

  while (rem != 0) {
    if (rem & 1)
      res *= x;
    rem >>= 1;
    x *= x;
  }
  return res;
}

SCALAR_FUN_ATTR uint32_t pow32(uint32_t x, uint32_t y) {
  uint32_t res = 1, rem = y;

  while (rem != 0) {
    if (rem & 1)
      res *= x;
    rem >>= 1;
    x *= x;
  }
  return res;
}

SCALAR_FUN_ATTR uint64_t pow64(uint64_t x, uint64_t y) {
  uint64_t res = 1, rem = y;

  while (rem != 0) {
    if (rem & 1)
      res *= x;
    rem >>= 1;
    x *= x;
  }
  return res;
}

SCALAR_FUN_ATTR bool itob_i8_bool(int8_t x) {
  return x != 0;
}

SCALAR_FUN_ATTR bool itob_i16_bool(int16_t x) {
  return x != 0;
}

SCALAR_FUN_ATTR bool itob_i32_bool(int32_t x) {
  return x != 0;
}

SCALAR_FUN_ATTR bool itob_i64_bool(int64_t x) {
  return x != 0;
}

SCALAR_FUN_ATTR int8_t btoi_bool_i8(bool x) {
  return x;
}

SCALAR_FUN_ATTR int16_t btoi_bool_i16(bool x) {
  return x;
}

SCALAR_FUN_ATTR int32_t btoi_bool_i32(bool x) {
  return x;
}

SCALAR_FUN_ATTR int64_t btoi_bool_i64(bool x) {
  return x;
}

#define sext_i8_i8(x) ((int8_t) (int8_t) (x))
#define sext_i8_i16(x) ((int16_t) (int8_t) (x))
#define sext_i8_i32(x) ((int32_t) (int8_t) (x))
#define sext_i8_i64(x) ((int64_t) (int8_t) (x))
#define sext_i16_i8(x) ((int8_t) (int16_t) (x))
#define sext_i16_i16(x) ((int16_t) (int16_t) (x))
#define sext_i16_i32(x) ((int32_t) (int16_t) (x))
#define sext_i16_i64(x) ((int64_t) (int16_t) (x))
#define sext_i32_i8(x) ((int8_t) (int32_t) (x))
#define sext_i32_i16(x) ((int16_t) (int32_t) (x))
#define sext_i32_i32(x) ((int32_t) (int32_t) (x))
#define sext_i32_i64(x) ((int64_t) (int32_t) (x))
#define sext_i64_i8(x) ((int8_t) (int64_t) (x))
#define sext_i64_i16(x) ((int16_t) (int64_t) (x))
#define sext_i64_i32(x) ((int32_t) (int64_t) (x))
#define sext_i64_i64(x) ((int64_t) (int64_t) (x))
#define zext_i8_i8(x) ((int8_t) (uint8_t) (x))
#define zext_i8_i16(x) ((int16_t) (uint8_t) (x))
#define zext_i8_i32(x) ((int32_t) (uint8_t) (x))
#define zext_i8_i64(x) ((int64_t) (uint8_t) (x))
#define zext_i16_i8(x) ((int8_t) (uint16_t) (x))
#define zext_i16_i16(x) ((int16_t) (uint16_t) (x))
#define zext_i16_i32(x) ((int32_t) (uint16_t) (x))
#define zext_i16_i64(x) ((int64_t) (uint16_t) (x))
#define zext_i32_i8(x) ((int8_t) (uint32_t) (x))
#define zext_i32_i16(x) ((int16_t) (uint32_t) (x))
#define zext_i32_i32(x) ((int32_t) (uint32_t) (x))
#define zext_i32_i64(x) ((int64_t) (uint32_t) (x))
#define zext_i64_i8(x) ((int8_t) (uint64_t) (x))
#define zext_i64_i16(x) ((int16_t) (uint64_t) (x))
#define zext_i64_i32(x) ((int32_t) (uint64_t) (x))
#define zext_i64_i64(x) ((int64_t) (uint64_t) (x))

SCALAR_FUN_ATTR int8_t abs8(int8_t x) {
  return (int8_t)abs(x);
}

SCALAR_FUN_ATTR int16_t abs16(int16_t x) {
  return (int16_t)abs(x);
}

SCALAR_FUN_ATTR int32_t abs32(int32_t x) {
  return abs(x);
}

SCALAR_FUN_ATTR int64_t abs64(int64_t x) {
#if defined(__OPENCL_VERSION__) || defined(ISPC)
  return abs(x);
#else
  return llabs(x);
#endif
}

#if defined(__OPENCL_VERSION__)
SCALAR_FUN_ATTR int32_t futrts_popc8(int8_t x) {
  return popcount(x);
}

SCALAR_FUN_ATTR int32_t futrts_popc16(int16_t x) {
  return popcount(x);
}

SCALAR_FUN_ATTR int32_t futrts_popc32(int32_t x) {
  return popcount(x);
}

SCALAR_FUN_ATTR int32_t futrts_popc64(int64_t x) {
  return popcount(x);
}
#elif defined(__CUDA_ARCH__)

SCALAR_FUN_ATTR int32_t futrts_popc8(int8_t x) {
  return __popc(zext_i8_i32(x));
}

SCALAR_FUN_ATTR int32_t futrts_popc16(int16_t x) {
  return __popc(zext_i16_i32(x));
}

SCALAR_FUN_ATTR int32_t futrts_popc32(int32_t x) {
  return __popc(x);
}

SCALAR_FUN_ATTR int32_t futrts_popc64(int64_t x) {
  return __popcll(x);
}

#else // Not OpenCL or CUDA, but plain C.

SCALAR_FUN_ATTR int32_t futrts_popc8(uint8_t x) {
  int c = 0;
  for (; x; ++c) { x &= x - 1; }
  return c;
}

SCALAR_FUN_ATTR int32_t futrts_popc16(uint16_t x) {
  int c = 0;
  for (; x; ++c) { x &= x - 1; }
  return c;
}

SCALAR_FUN_ATTR int32_t futrts_popc32(uint32_t x) {
  int c = 0;
  for (; x; ++c) { x &= x - 1; }
  return c;
}

SCALAR_FUN_ATTR int32_t futrts_popc64(uint64_t x) {
  int c = 0;
  for (; x; ++c) { x &= x - 1; }
  return c;
}
#endif

#if defined(__OPENCL_VERSION__)
SCALAR_FUN_ATTR uint8_t  futrts_umul_hi8 ( uint8_t a,  uint8_t b) { return mul_hi(a, b); }
SCALAR_FUN_ATTR uint16_t futrts_umul_hi16(uint16_t a, uint16_t b) { return mul_hi(a, b); }
SCALAR_FUN_ATTR uint32_t futrts_umul_hi32(uint32_t a, uint32_t b) { return mul_hi(a, b); }
SCALAR_FUN_ATTR uint64_t futrts_umul_hi64(uint64_t a, uint64_t b) { return mul_hi(a, b); }
SCALAR_FUN_ATTR uint8_t  futrts_smul_hi8 ( int8_t a,  int8_t b) { return mul_hi(a, b); }
SCALAR_FUN_ATTR uint16_t futrts_smul_hi16(int16_t a, int16_t b) { return mul_hi(a, b); }
SCALAR_FUN_ATTR uint32_t futrts_smul_hi32(int32_t a, int32_t b) { return mul_hi(a, b); }
SCALAR_FUN_ATTR uint64_t futrts_smul_hi64(int64_t a, int64_t b) { return mul_hi(a, b); }
#elif defined(__CUDA_ARCH__)
SCALAR_FUN_ATTR  uint8_t futrts_umul_hi8(uint8_t a, uint8_t b) { return ((uint16_t)a) * ((uint16_t)b) >> 8; }
SCALAR_FUN_ATTR uint16_t futrts_umul_hi16(uint16_t a, uint16_t b) { return ((uint32_t)a) * ((uint32_t)b) >> 16; }
SCALAR_FUN_ATTR uint32_t futrts_umul_hi32(uint32_t a, uint32_t b) { return __umulhi(a, b); }
SCALAR_FUN_ATTR uint64_t futrts_umul_hi64(uint64_t a, uint64_t b) { return __umul64hi(a, b); }
SCALAR_FUN_ATTR  uint8_t futrts_smul_hi8 ( int8_t a, int8_t b) { return ((int16_t)a) * ((int16_t)b) >> 8; }
SCALAR_FUN_ATTR uint16_t futrts_smul_hi16(int16_t a, int16_t b) { return ((int32_t)a) * ((int32_t)b) >> 16; }
SCALAR_FUN_ATTR uint32_t futrts_smul_hi32(int32_t a, int32_t b) { return __mulhi(a, b); }
SCALAR_FUN_ATTR uint64_t futrts_smul_hi64(int64_t a, int64_t b) { return __mul64hi(a, b); }
#elif ISPC
SCALAR_FUN_ATTR uint8_t futrts_umul_hi8(uint8_t a, uint8_t b) { return ((uint16_t)a) * ((uint16_t)b) >> 8; }
SCALAR_FUN_ATTR uint16_t futrts_umul_hi16(uint16_t a, uint16_t b) { return ((uint32_t)a) * ((uint32_t)b) >> 16; }
SCALAR_FUN_ATTR uint32_t futrts_umul_hi32(uint32_t a, uint32_t b) { return ((uint64_t)a) * ((uint64_t)b) >> 32; }
SCALAR_FUN_ATTR uint64_t futrts_umul_hi64(uint64_t a, uint64_t b) {
  uint64_t ah = a >> 32;
  uint64_t al = a & 0xffffffff;
  uint64_t bh = b >> 32;
  uint64_t bl = b & 0xffffffff;

  uint64_t p1 = al * bl;
  uint64_t p2 = al * bh;
  uint64_t p3 = ah * bl;
  uint64_t p4 = ah * bh;

  uint64_t p1h = p1 >> 32;
  uint64_t p2h = p2 >> 32;
  uint64_t p3h = p3 >> 32;
  uint64_t p2l = p2 & 0xffffffff;
  uint64_t p3l = p3 & 0xffffffff;

  uint64_t l = p1h + p2l + p3l;
  uint64_t m = (p2 >> 32) + (p3 >> 32);
  uint64_t h = (l >> 32) + m + p4;

  return h;
}
SCALAR_FUN_ATTR  int8_t futrts_smul_hi8 ( int8_t a,  int8_t b) { return ((uint16_t)a) * ((uint16_t)b) >> 8; }
SCALAR_FUN_ATTR int16_t futrts_smul_hi16(int16_t a, int16_t b) { return ((uint32_t)a) * ((uint32_t)b) >> 16; }
SCALAR_FUN_ATTR int32_t futrts_smul_hi32(int32_t a, int32_t b) { return ((uint64_t)a) * ((uint64_t)b) >> 32; }
SCALAR_FUN_ATTR int64_t futrts_smul_hi64(int64_t a, int64_t b) {
  uint64_t ah = a >> 32;
  uint64_t al = a & 0xffffffff;
  uint64_t bh = b >> 32;
  uint64_t bl = b & 0xffffffff;

  uint64_t p1 =  al * bl;
  int64_t  p2 = al * bh;
  int64_t  p3 = ah * bl;
  uint64_t p4 =  ah * bh;

  uint64_t p1h = p1 >> 32;
  uint64_t p2h = p2 >> 32;
  uint64_t p3h = p3 >> 32;
  uint64_t p2l = p2 & 0xffffffff;
  uint64_t p3l = p3 & 0xffffffff;

  uint64_t l = p1h + p2l + p3l;
  uint64_t m = (p2 >> 32) + (p3 >> 32);
  uint64_t h = (l >> 32) + m + p4;

  return h;
}

#else // Not OpenCL, ISPC, or CUDA, but plain C.
SCALAR_FUN_ATTR uint8_t futrts_umul_hi8(uint8_t a, uint8_t b) { return ((uint16_t)a) * ((uint16_t)b) >> 8; }
SCALAR_FUN_ATTR uint16_t futrts_umul_hi16(uint16_t a, uint16_t b) { return ((uint32_t)a) * ((uint32_t)b) >> 16; }
SCALAR_FUN_ATTR uint32_t futrts_umul_hi32(uint32_t a, uint32_t b) { return ((uint64_t)a) * ((uint64_t)b) >> 32; }
SCALAR_FUN_ATTR uint64_t futrts_umul_hi64(uint64_t a, uint64_t b) { return ((__uint128_t)a) * ((__uint128_t)b) >> 64; }
SCALAR_FUN_ATTR int8_t futrts_smul_hi8(int8_t a, int8_t b) { return ((int16_t)a) * ((int16_t)b) >> 8; }
SCALAR_FUN_ATTR int16_t futrts_smul_hi16(int16_t a, int16_t b) { return ((int32_t)a) * ((int32_t)b) >> 16; }
SCALAR_FUN_ATTR int32_t futrts_smul_hi32(int32_t a, int32_t b) { return ((int64_t)a) * ((int64_t)b) >> 32; }
SCALAR_FUN_ATTR int64_t futrts_smul_hi64(int64_t a, int64_t b) { return ((__int128_t)a) * ((__int128_t)b) >> 64; }
#endif

#if defined(__OPENCL_VERSION__)
SCALAR_FUN_ATTR  uint8_t futrts_umad_hi8 ( uint8_t a,  uint8_t b,  uint8_t c) { return mad_hi(a, b, c); }
SCALAR_FUN_ATTR uint16_t futrts_umad_hi16(uint16_t a, uint16_t b, uint16_t c) { return mad_hi(a, b, c); }
SCALAR_FUN_ATTR uint32_t futrts_umad_hi32(uint32_t a, uint32_t b, uint32_t c) { return mad_hi(a, b, c); }
SCALAR_FUN_ATTR uint64_t futrts_umad_hi64(uint64_t a, uint64_t b, uint64_t c) { return mad_hi(a, b, c); }
SCALAR_FUN_ATTR  uint8_t futrts_smad_hi8( int8_t a,  int8_t b,   int8_t c) { return mad_hi(a, b, c); }
SCALAR_FUN_ATTR uint16_t futrts_smad_hi16(int16_t a, int16_t b, int16_t c) { return mad_hi(a, b, c); }
SCALAR_FUN_ATTR uint32_t futrts_smad_hi32(int32_t a, int32_t b, int32_t c) { return mad_hi(a, b, c); }
SCALAR_FUN_ATTR uint64_t futrts_smad_hi64(int64_t a, int64_t b, int64_t c) { return mad_hi(a, b, c); }
#else // Not OpenCL

SCALAR_FUN_ATTR  uint8_t futrts_umad_hi8( uint8_t a,  uint8_t b,  uint8_t c) { return futrts_umul_hi8(a, b) + c; }
SCALAR_FUN_ATTR uint16_t futrts_umad_hi16(uint16_t a, uint16_t b, uint16_t c) { return futrts_umul_hi16(a, b) + c; }
SCALAR_FUN_ATTR uint32_t futrts_umad_hi32(uint32_t a, uint32_t b, uint32_t c) { return futrts_umul_hi32(a, b) + c; }
SCALAR_FUN_ATTR uint64_t futrts_umad_hi64(uint64_t a, uint64_t b, uint64_t c) { return futrts_umul_hi64(a, b) + c; }
SCALAR_FUN_ATTR  uint8_t futrts_smad_hi8 ( int8_t a,  int8_t b,  int8_t c) { return futrts_smul_hi8(a, b) + c; }
SCALAR_FUN_ATTR uint16_t futrts_smad_hi16(int16_t a, int16_t b, int16_t c) { return futrts_smul_hi16(a, b) + c; }
SCALAR_FUN_ATTR uint32_t futrts_smad_hi32(int32_t a, int32_t b, int32_t c) { return futrts_smul_hi32(a, b) + c; }
SCALAR_FUN_ATTR uint64_t futrts_smad_hi64(int64_t a, int64_t b, int64_t c) { return futrts_smul_hi64(a, b) + c; }
#endif

#if defined(__OPENCL_VERSION__)
SCALAR_FUN_ATTR int32_t futrts_clzz8(int8_t x) {
  return clz(x);
}

SCALAR_FUN_ATTR int32_t futrts_clzz16(int16_t x) {
  return clz(x);
}

SCALAR_FUN_ATTR int32_t futrts_clzz32(int32_t x) {
  return clz(x);
}

SCALAR_FUN_ATTR int32_t futrts_clzz64(int64_t x) {
  return clz(x);
}

#elif defined(__CUDA_ARCH__)

SCALAR_FUN_ATTR int32_t futrts_clzz8(int8_t x) {
  return __clz(zext_i8_i32(x)) - 24;
}

SCALAR_FUN_ATTR int32_t futrts_clzz16(int16_t x) {
  return __clz(zext_i16_i32(x)) - 16;
}

SCALAR_FUN_ATTR int32_t futrts_clzz32(int32_t x) {
  return __clz(x);
}

SCALAR_FUN_ATTR int32_t futrts_clzz64(int64_t x) {
  return __clzll(x);
}

#elif ISPC

SCALAR_FUN_ATTR int32_t futrts_clzz8(int8_t x) {
  return count_leading_zeros((int32_t)(uint8_t)x)-24;
}

SCALAR_FUN_ATTR int32_t futrts_clzz16(int16_t x) {
  return count_leading_zeros((int32_t)(uint16_t)x)-16;
}

SCALAR_FUN_ATTR int32_t futrts_clzz32(int32_t x) {
  return count_leading_zeros(x);
}

SCALAR_FUN_ATTR int32_t futrts_clzz64(int64_t x) {
  return count_leading_zeros(x);
}

#else // Not OpenCL, ISPC or CUDA, but plain C.

SCALAR_FUN_ATTR int32_t futrts_clzz8(int8_t x) {
  return x == 0 ? 8 : __builtin_clz((uint32_t)zext_i8_i32(x)) - 24;
}

SCALAR_FUN_ATTR int32_t futrts_clzz16(int16_t x) {
  return x == 0 ? 16 : __builtin_clz((uint32_t)zext_i16_i32(x)) - 16;
}

SCALAR_FUN_ATTR int32_t futrts_clzz32(int32_t x) {
  return x == 0 ? 32 : __builtin_clz((uint32_t)x);
}

SCALAR_FUN_ATTR int32_t futrts_clzz64(int64_t x) {
  return x == 0 ? 64 : __builtin_clzll((uint64_t)x);
}
#endif

#if defined(__OPENCL_VERSION__)
SCALAR_FUN_ATTR int32_t futrts_ctzz8(int8_t x) {
  int i = 0;
  for (; i < 8 && (x & 1) == 0; i++, x >>= 1)
    ;
  return i;
}

SCALAR_FUN_ATTR int32_t futrts_ctzz16(int16_t x) {
  int i = 0;
  for (; i < 16 && (x & 1) == 0; i++, x >>= 1)
    ;
  return i;
}

SCALAR_FUN_ATTR int32_t futrts_ctzz32(int32_t x) {
  int i = 0;
  for (; i < 32 && (x & 1) == 0; i++, x >>= 1)
    ;
  return i;
}

SCALAR_FUN_ATTR int32_t futrts_ctzz64(int64_t x) {
  int i = 0;
  for (; i < 64 && (x & 1) == 0; i++, x >>= 1)
    ;
  return i;
}

#elif defined(__CUDA_ARCH__)

SCALAR_FUN_ATTR int32_t futrts_ctzz8(int8_t x) {
  int y = __ffs(x);
  return y == 0 ? 8 : y - 1;
}

SCALAR_FUN_ATTR int32_t futrts_ctzz16(int16_t x) {
  int y = __ffs(x);
  return y == 0 ? 16 : y - 1;
}

SCALAR_FUN_ATTR int32_t futrts_ctzz32(int32_t x) {
  int y = __ffs(x);
  return y == 0 ? 32 : y - 1;
}

SCALAR_FUN_ATTR int32_t futrts_ctzz64(int64_t x) {
  int y = __ffsll(x);
  return y == 0 ? 64 : y - 1;
}

#elif ISPC

SCALAR_FUN_ATTR int32_t futrts_ctzz8(int8_t x) {
  return x == 0 ? 8 : count_trailing_zeros((int32_t)x);
}

SCALAR_FUN_ATTR int32_t futrts_ctzz16(int16_t x) {
  return x == 0 ? 16 : count_trailing_zeros((int32_t)x);
}

SCALAR_FUN_ATTR int32_t futrts_ctzz32(int32_t x) {
  return count_trailing_zeros(x);
}

SCALAR_FUN_ATTR int32_t futrts_ctzz64(int64_t x) {
  return count_trailing_zeros(x);
}

#else // Not OpenCL or CUDA, but plain C.

SCALAR_FUN_ATTR int32_t futrts_ctzz8(int8_t x) {
  return x == 0 ? 8 : __builtin_ctz((uint32_t)x);
}

SCALAR_FUN_ATTR int32_t futrts_ctzz16(int16_t x) {
  return x == 0 ? 16 : __builtin_ctz((uint32_t)x);
}

SCALAR_FUN_ATTR int32_t futrts_ctzz32(int32_t x) {
  return x == 0 ? 32 : __builtin_ctz((uint32_t)x);
}

SCALAR_FUN_ATTR int32_t futrts_ctzz64(int64_t x) {
  return x == 0 ? 64 : __builtin_ctzll((uint64_t)x);
}
#endif

SCALAR_FUN_ATTR float fdiv32(float x, float y) {
  return x / y;
}

SCALAR_FUN_ATTR float fadd32(float x, float y) {
  return x + y;
}

SCALAR_FUN_ATTR float fsub32(float x, float y) {
  return x - y;
}

SCALAR_FUN_ATTR float fmul32(float x, float y) {
  return x * y;
}

SCALAR_FUN_ATTR bool cmplt32(float x, float y) {
  return x < y;
}

SCALAR_FUN_ATTR bool cmple32(float x, float y) {
  return x <= y;
}

SCALAR_FUN_ATTR float sitofp_i8_f32(int8_t x) {
  return (float) x;
}

SCALAR_FUN_ATTR float sitofp_i16_f32(int16_t x) {
  return (float) x;
}

SCALAR_FUN_ATTR float sitofp_i32_f32(int32_t x) {
  return (float) x;
}

SCALAR_FUN_ATTR float sitofp_i64_f32(int64_t x) {
  return (float) x;
}

SCALAR_FUN_ATTR float uitofp_i8_f32(uint8_t x) {
  return (float) x;
}

SCALAR_FUN_ATTR float uitofp_i16_f32(uint16_t x) {
  return (float) x;
}

SCALAR_FUN_ATTR float uitofp_i32_f32(uint32_t x) {
  return (float) x;
}

SCALAR_FUN_ATTR float uitofp_i64_f32(uint64_t x) {
  return (float) x;
}

#ifdef __OPENCL_VERSION__
SCALAR_FUN_ATTR float fabs32(float x) {
  return fabs(x);
}

SCALAR_FUN_ATTR float fmax32(float x, float y) {
  return fmax(x, y);
}

SCALAR_FUN_ATTR float fmin32(float x, float y) {
  return fmin(x, y);
}

SCALAR_FUN_ATTR float fpow32(float x, float y) {
  return pow(x, y);
}

#elif ISPC

SCALAR_FUN_ATTR float fabs32(float x) {
  return abs(x);
}

SCALAR_FUN_ATTR float fmax32(float x, float y) {
  return isnan(x) ? y : isnan(y) ? x : max(x, y);
}

SCALAR_FUN_ATTR float fmin32(float x, float y) {
  return isnan(x) ? y : isnan(y) ? x : min(x, y);
}

SCALAR_FUN_ATTR float fpow32(float a, float b) {
  float ret;
  foreach_active (i) {
      uniform float r = __stdlib_powf(extract(a, i), extract(b, i));
      ret = insert(ret, i, r);
  }
  return ret;
}

#else // Not OpenCL, but CUDA or plain C.

SCALAR_FUN_ATTR float fabs32(float x) {
  return fabsf(x);
}

SCALAR_FUN_ATTR float fmax32(float x, float y) {
  return fmaxf(x, y);
}

SCALAR_FUN_ATTR float fmin32(float x, float y) {
  return fminf(x, y);
}

SCALAR_FUN_ATTR float fpow32(float x, float y) {
  return powf(x, y);
}
#endif

SCALAR_FUN_ATTR bool futrts_isnan32(float x) {
  return isnan(x);
}

#if ISPC

SCALAR_FUN_ATTR bool futrts_isinf32(float x) {
  return !isnan(x) && isnan(x - x);
}

SCALAR_FUN_ATTR bool futrts_isfinite32(float x) {
  return !isnan(x) && !futrts_isinf32(x);
}

#else

SCALAR_FUN_ATTR bool futrts_isinf32(float x) {
  return isinf(x);
}

#endif

SCALAR_FUN_ATTR int8_t fptosi_f32_i8(float x) {
  if (futrts_isnan32(x) || futrts_isinf32(x)) {
    return 0;
  } else {
    return (int8_t) x;
  }
}

SCALAR_FUN_ATTR int16_t fptosi_f32_i16(float x) {
  if (futrts_isnan32(x) || futrts_isinf32(x)) {
    return 0;
  } else {
    return (int16_t) x;
  }
}

SCALAR_FUN_ATTR int32_t fptosi_f32_i32(float x) {
  if (futrts_isnan32(x) || futrts_isinf32(x)) {
    return 0;
  } else {
    return (int32_t) x;
  }
}

SCALAR_FUN_ATTR int64_t fptosi_f32_i64(float x) {
  if (futrts_isnan32(x) || futrts_isinf32(x)) {
    return 0;
  } else {
    return (int64_t) x;
  };
}

SCALAR_FUN_ATTR uint8_t fptoui_f32_i8(float x) {
  if (futrts_isnan32(x) || futrts_isinf32(x)) {
    return 0;
  } else {
    return (uint8_t) (int8_t) x;
  }
}

SCALAR_FUN_ATTR uint16_t fptoui_f32_i16(float x) {
  if (futrts_isnan32(x) || futrts_isinf32(x)) {
    return 0;
  } else {
    return (uint16_t) (int16_t) x;
  }
}

SCALAR_FUN_ATTR uint32_t fptoui_f32_i32(float x) {
  if (futrts_isnan32(x) || futrts_isinf32(x)) {
    return 0;
  } else {
    return (uint32_t) (int32_t) x;
  }
}

SCALAR_FUN_ATTR uint64_t fptoui_f32_i64(float x) {
  if (futrts_isnan32(x) || futrts_isinf32(x)) {
    return 0;
  } else {
    return (uint64_t) (int64_t) x;
  }
}

SCALAR_FUN_ATTR bool ftob_f32_bool(float x) {
  return x != 0;
}

SCALAR_FUN_ATTR float btof_bool_f32(bool x) {
  return x ? 1 : 0;
}

#ifdef __OPENCL_VERSION__
SCALAR_FUN_ATTR float futrts_log32(float x) {
  return log(x);
}

SCALAR_FUN_ATTR float futrts_log2_32(float x) {
  return log2(x);
}

SCALAR_FUN_ATTR float futrts_log10_32(float x) {
  return log10(x);
}

SCALAR_FUN_ATTR float futrts_log1p_32(float x) {
  return log1p(x);
}

SCALAR_FUN_ATTR float futrts_sqrt32(float x) {
  return sqrt(x);
}

SCALAR_FUN_ATTR float futrts_cbrt32(float x) {
  return cbrt(x);
}

SCALAR_FUN_ATTR float futrts_exp32(float x) {
  return exp(x);
}

SCALAR_FUN_ATTR float futrts_cos32(float x) {
  return cos(x);
}

SCALAR_FUN_ATTR float futrts_sin32(float x) {
  return sin(x);
}

SCALAR_FUN_ATTR float futrts_tan32(float x) {
  return tan(x);
}

SCALAR_FUN_ATTR float futrts_acos32(float x) {
  return acos(x);
}

SCALAR_FUN_ATTR float futrts_asin32(float x) {
  return asin(x);
}

SCALAR_FUN_ATTR float futrts_atan32(float x) {
  return atan(x);
}

SCALAR_FUN_ATTR float futrts_cosh32(float x) {
  return cosh(x);
}

SCALAR_FUN_ATTR float futrts_sinh32(float x) {
  return sinh(x);
}

SCALAR_FUN_ATTR float futrts_tanh32(float x) {
  return tanh(x);
}

SCALAR_FUN_ATTR float futrts_acosh32(float x) {
  return acosh(x);
}

SCALAR_FUN_ATTR float futrts_asinh32(float x) {
  return asinh(x);
}

SCALAR_FUN_ATTR float futrts_atanh32(float x) {
  return atanh(x);
}

SCALAR_FUN_ATTR float futrts_atan2_32(float x, float y) {
  return atan2(x, y);
}

SCALAR_FUN_ATTR float futrts_hypot32(float x, float y) {
  return hypot(x, y);
}

SCALAR_FUN_ATTR float futrts_gamma32(float x) {
  return tgamma(x);
}

SCALAR_FUN_ATTR float futrts_lgamma32(float x) {
  return lgamma(x);
}

SCALAR_FUN_ATTR float futrts_erf32(float x) {
  return erf(x);
}

SCALAR_FUN_ATTR float futrts_erfc32(float x) {
  return erfc(x);
}

SCALAR_FUN_ATTR float fmod32(float x, float y) {
  return fmod(x, y);
}

SCALAR_FUN_ATTR float futrts_round32(float x) {
  return rint(x);
}

SCALAR_FUN_ATTR float futrts_floor32(float x) {
  return floor(x);
}

SCALAR_FUN_ATTR float futrts_ceil32(float x) {
  return ceil(x);
}

SCALAR_FUN_ATTR float futrts_nextafter32(float x, float y) {
  return nextafter(x, y);
}

SCALAR_FUN_ATTR float futrts_lerp32(float v0, float v1, float t) {
  return mix(v0, v1, t);
}

SCALAR_FUN_ATTR float futrts_ldexp32(float x, int32_t y) {
  return ldexp(x, y);
}

SCALAR_FUN_ATTR float futrts_copysign32(float x, float y) {
  return copysign(x, y);
}

SCALAR_FUN_ATTR float futrts_mad32(float a, float b, float c) {
  return mad(a, b, c);
}

SCALAR_FUN_ATTR float futrts_fma32(float a, float b, float c) {
  return fma(a, b, c);
}

#elif ISPC

SCALAR_FUN_ATTR float futrts_log32(float x) {
  return futrts_isfinite32(x) || (futrts_isinf32(x) && x < 0)? log(x) : x;
}

SCALAR_FUN_ATTR float futrts_log2_32(float x) {
  return futrts_log32(x) / log(2.0f);
}

SCALAR_FUN_ATTR float futrts_log10_32(float x) {
  return futrts_log32(x) / log(10.0f);
}

SCALAR_FUN_ATTR float futrts_log1p_32(float x) {
  if(x == -1.0f || (futrts_isinf32(x) && x > 0.0f)) return x / 0.0f;
  float y = 1.0f + x;
  float z = y - 1.0f;
  return log(y) - (z-x)/y;
}

SCALAR_FUN_ATTR float futrts_sqrt32(float x) {
  return sqrt(x);
}

extern "C" unmasked uniform float cbrtf(uniform float);
SCALAR_FUN_ATTR float futrts_cbrt32(float x) {
  float res;
  foreach_active (i) {
    uniform float r = cbrtf(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

SCALAR_FUN_ATTR float futrts_exp32(float x) {
  return exp(x);
}

SCALAR_FUN_ATTR float futrts_cos32(float x) {
  return cos(x);
}

SCALAR_FUN_ATTR float futrts_sin32(float x) {
  return sin(x);
}

SCALAR_FUN_ATTR float futrts_tan32(float x) {
  return tan(x);
}

SCALAR_FUN_ATTR float futrts_acos32(float x) {
  return acos(x);
}

SCALAR_FUN_ATTR float futrts_asin32(float x) {
  return asin(x);
}

SCALAR_FUN_ATTR float futrts_atan32(float x) {
  return atan(x);
}

SCALAR_FUN_ATTR float futrts_cosh32(float x) {
  return (exp(x)+exp(-x)) / 2.0f;
}

SCALAR_FUN_ATTR float futrts_sinh32(float x) {
  return (exp(x)-exp(-x)) / 2.0f;
}

SCALAR_FUN_ATTR float futrts_tanh32(float x) {
  return futrts_sinh32(x)/futrts_cosh32(x);
}

SCALAR_FUN_ATTR float futrts_acosh32(float x) {
  float f = x+sqrt(x*x-1);
  if(futrts_isfinite32(f)) return log(f);
  return f;
}

SCALAR_FUN_ATTR float futrts_asinh32(float x) {
  float f = x+sqrt(x*x+1);
  if(futrts_isfinite32(f)) return log(f);
  return f;

}

SCALAR_FUN_ATTR float futrts_atanh32(float x) {
  float f = (1+x)/(1-x);
  if(futrts_isfinite32(f)) return log(f)/2.0f;
  return f;

}

SCALAR_FUN_ATTR float futrts_atan2_32(float x, float y) {
  return (x == 0.0f && y == 0.0f) ? 0.0f : atan2(x, y);
}

SCALAR_FUN_ATTR float futrts_hypot32(float x, float y) {
  if (futrts_isfinite32(x) && futrts_isfinite32(y)) {
    x = abs(x);
    y = abs(y);
    float a;
    float b;
    if (x >= y){
        a = x;
        b = y;
    } else {
        a = y;
        b = x;
    }
    if(b == 0){
      return a;
    }

    int e;
    float an;
    float bn;
    an = frexp (a, &e);
    bn = ldexp (b, - e);
    float cn;
    cn = sqrt (an * an + bn * bn);
    return ldexp (cn, e);
  } else {
    if (futrts_isinf32(x) || futrts_isinf32(y)) return INFINITY;
    else return x + y;
  }

}

extern "C" unmasked uniform float tgammaf(uniform float x);
SCALAR_FUN_ATTR float futrts_gamma32(float x) {
  float res;
  foreach_active (i) {
    uniform float r = tgammaf(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

extern "C" unmasked uniform float lgammaf(uniform float x);
SCALAR_FUN_ATTR float futrts_lgamma32(float x) {
  float res;
  foreach_active (i) {
    uniform float r = lgammaf(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

extern "C" unmasked uniform float erff(uniform float x);
SCALAR_FUN_ATTR float futrts_erf32(float x) {
  float res;
  foreach_active (i) {
    uniform float r = erff(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

extern "C" unmasked uniform float erfcf(uniform float x);
SCALAR_FUN_ATTR float futrts_erfc32(float x) {
  float res;
  foreach_active (i) {
    uniform float r = erfcf(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

SCALAR_FUN_ATTR float fmod32(float x, float y) {
  return x - y * trunc(x/y);
}

SCALAR_FUN_ATTR float futrts_round32(float x) {
  return round(x);
}

SCALAR_FUN_ATTR float futrts_floor32(float x) {
  return floor(x);
}

SCALAR_FUN_ATTR float futrts_ceil32(float x) {
  return ceil(x);
}

extern "C" unmasked uniform float nextafterf(uniform float x, uniform float y);
SCALAR_FUN_ATTR float futrts_nextafter32(float x, float y) {
  float res;
  foreach_active (i) {
    uniform float r = nextafterf(extract(x, i), extract(y, i));
    res = insert(res, i, r);
  }
  return res;
}

SCALAR_FUN_ATTR float futrts_lerp32(float v0, float v1, float t) {
  return v0 + (v1 - v0) * t;
}

SCALAR_FUN_ATTR float futrts_ldexp32(float x, int32_t y) {
  return x * pow((double)2.0, (double)y);
}

SCALAR_FUN_ATTR float futrts_copysign32(float x, float y) {
  int32_t xb = futrts_to_bits32(x);
  int32_t yb = futrts_to_bits32(y);
  return futrts_from_bits32((xb & ~(1<<31)) | (yb & (1<<31)));
}

SCALAR_FUN_ATTR float futrts_mad32(float a, float b, float c) {
  return a * b + c;
}

SCALAR_FUN_ATTR float futrts_fma32(float a, float b, float c) {
  return a * b + c;
}

#else // Not OpenCL or ISPC, but CUDA or plain C.

SCALAR_FUN_ATTR float futrts_log32(float x) {
  return logf(x);
}

SCALAR_FUN_ATTR float futrts_log2_32(float x) {
  return log2f(x);
}

SCALAR_FUN_ATTR float futrts_log10_32(float x) {
  return log10f(x);
}

SCALAR_FUN_ATTR float futrts_log1p_32(float x) {
  return log1pf(x);
}

SCALAR_FUN_ATTR float futrts_sqrt32(float x) {
  return sqrtf(x);
}

SCALAR_FUN_ATTR float futrts_cbrt32(float x) {
  return cbrtf(x);
}

SCALAR_FUN_ATTR float futrts_exp32(float x) {
  return expf(x);
}

SCALAR_FUN_ATTR float futrts_cos32(float x) {
  return cosf(x);
}

SCALAR_FUN_ATTR float futrts_sin32(float x) {
  return sinf(x);
}

SCALAR_FUN_ATTR float futrts_tan32(float x) {
  return tanf(x);
}

SCALAR_FUN_ATTR float futrts_acos32(float x) {
  return acosf(x);
}

SCALAR_FUN_ATTR float futrts_asin32(float x) {
  return asinf(x);
}

SCALAR_FUN_ATTR float futrts_atan32(float x) {
  return atanf(x);
}

SCALAR_FUN_ATTR float futrts_cosh32(float x) {
  return coshf(x);
}

SCALAR_FUN_ATTR float futrts_sinh32(float x) {
  return sinhf(x);
}

SCALAR_FUN_ATTR float futrts_tanh32(float x) {
  return tanhf(x);
}

SCALAR_FUN_ATTR float futrts_acosh32(float x) {
  return acoshf(x);
}

SCALAR_FUN_ATTR float futrts_asinh32(float x) {
  return asinhf(x);
}

SCALAR_FUN_ATTR float futrts_atanh32(float x) {
  return atanhf(x);
}

SCALAR_FUN_ATTR float futrts_atan2_32(float x, float y) {
  return atan2f(x, y);
}

SCALAR_FUN_ATTR float futrts_hypot32(float x, float y) {
  return hypotf(x, y);
}

SCALAR_FUN_ATTR float futrts_gamma32(float x) {
  return tgammaf(x);
}

SCALAR_FUN_ATTR float futrts_lgamma32(float x) {
  return lgammaf(x);
}

SCALAR_FUN_ATTR float futrts_erf32(float x) {
  return erff(x);
}

SCALAR_FUN_ATTR float futrts_erfc32(float x) {
  return erfcf(x);
}

SCALAR_FUN_ATTR float fmod32(float x, float y) {
  return fmodf(x, y);
}

SCALAR_FUN_ATTR float futrts_round32(float x) {
  return rintf(x);
}

SCALAR_FUN_ATTR float futrts_floor32(float x) {
  return floorf(x);
}

SCALAR_FUN_ATTR float futrts_ceil32(float x) {
  return ceilf(x);
}

SCALAR_FUN_ATTR float futrts_nextafter32(float x, float y) {
  return nextafterf(x, y);
}

SCALAR_FUN_ATTR float futrts_lerp32(float v0, float v1, float t) {
  return v0 + (v1 - v0) * t;
}

SCALAR_FUN_ATTR float futrts_ldexp32(float x, int32_t y) {
  return ldexpf(x, y);
}

SCALAR_FUN_ATTR float futrts_copysign32(float x, float y) {
  return copysignf(x, y);
}

SCALAR_FUN_ATTR float futrts_mad32(float a, float b, float c) {
  return a * b + c;
}

SCALAR_FUN_ATTR float futrts_fma32(float a, float b, float c) {
  return fmaf(a, b, c);
}
#endif

#if ISPC
SCALAR_FUN_ATTR int32_t futrts_to_bits32(float x) {
  return intbits(x);
}

SCALAR_FUN_ATTR float futrts_from_bits32(int32_t x) {
  return floatbits(x);
}
#else
SCALAR_FUN_ATTR int32_t futrts_to_bits32(float x) {
  union {
    float f;
    int32_t t;
  } p;

  p.f = x;
  return p.t;
}

SCALAR_FUN_ATTR float futrts_from_bits32(int32_t x) {
  union {
    int32_t f;
    float t;
  } p;

  p.f = x;
  return p.t;
}
#endif

SCALAR_FUN_ATTR float fsignum32(float x) {
  return futrts_isnan32(x) ? x : (x > 0 ? 1 : 0) - (x < 0 ? 1 : 0);
}

#ifdef FUTHARK_F64_ENABLED

SCALAR_FUN_ATTR double futrts_from_bits64(int64_t x);
SCALAR_FUN_ATTR int64_t futrts_to_bits64(double x);

#if ISPC
SCALAR_FUN_ATTR bool futrts_isinf64(float x) {
  return !isnan(x) && isnan(x - x);
}

SCALAR_FUN_ATTR bool futrts_isfinite64(float x) {
  return !isnan(x) && !futrts_isinf64(x);
}

SCALAR_FUN_ATTR double fdiv64(double x, double y) {
  return x / y;
}

SCALAR_FUN_ATTR double fadd64(double x, double y) {
  return x + y;
}

SCALAR_FUN_ATTR double fsub64(double x, double y) {
  return x - y;
}

SCALAR_FUN_ATTR double fmul64(double x, double y) {
  return x * y;
}

SCALAR_FUN_ATTR bool cmplt64(double x, double y) {
  return x < y;
}

SCALAR_FUN_ATTR bool cmple64(double x, double y) {
  return x <= y;
}

SCALAR_FUN_ATTR double sitofp_i8_f64(int8_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double sitofp_i16_f64(int16_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double sitofp_i32_f64(int32_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double sitofp_i64_f64(int64_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double uitofp_i8_f64(uint8_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double uitofp_i16_f64(uint16_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double uitofp_i32_f64(uint32_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double uitofp_i64_f64(uint64_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double fabs64(double x) {
  return abs(x);
}

SCALAR_FUN_ATTR double fmax64(double x, double y) {
  return isnan(x) ? y : isnan(y) ? x : max(x, y);
}

SCALAR_FUN_ATTR double fmin64(double x, double y) {
  return isnan(x) ? y : isnan(y) ? x : min(x, y);
}

SCALAR_FUN_ATTR double fpow64(double a, double b) {
  float ret;
  foreach_active (i) {
      uniform float r = __stdlib_powf(extract(a, i), extract(b, i));
      ret = insert(ret, i, r);
  }
  return ret;
}

SCALAR_FUN_ATTR double futrts_log64(double x) {
  return futrts_isfinite64(x) || (futrts_isinf64(x) && x < 0)? log(x) : x;
}

SCALAR_FUN_ATTR double futrts_log2_64(double x) {
  return futrts_log64(x)/log(2.0d);
}

SCALAR_FUN_ATTR double futrts_log10_64(double x) {
  return futrts_log64(x)/log(10.0d);
}

SCALAR_FUN_ATTR double futrts_log1p_64(double x) {
  if(x == -1.0d || (futrts_isinf64(x) && x > 0.0d)) return x / 0.0d;
  double y = 1.0d + x;
  double z = y - 1.0d;
  return log(y) - (z-x)/y;
}

SCALAR_FUN_ATTR double futrts_sqrt64(double x) {
  return sqrt(x);
}

extern "C" unmasked uniform double cbrt(uniform double);
SCALAR_FUN_ATTR double futrts_cbrt64(double x) {
  double res;
  foreach_active (i) {
    uniform double r = cbrtf(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

SCALAR_FUN_ATTR double futrts_exp64(double x) {
  return exp(x);
}

SCALAR_FUN_ATTR double futrts_cos64(double x) {
  return cos(x);
}

SCALAR_FUN_ATTR double futrts_sin64(double x) {
  return sin(x);
}

SCALAR_FUN_ATTR double futrts_tan64(double x) {
  return tan(x);
}

SCALAR_FUN_ATTR double futrts_acos64(double x) {
  return acos(x);
}

SCALAR_FUN_ATTR double futrts_asin64(double x) {
  return asin(x);
}

SCALAR_FUN_ATTR double futrts_atan64(double x) {
  return atan(x);
}

SCALAR_FUN_ATTR double futrts_cosh64(double x) {
  return (exp(x)+exp(-x)) / 2.0d;
}

SCALAR_FUN_ATTR double futrts_sinh64(double x) {
  return (exp(x)-exp(-x)) / 2.0d;
}

SCALAR_FUN_ATTR double futrts_tanh64(double x) {
  return futrts_sinh64(x)/futrts_cosh64(x);
}

SCALAR_FUN_ATTR double futrts_acosh64(double x) {
  double f = x+sqrt(x*x-1.0d);
  if(futrts_isfinite64(f)) return log(f);
  return f;
}

SCALAR_FUN_ATTR double futrts_asinh64(double x) {
  double f = x+sqrt(x*x+1.0d);
  if(futrts_isfinite64(f)) return log(f);
  return f;
}

SCALAR_FUN_ATTR double futrts_atanh64(double x) {
  double f = (1.0d+x)/(1.0d-x);
  if(futrts_isfinite64(f)) return log(f)/2.0d;
  return f;

}

SCALAR_FUN_ATTR double futrts_atan2_64(double x, double y) {
  return atan2(x, y);
}

extern "C" unmasked uniform double hypot(uniform double x, uniform double y);
SCALAR_FUN_ATTR double futrts_hypot64(double x, double y) {
  double res;
  foreach_active (i) {
    uniform double r = hypot(extract(x, i), extract(y, i));
    res = insert(res, i, r);
  }
  return res;
}

extern "C" unmasked uniform double tgamma(uniform double x);
SCALAR_FUN_ATTR double futrts_gamma64(double x) {
  double res;
  foreach_active (i) {
    uniform double r = tgamma(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

extern "C" unmasked uniform double lgamma(uniform double x);
SCALAR_FUN_ATTR double futrts_lgamma64(double x) {
  double res;
  foreach_active (i) {
    uniform double r = lgamma(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

extern "C" unmasked uniform double erf(uniform double x);
SCALAR_FUN_ATTR double futrts_erf64(double x) {
  double res;
  foreach_active (i) {
    uniform double r = erf(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

extern "C" unmasked uniform double erfc(uniform double x);
SCALAR_FUN_ATTR double futrts_erfc64(double x) {
  double res;
  foreach_active (i) {
    uniform double r = erfc(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

SCALAR_FUN_ATTR double futrts_fma64(double a, double b, double c) {
  return a * b + c;
}

SCALAR_FUN_ATTR double futrts_round64(double x) {
  return round(x);
}

SCALAR_FUN_ATTR double futrts_ceil64(double x) {
  return ceil(x);
}

extern "C" unmasked uniform double nextafter(uniform float x, uniform double y);
SCALAR_FUN_ATTR float futrts_nextafter64(double x, double y) {
  double res;
  foreach_active (i) {
    uniform double r = nextafter(extract(x, i), extract(y, i));
    res = insert(res, i, r);
  }
  return res;
}

SCALAR_FUN_ATTR double futrts_floor64(double x) {
  return floor(x);
}

SCALAR_FUN_ATTR bool futrts_isnan64(double x) {
  return isnan(x);
}

SCALAR_FUN_ATTR int8_t fptosi_f64_i8(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (int8_t) x;
  }
}

SCALAR_FUN_ATTR int16_t fptosi_f64_i16(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (int16_t) x;
  }
}

SCALAR_FUN_ATTR int32_t fptosi_f64_i32(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (int32_t) x;
  }
}

SCALAR_FUN_ATTR int64_t fptosi_f64_i64(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (int64_t) x;
  }
}

SCALAR_FUN_ATTR uint8_t fptoui_f64_i8(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (uint8_t) (int8_t) x;
  }
}

SCALAR_FUN_ATTR uint16_t fptoui_f64_i16(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (uint16_t) (int16_t) x;
  }
}

SCALAR_FUN_ATTR uint32_t fptoui_f64_i32(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (uint32_t) (int32_t) x;
  }
}

SCALAR_FUN_ATTR uint64_t fptoui_f64_i64(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (uint64_t) (int64_t) x;
  }
}

SCALAR_FUN_ATTR bool ftob_f64_bool(double x) {
  return x != 0.0;
}

SCALAR_FUN_ATTR double btof_bool_f64(bool x) {
  return x ? 1.0 : 0.0;
}

SCALAR_FUN_ATTR int64_t futrts_to_bits64(double x) {
  int64_t res;
  foreach_active (i) {
    uniform double tmp = extract(x, i);
    uniform int64_t r = *((uniform int64_t* uniform)&tmp);
    res = insert(res, i, r);
  }
  return res;
}

SCALAR_FUN_ATTR double futrts_from_bits64(int64_t x) {
  double res;
  foreach_active (i) {
    uniform int64_t tmp = extract(x, i);
    uniform double r = *((uniform double* uniform)&tmp);
    res = insert(res, i, r);
  }
  return res;
}

SCALAR_FUN_ATTR double fmod64(double x, double y) {
  return x - y * trunc(x/y);
}

SCALAR_FUN_ATTR double fsignum64(double x) {
  return futrts_isnan64(x) ? x : (x > 0 ? 1.0d : 0.0d) - (x < 0 ? 1.0d : 0.0d);
}

SCALAR_FUN_ATTR double futrts_lerp64(double v0, double v1, double t) {
  return v0 + (v1 - v0) * t;
}

SCALAR_FUN_ATTR double futrts_ldexp64(double x, int32_t y) {
  return x * pow((double)2.0, (double)y);
}

SCALAR_FUN_ATTR double futrts_copysign64(double x, double y) {
  int64_t xb = futrts_to_bits64(x);
  int64_t yb = futrts_to_bits64(y);
  return futrts_from_bits64((xb & ~(((int64_t)1)<<63)) | (yb & (((int64_t)1)<<63)));
}

SCALAR_FUN_ATTR double futrts_mad64(double a, double b, double c) {
  return a * b + c;
}

SCALAR_FUN_ATTR float fpconv_f32_f32(float x) {
  return (float) x;
}

SCALAR_FUN_ATTR double fpconv_f32_f64(float x) {
  return (double) x;
}

SCALAR_FUN_ATTR float fpconv_f64_f32(double x) {
  return (float) x;
}

SCALAR_FUN_ATTR double fpconv_f64_f64(double x) {
  return (double) x;
}

#else

SCALAR_FUN_ATTR double fdiv64(double x, double y) {
  return x / y;
}

SCALAR_FUN_ATTR double fadd64(double x, double y) {
  return x + y;
}

SCALAR_FUN_ATTR double fsub64(double x, double y) {
  return x - y;
}

SCALAR_FUN_ATTR double fmul64(double x, double y) {
  return x * y;
}

SCALAR_FUN_ATTR bool cmplt64(double x, double y) {
  return x < y;
}

SCALAR_FUN_ATTR bool cmple64(double x, double y) {
  return x <= y;
}

SCALAR_FUN_ATTR double sitofp_i8_f64(int8_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double sitofp_i16_f64(int16_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double sitofp_i32_f64(int32_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double sitofp_i64_f64(int64_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double uitofp_i8_f64(uint8_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double uitofp_i16_f64(uint16_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double uitofp_i32_f64(uint32_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double uitofp_i64_f64(uint64_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double fabs64(double x) {
  return fabs(x);
}

SCALAR_FUN_ATTR double fmax64(double x, double y) {
  return fmax(x, y);
}

SCALAR_FUN_ATTR double fmin64(double x, double y) {
  return fmin(x, y);
}

SCALAR_FUN_ATTR double fpow64(double x, double y) {
  return pow(x, y);
}

SCALAR_FUN_ATTR double futrts_log64(double x) {
  return log(x);
}

SCALAR_FUN_ATTR double futrts_log2_64(double x) {
  return log2(x);
}

SCALAR_FUN_ATTR double futrts_log10_64(double x) {
  return log10(x);
}

SCALAR_FUN_ATTR double futrts_log1p_64(double x) {
  return log1p(x);
}

SCALAR_FUN_ATTR double futrts_sqrt64(double x) {
  return sqrt(x);
}

SCALAR_FUN_ATTR double futrts_cbrt64(double x) {
  return cbrt(x);
}

SCALAR_FUN_ATTR double futrts_exp64(double x) {
  return exp(x);
}

SCALAR_FUN_ATTR double futrts_cos64(double x) {
  return cos(x);
}

SCALAR_FUN_ATTR double futrts_sin64(double x) {
  return sin(x);
}

SCALAR_FUN_ATTR double futrts_tan64(double x) {
  return tan(x);
}

SCALAR_FUN_ATTR double futrts_acos64(double x) {
  return acos(x);
}

SCALAR_FUN_ATTR double futrts_asin64(double x) {
  return asin(x);
}

SCALAR_FUN_ATTR double futrts_atan64(double x) {
  return atan(x);
}

SCALAR_FUN_ATTR double futrts_cosh64(double x) {
  return cosh(x);
}

SCALAR_FUN_ATTR double futrts_sinh64(double x) {
  return sinh(x);
}

SCALAR_FUN_ATTR double futrts_tanh64(double x) {
  return tanh(x);
}

SCALAR_FUN_ATTR double futrts_acosh64(double x) {
  return acosh(x);
}

SCALAR_FUN_ATTR double futrts_asinh64(double x) {
  return asinh(x);
}

SCALAR_FUN_ATTR double futrts_atanh64(double x) {
  return atanh(x);
}

SCALAR_FUN_ATTR double futrts_atan2_64(double x, double y) {
  return atan2(x, y);
}

SCALAR_FUN_ATTR double futrts_hypot64(double x, double y) {
  return hypot(x, y);
}

SCALAR_FUN_ATTR double futrts_gamma64(double x) {
  return tgamma(x);
}

SCALAR_FUN_ATTR double futrts_lgamma64(double x) {
  return lgamma(x);
}

SCALAR_FUN_ATTR double futrts_erf64(double x) {
  return erf(x);
}

SCALAR_FUN_ATTR double futrts_erfc64(double x) {
  return erfc(x);
}

SCALAR_FUN_ATTR double futrts_fma64(double a, double b, double c) {
  return fma(a, b, c);
}

SCALAR_FUN_ATTR double futrts_round64(double x) {
  return rint(x);
}

SCALAR_FUN_ATTR double futrts_ceil64(double x) {
  return ceil(x);
}

SCALAR_FUN_ATTR float futrts_nextafter64(float x, float y) {
  return nextafter(x, y);
}

SCALAR_FUN_ATTR double futrts_floor64(double x) {
  return floor(x);
}

SCALAR_FUN_ATTR bool futrts_isnan64(double x) {
  return isnan(x);
}

SCALAR_FUN_ATTR bool futrts_isinf64(double x) {
  return isinf(x);
}

SCALAR_FUN_ATTR int8_t fptosi_f64_i8(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (int8_t) x;
  }
}

SCALAR_FUN_ATTR int16_t fptosi_f64_i16(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (int16_t) x;
  }
}

SCALAR_FUN_ATTR int32_t fptosi_f64_i32(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (int32_t) x;
  }
}

SCALAR_FUN_ATTR int64_t fptosi_f64_i64(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (int64_t) x;
  }
}

SCALAR_FUN_ATTR uint8_t fptoui_f64_i8(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (uint8_t) (int8_t) x;
  }
}

SCALAR_FUN_ATTR uint16_t fptoui_f64_i16(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (uint16_t) (int16_t) x;
  }
}

SCALAR_FUN_ATTR uint32_t fptoui_f64_i32(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (uint32_t) (int32_t) x;
  }
}

SCALAR_FUN_ATTR uint64_t fptoui_f64_i64(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (uint64_t) (int64_t) x;
  }
}

SCALAR_FUN_ATTR bool ftob_f64_bool(double x) {
  return x != 0;
}

SCALAR_FUN_ATTR double btof_bool_f64(bool x) {
  return x ? 1 : 0;
}

SCALAR_FUN_ATTR int64_t futrts_to_bits64(double x) {
  union {
    double f;
    int64_t t;
  } p;

  p.f = x;
  return p.t;
}

SCALAR_FUN_ATTR double futrts_from_bits64(int64_t x) {
  union {
    int64_t f;
    double t;
  } p;

  p.f = x;
  return p.t;
}

SCALAR_FUN_ATTR double fmod64(double x, double y) {
  return fmod(x, y);
}

SCALAR_FUN_ATTR double fsignum64(double x) {
  return futrts_isnan64(x) ? x : (x > 0) - (x < 0);
}

SCALAR_FUN_ATTR double futrts_lerp64(double v0, double v1, double t) {
#ifdef __OPENCL_VERSION__
  return mix(v0, v1, t);
#else
  return v0 + (v1 - v0) * t;
#endif
}

SCALAR_FUN_ATTR double futrts_ldexp64(double x, int32_t y) {
  return ldexp(x, y);
}

SCALAR_FUN_ATTR float futrts_copysign64(double x, double y) {
  return copysign(x, y);
}

SCALAR_FUN_ATTR double futrts_mad64(double a, double b, double c) {
#ifdef __OPENCL_VERSION__
  return mad(a, b, c);
#else
  return a * b + c;
#endif
}

SCALAR_FUN_ATTR float fpconv_f32_f32(float x) {
  return (float) x;
}

SCALAR_FUN_ATTR double fpconv_f32_f64(float x) {
  return (double) x;
}

SCALAR_FUN_ATTR float fpconv_f64_f32(double x) {
  return (float) x;
}

SCALAR_FUN_ATTR double fpconv_f64_f64(double x) {
  return (double) x;
}

#endif

#endif

// End of scalar.h.
// Start of scalar_f16.h.

// Half-precision is emulated if needed (e.g. in straight C) with the
// native type used if possible.  The emulation works by typedef'ing
// 'float' to 'f16', and then implementing all operations on single
// precision.  To cut down on duplication, we use the same code for
// those Futhark functions that require just operators or casts.  The
// in-memory representation for arrays will still be 16 bits even
// under emulation, so the compiler will have to be careful when
// generating reads or writes.

#if !defined(cl_khr_fp16) && !(defined(__CUDA_ARCH__) && __CUDA_ARCH__ >= 600) && !(defined(ISPC))
#define EMULATE_F16
#endif

#if !defined(EMULATE_F16) && defined(__OPENCL_VERSION__)
#pragma OPENCL EXTENSION cl_khr_fp16 : enable
#endif

#ifdef EMULATE_F16

// Note that the half-precision storage format is still 16 bits - the
// compiler will have to be real careful!
typedef float f16;

#elif ISPC
typedef float16 f16;

#else

#ifdef __CUDA_ARCH__
#include <cuda_fp16.h>
#endif

typedef half f16;

#endif

// Some of these functions convert to single precision because half
// precision versions are not available.

SCALAR_FUN_ATTR f16 fadd16(f16 x, f16 y) {
  return x + y;
}

SCALAR_FUN_ATTR f16 fsub16(f16 x, f16 y) {
  return x - y;
}

SCALAR_FUN_ATTR f16 fmul16(f16 x, f16 y) {
  return x * y;
}

SCALAR_FUN_ATTR bool cmplt16(f16 x, f16 y) {
  return x < y;
}

SCALAR_FUN_ATTR bool cmple16(f16 x, f16 y) {
  return x <= y;
}

SCALAR_FUN_ATTR f16 sitofp_i8_f16(int8_t x) {
  return (f16) x;
}

SCALAR_FUN_ATTR f16 sitofp_i16_f16(int16_t x) {
  return (f16) x;
}

SCALAR_FUN_ATTR f16 sitofp_i32_f16(int32_t x) {
  return (f16) x;
}

SCALAR_FUN_ATTR f16 sitofp_i64_f16(int64_t x) {
  return (f16) x;
}

SCALAR_FUN_ATTR f16 uitofp_i8_f16(uint8_t x) {
  return (f16) x;
}

SCALAR_FUN_ATTR f16 uitofp_i16_f16(uint16_t x) {
  return (f16) x;
}

SCALAR_FUN_ATTR f16 uitofp_i32_f16(uint32_t x) {
  return (f16) x;
}

SCALAR_FUN_ATTR f16 uitofp_i64_f16(uint64_t x) {
  return (f16) x;
}

SCALAR_FUN_ATTR int8_t fptosi_f16_i8(f16 x) {
  return (int8_t) (float) x;
}

SCALAR_FUN_ATTR int16_t fptosi_f16_i16(f16 x) {
  return (int16_t) x;
}

SCALAR_FUN_ATTR int32_t fptosi_f16_i32(f16 x) {
  return (int32_t) x;
}

SCALAR_FUN_ATTR int64_t fptosi_f16_i64(f16 x) {
  return (int64_t) x;
}

SCALAR_FUN_ATTR uint8_t fptoui_f16_i8(f16 x) {
  return (uint8_t) (float) x;
}

SCALAR_FUN_ATTR uint16_t fptoui_f16_i16(f16 x) {
  return (uint16_t) x;
}

SCALAR_FUN_ATTR uint32_t fptoui_f16_i32(f16 x) {
  return (uint32_t) x;
}

SCALAR_FUN_ATTR uint64_t fptoui_f16_i64(f16 x) {
  return (uint64_t) x;
}

SCALAR_FUN_ATTR bool ftob_f16_bool(f16 x) {
  return x != (f16)0;
}

SCALAR_FUN_ATTR f16 btof_bool_f16(bool x) {
  return x ? 1 : 0;
}

#ifndef EMULATE_F16
SCALAR_FUN_ATTR bool futrts_isnan16(f16 x) {
  return isnan((float)x);
}

#ifdef __OPENCL_VERSION__

SCALAR_FUN_ATTR f16 fabs16(f16 x) {
  return fabs(x);
}

SCALAR_FUN_ATTR f16 fmax16(f16 x, f16 y) {
  return fmax(x, y);
}

SCALAR_FUN_ATTR f16 fmin16(f16 x, f16 y) {
  return fmin(x, y);
}

SCALAR_FUN_ATTR f16 fpow16(f16 x, f16 y) {
  return pow(x, y);
}

#elif ISPC
SCALAR_FUN_ATTR f16 fabs16(f16 x) {
  return abs(x);
}

SCALAR_FUN_ATTR f16 fmax16(f16 x, f16 y) {
  return futrts_isnan16(x) ? y : futrts_isnan16(y) ? x : max(x, y);
}

SCALAR_FUN_ATTR f16 fmin16(f16 x, f16 y) {
  return futrts_isnan16(x) ? y : futrts_isnan16(y) ? x : min(x, y);
}

SCALAR_FUN_ATTR f16 fpow16(f16 x, f16 y) {
  return pow(x, y);
}

#else // Assuming CUDA.

SCALAR_FUN_ATTR f16 fabs16(f16 x) {
  return fabsf(x);
}

SCALAR_FUN_ATTR f16 fmax16(f16 x, f16 y) {
  return fmaxf(x, y);
}

SCALAR_FUN_ATTR f16 fmin16(f16 x, f16 y) {
  return fminf(x, y);
}

SCALAR_FUN_ATTR f16 fpow16(f16 x, f16 y) {
  return powf(x, y);
}
#endif

#if ISPC
SCALAR_FUN_ATTR bool futrts_isinf16(float x) {
  return !futrts_isnan16(x) && futrts_isnan16(x - x);
}
SCALAR_FUN_ATTR bool futrts_isfinite16(float x) {
  return !futrts_isnan16(x) && !futrts_isinf16(x);
}

#else

SCALAR_FUN_ATTR bool futrts_isinf16(f16 x) {
  return isinf((float)x);
}
#endif

#ifdef __OPENCL_VERSION__
SCALAR_FUN_ATTR f16 futrts_log16(f16 x) {
  return log(x);
}

SCALAR_FUN_ATTR f16 futrts_log2_16(f16 x) {
  return log2(x);
}

SCALAR_FUN_ATTR f16 futrts_log10_16(f16 x) {
  return log10(x);
}

SCALAR_FUN_ATTR f16 futrts_log1p_16(f16 x) {
  return log1p(x);
}

SCALAR_FUN_ATTR f16 futrts_sqrt16(f16 x) {
  return sqrt(x);
}

SCALAR_FUN_ATTR f16 futrts_cbrt16(f16 x) {
  return cbrt(x);
}

SCALAR_FUN_ATTR f16 futrts_exp16(f16 x) {
  return exp(x);
}

SCALAR_FUN_ATTR f16 futrts_cos16(f16 x) {
  return cos(x);
}

SCALAR_FUN_ATTR f16 futrts_sin16(f16 x) {
  return sin(x);
}

SCALAR_FUN_ATTR f16 futrts_tan16(f16 x) {
  return tan(x);
}

SCALAR_FUN_ATTR f16 futrts_acos16(f16 x) {
  return acos(x);
}

SCALAR_FUN_ATTR f16 futrts_asin16(f16 x) {
  return asin(x);
}

SCALAR_FUN_ATTR f16 futrts_atan16(f16 x) {
  return atan(x);
}

SCALAR_FUN_ATTR f16 futrts_cosh16(f16 x) {
  return cosh(x);
}

SCALAR_FUN_ATTR f16 futrts_sinh16(f16 x) {
  return sinh(x);
}

SCALAR_FUN_ATTR f16 futrts_tanh16(f16 x) {
  return tanh(x);
}

SCALAR_FUN_ATTR f16 futrts_acosh16(f16 x) {
  return acosh(x);
}

SCALAR_FUN_ATTR f16 futrts_asinh16(f16 x) {
  return asinh(x);
}

SCALAR_FUN_ATTR f16 futrts_atanh16(f16 x) {
  return atanh(x);
}

SCALAR_FUN_ATTR f16 futrts_atan2_16(f16 x, f16 y) {
  return atan2(x, y);
}

SCALAR_FUN_ATTR f16 futrts_hypot16(f16 x, f16 y) {
  return hypot(x, y);
}

SCALAR_FUN_ATTR f16 futrts_gamma16(f16 x) {
  return tgamma(x);
}

SCALAR_FUN_ATTR f16 futrts_lgamma16(f16 x) {
  return lgamma(x);
}

SCALAR_FUN_ATTR f16 futrts_erf16(f16 x) {
  return erf(x);
}

SCALAR_FUN_ATTR f16 futrts_erfc16(f16 x) {
  return erfc(x);
}

SCALAR_FUN_ATTR f16 fmod16(f16 x, f16 y) {
  return fmod(x, y);
}

SCALAR_FUN_ATTR f16 futrts_round16(f16 x) {
  return rint(x);
}

SCALAR_FUN_ATTR f16 futrts_floor16(f16 x) {
  return floor(x);
}

SCALAR_FUN_ATTR f16 futrts_ceil16(f16 x) {
  return ceil(x);
}

SCALAR_FUN_ATTR f16 futrts_nextafter16(f16 x, f16 y) {
  return nextafter(x, y);
}

SCALAR_FUN_ATTR f16 futrts_lerp16(f16 v0, f16 v1, f16 t) {
  return mix(v0, v1, t);
}

SCALAR_FUN_ATTR f16 futrts_ldexp16(f16 x, int32_t y) {
  return ldexp(x, y);
}

SCALAR_FUN_ATTR f16 futrts_copysign16(f16 x, f16 y) {
  return copysign(x, y);
}

SCALAR_FUN_ATTR f16 futrts_mad16(f16 a, f16 b, f16 c) {
  return mad(a, b, c);
}

SCALAR_FUN_ATTR f16 futrts_fma16(f16 a, f16 b, f16 c) {
  return fma(a, b, c);
}
#elif ISPC

SCALAR_FUN_ATTR f16 futrts_log16(f16 x) {
  return futrts_isfinite16(x) || (futrts_isinf16(x) && x < 0) ? log(x) : x;
}

SCALAR_FUN_ATTR f16 futrts_log2_16(f16 x) {
  return futrts_log16(x) / log(2.0f16);
}

SCALAR_FUN_ATTR f16 futrts_log10_16(f16 x) {
  return futrts_log16(x) / log(10.0f16);
}

SCALAR_FUN_ATTR f16 futrts_log1p_16(f16 x) {
  if(x == -1.0f16 || (futrts_isinf16(x) && x > 0.0f16)) return x / 0.0f16;
  f16 y = 1.0f16 + x;
  f16 z = y - 1.0f16;
  return log(y) - (z-x)/y;
}

SCALAR_FUN_ATTR f16 futrts_sqrt16(f16 x) {
  return (float16)sqrt((float)x);
}

SCALAR_FUN_ATTR f16 futrts_exp16(f16 x) {
  return exp(x);
}

SCALAR_FUN_ATTR f16 futrts_cos16(f16 x) {
  return (float16)cos((float)x);
}

SCALAR_FUN_ATTR f16 futrts_sin16(f16 x) {
  return (float16)sin((float)x);
}

SCALAR_FUN_ATTR f16 futrts_tan16(f16 x) {
  return (float16)tan((float)x);
}

SCALAR_FUN_ATTR f16 futrts_acos16(f16 x) {
  return (float16)acos((float)x);
}

SCALAR_FUN_ATTR f16 futrts_asin16(f16 x) {
  return (float16)asin((float)x);
}

SCALAR_FUN_ATTR f16 futrts_atan16(f16 x) {
  return (float16)atan((float)x);
}

SCALAR_FUN_ATTR f16 futrts_cosh16(f16 x) {
  return (exp(x)+exp(-x)) / 2.0f16;
}

SCALAR_FUN_ATTR f16 futrts_sinh16(f16 x) {
  return (exp(x)-exp(-x)) / 2.0f16;
}

SCALAR_FUN_ATTR f16 futrts_tanh16(f16 x) {
  return futrts_sinh16(x)/futrts_cosh16(x);
}

SCALAR_FUN_ATTR f16 futrts_acosh16(f16 x) {
  float16 f = x+(float16)sqrt((float)(x*x-1));
  if(futrts_isfinite16(f)) return log(f);
  return f;
}

SCALAR_FUN_ATTR f16 futrts_asinh16(f16 x) {
  float16 f = x+(float16)sqrt((float)(x*x+1));
  if(futrts_isfinite16(f)) return log(f);
  return f;
}

SCALAR_FUN_ATTR f16 futrts_atanh16(f16 x) {
  float16 f = (1+x)/(1-x);
  if(futrts_isfinite16(f)) return log(f)/2.0f16;
  return f;
}

SCALAR_FUN_ATTR f16 futrts_atan2_16(f16 x, f16 y) {
  return (float16)atan2((float)x, (float)y);
}

SCALAR_FUN_ATTR f16 futrts_hypot16(f16 x, f16 y) {
  return (float16)futrts_hypot32((float)x, (float)y);
}

extern "C" unmasked uniform float tgammaf(uniform float x);
SCALAR_FUN_ATTR f16 futrts_gamma16(f16 x) {
  f16 res;
  foreach_active (i) {
    uniform f16 r = (f16)tgammaf(extract((float)x, i));
    res = insert(res, i, r);
  }
  return res;
}

extern "C" unmasked uniform float lgammaf(uniform float x);
SCALAR_FUN_ATTR f16 futrts_lgamma16(f16 x) {
  f16 res;
  foreach_active (i) {
    uniform f16 r = (f16)lgammaf(extract((float)x, i));
    res = insert(res, i, r);
  }
  return res;
}

SCALAR_FUN_ATTR f16 futrts_cbrt16(f16 x) {
  f16 res = (f16)futrts_cbrt32((float)x);
  return res;
}

SCALAR_FUN_ATTR f16 futrts_erf16(f16 x) {
  f16 res = (f16)futrts_erf32((float)x);
  return res;
}

SCALAR_FUN_ATTR f16 futrts_erfc16(f16 x) {
  f16 res = (f16)futrts_erfc32((float)x);
  return res;
}

SCALAR_FUN_ATTR f16 fmod16(f16 x, f16 y) {
  return x - y * (float16)trunc((float) (x/y));
}

SCALAR_FUN_ATTR f16 futrts_round16(f16 x) {
  return (float16)round((float)x);
}

SCALAR_FUN_ATTR f16 futrts_floor16(f16 x) {
  return (float16)floor((float)x);
}

SCALAR_FUN_ATTR f16 futrts_ceil16(f16 x) {
  return (float16)ceil((float)x);
}

SCALAR_FUN_ATTR f16 futrts_nextafter16(f16 x, f16 y) {
  return (float16)futrts_nextafter32((float)x, (float) y);
}

SCALAR_FUN_ATTR f16 futrts_lerp16(f16 v0, f16 v1, f16 t) {
  return v0 + (v1 - v0) * t;
}

SCALAR_FUN_ATTR f16 futrts_ldexp16(f16 x, int32_t y) {
  return futrts_ldexp32((float)x, y);
}

SCALAR_FUN_ATTR f16 futrts_copysign16(f16 x, f16 y) {
  return futrts_copysign32((float)x, y);
}

SCALAR_FUN_ATTR f16 futrts_mad16(f16 a, f16 b, f16 c) {
  return a * b + c;
}

SCALAR_FUN_ATTR f16 futrts_fma16(f16 a, f16 b, f16 c) {
  return a * b + c;
}

#else // Assume CUDA.

SCALAR_FUN_ATTR f16 futrts_log16(f16 x) {
  return hlog(x);
}

SCALAR_FUN_ATTR f16 futrts_log2_16(f16 x) {
  return hlog2(x);
}

SCALAR_FUN_ATTR f16 futrts_log10_16(f16 x) {
  return hlog10(x);
}

SCALAR_FUN_ATTR f16 futrts_log1p_16(f16 x) {
  return (f16)log1pf((float)x);
}

SCALAR_FUN_ATTR f16 futrts_sqrt16(f16 x) {
  return hsqrt(x);
}

SCALAR_FUN_ATTR f16 futrts_cbrt16(f16 x) {
  return cbrtf(x);
}

SCALAR_FUN_ATTR f16 futrts_exp16(f16 x) {
  return hexp(x);
}

SCALAR_FUN_ATTR f16 futrts_cos16(f16 x) {
  return hcos(x);
}

SCALAR_FUN_ATTR f16 futrts_sin16(f16 x) {
  return hsin(x);
}

SCALAR_FUN_ATTR f16 futrts_tan16(f16 x) {
  return tanf(x);
}

SCALAR_FUN_ATTR f16 futrts_acos16(f16 x) {
  return acosf(x);
}

SCALAR_FUN_ATTR f16 futrts_asin16(f16 x) {
  return asinf(x);
}

SCALAR_FUN_ATTR f16 futrts_atan16(f16 x) {
  return atanf(x);
}

SCALAR_FUN_ATTR f16 futrts_cosh16(f16 x) {
  return coshf(x);
}

SCALAR_FUN_ATTR f16 futrts_sinh16(f16 x) {
  return sinhf(x);
}

SCALAR_FUN_ATTR f16 futrts_tanh16(f16 x) {
  return tanhf(x);
}

SCALAR_FUN_ATTR f16 futrts_acosh16(f16 x) {
  return acoshf(x);
}

SCALAR_FUN_ATTR f16 futrts_asinh16(f16 x) {
  return asinhf(x);
}

SCALAR_FUN_ATTR f16 futrts_atanh16(f16 x) {
  return atanhf(x);
}

SCALAR_FUN_ATTR f16 futrts_atan2_16(f16 x, f16 y) {
  return atan2f(x, y);
}

SCALAR_FUN_ATTR f16 futrts_hypot16(f16 x, f16 y) {
  return hypotf(x, y);
}

SCALAR_FUN_ATTR f16 futrts_gamma16(f16 x) {
  return tgammaf(x);
}

SCALAR_FUN_ATTR f16 futrts_lgamma16(f16 x) {
  return lgammaf(x);
}

SCALAR_FUN_ATTR f16 futrts_erf16(f16 x) {
  return erff(x);
}

SCALAR_FUN_ATTR f16 futrts_erfc16(f16 x) {
  return erfcf(x);
}

SCALAR_FUN_ATTR f16 fmod16(f16 x, f16 y) {
  return fmodf(x, y);
}

SCALAR_FUN_ATTR f16 futrts_round16(f16 x) {
  return rintf(x);
}

SCALAR_FUN_ATTR f16 futrts_floor16(f16 x) {
  return hfloor(x);
}

SCALAR_FUN_ATTR f16 futrts_ceil16(f16 x) {
  return hceil(x);
}

SCALAR_FUN_ATTR f16 futrts_nextafter16(f16 x, f16 y) {
  return __ushort_as_half(halfbitsnextafter(__half_as_ushort(x), __half_as_ushort(y)));
}

SCALAR_FUN_ATTR f16 futrts_lerp16(f16 v0, f16 v1, f16 t) {
  return v0 + (v1 - v0) * t;
}

SCALAR_FUN_ATTR f16 futrts_ldexp16(f16 x, int32_t y) {
  return futrts_ldexp32((float)x, y);
}

SCALAR_FUN_ATTR f16 futrts_copysign16(f16 x, f16 y) {
  return futrts_copysign32((float)x, y);
}

SCALAR_FUN_ATTR f16 futrts_mad16(f16 a, f16 b, f16 c) {
  return a * b + c;
}

SCALAR_FUN_ATTR f16 futrts_fma16(f16 a, f16 b, f16 c) {
  return fmaf(a, b, c);
}

#endif

// The CUDA __half type cannot be put in unions for some reason, so we
// use bespoke conversion functions instead.
#ifdef __CUDA_ARCH__
SCALAR_FUN_ATTR int16_t futrts_to_bits16(f16 x) {
  return __half_as_ushort(x);
}
SCALAR_FUN_ATTR f16 futrts_from_bits16(int16_t x) {
  return __ushort_as_half(x);
}
#elif ISPC

SCALAR_FUN_ATTR int16_t futrts_to_bits16(f16 x) {
  varying int16_t y = *((varying int16_t * uniform)&x);
  return y;
}

SCALAR_FUN_ATTR f16 futrts_from_bits16(int16_t x) {
  varying f16 y = *((varying f16 * uniform)&x);
  return y;
}
#else
SCALAR_FUN_ATTR int16_t futrts_to_bits16(f16 x) {
  union {
    f16 f;
    int16_t t;
  } p;

  p.f = x;
  return p.t;
}

SCALAR_FUN_ATTR f16 futrts_from_bits16(int16_t x) {
  union {
    int16_t f;
    f16 t;
  } p;

  p.f = x;
  return p.t;
}
#endif

#else // No native f16 - emulate.

SCALAR_FUN_ATTR f16 fabs16(f16 x) {
  return fabs32(x);
}

SCALAR_FUN_ATTR f16 fmax16(f16 x, f16 y) {
  return fmax32(x, y);
}

SCALAR_FUN_ATTR f16 fmin16(f16 x, f16 y) {
  return fmin32(x, y);
}

SCALAR_FUN_ATTR f16 fpow16(f16 x, f16 y) {
  return fpow32(x, y);
}

SCALAR_FUN_ATTR bool futrts_isnan16(f16 x) {
  return futrts_isnan32(x);
}

SCALAR_FUN_ATTR bool futrts_isinf16(f16 x) {
  return futrts_isinf32(x);
}

SCALAR_FUN_ATTR f16 futrts_log16(f16 x) {
  return futrts_log32(x);
}

SCALAR_FUN_ATTR f16 futrts_log2_16(f16 x) {
  return futrts_log2_32(x);
}

SCALAR_FUN_ATTR f16 futrts_log10_16(f16 x) {
  return futrts_log10_32(x);
}

SCALAR_FUN_ATTR f16 futrts_log1p_16(f16 x) {
  return futrts_log1p_32(x);
}

SCALAR_FUN_ATTR f16 futrts_sqrt16(f16 x) {
  return futrts_sqrt32(x);
}

SCALAR_FUN_ATTR f16 futrts_cbrt16(f16 x) {
  return futrts_cbrt32(x);
}

SCALAR_FUN_ATTR f16 futrts_exp16(f16 x) {
  return futrts_exp32(x);
}

SCALAR_FUN_ATTR f16 futrts_cos16(f16 x) {
  return futrts_cos32(x);
}

SCALAR_FUN_ATTR f16 futrts_sin16(f16 x) {
  return futrts_sin32(x);
}

SCALAR_FUN_ATTR f16 futrts_tan16(f16 x) {
  return futrts_tan32(x);
}

SCALAR_FUN_ATTR f16 futrts_acos16(f16 x) {
  return futrts_acos32(x);
}

SCALAR_FUN_ATTR f16 futrts_asin16(f16 x) {
  return futrts_asin32(x);
}

SCALAR_FUN_ATTR f16 futrts_atan16(f16 x) {
  return futrts_atan32(x);
}

SCALAR_FUN_ATTR f16 futrts_cosh16(f16 x) {
  return futrts_cosh32(x);
}

SCALAR_FUN_ATTR f16 futrts_sinh16(f16 x) {
  return futrts_sinh32(x);
}

SCALAR_FUN_ATTR f16 futrts_tanh16(f16 x) {
  return futrts_tanh32(x);
}

SCALAR_FUN_ATTR f16 futrts_acosh16(f16 x) {
  return futrts_acosh32(x);
}

SCALAR_FUN_ATTR f16 futrts_asinh16(f16 x) {
  return futrts_asinh32(x);
}

SCALAR_FUN_ATTR f16 futrts_atanh16(f16 x) {
  return futrts_atanh32(x);
}

SCALAR_FUN_ATTR f16 futrts_atan2_16(f16 x, f16 y) {
  return futrts_atan2_32(x, y);
}

SCALAR_FUN_ATTR f16 futrts_hypot16(f16 x, f16 y) {
  return futrts_hypot32(x, y);
}

SCALAR_FUN_ATTR f16 futrts_gamma16(f16 x) {
  return futrts_gamma32(x);
}

SCALAR_FUN_ATTR f16 futrts_lgamma16(f16 x) {
  return futrts_lgamma32(x);
}

SCALAR_FUN_ATTR f16 futrts_erf16(f16 x) {
  return futrts_erf32(x);
}

SCALAR_FUN_ATTR f16 futrts_erfc16(f16 x) {
  return futrts_erfc32(x);
}

SCALAR_FUN_ATTR f16 fmod16(f16 x, f16 y) {
  return fmod32(x, y);
}

SCALAR_FUN_ATTR f16 futrts_round16(f16 x) {
  return futrts_round32(x);
}

SCALAR_FUN_ATTR f16 futrts_floor16(f16 x) {
  return futrts_floor32(x);
}

SCALAR_FUN_ATTR f16 futrts_ceil16(f16 x) {
  return futrts_ceil32(x);
}

SCALAR_FUN_ATTR f16 futrts_nextafter16(f16 x, f16 y) {
  return halfbits2float(halfbitsnextafter(float2halfbits(x), float2halfbits(y)));
}

SCALAR_FUN_ATTR f16 futrts_lerp16(f16 v0, f16 v1, f16 t) {
  return futrts_lerp32(v0, v1, t);
}

SCALAR_FUN_ATTR f16 futrts_ldexp16(f16 x, int32_t y) {
  return futrts_ldexp32(x, y);
}

SCALAR_FUN_ATTR f16 futrts_copysign16(f16 x, f16 y) {
  return futrts_copysign32((float)x, y);
}

SCALAR_FUN_ATTR f16 futrts_mad16(f16 a, f16 b, f16 c) {
  return futrts_mad32(a, b, c);
}

SCALAR_FUN_ATTR f16 futrts_fma16(f16 a, f16 b, f16 c) {
  return futrts_fma32(a, b, c);
}

// Even when we are using an OpenCL that does not support cl_khr_fp16,
// it must still support vload_half for actually creating a
// half-precision number, which can then be efficiently converted to a
// float.  Similarly for vstore_half.
#ifdef __OPENCL_VERSION__

SCALAR_FUN_ATTR int16_t futrts_to_bits16(f16 x) {
  int16_t y;
  // Violating strict aliasing here.
  vstore_half((float)x, 0, (half*)&y);
  return y;
}

SCALAR_FUN_ATTR f16 futrts_from_bits16(int16_t x) {
  return (f16)vload_half(0, (half*)&x);
}

#else

SCALAR_FUN_ATTR int16_t futrts_to_bits16(f16 x) {
  return (int16_t)float2halfbits(x);
}

SCALAR_FUN_ATTR f16 futrts_from_bits16(int16_t x) {
  return halfbits2float((uint16_t)x);
}

SCALAR_FUN_ATTR f16 fsignum16(f16 x) {
  return futrts_isnan16(x) ? x : (x > 0 ? 1 : 0) - (x < 0 ? 1 : 0);
}

#endif

#endif

SCALAR_FUN_ATTR float fpconv_f16_f16(f16 x) {
  return x;
}

SCALAR_FUN_ATTR float fpconv_f16_f32(f16 x) {
  return x;
}

SCALAR_FUN_ATTR f16 fpconv_f32_f16(float x) {
  return (f16) x;
}

#ifdef FUTHARK_F64_ENABLED

SCALAR_FUN_ATTR double fpconv_f16_f64(f16 x) {
  return (double) x;
}

#if ISPC
SCALAR_FUN_ATTR f16 fpconv_f64_f16(double x) {
  return (f16) ((float)x);
}
#else
SCALAR_FUN_ATTR f16 fpconv_f64_f16(double x) {
  return (f16) x;
}
#endif
#endif


// End of scalar_f16.h.

// Start of context_prototypes.h
//
// Prototypes for the functions in context.h, or that will be called
// from those functions, that need to be available very early.

struct futhark_context_config;
struct futhark_context;

static void set_error(struct futhark_context* ctx, char *error);

// These are called in context/config new/free functions and contain
// shared setup.  They are generated by the compiler itself.
static int init_constants(struct futhark_context*);
static int free_constants(struct futhark_context*);
static void setup_program(struct futhark_context* ctx);
static void teardown_program(struct futhark_context *ctx);

// Allocate host memory.  Must be freed with host_free().
static void host_alloc(struct futhark_context* ctx, size_t size, const char* tag, size_t* size_out, void** mem_out);
// Allocate memory allocated with host_alloc().
static void host_free(struct futhark_context* ctx, size_t size, const char* tag, void* mem);

// Log that a copy has occurred.
static void log_copy(struct futhark_context* ctx,
                     const char *kind, int r,
                     int64_t dst_offset, int64_t dst_strides[r],
                     int64_t src_offset, int64_t src_strides[r],
                     int64_t shape[r]);

static void log_transpose(struct futhark_context* ctx,
                          int64_t k, int64_t m, int64_t n);

static bool lmad_map_tr(int64_t *num_arrays_out, int64_t *n_out, int64_t *m_out,
                        int r,
                        const int64_t dst_strides[r],
                        const int64_t src_strides[r],
                        const int64_t shape[r]);

static bool lmad_contiguous(int r, int64_t strides[r], int64_t shape[r]);

static bool lmad_memcpyable(int r,
                            int64_t dst_strides[r], int64_t src_strides[r], int64_t shape[r]);

static void add_event(struct futhark_context* ctx,
                      const char* name,
                      char* description,
                      void* data,
                      event_report_fn f);

// Functions that must be defined by the backend.
static void backend_context_config_setup(struct futhark_context_config* cfg);
static void backend_context_config_teardown(struct futhark_context_config* cfg);
static int backend_context_setup(struct futhark_context *ctx);
static void backend_context_teardown(struct futhark_context *ctx);

// End of of context_prototypes.h

struct memblock {
    int *references;
    unsigned char *mem;
    int64_t size;
    const char *desc;
};
struct constants {
    int dummy;
};
struct tuning_params {
    int dummy;
};
static const int num_tuning_params = 0;
static const char *tuning_param_names[] = {NULL};
static const char *tuning_param_vars[] = {NULL};
static const char *tuning_param_classes[] = {NULL};
static int64_t tuning_param_defaults[] = {0};
// start of scheduler.h

// First, the API that the generated code will access.  In principle,
// we could then compile the scheduler separately and link an object
// file with the generated code.  In practice, we will embed all of
// this in the generated code.

// Scheduler handle.
struct scheduler;

// Initialise a scheduler (and start worker threads).
static int scheduler_init(struct scheduler *scheduler,
                          int num_workers,
                          double kappa);

// Shut down a scheduler (and destroy worker threads).
static int scheduler_destroy(struct scheduler *scheduler);

// Figure out the smallest amount of work that amortises task
// creation.
static int determine_kappa(double *kappa);

// How a segop should be scheduled.
enum scheduling {
  DYNAMIC,
  STATIC
};

// How a given task should be executed.  Filled out by the scheduler
// and passed to the segop function
struct scheduler_info {
  int64_t iter_pr_subtask;
  int64_t remainder;
  int nsubtasks;
  enum scheduling sched;
  int wake_up_threads;

  int64_t *task_time;
  int64_t *task_iter;
};

// A segop function.  This is what you hand the scheduler for
// execution.
typedef int (*segop_fn)(void* args,
                        int64_t iterations,
                        int tid,
                        struct scheduler_info info);

// A task for the scheduler to execute.
struct scheduler_segop {
  void *args;
  segop_fn top_level_fn;
  segop_fn nested_fn;
  int64_t iterations;
  enum scheduling sched;

  // Pointers to timer and iter associated with the task
  int64_t *task_time;
  int64_t *task_iter;

  // For debugging
  const char* name;
};

static inline int scheduler_prepare_task(struct scheduler *scheduler,
                                         struct scheduler_segop *task);

typedef int (*parloop_fn)(void* args,
                          int64_t start,
                          int64_t end,
                          int subtask_id,
                          int tid);

// A parallel parloop task.
struct scheduler_parloop {
  void* args;
  parloop_fn fn;
  int64_t iterations;
  struct scheduler_info info;

  // For debugging
  const char* name;
};

static inline int scheduler_execute_task(struct scheduler *scheduler,
                                         struct scheduler_parloop *task);

// Then the API implementation.

#include <signal.h>

#if defined(_WIN32)
#include <windows.h>
#elif defined(__APPLE__)
#include <sys/sysctl.h>
// For getting cpu usage of threads
#include <mach/mach.h>
#include <sys/resource.h>
#elif defined(__linux__)
#include <sys/sysinfo.h>
#include <sys/resource.h>
#include <signal.h>
#elif defined(__EMSCRIPTEN__)
#include <emscripten/threading.h>
#include <sys/sysinfo.h>
#include <sys/resource.h>
#include <signal.h>
#endif

/* Multicore Utility functions */

/* A wrapper for getting rusage on Linux and MacOS */
/* TODO maybe figure out this for windows */
static inline int getrusage_thread(struct rusage *rusage)
{
  int err = -1;
#if  defined(__APPLE__)
    thread_basic_info_data_t info = { 0 };
    mach_msg_type_number_t info_count = THREAD_BASIC_INFO_COUNT;
    kern_return_t kern_err;

    kern_err = thread_info(mach_thread_self(),
                           THREAD_BASIC_INFO,
                           (thread_info_t)&info,
                           &info_count);
    if (kern_err == KERN_SUCCESS) {
        memset(rusage, 0, sizeof(struct rusage));
        rusage->ru_utime.tv_sec = info.user_time.seconds;
        rusage->ru_utime.tv_usec = info.user_time.microseconds;
        rusage->ru_stime.tv_sec = info.system_time.seconds;
        rusage->ru_stime.tv_usec = info.system_time.microseconds;
        err = 0;
    } else {
        errno = EINVAL;
    }
#elif defined(__linux__) || __EMSCRIPTEN__
    err = getrusage(RUSAGE_THREAD, rusage);
#endif
    return err;
}

/* returns the number of logical cores */
static int num_processors(void) {
#if  defined(_WIN32)
  /* https://docs.microsoft.com/en-us/windows/win32/api/sysinfoapi/ns-sysinfoapi-system_info */
  SYSTEM_INFO sysinfo;
  GetSystemInfo(&sysinfo);
  int ncores = sysinfo.dwNumberOfProcessors;
  fprintf(stderr, "Found %d cores on your Windows machine\n Is that correct?\n", ncores);
  return ncores;
#elif defined(__APPLE__)
  int ncores;
  size_t ncores_size = sizeof(ncores);
  CHECK_ERRNO(sysctlbyname("hw.logicalcpu", &ncores, &ncores_size, NULL, 0),
              "sysctlbyname (hw.logicalcpu)");
  return ncores;
#elif defined(__linux__)
  return get_nprocs();
#elif __EMSCRIPTEN__
  return emscripten_num_logical_cores();
#else
  fprintf(stderr, "operating system not recognised\n");
  return -1;
#endif
}

static unsigned int g_seed;

// Used to seed the generator.
static inline void fast_srand(unsigned int seed) {
    g_seed = seed;
}

// Compute a pseudorandom integer.
// Output value in range [0, 32767]
static inline unsigned int fast_rand(void) {
    g_seed = (214013*g_seed+2531011);
    return (g_seed>>16)&0x7FFF;
}

struct subtask_queue {
  int capacity;             // Size of the buffer.
  int first;                // Index of the start of the ring buffer.
  int num_used;             // Number of used elements in the buffer.
  struct subtask **buffer;

  pthread_mutex_t mutex;    // Mutex used for synchronisation.
  pthread_cond_t cond;      // Condition variable used for synchronisation.
  int dead;

#if defined(MCPROFILE)
  /* Profiling fields */
  uint64_t time_enqueue;
  uint64_t time_dequeue;
  uint64_t n_dequeues;
  uint64_t n_enqueues;
#endif
};

/* A subtask that can be executed by a worker */
struct subtask {
  /* The parloop function */
  parloop_fn fn;
  /* Execution parameters */
  void* args;
  int64_t start, end;
  int id;

  /* Dynamic scheduling parameters */
  int chunkable;
  int64_t chunk_size;

  /* Shared variables across subtasks */
  volatile int *counter; // Counter for ongoing subtasks
  // Shared task timers and iterators
  int64_t *task_time;
  int64_t *task_iter;

  /* For debugging */
  const char *name;
};


struct worker {
  pthread_t thread;
  struct scheduler *scheduler;  /* Reference to the scheduler struct the worker belongs to*/
  struct subtask_queue q;
  int dead;
  int tid;                      /* Just a thread id */

  /* "thread local" time fields used for online algorithm */
  uint64_t timer;
  uint64_t total;
  int nested; /* How nested the current computation is */

  // Profiling fields
  int output_usage;            /* Whether to dump thread usage */
  uint64_t time_spent_working; /* Time spent in parloop functions */
};

static inline void output_worker_usage(struct worker *worker)
{
  struct rusage usage;
  CHECK_ERRNO(getrusage_thread(&usage), "getrusage_thread");
  struct timeval user_cpu_time = usage.ru_utime;
  struct timeval sys_cpu_time = usage.ru_stime;
  fprintf(stderr, "tid: %2d - work time %10llu us - user time: %10llu us - sys: %10llu us\n",
          worker->tid,
          (long long unsigned)worker->time_spent_working / 1000,
          (long long unsigned)(user_cpu_time.tv_sec * 1000000 + user_cpu_time.tv_usec),
          (long long unsigned)(sys_cpu_time.tv_sec * 1000000 + sys_cpu_time.tv_usec));
}

/* Doubles the size of the queue */
static inline int subtask_queue_grow_queue(struct subtask_queue *subtask_queue) {

  int new_capacity = 2 * subtask_queue->capacity;
#ifdef MCDEBUG
  fprintf(stderr, "Growing queue to %d\n", subtask_queue->capacity * 2);
#endif

  struct subtask **new_buffer = calloc(new_capacity, sizeof(struct subtask*));
  for (int i = 0; i < subtask_queue->num_used; i++) {
    new_buffer[i] = subtask_queue->buffer[(subtask_queue->first + i) % subtask_queue->capacity];
  }

  free(subtask_queue->buffer);
  subtask_queue->buffer = new_buffer;
  subtask_queue->capacity = new_capacity;
  subtask_queue->first = 0;

  return 0;
}

// Initialise a job queue with the given capacity.  The queue starts out
// empty.  Returns non-zero on error.
static inline int subtask_queue_init(struct subtask_queue *subtask_queue, int capacity)
{
  assert(subtask_queue != NULL);
  memset(subtask_queue, 0, sizeof(struct subtask_queue));

  subtask_queue->capacity = capacity;
  subtask_queue->buffer = calloc(capacity, sizeof(struct subtask*));
  if (subtask_queue->buffer == NULL) {
    return -1;
  }

  CHECK_ERRNO(pthread_mutex_init(&subtask_queue->mutex, NULL), "pthread_mutex_init");
  CHECK_ERRNO(pthread_cond_init(&subtask_queue->cond, NULL), "pthread_cond_init");

  return 0;
}

// Destroy the job queue.  Blocks until the queue is empty before it
// is destroyed.
static inline int subtask_queue_destroy(struct subtask_queue *subtask_queue)
{
  assert(subtask_queue != NULL);

  CHECK_ERR(pthread_mutex_lock(&subtask_queue->mutex), "pthread_mutex_lock");

  while (subtask_queue->num_used != 0) {
    CHECK_ERR(pthread_cond_wait(&subtask_queue->cond, &subtask_queue->mutex), "pthread_cond_wait");
  }

  // Queue is now empty.  Let's kill it!
  subtask_queue->dead = 1;
  free(subtask_queue->buffer);
  CHECK_ERR(pthread_cond_broadcast(&subtask_queue->cond), "pthread_cond_broadcast");
  CHECK_ERR(pthread_mutex_unlock(&subtask_queue->mutex), "pthread_mutex_unlock");

  return 0;
}

static inline void dump_queue(struct worker *worker)
{
  struct subtask_queue *subtask_queue = &worker->q;
  CHECK_ERR(pthread_mutex_lock(&subtask_queue->mutex), "pthread_mutex_lock");
  for (int i = 0; i < subtask_queue->num_used; i++) {
    struct subtask * subtask = subtask_queue->buffer[(subtask_queue->first + i) % subtask_queue->capacity];
    printf("queue tid %d with %d task %s\n", worker->tid, i, subtask->name);
  }
  CHECK_ERR(pthread_cond_broadcast(&subtask_queue->cond), "pthread_cond_broadcast");
  CHECK_ERR(pthread_mutex_unlock(&subtask_queue->mutex), "pthread_mutex_unlock");
}

// Push an element onto the end of the job queue.  Blocks if the
// subtask_queue is full (its size is equal to its capacity).  Returns
// non-zero on error.  It is an error to push a job onto a queue that
// has been destroyed.
static inline int subtask_queue_enqueue(struct worker *worker, struct subtask *subtask )
{
  assert(worker != NULL);
  struct subtask_queue *subtask_queue = &worker->q;

#ifdef MCPROFILE
  uint64_t start = get_wall_time();
#endif

  CHECK_ERR(pthread_mutex_lock(&subtask_queue->mutex), "pthread_mutex_lock");
  // Wait until there is room in the subtask_queue.
  while (subtask_queue->num_used == subtask_queue->capacity && !subtask_queue->dead) {
    if (subtask_queue->num_used == subtask_queue->capacity) {
      CHECK_ERR(subtask_queue_grow_queue(subtask_queue), "subtask_queue_grow_queue");
      continue;
    }
    CHECK_ERR(pthread_cond_wait(&subtask_queue->cond, &subtask_queue->mutex), "pthread_cond_wait");
  }

  if (subtask_queue->dead) {
    CHECK_ERR(pthread_mutex_unlock(&subtask_queue->mutex), "pthread_mutex_unlock");
    return -1;
  }

  // If we made it past the loop, there is room in the subtask_queue.
  subtask_queue->buffer[(subtask_queue->first + subtask_queue->num_used) % subtask_queue->capacity] = subtask;
  subtask_queue->num_used++;

#ifdef MCPROFILE
  uint64_t end = get_wall_time();
  subtask_queue->time_enqueue += (end - start);
  subtask_queue->n_enqueues++;
#endif
  // Broadcast a reader (if any) that there is now an element.
  CHECK_ERR(pthread_cond_broadcast(&subtask_queue->cond), "pthread_cond_broadcast");
  CHECK_ERR(pthread_mutex_unlock(&subtask_queue->mutex), "pthread_mutex_unlock");

  return 0;
}


/* Like subtask_queue_dequeue, but with two differences:
   1) the subtask is stolen from the __front__ of the queue
   2) returns immediately if there is no subtasks queued,
      as we dont' want to block on another workers queue and
*/
static inline int subtask_queue_steal(struct worker *worker,
                                      struct subtask **subtask)
{
  struct subtask_queue *subtask_queue = &worker->q;
  assert(subtask_queue != NULL);

#ifdef MCPROFILE
  uint64_t start = get_wall_time();
#endif
  CHECK_ERR(pthread_mutex_lock(&subtask_queue->mutex), "pthread_mutex_lock");

  if (subtask_queue->num_used == 0) {
    CHECK_ERR(pthread_cond_broadcast(&subtask_queue->cond), "pthread_cond_broadcast");
    CHECK_ERR(pthread_mutex_unlock(&subtask_queue->mutex), "pthread_mutex_unlock");
    return 1;
  }

  if (subtask_queue->dead) {
    CHECK_ERR(pthread_mutex_unlock(&subtask_queue->mutex), "pthread_mutex_unlock");
    return -1;
  }

  // Tasks gets stolen from the "front"
  struct subtask *cur_back = subtask_queue->buffer[subtask_queue->first];
  struct subtask *new_subtask = NULL;
  int remaining_iter = cur_back->end - cur_back->start;
  // If subtask is chunkable, we steal half of the iterations
  if (cur_back->chunkable && remaining_iter > 1) {
      int64_t half = remaining_iter / 2;
      new_subtask = malloc(sizeof(struct subtask));
      *new_subtask = *cur_back;
      new_subtask->start = cur_back->end - half;
      cur_back->end = new_subtask->start;
      __atomic_fetch_add(cur_back->counter, 1, __ATOMIC_RELAXED);
  } else {
    new_subtask = cur_back;
    subtask_queue->num_used--;
    subtask_queue->first = (subtask_queue->first + 1) % subtask_queue->capacity;
  }
  *subtask = new_subtask;

  if (*subtask == NULL) {
    CHECK_ERR(pthread_mutex_unlock(&subtask_queue->mutex), "pthred_mutex_unlock");
    return 1;
  }

#ifdef MCPROFILE
  uint64_t end = get_wall_time();
  subtask_queue->time_dequeue += (end - start);
  subtask_queue->n_dequeues++;
#endif

  // Broadcast a writer (if any) that there is now room for more.
  CHECK_ERR(pthread_cond_broadcast(&subtask_queue->cond), "pthread_cond_broadcast");
  CHECK_ERR(pthread_mutex_unlock(&subtask_queue->mutex), "pthread_mutex_unlock");

  return 0;
}


// Pop an element from the back of the job queue.
// Optional argument can be provided to block or not
static inline int subtask_queue_dequeue(struct worker *worker,
                                        struct subtask **subtask, int blocking)
{
  assert(worker != NULL);
  struct subtask_queue *subtask_queue = &worker->q;

#ifdef MCPROFILE
  uint64_t start = get_wall_time();
#endif

  CHECK_ERR(pthread_mutex_lock(&subtask_queue->mutex), "pthread_mutex_lock");
  if (subtask_queue->num_used == 0 && !blocking) {
    CHECK_ERR(pthread_mutex_unlock(&subtask_queue->mutex), "pthread_mutex_unlock");
    return 1;
  }
  // Try to steal some work while the subtask_queue is empty
  while (subtask_queue->num_used == 0 && !subtask_queue->dead) {
    pthread_cond_wait(&subtask_queue->cond, &subtask_queue->mutex);
  }

  if (subtask_queue->dead) {
    CHECK_ERR(pthread_mutex_unlock(&subtask_queue->mutex), "pthread_mutex_unlock");
    return -1;
  }

  // dequeue pops from the back
  *subtask = subtask_queue->buffer[(subtask_queue->first + subtask_queue->num_used - 1) % subtask_queue->capacity];
  subtask_queue->num_used--;

  if (*subtask == NULL) {
    assert(!"got NULL ptr");
    CHECK_ERR(pthread_mutex_unlock(&subtask_queue->mutex), "pthred_mutex_unlock");
    return -1;
  }

#ifdef MCPROFILE
  uint64_t end = get_wall_time();
  subtask_queue->time_dequeue += (end - start);
  subtask_queue->n_dequeues++;
#endif

  // Broadcast a writer (if any) that there is now room for more.
  CHECK_ERR(pthread_cond_broadcast(&subtask_queue->cond), "pthread_cond_broadcast");
  CHECK_ERR(pthread_mutex_unlock(&subtask_queue->mutex), "pthread_mutex_unlock");

  return 0;
}

static inline int subtask_queue_is_empty(struct subtask_queue *subtask_queue)
{
  return subtask_queue->num_used == 0;
}

/* Scheduler definitions */

struct scheduler {
  struct worker *workers;
  int num_threads;
  int minimum_chunk_size;


  // If there is work to steal => active_work > 0
  volatile int active_work;

  // Only one error can be returned at the time now.  Maybe we can
  // provide a stack like structure for pushing errors onto if we wish
  // to backpropagte multiple errors
  volatile int error;

  // kappa time unit in nanoseconds
  double kappa;
};


// Thread local variable worker struct
// Note that, accesses to tls variables are expensive
// Minimize direct references to this variable
__thread struct worker* worker_local = NULL;

static int64_t total_now(int64_t total, int64_t time) {
  return total + (get_wall_time_ns() - time);
}

static int random_other_worker(struct scheduler *scheduler, int my_id) {
  int my_num_workers = scheduler->num_threads;
  assert(my_num_workers != 1);
  int i = fast_rand() % (my_num_workers - 1);
  if (i >= my_id) {
    i++;
  }
#ifdef MCDEBUG
  assert(i >= 0);
  assert(i < my_num_workers);
  assert(i != my_id);
#endif

  return i;
}

static inline int64_t compute_chunk_size(int64_t minimum_chunk_size, double kappa, struct subtask* subtask)
{
  double C = (double)*subtask->task_time / (double)*subtask->task_iter;
  if (C == 0.0F) C += DBL_EPSILON;
  return smax64((int64_t)(kappa / C), minimum_chunk_size);
}

/* Takes a chunk from subtask and enqueues the remaining iterations onto the worker's queue */
/* A no-op if the subtask is not chunkable */
static inline struct subtask* chunk_subtask(struct worker* worker, struct subtask *subtask)
{
  if (subtask->chunkable) {
    // Do we have information from previous runs avaliable
    if (*subtask->task_iter > 0) {
      subtask->chunk_size = compute_chunk_size(worker->scheduler->minimum_chunk_size,
                                               worker->scheduler->kappa,
                                               subtask);
      assert(subtask->chunk_size > 0);
    }
    int64_t remaining_iter = subtask->end - subtask->start;
    assert(remaining_iter > 0);
    if (remaining_iter > subtask->chunk_size) {
      struct subtask *new_subtask = malloc(sizeof(struct subtask));
      *new_subtask = *subtask;
      // increment the subtask join counter to account for new subtask
      __atomic_fetch_add(subtask->counter, 1, __ATOMIC_RELAXED);
      // Update range parameters
      subtask->end = subtask->start + subtask->chunk_size;
      new_subtask->start = subtask->end;
      subtask_queue_enqueue(worker, new_subtask);
    }
  }
  return subtask;
}

static inline int run_subtask(struct worker* worker, struct subtask* subtask)
{
  assert(subtask != NULL);
  assert(worker != NULL);

  subtask = chunk_subtask(worker, subtask);
  worker->total = 0;
  worker->timer = get_wall_time_ns();
#if defined(MCPROFILE)
  int64_t start = worker->timer;
#endif
  worker->nested++;
  int err = subtask->fn(subtask->args, subtask->start, subtask->end,
                        subtask->id,
                        worker->tid);
  worker->nested--;
  // Some error occured during some other subtask
  // so we just clean-up and return
  if (worker->scheduler->error != 0) {
    // Even a failed task counts as finished.
    __atomic_fetch_sub(subtask->counter, 1, __ATOMIC_RELAXED);
    free(subtask);
    return 0;
  }
  if (err != 0) {
    __atomic_store_n(&worker->scheduler->error, err, __ATOMIC_RELAXED);
  }
  // Total sequential time spent
  int64_t time_elapsed = total_now(worker->total, worker->timer);
#if defined(MCPROFILE)
  worker->time_spent_working += get_wall_time_ns() - start;
#endif
  int64_t iter = subtask->end - subtask->start;
  // report measurements
  // These updates should really be done using a single atomic CAS operation
  __atomic_fetch_add(subtask->task_time, time_elapsed, __ATOMIC_RELAXED);
  __atomic_fetch_add(subtask->task_iter, iter, __ATOMIC_RELAXED);
  // We need a fence here, since if the counter is decremented before either
  // of the two above are updated bad things can happen, e.g. if they are stack-allocated
  __atomic_thread_fence(__ATOMIC_SEQ_CST);
  __atomic_fetch_sub(subtask->counter, 1, __ATOMIC_RELAXED);
  free(subtask);
  return 0;
}


static inline int is_small(struct scheduler_segop *task, struct scheduler *scheduler, int *nsubtasks)
{
  int64_t time = *task->task_time;
  int64_t iter = *task->task_iter;

  if (task->sched == DYNAMIC || iter == 0) {
    *nsubtasks = scheduler->num_threads;
    return 0;
  }

  // Estimate the constant C
  double C = (double)time / (double)iter;
  double cur_task_iter = (double) task->iterations;

  // Returns true if the task is small i.e.
  // if the number of iterations times C is smaller
  // than the overhead of subtask creation
  if (C == 0.0F || C * cur_task_iter < scheduler->kappa) {
    *nsubtasks = 1;
    return 1;
  }

  // Else compute how many subtasks this tasks should create
  int64_t min_iter_pr_subtask = smax64(scheduler->kappa / C, 1);
  *nsubtasks = smin64(smax64(task->iterations / min_iter_pr_subtask, 1), scheduler->num_threads);

  return 0;
}

// TODO make this prettier
static inline struct subtask* create_subtask(parloop_fn fn,
                                             void* args,
                                             const char* name,
                                             volatile int* counter,
                                             int64_t *timer,
                                             int64_t *iter,
                                             int64_t start, int64_t end,
                                             int chunkable,
                                             int64_t chunk_size,
                                             int id)
{
  struct subtask* subtask = malloc(sizeof(struct subtask));
  if (subtask == NULL) {
    assert(!"malloc failed in create_subtask");
    return NULL;
  }
  subtask->fn         = fn;
  subtask->args       = args;

  subtask->counter    = counter;
  subtask->task_time  = timer;
  subtask->task_iter  = iter;

  subtask->start      = start;
  subtask->end        = end;
  subtask->id         = id;
  subtask->chunkable  = chunkable;
  subtask->chunk_size = chunk_size;

  subtask->name       = name;
  return subtask;
}

static int dummy_counter = 0;
static int64_t dummy_timer = 0;
static int64_t dummy_iter = 0;

static int dummy_fn(void *args, int64_t start, int64_t end, int subtask_id, int tid) {
  (void)args;
  (void)start;
  (void)end;
  (void)subtask_id;
  (void)tid;
  return 0;
}

// Wake up threads, who are blocking by pushing a dummy task
// onto their queue
static inline void wake_up_threads(struct scheduler *scheduler, int start_tid, int end_tid) {

#if defined(MCDEBUG)
  assert(start_tid >= 1);
  assert(end_tid <= scheduler->num_threads);
#endif
  for (int i = start_tid; i < end_tid; i++) {
    struct subtask *subtask = create_subtask(dummy_fn, NULL, "dummy_fn",
                                            &dummy_counter,
                                            &dummy_timer, &dummy_iter,
                                            0, 0,
                                            0, 0,
                                            0);
    CHECK_ERR(subtask_queue_enqueue(&scheduler->workers[i], subtask), "subtask_queue_enqueue");
  }
}

static inline int is_finished(struct worker *worker) {
  return worker->dead && subtask_queue_is_empty(&worker->q);
}

// Try to steal from a random queue
static inline int steal_from_random_worker(struct worker* worker)
{
  int my_id = worker->tid;
  struct scheduler* scheduler = worker->scheduler;
  int k = random_other_worker(scheduler, my_id);
  struct worker *worker_k = &scheduler->workers[k];
  struct subtask* subtask =  NULL;
  int retval = subtask_queue_steal(worker_k, &subtask);
  if (retval == 0) {
    subtask_queue_enqueue(worker, subtask);
    return 1;
  }
  return 0;
}


static inline void *scheduler_worker(void* args)
{
  struct worker *worker = (struct worker*) args;
  struct scheduler *scheduler = worker->scheduler;
  worker_local = worker;
  struct subtask *subtask = NULL;

  while(!is_finished(worker)) {
    if (!subtask_queue_is_empty(&worker->q)) {
      int retval = subtask_queue_dequeue(worker, &subtask, 0);
      if (retval == 0) {
        assert(subtask != NULL);
        CHECK_ERR(run_subtask(worker, subtask), "run_subtask");
      } // else someone stole our work

    } else if (scheduler->active_work) { /* steal */
      while (!is_finished(worker) && scheduler->active_work) {
        if (steal_from_random_worker(worker)) {
          break;
        }
      }
    } else { /* go back to sleep and wait for work */
      int retval = subtask_queue_dequeue(worker, &subtask, 1);
      if (retval == 0) {
        assert(subtask != NULL);
        CHECK_ERR(run_subtask(worker, subtask), "run_subtask");
      }
    }
  }

  assert(subtask_queue_is_empty(&worker->q));
#if defined(MCPROFILE)
  if (worker->output_usage)
    output_worker_usage(worker);
#endif
  return NULL;
}


static inline int scheduler_execute_parloop(struct scheduler *scheduler,
                                            struct scheduler_parloop *task,
                                            int64_t *timer)
{

  struct worker *worker = worker_local;

  struct scheduler_info info = task->info;
  int64_t iter_pr_subtask = info.iter_pr_subtask;
  int64_t remainder = info.remainder;
  int nsubtasks = info.nsubtasks;
  volatile int join_counter = nsubtasks;

  // Shared timer used to sum up all
  // sequential work from each subtask
  int64_t task_timer = 0;
  int64_t task_iter = 0;

  enum scheduling sched = info.sched;
  /* If each subtasks should be processed in chunks */
  int chunkable = sched == STATIC ? 0 : 1;
  int64_t chunk_size = scheduler->minimum_chunk_size; // The initial chunk size when no info is avaliable


  if (info.wake_up_threads || sched == DYNAMIC)
    __atomic_add_fetch(&scheduler->active_work, nsubtasks, __ATOMIC_RELAXED);

  int64_t start = 0;
  int64_t end = iter_pr_subtask + (int64_t)(remainder != 0);
  for (int subtask_id = 0; subtask_id < nsubtasks; subtask_id++) {
    struct subtask *subtask = create_subtask(task->fn, task->args, task->name,
                                              &join_counter,
                                              &task_timer, &task_iter,
                                              start, end,
                                              chunkable, chunk_size,
                                              subtask_id);
    assert(subtask != NULL);
    // In most cases we will never have more subtasks than workers,
    // but there can be exceptions (e.g. the kappa tuning function).
    struct worker *subtask_worker =
      worker->nested
      ? &scheduler->workers[worker->tid]
      : &scheduler->workers[subtask_id % scheduler->num_threads];
    CHECK_ERR(subtask_queue_enqueue(subtask_worker, subtask),
              "subtask_queue_enqueue");
    // Update range params
    start = end;
    end += iter_pr_subtask + ((subtask_id + 1) < remainder);
  }

  if (info.wake_up_threads) {
    wake_up_threads(scheduler, nsubtasks, scheduler->num_threads);
  }

  // Join (wait for subtasks to finish)
  while(join_counter != 0) {
    if (!subtask_queue_is_empty(&worker->q)) {
      struct subtask *subtask = NULL;
      int err = subtask_queue_dequeue(worker, &subtask, 0);
      if (err == 0 ) {
        CHECK_ERR(run_subtask(worker, subtask), "run_subtask");
      }
    } else {
      if (steal_from_random_worker(worker)) {
        struct subtask *subtask = NULL;
        int err = subtask_queue_dequeue(worker, &subtask, 0);
        if (err == 0) {
          CHECK_ERR(run_subtask(worker, subtask), "run_subtask");
        }
      }
    }
  }


  if (info.wake_up_threads || sched == DYNAMIC) {
    __atomic_sub_fetch(&scheduler->active_work, nsubtasks, __ATOMIC_RELAXED);
  }

  // Write back timing results of all sequential work
  (*timer) += task_timer;
  return scheduler->error;
}


static inline int scheduler_execute_task(struct scheduler *scheduler,
                                         struct scheduler_parloop *task)
{

  struct worker *worker = worker_local;

  int err = 0;

  // How much sequential work was performed by the task
  int64_t task_timer = 0;

  /* Execute task sequential or parallel based on decision made earlier */
  if (task->info.nsubtasks == 1) {
    int64_t start = get_wall_time_ns();
    err = task->fn(task->args, 0, task->iterations, 0, worker->tid);
    int64_t end = get_wall_time_ns();
    task_timer = end - start;
    worker->time_spent_working += task_timer;
    // Report time measurements
    // TODO the update of both of these should really be a single atomic!!
    __atomic_fetch_add(task->info.task_time, task_timer, __ATOMIC_RELAXED);
    __atomic_fetch_add(task->info.task_iter, task->iterations, __ATOMIC_RELAXED);
  } else {
    // Add "before" time if we already are inside a task
    int64_t time_before = 0;
    if (worker->nested > 0) {
      time_before = total_now(worker->total, worker->timer);
    }

    err = scheduler_execute_parloop(scheduler, task, &task_timer);

    // Report time measurements
    // TODO the update of both of these should really be a single atomic!!
    __atomic_fetch_add(task->info.task_time, task_timer, __ATOMIC_RELAXED);
    __atomic_fetch_add(task->info.task_iter, task->iterations, __ATOMIC_RELAXED);

    // Update timers to account for new timings
    worker->total = time_before + task_timer;
    worker->timer = get_wall_time_ns();
  }


  return err;
}

/* Decide on how schedule the incoming task i.e. how many subtasks and
   to run sequential or (potentially nested) parallel code body */
static inline int scheduler_prepare_task(struct scheduler* scheduler,
                                         struct scheduler_segop *task)
{
  assert(task != NULL);

  struct worker *worker = worker_local;
  struct scheduler_info info;
  info.task_time = task->task_time;
  info.task_iter = task->task_iter;

  int nsubtasks;
  // Decide if task should be scheduled sequentially
  if (is_small(task, scheduler, &nsubtasks)) {
    info.iter_pr_subtask = task->iterations;
    info.remainder = 0;
    info.nsubtasks = nsubtasks;
    return task->top_level_fn(task->args, task->iterations, worker->tid, info);
  } else {
    info.iter_pr_subtask = task->iterations / nsubtasks;
    info.remainder = task->iterations % nsubtasks;
    info.sched = task->sched;
    switch (task->sched) {
    case STATIC:
      info.nsubtasks = info.iter_pr_subtask == 0 ? info.remainder : ((task->iterations - info.remainder) / info.iter_pr_subtask);
      break;
    case DYNAMIC:
      // As any thread can take any subtasks, we are being safe with using
      // an upper bound on the number of tasks such that the task allocate enough memory
      info.nsubtasks = info.iter_pr_subtask == 0 ? info.remainder : nsubtasks;
      break;
    default:
      assert(!"Got unknown scheduling");
    }
  }

  info.wake_up_threads = 0;
  // We only use the nested parallel segop function if we can't exchaust all cores
  // using the outer most level
  if (task->nested_fn != NULL && info.nsubtasks < scheduler->num_threads && info.nsubtasks == task->iterations) {
    if (worker->nested == 0)
      info.wake_up_threads = 1;
    return task->nested_fn(task->args, task->iterations, worker->tid, info);
  }

  return task->top_level_fn(task->args, task->iterations, worker->tid, info);
}

// Now some code for finding the proper value of kappa on a given
// machine (the smallest amount of work that amortises the cost of
// task creation).

struct tuning_struct {
  int32_t *free_tuning_res;
  int32_t *array;
};

// Reduction function over an integer array
static int tuning_loop(void *args, int64_t start, int64_t end,
                                     int flat_tid, int tid) {
  (void)flat_tid;
  (void)tid;

  int err = 0;
  struct tuning_struct *tuning_struct = (struct tuning_struct *) args;
  int32_t *array = tuning_struct->array;
  int32_t *tuning_res = tuning_struct->free_tuning_res;

  int32_t sum = 0;
  for (int i = start; i < end; i++) {
    int32_t y = array[i];
    sum = add32(sum, y);
  }
  *tuning_res = sum;
  return err;
}

// The main entry point for the tuning process.  Sets the provided
// variable ``kappa``.
static int determine_kappa(double *kappa) {
  int err = 0;

  int64_t iterations = 100000000;
  int64_t tuning_time = 0;
  int64_t tuning_iter = 0;

  int32_t *array = malloc(sizeof(int32_t) * iterations);
  for (int64_t i = 0; i < iterations; i++) {
    array[i] = fast_rand();
  }

  int64_t start_tuning = get_wall_time_ns();
  /* **************************** */
  /* Run sequential reduce first' */
  /* **************************** */
  int64_t tuning_sequentiual_start = get_wall_time_ns();
  struct tuning_struct tuning_struct;
  int32_t tuning_res;
  tuning_struct.free_tuning_res = &tuning_res;
  tuning_struct.array = array;

  err = tuning_loop(&tuning_struct, 0, iterations, 0, 0);
  int64_t tuning_sequentiual_end = get_wall_time_ns();
  int64_t sequential_elapsed = tuning_sequentiual_end - tuning_sequentiual_start;

  double C = (double)sequential_elapsed / (double)iterations;
  fprintf(stderr, " Time for sequential run is %lld - Found C %f\n", (long long)sequential_elapsed, C);

  /* ********************** */
  /* Now run tuning process */
  /* ********************** */
  // Setup a scheduler with a single worker
  struct scheduler scheduler;
  scheduler.num_threads = 1;
  scheduler.workers = malloc(sizeof(struct worker));
  worker_local = &scheduler.workers[0];
  worker_local->tid = 0;
  CHECK_ERR(subtask_queue_init(&scheduler.workers[0].q, 1024),
            "failed to init queue for worker %d\n", 0);

  // Start tuning for kappa
  double kappa_tune = 1000; // Initial kappa is 1 us
  double ratio;
  int64_t time_elapsed;
  while(1) {
    int64_t min_iter_pr_subtask = (int64_t) (kappa_tune / C) == 0 ? 1 : (kappa_tune / C);
    int nsubtasks = iterations / min_iter_pr_subtask;
    struct scheduler_info info;
    info.iter_pr_subtask = min_iter_pr_subtask;

    info.nsubtasks = iterations / min_iter_pr_subtask;
    info.remainder = iterations % min_iter_pr_subtask;
    info.task_time = &tuning_time;
    info.task_iter = &tuning_iter;
    info.sched = STATIC;

    struct scheduler_parloop parloop;
    parloop.name = "tuning_loop";
    parloop.fn = tuning_loop;
    parloop.args = &tuning_struct;
    parloop.iterations = iterations;
    parloop.info = info;

    int64_t tuning_chunked_start = get_wall_time_ns();
    int determine_kappa_err =
      scheduler_execute_task(&scheduler,
                             &parloop);
    assert(determine_kappa_err == 0);
    int64_t tuning_chunked_end = get_wall_time_ns();
    time_elapsed =  tuning_chunked_end - tuning_chunked_start;

    ratio = (double)time_elapsed / (double)sequential_elapsed;
    if (ratio < 1.055) {
      break;
    }
    kappa_tune += 100; // Increase by 100 ns at the time
    fprintf(stderr, "nsubtask %d - kappa %f - ratio %f\n", nsubtasks, kappa_tune, ratio);
  }

  int64_t end_tuning = get_wall_time_ns();
  fprintf(stderr, "tuning took %lld ns and found kappa %f - time %lld - ratio %f\n",
          (long long)end_tuning - start_tuning,
          kappa_tune,
          (long long)time_elapsed,
          ratio);
  *kappa = kappa_tune;

  // Clean-up
  CHECK_ERR(subtask_queue_destroy(&scheduler.workers[0].q), "failed to destroy queue");
  free(array);
  free(scheduler.workers);
  return err;
}

static int scheduler_init(struct scheduler *scheduler,
                          int num_workers,
                          double kappa) {
#ifdef FUTHARK_BACKEND_ispc
  int64_t get_gang_size();
  scheduler->minimum_chunk_size = get_gang_size();
#else
  scheduler->minimum_chunk_size = 1;
#endif

  assert(num_workers > 0);

  scheduler->kappa = kappa;
  scheduler->num_threads = num_workers;
  scheduler->active_work = 0;
  scheduler->error = 0;

  scheduler->workers = calloc(num_workers, sizeof(struct worker));

  const int queue_capacity = 1024;

  worker_local = &scheduler->workers[0];
  worker_local->tid = 0;
  worker_local->scheduler = scheduler;
  CHECK_ERR(subtask_queue_init(&worker_local->q, queue_capacity),
            "failed to init queue for worker %d\n", 0);

  for (int i = 1; i < num_workers; i++) {
    struct worker *cur_worker = &scheduler->workers[i];
    memset(cur_worker, 0, sizeof(struct worker));
    cur_worker->tid = i;
    cur_worker->output_usage = 0;
    cur_worker->scheduler = scheduler;
    CHECK_ERR(subtask_queue_init(&cur_worker->q, queue_capacity),
              "failed to init queue for worker %d\n", i);

    CHECK_ERR(pthread_create(&cur_worker->thread,
                             NULL,
                             &scheduler_worker,
                             cur_worker),
              "Failed to create worker %d\n", i);
  }

  return 0;
}

static int scheduler_destroy(struct scheduler *scheduler) {
  // We assume that this function is called by the thread controlling
  // the first worker, which is why we treat scheduler->workers[0]
  // specially here.

  // First mark them all as dead.
  for (int i = 1; i < scheduler->num_threads; i++) {
    struct worker *cur_worker = &scheduler->workers[i];
    cur_worker->dead = 1;
  }

  // Then destroy their task queues (this will wake up the threads and
  // make them do their shutdown).
  for (int i = 1; i < scheduler->num_threads; i++) {
    struct worker *cur_worker = &scheduler->workers[i];
    subtask_queue_destroy(&cur_worker->q);
  }

  // Then actually wait for them to stop.
  for (int i = 1; i < scheduler->num_threads; i++) {
    struct worker *cur_worker = &scheduler->workers[i];
    CHECK_ERR(pthread_join(scheduler->workers[i].thread, NULL), "pthread_join");
  }

  // And then destroy our own queue.
  subtask_queue_destroy(&scheduler->workers[0].q);

  free(scheduler->workers);

  return 0;
}

// End of scheduler.h

// Start of backends/multicore.h

struct futhark_context_config {
  int in_use;
  int debugging;
  int profiling;
  int logging;
  char *cache_fname;
  int num_tuning_params;
  int64_t *tuning_params;
  const char** tuning_param_names;
  const char** tuning_param_vars;
  const char** tuning_param_classes;
  // Uniform fields above.

  int num_threads;
};

static void backend_context_config_setup(struct futhark_context_config* cfg) {
  cfg->num_threads = 0;
}

static void backend_context_config_teardown(struct futhark_context_config* cfg) {
  (void)cfg;
}

void futhark_context_config_set_num_threads(struct futhark_context_config *cfg, int n) {
  cfg->num_threads = n;
}

int futhark_context_config_set_tuning_param(struct futhark_context_config* cfg, const char *param_name, size_t param_value) {
  (void)cfg; (void)param_name; (void)param_value;
  return 1;
}

struct futhark_context {
  struct futhark_context_config* cfg;
  int detail_memory;
  int debugging;
  int profiling;
  int profiling_paused;
  int logging;
  lock_t lock;
  char *error;
  lock_t error_lock;
  FILE *log;
  struct constants *constants;
  struct free_list free_list;
  struct event_list event_list;
  int64_t peak_mem_usage_default;
  int64_t cur_mem_usage_default;
  struct program* program;
  bool program_initialised;
  // Uniform fields above.

  lock_t event_list_lock;
  struct scheduler scheduler;
  int total_runs;
  long int total_runtime;
  int64_t tuning_timing;
  int64_t tuning_iter;
};

int backend_context_setup(struct futhark_context* ctx) {
  // Initialize rand()
  fast_srand(time(0));

  int tune_kappa = 0;
  double kappa = 5.1f * 1000;

  if (tune_kappa) {
    if (determine_kappa(&kappa) != 0) {
      ctx->error = strdup("Failed to determine kappa.");
      return 1;
    }
  }

  if (scheduler_init(&ctx->scheduler,
                     ctx->cfg->num_threads > 0 ?
                     ctx->cfg->num_threads : num_processors(),
                     kappa) != 0) {
    ctx->error = strdup("Failed to initialise scheduler.");
    return 1;
  }

  create_lock(&ctx->event_list_lock);

  return 0;
}

void backend_context_teardown(struct futhark_context* ctx) {
  (void)scheduler_destroy(&ctx->scheduler);
  free_lock(&ctx->event_list_lock);
}

int futhark_context_sync(struct futhark_context* ctx) {
  (void)ctx;
  return 0;
}

struct mc_event {
  // Time in microseconds.
  uint64_t bef, aft;
};

static struct mc_event* mc_event_new(struct futhark_context* ctx) {
  if (ctx->profiling && !ctx->profiling_paused) {
    struct mc_event* e = malloc(sizeof(struct mc_event));
    return e;
  } else {
    return NULL;
  }
}

static int mc_event_report(struct str_builder* sb, struct mc_event* e) {
  float ms = e->aft - e->bef;
  str_builder(sb, ",\"duration\":%f", ms);
  free(e);
  return 0;
}


// End of backends/multicore.h

struct program {
    int dummy;
    int64_t futhark_mc_copy_114760_task_127226_total_time;
    int64_t futhark_mc_copy_114760_task_127226_total_iter;
    int64_t futhark_mc_copy_114770_task_127233_total_time;
    int64_t futhark_mc_copy_114770_task_127233_total_iter;
    int64_t futhark_mc_copy_114783_task_127240_total_time;
    int64_t futhark_mc_copy_114783_task_127240_total_iter;
    int64_t futhark_mc_copy_114796_task_127247_total_time;
    int64_t futhark_mc_copy_114796_task_127247_total_iter;
    int64_t futhark_mc_segmap_task_127256_total_time;
    int64_t futhark_mc_segmap_task_127256_total_iter;
    int64_t futhark_mc_segmap_task_127267_total_time;
    int64_t futhark_mc_segmap_task_127267_total_iter;
    int64_t futhark_mc_segmap_task_127277_total_time;
    int64_t futhark_mc_segmap_task_127277_total_iter;
    int64_t futhark_mc_segred_task_127287_total_time;
    int64_t futhark_mc_segred_task_127287_total_iter;
    int64_t futhark_mc_segscan_task_127320_total_time;
    int64_t futhark_mc_segscan_task_127320_total_iter;
    int64_t futhark_mc_segred_task_127332_total_time;
    int64_t futhark_mc_segred_task_127332_total_iter;
    int64_t futhark_mc_segmap_task_127340_total_time;
    int64_t futhark_mc_segmap_task_127340_total_iter;
    int64_t futhark_mc_segscan_task_127347_total_time;
    int64_t futhark_mc_segscan_task_127347_total_iter;
    int64_t futhark_mc_segscan_task_127360_total_time;
    int64_t futhark_mc_segscan_task_127360_total_iter;
    int64_t futhark_mc_copy_114882_task_127373_total_time;
    int64_t futhark_mc_copy_114882_task_127373_total_iter;
    int64_t futhark_mc_segmap_task_127380_total_time;
    int64_t futhark_mc_segmap_task_127380_total_iter;
    int64_t futhark_mc_segred_task_127472_total_time;
    int64_t futhark_mc_segred_task_127472_total_iter;
    int64_t futhark_mc_segred_task_127502_total_time;
    int64_t futhark_mc_segred_task_127502_total_iter;
    int64_t futhark_mc_copy_122254_task_127517_total_time;
    int64_t futhark_mc_copy_122254_task_127517_total_iter;
    int64_t futhark_mc_segred_task_127527_total_time;
    int64_t futhark_mc_segred_task_127527_total_iter;
    int64_t futhark_mc_segred_task_127545_total_time;
    int64_t futhark_mc_segred_task_127545_total_iter;
    int64_t futhark_mc_segred_task_127559_total_time;
    int64_t futhark_mc_segred_task_127559_total_iter;
    int64_t futhark_mc_segred_task_127571_total_time;
    int64_t futhark_mc_segred_task_127571_total_iter;
    int64_t futhark_mc_segred_task_127583_total_time;
    int64_t futhark_mc_segred_task_127583_total_iter;
    int64_t futhark_mc_segred_task_127604_total_time;
    int64_t futhark_mc_segred_task_127604_total_iter;
    int64_t futhark_mc_segmap_task_127613_total_time;
    int64_t futhark_mc_segmap_task_127613_total_iter;
    int64_t futhark_mc_segred_task_127623_total_time;
    int64_t futhark_mc_segred_task_127623_total_iter;
    int64_t futhark_mc_segred_task_127635_total_time;
    int64_t futhark_mc_segred_task_127635_total_iter;
    int64_t futhark_mc_segred_task_127649_total_time;
    int64_t futhark_mc_segred_task_127649_total_iter;
    int64_t futhark_mc_segmap_task_127661_total_time;
    int64_t futhark_mc_segmap_task_127661_total_iter;
    int64_t futhark_mc_copy_122738_task_127668_total_time;
    int64_t futhark_mc_copy_122738_task_127668_total_iter;
    int64_t futhark_mc_segmap_task_127678_total_time;
    int64_t futhark_mc_segmap_task_127678_total_iter;
    int64_t futhark_mc_segred_task_127688_total_time;
    int64_t futhark_mc_segred_task_127688_total_iter;
    int64_t futhark_mc_segmap_task_127699_total_time;
    int64_t futhark_mc_segmap_task_127699_total_iter;
    int64_t futhark_mc_segred_task_127709_total_time;
    int64_t futhark_mc_segred_task_127709_total_iter;
    int64_t futhark_mc_segred_task_127720_total_time;
    int64_t futhark_mc_segred_task_127720_total_iter;
    int64_t futhark_mc_segred_task_127732_total_time;
    int64_t futhark_mc_segred_task_127732_total_iter;
    int64_t futhark_mc_segred_task_127743_total_time;
    int64_t futhark_mc_segred_task_127743_total_iter;
    int64_t futhark_mc_segred_task_127755_total_time;
    int64_t futhark_mc_segred_task_127755_total_iter;
    int64_t futhark_mc_segred_task_127766_total_time;
    int64_t futhark_mc_segred_task_127766_total_iter;
    int64_t futhark_mc_segmap_task_127774_total_time;
    int64_t futhark_mc_segmap_task_127774_total_iter;
    int64_t futhark_mc_segred_task_127781_total_time;
    int64_t futhark_mc_segred_task_127781_total_iter;
    int64_t futhark_mc_segmap_task_127789_total_time;
    int64_t futhark_mc_segmap_task_127789_total_iter;
    int64_t futhark_mc_segred_task_127796_total_time;
    int64_t futhark_mc_segred_task_127796_total_iter;
    int64_t futhark_mc_segred_task_127804_total_time;
    int64_t futhark_mc_segred_task_127804_total_iter;
    int64_t futhark_mc_segred_task_127816_total_time;
    int64_t futhark_mc_segred_task_127816_total_iter;
    int64_t futhark_mc_segred_task_127827_total_time;
    int64_t futhark_mc_segred_task_127827_total_iter;
    int64_t futhark_mc_segred_task_127839_total_time;
    int64_t futhark_mc_segred_task_127839_total_iter;
    int64_t futhark_mc_segred_task_127850_total_time;
    int64_t futhark_mc_segred_task_127850_total_iter;
    int64_t futhark_mc_segmap_task_127858_total_time;
    int64_t futhark_mc_segmap_task_127858_total_iter;
    int64_t futhark_mc_segred_task_127865_total_time;
    int64_t futhark_mc_segred_task_127865_total_iter;
    int64_t futhark_mc_segmap_task_127873_total_time;
    int64_t futhark_mc_segmap_task_127873_total_iter;
    int64_t futhark_mc_segred_task_127880_total_time;
    int64_t futhark_mc_segred_task_127880_total_iter;
    int64_t futhark_mc_segred_task_127888_total_time;
    int64_t futhark_mc_segred_task_127888_total_iter;
    int64_t futhark_mc_segred_task_127902_total_time;
    int64_t futhark_mc_segred_task_127902_total_iter;
    int64_t futhark_mc_copy_123299_task_127910_total_time;
    int64_t futhark_mc_copy_123299_task_127910_total_iter;
    int64_t futhark_mc_segred_task_127920_total_time;
    int64_t futhark_mc_segred_task_127920_total_iter;
    int64_t futhark_mc_segred_task_127934_total_time;
    int64_t futhark_mc_segred_task_127934_total_iter;
    int64_t futhark_mc_copy_123362_task_127942_total_time;
    int64_t futhark_mc_copy_123362_task_127942_total_iter;
    int64_t futhark_mc_segred_task_127952_total_time;
    int64_t futhark_mc_segred_task_127952_total_iter;
    int64_t futhark_mc_segred_task_127964_total_time;
    int64_t futhark_mc_segred_task_127964_total_iter;
    int64_t futhark_mc_segred_task_127975_total_time;
    int64_t futhark_mc_segred_task_127975_total_iter;
    int64_t futhark_mc_segred_task_127983_total_time;
    int64_t futhark_mc_segred_task_127983_total_iter;
    int64_t futhark_mc_segred_task_127991_total_time;
    int64_t futhark_mc_segred_task_127991_total_iter;
    int64_t futhark_mc_segred_task_128009_total_time;
    int64_t futhark_mc_segred_task_128009_total_iter;
    int64_t futhark_mc_segred_task_128024_total_time;
    int64_t futhark_mc_segred_task_128024_total_iter;
    int64_t futhark_mc_segred_task_128036_total_time;
    int64_t futhark_mc_segred_task_128036_total_iter;
    int64_t futhark_mc_segmap_task_128048_total_time;
    int64_t futhark_mc_segmap_task_128048_total_iter;
    int64_t futhark_mc_segred_task_128058_total_time;
    int64_t futhark_mc_segred_task_128058_total_iter;
    int64_t futhark_mc_segmap_task_128069_total_time;
    int64_t futhark_mc_segmap_task_128069_total_iter;
    int64_t futhark_mc_segred_task_128082_total_time;
    int64_t futhark_mc_segred_task_128082_total_iter;
    int64_t futhark_mc_segmap_task_128090_total_time;
    int64_t futhark_mc_segmap_task_128090_total_iter;
    int64_t futhark_mc_segred_task_128100_total_time;
    int64_t futhark_mc_segred_task_128100_total_iter;
    int64_t futhark_mc_segred_task_128111_total_time;
    int64_t futhark_mc_segred_task_128111_total_iter;
    int64_t futhark_mc_segred_task_128123_total_time;
    int64_t futhark_mc_segred_task_128123_total_iter;
    int64_t futhark_mc_segmap_task_128134_total_time;
    int64_t futhark_mc_segmap_task_128134_total_iter;
    int64_t futhark_mc_segred_task_128144_total_time;
    int64_t futhark_mc_segred_task_128144_total_iter;
    int64_t futhark_mc_segred_task_128158_total_time;
    int64_t futhark_mc_segred_task_128158_total_iter;
    int64_t futhark_mc_segred_task_128166_total_time;
    int64_t futhark_mc_segred_task_128166_total_iter;
    int64_t futhark_mc_copy_124082_task_128174_total_time;
    int64_t futhark_mc_copy_124082_task_128174_total_iter;
    int64_t futhark_mc_segred_task_128184_total_time;
    int64_t futhark_mc_segred_task_128184_total_iter;
    int64_t futhark_mc_segred_task_128196_total_time;
    int64_t futhark_mc_segred_task_128196_total_iter;
    int64_t futhark_mc_segred_task_128207_total_time;
    int64_t futhark_mc_segred_task_128207_total_iter;
    int64_t futhark_mc_segmap_task_128215_total_time;
    int64_t futhark_mc_segmap_task_128215_total_iter;
    int64_t futhark_mc_segred_task_128222_total_time;
    int64_t futhark_mc_segred_task_128222_total_iter;
    int64_t futhark_mc_segmap_task_128230_total_time;
    int64_t futhark_mc_segmap_task_128230_total_iter;
    int64_t futhark_mc_segred_task_128237_total_time;
    int64_t futhark_mc_segred_task_128237_total_iter;
    int64_t futhark_mc_segred_task_128245_total_time;
    int64_t futhark_mc_segred_task_128245_total_iter;
    int64_t futhark_mc_segred_task_128253_total_time;
    int64_t futhark_mc_segred_task_128253_total_iter;
    int64_t futhark_mc_segred_task_128265_total_time;
    int64_t futhark_mc_segred_task_128265_total_iter;
    int64_t futhark_mc_segred_task_128276_total_time;
    int64_t futhark_mc_segred_task_128276_total_iter;
    int64_t futhark_mc_segred_task_128288_total_time;
    int64_t futhark_mc_segred_task_128288_total_iter;
    int64_t futhark_mc_segred_task_128299_total_time;
    int64_t futhark_mc_segred_task_128299_total_iter;
    int64_t futhark_mc_segmap_task_128307_total_time;
    int64_t futhark_mc_segmap_task_128307_total_iter;
    int64_t futhark_mc_segred_task_128314_total_time;
    int64_t futhark_mc_segred_task_128314_total_iter;
    int64_t futhark_mc_segmap_task_128322_total_time;
    int64_t futhark_mc_segmap_task_128322_total_iter;
    int64_t futhark_mc_segred_task_128329_total_time;
    int64_t futhark_mc_segred_task_128329_total_iter;
    int64_t futhark_mc_segred_task_128337_total_time;
    int64_t futhark_mc_segred_task_128337_total_iter;
    int64_t futhark_mc_segred_task_128345_total_time;
    int64_t futhark_mc_segred_task_128345_total_iter;
    int64_t futhark_mc_segred_task_128353_total_time;
    int64_t futhark_mc_segred_task_128353_total_iter;
    int64_t futhark_mc_segred_task_128365_total_time;
    int64_t futhark_mc_segred_task_128365_total_iter;
    int64_t futhark_mc_segred_task_128376_total_time;
    int64_t futhark_mc_segred_task_128376_total_iter;
    int64_t futhark_mc_segred_task_128388_total_time;
    int64_t futhark_mc_segred_task_128388_total_iter;
    int64_t futhark_mc_segred_task_128399_total_time;
    int64_t futhark_mc_segred_task_128399_total_iter;
    int64_t futhark_mc_segmap_task_128407_total_time;
    int64_t futhark_mc_segmap_task_128407_total_iter;
    int64_t futhark_mc_segred_task_128414_total_time;
    int64_t futhark_mc_segred_task_128414_total_iter;
    int64_t futhark_mc_segmap_task_128422_total_time;
    int64_t futhark_mc_segmap_task_128422_total_iter;
    int64_t futhark_mc_segred_task_128429_total_time;
    int64_t futhark_mc_segred_task_128429_total_iter;
    int64_t futhark_mc_segred_task_128437_total_time;
    int64_t futhark_mc_segred_task_128437_total_iter;
    int64_t futhark_mc_segred_task_128445_total_time;
    int64_t futhark_mc_segred_task_128445_total_iter;
    int64_t futhark_mc_segred_task_128457_total_time;
    int64_t futhark_mc_segred_task_128457_total_iter;
    int64_t futhark_mc_segred_task_128468_total_time;
    int64_t futhark_mc_segred_task_128468_total_iter;
    int64_t futhark_mc_segred_task_128480_total_time;
    int64_t futhark_mc_segred_task_128480_total_iter;
    int64_t futhark_mc_segred_task_128491_total_time;
    int64_t futhark_mc_segred_task_128491_total_iter;
    int64_t futhark_mc_segmap_task_128499_total_time;
    int64_t futhark_mc_segmap_task_128499_total_iter;
    int64_t futhark_mc_segred_task_128506_total_time;
    int64_t futhark_mc_segred_task_128506_total_iter;
    int64_t futhark_mc_segmap_task_128514_total_time;
    int64_t futhark_mc_segmap_task_128514_total_iter;
    int64_t futhark_mc_segred_task_128521_total_time;
    int64_t futhark_mc_segred_task_128521_total_iter;
    int64_t futhark_mc_segred_task_128529_total_time;
    int64_t futhark_mc_segred_task_128529_total_iter;
    int64_t futhark_mc_segred_task_128537_total_time;
    int64_t futhark_mc_segred_task_128537_total_iter;
    int64_t futhark_mc_segred_task_128551_total_time;
    int64_t futhark_mc_segred_task_128551_total_iter;
    int64_t futhark_mc_copy_124989_task_128559_total_time;
    int64_t futhark_mc_copy_124989_task_128559_total_iter;
    int64_t futhark_mc_segred_task_128569_total_time;
    int64_t futhark_mc_segred_task_128569_total_iter;
    int64_t futhark_mc_segred_task_128585_total_time;
    int64_t futhark_mc_segred_task_128585_total_iter;
    int64_t futhark_mc_segmap_task_128598_total_time;
    int64_t futhark_mc_segmap_task_128598_total_iter;
    int64_t futhark_mc_segred_task_128605_total_time;
    int64_t futhark_mc_segred_task_128605_total_iter;
    int64_t futhark_mc_segred_task_128623_total_time;
    int64_t futhark_mc_segred_task_128623_total_iter;
    int64_t futhark_mc_segmap_task_128638_total_time;
    int64_t futhark_mc_segmap_task_128638_total_iter;
    int64_t futhark_mc_segred_task_128648_total_time;
    int64_t futhark_mc_segred_task_128648_total_iter;
    int64_t futhark_mc_copy_125336_task_128659_total_time;
    int64_t futhark_mc_copy_125336_task_128659_total_iter;
    int64_t futhark_mc_segred_task_128666_total_time;
    int64_t futhark_mc_segred_task_128666_total_iter;
    int64_t futhark_mc_segmap_task_128692_total_time;
    int64_t futhark_mc_segmap_task_128692_total_iter;
    int64_t futhark_mc_segred_task_128702_total_time;
    int64_t futhark_mc_segred_task_128702_total_iter;
    int64_t futhark_mc_segred_task_128713_total_time;
    int64_t futhark_mc_segred_task_128713_total_iter;
    int64_t futhark_mc_segred_task_128721_total_time;
    int64_t futhark_mc_segred_task_128721_total_iter;
    int64_t futhark_mc_segred_task_128739_total_time;
    int64_t futhark_mc_segred_task_128739_total_iter;
    int64_t futhark_mc_copy_125628_task_128750_total_time;
    int64_t futhark_mc_copy_125628_task_128750_total_iter;
    int64_t futhark_mc_copy_125638_task_128757_total_time;
    int64_t futhark_mc_copy_125638_task_128757_total_iter;
    int64_t futhark_mc_segred_task_128767_total_time;
    int64_t futhark_mc_segred_task_128767_total_iter;
    int64_t futhark_mc_segred_task_128779_total_time;
    int64_t futhark_mc_segred_task_128779_total_iter;
    int64_t futhark_mc_segred_task_128791_total_time;
    int64_t futhark_mc_segred_task_128791_total_iter;
    int64_t futhark_mc_segred_task_128807_total_time;
    int64_t futhark_mc_segred_task_128807_total_iter;
    int64_t futhark_mc_segmap_task_128815_total_time;
    int64_t futhark_mc_segmap_task_128815_total_iter;
    int64_t futhark_mc_segred_task_128825_total_time;
    int64_t futhark_mc_segred_task_128825_total_iter;
    int64_t futhark_mc_segred_task_128836_total_time;
    int64_t futhark_mc_segred_task_128836_total_iter;
    int64_t futhark_mc_segred_task_128848_total_time;
    int64_t futhark_mc_segred_task_128848_total_iter;
    int64_t futhark_mc_segred_task_128862_total_time;
    int64_t futhark_mc_segred_task_128862_total_iter;
    int64_t futhark_mc_segred_task_128874_total_time;
    int64_t futhark_mc_segred_task_128874_total_iter;
    int64_t futhark_mc_segred_task_128885_total_time;
    int64_t futhark_mc_segred_task_128885_total_iter;
    int64_t futhark_mc_segred_task_128905_total_time;
    int64_t futhark_mc_segred_task_128905_total_iter;
    int64_t futhark_mc_copy_126065_task_128915_total_time;
    int64_t futhark_mc_copy_126065_task_128915_total_iter;
    int64_t futhark_mc_copy_126075_task_128922_total_time;
    int64_t futhark_mc_copy_126075_task_128922_total_iter;
    int64_t futhark_mc_segred_task_128932_total_time;
    int64_t futhark_mc_segred_task_128932_total_iter;
    int64_t futhark_mc_segred_task_128944_total_time;
    int64_t futhark_mc_segred_task_128944_total_iter;
    int64_t futhark_mc_segred_task_128956_total_time;
    int64_t futhark_mc_segred_task_128956_total_iter;
    int64_t futhark_mc_segred_task_128972_total_time;
    int64_t futhark_mc_segred_task_128972_total_iter;
    int64_t futhark_mc_segmap_task_128980_total_time;
    int64_t futhark_mc_segmap_task_128980_total_iter;
    int64_t futhark_mc_segred_task_128990_total_time;
    int64_t futhark_mc_segred_task_128990_total_iter;
    int64_t futhark_mc_segred_task_129001_total_time;
    int64_t futhark_mc_segred_task_129001_total_iter;
    int64_t futhark_mc_segred_task_129013_total_time;
    int64_t futhark_mc_segred_task_129013_total_iter;
    int64_t futhark_mc_segred_task_129027_total_time;
    int64_t futhark_mc_segred_task_129027_total_iter;
    int64_t futhark_mc_segred_task_129039_total_time;
    int64_t futhark_mc_segred_task_129039_total_iter;
    int64_t futhark_mc_segmap_task_129050_total_time;
    int64_t futhark_mc_segmap_task_129050_total_iter;
    int64_t futhark_mc_segmap_task_129060_total_time;
    int64_t futhark_mc_segmap_task_129060_total_iter;
    int64_t futhark_mc_segred_task_129070_total_time;
    int64_t futhark_mc_segred_task_129070_total_iter;
    int64_t futhark_mc_segred_task_129082_total_time;
    int64_t futhark_mc_segred_task_129082_total_iter;
    int64_t futhark_mc_segred_task_129093_total_time;
    int64_t futhark_mc_segred_task_129093_total_iter;
    int64_t futhark_mc_segred_task_129105_total_time;
    int64_t futhark_mc_segred_task_129105_total_iter;
    int64_t futhark_mc_segred_task_129116_total_time;
    int64_t futhark_mc_segred_task_129116_total_iter;
    int64_t futhark_mc_segmap_task_129138_total_time;
    int64_t futhark_mc_segmap_task_129138_total_iter;
    int64_t futhark_mc_segred_task_129148_total_time;
    int64_t futhark_mc_segred_task_129148_total_iter;
    int64_t futhark_mc_segred_task_129159_total_time;
    int64_t futhark_mc_segred_task_129159_total_iter;
    int64_t futhark_mc_segred_task_129185_total_time;
    int64_t futhark_mc_segred_task_129185_total_iter;
    int64_t futhark_mc_segmap_task_129199_total_time;
    int64_t futhark_mc_segmap_task_129199_total_iter;
    int64_t futhark_mc_segred_task_129209_total_time;
    int64_t futhark_mc_segred_task_129209_total_iter;
    int64_t futhark_mc_segred_task_129222_total_time;
    int64_t futhark_mc_segred_task_129222_total_iter;
    int64_t futhark_mc_segred_task_129234_total_time;
    int64_t futhark_mc_segred_task_129234_total_iter;
    int64_t futhark_mc_segred_task_129245_total_time;
    int64_t futhark_mc_segred_task_129245_total_iter;
    int64_t futhark_mc_segred_task_129257_total_time;
    int64_t futhark_mc_segred_task_129257_total_iter;
    int64_t futhark_mc_segred_task_129268_total_time;
    int64_t futhark_mc_segred_task_129268_total_iter;
    int64_t futhark_mc_segred_task_129282_total_time;
    int64_t futhark_mc_segred_task_129282_total_iter;
    int64_t futhark_mc_segred_task_129294_total_time;
    int64_t futhark_mc_segred_task_129294_total_iter;
    int64_t futhark_mc_segred_task_129308_total_time;
    int64_t futhark_mc_segred_task_129308_total_iter;
};
static void setup_program(struct futhark_context *ctx)
{
    (void) ctx;
    
    int error = 0;
    
    (void) error;
    ctx->program = malloc(sizeof(struct program));
    ctx->program->futhark_mc_copy_114760_task_127226_total_time = 0;
    ctx->program->futhark_mc_copy_114760_task_127226_total_iter = 0;
    ctx->program->futhark_mc_copy_114770_task_127233_total_time = 0;
    ctx->program->futhark_mc_copy_114770_task_127233_total_iter = 0;
    ctx->program->futhark_mc_copy_114783_task_127240_total_time = 0;
    ctx->program->futhark_mc_copy_114783_task_127240_total_iter = 0;
    ctx->program->futhark_mc_copy_114796_task_127247_total_time = 0;
    ctx->program->futhark_mc_copy_114796_task_127247_total_iter = 0;
    ctx->program->futhark_mc_segmap_task_127256_total_time = 0;
    ctx->program->futhark_mc_segmap_task_127256_total_iter = 0;
    ctx->program->futhark_mc_segmap_task_127267_total_time = 0;
    ctx->program->futhark_mc_segmap_task_127267_total_iter = 0;
    ctx->program->futhark_mc_segmap_task_127277_total_time = 0;
    ctx->program->futhark_mc_segmap_task_127277_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127287_total_time = 0;
    ctx->program->futhark_mc_segred_task_127287_total_iter = 0;
    ctx->program->futhark_mc_segscan_task_127320_total_time = 0;
    ctx->program->futhark_mc_segscan_task_127320_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127332_total_time = 0;
    ctx->program->futhark_mc_segred_task_127332_total_iter = 0;
    ctx->program->futhark_mc_segmap_task_127340_total_time = 0;
    ctx->program->futhark_mc_segmap_task_127340_total_iter = 0;
    ctx->program->futhark_mc_segscan_task_127347_total_time = 0;
    ctx->program->futhark_mc_segscan_task_127347_total_iter = 0;
    ctx->program->futhark_mc_segscan_task_127360_total_time = 0;
    ctx->program->futhark_mc_segscan_task_127360_total_iter = 0;
    ctx->program->futhark_mc_copy_114882_task_127373_total_time = 0;
    ctx->program->futhark_mc_copy_114882_task_127373_total_iter = 0;
    ctx->program->futhark_mc_segmap_task_127380_total_time = 0;
    ctx->program->futhark_mc_segmap_task_127380_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127472_total_time = 0;
    ctx->program->futhark_mc_segred_task_127472_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127502_total_time = 0;
    ctx->program->futhark_mc_segred_task_127502_total_iter = 0;
    ctx->program->futhark_mc_copy_122254_task_127517_total_time = 0;
    ctx->program->futhark_mc_copy_122254_task_127517_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127527_total_time = 0;
    ctx->program->futhark_mc_segred_task_127527_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127545_total_time = 0;
    ctx->program->futhark_mc_segred_task_127545_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127559_total_time = 0;
    ctx->program->futhark_mc_segred_task_127559_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127571_total_time = 0;
    ctx->program->futhark_mc_segred_task_127571_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127583_total_time = 0;
    ctx->program->futhark_mc_segred_task_127583_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127604_total_time = 0;
    ctx->program->futhark_mc_segred_task_127604_total_iter = 0;
    ctx->program->futhark_mc_segmap_task_127613_total_time = 0;
    ctx->program->futhark_mc_segmap_task_127613_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127623_total_time = 0;
    ctx->program->futhark_mc_segred_task_127623_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127635_total_time = 0;
    ctx->program->futhark_mc_segred_task_127635_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127649_total_time = 0;
    ctx->program->futhark_mc_segred_task_127649_total_iter = 0;
    ctx->program->futhark_mc_segmap_task_127661_total_time = 0;
    ctx->program->futhark_mc_segmap_task_127661_total_iter = 0;
    ctx->program->futhark_mc_copy_122738_task_127668_total_time = 0;
    ctx->program->futhark_mc_copy_122738_task_127668_total_iter = 0;
    ctx->program->futhark_mc_segmap_task_127678_total_time = 0;
    ctx->program->futhark_mc_segmap_task_127678_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127688_total_time = 0;
    ctx->program->futhark_mc_segred_task_127688_total_iter = 0;
    ctx->program->futhark_mc_segmap_task_127699_total_time = 0;
    ctx->program->futhark_mc_segmap_task_127699_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127709_total_time = 0;
    ctx->program->futhark_mc_segred_task_127709_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127720_total_time = 0;
    ctx->program->futhark_mc_segred_task_127720_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127732_total_time = 0;
    ctx->program->futhark_mc_segred_task_127732_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127743_total_time = 0;
    ctx->program->futhark_mc_segred_task_127743_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127755_total_time = 0;
    ctx->program->futhark_mc_segred_task_127755_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127766_total_time = 0;
    ctx->program->futhark_mc_segred_task_127766_total_iter = 0;
    ctx->program->futhark_mc_segmap_task_127774_total_time = 0;
    ctx->program->futhark_mc_segmap_task_127774_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127781_total_time = 0;
    ctx->program->futhark_mc_segred_task_127781_total_iter = 0;
    ctx->program->futhark_mc_segmap_task_127789_total_time = 0;
    ctx->program->futhark_mc_segmap_task_127789_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127796_total_time = 0;
    ctx->program->futhark_mc_segred_task_127796_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127804_total_time = 0;
    ctx->program->futhark_mc_segred_task_127804_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127816_total_time = 0;
    ctx->program->futhark_mc_segred_task_127816_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127827_total_time = 0;
    ctx->program->futhark_mc_segred_task_127827_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127839_total_time = 0;
    ctx->program->futhark_mc_segred_task_127839_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127850_total_time = 0;
    ctx->program->futhark_mc_segred_task_127850_total_iter = 0;
    ctx->program->futhark_mc_segmap_task_127858_total_time = 0;
    ctx->program->futhark_mc_segmap_task_127858_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127865_total_time = 0;
    ctx->program->futhark_mc_segred_task_127865_total_iter = 0;
    ctx->program->futhark_mc_segmap_task_127873_total_time = 0;
    ctx->program->futhark_mc_segmap_task_127873_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127880_total_time = 0;
    ctx->program->futhark_mc_segred_task_127880_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127888_total_time = 0;
    ctx->program->futhark_mc_segred_task_127888_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127902_total_time = 0;
    ctx->program->futhark_mc_segred_task_127902_total_iter = 0;
    ctx->program->futhark_mc_copy_123299_task_127910_total_time = 0;
    ctx->program->futhark_mc_copy_123299_task_127910_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127920_total_time = 0;
    ctx->program->futhark_mc_segred_task_127920_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127934_total_time = 0;
    ctx->program->futhark_mc_segred_task_127934_total_iter = 0;
    ctx->program->futhark_mc_copy_123362_task_127942_total_time = 0;
    ctx->program->futhark_mc_copy_123362_task_127942_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127952_total_time = 0;
    ctx->program->futhark_mc_segred_task_127952_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127964_total_time = 0;
    ctx->program->futhark_mc_segred_task_127964_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127975_total_time = 0;
    ctx->program->futhark_mc_segred_task_127975_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127983_total_time = 0;
    ctx->program->futhark_mc_segred_task_127983_total_iter = 0;
    ctx->program->futhark_mc_segred_task_127991_total_time = 0;
    ctx->program->futhark_mc_segred_task_127991_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128009_total_time = 0;
    ctx->program->futhark_mc_segred_task_128009_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128024_total_time = 0;
    ctx->program->futhark_mc_segred_task_128024_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128036_total_time = 0;
    ctx->program->futhark_mc_segred_task_128036_total_iter = 0;
    ctx->program->futhark_mc_segmap_task_128048_total_time = 0;
    ctx->program->futhark_mc_segmap_task_128048_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128058_total_time = 0;
    ctx->program->futhark_mc_segred_task_128058_total_iter = 0;
    ctx->program->futhark_mc_segmap_task_128069_total_time = 0;
    ctx->program->futhark_mc_segmap_task_128069_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128082_total_time = 0;
    ctx->program->futhark_mc_segred_task_128082_total_iter = 0;
    ctx->program->futhark_mc_segmap_task_128090_total_time = 0;
    ctx->program->futhark_mc_segmap_task_128090_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128100_total_time = 0;
    ctx->program->futhark_mc_segred_task_128100_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128111_total_time = 0;
    ctx->program->futhark_mc_segred_task_128111_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128123_total_time = 0;
    ctx->program->futhark_mc_segred_task_128123_total_iter = 0;
    ctx->program->futhark_mc_segmap_task_128134_total_time = 0;
    ctx->program->futhark_mc_segmap_task_128134_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128144_total_time = 0;
    ctx->program->futhark_mc_segred_task_128144_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128158_total_time = 0;
    ctx->program->futhark_mc_segred_task_128158_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128166_total_time = 0;
    ctx->program->futhark_mc_segred_task_128166_total_iter = 0;
    ctx->program->futhark_mc_copy_124082_task_128174_total_time = 0;
    ctx->program->futhark_mc_copy_124082_task_128174_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128184_total_time = 0;
    ctx->program->futhark_mc_segred_task_128184_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128196_total_time = 0;
    ctx->program->futhark_mc_segred_task_128196_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128207_total_time = 0;
    ctx->program->futhark_mc_segred_task_128207_total_iter = 0;
    ctx->program->futhark_mc_segmap_task_128215_total_time = 0;
    ctx->program->futhark_mc_segmap_task_128215_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128222_total_time = 0;
    ctx->program->futhark_mc_segred_task_128222_total_iter = 0;
    ctx->program->futhark_mc_segmap_task_128230_total_time = 0;
    ctx->program->futhark_mc_segmap_task_128230_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128237_total_time = 0;
    ctx->program->futhark_mc_segred_task_128237_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128245_total_time = 0;
    ctx->program->futhark_mc_segred_task_128245_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128253_total_time = 0;
    ctx->program->futhark_mc_segred_task_128253_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128265_total_time = 0;
    ctx->program->futhark_mc_segred_task_128265_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128276_total_time = 0;
    ctx->program->futhark_mc_segred_task_128276_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128288_total_time = 0;
    ctx->program->futhark_mc_segred_task_128288_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128299_total_time = 0;
    ctx->program->futhark_mc_segred_task_128299_total_iter = 0;
    ctx->program->futhark_mc_segmap_task_128307_total_time = 0;
    ctx->program->futhark_mc_segmap_task_128307_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128314_total_time = 0;
    ctx->program->futhark_mc_segred_task_128314_total_iter = 0;
    ctx->program->futhark_mc_segmap_task_128322_total_time = 0;
    ctx->program->futhark_mc_segmap_task_128322_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128329_total_time = 0;
    ctx->program->futhark_mc_segred_task_128329_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128337_total_time = 0;
    ctx->program->futhark_mc_segred_task_128337_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128345_total_time = 0;
    ctx->program->futhark_mc_segred_task_128345_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128353_total_time = 0;
    ctx->program->futhark_mc_segred_task_128353_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128365_total_time = 0;
    ctx->program->futhark_mc_segred_task_128365_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128376_total_time = 0;
    ctx->program->futhark_mc_segred_task_128376_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128388_total_time = 0;
    ctx->program->futhark_mc_segred_task_128388_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128399_total_time = 0;
    ctx->program->futhark_mc_segred_task_128399_total_iter = 0;
    ctx->program->futhark_mc_segmap_task_128407_total_time = 0;
    ctx->program->futhark_mc_segmap_task_128407_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128414_total_time = 0;
    ctx->program->futhark_mc_segred_task_128414_total_iter = 0;
    ctx->program->futhark_mc_segmap_task_128422_total_time = 0;
    ctx->program->futhark_mc_segmap_task_128422_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128429_total_time = 0;
    ctx->program->futhark_mc_segred_task_128429_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128437_total_time = 0;
    ctx->program->futhark_mc_segred_task_128437_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128445_total_time = 0;
    ctx->program->futhark_mc_segred_task_128445_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128457_total_time = 0;
    ctx->program->futhark_mc_segred_task_128457_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128468_total_time = 0;
    ctx->program->futhark_mc_segred_task_128468_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128480_total_time = 0;
    ctx->program->futhark_mc_segred_task_128480_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128491_total_time = 0;
    ctx->program->futhark_mc_segred_task_128491_total_iter = 0;
    ctx->program->futhark_mc_segmap_task_128499_total_time = 0;
    ctx->program->futhark_mc_segmap_task_128499_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128506_total_time = 0;
    ctx->program->futhark_mc_segred_task_128506_total_iter = 0;
    ctx->program->futhark_mc_segmap_task_128514_total_time = 0;
    ctx->program->futhark_mc_segmap_task_128514_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128521_total_time = 0;
    ctx->program->futhark_mc_segred_task_128521_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128529_total_time = 0;
    ctx->program->futhark_mc_segred_task_128529_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128537_total_time = 0;
    ctx->program->futhark_mc_segred_task_128537_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128551_total_time = 0;
    ctx->program->futhark_mc_segred_task_128551_total_iter = 0;
    ctx->program->futhark_mc_copy_124989_task_128559_total_time = 0;
    ctx->program->futhark_mc_copy_124989_task_128559_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128569_total_time = 0;
    ctx->program->futhark_mc_segred_task_128569_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128585_total_time = 0;
    ctx->program->futhark_mc_segred_task_128585_total_iter = 0;
    ctx->program->futhark_mc_segmap_task_128598_total_time = 0;
    ctx->program->futhark_mc_segmap_task_128598_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128605_total_time = 0;
    ctx->program->futhark_mc_segred_task_128605_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128623_total_time = 0;
    ctx->program->futhark_mc_segred_task_128623_total_iter = 0;
    ctx->program->futhark_mc_segmap_task_128638_total_time = 0;
    ctx->program->futhark_mc_segmap_task_128638_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128648_total_time = 0;
    ctx->program->futhark_mc_segred_task_128648_total_iter = 0;
    ctx->program->futhark_mc_copy_125336_task_128659_total_time = 0;
    ctx->program->futhark_mc_copy_125336_task_128659_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128666_total_time = 0;
    ctx->program->futhark_mc_segred_task_128666_total_iter = 0;
    ctx->program->futhark_mc_segmap_task_128692_total_time = 0;
    ctx->program->futhark_mc_segmap_task_128692_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128702_total_time = 0;
    ctx->program->futhark_mc_segred_task_128702_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128713_total_time = 0;
    ctx->program->futhark_mc_segred_task_128713_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128721_total_time = 0;
    ctx->program->futhark_mc_segred_task_128721_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128739_total_time = 0;
    ctx->program->futhark_mc_segred_task_128739_total_iter = 0;
    ctx->program->futhark_mc_copy_125628_task_128750_total_time = 0;
    ctx->program->futhark_mc_copy_125628_task_128750_total_iter = 0;
    ctx->program->futhark_mc_copy_125638_task_128757_total_time = 0;
    ctx->program->futhark_mc_copy_125638_task_128757_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128767_total_time = 0;
    ctx->program->futhark_mc_segred_task_128767_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128779_total_time = 0;
    ctx->program->futhark_mc_segred_task_128779_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128791_total_time = 0;
    ctx->program->futhark_mc_segred_task_128791_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128807_total_time = 0;
    ctx->program->futhark_mc_segred_task_128807_total_iter = 0;
    ctx->program->futhark_mc_segmap_task_128815_total_time = 0;
    ctx->program->futhark_mc_segmap_task_128815_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128825_total_time = 0;
    ctx->program->futhark_mc_segred_task_128825_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128836_total_time = 0;
    ctx->program->futhark_mc_segred_task_128836_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128848_total_time = 0;
    ctx->program->futhark_mc_segred_task_128848_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128862_total_time = 0;
    ctx->program->futhark_mc_segred_task_128862_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128874_total_time = 0;
    ctx->program->futhark_mc_segred_task_128874_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128885_total_time = 0;
    ctx->program->futhark_mc_segred_task_128885_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128905_total_time = 0;
    ctx->program->futhark_mc_segred_task_128905_total_iter = 0;
    ctx->program->futhark_mc_copy_126065_task_128915_total_time = 0;
    ctx->program->futhark_mc_copy_126065_task_128915_total_iter = 0;
    ctx->program->futhark_mc_copy_126075_task_128922_total_time = 0;
    ctx->program->futhark_mc_copy_126075_task_128922_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128932_total_time = 0;
    ctx->program->futhark_mc_segred_task_128932_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128944_total_time = 0;
    ctx->program->futhark_mc_segred_task_128944_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128956_total_time = 0;
    ctx->program->futhark_mc_segred_task_128956_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128972_total_time = 0;
    ctx->program->futhark_mc_segred_task_128972_total_iter = 0;
    ctx->program->futhark_mc_segmap_task_128980_total_time = 0;
    ctx->program->futhark_mc_segmap_task_128980_total_iter = 0;
    ctx->program->futhark_mc_segred_task_128990_total_time = 0;
    ctx->program->futhark_mc_segred_task_128990_total_iter = 0;
    ctx->program->futhark_mc_segred_task_129001_total_time = 0;
    ctx->program->futhark_mc_segred_task_129001_total_iter = 0;
    ctx->program->futhark_mc_segred_task_129013_total_time = 0;
    ctx->program->futhark_mc_segred_task_129013_total_iter = 0;
    ctx->program->futhark_mc_segred_task_129027_total_time = 0;
    ctx->program->futhark_mc_segred_task_129027_total_iter = 0;
    ctx->program->futhark_mc_segred_task_129039_total_time = 0;
    ctx->program->futhark_mc_segred_task_129039_total_iter = 0;
    ctx->program->futhark_mc_segmap_task_129050_total_time = 0;
    ctx->program->futhark_mc_segmap_task_129050_total_iter = 0;
    ctx->program->futhark_mc_segmap_task_129060_total_time = 0;
    ctx->program->futhark_mc_segmap_task_129060_total_iter = 0;
    ctx->program->futhark_mc_segred_task_129070_total_time = 0;
    ctx->program->futhark_mc_segred_task_129070_total_iter = 0;
    ctx->program->futhark_mc_segred_task_129082_total_time = 0;
    ctx->program->futhark_mc_segred_task_129082_total_iter = 0;
    ctx->program->futhark_mc_segred_task_129093_total_time = 0;
    ctx->program->futhark_mc_segred_task_129093_total_iter = 0;
    ctx->program->futhark_mc_segred_task_129105_total_time = 0;
    ctx->program->futhark_mc_segred_task_129105_total_iter = 0;
    ctx->program->futhark_mc_segred_task_129116_total_time = 0;
    ctx->program->futhark_mc_segred_task_129116_total_iter = 0;
    ctx->program->futhark_mc_segmap_task_129138_total_time = 0;
    ctx->program->futhark_mc_segmap_task_129138_total_iter = 0;
    ctx->program->futhark_mc_segred_task_129148_total_time = 0;
    ctx->program->futhark_mc_segred_task_129148_total_iter = 0;
    ctx->program->futhark_mc_segred_task_129159_total_time = 0;
    ctx->program->futhark_mc_segred_task_129159_total_iter = 0;
    ctx->program->futhark_mc_segred_task_129185_total_time = 0;
    ctx->program->futhark_mc_segred_task_129185_total_iter = 0;
    ctx->program->futhark_mc_segmap_task_129199_total_time = 0;
    ctx->program->futhark_mc_segmap_task_129199_total_iter = 0;
    ctx->program->futhark_mc_segred_task_129209_total_time = 0;
    ctx->program->futhark_mc_segred_task_129209_total_iter = 0;
    ctx->program->futhark_mc_segred_task_129222_total_time = 0;
    ctx->program->futhark_mc_segred_task_129222_total_iter = 0;
    ctx->program->futhark_mc_segred_task_129234_total_time = 0;
    ctx->program->futhark_mc_segred_task_129234_total_iter = 0;
    ctx->program->futhark_mc_segred_task_129245_total_time = 0;
    ctx->program->futhark_mc_segred_task_129245_total_iter = 0;
    ctx->program->futhark_mc_segred_task_129257_total_time = 0;
    ctx->program->futhark_mc_segred_task_129257_total_iter = 0;
    ctx->program->futhark_mc_segred_task_129268_total_time = 0;
    ctx->program->futhark_mc_segred_task_129268_total_iter = 0;
    ctx->program->futhark_mc_segred_task_129282_total_time = 0;
    ctx->program->futhark_mc_segred_task_129282_total_iter = 0;
    ctx->program->futhark_mc_segred_task_129294_total_time = 0;
    ctx->program->futhark_mc_segred_task_129294_total_iter = 0;
    ctx->program->futhark_mc_segred_task_129308_total_time = 0;
    ctx->program->futhark_mc_segred_task_129308_total_iter = 0;
}
static void teardown_program(struct futhark_context *ctx)
{
    (void) ctx;
    
    int error = 0;
    
    (void) error;
    free(ctx->program);
}
static void set_tuning_params(struct futhark_context *ctx)
{
    (void) ctx;
}
int memblock_unref(struct futhark_context *ctx, struct memblock *block, const char *desc)
{
    if (block->references != NULL) {
        *block->references -= 1;
        if (ctx->detail_memory)
            fprintf(ctx->log, "Unreferencing block %s (allocated as %s) in %s: %d references remaining.\n", desc, block->desc, "default space", *block->references);
        if (*block->references == 0) {
            ctx->cur_mem_usage_default -= block->size;
            host_free(ctx, (size_t) block->size, desc, (void *) block->mem);
            free(block->references);
            if (ctx->detail_memory)
                fprintf(ctx->log, "%lld bytes freed (now allocated: %lld bytes)\n", (long long) block->size, (long long) ctx->cur_mem_usage_default);
        }
        block->references = NULL;
    }
    return 0;
}
int memblock_alloc(struct futhark_context *ctx, struct memblock *block, int64_t size, const char *desc)
{
    if (size < 0)
        futhark_panic(1, "Negative allocation of %lld bytes attempted for %s in %s.\n", (long long) size, desc, "default space", ctx->cur_mem_usage_default);
    
    int ret = memblock_unref(ctx, block, desc);
    
    if (ret != FUTHARK_SUCCESS)
        return ret;
    if (ctx->detail_memory)
        fprintf(ctx->log, "Allocating %lld bytes for %s in %s (currently allocated: %lld bytes).\n", (long long) size, desc, "default space", (long long) ctx->cur_mem_usage_default);
    host_alloc(ctx, (size_t) size, desc, (size_t *) &size, (void *) &block->mem);
    if (ctx->error == NULL) {
        block->references = (int *) malloc(sizeof(int));
        *block->references = 1;
        block->size = size;
        block->desc = desc;
        
        long long new_usage = ctx->cur_mem_usage_default + size;
        
        if (ctx->detail_memory)
            fprintf(ctx->log, "Received block of %lld bytes; now allocated: %lld bytes", (long long) block->size, new_usage);
        ctx->cur_mem_usage_default = new_usage;
        if (new_usage > ctx->peak_mem_usage_default) {
            ctx->peak_mem_usage_default = new_usage;
            if (ctx->detail_memory)
                fprintf(ctx->log, " (new peak).\n");
        } else if (ctx->detail_memory)
            fprintf(ctx->log, ".\n");
        return FUTHARK_SUCCESS;
    } else {
        // We are naively assuming that any memory allocation error is due to OOM.
        lock_lock(&ctx->error_lock);
        
        char *old_error = ctx->error;
        
        ctx->error = msgprintf("Failed to allocate memory in %s.\nAttempted allocation: %12lld bytes\nCurrently allocated:  %12lld bytes\n%s", "default space", (long long) size, (long long) ctx->cur_mem_usage_default, old_error);
        free(old_error);
        lock_unlock(&ctx->error_lock);
        return FUTHARK_OUT_OF_MEMORY;
    }
}
int memblock_set(struct futhark_context *ctx, struct memblock *lhs, struct memblock *rhs, const char *lhs_desc)
{
    int ret = memblock_unref(ctx, lhs, lhs_desc);
    
    if (rhs->references != NULL)
        (*rhs->references)++;
    *lhs = *rhs;
    return ret;
}
char *futhark_context_report(struct futhark_context *ctx)
{
    if (futhark_context_sync(ctx) != 0)
        return NULL;
    
    struct str_builder builder;
    
    str_builder_init(&builder);
    str_builder_char(&builder, '{');
    str_builder_str(&builder, "\"memory\":{");
    str_builder(&builder, "\"default space\": %lld", (long long) ctx->peak_mem_usage_default);
    str_builder_str(&builder, "},\"events\":[");
    if (report_events_in_list(&ctx->event_list, &builder) != 0) {
        free(builder.str);
        return NULL;
    } else {
        str_builder_str(&builder, "]}");
        return builder.str;
    }
}
int futhark_context_clear_caches(struct futhark_context *ctx)
{
    lock_lock(&ctx->lock);
    worker_local = &ctx->scheduler.workers[0];
    ctx->peak_mem_usage_default = 0;
    lock_unlock(&ctx->lock);
    return ctx->error != NULL;
}

// Start of context.h

// Internal functions.

static void set_error(struct futhark_context* ctx, char *error) {
  lock_lock(&ctx->error_lock);
  if (ctx->error == NULL) {
    ctx->error = error;
  } else {
    free(error);
  }
  lock_unlock(&ctx->error_lock);
}

// XXX: should be static, but used in ispc_util.h
void lexical_realloc_error(struct futhark_context* ctx, size_t new_size) {
  set_error(ctx,
            msgprintf("Failed to allocate memory.\nAttempted allocation: %12lld bytes\n",
                      (long long) new_size));
}

static int lexical_realloc(struct futhark_context *ctx,
                           unsigned char **ptr,
                           int64_t *old_size,
                           int64_t new_size) {
  unsigned char *new = realloc(*ptr, (size_t)new_size);
  if (new == NULL) {
    lexical_realloc_error(ctx, new_size);
    return FUTHARK_OUT_OF_MEMORY;
  } else {
    *ptr = new;
    *old_size = new_size;
    return FUTHARK_SUCCESS;
  }
}

static void free_all_in_free_list(struct futhark_context* ctx) {
  fl_mem mem;
  free_list_pack(&ctx->free_list);
  while (free_list_first(&ctx->free_list, (fl_mem*)&mem) == 0) {
    free((void*)mem);
  }
}

static int is_small_alloc(size_t size) {
  return size < 1024*1024;
}

static void host_alloc(struct futhark_context* ctx,
                       size_t size, const char* tag, size_t* size_out, void** mem_out) {
  if (is_small_alloc(size) || free_list_find(&ctx->free_list, size, tag, size_out, (fl_mem*)mem_out) != 0) {
    *size_out = size;
    *mem_out = malloc(size);
  }
}

static void host_free(struct futhark_context* ctx,
                      size_t size, const char* tag, void* mem) {
  // Small allocations are handled by malloc()s own free list.  The
  // threshold here is kind of arbitrary, but seems to work OK.
  // Larger allocations are mmap()ed/munmapped() every time, which is
  // very slow, and Futhark programs tend to use a few very large
  // allocations.
  if (is_small_alloc(size)) {
    free(mem);
  } else {
    free_list_insert(&ctx->free_list, size, (fl_mem)mem, tag);
  }
}

static void add_event(struct futhark_context* ctx,
                      const char* name,
                      char* description,
                      void* data,
                      event_report_fn f) {
  if (ctx->logging) {
    fprintf(ctx->log, "Event: %s\n%s\n", name, description);
  }
  add_event_to_list(&ctx->event_list, name, description, data, f);
}

char *futhark_context_get_error(struct futhark_context *ctx) {
  char *error = ctx->error;
  ctx->error = NULL;
  return error;
}

void futhark_context_config_set_debugging(struct futhark_context_config *cfg, int flag) {
    cfg->profiling = cfg->logging = cfg->debugging = flag;
}

void futhark_context_config_set_profiling(struct futhark_context_config *cfg, int flag) {
    cfg->profiling = flag;
}

void futhark_context_config_set_logging(struct futhark_context_config *cfg, int flag) {
    cfg->logging = flag;
}

void futhark_context_config_set_cache_file(struct futhark_context_config *cfg, const char *f) {
  cfg->cache_fname = strdup(f);
}

int futhark_get_tuning_param_count(void) {
  return num_tuning_params;
}

const char *futhark_get_tuning_param_name(int i) {
  return tuning_param_names[i];
}

const char *futhark_get_tuning_param_class(int i) {
    return tuning_param_classes[i];
}

void futhark_context_set_logging_file(struct futhark_context *ctx, FILE *f){
  ctx->log = f;
}

void futhark_context_pause_profiling(struct futhark_context *ctx) {
  ctx->profiling_paused = 1;
}

void futhark_context_unpause_profiling(struct futhark_context *ctx) {
  ctx->profiling_paused = 0;
}

struct futhark_context_config* futhark_context_config_new(void) {
  struct futhark_context_config* cfg = malloc(sizeof(struct futhark_context_config));
  if (cfg == NULL) {
    return NULL;
  }
  cfg->in_use = 0;
  cfg->debugging = 0;
  cfg->profiling = 0;
  cfg->logging = 0;
  cfg->cache_fname = NULL;
  cfg->num_tuning_params = num_tuning_params;
  cfg->tuning_params = malloc(cfg->num_tuning_params * sizeof(int64_t));
  memcpy(cfg->tuning_params, tuning_param_defaults,
         cfg->num_tuning_params * sizeof(int64_t));
  cfg->tuning_param_names = tuning_param_names;
  cfg->tuning_param_vars = tuning_param_vars;
  cfg->tuning_param_classes = tuning_param_classes;
  backend_context_config_setup(cfg);
  return cfg;
}

void futhark_context_config_free(struct futhark_context_config* cfg) {
  assert(!cfg->in_use);
  backend_context_config_teardown(cfg);
  free(cfg->cache_fname);
  free(cfg->tuning_params);
  free(cfg);
}

struct futhark_context* futhark_context_new(struct futhark_context_config* cfg) {
  struct futhark_context* ctx = malloc(sizeof(struct futhark_context));
  if (ctx == NULL) {
    return NULL;
  }
  assert(!cfg->in_use);
  ctx->cfg = cfg;
  ctx->cfg->in_use = 1;
  ctx->program_initialised = false;
  create_lock(&ctx->error_lock);
  create_lock(&ctx->lock);
  free_list_init(&ctx->free_list);
  event_list_init(&ctx->event_list);
  ctx->peak_mem_usage_default = 0;
  ctx->cur_mem_usage_default = 0;
  ctx->constants = malloc(sizeof(struct constants));
  ctx->debugging = cfg->debugging;
  ctx->logging = cfg->logging;
  ctx->detail_memory = cfg->logging;
  ctx->profiling = cfg->profiling;
  ctx->profiling_paused = 0;
  ctx->error = NULL;
  ctx->log = stderr;
  set_tuning_params(ctx);
  if (backend_context_setup(ctx) == 0) {
    setup_program(ctx);
    init_constants(ctx);
    ctx->program_initialised = true;
    (void)futhark_context_clear_caches(ctx);
    (void)futhark_context_sync(ctx);
  }
  return ctx;
}

void futhark_context_free(struct futhark_context* ctx) {
  if (ctx->program_initialised) {
    free_constants(ctx);
    teardown_program(ctx);
  }
  backend_context_teardown(ctx);
  free_all_in_free_list(ctx);
  free_list_destroy(&ctx->free_list);
  event_list_free(&ctx->event_list);
  free(ctx->constants);
  free(ctx->error);
  free_lock(&ctx->lock);
  free_lock(&ctx->error_lock);
  ctx->cfg->in_use = 0;
  free(ctx);
}

// End of context.h

// Start of copy.h

// Cache-oblivious map-transpose function.
#define GEN_MAP_TRANSPOSE(NAME, ELEM_TYPE)                              \
  static void map_transpose_##NAME                                      \
  (ELEM_TYPE* dst, ELEM_TYPE* src,                                      \
   int64_t k, int64_t m, int64_t n,                                     \
   int64_t cb, int64_t ce, int64_t rb, int64_t re)                      \
  {                                                                     \
  int32_t r = re - rb;                                                  \
  int32_t c = ce - cb;                                                  \
  if (k == 1) {                                                         \
    if (r <= 64 && c <= 64) {                                           \
      for (int64_t j = 0; j < c; j++) {                                 \
        for (int64_t i = 0; i < r; i++) {                               \
          dst[(j + cb) * n + (i + rb)] = src[(i + rb) * m + (j + cb)];  \
        }                                                               \
      }                                                                 \
    } else if (c <= r) {                                                \
      map_transpose_##NAME(dst, src, k, m, n, cb, ce, rb, rb + r/2);    \
      map_transpose_##NAME(dst, src, k, m, n, cb, ce, rb + r/2, re);    \
    } else {                                                            \
      map_transpose_##NAME(dst, src, k, m, n, cb, cb + c/2, rb, re);    \
      map_transpose_##NAME(dst, src, k, m, n, cb + c/2, ce, rb, re);    \
    }                                                                   \
  } else {                                                              \
  for (int64_t i = 0; i < k; i++) {                                     \
    map_transpose_##NAME(dst + i * m * n, src + i * m * n, 1, m, n, cb, ce, rb, re); \
  }\
} \
}

// Straightforward LMAD copy function.
#define GEN_LMAD_COPY_ELEMENTS(NAME, ELEM_TYPE)                         \
  static void lmad_copy_elements_##NAME(int r,                          \
                                        ELEM_TYPE* dst, int64_t dst_strides[r], \
                                        ELEM_TYPE *src, int64_t src_strides[r], \
                                        int64_t shape[r]) {             \
    if (r == 1) {                                                       \
      for (int i = 0; i < shape[0]; i++) {                              \
        dst[i*dst_strides[0]] = src[i*src_strides[0]];                  \
      }                                                                 \
    } else if (r > 1) {                                                 \
      for (int i = 0; i < shape[0]; i++) {                              \
        lmad_copy_elements_##NAME(r-1,                                  \
                                  dst+i*dst_strides[0], dst_strides+1,  \
                                  src+i*src_strides[0], src_strides+1,  \
                                  shape+1);                             \
      }                                                                 \
    }                                                                   \
  }                                                                     \

// Check whether this LMAD can be seen as a transposed 2D array.  This
// is done by checking every possible splitting point.
static bool lmad_is_tr(int64_t *n_out, int64_t *m_out,
                       int r,
                       const int64_t strides[r],
                       const int64_t shape[r]) {
  for (int i = 1; i < r; i++) {
    int n = 1, m = 1;
    bool ok = true;
    int64_t expected = 1;
    // Check strides before 'i'.
    for (int j = i-1; j >= 0; j--) {
      ok = ok && strides[j] == expected;
      expected *= shape[j];
      n *= shape[j];
    }
    // Check strides after 'i'.
    for (int j = r-1; j >= i; j--) {
      ok = ok && strides[j] == expected;
      expected *= shape[j];
      m *= shape[j];
    }
    if (ok) {
      *n_out = n;
      *m_out = m;
      return true;
    }
  }
  return false;
}

// This function determines whether the a 'dst' LMAD is row-major and
// 'src' LMAD is column-major.  Both LMADs are for arrays of the same
// shape.  Both LMADs are allowed to have additional dimensions "on
// top".  Essentially, this function determines whether a copy from
// 'src' to 'dst' is a "map(transpose)" that we know how to implement
// efficiently.  The LMADs can have arbitrary rank, and the main
// challenge here is checking whether the src LMAD actually
// corresponds to a 2D column-major layout by morally collapsing
// dimensions.  There is a lot of looping here, but the actual trip
// count is going to be very low in practice.
//
// Returns true if this is indeed a map(transpose), and writes the
// number of arrays, and moral array size to appropriate output
// parameters.
static bool lmad_map_tr(int64_t *num_arrays_out, int64_t *n_out, int64_t *m_out,
                        int r,
                        const int64_t dst_strides[r],
                        const int64_t src_strides[r],
                        const int64_t shape[r]) {
  int64_t rowmajor_strides[r];
  rowmajor_strides[r-1] = 1;

  for (int i = r-2; i >= 0; i--) {
    rowmajor_strides[i] = rowmajor_strides[i+1] * shape[i+1];
  }

  // map_r will be the number of mapped dimensions on top.
  int map_r = 0;
  int64_t num_arrays = 1;
  for (int i = 0; i < r; i++) {
    if (dst_strides[i] != rowmajor_strides[i] ||
        src_strides[i] != rowmajor_strides[i]) {
      break;
    } else {
      num_arrays *= shape[i];
      map_r++;
    }
  }

  *num_arrays_out = num_arrays;

  if (r==map_r) {
    return false;
  }

  if (memcmp(&rowmajor_strides[map_r],
             &dst_strides[map_r],
             sizeof(int64_t)*(r-map_r)) == 0) {
    return lmad_is_tr(n_out, m_out, r-map_r, src_strides+map_r, shape+map_r);
  } else if (memcmp(&rowmajor_strides[map_r],
                    &src_strides[map_r],
                    sizeof(int64_t)*(r-map_r)) == 0) {
    return lmad_is_tr(m_out, n_out, r-map_r, dst_strides+map_r, shape+map_r);
  }
  return false;
}

// Check if the strides correspond to row-major strides of *any*
// permutation of the shape.  This is done by recursive search with
// backtracking.  This is worst-case exponential, but hopefully the
// arrays we encounter do not have that many dimensions.
static bool lmad_contiguous_search(int checked, int64_t expected,
                                   int r,
                                   int64_t strides[r], int64_t shape[r], bool used[r]) {
  for (int i = 0; i < r; i++) {
    for (int j = 0; j < r; j++) {
      if (!used[j] && strides[j] == expected && strides[j] >= 0) {
        used[j] = true;
        if (checked+1 == r ||
            lmad_contiguous_search(checked+1, expected * shape[j], r, strides, shape, used)) {
          return true;
        }
        used[j] = false;
      }
    }
  }
  return false;
}

// Does this LMAD correspond to an array with positive strides and no
// holes?
static bool lmad_contiguous(int r, int64_t strides[r], int64_t shape[r]) {
  bool used[r];
  for (int i = 0; i < r; i++) {
    used[i] = false;
  }
  return lmad_contiguous_search(0, 1, r, strides, shape, used);
}

// Does this copy correspond to something that could be done with a
// memcpy()-like operation?  I.e. do the LMADs actually represent the
// same in-memory layout and are they contiguous?
static bool lmad_memcpyable(int r,
                            int64_t dst_strides[r], int64_t src_strides[r], int64_t shape[r]) {
  if (!lmad_contiguous(r, dst_strides, shape)) {
    return false;
  }
  for (int i = 0; i < r; i++) {
    if (dst_strides[i] != src_strides[i] && shape[i] != 1) {
      return false;
    }
  }
  return true;
}


static void log_copy(struct futhark_context* ctx,
                     const char *kind, int r,
                     int64_t dst_offset, int64_t dst_strides[r],
                     int64_t src_offset, int64_t src_strides[r],
                     int64_t shape[r]) {
  if (ctx->logging) {
    fprintf(ctx->log, "\n# Copy %s\n", kind);
    fprintf(ctx->log, "Shape: ");
    for (int i = 0; i < r; i++) { fprintf(ctx->log, "[%ld]", (long int)shape[i]); }
    fprintf(ctx->log, "\n");
    fprintf(ctx->log, "Dst offset: %ld\n", (long int)dst_offset);
    fprintf(ctx->log, "Dst strides:");
    for (int i = 0; i < r; i++) { fprintf(ctx->log, " %ld", (long int)dst_strides[i]); }
    fprintf(ctx->log, "\n");
    fprintf(ctx->log, "Src offset: %ld\n", (long int)src_offset);
    fprintf(ctx->log, "Src strides:");
    for (int i = 0; i < r; i++) { fprintf(ctx->log, " %ld", (long int)src_strides[i]); }
    fprintf(ctx->log, "\n");
  }
}

static void log_transpose(struct futhark_context* ctx,
                          int64_t k, int64_t n, int64_t m) {
  if (ctx->logging) {
    fprintf(ctx->log, "## Transpose\n");
    fprintf(ctx->log, "Arrays     : %ld\n", (long int)k);
    fprintf(ctx->log, "X elements : %ld\n", (long int)m);
    fprintf(ctx->log, "Y elements : %ld\n", (long int)n);
    fprintf(ctx->log, "\n");
  }
}

#define GEN_LMAD_COPY(NAME, ELEM_TYPE)                                  \
  static void lmad_copy_##NAME                                          \
  (struct futhark_context *ctx, int r,                                  \
   ELEM_TYPE* dst, int64_t dst_offset, int64_t dst_strides[r],          \
   ELEM_TYPE *src, int64_t src_offset, int64_t src_strides[r],          \
   int64_t shape[r]) {                                                  \
    log_copy(ctx, "CPU to CPU", r, dst_offset, dst_strides,             \
             src_offset, src_strides, shape);                           \
    int64_t size = 1;                                                   \
    for (int i = 0; i < r; i++) { size *= shape[i]; }                   \
    if (size == 0) { return; }                                          \
    int64_t k, n, m;                                                    \
    if (lmad_map_tr(&k, &n, &m,                                         \
                    r, dst_strides, src_strides, shape)) {              \
      log_transpose(ctx, k, n, m);                                      \
      map_transpose_##NAME                                              \
        (dst+dst_offset, src+src_offset, k, n, m, 0, n, 0, m);          \
    } else if (lmad_memcpyable(r, dst_strides, src_strides, shape)) {   \
      if (ctx->logging) {fprintf(ctx->log, "## Flat copy\n\n");}          \
      memcpy(dst+dst_offset, src+src_offset, size*sizeof(*dst));        \
    } else {                                                            \
      if (ctx->logging) {fprintf(ctx->log, "## General copy\n\n");}       \
      lmad_copy_elements_##NAME                                         \
        (r,                                                             \
         dst+dst_offset, dst_strides,                                   \
         src+src_offset, src_strides, shape);                           \
    }                                                                   \
  }

GEN_MAP_TRANSPOSE(1b, uint8_t)
GEN_MAP_TRANSPOSE(2b, uint16_t)
GEN_MAP_TRANSPOSE(4b, uint32_t)
GEN_MAP_TRANSPOSE(8b, uint64_t)

GEN_LMAD_COPY_ELEMENTS(1b, uint8_t)
GEN_LMAD_COPY_ELEMENTS(2b, uint16_t)
GEN_LMAD_COPY_ELEMENTS(4b, uint32_t)
GEN_LMAD_COPY_ELEMENTS(8b, uint64_t)

GEN_LMAD_COPY(1b, uint8_t)
GEN_LMAD_COPY(2b, uint16_t)
GEN_LMAD_COPY(4b, uint32_t)
GEN_LMAD_COPY(8b, uint64_t)

// End of copy.h

#define FUTHARK_FUN_ATTR static

FUTHARK_FUN_ATTR int futrts_entry_ugw_armijo(struct futhark_context *ctx, struct memblock *mem_out_p_127224, struct memblock A_mem_111707, struct memblock mu_mem_111708, struct memblock B_mem_111709, struct memblock nu_mem_111710, int64_t mz2081Uz2084U_33563, double rho1_33564, double rho2_33565, double eps_33566, double exp_absorb_cutoff_33571, double safe_for_exp_33572, double tol_sinkhorn_33573, double tol_outerloop_33574);
FUTHARK_FUN_ATTR int futrts_entry_ugw_armijo_euclidean(struct futhark_context *ctx, struct memblock *mem_out_p_127253, int64_t *out_prim_out_127254, struct memblock pt_clouds_mem_111707, int64_t k_34109, int64_t m_34110, int64_t d_34111, double rho1_34112, double rho2_34113, double eps_34114, double exp_absorb_cutoff_34116, double safe_for_exp_34117, double tol_sinkhorn_34118, double tol_outerloop_34119);
FUTHARK_FUN_ATTR int futrts_entry_ugw_armijo_pairwise(struct futhark_context *ctx, struct memblock *mem_out_p_127303, int64_t *out_prim_out_127304, struct memblock A_mem_111707, struct memblock distrs_mem_111708, int64_t k_33497, int64_t m_33498, double rho1_33499, double rho2_33500, double eps_33501, double exp_absorb_cutoff_33504, double safe_for_exp_33505, double tol_sinkhorn_33506, double tol_outerloop_33507);
FUTHARK_FUN_ATTR int futrts_entry_ugw_armijo_pairwise_unif(struct futhark_context *ctx, struct memblock *mem_out_p_127305, int64_t *out_prim_out_127306, struct memblock A_mem_111707, int64_t k_33767, int64_t m_33768, double rho1_33769, double rho2_33770, double eps_33771, double exp_absorb_cutoff_33773, double safe_for_exp_33774, double tol_sinkhorn_33775, double tol_outerloop_33776);
FUTHARK_FUN_ATTR int futrts_ugw_armijo_pairwise_13790(struct futhark_context *ctx, struct memblock *mem_out_p_127307, int64_t *out_prim_out_127308, struct memblock A_mem_111707, struct memblock distrs_mem_111708, int64_t k_33387, int64_t m_33388, double rho1_33389, double rho2_33390, double eps_33391, double exp_absorb_cutoff_33394, double safe_for_exp_33395, double tol_sinkhorn_33396, double tol_outerloop_33397);

static int init_constants(struct futhark_context *ctx)
{
    (void) ctx;
    
    int err = 0;
    
    
  cleanup:
    return err;
}
static int free_constants(struct futhark_context *ctx)
{
    (void) ctx;
    return 0;
}
struct futhark_mc_task_127225 {
    struct futhark_context *ctx;
    int64_t free_mz2081Uz2084U_33563;
    unsigned char *free_mu_mem_111708;
    unsigned char *free_mem_111712;
};
struct futhark_mc_copy_parloop_struct_127227 {
    struct futhark_context *ctx;
    int64_t free_mz2081Uz2084U_33563;
    unsigned char *free_mu_mem_111708;
    unsigned char *free_mem_111712;
};
static int futhark_mc_copy_parloop_127228(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_copy_parloop_struct_127227 *futhark_mc_copy_parloop_struct_127227 = (struct futhark_mc_copy_parloop_struct_127227 *) args;
    struct futhark_context *ctx = futhark_mc_copy_parloop_struct_127227->ctx;
    struct mc_event *event_127229 = mc_event_new(ctx);
    
    if (event_127229 != NULL)
        event_127229->bef = get_wall_time();
    
    int64_t mz2081Uz2084U_33563 = futhark_mc_copy_parloop_struct_127227->free_mz2081Uz2084U_33563;
    struct memblock mu_mem_111708 = {.desc ="mu_mem_111708", .mem =futhark_mc_copy_parloop_struct_127227->free_mu_mem_111708, .size =0, .references =NULL};
    struct memblock mem_111712 = {.desc ="mem_111712", .mem =futhark_mc_copy_parloop_struct_127227->free_mem_111712, .size =0, .references =NULL};
    int64_t iterations = end - start;
    
    {
        int64_t start_114752;
        int64_t end_114753;
        
        start_114752 = start;
        end_114753 = end;
        
        int64_t n_114754 = end_114753 - start_114752;
        
        for (int64_t copy_i_114755 = start_114752; copy_i_114755 < start_114752 + n_114754; copy_i_114755++) {
            int64_t slice_114757 = mz2081Uz2084U_33563;
            int64_t i_114756 = copy_i_114755;
            int64_t remnant_114758 = copy_i_114755 - i_114756;
            double tmp_114759 = ((double *) mu_mem_111708.mem)[i_114756];
            
            ((double *) mem_111712.mem)[i_114756] = tmp_114759;
        }
    }
    
  cleanup:
    { }
    if (event_127229 != NULL) {
        event_127229->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_parloop_127228", strdup("nothing further"), event_127229, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_copy_114760_task_127226(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127225 *futhark_mc_task_127225 = (struct futhark_mc_task_127225 *) args;
    struct futhark_context *ctx = futhark_mc_task_127225->ctx;
    struct mc_event *event_127231 = mc_event_new(ctx);
    
    if (event_127231 != NULL)
        event_127231->bef = get_wall_time();
    
    int64_t mz2081Uz2084U_33563 = futhark_mc_task_127225->free_mz2081Uz2084U_33563;
    struct memblock mu_mem_111708 = {.desc ="mu_mem_111708", .mem =futhark_mc_task_127225->free_mu_mem_111708, .size =0, .references =NULL};
    struct memblock mem_111712 = {.desc ="mem_111712", .mem =futhark_mc_task_127225->free_mem_111712, .size =0, .references =NULL};
    struct futhark_mc_copy_parloop_struct_127227 futhark_mc_copy_parloop_struct_127227_;
    
    futhark_mc_copy_parloop_struct_127227_.ctx = ctx;
    futhark_mc_copy_parloop_struct_127227_.free_mz2081Uz2084U_33563 = mz2081Uz2084U_33563;
    futhark_mc_copy_parloop_struct_127227_.free_mu_mem_111708 = mu_mem_111708.mem;
    futhark_mc_copy_parloop_struct_127227_.free_mem_111712 = mem_111712.mem;
    
    struct scheduler_parloop futhark_mc_copy_parloop_127228_task;
    
    futhark_mc_copy_parloop_127228_task.name = "futhark_mc_copy_parloop_127228";
    futhark_mc_copy_parloop_127228_task.fn = futhark_mc_copy_parloop_127228;
    futhark_mc_copy_parloop_127228_task.args = &futhark_mc_copy_parloop_struct_127227_;
    futhark_mc_copy_parloop_127228_task.iterations = iterations;
    futhark_mc_copy_parloop_127228_task.info = info;
    
    struct mc_event *event_127230 = mc_event_new(ctx);
    
    if (event_127230 != NULL)
        event_127230->bef = get_wall_time();
    
    int futhark_mc_copy_parloop_127228_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_copy_parloop_127228_task);
    
    if (futhark_mc_copy_parloop_127228_err != 0) {
        err = futhark_mc_copy_parloop_127228_err;
        goto cleanup;
    }
    if (event_127230 != NULL) {
        event_127230->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_parloop_127228_total", strdup("nothing further"), event_127230, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_127231 != NULL) {
        event_127231->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_114760_task_127226", strdup("nothing further"), event_127231, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_127232 {
    struct futhark_context *ctx;
    int64_t free_mz2081Uz2084U_33563;
    unsigned char *free_nu_mem_111710;
    unsigned char *free_mem_111712;
};
struct futhark_mc_copy_parloop_struct_127234 {
    struct futhark_context *ctx;
    int64_t free_mz2081Uz2084U_33563;
    unsigned char *free_nu_mem_111710;
    unsigned char *free_mem_111712;
};
static int futhark_mc_copy_parloop_127235(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_copy_parloop_struct_127234 *futhark_mc_copy_parloop_struct_127234 = (struct futhark_mc_copy_parloop_struct_127234 *) args;
    struct futhark_context *ctx = futhark_mc_copy_parloop_struct_127234->ctx;
    struct mc_event *event_127236 = mc_event_new(ctx);
    
    if (event_127236 != NULL)
        event_127236->bef = get_wall_time();
    
    int64_t mz2081Uz2084U_33563 = futhark_mc_copy_parloop_struct_127234->free_mz2081Uz2084U_33563;
    struct memblock nu_mem_111710 = {.desc ="nu_mem_111710", .mem =futhark_mc_copy_parloop_struct_127234->free_nu_mem_111710, .size =0, .references =NULL};
    struct memblock mem_111712 = {.desc ="mem_111712", .mem =futhark_mc_copy_parloop_struct_127234->free_mem_111712, .size =0, .references =NULL};
    int64_t iterations = end - start;
    
    {
        int64_t start_114762;
        int64_t end_114763;
        
        start_114762 = start;
        end_114763 = end;
        
        int64_t n_114764 = end_114763 - start_114762;
        
        for (int64_t copy_i_114765 = start_114762; copy_i_114765 < start_114762 + n_114764; copy_i_114765++) {
            int64_t slice_114767 = mz2081Uz2084U_33563;
            int64_t i_114766 = copy_i_114765;
            int64_t remnant_114768 = copy_i_114765 - i_114766;
            double tmp_114769 = ((double *) nu_mem_111710.mem)[i_114766];
            
            ((double *) mem_111712.mem)[mz2081Uz2084U_33563 + i_114766] = tmp_114769;
        }
    }
    
  cleanup:
    { }
    if (event_127236 != NULL) {
        event_127236->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_parloop_127235", strdup("nothing further"), event_127236, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_copy_114770_task_127233(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127232 *futhark_mc_task_127232 = (struct futhark_mc_task_127232 *) args;
    struct futhark_context *ctx = futhark_mc_task_127232->ctx;
    struct mc_event *event_127238 = mc_event_new(ctx);
    
    if (event_127238 != NULL)
        event_127238->bef = get_wall_time();
    
    int64_t mz2081Uz2084U_33563 = futhark_mc_task_127232->free_mz2081Uz2084U_33563;
    struct memblock nu_mem_111710 = {.desc ="nu_mem_111710", .mem =futhark_mc_task_127232->free_nu_mem_111710, .size =0, .references =NULL};
    struct memblock mem_111712 = {.desc ="mem_111712", .mem =futhark_mc_task_127232->free_mem_111712, .size =0, .references =NULL};
    struct futhark_mc_copy_parloop_struct_127234 futhark_mc_copy_parloop_struct_127234_;
    
    futhark_mc_copy_parloop_struct_127234_.ctx = ctx;
    futhark_mc_copy_parloop_struct_127234_.free_mz2081Uz2084U_33563 = mz2081Uz2084U_33563;
    futhark_mc_copy_parloop_struct_127234_.free_nu_mem_111710 = nu_mem_111710.mem;
    futhark_mc_copy_parloop_struct_127234_.free_mem_111712 = mem_111712.mem;
    
    struct scheduler_parloop futhark_mc_copy_parloop_127235_task;
    
    futhark_mc_copy_parloop_127235_task.name = "futhark_mc_copy_parloop_127235";
    futhark_mc_copy_parloop_127235_task.fn = futhark_mc_copy_parloop_127235;
    futhark_mc_copy_parloop_127235_task.args = &futhark_mc_copy_parloop_struct_127234_;
    futhark_mc_copy_parloop_127235_task.iterations = iterations;
    futhark_mc_copy_parloop_127235_task.info = info;
    
    struct mc_event *event_127237 = mc_event_new(ctx);
    
    if (event_127237 != NULL)
        event_127237->bef = get_wall_time();
    
    int futhark_mc_copy_parloop_127235_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_copy_parloop_127235_task);
    
    if (futhark_mc_copy_parloop_127235_err != 0) {
        err = futhark_mc_copy_parloop_127235_err;
        goto cleanup;
    }
    if (event_127237 != NULL) {
        event_127237->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_parloop_127235_total", strdup("nothing further"), event_127237, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_127238 != NULL) {
        event_127238->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_114770_task_127233", strdup("nothing further"), event_127238, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_127239 {
    struct futhark_context *ctx;
    int64_t free_mz2081Uz2084U_33563;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_111715;
};
struct futhark_mc_copy_parloop_struct_127241 {
    struct futhark_context *ctx;
    int64_t free_mz2081Uz2084U_33563;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_111715;
};
static int futhark_mc_copy_parloop_127242(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_copy_parloop_struct_127241 *futhark_mc_copy_parloop_struct_127241 = (struct futhark_mc_copy_parloop_struct_127241 *) args;
    struct futhark_context *ctx = futhark_mc_copy_parloop_struct_127241->ctx;
    struct mc_event *event_127243 = mc_event_new(ctx);
    
    if (event_127243 != NULL)
        event_127243->bef = get_wall_time();
    
    int64_t mz2081Uz2084U_33563 = futhark_mc_copy_parloop_struct_127241->free_mz2081Uz2084U_33563;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_copy_parloop_struct_127241->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_111715 = {.desc ="mem_111715", .mem =futhark_mc_copy_parloop_struct_127241->free_mem_111715, .size =0, .references =NULL};
    int64_t iterations = end - start;
    
    {
        int64_t start_114772;
        int64_t end_114773;
        
        start_114772 = start;
        end_114773 = end;
        
        int64_t n_114774 = end_114773 - start_114772;
        
        for (int64_t copy_i_114775 = start_114772; copy_i_114775 < start_114772 + n_114774; copy_i_114775++) {
            int64_t slice_114778 = mz2081Uz2084U_33563;
            int64_t slice_114779 = mz2081Uz2084U_33563 * slice_114778;
            int64_t i_114776 = squot64(copy_i_114775, slice_114778);
            int64_t remnant_114780 = copy_i_114775 - i_114776 * slice_114778;
            int64_t i_114777 = remnant_114780;
            int64_t remnant_114781 = remnant_114780 - i_114777;
            double tmp_114782 = ((double *) A_mem_111707.mem)[i_114776 * mz2081Uz2084U_33563 + i_114777];
            
            ((double *) mem_111715.mem)[i_114776 * mz2081Uz2084U_33563 + i_114777] = tmp_114782;
        }
    }
    
  cleanup:
    { }
    if (event_127243 != NULL) {
        event_127243->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_parloop_127242", strdup("nothing further"), event_127243, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_copy_114783_task_127240(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127239 *futhark_mc_task_127239 = (struct futhark_mc_task_127239 *) args;
    struct futhark_context *ctx = futhark_mc_task_127239->ctx;
    struct mc_event *event_127245 = mc_event_new(ctx);
    
    if (event_127245 != NULL)
        event_127245->bef = get_wall_time();
    
    int64_t mz2081Uz2084U_33563 = futhark_mc_task_127239->free_mz2081Uz2084U_33563;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_127239->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_111715 = {.desc ="mem_111715", .mem =futhark_mc_task_127239->free_mem_111715, .size =0, .references =NULL};
    struct futhark_mc_copy_parloop_struct_127241 futhark_mc_copy_parloop_struct_127241_;
    
    futhark_mc_copy_parloop_struct_127241_.ctx = ctx;
    futhark_mc_copy_parloop_struct_127241_.free_mz2081Uz2084U_33563 = mz2081Uz2084U_33563;
    futhark_mc_copy_parloop_struct_127241_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_copy_parloop_struct_127241_.free_mem_111715 = mem_111715.mem;
    
    struct scheduler_parloop futhark_mc_copy_parloop_127242_task;
    
    futhark_mc_copy_parloop_127242_task.name = "futhark_mc_copy_parloop_127242";
    futhark_mc_copy_parloop_127242_task.fn = futhark_mc_copy_parloop_127242;
    futhark_mc_copy_parloop_127242_task.args = &futhark_mc_copy_parloop_struct_127241_;
    futhark_mc_copy_parloop_127242_task.iterations = iterations;
    futhark_mc_copy_parloop_127242_task.info = info;
    
    struct mc_event *event_127244 = mc_event_new(ctx);
    
    if (event_127244 != NULL)
        event_127244->bef = get_wall_time();
    
    int futhark_mc_copy_parloop_127242_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_copy_parloop_127242_task);
    
    if (futhark_mc_copy_parloop_127242_err != 0) {
        err = futhark_mc_copy_parloop_127242_err;
        goto cleanup;
    }
    if (event_127244 != NULL) {
        event_127244->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_parloop_127242_total", strdup("nothing further"), event_127244, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_127245 != NULL) {
        event_127245->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_114783_task_127240", strdup("nothing further"), event_127245, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_127246 {
    struct futhark_context *ctx;
    int64_t free_mz2081Uz2084U_33563;
    unsigned char *free_B_mem_111709;
    unsigned char *free_mem_111715;
};
struct futhark_mc_copy_parloop_struct_127248 {
    struct futhark_context *ctx;
    int64_t free_mz2081Uz2084U_33563;
    unsigned char *free_B_mem_111709;
    unsigned char *free_mem_111715;
};
static int futhark_mc_copy_parloop_127249(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_copy_parloop_struct_127248 *futhark_mc_copy_parloop_struct_127248 = (struct futhark_mc_copy_parloop_struct_127248 *) args;
    struct futhark_context *ctx = futhark_mc_copy_parloop_struct_127248->ctx;
    struct mc_event *event_127250 = mc_event_new(ctx);
    
    if (event_127250 != NULL)
        event_127250->bef = get_wall_time();
    
    int64_t mz2081Uz2084U_33563 = futhark_mc_copy_parloop_struct_127248->free_mz2081Uz2084U_33563;
    struct memblock B_mem_111709 = {.desc ="B_mem_111709", .mem =futhark_mc_copy_parloop_struct_127248->free_B_mem_111709, .size =0, .references =NULL};
    struct memblock mem_111715 = {.desc ="mem_111715", .mem =futhark_mc_copy_parloop_struct_127248->free_mem_111715, .size =0, .references =NULL};
    int64_t iterations = end - start;
    
    {
        int64_t start_114785;
        int64_t end_114786;
        
        start_114785 = start;
        end_114786 = end;
        
        int64_t n_114787 = end_114786 - start_114785;
        
        for (int64_t copy_i_114788 = start_114785; copy_i_114788 < start_114785 + n_114787; copy_i_114788++) {
            int64_t slice_114791 = mz2081Uz2084U_33563;
            int64_t slice_114792 = mz2081Uz2084U_33563 * slice_114791;
            int64_t i_114789 = squot64(copy_i_114788, slice_114791);
            int64_t remnant_114793 = copy_i_114788 - i_114789 * slice_114791;
            int64_t i_114790 = remnant_114793;
            int64_t remnant_114794 = remnant_114793 - i_114790;
            double tmp_114795 = ((double *) B_mem_111709.mem)[i_114789 * mz2081Uz2084U_33563 + i_114790];
            
            ((double *) mem_111715.mem)[mz2081Uz2084U_33563 * mz2081Uz2084U_33563 + (i_114789 * mz2081Uz2084U_33563 + i_114790)] = tmp_114795;
        }
    }
    
  cleanup:
    { }
    if (event_127250 != NULL) {
        event_127250->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_parloop_127249", strdup("nothing further"), event_127250, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_copy_114796_task_127247(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127246 *futhark_mc_task_127246 = (struct futhark_mc_task_127246 *) args;
    struct futhark_context *ctx = futhark_mc_task_127246->ctx;
    struct mc_event *event_127252 = mc_event_new(ctx);
    
    if (event_127252 != NULL)
        event_127252->bef = get_wall_time();
    
    int64_t mz2081Uz2084U_33563 = futhark_mc_task_127246->free_mz2081Uz2084U_33563;
    struct memblock B_mem_111709 = {.desc ="B_mem_111709", .mem =futhark_mc_task_127246->free_B_mem_111709, .size =0, .references =NULL};
    struct memblock mem_111715 = {.desc ="mem_111715", .mem =futhark_mc_task_127246->free_mem_111715, .size =0, .references =NULL};
    struct futhark_mc_copy_parloop_struct_127248 futhark_mc_copy_parloop_struct_127248_;
    
    futhark_mc_copy_parloop_struct_127248_.ctx = ctx;
    futhark_mc_copy_parloop_struct_127248_.free_mz2081Uz2084U_33563 = mz2081Uz2084U_33563;
    futhark_mc_copy_parloop_struct_127248_.free_B_mem_111709 = B_mem_111709.mem;
    futhark_mc_copy_parloop_struct_127248_.free_mem_111715 = mem_111715.mem;
    
    struct scheduler_parloop futhark_mc_copy_parloop_127249_task;
    
    futhark_mc_copy_parloop_127249_task.name = "futhark_mc_copy_parloop_127249";
    futhark_mc_copy_parloop_127249_task.fn = futhark_mc_copy_parloop_127249;
    futhark_mc_copy_parloop_127249_task.args = &futhark_mc_copy_parloop_struct_127248_;
    futhark_mc_copy_parloop_127249_task.iterations = iterations;
    futhark_mc_copy_parloop_127249_task.info = info;
    
    struct mc_event *event_127251 = mc_event_new(ctx);
    
    if (event_127251 != NULL)
        event_127251->bef = get_wall_time();
    
    int futhark_mc_copy_parloop_127249_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_copy_parloop_127249_task);
    
    if (futhark_mc_copy_parloop_127249_err != 0) {
        err = futhark_mc_copy_parloop_127249_err;
        goto cleanup;
    }
    if (event_127251 != NULL) {
        event_127251->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_parloop_127249_total", strdup("nothing further"), event_127251, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_127252 != NULL) {
        event_127252->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_114796_task_127247", strdup("nothing further"), event_127252, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_127255 {
    struct futhark_context *ctx;
    int64_t free_k_34109;
    int64_t free_m_34110;
    int64_t free_d_34111;
    unsigned char *free_pt_clouds_mem_111707;
    int64_t free_bytes_111719;
    unsigned char *free_mem_111743;
};
struct futhark_mc_segmap_parloop_struct_127257 {
    struct futhark_context *ctx;
    int64_t free_k_34109;
    int64_t free_m_34110;
    int64_t free_d_34111;
    unsigned char *free_pt_clouds_mem_111707;
    unsigned char *free_mem_111743;
};
static int futhark_mc_segmap_parloop_127258(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_127257 *futhark_mc_segmap_parloop_struct_127257 = (struct futhark_mc_segmap_parloop_struct_127257 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_127257->ctx;
    struct mc_event *event_127259 = mc_event_new(ctx);
    
    if (event_127259 != NULL)
        event_127259->bef = get_wall_time();
    
    int64_t k_34109 = futhark_mc_segmap_parloop_struct_127257->free_k_34109;
    int64_t m_34110 = futhark_mc_segmap_parloop_struct_127257->free_m_34110;
    int64_t d_34111 = futhark_mc_segmap_parloop_struct_127257->free_d_34111;
    struct memblock pt_clouds_mem_111707 = {.desc ="pt_clouds_mem_111707", .mem =futhark_mc_segmap_parloop_struct_127257->free_pt_clouds_mem_111707, .size =0, .references =NULL};
    struct memblock mem_111743 = {.desc ="mem_111743", .mem =futhark_mc_segmap_parloop_struct_127257->free_mem_111743, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_103772;
    
    flat_tid_103772 = subtask_id;
    {
        int64_t start_114771;
        int64_t end_114772;
        
        start_114771 = start;
        end_114772 = end;
        
        int64_t n_114773 = end_114772 - start_114771;
        
        for (int64_t SegMap_i_114774 = start_114771; SegMap_i_114774 < start_114771 + n_114773; SegMap_i_114774++) {
            int64_t slice_114775 = k_34109;
            int64_t gtid_103773 = SegMap_i_114774;
            int64_t remnant_114776 = SegMap_i_114774 - gtid_103773;
            
            for (int64_t i_114754 = 0; i_114754 < m_34110; i_114754++) {
                for (int64_t i_114758 = 0; i_114758 < m_34110; i_114758++) {
                    double defunc_0_reduce_res_114760;
                    double redout_114762 = 0.0;
                    
                    for (int64_t i_114761 = 0; i_114761 < d_34111; i_114761++) {
                        double eta_p_114763 = ((double *) pt_clouds_mem_111707.mem)[gtid_103773 * (d_34111 * m_34110) + i_114754 * d_34111 + i_114761];
                        double eta_p_114764 = ((double *) pt_clouds_mem_111707.mem)[gtid_103773 * (d_34111 * m_34110) + i_114758 * d_34111 + i_114761];
                        double zm_res_114765 = eta_p_114763 - eta_p_114764;
                        double zt_res_114766 = zm_res_114765 * zm_res_114765;
                        double zp_res_114767 = zt_res_114766 + redout_114762;
                        double redout_tmp_114779 = zp_res_114767;
                        
                        redout_114762 = redout_tmp_114779;
                    }
                    defunc_0_reduce_res_114760 = redout_114762;
                    
                    double sqrt_res_114768 = futrts_sqrt64(defunc_0_reduce_res_114760);
                    
                    ((double *) mem_111743.mem)[gtid_103773 * (m_34110 * m_34110) + i_114754 * m_34110 + i_114758] = sqrt_res_114768;
                }
            }
        }
    }
    
  cleanup:
    { }
    if (event_127259 != NULL) {
        event_127259->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127258", strdup("nothing further"), event_127259, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_task_127256(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127255 *futhark_mc_task_127255 = (struct futhark_mc_task_127255 *) args;
    struct futhark_context *ctx = futhark_mc_task_127255->ctx;
    struct mc_event *event_127261 = mc_event_new(ctx);
    
    if (event_127261 != NULL)
        event_127261->bef = get_wall_time();
    
    int64_t k_34109 = futhark_mc_task_127255->free_k_34109;
    int64_t m_34110 = futhark_mc_task_127255->free_m_34110;
    int64_t d_34111 = futhark_mc_task_127255->free_d_34111;
    struct memblock pt_clouds_mem_111707 = {.desc ="pt_clouds_mem_111707", .mem =futhark_mc_task_127255->free_pt_clouds_mem_111707, .size =0, .references =NULL};
    int64_t bytes_111719 = futhark_mc_task_127255->free_bytes_111719;
    struct memblock mem_111743 = {.desc ="mem_111743", .mem =futhark_mc_task_127255->free_mem_111743, .size =0, .references =NULL};
    int32_t nsubtasks_114753;
    
    nsubtasks_114753 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_127257 futhark_mc_segmap_parloop_struct_127257_;
    
    futhark_mc_segmap_parloop_struct_127257_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_127257_.free_k_34109 = k_34109;
    futhark_mc_segmap_parloop_struct_127257_.free_m_34110 = m_34110;
    futhark_mc_segmap_parloop_struct_127257_.free_d_34111 = d_34111;
    futhark_mc_segmap_parloop_struct_127257_.free_pt_clouds_mem_111707 = pt_clouds_mem_111707.mem;
    futhark_mc_segmap_parloop_struct_127257_.free_mem_111743 = mem_111743.mem;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_127258_task;
    
    futhark_mc_segmap_parloop_127258_task.name = "futhark_mc_segmap_parloop_127258";
    futhark_mc_segmap_parloop_127258_task.fn = futhark_mc_segmap_parloop_127258;
    futhark_mc_segmap_parloop_127258_task.args = &futhark_mc_segmap_parloop_struct_127257_;
    futhark_mc_segmap_parloop_127258_task.iterations = iterations;
    futhark_mc_segmap_parloop_127258_task.info = info;
    
    struct mc_event *event_127260 = mc_event_new(ctx);
    
    if (event_127260 != NULL)
        event_127260->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_127258_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_127258_task);
    
    if (futhark_mc_segmap_parloop_127258_err != 0) {
        err = futhark_mc_segmap_parloop_127258_err;
        goto cleanup;
    }
    if (event_127260 != NULL) {
        event_127260->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127258_total", strdup("nothing further"), event_127260, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_127261 != NULL) {
        event_127261->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_task_127256", strdup("nothing further"), event_127261, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_segmap_parloop_struct_127263 {
    struct futhark_context *ctx;
    int64_t free_k_34109;
    int64_t free_m_34110;
    int64_t free_d_34111;
    unsigned char *free_pt_clouds_mem_111707;
    int64_t free_bytes_111719;
    unsigned char *free_mem_111743;
};
struct futhark_mc_task_127266 {
    struct futhark_context *ctx;
    int64_t free_m_34110;
    int64_t free_d_34111;
    int64_t free_gtid_103831;
    unsigned char *free_pt_clouds_mem_111707;
    unsigned char *free_mem_111720;
    unsigned char *free_mem_111743;
};
struct futhark_mc_segmap_parloop_struct_127268 {
    struct futhark_context *ctx;
    int64_t free_m_34110;
    int64_t free_d_34111;
    int64_t free_gtid_103831;
    unsigned char *free_pt_clouds_mem_111707;
    unsigned char *free_mem_111720;
    unsigned char *free_mem_111743;
};
static int futhark_mc_segmap_parloop_127269(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_127268 *futhark_mc_segmap_parloop_struct_127268 = (struct futhark_mc_segmap_parloop_struct_127268 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_127268->ctx;
    struct mc_event *event_127270 = mc_event_new(ctx);
    
    if (event_127270 != NULL)
        event_127270->bef = get_wall_time();
    
    int64_t m_34110 = futhark_mc_segmap_parloop_struct_127268->free_m_34110;
    int64_t d_34111 = futhark_mc_segmap_parloop_struct_127268->free_d_34111;
    int64_t gtid_103831 = futhark_mc_segmap_parloop_struct_127268->free_gtid_103831;
    struct memblock pt_clouds_mem_111707 = {.desc ="pt_clouds_mem_111707", .mem =futhark_mc_segmap_parloop_struct_127268->free_pt_clouds_mem_111707, .size =0, .references =NULL};
    struct memblock mem_111720 = {.desc ="mem_111720", .mem =futhark_mc_segmap_parloop_struct_127268->free_mem_111720, .size =0, .references =NULL};
    struct memblock mem_111743 = {.desc ="mem_111743", .mem =futhark_mc_segmap_parloop_struct_127268->free_mem_111743, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_114808;
    
    flat_tid_114808 = subtask_id;
    {
        int64_t start_114843;
        int64_t end_114844;
        
        start_114843 = start;
        end_114844 = end;
        
        int64_t n_114845 = end_114844 - start_114843;
        
        for (int64_t SegMap_i_114846 = start_114843; SegMap_i_114846 < start_114843 + n_114845; SegMap_i_114846++) {
            int64_t slice_114847 = m_34110;
            int64_t gtid_114809 = SegMap_i_114846;
            int64_t remnant_114848 = SegMap_i_114846 - gtid_114809;
            
            for (int64_t i_114831 = 0; i_114831 < m_34110; i_114831++) {
                double defunc_0_reduce_res_114833;
                double redout_114835 = 0.0;
                
                for (int64_t i_114834 = 0; i_114834 < d_34111; i_114834++) {
                    double eta_p_114836 = ((double *) pt_clouds_mem_111707.mem)[gtid_103831 * (d_34111 * m_34110) + gtid_114809 * d_34111 + i_114834];
                    double eta_p_114837 = ((double *) pt_clouds_mem_111707.mem)[gtid_103831 * (d_34111 * m_34110) + i_114831 * d_34111 + i_114834];
                    double zm_res_114838 = eta_p_114836 - eta_p_114837;
                    double zt_res_114839 = zm_res_114838 * zm_res_114838;
                    double zp_res_114840 = zt_res_114839 + redout_114835;
                    double redout_tmp_114850 = zp_res_114840;
                    
                    redout_114835 = redout_tmp_114850;
                }
                defunc_0_reduce_res_114833 = redout_114835;
                
                double sqrt_res_114841 = futrts_sqrt64(defunc_0_reduce_res_114833);
                
                ((double *) mem_111720.mem)[gtid_114809 * m_34110 + i_114831] = sqrt_res_114841;
            }
            lmad_copy_8b(ctx, 1, (uint64_t *) mem_111743.mem, gtid_103831 * (m_34110 * m_34110) + gtid_114809 * m_34110, (int64_t []) {(int64_t) 1}, (uint64_t *) mem_111720.mem, gtid_114809 * m_34110, (int64_t []) {(int64_t) 1}, (int64_t []) {m_34110});
        }
    }
    
  cleanup:
    { }
    if (event_127270 != NULL) {
        event_127270->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127269", strdup("nothing further"), event_127270, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_task_127267(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127266 *futhark_mc_task_127266 = (struct futhark_mc_task_127266 *) args;
    struct futhark_context *ctx = futhark_mc_task_127266->ctx;
    struct mc_event *event_127272 = mc_event_new(ctx);
    
    if (event_127272 != NULL)
        event_127272->bef = get_wall_time();
    
    int64_t m_34110 = futhark_mc_task_127266->free_m_34110;
    int64_t d_34111 = futhark_mc_task_127266->free_d_34111;
    int64_t gtid_103831 = futhark_mc_task_127266->free_gtid_103831;
    struct memblock pt_clouds_mem_111707 = {.desc ="pt_clouds_mem_111707", .mem =futhark_mc_task_127266->free_pt_clouds_mem_111707, .size =0, .references =NULL};
    struct memblock mem_111720 = {.desc ="mem_111720", .mem =futhark_mc_task_127266->free_mem_111720, .size =0, .references =NULL};
    struct memblock mem_111743 = {.desc ="mem_111743", .mem =futhark_mc_task_127266->free_mem_111743, .size =0, .references =NULL};
    int32_t nsubtasks_114830;
    
    nsubtasks_114830 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_127268 futhark_mc_segmap_parloop_struct_127268_;
    
    futhark_mc_segmap_parloop_struct_127268_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_127268_.free_m_34110 = m_34110;
    futhark_mc_segmap_parloop_struct_127268_.free_d_34111 = d_34111;
    futhark_mc_segmap_parloop_struct_127268_.free_gtid_103831 = gtid_103831;
    futhark_mc_segmap_parloop_struct_127268_.free_pt_clouds_mem_111707 = pt_clouds_mem_111707.mem;
    futhark_mc_segmap_parloop_struct_127268_.free_mem_111720 = mem_111720.mem;
    futhark_mc_segmap_parloop_struct_127268_.free_mem_111743 = mem_111743.mem;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_127269_task;
    
    futhark_mc_segmap_parloop_127269_task.name = "futhark_mc_segmap_parloop_127269";
    futhark_mc_segmap_parloop_127269_task.fn = futhark_mc_segmap_parloop_127269;
    futhark_mc_segmap_parloop_127269_task.args = &futhark_mc_segmap_parloop_struct_127268_;
    futhark_mc_segmap_parloop_127269_task.iterations = iterations;
    futhark_mc_segmap_parloop_127269_task.info = info;
    
    struct mc_event *event_127271 = mc_event_new(ctx);
    
    if (event_127271 != NULL)
        event_127271->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_127269_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_127269_task);
    
    if (futhark_mc_segmap_parloop_127269_err != 0) {
        err = futhark_mc_segmap_parloop_127269_err;
        goto cleanup;
    }
    if (event_127271 != NULL) {
        event_127271->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127269_total", strdup("nothing further"), event_127271, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_127272 != NULL) {
        event_127272->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_task_127267", strdup("nothing further"), event_127272, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_segmap_parloop_struct_127274 {
    struct futhark_context *ctx;
    int64_t free_m_34110;
    int64_t free_d_34111;
    int64_t free_gtid_103831;
    unsigned char *free_pt_clouds_mem_111707;
    unsigned char *free_mem_111743;
};
struct futhark_mc_task_127276 {
    struct futhark_context *ctx;
    int64_t free_m_34110;
    int64_t free_d_34111;
    int64_t free_gtid_103831;
    unsigned char *free_pt_clouds_mem_111707;
    unsigned char *free_mem_111743;
    int64_t free_gtid_114782;
};
struct futhark_mc_segmap_parloop_struct_127278 {
    struct futhark_context *ctx;
    int64_t free_m_34110;
    int64_t free_d_34111;
    int64_t free_gtid_103831;
    unsigned char *free_pt_clouds_mem_111707;
    unsigned char *free_mem_111743;
    int64_t free_gtid_114782;
};
static int futhark_mc_segmap_parloop_127279(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_127278 *futhark_mc_segmap_parloop_struct_127278 = (struct futhark_mc_segmap_parloop_struct_127278 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_127278->ctx;
    struct mc_event *event_127280 = mc_event_new(ctx);
    
    if (event_127280 != NULL)
        event_127280->bef = get_wall_time();
    
    int64_t m_34110 = futhark_mc_segmap_parloop_struct_127278->free_m_34110;
    int64_t d_34111 = futhark_mc_segmap_parloop_struct_127278->free_d_34111;
    int64_t gtid_103831 = futhark_mc_segmap_parloop_struct_127278->free_gtid_103831;
    struct memblock pt_clouds_mem_111707 = {.desc ="pt_clouds_mem_111707", .mem =futhark_mc_segmap_parloop_struct_127278->free_pt_clouds_mem_111707, .size =0, .references =NULL};
    struct memblock mem_111743 = {.desc ="mem_111743", .mem =futhark_mc_segmap_parloop_struct_127278->free_mem_111743, .size =0, .references =NULL};
    int64_t gtid_114782 = futhark_mc_segmap_parloop_struct_127278->free_gtid_114782;
    int64_t iterations = end - start;
    int64_t flat_tid_114865;
    
    flat_tid_114865 = subtask_id;
    {
        int64_t start_114890;
        int64_t end_114891;
        
        start_114890 = start;
        end_114891 = end;
        
        int64_t n_114892 = end_114891 - start_114890;
        
        for (int64_t SegMap_i_114893 = start_114890; SegMap_i_114893 < start_114890 + n_114892; SegMap_i_114893++) {
            int64_t slice_114894 = m_34110;
            int64_t gtid_114866 = SegMap_i_114893;
            int64_t remnant_114895 = SegMap_i_114893 - gtid_114866;
            double defunc_0_reduce_res_114867;
            double redout_114884 = 0.0;
            
            for (int64_t i_114883 = 0; i_114883 < d_34111; i_114883++) {
                double eta_p_114885 = ((double *) pt_clouds_mem_111707.mem)[gtid_103831 * (d_34111 * m_34110) + gtid_114782 * d_34111 + i_114883];
                double eta_p_114886 = ((double *) pt_clouds_mem_111707.mem)[gtid_103831 * (d_34111 * m_34110) + gtid_114866 * d_34111 + i_114883];
                double zm_res_114887 = eta_p_114885 - eta_p_114886;
                double zt_res_114888 = zm_res_114887 * zm_res_114887;
                double zp_res_114889 = zt_res_114888 + redout_114884;
                double redout_tmp_114896 = zp_res_114889;
                
                redout_114884 = redout_tmp_114896;
            }
            defunc_0_reduce_res_114867 = redout_114884;
            
            double sqrt_res_114875 = futrts_sqrt64(defunc_0_reduce_res_114867);
            
            ((double *) mem_111743.mem)[gtid_103831 * (m_34110 * m_34110) + gtid_114782 * m_34110 + gtid_114866] = sqrt_res_114875;
        }
    }
    
  cleanup:
    { }
    if (event_127280 != NULL) {
        event_127280->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127279", strdup("nothing further"), event_127280, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_task_127277(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127276 *futhark_mc_task_127276 = (struct futhark_mc_task_127276 *) args;
    struct futhark_context *ctx = futhark_mc_task_127276->ctx;
    struct mc_event *event_127282 = mc_event_new(ctx);
    
    if (event_127282 != NULL)
        event_127282->bef = get_wall_time();
    
    int64_t m_34110 = futhark_mc_task_127276->free_m_34110;
    int64_t d_34111 = futhark_mc_task_127276->free_d_34111;
    int64_t gtid_103831 = futhark_mc_task_127276->free_gtid_103831;
    struct memblock pt_clouds_mem_111707 = {.desc ="pt_clouds_mem_111707", .mem =futhark_mc_task_127276->free_pt_clouds_mem_111707, .size =0, .references =NULL};
    struct memblock mem_111743 = {.desc ="mem_111743", .mem =futhark_mc_task_127276->free_mem_111743, .size =0, .references =NULL};
    int64_t gtid_114782 = futhark_mc_task_127276->free_gtid_114782;
    int32_t nsubtasks_114882;
    
    nsubtasks_114882 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_127278 futhark_mc_segmap_parloop_struct_127278_;
    
    futhark_mc_segmap_parloop_struct_127278_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_127278_.free_m_34110 = m_34110;
    futhark_mc_segmap_parloop_struct_127278_.free_d_34111 = d_34111;
    futhark_mc_segmap_parloop_struct_127278_.free_gtid_103831 = gtid_103831;
    futhark_mc_segmap_parloop_struct_127278_.free_pt_clouds_mem_111707 = pt_clouds_mem_111707.mem;
    futhark_mc_segmap_parloop_struct_127278_.free_mem_111743 = mem_111743.mem;
    futhark_mc_segmap_parloop_struct_127278_.free_gtid_114782 = gtid_114782;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_127279_task;
    
    futhark_mc_segmap_parloop_127279_task.name = "futhark_mc_segmap_parloop_127279";
    futhark_mc_segmap_parloop_127279_task.fn = futhark_mc_segmap_parloop_127279;
    futhark_mc_segmap_parloop_127279_task.args = &futhark_mc_segmap_parloop_struct_127278_;
    futhark_mc_segmap_parloop_127279_task.iterations = iterations;
    futhark_mc_segmap_parloop_127279_task.info = info;
    
    struct mc_event *event_127281 = mc_event_new(ctx);
    
    if (event_127281 != NULL)
        event_127281->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_127279_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_127279_task);
    
    if (futhark_mc_segmap_parloop_127279_err != 0) {
        err = futhark_mc_segmap_parloop_127279_err;
        goto cleanup;
    }
    if (event_127281 != NULL) {
        event_127281->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127279_total", strdup("nothing further"), event_127281, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_127282 != NULL) {
        event_127282->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_task_127277", strdup("nothing further"), event_127282, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_segmap_parloop_struct_127284 {
    struct futhark_context *ctx;
    int64_t free_m_34110;
    int64_t free_d_34111;
    int64_t free_gtid_103831;
    unsigned char *free_pt_clouds_mem_111707;
    unsigned char *free_mem_111743;
    int64_t free_gtid_114782;
};
struct futhark_mc_task_127286 {
    struct futhark_context *ctx;
    int64_t free_m_34110;
    int64_t free_d_34111;
    int64_t free_gtid_103831;
    unsigned char *free_pt_clouds_mem_111707;
    int64_t free_gtid_114782;
    int64_t free_gtid_114853;
    int64_t free_flat_tid_114898;
    double *retval_defunc_0_reduce_res_114854;
};
struct futhark_mc_segred_stage_1_parloop_struct_127289 {
    struct futhark_context *ctx;
    int64_t free_m_34110;
    int64_t free_d_34111;
    int64_t free_gtid_103831;
    unsigned char *free_pt_clouds_mem_111707;
    int64_t free_gtid_114782;
    int64_t free_gtid_114853;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_114914;
};
static int futhark_mc_segred_stage_1_parloop_127290(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127289 *futhark_mc_segred_stage_1_parloop_struct_127289 = (struct futhark_mc_segred_stage_1_parloop_struct_127289 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127289->ctx;
    struct mc_event *event_127291 = mc_event_new(ctx);
    
    if (event_127291 != NULL)
        event_127291->bef = get_wall_time();
    
    int64_t m_34110 = futhark_mc_segred_stage_1_parloop_struct_127289->free_m_34110;
    int64_t d_34111 = futhark_mc_segred_stage_1_parloop_struct_127289->free_d_34111;
    int64_t gtid_103831 = futhark_mc_segred_stage_1_parloop_struct_127289->free_gtid_103831;
    struct memblock pt_clouds_mem_111707 = {.desc ="pt_clouds_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_127289->free_pt_clouds_mem_111707, .size =0, .references =NULL};
    int64_t gtid_114782 = futhark_mc_segred_stage_1_parloop_struct_127289->free_gtid_114782;
    int64_t gtid_114853 = futhark_mc_segred_stage_1_parloop_struct_127289->free_gtid_114853;
    struct memblock reduce_stage_1_tid_res_arr_mem_114914 = {.desc ="reduce_stage_1_tid_res_arr_mem_114914", .mem =futhark_mc_segred_stage_1_parloop_struct_127289->free_reduce_stage_1_tid_res_arr_mem_114914, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_114898;
    
    flat_tid_114898 = subtask_id;
    {
        double eta_p_114916;
        double eta_p_114917;
        double local_acc_114919 = 0.0;
        double eta_p_114900;
        double eta_p_114901;
        double local_acc_114920 = 0.0;
        int64_t start_114921;
        int64_t end_114922;
        
        start_114921 = start;
        end_114922 = end;
        
        int64_t n_114923 = end_114922 - start_114921;
        
        for (int64_t SegRed_i_114924 = start_114921; SegRed_i_114924 < start_114921 + n_114923; SegRed_i_114924++) {
            int64_t gtid_114899 = SegRed_i_114924;
            double eta_p_114903 = ((double *) pt_clouds_mem_111707.mem)[gtid_103831 * (d_34111 * m_34110) + gtid_114782 * d_34111 + gtid_114899];
            double eta_p_114904 = ((double *) pt_clouds_mem_111707.mem)[gtid_103831 * (d_34111 * m_34110) + gtid_114853 * d_34111 + gtid_114899];
            double zm_res_114905 = eta_p_114903 - eta_p_114904;
            double zt_res_114906 = zm_res_114905 * zm_res_114905;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_114900 = local_acc_114920;
            }
            // Load next params
            {
                eta_p_114901 = zt_res_114906;
            }
            // SegRed body
            {
                double zp_res_114902 = eta_p_114900 + eta_p_114901;
                
                local_acc_114920 = zp_res_114902;
            }
        }
        
        int64_t uni_i_114925 = 0;
        
        {
            int64_t gtid_114899 = uni_i_114925;
            
            // Load accum params
            {
                eta_p_114916 = local_acc_114919;
            }
            // Load next params
            {
                eta_p_114917 = local_acc_114920;
            }
            // SegRed body
            {
                double zp_res_114918 = eta_p_114916 + eta_p_114917;
                
                local_acc_114919 = zp_res_114918;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_114914.mem)[flat_tid_114898] = local_acc_114919;
    }
    
  cleanup:
    { }
    if (event_127291 != NULL) {
        event_127291->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127290", strdup("nothing further"), event_127291, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127287(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127286 *futhark_mc_task_127286 = (struct futhark_mc_task_127286 *) args;
    struct futhark_context *ctx = futhark_mc_task_127286->ctx;
    struct mc_event *event_127293 = mc_event_new(ctx);
    
    if (event_127293 != NULL)
        event_127293->bef = get_wall_time();
    
    int64_t m_34110 = futhark_mc_task_127286->free_m_34110;
    int64_t d_34111 = futhark_mc_task_127286->free_d_34111;
    int64_t gtid_103831 = futhark_mc_task_127286->free_gtid_103831;
    struct memblock pt_clouds_mem_111707 = {.desc ="pt_clouds_mem_111707", .mem =futhark_mc_task_127286->free_pt_clouds_mem_111707, .size =0, .references =NULL};
    int64_t gtid_114782 = futhark_mc_task_127286->free_gtid_114782;
    int64_t gtid_114853 = futhark_mc_task_127286->free_gtid_114853;
    int64_t flat_tid_114898 = futhark_mc_task_127286->free_flat_tid_114898;
    double defunc_0_reduce_res_114854 = *futhark_mc_task_127286->retval_defunc_0_reduce_res_114854;
    int64_t reduce_stage_1_tid_res_arr_mem_114914_cached_sizze_127288 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_114914 = NULL;
    int32_t nsubtasks_114913;
    
    nsubtasks_114913 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_114914_cached_sizze_127288 < (int64_t) 8 * nsubtasks_114913) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_114914, &reduce_stage_1_tid_res_arr_mem_114914_cached_sizze_127288, (int64_t) 8 * nsubtasks_114913);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127289 futhark_mc_segred_stage_1_parloop_struct_127289_;
    
    futhark_mc_segred_stage_1_parloop_struct_127289_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127289_.free_m_34110 = m_34110;
    futhark_mc_segred_stage_1_parloop_struct_127289_.free_d_34111 = d_34111;
    futhark_mc_segred_stage_1_parloop_struct_127289_.free_gtid_103831 = gtid_103831;
    futhark_mc_segred_stage_1_parloop_struct_127289_.free_pt_clouds_mem_111707 = pt_clouds_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_127289_.free_gtid_114782 = gtid_114782;
    futhark_mc_segred_stage_1_parloop_struct_127289_.free_gtid_114853 = gtid_114853;
    futhark_mc_segred_stage_1_parloop_struct_127289_.free_reduce_stage_1_tid_res_arr_mem_114914 = reduce_stage_1_tid_res_arr_mem_114914;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127290_task;
    
    futhark_mc_segred_stage_1_parloop_127290_task.name = "futhark_mc_segred_stage_1_parloop_127290";
    futhark_mc_segred_stage_1_parloop_127290_task.fn = futhark_mc_segred_stage_1_parloop_127290;
    futhark_mc_segred_stage_1_parloop_127290_task.args = &futhark_mc_segred_stage_1_parloop_struct_127289_;
    futhark_mc_segred_stage_1_parloop_127290_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127290_task.info = info;
    
    struct mc_event *event_127292 = mc_event_new(ctx);
    
    if (event_127292 != NULL)
        event_127292->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127290_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127290_task);
    
    if (futhark_mc_segred_stage_1_parloop_127290_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127290_err;
        goto cleanup;
    }
    if (event_127292 != NULL) {
        event_127292->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127290_total", strdup("nothing further"), event_127292, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_114854 = 0.0;
    }
    
    double eta_p_114926;
    double eta_p_114927;
    
    for (int32_t i_114929 = 0; i_114929 < nsubtasks_114913; i_114929++) {
        flat_tid_114898 = i_114929;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_114926 = defunc_0_reduce_res_114854;
            }
            // load next params
            {
                eta_p_114927 = ((double *) reduce_stage_1_tid_res_arr_mem_114914)[flat_tid_114898];
            }
            // red body
            {
                double zp_res_114928 = eta_p_114926 + eta_p_114927;
                
                defunc_0_reduce_res_114854 = zp_res_114928;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_114914);
    }
    if (event_127293 != NULL) {
        event_127293->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127287", strdup("nothing further"), event_127293, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127286->retval_defunc_0_reduce_res_114854 = defunc_0_reduce_res_114854;
    }
    return err;
}
static int futhark_mc_segmap_parloop_127285(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_127284 *futhark_mc_segmap_parloop_struct_127284 = (struct futhark_mc_segmap_parloop_struct_127284 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_127284->ctx;
    struct mc_event *event_127294 = mc_event_new(ctx);
    
    if (event_127294 != NULL)
        event_127294->bef = get_wall_time();
    
    int64_t m_34110 = futhark_mc_segmap_parloop_struct_127284->free_m_34110;
    int64_t d_34111 = futhark_mc_segmap_parloop_struct_127284->free_d_34111;
    int64_t gtid_103831 = futhark_mc_segmap_parloop_struct_127284->free_gtid_103831;
    struct memblock pt_clouds_mem_111707 = {.desc ="pt_clouds_mem_111707", .mem =futhark_mc_segmap_parloop_struct_127284->free_pt_clouds_mem_111707, .size =0, .references =NULL};
    struct memblock mem_111743 = {.desc ="mem_111743", .mem =futhark_mc_segmap_parloop_struct_127284->free_mem_111743, .size =0, .references =NULL};
    int64_t gtid_114782 = futhark_mc_segmap_parloop_struct_127284->free_gtid_114782;
    int64_t iterations = end - start;
    int64_t flat_tid_114852;
    
    flat_tid_114852 = subtask_id;
    {
        int64_t start_114907;
        int64_t end_114908;
        
        start_114907 = start;
        end_114908 = end;
        
        int64_t n_114909 = end_114908 - start_114907;
        
        for (int64_t SegMap_i_114910 = start_114907; SegMap_i_114910 < start_114907 + n_114909; SegMap_i_114910++) {
            int64_t slice_114911 = m_34110;
            int64_t gtid_114853 = SegMap_i_114910;
            int64_t remnant_114912 = SegMap_i_114910 - gtid_114853;
            double defunc_0_reduce_res_114854;
            int64_t flat_tid_114898 = (int64_t) 0;
            
            defunc_0_reduce_res_114854 = 0.0;
            
            struct futhark_mc_task_127286 futhark_mc_task_127286_;
            
            futhark_mc_task_127286_.ctx = ctx;
            futhark_mc_task_127286_.free_m_34110 = m_34110;
            futhark_mc_task_127286_.free_d_34111 = d_34111;
            futhark_mc_task_127286_.free_gtid_103831 = gtid_103831;
            futhark_mc_task_127286_.free_pt_clouds_mem_111707 = pt_clouds_mem_111707.mem;
            futhark_mc_task_127286_.free_gtid_114782 = gtid_114782;
            futhark_mc_task_127286_.free_gtid_114853 = gtid_114853;
            futhark_mc_task_127286_.free_flat_tid_114898 = flat_tid_114898;
            futhark_mc_task_127286_.retval_defunc_0_reduce_res_114854 = (double *) &defunc_0_reduce_res_114854;
            #if ISPC
            futhark_mc_task_127286_.retval_defunc_0_reduce_res_114854 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_127286_task;
            
            futhark_mc_task_127286_task.args = &futhark_mc_task_127286_;
            futhark_mc_task_127286_task.top_level_fn = futhark_mc_segred_task_127287;
            futhark_mc_task_127286_task.name = "futhark_mc_segred_task_127287";
            futhark_mc_task_127286_task.iterations = d_34111;
            futhark_mc_task_127286_task.task_time = &ctx->program->futhark_mc_segred_task_127287_total_time;
            futhark_mc_task_127286_task.task_iter = &ctx->program->futhark_mc_segred_task_127287_total_iter;
            futhark_mc_task_127286_task.sched = STATIC;
            futhark_mc_task_127286_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_127287_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127286_task);
            
            if (futhark_mc_segred_task_127287_err != 0) {
                err = futhark_mc_segred_task_127287_err;
                goto cleanup;
            }
            
            double sqrt_res_114864 = futrts_sqrt64(defunc_0_reduce_res_114854);
            
            ((double *) mem_111743.mem)[gtid_103831 * (m_34110 * m_34110) + gtid_114782 * m_34110 + gtid_114853] = sqrt_res_114864;
        }
    }
    
  cleanup:
    { }
    if (event_127294 != NULL) {
        event_127294->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127285", strdup("nothing further"), event_127294, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_nested_task_127283(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127276 *futhark_mc_task_127276 = (struct futhark_mc_task_127276 *) args;
    struct futhark_context *ctx = futhark_mc_task_127276->ctx;
    struct mc_event *event_127296 = mc_event_new(ctx);
    
    if (event_127296 != NULL)
        event_127296->bef = get_wall_time();
    
    int64_t m_34110 = futhark_mc_task_127276->free_m_34110;
    int64_t d_34111 = futhark_mc_task_127276->free_d_34111;
    int64_t gtid_103831 = futhark_mc_task_127276->free_gtid_103831;
    struct memblock pt_clouds_mem_111707 = {.desc ="pt_clouds_mem_111707", .mem =futhark_mc_task_127276->free_pt_clouds_mem_111707, .size =0, .references =NULL};
    struct memblock mem_111743 = {.desc ="mem_111743", .mem =futhark_mc_task_127276->free_mem_111743, .size =0, .references =NULL};
    int64_t gtid_114782 = futhark_mc_task_127276->free_gtid_114782;
    int32_t nsubtasks_114897;
    
    nsubtasks_114897 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_127284 futhark_mc_segmap_parloop_struct_127284_;
    
    futhark_mc_segmap_parloop_struct_127284_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_127284_.free_m_34110 = m_34110;
    futhark_mc_segmap_parloop_struct_127284_.free_d_34111 = d_34111;
    futhark_mc_segmap_parloop_struct_127284_.free_gtid_103831 = gtid_103831;
    futhark_mc_segmap_parloop_struct_127284_.free_pt_clouds_mem_111707 = pt_clouds_mem_111707.mem;
    futhark_mc_segmap_parloop_struct_127284_.free_mem_111743 = mem_111743.mem;
    futhark_mc_segmap_parloop_struct_127284_.free_gtid_114782 = gtid_114782;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_127285_task;
    
    futhark_mc_segmap_parloop_127285_task.name = "futhark_mc_segmap_parloop_127285";
    futhark_mc_segmap_parloop_127285_task.fn = futhark_mc_segmap_parloop_127285;
    futhark_mc_segmap_parloop_127285_task.args = &futhark_mc_segmap_parloop_struct_127284_;
    futhark_mc_segmap_parloop_127285_task.iterations = iterations;
    futhark_mc_segmap_parloop_127285_task.info = info;
    
    struct mc_event *event_127295 = mc_event_new(ctx);
    
    if (event_127295 != NULL)
        event_127295->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_127285_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_127285_task);
    
    if (futhark_mc_segmap_parloop_127285_err != 0) {
        err = futhark_mc_segmap_parloop_127285_err;
        goto cleanup;
    }
    if (event_127295 != NULL) {
        event_127295->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127285_total", strdup("nothing further"), event_127295, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_127296 != NULL) {
        event_127296->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_nested_task_127283", strdup("nothing further"), event_127296, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
static int futhark_mc_segmap_parloop_127275(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_127274 *futhark_mc_segmap_parloop_struct_127274 = (struct futhark_mc_segmap_parloop_struct_127274 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_127274->ctx;
    struct mc_event *event_127297 = mc_event_new(ctx);
    
    if (event_127297 != NULL)
        event_127297->bef = get_wall_time();
    
    int64_t m_34110 = futhark_mc_segmap_parloop_struct_127274->free_m_34110;
    int64_t d_34111 = futhark_mc_segmap_parloop_struct_127274->free_d_34111;
    int64_t gtid_103831 = futhark_mc_segmap_parloop_struct_127274->free_gtid_103831;
    struct memblock pt_clouds_mem_111707 = {.desc ="pt_clouds_mem_111707", .mem =futhark_mc_segmap_parloop_struct_127274->free_pt_clouds_mem_111707, .size =0, .references =NULL};
    struct memblock mem_111743 = {.desc ="mem_111743", .mem =futhark_mc_segmap_parloop_struct_127274->free_mem_111743, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_114781;
    
    flat_tid_114781 = subtask_id;
    {
        int64_t start_114876;
        int64_t end_114877;
        
        start_114876 = start;
        end_114877 = end;
        
        int64_t n_114878 = end_114877 - start_114876;
        
        for (int64_t SegMap_i_114879 = start_114876; SegMap_i_114879 < start_114876 + n_114878; SegMap_i_114879++) {
            int64_t slice_114880 = m_34110;
            int64_t gtid_114782 = SegMap_i_114879;
            int64_t remnant_114881 = SegMap_i_114879 - gtid_114782;
            int64_t flat_tid_114865 = (int64_t) 0;
            int64_t flat_tid_114852 = (int64_t) 0;
            struct futhark_mc_task_127276 futhark_mc_task_127276_;
            
            futhark_mc_task_127276_.ctx = ctx;
            futhark_mc_task_127276_.free_m_34110 = m_34110;
            futhark_mc_task_127276_.free_d_34111 = d_34111;
            futhark_mc_task_127276_.free_gtid_103831 = gtid_103831;
            futhark_mc_task_127276_.free_pt_clouds_mem_111707 = pt_clouds_mem_111707.mem;
            futhark_mc_task_127276_.free_mem_111743 = mem_111743.mem;
            futhark_mc_task_127276_.free_gtid_114782 = gtid_114782;
            
            struct scheduler_segop futhark_mc_task_127276_task;
            
            futhark_mc_task_127276_task.args = &futhark_mc_task_127276_;
            futhark_mc_task_127276_task.top_level_fn = futhark_mc_segmap_task_127277;
            futhark_mc_task_127276_task.name = "futhark_mc_segmap_task_127277";
            futhark_mc_task_127276_task.iterations = m_34110;
            futhark_mc_task_127276_task.task_time = &ctx->program->futhark_mc_segmap_task_127277_total_time;
            futhark_mc_task_127276_task.task_iter = &ctx->program->futhark_mc_segmap_task_127277_total_iter;
            futhark_mc_task_127276_task.sched = STATIC;
            futhark_mc_task_127276_task.nested_fn = futhark_mc_segmap_nested_task_127283;
            
            int futhark_mc_segmap_task_127277_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127276_task);
            
            if (futhark_mc_segmap_task_127277_err != 0) {
                err = futhark_mc_segmap_task_127277_err;
                goto cleanup;
            }
        }
    }
    
  cleanup:
    { }
    if (event_127297 != NULL) {
        event_127297->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127275", strdup("nothing further"), event_127297, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_nested_task_127273(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127266 *futhark_mc_task_127266 = (struct futhark_mc_task_127266 *) args;
    struct futhark_context *ctx = futhark_mc_task_127266->ctx;
    struct mc_event *event_127299 = mc_event_new(ctx);
    
    if (event_127299 != NULL)
        event_127299->bef = get_wall_time();
    
    int64_t m_34110 = futhark_mc_task_127266->free_m_34110;
    int64_t d_34111 = futhark_mc_task_127266->free_d_34111;
    int64_t gtid_103831 = futhark_mc_task_127266->free_gtid_103831;
    struct memblock pt_clouds_mem_111707 = {.desc ="pt_clouds_mem_111707", .mem =futhark_mc_task_127266->free_pt_clouds_mem_111707, .size =0, .references =NULL};
    struct memblock mem_111720 = {.desc ="mem_111720", .mem =futhark_mc_task_127266->free_mem_111720, .size =0, .references =NULL};
    struct memblock mem_111743 = {.desc ="mem_111743", .mem =futhark_mc_task_127266->free_mem_111743, .size =0, .references =NULL};
    int32_t nsubtasks_114851;
    
    nsubtasks_114851 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_127274 futhark_mc_segmap_parloop_struct_127274_;
    
    futhark_mc_segmap_parloop_struct_127274_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_127274_.free_m_34110 = m_34110;
    futhark_mc_segmap_parloop_struct_127274_.free_d_34111 = d_34111;
    futhark_mc_segmap_parloop_struct_127274_.free_gtid_103831 = gtid_103831;
    futhark_mc_segmap_parloop_struct_127274_.free_pt_clouds_mem_111707 = pt_clouds_mem_111707.mem;
    futhark_mc_segmap_parloop_struct_127274_.free_mem_111743 = mem_111743.mem;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_127275_task;
    
    futhark_mc_segmap_parloop_127275_task.name = "futhark_mc_segmap_parloop_127275";
    futhark_mc_segmap_parloop_127275_task.fn = futhark_mc_segmap_parloop_127275;
    futhark_mc_segmap_parloop_127275_task.args = &futhark_mc_segmap_parloop_struct_127274_;
    futhark_mc_segmap_parloop_127275_task.iterations = iterations;
    futhark_mc_segmap_parloop_127275_task.info = info;
    
    struct mc_event *event_127298 = mc_event_new(ctx);
    
    if (event_127298 != NULL)
        event_127298->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_127275_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_127275_task);
    
    if (futhark_mc_segmap_parloop_127275_err != 0) {
        err = futhark_mc_segmap_parloop_127275_err;
        goto cleanup;
    }
    if (event_127298 != NULL) {
        event_127298->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127275_total", strdup("nothing further"), event_127298, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_127299 != NULL) {
        event_127299->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_nested_task_127273", strdup("nothing further"), event_127299, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
static int futhark_mc_segmap_parloop_127264(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_127263 *futhark_mc_segmap_parloop_struct_127263 = (struct futhark_mc_segmap_parloop_struct_127263 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_127263->ctx;
    struct mc_event *event_127300 = mc_event_new(ctx);
    
    if (event_127300 != NULL)
        event_127300->bef = get_wall_time();
    
    int64_t k_34109 = futhark_mc_segmap_parloop_struct_127263->free_k_34109;
    int64_t m_34110 = futhark_mc_segmap_parloop_struct_127263->free_m_34110;
    int64_t d_34111 = futhark_mc_segmap_parloop_struct_127263->free_d_34111;
    struct memblock pt_clouds_mem_111707 = {.desc ="pt_clouds_mem_111707", .mem =futhark_mc_segmap_parloop_struct_127263->free_pt_clouds_mem_111707, .size =0, .references =NULL};
    int64_t bytes_111719 = futhark_mc_segmap_parloop_struct_127263->free_bytes_111719;
    struct memblock mem_111743 = {.desc ="mem_111743", .mem =futhark_mc_segmap_parloop_struct_127263->free_mem_111743, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t mem_111720_cached_sizze_127265 = 0;
    unsigned char *mem_111720 = NULL;
    int64_t flat_tid_103830;
    
    flat_tid_103830 = subtask_id;
    {
        int64_t start_114824;
        int64_t end_114825;
        
        start_114824 = start;
        end_114825 = end;
        
        int64_t n_114826 = end_114825 - start_114824;
        
        if (mem_111720_cached_sizze_127265 < bytes_111719) {
            err = lexical_realloc(ctx, &mem_111720, &mem_111720_cached_sizze_127265, bytes_111719);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        for (int64_t SegMap_i_114827 = start_114824; SegMap_i_114827 < start_114824 + n_114826; SegMap_i_114827++) {
            int64_t slice_114828 = k_34109;
            int64_t gtid_103831 = SegMap_i_114827;
            int64_t remnant_114829 = SegMap_i_114827 - gtid_103831;
            int64_t flat_tid_114808 = (int64_t) 0;
            int64_t flat_tid_114781 = (int64_t) 0;
            struct futhark_mc_task_127266 futhark_mc_task_127266_;
            
            futhark_mc_task_127266_.ctx = ctx;
            futhark_mc_task_127266_.free_m_34110 = m_34110;
            futhark_mc_task_127266_.free_d_34111 = d_34111;
            futhark_mc_task_127266_.free_gtid_103831 = gtid_103831;
            futhark_mc_task_127266_.free_pt_clouds_mem_111707 = pt_clouds_mem_111707.mem;
            futhark_mc_task_127266_.free_mem_111720 = mem_111720;
            futhark_mc_task_127266_.free_mem_111743 = mem_111743.mem;
            
            struct scheduler_segop futhark_mc_task_127266_task;
            
            futhark_mc_task_127266_task.args = &futhark_mc_task_127266_;
            futhark_mc_task_127266_task.top_level_fn = futhark_mc_segmap_task_127267;
            futhark_mc_task_127266_task.name = "futhark_mc_segmap_task_127267";
            futhark_mc_task_127266_task.iterations = m_34110;
            futhark_mc_task_127266_task.task_time = &ctx->program->futhark_mc_segmap_task_127267_total_time;
            futhark_mc_task_127266_task.task_iter = &ctx->program->futhark_mc_segmap_task_127267_total_iter;
            futhark_mc_task_127266_task.sched = STATIC;
            futhark_mc_task_127266_task.nested_fn = futhark_mc_segmap_nested_task_127273;
            
            int futhark_mc_segmap_task_127267_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127266_task);
            
            if (futhark_mc_segmap_task_127267_err != 0) {
                err = futhark_mc_segmap_task_127267_err;
                goto cleanup;
            }
        }
    }
    
  cleanup:
    {
        free(mem_111720);
    }
    if (event_127300 != NULL) {
        event_127300->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127264", strdup("nothing further"), event_127300, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_nested_task_127262(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127255 *futhark_mc_task_127255 = (struct futhark_mc_task_127255 *) args;
    struct futhark_context *ctx = futhark_mc_task_127255->ctx;
    struct mc_event *event_127302 = mc_event_new(ctx);
    
    if (event_127302 != NULL)
        event_127302->bef = get_wall_time();
    
    int64_t k_34109 = futhark_mc_task_127255->free_k_34109;
    int64_t m_34110 = futhark_mc_task_127255->free_m_34110;
    int64_t d_34111 = futhark_mc_task_127255->free_d_34111;
    struct memblock pt_clouds_mem_111707 = {.desc ="pt_clouds_mem_111707", .mem =futhark_mc_task_127255->free_pt_clouds_mem_111707, .size =0, .references =NULL};
    int64_t bytes_111719 = futhark_mc_task_127255->free_bytes_111719;
    struct memblock mem_111743 = {.desc ="mem_111743", .mem =futhark_mc_task_127255->free_mem_111743, .size =0, .references =NULL};
    int32_t nsubtasks_114780;
    
    nsubtasks_114780 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_127263 futhark_mc_segmap_parloop_struct_127263_;
    
    futhark_mc_segmap_parloop_struct_127263_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_127263_.free_k_34109 = k_34109;
    futhark_mc_segmap_parloop_struct_127263_.free_m_34110 = m_34110;
    futhark_mc_segmap_parloop_struct_127263_.free_d_34111 = d_34111;
    futhark_mc_segmap_parloop_struct_127263_.free_pt_clouds_mem_111707 = pt_clouds_mem_111707.mem;
    futhark_mc_segmap_parloop_struct_127263_.free_bytes_111719 = bytes_111719;
    futhark_mc_segmap_parloop_struct_127263_.free_mem_111743 = mem_111743.mem;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_127264_task;
    
    futhark_mc_segmap_parloop_127264_task.name = "futhark_mc_segmap_parloop_127264";
    futhark_mc_segmap_parloop_127264_task.fn = futhark_mc_segmap_parloop_127264;
    futhark_mc_segmap_parloop_127264_task.args = &futhark_mc_segmap_parloop_struct_127263_;
    futhark_mc_segmap_parloop_127264_task.iterations = iterations;
    futhark_mc_segmap_parloop_127264_task.info = info;
    
    struct mc_event *event_127301 = mc_event_new(ctx);
    
    if (event_127301 != NULL)
        event_127301->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_127264_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_127264_task);
    
    if (futhark_mc_segmap_parloop_127264_err != 0) {
        err = futhark_mc_segmap_parloop_127264_err;
        goto cleanup;
    }
    if (event_127301 != NULL) {
        event_127301->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127264_total", strdup("nothing further"), event_127301, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_127302 != NULL) {
        event_127302->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_nested_task_127262", strdup("nothing further"), event_127302, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_127319 {
    struct futhark_context *ctx;
    int64_t free_k_33387;
    int64_t free_zm_lhs_34592;
    unsigned char *free_mem_111710;
    unsigned char *free_mem_111712;
};
struct futhark_mc_scan_stage_1_parloop_struct_127322 {
    struct futhark_context *ctx;
    int64_t free_zm_lhs_34592;
    unsigned char *free_mem_111710;
    unsigned char *free_mem_111712;
};
static int futhark_mc_scan_stage_1_parloop_127323(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_scan_stage_1_parloop_struct_127322 *futhark_mc_scan_stage_1_parloop_struct_127322 = (struct futhark_mc_scan_stage_1_parloop_struct_127322 *) args;
    struct futhark_context *ctx = futhark_mc_scan_stage_1_parloop_struct_127322->ctx;
    struct mc_event *event_127324 = mc_event_new(ctx);
    
    if (event_127324 != NULL)
        event_127324->bef = get_wall_time();
    
    int64_t zm_lhs_34592 = futhark_mc_scan_stage_1_parloop_struct_127322->free_zm_lhs_34592;
    struct memblock mem_111710 = {.desc ="mem_111710", .mem =futhark_mc_scan_stage_1_parloop_struct_127322->free_mem_111710, .size =0, .references =NULL};
    struct memblock mem_111712 = {.desc ="mem_111712", .mem =futhark_mc_scan_stage_1_parloop_struct_127322->free_mem_111712, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_103880;
    
    flat_tid_103880 = subtask_id;
    
    int64_t eta_p_34602;
    int64_t eta_p_34603;
    
    eta_p_34602 = (int64_t) 0;
    {
        int64_t start_114754;
        int64_t end_114755;
        
        start_114754 = start;
        end_114755 = end;
        
        int64_t n_114756 = end_114755 - start_114754;
        
        for (int64_t SegScan_i_114757 = start_114754; SegScan_i_114757 < start_114754 + n_114756; SegScan_i_114757++) {
            int64_t gtid_103881 = SegScan_i_114757;
            int64_t lifted_lambda_res_66902 = sub64(zm_lhs_34592, gtid_103881);
            
            // write mapped values results to memory
            {
                ((int64_t *) mem_111712.mem)[gtid_103881] = lifted_lambda_res_66902;
            }
            // Apply scan op
            {
                int64_t uni_i_114758 = 0;
                
                {
                    // Read accumulator
                    {
                        eta_p_34602 = eta_p_34602;
                    }
                    // Read next values
                    {
                        eta_p_34603 = lifted_lambda_res_66902;
                    }
                    // Scan op body
                    {
                        int64_t defunc_0_op_res_34604 = add64(eta_p_34602, eta_p_34603);
                        
                        ((int64_t *) mem_111710.mem)[gtid_103881] = defunc_0_op_res_34604;
                        eta_p_34602 = defunc_0_op_res_34604;
                    }
                }
            }
        }
    }
    
  cleanup:
    { }
    if (event_127324 != NULL) {
        event_127324->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_scan_stage_1_parloop_127323", strdup("nothing further"), event_127324, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
struct futhark_mc_scan_stage_3_parloop_struct_127326 {
    struct futhark_context *ctx;
    unsigned char *free_mem_111710;
    unsigned char *free_scan_stage_2_carry_mem_114764;
};
static int futhark_mc_scan_stage_3_parloop_127327(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_scan_stage_3_parloop_struct_127326 *futhark_mc_scan_stage_3_parloop_struct_127326 = (struct futhark_mc_scan_stage_3_parloop_struct_127326 *) args;
    struct futhark_context *ctx = futhark_mc_scan_stage_3_parloop_struct_127326->ctx;
    struct mc_event *event_127328 = mc_event_new(ctx);
    
    if (event_127328 != NULL)
        event_127328->bef = get_wall_time();
    
    struct memblock mem_111710 = {.desc ="mem_111710", .mem =futhark_mc_scan_stage_3_parloop_struct_127326->free_mem_111710, .size =0, .references =NULL};
    struct memblock scan_stage_2_carry_mem_114764 = {.desc ="scan_stage_2_carry_mem_114764", .mem =futhark_mc_scan_stage_3_parloop_struct_127326->free_scan_stage_2_carry_mem_114764, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_103880;
    
    flat_tid_103880 = subtask_id;
    {
        int64_t eta_p_114767;
        int64_t eta_p_114768;
        
        // load carry-in
        {
            eta_p_114767 = ((int64_t *) scan_stage_2_carry_mem_114764.mem)[flat_tid_103880];
        }
        
        int64_t start_114770;
        int64_t end_114771;
        
        start_114770 = start;
        end_114771 = end;
        
        int64_t n_114772 = end_114771 - start_114770;
        
        for (int64_t SegScan_i_114773 = start_114770; SegScan_i_114773 < start_114770 + n_114772; SegScan_i_114773++) {
            int64_t gtid_103881 = SegScan_i_114773;
            
            // load partial result
            {
                eta_p_114768 = ((int64_t *) mem_111710.mem)[gtid_103881];
            }
            // combine carry with partial result
            {
                int64_t defunc_0_op_res_114769 = add64(eta_p_114767, eta_p_114768);
                
                ((int64_t *) mem_111710.mem)[gtid_103881] = defunc_0_op_res_114769;
            }
        }
    }
    
  cleanup:
    { }
    if (event_127328 != NULL) {
        event_127328->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_scan_stage_3_parloop_127327", strdup("nothing further"), event_127328, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segscan_task_127320(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127319 *futhark_mc_task_127319 = (struct futhark_mc_task_127319 *) args;
    struct futhark_context *ctx = futhark_mc_task_127319->ctx;
    struct mc_event *event_127330 = mc_event_new(ctx);
    
    if (event_127330 != NULL)
        event_127330->bef = get_wall_time();
    
    int64_t k_33387 = futhark_mc_task_127319->free_k_33387;
    int64_t zm_lhs_34592 = futhark_mc_task_127319->free_zm_lhs_34592;
    struct memblock mem_111710 = {.desc ="mem_111710", .mem =futhark_mc_task_127319->free_mem_111710, .size =0, .references =NULL};
    struct memblock mem_111712 = {.desc ="mem_111712", .mem =futhark_mc_task_127319->free_mem_111712, .size =0, .references =NULL};
    int64_t scan_stage_2_carry_mem_114764_cached_sizze_127321 = 0;
    unsigned char *scan_stage_2_carry_mem_114764 = NULL;
    int32_t nsubtasks_114753;
    
    nsubtasks_114753 = info.nsubtasks;
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "nonsegmented segScan");
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "Scan stage 1");
    
    struct futhark_mc_scan_stage_1_parloop_struct_127322 futhark_mc_scan_stage_1_parloop_struct_127322_;
    
    futhark_mc_scan_stage_1_parloop_struct_127322_.ctx = ctx;
    futhark_mc_scan_stage_1_parloop_struct_127322_.free_zm_lhs_34592 = zm_lhs_34592;
    futhark_mc_scan_stage_1_parloop_struct_127322_.free_mem_111710 = mem_111710.mem;
    futhark_mc_scan_stage_1_parloop_struct_127322_.free_mem_111712 = mem_111712.mem;
    
    struct scheduler_parloop futhark_mc_scan_stage_1_parloop_127323_task;
    
    futhark_mc_scan_stage_1_parloop_127323_task.name = "futhark_mc_scan_stage_1_parloop_127323";
    futhark_mc_scan_stage_1_parloop_127323_task.fn = futhark_mc_scan_stage_1_parloop_127323;
    futhark_mc_scan_stage_1_parloop_127323_task.args = &futhark_mc_scan_stage_1_parloop_struct_127322_;
    futhark_mc_scan_stage_1_parloop_127323_task.iterations = iterations;
    futhark_mc_scan_stage_1_parloop_127323_task.info = info;
    
    struct mc_event *event_127325 = mc_event_new(ctx);
    
    if (event_127325 != NULL)
        event_127325->bef = get_wall_time();
    
    int futhark_mc_scan_stage_1_parloop_127323_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_scan_stage_1_parloop_127323_task);
    
    if (futhark_mc_scan_stage_1_parloop_127323_err != 0) {
        err = futhark_mc_scan_stage_1_parloop_127323_err;
        goto cleanup;
    }
    if (event_127325 != NULL) {
        event_127325->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_scan_stage_1_parloop_127323_total", strdup("nothing further"), event_127325, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (slt32(1, nsubtasks_114753)) {
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "Scan stage 2");
        
        int64_t eta_p_114759;
        int64_t eta_p_114760;
        int64_t offset_114762 = (int64_t) 0;
        int64_t offset_index_114763 = (int64_t) 0;
        
        if (scan_stage_2_carry_mem_114764_cached_sizze_127321 < (int64_t) 8 * nsubtasks_114753) {
            err = lexical_realloc(ctx, &scan_stage_2_carry_mem_114764, &scan_stage_2_carry_mem_114764_cached_sizze_127321, (int64_t) 8 * nsubtasks_114753);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        // carry-in for first chunk is neutral
        {
            ((int64_t *) scan_stage_2_carry_mem_114764)[(int64_t) 0] = (int64_t) 0;
        }
        // scan carries
        {
            for (int64_t i_114766 = 0; i_114766 < sext_i32_i64(nsubtasks_114753) - (int64_t) 1; i_114766++) {
                offset_114762 = squot64(k_33387, sext_i32_i64(nsubtasks_114753));
                if (slt64(i_114766, srem64(k_33387, sext_i32_i64(nsubtasks_114753)))) {
                    offset_114762 += (int64_t) 1;
                }
                offset_index_114763 += offset_114762;
                
                int64_t gtid_103881 = offset_index_114763;
                
                // Read carry
                {
                    eta_p_114759 = ((int64_t *) scan_stage_2_carry_mem_114764)[i_114766];
                }
                // Read next values
                {
                    eta_p_114760 = ((int64_t *) mem_111710.mem)[offset_index_114763 - (int64_t) 1];
                }
                
                int64_t defunc_0_op_res_114761 = add64(eta_p_114759, eta_p_114760);
                
                ((int64_t *) scan_stage_2_carry_mem_114764)[i_114766 + (int64_t) 1] = defunc_0_op_res_114761;
            }
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "Scan stage 3");
        
        struct futhark_mc_scan_stage_3_parloop_struct_127326 futhark_mc_scan_stage_3_parloop_struct_127326_;
        
        futhark_mc_scan_stage_3_parloop_struct_127326_.ctx = ctx;
        futhark_mc_scan_stage_3_parloop_struct_127326_.free_mem_111710 = mem_111710.mem;
        futhark_mc_scan_stage_3_parloop_struct_127326_.free_scan_stage_2_carry_mem_114764 = scan_stage_2_carry_mem_114764;
        
        struct scheduler_parloop futhark_mc_scan_stage_3_parloop_127327_task;
        
        futhark_mc_scan_stage_3_parloop_127327_task.name = "futhark_mc_scan_stage_3_parloop_127327";
        futhark_mc_scan_stage_3_parloop_127327_task.fn = futhark_mc_scan_stage_3_parloop_127327;
        futhark_mc_scan_stage_3_parloop_127327_task.args = &futhark_mc_scan_stage_3_parloop_struct_127326_;
        futhark_mc_scan_stage_3_parloop_127327_task.iterations = iterations;
        futhark_mc_scan_stage_3_parloop_127327_task.info = info;
        
        struct mc_event *event_127329 = mc_event_new(ctx);
        
        if (event_127329 != NULL)
            event_127329->bef = get_wall_time();
        
        int futhark_mc_scan_stage_3_parloop_127327_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_scan_stage_3_parloop_127327_task);
        
        if (futhark_mc_scan_stage_3_parloop_127327_err != 0) {
            err = futhark_mc_scan_stage_3_parloop_127327_err;
            goto cleanup;
        }
        if (event_127329 != NULL) {
            event_127329->aft = get_wall_time();
            lock_lock(&ctx->event_list_lock);
            add_event(ctx, "futhark_mc_scan_stage_3_parloop_127327_total", strdup("nothing further"), event_127329, (event_report_fn) mc_event_report);
            lock_unlock(&ctx->event_list_lock);
        }
    }
    
  cleanup:
    {
        free(scan_stage_2_carry_mem_114764);
    }
    if (event_127330 != NULL) {
        event_127330->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segscan_task_127320", strdup("nothing further"), event_127330, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_127331 {
    struct futhark_context *ctx;
    int64_t free_flat_tid_103882;
    unsigned char *free_mem_111712;
    int64_t *retval_defunc_0_reduce_res_103765;
};
struct futhark_mc_segred_stage_1_parloop_struct_127334 {
    struct futhark_context *ctx;
    unsigned char *free_mem_111712;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_114775;
};
static int futhark_mc_segred_stage_1_parloop_127335(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127334 *futhark_mc_segred_stage_1_parloop_struct_127334 = (struct futhark_mc_segred_stage_1_parloop_struct_127334 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127334->ctx;
    struct mc_event *event_127336 = mc_event_new(ctx);
    
    if (event_127336 != NULL)
        event_127336->bef = get_wall_time();
    
    struct memblock mem_111712 = {.desc ="mem_111712", .mem =futhark_mc_segred_stage_1_parloop_struct_127334->free_mem_111712, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_114775 = {.desc ="reduce_stage_1_tid_res_arr_mem_114775", .mem =futhark_mc_segred_stage_1_parloop_struct_127334->free_reduce_stage_1_tid_res_arr_mem_114775, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_103882;
    
    flat_tid_103882 = subtask_id;
    {
        int64_t eta_p_114777;
        int64_t eta_p_114778;
        int64_t local_acc_114780 = (int64_t) 0;
        int64_t eta_p_34597;
        int64_t eta_p_34598;
        int64_t local_acc_114781 = (int64_t) 0;
        int64_t start_114782;
        int64_t end_114783;
        
        start_114782 = start;
        end_114783 = end;
        
        int64_t n_114784 = end_114783 - start_114782;
        
        for (int64_t SegRed_i_114785 = start_114782; SegRed_i_114785 < start_114782 + n_114784; SegRed_i_114785++) {
            int64_t gtid_103883 = SegRed_i_114785;
            int64_t x_103879 = ((int64_t *) mem_111712.mem)[gtid_103883];
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_34597 = local_acc_114781;
            }
            // Load next params
            {
                eta_p_34598 = x_103879;
            }
            // SegRed body
            {
                int64_t defunc_0_op_res_34599 = add64(eta_p_34597, eta_p_34598);
                
                local_acc_114781 = defunc_0_op_res_34599;
            }
        }
        
        int64_t uni_i_114786 = 0;
        
        {
            int64_t gtid_103883 = uni_i_114786;
            
            // Load accum params
            {
                eta_p_114777 = local_acc_114780;
            }
            // Load next params
            {
                eta_p_114778 = local_acc_114781;
            }
            // SegRed body
            {
                int64_t defunc_0_op_res_114779 = add64(eta_p_114777, eta_p_114778);
                
                local_acc_114780 = defunc_0_op_res_114779;
            }
        }
        ((int64_t *) reduce_stage_1_tid_res_arr_mem_114775.mem)[flat_tid_103882] = local_acc_114780;
    }
    
  cleanup:
    { }
    if (event_127336 != NULL) {
        event_127336->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127335", strdup("nothing further"), event_127336, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127332(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127331 *futhark_mc_task_127331 = (struct futhark_mc_task_127331 *) args;
    struct futhark_context *ctx = futhark_mc_task_127331->ctx;
    struct mc_event *event_127338 = mc_event_new(ctx);
    
    if (event_127338 != NULL)
        event_127338->bef = get_wall_time();
    
    int64_t flat_tid_103882 = futhark_mc_task_127331->free_flat_tid_103882;
    struct memblock mem_111712 = {.desc ="mem_111712", .mem =futhark_mc_task_127331->free_mem_111712, .size =0, .references =NULL};
    int64_t defunc_0_reduce_res_103765 = *futhark_mc_task_127331->retval_defunc_0_reduce_res_103765;
    int64_t reduce_stage_1_tid_res_arr_mem_114775_cached_sizze_127333 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_114775 = NULL;
    int32_t nsubtasks_114774;
    
    nsubtasks_114774 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_114775_cached_sizze_127333 < (int64_t) 8 * nsubtasks_114774) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_114775, &reduce_stage_1_tid_res_arr_mem_114775_cached_sizze_127333, (int64_t) 8 * nsubtasks_114774);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127334 futhark_mc_segred_stage_1_parloop_struct_127334_;
    
    futhark_mc_segred_stage_1_parloop_struct_127334_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127334_.free_mem_111712 = mem_111712.mem;
    futhark_mc_segred_stage_1_parloop_struct_127334_.free_reduce_stage_1_tid_res_arr_mem_114775 = reduce_stage_1_tid_res_arr_mem_114775;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127335_task;
    
    futhark_mc_segred_stage_1_parloop_127335_task.name = "futhark_mc_segred_stage_1_parloop_127335";
    futhark_mc_segred_stage_1_parloop_127335_task.fn = futhark_mc_segred_stage_1_parloop_127335;
    futhark_mc_segred_stage_1_parloop_127335_task.args = &futhark_mc_segred_stage_1_parloop_struct_127334_;
    futhark_mc_segred_stage_1_parloop_127335_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127335_task.info = info;
    
    struct mc_event *event_127337 = mc_event_new(ctx);
    
    if (event_127337 != NULL)
        event_127337->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127335_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127335_task);
    
    if (futhark_mc_segred_stage_1_parloop_127335_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127335_err;
        goto cleanup;
    }
    if (event_127337 != NULL) {
        event_127337->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127335_total", strdup("nothing further"), event_127337, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_103765 = (int64_t) 0;
    }
    
    int64_t eta_p_114787;
    int64_t eta_p_114788;
    
    for (int32_t i_114790 = 0; i_114790 < nsubtasks_114774; i_114790++) {
        flat_tid_103882 = i_114790;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_114787 = defunc_0_reduce_res_103765;
            }
            // load next params
            {
                eta_p_114788 = ((int64_t *) reduce_stage_1_tid_res_arr_mem_114775)[flat_tid_103882];
            }
            // red body
            {
                int64_t defunc_0_op_res_114789 = add64(eta_p_114787, eta_p_114788);
                
                defunc_0_reduce_res_103765 = defunc_0_op_res_114789;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_114775);
    }
    if (event_127338 != NULL) {
        event_127338->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127332", strdup("nothing further"), event_127338, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127331->retval_defunc_0_reduce_res_103765 = defunc_0_reduce_res_103765;
    }
    return err;
}
struct futhark_mc_task_127339 {
    struct futhark_context *ctx;
    int64_t free_k_33387;
    int64_t free_defunc_0_reduce_res_103765;
    unsigned char *free_mem_111710;
    unsigned char *free_mem_111714;
};
struct futhark_mc_segmap_parloop_struct_127341 {
    struct futhark_context *ctx;
    int64_t free_k_33387;
    int64_t free_defunc_0_reduce_res_103765;
    unsigned char *free_mem_111710;
    unsigned char *free_mem_111714;
};
static int futhark_mc_segmap_parloop_127342(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_127341 *futhark_mc_segmap_parloop_struct_127341 = (struct futhark_mc_segmap_parloop_struct_127341 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_127341->ctx;
    struct mc_event *event_127343 = mc_event_new(ctx);
    
    if (event_127343 != NULL)
        event_127343->bef = get_wall_time();
    
    int64_t k_33387 = futhark_mc_segmap_parloop_struct_127341->free_k_33387;
    int64_t defunc_0_reduce_res_103765 = futhark_mc_segmap_parloop_struct_127341->free_defunc_0_reduce_res_103765;
    struct memblock mem_111710 = {.desc ="mem_111710", .mem =futhark_mc_segmap_parloop_struct_127341->free_mem_111710, .size =0, .references =NULL};
    struct memblock mem_111714 = {.desc ="mem_111714", .mem =futhark_mc_segmap_parloop_struct_127341->free_mem_111714, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_103884;
    
    flat_tid_103884 = subtask_id;
    {
        int64_t start_114799;
        int64_t end_114800;
        
        start_114799 = start;
        end_114800 = end;
        
        int64_t n_114801 = end_114800 - start_114799;
        
        for (int64_t SegMap_i_114802 = start_114799; SegMap_i_114802 < start_114799 + n_114801; SegMap_i_114802++) {
            int64_t slice_114803 = k_33387;
            int64_t gtid_103885 = SegMap_i_114802;
            int64_t remnant_114804 = SegMap_i_114802 - gtid_103885;
            bool cond_66886 = gtid_103885 == (int64_t) 0;
            int64_t lifted_lambda_res_66887;
            
            if (cond_66886) {
                lifted_lambda_res_66887 = (int64_t) 0;
            } else {
                int64_t tmp_114793 = sub64(gtid_103885, (int64_t) 1);
                bool x_114794 = sle64((int64_t) 0, tmp_114793);
                bool y_114795 = slt64(tmp_114793, k_33387);
                bool bounds_check_114796 = x_114794 && y_114795;
                bool index_certs_114797;
                
                if (!bounds_check_114796) {
                    set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) tmp_114793, "] out of bounds for array of shape [", (long long) k_33387, "].", "-> #0  unbalanced_gw.fut:13:45-52\n   #1  unbalanced_gw.fut:13:55-61\n   #2  unbalanced_gw.fut:151:3-16\n"));
                    err = FUTHARK_PROGRAM_ERROR;
                    goto cleanup;
                }
                
                int64_t lifted_lambda_res_f_res_114798 = ((int64_t *) mem_111710.mem)[tmp_114793];
                
                lifted_lambda_res_66887 = lifted_lambda_res_f_res_114798;
            }
            if (sle64((int64_t) 0, lifted_lambda_res_66887) && slt64(lifted_lambda_res_66887, defunc_0_reduce_res_103765)) {
                ((int64_t *) mem_111714.mem)[lifted_lambda_res_66887] = gtid_103885;
            }
        }
    }
    
  cleanup:
    { }
    if (event_127343 != NULL) {
        event_127343->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127342", strdup("nothing further"), event_127343, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_task_127340(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127339 *futhark_mc_task_127339 = (struct futhark_mc_task_127339 *) args;
    struct futhark_context *ctx = futhark_mc_task_127339->ctx;
    struct mc_event *event_127345 = mc_event_new(ctx);
    
    if (event_127345 != NULL)
        event_127345->bef = get_wall_time();
    
    int64_t k_33387 = futhark_mc_task_127339->free_k_33387;
    int64_t defunc_0_reduce_res_103765 = futhark_mc_task_127339->free_defunc_0_reduce_res_103765;
    struct memblock mem_111710 = {.desc ="mem_111710", .mem =futhark_mc_task_127339->free_mem_111710, .size =0, .references =NULL};
    struct memblock mem_111714 = {.desc ="mem_111714", .mem =futhark_mc_task_127339->free_mem_111714, .size =0, .references =NULL};
    int32_t nsubtasks_114792;
    
    nsubtasks_114792 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_127341 futhark_mc_segmap_parloop_struct_127341_;
    
    futhark_mc_segmap_parloop_struct_127341_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_127341_.free_k_33387 = k_33387;
    futhark_mc_segmap_parloop_struct_127341_.free_defunc_0_reduce_res_103765 = defunc_0_reduce_res_103765;
    futhark_mc_segmap_parloop_struct_127341_.free_mem_111710 = mem_111710.mem;
    futhark_mc_segmap_parloop_struct_127341_.free_mem_111714 = mem_111714.mem;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_127342_task;
    
    futhark_mc_segmap_parloop_127342_task.name = "futhark_mc_segmap_parloop_127342";
    futhark_mc_segmap_parloop_127342_task.fn = futhark_mc_segmap_parloop_127342;
    futhark_mc_segmap_parloop_127342_task.args = &futhark_mc_segmap_parloop_struct_127341_;
    futhark_mc_segmap_parloop_127342_task.iterations = iterations;
    futhark_mc_segmap_parloop_127342_task.info = info;
    
    struct mc_event *event_127344 = mc_event_new(ctx);
    
    if (event_127344 != NULL)
        event_127344->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_127342_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_127342_task);
    
    if (futhark_mc_segmap_parloop_127342_err != 0) {
        err = futhark_mc_segmap_parloop_127342_err;
        goto cleanup;
    }
    if (event_127344 != NULL) {
        event_127344->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127342_total", strdup("nothing further"), event_127344, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_127345 != NULL) {
        event_127345->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_task_127340", strdup("nothing further"), event_127345, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_127346 {
    struct futhark_context *ctx;
    int64_t free_defunc_0_reduce_res_103765;
    unsigned char *free_mem_111714;
    unsigned char *free_mem_111717;
    unsigned char *free_mem_111719;
    unsigned char *free_mem_111720;
};
struct futhark_mc_scan_stage_1_parloop_struct_127350 {
    struct futhark_context *ctx;
    unsigned char *free_mem_111714;
    unsigned char *free_mem_111717;
    unsigned char *free_mem_111719;
    unsigned char *free_mem_111720;
};
static int futhark_mc_scan_stage_1_parloop_127351(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_scan_stage_1_parloop_struct_127350 *futhark_mc_scan_stage_1_parloop_struct_127350 = (struct futhark_mc_scan_stage_1_parloop_struct_127350 *) args;
    struct futhark_context *ctx = futhark_mc_scan_stage_1_parloop_struct_127350->ctx;
    struct mc_event *event_127352 = mc_event_new(ctx);
    
    if (event_127352 != NULL)
        event_127352->bef = get_wall_time();
    
    struct memblock mem_111714 = {.desc ="mem_111714", .mem =futhark_mc_scan_stage_1_parloop_struct_127350->free_mem_111714, .size =0, .references =NULL};
    struct memblock mem_111717 = {.desc ="mem_111717", .mem =futhark_mc_scan_stage_1_parloop_struct_127350->free_mem_111717, .size =0, .references =NULL};
    struct memblock mem_111719 = {.desc ="mem_111719", .mem =futhark_mc_scan_stage_1_parloop_struct_127350->free_mem_111719, .size =0, .references =NULL};
    struct memblock mem_111720 = {.desc ="mem_111720", .mem =futhark_mc_scan_stage_1_parloop_struct_127350->free_mem_111720, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_103886;
    
    flat_tid_103886 = subtask_id;
    
    bool eta_p_63685;
    int64_t eta_p_63686;
    bool eta_p_63687;
    int64_t eta_p_63688;
    
    eta_p_63685 = 0;
    eta_p_63686 = (int64_t) 0;
    {
        int64_t start_114807;
        int64_t end_114808;
        
        start_114807 = start;
        end_114808 = end;
        
        int64_t n_114809 = end_114808 - start_114807;
        
        for (int64_t SegScan_i_114810 = start_114807; SegScan_i_114810 < start_114807 + n_114809; SegScan_i_114810++) {
            int64_t gtid_103887 = SegScan_i_114810;
            int64_t eta_p_73242 = ((int64_t *) mem_111714.mem)[gtid_103887];
            bool lifted_lambda_res_73244 = slt64((int64_t) 0, eta_p_73242);
            
            // write mapped values results to memory
            {
                ((bool *) mem_111720.mem)[gtid_103887] = lifted_lambda_res_73244;
            }
            // Apply scan op
            {
                int64_t uni_i_114811 = 0;
                
                {
                    // Read accumulator
                    {
                        eta_p_63685 = eta_p_63685;
                        eta_p_63686 = eta_p_63686;
                    }
                    // Read next values
                    {
                        eta_p_63687 = lifted_lambda_res_73244;
                        eta_p_63688 = (int64_t) 1;
                    }
                    // Scan op body
                    {
                        bool tmp_63689 = eta_p_63685 || eta_p_63687;
                        int64_t tmp_63690;
                        
                        if (eta_p_63687) {
                            tmp_63690 = eta_p_63688;
                        } else {
                            int64_t defunc_0_op_res_63691 = add64(eta_p_63686, eta_p_63688);
                            
                            tmp_63690 = defunc_0_op_res_63691;
                        }
                        ((bool *) mem_111717.mem)[gtid_103887] = tmp_63689;
                        eta_p_63685 = tmp_63689;
                        ((int64_t *) mem_111719.mem)[gtid_103887] = tmp_63690;
                        eta_p_63686 = tmp_63690;
                    }
                }
            }
        }
    }
    
  cleanup:
    { }
    if (event_127352 != NULL) {
        event_127352->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_scan_stage_1_parloop_127351", strdup("nothing further"), event_127352, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
struct futhark_mc_scan_stage_3_parloop_struct_127354 {
    struct futhark_context *ctx;
    unsigned char *free_mem_111717;
    unsigned char *free_mem_111719;
    unsigned char *free_scan_stage_2_carry_mem_114821;
    unsigned char *free_scan_stage_2_carry_mem_114823;
};
static int futhark_mc_scan_stage_3_parloop_127355(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_scan_stage_3_parloop_struct_127354 *futhark_mc_scan_stage_3_parloop_struct_127354 = (struct futhark_mc_scan_stage_3_parloop_struct_127354 *) args;
    struct futhark_context *ctx = futhark_mc_scan_stage_3_parloop_struct_127354->ctx;
    struct mc_event *event_127356 = mc_event_new(ctx);
    
    if (event_127356 != NULL)
        event_127356->bef = get_wall_time();
    
    struct memblock mem_111717 = {.desc ="mem_111717", .mem =futhark_mc_scan_stage_3_parloop_struct_127354->free_mem_111717, .size =0, .references =NULL};
    struct memblock mem_111719 = {.desc ="mem_111719", .mem =futhark_mc_scan_stage_3_parloop_struct_127354->free_mem_111719, .size =0, .references =NULL};
    struct memblock scan_stage_2_carry_mem_114821 = {.desc ="scan_stage_2_carry_mem_114821", .mem =futhark_mc_scan_stage_3_parloop_struct_127354->free_scan_stage_2_carry_mem_114821, .size =0, .references =NULL};
    struct memblock scan_stage_2_carry_mem_114823 = {.desc ="scan_stage_2_carry_mem_114823", .mem =futhark_mc_scan_stage_3_parloop_struct_127354->free_scan_stage_2_carry_mem_114823, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_103886;
    
    flat_tid_103886 = subtask_id;
    {
        bool eta_p_114826;
        int64_t eta_p_114827;
        bool eta_p_114828;
        int64_t eta_p_114829;
        
        // load carry-in
        {
            eta_p_114826 = ((bool *) scan_stage_2_carry_mem_114821.mem)[flat_tid_103886];
            eta_p_114827 = ((int64_t *) scan_stage_2_carry_mem_114823.mem)[flat_tid_103886];
        }
        
        int64_t start_114833;
        int64_t end_114834;
        
        start_114833 = start;
        end_114834 = end;
        
        int64_t n_114835 = end_114834 - start_114833;
        
        for (int64_t SegScan_i_114836 = start_114833; SegScan_i_114836 < start_114833 + n_114835; SegScan_i_114836++) {
            int64_t gtid_103887 = SegScan_i_114836;
            
            // load partial result
            {
                eta_p_114828 = ((bool *) mem_111717.mem)[gtid_103887];
                eta_p_114829 = ((int64_t *) mem_111719.mem)[gtid_103887];
            }
            // combine carry with partial result
            {
                bool tmp_114830 = eta_p_114826 || eta_p_114828;
                int64_t tmp_114831;
                
                if (eta_p_114828) {
                    tmp_114831 = eta_p_114829;
                } else {
                    int64_t defunc_0_op_res_114832 = add64(eta_p_114827, eta_p_114829);
                    
                    tmp_114831 = defunc_0_op_res_114832;
                }
                ((bool *) mem_111717.mem)[gtid_103887] = tmp_114830;
                ((int64_t *) mem_111719.mem)[gtid_103887] = tmp_114831;
            }
        }
    }
    
  cleanup:
    { }
    if (event_127356 != NULL) {
        event_127356->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_scan_stage_3_parloop_127355", strdup("nothing further"), event_127356, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segscan_task_127347(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127346 *futhark_mc_task_127346 = (struct futhark_mc_task_127346 *) args;
    struct futhark_context *ctx = futhark_mc_task_127346->ctx;
    struct mc_event *event_127358 = mc_event_new(ctx);
    
    if (event_127358 != NULL)
        event_127358->bef = get_wall_time();
    
    int64_t defunc_0_reduce_res_103765 = futhark_mc_task_127346->free_defunc_0_reduce_res_103765;
    struct memblock mem_111714 = {.desc ="mem_111714", .mem =futhark_mc_task_127346->free_mem_111714, .size =0, .references =NULL};
    struct memblock mem_111717 = {.desc ="mem_111717", .mem =futhark_mc_task_127346->free_mem_111717, .size =0, .references =NULL};
    struct memblock mem_111719 = {.desc ="mem_111719", .mem =futhark_mc_task_127346->free_mem_111719, .size =0, .references =NULL};
    struct memblock mem_111720 = {.desc ="mem_111720", .mem =futhark_mc_task_127346->free_mem_111720, .size =0, .references =NULL};
    int64_t scan_stage_2_carry_mem_114821_cached_sizze_127348 = 0;
    unsigned char *scan_stage_2_carry_mem_114821 = NULL;
    int64_t scan_stage_2_carry_mem_114823_cached_sizze_127349 = 0;
    unsigned char *scan_stage_2_carry_mem_114823 = NULL;
    int32_t nsubtasks_114806;
    
    nsubtasks_114806 = info.nsubtasks;
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "nonsegmented segScan");
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "Scan stage 1");
    
    struct futhark_mc_scan_stage_1_parloop_struct_127350 futhark_mc_scan_stage_1_parloop_struct_127350_;
    
    futhark_mc_scan_stage_1_parloop_struct_127350_.ctx = ctx;
    futhark_mc_scan_stage_1_parloop_struct_127350_.free_mem_111714 = mem_111714.mem;
    futhark_mc_scan_stage_1_parloop_struct_127350_.free_mem_111717 = mem_111717.mem;
    futhark_mc_scan_stage_1_parloop_struct_127350_.free_mem_111719 = mem_111719.mem;
    futhark_mc_scan_stage_1_parloop_struct_127350_.free_mem_111720 = mem_111720.mem;
    
    struct scheduler_parloop futhark_mc_scan_stage_1_parloop_127351_task;
    
    futhark_mc_scan_stage_1_parloop_127351_task.name = "futhark_mc_scan_stage_1_parloop_127351";
    futhark_mc_scan_stage_1_parloop_127351_task.fn = futhark_mc_scan_stage_1_parloop_127351;
    futhark_mc_scan_stage_1_parloop_127351_task.args = &futhark_mc_scan_stage_1_parloop_struct_127350_;
    futhark_mc_scan_stage_1_parloop_127351_task.iterations = iterations;
    futhark_mc_scan_stage_1_parloop_127351_task.info = info;
    
    struct mc_event *event_127353 = mc_event_new(ctx);
    
    if (event_127353 != NULL)
        event_127353->bef = get_wall_time();
    
    int futhark_mc_scan_stage_1_parloop_127351_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_scan_stage_1_parloop_127351_task);
    
    if (futhark_mc_scan_stage_1_parloop_127351_err != 0) {
        err = futhark_mc_scan_stage_1_parloop_127351_err;
        goto cleanup;
    }
    if (event_127353 != NULL) {
        event_127353->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_scan_stage_1_parloop_127351_total", strdup("nothing further"), event_127353, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (slt32(1, nsubtasks_114806)) {
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "Scan stage 2");
        
        bool eta_p_114812;
        int64_t eta_p_114813;
        bool eta_p_114814;
        int64_t eta_p_114815;
        int64_t offset_114819 = (int64_t) 0;
        int64_t offset_index_114820 = (int64_t) 0;
        
        if (scan_stage_2_carry_mem_114821_cached_sizze_127348 < nsubtasks_114806) {
            err = lexical_realloc(ctx, &scan_stage_2_carry_mem_114821, &scan_stage_2_carry_mem_114821_cached_sizze_127348, nsubtasks_114806);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (scan_stage_2_carry_mem_114823_cached_sizze_127349 < (int64_t) 8 * nsubtasks_114806) {
            err = lexical_realloc(ctx, &scan_stage_2_carry_mem_114823, &scan_stage_2_carry_mem_114823_cached_sizze_127349, (int64_t) 8 * nsubtasks_114806);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        // carry-in for first chunk is neutral
        {
            ((bool *) scan_stage_2_carry_mem_114821)[(int64_t) 0] = 0;
            ((int64_t *) scan_stage_2_carry_mem_114823)[(int64_t) 0] = (int64_t) 0;
        }
        // scan carries
        {
            for (int64_t i_114825 = 0; i_114825 < sext_i32_i64(nsubtasks_114806) - (int64_t) 1; i_114825++) {
                offset_114819 = squot64(defunc_0_reduce_res_103765, sext_i32_i64(nsubtasks_114806));
                if (slt64(i_114825, srem64(defunc_0_reduce_res_103765, sext_i32_i64(nsubtasks_114806)))) {
                    offset_114819 += (int64_t) 1;
                }
                offset_index_114820 += offset_114819;
                
                int64_t gtid_103887 = offset_index_114820;
                
                // Read carry
                {
                    eta_p_114812 = ((bool *) scan_stage_2_carry_mem_114821)[i_114825];
                    eta_p_114813 = ((int64_t *) scan_stage_2_carry_mem_114823)[i_114825];
                }
                // Read next values
                {
                    eta_p_114814 = ((bool *) mem_111717.mem)[offset_index_114820 - (int64_t) 1];
                    eta_p_114815 = ((int64_t *) mem_111719.mem)[offset_index_114820 - (int64_t) 1];
                }
                
                bool tmp_114816 = eta_p_114812 || eta_p_114814;
                int64_t tmp_114817;
                
                if (eta_p_114814) {
                    tmp_114817 = eta_p_114815;
                } else {
                    int64_t defunc_0_op_res_114818 = add64(eta_p_114813, eta_p_114815);
                    
                    tmp_114817 = defunc_0_op_res_114818;
                }
                ((bool *) scan_stage_2_carry_mem_114821)[i_114825 + (int64_t) 1] = tmp_114816;
                ((int64_t *) scan_stage_2_carry_mem_114823)[i_114825 + (int64_t) 1] = tmp_114817;
            }
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "Scan stage 3");
        
        struct futhark_mc_scan_stage_3_parloop_struct_127354 futhark_mc_scan_stage_3_parloop_struct_127354_;
        
        futhark_mc_scan_stage_3_parloop_struct_127354_.ctx = ctx;
        futhark_mc_scan_stage_3_parloop_struct_127354_.free_mem_111717 = mem_111717.mem;
        futhark_mc_scan_stage_3_parloop_struct_127354_.free_mem_111719 = mem_111719.mem;
        futhark_mc_scan_stage_3_parloop_struct_127354_.free_scan_stage_2_carry_mem_114821 = scan_stage_2_carry_mem_114821;
        futhark_mc_scan_stage_3_parloop_struct_127354_.free_scan_stage_2_carry_mem_114823 = scan_stage_2_carry_mem_114823;
        
        struct scheduler_parloop futhark_mc_scan_stage_3_parloop_127355_task;
        
        futhark_mc_scan_stage_3_parloop_127355_task.name = "futhark_mc_scan_stage_3_parloop_127355";
        futhark_mc_scan_stage_3_parloop_127355_task.fn = futhark_mc_scan_stage_3_parloop_127355;
        futhark_mc_scan_stage_3_parloop_127355_task.args = &futhark_mc_scan_stage_3_parloop_struct_127354_;
        futhark_mc_scan_stage_3_parloop_127355_task.iterations = iterations;
        futhark_mc_scan_stage_3_parloop_127355_task.info = info;
        
        struct mc_event *event_127357 = mc_event_new(ctx);
        
        if (event_127357 != NULL)
            event_127357->bef = get_wall_time();
        
        int futhark_mc_scan_stage_3_parloop_127355_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_scan_stage_3_parloop_127355_task);
        
        if (futhark_mc_scan_stage_3_parloop_127355_err != 0) {
            err = futhark_mc_scan_stage_3_parloop_127355_err;
            goto cleanup;
        }
        if (event_127357 != NULL) {
            event_127357->aft = get_wall_time();
            lock_lock(&ctx->event_list_lock);
            add_event(ctx, "futhark_mc_scan_stage_3_parloop_127355_total", strdup("nothing further"), event_127357, (event_report_fn) mc_event_report);
            lock_unlock(&ctx->event_list_lock);
        }
    }
    
  cleanup:
    {
        free(scan_stage_2_carry_mem_114821);
        free(scan_stage_2_carry_mem_114823);
    }
    if (event_127358 != NULL) {
        event_127358->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segscan_task_127347", strdup("nothing further"), event_127358, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_127359 {
    struct futhark_context *ctx;
    int64_t free_defunc_0_reduce_res_103765;
    unsigned char *free_mem_111714;
    unsigned char *free_mem_111720;
    unsigned char *free_mem_111721;
    unsigned char *free_mem_111723;
};
struct futhark_mc_scan_stage_1_parloop_struct_127363 {
    struct futhark_context *ctx;
    unsigned char *free_mem_111714;
    unsigned char *free_mem_111720;
    unsigned char *free_mem_111721;
    unsigned char *free_mem_111723;
};
static int futhark_mc_scan_stage_1_parloop_127364(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_scan_stage_1_parloop_struct_127363 *futhark_mc_scan_stage_1_parloop_struct_127363 = (struct futhark_mc_scan_stage_1_parloop_struct_127363 *) args;
    struct futhark_context *ctx = futhark_mc_scan_stage_1_parloop_struct_127363->ctx;
    struct mc_event *event_127365 = mc_event_new(ctx);
    
    if (event_127365 != NULL)
        event_127365->bef = get_wall_time();
    
    struct memblock mem_111714 = {.desc ="mem_111714", .mem =futhark_mc_scan_stage_1_parloop_struct_127363->free_mem_111714, .size =0, .references =NULL};
    struct memblock mem_111720 = {.desc ="mem_111720", .mem =futhark_mc_scan_stage_1_parloop_struct_127363->free_mem_111720, .size =0, .references =NULL};
    struct memblock mem_111721 = {.desc ="mem_111721", .mem =futhark_mc_scan_stage_1_parloop_struct_127363->free_mem_111721, .size =0, .references =NULL};
    struct memblock mem_111723 = {.desc ="mem_111723", .mem =futhark_mc_scan_stage_1_parloop_struct_127363->free_mem_111723, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_103888;
    
    flat_tid_103888 = subtask_id;
    
    bool eta_p_63650;
    int64_t eta_p_63651;
    bool eta_p_63652;
    int64_t eta_p_63653;
    
    eta_p_63650 = 0;
    eta_p_63651 = (int64_t) 0;
    {
        int64_t start_114838;
        int64_t end_114839;
        
        start_114838 = start;
        end_114839 = end;
        
        int64_t n_114840 = end_114839 - start_114838;
        
        for (int64_t SegScan_i_114841 = start_114838; SegScan_i_114841 < start_114838 + n_114840; SegScan_i_114841++) {
            int64_t gtid_103889 = SegScan_i_114841;
            bool x_63657 = ((bool *) mem_111720.mem)[gtid_103889];
            int64_t x_63658 = ((int64_t *) mem_111714.mem)[gtid_103889];
            
            // write mapped values results to memory
            { }
            // Apply scan op
            {
                int64_t uni_i_114842 = 0;
                
                {
                    // Read accumulator
                    {
                        eta_p_63650 = eta_p_63650;
                        eta_p_63651 = eta_p_63651;
                    }
                    // Read next values
                    {
                        eta_p_63652 = x_63657;
                        eta_p_63653 = x_63658;
                    }
                    // Scan op body
                    {
                        bool tmp_63654 = eta_p_63650 || eta_p_63652;
                        int64_t tmp_63655;
                        
                        if (eta_p_63652) {
                            tmp_63655 = eta_p_63653;
                        } else {
                            int64_t defunc_0_op_res_63656 = add64(eta_p_63651, eta_p_63653);
                            
                            tmp_63655 = defunc_0_op_res_63656;
                        }
                        ((bool *) mem_111721.mem)[gtid_103889] = tmp_63654;
                        eta_p_63650 = tmp_63654;
                        ((int64_t *) mem_111723.mem)[gtid_103889] = tmp_63655;
                        eta_p_63651 = tmp_63655;
                    }
                }
            }
        }
    }
    
  cleanup:
    { }
    if (event_127365 != NULL) {
        event_127365->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_scan_stage_1_parloop_127364", strdup("nothing further"), event_127365, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
struct futhark_mc_scan_stage_3_parloop_struct_127367 {
    struct futhark_context *ctx;
    unsigned char *free_mem_111721;
    unsigned char *free_mem_111723;
    unsigned char *free_scan_stage_2_carry_mem_114852;
    unsigned char *free_scan_stage_2_carry_mem_114854;
};
static int futhark_mc_scan_stage_3_parloop_127368(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_scan_stage_3_parloop_struct_127367 *futhark_mc_scan_stage_3_parloop_struct_127367 = (struct futhark_mc_scan_stage_3_parloop_struct_127367 *) args;
    struct futhark_context *ctx = futhark_mc_scan_stage_3_parloop_struct_127367->ctx;
    struct mc_event *event_127369 = mc_event_new(ctx);
    
    if (event_127369 != NULL)
        event_127369->bef = get_wall_time();
    
    struct memblock mem_111721 = {.desc ="mem_111721", .mem =futhark_mc_scan_stage_3_parloop_struct_127367->free_mem_111721, .size =0, .references =NULL};
    struct memblock mem_111723 = {.desc ="mem_111723", .mem =futhark_mc_scan_stage_3_parloop_struct_127367->free_mem_111723, .size =0, .references =NULL};
    struct memblock scan_stage_2_carry_mem_114852 = {.desc ="scan_stage_2_carry_mem_114852", .mem =futhark_mc_scan_stage_3_parloop_struct_127367->free_scan_stage_2_carry_mem_114852, .size =0, .references =NULL};
    struct memblock scan_stage_2_carry_mem_114854 = {.desc ="scan_stage_2_carry_mem_114854", .mem =futhark_mc_scan_stage_3_parloop_struct_127367->free_scan_stage_2_carry_mem_114854, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_103888;
    
    flat_tid_103888 = subtask_id;
    {
        bool eta_p_114857;
        int64_t eta_p_114858;
        bool eta_p_114859;
        int64_t eta_p_114860;
        
        // load carry-in
        {
            eta_p_114857 = ((bool *) scan_stage_2_carry_mem_114852.mem)[flat_tid_103888];
            eta_p_114858 = ((int64_t *) scan_stage_2_carry_mem_114854.mem)[flat_tid_103888];
        }
        
        int64_t start_114864;
        int64_t end_114865;
        
        start_114864 = start;
        end_114865 = end;
        
        int64_t n_114866 = end_114865 - start_114864;
        
        for (int64_t SegScan_i_114867 = start_114864; SegScan_i_114867 < start_114864 + n_114866; SegScan_i_114867++) {
            int64_t gtid_103889 = SegScan_i_114867;
            
            // load partial result
            {
                eta_p_114859 = ((bool *) mem_111721.mem)[gtid_103889];
                eta_p_114860 = ((int64_t *) mem_111723.mem)[gtid_103889];
            }
            // combine carry with partial result
            {
                bool tmp_114861 = eta_p_114857 || eta_p_114859;
                int64_t tmp_114862;
                
                if (eta_p_114859) {
                    tmp_114862 = eta_p_114860;
                } else {
                    int64_t defunc_0_op_res_114863 = add64(eta_p_114858, eta_p_114860);
                    
                    tmp_114862 = defunc_0_op_res_114863;
                }
                ((bool *) mem_111721.mem)[gtid_103889] = tmp_114861;
                ((int64_t *) mem_111723.mem)[gtid_103889] = tmp_114862;
            }
        }
    }
    
  cleanup:
    { }
    if (event_127369 != NULL) {
        event_127369->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_scan_stage_3_parloop_127368", strdup("nothing further"), event_127369, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segscan_task_127360(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127359 *futhark_mc_task_127359 = (struct futhark_mc_task_127359 *) args;
    struct futhark_context *ctx = futhark_mc_task_127359->ctx;
    struct mc_event *event_127371 = mc_event_new(ctx);
    
    if (event_127371 != NULL)
        event_127371->bef = get_wall_time();
    
    int64_t defunc_0_reduce_res_103765 = futhark_mc_task_127359->free_defunc_0_reduce_res_103765;
    struct memblock mem_111714 = {.desc ="mem_111714", .mem =futhark_mc_task_127359->free_mem_111714, .size =0, .references =NULL};
    struct memblock mem_111720 = {.desc ="mem_111720", .mem =futhark_mc_task_127359->free_mem_111720, .size =0, .references =NULL};
    struct memblock mem_111721 = {.desc ="mem_111721", .mem =futhark_mc_task_127359->free_mem_111721, .size =0, .references =NULL};
    struct memblock mem_111723 = {.desc ="mem_111723", .mem =futhark_mc_task_127359->free_mem_111723, .size =0, .references =NULL};
    int64_t scan_stage_2_carry_mem_114852_cached_sizze_127361 = 0;
    unsigned char *scan_stage_2_carry_mem_114852 = NULL;
    int64_t scan_stage_2_carry_mem_114854_cached_sizze_127362 = 0;
    unsigned char *scan_stage_2_carry_mem_114854 = NULL;
    int32_t nsubtasks_114837;
    
    nsubtasks_114837 = info.nsubtasks;
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "nonsegmented segScan");
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "Scan stage 1");
    
    struct futhark_mc_scan_stage_1_parloop_struct_127363 futhark_mc_scan_stage_1_parloop_struct_127363_;
    
    futhark_mc_scan_stage_1_parloop_struct_127363_.ctx = ctx;
    futhark_mc_scan_stage_1_parloop_struct_127363_.free_mem_111714 = mem_111714.mem;
    futhark_mc_scan_stage_1_parloop_struct_127363_.free_mem_111720 = mem_111720.mem;
    futhark_mc_scan_stage_1_parloop_struct_127363_.free_mem_111721 = mem_111721.mem;
    futhark_mc_scan_stage_1_parloop_struct_127363_.free_mem_111723 = mem_111723.mem;
    
    struct scheduler_parloop futhark_mc_scan_stage_1_parloop_127364_task;
    
    futhark_mc_scan_stage_1_parloop_127364_task.name = "futhark_mc_scan_stage_1_parloop_127364";
    futhark_mc_scan_stage_1_parloop_127364_task.fn = futhark_mc_scan_stage_1_parloop_127364;
    futhark_mc_scan_stage_1_parloop_127364_task.args = &futhark_mc_scan_stage_1_parloop_struct_127363_;
    futhark_mc_scan_stage_1_parloop_127364_task.iterations = iterations;
    futhark_mc_scan_stage_1_parloop_127364_task.info = info;
    
    struct mc_event *event_127366 = mc_event_new(ctx);
    
    if (event_127366 != NULL)
        event_127366->bef = get_wall_time();
    
    int futhark_mc_scan_stage_1_parloop_127364_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_scan_stage_1_parloop_127364_task);
    
    if (futhark_mc_scan_stage_1_parloop_127364_err != 0) {
        err = futhark_mc_scan_stage_1_parloop_127364_err;
        goto cleanup;
    }
    if (event_127366 != NULL) {
        event_127366->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_scan_stage_1_parloop_127364_total", strdup("nothing further"), event_127366, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (slt32(1, nsubtasks_114837)) {
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "Scan stage 2");
        
        bool eta_p_114843;
        int64_t eta_p_114844;
        bool eta_p_114845;
        int64_t eta_p_114846;
        int64_t offset_114850 = (int64_t) 0;
        int64_t offset_index_114851 = (int64_t) 0;
        
        if (scan_stage_2_carry_mem_114852_cached_sizze_127361 < nsubtasks_114837) {
            err = lexical_realloc(ctx, &scan_stage_2_carry_mem_114852, &scan_stage_2_carry_mem_114852_cached_sizze_127361, nsubtasks_114837);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (scan_stage_2_carry_mem_114854_cached_sizze_127362 < (int64_t) 8 * nsubtasks_114837) {
            err = lexical_realloc(ctx, &scan_stage_2_carry_mem_114854, &scan_stage_2_carry_mem_114854_cached_sizze_127362, (int64_t) 8 * nsubtasks_114837);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        // carry-in for first chunk is neutral
        {
            ((bool *) scan_stage_2_carry_mem_114852)[(int64_t) 0] = 0;
            ((int64_t *) scan_stage_2_carry_mem_114854)[(int64_t) 0] = (int64_t) 0;
        }
        // scan carries
        {
            for (int64_t i_114856 = 0; i_114856 < sext_i32_i64(nsubtasks_114837) - (int64_t) 1; i_114856++) {
                offset_114850 = squot64(defunc_0_reduce_res_103765, sext_i32_i64(nsubtasks_114837));
                if (slt64(i_114856, srem64(defunc_0_reduce_res_103765, sext_i32_i64(nsubtasks_114837)))) {
                    offset_114850 += (int64_t) 1;
                }
                offset_index_114851 += offset_114850;
                
                int64_t gtid_103889 = offset_index_114851;
                
                // Read carry
                {
                    eta_p_114843 = ((bool *) scan_stage_2_carry_mem_114852)[i_114856];
                    eta_p_114844 = ((int64_t *) scan_stage_2_carry_mem_114854)[i_114856];
                }
                // Read next values
                {
                    eta_p_114845 = ((bool *) mem_111721.mem)[offset_index_114851 - (int64_t) 1];
                    eta_p_114846 = ((int64_t *) mem_111723.mem)[offset_index_114851 - (int64_t) 1];
                }
                
                bool tmp_114847 = eta_p_114843 || eta_p_114845;
                int64_t tmp_114848;
                
                if (eta_p_114845) {
                    tmp_114848 = eta_p_114846;
                } else {
                    int64_t defunc_0_op_res_114849 = add64(eta_p_114844, eta_p_114846);
                    
                    tmp_114848 = defunc_0_op_res_114849;
                }
                ((bool *) scan_stage_2_carry_mem_114852)[i_114856 + (int64_t) 1] = tmp_114847;
                ((int64_t *) scan_stage_2_carry_mem_114854)[i_114856 + (int64_t) 1] = tmp_114848;
            }
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "Scan stage 3");
        
        struct futhark_mc_scan_stage_3_parloop_struct_127367 futhark_mc_scan_stage_3_parloop_struct_127367_;
        
        futhark_mc_scan_stage_3_parloop_struct_127367_.ctx = ctx;
        futhark_mc_scan_stage_3_parloop_struct_127367_.free_mem_111721 = mem_111721.mem;
        futhark_mc_scan_stage_3_parloop_struct_127367_.free_mem_111723 = mem_111723.mem;
        futhark_mc_scan_stage_3_parloop_struct_127367_.free_scan_stage_2_carry_mem_114852 = scan_stage_2_carry_mem_114852;
        futhark_mc_scan_stage_3_parloop_struct_127367_.free_scan_stage_2_carry_mem_114854 = scan_stage_2_carry_mem_114854;
        
        struct scheduler_parloop futhark_mc_scan_stage_3_parloop_127368_task;
        
        futhark_mc_scan_stage_3_parloop_127368_task.name = "futhark_mc_scan_stage_3_parloop_127368";
        futhark_mc_scan_stage_3_parloop_127368_task.fn = futhark_mc_scan_stage_3_parloop_127368;
        futhark_mc_scan_stage_3_parloop_127368_task.args = &futhark_mc_scan_stage_3_parloop_struct_127367_;
        futhark_mc_scan_stage_3_parloop_127368_task.iterations = iterations;
        futhark_mc_scan_stage_3_parloop_127368_task.info = info;
        
        struct mc_event *event_127370 = mc_event_new(ctx);
        
        if (event_127370 != NULL)
            event_127370->bef = get_wall_time();
        
        int futhark_mc_scan_stage_3_parloop_127368_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_scan_stage_3_parloop_127368_task);
        
        if (futhark_mc_scan_stage_3_parloop_127368_err != 0) {
            err = futhark_mc_scan_stage_3_parloop_127368_err;
            goto cleanup;
        }
        if (event_127370 != NULL) {
            event_127370->aft = get_wall_time();
            lock_lock(&ctx->event_list_lock);
            add_event(ctx, "futhark_mc_scan_stage_3_parloop_127368_total", strdup("nothing further"), event_127370, (event_report_fn) mc_event_report);
            lock_unlock(&ctx->event_list_lock);
        }
    }
    
  cleanup:
    {
        free(scan_stage_2_carry_mem_114852);
        free(scan_stage_2_carry_mem_114854);
    }
    if (event_127371 != NULL) {
        event_127371->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segscan_task_127360", strdup("nothing further"), event_127371, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_127372 {
    struct futhark_context *ctx;
    int64_t free_k_33387;
    int64_t free_m_33388;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_111727;
};
struct futhark_mc_copy_parloop_struct_127374 {
    struct futhark_context *ctx;
    int64_t free_k_33387;
    int64_t free_m_33388;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_111727;
};
static int futhark_mc_copy_parloop_127375(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_copy_parloop_struct_127374 *futhark_mc_copy_parloop_struct_127374 = (struct futhark_mc_copy_parloop_struct_127374 *) args;
    struct futhark_context *ctx = futhark_mc_copy_parloop_struct_127374->ctx;
    struct mc_event *event_127376 = mc_event_new(ctx);
    
    if (event_127376 != NULL)
        event_127376->bef = get_wall_time();
    
    int64_t k_33387 = futhark_mc_copy_parloop_struct_127374->free_k_33387;
    int64_t m_33388 = futhark_mc_copy_parloop_struct_127374->free_m_33388;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_copy_parloop_struct_127374->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_111727 = {.desc ="mem_111727", .mem =futhark_mc_copy_parloop_struct_127374->free_mem_111727, .size =0, .references =NULL};
    int64_t iterations = end - start;
    
    {
        int64_t start_114868;
        int64_t end_114869;
        
        start_114868 = start;
        end_114869 = end;
        
        int64_t n_114870 = end_114869 - start_114868;
        
        for (int64_t copy_i_114871 = start_114868; copy_i_114871 < start_114868 + n_114870; copy_i_114871++) {
            int64_t slice_114875 = m_33388;
            int64_t slice_114876 = m_33388 * slice_114875;
            int64_t slice_114877 = k_33387 * slice_114876;
            int64_t i_114872 = squot64(copy_i_114871, slice_114876);
            int64_t remnant_114878 = copy_i_114871 - i_114872 * slice_114876;
            int64_t i_114873 = squot64(remnant_114878, slice_114875);
            int64_t remnant_114879 = remnant_114878 - i_114873 * slice_114875;
            int64_t i_114874 = remnant_114879;
            int64_t remnant_114880 = remnant_114879 - i_114874;
            double tmp_114881 = ((double *) A_mem_111707.mem)[i_114872 * (m_33388 * m_33388) + i_114873 * m_33388 + i_114874];
            
            ((double *) mem_111727.mem)[i_114872 * (m_33388 * m_33388) + i_114873 * m_33388 + i_114874] = tmp_114881;
        }
    }
    
  cleanup:
    { }
    if (event_127376 != NULL) {
        event_127376->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_parloop_127375", strdup("nothing further"), event_127376, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_copy_114882_task_127373(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127372 *futhark_mc_task_127372 = (struct futhark_mc_task_127372 *) args;
    struct futhark_context *ctx = futhark_mc_task_127372->ctx;
    struct mc_event *event_127378 = mc_event_new(ctx);
    
    if (event_127378 != NULL)
        event_127378->bef = get_wall_time();
    
    int64_t k_33387 = futhark_mc_task_127372->free_k_33387;
    int64_t m_33388 = futhark_mc_task_127372->free_m_33388;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_127372->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_111727 = {.desc ="mem_111727", .mem =futhark_mc_task_127372->free_mem_111727, .size =0, .references =NULL};
    struct futhark_mc_copy_parloop_struct_127374 futhark_mc_copy_parloop_struct_127374_;
    
    futhark_mc_copy_parloop_struct_127374_.ctx = ctx;
    futhark_mc_copy_parloop_struct_127374_.free_k_33387 = k_33387;
    futhark_mc_copy_parloop_struct_127374_.free_m_33388 = m_33388;
    futhark_mc_copy_parloop_struct_127374_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_copy_parloop_struct_127374_.free_mem_111727 = mem_111727.mem;
    
    struct scheduler_parloop futhark_mc_copy_parloop_127375_task;
    
    futhark_mc_copy_parloop_127375_task.name = "futhark_mc_copy_parloop_127375";
    futhark_mc_copy_parloop_127375_task.fn = futhark_mc_copy_parloop_127375;
    futhark_mc_copy_parloop_127375_task.args = &futhark_mc_copy_parloop_struct_127374_;
    futhark_mc_copy_parloop_127375_task.iterations = iterations;
    futhark_mc_copy_parloop_127375_task.info = info;
    
    struct mc_event *event_127377 = mc_event_new(ctx);
    
    if (event_127377 != NULL)
        event_127377->bef = get_wall_time();
    
    int futhark_mc_copy_parloop_127375_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_copy_parloop_127375_task);
    
    if (futhark_mc_copy_parloop_127375_err != 0) {
        err = futhark_mc_copy_parloop_127375_err;
        goto cleanup;
    }
    if (event_127377 != NULL) {
        event_127377->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_parloop_127375_total", strdup("nothing further"), event_127377, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_127378 != NULL) {
        event_127378->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_114882_task_127373", strdup("nothing further"), event_127378, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_127379 {
    struct futhark_context *ctx;
    int64_t free_k_33387;
    int64_t free_m_33388;
    double free_rho1_33389;
    double free_rho2_33390;
    double free_eps_33391;
    double free_exp_absorb_cutoff_33394;
    double free_safe_for_exp_33395;
    double free_tol_sinkhorn_33396;
    double free_neg_res_43882;
    double free_zp_res_43884;
    double free_zs_res_44842;
    double free_zs_res_44844;
    double free_zs_res_44883;
    double free_zs_res_44885;
    double free_zp_res_46827;
    int64_t free_defunc_0_reduce_res_103765;
    double free_zs_res_107134;
    double free_zp_res_108112;
    unsigned char *free_A_mem_111707;
    unsigned char *free_distrs_mem_111708;
    int64_t free_bytes_111715;
    unsigned char *free_mem_111716;
    unsigned char *free_mem_111719;
    unsigned char *free_mem_111723;
    int64_t free_bytes_111726;
    unsigned char *free_mem_111727;
    int64_t free_bytes_111743;
    unsigned char *free_mem_114063;
    int64_t free_num_bytes_114668;
};
struct futhark_mc_segmap_parloop_struct_127381 {
    struct futhark_context *ctx;
    int64_t free_k_33387;
    int64_t free_m_33388;
    double free_rho1_33389;
    double free_rho2_33390;
    double free_eps_33391;
    double free_exp_absorb_cutoff_33394;
    double free_safe_for_exp_33395;
    double free_tol_sinkhorn_33396;
    double free_neg_res_43882;
    double free_zp_res_43884;
    double free_zs_res_44842;
    double free_zs_res_44844;
    double free_zs_res_44883;
    double free_zs_res_44885;
    double free_zp_res_46827;
    int64_t free_defunc_0_reduce_res_103765;
    double free_zs_res_107134;
    double free_zp_res_108112;
    unsigned char *free_A_mem_111707;
    unsigned char *free_distrs_mem_111708;
    int64_t free_bytes_111715;
    unsigned char *free_mem_111716;
    unsigned char *free_mem_111719;
    unsigned char *free_mem_111723;
    unsigned char *free_mem_111727;
    int64_t free_bytes_111743;
    unsigned char *free_mem_114063;
    int64_t free_num_bytes_114668;
};
static int futhark_mc_segmap_parloop_127382(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_127381 *futhark_mc_segmap_parloop_struct_127381 = (struct futhark_mc_segmap_parloop_struct_127381 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_127381->ctx;
    struct mc_event *event_127428 = mc_event_new(ctx);
    
    if (event_127428 != NULL)
        event_127428->bef = get_wall_time();
    
    int64_t k_33387 = futhark_mc_segmap_parloop_struct_127381->free_k_33387;
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_127381->free_m_33388;
    double rho1_33389 = futhark_mc_segmap_parloop_struct_127381->free_rho1_33389;
    double rho2_33390 = futhark_mc_segmap_parloop_struct_127381->free_rho2_33390;
    double eps_33391 = futhark_mc_segmap_parloop_struct_127381->free_eps_33391;
    double exp_absorb_cutoff_33394 = futhark_mc_segmap_parloop_struct_127381->free_exp_absorb_cutoff_33394;
    double safe_for_exp_33395 = futhark_mc_segmap_parloop_struct_127381->free_safe_for_exp_33395;
    double tol_sinkhorn_33396 = futhark_mc_segmap_parloop_struct_127381->free_tol_sinkhorn_33396;
    double neg_res_43882 = futhark_mc_segmap_parloop_struct_127381->free_neg_res_43882;
    double zp_res_43884 = futhark_mc_segmap_parloop_struct_127381->free_zp_res_43884;
    double zs_res_44842 = futhark_mc_segmap_parloop_struct_127381->free_zs_res_44842;
    double zs_res_44844 = futhark_mc_segmap_parloop_struct_127381->free_zs_res_44844;
    double zs_res_44883 = futhark_mc_segmap_parloop_struct_127381->free_zs_res_44883;
    double zs_res_44885 = futhark_mc_segmap_parloop_struct_127381->free_zs_res_44885;
    double zp_res_46827 = futhark_mc_segmap_parloop_struct_127381->free_zp_res_46827;
    int64_t defunc_0_reduce_res_103765 = futhark_mc_segmap_parloop_struct_127381->free_defunc_0_reduce_res_103765;
    double zs_res_107134 = futhark_mc_segmap_parloop_struct_127381->free_zs_res_107134;
    double zp_res_108112 = futhark_mc_segmap_parloop_struct_127381->free_zp_res_108112;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segmap_parloop_struct_127381->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segmap_parloop_struct_127381->free_distrs_mem_111708, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_segmap_parloop_struct_127381->free_bytes_111715;
    struct memblock mem_111716 = {.desc ="mem_111716", .mem =futhark_mc_segmap_parloop_struct_127381->free_mem_111716, .size =0, .references =NULL};
    struct memblock mem_111719 = {.desc ="mem_111719", .mem =futhark_mc_segmap_parloop_struct_127381->free_mem_111719, .size =0, .references =NULL};
    struct memblock mem_111723 = {.desc ="mem_111723", .mem =futhark_mc_segmap_parloop_struct_127381->free_mem_111723, .size =0, .references =NULL};
    struct memblock mem_111727 = {.desc ="mem_111727", .mem =futhark_mc_segmap_parloop_struct_127381->free_mem_111727, .size =0, .references =NULL};
    int64_t bytes_111743 = futhark_mc_segmap_parloop_struct_127381->free_bytes_111743;
    struct memblock mem_114063 = {.desc ="mem_114063", .mem =futhark_mc_segmap_parloop_struct_127381->free_mem_114063, .size =0, .references =NULL};
    int64_t num_bytes_114668 = futhark_mc_segmap_parloop_struct_127381->free_num_bytes_114668;
    int64_t iterations = end - start;
    int64_t mem_112580_cached_sizze_127383 = 0;
    unsigned char *mem_112580 = NULL;
    int64_t mem_112582_cached_sizze_127384 = 0;
    unsigned char *mem_112582 = NULL;
    int64_t mem_112585_cached_sizze_127385 = 0;
    unsigned char *mem_112585 = NULL;
    int64_t mem_112615_cached_sizze_127386 = 0;
    unsigned char *mem_112615 = NULL;
    int64_t mem_112617_cached_sizze_127387 = 0;
    unsigned char *mem_112617 = NULL;
    int64_t mem_112619_cached_sizze_127388 = 0;
    unsigned char *mem_112619 = NULL;
    int64_t mem_112639_cached_sizze_127389 = 0;
    unsigned char *mem_112639 = NULL;
    int64_t mem_112648_cached_sizze_127390 = 0;
    unsigned char *mem_112648 = NULL;
    int64_t mem_112659_cached_sizze_127391 = 0;
    unsigned char *mem_112659 = NULL;
    int64_t mem_112661_cached_sizze_127392 = 0;
    unsigned char *mem_112661 = NULL;
    int64_t mem_112675_cached_sizze_127393 = 0;
    unsigned char *mem_112675 = NULL;
    int64_t mem_112706_cached_sizze_127394 = 0;
    unsigned char *mem_112706 = NULL;
    int64_t mem_112998_cached_sizze_127395 = 0;
    unsigned char *mem_112998 = NULL;
    int64_t mem_113045_cached_sizze_127396 = 0;
    unsigned char *mem_113045 = NULL;
    int64_t mem_113053_cached_sizze_127397 = 0;
    unsigned char *mem_113053 = NULL;
    int64_t mem_113055_cached_sizze_127398 = 0;
    unsigned char *mem_113055 = NULL;
    int64_t mem_113069_cached_sizze_127399 = 0;
    unsigned char *mem_113069 = NULL;
    int64_t mem_113078_cached_sizze_127400 = 0;
    unsigned char *mem_113078 = NULL;
    int64_t mem_113080_cached_sizze_127401 = 0;
    unsigned char *mem_113080 = NULL;
    int64_t mem_113089_cached_sizze_127402 = 0;
    unsigned char *mem_113089 = NULL;
    int64_t mem_113097_cached_sizze_127403 = 0;
    unsigned char *mem_113097 = NULL;
    int64_t mem_113728_cached_sizze_127404 = 0;
    unsigned char *mem_113728 = NULL;
    int64_t mem_113765_cached_sizze_127405 = 0;
    unsigned char *mem_113765 = NULL;
    int64_t mem_113767_cached_sizze_127406 = 0;
    unsigned char *mem_113767 = NULL;
    int64_t mem_113769_cached_sizze_127407 = 0;
    unsigned char *mem_113769 = NULL;
    int64_t mem_113790_cached_sizze_127408 = 0;
    unsigned char *mem_113790 = NULL;
    int64_t mem_113802_cached_sizze_127409 = 0;
    unsigned char *mem_113802 = NULL;
    int64_t mem_113804_cached_sizze_127410 = 0;
    unsigned char *mem_113804 = NULL;
    int64_t mem_113818_cached_sizze_127411 = 0;
    unsigned char *mem_113818 = NULL;
    int64_t mem_113826_cached_sizze_127412 = 0;
    unsigned char *mem_113826 = NULL;
    int64_t mem_113829_cached_sizze_127413 = 0;
    unsigned char *mem_113829 = NULL;
    int64_t mem_113845_cached_sizze_127414 = 0;
    unsigned char *mem_113845 = NULL;
    int64_t mem_113880_cached_sizze_127415 = 0;
    unsigned char *mem_113880 = NULL;
    int64_t mem_113888_cached_sizze_127416 = 0;
    unsigned char *mem_113888 = NULL;
    int64_t mem_113900_cached_sizze_127417 = 0;
    unsigned char *mem_113900 = NULL;
    int64_t mem_113903_cached_sizze_127418 = 0;
    unsigned char *mem_113903 = NULL;
    int64_t mem_113946_cached_sizze_127419 = 0;
    unsigned char *mem_113946 = NULL;
    int64_t mem_113954_cached_sizze_127420 = 0;
    unsigned char *mem_113954 = NULL;
    int64_t mem_114005_cached_sizze_127421 = 0;
    unsigned char *mem_114005 = NULL;
    int64_t mem_114007_cached_sizze_127422 = 0;
    unsigned char *mem_114007 = NULL;
    int64_t mem_114009_cached_sizze_127423 = 0;
    unsigned char *mem_114009 = NULL;
    int64_t mem_114020_cached_sizze_127424 = 0;
    unsigned char *mem_114020 = NULL;
    int64_t mem_114037_cached_sizze_127425 = 0;
    unsigned char *mem_114037 = NULL;
    int64_t mem_114039_cached_sizze_127426 = 0;
    unsigned char *mem_114039 = NULL;
    int64_t mem_114041_cached_sizze_127427 = 0;
    unsigned char *mem_114041 = NULL;
    struct memblock mem_param_tmp_117527;
    
    mem_param_tmp_117527.references = NULL;
    
    struct memblock mem_param_tmp_117526;
    
    mem_param_tmp_117526.references = NULL;
    
    struct memblock mem_param_tmp_117525;
    
    mem_param_tmp_117525.references = NULL;
    
    struct memblock mem_param_out_tmp_117740;
    
    mem_param_out_tmp_117740.references = NULL;
    
    struct memblock mem_param_tmp_117739;
    
    mem_param_tmp_117739.references = NULL;
    
    struct memblock mem_param_out_117008;
    
    mem_param_out_117008.references = NULL;
    
    struct memblock mem_param_117007;
    
    mem_param_117007.references = NULL;
    
    struct memblock ext_mem_unused_117002;
    
    ext_mem_unused_117002.references = NULL;
    
    struct memblock ext_mem_117001;
    
    ext_mem_117001.references = NULL;
    
    struct memblock ext_mem_116624;
    
    ext_mem_116624.references = NULL;
    
    struct memblock ext_mem_116623;
    
    ext_mem_116623.references = NULL;
    
    struct memblock ext_mem_116622;
    
    ext_mem_116622.references = NULL;
    
    struct memblock mem_116621;
    
    mem_116621.references = NULL;
    
    struct memblock mem_116620;
    
    mem_116620.references = NULL;
    
    struct memblock mem_116619;
    
    mem_116619.references = NULL;
    
    struct memblock mem_116581;
    
    mem_116581.references = NULL;
    
    struct memblock mem_116578;
    
    mem_116578.references = NULL;
    
    struct memblock mem_param_tmp_117648;
    
    mem_param_tmp_117648.references = NULL;
    
    struct memblock mem_param_tmp_117647;
    
    mem_param_tmp_117647.references = NULL;
    
    struct memblock mem_param_tmp_117646;
    
    mem_param_tmp_117646.references = NULL;
    
    struct memblock mem_param_tmp_117645;
    
    mem_param_tmp_117645.references = NULL;
    
    struct memblock mem_param_tmp_117644;
    
    mem_param_tmp_117644.references = NULL;
    
    struct memblock ext_mem_116538;
    
    ext_mem_116538.references = NULL;
    
    struct memblock ext_mem_116511;
    
    ext_mem_116511.references = NULL;
    
    struct memblock ext_mem_116510;
    
    ext_mem_116510.references = NULL;
    
    struct memblock ext_mem_116509;
    
    ext_mem_116509.references = NULL;
    
    struct memblock mem_116508;
    
    mem_116508.references = NULL;
    
    struct memblock mem_116507;
    
    mem_116507.references = NULL;
    
    struct memblock mem_116506;
    
    mem_116506.references = NULL;
    
    struct memblock ext_mem_116475;
    
    ext_mem_116475.references = NULL;
    
    struct memblock ext_mem_116448;
    
    ext_mem_116448.references = NULL;
    
    struct memblock ext_mem_116447;
    
    ext_mem_116447.references = NULL;
    
    struct memblock ext_mem_116446;
    
    ext_mem_116446.references = NULL;
    
    struct memblock mem_116445;
    
    mem_116445.references = NULL;
    
    struct memblock mem_116444;
    
    mem_116444.references = NULL;
    
    struct memblock mem_116443;
    
    mem_116443.references = NULL;
    
    struct memblock mem_116407;
    
    mem_116407.references = NULL;
    
    struct memblock mem_116383;
    
    mem_116383.references = NULL;
    
    struct memblock mem_param_116373;
    
    mem_param_116373.references = NULL;
    
    struct memblock mem_param_116372;
    
    mem_param_116372.references = NULL;
    
    struct memblock mem_param_116371;
    
    mem_param_116371.references = NULL;
    
    struct memblock mem_param_116370;
    
    mem_param_116370.references = NULL;
    
    struct memblock mem_param_116369;
    
    mem_param_116369.references = NULL;
    
    struct memblock ext_mem_116359;
    
    ext_mem_116359.references = NULL;
    
    struct memblock ext_mem_116358;
    
    ext_mem_116358.references = NULL;
    
    struct memblock ext_mem_116357;
    
    ext_mem_116357.references = NULL;
    
    struct memblock ext_mem_116356;
    
    ext_mem_116356.references = NULL;
    
    struct memblock ext_mem_116355;
    
    ext_mem_116355.references = NULL;
    
    struct memblock ext_mem_116315;
    
    ext_mem_116315.references = NULL;
    
    struct memblock ext_mem_116289;
    
    ext_mem_116289.references = NULL;
    
    struct memblock ext_mem_116288;
    
    ext_mem_116288.references = NULL;
    
    struct memblock ext_mem_116287;
    
    ext_mem_116287.references = NULL;
    
    struct memblock ext_mem_116256;
    
    ext_mem_116256.references = NULL;
    
    struct memblock ext_mem_116230;
    
    ext_mem_116230.references = NULL;
    
    struct memblock ext_mem_116229;
    
    ext_mem_116229.references = NULL;
    
    struct memblock ext_mem_116228;
    
    ext_mem_116228.references = NULL;
    
    struct memblock ext_mem_116164;
    
    ext_mem_116164.references = NULL;
    
    struct memblock ext_mem_116163;
    
    ext_mem_116163.references = NULL;
    
    struct memblock ext_mem_116162;
    
    ext_mem_116162.references = NULL;
    
    struct memblock ext_mem_116161;
    
    ext_mem_116161.references = NULL;
    
    struct memblock ext_mem_116157;
    
    ext_mem_116157.references = NULL;
    
    struct memblock mem_param_tmp_117590;
    
    mem_param_tmp_117590.references = NULL;
    
    struct memblock mem_param_tmp_117589;
    
    mem_param_tmp_117589.references = NULL;
    
    struct memblock mem_param_tmp_117588;
    
    mem_param_tmp_117588.references = NULL;
    
    struct memblock mem_param_tmp_117587;
    
    mem_param_tmp_117587.references = NULL;
    
    struct memblock mem_param_tmp_117586;
    
    mem_param_tmp_117586.references = NULL;
    
    struct memblock mem_param_tmp_117585;
    
    mem_param_tmp_117585.references = NULL;
    
    struct memblock mem_param_tmp_117584;
    
    mem_param_tmp_117584.references = NULL;
    
    struct memblock mem_param_tmp_117583;
    
    mem_param_tmp_117583.references = NULL;
    
    struct memblock mem_param_tmp_117582;
    
    mem_param_tmp_117582.references = NULL;
    
    struct memblock ext_mem_116110;
    
    ext_mem_116110.references = NULL;
    
    struct memblock ext_mem_116083;
    
    ext_mem_116083.references = NULL;
    
    struct memblock ext_mem_116082;
    
    ext_mem_116082.references = NULL;
    
    struct memblock ext_mem_116081;
    
    ext_mem_116081.references = NULL;
    
    struct memblock mem_116080;
    
    mem_116080.references = NULL;
    
    struct memblock mem_116079;
    
    mem_116079.references = NULL;
    
    struct memblock mem_116078;
    
    mem_116078.references = NULL;
    
    struct memblock ext_mem_116047;
    
    ext_mem_116047.references = NULL;
    
    struct memblock ext_mem_116020;
    
    ext_mem_116020.references = NULL;
    
    struct memblock ext_mem_116019;
    
    ext_mem_116019.references = NULL;
    
    struct memblock ext_mem_116018;
    
    ext_mem_116018.references = NULL;
    
    struct memblock mem_116017;
    
    mem_116017.references = NULL;
    
    struct memblock mem_116016;
    
    mem_116016.references = NULL;
    
    struct memblock mem_116015;
    
    mem_116015.references = NULL;
    
    struct memblock mem_115979;
    
    mem_115979.references = NULL;
    
    struct memblock mem_115955;
    
    mem_115955.references = NULL;
    
    struct memblock mem_param_115938;
    
    mem_param_115938.references = NULL;
    
    struct memblock mem_param_115937;
    
    mem_param_115937.references = NULL;
    
    struct memblock mem_param_115936;
    
    mem_param_115936.references = NULL;
    
    struct memblock mem_param_115935;
    
    mem_param_115935.references = NULL;
    
    struct memblock mem_param_115934;
    
    mem_param_115934.references = NULL;
    
    struct memblock mem_param_115933;
    
    mem_param_115933.references = NULL;
    
    struct memblock mem_param_115932;
    
    mem_param_115932.references = NULL;
    
    struct memblock mem_param_115931;
    
    mem_param_115931.references = NULL;
    
    struct memblock mem_param_115930;
    
    mem_param_115930.references = NULL;
    
    struct memblock ext_mem_115913;
    
    ext_mem_115913.references = NULL;
    
    struct memblock ext_mem_115912;
    
    ext_mem_115912.references = NULL;
    
    struct memblock ext_mem_115911;
    
    ext_mem_115911.references = NULL;
    
    struct memblock ext_mem_115910;
    
    ext_mem_115910.references = NULL;
    
    struct memblock ext_mem_115909;
    
    ext_mem_115909.references = NULL;
    
    struct memblock ext_mem_115908;
    
    ext_mem_115908.references = NULL;
    
    struct memblock ext_mem_115907;
    
    ext_mem_115907.references = NULL;
    
    struct memblock ext_mem_115906;
    
    ext_mem_115906.references = NULL;
    
    struct memblock ext_mem_115905;
    
    ext_mem_115905.references = NULL;
    
    struct memblock ext_mem_115867;
    
    ext_mem_115867.references = NULL;
    
    struct memblock ext_mem_115842;
    
    ext_mem_115842.references = NULL;
    
    struct memblock ext_mem_115841;
    
    ext_mem_115841.references = NULL;
    
    struct memblock ext_mem_115840;
    
    ext_mem_115840.references = NULL;
    
    struct memblock ext_mem_115810;
    
    ext_mem_115810.references = NULL;
    
    struct memblock ext_mem_115786;
    
    ext_mem_115786.references = NULL;
    
    struct memblock ext_mem_115785;
    
    ext_mem_115785.references = NULL;
    
    struct memblock ext_mem_115784;
    
    ext_mem_115784.references = NULL;
    
    struct memblock mem_param_tmp_117488;
    
    mem_param_tmp_117488.references = NULL;
    
    struct memblock mem_param_tmp_117487;
    
    mem_param_tmp_117487.references = NULL;
    
    struct memblock mem_param_tmp_117486;
    
    mem_param_tmp_117486.references = NULL;
    
    struct memblock mem_param_tmp_117485;
    
    mem_param_tmp_117485.references = NULL;
    
    struct memblock mem_param_tmp_117484;
    
    mem_param_tmp_117484.references = NULL;
    
    struct memblock ext_mem_115451;
    
    ext_mem_115451.references = NULL;
    
    struct memblock ext_mem_115424;
    
    ext_mem_115424.references = NULL;
    
    struct memblock ext_mem_115423;
    
    ext_mem_115423.references = NULL;
    
    struct memblock ext_mem_115422;
    
    ext_mem_115422.references = NULL;
    
    struct memblock mem_115421;
    
    mem_115421.references = NULL;
    
    struct memblock mem_115420;
    
    mem_115420.references = NULL;
    
    struct memblock mem_115419;
    
    mem_115419.references = NULL;
    
    struct memblock ext_mem_115388;
    
    ext_mem_115388.references = NULL;
    
    struct memblock ext_mem_115361;
    
    ext_mem_115361.references = NULL;
    
    struct memblock ext_mem_115360;
    
    ext_mem_115360.references = NULL;
    
    struct memblock ext_mem_115359;
    
    ext_mem_115359.references = NULL;
    
    struct memblock mem_115358;
    
    mem_115358.references = NULL;
    
    struct memblock mem_115357;
    
    mem_115357.references = NULL;
    
    struct memblock mem_115356;
    
    mem_115356.references = NULL;
    
    struct memblock mem_115320;
    
    mem_115320.references = NULL;
    
    struct memblock mem_115296;
    
    mem_115296.references = NULL;
    
    struct memblock ext_mem_115255;
    
    ext_mem_115255.references = NULL;
    
    struct memblock ext_mem_115211;
    
    ext_mem_115211.references = NULL;
    
    struct memblock mem_param_115532;
    
    mem_param_115532.references = NULL;
    
    struct memblock mem_param_115531;
    
    mem_param_115531.references = NULL;
    
    struct memblock mem_param_115530;
    
    mem_param_115530.references = NULL;
    
    struct memblock ext_mem_114001;
    
    ext_mem_114001.references = NULL;
    
    struct memblock ext_mem_114002;
    
    ext_mem_114002.references = NULL;
    
    struct memblock ext_mem_114003;
    
    ext_mem_114003.references = NULL;
    
    struct memblock mem_in_114683;
    
    mem_in_114683.references = NULL;
    
    struct memblock mem_113906;
    
    mem_113906.references = NULL;
    
    struct memblock mem_113660;
    
    mem_113660.references = NULL;
    
    struct memblock mem_113610;
    
    mem_113610.references = NULL;
    
    struct memblock mem_113528;
    
    mem_113528.references = NULL;
    
    struct memblock mem_113516;
    
    mem_113516.references = NULL;
    
    struct memblock mem_113513;
    
    mem_113513.references = NULL;
    
    struct memblock mem_113511;
    
    mem_113511.references = NULL;
    
    struct memblock mem_113478;
    
    mem_113478.references = NULL;
    
    struct memblock mem_113466;
    
    mem_113466.references = NULL;
    
    struct memblock mem_113463;
    
    mem_113463.references = NULL;
    
    struct memblock mem_113461;
    
    mem_113461.references = NULL;
    
    struct memblock mem_113453;
    
    mem_113453.references = NULL;
    
    struct memblock mem_113445;
    
    mem_113445.references = NULL;
    
    struct memblock mem_113383;
    
    mem_113383.references = NULL;
    
    struct memblock mem_113333;
    
    mem_113333.references = NULL;
    
    struct memblock mem_113238;
    
    mem_113238.references = NULL;
    
    struct memblock mem_113226;
    
    mem_113226.references = NULL;
    
    struct memblock mem_113223;
    
    mem_113223.references = NULL;
    
    struct memblock mem_113221;
    
    mem_113221.references = NULL;
    
    struct memblock mem_113188;
    
    mem_113188.references = NULL;
    
    struct memblock mem_113176;
    
    mem_113176.references = NULL;
    
    struct memblock mem_113173;
    
    mem_113173.references = NULL;
    
    struct memblock mem_113171;
    
    mem_113171.references = NULL;
    
    struct memblock mem_113157;
    
    mem_113157.references = NULL;
    
    struct memblock mem_113155;
    
    mem_113155.references = NULL;
    
    struct memblock mem_113125;
    
    mem_113125.references = NULL;
    
    struct memblock mem_113122;
    
    mem_113122.references = NULL;
    
    struct memblock mem_113120;
    
    mem_113120.references = NULL;
    
    struct memblock mem_113017;
    
    mem_113017.references = NULL;
    
    struct memblock mem_param_115286;
    
    mem_param_115286.references = NULL;
    
    struct memblock mem_param_115285;
    
    mem_param_115285.references = NULL;
    
    struct memblock mem_param_115284;
    
    mem_param_115284.references = NULL;
    
    struct memblock mem_param_115283;
    
    mem_param_115283.references = NULL;
    
    struct memblock mem_param_115282;
    
    mem_param_115282.references = NULL;
    
    struct memblock ext_mem_112991;
    
    ext_mem_112991.references = NULL;
    
    struct memblock ext_mem_112992;
    
    ext_mem_112992.references = NULL;
    
    struct memblock ext_mem_112993;
    
    ext_mem_112993.references = NULL;
    
    struct memblock ext_mem_112994;
    
    ext_mem_112994.references = NULL;
    
    struct memblock ext_mem_112995;
    
    ext_mem_112995.references = NULL;
    
    struct memblock mem_112948;
    
    mem_112948.references = NULL;
    
    struct memblock mem_112898;
    
    mem_112898.references = NULL;
    
    struct memblock ext_mem_112841;
    
    ext_mem_112841.references = NULL;
    
    struct memblock ext_mem_112844;
    
    ext_mem_112844.references = NULL;
    
    struct memblock ext_mem_112847;
    
    ext_mem_112847.references = NULL;
    
    struct memblock mem_112816;
    
    mem_112816.references = NULL;
    
    struct memblock mem_112804;
    
    mem_112804.references = NULL;
    
    struct memblock mem_112801;
    
    mem_112801.references = NULL;
    
    struct memblock mem_112799;
    
    mem_112799.references = NULL;
    
    struct memblock ext_mem_112791;
    
    ext_mem_112791.references = NULL;
    
    struct memblock ext_mem_112794;
    
    ext_mem_112794.references = NULL;
    
    struct memblock ext_mem_112797;
    
    ext_mem_112797.references = NULL;
    
    struct memblock mem_112766;
    
    mem_112766.references = NULL;
    
    struct memblock mem_112754;
    
    mem_112754.references = NULL;
    
    struct memblock mem_112751;
    
    mem_112751.references = NULL;
    
    struct memblock mem_112749;
    
    mem_112749.references = NULL;
    
    struct memblock mem_112741;
    
    mem_112741.references = NULL;
    
    struct memblock mem_112733;
    
    mem_112733.references = NULL;
    
    struct memblock mem_112709;
    
    mem_112709.references = NULL;
    
    struct memblock mem_112698;
    
    mem_112698.references = NULL;
    
    struct memblock mem_112650;
    
    mem_112650.references = NULL;
    
    int64_t flat_tid_103890;
    
    flat_tid_103890 = subtask_id;
    {
        int64_t start_117403;
        int64_t end_117404;
        
        start_117403 = start;
        end_117404 = end;
        
        int64_t n_117405 = end_117404 - start_117403;
        
        if (mem_112580_cached_sizze_127383 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_112580, &mem_112580_cached_sizze_127383, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_112582_cached_sizze_127384 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_112582, &mem_112582_cached_sizze_127384, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_112585_cached_sizze_127385 < bytes_111743) {
            err = lexical_realloc(ctx, &mem_112585, &mem_112585_cached_sizze_127385, bytes_111743);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_112615_cached_sizze_127386 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_112615, &mem_112615_cached_sizze_127386, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_112617_cached_sizze_127387 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_112617, &mem_112617_cached_sizze_127387, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_112619_cached_sizze_127388 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_112619, &mem_112619_cached_sizze_127388, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_112639_cached_sizze_127389 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_112639, &mem_112639_cached_sizze_127389, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_112648_cached_sizze_127390 < bytes_111743) {
            err = lexical_realloc(ctx, &mem_112648, &mem_112648_cached_sizze_127390, bytes_111743);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_112650, bytes_111715, "mem_112650")) {
            err = 1;
            goto cleanup;
        }
        if (mem_112659_cached_sizze_127391 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_112659, &mem_112659_cached_sizze_127391, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_112661_cached_sizze_127392 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_112661, &mem_112661_cached_sizze_127392, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_112675_cached_sizze_127393 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_112675, &mem_112675_cached_sizze_127393, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_112698, bytes_111715, "mem_112698")) {
            err = 1;
            goto cleanup;
        }
        if (mem_112706_cached_sizze_127394 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_112706, &mem_112706_cached_sizze_127394, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_112709, bytes_111743, "mem_112709")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_112733, bytes_111715, "mem_112733")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_112741, bytes_111715, "mem_112741")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_112749, bytes_111715, "mem_112749")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_112751, bytes_111715, "mem_112751")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_112754, bytes_111743, "mem_112754")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_112766, bytes_111715, "mem_112766")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_112799, bytes_111715, "mem_112799")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_112801, bytes_111715, "mem_112801")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_112804, bytes_111743, "mem_112804")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_112816, bytes_111715, "mem_112816")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_112898, bytes_111715, "mem_112898")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_112948, bytes_111715, "mem_112948")) {
            err = 1;
            goto cleanup;
        }
        if (mem_112998_cached_sizze_127395 < bytes_111743) {
            err = lexical_realloc(ctx, &mem_112998, &mem_112998_cached_sizze_127395, bytes_111743);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_113017, bytes_111743, "mem_113017")) {
            err = 1;
            goto cleanup;
        }
        if (mem_113045_cached_sizze_127396 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_113045, &mem_113045_cached_sizze_127396, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_113053_cached_sizze_127397 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_113053, &mem_113053_cached_sizze_127397, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_113055_cached_sizze_127398 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_113055, &mem_113055_cached_sizze_127398, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_113069_cached_sizze_127399 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_113069, &mem_113069_cached_sizze_127399, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_113078_cached_sizze_127400 < bytes_111743) {
            err = lexical_realloc(ctx, &mem_113078, &mem_113078_cached_sizze_127400, bytes_111743);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_113080_cached_sizze_127401 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_113080, &mem_113080_cached_sizze_127401, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_113089_cached_sizze_127402 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_113089, &mem_113089_cached_sizze_127402, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_113097_cached_sizze_127403 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_113097, &mem_113097_cached_sizze_127403, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_113120, bytes_111715, "mem_113120")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_113122, bytes_111715, "mem_113122")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_113125, bytes_111743, "mem_113125")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_113155, bytes_111715, "mem_113155")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_113157, bytes_111715, "mem_113157")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_113171, bytes_111715, "mem_113171")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_113173, bytes_111715, "mem_113173")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_113176, bytes_111743, "mem_113176")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_113188, bytes_111715, "mem_113188")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_113221, bytes_111715, "mem_113221")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_113223, bytes_111715, "mem_113223")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_113226, bytes_111743, "mem_113226")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_113238, bytes_111715, "mem_113238")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_113333, bytes_111715, "mem_113333")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_113383, bytes_111715, "mem_113383")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_113445, bytes_111715, "mem_113445")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_113453, bytes_111715, "mem_113453")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_113461, bytes_111715, "mem_113461")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_113463, bytes_111715, "mem_113463")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_113466, bytes_111743, "mem_113466")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_113478, bytes_111715, "mem_113478")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_113511, bytes_111715, "mem_113511")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_113513, bytes_111715, "mem_113513")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_113516, bytes_111743, "mem_113516")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_113528, bytes_111715, "mem_113528")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_113610, bytes_111715, "mem_113610")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_113660, bytes_111715, "mem_113660")) {
            err = 1;
            goto cleanup;
        }
        if (mem_113728_cached_sizze_127404 < bytes_111743) {
            err = lexical_realloc(ctx, &mem_113728, &mem_113728_cached_sizze_127404, bytes_111743);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_113765_cached_sizze_127405 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_113765, &mem_113765_cached_sizze_127405, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_113767_cached_sizze_127406 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_113767, &mem_113767_cached_sizze_127406, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_113769_cached_sizze_127407 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_113769, &mem_113769_cached_sizze_127407, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_113790_cached_sizze_127408 < bytes_111743) {
            err = lexical_realloc(ctx, &mem_113790, &mem_113790_cached_sizze_127408, bytes_111743);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_113802_cached_sizze_127409 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_113802, &mem_113802_cached_sizze_127409, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_113804_cached_sizze_127410 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_113804, &mem_113804_cached_sizze_127410, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_113818_cached_sizze_127411 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_113818, &mem_113818_cached_sizze_127411, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_113826_cached_sizze_127412 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_113826, &mem_113826_cached_sizze_127412, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_113829_cached_sizze_127413 < bytes_111743) {
            err = lexical_realloc(ctx, &mem_113829, &mem_113829_cached_sizze_127413, bytes_111743);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_113845_cached_sizze_127414 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_113845, &mem_113845_cached_sizze_127414, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_113880_cached_sizze_127415 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_113880, &mem_113880_cached_sizze_127415, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_113888_cached_sizze_127416 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_113888, &mem_113888_cached_sizze_127416, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_113900_cached_sizze_127417 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_113900, &mem_113900_cached_sizze_127417, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_113903_cached_sizze_127418 < bytes_111743) {
            err = lexical_realloc(ctx, &mem_113903, &mem_113903_cached_sizze_127418, bytes_111743);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_113906, bytes_111743, "mem_113906")) {
            err = 1;
            goto cleanup;
        }
        if (mem_113946_cached_sizze_127419 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_113946, &mem_113946_cached_sizze_127419, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_113954_cached_sizze_127420 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_113954, &mem_113954_cached_sizze_127420, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_in_114683, num_bytes_114668, "mem_in_114683")) {
            err = 1;
            goto cleanup;
        }
        if (mem_114005_cached_sizze_127421 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_114005, &mem_114005_cached_sizze_127421, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_114007_cached_sizze_127422 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_114007, &mem_114007_cached_sizze_127422, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_114009_cached_sizze_127423 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_114009, &mem_114009_cached_sizze_127423, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_114020_cached_sizze_127424 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_114020, &mem_114020_cached_sizze_127424, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_114037_cached_sizze_127425 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_114037, &mem_114037_cached_sizze_127425, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_114039_cached_sizze_127426 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_114039, &mem_114039_cached_sizze_127426, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_114041_cached_sizze_127427 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_114041, &mem_114041_cached_sizze_127427, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        for (int64_t SegMap_i_117406 = start_117403; SegMap_i_117406 < start_117403 + n_117405; SegMap_i_117406++) {
            int64_t slice_117407 = defunc_0_reduce_res_103765;
            int64_t gtid_103891 = SegMap_i_117406;
            int64_t remnant_117408 = SegMap_i_117406 - gtid_103891;
            int64_t eta_p_70073 = ((int64_t *) mem_111723.mem)[gtid_103891];
            int64_t eta_p_70075 = ((int64_t *) mem_111719.mem)[gtid_103891];
            int64_t lifted_lambda_res_70082 = sub64(eta_p_70075, (int64_t) 1);
            int64_t zp_lhs_70083 = add64(eta_p_70073, lifted_lambda_res_70082);
            int64_t lifted_lambda_res_70084 = add64((int64_t) 1, zp_lhs_70083);
            bool x_70085 = sle64((int64_t) 0, lifted_lambda_res_70084);
            bool y_70086 = slt64(lifted_lambda_res_70084, k_33387);
            bool bounds_check_70087 = x_70085 && y_70086;
            bool index_certs_70088;
            
            if (!bounds_check_70087) {
                set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) lifted_lambda_res_70084, "] out of bounds for array of shape [", (long long) k_33387, "].", "-> #0  unbalanced_gw.fut:155:43-52\n   #1  /prelude/functional.fut:9:44-45\n   #2  unbalanced_gw.fut:152:6-156:84\n"));
                err = FUTHARK_PROGRAM_ERROR;
                goto cleanup;
            }
            
            bool x_70091 = sle64((int64_t) 0, eta_p_70073);
            bool y_70092 = slt64(eta_p_70073, k_33387);
            bool bounds_check_70093 = x_70091 && y_70092;
            bool index_certs_70094;
            
            if (!bounds_check_70093) {
                set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) eta_p_70073, "] out of bounds for array of shape [", (long long) k_33387, "].", "-> #0  unbalanced_gw.fut:155:28-37\n   #1  /prelude/functional.fut:9:44-45\n   #2  unbalanced_gw.fut:152:6-156:84\n"));
                err = FUTHARK_PROGRAM_ERROR;
                goto cleanup;
            }
            
            double defunc_res_103700;
            double defunc_res_103701;
            double defunc_res_103702;
            double defunc_res_103703;
            double defunc_res_103704;
            double defunc_res_103705;
            double defunc_res_103706;
            double defunc_res_103707;
            double defunc_res_103708;
            double redout_114886;
            double redout_114887;
            double redout_114888;
            double redout_114889;
            double redout_114890;
            double redout_114891;
            double redout_114892;
            double redout_114893;
            double redout_114894;
            
            redout_114886 = 0.0;
            redout_114887 = 0.0;
            redout_114888 = 0.0;
            redout_114889 = 0.0;
            redout_114890 = 0.0;
            redout_114891 = 0.0;
            redout_114892 = 0.0;
            redout_114893 = 0.0;
            redout_114894 = 0.0;
            for (int64_t i_114885 = 0; i_114885 < m_33388; i_114885++) {
                double x_114898 = ((double *) distrs_mem_111708.mem)[eta_p_70073 * m_33388 + i_114885];
                double defunc_res_114900;
                double defunc_res_114901;
                double defunc_res_114902;
                double defunc_res_114903;
                double defunc_res_114904;
                double defunc_res_114905;
                double defunc_res_114906;
                double defunc_res_114907;
                double redout_114910;
                double redout_114911;
                double redout_114912;
                double redout_114913;
                double redout_114914;
                double redout_114915;
                double redout_114916;
                double redout_114917;
                
                redout_114910 = 0.0;
                redout_114911 = 0.0;
                redout_114912 = 0.0;
                redout_114913 = 0.0;
                redout_114914 = 0.0;
                redout_114915 = 0.0;
                redout_114916 = 0.0;
                redout_114917 = 0.0;
                for (int64_t i_114909 = 0; i_114909 < m_33388; i_114909++) {
                    double eta_p_114919 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_70084 * m_33388 + i_114909];
                    double zt_res_114920 = x_114898 * eta_p_114919;
                    bool zeze_res_114921 = zt_res_114920 == 0.0;
                    double klu_res_114922;
                    
                    if (zeze_res_114921) {
                        klu_res_114922 = 0.0;
                    } else {
                        double zs_res_114923 = zt_res_114920 / zt_res_114920;
                        double log_res_114924 = futrts_log64(zs_res_114923);
                        double zt_res_114925 = zt_res_114920 * log_res_114924;
                        
                        klu_res_114922 = zt_res_114925;
                    }
                    
                    double klu_res_114926;
                    
                    if (zeze_res_114921) {
                        klu_res_114926 = 0.0;
                    } else {
                        double zs_res_114927 = zt_res_114920 / zt_res_114920;
                        double log_res_114928 = futrts_log64(zs_res_114927);
                        double zt_res_114929 = zt_res_114920 * log_res_114928;
                        
                        klu_res_114926 = zt_res_114929;
                    }
                    
                    double zp_res_114930 = klu_res_114922 + redout_114910;
                    double zp_res_114931 = klu_res_114926 + redout_114911;
                    double zp_res_114932 = zt_res_114920 + redout_114912;
                    double zp_res_114933 = zt_res_114920 + redout_114913;
                    double zp_res_114934 = zt_res_114920 + redout_114914;
                    double zp_res_114935 = zt_res_114920 + redout_114915;
                    double zp_res_114936 = zt_res_114920 + redout_114916;
                    double zp_res_114937 = zt_res_114920 + redout_114917;
                    
                    ((double *) mem_112585)[i_114885 * m_33388 + i_114909] = zt_res_114920;
                    
                    double redout_tmp_117421 = zp_res_114930;
                    double redout_tmp_117422 = zp_res_114931;
                    double redout_tmp_117423 = zp_res_114932;
                    double redout_tmp_117424 = zp_res_114933;
                    double redout_tmp_117425 = zp_res_114934;
                    double redout_tmp_117426 = zp_res_114935;
                    double redout_tmp_117427 = zp_res_114936;
                    double redout_tmp_117428 = zp_res_114937;
                    
                    redout_114910 = redout_tmp_117421;
                    redout_114911 = redout_tmp_117422;
                    redout_114912 = redout_tmp_117423;
                    redout_114913 = redout_tmp_117424;
                    redout_114914 = redout_tmp_117425;
                    redout_114915 = redout_tmp_117426;
                    redout_114916 = redout_tmp_117427;
                    redout_114917 = redout_tmp_117428;
                }
                defunc_res_114900 = redout_114910;
                defunc_res_114901 = redout_114911;
                defunc_res_114902 = redout_114912;
                defunc_res_114903 = redout_114913;
                defunc_res_114904 = redout_114914;
                defunc_res_114905 = redout_114915;
                defunc_res_114906 = redout_114916;
                defunc_res_114907 = redout_114917;
                
                bool zeze_res_114939 = defunc_res_114906 == 0.0;
                double klu_res_114940;
                
                if (zeze_res_114939) {
                    klu_res_114940 = 0.0;
                } else {
                    double zs_res_114941 = defunc_res_114906 / x_114898;
                    double log_res_114942 = futrts_log64(zs_res_114941);
                    double zt_res_114943 = log_res_114942 * defunc_res_114906;
                    
                    klu_res_114940 = zt_res_114943;
                }
                
                bool zeze_res_114944 = defunc_res_114904 == 0.0;
                double klu_res_114945;
                
                if (zeze_res_114944) {
                    klu_res_114945 = 0.0;
                } else {
                    double zs_res_114946 = defunc_res_114904 / x_114898;
                    double log_res_114947 = futrts_log64(zs_res_114946);
                    double zt_res_114948 = log_res_114947 * defunc_res_114904;
                    
                    klu_res_114945 = zt_res_114948;
                }
                
                double zp_res_114949 = defunc_res_114907 + redout_114886;
                double zp_res_114950 = klu_res_114940 + redout_114887;
                double zp_res_114951 = defunc_res_114900 + redout_114888;
                double zp_res_114952 = defunc_res_114905 + redout_114889;
                double zp_res_114953 = klu_res_114945 + redout_114890;
                double zp_res_114954 = defunc_res_114904 + redout_114891;
                double zp_res_114955 = defunc_res_114901 + redout_114892;
                double zp_res_114956 = x_114898 + redout_114893;
                double zp_res_114957 = x_114898 + redout_114894;
                
                ((double *) mem_112580)[i_114885] = defunc_res_114902;
                ((double *) mem_112582)[i_114885] = defunc_res_114903;
                
                double redout_tmp_117409 = zp_res_114949;
                double redout_tmp_117410 = zp_res_114950;
                double redout_tmp_117411 = zp_res_114951;
                double redout_tmp_117412 = zp_res_114952;
                double redout_tmp_117413 = zp_res_114953;
                double redout_tmp_117414 = zp_res_114954;
                double redout_tmp_117415 = zp_res_114955;
                double redout_tmp_117416 = zp_res_114956;
                double redout_tmp_117417 = zp_res_114957;
                
                redout_114886 = redout_tmp_117409;
                redout_114887 = redout_tmp_117410;
                redout_114888 = redout_tmp_117411;
                redout_114889 = redout_tmp_117412;
                redout_114890 = redout_tmp_117413;
                redout_114891 = redout_tmp_117414;
                redout_114892 = redout_tmp_117415;
                redout_114893 = redout_tmp_117416;
                redout_114894 = redout_tmp_117417;
            }
            defunc_res_103700 = redout_114886;
            defunc_res_103701 = redout_114887;
            defunc_res_103702 = redout_114888;
            defunc_res_103703 = redout_114889;
            defunc_res_103704 = redout_114890;
            defunc_res_103705 = redout_114891;
            defunc_res_103706 = redout_114892;
            defunc_res_103707 = redout_114893;
            defunc_res_103708 = redout_114894;
            
            double zt_res_70117 = eps_33391 * defunc_res_103700;
            double defunc_res_103712;
            double defunc_res_103713;
            double defunc_res_103714;
            double defunc_res_103715;
            double redout_114962;
            double redout_114963;
            double redout_114964;
            double redout_114965;
            
            redout_114962 = 0.0;
            redout_114963 = 0.0;
            redout_114964 = 0.0;
            redout_114965 = 0.0;
            for (int64_t i_114961 = 0; i_114961 < m_33388; i_114961++) {
                double x_114969 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_70084 * m_33388 + i_114961];
                double log_res_114970 = futrts_log64(x_114969);
                double zt_res_114971 = zt_res_70117 * log_res_114970;
                double defunc_res_114972;
                double defunc_res_114973;
                double defunc_res_114974;
                double defunc_res_114975;
                double redout_114977;
                double redout_114978;
                double redout_114979;
                double redout_114980;
                
                redout_114977 = 0.0;
                redout_114978 = 0.0;
                redout_114979 = 0.0;
                redout_114980 = 0.0;
                for (int64_t i_114976 = 0; i_114976 < m_33388; i_114976++) {
                    double x_114981 = ((double *) mem_112585)[i_114976 * m_33388 + i_114961];
                    double zp_res_114982 = x_114981 + redout_114977;
                    double zp_res_114983 = x_114981 + redout_114978;
                    double zp_res_114984 = x_114981 + redout_114979;
                    double zp_res_114985 = x_114981 + redout_114980;
                    double redout_tmp_117437 = zp_res_114982;
                    double redout_tmp_117438 = zp_res_114983;
                    double redout_tmp_117439 = zp_res_114984;
                    double redout_tmp_117440 = zp_res_114985;
                    
                    redout_114977 = redout_tmp_117437;
                    redout_114978 = redout_tmp_117438;
                    redout_114979 = redout_tmp_117439;
                    redout_114980 = redout_tmp_117440;
                }
                defunc_res_114972 = redout_114977;
                defunc_res_114973 = redout_114978;
                defunc_res_114974 = redout_114979;
                defunc_res_114975 = redout_114980;
                
                bool zeze_res_114986 = defunc_res_114972 == 0.0;
                double klu_res_114987;
                
                if (zeze_res_114986) {
                    klu_res_114987 = 0.0;
                } else {
                    double zs_res_114988 = defunc_res_114972 / x_114969;
                    double log_res_114989 = futrts_log64(zs_res_114988);
                    double zt_res_114990 = log_res_114989 * defunc_res_114972;
                    
                    klu_res_114987 = zt_res_114990;
                }
                
                bool zeze_res_114991 = defunc_res_114973 == 0.0;
                double klu_res_114992;
                
                if (zeze_res_114991) {
                    klu_res_114992 = 0.0;
                } else {
                    double zs_res_114993 = defunc_res_114973 / x_114969;
                    double log_res_114994 = futrts_log64(zs_res_114993);
                    double zt_res_114995 = log_res_114994 * defunc_res_114973;
                    
                    klu_res_114992 = zt_res_114995;
                }
                
                double zp_res_114996 = klu_res_114987 + redout_114962;
                double zp_res_114997 = klu_res_114992 + redout_114963;
                double zp_res_114998 = x_114969 + redout_114964;
                double zp_res_114999 = x_114969 + redout_114965;
                
                ((double *) mem_112615)[i_114961] = defunc_res_114975;
                ((double *) mem_112617)[i_114961] = defunc_res_114974;
                ((double *) mem_112619)[i_114961] = zt_res_114971;
                
                double redout_tmp_117430 = zp_res_114996;
                double redout_tmp_117431 = zp_res_114997;
                double redout_tmp_117432 = zp_res_114998;
                double redout_tmp_117433 = zp_res_114999;
                
                redout_114962 = redout_tmp_117430;
                redout_114963 = redout_tmp_117431;
                redout_114964 = redout_tmp_117432;
                redout_114965 = redout_tmp_117433;
            }
            defunc_res_103712 = redout_114962;
            defunc_res_103713 = redout_114963;
            defunc_res_103714 = redout_114964;
            defunc_res_103715 = redout_114965;
            
            double zt_res_70259 = rho2_33390 * defunc_res_103712;
            double zt_res_70238 = rho1_33389 * defunc_res_103701;
            double zp_res_70283 = zt_res_70238 + zt_res_70259;
            double zt_res_70282 = eps_33391 * defunc_res_103702;
            double zp_res_70284 = zt_res_70282 + zp_res_70283;
            double defunc_0_reduce_res_103719;
            double redout_115004 = 0.0;
            
            for (int64_t i_115003 = 0; i_115003 < m_33388; i_115003++) {
                double eta_p_115006 = ((double *) mem_112615)[i_115003];
                double defunc_0_reduce_res_115007;
                double defunc_0_reduce_res_115008;
                double redout_115010;
                double redout_115011;
                
                redout_115010 = 0.0;
                redout_115011 = 0.0;
                for (int64_t i_115009 = 0; i_115009 < m_33388; i_115009++) {
                    double eta_p_115012 = ((double *) A_mem_111707.mem)[lifted_lambda_res_70084 * (m_33388 * m_33388) + i_115003 * m_33388 + i_115009];
                    double eta_p_115013 = ((double *) mem_112615)[i_115009];
                    double eta_p_115014 = ((double *) mem_112617)[i_115009];
                    double zt_res_115015 = eta_p_115012 * eta_p_115012;
                    double zt_res_115016 = eta_p_115014 * zt_res_115015;
                    double zt_res_115017 = eta_p_115013 * zt_res_115015;
                    double zp_res_115018 = zt_res_115016 + redout_115010;
                    double zp_res_115019 = zt_res_115017 + redout_115011;
                    double redout_tmp_117443 = zp_res_115018;
                    double redout_tmp_117444 = zp_res_115019;
                    
                    redout_115010 = redout_tmp_117443;
                    redout_115011 = redout_tmp_117444;
                }
                defunc_0_reduce_res_115007 = redout_115010;
                defunc_0_reduce_res_115008 = redout_115011;
                
                double zt_res_115020 = eta_p_115006 * defunc_0_reduce_res_115008;
                double zp_res_115021 = zt_res_115020 + redout_115004;
                
                ((double *) mem_112639)[i_115003] = defunc_0_reduce_res_115007;
                
                double redout_tmp_117441 = zp_res_115021;
                
                redout_115004 = redout_tmp_117441;
            }
            defunc_0_reduce_res_103719 = redout_115004;
            
            double defunc_0_reduce_res_103721;
            double defunc_res_103722;
            double redout_115024;
            double redout_115025;
            
            redout_115024 = 0.0;
            redout_115025 = 0.0;
            for (int64_t i_115023 = 0; i_115023 < m_33388; i_115023++) {
                double eta_p_115028 = ((double *) mem_112582)[i_115023];
                double eta_p_115029 = ((double *) distrs_mem_111708.mem)[eta_p_70073 * m_33388 + i_115023];
                double log_res_115030 = futrts_log64(eta_p_115029);
                double zt_res_115031 = zt_res_70117 * log_res_115030;
                double defunc_0_reduce_res_115032;
                double defunc_0_reduce_res_115033;
                double redout_115035;
                double redout_115036;
                
                redout_115035 = 0.0;
                redout_115036 = 0.0;
                for (int64_t i_115034 = 0; i_115034 < m_33388; i_115034++) {
                    double eta_p_115037 = ((double *) A_mem_111707.mem)[eta_p_70073 * (m_33388 * m_33388) + i_115023 * m_33388 + i_115034];
                    double eta_p_115038 = ((double *) mem_112582)[i_115034];
                    double eta_p_115039 = ((double *) mem_112580)[i_115034];
                    double zt_res_115040 = eta_p_115037 * eta_p_115037;
                    double zt_res_115041 = eta_p_115039 * zt_res_115040;
                    double zt_res_115042 = eta_p_115038 * zt_res_115040;
                    double zp_res_115043 = zt_res_115041 + redout_115035;
                    double zp_res_115044 = zt_res_115042 + redout_115036;
                    double redout_tmp_117449 = zp_res_115043;
                    double redout_tmp_117450 = zp_res_115044;
                    
                    redout_115035 = redout_tmp_117449;
                    redout_115036 = redout_tmp_117450;
                }
                defunc_0_reduce_res_115032 = redout_115035;
                defunc_0_reduce_res_115033 = redout_115036;
                for (int64_t i_115049 = 0; i_115049 < m_33388; i_115049++) {
                    double defunc_0_reduce_res_115052;
                    double defunc_0_reduce_res_115053;
                    double redout_115055;
                    double redout_115056;
                    
                    redout_115055 = 0.0;
                    redout_115056 = 0.0;
                    for (int64_t i_115054 = 0; i_115054 < m_33388; i_115054++) {
                        double eta_p_115057 = ((double *) A_mem_111707.mem)[eta_p_70073 * (m_33388 * m_33388) + i_115023 * m_33388 + i_115054];
                        double eta_p_115058 = ((double *) mem_112585)[i_115054 * m_33388 + i_115049];
                        double zt_res_115059 = eta_p_115057 * eta_p_115058;
                        double zp_res_115060 = zt_res_115059 + redout_115055;
                        double zp_res_115061 = zt_res_115059 + redout_115056;
                        double redout_tmp_117453 = zp_res_115060;
                        double redout_tmp_117454 = zp_res_115061;
                        
                        redout_115055 = redout_tmp_117453;
                        redout_115056 = redout_tmp_117454;
                    }
                    defunc_0_reduce_res_115052 = redout_115055;
                    defunc_0_reduce_res_115053 = redout_115056;
                    ((double *) mem_112659)[i_115049] = defunc_0_reduce_res_115053;
                    ((double *) mem_112661)[i_115049] = defunc_0_reduce_res_115052;
                }
                
                double defunc_0_reduce_res_115065;
                double defunc_0_reduce_res_115066;
                double redout_115069;
                double redout_115070;
                
                redout_115069 = INFINITY;
                redout_115070 = 0.0;
                for (int64_t i_115068 = 0; i_115068 < m_33388; i_115068++) {
                    double eta_p_115072 = ((double *) mem_112585)[i_115023 * m_33388 + i_115068];
                    double eta_p_wasfree_115073 = ((double *) mem_112639)[i_115068];
                    double eta_p_wasfree_115074 = ((double *) mem_112619)[i_115068];
                    double defunc_0_reduce_res_115075;
                    double defunc_0_reduce_res_115076;
                    double redout_115078;
                    double redout_115079;
                    
                    redout_115078 = 0.0;
                    redout_115079 = 0.0;
                    for (int64_t i_115077 = 0; i_115077 < m_33388; i_115077++) {
                        double eta_p_115080 = ((double *) mem_112659)[i_115077];
                        double eta_p_115081 = ((double *) mem_111727.mem)[lifted_lambda_res_70084 * (m_33388 * m_33388) + i_115077 * m_33388 + i_115068];
                        double eta_p_115082 = ((double *) mem_112661)[i_115077];
                        double zt_res_115083 = eta_p_115081 * eta_p_115082;
                        double zt_res_115084 = eta_p_115080 * eta_p_115081;
                        double zp_res_115085 = zt_res_115083 + redout_115078;
                        double zp_res_115086 = zt_res_115084 + redout_115079;
                        double redout_tmp_117458 = zp_res_115085;
                        double redout_tmp_117459 = zp_res_115086;
                        
                        redout_115078 = redout_tmp_117458;
                        redout_115079 = redout_tmp_117459;
                    }
                    defunc_0_reduce_res_115075 = redout_115078;
                    defunc_0_reduce_res_115076 = redout_115079;
                    
                    double zt_res_115087 = -2.0 * defunc_0_reduce_res_115075;
                    double zp_res_115088 = zt_res_115087 + defunc_0_reduce_res_115032;
                    double zp_res_115089 = eta_p_wasfree_115073 + zp_res_115088;
                    double zp_res_115090 = zp_res_70284 + zp_res_115089;
                    double zm_res_115091 = zp_res_115090 - zt_res_115031;
                    double zm_res_115092 = zm_res_115091 - eta_p_wasfree_115074;
                    double zs_res_115093 = zm_res_115092 / defunc_res_103703;
                    double zs_res_115094 = zs_res_115093 / neg_res_43882;
                    double zm_res_115095 = safe_for_exp_33395 - zs_res_115094;
                    double zt_res_115096 = eta_p_115072 * defunc_0_reduce_res_115076;
                    double min_res_115097 = fmin64(zm_res_115095, redout_115069);
                    double zp_res_115098 = zt_res_115096 + redout_115070;
                    
                    ((double *) mem_112675)[i_115068] = zs_res_115094;
                    
                    double redout_tmp_117455 = min_res_115097;
                    double redout_tmp_117456 = zp_res_115098;
                    
                    redout_115069 = redout_tmp_117455;
                    redout_115070 = redout_tmp_117456;
                }
                defunc_0_reduce_res_115065 = redout_115069;
                defunc_0_reduce_res_115066 = redout_115070;
                for (int64_t i_115102 = 0; i_115102 < m_33388; i_115102++) {
                    double eta_p_115104 = ((double *) mem_112675)[i_115102];
                    double zp_res_115105 = eta_p_115104 + defunc_0_reduce_res_115065;
                    
                    ((double *) mem_112648)[i_115023 * m_33388 + i_115102] = zp_res_115105;
                }
                
                double zt_res_115107 = eta_p_115028 * defunc_0_reduce_res_115033;
                double zp_res_115108 = zt_res_115107 + redout_115024;
                double zp_res_115109 = defunc_0_reduce_res_115066 + redout_115025;
                
                ((double *) mem_112650.mem)[i_115023] = defunc_0_reduce_res_115065;
                
                double redout_tmp_117445 = zp_res_115108;
                double redout_tmp_117446 = zp_res_115109;
                
                redout_115024 = redout_tmp_117445;
                redout_115025 = redout_tmp_117446;
            }
            defunc_0_reduce_res_103721 = redout_115024;
            defunc_res_103722 = redout_115025;
            for (int64_t i_115112 = 0; i_115112 < m_33388; i_115112++) {
                double defunc_0_reduce_res_115114;
                double redout_115116 = INFINITY;
                
                for (int64_t i_115115 = 0; i_115115 < m_33388; i_115115++) {
                    double eta_p_115117 = ((double *) mem_112648)[i_115115 * m_33388 + i_115112];
                    double zm_res_115118 = safe_for_exp_33395 - eta_p_115117;
                    double min_res_115119 = fmin64(zm_res_115118, redout_115116);
                    double redout_tmp_117462 = min_res_115119;
                    
                    redout_115116 = redout_tmp_117462;
                }
                defunc_0_reduce_res_115114 = redout_115116;
                ((double *) mem_112698.mem)[i_115112] = defunc_0_reduce_res_115114;
            }
            for (int64_t i_115121 = 0; i_115121 < m_33388; i_115121++) {
                double eta_p_115124 = ((double *) distrs_mem_111708.mem)[eta_p_70073 * m_33388 + i_115121];
                double eta_p_115125 = ((double *) mem_112650.mem)[i_115121];
                double defunc_0_reduce_res_115127;
                double redout_115130 = 0.0;
                
                for (int64_t i_115129 = 0; i_115129 < m_33388; i_115129++) {
                    double eta_p_115132 = ((double *) mem_112648)[i_115121 * m_33388 + i_115129];
                    double eta_p_wasfree_115133 = ((double *) mem_112698.mem)[i_115129];
                    double zp_res_115134 = eta_p_115132 + eta_p_wasfree_115133;
                    double exp_res_115135 = futrts_exp64(zp_res_115134);
                    double zp_res_115136 = exp_res_115135 + redout_115130;
                    
                    ((double *) mem_112709.mem)[i_115121 * m_33388 + i_115129] = exp_res_115135;
                    
                    double redout_tmp_117465 = zp_res_115136;
                    
                    redout_115130 = redout_tmp_117465;
                }
                defunc_0_reduce_res_115127 = redout_115130;
                
                double zs_res_115138 = defunc_0_reduce_res_115127 / eta_p_115124;
                double ztzt_res_115139 = fpow64(zs_res_115138, zs_res_44842);
                double zt_res_115140 = zs_res_44844 * eta_p_115125;
                double exp_res_115141 = futrts_exp64(zt_res_115140);
                double zt_res_115142 = ztzt_res_115139 * exp_res_115141;
                
                ((double *) mem_112706)[i_115121] = zt_res_115142;
            }
            
            bool defunc_0_reduce_res_103731;
            bool redout_115146 = 0;
            
            for (int64_t i_115145 = 0; i_115145 < m_33388; i_115145++) {
                double eta_p_115148 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_70084 * m_33388 + i_115145];
                double eta_p_115149 = ((double *) mem_112698.mem)[i_115145];
                double defunc_0_reduce_res_115150;
                double redout_115152 = 0.0;
                
                for (int64_t i_115151 = 0; i_115151 < m_33388; i_115151++) {
                    double eta_p_115153 = ((double *) mem_112706)[i_115151];
                    double eta_p_115154 = ((double *) mem_112709.mem)[i_115151 * m_33388 + i_115145];
                    double zt_res_115155 = eta_p_115153 * eta_p_115154;
                    double zp_res_115156 = zt_res_115155 + redout_115152;
                    double redout_tmp_117469 = zp_res_115156;
                    
                    redout_115152 = redout_tmp_117469;
                }
                defunc_0_reduce_res_115150 = redout_115152;
                
                double zs_res_115157 = defunc_0_reduce_res_115150 / eta_p_115148;
                double ztzt_res_115158 = fpow64(zs_res_115157, zs_res_44883);
                double zt_res_115159 = zs_res_44885 * eta_p_115149;
                double exp_res_115160 = futrts_exp64(zt_res_115159);
                double zt_res_115161 = ztzt_res_115158 * exp_res_115160;
                bool zgze_res_115162 = exp_absorb_cutoff_33394 <= zt_res_115161;
                bool defunc_0_op_res_115163 = zgze_res_115162 || redout_115146;
                
                ((double *) mem_112733.mem)[i_115145] = zt_res_115161;
                
                bool redout_tmp_117467 = defunc_0_op_res_115163;
                
                redout_115146 = redout_tmp_117467;
            }
            defunc_0_reduce_res_103731 = redout_115146;
            
            bool defunc_0_reduce_res_103734;
            bool redout_115166 = 0;
            
            for (int64_t i_115165 = 0; i_115165 < m_33388; i_115165++) {
                double eta_p_115168 = ((double *) distrs_mem_111708.mem)[eta_p_70073 * m_33388 + i_115165];
                double eta_p_115169 = ((double *) mem_112650.mem)[i_115165];
                double defunc_0_reduce_res_115170;
                double redout_115172 = 0.0;
                
                for (int64_t i_115171 = 0; i_115171 < m_33388; i_115171++) {
                    double eta_p_115173 = ((double *) mem_112733.mem)[i_115171];
                    double eta_p_115174 = ((double *) mem_112709.mem)[i_115165 * m_33388 + i_115171];
                    double zt_res_115175 = eta_p_115173 * eta_p_115174;
                    double zp_res_115176 = zt_res_115175 + redout_115172;
                    double redout_tmp_117472 = zp_res_115176;
                    
                    redout_115172 = redout_tmp_117472;
                }
                defunc_0_reduce_res_115170 = redout_115172;
                
                double zs_res_115177 = defunc_0_reduce_res_115170 / eta_p_115168;
                double ztzt_res_115178 = fpow64(zs_res_115177, zs_res_44842);
                double zt_res_115179 = zs_res_44844 * eta_p_115169;
                double exp_res_115180 = futrts_exp64(zt_res_115179);
                double zt_res_115181 = ztzt_res_115178 * exp_res_115180;
                bool zgze_res_115182 = exp_absorb_cutoff_33394 <= zt_res_115181;
                bool defunc_0_op_res_115183 = zgze_res_115182 || redout_115166;
                
                ((double *) mem_112741.mem)[i_115165] = zt_res_115181;
                
                bool redout_tmp_117470 = defunc_0_op_res_115183;
                
                redout_115166 = redout_tmp_117470;
            }
            defunc_0_reduce_res_103734 = redout_115166;
            
            bool x_114448 = !defunc_0_reduce_res_103734;
            bool defunc_0_reduce_res_102309;
            
            if (x_114448) {
                bool x_115185;
                bool redout_115187 = 0;
                
                for (int64_t i_115186 = 0; i_115186 < m_33388; i_115186++) {
                    double eta_p_115188 = ((double *) mem_112741.mem)[i_115186];
                    bool zlze_res_115189 = eta_p_115188 <= zs_res_107134;
                    bool defunc_0_op_res_115190 = zlze_res_115189 || redout_115187;
                    bool redout_tmp_117473 = defunc_0_op_res_115190;
                    
                    redout_115187 = redout_tmp_117473;
                }
                x_115185 = redout_115187;
                defunc_0_reduce_res_102309 = x_115185;
            } else {
                defunc_0_reduce_res_102309 = 0;
            }
            
            bool cond_70454 = defunc_0_reduce_res_102309 || defunc_0_reduce_res_103734;
            
            if (cond_70454) {
                for (int64_t i_115197 = 0; i_115197 < m_33388; i_115197++) {
                    double eta_p_115201 = ((double *) mem_112741.mem)[i_115197];
                    double eta_p_115202 = ((double *) mem_112650.mem)[i_115197];
                    bool zgze_res_115204 = exp_absorb_cutoff_33394 <= eta_p_115201;
                    bool zl_res_115205 = eta_p_115201 < zs_res_107134;
                    bool x_115206 = !zgze_res_115204;
                    bool y_115207 = zl_res_115205 && x_115206;
                    bool cond_115208 = zgze_res_115204 || y_115207;
                    int64_t binop_y_115209 = m_33388 * i_115197;
                    int64_t ext_115210;
                    
                    if (cond_115208) {
                        ext_115210 = (int64_t) 0;
                    } else {
                        ext_115210 = binop_y_115209;
                    }
                    
                    double rescale_res_115212;
                    double rescale_res_115213;
                    
                    if (cond_115208) {
                        double log_res_115215 = futrts_log64(eta_p_115201);
                        double sqrt_res_115216 = futrts_sqrt64(eta_p_115201);
                        double zs_res_115217 = log_res_115215 / 2.0;
                        double zp_res_115218 = eta_p_115202 + zs_res_115217;
                        
                        for (int64_t i_115221 = 0; i_115221 < m_33388; i_115221++) {
                            double eta_p_115223 = ((double *) mem_112709.mem)[i_115197 * m_33388 + i_115221];
                            double zt_res_115224 = sqrt_res_115216 * eta_p_115223;
                            
                            ((double *) mem_112766.mem)[i_115221] = zt_res_115224;
                        }
                        if (memblock_set(ctx, &ext_mem_115211, &mem_112766, "mem_112766") != 0)
                            return 1;
                        rescale_res_115212 = sqrt_res_115216;
                        rescale_res_115213 = zp_res_115218;
                    } else {
                        if (memblock_set(ctx, &ext_mem_115211, &mem_112709, "mem_112709") != 0)
                            return 1;
                        rescale_res_115212 = eta_p_115201;
                        rescale_res_115213 = eta_p_115202;
                    }
                    ((double *) mem_112749.mem)[i_115197] = rescale_res_115212;
                    ((double *) mem_112751.mem)[i_115197] = rescale_res_115213;
                    lmad_copy_8b(ctx, 1, (uint64_t *) mem_112754.mem, i_115197 * m_33388, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_115211.mem, ext_115210, (int64_t []) {(int64_t) 1}, (int64_t []) {m_33388});
                    if (memblock_unref(ctx, &ext_mem_115211, "ext_mem_115211") != 0)
                        return 1;
                }
                if (memblock_set(ctx, &ext_mem_112797, &mem_112749, "mem_112749") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_112794, &mem_112751, "mem_112751") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_112791, &mem_112754, "mem_112754") != 0)
                    return 1;
            } else {
                if (memblock_set(ctx, &ext_mem_112797, &mem_112741, "mem_112741") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_112794, &mem_112650, "mem_112650") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_112791, &mem_112709, "mem_112709") != 0)
                    return 1;
            }
            
            bool x_114436 = !defunc_0_reduce_res_103731;
            bool defunc_0_reduce_res_102348;
            
            if (x_114436) {
                bool x_115229;
                bool redout_115231 = 0;
                
                for (int64_t i_115230 = 0; i_115230 < m_33388; i_115230++) {
                    double eta_p_115232 = ((double *) mem_112733.mem)[i_115230];
                    bool zlze_res_115233 = eta_p_115232 <= zs_res_107134;
                    bool defunc_0_op_res_115234 = zlze_res_115233 || redout_115231;
                    bool redout_tmp_117478 = defunc_0_op_res_115234;
                    
                    redout_115231 = redout_tmp_117478;
                }
                x_115229 = redout_115231;
                defunc_0_reduce_res_102348 = x_115229;
            } else {
                defunc_0_reduce_res_102348 = 0;
            }
            
            bool cond_70497 = defunc_0_reduce_res_102348 || defunc_0_reduce_res_103731;
            int64_t ext_112839;
            
            if (cond_70497) {
                ext_112839 = (int64_t) 1;
            } else {
                ext_112839 = m_33388;
            }
            
            int64_t ext_112838;
            
            if (cond_70497) {
                ext_112838 = m_33388;
            } else {
                ext_112838 = (int64_t) 1;
            }
            if (cond_70497) {
                for (int64_t i_115241 = 0; i_115241 < m_33388; i_115241++) {
                    double eta_p_115245 = ((double *) mem_112733.mem)[i_115241];
                    double eta_p_115246 = ((double *) mem_112698.mem)[i_115241];
                    bool zgze_res_115248 = exp_absorb_cutoff_33394 <= eta_p_115245;
                    bool zl_res_115249 = eta_p_115245 < zs_res_107134;
                    bool x_115250 = !zgze_res_115248;
                    bool y_115251 = zl_res_115249 && x_115250;
                    bool cond_115252 = zgze_res_115248 || y_115251;
                    int64_t ext_115253;
                    
                    if (cond_115252) {
                        ext_115253 = (int64_t) 0;
                    } else {
                        ext_115253 = i_115241;
                    }
                    
                    int64_t ext_115254;
                    
                    if (cond_115252) {
                        ext_115254 = (int64_t) 1;
                    } else {
                        ext_115254 = m_33388;
                    }
                    
                    double rescale_res_115256;
                    double rescale_res_115257;
                    
                    if (cond_115252) {
                        double log_res_115259 = futrts_log64(eta_p_115245);
                        double sqrt_res_115260 = futrts_sqrt64(eta_p_115245);
                        double zs_res_115261 = log_res_115259 / 2.0;
                        double zp_res_115262 = eta_p_115246 + zs_res_115261;
                        
                        for (int64_t i_115265 = 0; i_115265 < m_33388; i_115265++) {
                            double eta_p_115267 = ((double *) ext_mem_112791.mem)[i_115265 * m_33388 + i_115241];
                            double zt_res_115268 = sqrt_res_115260 * eta_p_115267;
                            
                            ((double *) mem_112816.mem)[i_115265] = zt_res_115268;
                        }
                        if (memblock_set(ctx, &ext_mem_115255, &mem_112816, "mem_112816") != 0)
                            return 1;
                        rescale_res_115256 = sqrt_res_115260;
                        rescale_res_115257 = zp_res_115262;
                    } else {
                        if (memblock_set(ctx, &ext_mem_115255, &ext_mem_112791, "ext_mem_112791") != 0)
                            return 1;
                        rescale_res_115256 = eta_p_115245;
                        rescale_res_115257 = eta_p_115246;
                    }
                    ((double *) mem_112799.mem)[i_115241] = rescale_res_115256;
                    ((double *) mem_112801.mem)[i_115241] = rescale_res_115257;
                    lmad_copy_8b(ctx, 1, (uint64_t *) mem_112804.mem, i_115241 * m_33388, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_115255.mem, ext_115253, (int64_t []) {ext_115254}, (int64_t []) {m_33388});
                    if (memblock_unref(ctx, &ext_mem_115255, "ext_mem_115255") != 0)
                        return 1;
                }
                if (memblock_set(ctx, &ext_mem_112847, &mem_112799, "mem_112799") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_112844, &mem_112801, "mem_112801") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_112841, &mem_112804, "mem_112804") != 0)
                    return 1;
            } else {
                if (memblock_set(ctx, &ext_mem_112847, &mem_112733, "mem_112733") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_112844, &mem_112698, "mem_112698") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_112841, &ext_mem_112791, "ext_mem_112791") != 0)
                    return 1;
            }
            
            double defunc_0_reduce_res_103736;
            double redout_115275 = 0.0;
            
            for (int64_t i_115274 = 0; i_115274 < m_33388; i_115274++) {
                double eta_p_115276 = ((double *) mem_112706)[i_115274];
                double eta_p_115277 = ((double *) ext_mem_112797.mem)[i_115274];
                double zs_res_115278 = eta_p_115276 / eta_p_115277;
                double zm_res_115279 = zs_res_115278 - 1.0;
                double abs_res_115280 = fabs64(zm_res_115279);
                double max_res_115281 = fmax64(abs_res_115280, redout_115275);
                double redout_tmp_117483 = max_res_115281;
                
                redout_115275 = redout_tmp_117483;
            }
            defunc_0_reduce_res_103736 = redout_115275;
            
            bool zgze_res_70549 = tol_sinkhorn_33396 <= defunc_0_reduce_res_103736;
            int64_t ext_112990;
            int64_t ext_112989;
            int64_t ext_112988;
            bool algo3_core_loop_res_70550;
            int64_t ctx_param_ext_115287;
            int64_t ctx_param_ext_115288;
            int64_t ctx_param_ext_115289;
            bool loop_while_115290;
            
            if (memblock_set(ctx, &mem_param_115282, &ext_mem_112841, "ext_mem_112841") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_115283, &ext_mem_112797, "ext_mem_112797") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_115284, &ext_mem_112847, "ext_mem_112847") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_115285, &ext_mem_112794, "ext_mem_112794") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_115286, &ext_mem_112844, "ext_mem_112844") != 0)
                return 1;
            ctx_param_ext_115287 = (int64_t) 0;
            ctx_param_ext_115288 = ext_112839;
            ctx_param_ext_115289 = ext_112838;
            loop_while_115290 = zgze_res_70549;
            while (loop_while_115290) {
                if (memblock_alloc(ctx, &mem_115296, bytes_111715, "mem_115296")) {
                    err = 1;
                    goto cleanup;
                }
                
                bool defunc_0_reduce_res_115298;
                bool redout_115301 = 0;
                
                for (int64_t i_115300 = 0; i_115300 < m_33388; i_115300++) {
                    double eta_p_115303 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_70084 * m_33388 + i_115300];
                    double eta_p_115304 = ((double *) mem_param_115286.mem)[i_115300];
                    double defunc_0_reduce_res_115305;
                    double redout_115307 = 0.0;
                    
                    for (int64_t i_115306 = 0; i_115306 < m_33388; i_115306++) {
                        double eta_p_115308 = ((double *) mem_param_115283.mem)[i_115306];
                        double eta_p_115309 = ((double *) mem_param_115282.mem)[ctx_param_ext_115287 + (i_115306 * ctx_param_ext_115288 + i_115300 * ctx_param_ext_115289)];
                        double zt_res_115310 = eta_p_115308 * eta_p_115309;
                        double zp_res_115311 = zt_res_115310 + redout_115307;
                        double redout_tmp_117500 = zp_res_115311;
                        
                        redout_115307 = redout_tmp_117500;
                    }
                    defunc_0_reduce_res_115305 = redout_115307;
                    
                    double zs_res_115312 = defunc_0_reduce_res_115305 / eta_p_115303;
                    double ztzt_res_115313 = fpow64(zs_res_115312, zs_res_44883);
                    double zt_res_115314 = zs_res_44885 * eta_p_115304;
                    double exp_res_115315 = futrts_exp64(zt_res_115314);
                    double zt_res_115316 = ztzt_res_115313 * exp_res_115315;
                    bool zgze_res_115317 = exp_absorb_cutoff_33394 <= zt_res_115316;
                    bool defunc_0_op_res_115318 = zgze_res_115317 || redout_115301;
                    
                    ((double *) mem_115296.mem)[i_115300] = zt_res_115316;
                    
                    bool redout_tmp_117498 = defunc_0_op_res_115318;
                    
                    redout_115301 = redout_tmp_117498;
                }
                defunc_0_reduce_res_115298 = redout_115301;
                if (memblock_alloc(ctx, &mem_115320, bytes_111715, "mem_115320")) {
                    err = 1;
                    goto cleanup;
                }
                
                bool defunc_0_reduce_res_115322;
                bool redout_115325 = 0;
                
                for (int64_t i_115324 = 0; i_115324 < m_33388; i_115324++) {
                    double eta_p_115327 = ((double *) distrs_mem_111708.mem)[eta_p_70073 * m_33388 + i_115324];
                    double eta_p_115328 = ((double *) mem_param_115285.mem)[i_115324];
                    double defunc_0_reduce_res_115329;
                    double redout_115331 = 0.0;
                    
                    for (int64_t i_115330 = 0; i_115330 < m_33388; i_115330++) {
                        double eta_p_115332 = ((double *) mem_115296.mem)[i_115330];
                        double eta_p_115333 = ((double *) mem_param_115282.mem)[ctx_param_ext_115287 + (i_115324 * ctx_param_ext_115288 + i_115330 * ctx_param_ext_115289)];
                        double zt_res_115334 = eta_p_115332 * eta_p_115333;
                        double zp_res_115335 = zt_res_115334 + redout_115331;
                        double redout_tmp_117503 = zp_res_115335;
                        
                        redout_115331 = redout_tmp_117503;
                    }
                    defunc_0_reduce_res_115329 = redout_115331;
                    
                    double zs_res_115336 = defunc_0_reduce_res_115329 / eta_p_115327;
                    double ztzt_res_115337 = fpow64(zs_res_115336, zs_res_44842);
                    double zt_res_115338 = zs_res_44844 * eta_p_115328;
                    double exp_res_115339 = futrts_exp64(zt_res_115338);
                    double zt_res_115340 = ztzt_res_115337 * exp_res_115339;
                    bool zgze_res_115341 = exp_absorb_cutoff_33394 <= zt_res_115340;
                    bool defunc_0_op_res_115342 = zgze_res_115341 || redout_115325;
                    
                    ((double *) mem_115320.mem)[i_115324] = zt_res_115340;
                    
                    bool redout_tmp_117501 = defunc_0_op_res_115342;
                    
                    redout_115325 = redout_tmp_117501;
                }
                defunc_0_reduce_res_115322 = redout_115325;
                
                bool x_115344 = !defunc_0_reduce_res_115322;
                bool defunc_0_reduce_res_115345;
                
                if (x_115344) {
                    bool x_115346;
                    bool redout_115348 = 0;
                    
                    for (int64_t i_115347 = 0; i_115347 < m_33388; i_115347++) {
                        double eta_p_115349 = ((double *) mem_115320.mem)[i_115347];
                        bool zlze_res_115350 = eta_p_115349 <= zs_res_107134;
                        bool defunc_0_op_res_115351 = zlze_res_115350 || redout_115348;
                        bool redout_tmp_117504 = defunc_0_op_res_115351;
                        
                        redout_115348 = redout_tmp_117504;
                    }
                    x_115346 = redout_115348;
                    defunc_0_reduce_res_115345 = x_115346;
                } else {
                    defunc_0_reduce_res_115345 = 0;
                }
                
                bool cond_115352 = defunc_0_reduce_res_115345 || defunc_0_reduce_res_115322;
                int64_t ext_115353;
                
                if (cond_115352) {
                    ext_115353 = (int64_t) 0;
                } else {
                    ext_115353 = ctx_param_ext_115287;
                }
                
                int64_t ext_115354;
                
                if (cond_115352) {
                    ext_115354 = m_33388;
                } else {
                    ext_115354 = ctx_param_ext_115288;
                }
                
                int64_t ext_115355;
                
                if (cond_115352) {
                    ext_115355 = (int64_t) 1;
                } else {
                    ext_115355 = ctx_param_ext_115289;
                }
                if (memblock_alloc(ctx, &mem_115356, bytes_111715, "mem_115356")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_115357, bytes_111715, "mem_115357")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_115358, bytes_111743, "mem_115358")) {
                    err = 1;
                    goto cleanup;
                }
                if (cond_115352) {
                    double zs_res_115365 = 1.0 / exp_absorb_cutoff_33394;
                    
                    for (int64_t i_115372 = 0; i_115372 < m_33388; i_115372++) {
                        double eta_p_115376 = ((double *) mem_115320.mem)[i_115372];
                        double eta_p_115377 = ((double *) mem_param_115285.mem)[i_115372];
                        bool zgze_res_115379 = exp_absorb_cutoff_33394 <= eta_p_115376;
                        bool zl_res_115380 = eta_p_115376 < zs_res_115365;
                        bool x_115381 = !zgze_res_115379;
                        bool y_115382 = zl_res_115380 && x_115381;
                        bool cond_115383 = zgze_res_115379 || y_115382;
                        int64_t binop_y_115384 = i_115372 * ctx_param_ext_115288;
                        int64_t lmad_ext_115385 = ctx_param_ext_115287 + binop_y_115384;
                        int64_t ext_115386;
                        
                        if (cond_115383) {
                            ext_115386 = (int64_t) 0;
                        } else {
                            ext_115386 = lmad_ext_115385;
                        }
                        
                        int64_t ext_115387;
                        
                        if (cond_115383) {
                            ext_115387 = (int64_t) 1;
                        } else {
                            ext_115387 = ctx_param_ext_115289;
                        }
                        
                        double rescale_res_115389;
                        double rescale_res_115390;
                        
                        if (cond_115383) {
                            double log_res_115392 = futrts_log64(eta_p_115376);
                            double sqrt_res_115393 = futrts_sqrt64(eta_p_115376);
                            double zs_res_115394 = log_res_115392 / 2.0;
                            double zp_res_115395 = eta_p_115377 + zs_res_115394;
                            
                            for (int64_t i_115398 = 0; i_115398 < m_33388; i_115398++) {
                                double eta_p_115400 = ((double *) mem_param_115282.mem)[ctx_param_ext_115287 + (i_115372 * ctx_param_ext_115288 + i_115398 * ctx_param_ext_115289)];
                                double zt_res_115401 = sqrt_res_115393 * eta_p_115400;
                                
                                ((double *) mem_112898.mem)[i_115398] = zt_res_115401;
                            }
                            if (memblock_set(ctx, &ext_mem_115388, &mem_112898, "mem_112898") != 0)
                                return 1;
                            rescale_res_115389 = sqrt_res_115393;
                            rescale_res_115390 = zp_res_115395;
                        } else {
                            if (memblock_set(ctx, &ext_mem_115388, &mem_param_115282, "mem_param_115282") != 0)
                                return 1;
                            rescale_res_115389 = eta_p_115376;
                            rescale_res_115390 = eta_p_115377;
                        }
                        ((double *) mem_115356.mem)[i_115372] = rescale_res_115389;
                        ((double *) mem_115357.mem)[i_115372] = rescale_res_115390;
                        lmad_copy_8b(ctx, 1, (uint64_t *) mem_115358.mem, i_115372 * m_33388, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_115388.mem, ext_115386, (int64_t []) {ext_115387}, (int64_t []) {m_33388});
                        if (memblock_unref(ctx, &ext_mem_115388, "ext_mem_115388") != 0)
                            return 1;
                    }
                    if (memblock_set(ctx, &ext_mem_115359, &mem_115356, "mem_115356") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_115360, &mem_115357, "mem_115357") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_115361, &mem_115358, "mem_115358") != 0)
                        return 1;
                } else {
                    if (memblock_set(ctx, &ext_mem_115359, &mem_115320, "mem_115320") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_115360, &mem_param_115285, "mem_param_115285") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_115361, &mem_param_115282, "mem_param_115282") != 0)
                        return 1;
                }
                if (memblock_unref(ctx, &mem_115320, "mem_115320") != 0)
                    return 1;
                if (memblock_unref(ctx, &mem_115356, "mem_115356") != 0)
                    return 1;
                if (memblock_unref(ctx, &mem_115357, "mem_115357") != 0)
                    return 1;
                if (memblock_unref(ctx, &mem_115358, "mem_115358") != 0)
                    return 1;
                
                bool x_115406 = !defunc_0_reduce_res_115298;
                bool defunc_0_reduce_res_115407;
                
                if (x_115406) {
                    bool x_115408;
                    bool redout_115410 = 0;
                    
                    for (int64_t i_115409 = 0; i_115409 < m_33388; i_115409++) {
                        double eta_p_115411 = ((double *) mem_115296.mem)[i_115409];
                        bool zlze_res_115412 = eta_p_115411 <= zs_res_107134;
                        bool defunc_0_op_res_115413 = zlze_res_115412 || redout_115410;
                        bool redout_tmp_117509 = defunc_0_op_res_115413;
                        
                        redout_115410 = redout_tmp_117509;
                    }
                    x_115408 = redout_115410;
                    defunc_0_reduce_res_115407 = x_115408;
                } else {
                    defunc_0_reduce_res_115407 = 0;
                }
                
                bool cond_115414 = defunc_0_reduce_res_115407 || defunc_0_reduce_res_115298;
                int64_t ext_115416;
                
                if (cond_115414) {
                    ext_115416 = (int64_t) 0;
                } else {
                    ext_115416 = ext_115353;
                }
                
                int64_t ext_115417;
                
                if (cond_115414) {
                    ext_115417 = (int64_t) 1;
                } else {
                    ext_115417 = ext_115354;
                }
                
                int64_t ext_115418;
                
                if (cond_115414) {
                    ext_115418 = m_33388;
                } else {
                    ext_115418 = ext_115355;
                }
                if (memblock_alloc(ctx, &mem_115419, bytes_111715, "mem_115419")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_115420, bytes_111715, "mem_115420")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_115421, bytes_111743, "mem_115421")) {
                    err = 1;
                    goto cleanup;
                }
                if (cond_115414) {
                    double zs_res_115428 = 1.0 / exp_absorb_cutoff_33394;
                    
                    for (int64_t i_115435 = 0; i_115435 < m_33388; i_115435++) {
                        double eta_p_115439 = ((double *) mem_115296.mem)[i_115435];
                        double eta_p_115440 = ((double *) mem_param_115286.mem)[i_115435];
                        bool zgze_res_115442 = exp_absorb_cutoff_33394 <= eta_p_115439;
                        bool zl_res_115443 = eta_p_115439 < zs_res_115428;
                        bool x_115444 = !zgze_res_115442;
                        bool y_115445 = zl_res_115443 && x_115444;
                        bool cond_115446 = zgze_res_115442 || y_115445;
                        int64_t binop_y_115447 = i_115435 * ext_115355;
                        int64_t lmad_ext_115448 = ext_115353 + binop_y_115447;
                        int64_t ext_115449;
                        
                        if (cond_115446) {
                            ext_115449 = (int64_t) 0;
                        } else {
                            ext_115449 = lmad_ext_115448;
                        }
                        
                        int64_t ext_115450;
                        
                        if (cond_115446) {
                            ext_115450 = (int64_t) 1;
                        } else {
                            ext_115450 = ext_115354;
                        }
                        
                        double rescale_res_115452;
                        double rescale_res_115453;
                        
                        if (cond_115446) {
                            double log_res_115455 = futrts_log64(eta_p_115439);
                            double sqrt_res_115456 = futrts_sqrt64(eta_p_115439);
                            double zs_res_115457 = log_res_115455 / 2.0;
                            double zp_res_115458 = eta_p_115440 + zs_res_115457;
                            
                            for (int64_t i_115461 = 0; i_115461 < m_33388; i_115461++) {
                                double eta_p_115463 = ((double *) ext_mem_115361.mem)[ext_115353 + (i_115461 * ext_115354 + i_115435 * ext_115355)];
                                double zt_res_115464 = sqrt_res_115456 * eta_p_115463;
                                
                                ((double *) mem_112948.mem)[i_115461] = zt_res_115464;
                            }
                            if (memblock_set(ctx, &ext_mem_115451, &mem_112948, "mem_112948") != 0)
                                return 1;
                            rescale_res_115452 = sqrt_res_115456;
                            rescale_res_115453 = zp_res_115458;
                        } else {
                            if (memblock_set(ctx, &ext_mem_115451, &ext_mem_115361, "ext_mem_115361") != 0)
                                return 1;
                            rescale_res_115452 = eta_p_115439;
                            rescale_res_115453 = eta_p_115440;
                        }
                        ((double *) mem_115419.mem)[i_115435] = rescale_res_115452;
                        ((double *) mem_115420.mem)[i_115435] = rescale_res_115453;
                        lmad_copy_8b(ctx, 1, (uint64_t *) mem_115421.mem, i_115435 * m_33388, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_115451.mem, ext_115449, (int64_t []) {ext_115450}, (int64_t []) {m_33388});
                        if (memblock_unref(ctx, &ext_mem_115451, "ext_mem_115451") != 0)
                            return 1;
                    }
                    if (memblock_set(ctx, &ext_mem_115422, &mem_115419, "mem_115419") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_115423, &mem_115420, "mem_115420") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_115424, &mem_115421, "mem_115421") != 0)
                        return 1;
                } else {
                    if (memblock_set(ctx, &ext_mem_115422, &mem_115296, "mem_115296") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_115423, &mem_param_115286, "mem_param_115286") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_115424, &ext_mem_115361, "ext_mem_115361") != 0)
                        return 1;
                }
                if (memblock_unref(ctx, &mem_115296, "mem_115296") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_115361, "ext_mem_115361") != 0)
                    return 1;
                if (memblock_unref(ctx, &mem_115419, "mem_115419") != 0)
                    return 1;
                if (memblock_unref(ctx, &mem_115420, "mem_115420") != 0)
                    return 1;
                if (memblock_unref(ctx, &mem_115421, "mem_115421") != 0)
                    return 1;
                
                double defunc_0_reduce_res_115470;
                double redout_115472 = 0.0;
                
                for (int64_t i_115471 = 0; i_115471 < m_33388; i_115471++) {
                    double eta_p_115473 = ((double *) mem_param_115283.mem)[i_115471];
                    double eta_p_115474 = ((double *) ext_mem_115359.mem)[i_115471];
                    double zs_res_115475 = eta_p_115473 / eta_p_115474;
                    double zm_res_115476 = zs_res_115475 - 1.0;
                    double abs_res_115477 = fabs64(zm_res_115476);
                    double max_res_115478 = fmax64(abs_res_115477, redout_115472);
                    double redout_tmp_117514 = max_res_115478;
                    
                    redout_115472 = redout_tmp_117514;
                }
                defunc_0_reduce_res_115470 = redout_115472;
                
                bool zgze_res_115479 = tol_sinkhorn_33396 <= defunc_0_reduce_res_115470;
                
                if (memblock_set(ctx, &mem_param_tmp_117484, &ext_mem_115424, "ext_mem_115424") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_117485, &ext_mem_115359, "ext_mem_115359") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_117486, &ext_mem_115422, "ext_mem_115422") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_117487, &ext_mem_115360, "ext_mem_115360") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_117488, &ext_mem_115423, "ext_mem_115423") != 0)
                    return 1;
                
                int64_t ctx_param_ext_tmp_117489 = ext_115416;
                int64_t ctx_param_ext_tmp_117490 = ext_115417;
                int64_t ctx_param_ext_tmp_117491 = ext_115418;
                bool loop_while_tmp_117492 = zgze_res_115479;
                
                if (memblock_set(ctx, &mem_param_115282, &mem_param_tmp_117484, "mem_param_tmp_117484") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_115283, &mem_param_tmp_117485, "mem_param_tmp_117485") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_115284, &mem_param_tmp_117486, "mem_param_tmp_117486") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_115285, &mem_param_tmp_117487, "mem_param_tmp_117487") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_115286, &mem_param_tmp_117488, "mem_param_tmp_117488") != 0)
                    return 1;
                ctx_param_ext_115287 = ctx_param_ext_tmp_117489;
                ctx_param_ext_115288 = ctx_param_ext_tmp_117490;
                ctx_param_ext_115289 = ctx_param_ext_tmp_117491;
                loop_while_115290 = loop_while_tmp_117492;
            }
            if (memblock_set(ctx, &ext_mem_112995, &mem_param_115282, "mem_param_115282") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_112994, &mem_param_115283, "mem_param_115283") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_112993, &mem_param_115284, "mem_param_115284") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_112992, &mem_param_115285, "mem_param_115285") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_112991, &mem_param_115286, "mem_param_115286") != 0)
                return 1;
            ext_112990 = ctx_param_ext_115287;
            ext_112989 = ctx_param_ext_115288;
            ext_112988 = ctx_param_ext_115289;
            algo3_core_loop_res_70550 = loop_while_115290;
            
            double defunc_res_103737;
            double redout_115481 = 0.0;
            
            for (int64_t i_115480 = 0; i_115480 < m_33388; i_115480++) {
                double eta_p_115483 = ((double *) ext_mem_112994.mem)[i_115480];
                double defunc_res_115485;
                double redout_115488 = 0.0;
                
                for (int64_t i_115487 = 0; i_115487 < m_33388; i_115487++) {
                    double eta_p_115490 = ((double *) ext_mem_112995.mem)[ext_112990 + (i_115480 * ext_112989 + i_115487 * ext_112988)];
                    double eta_p_wasfree_115491 = ((double *) ext_mem_112993.mem)[i_115487];
                    double zt_res_115492 = eta_p_115483 * eta_p_115490;
                    double zt_res_115493 = eta_p_wasfree_115491 * zt_res_115492;
                    double zp_res_115494 = zt_res_115493 + redout_115488;
                    
                    ((double *) mem_112998)[i_115480 * m_33388 + i_115487] = zt_res_115493;
                    
                    double redout_tmp_117517 = zp_res_115494;
                    
                    redout_115488 = redout_tmp_117517;
                }
                defunc_res_115485 = redout_115488;
                
                double zp_res_115496 = defunc_res_115485 + redout_115481;
                double redout_tmp_117515 = zp_res_115496;
                
                redout_115481 = redout_tmp_117515;
            }
            defunc_res_103737 = redout_115481;
            
            double zs_res_70749 = defunc_res_103703 / defunc_res_103737;
            double sqrt_res_70750 = futrts_sqrt64(zs_res_70749);
            bool defunc_0_reduce_comm_res_103739;
            bool redout_115499 = 0;
            
            for (int64_t i_115498 = 0; i_115498 < m_33388; i_115498++) {
                bool defunc_0_reduce_comm_res_115502;
                bool redout_115505 = 0;
                
                for (int64_t i_115504 = 0; i_115504 < m_33388; i_115504++) {
                    double eta_p_115507 = ((double *) mem_112998)[i_115498 * m_33388 + i_115504];
                    double eta_p_115508 = ((double *) mem_112585)[i_115498 * m_33388 + i_115504];
                    double zt_res_115509 = sqrt_res_70750 * eta_p_115507;
                    double zt_res_115510 = zp_res_43884 * eta_p_115508;
                    bool zgze_res_115511 = zt_res_115509 <= zt_res_115510;
                    double zt_res_115512 = zp_res_43884 * zt_res_115509;
                    bool zgze_res_115513 = eta_p_115508 <= zt_res_115512;
                    bool x_115514 = zgze_res_115511 && zgze_res_115513;
                    bool not_res_115515 = !x_115514;
                    bool defunc_0_op_res_115516 = not_res_115515 || redout_115505;
                    
                    ((double *) mem_113017.mem)[i_115498 * m_33388 + i_115504] = zt_res_115509;
                    
                    bool redout_tmp_117521 = defunc_0_op_res_115516;
                    
                    redout_115505 = redout_tmp_117521;
                }
                defunc_0_reduce_comm_res_115502 = redout_115505;
                
                bool defunc_0_op_res_115518 = defunc_0_reduce_comm_res_115502 || redout_115499;
                bool redout_tmp_117519 = defunc_0_op_res_115518;
                
                redout_115499 = redout_tmp_117519;
            }
            defunc_0_reduce_comm_res_103739 = redout_115499;
            
            double zt_res_70861 = -2.0 * defunc_res_103722;
            double zp_res_70862 = zt_res_70861 + defunc_0_reduce_res_103721;
            double zp_res_70863 = zp_res_70862 + defunc_0_reduce_res_103719;
            double zt_res_70905 = eps_33391 * defunc_res_103706;
            double zt_res_70919 = rho1_33389 * defunc_res_103704;
            double zt_res_70933 = rho2_33390 * defunc_res_103713;
            double zp_res_70934 = zt_res_70905 + zt_res_70919;
            double zp_res_70935 = zt_res_70933 + zp_res_70934;
            double zt_res_70936 = 2.0 * zp_res_70935;
            double zt_res_70937 = zt_res_70936 * defunc_res_103705;
            double zp_res_70938 = zp_res_70863 + zt_res_70937;
            double zt_res_70939 = defunc_res_103705 * defunc_res_103705;
            double zt_res_70940 = zp_res_46827 * zt_res_70939;
            double zm_res_70941 = zp_res_70938 - zt_res_70940;
            double zt_res_70952 = defunc_res_103707 * defunc_res_103714;
            double zt_res_70953 = rho1_33389 * defunc_res_103707;
            double zt_res_70954 = zt_res_70953 * defunc_res_103707;
            double zt_res_70955 = rho2_33390 * defunc_res_103714;
            double zt_res_70956 = zt_res_70955 * defunc_res_103714;
            double zp_res_70957 = zt_res_70954 + zt_res_70956;
            double zt_res_70958 = eps_33391 * zt_res_70952;
            double zt_res_70959 = zt_res_70952 * zt_res_70958;
            double zp_res_70960 = zp_res_70957 + zt_res_70959;
            double zp_res_70961 = zm_res_70941 + zp_res_70960;
            bool defunc_0_reduce_res_102485;
            
            if (defunc_0_reduce_comm_res_103739) {
                bool x_115520;
                bool redout_115522 = 0;
                
                for (int64_t i_115521 = 0; i_115521 < m_33388; i_115521++) {
                    bool defunc_0_reduce_res_115523;
                    bool redout_115525 = 0;
                    
                    for (int64_t i_115524 = 0; i_115524 < m_33388; i_115524++) {
                        double eta_p_115526 = ((double *) mem_113017.mem)[i_115521 * m_33388 + i_115524];
                        bool zg_res_115527 = 0.0 < eta_p_115526;
                        bool defunc_0_op_res_115528 = zg_res_115527 || redout_115525;
                        bool redout_tmp_117524 = defunc_0_op_res_115528;
                        
                        redout_115525 = redout_tmp_117524;
                    }
                    defunc_0_reduce_res_115523 = redout_115525;
                    
                    bool defunc_0_op_res_115529 = defunc_0_reduce_res_115523 || redout_115522;
                    bool redout_tmp_117523 = defunc_0_op_res_115529;
                    
                    redout_115522 = redout_tmp_117523;
                }
                x_115520 = redout_115522;
                defunc_0_reduce_res_102485 = x_115520;
            } else {
                defunc_0_reduce_res_102485 = 0;
            }
            
            bool x_114494 = defunc_0_reduce_res_102485 && defunc_0_reduce_comm_res_103739;
            bool final_plan_71000;
            double final_plan_71004;
            bool loop_while_115533;
            double loss_115537;
            
            if (memblock_set(ctx, &mem_param_115530, &ext_mem_112992, "ext_mem_112992") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_115531, &ext_mem_112991, "ext_mem_112991") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_115532, &mem_113017, "mem_113017") != 0)
                return 1;
            loop_while_115533 = x_114494;
            loss_115537 = zp_res_70961;
            while (loop_while_115533) {
                double defunc_res_115539;
                double defunc_res_115540;
                double defunc_res_115541;
                double defunc_res_115542;
                double redout_115545;
                double redout_115546;
                double redout_115547;
                double redout_115548;
                
                redout_115545 = 0.0;
                redout_115546 = 0.0;
                redout_115547 = 0.0;
                redout_115548 = 0.0;
                for (int64_t i_115544 = 0; i_115544 < m_33388; i_115544++) {
                    double eta_p_115550 = ((double *) distrs_mem_111708.mem)[eta_p_70073 * m_33388 + i_115544];
                    double defunc_res_115551;
                    double defunc_res_115552;
                    double defunc_res_115553;
                    double defunc_res_115554;
                    double defunc_res_115555;
                    double redout_115557;
                    double redout_115558;
                    double redout_115559;
                    double redout_115560;
                    double redout_115561;
                    
                    redout_115557 = 0.0;
                    redout_115558 = 0.0;
                    redout_115559 = 0.0;
                    redout_115560 = 0.0;
                    redout_115561 = 0.0;
                    for (int64_t i_115556 = 0; i_115556 < m_33388; i_115556++) {
                        double x_115562 = ((double *) mem_param_115532.mem)[i_115544 * m_33388 + i_115556];
                        double eta_p_115563 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_70084 * m_33388 + i_115556];
                        double zt_res_115564 = eta_p_115550 * eta_p_115563;
                        bool zeze_res_115565 = x_115562 == 0.0;
                        double klu_res_115566;
                        
                        if (zeze_res_115565) {
                            klu_res_115566 = 0.0;
                        } else {
                            double zs_res_115567 = x_115562 / zt_res_115564;
                            double log_res_115568 = futrts_log64(zs_res_115567);
                            double zt_res_115569 = x_115562 * log_res_115568;
                            
                            klu_res_115566 = zt_res_115569;
                        }
                        
                        double zp_res_115570 = x_115562 + redout_115557;
                        double zp_res_115571 = x_115562 + redout_115558;
                        double zp_res_115572 = x_115562 + redout_115559;
                        double zp_res_115573 = klu_res_115566 + redout_115560;
                        double zp_res_115574 = x_115562 + redout_115561;
                        double redout_tmp_117538 = zp_res_115570;
                        double redout_tmp_117539 = zp_res_115571;
                        double redout_tmp_117540 = zp_res_115572;
                        double redout_tmp_117541 = zp_res_115573;
                        double redout_tmp_117542 = zp_res_115574;
                        
                        redout_115557 = redout_tmp_117538;
                        redout_115558 = redout_tmp_117539;
                        redout_115559 = redout_tmp_117540;
                        redout_115560 = redout_tmp_117541;
                        redout_115561 = redout_tmp_117542;
                    }
                    defunc_res_115551 = redout_115557;
                    defunc_res_115552 = redout_115558;
                    defunc_res_115553 = redout_115559;
                    defunc_res_115554 = redout_115560;
                    defunc_res_115555 = redout_115561;
                    
                    bool zeze_res_115575 = defunc_res_115553 == 0.0;
                    double klu_res_115576;
                    
                    if (zeze_res_115575) {
                        klu_res_115576 = 0.0;
                    } else {
                        double zs_res_115577 = defunc_res_115553 / eta_p_115550;
                        double log_res_115578 = futrts_log64(zs_res_115577);
                        double zt_res_115579 = log_res_115578 * defunc_res_115553;
                        
                        klu_res_115576 = zt_res_115579;
                    }
                    
                    double zp_res_115580 = defunc_res_115551 + redout_115545;
                    double zp_res_115581 = klu_res_115576 + redout_115546;
                    double zp_res_115582 = defunc_res_115554 + redout_115547;
                    double zp_res_115583 = defunc_res_115555 + redout_115548;
                    
                    ((double *) mem_113045)[i_115544] = defunc_res_115552;
                    
                    double redout_tmp_117533 = zp_res_115580;
                    double redout_tmp_117534 = zp_res_115581;
                    double redout_tmp_117535 = zp_res_115582;
                    double redout_tmp_117536 = zp_res_115583;
                    
                    redout_115545 = redout_tmp_117533;
                    redout_115546 = redout_tmp_117534;
                    redout_115547 = redout_tmp_117535;
                    redout_115548 = redout_tmp_117536;
                }
                defunc_res_115539 = redout_115545;
                defunc_res_115540 = redout_115546;
                defunc_res_115541 = redout_115547;
                defunc_res_115542 = redout_115548;
                
                double zt_res_115585 = eps_33391 * defunc_res_115539;
                double defunc_res_115588;
                double redout_115592 = 0.0;
                
                for (int64_t i_115591 = 0; i_115591 < m_33388; i_115591++) {
                    double eta_p_115595 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_70084 * m_33388 + i_115591];
                    double log_res_115596 = futrts_log64(eta_p_115595);
                    double zt_res_115597 = zt_res_115585 * log_res_115596;
                    double defunc_res_115598;
                    double defunc_res_115599;
                    double redout_115601;
                    double redout_115602;
                    
                    redout_115601 = 0.0;
                    redout_115602 = 0.0;
                    for (int64_t i_115600 = 0; i_115600 < m_33388; i_115600++) {
                        double x_115603 = ((double *) mem_param_115532.mem)[i_115600 * m_33388 + i_115591];
                        double zp_res_115604 = x_115603 + redout_115601;
                        double zp_res_115605 = x_115603 + redout_115602;
                        double redout_tmp_117546 = zp_res_115604;
                        double redout_tmp_117547 = zp_res_115605;
                        
                        redout_115601 = redout_tmp_117546;
                        redout_115602 = redout_tmp_117547;
                    }
                    defunc_res_115598 = redout_115601;
                    defunc_res_115599 = redout_115602;
                    
                    bool zeze_res_115606 = defunc_res_115598 == 0.0;
                    double klu_res_115607;
                    
                    if (zeze_res_115606) {
                        klu_res_115607 = 0.0;
                    } else {
                        double zs_res_115608 = defunc_res_115598 / eta_p_115595;
                        double log_res_115609 = futrts_log64(zs_res_115608);
                        double zt_res_115610 = log_res_115609 * defunc_res_115598;
                        
                        klu_res_115607 = zt_res_115610;
                    }
                    
                    double zp_res_115611 = klu_res_115607 + redout_115592;
                    
                    ((double *) mem_113053)[i_115591] = defunc_res_115599;
                    ((double *) mem_113055)[i_115591] = zt_res_115597;
                    
                    double redout_tmp_117543 = zp_res_115611;
                    
                    redout_115592 = redout_tmp_117543;
                }
                defunc_res_115588 = redout_115592;
                
                double zt_res_115614 = rho2_33390 * defunc_res_115588;
                double zt_res_115615 = rho1_33389 * defunc_res_115540;
                double zp_res_115616 = zt_res_115615 + zt_res_115614;
                double zt_res_115617 = eps_33391 * defunc_res_115541;
                double zp_res_115618 = zt_res_115617 + zp_res_115616;
                
                for (int64_t i_115621 = 0; i_115621 < m_33388; i_115621++) {
                    double defunc_0_reduce_res_115623;
                    double redout_115625 = 0.0;
                    
                    for (int64_t i_115624 = 0; i_115624 < m_33388; i_115624++) {
                        double eta_p_115626 = ((double *) A_mem_111707.mem)[lifted_lambda_res_70084 * (m_33388 * m_33388) + i_115621 * m_33388 + i_115624];
                        double eta_p_115627 = ((double *) mem_113053)[i_115624];
                        double zt_res_115628 = eta_p_115626 * eta_p_115626;
                        double zt_res_115629 = eta_p_115627 * zt_res_115628;
                        double zp_res_115630 = zt_res_115629 + redout_115625;
                        double redout_tmp_117549 = zp_res_115630;
                        
                        redout_115625 = redout_tmp_117549;
                    }
                    defunc_0_reduce_res_115623 = redout_115625;
                    ((double *) mem_113069)[i_115621] = defunc_0_reduce_res_115623;
                }
                for (int64_t i_115636 = 0; i_115636 < m_33388; i_115636++) {
                    double eta_p_115639 = ((double *) distrs_mem_111708.mem)[eta_p_70073 * m_33388 + i_115636];
                    double eta_p_115640 = ((double *) mem_param_115530.mem)[i_115636];
                    double log_res_115641 = futrts_log64(eta_p_115639);
                    double zt_res_115642 = zt_res_115585 * log_res_115641;
                    double defunc_0_reduce_res_115643;
                    double redout_115645 = 0.0;
                    
                    for (int64_t i_115644 = 0; i_115644 < m_33388; i_115644++) {
                        double eta_p_115646 = ((double *) A_mem_111707.mem)[eta_p_70073 * (m_33388 * m_33388) + i_115636 * m_33388 + i_115644];
                        double eta_p_115647 = ((double *) mem_113045)[i_115644];
                        double zt_res_115648 = eta_p_115646 * eta_p_115646;
                        double zt_res_115649 = eta_p_115647 * zt_res_115648;
                        double zp_res_115650 = zt_res_115649 + redout_115645;
                        double redout_tmp_117552 = zp_res_115650;
                        
                        redout_115645 = redout_tmp_117552;
                    }
                    defunc_0_reduce_res_115643 = redout_115645;
                    for (int64_t i_115653 = 0; i_115653 < m_33388; i_115653++) {
                        double defunc_0_reduce_res_115655;
                        double redout_115657 = 0.0;
                        
                        for (int64_t i_115656 = 0; i_115656 < m_33388; i_115656++) {
                            double eta_p_115658 = ((double *) A_mem_111707.mem)[eta_p_70073 * (m_33388 * m_33388) + i_115636 * m_33388 + i_115656];
                            double eta_p_115659 = ((double *) mem_param_115532.mem)[i_115656 * m_33388 + i_115653];
                            double zt_res_115660 = eta_p_115658 * eta_p_115659;
                            double zp_res_115661 = zt_res_115660 + redout_115657;
                            double redout_tmp_117554 = zp_res_115661;
                            
                            redout_115657 = redout_tmp_117554;
                        }
                        defunc_0_reduce_res_115655 = redout_115657;
                        ((double *) mem_113089)[i_115653] = defunc_0_reduce_res_115655;
                    }
                    
                    double defunc_0_reduce_res_115664;
                    double redout_115667 = INFINITY;
                    
                    for (int64_t i_115666 = 0; i_115666 < m_33388; i_115666++) {
                        double eta_p_wasfree_115669 = ((double *) mem_113069)[i_115666];
                        double eta_p_wasfree_115670 = ((double *) mem_113055)[i_115666];
                        double eta_p_wasfree_115671 = ((double *) mem_param_115531.mem)[i_115666];
                        double defunc_0_reduce_res_115672;
                        double redout_115674 = 0.0;
                        
                        for (int64_t i_115673 = 0; i_115673 < m_33388; i_115673++) {
                            double eta_p_115675 = ((double *) mem_113089)[i_115673];
                            double eta_p_115676 = ((double *) mem_111727.mem)[lifted_lambda_res_70084 * (m_33388 * m_33388) + i_115673 * m_33388 + i_115666];
                            double zt_res_115677 = eta_p_115675 * eta_p_115676;
                            double zp_res_115678 = zt_res_115677 + redout_115674;
                            double redout_tmp_117557 = zp_res_115678;
                            
                            redout_115674 = redout_tmp_117557;
                        }
                        defunc_0_reduce_res_115672 = redout_115674;
                        
                        double zt_res_115679 = -2.0 * defunc_0_reduce_res_115672;
                        double zp_res_115680 = zt_res_115679 + defunc_0_reduce_res_115643;
                        double zp_res_115681 = eta_p_wasfree_115669 + zp_res_115680;
                        double zp_res_115682 = zp_res_115618 + zp_res_115681;
                        double zm_res_115683 = zp_res_115682 - zt_res_115642;
                        double zm_res_115684 = zm_res_115683 - eta_p_wasfree_115670;
                        double zs_res_115685 = zm_res_115684 / defunc_res_115542;
                        double zs_res_115686 = zs_res_115685 / neg_res_43882;
                        double zp_res_115687 = eta_p_115640 + zs_res_115686;
                        double zp_res_115688 = eta_p_wasfree_115671 + zp_res_115687;
                        double zm_res_115689 = 30.0 - zp_res_115688;
                        double min_res_115690 = fmin64(zm_res_115689, redout_115667);
                        
                        ((double *) mem_113097)[i_115666] = zp_res_115688;
                        
                        double redout_tmp_117555 = min_res_115690;
                        
                        redout_115667 = redout_tmp_117555;
                    }
                    defunc_0_reduce_res_115664 = redout_115667;
                    for (int64_t i_115694 = 0; i_115694 < m_33388; i_115694++) {
                        double eta_p_115696 = ((double *) mem_113097)[i_115694];
                        double zp_res_115697 = eta_p_115696 + defunc_0_reduce_res_115664;
                        
                        ((double *) mem_113078)[i_115636 * m_33388 + i_115694] = zp_res_115697;
                    }
                    ((double *) mem_113080)[i_115636] = defunc_0_reduce_res_115664;
                }
                
                bool defunc_0_reduce_res_115704;
                bool redout_115709 = 0;
                
                for (int64_t i_115708 = 0; i_115708 < m_33388; i_115708++) {
                    double eta_p_115713 = ((double *) mem_param_115531.mem)[i_115708];
                    double eta_p_115714 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_70084 * m_33388 + i_115708];
                    double defunc_0_reduce_res_115715;
                    double redout_115717 = INFINITY;
                    
                    for (int64_t i_115716 = 0; i_115716 < m_33388; i_115716++) {
                        double eta_p_115718 = ((double *) mem_113078)[i_115716 * m_33388 + i_115708];
                        double zm_res_115719 = 30.0 - eta_p_115718;
                        double min_res_115720 = fmin64(zm_res_115719, redout_115717);
                        double redout_tmp_117563 = min_res_115720;
                        
                        redout_115717 = redout_tmp_117563;
                    }
                    defunc_0_reduce_res_115715 = redout_115717;
                    
                    double defunc_0_reduce_res_115722;
                    double redout_115725 = 0.0;
                    
                    for (int64_t i_115724 = 0; i_115724 < m_33388; i_115724++) {
                        double eta_p_115727 = ((double *) mem_113078)[i_115724 * m_33388 + i_115708];
                        double zp_res_115728 = eta_p_115727 + defunc_0_reduce_res_115715;
                        double exp_res_115729 = futrts_exp64(zp_res_115728);
                        double zp_res_115730 = exp_res_115729 + redout_115725;
                        
                        ((double *) mem_113125.mem)[i_115708 * m_33388 + i_115724] = exp_res_115729;
                        
                        double redout_tmp_117564 = zp_res_115730;
                        
                        redout_115725 = redout_tmp_117564;
                    }
                    defunc_0_reduce_res_115722 = redout_115725;
                    
                    double zp_res_115732 = eta_p_115713 + defunc_0_reduce_res_115715;
                    double zs_res_115733 = defunc_0_reduce_res_115722 / eta_p_115714;
                    double ztzt_res_115734 = fpow64(zs_res_115733, zs_res_44883);
                    double zt_res_115735 = zs_res_44885 * zp_res_115732;
                    double exp_res_115736 = futrts_exp64(zt_res_115735);
                    double zt_res_115737 = ztzt_res_115734 * exp_res_115736;
                    bool zgze_res_115738 = exp_absorb_cutoff_33394 <= zt_res_115737;
                    bool defunc_0_op_res_115739 = zgze_res_115738 || redout_115709;
                    
                    ((double *) mem_113120.mem)[i_115708] = zt_res_115737;
                    ((double *) mem_113122.mem)[i_115708] = zp_res_115732;
                    
                    bool redout_tmp_117559 = defunc_0_op_res_115739;
                    
                    redout_115709 = redout_tmp_117559;
                }
                defunc_0_reduce_res_115704 = redout_115709;
                
                bool defunc_0_reduce_res_115746;
                bool redout_115750 = 0;
                
                for (int64_t i_115749 = 0; i_115749 < m_33388; i_115749++) {
                    double eta_p_115753 = ((double *) mem_param_115530.mem)[i_115749];
                    double eta_p_115754 = ((double *) mem_113080)[i_115749];
                    double eta_p_115755 = ((double *) distrs_mem_111708.mem)[eta_p_70073 * m_33388 + i_115749];
                    double zp_res_115756 = eta_p_115753 + eta_p_115754;
                    double defunc_0_reduce_res_115757;
                    double redout_115759 = 0.0;
                    
                    for (int64_t i_115758 = 0; i_115758 < m_33388; i_115758++) {
                        double eta_p_115760 = ((double *) mem_113120.mem)[i_115758];
                        double eta_p_115761 = ((double *) mem_113125.mem)[i_115758 * m_33388 + i_115749];
                        double zt_res_115762 = eta_p_115760 * eta_p_115761;
                        double zp_res_115763 = zt_res_115762 + redout_115759;
                        double redout_tmp_117569 = zp_res_115763;
                        
                        redout_115759 = redout_tmp_117569;
                    }
                    defunc_0_reduce_res_115757 = redout_115759;
                    
                    double zs_res_115764 = defunc_0_reduce_res_115757 / eta_p_115755;
                    double ztzt_res_115765 = fpow64(zs_res_115764, zs_res_44842);
                    double zt_res_115766 = zs_res_44844 * zp_res_115756;
                    double exp_res_115767 = futrts_exp64(zt_res_115766);
                    double zt_res_115768 = ztzt_res_115765 * exp_res_115767;
                    bool zgze_res_115769 = exp_absorb_cutoff_33394 <= zt_res_115768;
                    bool defunc_0_op_res_115770 = zgze_res_115769 || redout_115750;
                    
                    ((double *) mem_113155.mem)[i_115749] = zt_res_115768;
                    ((double *) mem_113157.mem)[i_115749] = zp_res_115756;
                    
                    bool redout_tmp_117566 = defunc_0_op_res_115770;
                    
                    redout_115750 = redout_tmp_117566;
                }
                defunc_0_reduce_res_115746 = redout_115750;
                
                bool x_115773 = !defunc_0_reduce_res_115746;
                bool defunc_0_reduce_res_115774;
                
                if (x_115773) {
                    bool x_115775;
                    bool redout_115777 = 0;
                    
                    for (int64_t i_115776 = 0; i_115776 < m_33388; i_115776++) {
                        double eta_p_115778 = ((double *) mem_113155.mem)[i_115776];
                        bool zlze_res_115779 = eta_p_115778 <= zs_res_107134;
                        bool defunc_0_op_res_115780 = zlze_res_115779 || redout_115777;
                        bool redout_tmp_117570 = defunc_0_op_res_115780;
                        
                        redout_115777 = redout_tmp_117570;
                    }
                    x_115775 = redout_115777;
                    defunc_0_reduce_res_115774 = x_115775;
                } else {
                    defunc_0_reduce_res_115774 = 0;
                }
                
                bool cond_115781 = defunc_0_reduce_res_115774 || defunc_0_reduce_res_115746;
                int64_t ext_115782;
                
                if (cond_115781) {
                    ext_115782 = m_33388;
                } else {
                    ext_115782 = (int64_t) 1;
                }
                
                int64_t ext_115783;
                
                if (cond_115781) {
                    ext_115783 = (int64_t) 1;
                } else {
                    ext_115783 = m_33388;
                }
                if (cond_115781) {
                    for (int64_t i_115796 = 0; i_115796 < m_33388; i_115796++) {
                        double eta_p_115800 = ((double *) mem_113155.mem)[i_115796];
                        double eta_p_115801 = ((double *) mem_113157.mem)[i_115796];
                        bool zgze_res_115803 = exp_absorb_cutoff_33394 <= eta_p_115800;
                        bool zl_res_115804 = eta_p_115800 < zs_res_107134;
                        bool x_115805 = !zgze_res_115803;
                        bool y_115806 = zl_res_115804 && x_115805;
                        bool cond_115807 = zgze_res_115803 || y_115806;
                        int64_t ext_115808;
                        
                        if (cond_115807) {
                            ext_115808 = (int64_t) 0;
                        } else {
                            ext_115808 = i_115796;
                        }
                        
                        int64_t ext_115809;
                        
                        if (cond_115807) {
                            ext_115809 = (int64_t) 1;
                        } else {
                            ext_115809 = m_33388;
                        }
                        
                        double rescale_res_115811;
                        double rescale_res_115812;
                        
                        if (cond_115807) {
                            double log_res_115814 = futrts_log64(eta_p_115800);
                            double sqrt_res_115815 = futrts_sqrt64(eta_p_115800);
                            double zs_res_115816 = log_res_115814 / 2.0;
                            double zp_res_115817 = eta_p_115801 + zs_res_115816;
                            
                            for (int64_t i_115820 = 0; i_115820 < m_33388; i_115820++) {
                                double eta_p_115822 = ((double *) mem_113125.mem)[i_115820 * m_33388 + i_115796];
                                double zt_res_115823 = sqrt_res_115815 * eta_p_115822;
                                
                                ((double *) mem_113188.mem)[i_115820] = zt_res_115823;
                            }
                            if (memblock_set(ctx, &ext_mem_115810, &mem_113188, "mem_113188") != 0)
                                return 1;
                            rescale_res_115811 = sqrt_res_115815;
                            rescale_res_115812 = zp_res_115817;
                        } else {
                            if (memblock_set(ctx, &ext_mem_115810, &mem_113125, "mem_113125") != 0)
                                return 1;
                            rescale_res_115811 = eta_p_115800;
                            rescale_res_115812 = eta_p_115801;
                        }
                        ((double *) mem_113171.mem)[i_115796] = rescale_res_115811;
                        ((double *) mem_113173.mem)[i_115796] = rescale_res_115812;
                        lmad_copy_8b(ctx, 1, (uint64_t *) mem_113176.mem, i_115796 * m_33388, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_115810.mem, ext_115808, (int64_t []) {ext_115809}, (int64_t []) {m_33388});
                        if (memblock_unref(ctx, &ext_mem_115810, "ext_mem_115810") != 0)
                            return 1;
                    }
                    if (memblock_set(ctx, &ext_mem_115784, &mem_113171, "mem_113171") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_115785, &mem_113173, "mem_113173") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_115786, &mem_113176, "mem_113176") != 0)
                        return 1;
                } else {
                    if (memblock_set(ctx, &ext_mem_115784, &mem_113155, "mem_113155") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_115785, &mem_113157, "mem_113157") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_115786, &mem_113125, "mem_113125") != 0)
                        return 1;
                }
                
                bool x_115828 = !defunc_0_reduce_res_115704;
                bool defunc_0_reduce_res_115829;
                
                if (x_115828) {
                    bool x_115830;
                    bool redout_115832 = 0;
                    
                    for (int64_t i_115831 = 0; i_115831 < m_33388; i_115831++) {
                        double eta_p_115833 = ((double *) mem_113120.mem)[i_115831];
                        bool zlze_res_115834 = eta_p_115833 <= zs_res_107134;
                        bool defunc_0_op_res_115835 = zlze_res_115834 || redout_115832;
                        bool redout_tmp_117575 = defunc_0_op_res_115835;
                        
                        redout_115832 = redout_tmp_117575;
                    }
                    x_115830 = redout_115832;
                    defunc_0_reduce_res_115829 = x_115830;
                } else {
                    defunc_0_reduce_res_115829 = 0;
                }
                
                bool cond_115836 = defunc_0_reduce_res_115829 || defunc_0_reduce_res_115704;
                int64_t ext_115838;
                
                if (cond_115836) {
                    ext_115838 = (int64_t) 1;
                } else {
                    ext_115838 = ext_115782;
                }
                
                int64_t ext_115839;
                
                if (cond_115836) {
                    ext_115839 = m_33388;
                } else {
                    ext_115839 = ext_115783;
                }
                if (cond_115836) {
                    for (int64_t i_115852 = 0; i_115852 < m_33388; i_115852++) {
                        double eta_p_115856 = ((double *) mem_113120.mem)[i_115852];
                        double eta_p_115857 = ((double *) mem_113122.mem)[i_115852];
                        bool zgze_res_115859 = exp_absorb_cutoff_33394 <= eta_p_115856;
                        bool zl_res_115860 = eta_p_115856 < zs_res_107134;
                        bool x_115861 = !zgze_res_115859;
                        bool y_115862 = zl_res_115860 && x_115861;
                        bool cond_115863 = zgze_res_115859 || y_115862;
                        int64_t binop_y_115864 = i_115852 * ext_115783;
                        int64_t ext_115865;
                        
                        if (cond_115863) {
                            ext_115865 = (int64_t) 0;
                        } else {
                            ext_115865 = binop_y_115864;
                        }
                        
                        int64_t ext_115866;
                        
                        if (cond_115863) {
                            ext_115866 = (int64_t) 1;
                        } else {
                            ext_115866 = ext_115782;
                        }
                        
                        double rescale_res_115868;
                        double rescale_res_115869;
                        
                        if (cond_115863) {
                            double log_res_115871 = futrts_log64(eta_p_115856);
                            double sqrt_res_115872 = futrts_sqrt64(eta_p_115856);
                            double zs_res_115873 = log_res_115871 / 2.0;
                            double zp_res_115874 = eta_p_115857 + zs_res_115873;
                            
                            for (int64_t i_115877 = 0; i_115877 < m_33388; i_115877++) {
                                double eta_p_115879 = ((double *) ext_mem_115786.mem)[i_115877 * ext_115782 + i_115852 * ext_115783];
                                double zt_res_115880 = sqrt_res_115872 * eta_p_115879;
                                
                                ((double *) mem_113238.mem)[i_115877] = zt_res_115880;
                            }
                            if (memblock_set(ctx, &ext_mem_115867, &mem_113238, "mem_113238") != 0)
                                return 1;
                            rescale_res_115868 = sqrt_res_115872;
                            rescale_res_115869 = zp_res_115874;
                        } else {
                            if (memblock_set(ctx, &ext_mem_115867, &ext_mem_115786, "ext_mem_115786") != 0)
                                return 1;
                            rescale_res_115868 = eta_p_115856;
                            rescale_res_115869 = eta_p_115857;
                        }
                        ((double *) mem_113221.mem)[i_115852] = rescale_res_115868;
                        ((double *) mem_113223.mem)[i_115852] = rescale_res_115869;
                        lmad_copy_8b(ctx, 1, (uint64_t *) mem_113226.mem, i_115852 * m_33388, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_115867.mem, ext_115865, (int64_t []) {ext_115866}, (int64_t []) {m_33388});
                        if (memblock_unref(ctx, &ext_mem_115867, "ext_mem_115867") != 0)
                            return 1;
                    }
                    if (memblock_set(ctx, &ext_mem_115840, &mem_113221, "mem_113221") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_115841, &mem_113223, "mem_113223") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_115842, &mem_113226, "mem_113226") != 0)
                        return 1;
                } else {
                    if (memblock_set(ctx, &ext_mem_115840, &mem_113120, "mem_113120") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_115841, &mem_113122, "mem_113122") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_115842, &ext_mem_115786, "ext_mem_115786") != 0)
                        return 1;
                }
                if (memblock_unref(ctx, &ext_mem_115786, "ext_mem_115786") != 0)
                    return 1;
                
                bool defunc_0_reduce_res_115886;
                bool redout_115888 = 1;
                
                for (int64_t i_115887 = 0; i_115887 < m_33388; i_115887++) {
                    double eta_p_115889 = ((double *) ext_mem_115784.mem)[i_115887];
                    bool isnan_res_115890 = futrts_isnan64(eta_p_115889);
                    bool not_res_115891 = !isnan_res_115890;
                    bool x_115892 = not_res_115891 && redout_115888;
                    bool redout_tmp_117580 = x_115892;
                    
                    redout_115888 = redout_tmp_117580;
                }
                defunc_0_reduce_res_115886 = redout_115888;
                
                bool defunc_0_reduce_comm_res_115893;
                
                if (defunc_0_reduce_res_115886) {
                    bool x_115894;
                    bool redout_115896 = 0;
                    
                    for (int64_t i_115895 = 0; i_115895 < m_33388; i_115895++) {
                        double eta_p_115897 = ((double *) ext_mem_115784.mem)[i_115895];
                        double zt_res_115898 = eta_p_115897 * zp_res_108112;
                        bool zgze_res_115899 = 1.0 <= zt_res_115898;
                        bool zgze_res_115900 = eta_p_115897 <= zp_res_108112;
                        bool x_115901 = zgze_res_115899 && zgze_res_115900;
                        bool not_res_115902 = !x_115901;
                        bool defunc_0_op_res_115903 = not_res_115902 || redout_115896;
                        bool redout_tmp_117581 = defunc_0_op_res_115903;
                        
                        redout_115896 = redout_tmp_117581;
                    }
                    x_115894 = redout_115896;
                    defunc_0_reduce_comm_res_115893 = x_115894;
                } else {
                    defunc_0_reduce_comm_res_115893 = 0;
                }
                
                bool x_115904 = defunc_0_reduce_comm_res_115893 && defunc_0_reduce_res_115886;
                int64_t ext_115914;
                int64_t ext_115915;
                int64_t ext_115916;
                int64_t ext_115917;
                int64_t ext_115918;
                int64_t ext_115919;
                bool algo5_core_loop_res_115920;
                int64_t ctx_param_ext_115939;
                int64_t ctx_param_ext_115940;
                int64_t ctx_param_ext_115941;
                int64_t ctx_param_ext_115942;
                int64_t ctx_param_ext_115943;
                int64_t ctx_param_ext_115944;
                bool loop_while_115945;
                
                if (memblock_set(ctx, &mem_param_115930, &mem_113125, "mem_113125") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_115931, &mem_111716, "mem_111716") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_115932, &mem_113157, "mem_113157") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_115933, &mem_113122, "mem_113122") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_115934, &ext_mem_115842, "ext_mem_115842") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_115935, &ext_mem_115784, "ext_mem_115784") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_115936, &ext_mem_115840, "ext_mem_115840") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_115937, &ext_mem_115785, "ext_mem_115785") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_115938, &ext_mem_115841, "ext_mem_115841") != 0)
                    return 1;
                ctx_param_ext_115939 = (int64_t) 0;
                ctx_param_ext_115940 = (int64_t) 1;
                ctx_param_ext_115941 = m_33388;
                ctx_param_ext_115942 = (int64_t) 0;
                ctx_param_ext_115943 = ext_115838;
                ctx_param_ext_115944 = ext_115839;
                loop_while_115945 = x_115904;
                while (loop_while_115945) {
                    if (memblock_alloc(ctx, &mem_115955, bytes_111715, "mem_115955")) {
                        err = 1;
                        goto cleanup;
                    }
                    
                    bool defunc_0_reduce_res_115957;
                    bool redout_115960 = 0;
                    
                    for (int64_t i_115959 = 0; i_115959 < m_33388; i_115959++) {
                        double eta_p_115962 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_70084 * m_33388 + i_115959];
                        double eta_p_115963 = ((double *) mem_param_115938.mem)[i_115959];
                        double defunc_0_reduce_res_115964;
                        double redout_115966 = 0.0;
                        
                        for (int64_t i_115965 = 0; i_115965 < m_33388; i_115965++) {
                            double eta_p_115967 = ((double *) mem_param_115935.mem)[i_115965];
                            double eta_p_115968 = ((double *) mem_param_115934.mem)[ctx_param_ext_115942 + (i_115965 * ctx_param_ext_115943 + i_115959 * ctx_param_ext_115944)];
                            double zt_res_115969 = eta_p_115967 * eta_p_115968;
                            double zp_res_115970 = zt_res_115969 + redout_115966;
                            double redout_tmp_117609 = zp_res_115970;
                            
                            redout_115966 = redout_tmp_117609;
                        }
                        defunc_0_reduce_res_115964 = redout_115966;
                        
                        double zs_res_115971 = defunc_0_reduce_res_115964 / eta_p_115962;
                        double ztzt_res_115972 = fpow64(zs_res_115971, zs_res_44883);
                        double zt_res_115973 = zs_res_44885 * eta_p_115963;
                        double exp_res_115974 = futrts_exp64(zt_res_115973);
                        double zt_res_115975 = ztzt_res_115972 * exp_res_115974;
                        bool zgze_res_115976 = exp_absorb_cutoff_33394 <= zt_res_115975;
                        bool defunc_0_op_res_115977 = zgze_res_115976 || redout_115960;
                        
                        ((double *) mem_115955.mem)[i_115959] = zt_res_115975;
                        
                        bool redout_tmp_117607 = defunc_0_op_res_115977;
                        
                        redout_115960 = redout_tmp_117607;
                    }
                    defunc_0_reduce_res_115957 = redout_115960;
                    if (memblock_alloc(ctx, &mem_115979, bytes_111715, "mem_115979")) {
                        err = 1;
                        goto cleanup;
                    }
                    
                    bool defunc_0_reduce_res_115981;
                    bool redout_115984 = 0;
                    
                    for (int64_t i_115983 = 0; i_115983 < m_33388; i_115983++) {
                        double eta_p_115986 = ((double *) distrs_mem_111708.mem)[eta_p_70073 * m_33388 + i_115983];
                        double eta_p_115987 = ((double *) mem_param_115937.mem)[i_115983];
                        double defunc_0_reduce_res_115988;
                        double redout_115990 = 0.0;
                        
                        for (int64_t i_115989 = 0; i_115989 < m_33388; i_115989++) {
                            double eta_p_115991 = ((double *) mem_115955.mem)[i_115989];
                            double eta_p_115992 = ((double *) mem_param_115934.mem)[ctx_param_ext_115942 + (i_115983 * ctx_param_ext_115943 + i_115989 * ctx_param_ext_115944)];
                            double zt_res_115993 = eta_p_115991 * eta_p_115992;
                            double zp_res_115994 = zt_res_115993 + redout_115990;
                            double redout_tmp_117612 = zp_res_115994;
                            
                            redout_115990 = redout_tmp_117612;
                        }
                        defunc_0_reduce_res_115988 = redout_115990;
                        
                        double zs_res_115995 = defunc_0_reduce_res_115988 / eta_p_115986;
                        double ztzt_res_115996 = fpow64(zs_res_115995, zs_res_44842);
                        double zt_res_115997 = zs_res_44844 * eta_p_115987;
                        double exp_res_115998 = futrts_exp64(zt_res_115997);
                        double zt_res_115999 = ztzt_res_115996 * exp_res_115998;
                        bool zgze_res_116000 = exp_absorb_cutoff_33394 <= zt_res_115999;
                        bool defunc_0_op_res_116001 = zgze_res_116000 || redout_115984;
                        
                        ((double *) mem_115979.mem)[i_115983] = zt_res_115999;
                        
                        bool redout_tmp_117610 = defunc_0_op_res_116001;
                        
                        redout_115984 = redout_tmp_117610;
                    }
                    defunc_0_reduce_res_115981 = redout_115984;
                    
                    bool x_116003 = !defunc_0_reduce_res_115981;
                    bool defunc_0_reduce_res_116004;
                    
                    if (x_116003) {
                        bool x_116005;
                        bool redout_116007 = 0;
                        
                        for (int64_t i_116006 = 0; i_116006 < m_33388; i_116006++) {
                            double eta_p_116008 = ((double *) mem_115979.mem)[i_116006];
                            bool zlze_res_116009 = eta_p_116008 <= zs_res_107134;
                            bool defunc_0_op_res_116010 = zlze_res_116009 || redout_116007;
                            bool redout_tmp_117613 = defunc_0_op_res_116010;
                            
                            redout_116007 = redout_tmp_117613;
                        }
                        x_116005 = redout_116007;
                        defunc_0_reduce_res_116004 = x_116005;
                    } else {
                        defunc_0_reduce_res_116004 = 0;
                    }
                    
                    bool cond_116011 = defunc_0_reduce_res_116004 || defunc_0_reduce_res_115981;
                    int64_t ext_116012;
                    
                    if (cond_116011) {
                        ext_116012 = (int64_t) 0;
                    } else {
                        ext_116012 = ctx_param_ext_115942;
                    }
                    
                    int64_t ext_116013;
                    
                    if (cond_116011) {
                        ext_116013 = m_33388;
                    } else {
                        ext_116013 = ctx_param_ext_115943;
                    }
                    
                    int64_t ext_116014;
                    
                    if (cond_116011) {
                        ext_116014 = (int64_t) 1;
                    } else {
                        ext_116014 = ctx_param_ext_115944;
                    }
                    if (memblock_alloc(ctx, &mem_116015, bytes_111715, "mem_116015")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_116016, bytes_111715, "mem_116016")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_116017, bytes_111743, "mem_116017")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (cond_116011) {
                        double zs_res_116024 = 1.0 / exp_absorb_cutoff_33394;
                        
                        for (int64_t i_116031 = 0; i_116031 < m_33388; i_116031++) {
                            double eta_p_116035 = ((double *) mem_115979.mem)[i_116031];
                            double eta_p_116036 = ((double *) mem_param_115937.mem)[i_116031];
                            bool zgze_res_116038 = exp_absorb_cutoff_33394 <= eta_p_116035;
                            bool zl_res_116039 = eta_p_116035 < zs_res_116024;
                            bool x_116040 = !zgze_res_116038;
                            bool y_116041 = zl_res_116039 && x_116040;
                            bool cond_116042 = zgze_res_116038 || y_116041;
                            int64_t binop_y_116043 = i_116031 * ctx_param_ext_115943;
                            int64_t lmad_ext_116044 = ctx_param_ext_115942 + binop_y_116043;
                            int64_t ext_116045;
                            
                            if (cond_116042) {
                                ext_116045 = (int64_t) 0;
                            } else {
                                ext_116045 = lmad_ext_116044;
                            }
                            
                            int64_t ext_116046;
                            
                            if (cond_116042) {
                                ext_116046 = (int64_t) 1;
                            } else {
                                ext_116046 = ctx_param_ext_115944;
                            }
                            
                            double rescale_res_116048;
                            double rescale_res_116049;
                            
                            if (cond_116042) {
                                double log_res_116051 = futrts_log64(eta_p_116035);
                                double sqrt_res_116052 = futrts_sqrt64(eta_p_116035);
                                double zs_res_116053 = log_res_116051 / 2.0;
                                double zp_res_116054 = eta_p_116036 + zs_res_116053;
                                
                                for (int64_t i_116057 = 0; i_116057 < m_33388; i_116057++) {
                                    double eta_p_116059 = ((double *) mem_param_115934.mem)[ctx_param_ext_115942 + (i_116031 * ctx_param_ext_115943 + i_116057 * ctx_param_ext_115944)];
                                    double zt_res_116060 = sqrt_res_116052 * eta_p_116059;
                                    
                                    ((double *) mem_113333.mem)[i_116057] = zt_res_116060;
                                }
                                if (memblock_set(ctx, &ext_mem_116047, &mem_113333, "mem_113333") != 0)
                                    return 1;
                                rescale_res_116048 = sqrt_res_116052;
                                rescale_res_116049 = zp_res_116054;
                            } else {
                                if (memblock_set(ctx, &ext_mem_116047, &mem_param_115934, "mem_param_115934") != 0)
                                    return 1;
                                rescale_res_116048 = eta_p_116035;
                                rescale_res_116049 = eta_p_116036;
                            }
                            ((double *) mem_116015.mem)[i_116031] = rescale_res_116048;
                            ((double *) mem_116016.mem)[i_116031] = rescale_res_116049;
                            lmad_copy_8b(ctx, 1, (uint64_t *) mem_116017.mem, i_116031 * m_33388, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_116047.mem, ext_116045, (int64_t []) {ext_116046}, (int64_t []) {m_33388});
                            if (memblock_unref(ctx, &ext_mem_116047, "ext_mem_116047") != 0)
                                return 1;
                        }
                        if (memblock_set(ctx, &ext_mem_116018, &mem_116015, "mem_116015") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_116019, &mem_116016, "mem_116016") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_116020, &mem_116017, "mem_116017") != 0)
                            return 1;
                    } else {
                        if (memblock_set(ctx, &ext_mem_116018, &mem_115979, "mem_115979") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_116019, &mem_param_115937, "mem_param_115937") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_116020, &mem_param_115934, "mem_param_115934") != 0)
                            return 1;
                    }
                    if (memblock_unref(ctx, &mem_115979, "mem_115979") != 0)
                        return 1;
                    if (memblock_unref(ctx, &mem_116015, "mem_116015") != 0)
                        return 1;
                    if (memblock_unref(ctx, &mem_116016, "mem_116016") != 0)
                        return 1;
                    if (memblock_unref(ctx, &mem_116017, "mem_116017") != 0)
                        return 1;
                    
                    bool x_116065 = !defunc_0_reduce_res_115957;
                    bool defunc_0_reduce_res_116066;
                    
                    if (x_116065) {
                        bool x_116067;
                        bool redout_116069 = 0;
                        
                        for (int64_t i_116068 = 0; i_116068 < m_33388; i_116068++) {
                            double eta_p_116070 = ((double *) mem_115955.mem)[i_116068];
                            bool zlze_res_116071 = eta_p_116070 <= zs_res_107134;
                            bool defunc_0_op_res_116072 = zlze_res_116071 || redout_116069;
                            bool redout_tmp_117618 = defunc_0_op_res_116072;
                            
                            redout_116069 = redout_tmp_117618;
                        }
                        x_116067 = redout_116069;
                        defunc_0_reduce_res_116066 = x_116067;
                    } else {
                        defunc_0_reduce_res_116066 = 0;
                    }
                    
                    bool cond_116073 = defunc_0_reduce_res_116066 || defunc_0_reduce_res_115957;
                    int64_t ext_116075;
                    
                    if (cond_116073) {
                        ext_116075 = (int64_t) 0;
                    } else {
                        ext_116075 = ext_116012;
                    }
                    
                    int64_t ext_116076;
                    
                    if (cond_116073) {
                        ext_116076 = (int64_t) 1;
                    } else {
                        ext_116076 = ext_116013;
                    }
                    
                    int64_t ext_116077;
                    
                    if (cond_116073) {
                        ext_116077 = m_33388;
                    } else {
                        ext_116077 = ext_116014;
                    }
                    if (memblock_alloc(ctx, &mem_116078, bytes_111715, "mem_116078")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_116079, bytes_111715, "mem_116079")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_116080, bytes_111743, "mem_116080")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (cond_116073) {
                        double zs_res_116087 = 1.0 / exp_absorb_cutoff_33394;
                        
                        for (int64_t i_116094 = 0; i_116094 < m_33388; i_116094++) {
                            double eta_p_116098 = ((double *) mem_115955.mem)[i_116094];
                            double eta_p_116099 = ((double *) mem_param_115938.mem)[i_116094];
                            bool zgze_res_116101 = exp_absorb_cutoff_33394 <= eta_p_116098;
                            bool zl_res_116102 = eta_p_116098 < zs_res_116087;
                            bool x_116103 = !zgze_res_116101;
                            bool y_116104 = zl_res_116102 && x_116103;
                            bool cond_116105 = zgze_res_116101 || y_116104;
                            int64_t binop_y_116106 = i_116094 * ext_116014;
                            int64_t lmad_ext_116107 = ext_116012 + binop_y_116106;
                            int64_t ext_116108;
                            
                            if (cond_116105) {
                                ext_116108 = (int64_t) 0;
                            } else {
                                ext_116108 = lmad_ext_116107;
                            }
                            
                            int64_t ext_116109;
                            
                            if (cond_116105) {
                                ext_116109 = (int64_t) 1;
                            } else {
                                ext_116109 = ext_116013;
                            }
                            
                            double rescale_res_116111;
                            double rescale_res_116112;
                            
                            if (cond_116105) {
                                double log_res_116114 = futrts_log64(eta_p_116098);
                                double sqrt_res_116115 = futrts_sqrt64(eta_p_116098);
                                double zs_res_116116 = log_res_116114 / 2.0;
                                double zp_res_116117 = eta_p_116099 + zs_res_116116;
                                
                                for (int64_t i_116120 = 0; i_116120 < m_33388; i_116120++) {
                                    double eta_p_116122 = ((double *) ext_mem_116020.mem)[ext_116012 + (i_116120 * ext_116013 + i_116094 * ext_116014)];
                                    double zt_res_116123 = sqrt_res_116115 * eta_p_116122;
                                    
                                    ((double *) mem_113383.mem)[i_116120] = zt_res_116123;
                                }
                                if (memblock_set(ctx, &ext_mem_116110, &mem_113383, "mem_113383") != 0)
                                    return 1;
                                rescale_res_116111 = sqrt_res_116115;
                                rescale_res_116112 = zp_res_116117;
                            } else {
                                if (memblock_set(ctx, &ext_mem_116110, &ext_mem_116020, "ext_mem_116020") != 0)
                                    return 1;
                                rescale_res_116111 = eta_p_116098;
                                rescale_res_116112 = eta_p_116099;
                            }
                            ((double *) mem_116078.mem)[i_116094] = rescale_res_116111;
                            ((double *) mem_116079.mem)[i_116094] = rescale_res_116112;
                            lmad_copy_8b(ctx, 1, (uint64_t *) mem_116080.mem, i_116094 * m_33388, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_116110.mem, ext_116108, (int64_t []) {ext_116109}, (int64_t []) {m_33388});
                            if (memblock_unref(ctx, &ext_mem_116110, "ext_mem_116110") != 0)
                                return 1;
                        }
                        if (memblock_set(ctx, &ext_mem_116081, &mem_116078, "mem_116078") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_116082, &mem_116079, "mem_116079") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_116083, &mem_116080, "mem_116080") != 0)
                            return 1;
                    } else {
                        if (memblock_set(ctx, &ext_mem_116081, &mem_115955, "mem_115955") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_116082, &mem_param_115938, "mem_param_115938") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_116083, &ext_mem_116020, "ext_mem_116020") != 0)
                            return 1;
                    }
                    if (memblock_unref(ctx, &mem_115955, "mem_115955") != 0)
                        return 1;
                    if (memblock_unref(ctx, &ext_mem_116020, "ext_mem_116020") != 0)
                        return 1;
                    if (memblock_unref(ctx, &mem_116078, "mem_116078") != 0)
                        return 1;
                    if (memblock_unref(ctx, &mem_116079, "mem_116079") != 0)
                        return 1;
                    if (memblock_unref(ctx, &mem_116080, "mem_116080") != 0)
                        return 1;
                    
                    bool defunc_0_reduce_res_116129;
                    bool redout_116131 = 1;
                    
                    for (int64_t i_116130 = 0; i_116130 < m_33388; i_116130++) {
                        double eta_p_116132 = ((double *) ext_mem_116018.mem)[i_116130];
                        bool isnan_res_116133 = futrts_isnan64(eta_p_116132);
                        bool not_res_116134 = !isnan_res_116133;
                        bool x_116135 = not_res_116134 && redout_116131;
                        bool redout_tmp_117623 = x_116135;
                        
                        redout_116131 = redout_tmp_117623;
                    }
                    defunc_0_reduce_res_116129 = redout_116131;
                    
                    bool loop_cond_116136;
                    
                    if (defunc_0_reduce_res_116129) {
                        double zp_res_116137 = 1.0 + tol_sinkhorn_33396;
                        bool defunc_0_reduce_comm_res_116138;
                        bool redout_116140 = 0;
                        
                        for (int64_t i_116139 = 0; i_116139 < m_33388; i_116139++) {
                            double eta_p_116141 = ((double *) ext_mem_116018.mem)[i_116139];
                            double eta_p_116142 = ((double *) mem_param_115935.mem)[i_116139];
                            double zt_res_116143 = zp_res_116137 * eta_p_116141;
                            bool zgze_res_116144 = eta_p_116142 <= zt_res_116143;
                            double zt_res_116145 = zp_res_116137 * eta_p_116142;
                            bool zgze_res_116146 = eta_p_116141 <= zt_res_116145;
                            bool x_116147 = zgze_res_116144 && zgze_res_116146;
                            bool not_res_116148 = !x_116147;
                            bool defunc_0_op_res_116149 = not_res_116148 || redout_116140;
                            bool redout_tmp_117624 = defunc_0_op_res_116149;
                            
                            redout_116140 = redout_tmp_117624;
                        }
                        defunc_0_reduce_comm_res_116138 = redout_116140;
                        loop_cond_116136 = defunc_0_reduce_comm_res_116138;
                    } else {
                        loop_cond_116136 = 0;
                    }
                    if (memblock_set(ctx, &mem_param_tmp_117582, &mem_param_115934, "mem_param_115934") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_117583, &mem_param_115935, "mem_param_115935") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_117584, &mem_param_115937, "mem_param_115937") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_117585, &mem_param_115938, "mem_param_115938") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_117586, &ext_mem_116083, "ext_mem_116083") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_117587, &ext_mem_116018, "ext_mem_116018") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_117588, &ext_mem_116081, "ext_mem_116081") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_117589, &ext_mem_116019, "ext_mem_116019") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_117590, &ext_mem_116082, "ext_mem_116082") != 0)
                        return 1;
                    
                    int64_t ctx_param_ext_tmp_117591 = ctx_param_ext_115942;
                    int64_t ctx_param_ext_tmp_117592 = ctx_param_ext_115943;
                    int64_t ctx_param_ext_tmp_117593 = ctx_param_ext_115944;
                    int64_t ctx_param_ext_tmp_117594 = ext_116075;
                    int64_t ctx_param_ext_tmp_117595 = ext_116076;
                    int64_t ctx_param_ext_tmp_117596 = ext_116077;
                    bool loop_while_tmp_117597 = loop_cond_116136;
                    
                    if (memblock_set(ctx, &mem_param_115930, &mem_param_tmp_117582, "mem_param_tmp_117582") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_115931, &mem_param_tmp_117583, "mem_param_tmp_117583") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_115932, &mem_param_tmp_117584, "mem_param_tmp_117584") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_115933, &mem_param_tmp_117585, "mem_param_tmp_117585") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_115934, &mem_param_tmp_117586, "mem_param_tmp_117586") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_115935, &mem_param_tmp_117587, "mem_param_tmp_117587") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_115936, &mem_param_tmp_117588, "mem_param_tmp_117588") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_115937, &mem_param_tmp_117589, "mem_param_tmp_117589") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_115938, &mem_param_tmp_117590, "mem_param_tmp_117590") != 0)
                        return 1;
                    ctx_param_ext_115939 = ctx_param_ext_tmp_117591;
                    ctx_param_ext_115940 = ctx_param_ext_tmp_117592;
                    ctx_param_ext_115941 = ctx_param_ext_tmp_117593;
                    ctx_param_ext_115942 = ctx_param_ext_tmp_117594;
                    ctx_param_ext_115943 = ctx_param_ext_tmp_117595;
                    ctx_param_ext_115944 = ctx_param_ext_tmp_117596;
                    loop_while_115945 = loop_while_tmp_117597;
                }
                if (memblock_set(ctx, &ext_mem_115905, &mem_param_115930, "mem_param_115930") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_115906, &mem_param_115931, "mem_param_115931") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_115907, &mem_param_115932, "mem_param_115932") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_115908, &mem_param_115933, "mem_param_115933") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_115909, &mem_param_115934, "mem_param_115934") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_115910, &mem_param_115935, "mem_param_115935") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_115911, &mem_param_115936, "mem_param_115936") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_115912, &mem_param_115937, "mem_param_115937") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_115913, &mem_param_115938, "mem_param_115938") != 0)
                    return 1;
                ext_115914 = ctx_param_ext_115939;
                ext_115915 = ctx_param_ext_115940;
                ext_115916 = ctx_param_ext_115941;
                ext_115917 = ctx_param_ext_115942;
                ext_115918 = ctx_param_ext_115943;
                ext_115919 = ctx_param_ext_115944;
                algo5_core_loop_res_115920 = loop_while_115945;
                if (memblock_unref(ctx, &ext_mem_115784, "ext_mem_115784") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_115785, "ext_mem_115785") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_115840, "ext_mem_115840") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_115841, "ext_mem_115841") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_115842, "ext_mem_115842") != 0)
                    return 1;
                
                bool defunc_0_reduce_res_116150;
                bool redout_116152 = 1;
                
                for (int64_t i_116151 = 0; i_116151 < m_33388; i_116151++) {
                    double eta_p_116153 = ((double *) ext_mem_115910.mem)[i_116151];
                    bool isnan_res_116154 = futrts_isnan64(eta_p_116153);
                    bool not_res_116155 = !isnan_res_116154;
                    bool x_116156 = not_res_116155 && redout_116152;
                    bool redout_tmp_117625 = x_116156;
                    
                    redout_116152 = redout_tmp_117625;
                }
                defunc_0_reduce_res_116150 = redout_116152;
                
                int64_t ext_116158;
                int64_t ext_116159;
                int64_t ext_116160;
                
                if (defunc_0_reduce_res_116150) {
                    if (memblock_set(ctx, &ext_mem_116157, &ext_mem_115909, "ext_mem_115909") != 0)
                        return 1;
                    ext_116158 = ext_115917;
                    ext_116159 = ext_115918;
                    ext_116160 = ext_115919;
                    if (memblock_set(ctx, &ext_mem_116161, &ext_mem_115910, "ext_mem_115910") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_116162, &ext_mem_115911, "ext_mem_115911") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_116163, &ext_mem_115912, "ext_mem_115912") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_116164, &ext_mem_115913, "ext_mem_115913") != 0)
                        return 1;
                } else {
                    bool defunc_0_reduce_res_116171;
                    bool redout_116174 = 0;
                    
                    for (int64_t i_116173 = 0; i_116173 < m_33388; i_116173++) {
                        double eta_p_116176 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_70084 * m_33388 + i_116173];
                        double eta_p_116177 = ((double *) ext_mem_115908.mem)[i_116173];
                        double defunc_0_reduce_res_116178;
                        double redout_116180 = 0.0;
                        
                        for (int64_t i_116179 = 0; i_116179 < m_33388; i_116179++) {
                            double eta_p_116181 = ((double *) ext_mem_115906.mem)[i_116179];
                            double eta_p_116182 = ((double *) ext_mem_115905.mem)[ext_115914 + (i_116179 * ext_115915 + i_116173 * ext_115916)];
                            double zt_res_116183 = eta_p_116181 * eta_p_116182;
                            double zp_res_116184 = zt_res_116183 + redout_116180;
                            double redout_tmp_117628 = zp_res_116184;
                            
                            redout_116180 = redout_tmp_117628;
                        }
                        defunc_0_reduce_res_116178 = redout_116180;
                        
                        double zs_res_116185 = defunc_0_reduce_res_116178 / eta_p_116176;
                        double ztzt_res_116186 = fpow64(zs_res_116185, zs_res_44883);
                        double zt_res_116187 = zs_res_44885 * eta_p_116177;
                        double exp_res_116188 = futrts_exp64(zt_res_116187);
                        double zt_res_116189 = ztzt_res_116186 * exp_res_116188;
                        bool zgze_res_116190 = exp_absorb_cutoff_33394 <= zt_res_116189;
                        bool defunc_0_op_res_116191 = zgze_res_116190 || redout_116174;
                        
                        ((double *) mem_113445.mem)[i_116173] = zt_res_116189;
                        
                        bool redout_tmp_117626 = defunc_0_op_res_116191;
                        
                        redout_116174 = redout_tmp_117626;
                    }
                    defunc_0_reduce_res_116171 = redout_116174;
                    
                    bool defunc_0_reduce_res_116194;
                    bool redout_116197 = 0;
                    
                    for (int64_t i_116196 = 0; i_116196 < m_33388; i_116196++) {
                        double eta_p_116199 = ((double *) distrs_mem_111708.mem)[eta_p_70073 * m_33388 + i_116196];
                        double eta_p_116200 = ((double *) ext_mem_115907.mem)[i_116196];
                        double defunc_0_reduce_res_116201;
                        double redout_116203 = 0.0;
                        
                        for (int64_t i_116202 = 0; i_116202 < m_33388; i_116202++) {
                            double eta_p_116204 = ((double *) mem_113445.mem)[i_116202];
                            double eta_p_116205 = ((double *) ext_mem_115905.mem)[ext_115914 + (i_116196 * ext_115915 + i_116202 * ext_115916)];
                            double zt_res_116206 = eta_p_116204 * eta_p_116205;
                            double zp_res_116207 = zt_res_116206 + redout_116203;
                            double redout_tmp_117631 = zp_res_116207;
                            
                            redout_116203 = redout_tmp_117631;
                        }
                        defunc_0_reduce_res_116201 = redout_116203;
                        
                        double zs_res_116208 = defunc_0_reduce_res_116201 / eta_p_116199;
                        double ztzt_res_116209 = fpow64(zs_res_116208, zs_res_44842);
                        double zt_res_116210 = zs_res_44844 * eta_p_116200;
                        double exp_res_116211 = futrts_exp64(zt_res_116210);
                        double zt_res_116212 = ztzt_res_116209 * exp_res_116211;
                        bool zgze_res_116213 = exp_absorb_cutoff_33394 <= zt_res_116212;
                        bool defunc_0_op_res_116214 = zgze_res_116213 || redout_116197;
                        
                        ((double *) mem_113453.mem)[i_116196] = zt_res_116212;
                        
                        bool redout_tmp_117629 = defunc_0_op_res_116214;
                        
                        redout_116197 = redout_tmp_117629;
                    }
                    defunc_0_reduce_res_116194 = redout_116197;
                    
                    bool x_116216 = !defunc_0_reduce_res_116194;
                    bool defunc_0_reduce_res_116217;
                    
                    if (x_116216) {
                        bool x_116218;
                        bool redout_116220 = 0;
                        
                        for (int64_t i_116219 = 0; i_116219 < m_33388; i_116219++) {
                            double eta_p_116221 = ((double *) mem_113453.mem)[i_116219];
                            bool zlze_res_116222 = eta_p_116221 <= zs_res_107134;
                            bool defunc_0_op_res_116223 = zlze_res_116222 || redout_116220;
                            bool redout_tmp_117632 = defunc_0_op_res_116223;
                            
                            redout_116220 = redout_tmp_117632;
                        }
                        x_116218 = redout_116220;
                        defunc_0_reduce_res_116217 = x_116218;
                    } else {
                        defunc_0_reduce_res_116217 = 0;
                    }
                    
                    bool cond_116224 = defunc_0_reduce_res_116217 || defunc_0_reduce_res_116194;
                    int64_t ext_116225;
                    
                    if (cond_116224) {
                        ext_116225 = (int64_t) 0;
                    } else {
                        ext_116225 = ext_115914;
                    }
                    
                    int64_t ext_116226;
                    
                    if (cond_116224) {
                        ext_116226 = m_33388;
                    } else {
                        ext_116226 = ext_115915;
                    }
                    
                    int64_t ext_116227;
                    
                    if (cond_116224) {
                        ext_116227 = (int64_t) 1;
                    } else {
                        ext_116227 = ext_115916;
                    }
                    if (cond_116224) {
                        for (int64_t i_116240 = 0; i_116240 < m_33388; i_116240++) {
                            double eta_p_116244 = ((double *) mem_113453.mem)[i_116240];
                            double eta_p_116245 = ((double *) ext_mem_115907.mem)[i_116240];
                            bool zgze_res_116247 = exp_absorb_cutoff_33394 <= eta_p_116244;
                            bool zl_res_116248 = eta_p_116244 < zs_res_107134;
                            bool x_116249 = !zgze_res_116247;
                            bool y_116250 = zl_res_116248 && x_116249;
                            bool cond_116251 = zgze_res_116247 || y_116250;
                            int64_t binop_y_116252 = i_116240 * ext_115915;
                            int64_t lmad_ext_116253 = ext_115914 + binop_y_116252;
                            int64_t ext_116254;
                            
                            if (cond_116251) {
                                ext_116254 = (int64_t) 0;
                            } else {
                                ext_116254 = lmad_ext_116253;
                            }
                            
                            int64_t ext_116255;
                            
                            if (cond_116251) {
                                ext_116255 = (int64_t) 1;
                            } else {
                                ext_116255 = ext_115916;
                            }
                            
                            double rescale_res_116257;
                            double rescale_res_116258;
                            
                            if (cond_116251) {
                                double log_res_116260 = futrts_log64(eta_p_116244);
                                double sqrt_res_116261 = futrts_sqrt64(eta_p_116244);
                                double zs_res_116262 = log_res_116260 / 2.0;
                                double zp_res_116263 = eta_p_116245 + zs_res_116262;
                                
                                for (int64_t i_116266 = 0; i_116266 < m_33388; i_116266++) {
                                    double eta_p_116268 = ((double *) ext_mem_115905.mem)[ext_115914 + (i_116240 * ext_115915 + i_116266 * ext_115916)];
                                    double zt_res_116269 = sqrt_res_116261 * eta_p_116268;
                                    
                                    ((double *) mem_113478.mem)[i_116266] = zt_res_116269;
                                }
                                if (memblock_set(ctx, &ext_mem_116256, &mem_113478, "mem_113478") != 0)
                                    return 1;
                                rescale_res_116257 = sqrt_res_116261;
                                rescale_res_116258 = zp_res_116263;
                            } else {
                                if (memblock_set(ctx, &ext_mem_116256, &ext_mem_115905, "ext_mem_115905") != 0)
                                    return 1;
                                rescale_res_116257 = eta_p_116244;
                                rescale_res_116258 = eta_p_116245;
                            }
                            ((double *) mem_113461.mem)[i_116240] = rescale_res_116257;
                            ((double *) mem_113463.mem)[i_116240] = rescale_res_116258;
                            lmad_copy_8b(ctx, 1, (uint64_t *) mem_113466.mem, i_116240 * m_33388, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_116256.mem, ext_116254, (int64_t []) {ext_116255}, (int64_t []) {m_33388});
                            if (memblock_unref(ctx, &ext_mem_116256, "ext_mem_116256") != 0)
                                return 1;
                        }
                        if (memblock_set(ctx, &ext_mem_116228, &mem_113461, "mem_113461") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_116229, &mem_113463, "mem_113463") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_116230, &mem_113466, "mem_113466") != 0)
                            return 1;
                    } else {
                        if (memblock_set(ctx, &ext_mem_116228, &mem_113453, "mem_113453") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_116229, &ext_mem_115907, "ext_mem_115907") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_116230, &ext_mem_115905, "ext_mem_115905") != 0)
                            return 1;
                    }
                    
                    bool x_116274 = !defunc_0_reduce_res_116171;
                    bool defunc_0_reduce_res_116275;
                    
                    if (x_116274) {
                        bool x_116276;
                        bool redout_116278 = 0;
                        
                        for (int64_t i_116277 = 0; i_116277 < m_33388; i_116277++) {
                            double eta_p_116279 = ((double *) mem_113445.mem)[i_116277];
                            bool zlze_res_116280 = eta_p_116279 <= zs_res_107134;
                            bool defunc_0_op_res_116281 = zlze_res_116280 || redout_116278;
                            bool redout_tmp_117637 = defunc_0_op_res_116281;
                            
                            redout_116278 = redout_tmp_117637;
                        }
                        x_116276 = redout_116278;
                        defunc_0_reduce_res_116275 = x_116276;
                    } else {
                        defunc_0_reduce_res_116275 = 0;
                    }
                    
                    bool cond_116282 = defunc_0_reduce_res_116275 || defunc_0_reduce_res_116171;
                    int64_t ext_116284;
                    
                    if (cond_116282) {
                        ext_116284 = (int64_t) 0;
                    } else {
                        ext_116284 = ext_116225;
                    }
                    
                    int64_t ext_116285;
                    
                    if (cond_116282) {
                        ext_116285 = (int64_t) 1;
                    } else {
                        ext_116285 = ext_116226;
                    }
                    
                    int64_t ext_116286;
                    
                    if (cond_116282) {
                        ext_116286 = m_33388;
                    } else {
                        ext_116286 = ext_116227;
                    }
                    if (cond_116282) {
                        for (int64_t i_116299 = 0; i_116299 < m_33388; i_116299++) {
                            double eta_p_116303 = ((double *) mem_113445.mem)[i_116299];
                            double eta_p_116304 = ((double *) ext_mem_115908.mem)[i_116299];
                            bool zgze_res_116306 = exp_absorb_cutoff_33394 <= eta_p_116303;
                            bool zl_res_116307 = eta_p_116303 < zs_res_107134;
                            bool x_116308 = !zgze_res_116306;
                            bool y_116309 = zl_res_116307 && x_116308;
                            bool cond_116310 = zgze_res_116306 || y_116309;
                            int64_t binop_y_116311 = i_116299 * ext_116227;
                            int64_t lmad_ext_116312 = ext_116225 + binop_y_116311;
                            int64_t ext_116313;
                            
                            if (cond_116310) {
                                ext_116313 = (int64_t) 0;
                            } else {
                                ext_116313 = lmad_ext_116312;
                            }
                            
                            int64_t ext_116314;
                            
                            if (cond_116310) {
                                ext_116314 = (int64_t) 1;
                            } else {
                                ext_116314 = ext_116226;
                            }
                            
                            double rescale_res_116316;
                            double rescale_res_116317;
                            
                            if (cond_116310) {
                                double log_res_116319 = futrts_log64(eta_p_116303);
                                double sqrt_res_116320 = futrts_sqrt64(eta_p_116303);
                                double zs_res_116321 = log_res_116319 / 2.0;
                                double zp_res_116322 = eta_p_116304 + zs_res_116321;
                                
                                for (int64_t i_116325 = 0; i_116325 < m_33388; i_116325++) {
                                    double eta_p_116327 = ((double *) ext_mem_116230.mem)[ext_116225 + (i_116325 * ext_116226 + i_116299 * ext_116227)];
                                    double zt_res_116328 = sqrt_res_116320 * eta_p_116327;
                                    
                                    ((double *) mem_113528.mem)[i_116325] = zt_res_116328;
                                }
                                if (memblock_set(ctx, &ext_mem_116315, &mem_113528, "mem_113528") != 0)
                                    return 1;
                                rescale_res_116316 = sqrt_res_116320;
                                rescale_res_116317 = zp_res_116322;
                            } else {
                                if (memblock_set(ctx, &ext_mem_116315, &ext_mem_116230, "ext_mem_116230") != 0)
                                    return 1;
                                rescale_res_116316 = eta_p_116303;
                                rescale_res_116317 = eta_p_116304;
                            }
                            ((double *) mem_113511.mem)[i_116299] = rescale_res_116316;
                            ((double *) mem_113513.mem)[i_116299] = rescale_res_116317;
                            lmad_copy_8b(ctx, 1, (uint64_t *) mem_113516.mem, i_116299 * m_33388, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_116315.mem, ext_116313, (int64_t []) {ext_116314}, (int64_t []) {m_33388});
                            if (memblock_unref(ctx, &ext_mem_116315, "ext_mem_116315") != 0)
                                return 1;
                        }
                        if (memblock_set(ctx, &ext_mem_116287, &mem_113511, "mem_113511") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_116288, &mem_113513, "mem_113513") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_116289, &mem_113516, "mem_113516") != 0)
                            return 1;
                    } else {
                        if (memblock_set(ctx, &ext_mem_116287, &mem_113445, "mem_113445") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_116288, &ext_mem_115908, "ext_mem_115908") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_116289, &ext_mem_116230, "ext_mem_116230") != 0)
                            return 1;
                    }
                    if (memblock_unref(ctx, &ext_mem_116230, "ext_mem_116230") != 0)
                        return 1;
                    
                    bool defunc_0_reduce_res_116334;
                    bool redout_116336 = 1;
                    
                    for (int64_t i_116335 = 0; i_116335 < m_33388; i_116335++) {
                        double eta_p_116337 = ((double *) ext_mem_116228.mem)[i_116335];
                        bool isnan_res_116338 = futrts_isnan64(eta_p_116337);
                        bool not_res_116339 = !isnan_res_116338;
                        bool x_116340 = not_res_116339 && redout_116336;
                        bool redout_tmp_117642 = x_116340;
                        
                        redout_116336 = redout_tmp_117642;
                    }
                    defunc_0_reduce_res_116334 = redout_116336;
                    
                    bool defunc_0_reduce_comm_res_116341;
                    
                    if (defunc_0_reduce_res_116334) {
                        bool x_116342;
                        bool redout_116344 = 0;
                        
                        for (int64_t i_116343 = 0; i_116343 < m_33388; i_116343++) {
                            double eta_p_116345 = ((double *) ext_mem_116228.mem)[i_116343];
                            double eta_p_116346 = ((double *) ext_mem_115906.mem)[i_116343];
                            double zt_res_116347 = eta_p_116345 * zp_res_108112;
                            bool zgze_res_116348 = eta_p_116346 <= zt_res_116347;
                            double zt_res_116349 = eta_p_116346 * zp_res_108112;
                            bool zgze_res_116350 = eta_p_116345 <= zt_res_116349;
                            bool x_116351 = zgze_res_116348 && zgze_res_116350;
                            bool not_res_116352 = !x_116351;
                            bool defunc_0_op_res_116353 = not_res_116352 || redout_116344;
                            bool redout_tmp_117643 = defunc_0_op_res_116353;
                            
                            redout_116344 = redout_tmp_117643;
                        }
                        x_116342 = redout_116344;
                        defunc_0_reduce_comm_res_116341 = x_116342;
                    } else {
                        defunc_0_reduce_comm_res_116341 = 0;
                    }
                    
                    bool x_116354 = defunc_0_reduce_comm_res_116341 && defunc_0_reduce_res_116334;
                    int64_t ext_116360;
                    int64_t ext_116361;
                    int64_t ext_116362;
                    bool algo5_core_loop_res_f_res_116363;
                    int64_t ctx_param_ext_116374;
                    int64_t ctx_param_ext_116375;
                    int64_t ctx_param_ext_116376;
                    bool loop_while_116377;
                    
                    if (memblock_set(ctx, &mem_param_116369, &ext_mem_116289, "ext_mem_116289") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_116370, &ext_mem_116228, "ext_mem_116228") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_116371, &ext_mem_116287, "ext_mem_116287") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_116372, &ext_mem_116229, "ext_mem_116229") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_116373, &ext_mem_116288, "ext_mem_116288") != 0)
                        return 1;
                    ctx_param_ext_116374 = ext_116284;
                    ctx_param_ext_116375 = ext_116285;
                    ctx_param_ext_116376 = ext_116286;
                    loop_while_116377 = x_116354;
                    while (loop_while_116377) {
                        if (memblock_alloc(ctx, &mem_116383, bytes_111715, "mem_116383")) {
                            err = 1;
                            goto cleanup;
                        }
                        
                        bool defunc_0_reduce_res_116385;
                        bool redout_116388 = 0;
                        
                        for (int64_t i_116387 = 0; i_116387 < m_33388; i_116387++) {
                            double eta_p_116390 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_70084 * m_33388 + i_116387];
                            double eta_p_116391 = ((double *) mem_param_116373.mem)[i_116387];
                            double defunc_0_reduce_res_116392;
                            double redout_116394 = 0.0;
                            
                            for (int64_t i_116393 = 0; i_116393 < m_33388; i_116393++) {
                                double eta_p_116395 = ((double *) mem_param_116370.mem)[i_116393];
                                double eta_p_116396 = ((double *) mem_param_116369.mem)[ctx_param_ext_116374 + (i_116393 * ctx_param_ext_116375 + i_116387 * ctx_param_ext_116376)];
                                double zt_res_116397 = eta_p_116395 * eta_p_116396;
                                double zp_res_116398 = zt_res_116397 + redout_116394;
                                double redout_tmp_117660 = zp_res_116398;
                                
                                redout_116394 = redout_tmp_117660;
                            }
                            defunc_0_reduce_res_116392 = redout_116394;
                            
                            double zs_res_116399 = defunc_0_reduce_res_116392 / eta_p_116390;
                            double ztzt_res_116400 = fpow64(zs_res_116399, zs_res_44883);
                            double zt_res_116401 = zs_res_44885 * eta_p_116391;
                            double exp_res_116402 = futrts_exp64(zt_res_116401);
                            double zt_res_116403 = ztzt_res_116400 * exp_res_116402;
                            bool zgze_res_116404 = exp_absorb_cutoff_33394 <= zt_res_116403;
                            bool defunc_0_op_res_116405 = zgze_res_116404 || redout_116388;
                            
                            ((double *) mem_116383.mem)[i_116387] = zt_res_116403;
                            
                            bool redout_tmp_117658 = defunc_0_op_res_116405;
                            
                            redout_116388 = redout_tmp_117658;
                        }
                        defunc_0_reduce_res_116385 = redout_116388;
                        if (memblock_alloc(ctx, &mem_116407, bytes_111715, "mem_116407")) {
                            err = 1;
                            goto cleanup;
                        }
                        
                        bool defunc_0_reduce_res_116409;
                        bool redout_116412 = 0;
                        
                        for (int64_t i_116411 = 0; i_116411 < m_33388; i_116411++) {
                            double eta_p_116414 = ((double *) distrs_mem_111708.mem)[eta_p_70073 * m_33388 + i_116411];
                            double eta_p_116415 = ((double *) mem_param_116372.mem)[i_116411];
                            double defunc_0_reduce_res_116416;
                            double redout_116418 = 0.0;
                            
                            for (int64_t i_116417 = 0; i_116417 < m_33388; i_116417++) {
                                double eta_p_116419 = ((double *) mem_116383.mem)[i_116417];
                                double eta_p_116420 = ((double *) mem_param_116369.mem)[ctx_param_ext_116374 + (i_116411 * ctx_param_ext_116375 + i_116417 * ctx_param_ext_116376)];
                                double zt_res_116421 = eta_p_116419 * eta_p_116420;
                                double zp_res_116422 = zt_res_116421 + redout_116418;
                                double redout_tmp_117663 = zp_res_116422;
                                
                                redout_116418 = redout_tmp_117663;
                            }
                            defunc_0_reduce_res_116416 = redout_116418;
                            
                            double zs_res_116423 = defunc_0_reduce_res_116416 / eta_p_116414;
                            double ztzt_res_116424 = fpow64(zs_res_116423, zs_res_44842);
                            double zt_res_116425 = zs_res_44844 * eta_p_116415;
                            double exp_res_116426 = futrts_exp64(zt_res_116425);
                            double zt_res_116427 = ztzt_res_116424 * exp_res_116426;
                            bool zgze_res_116428 = exp_absorb_cutoff_33394 <= zt_res_116427;
                            bool defunc_0_op_res_116429 = zgze_res_116428 || redout_116412;
                            
                            ((double *) mem_116407.mem)[i_116411] = zt_res_116427;
                            
                            bool redout_tmp_117661 = defunc_0_op_res_116429;
                            
                            redout_116412 = redout_tmp_117661;
                        }
                        defunc_0_reduce_res_116409 = redout_116412;
                        
                        bool x_116431 = !defunc_0_reduce_res_116409;
                        bool defunc_0_reduce_res_116432;
                        
                        if (x_116431) {
                            bool x_116433;
                            bool redout_116435 = 0;
                            
                            for (int64_t i_116434 = 0; i_116434 < m_33388; i_116434++) {
                                double eta_p_116436 = ((double *) mem_116407.mem)[i_116434];
                                bool zlze_res_116437 = eta_p_116436 <= zs_res_107134;
                                bool defunc_0_op_res_116438 = zlze_res_116437 || redout_116435;
                                bool redout_tmp_117664 = defunc_0_op_res_116438;
                                
                                redout_116435 = redout_tmp_117664;
                            }
                            x_116433 = redout_116435;
                            defunc_0_reduce_res_116432 = x_116433;
                        } else {
                            defunc_0_reduce_res_116432 = 0;
                        }
                        
                        bool cond_116439 = defunc_0_reduce_res_116432 || defunc_0_reduce_res_116409;
                        int64_t ext_116440;
                        
                        if (cond_116439) {
                            ext_116440 = (int64_t) 0;
                        } else {
                            ext_116440 = ctx_param_ext_116374;
                        }
                        
                        int64_t ext_116441;
                        
                        if (cond_116439) {
                            ext_116441 = m_33388;
                        } else {
                            ext_116441 = ctx_param_ext_116375;
                        }
                        
                        int64_t ext_116442;
                        
                        if (cond_116439) {
                            ext_116442 = (int64_t) 1;
                        } else {
                            ext_116442 = ctx_param_ext_116376;
                        }
                        if (memblock_alloc(ctx, &mem_116443, bytes_111715, "mem_116443")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (memblock_alloc(ctx, &mem_116444, bytes_111715, "mem_116444")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (memblock_alloc(ctx, &mem_116445, bytes_111743, "mem_116445")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (cond_116439) {
                            double zs_res_116452 = 1.0 / exp_absorb_cutoff_33394;
                            
                            for (int64_t i_116459 = 0; i_116459 < m_33388; i_116459++) {
                                double eta_p_116463 = ((double *) mem_116407.mem)[i_116459];
                                double eta_p_116464 = ((double *) mem_param_116372.mem)[i_116459];
                                bool zgze_res_116466 = exp_absorb_cutoff_33394 <= eta_p_116463;
                                bool zl_res_116467 = eta_p_116463 < zs_res_116452;
                                bool x_116468 = !zgze_res_116466;
                                bool y_116469 = zl_res_116467 && x_116468;
                                bool cond_116470 = zgze_res_116466 || y_116469;
                                int64_t binop_y_116471 = i_116459 * ctx_param_ext_116375;
                                int64_t lmad_ext_116472 = ctx_param_ext_116374 + binop_y_116471;
                                int64_t ext_116473;
                                
                                if (cond_116470) {
                                    ext_116473 = (int64_t) 0;
                                } else {
                                    ext_116473 = lmad_ext_116472;
                                }
                                
                                int64_t ext_116474;
                                
                                if (cond_116470) {
                                    ext_116474 = (int64_t) 1;
                                } else {
                                    ext_116474 = ctx_param_ext_116376;
                                }
                                
                                double rescale_res_116476;
                                double rescale_res_116477;
                                
                                if (cond_116470) {
                                    double log_res_116479 = futrts_log64(eta_p_116463);
                                    double sqrt_res_116480 = futrts_sqrt64(eta_p_116463);
                                    double zs_res_116481 = log_res_116479 / 2.0;
                                    double zp_res_116482 = eta_p_116464 + zs_res_116481;
                                    
                                    for (int64_t i_116485 = 0; i_116485 < m_33388; i_116485++) {
                                        double eta_p_116487 = ((double *) mem_param_116369.mem)[ctx_param_ext_116374 + (i_116459 * ctx_param_ext_116375 + i_116485 * ctx_param_ext_116376)];
                                        double zt_res_116488 = sqrt_res_116480 * eta_p_116487;
                                        
                                        ((double *) mem_113610.mem)[i_116485] = zt_res_116488;
                                    }
                                    if (memblock_set(ctx, &ext_mem_116475, &mem_113610, "mem_113610") != 0)
                                        return 1;
                                    rescale_res_116476 = sqrt_res_116480;
                                    rescale_res_116477 = zp_res_116482;
                                } else {
                                    if (memblock_set(ctx, &ext_mem_116475, &mem_param_116369, "mem_param_116369") != 0)
                                        return 1;
                                    rescale_res_116476 = eta_p_116463;
                                    rescale_res_116477 = eta_p_116464;
                                }
                                ((double *) mem_116443.mem)[i_116459] = rescale_res_116476;
                                ((double *) mem_116444.mem)[i_116459] = rescale_res_116477;
                                lmad_copy_8b(ctx, 1, (uint64_t *) mem_116445.mem, i_116459 * m_33388, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_116475.mem, ext_116473, (int64_t []) {ext_116474}, (int64_t []) {m_33388});
                                if (memblock_unref(ctx, &ext_mem_116475, "ext_mem_116475") != 0)
                                    return 1;
                            }
                            if (memblock_set(ctx, &ext_mem_116446, &mem_116443, "mem_116443") != 0)
                                return 1;
                            if (memblock_set(ctx, &ext_mem_116447, &mem_116444, "mem_116444") != 0)
                                return 1;
                            if (memblock_set(ctx, &ext_mem_116448, &mem_116445, "mem_116445") != 0)
                                return 1;
                        } else {
                            if (memblock_set(ctx, &ext_mem_116446, &mem_116407, "mem_116407") != 0)
                                return 1;
                            if (memblock_set(ctx, &ext_mem_116447, &mem_param_116372, "mem_param_116372") != 0)
                                return 1;
                            if (memblock_set(ctx, &ext_mem_116448, &mem_param_116369, "mem_param_116369") != 0)
                                return 1;
                        }
                        if (memblock_unref(ctx, &mem_116407, "mem_116407") != 0)
                            return 1;
                        if (memblock_unref(ctx, &mem_116443, "mem_116443") != 0)
                            return 1;
                        if (memblock_unref(ctx, &mem_116444, "mem_116444") != 0)
                            return 1;
                        if (memblock_unref(ctx, &mem_116445, "mem_116445") != 0)
                            return 1;
                        
                        bool x_116493 = !defunc_0_reduce_res_116385;
                        bool defunc_0_reduce_res_116494;
                        
                        if (x_116493) {
                            bool x_116495;
                            bool redout_116497 = 0;
                            
                            for (int64_t i_116496 = 0; i_116496 < m_33388; i_116496++) {
                                double eta_p_116498 = ((double *) mem_116383.mem)[i_116496];
                                bool zlze_res_116499 = eta_p_116498 <= zs_res_107134;
                                bool defunc_0_op_res_116500 = zlze_res_116499 || redout_116497;
                                bool redout_tmp_117669 = defunc_0_op_res_116500;
                                
                                redout_116497 = redout_tmp_117669;
                            }
                            x_116495 = redout_116497;
                            defunc_0_reduce_res_116494 = x_116495;
                        } else {
                            defunc_0_reduce_res_116494 = 0;
                        }
                        
                        bool cond_116501 = defunc_0_reduce_res_116494 || defunc_0_reduce_res_116385;
                        int64_t ext_116503;
                        
                        if (cond_116501) {
                            ext_116503 = (int64_t) 0;
                        } else {
                            ext_116503 = ext_116440;
                        }
                        
                        int64_t ext_116504;
                        
                        if (cond_116501) {
                            ext_116504 = (int64_t) 1;
                        } else {
                            ext_116504 = ext_116441;
                        }
                        
                        int64_t ext_116505;
                        
                        if (cond_116501) {
                            ext_116505 = m_33388;
                        } else {
                            ext_116505 = ext_116442;
                        }
                        if (memblock_alloc(ctx, &mem_116506, bytes_111715, "mem_116506")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (memblock_alloc(ctx, &mem_116507, bytes_111715, "mem_116507")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (memblock_alloc(ctx, &mem_116508, bytes_111743, "mem_116508")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (cond_116501) {
                            double zs_res_116515 = 1.0 / exp_absorb_cutoff_33394;
                            
                            for (int64_t i_116522 = 0; i_116522 < m_33388; i_116522++) {
                                double eta_p_116526 = ((double *) mem_116383.mem)[i_116522];
                                double eta_p_116527 = ((double *) mem_param_116373.mem)[i_116522];
                                bool zgze_res_116529 = exp_absorb_cutoff_33394 <= eta_p_116526;
                                bool zl_res_116530 = eta_p_116526 < zs_res_116515;
                                bool x_116531 = !zgze_res_116529;
                                bool y_116532 = zl_res_116530 && x_116531;
                                bool cond_116533 = zgze_res_116529 || y_116532;
                                int64_t binop_y_116534 = i_116522 * ext_116442;
                                int64_t lmad_ext_116535 = ext_116440 + binop_y_116534;
                                int64_t ext_116536;
                                
                                if (cond_116533) {
                                    ext_116536 = (int64_t) 0;
                                } else {
                                    ext_116536 = lmad_ext_116535;
                                }
                                
                                int64_t ext_116537;
                                
                                if (cond_116533) {
                                    ext_116537 = (int64_t) 1;
                                } else {
                                    ext_116537 = ext_116441;
                                }
                                
                                double rescale_res_116539;
                                double rescale_res_116540;
                                
                                if (cond_116533) {
                                    double log_res_116542 = futrts_log64(eta_p_116526);
                                    double sqrt_res_116543 = futrts_sqrt64(eta_p_116526);
                                    double zs_res_116544 = log_res_116542 / 2.0;
                                    double zp_res_116545 = eta_p_116527 + zs_res_116544;
                                    
                                    for (int64_t i_116548 = 0; i_116548 < m_33388; i_116548++) {
                                        double eta_p_116550 = ((double *) ext_mem_116448.mem)[ext_116440 + (i_116548 * ext_116441 + i_116522 * ext_116442)];
                                        double zt_res_116551 = sqrt_res_116543 * eta_p_116550;
                                        
                                        ((double *) mem_113660.mem)[i_116548] = zt_res_116551;
                                    }
                                    if (memblock_set(ctx, &ext_mem_116538, &mem_113660, "mem_113660") != 0)
                                        return 1;
                                    rescale_res_116539 = sqrt_res_116543;
                                    rescale_res_116540 = zp_res_116545;
                                } else {
                                    if (memblock_set(ctx, &ext_mem_116538, &ext_mem_116448, "ext_mem_116448") != 0)
                                        return 1;
                                    rescale_res_116539 = eta_p_116526;
                                    rescale_res_116540 = eta_p_116527;
                                }
                                ((double *) mem_116506.mem)[i_116522] = rescale_res_116539;
                                ((double *) mem_116507.mem)[i_116522] = rescale_res_116540;
                                lmad_copy_8b(ctx, 1, (uint64_t *) mem_116508.mem, i_116522 * m_33388, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_116538.mem, ext_116536, (int64_t []) {ext_116537}, (int64_t []) {m_33388});
                                if (memblock_unref(ctx, &ext_mem_116538, "ext_mem_116538") != 0)
                                    return 1;
                            }
                            if (memblock_set(ctx, &ext_mem_116509, &mem_116506, "mem_116506") != 0)
                                return 1;
                            if (memblock_set(ctx, &ext_mem_116510, &mem_116507, "mem_116507") != 0)
                                return 1;
                            if (memblock_set(ctx, &ext_mem_116511, &mem_116508, "mem_116508") != 0)
                                return 1;
                        } else {
                            if (memblock_set(ctx, &ext_mem_116509, &mem_116383, "mem_116383") != 0)
                                return 1;
                            if (memblock_set(ctx, &ext_mem_116510, &mem_param_116373, "mem_param_116373") != 0)
                                return 1;
                            if (memblock_set(ctx, &ext_mem_116511, &ext_mem_116448, "ext_mem_116448") != 0)
                                return 1;
                        }
                        if (memblock_unref(ctx, &mem_116383, "mem_116383") != 0)
                            return 1;
                        if (memblock_unref(ctx, &ext_mem_116448, "ext_mem_116448") != 0)
                            return 1;
                        if (memblock_unref(ctx, &mem_116506, "mem_116506") != 0)
                            return 1;
                        if (memblock_unref(ctx, &mem_116507, "mem_116507") != 0)
                            return 1;
                        if (memblock_unref(ctx, &mem_116508, "mem_116508") != 0)
                            return 1;
                        
                        bool defunc_0_reduce_res_116557;
                        bool redout_116559 = 1;
                        
                        for (int64_t i_116558 = 0; i_116558 < m_33388; i_116558++) {
                            double eta_p_116560 = ((double *) ext_mem_116446.mem)[i_116558];
                            bool isnan_res_116561 = futrts_isnan64(eta_p_116560);
                            bool not_res_116562 = !isnan_res_116561;
                            bool x_116563 = not_res_116562 && redout_116559;
                            bool redout_tmp_117674 = x_116563;
                            
                            redout_116559 = redout_tmp_117674;
                        }
                        defunc_0_reduce_res_116557 = redout_116559;
                        
                        bool loop_cond_116564;
                        
                        if (defunc_0_reduce_res_116557) {
                            double zp_res_116565 = 1.0 + tol_sinkhorn_33396;
                            bool defunc_0_reduce_comm_res_116566;
                            bool redout_116568 = 0;
                            
                            for (int64_t i_116567 = 0; i_116567 < m_33388; i_116567++) {
                                double eta_p_116569 = ((double *) ext_mem_116446.mem)[i_116567];
                                double eta_p_116570 = ((double *) mem_param_116370.mem)[i_116567];
                                double zt_res_116571 = zp_res_116565 * eta_p_116569;
                                bool zgze_res_116572 = eta_p_116570 <= zt_res_116571;
                                double zt_res_116573 = zp_res_116565 * eta_p_116570;
                                bool zgze_res_116574 = eta_p_116569 <= zt_res_116573;
                                bool x_116575 = zgze_res_116572 && zgze_res_116574;
                                bool not_res_116576 = !x_116575;
                                bool defunc_0_op_res_116577 = not_res_116576 || redout_116568;
                                bool redout_tmp_117675 = defunc_0_op_res_116577;
                                
                                redout_116568 = redout_tmp_117675;
                            }
                            defunc_0_reduce_comm_res_116566 = redout_116568;
                            loop_cond_116564 = defunc_0_reduce_comm_res_116566;
                        } else {
                            loop_cond_116564 = 0;
                        }
                        if (memblock_set(ctx, &mem_param_tmp_117644, &ext_mem_116511, "ext_mem_116511") != 0)
                            return 1;
                        if (memblock_set(ctx, &mem_param_tmp_117645, &ext_mem_116446, "ext_mem_116446") != 0)
                            return 1;
                        if (memblock_set(ctx, &mem_param_tmp_117646, &ext_mem_116509, "ext_mem_116509") != 0)
                            return 1;
                        if (memblock_set(ctx, &mem_param_tmp_117647, &ext_mem_116447, "ext_mem_116447") != 0)
                            return 1;
                        if (memblock_set(ctx, &mem_param_tmp_117648, &ext_mem_116510, "ext_mem_116510") != 0)
                            return 1;
                        
                        int64_t ctx_param_ext_tmp_117649 = ext_116503;
                        int64_t ctx_param_ext_tmp_117650 = ext_116504;
                        int64_t ctx_param_ext_tmp_117651 = ext_116505;
                        bool loop_while_tmp_117652 = loop_cond_116564;
                        
                        if (memblock_set(ctx, &mem_param_116369, &mem_param_tmp_117644, "mem_param_tmp_117644") != 0)
                            return 1;
                        if (memblock_set(ctx, &mem_param_116370, &mem_param_tmp_117645, "mem_param_tmp_117645") != 0)
                            return 1;
                        if (memblock_set(ctx, &mem_param_116371, &mem_param_tmp_117646, "mem_param_tmp_117646") != 0)
                            return 1;
                        if (memblock_set(ctx, &mem_param_116372, &mem_param_tmp_117647, "mem_param_tmp_117647") != 0)
                            return 1;
                        if (memblock_set(ctx, &mem_param_116373, &mem_param_tmp_117648, "mem_param_tmp_117648") != 0)
                            return 1;
                        ctx_param_ext_116374 = ctx_param_ext_tmp_117649;
                        ctx_param_ext_116375 = ctx_param_ext_tmp_117650;
                        ctx_param_ext_116376 = ctx_param_ext_tmp_117651;
                        loop_while_116377 = loop_while_tmp_117652;
                    }
                    if (memblock_set(ctx, &ext_mem_116355, &mem_param_116369, "mem_param_116369") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_116356, &mem_param_116370, "mem_param_116370") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_116357, &mem_param_116371, "mem_param_116371") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_116358, &mem_param_116372, "mem_param_116372") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_116359, &mem_param_116373, "mem_param_116373") != 0)
                        return 1;
                    ext_116360 = ctx_param_ext_116374;
                    ext_116361 = ctx_param_ext_116375;
                    ext_116362 = ctx_param_ext_116376;
                    algo5_core_loop_res_f_res_116363 = loop_while_116377;
                    if (memblock_unref(ctx, &ext_mem_116228, "ext_mem_116228") != 0)
                        return 1;
                    if (memblock_unref(ctx, &ext_mem_116229, "ext_mem_116229") != 0)
                        return 1;
                    if (memblock_unref(ctx, &ext_mem_116287, "ext_mem_116287") != 0)
                        return 1;
                    if (memblock_unref(ctx, &ext_mem_116288, "ext_mem_116288") != 0)
                        return 1;
                    if (memblock_unref(ctx, &ext_mem_116289, "ext_mem_116289") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_116157, &ext_mem_116355, "ext_mem_116355") != 0)
                        return 1;
                    ext_116158 = ext_116360;
                    ext_116159 = ext_116361;
                    ext_116160 = ext_116362;
                    if (memblock_set(ctx, &ext_mem_116161, &ext_mem_116356, "ext_mem_116356") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_116162, &ext_mem_116357, "ext_mem_116357") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_116163, &ext_mem_116358, "ext_mem_116358") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_116164, &ext_mem_116359, "ext_mem_116359") != 0)
                        return 1;
                }
                if (memblock_unref(ctx, &ext_mem_115905, "ext_mem_115905") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_115906, "ext_mem_115906") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_115907, "ext_mem_115907") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_115908, "ext_mem_115908") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_115909, "ext_mem_115909") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_115910, "ext_mem_115910") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_115911, "ext_mem_115911") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_115912, "ext_mem_115912") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_115913, "ext_mem_115913") != 0)
                    return 1;
                if (memblock_alloc(ctx, &mem_116578, bytes_111715, "mem_116578")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_116581, bytes_111715, "mem_116581")) {
                    err = 1;
                    goto cleanup;
                }
                
                double defunc_res_116583;
                double redout_116588 = 0.0;
                
                for (int64_t i_116587 = 0; i_116587 < m_33388; i_116587++) {
                    double eta_p_116592 = ((double *) ext_mem_116162.mem)[i_116587];
                    double eta_p_116593 = ((double *) ext_mem_116164.mem)[i_116587];
                    double eta_p_116594 = ((double *) ext_mem_116161.mem)[i_116587];
                    double eta_p_116595 = ((double *) ext_mem_116163.mem)[i_116587];
                    double log_res_116596 = futrts_log64(eta_p_116594);
                    double zp_res_116597 = eta_p_116595 + log_res_116596;
                    double defunc_res_116599;
                    double redout_116602 = 0.0;
                    
                    for (int64_t i_116601 = 0; i_116601 < m_33388; i_116601++) {
                        double eta_p_116604 = ((double *) ext_mem_116157.mem)[ext_116158 + (i_116587 * ext_116159 + i_116601 * ext_116160)];
                        double eta_p_wasfree_116605 = ((double *) ext_mem_116162.mem)[i_116601];
                        double zt_res_116606 = eta_p_116594 * eta_p_116604;
                        double zt_res_116607 = eta_p_wasfree_116605 * zt_res_116606;
                        double zp_res_116608 = zt_res_116607 + redout_116602;
                        
                        ((double *) mem_113728)[i_116587 * m_33388 + i_116601] = zt_res_116607;
                        
                        double redout_tmp_117680 = zp_res_116608;
                        
                        redout_116602 = redout_tmp_117680;
                    }
                    defunc_res_116599 = redout_116602;
                    
                    double log_res_116610 = futrts_log64(eta_p_116592);
                    double zp_res_116611 = eta_p_116593 + log_res_116610;
                    double zp_res_116612 = defunc_res_116599 + redout_116588;
                    
                    ((double *) mem_116578.mem)[i_116587] = zp_res_116611;
                    ((double *) mem_116581.mem)[i_116587] = zp_res_116597;
                    
                    double redout_tmp_117676 = zp_res_116612;
                    
                    redout_116588 = redout_tmp_117676;
                }
                defunc_res_116583 = redout_116588;
                if (memblock_unref(ctx, &ext_mem_116157, "ext_mem_116157") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_116161, "ext_mem_116161") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_116162, "ext_mem_116162") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_116163, "ext_mem_116163") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_116164, "ext_mem_116164") != 0)
                    return 1;
                
                bool zg_res_116616 = 0.0 < defunc_res_116583;
                double zs_res_116617 = defunc_res_115542 / defunc_res_116583;
                double sqrt_res_116618 = futrts_sqrt64(zs_res_116617);
                
                if (memblock_alloc(ctx, &mem_116619, bytes_111715, "mem_116619")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_116620, bytes_111743, "mem_116620")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_116621, bytes_111743, "mem_116621")) {
                    err = 1;
                    goto cleanup;
                }
                
                double descent_res_116628;
                
                if (zg_res_116616) {
                    double defunc_res_116632;
                    double defunc_res_116633;
                    double defunc_res_116634;
                    double redout_116639;
                    double redout_116640;
                    double redout_116641;
                    
                    redout_116639 = 0.0;
                    redout_116640 = 0.0;
                    redout_116641 = 0.0;
                    for (int64_t i_116638 = 0; i_116638 < m_33388; i_116638++) {
                        double x_116645 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_70084 * m_33388 + i_116638];
                        double log_res_116646 = futrts_log64(x_116645);
                        double defunc_res_116647;
                        double defunc_res_116648;
                        double defunc_res_116649;
                        double redout_116651;
                        double redout_116652;
                        double redout_116653;
                        
                        redout_116651 = 0.0;
                        redout_116652 = 0.0;
                        redout_116653 = 0.0;
                        for (int64_t i_116650 = 0; i_116650 < m_33388; i_116650++) {
                            double x_116654 = ((double *) mem_param_115532.mem)[i_116650 * m_33388 + i_116638];
                            double zp_res_116655 = x_116654 + redout_116651;
                            double zp_res_116656 = x_116654 + redout_116652;
                            double zp_res_116657 = x_116654 + redout_116653;
                            double redout_tmp_117688 = zp_res_116655;
                            double redout_tmp_117689 = zp_res_116656;
                            double redout_tmp_117690 = zp_res_116657;
                            
                            redout_116651 = redout_tmp_117688;
                            redout_116652 = redout_tmp_117689;
                            redout_116653 = redout_tmp_117690;
                        }
                        defunc_res_116647 = redout_116651;
                        defunc_res_116648 = redout_116652;
                        defunc_res_116649 = redout_116653;
                        
                        bool zeze_res_116658 = defunc_res_116647 == 0.0;
                        double klu_res_116659;
                        
                        if (zeze_res_116658) {
                            klu_res_116659 = 0.0;
                        } else {
                            double zs_res_116660 = defunc_res_116647 / x_116645;
                            double log_res_116661 = futrts_log64(zs_res_116660);
                            double zt_res_116662 = defunc_res_116647 * log_res_116661;
                            
                            klu_res_116659 = zt_res_116662;
                        }
                        
                        double zp_res_116663 = klu_res_116659 + redout_116639;
                        double zp_res_116664 = x_116645 + redout_116640;
                        double zp_res_116665 = defunc_res_116649 + redout_116641;
                        
                        ((double *) mem_113765)[i_116638] = defunc_res_116648;
                        ((double *) mem_113767)[i_116638] = defunc_res_116647;
                        ((double *) mem_113769)[i_116638] = log_res_116646;
                        
                        double redout_tmp_117682 = zp_res_116663;
                        double redout_tmp_117683 = zp_res_116664;
                        double redout_tmp_117684 = zp_res_116665;
                        
                        redout_116639 = redout_tmp_117682;
                        redout_116640 = redout_tmp_117683;
                        redout_116641 = redout_tmp_117684;
                    }
                    defunc_res_116632 = redout_116639;
                    defunc_res_116633 = redout_116640;
                    defunc_res_116634 = redout_116641;
                    
                    double zm_res_116669 = defunc_res_116632 - defunc_res_116634;
                    double zt_res_116670 = 2.0 * zm_res_116669;
                    double zt_res_116671 = 2.0 * defunc_res_116634;
                    
                    for (int64_t i_116674 = 0; i_116674 < m_33388; i_116674++) {
                        double eta_p_116676 = ((double *) mem_113767)[i_116674];
                        double eta_p_116677 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_70084 * m_33388 + i_116674];
                        double log_res_116678 = futrts_log64(eta_p_116676);
                        double log_res_116679 = futrts_log64(eta_p_116677);
                        double zm_res_116680 = log_res_116678 - log_res_116679;
                        double zp_res_116681 = 1.0 + zm_res_116680;
                        double fma_res_116682 = futrts_fma64(zt_res_116671, zp_res_116681, zt_res_116670);
                        
                        for (int64_t nest_i_117692 = 0; nest_i_117692 < m_33388; nest_i_117692++) {
                            ((double *) mem_113790)[i_116674 * m_33388 + nest_i_117692] = fma_res_116682;
                        }
                    }
                    
                    double defunc_res_116687;
                    double defunc_res_116688;
                    double defunc_res_116689;
                    double defunc_res_116690;
                    double redout_116694;
                    double redout_116695;
                    double redout_116696;
                    double redout_116697;
                    
                    redout_116694 = 0.0;
                    redout_116695 = 0.0;
                    redout_116696 = 0.0;
                    redout_116697 = 0.0;
                    for (int64_t i_116693 = 0; i_116693 < m_33388; i_116693++) {
                        double eta_p_116700 = ((double *) distrs_mem_111708.mem)[eta_p_70073 * m_33388 + i_116693];
                        double defunc_res_116701;
                        double defunc_res_116702;
                        double defunc_res_116703;
                        double defunc_res_116704;
                        double defunc_res_116705;
                        double redout_116707;
                        double redout_116708;
                        double redout_116709;
                        double redout_116710;
                        double redout_116711;
                        
                        redout_116707 = 0.0;
                        redout_116708 = 0.0;
                        redout_116709 = 0.0;
                        redout_116710 = 0.0;
                        redout_116711 = 0.0;
                        for (int64_t i_116706 = 0; i_116706 < m_33388; i_116706++) {
                            double x_116712 = ((double *) mem_param_115532.mem)[i_116693 * m_33388 + i_116706];
                            double eta_p_116713 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_70084 * m_33388 + i_116706];
                            double zt_res_116714 = eta_p_116700 * eta_p_116713;
                            bool zeze_res_116715 = x_116712 == 0.0;
                            double klu_res_116716;
                            
                            if (zeze_res_116715) {
                                klu_res_116716 = 0.0;
                            } else {
                                double zs_res_116717 = x_116712 / zt_res_116714;
                                double log_res_116718 = futrts_log64(zs_res_116717);
                                double zt_res_116719 = x_116712 * log_res_116718;
                                
                                klu_res_116716 = zt_res_116719;
                            }
                            
                            double zp_res_116720 = x_116712 + redout_116707;
                            double zp_res_116721 = klu_res_116716 + redout_116708;
                            double zp_res_116722 = x_116712 + redout_116709;
                            double zp_res_116723 = x_116712 + redout_116710;
                            double zp_res_116724 = x_116712 + redout_116711;
                            double redout_tmp_117699 = zp_res_116720;
                            double redout_tmp_117700 = zp_res_116721;
                            double redout_tmp_117701 = zp_res_116722;
                            double redout_tmp_117702 = zp_res_116723;
                            double redout_tmp_117703 = zp_res_116724;
                            
                            redout_116707 = redout_tmp_117699;
                            redout_116708 = redout_tmp_117700;
                            redout_116709 = redout_tmp_117701;
                            redout_116710 = redout_tmp_117702;
                            redout_116711 = redout_tmp_117703;
                        }
                        defunc_res_116701 = redout_116707;
                        defunc_res_116702 = redout_116708;
                        defunc_res_116703 = redout_116709;
                        defunc_res_116704 = redout_116710;
                        defunc_res_116705 = redout_116711;
                        
                        bool zeze_res_116725 = defunc_res_116705 == 0.0;
                        double klu_res_116726;
                        
                        if (zeze_res_116725) {
                            klu_res_116726 = 0.0;
                        } else {
                            double zs_res_116727 = defunc_res_116705 / eta_p_116700;
                            double log_res_116728 = futrts_log64(zs_res_116727);
                            double zt_res_116729 = defunc_res_116705 * log_res_116728;
                            
                            klu_res_116726 = zt_res_116729;
                        }
                        
                        double zp_res_116730 = defunc_res_116701 + redout_116694;
                        double zp_res_116731 = defunc_res_116702 + redout_116695;
                        double zp_res_116732 = defunc_res_116704 + redout_116696;
                        double zp_res_116733 = klu_res_116726 + redout_116697;
                        
                        ((double *) mem_113802)[i_116693] = defunc_res_116705;
                        ((double *) mem_113804)[i_116693] = defunc_res_116703;
                        
                        double redout_tmp_117693 = zp_res_116730;
                        double redout_tmp_117694 = zp_res_116731;
                        double redout_tmp_117695 = zp_res_116732;
                        double redout_tmp_117696 = zp_res_116733;
                        
                        redout_116694 = redout_tmp_117693;
                        redout_116695 = redout_tmp_117694;
                        redout_116696 = redout_tmp_117695;
                        redout_116697 = redout_tmp_117696;
                    }
                    defunc_res_116687 = redout_116694;
                    defunc_res_116688 = redout_116695;
                    defunc_res_116689 = redout_116696;
                    defunc_res_116690 = redout_116697;
                    
                    double zm_res_116736 = defunc_res_116690 - defunc_res_116689;
                    double zt_res_116737 = 2.0 * zm_res_116736;
                    double zt_res_116738 = 2.0 * defunc_res_116689;
                    
                    for (int64_t i_116741 = 0; i_116741 < m_33388; i_116741++) {
                        double defunc_0_reduce_res_116743;
                        double redout_116745 = 0.0;
                        
                        for (int64_t i_116744 = 0; i_116744 < m_33388; i_116744++) {
                            double eta_p_116746 = ((double *) A_mem_111707.mem)[lifted_lambda_res_70084 * (m_33388 * m_33388) + i_116741 * m_33388 + i_116744];
                            double eta_p_116747 = ((double *) mem_113765)[i_116744];
                            double zt_res_116748 = eta_p_116746 * eta_p_116746;
                            double zt_res_116749 = eta_p_116747 * zt_res_116748;
                            double zp_res_116750 = zt_res_116749 + redout_116745;
                            double redout_tmp_117705 = zp_res_116750;
                            
                            redout_116745 = redout_tmp_117705;
                        }
                        defunc_0_reduce_res_116743 = redout_116745;
                        ((double *) mem_113818)[i_116741] = defunc_0_reduce_res_116743;
                    }
                    
                    double zt_res_116752 = 2.0 * defunc_res_116687;
                    double zt_res_116753 = 2.0 * defunc_res_116688;
                    double defunc_res_116757;
                    double defunc_res_116758;
                    double defunc_res_116759;
                    double defunc_res_116760;
                    double defunc_res_116761;
                    double redout_116766;
                    double redout_116767;
                    double redout_116768;
                    double redout_116769;
                    double redout_116770;
                    
                    redout_116766 = 0.0;
                    redout_116767 = 0.0;
                    redout_116768 = 0.0;
                    redout_116769 = 0.0;
                    redout_116770 = 0.0;
                    for (int64_t i_116765 = 0; i_116765 < m_33388; i_116765++) {
                        double x_116774 = ((double *) distrs_mem_111708.mem)[eta_p_70073 * m_33388 + i_116765];
                        double eta_p_116775 = ((double *) mem_113802)[i_116765];
                        double log_res_116776 = futrts_log64(x_116774);
                        double log_res_116777 = futrts_log64(eta_p_116775);
                        double zm_res_116778 = log_res_116777 - log_res_116776;
                        double zp_res_116779 = 1.0 + zm_res_116778;
                        double fma_res_116780 = futrts_fma64(zt_res_116738, zp_res_116779, zt_res_116737);
                        
                        for (int64_t i_116783 = 0; i_116783 < m_33388; i_116783++) {
                            double defunc_0_reduce_res_116785;
                            double redout_116787 = 0.0;
                            
                            for (int64_t i_116786 = 0; i_116786 < m_33388; i_116786++) {
                                double eta_p_116788 = ((double *) A_mem_111707.mem)[eta_p_70073 * (m_33388 * m_33388) + i_116765 * m_33388 + i_116786];
                                double eta_p_116789 = ((double *) mem_param_115532.mem)[i_116786 * m_33388 + i_116783];
                                double zt_res_116790 = eta_p_116788 * eta_p_116789;
                                double zp_res_116791 = zt_res_116790 + redout_116787;
                                double redout_tmp_117715 = zp_res_116791;
                                
                                redout_116787 = redout_tmp_117715;
                            }
                            defunc_0_reduce_res_116785 = redout_116787;
                            ((double *) mem_113845)[i_116783] = defunc_0_reduce_res_116785;
                        }
                        
                        double defunc_0_reduce_res_116793;
                        double redout_116795 = 0.0;
                        
                        for (int64_t i_116794 = 0; i_116794 < m_33388; i_116794++) {
                            double eta_p_116796 = ((double *) A_mem_111707.mem)[eta_p_70073 * (m_33388 * m_33388) + i_116765 * m_33388 + i_116794];
                            double eta_p_116797 = ((double *) mem_113804)[i_116794];
                            double zt_res_116798 = eta_p_116796 * eta_p_116796;
                            double zt_res_116799 = eta_p_116797 * zt_res_116798;
                            double zp_res_116800 = zt_res_116799 + redout_116795;
                            double redout_tmp_117716 = zp_res_116800;
                            
                            redout_116795 = redout_tmp_117716;
                        }
                        defunc_0_reduce_res_116793 = redout_116795;
                        
                        double defunc_0_reduce_res_116803;
                        double defunc_res_116804;
                        double defunc_res_116805;
                        double defunc_res_116806;
                        double redout_116810;
                        double redout_116811;
                        double redout_116812;
                        double redout_116813;
                        
                        redout_116810 = 0.0;
                        redout_116811 = 0.0;
                        redout_116812 = 0.0;
                        redout_116813 = 0.0;
                        for (int64_t i_116809 = 0; i_116809 < m_33388; i_116809++) {
                            double eta_p_116816 = ((double *) mem_113728)[i_116765 * m_33388 + i_116809];
                            double eta_p_116817 = ((double *) mem_param_115532.mem)[i_116765 * m_33388 + i_116809];
                            double eta_p_116818 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_70084 * m_33388 + i_116809];
                            double eta_p_wasfree_116819 = ((double *) mem_113769)[i_116809];
                            double eta_p_wasfree_116820 = ((double *) mem_113818)[i_116809];
                            double eta_p_116821 = ((double *) mem_113790)[i_116809 * m_33388 + i_116765];
                            double zt_res_116822 = sqrt_res_116618 * eta_p_116816;
                            double zm_res_116823 = zt_res_116822 - eta_p_116817;
                            double log_res_116824 = futrts_log64(eta_p_116817);
                            double zm_res_116825 = log_res_116824 - eta_p_wasfree_116819;
                            double zm_res_116826 = zm_res_116825 - log_res_116776;
                            double fma_res_116827 = futrts_fma64(zt_res_116752, zm_res_116826, zt_res_116753);
                            double defunc_0_reduce_res_116828;
                            double redout_116830 = 0.0;
                            
                            for (int64_t i_116829 = 0; i_116829 < m_33388; i_116829++) {
                                double eta_p_116831 = ((double *) mem_113845)[i_116829];
                                double eta_p_116832 = ((double *) mem_111727.mem)[lifted_lambda_res_70084 * (m_33388 * m_33388) + i_116829 * m_33388 + i_116809];
                                double zt_res_116833 = eta_p_116831 * eta_p_116832;
                                double zp_res_116834 = zt_res_116833 + redout_116830;
                                double redout_tmp_117723 = zp_res_116834;
                                
                                redout_116830 = redout_tmp_117723;
                            }
                            defunc_0_reduce_res_116828 = redout_116830;
                            
                            double zt_res_116835 = -2.0 * defunc_0_reduce_res_116828;
                            double zp_res_116836 = defunc_0_reduce_res_116793 + zt_res_116835;
                            double zp_res_116837 = eta_p_wasfree_116820 + zp_res_116836;
                            double zt_res_116838 = 2.0 * zp_res_116837;
                            double fma_res_116839 = futrts_fma64(fma_res_116780, rho1_33389, zt_res_116838);
                            double fma_res_116840 = futrts_fma64(eta_p_116821, rho2_33390, fma_res_116839);
                            double fma_res_116841 = futrts_fma64(fma_res_116827, eps_33391, fma_res_116840);
                            double max_res_116842 = fmax64(-1.0e100, fma_res_116841);
                            double zt_res_116843 = zm_res_116823 * max_res_116842;
                            double zp_res_116844 = eta_p_116817 + zm_res_116823;
                            double zt_res_116845 = x_116774 * eta_p_116818;
                            bool zeze_res_116846 = zp_res_116844 == 0.0;
                            double klu_res_116847;
                            
                            if (zeze_res_116846) {
                                klu_res_116847 = 0.0;
                            } else {
                                double zs_res_116848 = zp_res_116844 / zt_res_116845;
                                double log_res_116849 = futrts_log64(zs_res_116848);
                                double zt_res_116850 = zp_res_116844 * log_res_116849;
                                
                                klu_res_116847 = zt_res_116850;
                            }
                            
                            double zp_res_116851 = zt_res_116843 + redout_116810;
                            double zp_res_116852 = klu_res_116847 + redout_116811;
                            double zp_res_116853 = zp_res_116844 + redout_116812;
                            double zp_res_116854 = zp_res_116844 + redout_116813;
                            
                            ((double *) mem_113829)[i_116765 * m_33388 + i_116809] = zp_res_116844;
                            ((double *) mem_in_114683.mem)[i_116765 * m_33388 + i_116809] = zm_res_116823;
                            
                            double redout_tmp_117717 = zp_res_116851;
                            double redout_tmp_117718 = zp_res_116852;
                            double redout_tmp_117719 = zp_res_116853;
                            double redout_tmp_117720 = zp_res_116854;
                            
                            redout_116810 = redout_tmp_117717;
                            redout_116811 = redout_tmp_117718;
                            redout_116812 = redout_tmp_117719;
                            redout_116813 = redout_tmp_117720;
                        }
                        defunc_0_reduce_res_116803 = redout_116810;
                        defunc_res_116804 = redout_116811;
                        defunc_res_116805 = redout_116812;
                        defunc_res_116806 = redout_116813;
                        
                        bool zeze_res_116857 = defunc_res_116806 == 0.0;
                        double klu_res_116858;
                        
                        if (zeze_res_116857) {
                            klu_res_116858 = 0.0;
                        } else {
                            double zs_res_116859 = defunc_res_116806 / x_116774;
                            double log_res_116860 = futrts_log64(zs_res_116859);
                            double zt_res_116861 = defunc_res_116806 * log_res_116860;
                            
                            klu_res_116858 = zt_res_116861;
                        }
                        
                        double zp_res_116862 = defunc_0_reduce_res_116803 + redout_116766;
                        double zp_res_116863 = klu_res_116858 + redout_116767;
                        double zp_res_116864 = defunc_res_116806 + redout_116768;
                        double zp_res_116865 = defunc_res_116804 + redout_116769;
                        double zp_res_116866 = x_116774 + redout_116770;
                        
                        ((double *) mem_113826)[i_116765] = defunc_res_116805;
                        
                        double redout_tmp_117706 = zp_res_116862;
                        double redout_tmp_117707 = zp_res_116863;
                        double redout_tmp_117708 = zp_res_116864;
                        double redout_tmp_117709 = zp_res_116865;
                        double redout_tmp_117710 = zp_res_116866;
                        
                        redout_116766 = redout_tmp_117706;
                        redout_116767 = redout_tmp_117707;
                        redout_116768 = redout_tmp_117708;
                        redout_116769 = redout_tmp_117709;
                        redout_116770 = redout_tmp_117710;
                    }
                    defunc_res_116757 = redout_116766;
                    defunc_res_116758 = redout_116767;
                    defunc_res_116759 = redout_116768;
                    defunc_res_116760 = redout_116769;
                    defunc_res_116761 = redout_116770;
                    
                    bool zl_res_116870 = defunc_res_116757 < 0.0;
                    bool assert_c_116871;
                    
                    if (!zl_res_116870) {
                        set_error(ctx, msgprintf("Error: %s\n\nBacktrace:\n%s", "Assertion is false: M.((gradient) M.< zero)", "-> #0  common.fut:220:7-221:22\n   #1  unbalanced_gw_core.fut:393:15-78\n   #2  unbalanced_gw_core.fut:402:7-11\n   #3  unbalanced_gw.fut:154:9-156:83\n   #4  /prelude/functional.fut:9:44-45\n   #5  unbalanced_gw.fut:152:6-156:84\n"));
                        err = FUTHARK_PROGRAM_ERROR;
                        goto cleanup;
                    }
                    
                    double defunc_res_116873;
                    double redout_116876 = 0.0;
                    
                    for (int64_t i_116875 = 0; i_116875 < m_33388; i_116875++) {
                        double defunc_res_116878;
                        double defunc_res_116879;
                        double redout_116881;
                        double redout_116882;
                        
                        redout_116881 = 0.0;
                        redout_116882 = 0.0;
                        for (int64_t i_116880 = 0; i_116880 < m_33388; i_116880++) {
                            double x_116883 = ((double *) mem_113829)[i_116880 * m_33388 + i_116875];
                            double zp_res_116884 = x_116883 + redout_116881;
                            double zp_res_116885 = x_116883 + redout_116882;
                            double redout_tmp_117726 = zp_res_116884;
                            double redout_tmp_117727 = zp_res_116885;
                            
                            redout_116881 = redout_tmp_117726;
                            redout_116882 = redout_tmp_117727;
                        }
                        defunc_res_116878 = redout_116881;
                        defunc_res_116879 = redout_116882;
                        
                        bool zeze_res_116886 = defunc_res_116879 == 0.0;
                        double klu_res_116887;
                        
                        if (zeze_res_116886) {
                            klu_res_116887 = 0.0;
                        } else {
                            double eta_p_116888 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_70084 * m_33388 + i_116875];
                            double zs_res_116889 = defunc_res_116879 / eta_p_116888;
                            double log_res_116890 = futrts_log64(zs_res_116889);
                            double zt_res_116891 = defunc_res_116879 * log_res_116890;
                            
                            klu_res_116887 = zt_res_116891;
                        }
                        
                        double zp_res_116892 = klu_res_116887 + redout_116876;
                        
                        ((double *) mem_113880)[i_116875] = defunc_res_116878;
                        
                        double redout_tmp_117724 = zp_res_116892;
                        
                        redout_116876 = redout_tmp_117724;
                    }
                    defunc_res_116873 = redout_116876;
                    
                    double defunc_0_reduce_res_116894;
                    double defunc_res_116895;
                    double redout_116897;
                    double redout_116898;
                    
                    redout_116897 = 0.0;
                    redout_116898 = 0.0;
                    for (int64_t i_116896 = 0; i_116896 < m_33388; i_116896++) {
                        double eta_p_116899 = ((double *) mem_113826)[i_116896];
                        double defunc_0_reduce_res_116900;
                        double redout_116902 = 0.0;
                        
                        for (int64_t i_116901 = 0; i_116901 < m_33388; i_116901++) {
                            double eta_p_116903 = ((double *) A_mem_111707.mem)[eta_p_70073 * (m_33388 * m_33388) + i_116896 * m_33388 + i_116901];
                            double eta_p_116904 = ((double *) mem_113826)[i_116901];
                            double zt_res_116905 = eta_p_116903 * eta_p_116903;
                            double zt_res_116906 = eta_p_116904 * zt_res_116905;
                            double zp_res_116907 = zt_res_116906 + redout_116902;
                            double redout_tmp_117730 = zp_res_116907;
                            
                            redout_116902 = redout_tmp_117730;
                        }
                        defunc_0_reduce_res_116900 = redout_116902;
                        
                        double zt_res_116908 = eta_p_116899 * defunc_0_reduce_res_116900;
                        
                        for (int64_t i_116911 = 0; i_116911 < m_33388; i_116911++) {
                            double defunc_0_reduce_res_116913;
                            double redout_116915 = 0.0;
                            
                            for (int64_t i_116914 = 0; i_116914 < m_33388; i_116914++) {
                                double eta_p_116916 = ((double *) A_mem_111707.mem)[eta_p_70073 * (m_33388 * m_33388) + i_116896 * m_33388 + i_116914];
                                double eta_p_116917 = ((double *) mem_113829)[i_116914 * m_33388 + i_116911];
                                double zt_res_116918 = eta_p_116916 * eta_p_116917;
                                double zp_res_116919 = zt_res_116918 + redout_116915;
                                double redout_tmp_117732 = zp_res_116919;
                                
                                redout_116915 = redout_tmp_117732;
                            }
                            defunc_0_reduce_res_116913 = redout_116915;
                            ((double *) mem_113888)[i_116911] = defunc_0_reduce_res_116913;
                        }
                        
                        double defunc_0_reduce_res_116921;
                        double redout_116923 = 0.0;
                        
                        for (int64_t i_116922 = 0; i_116922 < m_33388; i_116922++) {
                            double eta_p_116924 = ((double *) mem_113829)[i_116896 * m_33388 + i_116922];
                            double defunc_0_reduce_res_116925;
                            double redout_116927 = 0.0;
                            
                            for (int64_t i_116926 = 0; i_116926 < m_33388; i_116926++) {
                                double eta_p_116928 = ((double *) mem_113888)[i_116926];
                                double eta_p_116929 = ((double *) mem_111727.mem)[lifted_lambda_res_70084 * (m_33388 * m_33388) + i_116926 * m_33388 + i_116922];
                                double zt_res_116930 = eta_p_116928 * eta_p_116929;
                                double zp_res_116931 = zt_res_116930 + redout_116927;
                                double redout_tmp_117734 = zp_res_116931;
                                
                                redout_116927 = redout_tmp_117734;
                            }
                            defunc_0_reduce_res_116925 = redout_116927;
                            
                            double zt_res_116932 = eta_p_116924 * defunc_0_reduce_res_116925;
                            double zp_res_116933 = zt_res_116932 + redout_116923;
                            double redout_tmp_117733 = zp_res_116933;
                            
                            redout_116923 = redout_tmp_117733;
                        }
                        defunc_0_reduce_res_116921 = redout_116923;
                        
                        double zp_res_116934 = zt_res_116908 + redout_116897;
                        double zp_res_116935 = defunc_0_reduce_res_116921 + redout_116898;
                        double redout_tmp_117728 = zp_res_116934;
                        double redout_tmp_117729 = zp_res_116935;
                        
                        redout_116897 = redout_tmp_117728;
                        redout_116898 = redout_tmp_117729;
                    }
                    defunc_0_reduce_res_116894 = redout_116897;
                    defunc_res_116895 = redout_116898;
                    
                    double defunc_0_reduce_res_116936;
                    double redout_116938 = 0.0;
                    
                    for (int64_t i_116937 = 0; i_116937 < m_33388; i_116937++) {
                        double eta_p_116939 = ((double *) mem_113880)[i_116937];
                        double defunc_0_reduce_res_116940;
                        double redout_116942 = 0.0;
                        
                        for (int64_t i_116941 = 0; i_116941 < m_33388; i_116941++) {
                            double eta_p_116943 = ((double *) A_mem_111707.mem)[lifted_lambda_res_70084 * (m_33388 * m_33388) + i_116937 * m_33388 + i_116941];
                            double eta_p_116944 = ((double *) mem_113880)[i_116941];
                            double zt_res_116945 = eta_p_116943 * eta_p_116943;
                            double zt_res_116946 = eta_p_116944 * zt_res_116945;
                            double zp_res_116947 = zt_res_116946 + redout_116942;
                            double redout_tmp_117736 = zp_res_116947;
                            
                            redout_116942 = redout_tmp_117736;
                        }
                        defunc_0_reduce_res_116940 = redout_116942;
                        
                        double zt_res_116948 = eta_p_116939 * defunc_0_reduce_res_116940;
                        double zp_res_116949 = zt_res_116948 + redout_116938;
                        double redout_tmp_117735 = zp_res_116949;
                        
                        redout_116938 = redout_tmp_117735;
                    }
                    defunc_0_reduce_res_116936 = redout_116938;
                    
                    double zt_res_116950 = -2.0 * defunc_res_116895;
                    double zp_res_116951 = defunc_0_reduce_res_116894 + zt_res_116950;
                    double zp_res_116952 = defunc_0_reduce_res_116936 + zp_res_116951;
                    double zt_res_116953 = eps_33391 * defunc_res_116760;
                    double zt_res_116954 = rho1_33389 * defunc_res_116758;
                    double zt_res_116955 = rho2_33390 * defunc_res_116873;
                    double zp_res_116956 = zt_res_116953 + zt_res_116954;
                    double zp_res_116957 = zt_res_116955 + zp_res_116956;
                    double zt_res_116958 = 2.0 * zp_res_116957;
                    double zt_res_116959 = defunc_res_116759 * zt_res_116958;
                    double zp_res_116960 = zp_res_116952 + zt_res_116959;
                    double zt_res_116961 = defunc_res_116759 * defunc_res_116759;
                    double zt_res_116962 = zp_res_46827 * zt_res_116961;
                    double zm_res_116963 = zp_res_116960 - zt_res_116962;
                    double zt_res_116964 = defunc_res_116633 * defunc_res_116761;
                    double zt_res_116965 = rho1_33389 * defunc_res_116761;
                    double zt_res_116966 = defunc_res_116761 * zt_res_116965;
                    double zt_res_116967 = rho2_33390 * defunc_res_116633;
                    double zt_res_116968 = defunc_res_116633 * zt_res_116967;
                    double zp_res_116969 = zt_res_116966 + zt_res_116968;
                    double zt_res_116970 = eps_33391 * zt_res_116964;
                    double zt_res_116971 = zt_res_116964 * zt_res_116970;
                    double zp_res_116972 = zp_res_116969 + zt_res_116971;
                    double zp_res_116973 = zm_res_116963 + zp_res_116972;
                    double zm_res_116974 = zp_res_116973 - loss_115537;
                    bool zgze_res_116975 = -1.0 <= zm_res_116974;
                    double zs_res_116976 = zm_res_116974 / defunc_res_116757;
                    bool zlze_res_116977 = zs_res_116976 <= 0.5;
                    bool x_116978 = zgze_res_116975 && zlze_res_116977;
                    double defunc_res_116979;
                    
                    if (x_116978) {
                        double x_116980;
                        double redout_116982 = 0.0;
                        
                        for (int64_t i_116981 = 0; i_116981 < m_33388; i_116981++) {
                            double x_116983 = ((double *) distrs_mem_111708.mem)[eta_p_70073 * m_33388 + i_116981];
                            double zp_res_116984 = x_116983 + redout_116982;
                            double redout_tmp_117737 = zp_res_116984;
                            
                            redout_116982 = redout_tmp_117737;
                        }
                        x_116980 = redout_116982;
                        defunc_res_116979 = x_116980;
                    } else {
                        defunc_res_116979 = 0.0;
                    }
                    
                    double defunc_res_116985;
                    
                    if (x_116978) {
                        double x_116986;
                        double redout_116988 = 0.0;
                        
                        for (int64_t i_116987 = 0; i_116987 < m_33388; i_116987++) {
                            double x_116989 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_70084 * m_33388 + i_116987];
                            double zp_res_116990 = x_116989 + redout_116988;
                            double redout_tmp_117738 = zp_res_116990;
                            
                            redout_116988 = redout_tmp_117738;
                        }
                        x_116986 = redout_116988;
                        defunc_res_116985 = x_116986;
                    } else {
                        defunc_res_116985 = 0.0;
                    }
                    
                    double zt_res_116991 = defunc_res_116979 * defunc_res_116985;
                    double zt_res_116992 = rho1_33389 * defunc_res_116979;
                    double zt_res_116993 = defunc_res_116979 * zt_res_116992;
                    double zt_res_116994 = rho2_33390 * defunc_res_116985;
                    double zt_res_116995 = defunc_res_116985 * zt_res_116994;
                    double zp_res_116996 = zt_res_116993 + zt_res_116995;
                    double zt_res_116997 = eps_33391 * zt_res_116991;
                    double zt_res_116998 = zt_res_116991 * zt_res_116997;
                    double zp_res_116999 = zp_res_116996 + zt_res_116998;
                    bool defunc_0_armijo_line_search_res_117003;
                    double defunc_0_armijo_line_search_res_117005;
                    double defunc_0_armijo_line_search_res_117006;
                    bool loop_while_117009;
                    double current_loss_117011;
                    double alpha_117012;
                    
                    if (memblock_set(ctx, &mem_param_117007, &mem_in_114683, "mem_in_114683") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_out_117008, &mem_113906, "mem_113906") != 0)
                        return 1;
                    loop_while_117009 = x_116978;
                    current_loss_117011 = zp_res_116973;
                    alpha_117012 = 1.0;
                    while (loop_while_117009) {
                        double zt_res_117013 = 0.5 * alpha_117012;
                        double defunc_res_117017;
                        double defunc_res_117018;
                        double defunc_res_117019;
                        double redout_117024;
                        double redout_117025;
                        double redout_117026;
                        
                        redout_117024 = 0.0;
                        redout_117025 = 0.0;
                        redout_117026 = 0.0;
                        for (int64_t i_117023 = 0; i_117023 < m_33388; i_117023++) {
                            double eta_p_117030 = ((double *) distrs_mem_111708.mem)[eta_p_70073 * m_33388 + i_117023];
                            double defunc_res_117033;
                            double defunc_res_117034;
                            double defunc_res_117035;
                            double redout_117039;
                            double redout_117040;
                            double redout_117041;
                            
                            redout_117039 = 0.0;
                            redout_117040 = 0.0;
                            redout_117041 = 0.0;
                            for (int64_t i_117038 = 0; i_117038 < m_33388; i_117038++) {
                                double eta_p_117044 = ((double *) mem_param_117007.mem)[i_117023 * m_33388 + i_117038];
                                double eta_p_117045 = ((double *) mem_param_115532.mem)[i_117023 * m_33388 + i_117038];
                                double eta_p_117046 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_70084 * m_33388 + i_117038];
                                double zt_res_117047 = 0.5 * eta_p_117044;
                                double zp_res_117048 = eta_p_117045 + zt_res_117047;
                                double zt_res_117049 = eta_p_117030 * eta_p_117046;
                                bool zeze_res_117050 = zp_res_117048 == 0.0;
                                double klu_res_117051;
                                
                                if (zeze_res_117050) {
                                    klu_res_117051 = 0.0;
                                } else {
                                    double zs_res_117052 = zp_res_117048 / zt_res_117049;
                                    double log_res_117053 = futrts_log64(zs_res_117052);
                                    double zt_res_117054 = zp_res_117048 * log_res_117053;
                                    
                                    klu_res_117051 = zt_res_117054;
                                }
                                
                                double zp_res_117055 = klu_res_117051 + redout_117039;
                                double zp_res_117056 = zp_res_117048 + redout_117040;
                                double zp_res_117057 = zp_res_117048 + redout_117041;
                                
                                ((double *) mem_113903)[i_117023 * m_33388 + i_117038] = zp_res_117048;
                                ((double *) mem_param_out_117008.mem)[i_117023 * m_33388 + i_117038] = zt_res_117047;
                                
                                double redout_tmp_117751 = zp_res_117055;
                                double redout_tmp_117752 = zp_res_117056;
                                double redout_tmp_117753 = zp_res_117057;
                                
                                redout_117039 = redout_tmp_117751;
                                redout_117040 = redout_tmp_117752;
                                redout_117041 = redout_tmp_117753;
                            }
                            defunc_res_117033 = redout_117039;
                            defunc_res_117034 = redout_117040;
                            defunc_res_117035 = redout_117041;
                            
                            bool zeze_res_117060 = defunc_res_117035 == 0.0;
                            double klu_res_117061;
                            
                            if (zeze_res_117060) {
                                klu_res_117061 = 0.0;
                            } else {
                                double zs_res_117062 = defunc_res_117035 / eta_p_117030;
                                double log_res_117063 = futrts_log64(zs_res_117062);
                                double zt_res_117064 = defunc_res_117035 * log_res_117063;
                                
                                klu_res_117061 = zt_res_117064;
                            }
                            
                            double zp_res_117065 = klu_res_117061 + redout_117024;
                            double zp_res_117066 = defunc_res_117035 + redout_117025;
                            double zp_res_117067 = defunc_res_117033 + redout_117026;
                            
                            ((double *) mem_113900)[i_117023] = defunc_res_117034;
                            
                            double redout_tmp_117745 = zp_res_117065;
                            double redout_tmp_117746 = zp_res_117066;
                            double redout_tmp_117747 = zp_res_117067;
                            
                            redout_117024 = redout_tmp_117745;
                            redout_117025 = redout_tmp_117746;
                            redout_117026 = redout_tmp_117747;
                        }
                        defunc_res_117017 = redout_117024;
                        defunc_res_117018 = redout_117025;
                        defunc_res_117019 = redout_117026;
                        
                        double defunc_res_117072;
                        double redout_117075 = 0.0;
                        
                        for (int64_t i_117074 = 0; i_117074 < m_33388; i_117074++) {
                            double defunc_res_117077;
                            double defunc_res_117078;
                            double redout_117080;
                            double redout_117081;
                            
                            redout_117080 = 0.0;
                            redout_117081 = 0.0;
                            for (int64_t i_117079 = 0; i_117079 < m_33388; i_117079++) {
                                double x_117082 = ((double *) mem_113903)[i_117079 * m_33388 + i_117074];
                                double zp_res_117083 = x_117082 + redout_117080;
                                double zp_res_117084 = x_117082 + redout_117081;
                                double redout_tmp_117758 = zp_res_117083;
                                double redout_tmp_117759 = zp_res_117084;
                                
                                redout_117080 = redout_tmp_117758;
                                redout_117081 = redout_tmp_117759;
                            }
                            defunc_res_117077 = redout_117080;
                            defunc_res_117078 = redout_117081;
                            
                            bool zeze_res_117085 = defunc_res_117078 == 0.0;
                            double klu_res_117086;
                            
                            if (zeze_res_117085) {
                                klu_res_117086 = 0.0;
                            } else {
                                double eta_p_117087 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_70084 * m_33388 + i_117074];
                                double zs_res_117088 = defunc_res_117078 / eta_p_117087;
                                double log_res_117089 = futrts_log64(zs_res_117088);
                                double zt_res_117090 = defunc_res_117078 * log_res_117089;
                                
                                klu_res_117086 = zt_res_117090;
                            }
                            
                            double zp_res_117091 = klu_res_117086 + redout_117075;
                            
                            ((double *) mem_113946)[i_117074] = defunc_res_117077;
                            
                            double redout_tmp_117756 = zp_res_117091;
                            
                            redout_117075 = redout_tmp_117756;
                        }
                        defunc_res_117072 = redout_117075;
                        
                        double defunc_0_reduce_res_117093;
                        double defunc_res_117094;
                        double redout_117096;
                        double redout_117097;
                        
                        redout_117096 = 0.0;
                        redout_117097 = 0.0;
                        for (int64_t i_117095 = 0; i_117095 < m_33388; i_117095++) {
                            double eta_p_117098 = ((double *) mem_113900)[i_117095];
                            double defunc_0_reduce_res_117099;
                            double redout_117101 = 0.0;
                            
                            for (int64_t i_117100 = 0; i_117100 < m_33388; i_117100++) {
                                double eta_p_117102 = ((double *) A_mem_111707.mem)[eta_p_70073 * (m_33388 * m_33388) + i_117095 * m_33388 + i_117100];
                                double eta_p_117103 = ((double *) mem_113900)[i_117100];
                                double zt_res_117104 = eta_p_117102 * eta_p_117102;
                                double zt_res_117105 = eta_p_117103 * zt_res_117104;
                                double zp_res_117106 = zt_res_117105 + redout_117101;
                                double redout_tmp_117762 = zp_res_117106;
                                
                                redout_117101 = redout_tmp_117762;
                            }
                            defunc_0_reduce_res_117099 = redout_117101;
                            
                            double zt_res_117107 = eta_p_117098 * defunc_0_reduce_res_117099;
                            
                            for (int64_t i_117110 = 0; i_117110 < m_33388; i_117110++) {
                                double defunc_0_reduce_res_117112;
                                double redout_117114 = 0.0;
                                
                                for (int64_t i_117113 = 0; i_117113 < m_33388; i_117113++) {
                                    double eta_p_117115 = ((double *) A_mem_111707.mem)[eta_p_70073 * (m_33388 * m_33388) + i_117095 * m_33388 + i_117113];
                                    double eta_p_117116 = ((double *) mem_113903)[i_117113 * m_33388 + i_117110];
                                    double zt_res_117117 = eta_p_117115 * eta_p_117116;
                                    double zp_res_117118 = zt_res_117117 + redout_117114;
                                    double redout_tmp_117764 = zp_res_117118;
                                    
                                    redout_117114 = redout_tmp_117764;
                                }
                                defunc_0_reduce_res_117112 = redout_117114;
                                ((double *) mem_113954)[i_117110] = defunc_0_reduce_res_117112;
                            }
                            
                            double defunc_0_reduce_res_117120;
                            double redout_117122 = 0.0;
                            
                            for (int64_t i_117121 = 0; i_117121 < m_33388; i_117121++) {
                                double eta_p_117123 = ((double *) mem_113903)[i_117095 * m_33388 + i_117121];
                                double defunc_0_reduce_res_117124;
                                double redout_117126 = 0.0;
                                
                                for (int64_t i_117125 = 0; i_117125 < m_33388; i_117125++) {
                                    double eta_p_117127 = ((double *) mem_113954)[i_117125];
                                    double eta_p_117128 = ((double *) mem_111727.mem)[lifted_lambda_res_70084 * (m_33388 * m_33388) + i_117125 * m_33388 + i_117121];
                                    double zt_res_117129 = eta_p_117127 * eta_p_117128;
                                    double zp_res_117130 = zt_res_117129 + redout_117126;
                                    double redout_tmp_117766 = zp_res_117130;
                                    
                                    redout_117126 = redout_tmp_117766;
                                }
                                defunc_0_reduce_res_117124 = redout_117126;
                                
                                double zt_res_117131 = eta_p_117123 * defunc_0_reduce_res_117124;
                                double zp_res_117132 = zt_res_117131 + redout_117122;
                                double redout_tmp_117765 = zp_res_117132;
                                
                                redout_117122 = redout_tmp_117765;
                            }
                            defunc_0_reduce_res_117120 = redout_117122;
                            
                            double zp_res_117133 = zt_res_117107 + redout_117096;
                            double zp_res_117134 = defunc_0_reduce_res_117120 + redout_117097;
                            double redout_tmp_117760 = zp_res_117133;
                            double redout_tmp_117761 = zp_res_117134;
                            
                            redout_117096 = redout_tmp_117760;
                            redout_117097 = redout_tmp_117761;
                        }
                        defunc_0_reduce_res_117093 = redout_117096;
                        defunc_res_117094 = redout_117097;
                        
                        double defunc_0_reduce_res_117135;
                        double redout_117137 = 0.0;
                        
                        for (int64_t i_117136 = 0; i_117136 < m_33388; i_117136++) {
                            double eta_p_117138 = ((double *) mem_113946)[i_117136];
                            double defunc_0_reduce_res_117139;
                            double redout_117141 = 0.0;
                            
                            for (int64_t i_117140 = 0; i_117140 < m_33388; i_117140++) {
                                double eta_p_117142 = ((double *) A_mem_111707.mem)[lifted_lambda_res_70084 * (m_33388 * m_33388) + i_117136 * m_33388 + i_117140];
                                double eta_p_117143 = ((double *) mem_113946)[i_117140];
                                double zt_res_117144 = eta_p_117142 * eta_p_117142;
                                double zt_res_117145 = eta_p_117143 * zt_res_117144;
                                double zp_res_117146 = zt_res_117145 + redout_117141;
                                double redout_tmp_117768 = zp_res_117146;
                                
                                redout_117141 = redout_tmp_117768;
                            }
                            defunc_0_reduce_res_117139 = redout_117141;
                            
                            double zt_res_117147 = eta_p_117138 * defunc_0_reduce_res_117139;
                            double zp_res_117148 = zt_res_117147 + redout_117137;
                            double redout_tmp_117767 = zp_res_117148;
                            
                            redout_117137 = redout_tmp_117767;
                        }
                        defunc_0_reduce_res_117135 = redout_117137;
                        
                        double zt_res_117149 = -2.0 * defunc_res_117094;
                        double zp_res_117150 = defunc_0_reduce_res_117093 + zt_res_117149;
                        double zp_res_117151 = defunc_0_reduce_res_117135 + zp_res_117150;
                        double zt_res_117152 = eps_33391 * defunc_res_117019;
                        double zt_res_117153 = rho1_33389 * defunc_res_117017;
                        double zt_res_117154 = rho2_33390 * defunc_res_117072;
                        double zp_res_117155 = zt_res_117152 + zt_res_117153;
                        double zp_res_117156 = zt_res_117154 + zp_res_117155;
                        double zt_res_117157 = 2.0 * zp_res_117156;
                        double zt_res_117158 = defunc_res_117018 * zt_res_117157;
                        double zp_res_117159 = zp_res_117151 + zt_res_117158;
                        double zt_res_117160 = defunc_res_117018 * defunc_res_117018;
                        double zt_res_117161 = zp_res_46827 * zt_res_117160;
                        double zm_res_117162 = zp_res_117159 - zt_res_117161;
                        double zp_res_117163 = zp_res_116999 + zm_res_117162;
                        double zm_res_117164 = zp_res_117163 - loss_115537;
                        bool zgze_res_117165 = -1.0 <= zm_res_117164;
                        double zt_res_117166 = defunc_res_116757 * zt_res_117013;
                        double zs_res_117167 = zm_res_117164 / zt_res_117166;
                        bool zlze_res_117168 = zs_res_117167 <= 0.5;
                        bool zg_res_117169 = 1.0e-50 < zt_res_117013;
                        bool x_117170 = zlze_res_117168 && zg_res_117169;
                        bool x_117171 = zgze_res_117165 && x_117170;
                        
                        if (memblock_set(ctx, &mem_param_tmp_117739, &mem_param_out_117008, "mem_param_out_117008") != 0)
                            return 1;
                        if (memblock_set(ctx, &mem_param_out_tmp_117740, &mem_param_117007, "mem_param_117007") != 0)
                            return 1;
                        
                        bool loop_while_tmp_117741 = x_117171;
                        double current_loss_tmp_117743 = zp_res_117163;
                        double alpha_tmp_117744 = zt_res_117013;
                        
                        if (memblock_set(ctx, &mem_param_117007, &mem_param_tmp_117739, "mem_param_tmp_117739") != 0)
                            return 1;
                        if (memblock_set(ctx, &mem_param_out_117008, &mem_param_out_tmp_117740, "mem_param_out_tmp_117740") != 0)
                            return 1;
                        loop_while_117009 = loop_while_tmp_117741;
                        current_loss_117011 = current_loss_tmp_117743;
                        alpha_117012 = alpha_tmp_117744;
                    }
                    if (memblock_set(ctx, &ext_mem_117001, &mem_param_117007, "mem_param_117007") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_unused_117002, &mem_param_out_117008, "mem_param_out_117008") != 0)
                        return 1;
                    defunc_0_armijo_line_search_res_117003 = loop_while_117009;
                    defunc_0_armijo_line_search_res_117005 = current_loss_117011;
                    defunc_0_armijo_line_search_res_117006 = alpha_117012;
                    for (int64_t i_117174 = 0; i_117174 < m_33388; i_117174++) {
                        for (int64_t i_117178 = 0; i_117178 < m_33388; i_117178++) {
                            double eta_p_117180 = ((double *) mem_param_115532.mem)[i_117174 * m_33388 + i_117178];
                            double eta_p_117181 = ((double *) ext_mem_117001.mem)[i_117174 * m_33388 + i_117178];
                            double zp_res_117182 = eta_p_117180 + eta_p_117181;
                            
                            ((double *) mem_116621.mem)[i_117174 * m_33388 + i_117178] = zp_res_117182;
                        }
                    }
                    if (memblock_unref(ctx, &ext_mem_117001, "ext_mem_117001") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_116622, &mem_116581, "mem_116581") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_116623, &mem_116578, "mem_116578") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_116624, &mem_116621, "mem_116621") != 0)
                        return 1;
                    descent_res_116628 = defunc_0_armijo_line_search_res_117005;
                } else {
                    for (int64_t nest_i_117771 = 0; nest_i_117771 < m_33388; nest_i_117771++) {
                        ((double *) mem_116619.mem)[nest_i_117771] = 0.0;
                    }
                    for (int64_t nest_i_117772 = 0; nest_i_117772 < m_33388; nest_i_117772++) {
                        for (int64_t nest_i_117773 = 0; nest_i_117773 < m_33388; nest_i_117773++) {
                            ((double *) mem_116620.mem)[nest_i_117772 * m_33388 + nest_i_117773] = 0.0;
                        }
                    }
                    if (memblock_set(ctx, &ext_mem_116622, &mem_116619, "mem_116619") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_116623, &mem_116619, "mem_116619") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_116624, &mem_116620, "mem_116620") != 0)
                        return 1;
                    descent_res_116628 = 0.0;
                }
                if (memblock_unref(ctx, &mem_116578, "mem_116578") != 0)
                    return 1;
                if (memblock_unref(ctx, &mem_116581, "mem_116581") != 0)
                    return 1;
                if (memblock_unref(ctx, &mem_116619, "mem_116619") != 0)
                    return 1;
                if (memblock_unref(ctx, &mem_116620, "mem_116620") != 0)
                    return 1;
                if (memblock_unref(ctx, &mem_116621, "mem_116621") != 0)
                    return 1;
                
                bool defunc_0_reduce_comm_res_117187;
                bool redout_117189 = 0;
                
                for (int64_t i_117188 = 0; i_117188 < m_33388; i_117188++) {
                    bool defunc_0_reduce_comm_res_117190;
                    bool redout_117192 = 0;
                    
                    for (int64_t i_117191 = 0; i_117191 < m_33388; i_117191++) {
                        double eta_p_117193 = ((double *) mem_param_115532.mem)[i_117188 * m_33388 + i_117191];
                        double eta_p_117194 = ((double *) ext_mem_116624.mem)[i_117188 * m_33388 + i_117191];
                        double zt_res_117195 = zp_res_43884 * eta_p_117193;
                        bool zgze_res_117196 = eta_p_117194 <= zt_res_117195;
                        double zt_res_117197 = zp_res_43884 * eta_p_117194;
                        bool zgze_res_117198 = eta_p_117193 <= zt_res_117197;
                        bool x_117199 = zgze_res_117196 && zgze_res_117198;
                        bool not_res_117200 = !x_117199;
                        bool defunc_0_op_res_117201 = not_res_117200 || redout_117192;
                        bool redout_tmp_117775 = defunc_0_op_res_117201;
                        
                        redout_117192 = redout_tmp_117775;
                    }
                    defunc_0_reduce_comm_res_117190 = redout_117192;
                    
                    bool defunc_0_op_res_117202 = defunc_0_reduce_comm_res_117190 || redout_117189;
                    bool redout_tmp_117774 = defunc_0_op_res_117202;
                    
                    redout_117189 = redout_tmp_117774;
                }
                defunc_0_reduce_comm_res_117187 = redout_117189;
                
                bool loop_cond_117203;
                
                if (defunc_0_reduce_comm_res_117187) {
                    bool defunc_0_reduce_res_117204;
                    bool redout_117206 = 0;
                    
                    for (int64_t i_117205 = 0; i_117205 < m_33388; i_117205++) {
                        bool defunc_0_reduce_res_117207;
                        bool redout_117209 = 0;
                        
                        for (int64_t i_117208 = 0; i_117208 < m_33388; i_117208++) {
                            double eta_p_117210 = ((double *) ext_mem_116624.mem)[i_117205 * m_33388 + i_117208];
                            bool zg_res_117211 = 0.0 < eta_p_117210;
                            bool defunc_0_op_res_117212 = zg_res_117211 || redout_117209;
                            bool redout_tmp_117777 = defunc_0_op_res_117212;
                            
                            redout_117209 = redout_tmp_117777;
                        }
                        defunc_0_reduce_res_117207 = redout_117209;
                        
                        bool defunc_0_op_res_117213 = defunc_0_reduce_res_117207 || redout_117206;
                        bool redout_tmp_117776 = defunc_0_op_res_117213;
                        
                        redout_117206 = redout_tmp_117776;
                    }
                    defunc_0_reduce_res_117204 = redout_117206;
                    loop_cond_117203 = defunc_0_reduce_res_117204;
                } else {
                    loop_cond_117203 = 0;
                }
                if (memblock_set(ctx, &mem_param_tmp_117525, &ext_mem_116622, "ext_mem_116622") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_117526, &ext_mem_116623, "ext_mem_116623") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_117527, &ext_mem_116624, "ext_mem_116624") != 0)
                    return 1;
                
                bool loop_while_tmp_117528 = loop_cond_117203;
                double loss_tmp_117532 = descent_res_116628;
                
                if (memblock_set(ctx, &mem_param_115530, &mem_param_tmp_117525, "mem_param_tmp_117525") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_115531, &mem_param_tmp_117526, "mem_param_tmp_117526") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_115532, &mem_param_tmp_117527, "mem_param_tmp_117527") != 0)
                    return 1;
                loop_while_115533 = loop_while_tmp_117528;
                loss_115537 = loss_tmp_117532;
            }
            if (memblock_set(ctx, &ext_mem_114003, &mem_param_115530, "mem_param_115530") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_114002, &mem_param_115531, "mem_param_115531") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_114001, &mem_param_115532, "mem_param_115532") != 0)
                return 1;
            final_plan_71000 = loop_while_115533;
            final_plan_71004 = loss_115537;
            
            double defunc_res_103741;
            double defunc_res_103742;
            double defunc_res_103743;
            double defunc_res_103744;
            double defunc_res_103745;
            double redout_117215;
            double redout_117216;
            double redout_117217;
            double redout_117218;
            double redout_117219;
            
            redout_117215 = 0.0;
            redout_117216 = 0.0;
            redout_117217 = 0.0;
            redout_117218 = 0.0;
            redout_117219 = 0.0;
            for (int64_t i_117214 = 0; i_117214 < m_33388; i_117214++) {
                double eta_p_117223 = ((double *) distrs_mem_111708.mem)[eta_p_70073 * m_33388 + i_117214];
                
                for (int64_t i_117226 = 0; i_117226 < m_33388; i_117226++) {
                    double defunc_0_reduce_res_117228;
                    double redout_117230 = 0.0;
                    
                    for (int64_t i_117229 = 0; i_117229 < m_33388; i_117229++) {
                        double eta_p_117231 = ((double *) A_mem_111707.mem)[eta_p_70073 * (m_33388 * m_33388) + i_117214 * m_33388 + i_117229];
                        double eta_p_117232 = ((double *) ext_mem_114001.mem)[i_117229 * m_33388 + i_117226];
                        double zt_res_117233 = eta_p_117231 * eta_p_117232;
                        double zp_res_117234 = zt_res_117233 + redout_117230;
                        double redout_tmp_117787 = zp_res_117234;
                        
                        redout_117230 = redout_tmp_117787;
                    }
                    defunc_0_reduce_res_117228 = redout_117230;
                    ((double *) mem_114020)[i_117226] = defunc_0_reduce_res_117228;
                }
                
                double defunc_res_117236;
                double defunc_0_reduce_res_117237;
                double defunc_res_117238;
                double defunc_res_117239;
                double defunc_res_117240;
                double defunc_res_117241;
                double defunc_res_117242;
                double defunc_res_117243;
                double redout_117245;
                double redout_117246;
                double redout_117247;
                double redout_117248;
                double redout_117249;
                double redout_117250;
                double redout_117251;
                double redout_117252;
                
                redout_117245 = 0.0;
                redout_117246 = 0.0;
                redout_117247 = 0.0;
                redout_117248 = 0.0;
                redout_117249 = 0.0;
                redout_117250 = 0.0;
                redout_117251 = 0.0;
                redout_117252 = 0.0;
                for (int64_t i_117244 = 0; i_117244 < m_33388; i_117244++) {
                    double x_117253 = ((double *) ext_mem_114001.mem)[i_117214 * m_33388 + i_117244];
                    double eta_p_117254 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_70084 * m_33388 + i_117244];
                    double defunc_0_reduce_res_117255;
                    double redout_117257 = 0.0;
                    
                    for (int64_t i_117256 = 0; i_117256 < m_33388; i_117256++) {
                        double eta_p_117258 = ((double *) mem_114020)[i_117256];
                        double eta_p_117259 = ((double *) mem_111727.mem)[lifted_lambda_res_70084 * (m_33388 * m_33388) + i_117256 * m_33388 + i_117244];
                        double zt_res_117260 = eta_p_117258 * eta_p_117259;
                        double zp_res_117261 = zt_res_117260 + redout_117257;
                        double redout_tmp_117796 = zp_res_117261;
                        
                        redout_117257 = redout_tmp_117796;
                    }
                    defunc_0_reduce_res_117255 = redout_117257;
                    
                    double zt_res_117262 = x_117253 * defunc_0_reduce_res_117255;
                    double zt_res_117263 = eta_p_117223 * eta_p_117254;
                    bool zeze_res_117264 = x_117253 == 0.0;
                    double klu_res_117265;
                    
                    if (zeze_res_117264) {
                        klu_res_117265 = 0.0;
                    } else {
                        double zs_res_117266 = x_117253 / zt_res_117263;
                        double log_res_117267 = futrts_log64(zs_res_117266);
                        double zt_res_117268 = x_117253 * log_res_117267;
                        
                        klu_res_117265 = zt_res_117268;
                    }
                    
                    double klu_res_117269;
                    
                    if (zeze_res_117264) {
                        klu_res_117269 = 0.0;
                    } else {
                        double zs_res_117270 = x_117253 / zt_res_117263;
                        double log_res_117271 = futrts_log64(zs_res_117270);
                        double zt_res_117272 = x_117253 * log_res_117271;
                        
                        klu_res_117269 = zt_res_117272;
                    }
                    
                    double zp_res_117273 = x_117253 + redout_117245;
                    double zp_res_117274 = zt_res_117262 + redout_117246;
                    double zp_res_117275 = x_117253 + redout_117247;
                    double zp_res_117276 = x_117253 + redout_117248;
                    double zp_res_117277 = x_117253 + redout_117249;
                    double zp_res_117278 = klu_res_117265 + redout_117250;
                    double zp_res_117279 = klu_res_117269 + redout_117251;
                    double zp_res_117280 = x_117253 + redout_117252;
                    double redout_tmp_117788 = zp_res_117273;
                    double redout_tmp_117789 = zp_res_117274;
                    double redout_tmp_117790 = zp_res_117275;
                    double redout_tmp_117791 = zp_res_117276;
                    double redout_tmp_117792 = zp_res_117277;
                    double redout_tmp_117793 = zp_res_117278;
                    double redout_tmp_117794 = zp_res_117279;
                    double redout_tmp_117795 = zp_res_117280;
                    
                    redout_117245 = redout_tmp_117788;
                    redout_117246 = redout_tmp_117789;
                    redout_117247 = redout_tmp_117790;
                    redout_117248 = redout_tmp_117791;
                    redout_117249 = redout_tmp_117792;
                    redout_117250 = redout_tmp_117793;
                    redout_117251 = redout_tmp_117794;
                    redout_117252 = redout_tmp_117795;
                }
                defunc_res_117236 = redout_117245;
                defunc_0_reduce_res_117237 = redout_117246;
                defunc_res_117238 = redout_117247;
                defunc_res_117239 = redout_117248;
                defunc_res_117240 = redout_117249;
                defunc_res_117241 = redout_117250;
                defunc_res_117242 = redout_117251;
                defunc_res_117243 = redout_117252;
                
                double zp_res_117281 = defunc_0_reduce_res_117237 + redout_117215;
                double zp_res_117282 = defunc_res_117239 + redout_117216;
                double zp_res_117283 = defunc_res_117240 + redout_117217;
                double zp_res_117284 = defunc_res_117241 + redout_117218;
                double zp_res_117285 = defunc_res_117242 + redout_117219;
                
                ((double *) mem_114005)[i_117214] = defunc_res_117243;
                ((double *) mem_114007)[i_117214] = defunc_res_117238;
                ((double *) mem_114009)[i_117214] = defunc_res_117236;
                
                double redout_tmp_117778 = zp_res_117281;
                double redout_tmp_117779 = zp_res_117282;
                double redout_tmp_117780 = zp_res_117283;
                double redout_tmp_117781 = zp_res_117284;
                double redout_tmp_117782 = zp_res_117285;
                
                redout_117215 = redout_tmp_117778;
                redout_117216 = redout_tmp_117779;
                redout_117217 = redout_tmp_117780;
                redout_117218 = redout_tmp_117781;
                redout_117219 = redout_tmp_117782;
            }
            defunc_res_103741 = redout_117215;
            defunc_res_103742 = redout_117216;
            defunc_res_103743 = redout_117217;
            defunc_res_103744 = redout_117218;
            defunc_res_103745 = redout_117219;
            for (int64_t i_117289 = 0; i_117289 < m_33388; i_117289++) {
                double defunc_res_117293;
                double defunc_res_117294;
                double defunc_res_117295;
                double redout_117297;
                double redout_117298;
                double redout_117299;
                
                redout_117297 = 0.0;
                redout_117298 = 0.0;
                redout_117299 = 0.0;
                for (int64_t i_117296 = 0; i_117296 < m_33388; i_117296++) {
                    double x_117300 = ((double *) ext_mem_114001.mem)[i_117296 * m_33388 + i_117289];
                    double zp_res_117301 = x_117300 + redout_117297;
                    double zp_res_117302 = x_117300 + redout_117298;
                    double zp_res_117303 = x_117300 + redout_117299;
                    double redout_tmp_117800 = zp_res_117301;
                    double redout_tmp_117801 = zp_res_117302;
                    double redout_tmp_117802 = zp_res_117303;
                    
                    redout_117297 = redout_tmp_117800;
                    redout_117298 = redout_tmp_117801;
                    redout_117299 = redout_tmp_117802;
                }
                defunc_res_117293 = redout_117297;
                defunc_res_117294 = redout_117298;
                defunc_res_117295 = redout_117299;
                ((double *) mem_114037)[i_117289] = defunc_res_117295;
                ((double *) mem_114039)[i_117289] = defunc_res_117294;
                ((double *) mem_114041)[i_117289] = defunc_res_117293;
            }
            
            double defunc_0_reduce_res_103752;
            double redout_117308 = 0.0;
            
            for (int64_t i_117307 = 0; i_117307 < m_33388; i_117307++) {
                double eta_p_117309 = ((double *) mem_114009)[i_117307];
                double defunc_0_reduce_res_117310;
                double redout_117312 = 0.0;
                
                for (int64_t i_117311 = 0; i_117311 < m_33388; i_117311++) {
                    double eta_p_117313 = ((double *) A_mem_111707.mem)[eta_p_70073 * (m_33388 * m_33388) + i_117307 * m_33388 + i_117311];
                    double eta_p_117314 = ((double *) mem_114009)[i_117311];
                    double zt_res_117315 = eta_p_117313 * eta_p_117313;
                    double zt_res_117316 = eta_p_117314 * zt_res_117315;
                    double zp_res_117317 = zt_res_117316 + redout_117312;
                    double redout_tmp_117804 = zp_res_117317;
                    
                    redout_117312 = redout_tmp_117804;
                }
                defunc_0_reduce_res_117310 = redout_117312;
                
                double zt_res_117318 = eta_p_117309 * defunc_0_reduce_res_117310;
                double zp_res_117319 = zt_res_117318 + redout_117308;
                double redout_tmp_117803 = zp_res_117319;
                
                redout_117308 = redout_tmp_117803;
            }
            defunc_0_reduce_res_103752 = redout_117308;
            
            double defunc_0_reduce_res_103753;
            double redout_117321 = 0.0;
            
            for (int64_t i_117320 = 0; i_117320 < m_33388; i_117320++) {
                double eta_p_117322 = ((double *) mem_114041)[i_117320];
                double defunc_0_reduce_res_117323;
                double redout_117325 = 0.0;
                
                for (int64_t i_117324 = 0; i_117324 < m_33388; i_117324++) {
                    double eta_p_117326 = ((double *) A_mem_111707.mem)[lifted_lambda_res_70084 * (m_33388 * m_33388) + i_117320 * m_33388 + i_117324];
                    double eta_p_117327 = ((double *) mem_114041)[i_117324];
                    double zt_res_117328 = eta_p_117326 * eta_p_117326;
                    double zt_res_117329 = eta_p_117327 * zt_res_117328;
                    double zp_res_117330 = zt_res_117329 + redout_117325;
                    double redout_tmp_117806 = zp_res_117330;
                    
                    redout_117325 = redout_tmp_117806;
                }
                defunc_0_reduce_res_117323 = redout_117325;
                
                double zt_res_117331 = eta_p_117322 * defunc_0_reduce_res_117323;
                double zp_res_117332 = zt_res_117331 + redout_117321;
                double redout_tmp_117805 = zp_res_117332;
                
                redout_117321 = redout_tmp_117805;
            }
            defunc_0_reduce_res_103753 = redout_117321;
            
            double zt_res_72996 = -2.0 * defunc_res_103741;
            double zp_res_72997 = zt_res_72996 + defunc_0_reduce_res_103752;
            double zp_res_72998 = zp_res_72997 + defunc_0_reduce_res_103753;
            double defunc_res_103754;
            double defunc_res_103755;
            double redout_117334;
            double redout_117335;
            
            redout_117334 = 0.0;
            redout_117335 = 0.0;
            for (int64_t i_117333 = 0; i_117333 < m_33388; i_117333++) {
                double eta_p_117336 = ((double *) mem_114005)[i_117333];
                double eta_p_117337 = ((double *) distrs_mem_111708.mem)[eta_p_70073 * m_33388 + i_117333];
                double eta_p_117338 = ((double *) mem_114007)[i_117333];
                double defunc_res_117339;
                double defunc_res_117340;
                double redout_117342;
                double redout_117343;
                
                redout_117342 = 0.0;
                redout_117343 = 0.0;
                for (int64_t i_117341 = 0; i_117341 < m_33388; i_117341++) {
                    double eta_p_117344 = ((double *) mem_114005)[i_117341];
                    double eta_p_117345 = ((double *) distrs_mem_111708.mem)[eta_p_70073 * m_33388 + i_117341];
                    double eta_p_117346 = ((double *) mem_114007)[i_117341];
                    double zt_res_117347 = eta_p_117337 * eta_p_117345;
                    double zt_res_117348 = eta_p_117338 * eta_p_117346;
                    bool zeze_res_117349 = zt_res_117348 == 0.0;
                    double kl_res_117350;
                    
                    if (zeze_res_117349) {
                        kl_res_117350 = zt_res_117347;
                    } else {
                        double zs_res_117351 = zt_res_117348 / zt_res_117347;
                        double log_res_117352 = futrts_log64(zs_res_117351);
                        double zt_res_117353 = zt_res_117348 * log_res_117352;
                        double zm_res_117354 = zt_res_117353 - zt_res_117348;
                        double zp_res_117355 = zt_res_117347 + zm_res_117354;
                        
                        kl_res_117350 = zp_res_117355;
                    }
                    
                    double zt_res_117356 = eta_p_117336 * eta_p_117344;
                    bool zeze_res_117357 = zt_res_117356 == 0.0;
                    double kl_res_117358;
                    
                    if (zeze_res_117357) {
                        kl_res_117358 = zt_res_117347;
                    } else {
                        double zs_res_117359 = zt_res_117356 / zt_res_117347;
                        double log_res_117360 = futrts_log64(zs_res_117359);
                        double zt_res_117361 = zt_res_117356 * log_res_117360;
                        double zm_res_117362 = zt_res_117361 - zt_res_117356;
                        double zp_res_117363 = zt_res_117347 + zm_res_117362;
                        
                        kl_res_117358 = zp_res_117363;
                    }
                    
                    double zp_res_117364 = kl_res_117350 + redout_117342;
                    double zp_res_117365 = kl_res_117358 + redout_117343;
                    double redout_tmp_117809 = zp_res_117364;
                    double redout_tmp_117810 = zp_res_117365;
                    
                    redout_117342 = redout_tmp_117809;
                    redout_117343 = redout_tmp_117810;
                }
                defunc_res_117339 = redout_117342;
                defunc_res_117340 = redout_117343;
                
                double zp_res_117366 = defunc_res_117339 + redout_117334;
                double zp_res_117367 = defunc_res_117340 + redout_117335;
                double redout_tmp_117807 = zp_res_117366;
                double redout_tmp_117808 = zp_res_117367;
                
                redout_117334 = redout_tmp_117807;
                redout_117335 = redout_tmp_117808;
            }
            defunc_res_103754 = redout_117334;
            defunc_res_103755 = redout_117335;
            
            double defunc_res_103756;
            double defunc_res_103757;
            double redout_117369;
            double redout_117370;
            
            redout_117369 = 0.0;
            redout_117370 = 0.0;
            for (int64_t i_117368 = 0; i_117368 < m_33388; i_117368++) {
                double eta_p_117371 = ((double *) mem_114037)[i_117368];
                double eta_p_117372 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_70084 * m_33388 + i_117368];
                double eta_p_117373 = ((double *) mem_114039)[i_117368];
                double defunc_res_117374;
                double defunc_res_117375;
                double redout_117377;
                double redout_117378;
                
                redout_117377 = 0.0;
                redout_117378 = 0.0;
                for (int64_t i_117376 = 0; i_117376 < m_33388; i_117376++) {
                    double eta_p_117379 = ((double *) mem_114037)[i_117376];
                    double eta_p_117380 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_70084 * m_33388 + i_117376];
                    double eta_p_117381 = ((double *) mem_114039)[i_117376];
                    double zt_res_117382 = eta_p_117372 * eta_p_117380;
                    double zt_res_117383 = eta_p_117373 * eta_p_117381;
                    bool zeze_res_117384 = zt_res_117383 == 0.0;
                    double kl_res_117385;
                    
                    if (zeze_res_117384) {
                        kl_res_117385 = zt_res_117382;
                    } else {
                        double zs_res_117386 = zt_res_117383 / zt_res_117382;
                        double log_res_117387 = futrts_log64(zs_res_117386);
                        double zt_res_117388 = zt_res_117383 * log_res_117387;
                        double zm_res_117389 = zt_res_117388 - zt_res_117383;
                        double zp_res_117390 = zt_res_117382 + zm_res_117389;
                        
                        kl_res_117385 = zp_res_117390;
                    }
                    
                    double zt_res_117391 = eta_p_117371 * eta_p_117379;
                    bool zeze_res_117392 = zt_res_117391 == 0.0;
                    double kl_res_117393;
                    
                    if (zeze_res_117392) {
                        kl_res_117393 = zt_res_117382;
                    } else {
                        double zs_res_117394 = zt_res_117391 / zt_res_117382;
                        double log_res_117395 = futrts_log64(zs_res_117394);
                        double zt_res_117396 = zt_res_117391 * log_res_117395;
                        double zm_res_117397 = zt_res_117396 - zt_res_117391;
                        double zp_res_117398 = zt_res_117382 + zm_res_117397;
                        
                        kl_res_117393 = zp_res_117398;
                    }
                    
                    double zp_res_117399 = kl_res_117385 + redout_117377;
                    double zp_res_117400 = kl_res_117393 + redout_117378;
                    double redout_tmp_117813 = zp_res_117399;
                    double redout_tmp_117814 = zp_res_117400;
                    
                    redout_117377 = redout_tmp_117813;
                    redout_117378 = redout_tmp_117814;
                }
                defunc_res_117374 = redout_117377;
                defunc_res_117375 = redout_117378;
                
                double zp_res_117401 = defunc_res_117374 + redout_117369;
                double zp_res_117402 = defunc_res_117375 + redout_117370;
                double redout_tmp_117811 = zp_res_117401;
                double redout_tmp_117812 = zp_res_117402;
                
                redout_117369 = redout_tmp_117811;
                redout_117370 = redout_tmp_117812;
            }
            defunc_res_103756 = redout_117369;
            defunc_res_103757 = redout_117370;
            
            double zt_res_73113 = defunc_res_103708 * defunc_res_103715;
            double zt_res_73114 = zt_res_73113 * zt_res_73113;
            double zt_res_73137 = defunc_res_103743 * defunc_res_103744;
            double zt_res_73160 = defunc_res_103742 * defunc_res_103745;
            double zp_res_73161 = zt_res_73137 + zt_res_73160;
            double zp_res_73162 = zt_res_73114 + zp_res_73161;
            double zt_res_73163 = defunc_res_103742 * defunc_res_103743;
            double zm_res_73164 = zp_res_73162 - zt_res_73163;
            double zt_res_73200 = rho1_33389 * defunc_res_103755;
            double zp_res_73201 = zp_res_72998 + zt_res_73200;
            double zt_res_73237 = rho2_33390 * defunc_res_103757;
            double zp_res_73238 = zp_res_73201 + zt_res_73237;
            double fma_res_73239 = futrts_fma64(zm_res_73164, eps_33391, zp_res_73238);
            
            ((double *) mem_114063.mem)[gtid_103891 * (int64_t) 5] = zp_res_72998;
            ((double *) mem_114063.mem)[gtid_103891 * (int64_t) 5 + (int64_t) 1] = defunc_res_103754;
            ((double *) mem_114063.mem)[gtid_103891 * (int64_t) 5 + (int64_t) 2] = defunc_res_103756;
            ((double *) mem_114063.mem)[gtid_103891 * (int64_t) 5 + (int64_t) 3] = zm_res_73164;
            ((double *) mem_114063.mem)[gtid_103891 * (int64_t) 5 + (int64_t) 4] = fma_res_73239;
        }
    }
    
  cleanup:
    {
        free(mem_112580);
        free(mem_112582);
        free(mem_112585);
        free(mem_112615);
        free(mem_112617);
        free(mem_112619);
        free(mem_112639);
        free(mem_112648);
        free(mem_112659);
        free(mem_112661);
        free(mem_112675);
        free(mem_112706);
        free(mem_112998);
        free(mem_113045);
        free(mem_113053);
        free(mem_113055);
        free(mem_113069);
        free(mem_113078);
        free(mem_113080);
        free(mem_113089);
        free(mem_113097);
        free(mem_113728);
        free(mem_113765);
        free(mem_113767);
        free(mem_113769);
        free(mem_113790);
        free(mem_113802);
        free(mem_113804);
        free(mem_113818);
        free(mem_113826);
        free(mem_113829);
        free(mem_113845);
        free(mem_113880);
        free(mem_113888);
        free(mem_113900);
        free(mem_113903);
        free(mem_113946);
        free(mem_113954);
        free(mem_114005);
        free(mem_114007);
        free(mem_114009);
        free(mem_114020);
        free(mem_114037);
        free(mem_114039);
        free(mem_114041);
        if (memblock_unref(ctx, &mem_param_tmp_117527, "mem_param_tmp_117527") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_117526, "mem_param_tmp_117526") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_117525, "mem_param_tmp_117525") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_out_tmp_117740, "mem_param_out_tmp_117740") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_117739, "mem_param_tmp_117739") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_out_117008, "mem_param_out_117008") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_117007, "mem_param_117007") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_unused_117002, "ext_mem_unused_117002") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_117001, "ext_mem_117001") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_116624, "ext_mem_116624") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_116623, "ext_mem_116623") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_116622, "ext_mem_116622") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_116621, "mem_116621") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_116620, "mem_116620") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_116619, "mem_116619") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_116581, "mem_116581") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_116578, "mem_116578") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_117648, "mem_param_tmp_117648") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_117647, "mem_param_tmp_117647") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_117646, "mem_param_tmp_117646") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_117645, "mem_param_tmp_117645") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_117644, "mem_param_tmp_117644") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_116538, "ext_mem_116538") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_116511, "ext_mem_116511") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_116510, "ext_mem_116510") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_116509, "ext_mem_116509") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_116508, "mem_116508") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_116507, "mem_116507") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_116506, "mem_116506") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_116475, "ext_mem_116475") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_116448, "ext_mem_116448") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_116447, "ext_mem_116447") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_116446, "ext_mem_116446") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_116445, "mem_116445") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_116444, "mem_116444") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_116443, "mem_116443") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_116407, "mem_116407") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_116383, "mem_116383") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_116373, "mem_param_116373") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_116372, "mem_param_116372") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_116371, "mem_param_116371") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_116370, "mem_param_116370") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_116369, "mem_param_116369") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_116359, "ext_mem_116359") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_116358, "ext_mem_116358") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_116357, "ext_mem_116357") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_116356, "ext_mem_116356") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_116355, "ext_mem_116355") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_116315, "ext_mem_116315") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_116289, "ext_mem_116289") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_116288, "ext_mem_116288") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_116287, "ext_mem_116287") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_116256, "ext_mem_116256") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_116230, "ext_mem_116230") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_116229, "ext_mem_116229") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_116228, "ext_mem_116228") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_116164, "ext_mem_116164") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_116163, "ext_mem_116163") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_116162, "ext_mem_116162") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_116161, "ext_mem_116161") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_116157, "ext_mem_116157") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_117590, "mem_param_tmp_117590") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_117589, "mem_param_tmp_117589") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_117588, "mem_param_tmp_117588") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_117587, "mem_param_tmp_117587") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_117586, "mem_param_tmp_117586") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_117585, "mem_param_tmp_117585") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_117584, "mem_param_tmp_117584") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_117583, "mem_param_tmp_117583") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_117582, "mem_param_tmp_117582") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_116110, "ext_mem_116110") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_116083, "ext_mem_116083") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_116082, "ext_mem_116082") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_116081, "ext_mem_116081") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_116080, "mem_116080") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_116079, "mem_116079") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_116078, "mem_116078") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_116047, "ext_mem_116047") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_116020, "ext_mem_116020") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_116019, "ext_mem_116019") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_116018, "ext_mem_116018") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_116017, "mem_116017") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_116016, "mem_116016") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_116015, "mem_116015") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_115979, "mem_115979") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_115955, "mem_115955") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_115938, "mem_param_115938") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_115937, "mem_param_115937") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_115936, "mem_param_115936") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_115935, "mem_param_115935") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_115934, "mem_param_115934") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_115933, "mem_param_115933") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_115932, "mem_param_115932") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_115931, "mem_param_115931") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_115930, "mem_param_115930") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_115913, "ext_mem_115913") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_115912, "ext_mem_115912") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_115911, "ext_mem_115911") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_115910, "ext_mem_115910") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_115909, "ext_mem_115909") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_115908, "ext_mem_115908") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_115907, "ext_mem_115907") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_115906, "ext_mem_115906") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_115905, "ext_mem_115905") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_115867, "ext_mem_115867") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_115842, "ext_mem_115842") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_115841, "ext_mem_115841") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_115840, "ext_mem_115840") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_115810, "ext_mem_115810") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_115786, "ext_mem_115786") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_115785, "ext_mem_115785") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_115784, "ext_mem_115784") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_117488, "mem_param_tmp_117488") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_117487, "mem_param_tmp_117487") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_117486, "mem_param_tmp_117486") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_117485, "mem_param_tmp_117485") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_117484, "mem_param_tmp_117484") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_115451, "ext_mem_115451") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_115424, "ext_mem_115424") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_115423, "ext_mem_115423") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_115422, "ext_mem_115422") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_115421, "mem_115421") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_115420, "mem_115420") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_115419, "mem_115419") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_115388, "ext_mem_115388") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_115361, "ext_mem_115361") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_115360, "ext_mem_115360") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_115359, "ext_mem_115359") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_115358, "mem_115358") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_115357, "mem_115357") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_115356, "mem_115356") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_115320, "mem_115320") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_115296, "mem_115296") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_115255, "ext_mem_115255") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_115211, "ext_mem_115211") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_115532, "mem_param_115532") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_115531, "mem_param_115531") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_115530, "mem_param_115530") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_114001, "ext_mem_114001") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_114002, "ext_mem_114002") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_114003, "ext_mem_114003") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_in_114683, "mem_in_114683") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_113906, "mem_113906") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_113660, "mem_113660") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_113610, "mem_113610") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_113528, "mem_113528") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_113516, "mem_113516") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_113513, "mem_113513") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_113511, "mem_113511") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_113478, "mem_113478") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_113466, "mem_113466") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_113463, "mem_113463") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_113461, "mem_113461") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_113453, "mem_113453") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_113445, "mem_113445") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_113383, "mem_113383") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_113333, "mem_113333") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_113238, "mem_113238") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_113226, "mem_113226") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_113223, "mem_113223") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_113221, "mem_113221") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_113188, "mem_113188") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_113176, "mem_113176") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_113173, "mem_113173") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_113171, "mem_113171") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_113157, "mem_113157") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_113155, "mem_113155") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_113125, "mem_113125") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_113122, "mem_113122") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_113120, "mem_113120") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_113017, "mem_113017") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_115286, "mem_param_115286") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_115285, "mem_param_115285") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_115284, "mem_param_115284") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_115283, "mem_param_115283") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_115282, "mem_param_115282") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_112991, "ext_mem_112991") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_112992, "ext_mem_112992") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_112993, "ext_mem_112993") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_112994, "ext_mem_112994") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_112995, "ext_mem_112995") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_112948, "mem_112948") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_112898, "mem_112898") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_112841, "ext_mem_112841") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_112844, "ext_mem_112844") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_112847, "ext_mem_112847") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_112816, "mem_112816") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_112804, "mem_112804") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_112801, "mem_112801") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_112799, "mem_112799") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_112791, "ext_mem_112791") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_112794, "ext_mem_112794") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_112797, "ext_mem_112797") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_112766, "mem_112766") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_112754, "mem_112754") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_112751, "mem_112751") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_112749, "mem_112749") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_112741, "mem_112741") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_112733, "mem_112733") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_112709, "mem_112709") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_112698, "mem_112698") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_112650, "mem_112650") != 0)
            return 1;
    }
    if (event_127428 != NULL) {
        event_127428->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127382", strdup("nothing further"), event_127428, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_task_127380(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127379 *futhark_mc_task_127379 = (struct futhark_mc_task_127379 *) args;
    struct futhark_context *ctx = futhark_mc_task_127379->ctx;
    struct mc_event *event_127430 = mc_event_new(ctx);
    
    if (event_127430 != NULL)
        event_127430->bef = get_wall_time();
    
    int64_t k_33387 = futhark_mc_task_127379->free_k_33387;
    int64_t m_33388 = futhark_mc_task_127379->free_m_33388;
    double rho1_33389 = futhark_mc_task_127379->free_rho1_33389;
    double rho2_33390 = futhark_mc_task_127379->free_rho2_33390;
    double eps_33391 = futhark_mc_task_127379->free_eps_33391;
    double exp_absorb_cutoff_33394 = futhark_mc_task_127379->free_exp_absorb_cutoff_33394;
    double safe_for_exp_33395 = futhark_mc_task_127379->free_safe_for_exp_33395;
    double tol_sinkhorn_33396 = futhark_mc_task_127379->free_tol_sinkhorn_33396;
    double neg_res_43882 = futhark_mc_task_127379->free_neg_res_43882;
    double zp_res_43884 = futhark_mc_task_127379->free_zp_res_43884;
    double zs_res_44842 = futhark_mc_task_127379->free_zs_res_44842;
    double zs_res_44844 = futhark_mc_task_127379->free_zs_res_44844;
    double zs_res_44883 = futhark_mc_task_127379->free_zs_res_44883;
    double zs_res_44885 = futhark_mc_task_127379->free_zs_res_44885;
    double zp_res_46827 = futhark_mc_task_127379->free_zp_res_46827;
    int64_t defunc_0_reduce_res_103765 = futhark_mc_task_127379->free_defunc_0_reduce_res_103765;
    double zs_res_107134 = futhark_mc_task_127379->free_zs_res_107134;
    double zp_res_108112 = futhark_mc_task_127379->free_zp_res_108112;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_127379->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_127379->free_distrs_mem_111708, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_task_127379->free_bytes_111715;
    struct memblock mem_111716 = {.desc ="mem_111716", .mem =futhark_mc_task_127379->free_mem_111716, .size =0, .references =NULL};
    struct memblock mem_111719 = {.desc ="mem_111719", .mem =futhark_mc_task_127379->free_mem_111719, .size =0, .references =NULL};
    struct memblock mem_111723 = {.desc ="mem_111723", .mem =futhark_mc_task_127379->free_mem_111723, .size =0, .references =NULL};
    int64_t bytes_111726 = futhark_mc_task_127379->free_bytes_111726;
    struct memblock mem_111727 = {.desc ="mem_111727", .mem =futhark_mc_task_127379->free_mem_111727, .size =0, .references =NULL};
    int64_t bytes_111743 = futhark_mc_task_127379->free_bytes_111743;
    struct memblock mem_114063 = {.desc ="mem_114063", .mem =futhark_mc_task_127379->free_mem_114063, .size =0, .references =NULL};
    int64_t num_bytes_114668 = futhark_mc_task_127379->free_num_bytes_114668;
    int32_t nsubtasks_114884;
    
    nsubtasks_114884 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_127381 futhark_mc_segmap_parloop_struct_127381_;
    
    futhark_mc_segmap_parloop_struct_127381_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_127381_.free_k_33387 = k_33387;
    futhark_mc_segmap_parloop_struct_127381_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_127381_.free_rho1_33389 = rho1_33389;
    futhark_mc_segmap_parloop_struct_127381_.free_rho2_33390 = rho2_33390;
    futhark_mc_segmap_parloop_struct_127381_.free_eps_33391 = eps_33391;
    futhark_mc_segmap_parloop_struct_127381_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segmap_parloop_struct_127381_.free_safe_for_exp_33395 = safe_for_exp_33395;
    futhark_mc_segmap_parloop_struct_127381_.free_tol_sinkhorn_33396 = tol_sinkhorn_33396;
    futhark_mc_segmap_parloop_struct_127381_.free_neg_res_43882 = neg_res_43882;
    futhark_mc_segmap_parloop_struct_127381_.free_zp_res_43884 = zp_res_43884;
    futhark_mc_segmap_parloop_struct_127381_.free_zs_res_44842 = zs_res_44842;
    futhark_mc_segmap_parloop_struct_127381_.free_zs_res_44844 = zs_res_44844;
    futhark_mc_segmap_parloop_struct_127381_.free_zs_res_44883 = zs_res_44883;
    futhark_mc_segmap_parloop_struct_127381_.free_zs_res_44885 = zs_res_44885;
    futhark_mc_segmap_parloop_struct_127381_.free_zp_res_46827 = zp_res_46827;
    futhark_mc_segmap_parloop_struct_127381_.free_defunc_0_reduce_res_103765 = defunc_0_reduce_res_103765;
    futhark_mc_segmap_parloop_struct_127381_.free_zs_res_107134 = zs_res_107134;
    futhark_mc_segmap_parloop_struct_127381_.free_zp_res_108112 = zp_res_108112;
    futhark_mc_segmap_parloop_struct_127381_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segmap_parloop_struct_127381_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segmap_parloop_struct_127381_.free_bytes_111715 = bytes_111715;
    futhark_mc_segmap_parloop_struct_127381_.free_mem_111716 = mem_111716.mem;
    futhark_mc_segmap_parloop_struct_127381_.free_mem_111719 = mem_111719.mem;
    futhark_mc_segmap_parloop_struct_127381_.free_mem_111723 = mem_111723.mem;
    futhark_mc_segmap_parloop_struct_127381_.free_mem_111727 = mem_111727.mem;
    futhark_mc_segmap_parloop_struct_127381_.free_bytes_111743 = bytes_111743;
    futhark_mc_segmap_parloop_struct_127381_.free_mem_114063 = mem_114063.mem;
    futhark_mc_segmap_parloop_struct_127381_.free_num_bytes_114668 = num_bytes_114668;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_127382_task;
    
    futhark_mc_segmap_parloop_127382_task.name = "futhark_mc_segmap_parloop_127382";
    futhark_mc_segmap_parloop_127382_task.fn = futhark_mc_segmap_parloop_127382;
    futhark_mc_segmap_parloop_127382_task.args = &futhark_mc_segmap_parloop_struct_127381_;
    futhark_mc_segmap_parloop_127382_task.iterations = iterations;
    futhark_mc_segmap_parloop_127382_task.info = info;
    
    struct mc_event *event_127429 = mc_event_new(ctx);
    
    if (event_127429 != NULL)
        event_127429->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_127382_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_127382_task);
    
    if (futhark_mc_segmap_parloop_127382_err != 0) {
        err = futhark_mc_segmap_parloop_127382_err;
        goto cleanup;
    }
    if (event_127429 != NULL) {
        event_127429->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127382_total", strdup("nothing further"), event_127429, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_127430 != NULL) {
        event_127430->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_task_127380", strdup("nothing further"), event_127430, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_segmap_parloop_struct_127432 {
    struct futhark_context *ctx;
    int64_t free_k_33387;
    int64_t free_m_33388;
    double free_rho1_33389;
    double free_rho2_33390;
    double free_eps_33391;
    double free_exp_absorb_cutoff_33394;
    double free_safe_for_exp_33395;
    double free_tol_sinkhorn_33396;
    double free_neg_res_43882;
    double free_zp_res_43884;
    double free_zs_res_44842;
    double free_zs_res_44844;
    double free_zs_res_44883;
    double free_zs_res_44885;
    double free_zp_res_46827;
    int64_t free_defunc_0_reduce_res_103765;
    double free_zs_res_107134;
    double free_zp_res_108112;
    unsigned char *free_A_mem_111707;
    unsigned char *free_distrs_mem_111708;
    int64_t free_bytes_111715;
    unsigned char *free_mem_111716;
    unsigned char *free_mem_111719;
    unsigned char *free_mem_111723;
    int64_t free_bytes_111726;
    unsigned char *free_mem_111727;
    int64_t free_bytes_111743;
    unsigned char *free_mem_114063;
    int64_t free_num_bytes_114668;
};
struct futhark_mc_task_127471 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    int64_t free_bytes_111715;
    int64_t free_flat_tid_117816;
    int64_t free_flat_tid_117903;
    double *retval_defunc_res_106404;
    double *retval_defunc_res_106405;
    double *retval_defunc_res_106406;
    double *retval_defunc_res_106407;
    double *retval_defunc_res_106408;
    double *retval_defunc_res_106409;
    double *retval_defunc_res_106410;
    double *retval_defunc_res_106411;
    double *retval_defunc_res_106412;
    unsigned char *retval_mem_111739;
    unsigned char *retval_mem_111741;
    unsigned char *retval_mem_111744;
};
struct futhark_mc_segred_stage_1_parloop_struct_127482 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    int64_t free_bytes_111715;
    unsigned char *free_mem_111739;
    unsigned char *free_mem_111741;
    unsigned char *free_mem_111744;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_121986;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_121988;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_121990;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_121992;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_121994;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_121996;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_121998;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122000;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122002;
};
static int futhark_mc_segred_stage_1_parloop_127483(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127482 *futhark_mc_segred_stage_1_parloop_struct_127482 = (struct futhark_mc_segred_stage_1_parloop_struct_127482 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127482->ctx;
    struct mc_event *event_127485 = mc_event_new(ctx);
    
    if (event_127485 != NULL)
        event_127485->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127482->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_127482->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_127482->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_127482->free_distrs_mem_111708, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_segred_stage_1_parloop_struct_127482->free_bytes_111715;
    struct memblock mem_111739 = {.desc ="mem_111739", .mem =futhark_mc_segred_stage_1_parloop_struct_127482->free_mem_111739, .size =0, .references =NULL};
    struct memblock mem_111741 = {.desc ="mem_111741", .mem =futhark_mc_segred_stage_1_parloop_struct_127482->free_mem_111741, .size =0, .references =NULL};
    struct memblock mem_111744 = {.desc ="mem_111744", .mem =futhark_mc_segred_stage_1_parloop_struct_127482->free_mem_111744, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_121986 = {.desc ="reduce_stage_1_tid_res_arr_mem_121986", .mem =futhark_mc_segred_stage_1_parloop_struct_127482->free_reduce_stage_1_tid_res_arr_mem_121986, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_121988 = {.desc ="reduce_stage_1_tid_res_arr_mem_121988", .mem =futhark_mc_segred_stage_1_parloop_struct_127482->free_reduce_stage_1_tid_res_arr_mem_121988, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_121990 = {.desc ="reduce_stage_1_tid_res_arr_mem_121990", .mem =futhark_mc_segred_stage_1_parloop_struct_127482->free_reduce_stage_1_tid_res_arr_mem_121990, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_121992 = {.desc ="reduce_stage_1_tid_res_arr_mem_121992", .mem =futhark_mc_segred_stage_1_parloop_struct_127482->free_reduce_stage_1_tid_res_arr_mem_121992, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_121994 = {.desc ="reduce_stage_1_tid_res_arr_mem_121994", .mem =futhark_mc_segred_stage_1_parloop_struct_127482->free_reduce_stage_1_tid_res_arr_mem_121994, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_121996 = {.desc ="reduce_stage_1_tid_res_arr_mem_121996", .mem =futhark_mc_segred_stage_1_parloop_struct_127482->free_reduce_stage_1_tid_res_arr_mem_121996, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_121998 = {.desc ="reduce_stage_1_tid_res_arr_mem_121998", .mem =futhark_mc_segred_stage_1_parloop_struct_127482->free_reduce_stage_1_tid_res_arr_mem_121998, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122000 = {.desc ="reduce_stage_1_tid_res_arr_mem_122000", .mem =futhark_mc_segred_stage_1_parloop_struct_127482->free_reduce_stage_1_tid_res_arr_mem_122000, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122002 = {.desc ="reduce_stage_1_tid_res_arr_mem_122002", .mem =futhark_mc_segred_stage_1_parloop_struct_127482->free_reduce_stage_1_tid_res_arr_mem_122002, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t mem_117933_cached_sizze_127484 = 0;
    unsigned char *mem_117933 = NULL;
    int64_t flat_tid_117903;
    
    flat_tid_117903 = subtask_id;
    {
        double eta_p_122004;
        double eta_p_122005;
        double eta_p_122007;
        double eta_p_122008;
        double eta_p_122010;
        double eta_p_122011;
        double eta_p_122013;
        double eta_p_122014;
        double eta_p_122016;
        double eta_p_122017;
        double eta_p_122019;
        double eta_p_122020;
        double eta_p_122022;
        double eta_p_122023;
        double eta_p_122025;
        double eta_p_122026;
        double eta_p_122028;
        double eta_p_122029;
        double local_acc_122031 = 0.0;
        double local_acc_122032 = 0.0;
        double local_acc_122033 = 0.0;
        double local_acc_122034 = 0.0;
        double local_acc_122035 = 0.0;
        double local_acc_122036 = 0.0;
        double local_acc_122037 = 0.0;
        double local_acc_122038 = 0.0;
        double local_acc_122039 = 0.0;
        double eta_p_117905;
        double eta_p_117906;
        double eta_p_117908;
        double eta_p_117909;
        double eta_p_117911;
        double eta_p_117912;
        double eta_p_117914;
        double eta_p_117915;
        double eta_p_117917;
        double eta_p_117918;
        double eta_p_117920;
        double eta_p_117921;
        double eta_p_117923;
        double eta_p_117924;
        double eta_p_117926;
        double eta_p_117927;
        double eta_p_117929;
        double eta_p_117930;
        double local_acc_122040 = 0.0;
        double local_acc_122041 = 0.0;
        double local_acc_122042 = 0.0;
        double local_acc_122043 = 0.0;
        double local_acc_122044 = 0.0;
        double local_acc_122045 = 0.0;
        double local_acc_122046 = 0.0;
        double local_acc_122047 = 0.0;
        double local_acc_122048 = 0.0;
        int64_t start_122049;
        int64_t end_122050;
        
        start_122049 = start;
        end_122050 = end;
        
        int64_t n_122051 = end_122050 - start_122049;
        
        if (mem_117933_cached_sizze_127484 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_117933, &mem_117933_cached_sizze_127484, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        for (int64_t SegRed_i_122052 = start_122049; SegRed_i_122052 < start_122049 + n_122051; SegRed_i_122052++) {
            int64_t gtid_117904 = SegRed_i_122052;
            double x_117932 = ((double *) distrs_mem_111708.mem)[eta_p_106382 * m_33388 + gtid_117904];
            double defunc_res_117935;
            double defunc_res_117936;
            double defunc_res_117937;
            double defunc_res_117938;
            double defunc_res_117939;
            double defunc_res_117940;
            double defunc_res_117941;
            double defunc_res_117942;
            double redout_117945;
            double redout_117946;
            double redout_117947;
            double redout_117948;
            double redout_117949;
            double redout_117950;
            double redout_117951;
            double redout_117952;
            
            redout_117945 = 0.0;
            redout_117946 = 0.0;
            redout_117947 = 0.0;
            redout_117948 = 0.0;
            redout_117949 = 0.0;
            redout_117950 = 0.0;
            redout_117951 = 0.0;
            redout_117952 = 0.0;
            for (int64_t i_117944 = 0; i_117944 < m_33388; i_117944++) {
                double eta_p_117954 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + i_117944];
                double zt_res_117955 = x_117932 * eta_p_117954;
                bool zeze_res_117956 = zt_res_117955 == 0.0;
                double klu_res_117957;
                
                if (zeze_res_117956) {
                    klu_res_117957 = 0.0;
                } else {
                    double zs_res_117958 = zt_res_117955 / zt_res_117955;
                    double log_res_117959 = futrts_log64(zs_res_117958);
                    double zt_res_117960 = zt_res_117955 * log_res_117959;
                    
                    klu_res_117957 = zt_res_117960;
                }
                
                double klu_res_117961;
                
                if (zeze_res_117956) {
                    klu_res_117961 = 0.0;
                } else {
                    double zs_res_117962 = zt_res_117955 / zt_res_117955;
                    double log_res_117963 = futrts_log64(zs_res_117962);
                    double zt_res_117964 = zt_res_117955 * log_res_117963;
                    
                    klu_res_117961 = zt_res_117964;
                }
                
                double zp_res_117965 = klu_res_117957 + redout_117945;
                double zp_res_117966 = klu_res_117961 + redout_117946;
                double zp_res_117967 = zt_res_117955 + redout_117947;
                double zp_res_117968 = zt_res_117955 + redout_117948;
                double zp_res_117969 = zt_res_117955 + redout_117949;
                double zp_res_117970 = zt_res_117955 + redout_117950;
                double zp_res_117971 = zt_res_117955 + redout_117951;
                double zp_res_117972 = zt_res_117955 + redout_117952;
                
                ((double *) mem_117933)[i_117944] = zt_res_117955;
                
                double redout_tmp_122053 = zp_res_117965;
                double redout_tmp_122054 = zp_res_117966;
                double redout_tmp_122055 = zp_res_117967;
                double redout_tmp_122056 = zp_res_117968;
                double redout_tmp_122057 = zp_res_117969;
                double redout_tmp_122058 = zp_res_117970;
                double redout_tmp_122059 = zp_res_117971;
                double redout_tmp_122060 = zp_res_117972;
                
                redout_117945 = redout_tmp_122053;
                redout_117946 = redout_tmp_122054;
                redout_117947 = redout_tmp_122055;
                redout_117948 = redout_tmp_122056;
                redout_117949 = redout_tmp_122057;
                redout_117950 = redout_tmp_122058;
                redout_117951 = redout_tmp_122059;
                redout_117952 = redout_tmp_122060;
            }
            defunc_res_117935 = redout_117945;
            defunc_res_117936 = redout_117946;
            defunc_res_117937 = redout_117947;
            defunc_res_117938 = redout_117948;
            defunc_res_117939 = redout_117949;
            defunc_res_117940 = redout_117950;
            defunc_res_117941 = redout_117951;
            defunc_res_117942 = redout_117952;
            
            bool zeze_res_117974 = defunc_res_117941 == 0.0;
            double klu_res_117975;
            
            if (zeze_res_117974) {
                klu_res_117975 = 0.0;
            } else {
                double zs_res_117976 = defunc_res_117941 / x_117932;
                double log_res_117977 = futrts_log64(zs_res_117976);
                double zt_res_117978 = defunc_res_117941 * log_res_117977;
                
                klu_res_117975 = zt_res_117978;
            }
            
            bool zeze_res_117979 = defunc_res_117939 == 0.0;
            double klu_res_117980;
            
            if (zeze_res_117979) {
                klu_res_117980 = 0.0;
            } else {
                double zs_res_117981 = defunc_res_117939 / x_117932;
                double log_res_117982 = futrts_log64(zs_res_117981);
                double zt_res_117983 = defunc_res_117939 * log_res_117982;
                
                klu_res_117980 = zt_res_117983;
            }
            // save map-out results
            {
                ((double *) mem_111739.mem)[gtid_117904] = defunc_res_117937;
                ((double *) mem_111741.mem)[gtid_117904] = defunc_res_117938;
                lmad_copy_8b(ctx, 1, (uint64_t *) mem_111744.mem, gtid_117904 * m_33388, (int64_t []) {(int64_t) 1}, (uint64_t *) mem_117933, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_33388});
            }
            // Load accum params
            {
                eta_p_117905 = local_acc_122040;
            }
            // Load next params
            {
                eta_p_117906 = defunc_res_117942;
            }
            // SegRed body
            {
                double zp_res_117907 = eta_p_117905 + eta_p_117906;
                
                local_acc_122040 = zp_res_117907;
            }
            // Load accum params
            {
                eta_p_117908 = local_acc_122041;
            }
            // Load next params
            {
                eta_p_117909 = klu_res_117975;
            }
            // SegRed body
            {
                double zp_res_117910 = eta_p_117908 + eta_p_117909;
                
                local_acc_122041 = zp_res_117910;
            }
            // Load accum params
            {
                eta_p_117911 = local_acc_122042;
            }
            // Load next params
            {
                eta_p_117912 = defunc_res_117935;
            }
            // SegRed body
            {
                double zp_res_117913 = eta_p_117911 + eta_p_117912;
                
                local_acc_122042 = zp_res_117913;
            }
            // Load accum params
            {
                eta_p_117914 = local_acc_122043;
            }
            // Load next params
            {
                eta_p_117915 = defunc_res_117940;
            }
            // SegRed body
            {
                double zp_res_117916 = eta_p_117914 + eta_p_117915;
                
                local_acc_122043 = zp_res_117916;
            }
            // Load accum params
            {
                eta_p_117917 = local_acc_122044;
            }
            // Load next params
            {
                eta_p_117918 = klu_res_117980;
            }
            // SegRed body
            {
                double zp_res_117919 = eta_p_117917 + eta_p_117918;
                
                local_acc_122044 = zp_res_117919;
            }
            // Load accum params
            {
                eta_p_117920 = local_acc_122045;
            }
            // Load next params
            {
                eta_p_117921 = defunc_res_117939;
            }
            // SegRed body
            {
                double zp_res_117922 = eta_p_117920 + eta_p_117921;
                
                local_acc_122045 = zp_res_117922;
            }
            // Load accum params
            {
                eta_p_117923 = local_acc_122046;
            }
            // Load next params
            {
                eta_p_117924 = defunc_res_117936;
            }
            // SegRed body
            {
                double zp_res_117925 = eta_p_117923 + eta_p_117924;
                
                local_acc_122046 = zp_res_117925;
            }
            // Load accum params
            {
                eta_p_117926 = local_acc_122047;
            }
            // Load next params
            {
                eta_p_117927 = x_117932;
            }
            // SegRed body
            {
                double zp_res_117928 = eta_p_117926 + eta_p_117927;
                
                local_acc_122047 = zp_res_117928;
            }
            // Load accum params
            {
                eta_p_117929 = local_acc_122048;
            }
            // Load next params
            {
                eta_p_117930 = x_117932;
            }
            // SegRed body
            {
                double zp_res_117931 = eta_p_117929 + eta_p_117930;
                
                local_acc_122048 = zp_res_117931;
            }
        }
        
        int64_t uni_i_122062 = 0;
        
        {
            int64_t gtid_117904 = uni_i_122062;
            
            // Load accum params
            {
                eta_p_122004 = local_acc_122031;
            }
            // Load next params
            {
                eta_p_122005 = local_acc_122040;
            }
            // SegRed body
            {
                double zp_res_122006 = eta_p_122004 + eta_p_122005;
                
                local_acc_122031 = zp_res_122006;
            }
            // Load accum params
            {
                eta_p_122007 = local_acc_122032;
            }
            // Load next params
            {
                eta_p_122008 = local_acc_122041;
            }
            // SegRed body
            {
                double zp_res_122009 = eta_p_122007 + eta_p_122008;
                
                local_acc_122032 = zp_res_122009;
            }
            // Load accum params
            {
                eta_p_122010 = local_acc_122033;
            }
            // Load next params
            {
                eta_p_122011 = local_acc_122042;
            }
            // SegRed body
            {
                double zp_res_122012 = eta_p_122010 + eta_p_122011;
                
                local_acc_122033 = zp_res_122012;
            }
            // Load accum params
            {
                eta_p_122013 = local_acc_122034;
            }
            // Load next params
            {
                eta_p_122014 = local_acc_122043;
            }
            // SegRed body
            {
                double zp_res_122015 = eta_p_122013 + eta_p_122014;
                
                local_acc_122034 = zp_res_122015;
            }
            // Load accum params
            {
                eta_p_122016 = local_acc_122035;
            }
            // Load next params
            {
                eta_p_122017 = local_acc_122044;
            }
            // SegRed body
            {
                double zp_res_122018 = eta_p_122016 + eta_p_122017;
                
                local_acc_122035 = zp_res_122018;
            }
            // Load accum params
            {
                eta_p_122019 = local_acc_122036;
            }
            // Load next params
            {
                eta_p_122020 = local_acc_122045;
            }
            // SegRed body
            {
                double zp_res_122021 = eta_p_122019 + eta_p_122020;
                
                local_acc_122036 = zp_res_122021;
            }
            // Load accum params
            {
                eta_p_122022 = local_acc_122037;
            }
            // Load next params
            {
                eta_p_122023 = local_acc_122046;
            }
            // SegRed body
            {
                double zp_res_122024 = eta_p_122022 + eta_p_122023;
                
                local_acc_122037 = zp_res_122024;
            }
            // Load accum params
            {
                eta_p_122025 = local_acc_122038;
            }
            // Load next params
            {
                eta_p_122026 = local_acc_122047;
            }
            // SegRed body
            {
                double zp_res_122027 = eta_p_122025 + eta_p_122026;
                
                local_acc_122038 = zp_res_122027;
            }
            // Load accum params
            {
                eta_p_122028 = local_acc_122039;
            }
            // Load next params
            {
                eta_p_122029 = local_acc_122048;
            }
            // SegRed body
            {
                double zp_res_122030 = eta_p_122028 + eta_p_122029;
                
                local_acc_122039 = zp_res_122030;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_121986.mem)[flat_tid_117903] = local_acc_122031;
        ((double *) reduce_stage_1_tid_res_arr_mem_121988.mem)[flat_tid_117903] = local_acc_122032;
        ((double *) reduce_stage_1_tid_res_arr_mem_121990.mem)[flat_tid_117903] = local_acc_122033;
        ((double *) reduce_stage_1_tid_res_arr_mem_121992.mem)[flat_tid_117903] = local_acc_122034;
        ((double *) reduce_stage_1_tid_res_arr_mem_121994.mem)[flat_tid_117903] = local_acc_122035;
        ((double *) reduce_stage_1_tid_res_arr_mem_121996.mem)[flat_tid_117903] = local_acc_122036;
        ((double *) reduce_stage_1_tid_res_arr_mem_121998.mem)[flat_tid_117903] = local_acc_122037;
        ((double *) reduce_stage_1_tid_res_arr_mem_122000.mem)[flat_tid_117903] = local_acc_122038;
        ((double *) reduce_stage_1_tid_res_arr_mem_122002.mem)[flat_tid_117903] = local_acc_122039;
    }
    
  cleanup:
    {
        free(mem_117933);
    }
    if (event_127485 != NULL) {
        event_127485->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127483", strdup("nothing further"), event_127485, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127472(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127471 *futhark_mc_task_127471 = (struct futhark_mc_task_127471 *) args;
    struct futhark_context *ctx = futhark_mc_task_127471->ctx;
    struct mc_event *event_127487 = mc_event_new(ctx);
    
    if (event_127487 != NULL)
        event_127487->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127471->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_127471->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_127471->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_127471->free_distrs_mem_111708, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_task_127471->free_bytes_111715;
    int64_t flat_tid_117816 = futhark_mc_task_127471->free_flat_tid_117816;
    int64_t flat_tid_117903 = futhark_mc_task_127471->free_flat_tid_117903;
    double defunc_res_106404 = *futhark_mc_task_127471->retval_defunc_res_106404;
    double defunc_res_106405 = *futhark_mc_task_127471->retval_defunc_res_106405;
    double defunc_res_106406 = *futhark_mc_task_127471->retval_defunc_res_106406;
    double defunc_res_106407 = *futhark_mc_task_127471->retval_defunc_res_106407;
    double defunc_res_106408 = *futhark_mc_task_127471->retval_defunc_res_106408;
    double defunc_res_106409 = *futhark_mc_task_127471->retval_defunc_res_106409;
    double defunc_res_106410 = *futhark_mc_task_127471->retval_defunc_res_106410;
    double defunc_res_106411 = *futhark_mc_task_127471->retval_defunc_res_106411;
    double defunc_res_106412 = *futhark_mc_task_127471->retval_defunc_res_106412;
    struct memblock mem_111739 = {.desc ="mem_111739", .mem =futhark_mc_task_127471->retval_mem_111739, .size =0, .references =NULL};
    struct memblock mem_111741 = {.desc ="mem_111741", .mem =futhark_mc_task_127471->retval_mem_111741, .size =0, .references =NULL};
    struct memblock mem_111744 = {.desc ="mem_111744", .mem =futhark_mc_task_127471->retval_mem_111744, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_121986_cached_sizze_127473 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_121986 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_121988_cached_sizze_127474 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_121988 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_121990_cached_sizze_127475 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_121990 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_121992_cached_sizze_127476 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_121992 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_121994_cached_sizze_127477 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_121994 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_121996_cached_sizze_127478 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_121996 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_121998_cached_sizze_127479 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_121998 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_122000_cached_sizze_127480 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122000 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_122002_cached_sizze_127481 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122002 = NULL;
    int32_t nsubtasks_121985;
    
    nsubtasks_121985 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_121986_cached_sizze_127473 < (int64_t) 8 * nsubtasks_121985) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_121986, &reduce_stage_1_tid_res_arr_mem_121986_cached_sizze_127473, (int64_t) 8 * nsubtasks_121985);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_121988_cached_sizze_127474 < (int64_t) 8 * nsubtasks_121985) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_121988, &reduce_stage_1_tid_res_arr_mem_121988_cached_sizze_127474, (int64_t) 8 * nsubtasks_121985);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_121990_cached_sizze_127475 < (int64_t) 8 * nsubtasks_121985) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_121990, &reduce_stage_1_tid_res_arr_mem_121990_cached_sizze_127475, (int64_t) 8 * nsubtasks_121985);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_121992_cached_sizze_127476 < (int64_t) 8 * nsubtasks_121985) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_121992, &reduce_stage_1_tid_res_arr_mem_121992_cached_sizze_127476, (int64_t) 8 * nsubtasks_121985);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_121994_cached_sizze_127477 < (int64_t) 8 * nsubtasks_121985) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_121994, &reduce_stage_1_tid_res_arr_mem_121994_cached_sizze_127477, (int64_t) 8 * nsubtasks_121985);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_121996_cached_sizze_127478 < (int64_t) 8 * nsubtasks_121985) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_121996, &reduce_stage_1_tid_res_arr_mem_121996_cached_sizze_127478, (int64_t) 8 * nsubtasks_121985);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_121998_cached_sizze_127479 < (int64_t) 8 * nsubtasks_121985) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_121998, &reduce_stage_1_tid_res_arr_mem_121998_cached_sizze_127479, (int64_t) 8 * nsubtasks_121985);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_122000_cached_sizze_127480 < (int64_t) 8 * nsubtasks_121985) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122000, &reduce_stage_1_tid_res_arr_mem_122000_cached_sizze_127480, (int64_t) 8 * nsubtasks_121985);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_122002_cached_sizze_127481 < (int64_t) 8 * nsubtasks_121985) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122002, &reduce_stage_1_tid_res_arr_mem_122002_cached_sizze_127481, (int64_t) 8 * nsubtasks_121985);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127482 futhark_mc_segred_stage_1_parloop_struct_127482_;
    
    futhark_mc_segred_stage_1_parloop_struct_127482_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127482_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127482_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_127482_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_127482_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_127482_.free_bytes_111715 = bytes_111715;
    futhark_mc_segred_stage_1_parloop_struct_127482_.free_mem_111739 = mem_111739.mem;
    futhark_mc_segred_stage_1_parloop_struct_127482_.free_mem_111741 = mem_111741.mem;
    futhark_mc_segred_stage_1_parloop_struct_127482_.free_mem_111744 = mem_111744.mem;
    futhark_mc_segred_stage_1_parloop_struct_127482_.free_reduce_stage_1_tid_res_arr_mem_121986 = reduce_stage_1_tid_res_arr_mem_121986;
    futhark_mc_segred_stage_1_parloop_struct_127482_.free_reduce_stage_1_tid_res_arr_mem_121988 = reduce_stage_1_tid_res_arr_mem_121988;
    futhark_mc_segred_stage_1_parloop_struct_127482_.free_reduce_stage_1_tid_res_arr_mem_121990 = reduce_stage_1_tid_res_arr_mem_121990;
    futhark_mc_segred_stage_1_parloop_struct_127482_.free_reduce_stage_1_tid_res_arr_mem_121992 = reduce_stage_1_tid_res_arr_mem_121992;
    futhark_mc_segred_stage_1_parloop_struct_127482_.free_reduce_stage_1_tid_res_arr_mem_121994 = reduce_stage_1_tid_res_arr_mem_121994;
    futhark_mc_segred_stage_1_parloop_struct_127482_.free_reduce_stage_1_tid_res_arr_mem_121996 = reduce_stage_1_tid_res_arr_mem_121996;
    futhark_mc_segred_stage_1_parloop_struct_127482_.free_reduce_stage_1_tid_res_arr_mem_121998 = reduce_stage_1_tid_res_arr_mem_121998;
    futhark_mc_segred_stage_1_parloop_struct_127482_.free_reduce_stage_1_tid_res_arr_mem_122000 = reduce_stage_1_tid_res_arr_mem_122000;
    futhark_mc_segred_stage_1_parloop_struct_127482_.free_reduce_stage_1_tid_res_arr_mem_122002 = reduce_stage_1_tid_res_arr_mem_122002;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127483_task;
    
    futhark_mc_segred_stage_1_parloop_127483_task.name = "futhark_mc_segred_stage_1_parloop_127483";
    futhark_mc_segred_stage_1_parloop_127483_task.fn = futhark_mc_segred_stage_1_parloop_127483;
    futhark_mc_segred_stage_1_parloop_127483_task.args = &futhark_mc_segred_stage_1_parloop_struct_127482_;
    futhark_mc_segred_stage_1_parloop_127483_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127483_task.info = info;
    
    struct mc_event *event_127486 = mc_event_new(ctx);
    
    if (event_127486 != NULL)
        event_127486->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127483_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127483_task);
    
    if (futhark_mc_segred_stage_1_parloop_127483_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127483_err;
        goto cleanup;
    }
    if (event_127486 != NULL) {
        event_127486->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127483_total", strdup("nothing further"), event_127486, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_106404 = 0.0;
        defunc_res_106405 = 0.0;
        defunc_res_106406 = 0.0;
        defunc_res_106407 = 0.0;
        defunc_res_106408 = 0.0;
        defunc_res_106409 = 0.0;
        defunc_res_106410 = 0.0;
        defunc_res_106411 = 0.0;
        defunc_res_106412 = 0.0;
    }
    
    double eta_p_122063;
    double eta_p_122064;
    double eta_p_122066;
    double eta_p_122067;
    double eta_p_122069;
    double eta_p_122070;
    double eta_p_122072;
    double eta_p_122073;
    double eta_p_122075;
    double eta_p_122076;
    double eta_p_122078;
    double eta_p_122079;
    double eta_p_122081;
    double eta_p_122082;
    double eta_p_122084;
    double eta_p_122085;
    double eta_p_122087;
    double eta_p_122088;
    
    for (int32_t i_122090 = 0; i_122090 < nsubtasks_121985; i_122090++) {
        flat_tid_117903 = i_122090;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_122063 = defunc_res_106404;
            }
            // load next params
            {
                eta_p_122064 = ((double *) reduce_stage_1_tid_res_arr_mem_121986)[flat_tid_117903];
            }
            // red body
            {
                double zp_res_122065 = eta_p_122063 + eta_p_122064;
                
                defunc_res_106404 = zp_res_122065;
            }
            // load acc params
            {
                eta_p_122066 = defunc_res_106405;
            }
            // load next params
            {
                eta_p_122067 = ((double *) reduce_stage_1_tid_res_arr_mem_121988)[flat_tid_117903];
            }
            // red body
            {
                double zp_res_122068 = eta_p_122066 + eta_p_122067;
                
                defunc_res_106405 = zp_res_122068;
            }
            // load acc params
            {
                eta_p_122069 = defunc_res_106406;
            }
            // load next params
            {
                eta_p_122070 = ((double *) reduce_stage_1_tid_res_arr_mem_121990)[flat_tid_117903];
            }
            // red body
            {
                double zp_res_122071 = eta_p_122069 + eta_p_122070;
                
                defunc_res_106406 = zp_res_122071;
            }
            // load acc params
            {
                eta_p_122072 = defunc_res_106407;
            }
            // load next params
            {
                eta_p_122073 = ((double *) reduce_stage_1_tid_res_arr_mem_121992)[flat_tid_117903];
            }
            // red body
            {
                double zp_res_122074 = eta_p_122072 + eta_p_122073;
                
                defunc_res_106407 = zp_res_122074;
            }
            // load acc params
            {
                eta_p_122075 = defunc_res_106408;
            }
            // load next params
            {
                eta_p_122076 = ((double *) reduce_stage_1_tid_res_arr_mem_121994)[flat_tid_117903];
            }
            // red body
            {
                double zp_res_122077 = eta_p_122075 + eta_p_122076;
                
                defunc_res_106408 = zp_res_122077;
            }
            // load acc params
            {
                eta_p_122078 = defunc_res_106409;
            }
            // load next params
            {
                eta_p_122079 = ((double *) reduce_stage_1_tid_res_arr_mem_121996)[flat_tid_117903];
            }
            // red body
            {
                double zp_res_122080 = eta_p_122078 + eta_p_122079;
                
                defunc_res_106409 = zp_res_122080;
            }
            // load acc params
            {
                eta_p_122081 = defunc_res_106410;
            }
            // load next params
            {
                eta_p_122082 = ((double *) reduce_stage_1_tid_res_arr_mem_121998)[flat_tid_117903];
            }
            // red body
            {
                double zp_res_122083 = eta_p_122081 + eta_p_122082;
                
                defunc_res_106410 = zp_res_122083;
            }
            // load acc params
            {
                eta_p_122084 = defunc_res_106411;
            }
            // load next params
            {
                eta_p_122085 = ((double *) reduce_stage_1_tid_res_arr_mem_122000)[flat_tid_117903];
            }
            // red body
            {
                double zp_res_122086 = eta_p_122084 + eta_p_122085;
                
                defunc_res_106411 = zp_res_122086;
            }
            // load acc params
            {
                eta_p_122087 = defunc_res_106412;
            }
            // load next params
            {
                eta_p_122088 = ((double *) reduce_stage_1_tid_res_arr_mem_122002)[flat_tid_117903];
            }
            // red body
            {
                double zp_res_122089 = eta_p_122087 + eta_p_122088;
                
                defunc_res_106412 = zp_res_122089;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_121986);
        free(reduce_stage_1_tid_res_arr_mem_121988);
        free(reduce_stage_1_tid_res_arr_mem_121990);
        free(reduce_stage_1_tid_res_arr_mem_121992);
        free(reduce_stage_1_tid_res_arr_mem_121994);
        free(reduce_stage_1_tid_res_arr_mem_121996);
        free(reduce_stage_1_tid_res_arr_mem_121998);
        free(reduce_stage_1_tid_res_arr_mem_122000);
        free(reduce_stage_1_tid_res_arr_mem_122002);
    }
    if (event_127487 != NULL) {
        event_127487->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127472", strdup("nothing further"), event_127487, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127471->retval_defunc_res_106404 = defunc_res_106404;
        *futhark_mc_task_127471->retval_defunc_res_106405 = defunc_res_106405;
        *futhark_mc_task_127471->retval_defunc_res_106406 = defunc_res_106406;
        *futhark_mc_task_127471->retval_defunc_res_106407 = defunc_res_106407;
        *futhark_mc_task_127471->retval_defunc_res_106408 = defunc_res_106408;
        *futhark_mc_task_127471->retval_defunc_res_106409 = defunc_res_106409;
        *futhark_mc_task_127471->retval_defunc_res_106410 = defunc_res_106410;
        *futhark_mc_task_127471->retval_defunc_res_106411 = defunc_res_106411;
        *futhark_mc_task_127471->retval_defunc_res_106412 = defunc_res_106412;
        futhark_mc_task_127471->retval_mem_111739 = mem_111739.mem;
        futhark_mc_task_127471->retval_mem_111741 = mem_111741.mem;
        futhark_mc_task_127471->retval_mem_111744 = mem_111744.mem;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_127498 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    int64_t free_bytes_111715;
    unsigned char *free_mem_111739;
    unsigned char *free_mem_111741;
    unsigned char *free_mem_111744;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122092;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122094;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122096;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122098;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122100;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122102;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122104;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122106;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122108;
};
struct futhark_mc_task_127501 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    double free_x_117845;
    int64_t free_flat_tid_117856;
    double *retval_defunc_res_117847;
    double *retval_defunc_res_117848;
    double *retval_defunc_res_117849;
    double *retval_defunc_res_117850;
    double *retval_defunc_res_117851;
    double *retval_defunc_res_117852;
    double *retval_defunc_res_117853;
    double *retval_defunc_res_117854;
    unsigned char *retval_mem_117846;
};
struct futhark_mc_segred_stage_1_parloop_struct_127511 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    double free_x_117845;
    unsigned char *free_mem_117846;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122160;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122162;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122164;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122166;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122168;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122170;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122172;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122174;
};
static int futhark_mc_segred_stage_1_parloop_127512(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127511 *futhark_mc_segred_stage_1_parloop_struct_127511 = (struct futhark_mc_segred_stage_1_parloop_struct_127511 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127511->ctx;
    struct mc_event *event_127513 = mc_event_new(ctx);
    
    if (event_127513 != NULL)
        event_127513->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127511->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_127511->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_127511->free_distrs_mem_111708, .size =0, .references =NULL};
    double x_117845 = futhark_mc_segred_stage_1_parloop_struct_127511->free_x_117845;
    struct memblock mem_117846 = {.desc ="mem_117846", .mem =futhark_mc_segred_stage_1_parloop_struct_127511->free_mem_117846, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122160 = {.desc ="reduce_stage_1_tid_res_arr_mem_122160", .mem =futhark_mc_segred_stage_1_parloop_struct_127511->free_reduce_stage_1_tid_res_arr_mem_122160, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122162 = {.desc ="reduce_stage_1_tid_res_arr_mem_122162", .mem =futhark_mc_segred_stage_1_parloop_struct_127511->free_reduce_stage_1_tid_res_arr_mem_122162, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122164 = {.desc ="reduce_stage_1_tid_res_arr_mem_122164", .mem =futhark_mc_segred_stage_1_parloop_struct_127511->free_reduce_stage_1_tid_res_arr_mem_122164, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122166 = {.desc ="reduce_stage_1_tid_res_arr_mem_122166", .mem =futhark_mc_segred_stage_1_parloop_struct_127511->free_reduce_stage_1_tid_res_arr_mem_122166, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122168 = {.desc ="reduce_stage_1_tid_res_arr_mem_122168", .mem =futhark_mc_segred_stage_1_parloop_struct_127511->free_reduce_stage_1_tid_res_arr_mem_122168, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122170 = {.desc ="reduce_stage_1_tid_res_arr_mem_122170", .mem =futhark_mc_segred_stage_1_parloop_struct_127511->free_reduce_stage_1_tid_res_arr_mem_122170, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122172 = {.desc ="reduce_stage_1_tid_res_arr_mem_122172", .mem =futhark_mc_segred_stage_1_parloop_struct_127511->free_reduce_stage_1_tid_res_arr_mem_122172, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122174 = {.desc ="reduce_stage_1_tid_res_arr_mem_122174", .mem =futhark_mc_segred_stage_1_parloop_struct_127511->free_reduce_stage_1_tid_res_arr_mem_122174, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_117856;
    
    flat_tid_117856 = subtask_id;
    {
        double eta_p_122176;
        double eta_p_122177;
        double eta_p_122179;
        double eta_p_122180;
        double eta_p_122182;
        double eta_p_122183;
        double eta_p_122185;
        double eta_p_122186;
        double eta_p_122188;
        double eta_p_122189;
        double eta_p_122191;
        double eta_p_122192;
        double eta_p_122194;
        double eta_p_122195;
        double eta_p_122197;
        double eta_p_122198;
        double local_acc_122200 = 0.0;
        double local_acc_122201 = 0.0;
        double local_acc_122202 = 0.0;
        double local_acc_122203 = 0.0;
        double local_acc_122204 = 0.0;
        double local_acc_122205 = 0.0;
        double local_acc_122206 = 0.0;
        double local_acc_122207 = 0.0;
        double eta_p_117858;
        double eta_p_117859;
        double eta_p_117861;
        double eta_p_117862;
        double eta_p_117864;
        double eta_p_117865;
        double eta_p_117867;
        double eta_p_117868;
        double eta_p_117870;
        double eta_p_117871;
        double eta_p_117873;
        double eta_p_117874;
        double eta_p_117876;
        double eta_p_117877;
        double eta_p_117879;
        double eta_p_117880;
        double local_acc_122208 = 0.0;
        double local_acc_122209 = 0.0;
        double local_acc_122210 = 0.0;
        double local_acc_122211 = 0.0;
        double local_acc_122212 = 0.0;
        double local_acc_122213 = 0.0;
        double local_acc_122214 = 0.0;
        double local_acc_122215 = 0.0;
        int64_t start_122216;
        int64_t end_122217;
        
        start_122216 = start;
        end_122217 = end;
        
        int64_t n_122218 = end_122217 - start_122216;
        
        for (int64_t SegRed_i_122219 = start_122216; SegRed_i_122219 < start_122216 + n_122218; SegRed_i_122219++) {
            int64_t gtid_117857 = SegRed_i_122219;
            double eta_p_117882 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + gtid_117857];
            double zt_res_117883 = x_117845 * eta_p_117882;
            bool zeze_res_117884 = zt_res_117883 == 0.0;
            double klu_res_117885;
            
            if (zeze_res_117884) {
                klu_res_117885 = 0.0;
            } else {
                double zs_res_117886 = zt_res_117883 / zt_res_117883;
                double log_res_117887 = futrts_log64(zs_res_117886);
                double zt_res_117888 = zt_res_117883 * log_res_117887;
                
                klu_res_117885 = zt_res_117888;
            }
            
            double klu_res_117889;
            
            if (zeze_res_117884) {
                klu_res_117889 = 0.0;
            } else {
                double zs_res_117890 = zt_res_117883 / zt_res_117883;
                double log_res_117891 = futrts_log64(zs_res_117890);
                double zt_res_117892 = zt_res_117883 * log_res_117891;
                
                klu_res_117889 = zt_res_117892;
            }
            // save map-out results
            {
                ((double *) mem_117846.mem)[gtid_117857] = zt_res_117883;
            }
            // Load accum params
            {
                eta_p_117858 = local_acc_122208;
            }
            // Load next params
            {
                eta_p_117859 = klu_res_117885;
            }
            // SegRed body
            {
                double zp_res_117860 = eta_p_117858 + eta_p_117859;
                
                local_acc_122208 = zp_res_117860;
            }
            // Load accum params
            {
                eta_p_117861 = local_acc_122209;
            }
            // Load next params
            {
                eta_p_117862 = klu_res_117889;
            }
            // SegRed body
            {
                double zp_res_117863 = eta_p_117861 + eta_p_117862;
                
                local_acc_122209 = zp_res_117863;
            }
            // Load accum params
            {
                eta_p_117864 = local_acc_122210;
            }
            // Load next params
            {
                eta_p_117865 = zt_res_117883;
            }
            // SegRed body
            {
                double zp_res_117866 = eta_p_117864 + eta_p_117865;
                
                local_acc_122210 = zp_res_117866;
            }
            // Load accum params
            {
                eta_p_117867 = local_acc_122211;
            }
            // Load next params
            {
                eta_p_117868 = zt_res_117883;
            }
            // SegRed body
            {
                double zp_res_117869 = eta_p_117867 + eta_p_117868;
                
                local_acc_122211 = zp_res_117869;
            }
            // Load accum params
            {
                eta_p_117870 = local_acc_122212;
            }
            // Load next params
            {
                eta_p_117871 = zt_res_117883;
            }
            // SegRed body
            {
                double zp_res_117872 = eta_p_117870 + eta_p_117871;
                
                local_acc_122212 = zp_res_117872;
            }
            // Load accum params
            {
                eta_p_117873 = local_acc_122213;
            }
            // Load next params
            {
                eta_p_117874 = zt_res_117883;
            }
            // SegRed body
            {
                double zp_res_117875 = eta_p_117873 + eta_p_117874;
                
                local_acc_122213 = zp_res_117875;
            }
            // Load accum params
            {
                eta_p_117876 = local_acc_122214;
            }
            // Load next params
            {
                eta_p_117877 = zt_res_117883;
            }
            // SegRed body
            {
                double zp_res_117878 = eta_p_117876 + eta_p_117877;
                
                local_acc_122214 = zp_res_117878;
            }
            // Load accum params
            {
                eta_p_117879 = local_acc_122215;
            }
            // Load next params
            {
                eta_p_117880 = zt_res_117883;
            }
            // SegRed body
            {
                double zp_res_117881 = eta_p_117879 + eta_p_117880;
                
                local_acc_122215 = zp_res_117881;
            }
        }
        
        int64_t uni_i_122220 = 0;
        
        {
            int64_t gtid_117857 = uni_i_122220;
            
            // Load accum params
            {
                eta_p_122176 = local_acc_122200;
            }
            // Load next params
            {
                eta_p_122177 = local_acc_122208;
            }
            // SegRed body
            {
                double zp_res_122178 = eta_p_122176 + eta_p_122177;
                
                local_acc_122200 = zp_res_122178;
            }
            // Load accum params
            {
                eta_p_122179 = local_acc_122201;
            }
            // Load next params
            {
                eta_p_122180 = local_acc_122209;
            }
            // SegRed body
            {
                double zp_res_122181 = eta_p_122179 + eta_p_122180;
                
                local_acc_122201 = zp_res_122181;
            }
            // Load accum params
            {
                eta_p_122182 = local_acc_122202;
            }
            // Load next params
            {
                eta_p_122183 = local_acc_122210;
            }
            // SegRed body
            {
                double zp_res_122184 = eta_p_122182 + eta_p_122183;
                
                local_acc_122202 = zp_res_122184;
            }
            // Load accum params
            {
                eta_p_122185 = local_acc_122203;
            }
            // Load next params
            {
                eta_p_122186 = local_acc_122211;
            }
            // SegRed body
            {
                double zp_res_122187 = eta_p_122185 + eta_p_122186;
                
                local_acc_122203 = zp_res_122187;
            }
            // Load accum params
            {
                eta_p_122188 = local_acc_122204;
            }
            // Load next params
            {
                eta_p_122189 = local_acc_122212;
            }
            // SegRed body
            {
                double zp_res_122190 = eta_p_122188 + eta_p_122189;
                
                local_acc_122204 = zp_res_122190;
            }
            // Load accum params
            {
                eta_p_122191 = local_acc_122205;
            }
            // Load next params
            {
                eta_p_122192 = local_acc_122213;
            }
            // SegRed body
            {
                double zp_res_122193 = eta_p_122191 + eta_p_122192;
                
                local_acc_122205 = zp_res_122193;
            }
            // Load accum params
            {
                eta_p_122194 = local_acc_122206;
            }
            // Load next params
            {
                eta_p_122195 = local_acc_122214;
            }
            // SegRed body
            {
                double zp_res_122196 = eta_p_122194 + eta_p_122195;
                
                local_acc_122206 = zp_res_122196;
            }
            // Load accum params
            {
                eta_p_122197 = local_acc_122207;
            }
            // Load next params
            {
                eta_p_122198 = local_acc_122215;
            }
            // SegRed body
            {
                double zp_res_122199 = eta_p_122197 + eta_p_122198;
                
                local_acc_122207 = zp_res_122199;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_122160.mem)[flat_tid_117856] = local_acc_122200;
        ((double *) reduce_stage_1_tid_res_arr_mem_122162.mem)[flat_tid_117856] = local_acc_122201;
        ((double *) reduce_stage_1_tid_res_arr_mem_122164.mem)[flat_tid_117856] = local_acc_122202;
        ((double *) reduce_stage_1_tid_res_arr_mem_122166.mem)[flat_tid_117856] = local_acc_122203;
        ((double *) reduce_stage_1_tid_res_arr_mem_122168.mem)[flat_tid_117856] = local_acc_122204;
        ((double *) reduce_stage_1_tid_res_arr_mem_122170.mem)[flat_tid_117856] = local_acc_122205;
        ((double *) reduce_stage_1_tid_res_arr_mem_122172.mem)[flat_tid_117856] = local_acc_122206;
        ((double *) reduce_stage_1_tid_res_arr_mem_122174.mem)[flat_tid_117856] = local_acc_122207;
    }
    
  cleanup:
    { }
    if (event_127513 != NULL) {
        event_127513->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127512", strdup("nothing further"), event_127513, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127502(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127501 *futhark_mc_task_127501 = (struct futhark_mc_task_127501 *) args;
    struct futhark_context *ctx = futhark_mc_task_127501->ctx;
    struct mc_event *event_127515 = mc_event_new(ctx);
    
    if (event_127515 != NULL)
        event_127515->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127501->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_127501->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_127501->free_distrs_mem_111708, .size =0, .references =NULL};
    double x_117845 = futhark_mc_task_127501->free_x_117845;
    int64_t flat_tid_117856 = futhark_mc_task_127501->free_flat_tid_117856;
    double defunc_res_117847 = *futhark_mc_task_127501->retval_defunc_res_117847;
    double defunc_res_117848 = *futhark_mc_task_127501->retval_defunc_res_117848;
    double defunc_res_117849 = *futhark_mc_task_127501->retval_defunc_res_117849;
    double defunc_res_117850 = *futhark_mc_task_127501->retval_defunc_res_117850;
    double defunc_res_117851 = *futhark_mc_task_127501->retval_defunc_res_117851;
    double defunc_res_117852 = *futhark_mc_task_127501->retval_defunc_res_117852;
    double defunc_res_117853 = *futhark_mc_task_127501->retval_defunc_res_117853;
    double defunc_res_117854 = *futhark_mc_task_127501->retval_defunc_res_117854;
    struct memblock mem_117846 = {.desc ="mem_117846", .mem =futhark_mc_task_127501->retval_mem_117846, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_122160_cached_sizze_127503 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122160 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_122162_cached_sizze_127504 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122162 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_122164_cached_sizze_127505 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122164 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_122166_cached_sizze_127506 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122166 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_122168_cached_sizze_127507 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122168 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_122170_cached_sizze_127508 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122170 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_122172_cached_sizze_127509 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122172 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_122174_cached_sizze_127510 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122174 = NULL;
    int32_t nsubtasks_122159;
    
    nsubtasks_122159 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_122160_cached_sizze_127503 < (int64_t) 8 * nsubtasks_122159) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122160, &reduce_stage_1_tid_res_arr_mem_122160_cached_sizze_127503, (int64_t) 8 * nsubtasks_122159);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_122162_cached_sizze_127504 < (int64_t) 8 * nsubtasks_122159) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122162, &reduce_stage_1_tid_res_arr_mem_122162_cached_sizze_127504, (int64_t) 8 * nsubtasks_122159);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_122164_cached_sizze_127505 < (int64_t) 8 * nsubtasks_122159) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122164, &reduce_stage_1_tid_res_arr_mem_122164_cached_sizze_127505, (int64_t) 8 * nsubtasks_122159);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_122166_cached_sizze_127506 < (int64_t) 8 * nsubtasks_122159) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122166, &reduce_stage_1_tid_res_arr_mem_122166_cached_sizze_127506, (int64_t) 8 * nsubtasks_122159);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_122168_cached_sizze_127507 < (int64_t) 8 * nsubtasks_122159) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122168, &reduce_stage_1_tid_res_arr_mem_122168_cached_sizze_127507, (int64_t) 8 * nsubtasks_122159);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_122170_cached_sizze_127508 < (int64_t) 8 * nsubtasks_122159) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122170, &reduce_stage_1_tid_res_arr_mem_122170_cached_sizze_127508, (int64_t) 8 * nsubtasks_122159);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_122172_cached_sizze_127509 < (int64_t) 8 * nsubtasks_122159) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122172, &reduce_stage_1_tid_res_arr_mem_122172_cached_sizze_127509, (int64_t) 8 * nsubtasks_122159);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_122174_cached_sizze_127510 < (int64_t) 8 * nsubtasks_122159) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122174, &reduce_stage_1_tid_res_arr_mem_122174_cached_sizze_127510, (int64_t) 8 * nsubtasks_122159);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127511 futhark_mc_segred_stage_1_parloop_struct_127511_;
    
    futhark_mc_segred_stage_1_parloop_struct_127511_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127511_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127511_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_127511_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_127511_.free_x_117845 = x_117845;
    futhark_mc_segred_stage_1_parloop_struct_127511_.free_mem_117846 = mem_117846.mem;
    futhark_mc_segred_stage_1_parloop_struct_127511_.free_reduce_stage_1_tid_res_arr_mem_122160 = reduce_stage_1_tid_res_arr_mem_122160;
    futhark_mc_segred_stage_1_parloop_struct_127511_.free_reduce_stage_1_tid_res_arr_mem_122162 = reduce_stage_1_tid_res_arr_mem_122162;
    futhark_mc_segred_stage_1_parloop_struct_127511_.free_reduce_stage_1_tid_res_arr_mem_122164 = reduce_stage_1_tid_res_arr_mem_122164;
    futhark_mc_segred_stage_1_parloop_struct_127511_.free_reduce_stage_1_tid_res_arr_mem_122166 = reduce_stage_1_tid_res_arr_mem_122166;
    futhark_mc_segred_stage_1_parloop_struct_127511_.free_reduce_stage_1_tid_res_arr_mem_122168 = reduce_stage_1_tid_res_arr_mem_122168;
    futhark_mc_segred_stage_1_parloop_struct_127511_.free_reduce_stage_1_tid_res_arr_mem_122170 = reduce_stage_1_tid_res_arr_mem_122170;
    futhark_mc_segred_stage_1_parloop_struct_127511_.free_reduce_stage_1_tid_res_arr_mem_122172 = reduce_stage_1_tid_res_arr_mem_122172;
    futhark_mc_segred_stage_1_parloop_struct_127511_.free_reduce_stage_1_tid_res_arr_mem_122174 = reduce_stage_1_tid_res_arr_mem_122174;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127512_task;
    
    futhark_mc_segred_stage_1_parloop_127512_task.name = "futhark_mc_segred_stage_1_parloop_127512";
    futhark_mc_segred_stage_1_parloop_127512_task.fn = futhark_mc_segred_stage_1_parloop_127512;
    futhark_mc_segred_stage_1_parloop_127512_task.args = &futhark_mc_segred_stage_1_parloop_struct_127511_;
    futhark_mc_segred_stage_1_parloop_127512_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127512_task.info = info;
    
    struct mc_event *event_127514 = mc_event_new(ctx);
    
    if (event_127514 != NULL)
        event_127514->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127512_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127512_task);
    
    if (futhark_mc_segred_stage_1_parloop_127512_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127512_err;
        goto cleanup;
    }
    if (event_127514 != NULL) {
        event_127514->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127512_total", strdup("nothing further"), event_127514, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_117847 = 0.0;
        defunc_res_117848 = 0.0;
        defunc_res_117849 = 0.0;
        defunc_res_117850 = 0.0;
        defunc_res_117851 = 0.0;
        defunc_res_117852 = 0.0;
        defunc_res_117853 = 0.0;
        defunc_res_117854 = 0.0;
    }
    
    double eta_p_122221;
    double eta_p_122222;
    double eta_p_122224;
    double eta_p_122225;
    double eta_p_122227;
    double eta_p_122228;
    double eta_p_122230;
    double eta_p_122231;
    double eta_p_122233;
    double eta_p_122234;
    double eta_p_122236;
    double eta_p_122237;
    double eta_p_122239;
    double eta_p_122240;
    double eta_p_122242;
    double eta_p_122243;
    
    for (int32_t i_122245 = 0; i_122245 < nsubtasks_122159; i_122245++) {
        flat_tid_117856 = i_122245;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_122221 = defunc_res_117847;
            }
            // load next params
            {
                eta_p_122222 = ((double *) reduce_stage_1_tid_res_arr_mem_122160)[flat_tid_117856];
            }
            // red body
            {
                double zp_res_122223 = eta_p_122221 + eta_p_122222;
                
                defunc_res_117847 = zp_res_122223;
            }
            // load acc params
            {
                eta_p_122224 = defunc_res_117848;
            }
            // load next params
            {
                eta_p_122225 = ((double *) reduce_stage_1_tid_res_arr_mem_122162)[flat_tid_117856];
            }
            // red body
            {
                double zp_res_122226 = eta_p_122224 + eta_p_122225;
                
                defunc_res_117848 = zp_res_122226;
            }
            // load acc params
            {
                eta_p_122227 = defunc_res_117849;
            }
            // load next params
            {
                eta_p_122228 = ((double *) reduce_stage_1_tid_res_arr_mem_122164)[flat_tid_117856];
            }
            // red body
            {
                double zp_res_122229 = eta_p_122227 + eta_p_122228;
                
                defunc_res_117849 = zp_res_122229;
            }
            // load acc params
            {
                eta_p_122230 = defunc_res_117850;
            }
            // load next params
            {
                eta_p_122231 = ((double *) reduce_stage_1_tid_res_arr_mem_122166)[flat_tid_117856];
            }
            // red body
            {
                double zp_res_122232 = eta_p_122230 + eta_p_122231;
                
                defunc_res_117850 = zp_res_122232;
            }
            // load acc params
            {
                eta_p_122233 = defunc_res_117851;
            }
            // load next params
            {
                eta_p_122234 = ((double *) reduce_stage_1_tid_res_arr_mem_122168)[flat_tid_117856];
            }
            // red body
            {
                double zp_res_122235 = eta_p_122233 + eta_p_122234;
                
                defunc_res_117851 = zp_res_122235;
            }
            // load acc params
            {
                eta_p_122236 = defunc_res_117852;
            }
            // load next params
            {
                eta_p_122237 = ((double *) reduce_stage_1_tid_res_arr_mem_122170)[flat_tid_117856];
            }
            // red body
            {
                double zp_res_122238 = eta_p_122236 + eta_p_122237;
                
                defunc_res_117852 = zp_res_122238;
            }
            // load acc params
            {
                eta_p_122239 = defunc_res_117853;
            }
            // load next params
            {
                eta_p_122240 = ((double *) reduce_stage_1_tid_res_arr_mem_122172)[flat_tid_117856];
            }
            // red body
            {
                double zp_res_122241 = eta_p_122239 + eta_p_122240;
                
                defunc_res_117853 = zp_res_122241;
            }
            // load acc params
            {
                eta_p_122242 = defunc_res_117854;
            }
            // load next params
            {
                eta_p_122243 = ((double *) reduce_stage_1_tid_res_arr_mem_122174)[flat_tid_117856];
            }
            // red body
            {
                double zp_res_122244 = eta_p_122242 + eta_p_122243;
                
                defunc_res_117854 = zp_res_122244;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_122160);
        free(reduce_stage_1_tid_res_arr_mem_122162);
        free(reduce_stage_1_tid_res_arr_mem_122164);
        free(reduce_stage_1_tid_res_arr_mem_122166);
        free(reduce_stage_1_tid_res_arr_mem_122168);
        free(reduce_stage_1_tid_res_arr_mem_122170);
        free(reduce_stage_1_tid_res_arr_mem_122172);
        free(reduce_stage_1_tid_res_arr_mem_122174);
    }
    if (event_127515 != NULL) {
        event_127515->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127502", strdup("nothing further"), event_127515, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127501->retval_defunc_res_117847 = defunc_res_117847;
        *futhark_mc_task_127501->retval_defunc_res_117848 = defunc_res_117848;
        *futhark_mc_task_127501->retval_defunc_res_117849 = defunc_res_117849;
        *futhark_mc_task_127501->retval_defunc_res_117850 = defunc_res_117850;
        *futhark_mc_task_127501->retval_defunc_res_117851 = defunc_res_117851;
        *futhark_mc_task_127501->retval_defunc_res_117852 = defunc_res_117852;
        *futhark_mc_task_127501->retval_defunc_res_117853 = defunc_res_117853;
        *futhark_mc_task_127501->retval_defunc_res_117854 = defunc_res_117854;
        futhark_mc_task_127501->retval_mem_117846 = mem_117846.mem;
    }
    return err;
}
struct futhark_mc_task_127516 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_111744;
    int64_t free_gtid_117817;
    unsigned char *free_mem_117846;
};
struct futhark_mc_copy_parloop_struct_127518 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_111744;
    int64_t free_gtid_117817;
    unsigned char *free_mem_117846;
};
static int futhark_mc_copy_parloop_127519(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_copy_parloop_struct_127518 *futhark_mc_copy_parloop_struct_127518 = (struct futhark_mc_copy_parloop_struct_127518 *) args;
    struct futhark_context *ctx = futhark_mc_copy_parloop_struct_127518->ctx;
    struct mc_event *event_127520 = mc_event_new(ctx);
    
    if (event_127520 != NULL)
        event_127520->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_copy_parloop_struct_127518->free_m_33388;
    struct memblock mem_111744 = {.desc ="mem_111744", .mem =futhark_mc_copy_parloop_struct_127518->free_mem_111744, .size =0, .references =NULL};
    int64_t gtid_117817 = futhark_mc_copy_parloop_struct_127518->free_gtid_117817;
    struct memblock mem_117846 = {.desc ="mem_117846", .mem =futhark_mc_copy_parloop_struct_127518->free_mem_117846, .size =0, .references =NULL};
    int64_t iterations = end - start;
    
    {
        int64_t start_122246;
        int64_t end_122247;
        
        start_122246 = start;
        end_122247 = end;
        
        int64_t n_122248 = end_122247 - start_122246;
        
        for (int64_t copy_i_122249 = start_122246; copy_i_122249 < start_122246 + n_122248; copy_i_122249++) {
            int64_t slice_122251 = m_33388;
            int64_t i_122250 = copy_i_122249;
            int64_t remnant_122252 = copy_i_122249 - i_122250;
            double tmp_122253 = ((double *) mem_117846.mem)[i_122250];
            
            ((double *) mem_111744.mem)[gtid_117817 * m_33388 + i_122250] = tmp_122253;
        }
    }
    
  cleanup:
    { }
    if (event_127520 != NULL) {
        event_127520->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_parloop_127519", strdup("nothing further"), event_127520, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_copy_122254_task_127517(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127516 *futhark_mc_task_127516 = (struct futhark_mc_task_127516 *) args;
    struct futhark_context *ctx = futhark_mc_task_127516->ctx;
    struct mc_event *event_127522 = mc_event_new(ctx);
    
    if (event_127522 != NULL)
        event_127522->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127516->free_m_33388;
    struct memblock mem_111744 = {.desc ="mem_111744", .mem =futhark_mc_task_127516->free_mem_111744, .size =0, .references =NULL};
    int64_t gtid_117817 = futhark_mc_task_127516->free_gtid_117817;
    struct memblock mem_117846 = {.desc ="mem_117846", .mem =futhark_mc_task_127516->free_mem_117846, .size =0, .references =NULL};
    struct futhark_mc_copy_parloop_struct_127518 futhark_mc_copy_parloop_struct_127518_;
    
    futhark_mc_copy_parloop_struct_127518_.ctx = ctx;
    futhark_mc_copy_parloop_struct_127518_.free_m_33388 = m_33388;
    futhark_mc_copy_parloop_struct_127518_.free_mem_111744 = mem_111744.mem;
    futhark_mc_copy_parloop_struct_127518_.free_gtid_117817 = gtid_117817;
    futhark_mc_copy_parloop_struct_127518_.free_mem_117846 = mem_117846.mem;
    
    struct scheduler_parloop futhark_mc_copy_parloop_127519_task;
    
    futhark_mc_copy_parloop_127519_task.name = "futhark_mc_copy_parloop_127519";
    futhark_mc_copy_parloop_127519_task.fn = futhark_mc_copy_parloop_127519;
    futhark_mc_copy_parloop_127519_task.args = &futhark_mc_copy_parloop_struct_127518_;
    futhark_mc_copy_parloop_127519_task.iterations = iterations;
    futhark_mc_copy_parloop_127519_task.info = info;
    
    struct mc_event *event_127521 = mc_event_new(ctx);
    
    if (event_127521 != NULL)
        event_127521->bef = get_wall_time();
    
    int futhark_mc_copy_parloop_127519_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_copy_parloop_127519_task);
    
    if (futhark_mc_copy_parloop_127519_err != 0) {
        err = futhark_mc_copy_parloop_127519_err;
        goto cleanup;
    }
    if (event_127521 != NULL) {
        event_127521->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_parloop_127519_total", strdup("nothing further"), event_127521, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_127522 != NULL) {
        event_127522->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_122254_task_127517", strdup("nothing further"), event_127522, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_127499(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127498 *futhark_mc_segred_stage_1_parloop_struct_127498 = (struct futhark_mc_segred_stage_1_parloop_struct_127498 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127498->ctx;
    struct mc_event *event_127523 = mc_event_new(ctx);
    
    if (event_127523 != NULL)
        event_127523->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127498->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_127498->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_127498->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_127498->free_distrs_mem_111708, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_segred_stage_1_parloop_struct_127498->free_bytes_111715;
    struct memblock mem_111739 = {.desc ="mem_111739", .mem =futhark_mc_segred_stage_1_parloop_struct_127498->free_mem_111739, .size =0, .references =NULL};
    struct memblock mem_111741 = {.desc ="mem_111741", .mem =futhark_mc_segred_stage_1_parloop_struct_127498->free_mem_111741, .size =0, .references =NULL};
    struct memblock mem_111744 = {.desc ="mem_111744", .mem =futhark_mc_segred_stage_1_parloop_struct_127498->free_mem_111744, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122092 = {.desc ="reduce_stage_1_tid_res_arr_mem_122092", .mem =futhark_mc_segred_stage_1_parloop_struct_127498->free_reduce_stage_1_tid_res_arr_mem_122092, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122094 = {.desc ="reduce_stage_1_tid_res_arr_mem_122094", .mem =futhark_mc_segred_stage_1_parloop_struct_127498->free_reduce_stage_1_tid_res_arr_mem_122094, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122096 = {.desc ="reduce_stage_1_tid_res_arr_mem_122096", .mem =futhark_mc_segred_stage_1_parloop_struct_127498->free_reduce_stage_1_tid_res_arr_mem_122096, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122098 = {.desc ="reduce_stage_1_tid_res_arr_mem_122098", .mem =futhark_mc_segred_stage_1_parloop_struct_127498->free_reduce_stage_1_tid_res_arr_mem_122098, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122100 = {.desc ="reduce_stage_1_tid_res_arr_mem_122100", .mem =futhark_mc_segred_stage_1_parloop_struct_127498->free_reduce_stage_1_tid_res_arr_mem_122100, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122102 = {.desc ="reduce_stage_1_tid_res_arr_mem_122102", .mem =futhark_mc_segred_stage_1_parloop_struct_127498->free_reduce_stage_1_tid_res_arr_mem_122102, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122104 = {.desc ="reduce_stage_1_tid_res_arr_mem_122104", .mem =futhark_mc_segred_stage_1_parloop_struct_127498->free_reduce_stage_1_tid_res_arr_mem_122104, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122106 = {.desc ="reduce_stage_1_tid_res_arr_mem_122106", .mem =futhark_mc_segred_stage_1_parloop_struct_127498->free_reduce_stage_1_tid_res_arr_mem_122106, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122108 = {.desc ="reduce_stage_1_tid_res_arr_mem_122108", .mem =futhark_mc_segred_stage_1_parloop_struct_127498->free_reduce_stage_1_tid_res_arr_mem_122108, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t mem_117846_cached_sizze_127500 = 0;
    unsigned char *mem_117846 = NULL;
    int64_t flat_tid_117816;
    
    flat_tid_117816 = subtask_id;
    {
        double eta_p_122110;
        double eta_p_122111;
        double eta_p_122113;
        double eta_p_122114;
        double eta_p_122116;
        double eta_p_122117;
        double eta_p_122119;
        double eta_p_122120;
        double eta_p_122122;
        double eta_p_122123;
        double eta_p_122125;
        double eta_p_122126;
        double eta_p_122128;
        double eta_p_122129;
        double eta_p_122131;
        double eta_p_122132;
        double eta_p_122134;
        double eta_p_122135;
        double local_acc_122137 = 0.0;
        double local_acc_122138 = 0.0;
        double local_acc_122139 = 0.0;
        double local_acc_122140 = 0.0;
        double local_acc_122141 = 0.0;
        double local_acc_122142 = 0.0;
        double local_acc_122143 = 0.0;
        double local_acc_122144 = 0.0;
        double local_acc_122145 = 0.0;
        double eta_p_117818;
        double eta_p_117819;
        double eta_p_117821;
        double eta_p_117822;
        double eta_p_117824;
        double eta_p_117825;
        double eta_p_117827;
        double eta_p_117828;
        double eta_p_117830;
        double eta_p_117831;
        double eta_p_117833;
        double eta_p_117834;
        double eta_p_117836;
        double eta_p_117837;
        double eta_p_117839;
        double eta_p_117840;
        double eta_p_117842;
        double eta_p_117843;
        double local_acc_122146 = 0.0;
        double local_acc_122147 = 0.0;
        double local_acc_122148 = 0.0;
        double local_acc_122149 = 0.0;
        double local_acc_122150 = 0.0;
        double local_acc_122151 = 0.0;
        double local_acc_122152 = 0.0;
        double local_acc_122153 = 0.0;
        double local_acc_122154 = 0.0;
        int64_t start_122155;
        int64_t end_122156;
        
        start_122155 = start;
        end_122156 = end;
        
        int64_t n_122157 = end_122156 - start_122155;
        
        if (mem_117846_cached_sizze_127500 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_117846, &mem_117846_cached_sizze_127500, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        for (int64_t SegRed_i_122158 = start_122155; SegRed_i_122158 < start_122155 + n_122157; SegRed_i_122158++) {
            int64_t gtid_117817 = SegRed_i_122158;
            double x_117845 = ((double *) distrs_mem_111708.mem)[eta_p_106382 * m_33388 + gtid_117817];
            double defunc_res_117847;
            double defunc_res_117848;
            double defunc_res_117849;
            double defunc_res_117850;
            double defunc_res_117851;
            double defunc_res_117852;
            double defunc_res_117853;
            double defunc_res_117854;
            int64_t flat_tid_117856 = (int64_t) 0;
            
            defunc_res_117847 = 0.0;
            defunc_res_117848 = 0.0;
            defunc_res_117849 = 0.0;
            defunc_res_117850 = 0.0;
            defunc_res_117851 = 0.0;
            defunc_res_117852 = 0.0;
            defunc_res_117853 = 0.0;
            defunc_res_117854 = 0.0;
            
            struct futhark_mc_task_127501 futhark_mc_task_127501_;
            
            futhark_mc_task_127501_.ctx = ctx;
            futhark_mc_task_127501_.free_m_33388 = m_33388;
            futhark_mc_task_127501_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
            futhark_mc_task_127501_.free_distrs_mem_111708 = distrs_mem_111708.mem;
            futhark_mc_task_127501_.free_x_117845 = x_117845;
            futhark_mc_task_127501_.free_flat_tid_117856 = flat_tid_117856;
            futhark_mc_task_127501_.retval_defunc_res_117847 = (double *) &defunc_res_117847;
            #if ISPC
            futhark_mc_task_127501_.retval_defunc_res_117847 += programIndex;
            #endif
            futhark_mc_task_127501_.retval_defunc_res_117848 = (double *) &defunc_res_117848;
            #if ISPC
            futhark_mc_task_127501_.retval_defunc_res_117848 += programIndex;
            #endif
            futhark_mc_task_127501_.retval_defunc_res_117849 = (double *) &defunc_res_117849;
            #if ISPC
            futhark_mc_task_127501_.retval_defunc_res_117849 += programIndex;
            #endif
            futhark_mc_task_127501_.retval_defunc_res_117850 = (double *) &defunc_res_117850;
            #if ISPC
            futhark_mc_task_127501_.retval_defunc_res_117850 += programIndex;
            #endif
            futhark_mc_task_127501_.retval_defunc_res_117851 = (double *) &defunc_res_117851;
            #if ISPC
            futhark_mc_task_127501_.retval_defunc_res_117851 += programIndex;
            #endif
            futhark_mc_task_127501_.retval_defunc_res_117852 = (double *) &defunc_res_117852;
            #if ISPC
            futhark_mc_task_127501_.retval_defunc_res_117852 += programIndex;
            #endif
            futhark_mc_task_127501_.retval_defunc_res_117853 = (double *) &defunc_res_117853;
            #if ISPC
            futhark_mc_task_127501_.retval_defunc_res_117853 += programIndex;
            #endif
            futhark_mc_task_127501_.retval_defunc_res_117854 = (double *) &defunc_res_117854;
            #if ISPC
            futhark_mc_task_127501_.retval_defunc_res_117854 += programIndex;
            #endif
            futhark_mc_task_127501_.retval_mem_117846 = mem_117846;
            
            struct scheduler_segop futhark_mc_task_127501_task;
            
            futhark_mc_task_127501_task.args = &futhark_mc_task_127501_;
            futhark_mc_task_127501_task.top_level_fn = futhark_mc_segred_task_127502;
            futhark_mc_task_127501_task.name = "futhark_mc_segred_task_127502";
            futhark_mc_task_127501_task.iterations = m_33388;
            futhark_mc_task_127501_task.task_time = &ctx->program->futhark_mc_segred_task_127502_total_time;
            futhark_mc_task_127501_task.task_iter = &ctx->program->futhark_mc_segred_task_127502_total_iter;
            futhark_mc_task_127501_task.sched = STATIC;
            futhark_mc_task_127501_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_127502_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127501_task);
            
            if (futhark_mc_segred_task_127502_err != 0) {
                err = futhark_mc_segred_task_127502_err;
                goto cleanup;
            }
            
            bool zeze_res_117893 = defunc_res_117853 == 0.0;
            double klu_res_117894;
            
            if (zeze_res_117893) {
                klu_res_117894 = 0.0;
            } else {
                double zs_res_117895 = defunc_res_117853 / x_117845;
                double log_res_117896 = futrts_log64(zs_res_117895);
                double zt_res_117897 = defunc_res_117853 * log_res_117896;
                
                klu_res_117894 = zt_res_117897;
            }
            
            bool zeze_res_117898 = defunc_res_117851 == 0.0;
            double klu_res_117899;
            
            if (zeze_res_117898) {
                klu_res_117899 = 0.0;
            } else {
                double zs_res_117900 = defunc_res_117851 / x_117845;
                double log_res_117901 = futrts_log64(zs_res_117900);
                double zt_res_117902 = defunc_res_117851 * log_res_117901;
                
                klu_res_117899 = zt_res_117902;
            }
            // save map-out results
            {
                ((double *) mem_111739.mem)[gtid_117817] = defunc_res_117849;
                ((double *) mem_111741.mem)[gtid_117817] = defunc_res_117850;
                
                int64_t iterations_122255 = m_33388;
                struct futhark_mc_task_127516 futhark_mc_task_127516_;
                
                futhark_mc_task_127516_.ctx = ctx;
                futhark_mc_task_127516_.free_m_33388 = m_33388;
                futhark_mc_task_127516_.free_mem_111744 = mem_111744.mem;
                futhark_mc_task_127516_.free_gtid_117817 = gtid_117817;
                futhark_mc_task_127516_.free_mem_117846 = mem_117846;
                
                struct scheduler_segop futhark_mc_task_127516_task;
                
                futhark_mc_task_127516_task.args = &futhark_mc_task_127516_;
                futhark_mc_task_127516_task.top_level_fn = futhark_mc_copy_122254_task_127517;
                futhark_mc_task_127516_task.name = "futhark_mc_copy_122254_task_127517";
                futhark_mc_task_127516_task.iterations = iterations_122255;
                futhark_mc_task_127516_task.task_time = &ctx->program->futhark_mc_copy_122254_task_127517_total_time;
                futhark_mc_task_127516_task.task_iter = &ctx->program->futhark_mc_copy_122254_task_127517_total_iter;
                futhark_mc_task_127516_task.sched = STATIC;
                futhark_mc_task_127516_task.nested_fn = NULL;
                
                int futhark_mc_copy_122254_task_127517_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127516_task);
                
                if (futhark_mc_copy_122254_task_127517_err != 0) {
                    err = futhark_mc_copy_122254_task_127517_err;
                    goto cleanup;
                }
            }
            // Load accum params
            {
                eta_p_117818 = local_acc_122146;
            }
            // Load next params
            {
                eta_p_117819 = defunc_res_117854;
            }
            // SegRed body
            {
                double zp_res_117820 = eta_p_117818 + eta_p_117819;
                
                local_acc_122146 = zp_res_117820;
            }
            // Load accum params
            {
                eta_p_117821 = local_acc_122147;
            }
            // Load next params
            {
                eta_p_117822 = klu_res_117894;
            }
            // SegRed body
            {
                double zp_res_117823 = eta_p_117821 + eta_p_117822;
                
                local_acc_122147 = zp_res_117823;
            }
            // Load accum params
            {
                eta_p_117824 = local_acc_122148;
            }
            // Load next params
            {
                eta_p_117825 = defunc_res_117847;
            }
            // SegRed body
            {
                double zp_res_117826 = eta_p_117824 + eta_p_117825;
                
                local_acc_122148 = zp_res_117826;
            }
            // Load accum params
            {
                eta_p_117827 = local_acc_122149;
            }
            // Load next params
            {
                eta_p_117828 = defunc_res_117852;
            }
            // SegRed body
            {
                double zp_res_117829 = eta_p_117827 + eta_p_117828;
                
                local_acc_122149 = zp_res_117829;
            }
            // Load accum params
            {
                eta_p_117830 = local_acc_122150;
            }
            // Load next params
            {
                eta_p_117831 = klu_res_117899;
            }
            // SegRed body
            {
                double zp_res_117832 = eta_p_117830 + eta_p_117831;
                
                local_acc_122150 = zp_res_117832;
            }
            // Load accum params
            {
                eta_p_117833 = local_acc_122151;
            }
            // Load next params
            {
                eta_p_117834 = defunc_res_117851;
            }
            // SegRed body
            {
                double zp_res_117835 = eta_p_117833 + eta_p_117834;
                
                local_acc_122151 = zp_res_117835;
            }
            // Load accum params
            {
                eta_p_117836 = local_acc_122152;
            }
            // Load next params
            {
                eta_p_117837 = defunc_res_117848;
            }
            // SegRed body
            {
                double zp_res_117838 = eta_p_117836 + eta_p_117837;
                
                local_acc_122152 = zp_res_117838;
            }
            // Load accum params
            {
                eta_p_117839 = local_acc_122153;
            }
            // Load next params
            {
                eta_p_117840 = x_117845;
            }
            // SegRed body
            {
                double zp_res_117841 = eta_p_117839 + eta_p_117840;
                
                local_acc_122153 = zp_res_117841;
            }
            // Load accum params
            {
                eta_p_117842 = local_acc_122154;
            }
            // Load next params
            {
                eta_p_117843 = x_117845;
            }
            // SegRed body
            {
                double zp_res_117844 = eta_p_117842 + eta_p_117843;
                
                local_acc_122154 = zp_res_117844;
            }
        }
        
        int64_t uni_i_122256 = 0;
        
        {
            int64_t gtid_117817 = uni_i_122256;
            
            // Load accum params
            {
                eta_p_122110 = local_acc_122137;
            }
            // Load next params
            {
                eta_p_122111 = local_acc_122146;
            }
            // SegRed body
            {
                double zp_res_122112 = eta_p_122110 + eta_p_122111;
                
                local_acc_122137 = zp_res_122112;
            }
            // Load accum params
            {
                eta_p_122113 = local_acc_122138;
            }
            // Load next params
            {
                eta_p_122114 = local_acc_122147;
            }
            // SegRed body
            {
                double zp_res_122115 = eta_p_122113 + eta_p_122114;
                
                local_acc_122138 = zp_res_122115;
            }
            // Load accum params
            {
                eta_p_122116 = local_acc_122139;
            }
            // Load next params
            {
                eta_p_122117 = local_acc_122148;
            }
            // SegRed body
            {
                double zp_res_122118 = eta_p_122116 + eta_p_122117;
                
                local_acc_122139 = zp_res_122118;
            }
            // Load accum params
            {
                eta_p_122119 = local_acc_122140;
            }
            // Load next params
            {
                eta_p_122120 = local_acc_122149;
            }
            // SegRed body
            {
                double zp_res_122121 = eta_p_122119 + eta_p_122120;
                
                local_acc_122140 = zp_res_122121;
            }
            // Load accum params
            {
                eta_p_122122 = local_acc_122141;
            }
            // Load next params
            {
                eta_p_122123 = local_acc_122150;
            }
            // SegRed body
            {
                double zp_res_122124 = eta_p_122122 + eta_p_122123;
                
                local_acc_122141 = zp_res_122124;
            }
            // Load accum params
            {
                eta_p_122125 = local_acc_122142;
            }
            // Load next params
            {
                eta_p_122126 = local_acc_122151;
            }
            // SegRed body
            {
                double zp_res_122127 = eta_p_122125 + eta_p_122126;
                
                local_acc_122142 = zp_res_122127;
            }
            // Load accum params
            {
                eta_p_122128 = local_acc_122143;
            }
            // Load next params
            {
                eta_p_122129 = local_acc_122152;
            }
            // SegRed body
            {
                double zp_res_122130 = eta_p_122128 + eta_p_122129;
                
                local_acc_122143 = zp_res_122130;
            }
            // Load accum params
            {
                eta_p_122131 = local_acc_122144;
            }
            // Load next params
            {
                eta_p_122132 = local_acc_122153;
            }
            // SegRed body
            {
                double zp_res_122133 = eta_p_122131 + eta_p_122132;
                
                local_acc_122144 = zp_res_122133;
            }
            // Load accum params
            {
                eta_p_122134 = local_acc_122145;
            }
            // Load next params
            {
                eta_p_122135 = local_acc_122154;
            }
            // SegRed body
            {
                double zp_res_122136 = eta_p_122134 + eta_p_122135;
                
                local_acc_122145 = zp_res_122136;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_122092.mem)[flat_tid_117816] = local_acc_122137;
        ((double *) reduce_stage_1_tid_res_arr_mem_122094.mem)[flat_tid_117816] = local_acc_122138;
        ((double *) reduce_stage_1_tid_res_arr_mem_122096.mem)[flat_tid_117816] = local_acc_122139;
        ((double *) reduce_stage_1_tid_res_arr_mem_122098.mem)[flat_tid_117816] = local_acc_122140;
        ((double *) reduce_stage_1_tid_res_arr_mem_122100.mem)[flat_tid_117816] = local_acc_122141;
        ((double *) reduce_stage_1_tid_res_arr_mem_122102.mem)[flat_tid_117816] = local_acc_122142;
        ((double *) reduce_stage_1_tid_res_arr_mem_122104.mem)[flat_tid_117816] = local_acc_122143;
        ((double *) reduce_stage_1_tid_res_arr_mem_122106.mem)[flat_tid_117816] = local_acc_122144;
        ((double *) reduce_stage_1_tid_res_arr_mem_122108.mem)[flat_tid_117816] = local_acc_122145;
    }
    
  cleanup:
    {
        free(mem_117846);
    }
    if (event_127523 != NULL) {
        event_127523->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127499", strdup("nothing further"), event_127523, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_127488(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127471 *futhark_mc_task_127471 = (struct futhark_mc_task_127471 *) args;
    struct futhark_context *ctx = futhark_mc_task_127471->ctx;
    struct mc_event *event_127525 = mc_event_new(ctx);
    
    if (event_127525 != NULL)
        event_127525->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127471->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_127471->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_127471->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_127471->free_distrs_mem_111708, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_task_127471->free_bytes_111715;
    int64_t flat_tid_117816 = futhark_mc_task_127471->free_flat_tid_117816;
    int64_t flat_tid_117903 = futhark_mc_task_127471->free_flat_tid_117903;
    double defunc_res_106404 = *futhark_mc_task_127471->retval_defunc_res_106404;
    double defunc_res_106405 = *futhark_mc_task_127471->retval_defunc_res_106405;
    double defunc_res_106406 = *futhark_mc_task_127471->retval_defunc_res_106406;
    double defunc_res_106407 = *futhark_mc_task_127471->retval_defunc_res_106407;
    double defunc_res_106408 = *futhark_mc_task_127471->retval_defunc_res_106408;
    double defunc_res_106409 = *futhark_mc_task_127471->retval_defunc_res_106409;
    double defunc_res_106410 = *futhark_mc_task_127471->retval_defunc_res_106410;
    double defunc_res_106411 = *futhark_mc_task_127471->retval_defunc_res_106411;
    double defunc_res_106412 = *futhark_mc_task_127471->retval_defunc_res_106412;
    struct memblock mem_111739 = {.desc ="mem_111739", .mem =futhark_mc_task_127471->retval_mem_111739, .size =0, .references =NULL};
    struct memblock mem_111741 = {.desc ="mem_111741", .mem =futhark_mc_task_127471->retval_mem_111741, .size =0, .references =NULL};
    struct memblock mem_111744 = {.desc ="mem_111744", .mem =futhark_mc_task_127471->retval_mem_111744, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_122092_cached_sizze_127489 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122092 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_122094_cached_sizze_127490 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122094 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_122096_cached_sizze_127491 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122096 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_122098_cached_sizze_127492 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122098 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_122100_cached_sizze_127493 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122100 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_122102_cached_sizze_127494 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122102 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_122104_cached_sizze_127495 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122104 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_122106_cached_sizze_127496 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122106 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_122108_cached_sizze_127497 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122108 = NULL;
    int32_t nsubtasks_122091;
    
    nsubtasks_122091 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_122092_cached_sizze_127489 < (int64_t) 8 * nsubtasks_122091) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122092, &reduce_stage_1_tid_res_arr_mem_122092_cached_sizze_127489, (int64_t) 8 * nsubtasks_122091);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_122094_cached_sizze_127490 < (int64_t) 8 * nsubtasks_122091) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122094, &reduce_stage_1_tid_res_arr_mem_122094_cached_sizze_127490, (int64_t) 8 * nsubtasks_122091);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_122096_cached_sizze_127491 < (int64_t) 8 * nsubtasks_122091) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122096, &reduce_stage_1_tid_res_arr_mem_122096_cached_sizze_127491, (int64_t) 8 * nsubtasks_122091);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_122098_cached_sizze_127492 < (int64_t) 8 * nsubtasks_122091) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122098, &reduce_stage_1_tid_res_arr_mem_122098_cached_sizze_127492, (int64_t) 8 * nsubtasks_122091);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_122100_cached_sizze_127493 < (int64_t) 8 * nsubtasks_122091) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122100, &reduce_stage_1_tid_res_arr_mem_122100_cached_sizze_127493, (int64_t) 8 * nsubtasks_122091);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_122102_cached_sizze_127494 < (int64_t) 8 * nsubtasks_122091) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122102, &reduce_stage_1_tid_res_arr_mem_122102_cached_sizze_127494, (int64_t) 8 * nsubtasks_122091);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_122104_cached_sizze_127495 < (int64_t) 8 * nsubtasks_122091) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122104, &reduce_stage_1_tid_res_arr_mem_122104_cached_sizze_127495, (int64_t) 8 * nsubtasks_122091);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_122106_cached_sizze_127496 < (int64_t) 8 * nsubtasks_122091) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122106, &reduce_stage_1_tid_res_arr_mem_122106_cached_sizze_127496, (int64_t) 8 * nsubtasks_122091);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_122108_cached_sizze_127497 < (int64_t) 8 * nsubtasks_122091) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122108, &reduce_stage_1_tid_res_arr_mem_122108_cached_sizze_127497, (int64_t) 8 * nsubtasks_122091);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127498 futhark_mc_segred_stage_1_parloop_struct_127498_;
    
    futhark_mc_segred_stage_1_parloop_struct_127498_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127498_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127498_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_127498_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_127498_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_127498_.free_bytes_111715 = bytes_111715;
    futhark_mc_segred_stage_1_parloop_struct_127498_.free_mem_111739 = mem_111739.mem;
    futhark_mc_segred_stage_1_parloop_struct_127498_.free_mem_111741 = mem_111741.mem;
    futhark_mc_segred_stage_1_parloop_struct_127498_.free_mem_111744 = mem_111744.mem;
    futhark_mc_segred_stage_1_parloop_struct_127498_.free_reduce_stage_1_tid_res_arr_mem_122092 = reduce_stage_1_tid_res_arr_mem_122092;
    futhark_mc_segred_stage_1_parloop_struct_127498_.free_reduce_stage_1_tid_res_arr_mem_122094 = reduce_stage_1_tid_res_arr_mem_122094;
    futhark_mc_segred_stage_1_parloop_struct_127498_.free_reduce_stage_1_tid_res_arr_mem_122096 = reduce_stage_1_tid_res_arr_mem_122096;
    futhark_mc_segred_stage_1_parloop_struct_127498_.free_reduce_stage_1_tid_res_arr_mem_122098 = reduce_stage_1_tid_res_arr_mem_122098;
    futhark_mc_segred_stage_1_parloop_struct_127498_.free_reduce_stage_1_tid_res_arr_mem_122100 = reduce_stage_1_tid_res_arr_mem_122100;
    futhark_mc_segred_stage_1_parloop_struct_127498_.free_reduce_stage_1_tid_res_arr_mem_122102 = reduce_stage_1_tid_res_arr_mem_122102;
    futhark_mc_segred_stage_1_parloop_struct_127498_.free_reduce_stage_1_tid_res_arr_mem_122104 = reduce_stage_1_tid_res_arr_mem_122104;
    futhark_mc_segred_stage_1_parloop_struct_127498_.free_reduce_stage_1_tid_res_arr_mem_122106 = reduce_stage_1_tid_res_arr_mem_122106;
    futhark_mc_segred_stage_1_parloop_struct_127498_.free_reduce_stage_1_tid_res_arr_mem_122108 = reduce_stage_1_tid_res_arr_mem_122108;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127499_task;
    
    futhark_mc_segred_stage_1_parloop_127499_task.name = "futhark_mc_segred_stage_1_parloop_127499";
    futhark_mc_segred_stage_1_parloop_127499_task.fn = futhark_mc_segred_stage_1_parloop_127499;
    futhark_mc_segred_stage_1_parloop_127499_task.args = &futhark_mc_segred_stage_1_parloop_struct_127498_;
    futhark_mc_segred_stage_1_parloop_127499_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127499_task.info = info;
    
    struct mc_event *event_127524 = mc_event_new(ctx);
    
    if (event_127524 != NULL)
        event_127524->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127499_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127499_task);
    
    if (futhark_mc_segred_stage_1_parloop_127499_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127499_err;
        goto cleanup;
    }
    if (event_127524 != NULL) {
        event_127524->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127499_total", strdup("nothing further"), event_127524, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_106404 = 0.0;
        defunc_res_106405 = 0.0;
        defunc_res_106406 = 0.0;
        defunc_res_106407 = 0.0;
        defunc_res_106408 = 0.0;
        defunc_res_106409 = 0.0;
        defunc_res_106410 = 0.0;
        defunc_res_106411 = 0.0;
        defunc_res_106412 = 0.0;
    }
    
    double eta_p_122257;
    double eta_p_122258;
    double eta_p_122260;
    double eta_p_122261;
    double eta_p_122263;
    double eta_p_122264;
    double eta_p_122266;
    double eta_p_122267;
    double eta_p_122269;
    double eta_p_122270;
    double eta_p_122272;
    double eta_p_122273;
    double eta_p_122275;
    double eta_p_122276;
    double eta_p_122278;
    double eta_p_122279;
    double eta_p_122281;
    double eta_p_122282;
    
    for (int32_t i_122284 = 0; i_122284 < nsubtasks_122091; i_122284++) {
        flat_tid_117816 = i_122284;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_122257 = defunc_res_106404;
            }
            // load next params
            {
                eta_p_122258 = ((double *) reduce_stage_1_tid_res_arr_mem_122092)[flat_tid_117816];
            }
            // red body
            {
                double zp_res_122259 = eta_p_122257 + eta_p_122258;
                
                defunc_res_106404 = zp_res_122259;
            }
            // load acc params
            {
                eta_p_122260 = defunc_res_106405;
            }
            // load next params
            {
                eta_p_122261 = ((double *) reduce_stage_1_tid_res_arr_mem_122094)[flat_tid_117816];
            }
            // red body
            {
                double zp_res_122262 = eta_p_122260 + eta_p_122261;
                
                defunc_res_106405 = zp_res_122262;
            }
            // load acc params
            {
                eta_p_122263 = defunc_res_106406;
            }
            // load next params
            {
                eta_p_122264 = ((double *) reduce_stage_1_tid_res_arr_mem_122096)[flat_tid_117816];
            }
            // red body
            {
                double zp_res_122265 = eta_p_122263 + eta_p_122264;
                
                defunc_res_106406 = zp_res_122265;
            }
            // load acc params
            {
                eta_p_122266 = defunc_res_106407;
            }
            // load next params
            {
                eta_p_122267 = ((double *) reduce_stage_1_tid_res_arr_mem_122098)[flat_tid_117816];
            }
            // red body
            {
                double zp_res_122268 = eta_p_122266 + eta_p_122267;
                
                defunc_res_106407 = zp_res_122268;
            }
            // load acc params
            {
                eta_p_122269 = defunc_res_106408;
            }
            // load next params
            {
                eta_p_122270 = ((double *) reduce_stage_1_tid_res_arr_mem_122100)[flat_tid_117816];
            }
            // red body
            {
                double zp_res_122271 = eta_p_122269 + eta_p_122270;
                
                defunc_res_106408 = zp_res_122271;
            }
            // load acc params
            {
                eta_p_122272 = defunc_res_106409;
            }
            // load next params
            {
                eta_p_122273 = ((double *) reduce_stage_1_tid_res_arr_mem_122102)[flat_tid_117816];
            }
            // red body
            {
                double zp_res_122274 = eta_p_122272 + eta_p_122273;
                
                defunc_res_106409 = zp_res_122274;
            }
            // load acc params
            {
                eta_p_122275 = defunc_res_106410;
            }
            // load next params
            {
                eta_p_122276 = ((double *) reduce_stage_1_tid_res_arr_mem_122104)[flat_tid_117816];
            }
            // red body
            {
                double zp_res_122277 = eta_p_122275 + eta_p_122276;
                
                defunc_res_106410 = zp_res_122277;
            }
            // load acc params
            {
                eta_p_122278 = defunc_res_106411;
            }
            // load next params
            {
                eta_p_122279 = ((double *) reduce_stage_1_tid_res_arr_mem_122106)[flat_tid_117816];
            }
            // red body
            {
                double zp_res_122280 = eta_p_122278 + eta_p_122279;
                
                defunc_res_106411 = zp_res_122280;
            }
            // load acc params
            {
                eta_p_122281 = defunc_res_106412;
            }
            // load next params
            {
                eta_p_122282 = ((double *) reduce_stage_1_tid_res_arr_mem_122108)[flat_tid_117816];
            }
            // red body
            {
                double zp_res_122283 = eta_p_122281 + eta_p_122282;
                
                defunc_res_106412 = zp_res_122283;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_122092);
        free(reduce_stage_1_tid_res_arr_mem_122094);
        free(reduce_stage_1_tid_res_arr_mem_122096);
        free(reduce_stage_1_tid_res_arr_mem_122098);
        free(reduce_stage_1_tid_res_arr_mem_122100);
        free(reduce_stage_1_tid_res_arr_mem_122102);
        free(reduce_stage_1_tid_res_arr_mem_122104);
        free(reduce_stage_1_tid_res_arr_mem_122106);
        free(reduce_stage_1_tid_res_arr_mem_122108);
    }
    if (event_127525 != NULL) {
        event_127525->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_127488", strdup("nothing further"), event_127525, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127471->retval_defunc_res_106404 = defunc_res_106404;
        *futhark_mc_task_127471->retval_defunc_res_106405 = defunc_res_106405;
        *futhark_mc_task_127471->retval_defunc_res_106406 = defunc_res_106406;
        *futhark_mc_task_127471->retval_defunc_res_106407 = defunc_res_106407;
        *futhark_mc_task_127471->retval_defunc_res_106408 = defunc_res_106408;
        *futhark_mc_task_127471->retval_defunc_res_106409 = defunc_res_106409;
        *futhark_mc_task_127471->retval_defunc_res_106410 = defunc_res_106410;
        *futhark_mc_task_127471->retval_defunc_res_106411 = defunc_res_106411;
        *futhark_mc_task_127471->retval_defunc_res_106412 = defunc_res_106412;
        futhark_mc_task_127471->retval_mem_111739 = mem_111739.mem;
        futhark_mc_task_127471->retval_mem_111741 = mem_111741.mem;
        futhark_mc_task_127471->retval_mem_111744 = mem_111744.mem;
    }
    return err;
}
struct futhark_mc_task_127526 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    double free_zt_res_106587;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_111744;
    int64_t free_flat_tid_117984;
    int64_t free_flat_tid_118030;
    double *retval_defunc_res_106588;
    double *retval_defunc_res_106589;
    double *retval_defunc_res_106590;
    double *retval_defunc_res_106591;
    unsigned char *retval_mem_111746;
    unsigned char *retval_mem_111748;
    unsigned char *retval_mem_111750;
};
struct futhark_mc_segred_stage_1_parloop_struct_127532 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    double free_zt_res_106587;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_111744;
    unsigned char *free_mem_111746;
    unsigned char *free_mem_111748;
    unsigned char *free_mem_111750;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122286;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122288;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122290;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122292;
};
static int futhark_mc_segred_stage_1_parloop_127533(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127532 *futhark_mc_segred_stage_1_parloop_struct_127532 = (struct futhark_mc_segred_stage_1_parloop_struct_127532 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127532->ctx;
    struct mc_event *event_127534 = mc_event_new(ctx);
    
    if (event_127534 != NULL)
        event_127534->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127532->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_127532->free_lifted_lambda_res_106391;
    double zt_res_106587 = futhark_mc_segred_stage_1_parloop_struct_127532->free_zt_res_106587;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_127532->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_111744 = {.desc ="mem_111744", .mem =futhark_mc_segred_stage_1_parloop_struct_127532->free_mem_111744, .size =0, .references =NULL};
    struct memblock mem_111746 = {.desc ="mem_111746", .mem =futhark_mc_segred_stage_1_parloop_struct_127532->free_mem_111746, .size =0, .references =NULL};
    struct memblock mem_111748 = {.desc ="mem_111748", .mem =futhark_mc_segred_stage_1_parloop_struct_127532->free_mem_111748, .size =0, .references =NULL};
    struct memblock mem_111750 = {.desc ="mem_111750", .mem =futhark_mc_segred_stage_1_parloop_struct_127532->free_mem_111750, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122286 = {.desc ="reduce_stage_1_tid_res_arr_mem_122286", .mem =futhark_mc_segred_stage_1_parloop_struct_127532->free_reduce_stage_1_tid_res_arr_mem_122286, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122288 = {.desc ="reduce_stage_1_tid_res_arr_mem_122288", .mem =futhark_mc_segred_stage_1_parloop_struct_127532->free_reduce_stage_1_tid_res_arr_mem_122288, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122290 = {.desc ="reduce_stage_1_tid_res_arr_mem_122290", .mem =futhark_mc_segred_stage_1_parloop_struct_127532->free_reduce_stage_1_tid_res_arr_mem_122290, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122292 = {.desc ="reduce_stage_1_tid_res_arr_mem_122292", .mem =futhark_mc_segred_stage_1_parloop_struct_127532->free_reduce_stage_1_tid_res_arr_mem_122292, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118030;
    
    flat_tid_118030 = subtask_id;
    {
        double eta_p_122294;
        double eta_p_122295;
        double eta_p_122297;
        double eta_p_122298;
        double eta_p_122300;
        double eta_p_122301;
        double eta_p_122303;
        double eta_p_122304;
        double local_acc_122306 = 0.0;
        double local_acc_122307 = 0.0;
        double local_acc_122308 = 0.0;
        double local_acc_122309 = 0.0;
        double eta_p_118032;
        double eta_p_118033;
        double eta_p_118035;
        double eta_p_118036;
        double eta_p_118038;
        double eta_p_118039;
        double eta_p_118041;
        double eta_p_118042;
        double local_acc_122310 = 0.0;
        double local_acc_122311 = 0.0;
        double local_acc_122312 = 0.0;
        double local_acc_122313 = 0.0;
        int64_t start_122314;
        int64_t end_122315;
        
        start_122314 = start;
        end_122315 = end;
        
        int64_t n_122316 = end_122315 - start_122314;
        
        for (int64_t SegRed_i_122317 = start_122314; SegRed_i_122317 < start_122314 + n_122316; SegRed_i_122317++) {
            int64_t gtid_118031 = SegRed_i_122317;
            double x_118044 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + gtid_118031];
            double log_res_118045 = futrts_log64(x_118044);
            double zt_res_118046 = zt_res_106587 * log_res_118045;
            double defunc_res_118047;
            double defunc_res_118048;
            double defunc_res_118049;
            double defunc_res_118050;
            double redout_118052;
            double redout_118053;
            double redout_118054;
            double redout_118055;
            
            redout_118052 = 0.0;
            redout_118053 = 0.0;
            redout_118054 = 0.0;
            redout_118055 = 0.0;
            for (int64_t i_118051 = 0; i_118051 < m_33388; i_118051++) {
                double x_118056 = ((double *) mem_111744.mem)[i_118051 * m_33388 + gtid_118031];
                double zp_res_118057 = x_118056 + redout_118052;
                double zp_res_118058 = x_118056 + redout_118053;
                double zp_res_118059 = x_118056 + redout_118054;
                double zp_res_118060 = x_118056 + redout_118055;
                double redout_tmp_122318 = zp_res_118057;
                double redout_tmp_122319 = zp_res_118058;
                double redout_tmp_122320 = zp_res_118059;
                double redout_tmp_122321 = zp_res_118060;
                
                redout_118052 = redout_tmp_122318;
                redout_118053 = redout_tmp_122319;
                redout_118054 = redout_tmp_122320;
                redout_118055 = redout_tmp_122321;
            }
            defunc_res_118047 = redout_118052;
            defunc_res_118048 = redout_118053;
            defunc_res_118049 = redout_118054;
            defunc_res_118050 = redout_118055;
            
            bool zeze_res_118061 = defunc_res_118047 == 0.0;
            double klu_res_118062;
            
            if (zeze_res_118061) {
                klu_res_118062 = 0.0;
            } else {
                double zs_res_118063 = defunc_res_118047 / x_118044;
                double log_res_118064 = futrts_log64(zs_res_118063);
                double zt_res_118065 = defunc_res_118047 * log_res_118064;
                
                klu_res_118062 = zt_res_118065;
            }
            
            bool zeze_res_118066 = defunc_res_118048 == 0.0;
            double klu_res_118067;
            
            if (zeze_res_118066) {
                klu_res_118067 = 0.0;
            } else {
                double zs_res_118068 = defunc_res_118048 / x_118044;
                double log_res_118069 = futrts_log64(zs_res_118068);
                double zt_res_118070 = defunc_res_118048 * log_res_118069;
                
                klu_res_118067 = zt_res_118070;
            }
            // save map-out results
            {
                ((double *) mem_111746.mem)[gtid_118031] = defunc_res_118050;
                ((double *) mem_111748.mem)[gtid_118031] = defunc_res_118049;
                ((double *) mem_111750.mem)[gtid_118031] = zt_res_118046;
            }
            // Load accum params
            {
                eta_p_118032 = local_acc_122310;
            }
            // Load next params
            {
                eta_p_118033 = klu_res_118062;
            }
            // SegRed body
            {
                double zp_res_118034 = eta_p_118032 + eta_p_118033;
                
                local_acc_122310 = zp_res_118034;
            }
            // Load accum params
            {
                eta_p_118035 = local_acc_122311;
            }
            // Load next params
            {
                eta_p_118036 = klu_res_118067;
            }
            // SegRed body
            {
                double zp_res_118037 = eta_p_118035 + eta_p_118036;
                
                local_acc_122311 = zp_res_118037;
            }
            // Load accum params
            {
                eta_p_118038 = local_acc_122312;
            }
            // Load next params
            {
                eta_p_118039 = x_118044;
            }
            // SegRed body
            {
                double zp_res_118040 = eta_p_118038 + eta_p_118039;
                
                local_acc_122312 = zp_res_118040;
            }
            // Load accum params
            {
                eta_p_118041 = local_acc_122313;
            }
            // Load next params
            {
                eta_p_118042 = x_118044;
            }
            // SegRed body
            {
                double zp_res_118043 = eta_p_118041 + eta_p_118042;
                
                local_acc_122313 = zp_res_118043;
            }
        }
        
        int64_t uni_i_122322 = 0;
        
        {
            int64_t gtid_118031 = uni_i_122322;
            
            // Load accum params
            {
                eta_p_122294 = local_acc_122306;
            }
            // Load next params
            {
                eta_p_122295 = local_acc_122310;
            }
            // SegRed body
            {
                double zp_res_122296 = eta_p_122294 + eta_p_122295;
                
                local_acc_122306 = zp_res_122296;
            }
            // Load accum params
            {
                eta_p_122297 = local_acc_122307;
            }
            // Load next params
            {
                eta_p_122298 = local_acc_122311;
            }
            // SegRed body
            {
                double zp_res_122299 = eta_p_122297 + eta_p_122298;
                
                local_acc_122307 = zp_res_122299;
            }
            // Load accum params
            {
                eta_p_122300 = local_acc_122308;
            }
            // Load next params
            {
                eta_p_122301 = local_acc_122312;
            }
            // SegRed body
            {
                double zp_res_122302 = eta_p_122300 + eta_p_122301;
                
                local_acc_122308 = zp_res_122302;
            }
            // Load accum params
            {
                eta_p_122303 = local_acc_122309;
            }
            // Load next params
            {
                eta_p_122304 = local_acc_122313;
            }
            // SegRed body
            {
                double zp_res_122305 = eta_p_122303 + eta_p_122304;
                
                local_acc_122309 = zp_res_122305;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_122286.mem)[flat_tid_118030] = local_acc_122306;
        ((double *) reduce_stage_1_tid_res_arr_mem_122288.mem)[flat_tid_118030] = local_acc_122307;
        ((double *) reduce_stage_1_tid_res_arr_mem_122290.mem)[flat_tid_118030] = local_acc_122308;
        ((double *) reduce_stage_1_tid_res_arr_mem_122292.mem)[flat_tid_118030] = local_acc_122309;
    }
    
  cleanup:
    { }
    if (event_127534 != NULL) {
        event_127534->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127533", strdup("nothing further"), event_127534, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127527(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127526 *futhark_mc_task_127526 = (struct futhark_mc_task_127526 *) args;
    struct futhark_context *ctx = futhark_mc_task_127526->ctx;
    struct mc_event *event_127536 = mc_event_new(ctx);
    
    if (event_127536 != NULL)
        event_127536->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127526->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_127526->free_lifted_lambda_res_106391;
    double zt_res_106587 = futhark_mc_task_127526->free_zt_res_106587;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_127526->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_111744 = {.desc ="mem_111744", .mem =futhark_mc_task_127526->free_mem_111744, .size =0, .references =NULL};
    int64_t flat_tid_117984 = futhark_mc_task_127526->free_flat_tid_117984;
    int64_t flat_tid_118030 = futhark_mc_task_127526->free_flat_tid_118030;
    double defunc_res_106588 = *futhark_mc_task_127526->retval_defunc_res_106588;
    double defunc_res_106589 = *futhark_mc_task_127526->retval_defunc_res_106589;
    double defunc_res_106590 = *futhark_mc_task_127526->retval_defunc_res_106590;
    double defunc_res_106591 = *futhark_mc_task_127526->retval_defunc_res_106591;
    struct memblock mem_111746 = {.desc ="mem_111746", .mem =futhark_mc_task_127526->retval_mem_111746, .size =0, .references =NULL};
    struct memblock mem_111748 = {.desc ="mem_111748", .mem =futhark_mc_task_127526->retval_mem_111748, .size =0, .references =NULL};
    struct memblock mem_111750 = {.desc ="mem_111750", .mem =futhark_mc_task_127526->retval_mem_111750, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_122286_cached_sizze_127528 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122286 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_122288_cached_sizze_127529 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122288 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_122290_cached_sizze_127530 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122290 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_122292_cached_sizze_127531 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122292 = NULL;
    int32_t nsubtasks_122285;
    
    nsubtasks_122285 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_122286_cached_sizze_127528 < (int64_t) 8 * nsubtasks_122285) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122286, &reduce_stage_1_tid_res_arr_mem_122286_cached_sizze_127528, (int64_t) 8 * nsubtasks_122285);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_122288_cached_sizze_127529 < (int64_t) 8 * nsubtasks_122285) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122288, &reduce_stage_1_tid_res_arr_mem_122288_cached_sizze_127529, (int64_t) 8 * nsubtasks_122285);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_122290_cached_sizze_127530 < (int64_t) 8 * nsubtasks_122285) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122290, &reduce_stage_1_tid_res_arr_mem_122290_cached_sizze_127530, (int64_t) 8 * nsubtasks_122285);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_122292_cached_sizze_127531 < (int64_t) 8 * nsubtasks_122285) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122292, &reduce_stage_1_tid_res_arr_mem_122292_cached_sizze_127531, (int64_t) 8 * nsubtasks_122285);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127532 futhark_mc_segred_stage_1_parloop_struct_127532_;
    
    futhark_mc_segred_stage_1_parloop_struct_127532_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127532_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127532_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_127532_.free_zt_res_106587 = zt_res_106587;
    futhark_mc_segred_stage_1_parloop_struct_127532_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_127532_.free_mem_111744 = mem_111744.mem;
    futhark_mc_segred_stage_1_parloop_struct_127532_.free_mem_111746 = mem_111746.mem;
    futhark_mc_segred_stage_1_parloop_struct_127532_.free_mem_111748 = mem_111748.mem;
    futhark_mc_segred_stage_1_parloop_struct_127532_.free_mem_111750 = mem_111750.mem;
    futhark_mc_segred_stage_1_parloop_struct_127532_.free_reduce_stage_1_tid_res_arr_mem_122286 = reduce_stage_1_tid_res_arr_mem_122286;
    futhark_mc_segred_stage_1_parloop_struct_127532_.free_reduce_stage_1_tid_res_arr_mem_122288 = reduce_stage_1_tid_res_arr_mem_122288;
    futhark_mc_segred_stage_1_parloop_struct_127532_.free_reduce_stage_1_tid_res_arr_mem_122290 = reduce_stage_1_tid_res_arr_mem_122290;
    futhark_mc_segred_stage_1_parloop_struct_127532_.free_reduce_stage_1_tid_res_arr_mem_122292 = reduce_stage_1_tid_res_arr_mem_122292;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127533_task;
    
    futhark_mc_segred_stage_1_parloop_127533_task.name = "futhark_mc_segred_stage_1_parloop_127533";
    futhark_mc_segred_stage_1_parloop_127533_task.fn = futhark_mc_segred_stage_1_parloop_127533;
    futhark_mc_segred_stage_1_parloop_127533_task.args = &futhark_mc_segred_stage_1_parloop_struct_127532_;
    futhark_mc_segred_stage_1_parloop_127533_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127533_task.info = info;
    
    struct mc_event *event_127535 = mc_event_new(ctx);
    
    if (event_127535 != NULL)
        event_127535->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127533_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127533_task);
    
    if (futhark_mc_segred_stage_1_parloop_127533_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127533_err;
        goto cleanup;
    }
    if (event_127535 != NULL) {
        event_127535->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127533_total", strdup("nothing further"), event_127535, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_106588 = 0.0;
        defunc_res_106589 = 0.0;
        defunc_res_106590 = 0.0;
        defunc_res_106591 = 0.0;
    }
    
    double eta_p_122323;
    double eta_p_122324;
    double eta_p_122326;
    double eta_p_122327;
    double eta_p_122329;
    double eta_p_122330;
    double eta_p_122332;
    double eta_p_122333;
    
    for (int32_t i_122335 = 0; i_122335 < nsubtasks_122285; i_122335++) {
        flat_tid_118030 = i_122335;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_122323 = defunc_res_106588;
            }
            // load next params
            {
                eta_p_122324 = ((double *) reduce_stage_1_tid_res_arr_mem_122286)[flat_tid_118030];
            }
            // red body
            {
                double zp_res_122325 = eta_p_122323 + eta_p_122324;
                
                defunc_res_106588 = zp_res_122325;
            }
            // load acc params
            {
                eta_p_122326 = defunc_res_106589;
            }
            // load next params
            {
                eta_p_122327 = ((double *) reduce_stage_1_tid_res_arr_mem_122288)[flat_tid_118030];
            }
            // red body
            {
                double zp_res_122328 = eta_p_122326 + eta_p_122327;
                
                defunc_res_106589 = zp_res_122328;
            }
            // load acc params
            {
                eta_p_122329 = defunc_res_106590;
            }
            // load next params
            {
                eta_p_122330 = ((double *) reduce_stage_1_tid_res_arr_mem_122290)[flat_tid_118030];
            }
            // red body
            {
                double zp_res_122331 = eta_p_122329 + eta_p_122330;
                
                defunc_res_106590 = zp_res_122331;
            }
            // load acc params
            {
                eta_p_122332 = defunc_res_106591;
            }
            // load next params
            {
                eta_p_122333 = ((double *) reduce_stage_1_tid_res_arr_mem_122292)[flat_tid_118030];
            }
            // red body
            {
                double zp_res_122334 = eta_p_122332 + eta_p_122333;
                
                defunc_res_106591 = zp_res_122334;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_122286);
        free(reduce_stage_1_tid_res_arr_mem_122288);
        free(reduce_stage_1_tid_res_arr_mem_122290);
        free(reduce_stage_1_tid_res_arr_mem_122292);
    }
    if (event_127536 != NULL) {
        event_127536->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127527", strdup("nothing further"), event_127536, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127526->retval_defunc_res_106588 = defunc_res_106588;
        *futhark_mc_task_127526->retval_defunc_res_106589 = defunc_res_106589;
        *futhark_mc_task_127526->retval_defunc_res_106590 = defunc_res_106590;
        *futhark_mc_task_127526->retval_defunc_res_106591 = defunc_res_106591;
        futhark_mc_task_127526->retval_mem_111746 = mem_111746.mem;
        futhark_mc_task_127526->retval_mem_111748 = mem_111748.mem;
        futhark_mc_task_127526->retval_mem_111750 = mem_111750.mem;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_127542 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    double free_zt_res_106587;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_111744;
    unsigned char *free_mem_111746;
    unsigned char *free_mem_111748;
    unsigned char *free_mem_111750;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122337;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122339;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122341;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122343;
};
struct futhark_mc_task_127544 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_111744;
    int64_t free_gtid_117985;
    int64_t free_flat_tid_118005;
    double *retval_defunc_res_118001;
    double *retval_defunc_res_118002;
    double *retval_defunc_res_118003;
    double *retval_defunc_res_118004;
};
struct futhark_mc_segred_stage_1_parloop_struct_127550 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_111744;
    int64_t free_gtid_117985;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122370;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122372;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122374;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122376;
};
static int futhark_mc_segred_stage_1_parloop_127551(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127550 *futhark_mc_segred_stage_1_parloop_struct_127550 = (struct futhark_mc_segred_stage_1_parloop_struct_127550 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127550->ctx;
    struct mc_event *event_127552 = mc_event_new(ctx);
    
    if (event_127552 != NULL)
        event_127552->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127550->free_m_33388;
    struct memblock mem_111744 = {.desc ="mem_111744", .mem =futhark_mc_segred_stage_1_parloop_struct_127550->free_mem_111744, .size =0, .references =NULL};
    int64_t gtid_117985 = futhark_mc_segred_stage_1_parloop_struct_127550->free_gtid_117985;
    struct memblock reduce_stage_1_tid_res_arr_mem_122370 = {.desc ="reduce_stage_1_tid_res_arr_mem_122370", .mem =futhark_mc_segred_stage_1_parloop_struct_127550->free_reduce_stage_1_tid_res_arr_mem_122370, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122372 = {.desc ="reduce_stage_1_tid_res_arr_mem_122372", .mem =futhark_mc_segred_stage_1_parloop_struct_127550->free_reduce_stage_1_tid_res_arr_mem_122372, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122374 = {.desc ="reduce_stage_1_tid_res_arr_mem_122374", .mem =futhark_mc_segred_stage_1_parloop_struct_127550->free_reduce_stage_1_tid_res_arr_mem_122374, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122376 = {.desc ="reduce_stage_1_tid_res_arr_mem_122376", .mem =futhark_mc_segred_stage_1_parloop_struct_127550->free_reduce_stage_1_tid_res_arr_mem_122376, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118005;
    
    flat_tid_118005 = subtask_id;
    {
        double eta_p_122378;
        double eta_p_122379;
        double eta_p_122381;
        double eta_p_122382;
        double eta_p_122384;
        double eta_p_122385;
        double eta_p_122387;
        double eta_p_122388;
        double local_acc_122390 = 0.0;
        double local_acc_122391 = 0.0;
        double local_acc_122392 = 0.0;
        double local_acc_122393 = 0.0;
        double eta_p_118007;
        double eta_p_118008;
        double eta_p_118010;
        double eta_p_118011;
        double eta_p_118013;
        double eta_p_118014;
        double eta_p_118016;
        double eta_p_118017;
        double local_acc_122394 = 0.0;
        double local_acc_122395 = 0.0;
        double local_acc_122396 = 0.0;
        double local_acc_122397 = 0.0;
        int64_t start_122398;
        int64_t end_122399;
        
        start_122398 = start;
        end_122399 = end;
        
        int64_t n_122400 = end_122399 - start_122398;
        
        for (int64_t SegRed_i_122401 = start_122398; SegRed_i_122401 < start_122398 + n_122400; SegRed_i_122401++) {
            int64_t gtid_118006 = SegRed_i_122401;
            double x_118019 = ((double *) mem_111744.mem)[gtid_118006 * m_33388 + gtid_117985];
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_118007 = local_acc_122394;
            }
            // Load next params
            {
                eta_p_118008 = x_118019;
            }
            // SegRed body
            {
                double zp_res_118009 = eta_p_118007 + eta_p_118008;
                
                local_acc_122394 = zp_res_118009;
            }
            // Load accum params
            {
                eta_p_118010 = local_acc_122395;
            }
            // Load next params
            {
                eta_p_118011 = x_118019;
            }
            // SegRed body
            {
                double zp_res_118012 = eta_p_118010 + eta_p_118011;
                
                local_acc_122395 = zp_res_118012;
            }
            // Load accum params
            {
                eta_p_118013 = local_acc_122396;
            }
            // Load next params
            {
                eta_p_118014 = x_118019;
            }
            // SegRed body
            {
                double zp_res_118015 = eta_p_118013 + eta_p_118014;
                
                local_acc_122396 = zp_res_118015;
            }
            // Load accum params
            {
                eta_p_118016 = local_acc_122397;
            }
            // Load next params
            {
                eta_p_118017 = x_118019;
            }
            // SegRed body
            {
                double zp_res_118018 = eta_p_118016 + eta_p_118017;
                
                local_acc_122397 = zp_res_118018;
            }
        }
        
        int64_t uni_i_122402 = 0;
        
        {
            int64_t gtid_118006 = uni_i_122402;
            
            // Load accum params
            {
                eta_p_122378 = local_acc_122390;
            }
            // Load next params
            {
                eta_p_122379 = local_acc_122394;
            }
            // SegRed body
            {
                double zp_res_122380 = eta_p_122378 + eta_p_122379;
                
                local_acc_122390 = zp_res_122380;
            }
            // Load accum params
            {
                eta_p_122381 = local_acc_122391;
            }
            // Load next params
            {
                eta_p_122382 = local_acc_122395;
            }
            // SegRed body
            {
                double zp_res_122383 = eta_p_122381 + eta_p_122382;
                
                local_acc_122391 = zp_res_122383;
            }
            // Load accum params
            {
                eta_p_122384 = local_acc_122392;
            }
            // Load next params
            {
                eta_p_122385 = local_acc_122396;
            }
            // SegRed body
            {
                double zp_res_122386 = eta_p_122384 + eta_p_122385;
                
                local_acc_122392 = zp_res_122386;
            }
            // Load accum params
            {
                eta_p_122387 = local_acc_122393;
            }
            // Load next params
            {
                eta_p_122388 = local_acc_122397;
            }
            // SegRed body
            {
                double zp_res_122389 = eta_p_122387 + eta_p_122388;
                
                local_acc_122393 = zp_res_122389;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_122370.mem)[flat_tid_118005] = local_acc_122390;
        ((double *) reduce_stage_1_tid_res_arr_mem_122372.mem)[flat_tid_118005] = local_acc_122391;
        ((double *) reduce_stage_1_tid_res_arr_mem_122374.mem)[flat_tid_118005] = local_acc_122392;
        ((double *) reduce_stage_1_tid_res_arr_mem_122376.mem)[flat_tid_118005] = local_acc_122393;
    }
    
  cleanup:
    { }
    if (event_127552 != NULL) {
        event_127552->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127551", strdup("nothing further"), event_127552, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127545(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127544 *futhark_mc_task_127544 = (struct futhark_mc_task_127544 *) args;
    struct futhark_context *ctx = futhark_mc_task_127544->ctx;
    struct mc_event *event_127554 = mc_event_new(ctx);
    
    if (event_127554 != NULL)
        event_127554->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127544->free_m_33388;
    struct memblock mem_111744 = {.desc ="mem_111744", .mem =futhark_mc_task_127544->free_mem_111744, .size =0, .references =NULL};
    int64_t gtid_117985 = futhark_mc_task_127544->free_gtid_117985;
    int64_t flat_tid_118005 = futhark_mc_task_127544->free_flat_tid_118005;
    double defunc_res_118001 = *futhark_mc_task_127544->retval_defunc_res_118001;
    double defunc_res_118002 = *futhark_mc_task_127544->retval_defunc_res_118002;
    double defunc_res_118003 = *futhark_mc_task_127544->retval_defunc_res_118003;
    double defunc_res_118004 = *futhark_mc_task_127544->retval_defunc_res_118004;
    int64_t reduce_stage_1_tid_res_arr_mem_122370_cached_sizze_127546 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122370 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_122372_cached_sizze_127547 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122372 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_122374_cached_sizze_127548 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122374 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_122376_cached_sizze_127549 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122376 = NULL;
    int32_t nsubtasks_122369;
    
    nsubtasks_122369 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_122370_cached_sizze_127546 < (int64_t) 8 * nsubtasks_122369) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122370, &reduce_stage_1_tid_res_arr_mem_122370_cached_sizze_127546, (int64_t) 8 * nsubtasks_122369);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_122372_cached_sizze_127547 < (int64_t) 8 * nsubtasks_122369) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122372, &reduce_stage_1_tid_res_arr_mem_122372_cached_sizze_127547, (int64_t) 8 * nsubtasks_122369);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_122374_cached_sizze_127548 < (int64_t) 8 * nsubtasks_122369) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122374, &reduce_stage_1_tid_res_arr_mem_122374_cached_sizze_127548, (int64_t) 8 * nsubtasks_122369);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_122376_cached_sizze_127549 < (int64_t) 8 * nsubtasks_122369) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122376, &reduce_stage_1_tid_res_arr_mem_122376_cached_sizze_127549, (int64_t) 8 * nsubtasks_122369);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127550 futhark_mc_segred_stage_1_parloop_struct_127550_;
    
    futhark_mc_segred_stage_1_parloop_struct_127550_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127550_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127550_.free_mem_111744 = mem_111744.mem;
    futhark_mc_segred_stage_1_parloop_struct_127550_.free_gtid_117985 = gtid_117985;
    futhark_mc_segred_stage_1_parloop_struct_127550_.free_reduce_stage_1_tid_res_arr_mem_122370 = reduce_stage_1_tid_res_arr_mem_122370;
    futhark_mc_segred_stage_1_parloop_struct_127550_.free_reduce_stage_1_tid_res_arr_mem_122372 = reduce_stage_1_tid_res_arr_mem_122372;
    futhark_mc_segred_stage_1_parloop_struct_127550_.free_reduce_stage_1_tid_res_arr_mem_122374 = reduce_stage_1_tid_res_arr_mem_122374;
    futhark_mc_segred_stage_1_parloop_struct_127550_.free_reduce_stage_1_tid_res_arr_mem_122376 = reduce_stage_1_tid_res_arr_mem_122376;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127551_task;
    
    futhark_mc_segred_stage_1_parloop_127551_task.name = "futhark_mc_segred_stage_1_parloop_127551";
    futhark_mc_segred_stage_1_parloop_127551_task.fn = futhark_mc_segred_stage_1_parloop_127551;
    futhark_mc_segred_stage_1_parloop_127551_task.args = &futhark_mc_segred_stage_1_parloop_struct_127550_;
    futhark_mc_segred_stage_1_parloop_127551_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127551_task.info = info;
    
    struct mc_event *event_127553 = mc_event_new(ctx);
    
    if (event_127553 != NULL)
        event_127553->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127551_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127551_task);
    
    if (futhark_mc_segred_stage_1_parloop_127551_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127551_err;
        goto cleanup;
    }
    if (event_127553 != NULL) {
        event_127553->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127551_total", strdup("nothing further"), event_127553, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_118001 = 0.0;
        defunc_res_118002 = 0.0;
        defunc_res_118003 = 0.0;
        defunc_res_118004 = 0.0;
    }
    
    double eta_p_122403;
    double eta_p_122404;
    double eta_p_122406;
    double eta_p_122407;
    double eta_p_122409;
    double eta_p_122410;
    double eta_p_122412;
    double eta_p_122413;
    
    for (int32_t i_122415 = 0; i_122415 < nsubtasks_122369; i_122415++) {
        flat_tid_118005 = i_122415;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_122403 = defunc_res_118001;
            }
            // load next params
            {
                eta_p_122404 = ((double *) reduce_stage_1_tid_res_arr_mem_122370)[flat_tid_118005];
            }
            // red body
            {
                double zp_res_122405 = eta_p_122403 + eta_p_122404;
                
                defunc_res_118001 = zp_res_122405;
            }
            // load acc params
            {
                eta_p_122406 = defunc_res_118002;
            }
            // load next params
            {
                eta_p_122407 = ((double *) reduce_stage_1_tid_res_arr_mem_122372)[flat_tid_118005];
            }
            // red body
            {
                double zp_res_122408 = eta_p_122406 + eta_p_122407;
                
                defunc_res_118002 = zp_res_122408;
            }
            // load acc params
            {
                eta_p_122409 = defunc_res_118003;
            }
            // load next params
            {
                eta_p_122410 = ((double *) reduce_stage_1_tid_res_arr_mem_122374)[flat_tid_118005];
            }
            // red body
            {
                double zp_res_122411 = eta_p_122409 + eta_p_122410;
                
                defunc_res_118003 = zp_res_122411;
            }
            // load acc params
            {
                eta_p_122412 = defunc_res_118004;
            }
            // load next params
            {
                eta_p_122413 = ((double *) reduce_stage_1_tid_res_arr_mem_122376)[flat_tid_118005];
            }
            // red body
            {
                double zp_res_122414 = eta_p_122412 + eta_p_122413;
                
                defunc_res_118004 = zp_res_122414;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_122370);
        free(reduce_stage_1_tid_res_arr_mem_122372);
        free(reduce_stage_1_tid_res_arr_mem_122374);
        free(reduce_stage_1_tid_res_arr_mem_122376);
    }
    if (event_127554 != NULL) {
        event_127554->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127545", strdup("nothing further"), event_127554, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127544->retval_defunc_res_118001 = defunc_res_118001;
        *futhark_mc_task_127544->retval_defunc_res_118002 = defunc_res_118002;
        *futhark_mc_task_127544->retval_defunc_res_118003 = defunc_res_118003;
        *futhark_mc_task_127544->retval_defunc_res_118004 = defunc_res_118004;
    }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_127543(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127542 *futhark_mc_segred_stage_1_parloop_struct_127542 = (struct futhark_mc_segred_stage_1_parloop_struct_127542 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127542->ctx;
    struct mc_event *event_127555 = mc_event_new(ctx);
    
    if (event_127555 != NULL)
        event_127555->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127542->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_127542->free_lifted_lambda_res_106391;
    double zt_res_106587 = futhark_mc_segred_stage_1_parloop_struct_127542->free_zt_res_106587;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_127542->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_111744 = {.desc ="mem_111744", .mem =futhark_mc_segred_stage_1_parloop_struct_127542->free_mem_111744, .size =0, .references =NULL};
    struct memblock mem_111746 = {.desc ="mem_111746", .mem =futhark_mc_segred_stage_1_parloop_struct_127542->free_mem_111746, .size =0, .references =NULL};
    struct memblock mem_111748 = {.desc ="mem_111748", .mem =futhark_mc_segred_stage_1_parloop_struct_127542->free_mem_111748, .size =0, .references =NULL};
    struct memblock mem_111750 = {.desc ="mem_111750", .mem =futhark_mc_segred_stage_1_parloop_struct_127542->free_mem_111750, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122337 = {.desc ="reduce_stage_1_tid_res_arr_mem_122337", .mem =futhark_mc_segred_stage_1_parloop_struct_127542->free_reduce_stage_1_tid_res_arr_mem_122337, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122339 = {.desc ="reduce_stage_1_tid_res_arr_mem_122339", .mem =futhark_mc_segred_stage_1_parloop_struct_127542->free_reduce_stage_1_tid_res_arr_mem_122339, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122341 = {.desc ="reduce_stage_1_tid_res_arr_mem_122341", .mem =futhark_mc_segred_stage_1_parloop_struct_127542->free_reduce_stage_1_tid_res_arr_mem_122341, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122343 = {.desc ="reduce_stage_1_tid_res_arr_mem_122343", .mem =futhark_mc_segred_stage_1_parloop_struct_127542->free_reduce_stage_1_tid_res_arr_mem_122343, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_117984;
    
    flat_tid_117984 = subtask_id;
    {
        double eta_p_122345;
        double eta_p_122346;
        double eta_p_122348;
        double eta_p_122349;
        double eta_p_122351;
        double eta_p_122352;
        double eta_p_122354;
        double eta_p_122355;
        double local_acc_122357 = 0.0;
        double local_acc_122358 = 0.0;
        double local_acc_122359 = 0.0;
        double local_acc_122360 = 0.0;
        double eta_p_117986;
        double eta_p_117987;
        double eta_p_117989;
        double eta_p_117990;
        double eta_p_117992;
        double eta_p_117993;
        double eta_p_117995;
        double eta_p_117996;
        double local_acc_122361 = 0.0;
        double local_acc_122362 = 0.0;
        double local_acc_122363 = 0.0;
        double local_acc_122364 = 0.0;
        int64_t start_122365;
        int64_t end_122366;
        
        start_122365 = start;
        end_122366 = end;
        
        int64_t n_122367 = end_122366 - start_122365;
        
        for (int64_t SegRed_i_122368 = start_122365; SegRed_i_122368 < start_122365 + n_122367; SegRed_i_122368++) {
            int64_t gtid_117985 = SegRed_i_122368;
            double x_117998 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + gtid_117985];
            double log_res_117999 = futrts_log64(x_117998);
            double zt_res_118000 = zt_res_106587 * log_res_117999;
            double defunc_res_118001;
            double defunc_res_118002;
            double defunc_res_118003;
            double defunc_res_118004;
            int64_t flat_tid_118005 = (int64_t) 0;
            
            defunc_res_118001 = 0.0;
            defunc_res_118002 = 0.0;
            defunc_res_118003 = 0.0;
            defunc_res_118004 = 0.0;
            
            struct futhark_mc_task_127544 futhark_mc_task_127544_;
            
            futhark_mc_task_127544_.ctx = ctx;
            futhark_mc_task_127544_.free_m_33388 = m_33388;
            futhark_mc_task_127544_.free_mem_111744 = mem_111744.mem;
            futhark_mc_task_127544_.free_gtid_117985 = gtid_117985;
            futhark_mc_task_127544_.free_flat_tid_118005 = flat_tid_118005;
            futhark_mc_task_127544_.retval_defunc_res_118001 = (double *) &defunc_res_118001;
            #if ISPC
            futhark_mc_task_127544_.retval_defunc_res_118001 += programIndex;
            #endif
            futhark_mc_task_127544_.retval_defunc_res_118002 = (double *) &defunc_res_118002;
            #if ISPC
            futhark_mc_task_127544_.retval_defunc_res_118002 += programIndex;
            #endif
            futhark_mc_task_127544_.retval_defunc_res_118003 = (double *) &defunc_res_118003;
            #if ISPC
            futhark_mc_task_127544_.retval_defunc_res_118003 += programIndex;
            #endif
            futhark_mc_task_127544_.retval_defunc_res_118004 = (double *) &defunc_res_118004;
            #if ISPC
            futhark_mc_task_127544_.retval_defunc_res_118004 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_127544_task;
            
            futhark_mc_task_127544_task.args = &futhark_mc_task_127544_;
            futhark_mc_task_127544_task.top_level_fn = futhark_mc_segred_task_127545;
            futhark_mc_task_127544_task.name = "futhark_mc_segred_task_127545";
            futhark_mc_task_127544_task.iterations = m_33388;
            futhark_mc_task_127544_task.task_time = &ctx->program->futhark_mc_segred_task_127545_total_time;
            futhark_mc_task_127544_task.task_iter = &ctx->program->futhark_mc_segred_task_127545_total_iter;
            futhark_mc_task_127544_task.sched = STATIC;
            futhark_mc_task_127544_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_127545_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127544_task);
            
            if (futhark_mc_segred_task_127545_err != 0) {
                err = futhark_mc_segred_task_127545_err;
                goto cleanup;
            }
            
            bool zeze_res_118020 = defunc_res_118001 == 0.0;
            double klu_res_118021;
            
            if (zeze_res_118020) {
                klu_res_118021 = 0.0;
            } else {
                double zs_res_118022 = defunc_res_118001 / x_117998;
                double log_res_118023 = futrts_log64(zs_res_118022);
                double zt_res_118024 = defunc_res_118001 * log_res_118023;
                
                klu_res_118021 = zt_res_118024;
            }
            
            bool zeze_res_118025 = defunc_res_118002 == 0.0;
            double klu_res_118026;
            
            if (zeze_res_118025) {
                klu_res_118026 = 0.0;
            } else {
                double zs_res_118027 = defunc_res_118002 / x_117998;
                double log_res_118028 = futrts_log64(zs_res_118027);
                double zt_res_118029 = defunc_res_118002 * log_res_118028;
                
                klu_res_118026 = zt_res_118029;
            }
            // save map-out results
            {
                ((double *) mem_111746.mem)[gtid_117985] = defunc_res_118004;
                ((double *) mem_111748.mem)[gtid_117985] = defunc_res_118003;
                ((double *) mem_111750.mem)[gtid_117985] = zt_res_118000;
            }
            // Load accum params
            {
                eta_p_117986 = local_acc_122361;
            }
            // Load next params
            {
                eta_p_117987 = klu_res_118021;
            }
            // SegRed body
            {
                double zp_res_117988 = eta_p_117986 + eta_p_117987;
                
                local_acc_122361 = zp_res_117988;
            }
            // Load accum params
            {
                eta_p_117989 = local_acc_122362;
            }
            // Load next params
            {
                eta_p_117990 = klu_res_118026;
            }
            // SegRed body
            {
                double zp_res_117991 = eta_p_117989 + eta_p_117990;
                
                local_acc_122362 = zp_res_117991;
            }
            // Load accum params
            {
                eta_p_117992 = local_acc_122363;
            }
            // Load next params
            {
                eta_p_117993 = x_117998;
            }
            // SegRed body
            {
                double zp_res_117994 = eta_p_117992 + eta_p_117993;
                
                local_acc_122363 = zp_res_117994;
            }
            // Load accum params
            {
                eta_p_117995 = local_acc_122364;
            }
            // Load next params
            {
                eta_p_117996 = x_117998;
            }
            // SegRed body
            {
                double zp_res_117997 = eta_p_117995 + eta_p_117996;
                
                local_acc_122364 = zp_res_117997;
            }
        }
        
        int64_t uni_i_122416 = 0;
        
        {
            int64_t gtid_117985 = uni_i_122416;
            
            // Load accum params
            {
                eta_p_122345 = local_acc_122357;
            }
            // Load next params
            {
                eta_p_122346 = local_acc_122361;
            }
            // SegRed body
            {
                double zp_res_122347 = eta_p_122345 + eta_p_122346;
                
                local_acc_122357 = zp_res_122347;
            }
            // Load accum params
            {
                eta_p_122348 = local_acc_122358;
            }
            // Load next params
            {
                eta_p_122349 = local_acc_122362;
            }
            // SegRed body
            {
                double zp_res_122350 = eta_p_122348 + eta_p_122349;
                
                local_acc_122358 = zp_res_122350;
            }
            // Load accum params
            {
                eta_p_122351 = local_acc_122359;
            }
            // Load next params
            {
                eta_p_122352 = local_acc_122363;
            }
            // SegRed body
            {
                double zp_res_122353 = eta_p_122351 + eta_p_122352;
                
                local_acc_122359 = zp_res_122353;
            }
            // Load accum params
            {
                eta_p_122354 = local_acc_122360;
            }
            // Load next params
            {
                eta_p_122355 = local_acc_122364;
            }
            // SegRed body
            {
                double zp_res_122356 = eta_p_122354 + eta_p_122355;
                
                local_acc_122360 = zp_res_122356;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_122337.mem)[flat_tid_117984] = local_acc_122357;
        ((double *) reduce_stage_1_tid_res_arr_mem_122339.mem)[flat_tid_117984] = local_acc_122358;
        ((double *) reduce_stage_1_tid_res_arr_mem_122341.mem)[flat_tid_117984] = local_acc_122359;
        ((double *) reduce_stage_1_tid_res_arr_mem_122343.mem)[flat_tid_117984] = local_acc_122360;
    }
    
  cleanup:
    { }
    if (event_127555 != NULL) {
        event_127555->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127543", strdup("nothing further"), event_127555, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_127537(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127526 *futhark_mc_task_127526 = (struct futhark_mc_task_127526 *) args;
    struct futhark_context *ctx = futhark_mc_task_127526->ctx;
    struct mc_event *event_127557 = mc_event_new(ctx);
    
    if (event_127557 != NULL)
        event_127557->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127526->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_127526->free_lifted_lambda_res_106391;
    double zt_res_106587 = futhark_mc_task_127526->free_zt_res_106587;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_127526->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_111744 = {.desc ="mem_111744", .mem =futhark_mc_task_127526->free_mem_111744, .size =0, .references =NULL};
    int64_t flat_tid_117984 = futhark_mc_task_127526->free_flat_tid_117984;
    int64_t flat_tid_118030 = futhark_mc_task_127526->free_flat_tid_118030;
    double defunc_res_106588 = *futhark_mc_task_127526->retval_defunc_res_106588;
    double defunc_res_106589 = *futhark_mc_task_127526->retval_defunc_res_106589;
    double defunc_res_106590 = *futhark_mc_task_127526->retval_defunc_res_106590;
    double defunc_res_106591 = *futhark_mc_task_127526->retval_defunc_res_106591;
    struct memblock mem_111746 = {.desc ="mem_111746", .mem =futhark_mc_task_127526->retval_mem_111746, .size =0, .references =NULL};
    struct memblock mem_111748 = {.desc ="mem_111748", .mem =futhark_mc_task_127526->retval_mem_111748, .size =0, .references =NULL};
    struct memblock mem_111750 = {.desc ="mem_111750", .mem =futhark_mc_task_127526->retval_mem_111750, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_122337_cached_sizze_127538 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122337 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_122339_cached_sizze_127539 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122339 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_122341_cached_sizze_127540 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122341 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_122343_cached_sizze_127541 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122343 = NULL;
    int32_t nsubtasks_122336;
    
    nsubtasks_122336 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_122337_cached_sizze_127538 < (int64_t) 8 * nsubtasks_122336) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122337, &reduce_stage_1_tid_res_arr_mem_122337_cached_sizze_127538, (int64_t) 8 * nsubtasks_122336);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_122339_cached_sizze_127539 < (int64_t) 8 * nsubtasks_122336) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122339, &reduce_stage_1_tid_res_arr_mem_122339_cached_sizze_127539, (int64_t) 8 * nsubtasks_122336);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_122341_cached_sizze_127540 < (int64_t) 8 * nsubtasks_122336) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122341, &reduce_stage_1_tid_res_arr_mem_122341_cached_sizze_127540, (int64_t) 8 * nsubtasks_122336);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_122343_cached_sizze_127541 < (int64_t) 8 * nsubtasks_122336) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122343, &reduce_stage_1_tid_res_arr_mem_122343_cached_sizze_127541, (int64_t) 8 * nsubtasks_122336);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127542 futhark_mc_segred_stage_1_parloop_struct_127542_;
    
    futhark_mc_segred_stage_1_parloop_struct_127542_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127542_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127542_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_127542_.free_zt_res_106587 = zt_res_106587;
    futhark_mc_segred_stage_1_parloop_struct_127542_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_127542_.free_mem_111744 = mem_111744.mem;
    futhark_mc_segred_stage_1_parloop_struct_127542_.free_mem_111746 = mem_111746.mem;
    futhark_mc_segred_stage_1_parloop_struct_127542_.free_mem_111748 = mem_111748.mem;
    futhark_mc_segred_stage_1_parloop_struct_127542_.free_mem_111750 = mem_111750.mem;
    futhark_mc_segred_stage_1_parloop_struct_127542_.free_reduce_stage_1_tid_res_arr_mem_122337 = reduce_stage_1_tid_res_arr_mem_122337;
    futhark_mc_segred_stage_1_parloop_struct_127542_.free_reduce_stage_1_tid_res_arr_mem_122339 = reduce_stage_1_tid_res_arr_mem_122339;
    futhark_mc_segred_stage_1_parloop_struct_127542_.free_reduce_stage_1_tid_res_arr_mem_122341 = reduce_stage_1_tid_res_arr_mem_122341;
    futhark_mc_segred_stage_1_parloop_struct_127542_.free_reduce_stage_1_tid_res_arr_mem_122343 = reduce_stage_1_tid_res_arr_mem_122343;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127543_task;
    
    futhark_mc_segred_stage_1_parloop_127543_task.name = "futhark_mc_segred_stage_1_parloop_127543";
    futhark_mc_segred_stage_1_parloop_127543_task.fn = futhark_mc_segred_stage_1_parloop_127543;
    futhark_mc_segred_stage_1_parloop_127543_task.args = &futhark_mc_segred_stage_1_parloop_struct_127542_;
    futhark_mc_segred_stage_1_parloop_127543_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127543_task.info = info;
    
    struct mc_event *event_127556 = mc_event_new(ctx);
    
    if (event_127556 != NULL)
        event_127556->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127543_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127543_task);
    
    if (futhark_mc_segred_stage_1_parloop_127543_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127543_err;
        goto cleanup;
    }
    if (event_127556 != NULL) {
        event_127556->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127543_total", strdup("nothing further"), event_127556, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_106588 = 0.0;
        defunc_res_106589 = 0.0;
        defunc_res_106590 = 0.0;
        defunc_res_106591 = 0.0;
    }
    
    double eta_p_122417;
    double eta_p_122418;
    double eta_p_122420;
    double eta_p_122421;
    double eta_p_122423;
    double eta_p_122424;
    double eta_p_122426;
    double eta_p_122427;
    
    for (int32_t i_122429 = 0; i_122429 < nsubtasks_122336; i_122429++) {
        flat_tid_117984 = i_122429;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_122417 = defunc_res_106588;
            }
            // load next params
            {
                eta_p_122418 = ((double *) reduce_stage_1_tid_res_arr_mem_122337)[flat_tid_117984];
            }
            // red body
            {
                double zp_res_122419 = eta_p_122417 + eta_p_122418;
                
                defunc_res_106588 = zp_res_122419;
            }
            // load acc params
            {
                eta_p_122420 = defunc_res_106589;
            }
            // load next params
            {
                eta_p_122421 = ((double *) reduce_stage_1_tid_res_arr_mem_122339)[flat_tid_117984];
            }
            // red body
            {
                double zp_res_122422 = eta_p_122420 + eta_p_122421;
                
                defunc_res_106589 = zp_res_122422;
            }
            // load acc params
            {
                eta_p_122423 = defunc_res_106590;
            }
            // load next params
            {
                eta_p_122424 = ((double *) reduce_stage_1_tid_res_arr_mem_122341)[flat_tid_117984];
            }
            // red body
            {
                double zp_res_122425 = eta_p_122423 + eta_p_122424;
                
                defunc_res_106590 = zp_res_122425;
            }
            // load acc params
            {
                eta_p_122426 = defunc_res_106591;
            }
            // load next params
            {
                eta_p_122427 = ((double *) reduce_stage_1_tid_res_arr_mem_122343)[flat_tid_117984];
            }
            // red body
            {
                double zp_res_122428 = eta_p_122426 + eta_p_122427;
                
                defunc_res_106591 = zp_res_122428;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_122337);
        free(reduce_stage_1_tid_res_arr_mem_122339);
        free(reduce_stage_1_tid_res_arr_mem_122341);
        free(reduce_stage_1_tid_res_arr_mem_122343);
    }
    if (event_127557 != NULL) {
        event_127557->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_127537", strdup("nothing further"), event_127557, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127526->retval_defunc_res_106588 = defunc_res_106588;
        *futhark_mc_task_127526->retval_defunc_res_106589 = defunc_res_106589;
        *futhark_mc_task_127526->retval_defunc_res_106590 = defunc_res_106590;
        *futhark_mc_task_127526->retval_defunc_res_106591 = defunc_res_106591;
        futhark_mc_task_127526->retval_mem_111746 = mem_111746.mem;
        futhark_mc_task_127526->retval_mem_111748 = mem_111748.mem;
        futhark_mc_task_127526->retval_mem_111750 = mem_111750.mem;
    }
    return err;
}
struct futhark_mc_task_127558 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_111746;
    unsigned char *free_mem_111748;
    int64_t free_flat_tid_118071;
    int64_t free_flat_tid_118094;
    double *retval_defunc_0_reduce_res_106693;
    unsigned char *retval_mem_111752;
};
struct futhark_mc_segred_stage_1_parloop_struct_127561 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_111746;
    unsigned char *free_mem_111748;
    unsigned char *free_mem_111752;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122431;
};
static int futhark_mc_segred_stage_1_parloop_127562(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127561 *futhark_mc_segred_stage_1_parloop_struct_127561 = (struct futhark_mc_segred_stage_1_parloop_struct_127561 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127561->ctx;
    struct mc_event *event_127563 = mc_event_new(ctx);
    
    if (event_127563 != NULL)
        event_127563->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127561->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_127561->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_127561->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_111746 = {.desc ="mem_111746", .mem =futhark_mc_segred_stage_1_parloop_struct_127561->free_mem_111746, .size =0, .references =NULL};
    struct memblock mem_111748 = {.desc ="mem_111748", .mem =futhark_mc_segred_stage_1_parloop_struct_127561->free_mem_111748, .size =0, .references =NULL};
    struct memblock mem_111752 = {.desc ="mem_111752", .mem =futhark_mc_segred_stage_1_parloop_struct_127561->free_mem_111752, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122431 = {.desc ="reduce_stage_1_tid_res_arr_mem_122431", .mem =futhark_mc_segred_stage_1_parloop_struct_127561->free_reduce_stage_1_tid_res_arr_mem_122431, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118094;
    
    flat_tid_118094 = subtask_id;
    {
        double eta_p_122433;
        double eta_p_122434;
        double local_acc_122436 = 0.0;
        double eta_p_118096;
        double eta_p_118097;
        double local_acc_122437 = 0.0;
        int64_t start_122438;
        int64_t end_122439;
        
        start_122438 = start;
        end_122439 = end;
        
        int64_t n_122440 = end_122439 - start_122438;
        
        for (int64_t SegRed_i_122441 = start_122438; SegRed_i_122441 < start_122438 + n_122440; SegRed_i_122441++) {
            int64_t gtid_118095 = SegRed_i_122441;
            double eta_p_118099 = ((double *) mem_111746.mem)[gtid_118095];
            double defunc_0_reduce_res_118100;
            double defunc_0_reduce_res_118101;
            double redout_118103;
            double redout_118104;
            
            redout_118103 = 0.0;
            redout_118104 = 0.0;
            for (int64_t i_118102 = 0; i_118102 < m_33388; i_118102++) {
                double eta_p_118105 = ((double *) A_mem_111707.mem)[lifted_lambda_res_106391 * (m_33388 * m_33388) + gtid_118095 * m_33388 + i_118102];
                double eta_p_118106 = ((double *) mem_111746.mem)[i_118102];
                double eta_p_118107 = ((double *) mem_111748.mem)[i_118102];
                double zt_res_118108 = eta_p_118105 * eta_p_118105;
                double zt_res_118109 = eta_p_118107 * zt_res_118108;
                double zt_res_118110 = eta_p_118106 * zt_res_118108;
                double zp_res_118111 = zt_res_118109 + redout_118103;
                double zp_res_118112 = zt_res_118110 + redout_118104;
                double redout_tmp_122442 = zp_res_118111;
                double redout_tmp_122443 = zp_res_118112;
                
                redout_118103 = redout_tmp_122442;
                redout_118104 = redout_tmp_122443;
            }
            defunc_0_reduce_res_118100 = redout_118103;
            defunc_0_reduce_res_118101 = redout_118104;
            
            double zt_res_118113 = eta_p_118099 * defunc_0_reduce_res_118101;
            
            // save map-out results
            {
                ((double *) mem_111752.mem)[gtid_118095] = defunc_0_reduce_res_118100;
            }
            // Load accum params
            {
                eta_p_118096 = local_acc_122437;
            }
            // Load next params
            {
                eta_p_118097 = zt_res_118113;
            }
            // SegRed body
            {
                double zp_res_118098 = eta_p_118096 + eta_p_118097;
                
                local_acc_122437 = zp_res_118098;
            }
        }
        
        int64_t uni_i_122444 = 0;
        
        {
            int64_t gtid_118095 = uni_i_122444;
            
            // Load accum params
            {
                eta_p_122433 = local_acc_122436;
            }
            // Load next params
            {
                eta_p_122434 = local_acc_122437;
            }
            // SegRed body
            {
                double zp_res_122435 = eta_p_122433 + eta_p_122434;
                
                local_acc_122436 = zp_res_122435;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_122431.mem)[flat_tid_118094] = local_acc_122436;
    }
    
  cleanup:
    { }
    if (event_127563 != NULL) {
        event_127563->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127562", strdup("nothing further"), event_127563, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127559(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127558 *futhark_mc_task_127558 = (struct futhark_mc_task_127558 *) args;
    struct futhark_context *ctx = futhark_mc_task_127558->ctx;
    struct mc_event *event_127565 = mc_event_new(ctx);
    
    if (event_127565 != NULL)
        event_127565->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127558->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_127558->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_127558->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_111746 = {.desc ="mem_111746", .mem =futhark_mc_task_127558->free_mem_111746, .size =0, .references =NULL};
    struct memblock mem_111748 = {.desc ="mem_111748", .mem =futhark_mc_task_127558->free_mem_111748, .size =0, .references =NULL};
    int64_t flat_tid_118071 = futhark_mc_task_127558->free_flat_tid_118071;
    int64_t flat_tid_118094 = futhark_mc_task_127558->free_flat_tid_118094;
    double defunc_0_reduce_res_106693 = *futhark_mc_task_127558->retval_defunc_0_reduce_res_106693;
    struct memblock mem_111752 = {.desc ="mem_111752", .mem =futhark_mc_task_127558->retval_mem_111752, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_122431_cached_sizze_127560 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122431 = NULL;
    int32_t nsubtasks_122430;
    
    nsubtasks_122430 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_122431_cached_sizze_127560 < (int64_t) 8 * nsubtasks_122430) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122431, &reduce_stage_1_tid_res_arr_mem_122431_cached_sizze_127560, (int64_t) 8 * nsubtasks_122430);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127561 futhark_mc_segred_stage_1_parloop_struct_127561_;
    
    futhark_mc_segred_stage_1_parloop_struct_127561_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127561_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127561_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_127561_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_127561_.free_mem_111746 = mem_111746.mem;
    futhark_mc_segred_stage_1_parloop_struct_127561_.free_mem_111748 = mem_111748.mem;
    futhark_mc_segred_stage_1_parloop_struct_127561_.free_mem_111752 = mem_111752.mem;
    futhark_mc_segred_stage_1_parloop_struct_127561_.free_reduce_stage_1_tid_res_arr_mem_122431 = reduce_stage_1_tid_res_arr_mem_122431;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127562_task;
    
    futhark_mc_segred_stage_1_parloop_127562_task.name = "futhark_mc_segred_stage_1_parloop_127562";
    futhark_mc_segred_stage_1_parloop_127562_task.fn = futhark_mc_segred_stage_1_parloop_127562;
    futhark_mc_segred_stage_1_parloop_127562_task.args = &futhark_mc_segred_stage_1_parloop_struct_127561_;
    futhark_mc_segred_stage_1_parloop_127562_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127562_task.info = info;
    
    struct mc_event *event_127564 = mc_event_new(ctx);
    
    if (event_127564 != NULL)
        event_127564->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127562_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127562_task);
    
    if (futhark_mc_segred_stage_1_parloop_127562_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127562_err;
        goto cleanup;
    }
    if (event_127564 != NULL) {
        event_127564->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127562_total", strdup("nothing further"), event_127564, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_106693 = 0.0;
    }
    
    double eta_p_122445;
    double eta_p_122446;
    
    for (int32_t i_122448 = 0; i_122448 < nsubtasks_122430; i_122448++) {
        flat_tid_118094 = i_122448;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_122445 = defunc_0_reduce_res_106693;
            }
            // load next params
            {
                eta_p_122446 = ((double *) reduce_stage_1_tid_res_arr_mem_122431)[flat_tid_118094];
            }
            // red body
            {
                double zp_res_122447 = eta_p_122445 + eta_p_122446;
                
                defunc_0_reduce_res_106693 = zp_res_122447;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_122431);
    }
    if (event_127565 != NULL) {
        event_127565->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127559", strdup("nothing further"), event_127565, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127558->retval_defunc_0_reduce_res_106693 = defunc_0_reduce_res_106693;
        futhark_mc_task_127558->retval_mem_111752 = mem_111752.mem;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_127568 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_111746;
    unsigned char *free_mem_111748;
    unsigned char *free_mem_111752;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122450;
};
struct futhark_mc_task_127570 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_111746;
    unsigned char *free_mem_111748;
    int64_t free_gtid_118072;
    int64_t free_flat_tid_118079;
    double *retval_defunc_0_reduce_res_118077;
    double *retval_defunc_0_reduce_res_118078;
};
struct futhark_mc_segred_stage_1_parloop_struct_127574 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_111746;
    unsigned char *free_mem_111748;
    int64_t free_gtid_118072;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122462;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122464;
};
static int futhark_mc_segred_stage_1_parloop_127575(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127574 *futhark_mc_segred_stage_1_parloop_struct_127574 = (struct futhark_mc_segred_stage_1_parloop_struct_127574 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127574->ctx;
    struct mc_event *event_127576 = mc_event_new(ctx);
    
    if (event_127576 != NULL)
        event_127576->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127574->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_127574->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_127574->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_111746 = {.desc ="mem_111746", .mem =futhark_mc_segred_stage_1_parloop_struct_127574->free_mem_111746, .size =0, .references =NULL};
    struct memblock mem_111748 = {.desc ="mem_111748", .mem =futhark_mc_segred_stage_1_parloop_struct_127574->free_mem_111748, .size =0, .references =NULL};
    int64_t gtid_118072 = futhark_mc_segred_stage_1_parloop_struct_127574->free_gtid_118072;
    struct memblock reduce_stage_1_tid_res_arr_mem_122462 = {.desc ="reduce_stage_1_tid_res_arr_mem_122462", .mem =futhark_mc_segred_stage_1_parloop_struct_127574->free_reduce_stage_1_tid_res_arr_mem_122462, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122464 = {.desc ="reduce_stage_1_tid_res_arr_mem_122464", .mem =futhark_mc_segred_stage_1_parloop_struct_127574->free_reduce_stage_1_tid_res_arr_mem_122464, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118079;
    
    flat_tid_118079 = subtask_id;
    {
        double eta_p_122466;
        double eta_p_122467;
        double eta_p_122469;
        double eta_p_122470;
        double local_acc_122472 = 0.0;
        double local_acc_122473 = 0.0;
        double eta_p_118081;
        double eta_p_118082;
        double eta_p_118084;
        double eta_p_118085;
        double local_acc_122474 = 0.0;
        double local_acc_122475 = 0.0;
        int64_t start_122476;
        int64_t end_122477;
        
        start_122476 = start;
        end_122477 = end;
        
        int64_t n_122478 = end_122477 - start_122476;
        
        for (int64_t SegRed_i_122479 = start_122476; SegRed_i_122479 < start_122476 + n_122478; SegRed_i_122479++) {
            int64_t gtid_118080 = SegRed_i_122479;
            double eta_p_118087 = ((double *) A_mem_111707.mem)[lifted_lambda_res_106391 * (m_33388 * m_33388) + gtid_118072 * m_33388 + gtid_118080];
            double eta_p_118088 = ((double *) mem_111746.mem)[gtid_118080];
            double eta_p_118089 = ((double *) mem_111748.mem)[gtid_118080];
            double zt_res_118090 = eta_p_118087 * eta_p_118087;
            double zt_res_118091 = eta_p_118089 * zt_res_118090;
            double zt_res_118092 = eta_p_118088 * zt_res_118090;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_118081 = local_acc_122474;
            }
            // Load next params
            {
                eta_p_118082 = zt_res_118091;
            }
            // SegRed body
            {
                double zp_res_118083 = eta_p_118081 + eta_p_118082;
                
                local_acc_122474 = zp_res_118083;
            }
            // Load accum params
            {
                eta_p_118084 = local_acc_122475;
            }
            // Load next params
            {
                eta_p_118085 = zt_res_118092;
            }
            // SegRed body
            {
                double zp_res_118086 = eta_p_118084 + eta_p_118085;
                
                local_acc_122475 = zp_res_118086;
            }
        }
        
        int64_t uni_i_122480 = 0;
        
        {
            int64_t gtid_118080 = uni_i_122480;
            
            // Load accum params
            {
                eta_p_122466 = local_acc_122472;
            }
            // Load next params
            {
                eta_p_122467 = local_acc_122474;
            }
            // SegRed body
            {
                double zp_res_122468 = eta_p_122466 + eta_p_122467;
                
                local_acc_122472 = zp_res_122468;
            }
            // Load accum params
            {
                eta_p_122469 = local_acc_122473;
            }
            // Load next params
            {
                eta_p_122470 = local_acc_122475;
            }
            // SegRed body
            {
                double zp_res_122471 = eta_p_122469 + eta_p_122470;
                
                local_acc_122473 = zp_res_122471;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_122462.mem)[flat_tid_118079] = local_acc_122472;
        ((double *) reduce_stage_1_tid_res_arr_mem_122464.mem)[flat_tid_118079] = local_acc_122473;
    }
    
  cleanup:
    { }
    if (event_127576 != NULL) {
        event_127576->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127575", strdup("nothing further"), event_127576, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127571(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127570 *futhark_mc_task_127570 = (struct futhark_mc_task_127570 *) args;
    struct futhark_context *ctx = futhark_mc_task_127570->ctx;
    struct mc_event *event_127578 = mc_event_new(ctx);
    
    if (event_127578 != NULL)
        event_127578->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127570->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_127570->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_127570->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_111746 = {.desc ="mem_111746", .mem =futhark_mc_task_127570->free_mem_111746, .size =0, .references =NULL};
    struct memblock mem_111748 = {.desc ="mem_111748", .mem =futhark_mc_task_127570->free_mem_111748, .size =0, .references =NULL};
    int64_t gtid_118072 = futhark_mc_task_127570->free_gtid_118072;
    int64_t flat_tid_118079 = futhark_mc_task_127570->free_flat_tid_118079;
    double defunc_0_reduce_res_118077 = *futhark_mc_task_127570->retval_defunc_0_reduce_res_118077;
    double defunc_0_reduce_res_118078 = *futhark_mc_task_127570->retval_defunc_0_reduce_res_118078;
    int64_t reduce_stage_1_tid_res_arr_mem_122462_cached_sizze_127572 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122462 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_122464_cached_sizze_127573 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122464 = NULL;
    int32_t nsubtasks_122461;
    
    nsubtasks_122461 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_122462_cached_sizze_127572 < (int64_t) 8 * nsubtasks_122461) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122462, &reduce_stage_1_tid_res_arr_mem_122462_cached_sizze_127572, (int64_t) 8 * nsubtasks_122461);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_122464_cached_sizze_127573 < (int64_t) 8 * nsubtasks_122461) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122464, &reduce_stage_1_tid_res_arr_mem_122464_cached_sizze_127573, (int64_t) 8 * nsubtasks_122461);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127574 futhark_mc_segred_stage_1_parloop_struct_127574_;
    
    futhark_mc_segred_stage_1_parloop_struct_127574_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127574_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127574_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_127574_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_127574_.free_mem_111746 = mem_111746.mem;
    futhark_mc_segred_stage_1_parloop_struct_127574_.free_mem_111748 = mem_111748.mem;
    futhark_mc_segred_stage_1_parloop_struct_127574_.free_gtid_118072 = gtid_118072;
    futhark_mc_segred_stage_1_parloop_struct_127574_.free_reduce_stage_1_tid_res_arr_mem_122462 = reduce_stage_1_tid_res_arr_mem_122462;
    futhark_mc_segred_stage_1_parloop_struct_127574_.free_reduce_stage_1_tid_res_arr_mem_122464 = reduce_stage_1_tid_res_arr_mem_122464;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127575_task;
    
    futhark_mc_segred_stage_1_parloop_127575_task.name = "futhark_mc_segred_stage_1_parloop_127575";
    futhark_mc_segred_stage_1_parloop_127575_task.fn = futhark_mc_segred_stage_1_parloop_127575;
    futhark_mc_segred_stage_1_parloop_127575_task.args = &futhark_mc_segred_stage_1_parloop_struct_127574_;
    futhark_mc_segred_stage_1_parloop_127575_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127575_task.info = info;
    
    struct mc_event *event_127577 = mc_event_new(ctx);
    
    if (event_127577 != NULL)
        event_127577->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127575_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127575_task);
    
    if (futhark_mc_segred_stage_1_parloop_127575_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127575_err;
        goto cleanup;
    }
    if (event_127577 != NULL) {
        event_127577->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127575_total", strdup("nothing further"), event_127577, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_118077 = 0.0;
        defunc_0_reduce_res_118078 = 0.0;
    }
    
    double eta_p_122481;
    double eta_p_122482;
    double eta_p_122484;
    double eta_p_122485;
    
    for (int32_t i_122487 = 0; i_122487 < nsubtasks_122461; i_122487++) {
        flat_tid_118079 = i_122487;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_122481 = defunc_0_reduce_res_118077;
            }
            // load next params
            {
                eta_p_122482 = ((double *) reduce_stage_1_tid_res_arr_mem_122462)[flat_tid_118079];
            }
            // red body
            {
                double zp_res_122483 = eta_p_122481 + eta_p_122482;
                
                defunc_0_reduce_res_118077 = zp_res_122483;
            }
            // load acc params
            {
                eta_p_122484 = defunc_0_reduce_res_118078;
            }
            // load next params
            {
                eta_p_122485 = ((double *) reduce_stage_1_tid_res_arr_mem_122464)[flat_tid_118079];
            }
            // red body
            {
                double zp_res_122486 = eta_p_122484 + eta_p_122485;
                
                defunc_0_reduce_res_118078 = zp_res_122486;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_122462);
        free(reduce_stage_1_tid_res_arr_mem_122464);
    }
    if (event_127578 != NULL) {
        event_127578->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127571", strdup("nothing further"), event_127578, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127570->retval_defunc_0_reduce_res_118077 = defunc_0_reduce_res_118077;
        *futhark_mc_task_127570->retval_defunc_0_reduce_res_118078 = defunc_0_reduce_res_118078;
    }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_127569(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127568 *futhark_mc_segred_stage_1_parloop_struct_127568 = (struct futhark_mc_segred_stage_1_parloop_struct_127568 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127568->ctx;
    struct mc_event *event_127579 = mc_event_new(ctx);
    
    if (event_127579 != NULL)
        event_127579->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127568->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_127568->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_127568->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_111746 = {.desc ="mem_111746", .mem =futhark_mc_segred_stage_1_parloop_struct_127568->free_mem_111746, .size =0, .references =NULL};
    struct memblock mem_111748 = {.desc ="mem_111748", .mem =futhark_mc_segred_stage_1_parloop_struct_127568->free_mem_111748, .size =0, .references =NULL};
    struct memblock mem_111752 = {.desc ="mem_111752", .mem =futhark_mc_segred_stage_1_parloop_struct_127568->free_mem_111752, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122450 = {.desc ="reduce_stage_1_tid_res_arr_mem_122450", .mem =futhark_mc_segred_stage_1_parloop_struct_127568->free_reduce_stage_1_tid_res_arr_mem_122450, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118071;
    
    flat_tid_118071 = subtask_id;
    {
        double eta_p_122452;
        double eta_p_122453;
        double local_acc_122455 = 0.0;
        double eta_p_118073;
        double eta_p_118074;
        double local_acc_122456 = 0.0;
        int64_t start_122457;
        int64_t end_122458;
        
        start_122457 = start;
        end_122458 = end;
        
        int64_t n_122459 = end_122458 - start_122457;
        
        for (int64_t SegRed_i_122460 = start_122457; SegRed_i_122460 < start_122457 + n_122459; SegRed_i_122460++) {
            int64_t gtid_118072 = SegRed_i_122460;
            double eta_p_118076 = ((double *) mem_111746.mem)[gtid_118072];
            double defunc_0_reduce_res_118077;
            double defunc_0_reduce_res_118078;
            int64_t flat_tid_118079 = (int64_t) 0;
            
            defunc_0_reduce_res_118077 = 0.0;
            defunc_0_reduce_res_118078 = 0.0;
            
            struct futhark_mc_task_127570 futhark_mc_task_127570_;
            
            futhark_mc_task_127570_.ctx = ctx;
            futhark_mc_task_127570_.free_m_33388 = m_33388;
            futhark_mc_task_127570_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
            futhark_mc_task_127570_.free_A_mem_111707 = A_mem_111707.mem;
            futhark_mc_task_127570_.free_mem_111746 = mem_111746.mem;
            futhark_mc_task_127570_.free_mem_111748 = mem_111748.mem;
            futhark_mc_task_127570_.free_gtid_118072 = gtid_118072;
            futhark_mc_task_127570_.free_flat_tid_118079 = flat_tid_118079;
            futhark_mc_task_127570_.retval_defunc_0_reduce_res_118077 = (double *) &defunc_0_reduce_res_118077;
            #if ISPC
            futhark_mc_task_127570_.retval_defunc_0_reduce_res_118077 += programIndex;
            #endif
            futhark_mc_task_127570_.retval_defunc_0_reduce_res_118078 = (double *) &defunc_0_reduce_res_118078;
            #if ISPC
            futhark_mc_task_127570_.retval_defunc_0_reduce_res_118078 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_127570_task;
            
            futhark_mc_task_127570_task.args = &futhark_mc_task_127570_;
            futhark_mc_task_127570_task.top_level_fn = futhark_mc_segred_task_127571;
            futhark_mc_task_127570_task.name = "futhark_mc_segred_task_127571";
            futhark_mc_task_127570_task.iterations = m_33388;
            futhark_mc_task_127570_task.task_time = &ctx->program->futhark_mc_segred_task_127571_total_time;
            futhark_mc_task_127570_task.task_iter = &ctx->program->futhark_mc_segred_task_127571_total_iter;
            futhark_mc_task_127570_task.sched = STATIC;
            futhark_mc_task_127570_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_127571_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127570_task);
            
            if (futhark_mc_segred_task_127571_err != 0) {
                err = futhark_mc_segred_task_127571_err;
                goto cleanup;
            }
            
            double zt_res_118093 = eta_p_118076 * defunc_0_reduce_res_118078;
            
            // save map-out results
            {
                ((double *) mem_111752.mem)[gtid_118072] = defunc_0_reduce_res_118077;
            }
            // Load accum params
            {
                eta_p_118073 = local_acc_122456;
            }
            // Load next params
            {
                eta_p_118074 = zt_res_118093;
            }
            // SegRed body
            {
                double zp_res_118075 = eta_p_118073 + eta_p_118074;
                
                local_acc_122456 = zp_res_118075;
            }
        }
        
        int64_t uni_i_122488 = 0;
        
        {
            int64_t gtid_118072 = uni_i_122488;
            
            // Load accum params
            {
                eta_p_122452 = local_acc_122455;
            }
            // Load next params
            {
                eta_p_122453 = local_acc_122456;
            }
            // SegRed body
            {
                double zp_res_122454 = eta_p_122452 + eta_p_122453;
                
                local_acc_122455 = zp_res_122454;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_122450.mem)[flat_tid_118071] = local_acc_122455;
    }
    
  cleanup:
    { }
    if (event_127579 != NULL) {
        event_127579->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127569", strdup("nothing further"), event_127579, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_127566(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127558 *futhark_mc_task_127558 = (struct futhark_mc_task_127558 *) args;
    struct futhark_context *ctx = futhark_mc_task_127558->ctx;
    struct mc_event *event_127581 = mc_event_new(ctx);
    
    if (event_127581 != NULL)
        event_127581->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127558->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_127558->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_127558->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_111746 = {.desc ="mem_111746", .mem =futhark_mc_task_127558->free_mem_111746, .size =0, .references =NULL};
    struct memblock mem_111748 = {.desc ="mem_111748", .mem =futhark_mc_task_127558->free_mem_111748, .size =0, .references =NULL};
    int64_t flat_tid_118071 = futhark_mc_task_127558->free_flat_tid_118071;
    int64_t flat_tid_118094 = futhark_mc_task_127558->free_flat_tid_118094;
    double defunc_0_reduce_res_106693 = *futhark_mc_task_127558->retval_defunc_0_reduce_res_106693;
    struct memblock mem_111752 = {.desc ="mem_111752", .mem =futhark_mc_task_127558->retval_mem_111752, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_122450_cached_sizze_127567 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122450 = NULL;
    int32_t nsubtasks_122449;
    
    nsubtasks_122449 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_122450_cached_sizze_127567 < (int64_t) 8 * nsubtasks_122449) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122450, &reduce_stage_1_tid_res_arr_mem_122450_cached_sizze_127567, (int64_t) 8 * nsubtasks_122449);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127568 futhark_mc_segred_stage_1_parloop_struct_127568_;
    
    futhark_mc_segred_stage_1_parloop_struct_127568_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127568_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127568_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_127568_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_127568_.free_mem_111746 = mem_111746.mem;
    futhark_mc_segred_stage_1_parloop_struct_127568_.free_mem_111748 = mem_111748.mem;
    futhark_mc_segred_stage_1_parloop_struct_127568_.free_mem_111752 = mem_111752.mem;
    futhark_mc_segred_stage_1_parloop_struct_127568_.free_reduce_stage_1_tid_res_arr_mem_122450 = reduce_stage_1_tid_res_arr_mem_122450;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127569_task;
    
    futhark_mc_segred_stage_1_parloop_127569_task.name = "futhark_mc_segred_stage_1_parloop_127569";
    futhark_mc_segred_stage_1_parloop_127569_task.fn = futhark_mc_segred_stage_1_parloop_127569;
    futhark_mc_segred_stage_1_parloop_127569_task.args = &futhark_mc_segred_stage_1_parloop_struct_127568_;
    futhark_mc_segred_stage_1_parloop_127569_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127569_task.info = info;
    
    struct mc_event *event_127580 = mc_event_new(ctx);
    
    if (event_127580 != NULL)
        event_127580->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127569_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127569_task);
    
    if (futhark_mc_segred_stage_1_parloop_127569_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127569_err;
        goto cleanup;
    }
    if (event_127580 != NULL) {
        event_127580->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127569_total", strdup("nothing further"), event_127580, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_106693 = 0.0;
    }
    
    double eta_p_122489;
    double eta_p_122490;
    
    for (int32_t i_122492 = 0; i_122492 < nsubtasks_122449; i_122492++) {
        flat_tid_118071 = i_122492;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_122489 = defunc_0_reduce_res_106693;
            }
            // load next params
            {
                eta_p_122490 = ((double *) reduce_stage_1_tid_res_arr_mem_122450)[flat_tid_118071];
            }
            // red body
            {
                double zp_res_122491 = eta_p_122489 + eta_p_122490;
                
                defunc_0_reduce_res_106693 = zp_res_122491;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_122450);
    }
    if (event_127581 != NULL) {
        event_127581->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_127566", strdup("nothing further"), event_127581, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127558->retval_defunc_0_reduce_res_106693 = defunc_0_reduce_res_106693;
        futhark_mc_task_127558->retval_mem_111752 = mem_111752.mem;
    }
    return err;
}
struct futhark_mc_task_127582 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_safe_for_exp_33395;
    double free_neg_res_43882;
    int64_t free_eta_p_106382;
    int64_t free_lifted_lambda_res_106391;
    double free_defunc_res_106407;
    double free_zt_res_106587;
    double free_zp_res_106691;
    unsigned char *free_A_mem_111707;
    unsigned char *free_distrs_mem_111708;
    int64_t free_bytes_111715;
    unsigned char *free_mem_111727;
    unsigned char *free_mem_111739;
    unsigned char *free_mem_111741;
    unsigned char *free_mem_111744;
    unsigned char *free_mem_111750;
    unsigned char *free_mem_111752;
    int64_t free_flat_tid_118114;
    int64_t free_flat_tid_118252;
    double *retval_defunc_0_reduce_res_106743;
    double *retval_defunc_res_106744;
    unsigned char *retval_mem_111795;
    unsigned char *retval_mem_111797;
};
struct futhark_mc_segred_stage_1_parloop_struct_127586 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_safe_for_exp_33395;
    double free_neg_res_43882;
    int64_t free_eta_p_106382;
    int64_t free_lifted_lambda_res_106391;
    double free_defunc_res_106407;
    double free_zt_res_106587;
    double free_zp_res_106691;
    unsigned char *free_A_mem_111707;
    unsigned char *free_distrs_mem_111708;
    int64_t free_bytes_111715;
    unsigned char *free_mem_111727;
    unsigned char *free_mem_111739;
    unsigned char *free_mem_111741;
    unsigned char *free_mem_111744;
    unsigned char *free_mem_111750;
    unsigned char *free_mem_111752;
    unsigned char *free_mem_111795;
    unsigned char *free_mem_111797;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122494;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122496;
};
static int futhark_mc_segred_stage_1_parloop_127587(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127586 *futhark_mc_segred_stage_1_parloop_struct_127586 = (struct futhark_mc_segred_stage_1_parloop_struct_127586 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127586->ctx;
    struct mc_event *event_127592 = mc_event_new(ctx);
    
    if (event_127592 != NULL)
        event_127592->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127586->free_m_33388;
    double safe_for_exp_33395 = futhark_mc_segred_stage_1_parloop_struct_127586->free_safe_for_exp_33395;
    double neg_res_43882 = futhark_mc_segred_stage_1_parloop_struct_127586->free_neg_res_43882;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_127586->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_127586->free_lifted_lambda_res_106391;
    double defunc_res_106407 = futhark_mc_segred_stage_1_parloop_struct_127586->free_defunc_res_106407;
    double zt_res_106587 = futhark_mc_segred_stage_1_parloop_struct_127586->free_zt_res_106587;
    double zp_res_106691 = futhark_mc_segred_stage_1_parloop_struct_127586->free_zp_res_106691;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_127586->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_127586->free_distrs_mem_111708, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_segred_stage_1_parloop_struct_127586->free_bytes_111715;
    struct memblock mem_111727 = {.desc ="mem_111727", .mem =futhark_mc_segred_stage_1_parloop_struct_127586->free_mem_111727, .size =0, .references =NULL};
    struct memblock mem_111739 = {.desc ="mem_111739", .mem =futhark_mc_segred_stage_1_parloop_struct_127586->free_mem_111739, .size =0, .references =NULL};
    struct memblock mem_111741 = {.desc ="mem_111741", .mem =futhark_mc_segred_stage_1_parloop_struct_127586->free_mem_111741, .size =0, .references =NULL};
    struct memblock mem_111744 = {.desc ="mem_111744", .mem =futhark_mc_segred_stage_1_parloop_struct_127586->free_mem_111744, .size =0, .references =NULL};
    struct memblock mem_111750 = {.desc ="mem_111750", .mem =futhark_mc_segred_stage_1_parloop_struct_127586->free_mem_111750, .size =0, .references =NULL};
    struct memblock mem_111752 = {.desc ="mem_111752", .mem =futhark_mc_segred_stage_1_parloop_struct_127586->free_mem_111752, .size =0, .references =NULL};
    struct memblock mem_111795 = {.desc ="mem_111795", .mem =futhark_mc_segred_stage_1_parloop_struct_127586->free_mem_111795, .size =0, .references =NULL};
    struct memblock mem_111797 = {.desc ="mem_111797", .mem =futhark_mc_segred_stage_1_parloop_struct_127586->free_mem_111797, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122494 = {.desc ="reduce_stage_1_tid_res_arr_mem_122494", .mem =futhark_mc_segred_stage_1_parloop_struct_127586->free_reduce_stage_1_tid_res_arr_mem_122494, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122496 = {.desc ="reduce_stage_1_tid_res_arr_mem_122496", .mem =futhark_mc_segred_stage_1_parloop_struct_127586->free_reduce_stage_1_tid_res_arr_mem_122496, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t mem_118277_cached_sizze_127588 = 0;
    unsigned char *mem_118277 = NULL;
    int64_t mem_118279_cached_sizze_127589 = 0;
    unsigned char *mem_118279 = NULL;
    int64_t mem_118298_cached_sizze_127590 = 0;
    unsigned char *mem_118298 = NULL;
    int64_t mem_118335_cached_sizze_127591 = 0;
    unsigned char *mem_118335 = NULL;
    int64_t flat_tid_118252;
    
    flat_tid_118252 = subtask_id;
    {
        double eta_p_122498;
        double eta_p_122499;
        double eta_p_122501;
        double eta_p_122502;
        double local_acc_122504 = 0.0;
        double local_acc_122505 = 0.0;
        double eta_p_118254;
        double eta_p_118255;
        double eta_p_118257;
        double eta_p_118258;
        double local_acc_122506 = 0.0;
        double local_acc_122507 = 0.0;
        int64_t start_122508;
        int64_t end_122509;
        
        start_122508 = start;
        end_122509 = end;
        
        int64_t n_122510 = end_122509 - start_122508;
        
        if (mem_118277_cached_sizze_127588 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_118277, &mem_118277_cached_sizze_127588, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_118279_cached_sizze_127589 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_118279, &mem_118279_cached_sizze_127589, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_118298_cached_sizze_127590 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_118298, &mem_118298_cached_sizze_127590, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_118335_cached_sizze_127591 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_118335, &mem_118335_cached_sizze_127591, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        for (int64_t SegRed_i_122511 = start_122508; SegRed_i_122511 < start_122508 + n_122510; SegRed_i_122511++) {
            int64_t gtid_118253 = SegRed_i_122511;
            double eta_p_118260 = ((double *) mem_111741.mem)[gtid_118253];
            double eta_p_118261 = ((double *) distrs_mem_111708.mem)[eta_p_106382 * m_33388 + gtid_118253];
            double log_res_118262 = futrts_log64(eta_p_118261);
            double zt_res_118263 = zt_res_106587 * log_res_118262;
            double defunc_0_reduce_res_118264;
            double defunc_0_reduce_res_118265;
            double redout_118267;
            double redout_118268;
            
            redout_118267 = 0.0;
            redout_118268 = 0.0;
            for (int64_t i_118266 = 0; i_118266 < m_33388; i_118266++) {
                double eta_p_118269 = ((double *) A_mem_111707.mem)[eta_p_106382 * (m_33388 * m_33388) + gtid_118253 * m_33388 + i_118266];
                double eta_p_118270 = ((double *) mem_111741.mem)[i_118266];
                double eta_p_118271 = ((double *) mem_111739.mem)[i_118266];
                double zt_res_118272 = eta_p_118269 * eta_p_118269;
                double zt_res_118273 = eta_p_118271 * zt_res_118272;
                double zt_res_118274 = eta_p_118270 * zt_res_118272;
                double zp_res_118275 = zt_res_118273 + redout_118267;
                double zp_res_118276 = zt_res_118274 + redout_118268;
                double redout_tmp_122512 = zp_res_118275;
                double redout_tmp_122513 = zp_res_118276;
                
                redout_118267 = redout_tmp_122512;
                redout_118268 = redout_tmp_122513;
            }
            defunc_0_reduce_res_118264 = redout_118267;
            defunc_0_reduce_res_118265 = redout_118268;
            for (int64_t i_118283 = 0; i_118283 < m_33388; i_118283++) {
                double defunc_0_reduce_res_118286;
                double defunc_0_reduce_res_118287;
                double redout_118289;
                double redout_118290;
                
                redout_118289 = 0.0;
                redout_118290 = 0.0;
                for (int64_t i_118288 = 0; i_118288 < m_33388; i_118288++) {
                    double eta_p_118291 = ((double *) A_mem_111707.mem)[eta_p_106382 * (m_33388 * m_33388) + gtid_118253 * m_33388 + i_118288];
                    double eta_p_118292 = ((double *) mem_111744.mem)[i_118288 * m_33388 + i_118283];
                    double zt_res_118293 = eta_p_118291 * eta_p_118292;
                    double zp_res_118294 = zt_res_118293 + redout_118289;
                    double zp_res_118295 = zt_res_118293 + redout_118290;
                    double redout_tmp_122516 = zp_res_118294;
                    double redout_tmp_122517 = zp_res_118295;
                    
                    redout_118289 = redout_tmp_122516;
                    redout_118290 = redout_tmp_122517;
                }
                defunc_0_reduce_res_118286 = redout_118289;
                defunc_0_reduce_res_118287 = redout_118290;
                ((double *) mem_118277)[i_118283] = defunc_0_reduce_res_118287;
                ((double *) mem_118279)[i_118283] = defunc_0_reduce_res_118286;
            }
            
            double defunc_0_reduce_res_118300;
            double defunc_0_reduce_res_118301;
            double redout_118304;
            double redout_118305;
            
            redout_118304 = INFINITY;
            redout_118305 = 0.0;
            for (int64_t i_118303 = 0; i_118303 < m_33388; i_118303++) {
                double eta_p_118307 = ((double *) mem_111744.mem)[gtid_118253 * m_33388 + i_118303];
                double eta_p_wasfree_118308 = ((double *) mem_111752.mem)[i_118303];
                double eta_p_wasfree_118309 = ((double *) mem_111750.mem)[i_118303];
                double defunc_0_reduce_res_118310;
                double defunc_0_reduce_res_118311;
                double redout_118313;
                double redout_118314;
                
                redout_118313 = 0.0;
                redout_118314 = 0.0;
                for (int64_t i_118312 = 0; i_118312 < m_33388; i_118312++) {
                    double eta_p_118315 = ((double *) mem_118277)[i_118312];
                    double eta_p_118316 = ((double *) mem_111727.mem)[lifted_lambda_res_106391 * (m_33388 * m_33388) + i_118312 * m_33388 + i_118303];
                    double eta_p_118317 = ((double *) mem_118279)[i_118312];
                    double zt_res_118318 = eta_p_118316 * eta_p_118317;
                    double zt_res_118319 = eta_p_118315 * eta_p_118316;
                    double zp_res_118320 = zt_res_118318 + redout_118313;
                    double zp_res_118321 = zt_res_118319 + redout_118314;
                    double redout_tmp_122521 = zp_res_118320;
                    double redout_tmp_122522 = zp_res_118321;
                    
                    redout_118313 = redout_tmp_122521;
                    redout_118314 = redout_tmp_122522;
                }
                defunc_0_reduce_res_118310 = redout_118313;
                defunc_0_reduce_res_118311 = redout_118314;
                
                double zt_res_118322 = -2.0 * defunc_0_reduce_res_118310;
                double zp_res_118323 = defunc_0_reduce_res_118264 + zt_res_118322;
                double zp_res_118324 = eta_p_wasfree_118308 + zp_res_118323;
                double zp_res_118325 = zp_res_106691 + zp_res_118324;
                double zm_res_118326 = zp_res_118325 - zt_res_118263;
                double zm_res_118327 = zm_res_118326 - eta_p_wasfree_118309;
                double zs_res_118328 = zm_res_118327 / defunc_res_106407;
                double zs_res_118329 = zs_res_118328 / neg_res_43882;
                double zm_res_118330 = safe_for_exp_33395 - zs_res_118329;
                double zt_res_118331 = eta_p_118307 * defunc_0_reduce_res_118311;
                double min_res_118332 = fmin64(zm_res_118330, redout_118304);
                double zp_res_118333 = zt_res_118331 + redout_118305;
                
                ((double *) mem_118298)[i_118303] = zs_res_118329;
                
                double redout_tmp_122518 = min_res_118332;
                double redout_tmp_122519 = zp_res_118333;
                
                redout_118304 = redout_tmp_122518;
                redout_118305 = redout_tmp_122519;
            }
            defunc_0_reduce_res_118300 = redout_118304;
            defunc_0_reduce_res_118301 = redout_118305;
            for (int64_t i_118338 = 0; i_118338 < m_33388; i_118338++) {
                double eta_p_118340 = ((double *) mem_118298)[i_118338];
                double zp_res_118341 = defunc_0_reduce_res_118300 + eta_p_118340;
                
                ((double *) mem_118335)[i_118338] = zp_res_118341;
            }
            
            double zt_res_118343 = eta_p_118260 * defunc_0_reduce_res_118265;
            
            // save map-out results
            {
                lmad_copy_8b(ctx, 1, (uint64_t *) mem_111795.mem, gtid_118253 * m_33388, (int64_t []) {(int64_t) 1}, (uint64_t *) mem_118335, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_33388});
                ((double *) mem_111797.mem)[gtid_118253] = defunc_0_reduce_res_118300;
            }
            // Load accum params
            {
                eta_p_118254 = local_acc_122506;
            }
            // Load next params
            {
                eta_p_118255 = zt_res_118343;
            }
            // SegRed body
            {
                double zp_res_118256 = eta_p_118254 + eta_p_118255;
                
                local_acc_122506 = zp_res_118256;
            }
            // Load accum params
            {
                eta_p_118257 = local_acc_122507;
            }
            // Load next params
            {
                eta_p_118258 = defunc_0_reduce_res_118301;
            }
            // SegRed body
            {
                double zp_res_118259 = eta_p_118257 + eta_p_118258;
                
                local_acc_122507 = zp_res_118259;
            }
        }
        
        int64_t uni_i_122524 = 0;
        
        {
            int64_t gtid_118253 = uni_i_122524;
            
            // Load accum params
            {
                eta_p_122498 = local_acc_122504;
            }
            // Load next params
            {
                eta_p_122499 = local_acc_122506;
            }
            // SegRed body
            {
                double zp_res_122500 = eta_p_122498 + eta_p_122499;
                
                local_acc_122504 = zp_res_122500;
            }
            // Load accum params
            {
                eta_p_122501 = local_acc_122505;
            }
            // Load next params
            {
                eta_p_122502 = local_acc_122507;
            }
            // SegRed body
            {
                double zp_res_122503 = eta_p_122501 + eta_p_122502;
                
                local_acc_122505 = zp_res_122503;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_122494.mem)[flat_tid_118252] = local_acc_122504;
        ((double *) reduce_stage_1_tid_res_arr_mem_122496.mem)[flat_tid_118252] = local_acc_122505;
    }
    
  cleanup:
    {
        free(mem_118277);
        free(mem_118279);
        free(mem_118298);
        free(mem_118335);
    }
    if (event_127592 != NULL) {
        event_127592->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127587", strdup("nothing further"), event_127592, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127583(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127582 *futhark_mc_task_127582 = (struct futhark_mc_task_127582 *) args;
    struct futhark_context *ctx = futhark_mc_task_127582->ctx;
    struct mc_event *event_127594 = mc_event_new(ctx);
    
    if (event_127594 != NULL)
        event_127594->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127582->free_m_33388;
    double safe_for_exp_33395 = futhark_mc_task_127582->free_safe_for_exp_33395;
    double neg_res_43882 = futhark_mc_task_127582->free_neg_res_43882;
    int64_t eta_p_106382 = futhark_mc_task_127582->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_127582->free_lifted_lambda_res_106391;
    double defunc_res_106407 = futhark_mc_task_127582->free_defunc_res_106407;
    double zt_res_106587 = futhark_mc_task_127582->free_zt_res_106587;
    double zp_res_106691 = futhark_mc_task_127582->free_zp_res_106691;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_127582->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_127582->free_distrs_mem_111708, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_task_127582->free_bytes_111715;
    struct memblock mem_111727 = {.desc ="mem_111727", .mem =futhark_mc_task_127582->free_mem_111727, .size =0, .references =NULL};
    struct memblock mem_111739 = {.desc ="mem_111739", .mem =futhark_mc_task_127582->free_mem_111739, .size =0, .references =NULL};
    struct memblock mem_111741 = {.desc ="mem_111741", .mem =futhark_mc_task_127582->free_mem_111741, .size =0, .references =NULL};
    struct memblock mem_111744 = {.desc ="mem_111744", .mem =futhark_mc_task_127582->free_mem_111744, .size =0, .references =NULL};
    struct memblock mem_111750 = {.desc ="mem_111750", .mem =futhark_mc_task_127582->free_mem_111750, .size =0, .references =NULL};
    struct memblock mem_111752 = {.desc ="mem_111752", .mem =futhark_mc_task_127582->free_mem_111752, .size =0, .references =NULL};
    int64_t flat_tid_118114 = futhark_mc_task_127582->free_flat_tid_118114;
    int64_t flat_tid_118252 = futhark_mc_task_127582->free_flat_tid_118252;
    double defunc_0_reduce_res_106743 = *futhark_mc_task_127582->retval_defunc_0_reduce_res_106743;
    double defunc_res_106744 = *futhark_mc_task_127582->retval_defunc_res_106744;
    struct memblock mem_111795 = {.desc ="mem_111795", .mem =futhark_mc_task_127582->retval_mem_111795, .size =0, .references =NULL};
    struct memblock mem_111797 = {.desc ="mem_111797", .mem =futhark_mc_task_127582->retval_mem_111797, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_122494_cached_sizze_127584 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122494 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_122496_cached_sizze_127585 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122496 = NULL;
    int32_t nsubtasks_122493;
    
    nsubtasks_122493 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_122494_cached_sizze_127584 < (int64_t) 8 * nsubtasks_122493) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122494, &reduce_stage_1_tid_res_arr_mem_122494_cached_sizze_127584, (int64_t) 8 * nsubtasks_122493);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_122496_cached_sizze_127585 < (int64_t) 8 * nsubtasks_122493) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122496, &reduce_stage_1_tid_res_arr_mem_122496_cached_sizze_127585, (int64_t) 8 * nsubtasks_122493);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127586 futhark_mc_segred_stage_1_parloop_struct_127586_;
    
    futhark_mc_segred_stage_1_parloop_struct_127586_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127586_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127586_.free_safe_for_exp_33395 = safe_for_exp_33395;
    futhark_mc_segred_stage_1_parloop_struct_127586_.free_neg_res_43882 = neg_res_43882;
    futhark_mc_segred_stage_1_parloop_struct_127586_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_127586_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_127586_.free_defunc_res_106407 = defunc_res_106407;
    futhark_mc_segred_stage_1_parloop_struct_127586_.free_zt_res_106587 = zt_res_106587;
    futhark_mc_segred_stage_1_parloop_struct_127586_.free_zp_res_106691 = zp_res_106691;
    futhark_mc_segred_stage_1_parloop_struct_127586_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_127586_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_127586_.free_bytes_111715 = bytes_111715;
    futhark_mc_segred_stage_1_parloop_struct_127586_.free_mem_111727 = mem_111727.mem;
    futhark_mc_segred_stage_1_parloop_struct_127586_.free_mem_111739 = mem_111739.mem;
    futhark_mc_segred_stage_1_parloop_struct_127586_.free_mem_111741 = mem_111741.mem;
    futhark_mc_segred_stage_1_parloop_struct_127586_.free_mem_111744 = mem_111744.mem;
    futhark_mc_segred_stage_1_parloop_struct_127586_.free_mem_111750 = mem_111750.mem;
    futhark_mc_segred_stage_1_parloop_struct_127586_.free_mem_111752 = mem_111752.mem;
    futhark_mc_segred_stage_1_parloop_struct_127586_.free_mem_111795 = mem_111795.mem;
    futhark_mc_segred_stage_1_parloop_struct_127586_.free_mem_111797 = mem_111797.mem;
    futhark_mc_segred_stage_1_parloop_struct_127586_.free_reduce_stage_1_tid_res_arr_mem_122494 = reduce_stage_1_tid_res_arr_mem_122494;
    futhark_mc_segred_stage_1_parloop_struct_127586_.free_reduce_stage_1_tid_res_arr_mem_122496 = reduce_stage_1_tid_res_arr_mem_122496;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127587_task;
    
    futhark_mc_segred_stage_1_parloop_127587_task.name = "futhark_mc_segred_stage_1_parloop_127587";
    futhark_mc_segred_stage_1_parloop_127587_task.fn = futhark_mc_segred_stage_1_parloop_127587;
    futhark_mc_segred_stage_1_parloop_127587_task.args = &futhark_mc_segred_stage_1_parloop_struct_127586_;
    futhark_mc_segred_stage_1_parloop_127587_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127587_task.info = info;
    
    struct mc_event *event_127593 = mc_event_new(ctx);
    
    if (event_127593 != NULL)
        event_127593->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127587_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127587_task);
    
    if (futhark_mc_segred_stage_1_parloop_127587_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127587_err;
        goto cleanup;
    }
    if (event_127593 != NULL) {
        event_127593->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127587_total", strdup("nothing further"), event_127593, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_106743 = 0.0;
        defunc_res_106744 = 0.0;
    }
    
    double eta_p_122525;
    double eta_p_122526;
    double eta_p_122528;
    double eta_p_122529;
    
    for (int32_t i_122531 = 0; i_122531 < nsubtasks_122493; i_122531++) {
        flat_tid_118252 = i_122531;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_122525 = defunc_0_reduce_res_106743;
            }
            // load next params
            {
                eta_p_122526 = ((double *) reduce_stage_1_tid_res_arr_mem_122494)[flat_tid_118252];
            }
            // red body
            {
                double zp_res_122527 = eta_p_122525 + eta_p_122526;
                
                defunc_0_reduce_res_106743 = zp_res_122527;
            }
            // load acc params
            {
                eta_p_122528 = defunc_res_106744;
            }
            // load next params
            {
                eta_p_122529 = ((double *) reduce_stage_1_tid_res_arr_mem_122496)[flat_tid_118252];
            }
            // red body
            {
                double zp_res_122530 = eta_p_122528 + eta_p_122529;
                
                defunc_res_106744 = zp_res_122530;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_122494);
        free(reduce_stage_1_tid_res_arr_mem_122496);
    }
    if (event_127594 != NULL) {
        event_127594->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127583", strdup("nothing further"), event_127594, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127582->retval_defunc_0_reduce_res_106743 = defunc_0_reduce_res_106743;
        *futhark_mc_task_127582->retval_defunc_res_106744 = defunc_res_106744;
        futhark_mc_task_127582->retval_mem_111795 = mem_111795.mem;
        futhark_mc_task_127582->retval_mem_111797 = mem_111797.mem;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_127598 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_safe_for_exp_33395;
    double free_neg_res_43882;
    int64_t free_eta_p_106382;
    int64_t free_lifted_lambda_res_106391;
    double free_defunc_res_106407;
    double free_zt_res_106587;
    double free_zp_res_106691;
    unsigned char *free_A_mem_111707;
    unsigned char *free_distrs_mem_111708;
    int64_t free_bytes_111715;
    unsigned char *free_mem_111727;
    unsigned char *free_mem_111739;
    unsigned char *free_mem_111741;
    unsigned char *free_mem_111744;
    unsigned char *free_mem_111750;
    unsigned char *free_mem_111752;
    unsigned char *free_mem_111795;
    unsigned char *free_mem_111797;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122533;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122535;
};
struct futhark_mc_task_127603 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_111739;
    unsigned char *free_mem_111741;
    int64_t free_gtid_118115;
    int64_t free_flat_tid_118128;
    double *retval_defunc_0_reduce_res_118126;
    double *retval_defunc_0_reduce_res_118127;
};
struct futhark_mc_segred_stage_1_parloop_struct_127607 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_111739;
    unsigned char *free_mem_111741;
    int64_t free_gtid_118115;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122552;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122554;
};
static int futhark_mc_segred_stage_1_parloop_127608(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127607 *futhark_mc_segred_stage_1_parloop_struct_127607 = (struct futhark_mc_segred_stage_1_parloop_struct_127607 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127607->ctx;
    struct mc_event *event_127609 = mc_event_new(ctx);
    
    if (event_127609 != NULL)
        event_127609->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127607->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_127607->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_127607->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_111739 = {.desc ="mem_111739", .mem =futhark_mc_segred_stage_1_parloop_struct_127607->free_mem_111739, .size =0, .references =NULL};
    struct memblock mem_111741 = {.desc ="mem_111741", .mem =futhark_mc_segred_stage_1_parloop_struct_127607->free_mem_111741, .size =0, .references =NULL};
    int64_t gtid_118115 = futhark_mc_segred_stage_1_parloop_struct_127607->free_gtid_118115;
    struct memblock reduce_stage_1_tid_res_arr_mem_122552 = {.desc ="reduce_stage_1_tid_res_arr_mem_122552", .mem =futhark_mc_segred_stage_1_parloop_struct_127607->free_reduce_stage_1_tid_res_arr_mem_122552, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122554 = {.desc ="reduce_stage_1_tid_res_arr_mem_122554", .mem =futhark_mc_segred_stage_1_parloop_struct_127607->free_reduce_stage_1_tid_res_arr_mem_122554, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118128;
    
    flat_tid_118128 = subtask_id;
    {
        double eta_p_122556;
        double eta_p_122557;
        double eta_p_122559;
        double eta_p_122560;
        double local_acc_122562 = 0.0;
        double local_acc_122563 = 0.0;
        double eta_p_118130;
        double eta_p_118131;
        double eta_p_118133;
        double eta_p_118134;
        double local_acc_122564 = 0.0;
        double local_acc_122565 = 0.0;
        int64_t start_122566;
        int64_t end_122567;
        
        start_122566 = start;
        end_122567 = end;
        
        int64_t n_122568 = end_122567 - start_122566;
        
        for (int64_t SegRed_i_122569 = start_122566; SegRed_i_122569 < start_122566 + n_122568; SegRed_i_122569++) {
            int64_t gtid_118129 = SegRed_i_122569;
            double eta_p_118136 = ((double *) A_mem_111707.mem)[eta_p_106382 * (m_33388 * m_33388) + gtid_118115 * m_33388 + gtid_118129];
            double eta_p_118137 = ((double *) mem_111741.mem)[gtid_118129];
            double eta_p_118138 = ((double *) mem_111739.mem)[gtid_118129];
            double zt_res_118139 = eta_p_118136 * eta_p_118136;
            double zt_res_118140 = eta_p_118138 * zt_res_118139;
            double zt_res_118141 = eta_p_118137 * zt_res_118139;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_118130 = local_acc_122564;
            }
            // Load next params
            {
                eta_p_118131 = zt_res_118140;
            }
            // SegRed body
            {
                double zp_res_118132 = eta_p_118130 + eta_p_118131;
                
                local_acc_122564 = zp_res_118132;
            }
            // Load accum params
            {
                eta_p_118133 = local_acc_122565;
            }
            // Load next params
            {
                eta_p_118134 = zt_res_118141;
            }
            // SegRed body
            {
                double zp_res_118135 = eta_p_118133 + eta_p_118134;
                
                local_acc_122565 = zp_res_118135;
            }
        }
        
        int64_t uni_i_122570 = 0;
        
        {
            int64_t gtid_118129 = uni_i_122570;
            
            // Load accum params
            {
                eta_p_122556 = local_acc_122562;
            }
            // Load next params
            {
                eta_p_122557 = local_acc_122564;
            }
            // SegRed body
            {
                double zp_res_122558 = eta_p_122556 + eta_p_122557;
                
                local_acc_122562 = zp_res_122558;
            }
            // Load accum params
            {
                eta_p_122559 = local_acc_122563;
            }
            // Load next params
            {
                eta_p_122560 = local_acc_122565;
            }
            // SegRed body
            {
                double zp_res_122561 = eta_p_122559 + eta_p_122560;
                
                local_acc_122563 = zp_res_122561;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_122552.mem)[flat_tid_118128] = local_acc_122562;
        ((double *) reduce_stage_1_tid_res_arr_mem_122554.mem)[flat_tid_118128] = local_acc_122563;
    }
    
  cleanup:
    { }
    if (event_127609 != NULL) {
        event_127609->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127608", strdup("nothing further"), event_127609, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127604(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127603 *futhark_mc_task_127603 = (struct futhark_mc_task_127603 *) args;
    struct futhark_context *ctx = futhark_mc_task_127603->ctx;
    struct mc_event *event_127611 = mc_event_new(ctx);
    
    if (event_127611 != NULL)
        event_127611->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127603->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_127603->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_127603->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_111739 = {.desc ="mem_111739", .mem =futhark_mc_task_127603->free_mem_111739, .size =0, .references =NULL};
    struct memblock mem_111741 = {.desc ="mem_111741", .mem =futhark_mc_task_127603->free_mem_111741, .size =0, .references =NULL};
    int64_t gtid_118115 = futhark_mc_task_127603->free_gtid_118115;
    int64_t flat_tid_118128 = futhark_mc_task_127603->free_flat_tid_118128;
    double defunc_0_reduce_res_118126 = *futhark_mc_task_127603->retval_defunc_0_reduce_res_118126;
    double defunc_0_reduce_res_118127 = *futhark_mc_task_127603->retval_defunc_0_reduce_res_118127;
    int64_t reduce_stage_1_tid_res_arr_mem_122552_cached_sizze_127605 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122552 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_122554_cached_sizze_127606 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122554 = NULL;
    int32_t nsubtasks_122551;
    
    nsubtasks_122551 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_122552_cached_sizze_127605 < (int64_t) 8 * nsubtasks_122551) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122552, &reduce_stage_1_tid_res_arr_mem_122552_cached_sizze_127605, (int64_t) 8 * nsubtasks_122551);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_122554_cached_sizze_127606 < (int64_t) 8 * nsubtasks_122551) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122554, &reduce_stage_1_tid_res_arr_mem_122554_cached_sizze_127606, (int64_t) 8 * nsubtasks_122551);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127607 futhark_mc_segred_stage_1_parloop_struct_127607_;
    
    futhark_mc_segred_stage_1_parloop_struct_127607_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127607_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127607_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_127607_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_127607_.free_mem_111739 = mem_111739.mem;
    futhark_mc_segred_stage_1_parloop_struct_127607_.free_mem_111741 = mem_111741.mem;
    futhark_mc_segred_stage_1_parloop_struct_127607_.free_gtid_118115 = gtid_118115;
    futhark_mc_segred_stage_1_parloop_struct_127607_.free_reduce_stage_1_tid_res_arr_mem_122552 = reduce_stage_1_tid_res_arr_mem_122552;
    futhark_mc_segred_stage_1_parloop_struct_127607_.free_reduce_stage_1_tid_res_arr_mem_122554 = reduce_stage_1_tid_res_arr_mem_122554;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127608_task;
    
    futhark_mc_segred_stage_1_parloop_127608_task.name = "futhark_mc_segred_stage_1_parloop_127608";
    futhark_mc_segred_stage_1_parloop_127608_task.fn = futhark_mc_segred_stage_1_parloop_127608;
    futhark_mc_segred_stage_1_parloop_127608_task.args = &futhark_mc_segred_stage_1_parloop_struct_127607_;
    futhark_mc_segred_stage_1_parloop_127608_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127608_task.info = info;
    
    struct mc_event *event_127610 = mc_event_new(ctx);
    
    if (event_127610 != NULL)
        event_127610->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127608_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127608_task);
    
    if (futhark_mc_segred_stage_1_parloop_127608_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127608_err;
        goto cleanup;
    }
    if (event_127610 != NULL) {
        event_127610->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127608_total", strdup("nothing further"), event_127610, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_118126 = 0.0;
        defunc_0_reduce_res_118127 = 0.0;
    }
    
    double eta_p_122571;
    double eta_p_122572;
    double eta_p_122574;
    double eta_p_122575;
    
    for (int32_t i_122577 = 0; i_122577 < nsubtasks_122551; i_122577++) {
        flat_tid_118128 = i_122577;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_122571 = defunc_0_reduce_res_118126;
            }
            // load next params
            {
                eta_p_122572 = ((double *) reduce_stage_1_tid_res_arr_mem_122552)[flat_tid_118128];
            }
            // red body
            {
                double zp_res_122573 = eta_p_122571 + eta_p_122572;
                
                defunc_0_reduce_res_118126 = zp_res_122573;
            }
            // load acc params
            {
                eta_p_122574 = defunc_0_reduce_res_118127;
            }
            // load next params
            {
                eta_p_122575 = ((double *) reduce_stage_1_tid_res_arr_mem_122554)[flat_tid_118128];
            }
            // red body
            {
                double zp_res_122576 = eta_p_122574 + eta_p_122575;
                
                defunc_0_reduce_res_118127 = zp_res_122576;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_122552);
        free(reduce_stage_1_tid_res_arr_mem_122554);
    }
    if (event_127611 != NULL) {
        event_127611->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127604", strdup("nothing further"), event_127611, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127603->retval_defunc_0_reduce_res_118126 = defunc_0_reduce_res_118126;
        *futhark_mc_task_127603->retval_defunc_0_reduce_res_118127 = defunc_0_reduce_res_118127;
    }
    return err;
}
struct futhark_mc_task_127612 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_111744;
    int64_t free_gtid_118115;
    unsigned char *free_mem_118142;
    unsigned char *free_mem_118143;
};
struct futhark_mc_segmap_parloop_struct_127614 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_111744;
    int64_t free_gtid_118115;
    unsigned char *free_mem_118142;
    unsigned char *free_mem_118143;
};
static int futhark_mc_segmap_parloop_127615(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_127614 *futhark_mc_segmap_parloop_struct_127614 = (struct futhark_mc_segmap_parloop_struct_127614 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_127614->ctx;
    struct mc_event *event_127616 = mc_event_new(ctx);
    
    if (event_127616 != NULL)
        event_127616->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_127614->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segmap_parloop_struct_127614->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segmap_parloop_struct_127614->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_111744 = {.desc ="mem_111744", .mem =futhark_mc_segmap_parloop_struct_127614->free_mem_111744, .size =0, .references =NULL};
    int64_t gtid_118115 = futhark_mc_segmap_parloop_struct_127614->free_gtid_118115;
    struct memblock mem_118142 = {.desc ="mem_118142", .mem =futhark_mc_segmap_parloop_struct_127614->free_mem_118142, .size =0, .references =NULL};
    struct memblock mem_118143 = {.desc ="mem_118143", .mem =futhark_mc_segmap_parloop_struct_127614->free_mem_118143, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118161;
    
    flat_tid_118161 = subtask_id;
    {
        int64_t start_122587;
        int64_t end_122588;
        
        start_122587 = start;
        end_122588 = end;
        
        int64_t n_122589 = end_122588 - start_122587;
        
        for (int64_t SegMap_i_122590 = start_122587; SegMap_i_122590 < start_122587 + n_122589; SegMap_i_122590++) {
            int64_t slice_122591 = m_33388;
            int64_t gtid_118162 = SegMap_i_122590;
            int64_t remnant_122592 = SegMap_i_122590 - gtid_118162;
            double defunc_0_reduce_res_118163;
            double defunc_0_reduce_res_118164;
            double redout_122580;
            double redout_122581;
            
            redout_122580 = 0.0;
            redout_122581 = 0.0;
            for (int64_t i_122579 = 0; i_122579 < m_33388; i_122579++) {
                double eta_p_122582 = ((double *) A_mem_111707.mem)[eta_p_106382 * (m_33388 * m_33388) + gtid_118115 * m_33388 + i_122579];
                double eta_p_122583 = ((double *) mem_111744.mem)[i_122579 * m_33388 + gtid_118162];
                double zt_res_122584 = eta_p_122582 * eta_p_122583;
                double zp_res_122585 = zt_res_122584 + redout_122580;
                double zp_res_122586 = zt_res_122584 + redout_122581;
                double redout_tmp_122593 = zp_res_122585;
                double redout_tmp_122594 = zp_res_122586;
                
                redout_122580 = redout_tmp_122593;
                redout_122581 = redout_tmp_122594;
            }
            defunc_0_reduce_res_118163 = redout_122580;
            defunc_0_reduce_res_118164 = redout_122581;
            ((double *) mem_118142.mem)[gtid_118162] = defunc_0_reduce_res_118164;
            ((double *) mem_118143.mem)[gtid_118162] = defunc_0_reduce_res_118163;
        }
    }
    
  cleanup:
    { }
    if (event_127616 != NULL) {
        event_127616->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127615", strdup("nothing further"), event_127616, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_task_127613(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127612 *futhark_mc_task_127612 = (struct futhark_mc_task_127612 *) args;
    struct futhark_context *ctx = futhark_mc_task_127612->ctx;
    struct mc_event *event_127618 = mc_event_new(ctx);
    
    if (event_127618 != NULL)
        event_127618->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127612->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_127612->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_127612->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_111744 = {.desc ="mem_111744", .mem =futhark_mc_task_127612->free_mem_111744, .size =0, .references =NULL};
    int64_t gtid_118115 = futhark_mc_task_127612->free_gtid_118115;
    struct memblock mem_118142 = {.desc ="mem_118142", .mem =futhark_mc_task_127612->free_mem_118142, .size =0, .references =NULL};
    struct memblock mem_118143 = {.desc ="mem_118143", .mem =futhark_mc_task_127612->free_mem_118143, .size =0, .references =NULL};
    int32_t nsubtasks_122578;
    
    nsubtasks_122578 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_127614 futhark_mc_segmap_parloop_struct_127614_;
    
    futhark_mc_segmap_parloop_struct_127614_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_127614_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_127614_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segmap_parloop_struct_127614_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segmap_parloop_struct_127614_.free_mem_111744 = mem_111744.mem;
    futhark_mc_segmap_parloop_struct_127614_.free_gtid_118115 = gtid_118115;
    futhark_mc_segmap_parloop_struct_127614_.free_mem_118142 = mem_118142.mem;
    futhark_mc_segmap_parloop_struct_127614_.free_mem_118143 = mem_118143.mem;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_127615_task;
    
    futhark_mc_segmap_parloop_127615_task.name = "futhark_mc_segmap_parloop_127615";
    futhark_mc_segmap_parloop_127615_task.fn = futhark_mc_segmap_parloop_127615;
    futhark_mc_segmap_parloop_127615_task.args = &futhark_mc_segmap_parloop_struct_127614_;
    futhark_mc_segmap_parloop_127615_task.iterations = iterations;
    futhark_mc_segmap_parloop_127615_task.info = info;
    
    struct mc_event *event_127617 = mc_event_new(ctx);
    
    if (event_127617 != NULL)
        event_127617->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_127615_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_127615_task);
    
    if (futhark_mc_segmap_parloop_127615_err != 0) {
        err = futhark_mc_segmap_parloop_127615_err;
        goto cleanup;
    }
    if (event_127617 != NULL) {
        event_127617->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127615_total", strdup("nothing further"), event_127617, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_127618 != NULL) {
        event_127618->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_task_127613", strdup("nothing further"), event_127618, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_segmap_parloop_struct_127620 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_111744;
    int64_t free_gtid_118115;
    unsigned char *free_mem_118142;
    unsigned char *free_mem_118143;
};
struct futhark_mc_task_127622 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_111744;
    int64_t free_gtid_118115;
    int64_t free_gtid_118147;
    int64_t free_flat_tid_122596;
    double *retval_defunc_0_reduce_res_118148;
    double *retval_defunc_0_reduce_res_118149;
};
struct futhark_mc_segred_stage_1_parloop_struct_127626 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_111744;
    int64_t free_gtid_118115;
    int64_t free_gtid_118147;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122614;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122616;
};
static int futhark_mc_segred_stage_1_parloop_127627(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127626 *futhark_mc_segred_stage_1_parloop_struct_127626 = (struct futhark_mc_segred_stage_1_parloop_struct_127626 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127626->ctx;
    struct mc_event *event_127628 = mc_event_new(ctx);
    
    if (event_127628 != NULL)
        event_127628->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127626->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_127626->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_127626->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_111744 = {.desc ="mem_111744", .mem =futhark_mc_segred_stage_1_parloop_struct_127626->free_mem_111744, .size =0, .references =NULL};
    int64_t gtid_118115 = futhark_mc_segred_stage_1_parloop_struct_127626->free_gtid_118115;
    int64_t gtid_118147 = futhark_mc_segred_stage_1_parloop_struct_127626->free_gtid_118147;
    struct memblock reduce_stage_1_tid_res_arr_mem_122614 = {.desc ="reduce_stage_1_tid_res_arr_mem_122614", .mem =futhark_mc_segred_stage_1_parloop_struct_127626->free_reduce_stage_1_tid_res_arr_mem_122614, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122616 = {.desc ="reduce_stage_1_tid_res_arr_mem_122616", .mem =futhark_mc_segred_stage_1_parloop_struct_127626->free_reduce_stage_1_tid_res_arr_mem_122616, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_122596;
    
    flat_tid_122596 = subtask_id;
    {
        double eta_p_122618;
        double eta_p_122619;
        double eta_p_122621;
        double eta_p_122622;
        double local_acc_122624 = 0.0;
        double local_acc_122625 = 0.0;
        double eta_p_122598;
        double eta_p_122599;
        double eta_p_122601;
        double eta_p_122602;
        double local_acc_122626 = 0.0;
        double local_acc_122627 = 0.0;
        int64_t start_122628;
        int64_t end_122629;
        
        start_122628 = start;
        end_122629 = end;
        
        int64_t n_122630 = end_122629 - start_122628;
        
        for (int64_t SegRed_i_122631 = start_122628; SegRed_i_122631 < start_122628 + n_122630; SegRed_i_122631++) {
            int64_t gtid_122597 = SegRed_i_122631;
            double eta_p_122604 = ((double *) A_mem_111707.mem)[eta_p_106382 * (m_33388 * m_33388) + gtid_118115 * m_33388 + gtid_122597];
            double eta_p_122605 = ((double *) mem_111744.mem)[gtid_122597 * m_33388 + gtid_118147];
            double zt_res_122606 = eta_p_122604 * eta_p_122605;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_122598 = local_acc_122626;
            }
            // Load next params
            {
                eta_p_122599 = zt_res_122606;
            }
            // SegRed body
            {
                double zp_res_122600 = eta_p_122598 + eta_p_122599;
                
                local_acc_122626 = zp_res_122600;
            }
            // Load accum params
            {
                eta_p_122601 = local_acc_122627;
            }
            // Load next params
            {
                eta_p_122602 = zt_res_122606;
            }
            // SegRed body
            {
                double zp_res_122603 = eta_p_122601 + eta_p_122602;
                
                local_acc_122627 = zp_res_122603;
            }
        }
        
        int64_t uni_i_122632 = 0;
        
        {
            int64_t gtid_122597 = uni_i_122632;
            
            // Load accum params
            {
                eta_p_122618 = local_acc_122624;
            }
            // Load next params
            {
                eta_p_122619 = local_acc_122626;
            }
            // SegRed body
            {
                double zp_res_122620 = eta_p_122618 + eta_p_122619;
                
                local_acc_122624 = zp_res_122620;
            }
            // Load accum params
            {
                eta_p_122621 = local_acc_122625;
            }
            // Load next params
            {
                eta_p_122622 = local_acc_122627;
            }
            // SegRed body
            {
                double zp_res_122623 = eta_p_122621 + eta_p_122622;
                
                local_acc_122625 = zp_res_122623;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_122614.mem)[flat_tid_122596] = local_acc_122624;
        ((double *) reduce_stage_1_tid_res_arr_mem_122616.mem)[flat_tid_122596] = local_acc_122625;
    }
    
  cleanup:
    { }
    if (event_127628 != NULL) {
        event_127628->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127627", strdup("nothing further"), event_127628, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127623(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127622 *futhark_mc_task_127622 = (struct futhark_mc_task_127622 *) args;
    struct futhark_context *ctx = futhark_mc_task_127622->ctx;
    struct mc_event *event_127630 = mc_event_new(ctx);
    
    if (event_127630 != NULL)
        event_127630->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127622->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_127622->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_127622->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_111744 = {.desc ="mem_111744", .mem =futhark_mc_task_127622->free_mem_111744, .size =0, .references =NULL};
    int64_t gtid_118115 = futhark_mc_task_127622->free_gtid_118115;
    int64_t gtid_118147 = futhark_mc_task_127622->free_gtid_118147;
    int64_t flat_tid_122596 = futhark_mc_task_127622->free_flat_tid_122596;
    double defunc_0_reduce_res_118148 = *futhark_mc_task_127622->retval_defunc_0_reduce_res_118148;
    double defunc_0_reduce_res_118149 = *futhark_mc_task_127622->retval_defunc_0_reduce_res_118149;
    int64_t reduce_stage_1_tid_res_arr_mem_122614_cached_sizze_127624 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122614 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_122616_cached_sizze_127625 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122616 = NULL;
    int32_t nsubtasks_122613;
    
    nsubtasks_122613 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_122614_cached_sizze_127624 < (int64_t) 8 * nsubtasks_122613) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122614, &reduce_stage_1_tid_res_arr_mem_122614_cached_sizze_127624, (int64_t) 8 * nsubtasks_122613);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_122616_cached_sizze_127625 < (int64_t) 8 * nsubtasks_122613) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122616, &reduce_stage_1_tid_res_arr_mem_122616_cached_sizze_127625, (int64_t) 8 * nsubtasks_122613);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127626 futhark_mc_segred_stage_1_parloop_struct_127626_;
    
    futhark_mc_segred_stage_1_parloop_struct_127626_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127626_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127626_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_127626_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_127626_.free_mem_111744 = mem_111744.mem;
    futhark_mc_segred_stage_1_parloop_struct_127626_.free_gtid_118115 = gtid_118115;
    futhark_mc_segred_stage_1_parloop_struct_127626_.free_gtid_118147 = gtid_118147;
    futhark_mc_segred_stage_1_parloop_struct_127626_.free_reduce_stage_1_tid_res_arr_mem_122614 = reduce_stage_1_tid_res_arr_mem_122614;
    futhark_mc_segred_stage_1_parloop_struct_127626_.free_reduce_stage_1_tid_res_arr_mem_122616 = reduce_stage_1_tid_res_arr_mem_122616;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127627_task;
    
    futhark_mc_segred_stage_1_parloop_127627_task.name = "futhark_mc_segred_stage_1_parloop_127627";
    futhark_mc_segred_stage_1_parloop_127627_task.fn = futhark_mc_segred_stage_1_parloop_127627;
    futhark_mc_segred_stage_1_parloop_127627_task.args = &futhark_mc_segred_stage_1_parloop_struct_127626_;
    futhark_mc_segred_stage_1_parloop_127627_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127627_task.info = info;
    
    struct mc_event *event_127629 = mc_event_new(ctx);
    
    if (event_127629 != NULL)
        event_127629->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127627_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127627_task);
    
    if (futhark_mc_segred_stage_1_parloop_127627_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127627_err;
        goto cleanup;
    }
    if (event_127629 != NULL) {
        event_127629->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127627_total", strdup("nothing further"), event_127629, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_118148 = 0.0;
        defunc_0_reduce_res_118149 = 0.0;
    }
    
    double eta_p_122633;
    double eta_p_122634;
    double eta_p_122636;
    double eta_p_122637;
    
    for (int32_t i_122639 = 0; i_122639 < nsubtasks_122613; i_122639++) {
        flat_tid_122596 = i_122639;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_122633 = defunc_0_reduce_res_118148;
            }
            // load next params
            {
                eta_p_122634 = ((double *) reduce_stage_1_tid_res_arr_mem_122614)[flat_tid_122596];
            }
            // red body
            {
                double zp_res_122635 = eta_p_122633 + eta_p_122634;
                
                defunc_0_reduce_res_118148 = zp_res_122635;
            }
            // load acc params
            {
                eta_p_122636 = defunc_0_reduce_res_118149;
            }
            // load next params
            {
                eta_p_122637 = ((double *) reduce_stage_1_tid_res_arr_mem_122616)[flat_tid_122596];
            }
            // red body
            {
                double zp_res_122638 = eta_p_122636 + eta_p_122637;
                
                defunc_0_reduce_res_118149 = zp_res_122638;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_122614);
        free(reduce_stage_1_tid_res_arr_mem_122616);
    }
    if (event_127630 != NULL) {
        event_127630->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127623", strdup("nothing further"), event_127630, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127622->retval_defunc_0_reduce_res_118148 = defunc_0_reduce_res_118148;
        *futhark_mc_task_127622->retval_defunc_0_reduce_res_118149 = defunc_0_reduce_res_118149;
    }
    return err;
}
static int futhark_mc_segmap_parloop_127621(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_127620 *futhark_mc_segmap_parloop_struct_127620 = (struct futhark_mc_segmap_parloop_struct_127620 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_127620->ctx;
    struct mc_event *event_127631 = mc_event_new(ctx);
    
    if (event_127631 != NULL)
        event_127631->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_127620->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segmap_parloop_struct_127620->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segmap_parloop_struct_127620->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_111744 = {.desc ="mem_111744", .mem =futhark_mc_segmap_parloop_struct_127620->free_mem_111744, .size =0, .references =NULL};
    int64_t gtid_118115 = futhark_mc_segmap_parloop_struct_127620->free_gtid_118115;
    struct memblock mem_118142 = {.desc ="mem_118142", .mem =futhark_mc_segmap_parloop_struct_127620->free_mem_118142, .size =0, .references =NULL};
    struct memblock mem_118143 = {.desc ="mem_118143", .mem =futhark_mc_segmap_parloop_struct_127620->free_mem_118143, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118146;
    
    flat_tid_118146 = subtask_id;
    {
        int64_t start_122607;
        int64_t end_122608;
        
        start_122607 = start;
        end_122608 = end;
        
        int64_t n_122609 = end_122608 - start_122607;
        
        for (int64_t SegMap_i_122610 = start_122607; SegMap_i_122610 < start_122607 + n_122609; SegMap_i_122610++) {
            int64_t slice_122611 = m_33388;
            int64_t gtid_118147 = SegMap_i_122610;
            int64_t remnant_122612 = SegMap_i_122610 - gtid_118147;
            double defunc_0_reduce_res_118148;
            double defunc_0_reduce_res_118149;
            int64_t flat_tid_122596 = (int64_t) 0;
            
            defunc_0_reduce_res_118148 = 0.0;
            defunc_0_reduce_res_118149 = 0.0;
            
            struct futhark_mc_task_127622 futhark_mc_task_127622_;
            
            futhark_mc_task_127622_.ctx = ctx;
            futhark_mc_task_127622_.free_m_33388 = m_33388;
            futhark_mc_task_127622_.free_eta_p_106382 = eta_p_106382;
            futhark_mc_task_127622_.free_A_mem_111707 = A_mem_111707.mem;
            futhark_mc_task_127622_.free_mem_111744 = mem_111744.mem;
            futhark_mc_task_127622_.free_gtid_118115 = gtid_118115;
            futhark_mc_task_127622_.free_gtid_118147 = gtid_118147;
            futhark_mc_task_127622_.free_flat_tid_122596 = flat_tid_122596;
            futhark_mc_task_127622_.retval_defunc_0_reduce_res_118148 = (double *) &defunc_0_reduce_res_118148;
            #if ISPC
            futhark_mc_task_127622_.retval_defunc_0_reduce_res_118148 += programIndex;
            #endif
            futhark_mc_task_127622_.retval_defunc_0_reduce_res_118149 = (double *) &defunc_0_reduce_res_118149;
            #if ISPC
            futhark_mc_task_127622_.retval_defunc_0_reduce_res_118149 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_127622_task;
            
            futhark_mc_task_127622_task.args = &futhark_mc_task_127622_;
            futhark_mc_task_127622_task.top_level_fn = futhark_mc_segred_task_127623;
            futhark_mc_task_127622_task.name = "futhark_mc_segred_task_127623";
            futhark_mc_task_127622_task.iterations = m_33388;
            futhark_mc_task_127622_task.task_time = &ctx->program->futhark_mc_segred_task_127623_total_time;
            futhark_mc_task_127622_task.task_iter = &ctx->program->futhark_mc_segred_task_127623_total_iter;
            futhark_mc_task_127622_task.sched = STATIC;
            futhark_mc_task_127622_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_127623_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127622_task);
            
            if (futhark_mc_segred_task_127623_err != 0) {
                err = futhark_mc_segred_task_127623_err;
                goto cleanup;
            }
            ((double *) mem_118142.mem)[gtid_118147] = defunc_0_reduce_res_118149;
            ((double *) mem_118143.mem)[gtid_118147] = defunc_0_reduce_res_118148;
        }
    }
    
  cleanup:
    { }
    if (event_127631 != NULL) {
        event_127631->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127621", strdup("nothing further"), event_127631, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_nested_task_127619(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127612 *futhark_mc_task_127612 = (struct futhark_mc_task_127612 *) args;
    struct futhark_context *ctx = futhark_mc_task_127612->ctx;
    struct mc_event *event_127633 = mc_event_new(ctx);
    
    if (event_127633 != NULL)
        event_127633->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127612->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_127612->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_127612->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_111744 = {.desc ="mem_111744", .mem =futhark_mc_task_127612->free_mem_111744, .size =0, .references =NULL};
    int64_t gtid_118115 = futhark_mc_task_127612->free_gtid_118115;
    struct memblock mem_118142 = {.desc ="mem_118142", .mem =futhark_mc_task_127612->free_mem_118142, .size =0, .references =NULL};
    struct memblock mem_118143 = {.desc ="mem_118143", .mem =futhark_mc_task_127612->free_mem_118143, .size =0, .references =NULL};
    int32_t nsubtasks_122595;
    
    nsubtasks_122595 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_127620 futhark_mc_segmap_parloop_struct_127620_;
    
    futhark_mc_segmap_parloop_struct_127620_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_127620_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_127620_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segmap_parloop_struct_127620_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segmap_parloop_struct_127620_.free_mem_111744 = mem_111744.mem;
    futhark_mc_segmap_parloop_struct_127620_.free_gtid_118115 = gtid_118115;
    futhark_mc_segmap_parloop_struct_127620_.free_mem_118142 = mem_118142.mem;
    futhark_mc_segmap_parloop_struct_127620_.free_mem_118143 = mem_118143.mem;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_127621_task;
    
    futhark_mc_segmap_parloop_127621_task.name = "futhark_mc_segmap_parloop_127621";
    futhark_mc_segmap_parloop_127621_task.fn = futhark_mc_segmap_parloop_127621;
    futhark_mc_segmap_parloop_127621_task.args = &futhark_mc_segmap_parloop_struct_127620_;
    futhark_mc_segmap_parloop_127621_task.iterations = iterations;
    futhark_mc_segmap_parloop_127621_task.info = info;
    
    struct mc_event *event_127632 = mc_event_new(ctx);
    
    if (event_127632 != NULL)
        event_127632->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_127621_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_127621_task);
    
    if (futhark_mc_segmap_parloop_127621_err != 0) {
        err = futhark_mc_segmap_parloop_127621_err;
        goto cleanup;
    }
    if (event_127632 != NULL) {
        event_127632->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127621_total", strdup("nothing further"), event_127632, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_127633 != NULL) {
        event_127633->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_nested_task_127619", strdup("nothing further"), event_127633, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_127634 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_safe_for_exp_33395;
    double free_neg_res_43882;
    int64_t free_lifted_lambda_res_106391;
    double free_defunc_res_106407;
    double free_zp_res_106691;
    unsigned char *free_mem_111727;
    unsigned char *free_mem_111744;
    unsigned char *free_mem_111750;
    unsigned char *free_mem_111752;
    int64_t free_gtid_118115;
    double free_zt_res_118125;
    double free_defunc_0_reduce_res_118126;
    unsigned char *free_mem_118142;
    unsigned char *free_mem_118143;
    int64_t free_flat_tid_118177;
    int64_t free_flat_tid_118213;
    double *retval_defunc_0_reduce_res_118174;
    double *retval_defunc_0_reduce_res_118175;
    unsigned char *retval_mem_118173;
};
struct futhark_mc_segred_stage_1_parloop_struct_127638 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_safe_for_exp_33395;
    double free_neg_res_43882;
    int64_t free_lifted_lambda_res_106391;
    double free_defunc_res_106407;
    double free_zp_res_106691;
    unsigned char *free_mem_111727;
    unsigned char *free_mem_111744;
    unsigned char *free_mem_111750;
    unsigned char *free_mem_111752;
    int64_t free_gtid_118115;
    double free_zt_res_118125;
    double free_defunc_0_reduce_res_118126;
    unsigned char *free_mem_118142;
    unsigned char *free_mem_118143;
    unsigned char *free_mem_118173;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122641;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122643;
};
static int futhark_mc_segred_stage_1_parloop_127639(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127638 *futhark_mc_segred_stage_1_parloop_struct_127638 = (struct futhark_mc_segred_stage_1_parloop_struct_127638 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127638->ctx;
    struct mc_event *event_127640 = mc_event_new(ctx);
    
    if (event_127640 != NULL)
        event_127640->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127638->free_m_33388;
    double safe_for_exp_33395 = futhark_mc_segred_stage_1_parloop_struct_127638->free_safe_for_exp_33395;
    double neg_res_43882 = futhark_mc_segred_stage_1_parloop_struct_127638->free_neg_res_43882;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_127638->free_lifted_lambda_res_106391;
    double defunc_res_106407 = futhark_mc_segred_stage_1_parloop_struct_127638->free_defunc_res_106407;
    double zp_res_106691 = futhark_mc_segred_stage_1_parloop_struct_127638->free_zp_res_106691;
    struct memblock mem_111727 = {.desc ="mem_111727", .mem =futhark_mc_segred_stage_1_parloop_struct_127638->free_mem_111727, .size =0, .references =NULL};
    struct memblock mem_111744 = {.desc ="mem_111744", .mem =futhark_mc_segred_stage_1_parloop_struct_127638->free_mem_111744, .size =0, .references =NULL};
    struct memblock mem_111750 = {.desc ="mem_111750", .mem =futhark_mc_segred_stage_1_parloop_struct_127638->free_mem_111750, .size =0, .references =NULL};
    struct memblock mem_111752 = {.desc ="mem_111752", .mem =futhark_mc_segred_stage_1_parloop_struct_127638->free_mem_111752, .size =0, .references =NULL};
    int64_t gtid_118115 = futhark_mc_segred_stage_1_parloop_struct_127638->free_gtid_118115;
    double zt_res_118125 = futhark_mc_segred_stage_1_parloop_struct_127638->free_zt_res_118125;
    double defunc_0_reduce_res_118126 = futhark_mc_segred_stage_1_parloop_struct_127638->free_defunc_0_reduce_res_118126;
    struct memblock mem_118142 = {.desc ="mem_118142", .mem =futhark_mc_segred_stage_1_parloop_struct_127638->free_mem_118142, .size =0, .references =NULL};
    struct memblock mem_118143 = {.desc ="mem_118143", .mem =futhark_mc_segred_stage_1_parloop_struct_127638->free_mem_118143, .size =0, .references =NULL};
    struct memblock mem_118173 = {.desc ="mem_118173", .mem =futhark_mc_segred_stage_1_parloop_struct_127638->free_mem_118173, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122641 = {.desc ="reduce_stage_1_tid_res_arr_mem_122641", .mem =futhark_mc_segred_stage_1_parloop_struct_127638->free_reduce_stage_1_tid_res_arr_mem_122641, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122643 = {.desc ="reduce_stage_1_tid_res_arr_mem_122643", .mem =futhark_mc_segred_stage_1_parloop_struct_127638->free_reduce_stage_1_tid_res_arr_mem_122643, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118213;
    
    flat_tid_118213 = subtask_id;
    {
        double eta_p_122645;
        double eta_p_122646;
        double eta_p_122648;
        double eta_p_122649;
        double local_acc_122651 = INFINITY;
        double local_acc_122652 = 0.0;
        double eta_p_118215;
        double eta_p_118216;
        double eta_p_118218;
        double eta_p_118219;
        double local_acc_122653 = INFINITY;
        double local_acc_122654 = 0.0;
        int64_t start_122655;
        int64_t end_122656;
        
        start_122655 = start;
        end_122656 = end;
        
        int64_t n_122657 = end_122656 - start_122655;
        
        for (int64_t SegRed_i_122658 = start_122655; SegRed_i_122658 < start_122655 + n_122657; SegRed_i_122658++) {
            int64_t gtid_118214 = SegRed_i_122658;
            double eta_p_118221 = ((double *) mem_111744.mem)[gtid_118115 * m_33388 + gtid_118214];
            double eta_p_wasfree_118222 = ((double *) mem_111752.mem)[gtid_118214];
            double eta_p_wasfree_118223 = ((double *) mem_111750.mem)[gtid_118214];
            double defunc_0_reduce_res_118224;
            double defunc_0_reduce_res_118225;
            double redout_118227;
            double redout_118228;
            
            redout_118227 = 0.0;
            redout_118228 = 0.0;
            for (int64_t i_118226 = 0; i_118226 < m_33388; i_118226++) {
                double eta_p_118229 = ((double *) mem_118142.mem)[i_118226];
                double eta_p_118230 = ((double *) mem_111727.mem)[lifted_lambda_res_106391 * (m_33388 * m_33388) + i_118226 * m_33388 + gtid_118214];
                double eta_p_118231 = ((double *) mem_118143.mem)[i_118226];
                double zt_res_118232 = eta_p_118230 * eta_p_118231;
                double zt_res_118233 = eta_p_118229 * eta_p_118230;
                double zp_res_118234 = zt_res_118232 + redout_118227;
                double zp_res_118235 = zt_res_118233 + redout_118228;
                double redout_tmp_122659 = zp_res_118234;
                double redout_tmp_122660 = zp_res_118235;
                
                redout_118227 = redout_tmp_122659;
                redout_118228 = redout_tmp_122660;
            }
            defunc_0_reduce_res_118224 = redout_118227;
            defunc_0_reduce_res_118225 = redout_118228;
            
            double zt_res_118236 = -2.0 * defunc_0_reduce_res_118224;
            double zp_res_118237 = defunc_0_reduce_res_118126 + zt_res_118236;
            double zp_res_118238 = eta_p_wasfree_118222 + zp_res_118237;
            double zp_res_118239 = zp_res_106691 + zp_res_118238;
            double zm_res_118240 = zp_res_118239 - zt_res_118125;
            double zm_res_118241 = zm_res_118240 - eta_p_wasfree_118223;
            double zs_res_118242 = zm_res_118241 / defunc_res_106407;
            double zs_res_118243 = zs_res_118242 / neg_res_43882;
            double zm_res_118244 = safe_for_exp_33395 - zs_res_118243;
            double zt_res_118245 = eta_p_118221 * defunc_0_reduce_res_118225;
            
            // save map-out results
            {
                ((double *) mem_118173.mem)[gtid_118214] = zs_res_118243;
            }
            // Load accum params
            {
                eta_p_118215 = local_acc_122653;
            }
            // Load next params
            {
                eta_p_118216 = zm_res_118244;
            }
            // SegRed body
            {
                double min_res_118217 = fmin64(eta_p_118215, eta_p_118216);
                
                local_acc_122653 = min_res_118217;
            }
            // Load accum params
            {
                eta_p_118218 = local_acc_122654;
            }
            // Load next params
            {
                eta_p_118219 = zt_res_118245;
            }
            // SegRed body
            {
                double zp_res_118220 = eta_p_118218 + eta_p_118219;
                
                local_acc_122654 = zp_res_118220;
            }
        }
        
        int64_t uni_i_122661 = 0;
        
        {
            int64_t gtid_118214 = uni_i_122661;
            
            // Load accum params
            {
                eta_p_122645 = local_acc_122651;
            }
            // Load next params
            {
                eta_p_122646 = local_acc_122653;
            }
            // SegRed body
            {
                double min_res_122647 = fmin64(eta_p_122645, eta_p_122646);
                
                local_acc_122651 = min_res_122647;
            }
            // Load accum params
            {
                eta_p_122648 = local_acc_122652;
            }
            // Load next params
            {
                eta_p_122649 = local_acc_122654;
            }
            // SegRed body
            {
                double zp_res_122650 = eta_p_122648 + eta_p_122649;
                
                local_acc_122652 = zp_res_122650;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_122641.mem)[flat_tid_118213] = local_acc_122651;
        ((double *) reduce_stage_1_tid_res_arr_mem_122643.mem)[flat_tid_118213] = local_acc_122652;
    }
    
  cleanup:
    { }
    if (event_127640 != NULL) {
        event_127640->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127639", strdup("nothing further"), event_127640, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127635(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127634 *futhark_mc_task_127634 = (struct futhark_mc_task_127634 *) args;
    struct futhark_context *ctx = futhark_mc_task_127634->ctx;
    struct mc_event *event_127642 = mc_event_new(ctx);
    
    if (event_127642 != NULL)
        event_127642->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127634->free_m_33388;
    double safe_for_exp_33395 = futhark_mc_task_127634->free_safe_for_exp_33395;
    double neg_res_43882 = futhark_mc_task_127634->free_neg_res_43882;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_127634->free_lifted_lambda_res_106391;
    double defunc_res_106407 = futhark_mc_task_127634->free_defunc_res_106407;
    double zp_res_106691 = futhark_mc_task_127634->free_zp_res_106691;
    struct memblock mem_111727 = {.desc ="mem_111727", .mem =futhark_mc_task_127634->free_mem_111727, .size =0, .references =NULL};
    struct memblock mem_111744 = {.desc ="mem_111744", .mem =futhark_mc_task_127634->free_mem_111744, .size =0, .references =NULL};
    struct memblock mem_111750 = {.desc ="mem_111750", .mem =futhark_mc_task_127634->free_mem_111750, .size =0, .references =NULL};
    struct memblock mem_111752 = {.desc ="mem_111752", .mem =futhark_mc_task_127634->free_mem_111752, .size =0, .references =NULL};
    int64_t gtid_118115 = futhark_mc_task_127634->free_gtid_118115;
    double zt_res_118125 = futhark_mc_task_127634->free_zt_res_118125;
    double defunc_0_reduce_res_118126 = futhark_mc_task_127634->free_defunc_0_reduce_res_118126;
    struct memblock mem_118142 = {.desc ="mem_118142", .mem =futhark_mc_task_127634->free_mem_118142, .size =0, .references =NULL};
    struct memblock mem_118143 = {.desc ="mem_118143", .mem =futhark_mc_task_127634->free_mem_118143, .size =0, .references =NULL};
    int64_t flat_tid_118177 = futhark_mc_task_127634->free_flat_tid_118177;
    int64_t flat_tid_118213 = futhark_mc_task_127634->free_flat_tid_118213;
    double defunc_0_reduce_res_118174 = *futhark_mc_task_127634->retval_defunc_0_reduce_res_118174;
    double defunc_0_reduce_res_118175 = *futhark_mc_task_127634->retval_defunc_0_reduce_res_118175;
    struct memblock mem_118173 = {.desc ="mem_118173", .mem =futhark_mc_task_127634->retval_mem_118173, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_122641_cached_sizze_127636 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122641 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_122643_cached_sizze_127637 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122643 = NULL;
    int32_t nsubtasks_122640;
    
    nsubtasks_122640 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_122641_cached_sizze_127636 < (int64_t) 8 * nsubtasks_122640) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122641, &reduce_stage_1_tid_res_arr_mem_122641_cached_sizze_127636, (int64_t) 8 * nsubtasks_122640);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_122643_cached_sizze_127637 < (int64_t) 8 * nsubtasks_122640) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122643, &reduce_stage_1_tid_res_arr_mem_122643_cached_sizze_127637, (int64_t) 8 * nsubtasks_122640);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127638 futhark_mc_segred_stage_1_parloop_struct_127638_;
    
    futhark_mc_segred_stage_1_parloop_struct_127638_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127638_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127638_.free_safe_for_exp_33395 = safe_for_exp_33395;
    futhark_mc_segred_stage_1_parloop_struct_127638_.free_neg_res_43882 = neg_res_43882;
    futhark_mc_segred_stage_1_parloop_struct_127638_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_127638_.free_defunc_res_106407 = defunc_res_106407;
    futhark_mc_segred_stage_1_parloop_struct_127638_.free_zp_res_106691 = zp_res_106691;
    futhark_mc_segred_stage_1_parloop_struct_127638_.free_mem_111727 = mem_111727.mem;
    futhark_mc_segred_stage_1_parloop_struct_127638_.free_mem_111744 = mem_111744.mem;
    futhark_mc_segred_stage_1_parloop_struct_127638_.free_mem_111750 = mem_111750.mem;
    futhark_mc_segred_stage_1_parloop_struct_127638_.free_mem_111752 = mem_111752.mem;
    futhark_mc_segred_stage_1_parloop_struct_127638_.free_gtid_118115 = gtid_118115;
    futhark_mc_segred_stage_1_parloop_struct_127638_.free_zt_res_118125 = zt_res_118125;
    futhark_mc_segred_stage_1_parloop_struct_127638_.free_defunc_0_reduce_res_118126 = defunc_0_reduce_res_118126;
    futhark_mc_segred_stage_1_parloop_struct_127638_.free_mem_118142 = mem_118142.mem;
    futhark_mc_segred_stage_1_parloop_struct_127638_.free_mem_118143 = mem_118143.mem;
    futhark_mc_segred_stage_1_parloop_struct_127638_.free_mem_118173 = mem_118173.mem;
    futhark_mc_segred_stage_1_parloop_struct_127638_.free_reduce_stage_1_tid_res_arr_mem_122641 = reduce_stage_1_tid_res_arr_mem_122641;
    futhark_mc_segred_stage_1_parloop_struct_127638_.free_reduce_stage_1_tid_res_arr_mem_122643 = reduce_stage_1_tid_res_arr_mem_122643;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127639_task;
    
    futhark_mc_segred_stage_1_parloop_127639_task.name = "futhark_mc_segred_stage_1_parloop_127639";
    futhark_mc_segred_stage_1_parloop_127639_task.fn = futhark_mc_segred_stage_1_parloop_127639;
    futhark_mc_segred_stage_1_parloop_127639_task.args = &futhark_mc_segred_stage_1_parloop_struct_127638_;
    futhark_mc_segred_stage_1_parloop_127639_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127639_task.info = info;
    
    struct mc_event *event_127641 = mc_event_new(ctx);
    
    if (event_127641 != NULL)
        event_127641->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127639_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127639_task);
    
    if (futhark_mc_segred_stage_1_parloop_127639_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127639_err;
        goto cleanup;
    }
    if (event_127641 != NULL) {
        event_127641->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127639_total", strdup("nothing further"), event_127641, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_118174 = INFINITY;
        defunc_0_reduce_res_118175 = 0.0;
    }
    
    double eta_p_122662;
    double eta_p_122663;
    double eta_p_122665;
    double eta_p_122666;
    
    for (int32_t i_122668 = 0; i_122668 < nsubtasks_122640; i_122668++) {
        flat_tid_118213 = i_122668;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_122662 = defunc_0_reduce_res_118174;
            }
            // load next params
            {
                eta_p_122663 = ((double *) reduce_stage_1_tid_res_arr_mem_122641)[flat_tid_118213];
            }
            // red body
            {
                double min_res_122664 = fmin64(eta_p_122662, eta_p_122663);
                
                defunc_0_reduce_res_118174 = min_res_122664;
            }
            // load acc params
            {
                eta_p_122665 = defunc_0_reduce_res_118175;
            }
            // load next params
            {
                eta_p_122666 = ((double *) reduce_stage_1_tid_res_arr_mem_122643)[flat_tid_118213];
            }
            // red body
            {
                double zp_res_122667 = eta_p_122665 + eta_p_122666;
                
                defunc_0_reduce_res_118175 = zp_res_122667;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_122641);
        free(reduce_stage_1_tid_res_arr_mem_122643);
    }
    if (event_127642 != NULL) {
        event_127642->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127635", strdup("nothing further"), event_127642, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127634->retval_defunc_0_reduce_res_118174 = defunc_0_reduce_res_118174;
        *futhark_mc_task_127634->retval_defunc_0_reduce_res_118175 = defunc_0_reduce_res_118175;
        futhark_mc_task_127634->retval_mem_118173 = mem_118173.mem;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_127646 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_safe_for_exp_33395;
    double free_neg_res_43882;
    int64_t free_lifted_lambda_res_106391;
    double free_defunc_res_106407;
    double free_zp_res_106691;
    unsigned char *free_mem_111727;
    unsigned char *free_mem_111744;
    unsigned char *free_mem_111750;
    unsigned char *free_mem_111752;
    int64_t free_gtid_118115;
    double free_zt_res_118125;
    double free_defunc_0_reduce_res_118126;
    unsigned char *free_mem_118142;
    unsigned char *free_mem_118143;
    unsigned char *free_mem_118173;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122670;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122672;
};
struct futhark_mc_task_127648 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_mem_111727;
    unsigned char *free_mem_118142;
    unsigned char *free_mem_118143;
    int64_t free_gtid_118178;
    int64_t free_flat_tid_118190;
    double *retval_defunc_0_reduce_res_118188;
    double *retval_defunc_0_reduce_res_118189;
};
struct futhark_mc_segred_stage_1_parloop_struct_127652 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_mem_111727;
    unsigned char *free_mem_118142;
    unsigned char *free_mem_118143;
    int64_t free_gtid_118178;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122689;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122691;
};
static int futhark_mc_segred_stage_1_parloop_127653(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127652 *futhark_mc_segred_stage_1_parloop_struct_127652 = (struct futhark_mc_segred_stage_1_parloop_struct_127652 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127652->ctx;
    struct mc_event *event_127654 = mc_event_new(ctx);
    
    if (event_127654 != NULL)
        event_127654->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127652->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_127652->free_lifted_lambda_res_106391;
    struct memblock mem_111727 = {.desc ="mem_111727", .mem =futhark_mc_segred_stage_1_parloop_struct_127652->free_mem_111727, .size =0, .references =NULL};
    struct memblock mem_118142 = {.desc ="mem_118142", .mem =futhark_mc_segred_stage_1_parloop_struct_127652->free_mem_118142, .size =0, .references =NULL};
    struct memblock mem_118143 = {.desc ="mem_118143", .mem =futhark_mc_segred_stage_1_parloop_struct_127652->free_mem_118143, .size =0, .references =NULL};
    int64_t gtid_118178 = futhark_mc_segred_stage_1_parloop_struct_127652->free_gtid_118178;
    struct memblock reduce_stage_1_tid_res_arr_mem_122689 = {.desc ="reduce_stage_1_tid_res_arr_mem_122689", .mem =futhark_mc_segred_stage_1_parloop_struct_127652->free_reduce_stage_1_tid_res_arr_mem_122689, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122691 = {.desc ="reduce_stage_1_tid_res_arr_mem_122691", .mem =futhark_mc_segred_stage_1_parloop_struct_127652->free_reduce_stage_1_tid_res_arr_mem_122691, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118190;
    
    flat_tid_118190 = subtask_id;
    {
        double eta_p_122693;
        double eta_p_122694;
        double eta_p_122696;
        double eta_p_122697;
        double local_acc_122699 = 0.0;
        double local_acc_122700 = 0.0;
        double eta_p_118192;
        double eta_p_118193;
        double eta_p_118195;
        double eta_p_118196;
        double local_acc_122701 = 0.0;
        double local_acc_122702 = 0.0;
        int64_t start_122703;
        int64_t end_122704;
        
        start_122703 = start;
        end_122704 = end;
        
        int64_t n_122705 = end_122704 - start_122703;
        
        for (int64_t SegRed_i_122706 = start_122703; SegRed_i_122706 < start_122703 + n_122705; SegRed_i_122706++) {
            int64_t gtid_118191 = SegRed_i_122706;
            double eta_p_118198 = ((double *) mem_118142.mem)[gtid_118191];
            double eta_p_118199 = ((double *) mem_111727.mem)[lifted_lambda_res_106391 * (m_33388 * m_33388) + gtid_118191 * m_33388 + gtid_118178];
            double eta_p_118200 = ((double *) mem_118143.mem)[gtid_118191];
            double zt_res_118201 = eta_p_118199 * eta_p_118200;
            double zt_res_118202 = eta_p_118198 * eta_p_118199;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_118192 = local_acc_122701;
            }
            // Load next params
            {
                eta_p_118193 = zt_res_118201;
            }
            // SegRed body
            {
                double zp_res_118194 = eta_p_118192 + eta_p_118193;
                
                local_acc_122701 = zp_res_118194;
            }
            // Load accum params
            {
                eta_p_118195 = local_acc_122702;
            }
            // Load next params
            {
                eta_p_118196 = zt_res_118202;
            }
            // SegRed body
            {
                double zp_res_118197 = eta_p_118195 + eta_p_118196;
                
                local_acc_122702 = zp_res_118197;
            }
        }
        
        int64_t uni_i_122707 = 0;
        
        {
            int64_t gtid_118191 = uni_i_122707;
            
            // Load accum params
            {
                eta_p_122693 = local_acc_122699;
            }
            // Load next params
            {
                eta_p_122694 = local_acc_122701;
            }
            // SegRed body
            {
                double zp_res_122695 = eta_p_122693 + eta_p_122694;
                
                local_acc_122699 = zp_res_122695;
            }
            // Load accum params
            {
                eta_p_122696 = local_acc_122700;
            }
            // Load next params
            {
                eta_p_122697 = local_acc_122702;
            }
            // SegRed body
            {
                double zp_res_122698 = eta_p_122696 + eta_p_122697;
                
                local_acc_122700 = zp_res_122698;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_122689.mem)[flat_tid_118190] = local_acc_122699;
        ((double *) reduce_stage_1_tid_res_arr_mem_122691.mem)[flat_tid_118190] = local_acc_122700;
    }
    
  cleanup:
    { }
    if (event_127654 != NULL) {
        event_127654->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127653", strdup("nothing further"), event_127654, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127649(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127648 *futhark_mc_task_127648 = (struct futhark_mc_task_127648 *) args;
    struct futhark_context *ctx = futhark_mc_task_127648->ctx;
    struct mc_event *event_127656 = mc_event_new(ctx);
    
    if (event_127656 != NULL)
        event_127656->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127648->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_127648->free_lifted_lambda_res_106391;
    struct memblock mem_111727 = {.desc ="mem_111727", .mem =futhark_mc_task_127648->free_mem_111727, .size =0, .references =NULL};
    struct memblock mem_118142 = {.desc ="mem_118142", .mem =futhark_mc_task_127648->free_mem_118142, .size =0, .references =NULL};
    struct memblock mem_118143 = {.desc ="mem_118143", .mem =futhark_mc_task_127648->free_mem_118143, .size =0, .references =NULL};
    int64_t gtid_118178 = futhark_mc_task_127648->free_gtid_118178;
    int64_t flat_tid_118190 = futhark_mc_task_127648->free_flat_tid_118190;
    double defunc_0_reduce_res_118188 = *futhark_mc_task_127648->retval_defunc_0_reduce_res_118188;
    double defunc_0_reduce_res_118189 = *futhark_mc_task_127648->retval_defunc_0_reduce_res_118189;
    int64_t reduce_stage_1_tid_res_arr_mem_122689_cached_sizze_127650 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122689 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_122691_cached_sizze_127651 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122691 = NULL;
    int32_t nsubtasks_122688;
    
    nsubtasks_122688 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_122689_cached_sizze_127650 < (int64_t) 8 * nsubtasks_122688) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122689, &reduce_stage_1_tid_res_arr_mem_122689_cached_sizze_127650, (int64_t) 8 * nsubtasks_122688);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_122691_cached_sizze_127651 < (int64_t) 8 * nsubtasks_122688) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122691, &reduce_stage_1_tid_res_arr_mem_122691_cached_sizze_127651, (int64_t) 8 * nsubtasks_122688);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127652 futhark_mc_segred_stage_1_parloop_struct_127652_;
    
    futhark_mc_segred_stage_1_parloop_struct_127652_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127652_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127652_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_127652_.free_mem_111727 = mem_111727.mem;
    futhark_mc_segred_stage_1_parloop_struct_127652_.free_mem_118142 = mem_118142.mem;
    futhark_mc_segred_stage_1_parloop_struct_127652_.free_mem_118143 = mem_118143.mem;
    futhark_mc_segred_stage_1_parloop_struct_127652_.free_gtid_118178 = gtid_118178;
    futhark_mc_segred_stage_1_parloop_struct_127652_.free_reduce_stage_1_tid_res_arr_mem_122689 = reduce_stage_1_tid_res_arr_mem_122689;
    futhark_mc_segred_stage_1_parloop_struct_127652_.free_reduce_stage_1_tid_res_arr_mem_122691 = reduce_stage_1_tid_res_arr_mem_122691;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127653_task;
    
    futhark_mc_segred_stage_1_parloop_127653_task.name = "futhark_mc_segred_stage_1_parloop_127653";
    futhark_mc_segred_stage_1_parloop_127653_task.fn = futhark_mc_segred_stage_1_parloop_127653;
    futhark_mc_segred_stage_1_parloop_127653_task.args = &futhark_mc_segred_stage_1_parloop_struct_127652_;
    futhark_mc_segred_stage_1_parloop_127653_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127653_task.info = info;
    
    struct mc_event *event_127655 = mc_event_new(ctx);
    
    if (event_127655 != NULL)
        event_127655->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127653_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127653_task);
    
    if (futhark_mc_segred_stage_1_parloop_127653_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127653_err;
        goto cleanup;
    }
    if (event_127655 != NULL) {
        event_127655->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127653_total", strdup("nothing further"), event_127655, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_118188 = 0.0;
        defunc_0_reduce_res_118189 = 0.0;
    }
    
    double eta_p_122708;
    double eta_p_122709;
    double eta_p_122711;
    double eta_p_122712;
    
    for (int32_t i_122714 = 0; i_122714 < nsubtasks_122688; i_122714++) {
        flat_tid_118190 = i_122714;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_122708 = defunc_0_reduce_res_118188;
            }
            // load next params
            {
                eta_p_122709 = ((double *) reduce_stage_1_tid_res_arr_mem_122689)[flat_tid_118190];
            }
            // red body
            {
                double zp_res_122710 = eta_p_122708 + eta_p_122709;
                
                defunc_0_reduce_res_118188 = zp_res_122710;
            }
            // load acc params
            {
                eta_p_122711 = defunc_0_reduce_res_118189;
            }
            // load next params
            {
                eta_p_122712 = ((double *) reduce_stage_1_tid_res_arr_mem_122691)[flat_tid_118190];
            }
            // red body
            {
                double zp_res_122713 = eta_p_122711 + eta_p_122712;
                
                defunc_0_reduce_res_118189 = zp_res_122713;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_122689);
        free(reduce_stage_1_tid_res_arr_mem_122691);
    }
    if (event_127656 != NULL) {
        event_127656->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127649", strdup("nothing further"), event_127656, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127648->retval_defunc_0_reduce_res_118188 = defunc_0_reduce_res_118188;
        *futhark_mc_task_127648->retval_defunc_0_reduce_res_118189 = defunc_0_reduce_res_118189;
    }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_127647(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127646 *futhark_mc_segred_stage_1_parloop_struct_127646 = (struct futhark_mc_segred_stage_1_parloop_struct_127646 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127646->ctx;
    struct mc_event *event_127657 = mc_event_new(ctx);
    
    if (event_127657 != NULL)
        event_127657->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127646->free_m_33388;
    double safe_for_exp_33395 = futhark_mc_segred_stage_1_parloop_struct_127646->free_safe_for_exp_33395;
    double neg_res_43882 = futhark_mc_segred_stage_1_parloop_struct_127646->free_neg_res_43882;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_127646->free_lifted_lambda_res_106391;
    double defunc_res_106407 = futhark_mc_segred_stage_1_parloop_struct_127646->free_defunc_res_106407;
    double zp_res_106691 = futhark_mc_segred_stage_1_parloop_struct_127646->free_zp_res_106691;
    struct memblock mem_111727 = {.desc ="mem_111727", .mem =futhark_mc_segred_stage_1_parloop_struct_127646->free_mem_111727, .size =0, .references =NULL};
    struct memblock mem_111744 = {.desc ="mem_111744", .mem =futhark_mc_segred_stage_1_parloop_struct_127646->free_mem_111744, .size =0, .references =NULL};
    struct memblock mem_111750 = {.desc ="mem_111750", .mem =futhark_mc_segred_stage_1_parloop_struct_127646->free_mem_111750, .size =0, .references =NULL};
    struct memblock mem_111752 = {.desc ="mem_111752", .mem =futhark_mc_segred_stage_1_parloop_struct_127646->free_mem_111752, .size =0, .references =NULL};
    int64_t gtid_118115 = futhark_mc_segred_stage_1_parloop_struct_127646->free_gtid_118115;
    double zt_res_118125 = futhark_mc_segred_stage_1_parloop_struct_127646->free_zt_res_118125;
    double defunc_0_reduce_res_118126 = futhark_mc_segred_stage_1_parloop_struct_127646->free_defunc_0_reduce_res_118126;
    struct memblock mem_118142 = {.desc ="mem_118142", .mem =futhark_mc_segred_stage_1_parloop_struct_127646->free_mem_118142, .size =0, .references =NULL};
    struct memblock mem_118143 = {.desc ="mem_118143", .mem =futhark_mc_segred_stage_1_parloop_struct_127646->free_mem_118143, .size =0, .references =NULL};
    struct memblock mem_118173 = {.desc ="mem_118173", .mem =futhark_mc_segred_stage_1_parloop_struct_127646->free_mem_118173, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122670 = {.desc ="reduce_stage_1_tid_res_arr_mem_122670", .mem =futhark_mc_segred_stage_1_parloop_struct_127646->free_reduce_stage_1_tid_res_arr_mem_122670, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122672 = {.desc ="reduce_stage_1_tid_res_arr_mem_122672", .mem =futhark_mc_segred_stage_1_parloop_struct_127646->free_reduce_stage_1_tid_res_arr_mem_122672, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118177;
    
    flat_tid_118177 = subtask_id;
    {
        double eta_p_122674;
        double eta_p_122675;
        double eta_p_122677;
        double eta_p_122678;
        double local_acc_122680 = INFINITY;
        double local_acc_122681 = 0.0;
        double eta_p_118179;
        double eta_p_118180;
        double eta_p_118182;
        double eta_p_118183;
        double local_acc_122682 = INFINITY;
        double local_acc_122683 = 0.0;
        int64_t start_122684;
        int64_t end_122685;
        
        start_122684 = start;
        end_122685 = end;
        
        int64_t n_122686 = end_122685 - start_122684;
        
        for (int64_t SegRed_i_122687 = start_122684; SegRed_i_122687 < start_122684 + n_122686; SegRed_i_122687++) {
            int64_t gtid_118178 = SegRed_i_122687;
            double eta_p_118185 = ((double *) mem_111744.mem)[gtid_118115 * m_33388 + gtid_118178];
            double eta_p_wasfree_118186 = ((double *) mem_111752.mem)[gtid_118178];
            double eta_p_wasfree_118187 = ((double *) mem_111750.mem)[gtid_118178];
            double defunc_0_reduce_res_118188;
            double defunc_0_reduce_res_118189;
            int64_t flat_tid_118190 = (int64_t) 0;
            
            defunc_0_reduce_res_118188 = 0.0;
            defunc_0_reduce_res_118189 = 0.0;
            
            struct futhark_mc_task_127648 futhark_mc_task_127648_;
            
            futhark_mc_task_127648_.ctx = ctx;
            futhark_mc_task_127648_.free_m_33388 = m_33388;
            futhark_mc_task_127648_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
            futhark_mc_task_127648_.free_mem_111727 = mem_111727.mem;
            futhark_mc_task_127648_.free_mem_118142 = mem_118142.mem;
            futhark_mc_task_127648_.free_mem_118143 = mem_118143.mem;
            futhark_mc_task_127648_.free_gtid_118178 = gtid_118178;
            futhark_mc_task_127648_.free_flat_tid_118190 = flat_tid_118190;
            futhark_mc_task_127648_.retval_defunc_0_reduce_res_118188 = (double *) &defunc_0_reduce_res_118188;
            #if ISPC
            futhark_mc_task_127648_.retval_defunc_0_reduce_res_118188 += programIndex;
            #endif
            futhark_mc_task_127648_.retval_defunc_0_reduce_res_118189 = (double *) &defunc_0_reduce_res_118189;
            #if ISPC
            futhark_mc_task_127648_.retval_defunc_0_reduce_res_118189 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_127648_task;
            
            futhark_mc_task_127648_task.args = &futhark_mc_task_127648_;
            futhark_mc_task_127648_task.top_level_fn = futhark_mc_segred_task_127649;
            futhark_mc_task_127648_task.name = "futhark_mc_segred_task_127649";
            futhark_mc_task_127648_task.iterations = m_33388;
            futhark_mc_task_127648_task.task_time = &ctx->program->futhark_mc_segred_task_127649_total_time;
            futhark_mc_task_127648_task.task_iter = &ctx->program->futhark_mc_segred_task_127649_total_iter;
            futhark_mc_task_127648_task.sched = STATIC;
            futhark_mc_task_127648_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_127649_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127648_task);
            
            if (futhark_mc_segred_task_127649_err != 0) {
                err = futhark_mc_segred_task_127649_err;
                goto cleanup;
            }
            
            double zt_res_118203 = -2.0 * defunc_0_reduce_res_118188;
            double zp_res_118204 = defunc_0_reduce_res_118126 + zt_res_118203;
            double zp_res_118205 = eta_p_wasfree_118186 + zp_res_118204;
            double zp_res_118206 = zp_res_106691 + zp_res_118205;
            double zm_res_118207 = zp_res_118206 - zt_res_118125;
            double zm_res_118208 = zm_res_118207 - eta_p_wasfree_118187;
            double zs_res_118209 = zm_res_118208 / defunc_res_106407;
            double zs_res_118210 = zs_res_118209 / neg_res_43882;
            double zm_res_118211 = safe_for_exp_33395 - zs_res_118210;
            double zt_res_118212 = eta_p_118185 * defunc_0_reduce_res_118189;
            
            // save map-out results
            {
                ((double *) mem_118173.mem)[gtid_118178] = zs_res_118210;
            }
            // Load accum params
            {
                eta_p_118179 = local_acc_122682;
            }
            // Load next params
            {
                eta_p_118180 = zm_res_118211;
            }
            // SegRed body
            {
                double min_res_118181 = fmin64(eta_p_118179, eta_p_118180);
                
                local_acc_122682 = min_res_118181;
            }
            // Load accum params
            {
                eta_p_118182 = local_acc_122683;
            }
            // Load next params
            {
                eta_p_118183 = zt_res_118212;
            }
            // SegRed body
            {
                double zp_res_118184 = eta_p_118182 + eta_p_118183;
                
                local_acc_122683 = zp_res_118184;
            }
        }
        
        int64_t uni_i_122715 = 0;
        
        {
            int64_t gtid_118178 = uni_i_122715;
            
            // Load accum params
            {
                eta_p_122674 = local_acc_122680;
            }
            // Load next params
            {
                eta_p_122675 = local_acc_122682;
            }
            // SegRed body
            {
                double min_res_122676 = fmin64(eta_p_122674, eta_p_122675);
                
                local_acc_122680 = min_res_122676;
            }
            // Load accum params
            {
                eta_p_122677 = local_acc_122681;
            }
            // Load next params
            {
                eta_p_122678 = local_acc_122683;
            }
            // SegRed body
            {
                double zp_res_122679 = eta_p_122677 + eta_p_122678;
                
                local_acc_122681 = zp_res_122679;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_122670.mem)[flat_tid_118177] = local_acc_122680;
        ((double *) reduce_stage_1_tid_res_arr_mem_122672.mem)[flat_tid_118177] = local_acc_122681;
    }
    
  cleanup:
    { }
    if (event_127657 != NULL) {
        event_127657->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127647", strdup("nothing further"), event_127657, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_127643(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127634 *futhark_mc_task_127634 = (struct futhark_mc_task_127634 *) args;
    struct futhark_context *ctx = futhark_mc_task_127634->ctx;
    struct mc_event *event_127659 = mc_event_new(ctx);
    
    if (event_127659 != NULL)
        event_127659->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127634->free_m_33388;
    double safe_for_exp_33395 = futhark_mc_task_127634->free_safe_for_exp_33395;
    double neg_res_43882 = futhark_mc_task_127634->free_neg_res_43882;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_127634->free_lifted_lambda_res_106391;
    double defunc_res_106407 = futhark_mc_task_127634->free_defunc_res_106407;
    double zp_res_106691 = futhark_mc_task_127634->free_zp_res_106691;
    struct memblock mem_111727 = {.desc ="mem_111727", .mem =futhark_mc_task_127634->free_mem_111727, .size =0, .references =NULL};
    struct memblock mem_111744 = {.desc ="mem_111744", .mem =futhark_mc_task_127634->free_mem_111744, .size =0, .references =NULL};
    struct memblock mem_111750 = {.desc ="mem_111750", .mem =futhark_mc_task_127634->free_mem_111750, .size =0, .references =NULL};
    struct memblock mem_111752 = {.desc ="mem_111752", .mem =futhark_mc_task_127634->free_mem_111752, .size =0, .references =NULL};
    int64_t gtid_118115 = futhark_mc_task_127634->free_gtid_118115;
    double zt_res_118125 = futhark_mc_task_127634->free_zt_res_118125;
    double defunc_0_reduce_res_118126 = futhark_mc_task_127634->free_defunc_0_reduce_res_118126;
    struct memblock mem_118142 = {.desc ="mem_118142", .mem =futhark_mc_task_127634->free_mem_118142, .size =0, .references =NULL};
    struct memblock mem_118143 = {.desc ="mem_118143", .mem =futhark_mc_task_127634->free_mem_118143, .size =0, .references =NULL};
    int64_t flat_tid_118177 = futhark_mc_task_127634->free_flat_tid_118177;
    int64_t flat_tid_118213 = futhark_mc_task_127634->free_flat_tid_118213;
    double defunc_0_reduce_res_118174 = *futhark_mc_task_127634->retval_defunc_0_reduce_res_118174;
    double defunc_0_reduce_res_118175 = *futhark_mc_task_127634->retval_defunc_0_reduce_res_118175;
    struct memblock mem_118173 = {.desc ="mem_118173", .mem =futhark_mc_task_127634->retval_mem_118173, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_122670_cached_sizze_127644 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122670 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_122672_cached_sizze_127645 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122672 = NULL;
    int32_t nsubtasks_122669;
    
    nsubtasks_122669 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_122670_cached_sizze_127644 < (int64_t) 8 * nsubtasks_122669) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122670, &reduce_stage_1_tid_res_arr_mem_122670_cached_sizze_127644, (int64_t) 8 * nsubtasks_122669);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_122672_cached_sizze_127645 < (int64_t) 8 * nsubtasks_122669) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122672, &reduce_stage_1_tid_res_arr_mem_122672_cached_sizze_127645, (int64_t) 8 * nsubtasks_122669);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127646 futhark_mc_segred_stage_1_parloop_struct_127646_;
    
    futhark_mc_segred_stage_1_parloop_struct_127646_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127646_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127646_.free_safe_for_exp_33395 = safe_for_exp_33395;
    futhark_mc_segred_stage_1_parloop_struct_127646_.free_neg_res_43882 = neg_res_43882;
    futhark_mc_segred_stage_1_parloop_struct_127646_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_127646_.free_defunc_res_106407 = defunc_res_106407;
    futhark_mc_segred_stage_1_parloop_struct_127646_.free_zp_res_106691 = zp_res_106691;
    futhark_mc_segred_stage_1_parloop_struct_127646_.free_mem_111727 = mem_111727.mem;
    futhark_mc_segred_stage_1_parloop_struct_127646_.free_mem_111744 = mem_111744.mem;
    futhark_mc_segred_stage_1_parloop_struct_127646_.free_mem_111750 = mem_111750.mem;
    futhark_mc_segred_stage_1_parloop_struct_127646_.free_mem_111752 = mem_111752.mem;
    futhark_mc_segred_stage_1_parloop_struct_127646_.free_gtid_118115 = gtid_118115;
    futhark_mc_segred_stage_1_parloop_struct_127646_.free_zt_res_118125 = zt_res_118125;
    futhark_mc_segred_stage_1_parloop_struct_127646_.free_defunc_0_reduce_res_118126 = defunc_0_reduce_res_118126;
    futhark_mc_segred_stage_1_parloop_struct_127646_.free_mem_118142 = mem_118142.mem;
    futhark_mc_segred_stage_1_parloop_struct_127646_.free_mem_118143 = mem_118143.mem;
    futhark_mc_segred_stage_1_parloop_struct_127646_.free_mem_118173 = mem_118173.mem;
    futhark_mc_segred_stage_1_parloop_struct_127646_.free_reduce_stage_1_tid_res_arr_mem_122670 = reduce_stage_1_tid_res_arr_mem_122670;
    futhark_mc_segred_stage_1_parloop_struct_127646_.free_reduce_stage_1_tid_res_arr_mem_122672 = reduce_stage_1_tid_res_arr_mem_122672;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127647_task;
    
    futhark_mc_segred_stage_1_parloop_127647_task.name = "futhark_mc_segred_stage_1_parloop_127647";
    futhark_mc_segred_stage_1_parloop_127647_task.fn = futhark_mc_segred_stage_1_parloop_127647;
    futhark_mc_segred_stage_1_parloop_127647_task.args = &futhark_mc_segred_stage_1_parloop_struct_127646_;
    futhark_mc_segred_stage_1_parloop_127647_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127647_task.info = info;
    
    struct mc_event *event_127658 = mc_event_new(ctx);
    
    if (event_127658 != NULL)
        event_127658->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127647_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127647_task);
    
    if (futhark_mc_segred_stage_1_parloop_127647_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127647_err;
        goto cleanup;
    }
    if (event_127658 != NULL) {
        event_127658->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127647_total", strdup("nothing further"), event_127658, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_118174 = INFINITY;
        defunc_0_reduce_res_118175 = 0.0;
    }
    
    double eta_p_122716;
    double eta_p_122717;
    double eta_p_122719;
    double eta_p_122720;
    
    for (int32_t i_122722 = 0; i_122722 < nsubtasks_122669; i_122722++) {
        flat_tid_118177 = i_122722;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_122716 = defunc_0_reduce_res_118174;
            }
            // load next params
            {
                eta_p_122717 = ((double *) reduce_stage_1_tid_res_arr_mem_122670)[flat_tid_118177];
            }
            // red body
            {
                double min_res_122718 = fmin64(eta_p_122716, eta_p_122717);
                
                defunc_0_reduce_res_118174 = min_res_122718;
            }
            // load acc params
            {
                eta_p_122719 = defunc_0_reduce_res_118175;
            }
            // load next params
            {
                eta_p_122720 = ((double *) reduce_stage_1_tid_res_arr_mem_122672)[flat_tid_118177];
            }
            // red body
            {
                double zp_res_122721 = eta_p_122719 + eta_p_122720;
                
                defunc_0_reduce_res_118175 = zp_res_122721;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_122670);
        free(reduce_stage_1_tid_res_arr_mem_122672);
    }
    if (event_127659 != NULL) {
        event_127659->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_127643", strdup("nothing further"), event_127659, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127634->retval_defunc_0_reduce_res_118174 = defunc_0_reduce_res_118174;
        *futhark_mc_task_127634->retval_defunc_0_reduce_res_118175 = defunc_0_reduce_res_118175;
        futhark_mc_task_127634->retval_mem_118173 = mem_118173.mem;
    }
    return err;
}
struct futhark_mc_task_127660 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_118173;
    double free_defunc_0_reduce_res_118174;
};
struct futhark_mc_segmap_parloop_struct_127662 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_118173;
    double free_defunc_0_reduce_res_118174;
};
static int futhark_mc_segmap_parloop_127663(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_127662 *futhark_mc_segmap_parloop_struct_127662 = (struct futhark_mc_segmap_parloop_struct_127662 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_127662->ctx;
    struct mc_event *event_127664 = mc_event_new(ctx);
    
    if (event_127664 != NULL)
        event_127664->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_127662->free_m_33388;
    struct memblock mem_118173 = {.desc ="mem_118173", .mem =futhark_mc_segmap_parloop_struct_127662->free_mem_118173, .size =0, .references =NULL};
    double defunc_0_reduce_res_118174 = futhark_mc_segmap_parloop_struct_127662->free_defunc_0_reduce_res_118174;
    int64_t iterations = end - start;
    int64_t flat_tid_118247;
    
    flat_tid_118247 = subtask_id;
    {
        int64_t start_122724;
        int64_t end_122725;
        
        start_122724 = start;
        end_122725 = end;
        
        int64_t n_122726 = end_122725 - start_122724;
        
        for (int64_t SegMap_i_122727 = start_122724; SegMap_i_122727 < start_122724 + n_122726; SegMap_i_122727++) {
            int64_t slice_122728 = m_33388;
            int64_t gtid_118248 = SegMap_i_122727;
            int64_t remnant_122729 = SegMap_i_122727 - gtid_118248;
            double eta_p_118249 = ((double *) mem_118173.mem)[gtid_118248];
            double zp_res_118250 = defunc_0_reduce_res_118174 + eta_p_118249;
            
            ((double *) mem_118173.mem)[gtid_118248] = zp_res_118250;
        }
    }
    
  cleanup:
    { }
    if (event_127664 != NULL) {
        event_127664->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127663", strdup("nothing further"), event_127664, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_task_127661(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127660 *futhark_mc_task_127660 = (struct futhark_mc_task_127660 *) args;
    struct futhark_context *ctx = futhark_mc_task_127660->ctx;
    struct mc_event *event_127666 = mc_event_new(ctx);
    
    if (event_127666 != NULL)
        event_127666->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127660->free_m_33388;
    struct memblock mem_118173 = {.desc ="mem_118173", .mem =futhark_mc_task_127660->free_mem_118173, .size =0, .references =NULL};
    double defunc_0_reduce_res_118174 = futhark_mc_task_127660->free_defunc_0_reduce_res_118174;
    int32_t nsubtasks_122723;
    
    nsubtasks_122723 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_127662 futhark_mc_segmap_parloop_struct_127662_;
    
    futhark_mc_segmap_parloop_struct_127662_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_127662_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_127662_.free_mem_118173 = mem_118173.mem;
    futhark_mc_segmap_parloop_struct_127662_.free_defunc_0_reduce_res_118174 = defunc_0_reduce_res_118174;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_127663_task;
    
    futhark_mc_segmap_parloop_127663_task.name = "futhark_mc_segmap_parloop_127663";
    futhark_mc_segmap_parloop_127663_task.fn = futhark_mc_segmap_parloop_127663;
    futhark_mc_segmap_parloop_127663_task.args = &futhark_mc_segmap_parloop_struct_127662_;
    futhark_mc_segmap_parloop_127663_task.iterations = iterations;
    futhark_mc_segmap_parloop_127663_task.info = info;
    
    struct mc_event *event_127665 = mc_event_new(ctx);
    
    if (event_127665 != NULL)
        event_127665->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_127663_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_127663_task);
    
    if (futhark_mc_segmap_parloop_127663_err != 0) {
        err = futhark_mc_segmap_parloop_127663_err;
        goto cleanup;
    }
    if (event_127665 != NULL) {
        event_127665->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127663_total", strdup("nothing further"), event_127665, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_127666 != NULL) {
        event_127666->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_task_127661", strdup("nothing further"), event_127666, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_127667 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_111795;
    int64_t free_gtid_118115;
    unsigned char *free_mem_118173;
};
struct futhark_mc_copy_parloop_struct_127669 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_111795;
    int64_t free_gtid_118115;
    unsigned char *free_mem_118173;
};
static int futhark_mc_copy_parloop_127670(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_copy_parloop_struct_127669 *futhark_mc_copy_parloop_struct_127669 = (struct futhark_mc_copy_parloop_struct_127669 *) args;
    struct futhark_context *ctx = futhark_mc_copy_parloop_struct_127669->ctx;
    struct mc_event *event_127671 = mc_event_new(ctx);
    
    if (event_127671 != NULL)
        event_127671->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_copy_parloop_struct_127669->free_m_33388;
    struct memblock mem_111795 = {.desc ="mem_111795", .mem =futhark_mc_copy_parloop_struct_127669->free_mem_111795, .size =0, .references =NULL};
    int64_t gtid_118115 = futhark_mc_copy_parloop_struct_127669->free_gtid_118115;
    struct memblock mem_118173 = {.desc ="mem_118173", .mem =futhark_mc_copy_parloop_struct_127669->free_mem_118173, .size =0, .references =NULL};
    int64_t iterations = end - start;
    
    {
        int64_t start_122730;
        int64_t end_122731;
        
        start_122730 = start;
        end_122731 = end;
        
        int64_t n_122732 = end_122731 - start_122730;
        
        for (int64_t copy_i_122733 = start_122730; copy_i_122733 < start_122730 + n_122732; copy_i_122733++) {
            int64_t slice_122735 = m_33388;
            int64_t i_122734 = copy_i_122733;
            int64_t remnant_122736 = copy_i_122733 - i_122734;
            double tmp_122737 = ((double *) mem_118173.mem)[i_122734];
            
            ((double *) mem_111795.mem)[gtid_118115 * m_33388 + i_122734] = tmp_122737;
        }
    }
    
  cleanup:
    { }
    if (event_127671 != NULL) {
        event_127671->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_parloop_127670", strdup("nothing further"), event_127671, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_copy_122738_task_127668(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127667 *futhark_mc_task_127667 = (struct futhark_mc_task_127667 *) args;
    struct futhark_context *ctx = futhark_mc_task_127667->ctx;
    struct mc_event *event_127673 = mc_event_new(ctx);
    
    if (event_127673 != NULL)
        event_127673->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127667->free_m_33388;
    struct memblock mem_111795 = {.desc ="mem_111795", .mem =futhark_mc_task_127667->free_mem_111795, .size =0, .references =NULL};
    int64_t gtid_118115 = futhark_mc_task_127667->free_gtid_118115;
    struct memblock mem_118173 = {.desc ="mem_118173", .mem =futhark_mc_task_127667->free_mem_118173, .size =0, .references =NULL};
    struct futhark_mc_copy_parloop_struct_127669 futhark_mc_copy_parloop_struct_127669_;
    
    futhark_mc_copy_parloop_struct_127669_.ctx = ctx;
    futhark_mc_copy_parloop_struct_127669_.free_m_33388 = m_33388;
    futhark_mc_copy_parloop_struct_127669_.free_mem_111795 = mem_111795.mem;
    futhark_mc_copy_parloop_struct_127669_.free_gtid_118115 = gtid_118115;
    futhark_mc_copy_parloop_struct_127669_.free_mem_118173 = mem_118173.mem;
    
    struct scheduler_parloop futhark_mc_copy_parloop_127670_task;
    
    futhark_mc_copy_parloop_127670_task.name = "futhark_mc_copy_parloop_127670";
    futhark_mc_copy_parloop_127670_task.fn = futhark_mc_copy_parloop_127670;
    futhark_mc_copy_parloop_127670_task.args = &futhark_mc_copy_parloop_struct_127669_;
    futhark_mc_copy_parloop_127670_task.iterations = iterations;
    futhark_mc_copy_parloop_127670_task.info = info;
    
    struct mc_event *event_127672 = mc_event_new(ctx);
    
    if (event_127672 != NULL)
        event_127672->bef = get_wall_time();
    
    int futhark_mc_copy_parloop_127670_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_copy_parloop_127670_task);
    
    if (futhark_mc_copy_parloop_127670_err != 0) {
        err = futhark_mc_copy_parloop_127670_err;
        goto cleanup;
    }
    if (event_127672 != NULL) {
        event_127672->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_parloop_127670_total", strdup("nothing further"), event_127672, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_127673 != NULL) {
        event_127673->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_122738_task_127668", strdup("nothing further"), event_127673, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_127599(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127598 *futhark_mc_segred_stage_1_parloop_struct_127598 = (struct futhark_mc_segred_stage_1_parloop_struct_127598 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127598->ctx;
    struct mc_event *event_127674 = mc_event_new(ctx);
    
    if (event_127674 != NULL)
        event_127674->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127598->free_m_33388;
    double safe_for_exp_33395 = futhark_mc_segred_stage_1_parloop_struct_127598->free_safe_for_exp_33395;
    double neg_res_43882 = futhark_mc_segred_stage_1_parloop_struct_127598->free_neg_res_43882;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_127598->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_127598->free_lifted_lambda_res_106391;
    double defunc_res_106407 = futhark_mc_segred_stage_1_parloop_struct_127598->free_defunc_res_106407;
    double zt_res_106587 = futhark_mc_segred_stage_1_parloop_struct_127598->free_zt_res_106587;
    double zp_res_106691 = futhark_mc_segred_stage_1_parloop_struct_127598->free_zp_res_106691;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_127598->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_127598->free_distrs_mem_111708, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_segred_stage_1_parloop_struct_127598->free_bytes_111715;
    struct memblock mem_111727 = {.desc ="mem_111727", .mem =futhark_mc_segred_stage_1_parloop_struct_127598->free_mem_111727, .size =0, .references =NULL};
    struct memblock mem_111739 = {.desc ="mem_111739", .mem =futhark_mc_segred_stage_1_parloop_struct_127598->free_mem_111739, .size =0, .references =NULL};
    struct memblock mem_111741 = {.desc ="mem_111741", .mem =futhark_mc_segred_stage_1_parloop_struct_127598->free_mem_111741, .size =0, .references =NULL};
    struct memblock mem_111744 = {.desc ="mem_111744", .mem =futhark_mc_segred_stage_1_parloop_struct_127598->free_mem_111744, .size =0, .references =NULL};
    struct memblock mem_111750 = {.desc ="mem_111750", .mem =futhark_mc_segred_stage_1_parloop_struct_127598->free_mem_111750, .size =0, .references =NULL};
    struct memblock mem_111752 = {.desc ="mem_111752", .mem =futhark_mc_segred_stage_1_parloop_struct_127598->free_mem_111752, .size =0, .references =NULL};
    struct memblock mem_111795 = {.desc ="mem_111795", .mem =futhark_mc_segred_stage_1_parloop_struct_127598->free_mem_111795, .size =0, .references =NULL};
    struct memblock mem_111797 = {.desc ="mem_111797", .mem =futhark_mc_segred_stage_1_parloop_struct_127598->free_mem_111797, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122533 = {.desc ="reduce_stage_1_tid_res_arr_mem_122533", .mem =futhark_mc_segred_stage_1_parloop_struct_127598->free_reduce_stage_1_tid_res_arr_mem_122533, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122535 = {.desc ="reduce_stage_1_tid_res_arr_mem_122535", .mem =futhark_mc_segred_stage_1_parloop_struct_127598->free_reduce_stage_1_tid_res_arr_mem_122535, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t mem_118142_cached_sizze_127600 = 0;
    unsigned char *mem_118142 = NULL;
    int64_t mem_118143_cached_sizze_127601 = 0;
    unsigned char *mem_118143 = NULL;
    int64_t mem_118173_cached_sizze_127602 = 0;
    unsigned char *mem_118173 = NULL;
    int64_t flat_tid_118114;
    
    flat_tid_118114 = subtask_id;
    {
        double eta_p_122537;
        double eta_p_122538;
        double eta_p_122540;
        double eta_p_122541;
        double local_acc_122543 = 0.0;
        double local_acc_122544 = 0.0;
        double eta_p_118116;
        double eta_p_118117;
        double eta_p_118119;
        double eta_p_118120;
        double local_acc_122545 = 0.0;
        double local_acc_122546 = 0.0;
        int64_t start_122547;
        int64_t end_122548;
        
        start_122547 = start;
        end_122548 = end;
        
        int64_t n_122549 = end_122548 - start_122547;
        
        if (mem_118142_cached_sizze_127600 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_118142, &mem_118142_cached_sizze_127600, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_118143_cached_sizze_127601 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_118143, &mem_118143_cached_sizze_127601, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_118173_cached_sizze_127602 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_118173, &mem_118173_cached_sizze_127602, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        for (int64_t SegRed_i_122550 = start_122547; SegRed_i_122550 < start_122547 + n_122549; SegRed_i_122550++) {
            int64_t gtid_118115 = SegRed_i_122550;
            double eta_p_118122 = ((double *) mem_111741.mem)[gtid_118115];
            double eta_p_118123 = ((double *) distrs_mem_111708.mem)[eta_p_106382 * m_33388 + gtid_118115];
            double log_res_118124 = futrts_log64(eta_p_118123);
            double zt_res_118125 = zt_res_106587 * log_res_118124;
            double defunc_0_reduce_res_118126;
            double defunc_0_reduce_res_118127;
            int64_t flat_tid_118128 = (int64_t) 0;
            
            defunc_0_reduce_res_118126 = 0.0;
            defunc_0_reduce_res_118127 = 0.0;
            
            struct futhark_mc_task_127603 futhark_mc_task_127603_;
            
            futhark_mc_task_127603_.ctx = ctx;
            futhark_mc_task_127603_.free_m_33388 = m_33388;
            futhark_mc_task_127603_.free_eta_p_106382 = eta_p_106382;
            futhark_mc_task_127603_.free_A_mem_111707 = A_mem_111707.mem;
            futhark_mc_task_127603_.free_mem_111739 = mem_111739.mem;
            futhark_mc_task_127603_.free_mem_111741 = mem_111741.mem;
            futhark_mc_task_127603_.free_gtid_118115 = gtid_118115;
            futhark_mc_task_127603_.free_flat_tid_118128 = flat_tid_118128;
            futhark_mc_task_127603_.retval_defunc_0_reduce_res_118126 = (double *) &defunc_0_reduce_res_118126;
            #if ISPC
            futhark_mc_task_127603_.retval_defunc_0_reduce_res_118126 += programIndex;
            #endif
            futhark_mc_task_127603_.retval_defunc_0_reduce_res_118127 = (double *) &defunc_0_reduce_res_118127;
            #if ISPC
            futhark_mc_task_127603_.retval_defunc_0_reduce_res_118127 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_127603_task;
            
            futhark_mc_task_127603_task.args = &futhark_mc_task_127603_;
            futhark_mc_task_127603_task.top_level_fn = futhark_mc_segred_task_127604;
            futhark_mc_task_127603_task.name = "futhark_mc_segred_task_127604";
            futhark_mc_task_127603_task.iterations = m_33388;
            futhark_mc_task_127603_task.task_time = &ctx->program->futhark_mc_segred_task_127604_total_time;
            futhark_mc_task_127603_task.task_iter = &ctx->program->futhark_mc_segred_task_127604_total_iter;
            futhark_mc_task_127603_task.sched = STATIC;
            futhark_mc_task_127603_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_127604_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127603_task);
            
            if (futhark_mc_segred_task_127604_err != 0) {
                err = futhark_mc_segred_task_127604_err;
                goto cleanup;
            }
            
            int64_t flat_tid_118161 = (int64_t) 0;
            int64_t flat_tid_118146 = (int64_t) 0;
            struct futhark_mc_task_127612 futhark_mc_task_127612_;
            
            futhark_mc_task_127612_.ctx = ctx;
            futhark_mc_task_127612_.free_m_33388 = m_33388;
            futhark_mc_task_127612_.free_eta_p_106382 = eta_p_106382;
            futhark_mc_task_127612_.free_A_mem_111707 = A_mem_111707.mem;
            futhark_mc_task_127612_.free_mem_111744 = mem_111744.mem;
            futhark_mc_task_127612_.free_gtid_118115 = gtid_118115;
            futhark_mc_task_127612_.free_mem_118142 = mem_118142;
            futhark_mc_task_127612_.free_mem_118143 = mem_118143;
            
            struct scheduler_segop futhark_mc_task_127612_task;
            
            futhark_mc_task_127612_task.args = &futhark_mc_task_127612_;
            futhark_mc_task_127612_task.top_level_fn = futhark_mc_segmap_task_127613;
            futhark_mc_task_127612_task.name = "futhark_mc_segmap_task_127613";
            futhark_mc_task_127612_task.iterations = m_33388;
            futhark_mc_task_127612_task.task_time = &ctx->program->futhark_mc_segmap_task_127613_total_time;
            futhark_mc_task_127612_task.task_iter = &ctx->program->futhark_mc_segmap_task_127613_total_iter;
            futhark_mc_task_127612_task.sched = STATIC;
            futhark_mc_task_127612_task.nested_fn = futhark_mc_segmap_nested_task_127619;
            
            int futhark_mc_segmap_task_127613_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127612_task);
            
            if (futhark_mc_segmap_task_127613_err != 0) {
                err = futhark_mc_segmap_task_127613_err;
                goto cleanup;
            }
            
            double defunc_0_reduce_res_118174;
            double defunc_0_reduce_res_118175;
            int64_t flat_tid_118213 = (int64_t) 0;
            
            defunc_0_reduce_res_118174 = 0.0;
            defunc_0_reduce_res_118175 = 0.0;
            
            int64_t flat_tid_118177 = (int64_t) 0;
            struct futhark_mc_task_127634 futhark_mc_task_127634_;
            
            futhark_mc_task_127634_.ctx = ctx;
            futhark_mc_task_127634_.free_m_33388 = m_33388;
            futhark_mc_task_127634_.free_safe_for_exp_33395 = safe_for_exp_33395;
            futhark_mc_task_127634_.free_neg_res_43882 = neg_res_43882;
            futhark_mc_task_127634_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
            futhark_mc_task_127634_.free_defunc_res_106407 = defunc_res_106407;
            futhark_mc_task_127634_.free_zp_res_106691 = zp_res_106691;
            futhark_mc_task_127634_.free_mem_111727 = mem_111727.mem;
            futhark_mc_task_127634_.free_mem_111744 = mem_111744.mem;
            futhark_mc_task_127634_.free_mem_111750 = mem_111750.mem;
            futhark_mc_task_127634_.free_mem_111752 = mem_111752.mem;
            futhark_mc_task_127634_.free_gtid_118115 = gtid_118115;
            futhark_mc_task_127634_.free_zt_res_118125 = zt_res_118125;
            futhark_mc_task_127634_.free_defunc_0_reduce_res_118126 = defunc_0_reduce_res_118126;
            futhark_mc_task_127634_.free_mem_118142 = mem_118142;
            futhark_mc_task_127634_.free_mem_118143 = mem_118143;
            futhark_mc_task_127634_.free_flat_tid_118177 = flat_tid_118177;
            futhark_mc_task_127634_.free_flat_tid_118213 = flat_tid_118213;
            futhark_mc_task_127634_.retval_defunc_0_reduce_res_118174 = (double *) &defunc_0_reduce_res_118174;
            #if ISPC
            futhark_mc_task_127634_.retval_defunc_0_reduce_res_118174 += programIndex;
            #endif
            futhark_mc_task_127634_.retval_defunc_0_reduce_res_118175 = (double *) &defunc_0_reduce_res_118175;
            #if ISPC
            futhark_mc_task_127634_.retval_defunc_0_reduce_res_118175 += programIndex;
            #endif
            futhark_mc_task_127634_.retval_mem_118173 = mem_118173;
            
            struct scheduler_segop futhark_mc_task_127634_task;
            
            futhark_mc_task_127634_task.args = &futhark_mc_task_127634_;
            futhark_mc_task_127634_task.top_level_fn = futhark_mc_segred_task_127635;
            futhark_mc_task_127634_task.name = "futhark_mc_segred_task_127635";
            futhark_mc_task_127634_task.iterations = m_33388;
            futhark_mc_task_127634_task.task_time = &ctx->program->futhark_mc_segred_task_127635_total_time;
            futhark_mc_task_127634_task.task_iter = &ctx->program->futhark_mc_segred_task_127635_total_iter;
            futhark_mc_task_127634_task.sched = STATIC;
            futhark_mc_task_127634_task.nested_fn = futhark_mc_segred_nested_task_127643;
            
            int futhark_mc_segred_task_127635_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127634_task);
            
            if (futhark_mc_segred_task_127635_err != 0) {
                err = futhark_mc_segred_task_127635_err;
                goto cleanup;
            }
            
            int64_t flat_tid_118247 = (int64_t) 0;
            struct futhark_mc_task_127660 futhark_mc_task_127660_;
            
            futhark_mc_task_127660_.ctx = ctx;
            futhark_mc_task_127660_.free_m_33388 = m_33388;
            futhark_mc_task_127660_.free_mem_118173 = mem_118173;
            futhark_mc_task_127660_.free_defunc_0_reduce_res_118174 = defunc_0_reduce_res_118174;
            
            struct scheduler_segop futhark_mc_task_127660_task;
            
            futhark_mc_task_127660_task.args = &futhark_mc_task_127660_;
            futhark_mc_task_127660_task.top_level_fn = futhark_mc_segmap_task_127661;
            futhark_mc_task_127660_task.name = "futhark_mc_segmap_task_127661";
            futhark_mc_task_127660_task.iterations = m_33388;
            futhark_mc_task_127660_task.task_time = &ctx->program->futhark_mc_segmap_task_127661_total_time;
            futhark_mc_task_127660_task.task_iter = &ctx->program->futhark_mc_segmap_task_127661_total_iter;
            futhark_mc_task_127660_task.sched = STATIC;
            futhark_mc_task_127660_task.nested_fn = NULL;
            
            int futhark_mc_segmap_task_127661_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127660_task);
            
            if (futhark_mc_segmap_task_127661_err != 0) {
                err = futhark_mc_segmap_task_127661_err;
                goto cleanup;
            }
            
            double zt_res_118251 = eta_p_118122 * defunc_0_reduce_res_118127;
            
            // save map-out results
            {
                int64_t iterations_122739 = m_33388;
                struct futhark_mc_task_127667 futhark_mc_task_127667_;
                
                futhark_mc_task_127667_.ctx = ctx;
                futhark_mc_task_127667_.free_m_33388 = m_33388;
                futhark_mc_task_127667_.free_mem_111795 = mem_111795.mem;
                futhark_mc_task_127667_.free_gtid_118115 = gtid_118115;
                futhark_mc_task_127667_.free_mem_118173 = mem_118173;
                
                struct scheduler_segop futhark_mc_task_127667_task;
                
                futhark_mc_task_127667_task.args = &futhark_mc_task_127667_;
                futhark_mc_task_127667_task.top_level_fn = futhark_mc_copy_122738_task_127668;
                futhark_mc_task_127667_task.name = "futhark_mc_copy_122738_task_127668";
                futhark_mc_task_127667_task.iterations = iterations_122739;
                futhark_mc_task_127667_task.task_time = &ctx->program->futhark_mc_copy_122738_task_127668_total_time;
                futhark_mc_task_127667_task.task_iter = &ctx->program->futhark_mc_copy_122738_task_127668_total_iter;
                futhark_mc_task_127667_task.sched = STATIC;
                futhark_mc_task_127667_task.nested_fn = NULL;
                
                int futhark_mc_copy_122738_task_127668_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127667_task);
                
                if (futhark_mc_copy_122738_task_127668_err != 0) {
                    err = futhark_mc_copy_122738_task_127668_err;
                    goto cleanup;
                }
                ((double *) mem_111797.mem)[gtid_118115] = defunc_0_reduce_res_118174;
            }
            // Load accum params
            {
                eta_p_118116 = local_acc_122545;
            }
            // Load next params
            {
                eta_p_118117 = zt_res_118251;
            }
            // SegRed body
            {
                double zp_res_118118 = eta_p_118116 + eta_p_118117;
                
                local_acc_122545 = zp_res_118118;
            }
            // Load accum params
            {
                eta_p_118119 = local_acc_122546;
            }
            // Load next params
            {
                eta_p_118120 = defunc_0_reduce_res_118175;
            }
            // SegRed body
            {
                double zp_res_118121 = eta_p_118119 + eta_p_118120;
                
                local_acc_122546 = zp_res_118121;
            }
        }
        
        int64_t uni_i_122740 = 0;
        
        {
            int64_t gtid_118115 = uni_i_122740;
            
            // Load accum params
            {
                eta_p_122537 = local_acc_122543;
            }
            // Load next params
            {
                eta_p_122538 = local_acc_122545;
            }
            // SegRed body
            {
                double zp_res_122539 = eta_p_122537 + eta_p_122538;
                
                local_acc_122543 = zp_res_122539;
            }
            // Load accum params
            {
                eta_p_122540 = local_acc_122544;
            }
            // Load next params
            {
                eta_p_122541 = local_acc_122546;
            }
            // SegRed body
            {
                double zp_res_122542 = eta_p_122540 + eta_p_122541;
                
                local_acc_122544 = zp_res_122542;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_122533.mem)[flat_tid_118114] = local_acc_122543;
        ((double *) reduce_stage_1_tid_res_arr_mem_122535.mem)[flat_tid_118114] = local_acc_122544;
    }
    
  cleanup:
    {
        free(mem_118142);
        free(mem_118143);
        free(mem_118173);
    }
    if (event_127674 != NULL) {
        event_127674->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127599", strdup("nothing further"), event_127674, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_127595(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127582 *futhark_mc_task_127582 = (struct futhark_mc_task_127582 *) args;
    struct futhark_context *ctx = futhark_mc_task_127582->ctx;
    struct mc_event *event_127676 = mc_event_new(ctx);
    
    if (event_127676 != NULL)
        event_127676->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127582->free_m_33388;
    double safe_for_exp_33395 = futhark_mc_task_127582->free_safe_for_exp_33395;
    double neg_res_43882 = futhark_mc_task_127582->free_neg_res_43882;
    int64_t eta_p_106382 = futhark_mc_task_127582->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_127582->free_lifted_lambda_res_106391;
    double defunc_res_106407 = futhark_mc_task_127582->free_defunc_res_106407;
    double zt_res_106587 = futhark_mc_task_127582->free_zt_res_106587;
    double zp_res_106691 = futhark_mc_task_127582->free_zp_res_106691;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_127582->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_127582->free_distrs_mem_111708, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_task_127582->free_bytes_111715;
    struct memblock mem_111727 = {.desc ="mem_111727", .mem =futhark_mc_task_127582->free_mem_111727, .size =0, .references =NULL};
    struct memblock mem_111739 = {.desc ="mem_111739", .mem =futhark_mc_task_127582->free_mem_111739, .size =0, .references =NULL};
    struct memblock mem_111741 = {.desc ="mem_111741", .mem =futhark_mc_task_127582->free_mem_111741, .size =0, .references =NULL};
    struct memblock mem_111744 = {.desc ="mem_111744", .mem =futhark_mc_task_127582->free_mem_111744, .size =0, .references =NULL};
    struct memblock mem_111750 = {.desc ="mem_111750", .mem =futhark_mc_task_127582->free_mem_111750, .size =0, .references =NULL};
    struct memblock mem_111752 = {.desc ="mem_111752", .mem =futhark_mc_task_127582->free_mem_111752, .size =0, .references =NULL};
    int64_t flat_tid_118114 = futhark_mc_task_127582->free_flat_tid_118114;
    int64_t flat_tid_118252 = futhark_mc_task_127582->free_flat_tid_118252;
    double defunc_0_reduce_res_106743 = *futhark_mc_task_127582->retval_defunc_0_reduce_res_106743;
    double defunc_res_106744 = *futhark_mc_task_127582->retval_defunc_res_106744;
    struct memblock mem_111795 = {.desc ="mem_111795", .mem =futhark_mc_task_127582->retval_mem_111795, .size =0, .references =NULL};
    struct memblock mem_111797 = {.desc ="mem_111797", .mem =futhark_mc_task_127582->retval_mem_111797, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_122533_cached_sizze_127596 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122533 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_122535_cached_sizze_127597 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122535 = NULL;
    int32_t nsubtasks_122532;
    
    nsubtasks_122532 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_122533_cached_sizze_127596 < (int64_t) 8 * nsubtasks_122532) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122533, &reduce_stage_1_tid_res_arr_mem_122533_cached_sizze_127596, (int64_t) 8 * nsubtasks_122532);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_122535_cached_sizze_127597 < (int64_t) 8 * nsubtasks_122532) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122535, &reduce_stage_1_tid_res_arr_mem_122535_cached_sizze_127597, (int64_t) 8 * nsubtasks_122532);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127598 futhark_mc_segred_stage_1_parloop_struct_127598_;
    
    futhark_mc_segred_stage_1_parloop_struct_127598_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127598_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127598_.free_safe_for_exp_33395 = safe_for_exp_33395;
    futhark_mc_segred_stage_1_parloop_struct_127598_.free_neg_res_43882 = neg_res_43882;
    futhark_mc_segred_stage_1_parloop_struct_127598_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_127598_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_127598_.free_defunc_res_106407 = defunc_res_106407;
    futhark_mc_segred_stage_1_parloop_struct_127598_.free_zt_res_106587 = zt_res_106587;
    futhark_mc_segred_stage_1_parloop_struct_127598_.free_zp_res_106691 = zp_res_106691;
    futhark_mc_segred_stage_1_parloop_struct_127598_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_127598_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_127598_.free_bytes_111715 = bytes_111715;
    futhark_mc_segred_stage_1_parloop_struct_127598_.free_mem_111727 = mem_111727.mem;
    futhark_mc_segred_stage_1_parloop_struct_127598_.free_mem_111739 = mem_111739.mem;
    futhark_mc_segred_stage_1_parloop_struct_127598_.free_mem_111741 = mem_111741.mem;
    futhark_mc_segred_stage_1_parloop_struct_127598_.free_mem_111744 = mem_111744.mem;
    futhark_mc_segred_stage_1_parloop_struct_127598_.free_mem_111750 = mem_111750.mem;
    futhark_mc_segred_stage_1_parloop_struct_127598_.free_mem_111752 = mem_111752.mem;
    futhark_mc_segred_stage_1_parloop_struct_127598_.free_mem_111795 = mem_111795.mem;
    futhark_mc_segred_stage_1_parloop_struct_127598_.free_mem_111797 = mem_111797.mem;
    futhark_mc_segred_stage_1_parloop_struct_127598_.free_reduce_stage_1_tid_res_arr_mem_122533 = reduce_stage_1_tid_res_arr_mem_122533;
    futhark_mc_segred_stage_1_parloop_struct_127598_.free_reduce_stage_1_tid_res_arr_mem_122535 = reduce_stage_1_tid_res_arr_mem_122535;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127599_task;
    
    futhark_mc_segred_stage_1_parloop_127599_task.name = "futhark_mc_segred_stage_1_parloop_127599";
    futhark_mc_segred_stage_1_parloop_127599_task.fn = futhark_mc_segred_stage_1_parloop_127599;
    futhark_mc_segred_stage_1_parloop_127599_task.args = &futhark_mc_segred_stage_1_parloop_struct_127598_;
    futhark_mc_segred_stage_1_parloop_127599_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127599_task.info = info;
    
    struct mc_event *event_127675 = mc_event_new(ctx);
    
    if (event_127675 != NULL)
        event_127675->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127599_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127599_task);
    
    if (futhark_mc_segred_stage_1_parloop_127599_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127599_err;
        goto cleanup;
    }
    if (event_127675 != NULL) {
        event_127675->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127599_total", strdup("nothing further"), event_127675, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_106743 = 0.0;
        defunc_res_106744 = 0.0;
    }
    
    double eta_p_122741;
    double eta_p_122742;
    double eta_p_122744;
    double eta_p_122745;
    
    for (int32_t i_122747 = 0; i_122747 < nsubtasks_122532; i_122747++) {
        flat_tid_118114 = i_122747;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_122741 = defunc_0_reduce_res_106743;
            }
            // load next params
            {
                eta_p_122742 = ((double *) reduce_stage_1_tid_res_arr_mem_122533)[flat_tid_118114];
            }
            // red body
            {
                double zp_res_122743 = eta_p_122741 + eta_p_122742;
                
                defunc_0_reduce_res_106743 = zp_res_122743;
            }
            // load acc params
            {
                eta_p_122744 = defunc_res_106744;
            }
            // load next params
            {
                eta_p_122745 = ((double *) reduce_stage_1_tid_res_arr_mem_122535)[flat_tid_118114];
            }
            // red body
            {
                double zp_res_122746 = eta_p_122744 + eta_p_122745;
                
                defunc_res_106744 = zp_res_122746;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_122533);
        free(reduce_stage_1_tid_res_arr_mem_122535);
    }
    if (event_127676 != NULL) {
        event_127676->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_127595", strdup("nothing further"), event_127676, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127582->retval_defunc_0_reduce_res_106743 = defunc_0_reduce_res_106743;
        *futhark_mc_task_127582->retval_defunc_res_106744 = defunc_res_106744;
        futhark_mc_task_127582->retval_mem_111795 = mem_111795.mem;
        futhark_mc_task_127582->retval_mem_111797 = mem_111797.mem;
    }
    return err;
}
struct futhark_mc_task_127677 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_safe_for_exp_33395;
    unsigned char *free_mem_111795;
    unsigned char *free_mem_111799;
};
struct futhark_mc_segmap_parloop_struct_127679 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_safe_for_exp_33395;
    unsigned char *free_mem_111795;
    unsigned char *free_mem_111799;
};
static int futhark_mc_segmap_parloop_127680(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_127679 *futhark_mc_segmap_parloop_struct_127679 = (struct futhark_mc_segmap_parloop_struct_127679 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_127679->ctx;
    struct mc_event *event_127681 = mc_event_new(ctx);
    
    if (event_127681 != NULL)
        event_127681->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_127679->free_m_33388;
    double safe_for_exp_33395 = futhark_mc_segmap_parloop_struct_127679->free_safe_for_exp_33395;
    struct memblock mem_111795 = {.desc ="mem_111795", .mem =futhark_mc_segmap_parloop_struct_127679->free_mem_111795, .size =0, .references =NULL};
    struct memblock mem_111799 = {.desc ="mem_111799", .mem =futhark_mc_segmap_parloop_struct_127679->free_mem_111799, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118354;
    
    flat_tid_118354 = subtask_id;
    {
        int64_t start_122754;
        int64_t end_122755;
        
        start_122754 = start;
        end_122755 = end;
        
        int64_t n_122756 = end_122755 - start_122754;
        
        for (int64_t SegMap_i_122757 = start_122754; SegMap_i_122757 < start_122754 + n_122756; SegMap_i_122757++) {
            int64_t slice_122758 = m_33388;
            int64_t gtid_118355 = SegMap_i_122757;
            int64_t remnant_122759 = SegMap_i_122757 - gtid_118355;
            double defunc_0_reduce_res_118356;
            double redout_122750 = INFINITY;
            
            for (int64_t i_122749 = 0; i_122749 < m_33388; i_122749++) {
                double eta_p_122751 = ((double *) mem_111795.mem)[i_122749 * m_33388 + gtid_118355];
                double zm_res_122752 = safe_for_exp_33395 - eta_p_122751;
                double min_res_122753 = fmin64(zm_res_122752, redout_122750);
                double redout_tmp_122760 = min_res_122753;
                
                redout_122750 = redout_tmp_122760;
            }
            defunc_0_reduce_res_118356 = redout_122750;
            ((double *) mem_111799.mem)[gtid_118355] = defunc_0_reduce_res_118356;
        }
    }
    
  cleanup:
    { }
    if (event_127681 != NULL) {
        event_127681->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127680", strdup("nothing further"), event_127681, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_task_127678(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127677 *futhark_mc_task_127677 = (struct futhark_mc_task_127677 *) args;
    struct futhark_context *ctx = futhark_mc_task_127677->ctx;
    struct mc_event *event_127683 = mc_event_new(ctx);
    
    if (event_127683 != NULL)
        event_127683->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127677->free_m_33388;
    double safe_for_exp_33395 = futhark_mc_task_127677->free_safe_for_exp_33395;
    struct memblock mem_111795 = {.desc ="mem_111795", .mem =futhark_mc_task_127677->free_mem_111795, .size =0, .references =NULL};
    struct memblock mem_111799 = {.desc ="mem_111799", .mem =futhark_mc_task_127677->free_mem_111799, .size =0, .references =NULL};
    int32_t nsubtasks_122748;
    
    nsubtasks_122748 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_127679 futhark_mc_segmap_parloop_struct_127679_;
    
    futhark_mc_segmap_parloop_struct_127679_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_127679_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_127679_.free_safe_for_exp_33395 = safe_for_exp_33395;
    futhark_mc_segmap_parloop_struct_127679_.free_mem_111795 = mem_111795.mem;
    futhark_mc_segmap_parloop_struct_127679_.free_mem_111799 = mem_111799.mem;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_127680_task;
    
    futhark_mc_segmap_parloop_127680_task.name = "futhark_mc_segmap_parloop_127680";
    futhark_mc_segmap_parloop_127680_task.fn = futhark_mc_segmap_parloop_127680;
    futhark_mc_segmap_parloop_127680_task.args = &futhark_mc_segmap_parloop_struct_127679_;
    futhark_mc_segmap_parloop_127680_task.iterations = iterations;
    futhark_mc_segmap_parloop_127680_task.info = info;
    
    struct mc_event *event_127682 = mc_event_new(ctx);
    
    if (event_127682 != NULL)
        event_127682->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_127680_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_127680_task);
    
    if (futhark_mc_segmap_parloop_127680_err != 0) {
        err = futhark_mc_segmap_parloop_127680_err;
        goto cleanup;
    }
    if (event_127682 != NULL) {
        event_127682->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127680_total", strdup("nothing further"), event_127682, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_127683 != NULL) {
        event_127683->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_task_127678", strdup("nothing further"), event_127683, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_segmap_parloop_struct_127685 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_safe_for_exp_33395;
    unsigned char *free_mem_111795;
    unsigned char *free_mem_111799;
};
struct futhark_mc_task_127687 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_safe_for_exp_33395;
    unsigned char *free_mem_111795;
    int64_t free_gtid_118345;
    int64_t free_flat_tid_122762;
    double *retval_defunc_0_reduce_res_118346;
};
struct futhark_mc_segred_stage_1_parloop_struct_127690 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_safe_for_exp_33395;
    unsigned char *free_mem_111795;
    int64_t free_gtid_118345;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122776;
};
static int futhark_mc_segred_stage_1_parloop_127691(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127690 *futhark_mc_segred_stage_1_parloop_struct_127690 = (struct futhark_mc_segred_stage_1_parloop_struct_127690 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127690->ctx;
    struct mc_event *event_127692 = mc_event_new(ctx);
    
    if (event_127692 != NULL)
        event_127692->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127690->free_m_33388;
    double safe_for_exp_33395 = futhark_mc_segred_stage_1_parloop_struct_127690->free_safe_for_exp_33395;
    struct memblock mem_111795 = {.desc ="mem_111795", .mem =futhark_mc_segred_stage_1_parloop_struct_127690->free_mem_111795, .size =0, .references =NULL};
    int64_t gtid_118345 = futhark_mc_segred_stage_1_parloop_struct_127690->free_gtid_118345;
    struct memblock reduce_stage_1_tid_res_arr_mem_122776 = {.desc ="reduce_stage_1_tid_res_arr_mem_122776", .mem =futhark_mc_segred_stage_1_parloop_struct_127690->free_reduce_stage_1_tid_res_arr_mem_122776, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_122762;
    
    flat_tid_122762 = subtask_id;
    {
        double eta_p_122778;
        double eta_p_122779;
        double local_acc_122781 = INFINITY;
        double eta_p_122764;
        double eta_p_122765;
        double local_acc_122782 = INFINITY;
        int64_t start_122783;
        int64_t end_122784;
        
        start_122783 = start;
        end_122784 = end;
        
        int64_t n_122785 = end_122784 - start_122783;
        
        for (int64_t SegRed_i_122786 = start_122783; SegRed_i_122786 < start_122783 + n_122785; SegRed_i_122786++) {
            int64_t gtid_122763 = SegRed_i_122786;
            double eta_p_122767 = ((double *) mem_111795.mem)[gtid_122763 * m_33388 + gtid_118345];
            double zm_res_122768 = safe_for_exp_33395 - eta_p_122767;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_122764 = local_acc_122782;
            }
            // Load next params
            {
                eta_p_122765 = zm_res_122768;
            }
            // SegRed body
            {
                double min_res_122766 = fmin64(eta_p_122764, eta_p_122765);
                
                local_acc_122782 = min_res_122766;
            }
        }
        
        int64_t uni_i_122787 = 0;
        
        {
            int64_t gtid_122763 = uni_i_122787;
            
            // Load accum params
            {
                eta_p_122778 = local_acc_122781;
            }
            // Load next params
            {
                eta_p_122779 = local_acc_122782;
            }
            // SegRed body
            {
                double min_res_122780 = fmin64(eta_p_122778, eta_p_122779);
                
                local_acc_122781 = min_res_122780;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_122776.mem)[flat_tid_122762] = local_acc_122781;
    }
    
  cleanup:
    { }
    if (event_127692 != NULL) {
        event_127692->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127691", strdup("nothing further"), event_127692, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127688(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127687 *futhark_mc_task_127687 = (struct futhark_mc_task_127687 *) args;
    struct futhark_context *ctx = futhark_mc_task_127687->ctx;
    struct mc_event *event_127694 = mc_event_new(ctx);
    
    if (event_127694 != NULL)
        event_127694->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127687->free_m_33388;
    double safe_for_exp_33395 = futhark_mc_task_127687->free_safe_for_exp_33395;
    struct memblock mem_111795 = {.desc ="mem_111795", .mem =futhark_mc_task_127687->free_mem_111795, .size =0, .references =NULL};
    int64_t gtid_118345 = futhark_mc_task_127687->free_gtid_118345;
    int64_t flat_tid_122762 = futhark_mc_task_127687->free_flat_tid_122762;
    double defunc_0_reduce_res_118346 = *futhark_mc_task_127687->retval_defunc_0_reduce_res_118346;
    int64_t reduce_stage_1_tid_res_arr_mem_122776_cached_sizze_127689 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122776 = NULL;
    int32_t nsubtasks_122775;
    
    nsubtasks_122775 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_122776_cached_sizze_127689 < (int64_t) 8 * nsubtasks_122775) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122776, &reduce_stage_1_tid_res_arr_mem_122776_cached_sizze_127689, (int64_t) 8 * nsubtasks_122775);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127690 futhark_mc_segred_stage_1_parloop_struct_127690_;
    
    futhark_mc_segred_stage_1_parloop_struct_127690_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127690_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127690_.free_safe_for_exp_33395 = safe_for_exp_33395;
    futhark_mc_segred_stage_1_parloop_struct_127690_.free_mem_111795 = mem_111795.mem;
    futhark_mc_segred_stage_1_parloop_struct_127690_.free_gtid_118345 = gtid_118345;
    futhark_mc_segred_stage_1_parloop_struct_127690_.free_reduce_stage_1_tid_res_arr_mem_122776 = reduce_stage_1_tid_res_arr_mem_122776;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127691_task;
    
    futhark_mc_segred_stage_1_parloop_127691_task.name = "futhark_mc_segred_stage_1_parloop_127691";
    futhark_mc_segred_stage_1_parloop_127691_task.fn = futhark_mc_segred_stage_1_parloop_127691;
    futhark_mc_segred_stage_1_parloop_127691_task.args = &futhark_mc_segred_stage_1_parloop_struct_127690_;
    futhark_mc_segred_stage_1_parloop_127691_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127691_task.info = info;
    
    struct mc_event *event_127693 = mc_event_new(ctx);
    
    if (event_127693 != NULL)
        event_127693->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127691_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127691_task);
    
    if (futhark_mc_segred_stage_1_parloop_127691_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127691_err;
        goto cleanup;
    }
    if (event_127693 != NULL) {
        event_127693->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127691_total", strdup("nothing further"), event_127693, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_118346 = INFINITY;
    }
    
    double eta_p_122788;
    double eta_p_122789;
    
    for (int32_t i_122791 = 0; i_122791 < nsubtasks_122775; i_122791++) {
        flat_tid_122762 = i_122791;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_122788 = defunc_0_reduce_res_118346;
            }
            // load next params
            {
                eta_p_122789 = ((double *) reduce_stage_1_tid_res_arr_mem_122776)[flat_tid_122762];
            }
            // red body
            {
                double min_res_122790 = fmin64(eta_p_122788, eta_p_122789);
                
                defunc_0_reduce_res_118346 = min_res_122790;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_122776);
    }
    if (event_127694 != NULL) {
        event_127694->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127688", strdup("nothing further"), event_127694, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127687->retval_defunc_0_reduce_res_118346 = defunc_0_reduce_res_118346;
    }
    return err;
}
static int futhark_mc_segmap_parloop_127686(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_127685 *futhark_mc_segmap_parloop_struct_127685 = (struct futhark_mc_segmap_parloop_struct_127685 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_127685->ctx;
    struct mc_event *event_127695 = mc_event_new(ctx);
    
    if (event_127695 != NULL)
        event_127695->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_127685->free_m_33388;
    double safe_for_exp_33395 = futhark_mc_segmap_parloop_struct_127685->free_safe_for_exp_33395;
    struct memblock mem_111795 = {.desc ="mem_111795", .mem =futhark_mc_segmap_parloop_struct_127685->free_mem_111795, .size =0, .references =NULL};
    struct memblock mem_111799 = {.desc ="mem_111799", .mem =futhark_mc_segmap_parloop_struct_127685->free_mem_111799, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118344;
    
    flat_tid_118344 = subtask_id;
    {
        int64_t start_122769;
        int64_t end_122770;
        
        start_122769 = start;
        end_122770 = end;
        
        int64_t n_122771 = end_122770 - start_122769;
        
        for (int64_t SegMap_i_122772 = start_122769; SegMap_i_122772 < start_122769 + n_122771; SegMap_i_122772++) {
            int64_t slice_122773 = m_33388;
            int64_t gtid_118345 = SegMap_i_122772;
            int64_t remnant_122774 = SegMap_i_122772 - gtid_118345;
            double defunc_0_reduce_res_118346;
            int64_t flat_tid_122762 = (int64_t) 0;
            
            defunc_0_reduce_res_118346 = 0.0;
            
            struct futhark_mc_task_127687 futhark_mc_task_127687_;
            
            futhark_mc_task_127687_.ctx = ctx;
            futhark_mc_task_127687_.free_m_33388 = m_33388;
            futhark_mc_task_127687_.free_safe_for_exp_33395 = safe_for_exp_33395;
            futhark_mc_task_127687_.free_mem_111795 = mem_111795.mem;
            futhark_mc_task_127687_.free_gtid_118345 = gtid_118345;
            futhark_mc_task_127687_.free_flat_tid_122762 = flat_tid_122762;
            futhark_mc_task_127687_.retval_defunc_0_reduce_res_118346 = (double *) &defunc_0_reduce_res_118346;
            #if ISPC
            futhark_mc_task_127687_.retval_defunc_0_reduce_res_118346 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_127687_task;
            
            futhark_mc_task_127687_task.args = &futhark_mc_task_127687_;
            futhark_mc_task_127687_task.top_level_fn = futhark_mc_segred_task_127688;
            futhark_mc_task_127687_task.name = "futhark_mc_segred_task_127688";
            futhark_mc_task_127687_task.iterations = m_33388;
            futhark_mc_task_127687_task.task_time = &ctx->program->futhark_mc_segred_task_127688_total_time;
            futhark_mc_task_127687_task.task_iter = &ctx->program->futhark_mc_segred_task_127688_total_iter;
            futhark_mc_task_127687_task.sched = STATIC;
            futhark_mc_task_127687_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_127688_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127687_task);
            
            if (futhark_mc_segred_task_127688_err != 0) {
                err = futhark_mc_segred_task_127688_err;
                goto cleanup;
            }
            ((double *) mem_111799.mem)[gtid_118345] = defunc_0_reduce_res_118346;
        }
    }
    
  cleanup:
    { }
    if (event_127695 != NULL) {
        event_127695->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127686", strdup("nothing further"), event_127695, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_nested_task_127684(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127677 *futhark_mc_task_127677 = (struct futhark_mc_task_127677 *) args;
    struct futhark_context *ctx = futhark_mc_task_127677->ctx;
    struct mc_event *event_127697 = mc_event_new(ctx);
    
    if (event_127697 != NULL)
        event_127697->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127677->free_m_33388;
    double safe_for_exp_33395 = futhark_mc_task_127677->free_safe_for_exp_33395;
    struct memblock mem_111795 = {.desc ="mem_111795", .mem =futhark_mc_task_127677->free_mem_111795, .size =0, .references =NULL};
    struct memblock mem_111799 = {.desc ="mem_111799", .mem =futhark_mc_task_127677->free_mem_111799, .size =0, .references =NULL};
    int32_t nsubtasks_122761;
    
    nsubtasks_122761 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_127685 futhark_mc_segmap_parloop_struct_127685_;
    
    futhark_mc_segmap_parloop_struct_127685_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_127685_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_127685_.free_safe_for_exp_33395 = safe_for_exp_33395;
    futhark_mc_segmap_parloop_struct_127685_.free_mem_111795 = mem_111795.mem;
    futhark_mc_segmap_parloop_struct_127685_.free_mem_111799 = mem_111799.mem;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_127686_task;
    
    futhark_mc_segmap_parloop_127686_task.name = "futhark_mc_segmap_parloop_127686";
    futhark_mc_segmap_parloop_127686_task.fn = futhark_mc_segmap_parloop_127686;
    futhark_mc_segmap_parloop_127686_task.args = &futhark_mc_segmap_parloop_struct_127685_;
    futhark_mc_segmap_parloop_127686_task.iterations = iterations;
    futhark_mc_segmap_parloop_127686_task.info = info;
    
    struct mc_event *event_127696 = mc_event_new(ctx);
    
    if (event_127696 != NULL)
        event_127696->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_127686_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_127686_task);
    
    if (futhark_mc_segmap_parloop_127686_err != 0) {
        err = futhark_mc_segmap_parloop_127686_err;
        goto cleanup;
    }
    if (event_127696 != NULL) {
        event_127696->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127686_total", strdup("nothing further"), event_127696, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_127697 != NULL) {
        event_127697->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_nested_task_127684", strdup("nothing further"), event_127697, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_127698 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_zs_res_44842;
    double free_zs_res_44844;
    int64_t free_eta_p_106382;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_111795;
    unsigned char *free_mem_111797;
    unsigned char *free_mem_111799;
    unsigned char *free_mem_111811;
    unsigned char *free_mem_111814;
};
struct futhark_mc_segmap_parloop_struct_127700 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_zs_res_44842;
    double free_zs_res_44844;
    int64_t free_eta_p_106382;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_111795;
    unsigned char *free_mem_111797;
    unsigned char *free_mem_111799;
    unsigned char *free_mem_111811;
    unsigned char *free_mem_111814;
};
static int futhark_mc_segmap_parloop_127701(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_127700 *futhark_mc_segmap_parloop_struct_127700 = (struct futhark_mc_segmap_parloop_struct_127700 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_127700->ctx;
    struct mc_event *event_127702 = mc_event_new(ctx);
    
    if (event_127702 != NULL)
        event_127702->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_127700->free_m_33388;
    double zs_res_44842 = futhark_mc_segmap_parloop_struct_127700->free_zs_res_44842;
    double zs_res_44844 = futhark_mc_segmap_parloop_struct_127700->free_zs_res_44844;
    int64_t eta_p_106382 = futhark_mc_segmap_parloop_struct_127700->free_eta_p_106382;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segmap_parloop_struct_127700->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_111795 = {.desc ="mem_111795", .mem =futhark_mc_segmap_parloop_struct_127700->free_mem_111795, .size =0, .references =NULL};
    struct memblock mem_111797 = {.desc ="mem_111797", .mem =futhark_mc_segmap_parloop_struct_127700->free_mem_111797, .size =0, .references =NULL};
    struct memblock mem_111799 = {.desc ="mem_111799", .mem =futhark_mc_segmap_parloop_struct_127700->free_mem_111799, .size =0, .references =NULL};
    struct memblock mem_111811 = {.desc ="mem_111811", .mem =futhark_mc_segmap_parloop_struct_127700->free_mem_111811, .size =0, .references =NULL};
    struct memblock mem_111814 = {.desc ="mem_111814", .mem =futhark_mc_segmap_parloop_struct_127700->free_mem_111814, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118382;
    
    flat_tid_118382 = subtask_id;
    {
        int64_t start_122802;
        int64_t end_122803;
        
        start_122802 = start;
        end_122803 = end;
        
        int64_t n_122804 = end_122803 - start_122802;
        
        for (int64_t SegMap_i_122805 = start_122802; SegMap_i_122805 < start_122802 + n_122804; SegMap_i_122805++) {
            int64_t slice_122806 = m_33388;
            int64_t gtid_118383 = SegMap_i_122805;
            int64_t remnant_122807 = SegMap_i_122805 - gtid_118383;
            double eta_p_118384 = ((double *) distrs_mem_111708.mem)[eta_p_106382 * m_33388 + gtid_118383];
            double eta_p_118385 = ((double *) mem_111797.mem)[gtid_118383];
            double defunc_0_reduce_res_118387;
            double redout_122794 = 0.0;
            
            for (int64_t i_122793 = 0; i_122793 < m_33388; i_122793++) {
                double eta_p_122796 = ((double *) mem_111795.mem)[gtid_118383 * m_33388 + i_122793];
                double eta_p_wasfree_122797 = ((double *) mem_111799.mem)[i_122793];
                double zp_res_122798 = eta_p_122796 + eta_p_wasfree_122797;
                double exp_res_122799 = futrts_exp64(zp_res_122798);
                double zp_res_122800 = exp_res_122799 + redout_122794;
                
                ((double *) mem_111814.mem)[gtid_118383 * m_33388 + i_122793] = exp_res_122799;
                
                double redout_tmp_122808 = zp_res_122800;
                
                redout_122794 = redout_tmp_122808;
            }
            defunc_0_reduce_res_118387 = redout_122794;
            
            double zs_res_118398 = defunc_0_reduce_res_118387 / eta_p_118384;
            double ztzt_res_118399 = fpow64(zs_res_118398, zs_res_44842);
            double zt_res_118400 = zs_res_44844 * eta_p_118385;
            double exp_res_118401 = futrts_exp64(zt_res_118400);
            double zt_res_118402 = ztzt_res_118399 * exp_res_118401;
            
            ((double *) mem_111811.mem)[gtid_118383] = zt_res_118402;
        }
    }
    
  cleanup:
    { }
    if (event_127702 != NULL) {
        event_127702->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127701", strdup("nothing further"), event_127702, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_task_127699(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127698 *futhark_mc_task_127698 = (struct futhark_mc_task_127698 *) args;
    struct futhark_context *ctx = futhark_mc_task_127698->ctx;
    struct mc_event *event_127704 = mc_event_new(ctx);
    
    if (event_127704 != NULL)
        event_127704->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127698->free_m_33388;
    double zs_res_44842 = futhark_mc_task_127698->free_zs_res_44842;
    double zs_res_44844 = futhark_mc_task_127698->free_zs_res_44844;
    int64_t eta_p_106382 = futhark_mc_task_127698->free_eta_p_106382;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_127698->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_111795 = {.desc ="mem_111795", .mem =futhark_mc_task_127698->free_mem_111795, .size =0, .references =NULL};
    struct memblock mem_111797 = {.desc ="mem_111797", .mem =futhark_mc_task_127698->free_mem_111797, .size =0, .references =NULL};
    struct memblock mem_111799 = {.desc ="mem_111799", .mem =futhark_mc_task_127698->free_mem_111799, .size =0, .references =NULL};
    struct memblock mem_111811 = {.desc ="mem_111811", .mem =futhark_mc_task_127698->free_mem_111811, .size =0, .references =NULL};
    struct memblock mem_111814 = {.desc ="mem_111814", .mem =futhark_mc_task_127698->free_mem_111814, .size =0, .references =NULL};
    int32_t nsubtasks_122792;
    
    nsubtasks_122792 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_127700 futhark_mc_segmap_parloop_struct_127700_;
    
    futhark_mc_segmap_parloop_struct_127700_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_127700_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_127700_.free_zs_res_44842 = zs_res_44842;
    futhark_mc_segmap_parloop_struct_127700_.free_zs_res_44844 = zs_res_44844;
    futhark_mc_segmap_parloop_struct_127700_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segmap_parloop_struct_127700_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segmap_parloop_struct_127700_.free_mem_111795 = mem_111795.mem;
    futhark_mc_segmap_parloop_struct_127700_.free_mem_111797 = mem_111797.mem;
    futhark_mc_segmap_parloop_struct_127700_.free_mem_111799 = mem_111799.mem;
    futhark_mc_segmap_parloop_struct_127700_.free_mem_111811 = mem_111811.mem;
    futhark_mc_segmap_parloop_struct_127700_.free_mem_111814 = mem_111814.mem;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_127701_task;
    
    futhark_mc_segmap_parloop_127701_task.name = "futhark_mc_segmap_parloop_127701";
    futhark_mc_segmap_parloop_127701_task.fn = futhark_mc_segmap_parloop_127701;
    futhark_mc_segmap_parloop_127701_task.args = &futhark_mc_segmap_parloop_struct_127700_;
    futhark_mc_segmap_parloop_127701_task.iterations = iterations;
    futhark_mc_segmap_parloop_127701_task.info = info;
    
    struct mc_event *event_127703 = mc_event_new(ctx);
    
    if (event_127703 != NULL)
        event_127703->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_127701_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_127701_task);
    
    if (futhark_mc_segmap_parloop_127701_err != 0) {
        err = futhark_mc_segmap_parloop_127701_err;
        goto cleanup;
    }
    if (event_127703 != NULL) {
        event_127703->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127701_total", strdup("nothing further"), event_127703, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_127704 != NULL) {
        event_127704->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_task_127699", strdup("nothing further"), event_127704, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_segmap_parloop_struct_127706 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_zs_res_44842;
    double free_zs_res_44844;
    int64_t free_eta_p_106382;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_111795;
    unsigned char *free_mem_111797;
    unsigned char *free_mem_111799;
    unsigned char *free_mem_111811;
    unsigned char *free_mem_111814;
};
struct futhark_mc_task_127708 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_111795;
    unsigned char *free_mem_111799;
    int64_t free_gtid_118363;
    int64_t free_flat_tid_122811;
    double *retval_defunc_0_reduce_res_118366;
    unsigned char *retval_mem_111814;
};
struct futhark_mc_segred_stage_1_parloop_struct_127711 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_111795;
    unsigned char *free_mem_111799;
    unsigned char *free_mem_111814;
    int64_t free_gtid_118363;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122827;
};
static int futhark_mc_segred_stage_1_parloop_127712(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127711 *futhark_mc_segred_stage_1_parloop_struct_127711 = (struct futhark_mc_segred_stage_1_parloop_struct_127711 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127711->ctx;
    struct mc_event *event_127713 = mc_event_new(ctx);
    
    if (event_127713 != NULL)
        event_127713->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127711->free_m_33388;
    struct memblock mem_111795 = {.desc ="mem_111795", .mem =futhark_mc_segred_stage_1_parloop_struct_127711->free_mem_111795, .size =0, .references =NULL};
    struct memblock mem_111799 = {.desc ="mem_111799", .mem =futhark_mc_segred_stage_1_parloop_struct_127711->free_mem_111799, .size =0, .references =NULL};
    struct memblock mem_111814 = {.desc ="mem_111814", .mem =futhark_mc_segred_stage_1_parloop_struct_127711->free_mem_111814, .size =0, .references =NULL};
    int64_t gtid_118363 = futhark_mc_segred_stage_1_parloop_struct_127711->free_gtid_118363;
    struct memblock reduce_stage_1_tid_res_arr_mem_122827 = {.desc ="reduce_stage_1_tid_res_arr_mem_122827", .mem =futhark_mc_segred_stage_1_parloop_struct_127711->free_reduce_stage_1_tid_res_arr_mem_122827, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_122811;
    
    flat_tid_122811 = subtask_id;
    {
        double eta_p_122829;
        double eta_p_122830;
        double local_acc_122832 = 0.0;
        double eta_p_122813;
        double eta_p_122814;
        double local_acc_122833 = 0.0;
        int64_t start_122834;
        int64_t end_122835;
        
        start_122834 = start;
        end_122835 = end;
        
        int64_t n_122836 = end_122835 - start_122834;
        
        for (int64_t SegRed_i_122837 = start_122834; SegRed_i_122837 < start_122834 + n_122836; SegRed_i_122837++) {
            int64_t gtid_122812 = SegRed_i_122837;
            double eta_p_122816 = ((double *) mem_111795.mem)[gtid_118363 * m_33388 + gtid_122812];
            double eta_p_wasfree_122817 = ((double *) mem_111799.mem)[gtid_122812];
            double zp_res_122818 = eta_p_122816 + eta_p_wasfree_122817;
            double exp_res_122819 = futrts_exp64(zp_res_122818);
            
            // save map-out results
            {
                ((double *) mem_111814.mem)[gtid_118363 * m_33388 + gtid_122812] = exp_res_122819;
            }
            // Load accum params
            {
                eta_p_122813 = local_acc_122833;
            }
            // Load next params
            {
                eta_p_122814 = exp_res_122819;
            }
            // SegRed body
            {
                double zp_res_122815 = eta_p_122813 + eta_p_122814;
                
                local_acc_122833 = zp_res_122815;
            }
        }
        
        int64_t uni_i_122838 = 0;
        
        {
            int64_t gtid_122812 = uni_i_122838;
            
            // Load accum params
            {
                eta_p_122829 = local_acc_122832;
            }
            // Load next params
            {
                eta_p_122830 = local_acc_122833;
            }
            // SegRed body
            {
                double zp_res_122831 = eta_p_122829 + eta_p_122830;
                
                local_acc_122832 = zp_res_122831;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_122827.mem)[flat_tid_122811] = local_acc_122832;
    }
    
  cleanup:
    { }
    if (event_127713 != NULL) {
        event_127713->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127712", strdup("nothing further"), event_127713, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127709(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127708 *futhark_mc_task_127708 = (struct futhark_mc_task_127708 *) args;
    struct futhark_context *ctx = futhark_mc_task_127708->ctx;
    struct mc_event *event_127715 = mc_event_new(ctx);
    
    if (event_127715 != NULL)
        event_127715->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127708->free_m_33388;
    struct memblock mem_111795 = {.desc ="mem_111795", .mem =futhark_mc_task_127708->free_mem_111795, .size =0, .references =NULL};
    struct memblock mem_111799 = {.desc ="mem_111799", .mem =futhark_mc_task_127708->free_mem_111799, .size =0, .references =NULL};
    int64_t gtid_118363 = futhark_mc_task_127708->free_gtid_118363;
    int64_t flat_tid_122811 = futhark_mc_task_127708->free_flat_tid_122811;
    double defunc_0_reduce_res_118366 = *futhark_mc_task_127708->retval_defunc_0_reduce_res_118366;
    struct memblock mem_111814 = {.desc ="mem_111814", .mem =futhark_mc_task_127708->retval_mem_111814, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_122827_cached_sizze_127710 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122827 = NULL;
    int32_t nsubtasks_122826;
    
    nsubtasks_122826 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_122827_cached_sizze_127710 < (int64_t) 8 * nsubtasks_122826) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122827, &reduce_stage_1_tid_res_arr_mem_122827_cached_sizze_127710, (int64_t) 8 * nsubtasks_122826);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127711 futhark_mc_segred_stage_1_parloop_struct_127711_;
    
    futhark_mc_segred_stage_1_parloop_struct_127711_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127711_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127711_.free_mem_111795 = mem_111795.mem;
    futhark_mc_segred_stage_1_parloop_struct_127711_.free_mem_111799 = mem_111799.mem;
    futhark_mc_segred_stage_1_parloop_struct_127711_.free_mem_111814 = mem_111814.mem;
    futhark_mc_segred_stage_1_parloop_struct_127711_.free_gtid_118363 = gtid_118363;
    futhark_mc_segred_stage_1_parloop_struct_127711_.free_reduce_stage_1_tid_res_arr_mem_122827 = reduce_stage_1_tid_res_arr_mem_122827;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127712_task;
    
    futhark_mc_segred_stage_1_parloop_127712_task.name = "futhark_mc_segred_stage_1_parloop_127712";
    futhark_mc_segred_stage_1_parloop_127712_task.fn = futhark_mc_segred_stage_1_parloop_127712;
    futhark_mc_segred_stage_1_parloop_127712_task.args = &futhark_mc_segred_stage_1_parloop_struct_127711_;
    futhark_mc_segred_stage_1_parloop_127712_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127712_task.info = info;
    
    struct mc_event *event_127714 = mc_event_new(ctx);
    
    if (event_127714 != NULL)
        event_127714->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127712_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127712_task);
    
    if (futhark_mc_segred_stage_1_parloop_127712_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127712_err;
        goto cleanup;
    }
    if (event_127714 != NULL) {
        event_127714->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127712_total", strdup("nothing further"), event_127714, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_118366 = 0.0;
    }
    
    double eta_p_122839;
    double eta_p_122840;
    
    for (int32_t i_122842 = 0; i_122842 < nsubtasks_122826; i_122842++) {
        flat_tid_122811 = i_122842;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_122839 = defunc_0_reduce_res_118366;
            }
            // load next params
            {
                eta_p_122840 = ((double *) reduce_stage_1_tid_res_arr_mem_122827)[flat_tid_122811];
            }
            // red body
            {
                double zp_res_122841 = eta_p_122839 + eta_p_122840;
                
                defunc_0_reduce_res_118366 = zp_res_122841;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_122827);
    }
    if (event_127715 != NULL) {
        event_127715->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127709", strdup("nothing further"), event_127715, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127708->retval_defunc_0_reduce_res_118366 = defunc_0_reduce_res_118366;
        futhark_mc_task_127708->retval_mem_111814 = mem_111814.mem;
    }
    return err;
}
static int futhark_mc_segmap_parloop_127707(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_127706 *futhark_mc_segmap_parloop_struct_127706 = (struct futhark_mc_segmap_parloop_struct_127706 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_127706->ctx;
    struct mc_event *event_127716 = mc_event_new(ctx);
    
    if (event_127716 != NULL)
        event_127716->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_127706->free_m_33388;
    double zs_res_44842 = futhark_mc_segmap_parloop_struct_127706->free_zs_res_44842;
    double zs_res_44844 = futhark_mc_segmap_parloop_struct_127706->free_zs_res_44844;
    int64_t eta_p_106382 = futhark_mc_segmap_parloop_struct_127706->free_eta_p_106382;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segmap_parloop_struct_127706->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_111795 = {.desc ="mem_111795", .mem =futhark_mc_segmap_parloop_struct_127706->free_mem_111795, .size =0, .references =NULL};
    struct memblock mem_111797 = {.desc ="mem_111797", .mem =futhark_mc_segmap_parloop_struct_127706->free_mem_111797, .size =0, .references =NULL};
    struct memblock mem_111799 = {.desc ="mem_111799", .mem =futhark_mc_segmap_parloop_struct_127706->free_mem_111799, .size =0, .references =NULL};
    struct memblock mem_111811 = {.desc ="mem_111811", .mem =futhark_mc_segmap_parloop_struct_127706->free_mem_111811, .size =0, .references =NULL};
    struct memblock mem_111814 = {.desc ="mem_111814", .mem =futhark_mc_segmap_parloop_struct_127706->free_mem_111814, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118362;
    
    flat_tid_118362 = subtask_id;
    {
        int64_t start_122820;
        int64_t end_122821;
        
        start_122820 = start;
        end_122821 = end;
        
        int64_t n_122822 = end_122821 - start_122820;
        
        for (int64_t SegMap_i_122823 = start_122820; SegMap_i_122823 < start_122820 + n_122822; SegMap_i_122823++) {
            int64_t slice_122824 = m_33388;
            int64_t gtid_118363 = SegMap_i_122823;
            int64_t remnant_122825 = SegMap_i_122823 - gtid_118363;
            double eta_p_118364 = ((double *) distrs_mem_111708.mem)[eta_p_106382 * m_33388 + gtid_118363];
            double eta_p_118365 = ((double *) mem_111797.mem)[gtid_118363];
            double defunc_0_reduce_res_118366;
            int64_t flat_tid_122811 = (int64_t) 0;
            
            defunc_0_reduce_res_118366 = 0.0;
            
            struct futhark_mc_task_127708 futhark_mc_task_127708_;
            
            futhark_mc_task_127708_.ctx = ctx;
            futhark_mc_task_127708_.free_m_33388 = m_33388;
            futhark_mc_task_127708_.free_mem_111795 = mem_111795.mem;
            futhark_mc_task_127708_.free_mem_111799 = mem_111799.mem;
            futhark_mc_task_127708_.free_gtid_118363 = gtid_118363;
            futhark_mc_task_127708_.free_flat_tid_122811 = flat_tid_122811;
            futhark_mc_task_127708_.retval_defunc_0_reduce_res_118366 = (double *) &defunc_0_reduce_res_118366;
            #if ISPC
            futhark_mc_task_127708_.retval_defunc_0_reduce_res_118366 += programIndex;
            #endif
            futhark_mc_task_127708_.retval_mem_111814 = mem_111814.mem;
            
            struct scheduler_segop futhark_mc_task_127708_task;
            
            futhark_mc_task_127708_task.args = &futhark_mc_task_127708_;
            futhark_mc_task_127708_task.top_level_fn = futhark_mc_segred_task_127709;
            futhark_mc_task_127708_task.name = "futhark_mc_segred_task_127709";
            futhark_mc_task_127708_task.iterations = m_33388;
            futhark_mc_task_127708_task.task_time = &ctx->program->futhark_mc_segred_task_127709_total_time;
            futhark_mc_task_127708_task.task_iter = &ctx->program->futhark_mc_segred_task_127709_total_iter;
            futhark_mc_task_127708_task.sched = STATIC;
            futhark_mc_task_127708_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_127709_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127708_task);
            
            if (futhark_mc_segred_task_127709_err != 0) {
                err = futhark_mc_segred_task_127709_err;
                goto cleanup;
            }
            
            double zs_res_118377 = defunc_0_reduce_res_118366 / eta_p_118364;
            double ztzt_res_118378 = fpow64(zs_res_118377, zs_res_44842);
            double zt_res_118379 = zs_res_44844 * eta_p_118365;
            double exp_res_118380 = futrts_exp64(zt_res_118379);
            double zt_res_118381 = ztzt_res_118378 * exp_res_118380;
            
            ((double *) mem_111811.mem)[gtid_118363] = zt_res_118381;
        }
    }
    
  cleanup:
    { }
    if (event_127716 != NULL) {
        event_127716->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127707", strdup("nothing further"), event_127716, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_nested_task_127705(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127698 *futhark_mc_task_127698 = (struct futhark_mc_task_127698 *) args;
    struct futhark_context *ctx = futhark_mc_task_127698->ctx;
    struct mc_event *event_127718 = mc_event_new(ctx);
    
    if (event_127718 != NULL)
        event_127718->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127698->free_m_33388;
    double zs_res_44842 = futhark_mc_task_127698->free_zs_res_44842;
    double zs_res_44844 = futhark_mc_task_127698->free_zs_res_44844;
    int64_t eta_p_106382 = futhark_mc_task_127698->free_eta_p_106382;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_127698->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_111795 = {.desc ="mem_111795", .mem =futhark_mc_task_127698->free_mem_111795, .size =0, .references =NULL};
    struct memblock mem_111797 = {.desc ="mem_111797", .mem =futhark_mc_task_127698->free_mem_111797, .size =0, .references =NULL};
    struct memblock mem_111799 = {.desc ="mem_111799", .mem =futhark_mc_task_127698->free_mem_111799, .size =0, .references =NULL};
    struct memblock mem_111811 = {.desc ="mem_111811", .mem =futhark_mc_task_127698->free_mem_111811, .size =0, .references =NULL};
    struct memblock mem_111814 = {.desc ="mem_111814", .mem =futhark_mc_task_127698->free_mem_111814, .size =0, .references =NULL};
    int32_t nsubtasks_122810;
    
    nsubtasks_122810 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_127706 futhark_mc_segmap_parloop_struct_127706_;
    
    futhark_mc_segmap_parloop_struct_127706_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_127706_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_127706_.free_zs_res_44842 = zs_res_44842;
    futhark_mc_segmap_parloop_struct_127706_.free_zs_res_44844 = zs_res_44844;
    futhark_mc_segmap_parloop_struct_127706_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segmap_parloop_struct_127706_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segmap_parloop_struct_127706_.free_mem_111795 = mem_111795.mem;
    futhark_mc_segmap_parloop_struct_127706_.free_mem_111797 = mem_111797.mem;
    futhark_mc_segmap_parloop_struct_127706_.free_mem_111799 = mem_111799.mem;
    futhark_mc_segmap_parloop_struct_127706_.free_mem_111811 = mem_111811.mem;
    futhark_mc_segmap_parloop_struct_127706_.free_mem_111814 = mem_111814.mem;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_127707_task;
    
    futhark_mc_segmap_parloop_127707_task.name = "futhark_mc_segmap_parloop_127707";
    futhark_mc_segmap_parloop_127707_task.fn = futhark_mc_segmap_parloop_127707;
    futhark_mc_segmap_parloop_127707_task.args = &futhark_mc_segmap_parloop_struct_127706_;
    futhark_mc_segmap_parloop_127707_task.iterations = iterations;
    futhark_mc_segmap_parloop_127707_task.info = info;
    
    struct mc_event *event_127717 = mc_event_new(ctx);
    
    if (event_127717 != NULL)
        event_127717->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_127707_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_127707_task);
    
    if (futhark_mc_segmap_parloop_127707_err != 0) {
        err = futhark_mc_segmap_parloop_127707_err;
        goto cleanup;
    }
    if (event_127717 != NULL) {
        event_127717->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127707_total", strdup("nothing further"), event_127717, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_127718 != NULL) {
        event_127718->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_nested_task_127705", strdup("nothing further"), event_127718, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_127719 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_44883;
    double free_zs_res_44885;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_111799;
    unsigned char *free_mem_111811;
    unsigned char *free_mem_111814;
    int64_t free_flat_tid_118403;
    int64_t free_flat_tid_118425;
    bool *retval_defunc_0_reduce_res_107041;
    unsigned char *retval_mem_111816;
};
struct futhark_mc_segred_stage_1_parloop_struct_127722 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_44883;
    double free_zs_res_44885;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_111799;
    unsigned char *free_mem_111811;
    unsigned char *free_mem_111814;
    unsigned char *free_mem_111816;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122844;
};
static int futhark_mc_segred_stage_1_parloop_127723(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127722 *futhark_mc_segred_stage_1_parloop_struct_127722 = (struct futhark_mc_segred_stage_1_parloop_struct_127722 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127722->ctx;
    struct mc_event *event_127724 = mc_event_new(ctx);
    
    if (event_127724 != NULL)
        event_127724->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127722->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_segred_stage_1_parloop_struct_127722->free_exp_absorb_cutoff_33394;
    double zs_res_44883 = futhark_mc_segred_stage_1_parloop_struct_127722->free_zs_res_44883;
    double zs_res_44885 = futhark_mc_segred_stage_1_parloop_struct_127722->free_zs_res_44885;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_127722->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_127722->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_111799 = {.desc ="mem_111799", .mem =futhark_mc_segred_stage_1_parloop_struct_127722->free_mem_111799, .size =0, .references =NULL};
    struct memblock mem_111811 = {.desc ="mem_111811", .mem =futhark_mc_segred_stage_1_parloop_struct_127722->free_mem_111811, .size =0, .references =NULL};
    struct memblock mem_111814 = {.desc ="mem_111814", .mem =futhark_mc_segred_stage_1_parloop_struct_127722->free_mem_111814, .size =0, .references =NULL};
    struct memblock mem_111816 = {.desc ="mem_111816", .mem =futhark_mc_segred_stage_1_parloop_struct_127722->free_mem_111816, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122844 = {.desc ="reduce_stage_1_tid_res_arr_mem_122844", .mem =futhark_mc_segred_stage_1_parloop_struct_127722->free_reduce_stage_1_tid_res_arr_mem_122844, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118425;
    
    flat_tid_118425 = subtask_id;
    {
        bool eta_p_122846;
        bool eta_p_122847;
        bool local_acc_122849 = 0;
        bool eta_p_118427;
        bool eta_p_118428;
        bool local_acc_122850 = 0;
        int64_t start_122851;
        int64_t end_122852;
        
        start_122851 = start;
        end_122852 = end;
        
        int64_t n_122853 = end_122852 - start_122851;
        
        for (int64_t SegRed_i_122854 = start_122851; SegRed_i_122854 < start_122851 + n_122853; SegRed_i_122854++) {
            int64_t gtid_118426 = SegRed_i_122854;
            double eta_p_118430 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + gtid_118426];
            double eta_p_118431 = ((double *) mem_111799.mem)[gtid_118426];
            double defunc_0_reduce_res_118432;
            double redout_118434 = 0.0;
            
            for (int64_t i_118433 = 0; i_118433 < m_33388; i_118433++) {
                double eta_p_118435 = ((double *) mem_111811.mem)[i_118433];
                double eta_p_118436 = ((double *) mem_111814.mem)[i_118433 * m_33388 + gtid_118426];
                double zt_res_118437 = eta_p_118435 * eta_p_118436;
                double zp_res_118438 = zt_res_118437 + redout_118434;
                double redout_tmp_122855 = zp_res_118438;
                
                redout_118434 = redout_tmp_122855;
            }
            defunc_0_reduce_res_118432 = redout_118434;
            
            double zs_res_118439 = defunc_0_reduce_res_118432 / eta_p_118430;
            double ztzt_res_118440 = fpow64(zs_res_118439, zs_res_44883);
            double zt_res_118441 = zs_res_44885 * eta_p_118431;
            double exp_res_118442 = futrts_exp64(zt_res_118441);
            double zt_res_118443 = ztzt_res_118440 * exp_res_118442;
            bool zgze_res_118444 = exp_absorb_cutoff_33394 <= zt_res_118443;
            
            // save map-out results
            {
                ((double *) mem_111816.mem)[gtid_118426] = zt_res_118443;
            }
            // Load accum params
            {
                eta_p_118427 = local_acc_122850;
            }
            // Load next params
            {
                eta_p_118428 = zgze_res_118444;
            }
            // SegRed body
            {
                bool defunc_0_op_res_118429 = eta_p_118427 || eta_p_118428;
                
                local_acc_122850 = defunc_0_op_res_118429;
            }
        }
        
        int64_t uni_i_122856 = 0;
        
        {
            int64_t gtid_118426 = uni_i_122856;
            
            // Load accum params
            {
                eta_p_122846 = local_acc_122849;
            }
            // Load next params
            {
                eta_p_122847 = local_acc_122850;
            }
            // SegRed body
            {
                bool defunc_0_op_res_122848 = eta_p_122846 || eta_p_122847;
                
                local_acc_122849 = defunc_0_op_res_122848;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_122844.mem)[flat_tid_118425] = local_acc_122849;
    }
    
  cleanup:
    { }
    if (event_127724 != NULL) {
        event_127724->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127723", strdup("nothing further"), event_127724, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127720(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127719 *futhark_mc_task_127719 = (struct futhark_mc_task_127719 *) args;
    struct futhark_context *ctx = futhark_mc_task_127719->ctx;
    struct mc_event *event_127726 = mc_event_new(ctx);
    
    if (event_127726 != NULL)
        event_127726->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127719->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_task_127719->free_exp_absorb_cutoff_33394;
    double zs_res_44883 = futhark_mc_task_127719->free_zs_res_44883;
    double zs_res_44885 = futhark_mc_task_127719->free_zs_res_44885;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_127719->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_127719->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_111799 = {.desc ="mem_111799", .mem =futhark_mc_task_127719->free_mem_111799, .size =0, .references =NULL};
    struct memblock mem_111811 = {.desc ="mem_111811", .mem =futhark_mc_task_127719->free_mem_111811, .size =0, .references =NULL};
    struct memblock mem_111814 = {.desc ="mem_111814", .mem =futhark_mc_task_127719->free_mem_111814, .size =0, .references =NULL};
    int64_t flat_tid_118403 = futhark_mc_task_127719->free_flat_tid_118403;
    int64_t flat_tid_118425 = futhark_mc_task_127719->free_flat_tid_118425;
    bool defunc_0_reduce_res_107041 = *futhark_mc_task_127719->retval_defunc_0_reduce_res_107041;
    struct memblock mem_111816 = {.desc ="mem_111816", .mem =futhark_mc_task_127719->retval_mem_111816, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_122844_cached_sizze_127721 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122844 = NULL;
    int32_t nsubtasks_122843;
    
    nsubtasks_122843 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_122844_cached_sizze_127721 < nsubtasks_122843) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122844, &reduce_stage_1_tid_res_arr_mem_122844_cached_sizze_127721, nsubtasks_122843);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127722 futhark_mc_segred_stage_1_parloop_struct_127722_;
    
    futhark_mc_segred_stage_1_parloop_struct_127722_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127722_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127722_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segred_stage_1_parloop_struct_127722_.free_zs_res_44883 = zs_res_44883;
    futhark_mc_segred_stage_1_parloop_struct_127722_.free_zs_res_44885 = zs_res_44885;
    futhark_mc_segred_stage_1_parloop_struct_127722_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_127722_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_127722_.free_mem_111799 = mem_111799.mem;
    futhark_mc_segred_stage_1_parloop_struct_127722_.free_mem_111811 = mem_111811.mem;
    futhark_mc_segred_stage_1_parloop_struct_127722_.free_mem_111814 = mem_111814.mem;
    futhark_mc_segred_stage_1_parloop_struct_127722_.free_mem_111816 = mem_111816.mem;
    futhark_mc_segred_stage_1_parloop_struct_127722_.free_reduce_stage_1_tid_res_arr_mem_122844 = reduce_stage_1_tid_res_arr_mem_122844;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127723_task;
    
    futhark_mc_segred_stage_1_parloop_127723_task.name = "futhark_mc_segred_stage_1_parloop_127723";
    futhark_mc_segred_stage_1_parloop_127723_task.fn = futhark_mc_segred_stage_1_parloop_127723;
    futhark_mc_segred_stage_1_parloop_127723_task.args = &futhark_mc_segred_stage_1_parloop_struct_127722_;
    futhark_mc_segred_stage_1_parloop_127723_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127723_task.info = info;
    
    struct mc_event *event_127725 = mc_event_new(ctx);
    
    if (event_127725 != NULL)
        event_127725->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127723_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127723_task);
    
    if (futhark_mc_segred_stage_1_parloop_127723_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127723_err;
        goto cleanup;
    }
    if (event_127725 != NULL) {
        event_127725->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127723_total", strdup("nothing further"), event_127725, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_107041 = 0;
    }
    
    bool eta_p_122857;
    bool eta_p_122858;
    
    for (int32_t i_122860 = 0; i_122860 < nsubtasks_122843; i_122860++) {
        flat_tid_118425 = i_122860;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_122857 = defunc_0_reduce_res_107041;
            }
            // load next params
            {
                eta_p_122858 = ((bool *) reduce_stage_1_tid_res_arr_mem_122844)[flat_tid_118425];
            }
            // red body
            {
                bool defunc_0_op_res_122859 = eta_p_122857 || eta_p_122858;
                
                defunc_0_reduce_res_107041 = defunc_0_op_res_122859;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_122844);
    }
    if (event_127726 != NULL) {
        event_127726->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127720", strdup("nothing further"), event_127726, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127719->retval_defunc_0_reduce_res_107041 = defunc_0_reduce_res_107041;
        futhark_mc_task_127719->retval_mem_111816 = mem_111816.mem;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_127729 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_44883;
    double free_zs_res_44885;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_111799;
    unsigned char *free_mem_111811;
    unsigned char *free_mem_111814;
    unsigned char *free_mem_111816;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122862;
};
struct futhark_mc_task_127731 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_111811;
    unsigned char *free_mem_111814;
    int64_t free_gtid_118404;
    int64_t free_flat_tid_118411;
    double *retval_defunc_0_reduce_res_118410;
};
struct futhark_mc_segred_stage_1_parloop_struct_127734 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_111811;
    unsigned char *free_mem_111814;
    int64_t free_gtid_118404;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122874;
};
static int futhark_mc_segred_stage_1_parloop_127735(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127734 *futhark_mc_segred_stage_1_parloop_struct_127734 = (struct futhark_mc_segred_stage_1_parloop_struct_127734 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127734->ctx;
    struct mc_event *event_127736 = mc_event_new(ctx);
    
    if (event_127736 != NULL)
        event_127736->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127734->free_m_33388;
    struct memblock mem_111811 = {.desc ="mem_111811", .mem =futhark_mc_segred_stage_1_parloop_struct_127734->free_mem_111811, .size =0, .references =NULL};
    struct memblock mem_111814 = {.desc ="mem_111814", .mem =futhark_mc_segred_stage_1_parloop_struct_127734->free_mem_111814, .size =0, .references =NULL};
    int64_t gtid_118404 = futhark_mc_segred_stage_1_parloop_struct_127734->free_gtid_118404;
    struct memblock reduce_stage_1_tid_res_arr_mem_122874 = {.desc ="reduce_stage_1_tid_res_arr_mem_122874", .mem =futhark_mc_segred_stage_1_parloop_struct_127734->free_reduce_stage_1_tid_res_arr_mem_122874, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118411;
    
    flat_tid_118411 = subtask_id;
    {
        double eta_p_122876;
        double eta_p_122877;
        double local_acc_122879 = 0.0;
        double eta_p_118413;
        double eta_p_118414;
        double local_acc_122880 = 0.0;
        int64_t start_122881;
        int64_t end_122882;
        
        start_122881 = start;
        end_122882 = end;
        
        int64_t n_122883 = end_122882 - start_122881;
        
        for (int64_t SegRed_i_122884 = start_122881; SegRed_i_122884 < start_122881 + n_122883; SegRed_i_122884++) {
            int64_t gtid_118412 = SegRed_i_122884;
            double eta_p_118416 = ((double *) mem_111811.mem)[gtid_118412];
            double eta_p_118417 = ((double *) mem_111814.mem)[gtid_118412 * m_33388 + gtid_118404];
            double zt_res_118418 = eta_p_118416 * eta_p_118417;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_118413 = local_acc_122880;
            }
            // Load next params
            {
                eta_p_118414 = zt_res_118418;
            }
            // SegRed body
            {
                double zp_res_118415 = eta_p_118413 + eta_p_118414;
                
                local_acc_122880 = zp_res_118415;
            }
        }
        
        int64_t uni_i_122885 = 0;
        
        {
            int64_t gtid_118412 = uni_i_122885;
            
            // Load accum params
            {
                eta_p_122876 = local_acc_122879;
            }
            // Load next params
            {
                eta_p_122877 = local_acc_122880;
            }
            // SegRed body
            {
                double zp_res_122878 = eta_p_122876 + eta_p_122877;
                
                local_acc_122879 = zp_res_122878;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_122874.mem)[flat_tid_118411] = local_acc_122879;
    }
    
  cleanup:
    { }
    if (event_127736 != NULL) {
        event_127736->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127735", strdup("nothing further"), event_127736, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127732(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127731 *futhark_mc_task_127731 = (struct futhark_mc_task_127731 *) args;
    struct futhark_context *ctx = futhark_mc_task_127731->ctx;
    struct mc_event *event_127738 = mc_event_new(ctx);
    
    if (event_127738 != NULL)
        event_127738->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127731->free_m_33388;
    struct memblock mem_111811 = {.desc ="mem_111811", .mem =futhark_mc_task_127731->free_mem_111811, .size =0, .references =NULL};
    struct memblock mem_111814 = {.desc ="mem_111814", .mem =futhark_mc_task_127731->free_mem_111814, .size =0, .references =NULL};
    int64_t gtid_118404 = futhark_mc_task_127731->free_gtid_118404;
    int64_t flat_tid_118411 = futhark_mc_task_127731->free_flat_tid_118411;
    double defunc_0_reduce_res_118410 = *futhark_mc_task_127731->retval_defunc_0_reduce_res_118410;
    int64_t reduce_stage_1_tid_res_arr_mem_122874_cached_sizze_127733 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122874 = NULL;
    int32_t nsubtasks_122873;
    
    nsubtasks_122873 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_122874_cached_sizze_127733 < (int64_t) 8 * nsubtasks_122873) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122874, &reduce_stage_1_tid_res_arr_mem_122874_cached_sizze_127733, (int64_t) 8 * nsubtasks_122873);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127734 futhark_mc_segred_stage_1_parloop_struct_127734_;
    
    futhark_mc_segred_stage_1_parloop_struct_127734_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127734_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127734_.free_mem_111811 = mem_111811.mem;
    futhark_mc_segred_stage_1_parloop_struct_127734_.free_mem_111814 = mem_111814.mem;
    futhark_mc_segred_stage_1_parloop_struct_127734_.free_gtid_118404 = gtid_118404;
    futhark_mc_segred_stage_1_parloop_struct_127734_.free_reduce_stage_1_tid_res_arr_mem_122874 = reduce_stage_1_tid_res_arr_mem_122874;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127735_task;
    
    futhark_mc_segred_stage_1_parloop_127735_task.name = "futhark_mc_segred_stage_1_parloop_127735";
    futhark_mc_segred_stage_1_parloop_127735_task.fn = futhark_mc_segred_stage_1_parloop_127735;
    futhark_mc_segred_stage_1_parloop_127735_task.args = &futhark_mc_segred_stage_1_parloop_struct_127734_;
    futhark_mc_segred_stage_1_parloop_127735_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127735_task.info = info;
    
    struct mc_event *event_127737 = mc_event_new(ctx);
    
    if (event_127737 != NULL)
        event_127737->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127735_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127735_task);
    
    if (futhark_mc_segred_stage_1_parloop_127735_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127735_err;
        goto cleanup;
    }
    if (event_127737 != NULL) {
        event_127737->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127735_total", strdup("nothing further"), event_127737, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_118410 = 0.0;
    }
    
    double eta_p_122886;
    double eta_p_122887;
    
    for (int32_t i_122889 = 0; i_122889 < nsubtasks_122873; i_122889++) {
        flat_tid_118411 = i_122889;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_122886 = defunc_0_reduce_res_118410;
            }
            // load next params
            {
                eta_p_122887 = ((double *) reduce_stage_1_tid_res_arr_mem_122874)[flat_tid_118411];
            }
            // red body
            {
                double zp_res_122888 = eta_p_122886 + eta_p_122887;
                
                defunc_0_reduce_res_118410 = zp_res_122888;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_122874);
    }
    if (event_127738 != NULL) {
        event_127738->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127732", strdup("nothing further"), event_127738, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127731->retval_defunc_0_reduce_res_118410 = defunc_0_reduce_res_118410;
    }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_127730(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127729 *futhark_mc_segred_stage_1_parloop_struct_127729 = (struct futhark_mc_segred_stage_1_parloop_struct_127729 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127729->ctx;
    struct mc_event *event_127739 = mc_event_new(ctx);
    
    if (event_127739 != NULL)
        event_127739->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127729->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_segred_stage_1_parloop_struct_127729->free_exp_absorb_cutoff_33394;
    double zs_res_44883 = futhark_mc_segred_stage_1_parloop_struct_127729->free_zs_res_44883;
    double zs_res_44885 = futhark_mc_segred_stage_1_parloop_struct_127729->free_zs_res_44885;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_127729->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_127729->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_111799 = {.desc ="mem_111799", .mem =futhark_mc_segred_stage_1_parloop_struct_127729->free_mem_111799, .size =0, .references =NULL};
    struct memblock mem_111811 = {.desc ="mem_111811", .mem =futhark_mc_segred_stage_1_parloop_struct_127729->free_mem_111811, .size =0, .references =NULL};
    struct memblock mem_111814 = {.desc ="mem_111814", .mem =futhark_mc_segred_stage_1_parloop_struct_127729->free_mem_111814, .size =0, .references =NULL};
    struct memblock mem_111816 = {.desc ="mem_111816", .mem =futhark_mc_segred_stage_1_parloop_struct_127729->free_mem_111816, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122862 = {.desc ="reduce_stage_1_tid_res_arr_mem_122862", .mem =futhark_mc_segred_stage_1_parloop_struct_127729->free_reduce_stage_1_tid_res_arr_mem_122862, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118403;
    
    flat_tid_118403 = subtask_id;
    {
        bool eta_p_122864;
        bool eta_p_122865;
        bool local_acc_122867 = 0;
        bool eta_p_118405;
        bool eta_p_118406;
        bool local_acc_122868 = 0;
        int64_t start_122869;
        int64_t end_122870;
        
        start_122869 = start;
        end_122870 = end;
        
        int64_t n_122871 = end_122870 - start_122869;
        
        for (int64_t SegRed_i_122872 = start_122869; SegRed_i_122872 < start_122869 + n_122871; SegRed_i_122872++) {
            int64_t gtid_118404 = SegRed_i_122872;
            double eta_p_118408 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + gtid_118404];
            double eta_p_118409 = ((double *) mem_111799.mem)[gtid_118404];
            double defunc_0_reduce_res_118410;
            int64_t flat_tid_118411 = (int64_t) 0;
            
            defunc_0_reduce_res_118410 = 0.0;
            
            struct futhark_mc_task_127731 futhark_mc_task_127731_;
            
            futhark_mc_task_127731_.ctx = ctx;
            futhark_mc_task_127731_.free_m_33388 = m_33388;
            futhark_mc_task_127731_.free_mem_111811 = mem_111811.mem;
            futhark_mc_task_127731_.free_mem_111814 = mem_111814.mem;
            futhark_mc_task_127731_.free_gtid_118404 = gtid_118404;
            futhark_mc_task_127731_.free_flat_tid_118411 = flat_tid_118411;
            futhark_mc_task_127731_.retval_defunc_0_reduce_res_118410 = (double *) &defunc_0_reduce_res_118410;
            #if ISPC
            futhark_mc_task_127731_.retval_defunc_0_reduce_res_118410 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_127731_task;
            
            futhark_mc_task_127731_task.args = &futhark_mc_task_127731_;
            futhark_mc_task_127731_task.top_level_fn = futhark_mc_segred_task_127732;
            futhark_mc_task_127731_task.name = "futhark_mc_segred_task_127732";
            futhark_mc_task_127731_task.iterations = m_33388;
            futhark_mc_task_127731_task.task_time = &ctx->program->futhark_mc_segred_task_127732_total_time;
            futhark_mc_task_127731_task.task_iter = &ctx->program->futhark_mc_segred_task_127732_total_iter;
            futhark_mc_task_127731_task.sched = STATIC;
            futhark_mc_task_127731_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_127732_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127731_task);
            
            if (futhark_mc_segred_task_127732_err != 0) {
                err = futhark_mc_segred_task_127732_err;
                goto cleanup;
            }
            
            double zs_res_118419 = defunc_0_reduce_res_118410 / eta_p_118408;
            double ztzt_res_118420 = fpow64(zs_res_118419, zs_res_44883);
            double zt_res_118421 = zs_res_44885 * eta_p_118409;
            double exp_res_118422 = futrts_exp64(zt_res_118421);
            double zt_res_118423 = ztzt_res_118420 * exp_res_118422;
            bool zgze_res_118424 = exp_absorb_cutoff_33394 <= zt_res_118423;
            
            // save map-out results
            {
                ((double *) mem_111816.mem)[gtid_118404] = zt_res_118423;
            }
            // Load accum params
            {
                eta_p_118405 = local_acc_122868;
            }
            // Load next params
            {
                eta_p_118406 = zgze_res_118424;
            }
            // SegRed body
            {
                bool defunc_0_op_res_118407 = eta_p_118405 || eta_p_118406;
                
                local_acc_122868 = defunc_0_op_res_118407;
            }
        }
        
        int64_t uni_i_122890 = 0;
        
        {
            int64_t gtid_118404 = uni_i_122890;
            
            // Load accum params
            {
                eta_p_122864 = local_acc_122867;
            }
            // Load next params
            {
                eta_p_122865 = local_acc_122868;
            }
            // SegRed body
            {
                bool defunc_0_op_res_122866 = eta_p_122864 || eta_p_122865;
                
                local_acc_122867 = defunc_0_op_res_122866;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_122862.mem)[flat_tid_118403] = local_acc_122867;
    }
    
  cleanup:
    { }
    if (event_127739 != NULL) {
        event_127739->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127730", strdup("nothing further"), event_127739, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_127727(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127719 *futhark_mc_task_127719 = (struct futhark_mc_task_127719 *) args;
    struct futhark_context *ctx = futhark_mc_task_127719->ctx;
    struct mc_event *event_127741 = mc_event_new(ctx);
    
    if (event_127741 != NULL)
        event_127741->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127719->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_task_127719->free_exp_absorb_cutoff_33394;
    double zs_res_44883 = futhark_mc_task_127719->free_zs_res_44883;
    double zs_res_44885 = futhark_mc_task_127719->free_zs_res_44885;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_127719->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_127719->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_111799 = {.desc ="mem_111799", .mem =futhark_mc_task_127719->free_mem_111799, .size =0, .references =NULL};
    struct memblock mem_111811 = {.desc ="mem_111811", .mem =futhark_mc_task_127719->free_mem_111811, .size =0, .references =NULL};
    struct memblock mem_111814 = {.desc ="mem_111814", .mem =futhark_mc_task_127719->free_mem_111814, .size =0, .references =NULL};
    int64_t flat_tid_118403 = futhark_mc_task_127719->free_flat_tid_118403;
    int64_t flat_tid_118425 = futhark_mc_task_127719->free_flat_tid_118425;
    bool defunc_0_reduce_res_107041 = *futhark_mc_task_127719->retval_defunc_0_reduce_res_107041;
    struct memblock mem_111816 = {.desc ="mem_111816", .mem =futhark_mc_task_127719->retval_mem_111816, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_122862_cached_sizze_127728 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122862 = NULL;
    int32_t nsubtasks_122861;
    
    nsubtasks_122861 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_122862_cached_sizze_127728 < nsubtasks_122861) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122862, &reduce_stage_1_tid_res_arr_mem_122862_cached_sizze_127728, nsubtasks_122861);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127729 futhark_mc_segred_stage_1_parloop_struct_127729_;
    
    futhark_mc_segred_stage_1_parloop_struct_127729_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127729_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127729_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segred_stage_1_parloop_struct_127729_.free_zs_res_44883 = zs_res_44883;
    futhark_mc_segred_stage_1_parloop_struct_127729_.free_zs_res_44885 = zs_res_44885;
    futhark_mc_segred_stage_1_parloop_struct_127729_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_127729_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_127729_.free_mem_111799 = mem_111799.mem;
    futhark_mc_segred_stage_1_parloop_struct_127729_.free_mem_111811 = mem_111811.mem;
    futhark_mc_segred_stage_1_parloop_struct_127729_.free_mem_111814 = mem_111814.mem;
    futhark_mc_segred_stage_1_parloop_struct_127729_.free_mem_111816 = mem_111816.mem;
    futhark_mc_segred_stage_1_parloop_struct_127729_.free_reduce_stage_1_tid_res_arr_mem_122862 = reduce_stage_1_tid_res_arr_mem_122862;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127730_task;
    
    futhark_mc_segred_stage_1_parloop_127730_task.name = "futhark_mc_segred_stage_1_parloop_127730";
    futhark_mc_segred_stage_1_parloop_127730_task.fn = futhark_mc_segred_stage_1_parloop_127730;
    futhark_mc_segred_stage_1_parloop_127730_task.args = &futhark_mc_segred_stage_1_parloop_struct_127729_;
    futhark_mc_segred_stage_1_parloop_127730_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127730_task.info = info;
    
    struct mc_event *event_127740 = mc_event_new(ctx);
    
    if (event_127740 != NULL)
        event_127740->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127730_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127730_task);
    
    if (futhark_mc_segred_stage_1_parloop_127730_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127730_err;
        goto cleanup;
    }
    if (event_127740 != NULL) {
        event_127740->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127730_total", strdup("nothing further"), event_127740, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_107041 = 0;
    }
    
    bool eta_p_122891;
    bool eta_p_122892;
    
    for (int32_t i_122894 = 0; i_122894 < nsubtasks_122861; i_122894++) {
        flat_tid_118403 = i_122894;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_122891 = defunc_0_reduce_res_107041;
            }
            // load next params
            {
                eta_p_122892 = ((bool *) reduce_stage_1_tid_res_arr_mem_122862)[flat_tid_118403];
            }
            // red body
            {
                bool defunc_0_op_res_122893 = eta_p_122891 || eta_p_122892;
                
                defunc_0_reduce_res_107041 = defunc_0_op_res_122893;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_122862);
    }
    if (event_127741 != NULL) {
        event_127741->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_127727", strdup("nothing further"), event_127741, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127719->retval_defunc_0_reduce_res_107041 = defunc_0_reduce_res_107041;
        futhark_mc_task_127719->retval_mem_111816 = mem_111816.mem;
    }
    return err;
}
struct futhark_mc_task_127742 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_44842;
    double free_zs_res_44844;
    int64_t free_eta_p_106382;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_111797;
    unsigned char *free_mem_111814;
    unsigned char *free_mem_111816;
    int64_t free_flat_tid_118445;
    int64_t free_flat_tid_118467;
    bool *retval_defunc_0_reduce_res_107087;
    unsigned char *retval_mem_111818;
};
struct futhark_mc_segred_stage_1_parloop_struct_127745 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_44842;
    double free_zs_res_44844;
    int64_t free_eta_p_106382;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_111797;
    unsigned char *free_mem_111814;
    unsigned char *free_mem_111816;
    unsigned char *free_mem_111818;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122896;
};
static int futhark_mc_segred_stage_1_parloop_127746(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127745 *futhark_mc_segred_stage_1_parloop_struct_127745 = (struct futhark_mc_segred_stage_1_parloop_struct_127745 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127745->ctx;
    struct mc_event *event_127747 = mc_event_new(ctx);
    
    if (event_127747 != NULL)
        event_127747->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127745->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_segred_stage_1_parloop_struct_127745->free_exp_absorb_cutoff_33394;
    double zs_res_44842 = futhark_mc_segred_stage_1_parloop_struct_127745->free_zs_res_44842;
    double zs_res_44844 = futhark_mc_segred_stage_1_parloop_struct_127745->free_zs_res_44844;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_127745->free_eta_p_106382;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_127745->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_111797 = {.desc ="mem_111797", .mem =futhark_mc_segred_stage_1_parloop_struct_127745->free_mem_111797, .size =0, .references =NULL};
    struct memblock mem_111814 = {.desc ="mem_111814", .mem =futhark_mc_segred_stage_1_parloop_struct_127745->free_mem_111814, .size =0, .references =NULL};
    struct memblock mem_111816 = {.desc ="mem_111816", .mem =futhark_mc_segred_stage_1_parloop_struct_127745->free_mem_111816, .size =0, .references =NULL};
    struct memblock mem_111818 = {.desc ="mem_111818", .mem =futhark_mc_segred_stage_1_parloop_struct_127745->free_mem_111818, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122896 = {.desc ="reduce_stage_1_tid_res_arr_mem_122896", .mem =futhark_mc_segred_stage_1_parloop_struct_127745->free_reduce_stage_1_tid_res_arr_mem_122896, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118467;
    
    flat_tid_118467 = subtask_id;
    {
        bool eta_p_122898;
        bool eta_p_122899;
        bool local_acc_122901 = 0;
        bool eta_p_118469;
        bool eta_p_118470;
        bool local_acc_122902 = 0;
        int64_t start_122903;
        int64_t end_122904;
        
        start_122903 = start;
        end_122904 = end;
        
        int64_t n_122905 = end_122904 - start_122903;
        
        for (int64_t SegRed_i_122906 = start_122903; SegRed_i_122906 < start_122903 + n_122905; SegRed_i_122906++) {
            int64_t gtid_118468 = SegRed_i_122906;
            double eta_p_118472 = ((double *) distrs_mem_111708.mem)[eta_p_106382 * m_33388 + gtid_118468];
            double eta_p_118473 = ((double *) mem_111797.mem)[gtid_118468];
            double defunc_0_reduce_res_118474;
            double redout_118476 = 0.0;
            
            for (int64_t i_118475 = 0; i_118475 < m_33388; i_118475++) {
                double eta_p_118477 = ((double *) mem_111816.mem)[i_118475];
                double eta_p_118478 = ((double *) mem_111814.mem)[gtid_118468 * m_33388 + i_118475];
                double zt_res_118479 = eta_p_118477 * eta_p_118478;
                double zp_res_118480 = zt_res_118479 + redout_118476;
                double redout_tmp_122907 = zp_res_118480;
                
                redout_118476 = redout_tmp_122907;
            }
            defunc_0_reduce_res_118474 = redout_118476;
            
            double zs_res_118481 = defunc_0_reduce_res_118474 / eta_p_118472;
            double ztzt_res_118482 = fpow64(zs_res_118481, zs_res_44842);
            double zt_res_118483 = zs_res_44844 * eta_p_118473;
            double exp_res_118484 = futrts_exp64(zt_res_118483);
            double zt_res_118485 = ztzt_res_118482 * exp_res_118484;
            bool zgze_res_118486 = exp_absorb_cutoff_33394 <= zt_res_118485;
            
            // save map-out results
            {
                ((double *) mem_111818.mem)[gtid_118468] = zt_res_118485;
            }
            // Load accum params
            {
                eta_p_118469 = local_acc_122902;
            }
            // Load next params
            {
                eta_p_118470 = zgze_res_118486;
            }
            // SegRed body
            {
                bool defunc_0_op_res_118471 = eta_p_118469 || eta_p_118470;
                
                local_acc_122902 = defunc_0_op_res_118471;
            }
        }
        
        int64_t uni_i_122908 = 0;
        
        {
            int64_t gtid_118468 = uni_i_122908;
            
            // Load accum params
            {
                eta_p_122898 = local_acc_122901;
            }
            // Load next params
            {
                eta_p_122899 = local_acc_122902;
            }
            // SegRed body
            {
                bool defunc_0_op_res_122900 = eta_p_122898 || eta_p_122899;
                
                local_acc_122901 = defunc_0_op_res_122900;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_122896.mem)[flat_tid_118467] = local_acc_122901;
    }
    
  cleanup:
    { }
    if (event_127747 != NULL) {
        event_127747->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127746", strdup("nothing further"), event_127747, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127743(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127742 *futhark_mc_task_127742 = (struct futhark_mc_task_127742 *) args;
    struct futhark_context *ctx = futhark_mc_task_127742->ctx;
    struct mc_event *event_127749 = mc_event_new(ctx);
    
    if (event_127749 != NULL)
        event_127749->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127742->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_task_127742->free_exp_absorb_cutoff_33394;
    double zs_res_44842 = futhark_mc_task_127742->free_zs_res_44842;
    double zs_res_44844 = futhark_mc_task_127742->free_zs_res_44844;
    int64_t eta_p_106382 = futhark_mc_task_127742->free_eta_p_106382;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_127742->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_111797 = {.desc ="mem_111797", .mem =futhark_mc_task_127742->free_mem_111797, .size =0, .references =NULL};
    struct memblock mem_111814 = {.desc ="mem_111814", .mem =futhark_mc_task_127742->free_mem_111814, .size =0, .references =NULL};
    struct memblock mem_111816 = {.desc ="mem_111816", .mem =futhark_mc_task_127742->free_mem_111816, .size =0, .references =NULL};
    int64_t flat_tid_118445 = futhark_mc_task_127742->free_flat_tid_118445;
    int64_t flat_tid_118467 = futhark_mc_task_127742->free_flat_tid_118467;
    bool defunc_0_reduce_res_107087 = *futhark_mc_task_127742->retval_defunc_0_reduce_res_107087;
    struct memblock mem_111818 = {.desc ="mem_111818", .mem =futhark_mc_task_127742->retval_mem_111818, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_122896_cached_sizze_127744 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122896 = NULL;
    int32_t nsubtasks_122895;
    
    nsubtasks_122895 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_122896_cached_sizze_127744 < nsubtasks_122895) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122896, &reduce_stage_1_tid_res_arr_mem_122896_cached_sizze_127744, nsubtasks_122895);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127745 futhark_mc_segred_stage_1_parloop_struct_127745_;
    
    futhark_mc_segred_stage_1_parloop_struct_127745_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127745_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127745_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segred_stage_1_parloop_struct_127745_.free_zs_res_44842 = zs_res_44842;
    futhark_mc_segred_stage_1_parloop_struct_127745_.free_zs_res_44844 = zs_res_44844;
    futhark_mc_segred_stage_1_parloop_struct_127745_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_127745_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_127745_.free_mem_111797 = mem_111797.mem;
    futhark_mc_segred_stage_1_parloop_struct_127745_.free_mem_111814 = mem_111814.mem;
    futhark_mc_segred_stage_1_parloop_struct_127745_.free_mem_111816 = mem_111816.mem;
    futhark_mc_segred_stage_1_parloop_struct_127745_.free_mem_111818 = mem_111818.mem;
    futhark_mc_segred_stage_1_parloop_struct_127745_.free_reduce_stage_1_tid_res_arr_mem_122896 = reduce_stage_1_tid_res_arr_mem_122896;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127746_task;
    
    futhark_mc_segred_stage_1_parloop_127746_task.name = "futhark_mc_segred_stage_1_parloop_127746";
    futhark_mc_segred_stage_1_parloop_127746_task.fn = futhark_mc_segred_stage_1_parloop_127746;
    futhark_mc_segred_stage_1_parloop_127746_task.args = &futhark_mc_segred_stage_1_parloop_struct_127745_;
    futhark_mc_segred_stage_1_parloop_127746_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127746_task.info = info;
    
    struct mc_event *event_127748 = mc_event_new(ctx);
    
    if (event_127748 != NULL)
        event_127748->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127746_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127746_task);
    
    if (futhark_mc_segred_stage_1_parloop_127746_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127746_err;
        goto cleanup;
    }
    if (event_127748 != NULL) {
        event_127748->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127746_total", strdup("nothing further"), event_127748, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_107087 = 0;
    }
    
    bool eta_p_122909;
    bool eta_p_122910;
    
    for (int32_t i_122912 = 0; i_122912 < nsubtasks_122895; i_122912++) {
        flat_tid_118467 = i_122912;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_122909 = defunc_0_reduce_res_107087;
            }
            // load next params
            {
                eta_p_122910 = ((bool *) reduce_stage_1_tid_res_arr_mem_122896)[flat_tid_118467];
            }
            // red body
            {
                bool defunc_0_op_res_122911 = eta_p_122909 || eta_p_122910;
                
                defunc_0_reduce_res_107087 = defunc_0_op_res_122911;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_122896);
    }
    if (event_127749 != NULL) {
        event_127749->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127743", strdup("nothing further"), event_127749, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127742->retval_defunc_0_reduce_res_107087 = defunc_0_reduce_res_107087;
        futhark_mc_task_127742->retval_mem_111818 = mem_111818.mem;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_127752 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_44842;
    double free_zs_res_44844;
    int64_t free_eta_p_106382;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_111797;
    unsigned char *free_mem_111814;
    unsigned char *free_mem_111816;
    unsigned char *free_mem_111818;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122914;
};
struct futhark_mc_task_127754 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_111814;
    unsigned char *free_mem_111816;
    int64_t free_gtid_118446;
    int64_t free_flat_tid_118453;
    double *retval_defunc_0_reduce_res_118452;
};
struct futhark_mc_segred_stage_1_parloop_struct_127757 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_111814;
    unsigned char *free_mem_111816;
    int64_t free_gtid_118446;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122926;
};
static int futhark_mc_segred_stage_1_parloop_127758(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127757 *futhark_mc_segred_stage_1_parloop_struct_127757 = (struct futhark_mc_segred_stage_1_parloop_struct_127757 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127757->ctx;
    struct mc_event *event_127759 = mc_event_new(ctx);
    
    if (event_127759 != NULL)
        event_127759->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127757->free_m_33388;
    struct memblock mem_111814 = {.desc ="mem_111814", .mem =futhark_mc_segred_stage_1_parloop_struct_127757->free_mem_111814, .size =0, .references =NULL};
    struct memblock mem_111816 = {.desc ="mem_111816", .mem =futhark_mc_segred_stage_1_parloop_struct_127757->free_mem_111816, .size =0, .references =NULL};
    int64_t gtid_118446 = futhark_mc_segred_stage_1_parloop_struct_127757->free_gtid_118446;
    struct memblock reduce_stage_1_tid_res_arr_mem_122926 = {.desc ="reduce_stage_1_tid_res_arr_mem_122926", .mem =futhark_mc_segred_stage_1_parloop_struct_127757->free_reduce_stage_1_tid_res_arr_mem_122926, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118453;
    
    flat_tid_118453 = subtask_id;
    {
        double eta_p_122928;
        double eta_p_122929;
        double local_acc_122931 = 0.0;
        double eta_p_118455;
        double eta_p_118456;
        double local_acc_122932 = 0.0;
        int64_t start_122933;
        int64_t end_122934;
        
        start_122933 = start;
        end_122934 = end;
        
        int64_t n_122935 = end_122934 - start_122933;
        
        for (int64_t SegRed_i_122936 = start_122933; SegRed_i_122936 < start_122933 + n_122935; SegRed_i_122936++) {
            int64_t gtid_118454 = SegRed_i_122936;
            double eta_p_118458 = ((double *) mem_111816.mem)[gtid_118454];
            double eta_p_118459 = ((double *) mem_111814.mem)[gtid_118446 * m_33388 + gtid_118454];
            double zt_res_118460 = eta_p_118458 * eta_p_118459;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_118455 = local_acc_122932;
            }
            // Load next params
            {
                eta_p_118456 = zt_res_118460;
            }
            // SegRed body
            {
                double zp_res_118457 = eta_p_118455 + eta_p_118456;
                
                local_acc_122932 = zp_res_118457;
            }
        }
        
        int64_t uni_i_122937 = 0;
        
        {
            int64_t gtid_118454 = uni_i_122937;
            
            // Load accum params
            {
                eta_p_122928 = local_acc_122931;
            }
            // Load next params
            {
                eta_p_122929 = local_acc_122932;
            }
            // SegRed body
            {
                double zp_res_122930 = eta_p_122928 + eta_p_122929;
                
                local_acc_122931 = zp_res_122930;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_122926.mem)[flat_tid_118453] = local_acc_122931;
    }
    
  cleanup:
    { }
    if (event_127759 != NULL) {
        event_127759->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127758", strdup("nothing further"), event_127759, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127755(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127754 *futhark_mc_task_127754 = (struct futhark_mc_task_127754 *) args;
    struct futhark_context *ctx = futhark_mc_task_127754->ctx;
    struct mc_event *event_127761 = mc_event_new(ctx);
    
    if (event_127761 != NULL)
        event_127761->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127754->free_m_33388;
    struct memblock mem_111814 = {.desc ="mem_111814", .mem =futhark_mc_task_127754->free_mem_111814, .size =0, .references =NULL};
    struct memblock mem_111816 = {.desc ="mem_111816", .mem =futhark_mc_task_127754->free_mem_111816, .size =0, .references =NULL};
    int64_t gtid_118446 = futhark_mc_task_127754->free_gtid_118446;
    int64_t flat_tid_118453 = futhark_mc_task_127754->free_flat_tid_118453;
    double defunc_0_reduce_res_118452 = *futhark_mc_task_127754->retval_defunc_0_reduce_res_118452;
    int64_t reduce_stage_1_tid_res_arr_mem_122926_cached_sizze_127756 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122926 = NULL;
    int32_t nsubtasks_122925;
    
    nsubtasks_122925 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_122926_cached_sizze_127756 < (int64_t) 8 * nsubtasks_122925) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122926, &reduce_stage_1_tid_res_arr_mem_122926_cached_sizze_127756, (int64_t) 8 * nsubtasks_122925);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127757 futhark_mc_segred_stage_1_parloop_struct_127757_;
    
    futhark_mc_segred_stage_1_parloop_struct_127757_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127757_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127757_.free_mem_111814 = mem_111814.mem;
    futhark_mc_segred_stage_1_parloop_struct_127757_.free_mem_111816 = mem_111816.mem;
    futhark_mc_segred_stage_1_parloop_struct_127757_.free_gtid_118446 = gtid_118446;
    futhark_mc_segred_stage_1_parloop_struct_127757_.free_reduce_stage_1_tid_res_arr_mem_122926 = reduce_stage_1_tid_res_arr_mem_122926;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127758_task;
    
    futhark_mc_segred_stage_1_parloop_127758_task.name = "futhark_mc_segred_stage_1_parloop_127758";
    futhark_mc_segred_stage_1_parloop_127758_task.fn = futhark_mc_segred_stage_1_parloop_127758;
    futhark_mc_segred_stage_1_parloop_127758_task.args = &futhark_mc_segred_stage_1_parloop_struct_127757_;
    futhark_mc_segred_stage_1_parloop_127758_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127758_task.info = info;
    
    struct mc_event *event_127760 = mc_event_new(ctx);
    
    if (event_127760 != NULL)
        event_127760->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127758_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127758_task);
    
    if (futhark_mc_segred_stage_1_parloop_127758_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127758_err;
        goto cleanup;
    }
    if (event_127760 != NULL) {
        event_127760->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127758_total", strdup("nothing further"), event_127760, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_118452 = 0.0;
    }
    
    double eta_p_122938;
    double eta_p_122939;
    
    for (int32_t i_122941 = 0; i_122941 < nsubtasks_122925; i_122941++) {
        flat_tid_118453 = i_122941;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_122938 = defunc_0_reduce_res_118452;
            }
            // load next params
            {
                eta_p_122939 = ((double *) reduce_stage_1_tid_res_arr_mem_122926)[flat_tid_118453];
            }
            // red body
            {
                double zp_res_122940 = eta_p_122938 + eta_p_122939;
                
                defunc_0_reduce_res_118452 = zp_res_122940;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_122926);
    }
    if (event_127761 != NULL) {
        event_127761->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127755", strdup("nothing further"), event_127761, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127754->retval_defunc_0_reduce_res_118452 = defunc_0_reduce_res_118452;
    }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_127753(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127752 *futhark_mc_segred_stage_1_parloop_struct_127752 = (struct futhark_mc_segred_stage_1_parloop_struct_127752 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127752->ctx;
    struct mc_event *event_127762 = mc_event_new(ctx);
    
    if (event_127762 != NULL)
        event_127762->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127752->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_segred_stage_1_parloop_struct_127752->free_exp_absorb_cutoff_33394;
    double zs_res_44842 = futhark_mc_segred_stage_1_parloop_struct_127752->free_zs_res_44842;
    double zs_res_44844 = futhark_mc_segred_stage_1_parloop_struct_127752->free_zs_res_44844;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_127752->free_eta_p_106382;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_127752->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_111797 = {.desc ="mem_111797", .mem =futhark_mc_segred_stage_1_parloop_struct_127752->free_mem_111797, .size =0, .references =NULL};
    struct memblock mem_111814 = {.desc ="mem_111814", .mem =futhark_mc_segred_stage_1_parloop_struct_127752->free_mem_111814, .size =0, .references =NULL};
    struct memblock mem_111816 = {.desc ="mem_111816", .mem =futhark_mc_segred_stage_1_parloop_struct_127752->free_mem_111816, .size =0, .references =NULL};
    struct memblock mem_111818 = {.desc ="mem_111818", .mem =futhark_mc_segred_stage_1_parloop_struct_127752->free_mem_111818, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122914 = {.desc ="reduce_stage_1_tid_res_arr_mem_122914", .mem =futhark_mc_segred_stage_1_parloop_struct_127752->free_reduce_stage_1_tid_res_arr_mem_122914, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118445;
    
    flat_tid_118445 = subtask_id;
    {
        bool eta_p_122916;
        bool eta_p_122917;
        bool local_acc_122919 = 0;
        bool eta_p_118447;
        bool eta_p_118448;
        bool local_acc_122920 = 0;
        int64_t start_122921;
        int64_t end_122922;
        
        start_122921 = start;
        end_122922 = end;
        
        int64_t n_122923 = end_122922 - start_122921;
        
        for (int64_t SegRed_i_122924 = start_122921; SegRed_i_122924 < start_122921 + n_122923; SegRed_i_122924++) {
            int64_t gtid_118446 = SegRed_i_122924;
            double eta_p_118450 = ((double *) distrs_mem_111708.mem)[eta_p_106382 * m_33388 + gtid_118446];
            double eta_p_118451 = ((double *) mem_111797.mem)[gtid_118446];
            double defunc_0_reduce_res_118452;
            int64_t flat_tid_118453 = (int64_t) 0;
            
            defunc_0_reduce_res_118452 = 0.0;
            
            struct futhark_mc_task_127754 futhark_mc_task_127754_;
            
            futhark_mc_task_127754_.ctx = ctx;
            futhark_mc_task_127754_.free_m_33388 = m_33388;
            futhark_mc_task_127754_.free_mem_111814 = mem_111814.mem;
            futhark_mc_task_127754_.free_mem_111816 = mem_111816.mem;
            futhark_mc_task_127754_.free_gtid_118446 = gtid_118446;
            futhark_mc_task_127754_.free_flat_tid_118453 = flat_tid_118453;
            futhark_mc_task_127754_.retval_defunc_0_reduce_res_118452 = (double *) &defunc_0_reduce_res_118452;
            #if ISPC
            futhark_mc_task_127754_.retval_defunc_0_reduce_res_118452 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_127754_task;
            
            futhark_mc_task_127754_task.args = &futhark_mc_task_127754_;
            futhark_mc_task_127754_task.top_level_fn = futhark_mc_segred_task_127755;
            futhark_mc_task_127754_task.name = "futhark_mc_segred_task_127755";
            futhark_mc_task_127754_task.iterations = m_33388;
            futhark_mc_task_127754_task.task_time = &ctx->program->futhark_mc_segred_task_127755_total_time;
            futhark_mc_task_127754_task.task_iter = &ctx->program->futhark_mc_segred_task_127755_total_iter;
            futhark_mc_task_127754_task.sched = STATIC;
            futhark_mc_task_127754_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_127755_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127754_task);
            
            if (futhark_mc_segred_task_127755_err != 0) {
                err = futhark_mc_segred_task_127755_err;
                goto cleanup;
            }
            
            double zs_res_118461 = defunc_0_reduce_res_118452 / eta_p_118450;
            double ztzt_res_118462 = fpow64(zs_res_118461, zs_res_44842);
            double zt_res_118463 = zs_res_44844 * eta_p_118451;
            double exp_res_118464 = futrts_exp64(zt_res_118463);
            double zt_res_118465 = ztzt_res_118462 * exp_res_118464;
            bool zgze_res_118466 = exp_absorb_cutoff_33394 <= zt_res_118465;
            
            // save map-out results
            {
                ((double *) mem_111818.mem)[gtid_118446] = zt_res_118465;
            }
            // Load accum params
            {
                eta_p_118447 = local_acc_122920;
            }
            // Load next params
            {
                eta_p_118448 = zgze_res_118466;
            }
            // SegRed body
            {
                bool defunc_0_op_res_118449 = eta_p_118447 || eta_p_118448;
                
                local_acc_122920 = defunc_0_op_res_118449;
            }
        }
        
        int64_t uni_i_122942 = 0;
        
        {
            int64_t gtid_118446 = uni_i_122942;
            
            // Load accum params
            {
                eta_p_122916 = local_acc_122919;
            }
            // Load next params
            {
                eta_p_122917 = local_acc_122920;
            }
            // SegRed body
            {
                bool defunc_0_op_res_122918 = eta_p_122916 || eta_p_122917;
                
                local_acc_122919 = defunc_0_op_res_122918;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_122914.mem)[flat_tid_118445] = local_acc_122919;
    }
    
  cleanup:
    { }
    if (event_127762 != NULL) {
        event_127762->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127753", strdup("nothing further"), event_127762, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_127750(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127742 *futhark_mc_task_127742 = (struct futhark_mc_task_127742 *) args;
    struct futhark_context *ctx = futhark_mc_task_127742->ctx;
    struct mc_event *event_127764 = mc_event_new(ctx);
    
    if (event_127764 != NULL)
        event_127764->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127742->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_task_127742->free_exp_absorb_cutoff_33394;
    double zs_res_44842 = futhark_mc_task_127742->free_zs_res_44842;
    double zs_res_44844 = futhark_mc_task_127742->free_zs_res_44844;
    int64_t eta_p_106382 = futhark_mc_task_127742->free_eta_p_106382;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_127742->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_111797 = {.desc ="mem_111797", .mem =futhark_mc_task_127742->free_mem_111797, .size =0, .references =NULL};
    struct memblock mem_111814 = {.desc ="mem_111814", .mem =futhark_mc_task_127742->free_mem_111814, .size =0, .references =NULL};
    struct memblock mem_111816 = {.desc ="mem_111816", .mem =futhark_mc_task_127742->free_mem_111816, .size =0, .references =NULL};
    int64_t flat_tid_118445 = futhark_mc_task_127742->free_flat_tid_118445;
    int64_t flat_tid_118467 = futhark_mc_task_127742->free_flat_tid_118467;
    bool defunc_0_reduce_res_107087 = *futhark_mc_task_127742->retval_defunc_0_reduce_res_107087;
    struct memblock mem_111818 = {.desc ="mem_111818", .mem =futhark_mc_task_127742->retval_mem_111818, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_122914_cached_sizze_127751 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122914 = NULL;
    int32_t nsubtasks_122913;
    
    nsubtasks_122913 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_122914_cached_sizze_127751 < nsubtasks_122913) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122914, &reduce_stage_1_tid_res_arr_mem_122914_cached_sizze_127751, nsubtasks_122913);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127752 futhark_mc_segred_stage_1_parloop_struct_127752_;
    
    futhark_mc_segred_stage_1_parloop_struct_127752_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127752_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127752_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segred_stage_1_parloop_struct_127752_.free_zs_res_44842 = zs_res_44842;
    futhark_mc_segred_stage_1_parloop_struct_127752_.free_zs_res_44844 = zs_res_44844;
    futhark_mc_segred_stage_1_parloop_struct_127752_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_127752_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_127752_.free_mem_111797 = mem_111797.mem;
    futhark_mc_segred_stage_1_parloop_struct_127752_.free_mem_111814 = mem_111814.mem;
    futhark_mc_segred_stage_1_parloop_struct_127752_.free_mem_111816 = mem_111816.mem;
    futhark_mc_segred_stage_1_parloop_struct_127752_.free_mem_111818 = mem_111818.mem;
    futhark_mc_segred_stage_1_parloop_struct_127752_.free_reduce_stage_1_tid_res_arr_mem_122914 = reduce_stage_1_tid_res_arr_mem_122914;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127753_task;
    
    futhark_mc_segred_stage_1_parloop_127753_task.name = "futhark_mc_segred_stage_1_parloop_127753";
    futhark_mc_segred_stage_1_parloop_127753_task.fn = futhark_mc_segred_stage_1_parloop_127753;
    futhark_mc_segred_stage_1_parloop_127753_task.args = &futhark_mc_segred_stage_1_parloop_struct_127752_;
    futhark_mc_segred_stage_1_parloop_127753_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127753_task.info = info;
    
    struct mc_event *event_127763 = mc_event_new(ctx);
    
    if (event_127763 != NULL)
        event_127763->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127753_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127753_task);
    
    if (futhark_mc_segred_stage_1_parloop_127753_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127753_err;
        goto cleanup;
    }
    if (event_127763 != NULL) {
        event_127763->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127753_total", strdup("nothing further"), event_127763, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_107087 = 0;
    }
    
    bool eta_p_122943;
    bool eta_p_122944;
    
    for (int32_t i_122946 = 0; i_122946 < nsubtasks_122913; i_122946++) {
        flat_tid_118445 = i_122946;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_122943 = defunc_0_reduce_res_107087;
            }
            // load next params
            {
                eta_p_122944 = ((bool *) reduce_stage_1_tid_res_arr_mem_122914)[flat_tid_118445];
            }
            // red body
            {
                bool defunc_0_op_res_122945 = eta_p_122943 || eta_p_122944;
                
                defunc_0_reduce_res_107087 = defunc_0_op_res_122945;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_122914);
    }
    if (event_127764 != NULL) {
        event_127764->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_127750", strdup("nothing further"), event_127764, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127742->retval_defunc_0_reduce_res_107087 = defunc_0_reduce_res_107087;
        futhark_mc_task_127742->retval_mem_111818 = mem_111818.mem;
    }
    return err;
}
struct futhark_mc_task_127765 {
    struct futhark_context *ctx;
    double free_zs_res_107134;
    unsigned char *free_mem_111818;
    int64_t free_flat_tid_118487;
    bool *retval_defunc_0_reduce_res_107135;
};
struct futhark_mc_segred_stage_1_parloop_struct_127768 {
    struct futhark_context *ctx;
    double free_zs_res_107134;
    unsigned char *free_mem_111818;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122948;
};
static int futhark_mc_segred_stage_1_parloop_127769(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127768 *futhark_mc_segred_stage_1_parloop_struct_127768 = (struct futhark_mc_segred_stage_1_parloop_struct_127768 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127768->ctx;
    struct mc_event *event_127770 = mc_event_new(ctx);
    
    if (event_127770 != NULL)
        event_127770->bef = get_wall_time();
    
    double zs_res_107134 = futhark_mc_segred_stage_1_parloop_struct_127768->free_zs_res_107134;
    struct memblock mem_111818 = {.desc ="mem_111818", .mem =futhark_mc_segred_stage_1_parloop_struct_127768->free_mem_111818, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122948 = {.desc ="reduce_stage_1_tid_res_arr_mem_122948", .mem =futhark_mc_segred_stage_1_parloop_struct_127768->free_reduce_stage_1_tid_res_arr_mem_122948, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118487;
    
    flat_tid_118487 = subtask_id;
    {
        bool eta_p_122950;
        bool eta_p_122951;
        bool local_acc_122953 = 0;
        bool eta_p_118489;
        bool eta_p_118490;
        bool local_acc_122954 = 0;
        int64_t start_122955;
        int64_t end_122956;
        
        start_122955 = start;
        end_122956 = end;
        
        int64_t n_122957 = end_122956 - start_122955;
        
        for (int64_t SegRed_i_122958 = start_122955; SegRed_i_122958 < start_122955 + n_122957; SegRed_i_122958++) {
            int64_t gtid_118488 = SegRed_i_122958;
            double eta_p_118492 = ((double *) mem_111818.mem)[gtid_118488];
            bool zlze_res_118493 = eta_p_118492 <= zs_res_107134;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_118489 = local_acc_122954;
            }
            // Load next params
            {
                eta_p_118490 = zlze_res_118493;
            }
            // SegRed body
            {
                bool defunc_0_op_res_118491 = eta_p_118489 || eta_p_118490;
                
                local_acc_122954 = defunc_0_op_res_118491;
            }
        }
        
        int64_t uni_i_122959 = 0;
        
        {
            int64_t gtid_118488 = uni_i_122959;
            
            // Load accum params
            {
                eta_p_122950 = local_acc_122953;
            }
            // Load next params
            {
                eta_p_122951 = local_acc_122954;
            }
            // SegRed body
            {
                bool defunc_0_op_res_122952 = eta_p_122950 || eta_p_122951;
                
                local_acc_122953 = defunc_0_op_res_122952;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_122948.mem)[flat_tid_118487] = local_acc_122953;
    }
    
  cleanup:
    { }
    if (event_127770 != NULL) {
        event_127770->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127769", strdup("nothing further"), event_127770, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127766(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127765 *futhark_mc_task_127765 = (struct futhark_mc_task_127765 *) args;
    struct futhark_context *ctx = futhark_mc_task_127765->ctx;
    struct mc_event *event_127772 = mc_event_new(ctx);
    
    if (event_127772 != NULL)
        event_127772->bef = get_wall_time();
    
    double zs_res_107134 = futhark_mc_task_127765->free_zs_res_107134;
    struct memblock mem_111818 = {.desc ="mem_111818", .mem =futhark_mc_task_127765->free_mem_111818, .size =0, .references =NULL};
    int64_t flat_tid_118487 = futhark_mc_task_127765->free_flat_tid_118487;
    bool defunc_0_reduce_res_107135 = *futhark_mc_task_127765->retval_defunc_0_reduce_res_107135;
    int64_t reduce_stage_1_tid_res_arr_mem_122948_cached_sizze_127767 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122948 = NULL;
    int32_t nsubtasks_122947;
    
    nsubtasks_122947 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_122948_cached_sizze_127767 < nsubtasks_122947) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122948, &reduce_stage_1_tid_res_arr_mem_122948_cached_sizze_127767, nsubtasks_122947);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127768 futhark_mc_segred_stage_1_parloop_struct_127768_;
    
    futhark_mc_segred_stage_1_parloop_struct_127768_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127768_.free_zs_res_107134 = zs_res_107134;
    futhark_mc_segred_stage_1_parloop_struct_127768_.free_mem_111818 = mem_111818.mem;
    futhark_mc_segred_stage_1_parloop_struct_127768_.free_reduce_stage_1_tid_res_arr_mem_122948 = reduce_stage_1_tid_res_arr_mem_122948;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127769_task;
    
    futhark_mc_segred_stage_1_parloop_127769_task.name = "futhark_mc_segred_stage_1_parloop_127769";
    futhark_mc_segred_stage_1_parloop_127769_task.fn = futhark_mc_segred_stage_1_parloop_127769;
    futhark_mc_segred_stage_1_parloop_127769_task.args = &futhark_mc_segred_stage_1_parloop_struct_127768_;
    futhark_mc_segred_stage_1_parloop_127769_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127769_task.info = info;
    
    struct mc_event *event_127771 = mc_event_new(ctx);
    
    if (event_127771 != NULL)
        event_127771->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127769_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127769_task);
    
    if (futhark_mc_segred_stage_1_parloop_127769_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127769_err;
        goto cleanup;
    }
    if (event_127771 != NULL) {
        event_127771->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127769_total", strdup("nothing further"), event_127771, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_107135 = 0;
    }
    
    bool eta_p_122960;
    bool eta_p_122961;
    
    for (int32_t i_122963 = 0; i_122963 < nsubtasks_122947; i_122963++) {
        flat_tid_118487 = i_122963;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_122960 = defunc_0_reduce_res_107135;
            }
            // load next params
            {
                eta_p_122961 = ((bool *) reduce_stage_1_tid_res_arr_mem_122948)[flat_tid_118487];
            }
            // red body
            {
                bool defunc_0_op_res_122962 = eta_p_122960 || eta_p_122961;
                
                defunc_0_reduce_res_107135 = defunc_0_op_res_122962;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_122948);
    }
    if (event_127772 != NULL) {
        event_127772->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127766", strdup("nothing further"), event_127772, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127765->retval_defunc_0_reduce_res_107135 = defunc_0_reduce_res_107135;
    }
    return err;
}
struct futhark_mc_task_127773 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_107134;
    int64_t free_bytes_111715;
    unsigned char *free_mem_111797;
    unsigned char *free_mem_111814;
    unsigned char *free_mem_111818;
    unsigned char *free_mem_111832;
    unsigned char *free_mem_111834;
    unsigned char *free_mem_111837;
};
struct futhark_mc_segmap_parloop_struct_127775 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_107134;
    int64_t free_bytes_111715;
    unsigned char *free_mem_111797;
    unsigned char *free_mem_111814;
    unsigned char *free_mem_111818;
    unsigned char *free_mem_111832;
    unsigned char *free_mem_111834;
    unsigned char *free_mem_111837;
};
static int futhark_mc_segmap_parloop_127776(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_127775 *futhark_mc_segmap_parloop_struct_127775 = (struct futhark_mc_segmap_parloop_struct_127775 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_127775->ctx;
    struct mc_event *event_127777 = mc_event_new(ctx);
    
    if (event_127777 != NULL)
        event_127777->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_127775->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_segmap_parloop_struct_127775->free_exp_absorb_cutoff_33394;
    double zs_res_107134 = futhark_mc_segmap_parloop_struct_127775->free_zs_res_107134;
    int64_t bytes_111715 = futhark_mc_segmap_parloop_struct_127775->free_bytes_111715;
    struct memblock mem_111797 = {.desc ="mem_111797", .mem =futhark_mc_segmap_parloop_struct_127775->free_mem_111797, .size =0, .references =NULL};
    struct memblock mem_111814 = {.desc ="mem_111814", .mem =futhark_mc_segmap_parloop_struct_127775->free_mem_111814, .size =0, .references =NULL};
    struct memblock mem_111818 = {.desc ="mem_111818", .mem =futhark_mc_segmap_parloop_struct_127775->free_mem_111818, .size =0, .references =NULL};
    struct memblock mem_111832 = {.desc ="mem_111832", .mem =futhark_mc_segmap_parloop_struct_127775->free_mem_111832, .size =0, .references =NULL};
    struct memblock mem_111834 = {.desc ="mem_111834", .mem =futhark_mc_segmap_parloop_struct_127775->free_mem_111834, .size =0, .references =NULL};
    struct memblock mem_111837 = {.desc ="mem_111837", .mem =futhark_mc_segmap_parloop_struct_127775->free_mem_111837, .size =0, .references =NULL};
    int64_t iterations = end - start;
    struct memblock ext_mem_118510;
    
    ext_mem_118510.references = NULL;
    
    struct memblock mem_118509;
    
    mem_118509.references = NULL;
    
    int64_t flat_tid_118497;
    
    flat_tid_118497 = subtask_id;
    {
        int64_t start_122976;
        int64_t end_122977;
        
        start_122976 = start;
        end_122977 = end;
        
        int64_t n_122978 = end_122977 - start_122976;
        
        if (memblock_alloc(ctx, &mem_118509, bytes_111715, "mem_118509")) {
            err = 1;
            goto cleanup;
        }
        for (int64_t SegMap_i_122979 = start_122976; SegMap_i_122979 < start_122976 + n_122978; SegMap_i_122979++) {
            int64_t slice_122980 = m_33388;
            int64_t gtid_118498 = SegMap_i_122979;
            int64_t remnant_122981 = SegMap_i_122979 - gtid_118498;
            double eta_p_118499 = ((double *) mem_111818.mem)[gtid_118498];
            double eta_p_118500 = ((double *) mem_111797.mem)[gtid_118498];
            bool zgze_res_118502 = exp_absorb_cutoff_33394 <= eta_p_118499;
            bool zl_res_118503 = eta_p_118499 < zs_res_107134;
            bool x_118504 = !zgze_res_118502;
            bool y_118505 = zl_res_118503 && x_118504;
            bool cond_118506 = zgze_res_118502 || y_118505;
            int64_t lmad_ext_118507 = m_33388 * gtid_118498;
            int64_t ext_118508;
            
            if (cond_118506) {
                ext_118508 = (int64_t) 0;
            } else {
                ext_118508 = lmad_ext_118507;
            }
            
            double rescale_res_118511;
            double rescale_res_118512;
            
            if (cond_118506) {
                double log_res_122965 = futrts_log64(eta_p_118499);
                double sqrt_res_122966 = futrts_sqrt64(eta_p_118499);
                double zs_res_122967 = log_res_122965 / 2.0;
                double zp_res_122968 = eta_p_118500 + zs_res_122967;
                
                for (int64_t i_122971 = 0; i_122971 < m_33388; i_122971++) {
                    double eta_p_122973 = ((double *) mem_111814.mem)[gtid_118498 * m_33388 + i_122971];
                    double zt_res_122974 = sqrt_res_122966 * eta_p_122973;
                    
                    ((double *) mem_118509.mem)[i_122971] = zt_res_122974;
                }
                if (memblock_set(ctx, &ext_mem_118510, &mem_118509, "mem_118509") != 0)
                    return 1;
                rescale_res_118511 = sqrt_res_122966;
                rescale_res_118512 = zp_res_122968;
            } else {
                if (memblock_set(ctx, &ext_mem_118510, &mem_111814, "mem_111814") != 0)
                    return 1;
                rescale_res_118511 = eta_p_118499;
                rescale_res_118512 = eta_p_118500;
            }
            ((double *) mem_111832.mem)[gtid_118498] = rescale_res_118511;
            ((double *) mem_111834.mem)[gtid_118498] = rescale_res_118512;
            lmad_copy_8b(ctx, 1, (uint64_t *) mem_111837.mem, gtid_118498 * m_33388, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_118510.mem, ext_118508, (int64_t []) {(int64_t) 1}, (int64_t []) {m_33388});
        }
    }
    
  cleanup:
    {
        if (memblock_unref(ctx, &ext_mem_118510, "ext_mem_118510") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_118509, "mem_118509") != 0)
            return 1;
    }
    if (event_127777 != NULL) {
        event_127777->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127776", strdup("nothing further"), event_127777, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_task_127774(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127773 *futhark_mc_task_127773 = (struct futhark_mc_task_127773 *) args;
    struct futhark_context *ctx = futhark_mc_task_127773->ctx;
    struct mc_event *event_127779 = mc_event_new(ctx);
    
    if (event_127779 != NULL)
        event_127779->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127773->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_task_127773->free_exp_absorb_cutoff_33394;
    double zs_res_107134 = futhark_mc_task_127773->free_zs_res_107134;
    int64_t bytes_111715 = futhark_mc_task_127773->free_bytes_111715;
    struct memblock mem_111797 = {.desc ="mem_111797", .mem =futhark_mc_task_127773->free_mem_111797, .size =0, .references =NULL};
    struct memblock mem_111814 = {.desc ="mem_111814", .mem =futhark_mc_task_127773->free_mem_111814, .size =0, .references =NULL};
    struct memblock mem_111818 = {.desc ="mem_111818", .mem =futhark_mc_task_127773->free_mem_111818, .size =0, .references =NULL};
    struct memblock mem_111832 = {.desc ="mem_111832", .mem =futhark_mc_task_127773->free_mem_111832, .size =0, .references =NULL};
    struct memblock mem_111834 = {.desc ="mem_111834", .mem =futhark_mc_task_127773->free_mem_111834, .size =0, .references =NULL};
    struct memblock mem_111837 = {.desc ="mem_111837", .mem =futhark_mc_task_127773->free_mem_111837, .size =0, .references =NULL};
    int32_t nsubtasks_122964;
    
    nsubtasks_122964 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_127775 futhark_mc_segmap_parloop_struct_127775_;
    
    futhark_mc_segmap_parloop_struct_127775_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_127775_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_127775_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segmap_parloop_struct_127775_.free_zs_res_107134 = zs_res_107134;
    futhark_mc_segmap_parloop_struct_127775_.free_bytes_111715 = bytes_111715;
    futhark_mc_segmap_parloop_struct_127775_.free_mem_111797 = mem_111797.mem;
    futhark_mc_segmap_parloop_struct_127775_.free_mem_111814 = mem_111814.mem;
    futhark_mc_segmap_parloop_struct_127775_.free_mem_111818 = mem_111818.mem;
    futhark_mc_segmap_parloop_struct_127775_.free_mem_111832 = mem_111832.mem;
    futhark_mc_segmap_parloop_struct_127775_.free_mem_111834 = mem_111834.mem;
    futhark_mc_segmap_parloop_struct_127775_.free_mem_111837 = mem_111837.mem;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_127776_task;
    
    futhark_mc_segmap_parloop_127776_task.name = "futhark_mc_segmap_parloop_127776";
    futhark_mc_segmap_parloop_127776_task.fn = futhark_mc_segmap_parloop_127776;
    futhark_mc_segmap_parloop_127776_task.args = &futhark_mc_segmap_parloop_struct_127775_;
    futhark_mc_segmap_parloop_127776_task.iterations = iterations;
    futhark_mc_segmap_parloop_127776_task.info = info;
    
    struct mc_event *event_127778 = mc_event_new(ctx);
    
    if (event_127778 != NULL)
        event_127778->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_127776_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_127776_task);
    
    if (futhark_mc_segmap_parloop_127776_err != 0) {
        err = futhark_mc_segmap_parloop_127776_err;
        goto cleanup;
    }
    if (event_127778 != NULL) {
        event_127778->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127776_total", strdup("nothing further"), event_127778, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_127779 != NULL) {
        event_127779->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_task_127774", strdup("nothing further"), event_127779, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_127780 {
    struct futhark_context *ctx;
    double free_zs_res_107134;
    unsigned char *free_mem_111816;
    int64_t free_flat_tid_118525;
    bool *retval_defunc_0_reduce_res_107172;
};
struct futhark_mc_segred_stage_1_parloop_struct_127783 {
    struct futhark_context *ctx;
    double free_zs_res_107134;
    unsigned char *free_mem_111816;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_122984;
};
static int futhark_mc_segred_stage_1_parloop_127784(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127783 *futhark_mc_segred_stage_1_parloop_struct_127783 = (struct futhark_mc_segred_stage_1_parloop_struct_127783 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127783->ctx;
    struct mc_event *event_127785 = mc_event_new(ctx);
    
    if (event_127785 != NULL)
        event_127785->bef = get_wall_time();
    
    double zs_res_107134 = futhark_mc_segred_stage_1_parloop_struct_127783->free_zs_res_107134;
    struct memblock mem_111816 = {.desc ="mem_111816", .mem =futhark_mc_segred_stage_1_parloop_struct_127783->free_mem_111816, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_122984 = {.desc ="reduce_stage_1_tid_res_arr_mem_122984", .mem =futhark_mc_segred_stage_1_parloop_struct_127783->free_reduce_stage_1_tid_res_arr_mem_122984, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118525;
    
    flat_tid_118525 = subtask_id;
    {
        bool eta_p_122986;
        bool eta_p_122987;
        bool local_acc_122989 = 0;
        bool eta_p_118527;
        bool eta_p_118528;
        bool local_acc_122990 = 0;
        int64_t start_122991;
        int64_t end_122992;
        
        start_122991 = start;
        end_122992 = end;
        
        int64_t n_122993 = end_122992 - start_122991;
        
        for (int64_t SegRed_i_122994 = start_122991; SegRed_i_122994 < start_122991 + n_122993; SegRed_i_122994++) {
            int64_t gtid_118526 = SegRed_i_122994;
            double eta_p_118530 = ((double *) mem_111816.mem)[gtid_118526];
            bool zlze_res_118531 = eta_p_118530 <= zs_res_107134;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_118527 = local_acc_122990;
            }
            // Load next params
            {
                eta_p_118528 = zlze_res_118531;
            }
            // SegRed body
            {
                bool defunc_0_op_res_118529 = eta_p_118527 || eta_p_118528;
                
                local_acc_122990 = defunc_0_op_res_118529;
            }
        }
        
        int64_t uni_i_122995 = 0;
        
        {
            int64_t gtid_118526 = uni_i_122995;
            
            // Load accum params
            {
                eta_p_122986 = local_acc_122989;
            }
            // Load next params
            {
                eta_p_122987 = local_acc_122990;
            }
            // SegRed body
            {
                bool defunc_0_op_res_122988 = eta_p_122986 || eta_p_122987;
                
                local_acc_122989 = defunc_0_op_res_122988;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_122984.mem)[flat_tid_118525] = local_acc_122989;
    }
    
  cleanup:
    { }
    if (event_127785 != NULL) {
        event_127785->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127784", strdup("nothing further"), event_127785, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127781(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127780 *futhark_mc_task_127780 = (struct futhark_mc_task_127780 *) args;
    struct futhark_context *ctx = futhark_mc_task_127780->ctx;
    struct mc_event *event_127787 = mc_event_new(ctx);
    
    if (event_127787 != NULL)
        event_127787->bef = get_wall_time();
    
    double zs_res_107134 = futhark_mc_task_127780->free_zs_res_107134;
    struct memblock mem_111816 = {.desc ="mem_111816", .mem =futhark_mc_task_127780->free_mem_111816, .size =0, .references =NULL};
    int64_t flat_tid_118525 = futhark_mc_task_127780->free_flat_tid_118525;
    bool defunc_0_reduce_res_107172 = *futhark_mc_task_127780->retval_defunc_0_reduce_res_107172;
    int64_t reduce_stage_1_tid_res_arr_mem_122984_cached_sizze_127782 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_122984 = NULL;
    int32_t nsubtasks_122983;
    
    nsubtasks_122983 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_122984_cached_sizze_127782 < nsubtasks_122983) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_122984, &reduce_stage_1_tid_res_arr_mem_122984_cached_sizze_127782, nsubtasks_122983);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127783 futhark_mc_segred_stage_1_parloop_struct_127783_;
    
    futhark_mc_segred_stage_1_parloop_struct_127783_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127783_.free_zs_res_107134 = zs_res_107134;
    futhark_mc_segred_stage_1_parloop_struct_127783_.free_mem_111816 = mem_111816.mem;
    futhark_mc_segred_stage_1_parloop_struct_127783_.free_reduce_stage_1_tid_res_arr_mem_122984 = reduce_stage_1_tid_res_arr_mem_122984;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127784_task;
    
    futhark_mc_segred_stage_1_parloop_127784_task.name = "futhark_mc_segred_stage_1_parloop_127784";
    futhark_mc_segred_stage_1_parloop_127784_task.fn = futhark_mc_segred_stage_1_parloop_127784;
    futhark_mc_segred_stage_1_parloop_127784_task.args = &futhark_mc_segred_stage_1_parloop_struct_127783_;
    futhark_mc_segred_stage_1_parloop_127784_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127784_task.info = info;
    
    struct mc_event *event_127786 = mc_event_new(ctx);
    
    if (event_127786 != NULL)
        event_127786->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127784_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127784_task);
    
    if (futhark_mc_segred_stage_1_parloop_127784_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127784_err;
        goto cleanup;
    }
    if (event_127786 != NULL) {
        event_127786->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127784_total", strdup("nothing further"), event_127786, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_107172 = 0;
    }
    
    bool eta_p_122996;
    bool eta_p_122997;
    
    for (int32_t i_122999 = 0; i_122999 < nsubtasks_122983; i_122999++) {
        flat_tid_118525 = i_122999;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_122996 = defunc_0_reduce_res_107172;
            }
            // load next params
            {
                eta_p_122997 = ((bool *) reduce_stage_1_tid_res_arr_mem_122984)[flat_tid_118525];
            }
            // red body
            {
                bool defunc_0_op_res_122998 = eta_p_122996 || eta_p_122997;
                
                defunc_0_reduce_res_107172 = defunc_0_op_res_122998;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_122984);
    }
    if (event_127787 != NULL) {
        event_127787->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127781", strdup("nothing further"), event_127787, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127780->retval_defunc_0_reduce_res_107172 = defunc_0_reduce_res_107172;
    }
    return err;
}
struct futhark_mc_task_127788 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_107134;
    int64_t free_bytes_111715;
    unsigned char *free_mem_111799;
    unsigned char *free_mem_111816;
    unsigned char *free_ext_mem_111838;
    unsigned char *free_mem_111853;
    unsigned char *free_mem_111855;
    unsigned char *free_mem_111858;
};
struct futhark_mc_segmap_parloop_struct_127790 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_107134;
    int64_t free_bytes_111715;
    unsigned char *free_mem_111799;
    unsigned char *free_mem_111816;
    unsigned char *free_ext_mem_111838;
    unsigned char *free_mem_111853;
    unsigned char *free_mem_111855;
    unsigned char *free_mem_111858;
};
static int futhark_mc_segmap_parloop_127791(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_127790 *futhark_mc_segmap_parloop_struct_127790 = (struct futhark_mc_segmap_parloop_struct_127790 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_127790->ctx;
    struct mc_event *event_127792 = mc_event_new(ctx);
    
    if (event_127792 != NULL)
        event_127792->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_127790->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_segmap_parloop_struct_127790->free_exp_absorb_cutoff_33394;
    double zs_res_107134 = futhark_mc_segmap_parloop_struct_127790->free_zs_res_107134;
    int64_t bytes_111715 = futhark_mc_segmap_parloop_struct_127790->free_bytes_111715;
    struct memblock mem_111799 = {.desc ="mem_111799", .mem =futhark_mc_segmap_parloop_struct_127790->free_mem_111799, .size =0, .references =NULL};
    struct memblock mem_111816 = {.desc ="mem_111816", .mem =futhark_mc_segmap_parloop_struct_127790->free_mem_111816, .size =0, .references =NULL};
    struct memblock ext_mem_111838 = {.desc ="ext_mem_111838", .mem =futhark_mc_segmap_parloop_struct_127790->free_ext_mem_111838, .size =0, .references =NULL};
    struct memblock mem_111853 = {.desc ="mem_111853", .mem =futhark_mc_segmap_parloop_struct_127790->free_mem_111853, .size =0, .references =NULL};
    struct memblock mem_111855 = {.desc ="mem_111855", .mem =futhark_mc_segmap_parloop_struct_127790->free_mem_111855, .size =0, .references =NULL};
    struct memblock mem_111858 = {.desc ="mem_111858", .mem =futhark_mc_segmap_parloop_struct_127790->free_mem_111858, .size =0, .references =NULL};
    int64_t iterations = end - start;
    struct memblock ext_mem_118548;
    
    ext_mem_118548.references = NULL;
    
    struct memblock mem_118547;
    
    mem_118547.references = NULL;
    
    int64_t flat_tid_118535;
    
    flat_tid_118535 = subtask_id;
    {
        int64_t start_123012;
        int64_t end_123013;
        
        start_123012 = start;
        end_123013 = end;
        
        int64_t n_123014 = end_123013 - start_123012;
        
        if (memblock_alloc(ctx, &mem_118547, bytes_111715, "mem_118547")) {
            err = 1;
            goto cleanup;
        }
        for (int64_t SegMap_i_123015 = start_123012; SegMap_i_123015 < start_123012 + n_123014; SegMap_i_123015++) {
            int64_t slice_123016 = m_33388;
            int64_t gtid_118536 = SegMap_i_123015;
            int64_t remnant_123017 = SegMap_i_123015 - gtid_118536;
            double eta_p_118537 = ((double *) mem_111816.mem)[gtid_118536];
            double eta_p_118538 = ((double *) mem_111799.mem)[gtid_118536];
            bool zgze_res_118540 = exp_absorb_cutoff_33394 <= eta_p_118537;
            bool zl_res_118541 = eta_p_118537 < zs_res_107134;
            bool x_118542 = !zgze_res_118540;
            bool y_118543 = zl_res_118541 && x_118542;
            bool cond_118544 = zgze_res_118540 || y_118543;
            int64_t ext_118545;
            
            if (cond_118544) {
                ext_118545 = (int64_t) 0;
            } else {
                ext_118545 = gtid_118536;
            }
            
            int64_t ext_118546;
            
            if (cond_118544) {
                ext_118546 = (int64_t) 1;
            } else {
                ext_118546 = m_33388;
            }
            
            double rescale_res_118549;
            double rescale_res_118550;
            
            if (cond_118544) {
                double log_res_123001 = futrts_log64(eta_p_118537);
                double sqrt_res_123002 = futrts_sqrt64(eta_p_118537);
                double zs_res_123003 = log_res_123001 / 2.0;
                double zp_res_123004 = eta_p_118538 + zs_res_123003;
                
                for (int64_t i_123007 = 0; i_123007 < m_33388; i_123007++) {
                    double eta_p_123009 = ((double *) ext_mem_111838.mem)[i_123007 * m_33388 + gtid_118536];
                    double zt_res_123010 = sqrt_res_123002 * eta_p_123009;
                    
                    ((double *) mem_118547.mem)[i_123007] = zt_res_123010;
                }
                if (memblock_set(ctx, &ext_mem_118548, &mem_118547, "mem_118547") != 0)
                    return 1;
                rescale_res_118549 = sqrt_res_123002;
                rescale_res_118550 = zp_res_123004;
            } else {
                if (memblock_set(ctx, &ext_mem_118548, &ext_mem_111838, "ext_mem_111838") != 0)
                    return 1;
                rescale_res_118549 = eta_p_118537;
                rescale_res_118550 = eta_p_118538;
            }
            ((double *) mem_111853.mem)[gtid_118536] = rescale_res_118549;
            ((double *) mem_111855.mem)[gtid_118536] = rescale_res_118550;
            lmad_copy_8b(ctx, 1, (uint64_t *) mem_111858.mem, gtid_118536 * m_33388, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_118548.mem, ext_118545, (int64_t []) {ext_118546}, (int64_t []) {m_33388});
        }
    }
    
  cleanup:
    {
        if (memblock_unref(ctx, &ext_mem_118548, "ext_mem_118548") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_118547, "mem_118547") != 0)
            return 1;
    }
    if (event_127792 != NULL) {
        event_127792->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127791", strdup("nothing further"), event_127792, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_task_127789(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127788 *futhark_mc_task_127788 = (struct futhark_mc_task_127788 *) args;
    struct futhark_context *ctx = futhark_mc_task_127788->ctx;
    struct mc_event *event_127794 = mc_event_new(ctx);
    
    if (event_127794 != NULL)
        event_127794->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127788->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_task_127788->free_exp_absorb_cutoff_33394;
    double zs_res_107134 = futhark_mc_task_127788->free_zs_res_107134;
    int64_t bytes_111715 = futhark_mc_task_127788->free_bytes_111715;
    struct memblock mem_111799 = {.desc ="mem_111799", .mem =futhark_mc_task_127788->free_mem_111799, .size =0, .references =NULL};
    struct memblock mem_111816 = {.desc ="mem_111816", .mem =futhark_mc_task_127788->free_mem_111816, .size =0, .references =NULL};
    struct memblock ext_mem_111838 = {.desc ="ext_mem_111838", .mem =futhark_mc_task_127788->free_ext_mem_111838, .size =0, .references =NULL};
    struct memblock mem_111853 = {.desc ="mem_111853", .mem =futhark_mc_task_127788->free_mem_111853, .size =0, .references =NULL};
    struct memblock mem_111855 = {.desc ="mem_111855", .mem =futhark_mc_task_127788->free_mem_111855, .size =0, .references =NULL};
    struct memblock mem_111858 = {.desc ="mem_111858", .mem =futhark_mc_task_127788->free_mem_111858, .size =0, .references =NULL};
    int32_t nsubtasks_123000;
    
    nsubtasks_123000 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_127790 futhark_mc_segmap_parloop_struct_127790_;
    
    futhark_mc_segmap_parloop_struct_127790_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_127790_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_127790_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segmap_parloop_struct_127790_.free_zs_res_107134 = zs_res_107134;
    futhark_mc_segmap_parloop_struct_127790_.free_bytes_111715 = bytes_111715;
    futhark_mc_segmap_parloop_struct_127790_.free_mem_111799 = mem_111799.mem;
    futhark_mc_segmap_parloop_struct_127790_.free_mem_111816 = mem_111816.mem;
    futhark_mc_segmap_parloop_struct_127790_.free_ext_mem_111838 = ext_mem_111838.mem;
    futhark_mc_segmap_parloop_struct_127790_.free_mem_111853 = mem_111853.mem;
    futhark_mc_segmap_parloop_struct_127790_.free_mem_111855 = mem_111855.mem;
    futhark_mc_segmap_parloop_struct_127790_.free_mem_111858 = mem_111858.mem;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_127791_task;
    
    futhark_mc_segmap_parloop_127791_task.name = "futhark_mc_segmap_parloop_127791";
    futhark_mc_segmap_parloop_127791_task.fn = futhark_mc_segmap_parloop_127791;
    futhark_mc_segmap_parloop_127791_task.args = &futhark_mc_segmap_parloop_struct_127790_;
    futhark_mc_segmap_parloop_127791_task.iterations = iterations;
    futhark_mc_segmap_parloop_127791_task.info = info;
    
    struct mc_event *event_127793 = mc_event_new(ctx);
    
    if (event_127793 != NULL)
        event_127793->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_127791_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_127791_task);
    
    if (futhark_mc_segmap_parloop_127791_err != 0) {
        err = futhark_mc_segmap_parloop_127791_err;
        goto cleanup;
    }
    if (event_127793 != NULL) {
        event_127793->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127791_total", strdup("nothing further"), event_127793, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_127794 != NULL) {
        event_127794->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_task_127789", strdup("nothing further"), event_127794, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_127795 {
    struct futhark_context *ctx;
    unsigned char *free_mem_111811;
    unsigned char *free_ext_mem_111840;
    int64_t free_flat_tid_118564;
    double *retval_defunc_0_reduce_res_107209;
};
struct futhark_mc_segred_stage_1_parloop_struct_127798 {
    struct futhark_context *ctx;
    unsigned char *free_mem_111811;
    unsigned char *free_ext_mem_111840;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123020;
};
static int futhark_mc_segred_stage_1_parloop_127799(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127798 *futhark_mc_segred_stage_1_parloop_struct_127798 = (struct futhark_mc_segred_stage_1_parloop_struct_127798 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127798->ctx;
    struct mc_event *event_127800 = mc_event_new(ctx);
    
    if (event_127800 != NULL)
        event_127800->bef = get_wall_time();
    
    struct memblock mem_111811 = {.desc ="mem_111811", .mem =futhark_mc_segred_stage_1_parloop_struct_127798->free_mem_111811, .size =0, .references =NULL};
    struct memblock ext_mem_111840 = {.desc ="ext_mem_111840", .mem =futhark_mc_segred_stage_1_parloop_struct_127798->free_ext_mem_111840, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_123020 = {.desc ="reduce_stage_1_tid_res_arr_mem_123020", .mem =futhark_mc_segred_stage_1_parloop_struct_127798->free_reduce_stage_1_tid_res_arr_mem_123020, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118564;
    
    flat_tid_118564 = subtask_id;
    {
        double eta_p_123022;
        double eta_p_123023;
        double local_acc_123025 = 0.0;
        double eta_p_118566;
        double eta_p_118567;
        double local_acc_123026 = 0.0;
        int64_t start_123027;
        int64_t end_123028;
        
        start_123027 = start;
        end_123028 = end;
        
        int64_t n_123029 = end_123028 - start_123027;
        
        for (int64_t SegRed_i_123030 = start_123027; SegRed_i_123030 < start_123027 + n_123029; SegRed_i_123030++) {
            int64_t gtid_118565 = SegRed_i_123030;
            double eta_p_118569 = ((double *) mem_111811.mem)[gtid_118565];
            double eta_p_118570 = ((double *) ext_mem_111840.mem)[gtid_118565];
            double zs_res_118571 = eta_p_118569 / eta_p_118570;
            double zm_res_118572 = zs_res_118571 - 1.0;
            double abs_res_118573 = fabs64(zm_res_118572);
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_118566 = local_acc_123026;
            }
            // Load next params
            {
                eta_p_118567 = abs_res_118573;
            }
            // SegRed body
            {
                double max_res_118568 = fmax64(eta_p_118566, eta_p_118567);
                
                local_acc_123026 = max_res_118568;
            }
        }
        
        int64_t uni_i_123031 = 0;
        
        {
            int64_t gtid_118565 = uni_i_123031;
            
            // Load accum params
            {
                eta_p_123022 = local_acc_123025;
            }
            // Load next params
            {
                eta_p_123023 = local_acc_123026;
            }
            // SegRed body
            {
                double max_res_123024 = fmax64(eta_p_123022, eta_p_123023);
                
                local_acc_123025 = max_res_123024;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_123020.mem)[flat_tid_118564] = local_acc_123025;
    }
    
  cleanup:
    { }
    if (event_127800 != NULL) {
        event_127800->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127799", strdup("nothing further"), event_127800, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127796(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127795 *futhark_mc_task_127795 = (struct futhark_mc_task_127795 *) args;
    struct futhark_context *ctx = futhark_mc_task_127795->ctx;
    struct mc_event *event_127802 = mc_event_new(ctx);
    
    if (event_127802 != NULL)
        event_127802->bef = get_wall_time();
    
    struct memblock mem_111811 = {.desc ="mem_111811", .mem =futhark_mc_task_127795->free_mem_111811, .size =0, .references =NULL};
    struct memblock ext_mem_111840 = {.desc ="ext_mem_111840", .mem =futhark_mc_task_127795->free_ext_mem_111840, .size =0, .references =NULL};
    int64_t flat_tid_118564 = futhark_mc_task_127795->free_flat_tid_118564;
    double defunc_0_reduce_res_107209 = *futhark_mc_task_127795->retval_defunc_0_reduce_res_107209;
    int64_t reduce_stage_1_tid_res_arr_mem_123020_cached_sizze_127797 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123020 = NULL;
    int32_t nsubtasks_123019;
    
    nsubtasks_123019 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_123020_cached_sizze_127797 < (int64_t) 8 * nsubtasks_123019) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123020, &reduce_stage_1_tid_res_arr_mem_123020_cached_sizze_127797, (int64_t) 8 * nsubtasks_123019);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127798 futhark_mc_segred_stage_1_parloop_struct_127798_;
    
    futhark_mc_segred_stage_1_parloop_struct_127798_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127798_.free_mem_111811 = mem_111811.mem;
    futhark_mc_segred_stage_1_parloop_struct_127798_.free_ext_mem_111840 = ext_mem_111840.mem;
    futhark_mc_segred_stage_1_parloop_struct_127798_.free_reduce_stage_1_tid_res_arr_mem_123020 = reduce_stage_1_tid_res_arr_mem_123020;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127799_task;
    
    futhark_mc_segred_stage_1_parloop_127799_task.name = "futhark_mc_segred_stage_1_parloop_127799";
    futhark_mc_segred_stage_1_parloop_127799_task.fn = futhark_mc_segred_stage_1_parloop_127799;
    futhark_mc_segred_stage_1_parloop_127799_task.args = &futhark_mc_segred_stage_1_parloop_struct_127798_;
    futhark_mc_segred_stage_1_parloop_127799_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127799_task.info = info;
    
    struct mc_event *event_127801 = mc_event_new(ctx);
    
    if (event_127801 != NULL)
        event_127801->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127799_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127799_task);
    
    if (futhark_mc_segred_stage_1_parloop_127799_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127799_err;
        goto cleanup;
    }
    if (event_127801 != NULL) {
        event_127801->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127799_total", strdup("nothing further"), event_127801, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_107209 = 0.0;
    }
    
    double eta_p_123032;
    double eta_p_123033;
    
    for (int32_t i_123035 = 0; i_123035 < nsubtasks_123019; i_123035++) {
        flat_tid_118564 = i_123035;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_123032 = defunc_0_reduce_res_107209;
            }
            // load next params
            {
                eta_p_123033 = ((double *) reduce_stage_1_tid_res_arr_mem_123020)[flat_tid_118564];
            }
            // red body
            {
                double max_res_123034 = fmax64(eta_p_123032, eta_p_123033);
                
                defunc_0_reduce_res_107209 = max_res_123034;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_123020);
    }
    if (event_127802 != NULL) {
        event_127802->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127796", strdup("nothing further"), event_127802, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127795->retval_defunc_0_reduce_res_107209 = defunc_0_reduce_res_107209;
    }
    return err;
}
struct futhark_mc_task_127803 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_44883;
    double free_zs_res_44885;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_param_118574;
    unsigned char *free_mem_param_118575;
    unsigned char *free_mem_param_118578;
    int64_t free_ctx_param_ext_118579;
    int64_t free_ctx_param_ext_118580;
    int64_t free_ctx_param_ext_118581;
    int64_t free_flat_tid_118591;
    int64_t free_flat_tid_118613;
    bool *retval_defunc_0_reduce_res_118589;
    unsigned char *retval_mem_118588;
};
struct futhark_mc_segred_stage_1_parloop_struct_127806 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_44883;
    double free_zs_res_44885;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_param_118574;
    unsigned char *free_mem_param_118575;
    unsigned char *free_mem_param_118578;
    int64_t free_ctx_param_ext_118579;
    int64_t free_ctx_param_ext_118580;
    int64_t free_ctx_param_ext_118581;
    unsigned char *free_mem_118588;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123051;
};
static int futhark_mc_segred_stage_1_parloop_127807(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127806 *futhark_mc_segred_stage_1_parloop_struct_127806 = (struct futhark_mc_segred_stage_1_parloop_struct_127806 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127806->ctx;
    struct mc_event *event_127808 = mc_event_new(ctx);
    
    if (event_127808 != NULL)
        event_127808->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127806->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_segred_stage_1_parloop_struct_127806->free_exp_absorb_cutoff_33394;
    double zs_res_44883 = futhark_mc_segred_stage_1_parloop_struct_127806->free_zs_res_44883;
    double zs_res_44885 = futhark_mc_segred_stage_1_parloop_struct_127806->free_zs_res_44885;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_127806->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_127806->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_118574 = {.desc ="mem_param_118574", .mem =futhark_mc_segred_stage_1_parloop_struct_127806->free_mem_param_118574, .size =0, .references =NULL};
    struct memblock mem_param_118575 = {.desc ="mem_param_118575", .mem =futhark_mc_segred_stage_1_parloop_struct_127806->free_mem_param_118575, .size =0, .references =NULL};
    struct memblock mem_param_118578 = {.desc ="mem_param_118578", .mem =futhark_mc_segred_stage_1_parloop_struct_127806->free_mem_param_118578, .size =0, .references =NULL};
    int64_t ctx_param_ext_118579 = futhark_mc_segred_stage_1_parloop_struct_127806->free_ctx_param_ext_118579;
    int64_t ctx_param_ext_118580 = futhark_mc_segred_stage_1_parloop_struct_127806->free_ctx_param_ext_118580;
    int64_t ctx_param_ext_118581 = futhark_mc_segred_stage_1_parloop_struct_127806->free_ctx_param_ext_118581;
    struct memblock mem_118588 = {.desc ="mem_118588", .mem =futhark_mc_segred_stage_1_parloop_struct_127806->free_mem_118588, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_123051 = {.desc ="reduce_stage_1_tid_res_arr_mem_123051", .mem =futhark_mc_segred_stage_1_parloop_struct_127806->free_reduce_stage_1_tid_res_arr_mem_123051, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118613;
    
    flat_tid_118613 = subtask_id;
    {
        bool eta_p_123053;
        bool eta_p_123054;
        bool local_acc_123056 = 0;
        bool eta_p_118615;
        bool eta_p_118616;
        bool local_acc_123057 = 0;
        int64_t start_123058;
        int64_t end_123059;
        
        start_123058 = start;
        end_123059 = end;
        
        int64_t n_123060 = end_123059 - start_123058;
        
        for (int64_t SegRed_i_123061 = start_123058; SegRed_i_123061 < start_123058 + n_123060; SegRed_i_123061++) {
            int64_t gtid_118614 = SegRed_i_123061;
            double eta_p_118618 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + gtid_118614];
            double eta_p_118619 = ((double *) mem_param_118578.mem)[gtid_118614];
            double defunc_0_reduce_res_118620;
            double redout_118622 = 0.0;
            
            for (int64_t i_118621 = 0; i_118621 < m_33388; i_118621++) {
                double eta_p_118623 = ((double *) mem_param_118575.mem)[i_118621];
                double eta_p_118624 = ((double *) mem_param_118574.mem)[ctx_param_ext_118579 + (i_118621 * ctx_param_ext_118580 + gtid_118614 * ctx_param_ext_118581)];
                double zt_res_118625 = eta_p_118623 * eta_p_118624;
                double zp_res_118626 = zt_res_118625 + redout_118622;
                double redout_tmp_123062 = zp_res_118626;
                
                redout_118622 = redout_tmp_123062;
            }
            defunc_0_reduce_res_118620 = redout_118622;
            
            double zs_res_118627 = defunc_0_reduce_res_118620 / eta_p_118618;
            double ztzt_res_118628 = fpow64(zs_res_118627, zs_res_44883);
            double zt_res_118629 = zs_res_44885 * eta_p_118619;
            double exp_res_118630 = futrts_exp64(zt_res_118629);
            double zt_res_118631 = ztzt_res_118628 * exp_res_118630;
            bool zgze_res_118632 = exp_absorb_cutoff_33394 <= zt_res_118631;
            
            // save map-out results
            {
                ((double *) mem_118588.mem)[gtid_118614] = zt_res_118631;
            }
            // Load accum params
            {
                eta_p_118615 = local_acc_123057;
            }
            // Load next params
            {
                eta_p_118616 = zgze_res_118632;
            }
            // SegRed body
            {
                bool defunc_0_op_res_118617 = eta_p_118615 || eta_p_118616;
                
                local_acc_123057 = defunc_0_op_res_118617;
            }
        }
        
        int64_t uni_i_123063 = 0;
        
        {
            int64_t gtid_118614 = uni_i_123063;
            
            // Load accum params
            {
                eta_p_123053 = local_acc_123056;
            }
            // Load next params
            {
                eta_p_123054 = local_acc_123057;
            }
            // SegRed body
            {
                bool defunc_0_op_res_123055 = eta_p_123053 || eta_p_123054;
                
                local_acc_123056 = defunc_0_op_res_123055;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_123051.mem)[flat_tid_118613] = local_acc_123056;
    }
    
  cleanup:
    { }
    if (event_127808 != NULL) {
        event_127808->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127807", strdup("nothing further"), event_127808, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127804(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127803 *futhark_mc_task_127803 = (struct futhark_mc_task_127803 *) args;
    struct futhark_context *ctx = futhark_mc_task_127803->ctx;
    struct mc_event *event_127810 = mc_event_new(ctx);
    
    if (event_127810 != NULL)
        event_127810->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127803->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_task_127803->free_exp_absorb_cutoff_33394;
    double zs_res_44883 = futhark_mc_task_127803->free_zs_res_44883;
    double zs_res_44885 = futhark_mc_task_127803->free_zs_res_44885;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_127803->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_127803->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_118574 = {.desc ="mem_param_118574", .mem =futhark_mc_task_127803->free_mem_param_118574, .size =0, .references =NULL};
    struct memblock mem_param_118575 = {.desc ="mem_param_118575", .mem =futhark_mc_task_127803->free_mem_param_118575, .size =0, .references =NULL};
    struct memblock mem_param_118578 = {.desc ="mem_param_118578", .mem =futhark_mc_task_127803->free_mem_param_118578, .size =0, .references =NULL};
    int64_t ctx_param_ext_118579 = futhark_mc_task_127803->free_ctx_param_ext_118579;
    int64_t ctx_param_ext_118580 = futhark_mc_task_127803->free_ctx_param_ext_118580;
    int64_t ctx_param_ext_118581 = futhark_mc_task_127803->free_ctx_param_ext_118581;
    int64_t flat_tid_118591 = futhark_mc_task_127803->free_flat_tid_118591;
    int64_t flat_tid_118613 = futhark_mc_task_127803->free_flat_tid_118613;
    bool defunc_0_reduce_res_118589 = *futhark_mc_task_127803->retval_defunc_0_reduce_res_118589;
    struct memblock mem_118588 = {.desc ="mem_118588", .mem =futhark_mc_task_127803->retval_mem_118588, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_123051_cached_sizze_127805 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123051 = NULL;
    int32_t nsubtasks_123050;
    
    nsubtasks_123050 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_123051_cached_sizze_127805 < nsubtasks_123050) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123051, &reduce_stage_1_tid_res_arr_mem_123051_cached_sizze_127805, nsubtasks_123050);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127806 futhark_mc_segred_stage_1_parloop_struct_127806_;
    
    futhark_mc_segred_stage_1_parloop_struct_127806_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127806_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127806_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segred_stage_1_parloop_struct_127806_.free_zs_res_44883 = zs_res_44883;
    futhark_mc_segred_stage_1_parloop_struct_127806_.free_zs_res_44885 = zs_res_44885;
    futhark_mc_segred_stage_1_parloop_struct_127806_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_127806_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_127806_.free_mem_param_118574 = mem_param_118574.mem;
    futhark_mc_segred_stage_1_parloop_struct_127806_.free_mem_param_118575 = mem_param_118575.mem;
    futhark_mc_segred_stage_1_parloop_struct_127806_.free_mem_param_118578 = mem_param_118578.mem;
    futhark_mc_segred_stage_1_parloop_struct_127806_.free_ctx_param_ext_118579 = ctx_param_ext_118579;
    futhark_mc_segred_stage_1_parloop_struct_127806_.free_ctx_param_ext_118580 = ctx_param_ext_118580;
    futhark_mc_segred_stage_1_parloop_struct_127806_.free_ctx_param_ext_118581 = ctx_param_ext_118581;
    futhark_mc_segred_stage_1_parloop_struct_127806_.free_mem_118588 = mem_118588.mem;
    futhark_mc_segred_stage_1_parloop_struct_127806_.free_reduce_stage_1_tid_res_arr_mem_123051 = reduce_stage_1_tid_res_arr_mem_123051;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127807_task;
    
    futhark_mc_segred_stage_1_parloop_127807_task.name = "futhark_mc_segred_stage_1_parloop_127807";
    futhark_mc_segred_stage_1_parloop_127807_task.fn = futhark_mc_segred_stage_1_parloop_127807;
    futhark_mc_segred_stage_1_parloop_127807_task.args = &futhark_mc_segred_stage_1_parloop_struct_127806_;
    futhark_mc_segred_stage_1_parloop_127807_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127807_task.info = info;
    
    struct mc_event *event_127809 = mc_event_new(ctx);
    
    if (event_127809 != NULL)
        event_127809->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127807_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127807_task);
    
    if (futhark_mc_segred_stage_1_parloop_127807_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127807_err;
        goto cleanup;
    }
    if (event_127809 != NULL) {
        event_127809->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127807_total", strdup("nothing further"), event_127809, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_118589 = 0;
    }
    
    bool eta_p_123064;
    bool eta_p_123065;
    
    for (int32_t i_123067 = 0; i_123067 < nsubtasks_123050; i_123067++) {
        flat_tid_118613 = i_123067;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_123064 = defunc_0_reduce_res_118589;
            }
            // load next params
            {
                eta_p_123065 = ((bool *) reduce_stage_1_tid_res_arr_mem_123051)[flat_tid_118613];
            }
            // red body
            {
                bool defunc_0_op_res_123066 = eta_p_123064 || eta_p_123065;
                
                defunc_0_reduce_res_118589 = defunc_0_op_res_123066;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_123051);
    }
    if (event_127810 != NULL) {
        event_127810->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127804", strdup("nothing further"), event_127810, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127803->retval_defunc_0_reduce_res_118589 = defunc_0_reduce_res_118589;
        futhark_mc_task_127803->retval_mem_118588 = mem_118588.mem;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_127813 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_44883;
    double free_zs_res_44885;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_param_118574;
    unsigned char *free_mem_param_118575;
    unsigned char *free_mem_param_118578;
    int64_t free_ctx_param_ext_118579;
    int64_t free_ctx_param_ext_118580;
    int64_t free_ctx_param_ext_118581;
    unsigned char *free_mem_118588;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123069;
};
struct futhark_mc_task_127815 {
    struct futhark_context *ctx;
    unsigned char *free_mem_param_118574;
    unsigned char *free_mem_param_118575;
    int64_t free_ctx_param_ext_118579;
    int64_t free_ctx_param_ext_118580;
    int64_t free_ctx_param_ext_118581;
    int64_t free_gtid_118592;
    int64_t free_flat_tid_118599;
    double *retval_defunc_0_reduce_res_118598;
};
struct futhark_mc_segred_stage_1_parloop_struct_127818 {
    struct futhark_context *ctx;
    unsigned char *free_mem_param_118574;
    unsigned char *free_mem_param_118575;
    int64_t free_ctx_param_ext_118579;
    int64_t free_ctx_param_ext_118580;
    int64_t free_ctx_param_ext_118581;
    int64_t free_gtid_118592;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123081;
};
static int futhark_mc_segred_stage_1_parloop_127819(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127818 *futhark_mc_segred_stage_1_parloop_struct_127818 = (struct futhark_mc_segred_stage_1_parloop_struct_127818 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127818->ctx;
    struct mc_event *event_127820 = mc_event_new(ctx);
    
    if (event_127820 != NULL)
        event_127820->bef = get_wall_time();
    
    struct memblock mem_param_118574 = {.desc ="mem_param_118574", .mem =futhark_mc_segred_stage_1_parloop_struct_127818->free_mem_param_118574, .size =0, .references =NULL};
    struct memblock mem_param_118575 = {.desc ="mem_param_118575", .mem =futhark_mc_segred_stage_1_parloop_struct_127818->free_mem_param_118575, .size =0, .references =NULL};
    int64_t ctx_param_ext_118579 = futhark_mc_segred_stage_1_parloop_struct_127818->free_ctx_param_ext_118579;
    int64_t ctx_param_ext_118580 = futhark_mc_segred_stage_1_parloop_struct_127818->free_ctx_param_ext_118580;
    int64_t ctx_param_ext_118581 = futhark_mc_segred_stage_1_parloop_struct_127818->free_ctx_param_ext_118581;
    int64_t gtid_118592 = futhark_mc_segred_stage_1_parloop_struct_127818->free_gtid_118592;
    struct memblock reduce_stage_1_tid_res_arr_mem_123081 = {.desc ="reduce_stage_1_tid_res_arr_mem_123081", .mem =futhark_mc_segred_stage_1_parloop_struct_127818->free_reduce_stage_1_tid_res_arr_mem_123081, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118599;
    
    flat_tid_118599 = subtask_id;
    {
        double eta_p_123083;
        double eta_p_123084;
        double local_acc_123086 = 0.0;
        double eta_p_118601;
        double eta_p_118602;
        double local_acc_123087 = 0.0;
        int64_t start_123088;
        int64_t end_123089;
        
        start_123088 = start;
        end_123089 = end;
        
        int64_t n_123090 = end_123089 - start_123088;
        
        for (int64_t SegRed_i_123091 = start_123088; SegRed_i_123091 < start_123088 + n_123090; SegRed_i_123091++) {
            int64_t gtid_118600 = SegRed_i_123091;
            double eta_p_118604 = ((double *) mem_param_118575.mem)[gtid_118600];
            double eta_p_118605 = ((double *) mem_param_118574.mem)[ctx_param_ext_118579 + (gtid_118600 * ctx_param_ext_118580 + gtid_118592 * ctx_param_ext_118581)];
            double zt_res_118606 = eta_p_118604 * eta_p_118605;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_118601 = local_acc_123087;
            }
            // Load next params
            {
                eta_p_118602 = zt_res_118606;
            }
            // SegRed body
            {
                double zp_res_118603 = eta_p_118601 + eta_p_118602;
                
                local_acc_123087 = zp_res_118603;
            }
        }
        
        int64_t uni_i_123092 = 0;
        
        {
            int64_t gtid_118600 = uni_i_123092;
            
            // Load accum params
            {
                eta_p_123083 = local_acc_123086;
            }
            // Load next params
            {
                eta_p_123084 = local_acc_123087;
            }
            // SegRed body
            {
                double zp_res_123085 = eta_p_123083 + eta_p_123084;
                
                local_acc_123086 = zp_res_123085;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_123081.mem)[flat_tid_118599] = local_acc_123086;
    }
    
  cleanup:
    { }
    if (event_127820 != NULL) {
        event_127820->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127819", strdup("nothing further"), event_127820, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127816(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127815 *futhark_mc_task_127815 = (struct futhark_mc_task_127815 *) args;
    struct futhark_context *ctx = futhark_mc_task_127815->ctx;
    struct mc_event *event_127822 = mc_event_new(ctx);
    
    if (event_127822 != NULL)
        event_127822->bef = get_wall_time();
    
    struct memblock mem_param_118574 = {.desc ="mem_param_118574", .mem =futhark_mc_task_127815->free_mem_param_118574, .size =0, .references =NULL};
    struct memblock mem_param_118575 = {.desc ="mem_param_118575", .mem =futhark_mc_task_127815->free_mem_param_118575, .size =0, .references =NULL};
    int64_t ctx_param_ext_118579 = futhark_mc_task_127815->free_ctx_param_ext_118579;
    int64_t ctx_param_ext_118580 = futhark_mc_task_127815->free_ctx_param_ext_118580;
    int64_t ctx_param_ext_118581 = futhark_mc_task_127815->free_ctx_param_ext_118581;
    int64_t gtid_118592 = futhark_mc_task_127815->free_gtid_118592;
    int64_t flat_tid_118599 = futhark_mc_task_127815->free_flat_tid_118599;
    double defunc_0_reduce_res_118598 = *futhark_mc_task_127815->retval_defunc_0_reduce_res_118598;
    int64_t reduce_stage_1_tid_res_arr_mem_123081_cached_sizze_127817 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123081 = NULL;
    int32_t nsubtasks_123080;
    
    nsubtasks_123080 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_123081_cached_sizze_127817 < (int64_t) 8 * nsubtasks_123080) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123081, &reduce_stage_1_tid_res_arr_mem_123081_cached_sizze_127817, (int64_t) 8 * nsubtasks_123080);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127818 futhark_mc_segred_stage_1_parloop_struct_127818_;
    
    futhark_mc_segred_stage_1_parloop_struct_127818_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127818_.free_mem_param_118574 = mem_param_118574.mem;
    futhark_mc_segred_stage_1_parloop_struct_127818_.free_mem_param_118575 = mem_param_118575.mem;
    futhark_mc_segred_stage_1_parloop_struct_127818_.free_ctx_param_ext_118579 = ctx_param_ext_118579;
    futhark_mc_segred_stage_1_parloop_struct_127818_.free_ctx_param_ext_118580 = ctx_param_ext_118580;
    futhark_mc_segred_stage_1_parloop_struct_127818_.free_ctx_param_ext_118581 = ctx_param_ext_118581;
    futhark_mc_segred_stage_1_parloop_struct_127818_.free_gtid_118592 = gtid_118592;
    futhark_mc_segred_stage_1_parloop_struct_127818_.free_reduce_stage_1_tid_res_arr_mem_123081 = reduce_stage_1_tid_res_arr_mem_123081;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127819_task;
    
    futhark_mc_segred_stage_1_parloop_127819_task.name = "futhark_mc_segred_stage_1_parloop_127819";
    futhark_mc_segred_stage_1_parloop_127819_task.fn = futhark_mc_segred_stage_1_parloop_127819;
    futhark_mc_segred_stage_1_parloop_127819_task.args = &futhark_mc_segred_stage_1_parloop_struct_127818_;
    futhark_mc_segred_stage_1_parloop_127819_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127819_task.info = info;
    
    struct mc_event *event_127821 = mc_event_new(ctx);
    
    if (event_127821 != NULL)
        event_127821->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127819_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127819_task);
    
    if (futhark_mc_segred_stage_1_parloop_127819_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127819_err;
        goto cleanup;
    }
    if (event_127821 != NULL) {
        event_127821->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127819_total", strdup("nothing further"), event_127821, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_118598 = 0.0;
    }
    
    double eta_p_123093;
    double eta_p_123094;
    
    for (int32_t i_123096 = 0; i_123096 < nsubtasks_123080; i_123096++) {
        flat_tid_118599 = i_123096;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_123093 = defunc_0_reduce_res_118598;
            }
            // load next params
            {
                eta_p_123094 = ((double *) reduce_stage_1_tid_res_arr_mem_123081)[flat_tid_118599];
            }
            // red body
            {
                double zp_res_123095 = eta_p_123093 + eta_p_123094;
                
                defunc_0_reduce_res_118598 = zp_res_123095;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_123081);
    }
    if (event_127822 != NULL) {
        event_127822->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127816", strdup("nothing further"), event_127822, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127815->retval_defunc_0_reduce_res_118598 = defunc_0_reduce_res_118598;
    }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_127814(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127813 *futhark_mc_segred_stage_1_parloop_struct_127813 = (struct futhark_mc_segred_stage_1_parloop_struct_127813 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127813->ctx;
    struct mc_event *event_127823 = mc_event_new(ctx);
    
    if (event_127823 != NULL)
        event_127823->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127813->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_segred_stage_1_parloop_struct_127813->free_exp_absorb_cutoff_33394;
    double zs_res_44883 = futhark_mc_segred_stage_1_parloop_struct_127813->free_zs_res_44883;
    double zs_res_44885 = futhark_mc_segred_stage_1_parloop_struct_127813->free_zs_res_44885;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_127813->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_127813->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_118574 = {.desc ="mem_param_118574", .mem =futhark_mc_segred_stage_1_parloop_struct_127813->free_mem_param_118574, .size =0, .references =NULL};
    struct memblock mem_param_118575 = {.desc ="mem_param_118575", .mem =futhark_mc_segred_stage_1_parloop_struct_127813->free_mem_param_118575, .size =0, .references =NULL};
    struct memblock mem_param_118578 = {.desc ="mem_param_118578", .mem =futhark_mc_segred_stage_1_parloop_struct_127813->free_mem_param_118578, .size =0, .references =NULL};
    int64_t ctx_param_ext_118579 = futhark_mc_segred_stage_1_parloop_struct_127813->free_ctx_param_ext_118579;
    int64_t ctx_param_ext_118580 = futhark_mc_segred_stage_1_parloop_struct_127813->free_ctx_param_ext_118580;
    int64_t ctx_param_ext_118581 = futhark_mc_segred_stage_1_parloop_struct_127813->free_ctx_param_ext_118581;
    struct memblock mem_118588 = {.desc ="mem_118588", .mem =futhark_mc_segred_stage_1_parloop_struct_127813->free_mem_118588, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_123069 = {.desc ="reduce_stage_1_tid_res_arr_mem_123069", .mem =futhark_mc_segred_stage_1_parloop_struct_127813->free_reduce_stage_1_tid_res_arr_mem_123069, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118591;
    
    flat_tid_118591 = subtask_id;
    {
        bool eta_p_123071;
        bool eta_p_123072;
        bool local_acc_123074 = 0;
        bool eta_p_118593;
        bool eta_p_118594;
        bool local_acc_123075 = 0;
        int64_t start_123076;
        int64_t end_123077;
        
        start_123076 = start;
        end_123077 = end;
        
        int64_t n_123078 = end_123077 - start_123076;
        
        for (int64_t SegRed_i_123079 = start_123076; SegRed_i_123079 < start_123076 + n_123078; SegRed_i_123079++) {
            int64_t gtid_118592 = SegRed_i_123079;
            double eta_p_118596 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + gtid_118592];
            double eta_p_118597 = ((double *) mem_param_118578.mem)[gtid_118592];
            double defunc_0_reduce_res_118598;
            int64_t flat_tid_118599 = (int64_t) 0;
            
            defunc_0_reduce_res_118598 = 0.0;
            
            struct futhark_mc_task_127815 futhark_mc_task_127815_;
            
            futhark_mc_task_127815_.ctx = ctx;
            futhark_mc_task_127815_.free_mem_param_118574 = mem_param_118574.mem;
            futhark_mc_task_127815_.free_mem_param_118575 = mem_param_118575.mem;
            futhark_mc_task_127815_.free_ctx_param_ext_118579 = ctx_param_ext_118579;
            futhark_mc_task_127815_.free_ctx_param_ext_118580 = ctx_param_ext_118580;
            futhark_mc_task_127815_.free_ctx_param_ext_118581 = ctx_param_ext_118581;
            futhark_mc_task_127815_.free_gtid_118592 = gtid_118592;
            futhark_mc_task_127815_.free_flat_tid_118599 = flat_tid_118599;
            futhark_mc_task_127815_.retval_defunc_0_reduce_res_118598 = (double *) &defunc_0_reduce_res_118598;
            #if ISPC
            futhark_mc_task_127815_.retval_defunc_0_reduce_res_118598 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_127815_task;
            
            futhark_mc_task_127815_task.args = &futhark_mc_task_127815_;
            futhark_mc_task_127815_task.top_level_fn = futhark_mc_segred_task_127816;
            futhark_mc_task_127815_task.name = "futhark_mc_segred_task_127816";
            futhark_mc_task_127815_task.iterations = m_33388;
            futhark_mc_task_127815_task.task_time = &ctx->program->futhark_mc_segred_task_127816_total_time;
            futhark_mc_task_127815_task.task_iter = &ctx->program->futhark_mc_segred_task_127816_total_iter;
            futhark_mc_task_127815_task.sched = STATIC;
            futhark_mc_task_127815_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_127816_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127815_task);
            
            if (futhark_mc_segred_task_127816_err != 0) {
                err = futhark_mc_segred_task_127816_err;
                goto cleanup;
            }
            
            double zs_res_118607 = defunc_0_reduce_res_118598 / eta_p_118596;
            double ztzt_res_118608 = fpow64(zs_res_118607, zs_res_44883);
            double zt_res_118609 = zs_res_44885 * eta_p_118597;
            double exp_res_118610 = futrts_exp64(zt_res_118609);
            double zt_res_118611 = ztzt_res_118608 * exp_res_118610;
            bool zgze_res_118612 = exp_absorb_cutoff_33394 <= zt_res_118611;
            
            // save map-out results
            {
                ((double *) mem_118588.mem)[gtid_118592] = zt_res_118611;
            }
            // Load accum params
            {
                eta_p_118593 = local_acc_123075;
            }
            // Load next params
            {
                eta_p_118594 = zgze_res_118612;
            }
            // SegRed body
            {
                bool defunc_0_op_res_118595 = eta_p_118593 || eta_p_118594;
                
                local_acc_123075 = defunc_0_op_res_118595;
            }
        }
        
        int64_t uni_i_123097 = 0;
        
        {
            int64_t gtid_118592 = uni_i_123097;
            
            // Load accum params
            {
                eta_p_123071 = local_acc_123074;
            }
            // Load next params
            {
                eta_p_123072 = local_acc_123075;
            }
            // SegRed body
            {
                bool defunc_0_op_res_123073 = eta_p_123071 || eta_p_123072;
                
                local_acc_123074 = defunc_0_op_res_123073;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_123069.mem)[flat_tid_118591] = local_acc_123074;
    }
    
  cleanup:
    { }
    if (event_127823 != NULL) {
        event_127823->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127814", strdup("nothing further"), event_127823, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_127811(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127803 *futhark_mc_task_127803 = (struct futhark_mc_task_127803 *) args;
    struct futhark_context *ctx = futhark_mc_task_127803->ctx;
    struct mc_event *event_127825 = mc_event_new(ctx);
    
    if (event_127825 != NULL)
        event_127825->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127803->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_task_127803->free_exp_absorb_cutoff_33394;
    double zs_res_44883 = futhark_mc_task_127803->free_zs_res_44883;
    double zs_res_44885 = futhark_mc_task_127803->free_zs_res_44885;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_127803->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_127803->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_118574 = {.desc ="mem_param_118574", .mem =futhark_mc_task_127803->free_mem_param_118574, .size =0, .references =NULL};
    struct memblock mem_param_118575 = {.desc ="mem_param_118575", .mem =futhark_mc_task_127803->free_mem_param_118575, .size =0, .references =NULL};
    struct memblock mem_param_118578 = {.desc ="mem_param_118578", .mem =futhark_mc_task_127803->free_mem_param_118578, .size =0, .references =NULL};
    int64_t ctx_param_ext_118579 = futhark_mc_task_127803->free_ctx_param_ext_118579;
    int64_t ctx_param_ext_118580 = futhark_mc_task_127803->free_ctx_param_ext_118580;
    int64_t ctx_param_ext_118581 = futhark_mc_task_127803->free_ctx_param_ext_118581;
    int64_t flat_tid_118591 = futhark_mc_task_127803->free_flat_tid_118591;
    int64_t flat_tid_118613 = futhark_mc_task_127803->free_flat_tid_118613;
    bool defunc_0_reduce_res_118589 = *futhark_mc_task_127803->retval_defunc_0_reduce_res_118589;
    struct memblock mem_118588 = {.desc ="mem_118588", .mem =futhark_mc_task_127803->retval_mem_118588, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_123069_cached_sizze_127812 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123069 = NULL;
    int32_t nsubtasks_123068;
    
    nsubtasks_123068 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_123069_cached_sizze_127812 < nsubtasks_123068) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123069, &reduce_stage_1_tid_res_arr_mem_123069_cached_sizze_127812, nsubtasks_123068);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127813 futhark_mc_segred_stage_1_parloop_struct_127813_;
    
    futhark_mc_segred_stage_1_parloop_struct_127813_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127813_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127813_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segred_stage_1_parloop_struct_127813_.free_zs_res_44883 = zs_res_44883;
    futhark_mc_segred_stage_1_parloop_struct_127813_.free_zs_res_44885 = zs_res_44885;
    futhark_mc_segred_stage_1_parloop_struct_127813_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_127813_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_127813_.free_mem_param_118574 = mem_param_118574.mem;
    futhark_mc_segred_stage_1_parloop_struct_127813_.free_mem_param_118575 = mem_param_118575.mem;
    futhark_mc_segred_stage_1_parloop_struct_127813_.free_mem_param_118578 = mem_param_118578.mem;
    futhark_mc_segred_stage_1_parloop_struct_127813_.free_ctx_param_ext_118579 = ctx_param_ext_118579;
    futhark_mc_segred_stage_1_parloop_struct_127813_.free_ctx_param_ext_118580 = ctx_param_ext_118580;
    futhark_mc_segred_stage_1_parloop_struct_127813_.free_ctx_param_ext_118581 = ctx_param_ext_118581;
    futhark_mc_segred_stage_1_parloop_struct_127813_.free_mem_118588 = mem_118588.mem;
    futhark_mc_segred_stage_1_parloop_struct_127813_.free_reduce_stage_1_tid_res_arr_mem_123069 = reduce_stage_1_tid_res_arr_mem_123069;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127814_task;
    
    futhark_mc_segred_stage_1_parloop_127814_task.name = "futhark_mc_segred_stage_1_parloop_127814";
    futhark_mc_segred_stage_1_parloop_127814_task.fn = futhark_mc_segred_stage_1_parloop_127814;
    futhark_mc_segred_stage_1_parloop_127814_task.args = &futhark_mc_segred_stage_1_parloop_struct_127813_;
    futhark_mc_segred_stage_1_parloop_127814_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127814_task.info = info;
    
    struct mc_event *event_127824 = mc_event_new(ctx);
    
    if (event_127824 != NULL)
        event_127824->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127814_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127814_task);
    
    if (futhark_mc_segred_stage_1_parloop_127814_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127814_err;
        goto cleanup;
    }
    if (event_127824 != NULL) {
        event_127824->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127814_total", strdup("nothing further"), event_127824, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_118589 = 0;
    }
    
    bool eta_p_123098;
    bool eta_p_123099;
    
    for (int32_t i_123101 = 0; i_123101 < nsubtasks_123068; i_123101++) {
        flat_tid_118591 = i_123101;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_123098 = defunc_0_reduce_res_118589;
            }
            // load next params
            {
                eta_p_123099 = ((bool *) reduce_stage_1_tid_res_arr_mem_123069)[flat_tid_118591];
            }
            // red body
            {
                bool defunc_0_op_res_123100 = eta_p_123098 || eta_p_123099;
                
                defunc_0_reduce_res_118589 = defunc_0_op_res_123100;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_123069);
    }
    if (event_127825 != NULL) {
        event_127825->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_127811", strdup("nothing further"), event_127825, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127803->retval_defunc_0_reduce_res_118589 = defunc_0_reduce_res_118589;
        futhark_mc_task_127803->retval_mem_118588 = mem_118588.mem;
    }
    return err;
}
struct futhark_mc_task_127826 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_44842;
    double free_zs_res_44844;
    int64_t free_eta_p_106382;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_param_118574;
    unsigned char *free_mem_param_118577;
    int64_t free_ctx_param_ext_118579;
    int64_t free_ctx_param_ext_118580;
    int64_t free_ctx_param_ext_118581;
    unsigned char *free_mem_118588;
    int64_t free_flat_tid_118636;
    int64_t free_flat_tid_118658;
    bool *retval_defunc_0_reduce_res_118634;
    unsigned char *retval_mem_118633;
};
struct futhark_mc_segred_stage_1_parloop_struct_127829 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_44842;
    double free_zs_res_44844;
    int64_t free_eta_p_106382;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_param_118574;
    unsigned char *free_mem_param_118577;
    int64_t free_ctx_param_ext_118579;
    int64_t free_ctx_param_ext_118580;
    int64_t free_ctx_param_ext_118581;
    unsigned char *free_mem_118588;
    unsigned char *free_mem_118633;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123103;
};
static int futhark_mc_segred_stage_1_parloop_127830(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127829 *futhark_mc_segred_stage_1_parloop_struct_127829 = (struct futhark_mc_segred_stage_1_parloop_struct_127829 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127829->ctx;
    struct mc_event *event_127831 = mc_event_new(ctx);
    
    if (event_127831 != NULL)
        event_127831->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127829->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_segred_stage_1_parloop_struct_127829->free_exp_absorb_cutoff_33394;
    double zs_res_44842 = futhark_mc_segred_stage_1_parloop_struct_127829->free_zs_res_44842;
    double zs_res_44844 = futhark_mc_segred_stage_1_parloop_struct_127829->free_zs_res_44844;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_127829->free_eta_p_106382;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_127829->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_118574 = {.desc ="mem_param_118574", .mem =futhark_mc_segred_stage_1_parloop_struct_127829->free_mem_param_118574, .size =0, .references =NULL};
    struct memblock mem_param_118577 = {.desc ="mem_param_118577", .mem =futhark_mc_segred_stage_1_parloop_struct_127829->free_mem_param_118577, .size =0, .references =NULL};
    int64_t ctx_param_ext_118579 = futhark_mc_segred_stage_1_parloop_struct_127829->free_ctx_param_ext_118579;
    int64_t ctx_param_ext_118580 = futhark_mc_segred_stage_1_parloop_struct_127829->free_ctx_param_ext_118580;
    int64_t ctx_param_ext_118581 = futhark_mc_segred_stage_1_parloop_struct_127829->free_ctx_param_ext_118581;
    struct memblock mem_118588 = {.desc ="mem_118588", .mem =futhark_mc_segred_stage_1_parloop_struct_127829->free_mem_118588, .size =0, .references =NULL};
    struct memblock mem_118633 = {.desc ="mem_118633", .mem =futhark_mc_segred_stage_1_parloop_struct_127829->free_mem_118633, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_123103 = {.desc ="reduce_stage_1_tid_res_arr_mem_123103", .mem =futhark_mc_segred_stage_1_parloop_struct_127829->free_reduce_stage_1_tid_res_arr_mem_123103, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118658;
    
    flat_tid_118658 = subtask_id;
    {
        bool eta_p_123105;
        bool eta_p_123106;
        bool local_acc_123108 = 0;
        bool eta_p_118660;
        bool eta_p_118661;
        bool local_acc_123109 = 0;
        int64_t start_123110;
        int64_t end_123111;
        
        start_123110 = start;
        end_123111 = end;
        
        int64_t n_123112 = end_123111 - start_123110;
        
        for (int64_t SegRed_i_123113 = start_123110; SegRed_i_123113 < start_123110 + n_123112; SegRed_i_123113++) {
            int64_t gtid_118659 = SegRed_i_123113;
            double eta_p_118663 = ((double *) distrs_mem_111708.mem)[eta_p_106382 * m_33388 + gtid_118659];
            double eta_p_118664 = ((double *) mem_param_118577.mem)[gtid_118659];
            double defunc_0_reduce_res_118665;
            double redout_118667 = 0.0;
            
            for (int64_t i_118666 = 0; i_118666 < m_33388; i_118666++) {
                double eta_p_118668 = ((double *) mem_118588.mem)[i_118666];
                double eta_p_118669 = ((double *) mem_param_118574.mem)[ctx_param_ext_118579 + (gtid_118659 * ctx_param_ext_118580 + i_118666 * ctx_param_ext_118581)];
                double zt_res_118670 = eta_p_118668 * eta_p_118669;
                double zp_res_118671 = zt_res_118670 + redout_118667;
                double redout_tmp_123114 = zp_res_118671;
                
                redout_118667 = redout_tmp_123114;
            }
            defunc_0_reduce_res_118665 = redout_118667;
            
            double zs_res_118672 = defunc_0_reduce_res_118665 / eta_p_118663;
            double ztzt_res_118673 = fpow64(zs_res_118672, zs_res_44842);
            double zt_res_118674 = zs_res_44844 * eta_p_118664;
            double exp_res_118675 = futrts_exp64(zt_res_118674);
            double zt_res_118676 = ztzt_res_118673 * exp_res_118675;
            bool zgze_res_118677 = exp_absorb_cutoff_33394 <= zt_res_118676;
            
            // save map-out results
            {
                ((double *) mem_118633.mem)[gtid_118659] = zt_res_118676;
            }
            // Load accum params
            {
                eta_p_118660 = local_acc_123109;
            }
            // Load next params
            {
                eta_p_118661 = zgze_res_118677;
            }
            // SegRed body
            {
                bool defunc_0_op_res_118662 = eta_p_118660 || eta_p_118661;
                
                local_acc_123109 = defunc_0_op_res_118662;
            }
        }
        
        int64_t uni_i_123115 = 0;
        
        {
            int64_t gtid_118659 = uni_i_123115;
            
            // Load accum params
            {
                eta_p_123105 = local_acc_123108;
            }
            // Load next params
            {
                eta_p_123106 = local_acc_123109;
            }
            // SegRed body
            {
                bool defunc_0_op_res_123107 = eta_p_123105 || eta_p_123106;
                
                local_acc_123108 = defunc_0_op_res_123107;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_123103.mem)[flat_tid_118658] = local_acc_123108;
    }
    
  cleanup:
    { }
    if (event_127831 != NULL) {
        event_127831->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127830", strdup("nothing further"), event_127831, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127827(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127826 *futhark_mc_task_127826 = (struct futhark_mc_task_127826 *) args;
    struct futhark_context *ctx = futhark_mc_task_127826->ctx;
    struct mc_event *event_127833 = mc_event_new(ctx);
    
    if (event_127833 != NULL)
        event_127833->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127826->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_task_127826->free_exp_absorb_cutoff_33394;
    double zs_res_44842 = futhark_mc_task_127826->free_zs_res_44842;
    double zs_res_44844 = futhark_mc_task_127826->free_zs_res_44844;
    int64_t eta_p_106382 = futhark_mc_task_127826->free_eta_p_106382;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_127826->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_118574 = {.desc ="mem_param_118574", .mem =futhark_mc_task_127826->free_mem_param_118574, .size =0, .references =NULL};
    struct memblock mem_param_118577 = {.desc ="mem_param_118577", .mem =futhark_mc_task_127826->free_mem_param_118577, .size =0, .references =NULL};
    int64_t ctx_param_ext_118579 = futhark_mc_task_127826->free_ctx_param_ext_118579;
    int64_t ctx_param_ext_118580 = futhark_mc_task_127826->free_ctx_param_ext_118580;
    int64_t ctx_param_ext_118581 = futhark_mc_task_127826->free_ctx_param_ext_118581;
    struct memblock mem_118588 = {.desc ="mem_118588", .mem =futhark_mc_task_127826->free_mem_118588, .size =0, .references =NULL};
    int64_t flat_tid_118636 = futhark_mc_task_127826->free_flat_tid_118636;
    int64_t flat_tid_118658 = futhark_mc_task_127826->free_flat_tid_118658;
    bool defunc_0_reduce_res_118634 = *futhark_mc_task_127826->retval_defunc_0_reduce_res_118634;
    struct memblock mem_118633 = {.desc ="mem_118633", .mem =futhark_mc_task_127826->retval_mem_118633, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_123103_cached_sizze_127828 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123103 = NULL;
    int32_t nsubtasks_123102;
    
    nsubtasks_123102 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_123103_cached_sizze_127828 < nsubtasks_123102) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123103, &reduce_stage_1_tid_res_arr_mem_123103_cached_sizze_127828, nsubtasks_123102);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127829 futhark_mc_segred_stage_1_parloop_struct_127829_;
    
    futhark_mc_segred_stage_1_parloop_struct_127829_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127829_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127829_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segred_stage_1_parloop_struct_127829_.free_zs_res_44842 = zs_res_44842;
    futhark_mc_segred_stage_1_parloop_struct_127829_.free_zs_res_44844 = zs_res_44844;
    futhark_mc_segred_stage_1_parloop_struct_127829_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_127829_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_127829_.free_mem_param_118574 = mem_param_118574.mem;
    futhark_mc_segred_stage_1_parloop_struct_127829_.free_mem_param_118577 = mem_param_118577.mem;
    futhark_mc_segred_stage_1_parloop_struct_127829_.free_ctx_param_ext_118579 = ctx_param_ext_118579;
    futhark_mc_segred_stage_1_parloop_struct_127829_.free_ctx_param_ext_118580 = ctx_param_ext_118580;
    futhark_mc_segred_stage_1_parloop_struct_127829_.free_ctx_param_ext_118581 = ctx_param_ext_118581;
    futhark_mc_segred_stage_1_parloop_struct_127829_.free_mem_118588 = mem_118588.mem;
    futhark_mc_segred_stage_1_parloop_struct_127829_.free_mem_118633 = mem_118633.mem;
    futhark_mc_segred_stage_1_parloop_struct_127829_.free_reduce_stage_1_tid_res_arr_mem_123103 = reduce_stage_1_tid_res_arr_mem_123103;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127830_task;
    
    futhark_mc_segred_stage_1_parloop_127830_task.name = "futhark_mc_segred_stage_1_parloop_127830";
    futhark_mc_segred_stage_1_parloop_127830_task.fn = futhark_mc_segred_stage_1_parloop_127830;
    futhark_mc_segred_stage_1_parloop_127830_task.args = &futhark_mc_segred_stage_1_parloop_struct_127829_;
    futhark_mc_segred_stage_1_parloop_127830_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127830_task.info = info;
    
    struct mc_event *event_127832 = mc_event_new(ctx);
    
    if (event_127832 != NULL)
        event_127832->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127830_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127830_task);
    
    if (futhark_mc_segred_stage_1_parloop_127830_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127830_err;
        goto cleanup;
    }
    if (event_127832 != NULL) {
        event_127832->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127830_total", strdup("nothing further"), event_127832, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_118634 = 0;
    }
    
    bool eta_p_123116;
    bool eta_p_123117;
    
    for (int32_t i_123119 = 0; i_123119 < nsubtasks_123102; i_123119++) {
        flat_tid_118658 = i_123119;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_123116 = defunc_0_reduce_res_118634;
            }
            // load next params
            {
                eta_p_123117 = ((bool *) reduce_stage_1_tid_res_arr_mem_123103)[flat_tid_118658];
            }
            // red body
            {
                bool defunc_0_op_res_123118 = eta_p_123116 || eta_p_123117;
                
                defunc_0_reduce_res_118634 = defunc_0_op_res_123118;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_123103);
    }
    if (event_127833 != NULL) {
        event_127833->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127827", strdup("nothing further"), event_127833, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127826->retval_defunc_0_reduce_res_118634 = defunc_0_reduce_res_118634;
        futhark_mc_task_127826->retval_mem_118633 = mem_118633.mem;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_127836 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_44842;
    double free_zs_res_44844;
    int64_t free_eta_p_106382;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_param_118574;
    unsigned char *free_mem_param_118577;
    int64_t free_ctx_param_ext_118579;
    int64_t free_ctx_param_ext_118580;
    int64_t free_ctx_param_ext_118581;
    unsigned char *free_mem_118588;
    unsigned char *free_mem_118633;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123121;
};
struct futhark_mc_task_127838 {
    struct futhark_context *ctx;
    unsigned char *free_mem_param_118574;
    int64_t free_ctx_param_ext_118579;
    int64_t free_ctx_param_ext_118580;
    int64_t free_ctx_param_ext_118581;
    unsigned char *free_mem_118588;
    int64_t free_gtid_118637;
    int64_t free_flat_tid_118644;
    double *retval_defunc_0_reduce_res_118643;
};
struct futhark_mc_segred_stage_1_parloop_struct_127841 {
    struct futhark_context *ctx;
    unsigned char *free_mem_param_118574;
    int64_t free_ctx_param_ext_118579;
    int64_t free_ctx_param_ext_118580;
    int64_t free_ctx_param_ext_118581;
    unsigned char *free_mem_118588;
    int64_t free_gtid_118637;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123133;
};
static int futhark_mc_segred_stage_1_parloop_127842(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127841 *futhark_mc_segred_stage_1_parloop_struct_127841 = (struct futhark_mc_segred_stage_1_parloop_struct_127841 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127841->ctx;
    struct mc_event *event_127843 = mc_event_new(ctx);
    
    if (event_127843 != NULL)
        event_127843->bef = get_wall_time();
    
    struct memblock mem_param_118574 = {.desc ="mem_param_118574", .mem =futhark_mc_segred_stage_1_parloop_struct_127841->free_mem_param_118574, .size =0, .references =NULL};
    int64_t ctx_param_ext_118579 = futhark_mc_segred_stage_1_parloop_struct_127841->free_ctx_param_ext_118579;
    int64_t ctx_param_ext_118580 = futhark_mc_segred_stage_1_parloop_struct_127841->free_ctx_param_ext_118580;
    int64_t ctx_param_ext_118581 = futhark_mc_segred_stage_1_parloop_struct_127841->free_ctx_param_ext_118581;
    struct memblock mem_118588 = {.desc ="mem_118588", .mem =futhark_mc_segred_stage_1_parloop_struct_127841->free_mem_118588, .size =0, .references =NULL};
    int64_t gtid_118637 = futhark_mc_segred_stage_1_parloop_struct_127841->free_gtid_118637;
    struct memblock reduce_stage_1_tid_res_arr_mem_123133 = {.desc ="reduce_stage_1_tid_res_arr_mem_123133", .mem =futhark_mc_segred_stage_1_parloop_struct_127841->free_reduce_stage_1_tid_res_arr_mem_123133, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118644;
    
    flat_tid_118644 = subtask_id;
    {
        double eta_p_123135;
        double eta_p_123136;
        double local_acc_123138 = 0.0;
        double eta_p_118646;
        double eta_p_118647;
        double local_acc_123139 = 0.0;
        int64_t start_123140;
        int64_t end_123141;
        
        start_123140 = start;
        end_123141 = end;
        
        int64_t n_123142 = end_123141 - start_123140;
        
        for (int64_t SegRed_i_123143 = start_123140; SegRed_i_123143 < start_123140 + n_123142; SegRed_i_123143++) {
            int64_t gtid_118645 = SegRed_i_123143;
            double eta_p_118649 = ((double *) mem_118588.mem)[gtid_118645];
            double eta_p_118650 = ((double *) mem_param_118574.mem)[ctx_param_ext_118579 + (gtid_118637 * ctx_param_ext_118580 + gtid_118645 * ctx_param_ext_118581)];
            double zt_res_118651 = eta_p_118649 * eta_p_118650;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_118646 = local_acc_123139;
            }
            // Load next params
            {
                eta_p_118647 = zt_res_118651;
            }
            // SegRed body
            {
                double zp_res_118648 = eta_p_118646 + eta_p_118647;
                
                local_acc_123139 = zp_res_118648;
            }
        }
        
        int64_t uni_i_123144 = 0;
        
        {
            int64_t gtid_118645 = uni_i_123144;
            
            // Load accum params
            {
                eta_p_123135 = local_acc_123138;
            }
            // Load next params
            {
                eta_p_123136 = local_acc_123139;
            }
            // SegRed body
            {
                double zp_res_123137 = eta_p_123135 + eta_p_123136;
                
                local_acc_123138 = zp_res_123137;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_123133.mem)[flat_tid_118644] = local_acc_123138;
    }
    
  cleanup:
    { }
    if (event_127843 != NULL) {
        event_127843->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127842", strdup("nothing further"), event_127843, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127839(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127838 *futhark_mc_task_127838 = (struct futhark_mc_task_127838 *) args;
    struct futhark_context *ctx = futhark_mc_task_127838->ctx;
    struct mc_event *event_127845 = mc_event_new(ctx);
    
    if (event_127845 != NULL)
        event_127845->bef = get_wall_time();
    
    struct memblock mem_param_118574 = {.desc ="mem_param_118574", .mem =futhark_mc_task_127838->free_mem_param_118574, .size =0, .references =NULL};
    int64_t ctx_param_ext_118579 = futhark_mc_task_127838->free_ctx_param_ext_118579;
    int64_t ctx_param_ext_118580 = futhark_mc_task_127838->free_ctx_param_ext_118580;
    int64_t ctx_param_ext_118581 = futhark_mc_task_127838->free_ctx_param_ext_118581;
    struct memblock mem_118588 = {.desc ="mem_118588", .mem =futhark_mc_task_127838->free_mem_118588, .size =0, .references =NULL};
    int64_t gtid_118637 = futhark_mc_task_127838->free_gtid_118637;
    int64_t flat_tid_118644 = futhark_mc_task_127838->free_flat_tid_118644;
    double defunc_0_reduce_res_118643 = *futhark_mc_task_127838->retval_defunc_0_reduce_res_118643;
    int64_t reduce_stage_1_tid_res_arr_mem_123133_cached_sizze_127840 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123133 = NULL;
    int32_t nsubtasks_123132;
    
    nsubtasks_123132 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_123133_cached_sizze_127840 < (int64_t) 8 * nsubtasks_123132) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123133, &reduce_stage_1_tid_res_arr_mem_123133_cached_sizze_127840, (int64_t) 8 * nsubtasks_123132);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127841 futhark_mc_segred_stage_1_parloop_struct_127841_;
    
    futhark_mc_segred_stage_1_parloop_struct_127841_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127841_.free_mem_param_118574 = mem_param_118574.mem;
    futhark_mc_segred_stage_1_parloop_struct_127841_.free_ctx_param_ext_118579 = ctx_param_ext_118579;
    futhark_mc_segred_stage_1_parloop_struct_127841_.free_ctx_param_ext_118580 = ctx_param_ext_118580;
    futhark_mc_segred_stage_1_parloop_struct_127841_.free_ctx_param_ext_118581 = ctx_param_ext_118581;
    futhark_mc_segred_stage_1_parloop_struct_127841_.free_mem_118588 = mem_118588.mem;
    futhark_mc_segred_stage_1_parloop_struct_127841_.free_gtid_118637 = gtid_118637;
    futhark_mc_segred_stage_1_parloop_struct_127841_.free_reduce_stage_1_tid_res_arr_mem_123133 = reduce_stage_1_tid_res_arr_mem_123133;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127842_task;
    
    futhark_mc_segred_stage_1_parloop_127842_task.name = "futhark_mc_segred_stage_1_parloop_127842";
    futhark_mc_segred_stage_1_parloop_127842_task.fn = futhark_mc_segred_stage_1_parloop_127842;
    futhark_mc_segred_stage_1_parloop_127842_task.args = &futhark_mc_segred_stage_1_parloop_struct_127841_;
    futhark_mc_segred_stage_1_parloop_127842_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127842_task.info = info;
    
    struct mc_event *event_127844 = mc_event_new(ctx);
    
    if (event_127844 != NULL)
        event_127844->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127842_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127842_task);
    
    if (futhark_mc_segred_stage_1_parloop_127842_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127842_err;
        goto cleanup;
    }
    if (event_127844 != NULL) {
        event_127844->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127842_total", strdup("nothing further"), event_127844, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_118643 = 0.0;
    }
    
    double eta_p_123145;
    double eta_p_123146;
    
    for (int32_t i_123148 = 0; i_123148 < nsubtasks_123132; i_123148++) {
        flat_tid_118644 = i_123148;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_123145 = defunc_0_reduce_res_118643;
            }
            // load next params
            {
                eta_p_123146 = ((double *) reduce_stage_1_tid_res_arr_mem_123133)[flat_tid_118644];
            }
            // red body
            {
                double zp_res_123147 = eta_p_123145 + eta_p_123146;
                
                defunc_0_reduce_res_118643 = zp_res_123147;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_123133);
    }
    if (event_127845 != NULL) {
        event_127845->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127839", strdup("nothing further"), event_127845, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127838->retval_defunc_0_reduce_res_118643 = defunc_0_reduce_res_118643;
    }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_127837(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127836 *futhark_mc_segred_stage_1_parloop_struct_127836 = (struct futhark_mc_segred_stage_1_parloop_struct_127836 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127836->ctx;
    struct mc_event *event_127846 = mc_event_new(ctx);
    
    if (event_127846 != NULL)
        event_127846->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127836->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_segred_stage_1_parloop_struct_127836->free_exp_absorb_cutoff_33394;
    double zs_res_44842 = futhark_mc_segred_stage_1_parloop_struct_127836->free_zs_res_44842;
    double zs_res_44844 = futhark_mc_segred_stage_1_parloop_struct_127836->free_zs_res_44844;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_127836->free_eta_p_106382;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_127836->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_118574 = {.desc ="mem_param_118574", .mem =futhark_mc_segred_stage_1_parloop_struct_127836->free_mem_param_118574, .size =0, .references =NULL};
    struct memblock mem_param_118577 = {.desc ="mem_param_118577", .mem =futhark_mc_segred_stage_1_parloop_struct_127836->free_mem_param_118577, .size =0, .references =NULL};
    int64_t ctx_param_ext_118579 = futhark_mc_segred_stage_1_parloop_struct_127836->free_ctx_param_ext_118579;
    int64_t ctx_param_ext_118580 = futhark_mc_segred_stage_1_parloop_struct_127836->free_ctx_param_ext_118580;
    int64_t ctx_param_ext_118581 = futhark_mc_segred_stage_1_parloop_struct_127836->free_ctx_param_ext_118581;
    struct memblock mem_118588 = {.desc ="mem_118588", .mem =futhark_mc_segred_stage_1_parloop_struct_127836->free_mem_118588, .size =0, .references =NULL};
    struct memblock mem_118633 = {.desc ="mem_118633", .mem =futhark_mc_segred_stage_1_parloop_struct_127836->free_mem_118633, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_123121 = {.desc ="reduce_stage_1_tid_res_arr_mem_123121", .mem =futhark_mc_segred_stage_1_parloop_struct_127836->free_reduce_stage_1_tid_res_arr_mem_123121, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118636;
    
    flat_tid_118636 = subtask_id;
    {
        bool eta_p_123123;
        bool eta_p_123124;
        bool local_acc_123126 = 0;
        bool eta_p_118638;
        bool eta_p_118639;
        bool local_acc_123127 = 0;
        int64_t start_123128;
        int64_t end_123129;
        
        start_123128 = start;
        end_123129 = end;
        
        int64_t n_123130 = end_123129 - start_123128;
        
        for (int64_t SegRed_i_123131 = start_123128; SegRed_i_123131 < start_123128 + n_123130; SegRed_i_123131++) {
            int64_t gtid_118637 = SegRed_i_123131;
            double eta_p_118641 = ((double *) distrs_mem_111708.mem)[eta_p_106382 * m_33388 + gtid_118637];
            double eta_p_118642 = ((double *) mem_param_118577.mem)[gtid_118637];
            double defunc_0_reduce_res_118643;
            int64_t flat_tid_118644 = (int64_t) 0;
            
            defunc_0_reduce_res_118643 = 0.0;
            
            struct futhark_mc_task_127838 futhark_mc_task_127838_;
            
            futhark_mc_task_127838_.ctx = ctx;
            futhark_mc_task_127838_.free_mem_param_118574 = mem_param_118574.mem;
            futhark_mc_task_127838_.free_ctx_param_ext_118579 = ctx_param_ext_118579;
            futhark_mc_task_127838_.free_ctx_param_ext_118580 = ctx_param_ext_118580;
            futhark_mc_task_127838_.free_ctx_param_ext_118581 = ctx_param_ext_118581;
            futhark_mc_task_127838_.free_mem_118588 = mem_118588.mem;
            futhark_mc_task_127838_.free_gtid_118637 = gtid_118637;
            futhark_mc_task_127838_.free_flat_tid_118644 = flat_tid_118644;
            futhark_mc_task_127838_.retval_defunc_0_reduce_res_118643 = (double *) &defunc_0_reduce_res_118643;
            #if ISPC
            futhark_mc_task_127838_.retval_defunc_0_reduce_res_118643 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_127838_task;
            
            futhark_mc_task_127838_task.args = &futhark_mc_task_127838_;
            futhark_mc_task_127838_task.top_level_fn = futhark_mc_segred_task_127839;
            futhark_mc_task_127838_task.name = "futhark_mc_segred_task_127839";
            futhark_mc_task_127838_task.iterations = m_33388;
            futhark_mc_task_127838_task.task_time = &ctx->program->futhark_mc_segred_task_127839_total_time;
            futhark_mc_task_127838_task.task_iter = &ctx->program->futhark_mc_segred_task_127839_total_iter;
            futhark_mc_task_127838_task.sched = STATIC;
            futhark_mc_task_127838_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_127839_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127838_task);
            
            if (futhark_mc_segred_task_127839_err != 0) {
                err = futhark_mc_segred_task_127839_err;
                goto cleanup;
            }
            
            double zs_res_118652 = defunc_0_reduce_res_118643 / eta_p_118641;
            double ztzt_res_118653 = fpow64(zs_res_118652, zs_res_44842);
            double zt_res_118654 = zs_res_44844 * eta_p_118642;
            double exp_res_118655 = futrts_exp64(zt_res_118654);
            double zt_res_118656 = ztzt_res_118653 * exp_res_118655;
            bool zgze_res_118657 = exp_absorb_cutoff_33394 <= zt_res_118656;
            
            // save map-out results
            {
                ((double *) mem_118633.mem)[gtid_118637] = zt_res_118656;
            }
            // Load accum params
            {
                eta_p_118638 = local_acc_123127;
            }
            // Load next params
            {
                eta_p_118639 = zgze_res_118657;
            }
            // SegRed body
            {
                bool defunc_0_op_res_118640 = eta_p_118638 || eta_p_118639;
                
                local_acc_123127 = defunc_0_op_res_118640;
            }
        }
        
        int64_t uni_i_123149 = 0;
        
        {
            int64_t gtid_118637 = uni_i_123149;
            
            // Load accum params
            {
                eta_p_123123 = local_acc_123126;
            }
            // Load next params
            {
                eta_p_123124 = local_acc_123127;
            }
            // SegRed body
            {
                bool defunc_0_op_res_123125 = eta_p_123123 || eta_p_123124;
                
                local_acc_123126 = defunc_0_op_res_123125;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_123121.mem)[flat_tid_118636] = local_acc_123126;
    }
    
  cleanup:
    { }
    if (event_127846 != NULL) {
        event_127846->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127837", strdup("nothing further"), event_127846, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_127834(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127826 *futhark_mc_task_127826 = (struct futhark_mc_task_127826 *) args;
    struct futhark_context *ctx = futhark_mc_task_127826->ctx;
    struct mc_event *event_127848 = mc_event_new(ctx);
    
    if (event_127848 != NULL)
        event_127848->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127826->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_task_127826->free_exp_absorb_cutoff_33394;
    double zs_res_44842 = futhark_mc_task_127826->free_zs_res_44842;
    double zs_res_44844 = futhark_mc_task_127826->free_zs_res_44844;
    int64_t eta_p_106382 = futhark_mc_task_127826->free_eta_p_106382;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_127826->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_118574 = {.desc ="mem_param_118574", .mem =futhark_mc_task_127826->free_mem_param_118574, .size =0, .references =NULL};
    struct memblock mem_param_118577 = {.desc ="mem_param_118577", .mem =futhark_mc_task_127826->free_mem_param_118577, .size =0, .references =NULL};
    int64_t ctx_param_ext_118579 = futhark_mc_task_127826->free_ctx_param_ext_118579;
    int64_t ctx_param_ext_118580 = futhark_mc_task_127826->free_ctx_param_ext_118580;
    int64_t ctx_param_ext_118581 = futhark_mc_task_127826->free_ctx_param_ext_118581;
    struct memblock mem_118588 = {.desc ="mem_118588", .mem =futhark_mc_task_127826->free_mem_118588, .size =0, .references =NULL};
    int64_t flat_tid_118636 = futhark_mc_task_127826->free_flat_tid_118636;
    int64_t flat_tid_118658 = futhark_mc_task_127826->free_flat_tid_118658;
    bool defunc_0_reduce_res_118634 = *futhark_mc_task_127826->retval_defunc_0_reduce_res_118634;
    struct memblock mem_118633 = {.desc ="mem_118633", .mem =futhark_mc_task_127826->retval_mem_118633, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_123121_cached_sizze_127835 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123121 = NULL;
    int32_t nsubtasks_123120;
    
    nsubtasks_123120 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_123121_cached_sizze_127835 < nsubtasks_123120) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123121, &reduce_stage_1_tid_res_arr_mem_123121_cached_sizze_127835, nsubtasks_123120);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127836 futhark_mc_segred_stage_1_parloop_struct_127836_;
    
    futhark_mc_segred_stage_1_parloop_struct_127836_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127836_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127836_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segred_stage_1_parloop_struct_127836_.free_zs_res_44842 = zs_res_44842;
    futhark_mc_segred_stage_1_parloop_struct_127836_.free_zs_res_44844 = zs_res_44844;
    futhark_mc_segred_stage_1_parloop_struct_127836_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_127836_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_127836_.free_mem_param_118574 = mem_param_118574.mem;
    futhark_mc_segred_stage_1_parloop_struct_127836_.free_mem_param_118577 = mem_param_118577.mem;
    futhark_mc_segred_stage_1_parloop_struct_127836_.free_ctx_param_ext_118579 = ctx_param_ext_118579;
    futhark_mc_segred_stage_1_parloop_struct_127836_.free_ctx_param_ext_118580 = ctx_param_ext_118580;
    futhark_mc_segred_stage_1_parloop_struct_127836_.free_ctx_param_ext_118581 = ctx_param_ext_118581;
    futhark_mc_segred_stage_1_parloop_struct_127836_.free_mem_118588 = mem_118588.mem;
    futhark_mc_segred_stage_1_parloop_struct_127836_.free_mem_118633 = mem_118633.mem;
    futhark_mc_segred_stage_1_parloop_struct_127836_.free_reduce_stage_1_tid_res_arr_mem_123121 = reduce_stage_1_tid_res_arr_mem_123121;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127837_task;
    
    futhark_mc_segred_stage_1_parloop_127837_task.name = "futhark_mc_segred_stage_1_parloop_127837";
    futhark_mc_segred_stage_1_parloop_127837_task.fn = futhark_mc_segred_stage_1_parloop_127837;
    futhark_mc_segred_stage_1_parloop_127837_task.args = &futhark_mc_segred_stage_1_parloop_struct_127836_;
    futhark_mc_segred_stage_1_parloop_127837_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127837_task.info = info;
    
    struct mc_event *event_127847 = mc_event_new(ctx);
    
    if (event_127847 != NULL)
        event_127847->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127837_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127837_task);
    
    if (futhark_mc_segred_stage_1_parloop_127837_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127837_err;
        goto cleanup;
    }
    if (event_127847 != NULL) {
        event_127847->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127837_total", strdup("nothing further"), event_127847, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_118634 = 0;
    }
    
    bool eta_p_123150;
    bool eta_p_123151;
    
    for (int32_t i_123153 = 0; i_123153 < nsubtasks_123120; i_123153++) {
        flat_tid_118636 = i_123153;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_123150 = defunc_0_reduce_res_118634;
            }
            // load next params
            {
                eta_p_123151 = ((bool *) reduce_stage_1_tid_res_arr_mem_123121)[flat_tid_118636];
            }
            // red body
            {
                bool defunc_0_op_res_123152 = eta_p_123150 || eta_p_123151;
                
                defunc_0_reduce_res_118634 = defunc_0_op_res_123152;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_123121);
    }
    if (event_127848 != NULL) {
        event_127848->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_127834", strdup("nothing further"), event_127848, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127826->retval_defunc_0_reduce_res_118634 = defunc_0_reduce_res_118634;
        futhark_mc_task_127826->retval_mem_118633 = mem_118633.mem;
    }
    return err;
}
struct futhark_mc_task_127849 {
    struct futhark_context *ctx;
    double free_zs_res_107134;
    unsigned char *free_mem_118633;
    int64_t free_flat_tid_118679;
    bool *retval_defunc_0_reduce_res_118678;
};
struct futhark_mc_segred_stage_1_parloop_struct_127852 {
    struct futhark_context *ctx;
    double free_zs_res_107134;
    unsigned char *free_mem_118633;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123155;
};
static int futhark_mc_segred_stage_1_parloop_127853(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127852 *futhark_mc_segred_stage_1_parloop_struct_127852 = (struct futhark_mc_segred_stage_1_parloop_struct_127852 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127852->ctx;
    struct mc_event *event_127854 = mc_event_new(ctx);
    
    if (event_127854 != NULL)
        event_127854->bef = get_wall_time();
    
    double zs_res_107134 = futhark_mc_segred_stage_1_parloop_struct_127852->free_zs_res_107134;
    struct memblock mem_118633 = {.desc ="mem_118633", .mem =futhark_mc_segred_stage_1_parloop_struct_127852->free_mem_118633, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_123155 = {.desc ="reduce_stage_1_tid_res_arr_mem_123155", .mem =futhark_mc_segred_stage_1_parloop_struct_127852->free_reduce_stage_1_tid_res_arr_mem_123155, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118679;
    
    flat_tid_118679 = subtask_id;
    {
        bool eta_p_123157;
        bool eta_p_123158;
        bool local_acc_123160 = 0;
        bool eta_p_118681;
        bool eta_p_118682;
        bool local_acc_123161 = 0;
        int64_t start_123162;
        int64_t end_123163;
        
        start_123162 = start;
        end_123163 = end;
        
        int64_t n_123164 = end_123163 - start_123162;
        
        for (int64_t SegRed_i_123165 = start_123162; SegRed_i_123165 < start_123162 + n_123164; SegRed_i_123165++) {
            int64_t gtid_118680 = SegRed_i_123165;
            double eta_p_118684 = ((double *) mem_118633.mem)[gtid_118680];
            bool zlze_res_118685 = eta_p_118684 <= zs_res_107134;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_118681 = local_acc_123161;
            }
            // Load next params
            {
                eta_p_118682 = zlze_res_118685;
            }
            // SegRed body
            {
                bool defunc_0_op_res_118683 = eta_p_118681 || eta_p_118682;
                
                local_acc_123161 = defunc_0_op_res_118683;
            }
        }
        
        int64_t uni_i_123166 = 0;
        
        {
            int64_t gtid_118680 = uni_i_123166;
            
            // Load accum params
            {
                eta_p_123157 = local_acc_123160;
            }
            // Load next params
            {
                eta_p_123158 = local_acc_123161;
            }
            // SegRed body
            {
                bool defunc_0_op_res_123159 = eta_p_123157 || eta_p_123158;
                
                local_acc_123160 = defunc_0_op_res_123159;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_123155.mem)[flat_tid_118679] = local_acc_123160;
    }
    
  cleanup:
    { }
    if (event_127854 != NULL) {
        event_127854->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127853", strdup("nothing further"), event_127854, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127850(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127849 *futhark_mc_task_127849 = (struct futhark_mc_task_127849 *) args;
    struct futhark_context *ctx = futhark_mc_task_127849->ctx;
    struct mc_event *event_127856 = mc_event_new(ctx);
    
    if (event_127856 != NULL)
        event_127856->bef = get_wall_time();
    
    double zs_res_107134 = futhark_mc_task_127849->free_zs_res_107134;
    struct memblock mem_118633 = {.desc ="mem_118633", .mem =futhark_mc_task_127849->free_mem_118633, .size =0, .references =NULL};
    int64_t flat_tid_118679 = futhark_mc_task_127849->free_flat_tid_118679;
    bool defunc_0_reduce_res_118678 = *futhark_mc_task_127849->retval_defunc_0_reduce_res_118678;
    int64_t reduce_stage_1_tid_res_arr_mem_123155_cached_sizze_127851 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123155 = NULL;
    int32_t nsubtasks_123154;
    
    nsubtasks_123154 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_123155_cached_sizze_127851 < nsubtasks_123154) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123155, &reduce_stage_1_tid_res_arr_mem_123155_cached_sizze_127851, nsubtasks_123154);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127852 futhark_mc_segred_stage_1_parloop_struct_127852_;
    
    futhark_mc_segred_stage_1_parloop_struct_127852_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127852_.free_zs_res_107134 = zs_res_107134;
    futhark_mc_segred_stage_1_parloop_struct_127852_.free_mem_118633 = mem_118633.mem;
    futhark_mc_segred_stage_1_parloop_struct_127852_.free_reduce_stage_1_tid_res_arr_mem_123155 = reduce_stage_1_tid_res_arr_mem_123155;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127853_task;
    
    futhark_mc_segred_stage_1_parloop_127853_task.name = "futhark_mc_segred_stage_1_parloop_127853";
    futhark_mc_segred_stage_1_parloop_127853_task.fn = futhark_mc_segred_stage_1_parloop_127853;
    futhark_mc_segred_stage_1_parloop_127853_task.args = &futhark_mc_segred_stage_1_parloop_struct_127852_;
    futhark_mc_segred_stage_1_parloop_127853_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127853_task.info = info;
    
    struct mc_event *event_127855 = mc_event_new(ctx);
    
    if (event_127855 != NULL)
        event_127855->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127853_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127853_task);
    
    if (futhark_mc_segred_stage_1_parloop_127853_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127853_err;
        goto cleanup;
    }
    if (event_127855 != NULL) {
        event_127855->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127853_total", strdup("nothing further"), event_127855, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_118678 = 0;
    }
    
    bool eta_p_123167;
    bool eta_p_123168;
    
    for (int32_t i_123170 = 0; i_123170 < nsubtasks_123154; i_123170++) {
        flat_tid_118679 = i_123170;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_123167 = defunc_0_reduce_res_118678;
            }
            // load next params
            {
                eta_p_123168 = ((bool *) reduce_stage_1_tid_res_arr_mem_123155)[flat_tid_118679];
            }
            // red body
            {
                bool defunc_0_op_res_123169 = eta_p_123167 || eta_p_123168;
                
                defunc_0_reduce_res_118678 = defunc_0_op_res_123169;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_123155);
    }
    if (event_127856 != NULL) {
        event_127856->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127850", strdup("nothing further"), event_127856, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127849->retval_defunc_0_reduce_res_118678 = defunc_0_reduce_res_118678;
    }
    return err;
}
struct futhark_mc_task_127857 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    unsigned char *free_mem_param_118574;
    unsigned char *free_mem_param_118577;
    int64_t free_ctx_param_ext_118579;
    int64_t free_ctx_param_ext_118580;
    int64_t free_ctx_param_ext_118581;
    unsigned char *free_mem_118633;
    unsigned char *free_mem_118692;
    unsigned char *free_mem_118693;
    unsigned char *free_mem_118694;
    double free_zs_res_118701;
    int64_t free_bytes_118702;
};
struct futhark_mc_segmap_parloop_struct_127859 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    unsigned char *free_mem_param_118574;
    unsigned char *free_mem_param_118577;
    int64_t free_ctx_param_ext_118579;
    int64_t free_ctx_param_ext_118580;
    int64_t free_ctx_param_ext_118581;
    unsigned char *free_mem_118633;
    unsigned char *free_mem_118692;
    unsigned char *free_mem_118693;
    unsigned char *free_mem_118694;
    double free_zs_res_118701;
    int64_t free_bytes_118702;
};
static int futhark_mc_segmap_parloop_127860(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_127859 *futhark_mc_segmap_parloop_struct_127859 = (struct futhark_mc_segmap_parloop_struct_127859 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_127859->ctx;
    struct mc_event *event_127861 = mc_event_new(ctx);
    
    if (event_127861 != NULL)
        event_127861->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_127859->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_segmap_parloop_struct_127859->free_exp_absorb_cutoff_33394;
    struct memblock mem_param_118574 = {.desc ="mem_param_118574", .mem =futhark_mc_segmap_parloop_struct_127859->free_mem_param_118574, .size =0, .references =NULL};
    struct memblock mem_param_118577 = {.desc ="mem_param_118577", .mem =futhark_mc_segmap_parloop_struct_127859->free_mem_param_118577, .size =0, .references =NULL};
    int64_t ctx_param_ext_118579 = futhark_mc_segmap_parloop_struct_127859->free_ctx_param_ext_118579;
    int64_t ctx_param_ext_118580 = futhark_mc_segmap_parloop_struct_127859->free_ctx_param_ext_118580;
    int64_t ctx_param_ext_118581 = futhark_mc_segmap_parloop_struct_127859->free_ctx_param_ext_118581;
    struct memblock mem_118633 = {.desc ="mem_118633", .mem =futhark_mc_segmap_parloop_struct_127859->free_mem_118633, .size =0, .references =NULL};
    struct memblock mem_118692 = {.desc ="mem_118692", .mem =futhark_mc_segmap_parloop_struct_127859->free_mem_118692, .size =0, .references =NULL};
    struct memblock mem_118693 = {.desc ="mem_118693", .mem =futhark_mc_segmap_parloop_struct_127859->free_mem_118693, .size =0, .references =NULL};
    struct memblock mem_118694 = {.desc ="mem_118694", .mem =futhark_mc_segmap_parloop_struct_127859->free_mem_118694, .size =0, .references =NULL};
    double zs_res_118701 = futhark_mc_segmap_parloop_struct_127859->free_zs_res_118701;
    int64_t bytes_118702 = futhark_mc_segmap_parloop_struct_127859->free_bytes_118702;
    int64_t iterations = end - start;
    struct memblock ext_mem_118721;
    
    ext_mem_118721.references = NULL;
    
    struct memblock mem_118720;
    
    mem_118720.references = NULL;
    
    int64_t flat_tid_118706;
    
    flat_tid_118706 = subtask_id;
    {
        int64_t start_123183;
        int64_t end_123184;
        
        start_123183 = start;
        end_123184 = end;
        
        int64_t n_123185 = end_123184 - start_123183;
        
        if (memblock_alloc(ctx, &mem_118720, bytes_118702, "mem_118720")) {
            err = 1;
            goto cleanup;
        }
        for (int64_t SegMap_i_123186 = start_123183; SegMap_i_123186 < start_123183 + n_123185; SegMap_i_123186++) {
            int64_t slice_123187 = m_33388;
            int64_t gtid_118707 = SegMap_i_123186;
            int64_t remnant_123188 = SegMap_i_123186 - gtid_118707;
            double eta_p_118708 = ((double *) mem_118633.mem)[gtid_118707];
            double eta_p_118709 = ((double *) mem_param_118577.mem)[gtid_118707];
            bool zgze_res_118711 = exp_absorb_cutoff_33394 <= eta_p_118708;
            bool zl_res_118712 = eta_p_118708 < zs_res_118701;
            bool x_118713 = !zgze_res_118711;
            bool y_118714 = zl_res_118712 && x_118713;
            bool cond_118715 = zgze_res_118711 || y_118714;
            int64_t binop_y_118716 = gtid_118707 * ctx_param_ext_118580;
            int64_t lmad_ext_118717 = ctx_param_ext_118579 + binop_y_118716;
            int64_t ext_118718;
            
            if (cond_118715) {
                ext_118718 = (int64_t) 0;
            } else {
                ext_118718 = lmad_ext_118717;
            }
            
            int64_t ext_118719;
            
            if (cond_118715) {
                ext_118719 = (int64_t) 1;
            } else {
                ext_118719 = ctx_param_ext_118581;
            }
            
            double rescale_res_118722;
            double rescale_res_118723;
            
            if (cond_118715) {
                double log_res_123172 = futrts_log64(eta_p_118708);
                double sqrt_res_123173 = futrts_sqrt64(eta_p_118708);
                double zs_res_123174 = log_res_123172 / 2.0;
                double zp_res_123175 = eta_p_118709 + zs_res_123174;
                
                for (int64_t i_123178 = 0; i_123178 < m_33388; i_123178++) {
                    double eta_p_123180 = ((double *) mem_param_118574.mem)[ctx_param_ext_118579 + (gtid_118707 * ctx_param_ext_118580 + i_123178 * ctx_param_ext_118581)];
                    double zt_res_123181 = sqrt_res_123173 * eta_p_123180;
                    
                    ((double *) mem_118720.mem)[i_123178] = zt_res_123181;
                }
                if (memblock_set(ctx, &ext_mem_118721, &mem_118720, "mem_118720") != 0)
                    return 1;
                rescale_res_118722 = sqrt_res_123173;
                rescale_res_118723 = zp_res_123175;
            } else {
                if (memblock_set(ctx, &ext_mem_118721, &mem_param_118574, "mem_param_118574") != 0)
                    return 1;
                rescale_res_118722 = eta_p_118708;
                rescale_res_118723 = eta_p_118709;
            }
            ((double *) mem_118692.mem)[gtid_118707] = rescale_res_118722;
            ((double *) mem_118693.mem)[gtid_118707] = rescale_res_118723;
            lmad_copy_8b(ctx, 1, (uint64_t *) mem_118694.mem, gtid_118707 * m_33388, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_118721.mem, ext_118718, (int64_t []) {ext_118719}, (int64_t []) {m_33388});
        }
    }
    
  cleanup:
    {
        if (memblock_unref(ctx, &ext_mem_118721, "ext_mem_118721") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_118720, "mem_118720") != 0)
            return 1;
    }
    if (event_127861 != NULL) {
        event_127861->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127860", strdup("nothing further"), event_127861, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_task_127858(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127857 *futhark_mc_task_127857 = (struct futhark_mc_task_127857 *) args;
    struct futhark_context *ctx = futhark_mc_task_127857->ctx;
    struct mc_event *event_127863 = mc_event_new(ctx);
    
    if (event_127863 != NULL)
        event_127863->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127857->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_task_127857->free_exp_absorb_cutoff_33394;
    struct memblock mem_param_118574 = {.desc ="mem_param_118574", .mem =futhark_mc_task_127857->free_mem_param_118574, .size =0, .references =NULL};
    struct memblock mem_param_118577 = {.desc ="mem_param_118577", .mem =futhark_mc_task_127857->free_mem_param_118577, .size =0, .references =NULL};
    int64_t ctx_param_ext_118579 = futhark_mc_task_127857->free_ctx_param_ext_118579;
    int64_t ctx_param_ext_118580 = futhark_mc_task_127857->free_ctx_param_ext_118580;
    int64_t ctx_param_ext_118581 = futhark_mc_task_127857->free_ctx_param_ext_118581;
    struct memblock mem_118633 = {.desc ="mem_118633", .mem =futhark_mc_task_127857->free_mem_118633, .size =0, .references =NULL};
    struct memblock mem_118692 = {.desc ="mem_118692", .mem =futhark_mc_task_127857->free_mem_118692, .size =0, .references =NULL};
    struct memblock mem_118693 = {.desc ="mem_118693", .mem =futhark_mc_task_127857->free_mem_118693, .size =0, .references =NULL};
    struct memblock mem_118694 = {.desc ="mem_118694", .mem =futhark_mc_task_127857->free_mem_118694, .size =0, .references =NULL};
    double zs_res_118701 = futhark_mc_task_127857->free_zs_res_118701;
    int64_t bytes_118702 = futhark_mc_task_127857->free_bytes_118702;
    int32_t nsubtasks_123171;
    
    nsubtasks_123171 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_127859 futhark_mc_segmap_parloop_struct_127859_;
    
    futhark_mc_segmap_parloop_struct_127859_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_127859_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_127859_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segmap_parloop_struct_127859_.free_mem_param_118574 = mem_param_118574.mem;
    futhark_mc_segmap_parloop_struct_127859_.free_mem_param_118577 = mem_param_118577.mem;
    futhark_mc_segmap_parloop_struct_127859_.free_ctx_param_ext_118579 = ctx_param_ext_118579;
    futhark_mc_segmap_parloop_struct_127859_.free_ctx_param_ext_118580 = ctx_param_ext_118580;
    futhark_mc_segmap_parloop_struct_127859_.free_ctx_param_ext_118581 = ctx_param_ext_118581;
    futhark_mc_segmap_parloop_struct_127859_.free_mem_118633 = mem_118633.mem;
    futhark_mc_segmap_parloop_struct_127859_.free_mem_118692 = mem_118692.mem;
    futhark_mc_segmap_parloop_struct_127859_.free_mem_118693 = mem_118693.mem;
    futhark_mc_segmap_parloop_struct_127859_.free_mem_118694 = mem_118694.mem;
    futhark_mc_segmap_parloop_struct_127859_.free_zs_res_118701 = zs_res_118701;
    futhark_mc_segmap_parloop_struct_127859_.free_bytes_118702 = bytes_118702;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_127860_task;
    
    futhark_mc_segmap_parloop_127860_task.name = "futhark_mc_segmap_parloop_127860";
    futhark_mc_segmap_parloop_127860_task.fn = futhark_mc_segmap_parloop_127860;
    futhark_mc_segmap_parloop_127860_task.args = &futhark_mc_segmap_parloop_struct_127859_;
    futhark_mc_segmap_parloop_127860_task.iterations = iterations;
    futhark_mc_segmap_parloop_127860_task.info = info;
    
    struct mc_event *event_127862 = mc_event_new(ctx);
    
    if (event_127862 != NULL)
        event_127862->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_127860_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_127860_task);
    
    if (futhark_mc_segmap_parloop_127860_err != 0) {
        err = futhark_mc_segmap_parloop_127860_err;
        goto cleanup;
    }
    if (event_127862 != NULL) {
        event_127862->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127860_total", strdup("nothing further"), event_127862, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_127863 != NULL) {
        event_127863->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_task_127858", strdup("nothing further"), event_127863, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_127864 {
    struct futhark_context *ctx;
    double free_zs_res_107134;
    unsigned char *free_mem_118588;
    int64_t free_flat_tid_118737;
    bool *retval_defunc_0_reduce_res_118736;
};
struct futhark_mc_segred_stage_1_parloop_struct_127867 {
    struct futhark_context *ctx;
    double free_zs_res_107134;
    unsigned char *free_mem_118588;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123191;
};
static int futhark_mc_segred_stage_1_parloop_127868(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127867 *futhark_mc_segred_stage_1_parloop_struct_127867 = (struct futhark_mc_segred_stage_1_parloop_struct_127867 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127867->ctx;
    struct mc_event *event_127869 = mc_event_new(ctx);
    
    if (event_127869 != NULL)
        event_127869->bef = get_wall_time();
    
    double zs_res_107134 = futhark_mc_segred_stage_1_parloop_struct_127867->free_zs_res_107134;
    struct memblock mem_118588 = {.desc ="mem_118588", .mem =futhark_mc_segred_stage_1_parloop_struct_127867->free_mem_118588, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_123191 = {.desc ="reduce_stage_1_tid_res_arr_mem_123191", .mem =futhark_mc_segred_stage_1_parloop_struct_127867->free_reduce_stage_1_tid_res_arr_mem_123191, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118737;
    
    flat_tid_118737 = subtask_id;
    {
        bool eta_p_123193;
        bool eta_p_123194;
        bool local_acc_123196 = 0;
        bool eta_p_118739;
        bool eta_p_118740;
        bool local_acc_123197 = 0;
        int64_t start_123198;
        int64_t end_123199;
        
        start_123198 = start;
        end_123199 = end;
        
        int64_t n_123200 = end_123199 - start_123198;
        
        for (int64_t SegRed_i_123201 = start_123198; SegRed_i_123201 < start_123198 + n_123200; SegRed_i_123201++) {
            int64_t gtid_118738 = SegRed_i_123201;
            double eta_p_118742 = ((double *) mem_118588.mem)[gtid_118738];
            bool zlze_res_118743 = eta_p_118742 <= zs_res_107134;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_118739 = local_acc_123197;
            }
            // Load next params
            {
                eta_p_118740 = zlze_res_118743;
            }
            // SegRed body
            {
                bool defunc_0_op_res_118741 = eta_p_118739 || eta_p_118740;
                
                local_acc_123197 = defunc_0_op_res_118741;
            }
        }
        
        int64_t uni_i_123202 = 0;
        
        {
            int64_t gtid_118738 = uni_i_123202;
            
            // Load accum params
            {
                eta_p_123193 = local_acc_123196;
            }
            // Load next params
            {
                eta_p_123194 = local_acc_123197;
            }
            // SegRed body
            {
                bool defunc_0_op_res_123195 = eta_p_123193 || eta_p_123194;
                
                local_acc_123196 = defunc_0_op_res_123195;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_123191.mem)[flat_tid_118737] = local_acc_123196;
    }
    
  cleanup:
    { }
    if (event_127869 != NULL) {
        event_127869->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127868", strdup("nothing further"), event_127869, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127865(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127864 *futhark_mc_task_127864 = (struct futhark_mc_task_127864 *) args;
    struct futhark_context *ctx = futhark_mc_task_127864->ctx;
    struct mc_event *event_127871 = mc_event_new(ctx);
    
    if (event_127871 != NULL)
        event_127871->bef = get_wall_time();
    
    double zs_res_107134 = futhark_mc_task_127864->free_zs_res_107134;
    struct memblock mem_118588 = {.desc ="mem_118588", .mem =futhark_mc_task_127864->free_mem_118588, .size =0, .references =NULL};
    int64_t flat_tid_118737 = futhark_mc_task_127864->free_flat_tid_118737;
    bool defunc_0_reduce_res_118736 = *futhark_mc_task_127864->retval_defunc_0_reduce_res_118736;
    int64_t reduce_stage_1_tid_res_arr_mem_123191_cached_sizze_127866 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123191 = NULL;
    int32_t nsubtasks_123190;
    
    nsubtasks_123190 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_123191_cached_sizze_127866 < nsubtasks_123190) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123191, &reduce_stage_1_tid_res_arr_mem_123191_cached_sizze_127866, nsubtasks_123190);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127867 futhark_mc_segred_stage_1_parloop_struct_127867_;
    
    futhark_mc_segred_stage_1_parloop_struct_127867_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127867_.free_zs_res_107134 = zs_res_107134;
    futhark_mc_segred_stage_1_parloop_struct_127867_.free_mem_118588 = mem_118588.mem;
    futhark_mc_segred_stage_1_parloop_struct_127867_.free_reduce_stage_1_tid_res_arr_mem_123191 = reduce_stage_1_tid_res_arr_mem_123191;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127868_task;
    
    futhark_mc_segred_stage_1_parloop_127868_task.name = "futhark_mc_segred_stage_1_parloop_127868";
    futhark_mc_segred_stage_1_parloop_127868_task.fn = futhark_mc_segred_stage_1_parloop_127868;
    futhark_mc_segred_stage_1_parloop_127868_task.args = &futhark_mc_segred_stage_1_parloop_struct_127867_;
    futhark_mc_segred_stage_1_parloop_127868_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127868_task.info = info;
    
    struct mc_event *event_127870 = mc_event_new(ctx);
    
    if (event_127870 != NULL)
        event_127870->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127868_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127868_task);
    
    if (futhark_mc_segred_stage_1_parloop_127868_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127868_err;
        goto cleanup;
    }
    if (event_127870 != NULL) {
        event_127870->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127868_total", strdup("nothing further"), event_127870, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_118736 = 0;
    }
    
    bool eta_p_123203;
    bool eta_p_123204;
    
    for (int32_t i_123206 = 0; i_123206 < nsubtasks_123190; i_123206++) {
        flat_tid_118737 = i_123206;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_123203 = defunc_0_reduce_res_118736;
            }
            // load next params
            {
                eta_p_123204 = ((bool *) reduce_stage_1_tid_res_arr_mem_123191)[flat_tid_118737];
            }
            // red body
            {
                bool defunc_0_op_res_123205 = eta_p_123203 || eta_p_123204;
                
                defunc_0_reduce_res_118736 = defunc_0_op_res_123205;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_123191);
    }
    if (event_127871 != NULL) {
        event_127871->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127865", strdup("nothing further"), event_127871, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127864->retval_defunc_0_reduce_res_118736 = defunc_0_reduce_res_118736;
    }
    return err;
}
struct futhark_mc_task_127872 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    unsigned char *free_mem_param_118578;
    unsigned char *free_mem_118588;
    int64_t free_ext_118689;
    int64_t free_ext_118690;
    int64_t free_ext_118691;
    unsigned char *free_ext_mem_118697;
    unsigned char *free_mem_118751;
    unsigned char *free_mem_118752;
    unsigned char *free_mem_118753;
    double free_zs_res_118760;
    int64_t free_bytes_118761;
};
struct futhark_mc_segmap_parloop_struct_127874 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    unsigned char *free_mem_param_118578;
    unsigned char *free_mem_118588;
    int64_t free_ext_118689;
    int64_t free_ext_118690;
    int64_t free_ext_118691;
    unsigned char *free_ext_mem_118697;
    unsigned char *free_mem_118751;
    unsigned char *free_mem_118752;
    unsigned char *free_mem_118753;
    double free_zs_res_118760;
    int64_t free_bytes_118761;
};
static int futhark_mc_segmap_parloop_127875(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_127874 *futhark_mc_segmap_parloop_struct_127874 = (struct futhark_mc_segmap_parloop_struct_127874 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_127874->ctx;
    struct mc_event *event_127876 = mc_event_new(ctx);
    
    if (event_127876 != NULL)
        event_127876->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_127874->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_segmap_parloop_struct_127874->free_exp_absorb_cutoff_33394;
    struct memblock mem_param_118578 = {.desc ="mem_param_118578", .mem =futhark_mc_segmap_parloop_struct_127874->free_mem_param_118578, .size =0, .references =NULL};
    struct memblock mem_118588 = {.desc ="mem_118588", .mem =futhark_mc_segmap_parloop_struct_127874->free_mem_118588, .size =0, .references =NULL};
    int64_t ext_118689 = futhark_mc_segmap_parloop_struct_127874->free_ext_118689;
    int64_t ext_118690 = futhark_mc_segmap_parloop_struct_127874->free_ext_118690;
    int64_t ext_118691 = futhark_mc_segmap_parloop_struct_127874->free_ext_118691;
    struct memblock ext_mem_118697 = {.desc ="ext_mem_118697", .mem =futhark_mc_segmap_parloop_struct_127874->free_ext_mem_118697, .size =0, .references =NULL};
    struct memblock mem_118751 = {.desc ="mem_118751", .mem =futhark_mc_segmap_parloop_struct_127874->free_mem_118751, .size =0, .references =NULL};
    struct memblock mem_118752 = {.desc ="mem_118752", .mem =futhark_mc_segmap_parloop_struct_127874->free_mem_118752, .size =0, .references =NULL};
    struct memblock mem_118753 = {.desc ="mem_118753", .mem =futhark_mc_segmap_parloop_struct_127874->free_mem_118753, .size =0, .references =NULL};
    double zs_res_118760 = futhark_mc_segmap_parloop_struct_127874->free_zs_res_118760;
    int64_t bytes_118761 = futhark_mc_segmap_parloop_struct_127874->free_bytes_118761;
    int64_t iterations = end - start;
    struct memblock ext_mem_118780;
    
    ext_mem_118780.references = NULL;
    
    struct memblock mem_118779;
    
    mem_118779.references = NULL;
    
    int64_t flat_tid_118765;
    
    flat_tid_118765 = subtask_id;
    {
        int64_t start_123219;
        int64_t end_123220;
        
        start_123219 = start;
        end_123220 = end;
        
        int64_t n_123221 = end_123220 - start_123219;
        
        if (memblock_alloc(ctx, &mem_118779, bytes_118761, "mem_118779")) {
            err = 1;
            goto cleanup;
        }
        for (int64_t SegMap_i_123222 = start_123219; SegMap_i_123222 < start_123219 + n_123221; SegMap_i_123222++) {
            int64_t slice_123223 = m_33388;
            int64_t gtid_118766 = SegMap_i_123222;
            int64_t remnant_123224 = SegMap_i_123222 - gtid_118766;
            double eta_p_118767 = ((double *) mem_118588.mem)[gtid_118766];
            double eta_p_118768 = ((double *) mem_param_118578.mem)[gtid_118766];
            bool zgze_res_118770 = exp_absorb_cutoff_33394 <= eta_p_118767;
            bool zl_res_118771 = eta_p_118767 < zs_res_118760;
            bool x_118772 = !zgze_res_118770;
            bool y_118773 = zl_res_118771 && x_118772;
            bool cond_118774 = zgze_res_118770 || y_118773;
            int64_t binop_y_118775 = gtid_118766 * ext_118691;
            int64_t lmad_ext_118776 = ext_118689 + binop_y_118775;
            int64_t ext_118777;
            
            if (cond_118774) {
                ext_118777 = (int64_t) 0;
            } else {
                ext_118777 = lmad_ext_118776;
            }
            
            int64_t ext_118778;
            
            if (cond_118774) {
                ext_118778 = (int64_t) 1;
            } else {
                ext_118778 = ext_118690;
            }
            
            double rescale_res_118781;
            double rescale_res_118782;
            
            if (cond_118774) {
                double log_res_123208 = futrts_log64(eta_p_118767);
                double sqrt_res_123209 = futrts_sqrt64(eta_p_118767);
                double zs_res_123210 = log_res_123208 / 2.0;
                double zp_res_123211 = eta_p_118768 + zs_res_123210;
                
                for (int64_t i_123214 = 0; i_123214 < m_33388; i_123214++) {
                    double eta_p_123216 = ((double *) ext_mem_118697.mem)[ext_118689 + (i_123214 * ext_118690 + gtid_118766 * ext_118691)];
                    double zt_res_123217 = sqrt_res_123209 * eta_p_123216;
                    
                    ((double *) mem_118779.mem)[i_123214] = zt_res_123217;
                }
                if (memblock_set(ctx, &ext_mem_118780, &mem_118779, "mem_118779") != 0)
                    return 1;
                rescale_res_118781 = sqrt_res_123209;
                rescale_res_118782 = zp_res_123211;
            } else {
                if (memblock_set(ctx, &ext_mem_118780, &ext_mem_118697, "ext_mem_118697") != 0)
                    return 1;
                rescale_res_118781 = eta_p_118767;
                rescale_res_118782 = eta_p_118768;
            }
            ((double *) mem_118751.mem)[gtid_118766] = rescale_res_118781;
            ((double *) mem_118752.mem)[gtid_118766] = rescale_res_118782;
            lmad_copy_8b(ctx, 1, (uint64_t *) mem_118753.mem, gtid_118766 * m_33388, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_118780.mem, ext_118777, (int64_t []) {ext_118778}, (int64_t []) {m_33388});
        }
    }
    
  cleanup:
    {
        if (memblock_unref(ctx, &ext_mem_118780, "ext_mem_118780") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_118779, "mem_118779") != 0)
            return 1;
    }
    if (event_127876 != NULL) {
        event_127876->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127875", strdup("nothing further"), event_127876, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_task_127873(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127872 *futhark_mc_task_127872 = (struct futhark_mc_task_127872 *) args;
    struct futhark_context *ctx = futhark_mc_task_127872->ctx;
    struct mc_event *event_127878 = mc_event_new(ctx);
    
    if (event_127878 != NULL)
        event_127878->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127872->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_task_127872->free_exp_absorb_cutoff_33394;
    struct memblock mem_param_118578 = {.desc ="mem_param_118578", .mem =futhark_mc_task_127872->free_mem_param_118578, .size =0, .references =NULL};
    struct memblock mem_118588 = {.desc ="mem_118588", .mem =futhark_mc_task_127872->free_mem_118588, .size =0, .references =NULL};
    int64_t ext_118689 = futhark_mc_task_127872->free_ext_118689;
    int64_t ext_118690 = futhark_mc_task_127872->free_ext_118690;
    int64_t ext_118691 = futhark_mc_task_127872->free_ext_118691;
    struct memblock ext_mem_118697 = {.desc ="ext_mem_118697", .mem =futhark_mc_task_127872->free_ext_mem_118697, .size =0, .references =NULL};
    struct memblock mem_118751 = {.desc ="mem_118751", .mem =futhark_mc_task_127872->free_mem_118751, .size =0, .references =NULL};
    struct memblock mem_118752 = {.desc ="mem_118752", .mem =futhark_mc_task_127872->free_mem_118752, .size =0, .references =NULL};
    struct memblock mem_118753 = {.desc ="mem_118753", .mem =futhark_mc_task_127872->free_mem_118753, .size =0, .references =NULL};
    double zs_res_118760 = futhark_mc_task_127872->free_zs_res_118760;
    int64_t bytes_118761 = futhark_mc_task_127872->free_bytes_118761;
    int32_t nsubtasks_123207;
    
    nsubtasks_123207 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_127874 futhark_mc_segmap_parloop_struct_127874_;
    
    futhark_mc_segmap_parloop_struct_127874_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_127874_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_127874_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segmap_parloop_struct_127874_.free_mem_param_118578 = mem_param_118578.mem;
    futhark_mc_segmap_parloop_struct_127874_.free_mem_118588 = mem_118588.mem;
    futhark_mc_segmap_parloop_struct_127874_.free_ext_118689 = ext_118689;
    futhark_mc_segmap_parloop_struct_127874_.free_ext_118690 = ext_118690;
    futhark_mc_segmap_parloop_struct_127874_.free_ext_118691 = ext_118691;
    futhark_mc_segmap_parloop_struct_127874_.free_ext_mem_118697 = ext_mem_118697.mem;
    futhark_mc_segmap_parloop_struct_127874_.free_mem_118751 = mem_118751.mem;
    futhark_mc_segmap_parloop_struct_127874_.free_mem_118752 = mem_118752.mem;
    futhark_mc_segmap_parloop_struct_127874_.free_mem_118753 = mem_118753.mem;
    futhark_mc_segmap_parloop_struct_127874_.free_zs_res_118760 = zs_res_118760;
    futhark_mc_segmap_parloop_struct_127874_.free_bytes_118761 = bytes_118761;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_127875_task;
    
    futhark_mc_segmap_parloop_127875_task.name = "futhark_mc_segmap_parloop_127875";
    futhark_mc_segmap_parloop_127875_task.fn = futhark_mc_segmap_parloop_127875;
    futhark_mc_segmap_parloop_127875_task.args = &futhark_mc_segmap_parloop_struct_127874_;
    futhark_mc_segmap_parloop_127875_task.iterations = iterations;
    futhark_mc_segmap_parloop_127875_task.info = info;
    
    struct mc_event *event_127877 = mc_event_new(ctx);
    
    if (event_127877 != NULL)
        event_127877->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_127875_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_127875_task);
    
    if (futhark_mc_segmap_parloop_127875_err != 0) {
        err = futhark_mc_segmap_parloop_127875_err;
        goto cleanup;
    }
    if (event_127877 != NULL) {
        event_127877->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127875_total", strdup("nothing further"), event_127877, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_127878 != NULL) {
        event_127878->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_task_127873", strdup("nothing further"), event_127878, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_127879 {
    struct futhark_context *ctx;
    unsigned char *free_mem_param_118575;
    unsigned char *free_ext_mem_118695;
    int64_t free_flat_tid_118797;
    double *retval_defunc_0_reduce_res_118796;
};
struct futhark_mc_segred_stage_1_parloop_struct_127882 {
    struct futhark_context *ctx;
    unsigned char *free_mem_param_118575;
    unsigned char *free_ext_mem_118695;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123227;
};
static int futhark_mc_segred_stage_1_parloop_127883(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127882 *futhark_mc_segred_stage_1_parloop_struct_127882 = (struct futhark_mc_segred_stage_1_parloop_struct_127882 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127882->ctx;
    struct mc_event *event_127884 = mc_event_new(ctx);
    
    if (event_127884 != NULL)
        event_127884->bef = get_wall_time();
    
    struct memblock mem_param_118575 = {.desc ="mem_param_118575", .mem =futhark_mc_segred_stage_1_parloop_struct_127882->free_mem_param_118575, .size =0, .references =NULL};
    struct memblock ext_mem_118695 = {.desc ="ext_mem_118695", .mem =futhark_mc_segred_stage_1_parloop_struct_127882->free_ext_mem_118695, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_123227 = {.desc ="reduce_stage_1_tid_res_arr_mem_123227", .mem =futhark_mc_segred_stage_1_parloop_struct_127882->free_reduce_stage_1_tid_res_arr_mem_123227, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118797;
    
    flat_tid_118797 = subtask_id;
    {
        double eta_p_123229;
        double eta_p_123230;
        double local_acc_123232 = 0.0;
        double eta_p_118799;
        double eta_p_118800;
        double local_acc_123233 = 0.0;
        int64_t start_123234;
        int64_t end_123235;
        
        start_123234 = start;
        end_123235 = end;
        
        int64_t n_123236 = end_123235 - start_123234;
        
        for (int64_t SegRed_i_123237 = start_123234; SegRed_i_123237 < start_123234 + n_123236; SegRed_i_123237++) {
            int64_t gtid_118798 = SegRed_i_123237;
            double eta_p_118802 = ((double *) mem_param_118575.mem)[gtid_118798];
            double eta_p_118803 = ((double *) ext_mem_118695.mem)[gtid_118798];
            double zs_res_118804 = eta_p_118802 / eta_p_118803;
            double zm_res_118805 = zs_res_118804 - 1.0;
            double abs_res_118806 = fabs64(zm_res_118805);
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_118799 = local_acc_123233;
            }
            // Load next params
            {
                eta_p_118800 = abs_res_118806;
            }
            // SegRed body
            {
                double max_res_118801 = fmax64(eta_p_118799, eta_p_118800);
                
                local_acc_123233 = max_res_118801;
            }
        }
        
        int64_t uni_i_123238 = 0;
        
        {
            int64_t gtid_118798 = uni_i_123238;
            
            // Load accum params
            {
                eta_p_123229 = local_acc_123232;
            }
            // Load next params
            {
                eta_p_123230 = local_acc_123233;
            }
            // SegRed body
            {
                double max_res_123231 = fmax64(eta_p_123229, eta_p_123230);
                
                local_acc_123232 = max_res_123231;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_123227.mem)[flat_tid_118797] = local_acc_123232;
    }
    
  cleanup:
    { }
    if (event_127884 != NULL) {
        event_127884->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127883", strdup("nothing further"), event_127884, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127880(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127879 *futhark_mc_task_127879 = (struct futhark_mc_task_127879 *) args;
    struct futhark_context *ctx = futhark_mc_task_127879->ctx;
    struct mc_event *event_127886 = mc_event_new(ctx);
    
    if (event_127886 != NULL)
        event_127886->bef = get_wall_time();
    
    struct memblock mem_param_118575 = {.desc ="mem_param_118575", .mem =futhark_mc_task_127879->free_mem_param_118575, .size =0, .references =NULL};
    struct memblock ext_mem_118695 = {.desc ="ext_mem_118695", .mem =futhark_mc_task_127879->free_ext_mem_118695, .size =0, .references =NULL};
    int64_t flat_tid_118797 = futhark_mc_task_127879->free_flat_tid_118797;
    double defunc_0_reduce_res_118796 = *futhark_mc_task_127879->retval_defunc_0_reduce_res_118796;
    int64_t reduce_stage_1_tid_res_arr_mem_123227_cached_sizze_127881 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123227 = NULL;
    int32_t nsubtasks_123226;
    
    nsubtasks_123226 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_123227_cached_sizze_127881 < (int64_t) 8 * nsubtasks_123226) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123227, &reduce_stage_1_tid_res_arr_mem_123227_cached_sizze_127881, (int64_t) 8 * nsubtasks_123226);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127882 futhark_mc_segred_stage_1_parloop_struct_127882_;
    
    futhark_mc_segred_stage_1_parloop_struct_127882_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127882_.free_mem_param_118575 = mem_param_118575.mem;
    futhark_mc_segred_stage_1_parloop_struct_127882_.free_ext_mem_118695 = ext_mem_118695.mem;
    futhark_mc_segred_stage_1_parloop_struct_127882_.free_reduce_stage_1_tid_res_arr_mem_123227 = reduce_stage_1_tid_res_arr_mem_123227;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127883_task;
    
    futhark_mc_segred_stage_1_parloop_127883_task.name = "futhark_mc_segred_stage_1_parloop_127883";
    futhark_mc_segred_stage_1_parloop_127883_task.fn = futhark_mc_segred_stage_1_parloop_127883;
    futhark_mc_segred_stage_1_parloop_127883_task.args = &futhark_mc_segred_stage_1_parloop_struct_127882_;
    futhark_mc_segred_stage_1_parloop_127883_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127883_task.info = info;
    
    struct mc_event *event_127885 = mc_event_new(ctx);
    
    if (event_127885 != NULL)
        event_127885->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127883_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127883_task);
    
    if (futhark_mc_segred_stage_1_parloop_127883_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127883_err;
        goto cleanup;
    }
    if (event_127885 != NULL) {
        event_127885->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127883_total", strdup("nothing further"), event_127885, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_118796 = 0.0;
    }
    
    double eta_p_123239;
    double eta_p_123240;
    
    for (int32_t i_123242 = 0; i_123242 < nsubtasks_123226; i_123242++) {
        flat_tid_118797 = i_123242;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_123239 = defunc_0_reduce_res_118796;
            }
            // load next params
            {
                eta_p_123240 = ((double *) reduce_stage_1_tid_res_arr_mem_123227)[flat_tid_118797];
            }
            // red body
            {
                double max_res_123241 = fmax64(eta_p_123239, eta_p_123240);
                
                defunc_0_reduce_res_118796 = max_res_123241;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_123227);
    }
    if (event_127886 != NULL) {
        event_127886->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127880", strdup("nothing further"), event_127886, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127879->retval_defunc_0_reduce_res_118796 = defunc_0_reduce_res_118796;
    }
    return err;
}
struct futhark_mc_task_127887 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_bytes_111715;
    int64_t free_ext_111948;
    int64_t free_ext_111949;
    int64_t free_ext_111950;
    unsigned char *free_ext_mem_111953;
    unsigned char *free_ext_mem_111954;
    unsigned char *free_ext_mem_111955;
    int64_t free_flat_tid_118808;
    int64_t free_flat_tid_118826;
    double *retval_defunc_res_107414;
    unsigned char *retval_mem_111968;
};
struct futhark_mc_segred_stage_1_parloop_struct_127890 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_bytes_111715;
    int64_t free_ext_111948;
    int64_t free_ext_111949;
    int64_t free_ext_111950;
    unsigned char *free_ext_mem_111953;
    unsigned char *free_ext_mem_111954;
    unsigned char *free_ext_mem_111955;
    unsigned char *free_mem_111968;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123244;
};
static int futhark_mc_segred_stage_1_parloop_127891(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127890 *futhark_mc_segred_stage_1_parloop_struct_127890 = (struct futhark_mc_segred_stage_1_parloop_struct_127890 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127890->ctx;
    struct mc_event *event_127893 = mc_event_new(ctx);
    
    if (event_127893 != NULL)
        event_127893->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127890->free_m_33388;
    int64_t bytes_111715 = futhark_mc_segred_stage_1_parloop_struct_127890->free_bytes_111715;
    int64_t ext_111948 = futhark_mc_segred_stage_1_parloop_struct_127890->free_ext_111948;
    int64_t ext_111949 = futhark_mc_segred_stage_1_parloop_struct_127890->free_ext_111949;
    int64_t ext_111950 = futhark_mc_segred_stage_1_parloop_struct_127890->free_ext_111950;
    struct memblock ext_mem_111953 = {.desc ="ext_mem_111953", .mem =futhark_mc_segred_stage_1_parloop_struct_127890->free_ext_mem_111953, .size =0, .references =NULL};
    struct memblock ext_mem_111954 = {.desc ="ext_mem_111954", .mem =futhark_mc_segred_stage_1_parloop_struct_127890->free_ext_mem_111954, .size =0, .references =NULL};
    struct memblock ext_mem_111955 = {.desc ="ext_mem_111955", .mem =futhark_mc_segred_stage_1_parloop_struct_127890->free_ext_mem_111955, .size =0, .references =NULL};
    struct memblock mem_111968 = {.desc ="mem_111968", .mem =futhark_mc_segred_stage_1_parloop_struct_127890->free_mem_111968, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_123244 = {.desc ="reduce_stage_1_tid_res_arr_mem_123244", .mem =futhark_mc_segred_stage_1_parloop_struct_127890->free_reduce_stage_1_tid_res_arr_mem_123244, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t mem_118832_cached_sizze_127892 = 0;
    unsigned char *mem_118832 = NULL;
    int64_t flat_tid_118826;
    
    flat_tid_118826 = subtask_id;
    {
        double eta_p_123246;
        double eta_p_123247;
        double local_acc_123249 = 0.0;
        double eta_p_118828;
        double eta_p_118829;
        double local_acc_123250 = 0.0;
        int64_t start_123251;
        int64_t end_123252;
        
        start_123251 = start;
        end_123252 = end;
        
        int64_t n_123253 = end_123252 - start_123251;
        
        if (mem_118832_cached_sizze_127892 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_118832, &mem_118832_cached_sizze_127892, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        for (int64_t SegRed_i_123254 = start_123251; SegRed_i_123254 < start_123251 + n_123253; SegRed_i_123254++) {
            int64_t gtid_118827 = SegRed_i_123254;
            double eta_p_118831 = ((double *) ext_mem_111954.mem)[gtid_118827];
            double defunc_res_118834;
            double redout_118837 = 0.0;
            
            for (int64_t i_118836 = 0; i_118836 < m_33388; i_118836++) {
                double eta_p_118839 = ((double *) ext_mem_111955.mem)[ext_111950 + (gtid_118827 * ext_111949 + i_118836 * ext_111948)];
                double eta_p_wasfree_118840 = ((double *) ext_mem_111953.mem)[i_118836];
                double zt_res_118841 = eta_p_118831 * eta_p_118839;
                double zt_res_118842 = eta_p_wasfree_118840 * zt_res_118841;
                double zp_res_118843 = zt_res_118842 + redout_118837;
                
                ((double *) mem_118832)[i_118836] = zt_res_118842;
                
                double redout_tmp_123255 = zp_res_118843;
                
                redout_118837 = redout_tmp_123255;
            }
            defunc_res_118834 = redout_118837;
            // save map-out results
            {
                lmad_copy_8b(ctx, 1, (uint64_t *) mem_111968.mem, gtid_118827 * m_33388, (int64_t []) {(int64_t) 1}, (uint64_t *) mem_118832, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_33388});
            }
            // Load accum params
            {
                eta_p_118828 = local_acc_123250;
            }
            // Load next params
            {
                eta_p_118829 = defunc_res_118834;
            }
            // SegRed body
            {
                double zp_res_118830 = eta_p_118828 + eta_p_118829;
                
                local_acc_123250 = zp_res_118830;
            }
        }
        
        int64_t uni_i_123257 = 0;
        
        {
            int64_t gtid_118827 = uni_i_123257;
            
            // Load accum params
            {
                eta_p_123246 = local_acc_123249;
            }
            // Load next params
            {
                eta_p_123247 = local_acc_123250;
            }
            // SegRed body
            {
                double zp_res_123248 = eta_p_123246 + eta_p_123247;
                
                local_acc_123249 = zp_res_123248;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_123244.mem)[flat_tid_118826] = local_acc_123249;
    }
    
  cleanup:
    {
        free(mem_118832);
    }
    if (event_127893 != NULL) {
        event_127893->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127891", strdup("nothing further"), event_127893, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127888(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127887 *futhark_mc_task_127887 = (struct futhark_mc_task_127887 *) args;
    struct futhark_context *ctx = futhark_mc_task_127887->ctx;
    struct mc_event *event_127895 = mc_event_new(ctx);
    
    if (event_127895 != NULL)
        event_127895->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127887->free_m_33388;
    int64_t bytes_111715 = futhark_mc_task_127887->free_bytes_111715;
    int64_t ext_111948 = futhark_mc_task_127887->free_ext_111948;
    int64_t ext_111949 = futhark_mc_task_127887->free_ext_111949;
    int64_t ext_111950 = futhark_mc_task_127887->free_ext_111950;
    struct memblock ext_mem_111953 = {.desc ="ext_mem_111953", .mem =futhark_mc_task_127887->free_ext_mem_111953, .size =0, .references =NULL};
    struct memblock ext_mem_111954 = {.desc ="ext_mem_111954", .mem =futhark_mc_task_127887->free_ext_mem_111954, .size =0, .references =NULL};
    struct memblock ext_mem_111955 = {.desc ="ext_mem_111955", .mem =futhark_mc_task_127887->free_ext_mem_111955, .size =0, .references =NULL};
    int64_t flat_tid_118808 = futhark_mc_task_127887->free_flat_tid_118808;
    int64_t flat_tid_118826 = futhark_mc_task_127887->free_flat_tid_118826;
    double defunc_res_107414 = *futhark_mc_task_127887->retval_defunc_res_107414;
    struct memblock mem_111968 = {.desc ="mem_111968", .mem =futhark_mc_task_127887->retval_mem_111968, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_123244_cached_sizze_127889 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123244 = NULL;
    int32_t nsubtasks_123243;
    
    nsubtasks_123243 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_123244_cached_sizze_127889 < (int64_t) 8 * nsubtasks_123243) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123244, &reduce_stage_1_tid_res_arr_mem_123244_cached_sizze_127889, (int64_t) 8 * nsubtasks_123243);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127890 futhark_mc_segred_stage_1_parloop_struct_127890_;
    
    futhark_mc_segred_stage_1_parloop_struct_127890_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127890_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127890_.free_bytes_111715 = bytes_111715;
    futhark_mc_segred_stage_1_parloop_struct_127890_.free_ext_111948 = ext_111948;
    futhark_mc_segred_stage_1_parloop_struct_127890_.free_ext_111949 = ext_111949;
    futhark_mc_segred_stage_1_parloop_struct_127890_.free_ext_111950 = ext_111950;
    futhark_mc_segred_stage_1_parloop_struct_127890_.free_ext_mem_111953 = ext_mem_111953.mem;
    futhark_mc_segred_stage_1_parloop_struct_127890_.free_ext_mem_111954 = ext_mem_111954.mem;
    futhark_mc_segred_stage_1_parloop_struct_127890_.free_ext_mem_111955 = ext_mem_111955.mem;
    futhark_mc_segred_stage_1_parloop_struct_127890_.free_mem_111968 = mem_111968.mem;
    futhark_mc_segred_stage_1_parloop_struct_127890_.free_reduce_stage_1_tid_res_arr_mem_123244 = reduce_stage_1_tid_res_arr_mem_123244;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127891_task;
    
    futhark_mc_segred_stage_1_parloop_127891_task.name = "futhark_mc_segred_stage_1_parloop_127891";
    futhark_mc_segred_stage_1_parloop_127891_task.fn = futhark_mc_segred_stage_1_parloop_127891;
    futhark_mc_segred_stage_1_parloop_127891_task.args = &futhark_mc_segred_stage_1_parloop_struct_127890_;
    futhark_mc_segred_stage_1_parloop_127891_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127891_task.info = info;
    
    struct mc_event *event_127894 = mc_event_new(ctx);
    
    if (event_127894 != NULL)
        event_127894->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127891_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127891_task);
    
    if (futhark_mc_segred_stage_1_parloop_127891_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127891_err;
        goto cleanup;
    }
    if (event_127894 != NULL) {
        event_127894->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127891_total", strdup("nothing further"), event_127894, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_107414 = 0.0;
    }
    
    double eta_p_123258;
    double eta_p_123259;
    
    for (int32_t i_123261 = 0; i_123261 < nsubtasks_123243; i_123261++) {
        flat_tid_118826 = i_123261;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_123258 = defunc_res_107414;
            }
            // load next params
            {
                eta_p_123259 = ((double *) reduce_stage_1_tid_res_arr_mem_123244)[flat_tid_118826];
            }
            // red body
            {
                double zp_res_123260 = eta_p_123258 + eta_p_123259;
                
                defunc_res_107414 = zp_res_123260;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_123244);
    }
    if (event_127895 != NULL) {
        event_127895->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127888", strdup("nothing further"), event_127895, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127887->retval_defunc_res_107414 = defunc_res_107414;
        futhark_mc_task_127887->retval_mem_111968 = mem_111968.mem;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_127898 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_bytes_111715;
    int64_t free_ext_111948;
    int64_t free_ext_111949;
    int64_t free_ext_111950;
    unsigned char *free_ext_mem_111953;
    unsigned char *free_ext_mem_111954;
    unsigned char *free_ext_mem_111955;
    unsigned char *free_mem_111968;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123263;
};
struct futhark_mc_task_127901 {
    struct futhark_context *ctx;
    int64_t free_ext_111948;
    int64_t free_ext_111949;
    int64_t free_ext_111950;
    unsigned char *free_ext_mem_111953;
    unsigned char *free_ext_mem_111955;
    int64_t free_gtid_118809;
    double free_eta_p_118813;
    int64_t free_flat_tid_118817;
    double *retval_defunc_res_118815;
    unsigned char *retval_mem_118814;
};
struct futhark_mc_segred_stage_1_parloop_struct_127904 {
    struct futhark_context *ctx;
    int64_t free_ext_111948;
    int64_t free_ext_111949;
    int64_t free_ext_111950;
    unsigned char *free_ext_mem_111953;
    unsigned char *free_ext_mem_111955;
    int64_t free_gtid_118809;
    double free_eta_p_118813;
    unsigned char *free_mem_118814;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123275;
};
static int futhark_mc_segred_stage_1_parloop_127905(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127904 *futhark_mc_segred_stage_1_parloop_struct_127904 = (struct futhark_mc_segred_stage_1_parloop_struct_127904 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127904->ctx;
    struct mc_event *event_127906 = mc_event_new(ctx);
    
    if (event_127906 != NULL)
        event_127906->bef = get_wall_time();
    
    int64_t ext_111948 = futhark_mc_segred_stage_1_parloop_struct_127904->free_ext_111948;
    int64_t ext_111949 = futhark_mc_segred_stage_1_parloop_struct_127904->free_ext_111949;
    int64_t ext_111950 = futhark_mc_segred_stage_1_parloop_struct_127904->free_ext_111950;
    struct memblock ext_mem_111953 = {.desc ="ext_mem_111953", .mem =futhark_mc_segred_stage_1_parloop_struct_127904->free_ext_mem_111953, .size =0, .references =NULL};
    struct memblock ext_mem_111955 = {.desc ="ext_mem_111955", .mem =futhark_mc_segred_stage_1_parloop_struct_127904->free_ext_mem_111955, .size =0, .references =NULL};
    int64_t gtid_118809 = futhark_mc_segred_stage_1_parloop_struct_127904->free_gtid_118809;
    double eta_p_118813 = futhark_mc_segred_stage_1_parloop_struct_127904->free_eta_p_118813;
    struct memblock mem_118814 = {.desc ="mem_118814", .mem =futhark_mc_segred_stage_1_parloop_struct_127904->free_mem_118814, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_123275 = {.desc ="reduce_stage_1_tid_res_arr_mem_123275", .mem =futhark_mc_segred_stage_1_parloop_struct_127904->free_reduce_stage_1_tid_res_arr_mem_123275, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118817;
    
    flat_tid_118817 = subtask_id;
    {
        double eta_p_123277;
        double eta_p_123278;
        double local_acc_123280 = 0.0;
        double eta_p_118819;
        double eta_p_118820;
        double local_acc_123281 = 0.0;
        int64_t start_123282;
        int64_t end_123283;
        
        start_123282 = start;
        end_123283 = end;
        
        int64_t n_123284 = end_123283 - start_123282;
        
        for (int64_t SegRed_i_123285 = start_123282; SegRed_i_123285 < start_123282 + n_123284; SegRed_i_123285++) {
            int64_t gtid_118818 = SegRed_i_123285;
            double eta_p_118822 = ((double *) ext_mem_111955.mem)[ext_111950 + (gtid_118809 * ext_111949 + gtid_118818 * ext_111948)];
            double eta_p_wasfree_118823 = ((double *) ext_mem_111953.mem)[gtid_118818];
            double zt_res_118824 = eta_p_118813 * eta_p_118822;
            double zt_res_118825 = eta_p_wasfree_118823 * zt_res_118824;
            
            // save map-out results
            {
                ((double *) mem_118814.mem)[gtid_118818] = zt_res_118825;
            }
            // Load accum params
            {
                eta_p_118819 = local_acc_123281;
            }
            // Load next params
            {
                eta_p_118820 = zt_res_118825;
            }
            // SegRed body
            {
                double zp_res_118821 = eta_p_118819 + eta_p_118820;
                
                local_acc_123281 = zp_res_118821;
            }
        }
        
        int64_t uni_i_123286 = 0;
        
        {
            int64_t gtid_118818 = uni_i_123286;
            
            // Load accum params
            {
                eta_p_123277 = local_acc_123280;
            }
            // Load next params
            {
                eta_p_123278 = local_acc_123281;
            }
            // SegRed body
            {
                double zp_res_123279 = eta_p_123277 + eta_p_123278;
                
                local_acc_123280 = zp_res_123279;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_123275.mem)[flat_tid_118817] = local_acc_123280;
    }
    
  cleanup:
    { }
    if (event_127906 != NULL) {
        event_127906->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127905", strdup("nothing further"), event_127906, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127902(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127901 *futhark_mc_task_127901 = (struct futhark_mc_task_127901 *) args;
    struct futhark_context *ctx = futhark_mc_task_127901->ctx;
    struct mc_event *event_127908 = mc_event_new(ctx);
    
    if (event_127908 != NULL)
        event_127908->bef = get_wall_time();
    
    int64_t ext_111948 = futhark_mc_task_127901->free_ext_111948;
    int64_t ext_111949 = futhark_mc_task_127901->free_ext_111949;
    int64_t ext_111950 = futhark_mc_task_127901->free_ext_111950;
    struct memblock ext_mem_111953 = {.desc ="ext_mem_111953", .mem =futhark_mc_task_127901->free_ext_mem_111953, .size =0, .references =NULL};
    struct memblock ext_mem_111955 = {.desc ="ext_mem_111955", .mem =futhark_mc_task_127901->free_ext_mem_111955, .size =0, .references =NULL};
    int64_t gtid_118809 = futhark_mc_task_127901->free_gtid_118809;
    double eta_p_118813 = futhark_mc_task_127901->free_eta_p_118813;
    int64_t flat_tid_118817 = futhark_mc_task_127901->free_flat_tid_118817;
    double defunc_res_118815 = *futhark_mc_task_127901->retval_defunc_res_118815;
    struct memblock mem_118814 = {.desc ="mem_118814", .mem =futhark_mc_task_127901->retval_mem_118814, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_123275_cached_sizze_127903 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123275 = NULL;
    int32_t nsubtasks_123274;
    
    nsubtasks_123274 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_123275_cached_sizze_127903 < (int64_t) 8 * nsubtasks_123274) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123275, &reduce_stage_1_tid_res_arr_mem_123275_cached_sizze_127903, (int64_t) 8 * nsubtasks_123274);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127904 futhark_mc_segred_stage_1_parloop_struct_127904_;
    
    futhark_mc_segred_stage_1_parloop_struct_127904_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127904_.free_ext_111948 = ext_111948;
    futhark_mc_segred_stage_1_parloop_struct_127904_.free_ext_111949 = ext_111949;
    futhark_mc_segred_stage_1_parloop_struct_127904_.free_ext_111950 = ext_111950;
    futhark_mc_segred_stage_1_parloop_struct_127904_.free_ext_mem_111953 = ext_mem_111953.mem;
    futhark_mc_segred_stage_1_parloop_struct_127904_.free_ext_mem_111955 = ext_mem_111955.mem;
    futhark_mc_segred_stage_1_parloop_struct_127904_.free_gtid_118809 = gtid_118809;
    futhark_mc_segred_stage_1_parloop_struct_127904_.free_eta_p_118813 = eta_p_118813;
    futhark_mc_segred_stage_1_parloop_struct_127904_.free_mem_118814 = mem_118814.mem;
    futhark_mc_segred_stage_1_parloop_struct_127904_.free_reduce_stage_1_tid_res_arr_mem_123275 = reduce_stage_1_tid_res_arr_mem_123275;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127905_task;
    
    futhark_mc_segred_stage_1_parloop_127905_task.name = "futhark_mc_segred_stage_1_parloop_127905";
    futhark_mc_segred_stage_1_parloop_127905_task.fn = futhark_mc_segred_stage_1_parloop_127905;
    futhark_mc_segred_stage_1_parloop_127905_task.args = &futhark_mc_segred_stage_1_parloop_struct_127904_;
    futhark_mc_segred_stage_1_parloop_127905_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127905_task.info = info;
    
    struct mc_event *event_127907 = mc_event_new(ctx);
    
    if (event_127907 != NULL)
        event_127907->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127905_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127905_task);
    
    if (futhark_mc_segred_stage_1_parloop_127905_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127905_err;
        goto cleanup;
    }
    if (event_127907 != NULL) {
        event_127907->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127905_total", strdup("nothing further"), event_127907, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_118815 = 0.0;
    }
    
    double eta_p_123287;
    double eta_p_123288;
    
    for (int32_t i_123290 = 0; i_123290 < nsubtasks_123274; i_123290++) {
        flat_tid_118817 = i_123290;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_123287 = defunc_res_118815;
            }
            // load next params
            {
                eta_p_123288 = ((double *) reduce_stage_1_tid_res_arr_mem_123275)[flat_tid_118817];
            }
            // red body
            {
                double zp_res_123289 = eta_p_123287 + eta_p_123288;
                
                defunc_res_118815 = zp_res_123289;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_123275);
    }
    if (event_127908 != NULL) {
        event_127908->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127902", strdup("nothing further"), event_127908, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127901->retval_defunc_res_118815 = defunc_res_118815;
        futhark_mc_task_127901->retval_mem_118814 = mem_118814.mem;
    }
    return err;
}
struct futhark_mc_task_127909 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_111968;
    int64_t free_gtid_118809;
    unsigned char *free_mem_118814;
};
struct futhark_mc_copy_parloop_struct_127911 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_111968;
    int64_t free_gtid_118809;
    unsigned char *free_mem_118814;
};
static int futhark_mc_copy_parloop_127912(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_copy_parloop_struct_127911 *futhark_mc_copy_parloop_struct_127911 = (struct futhark_mc_copy_parloop_struct_127911 *) args;
    struct futhark_context *ctx = futhark_mc_copy_parloop_struct_127911->ctx;
    struct mc_event *event_127913 = mc_event_new(ctx);
    
    if (event_127913 != NULL)
        event_127913->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_copy_parloop_struct_127911->free_m_33388;
    struct memblock mem_111968 = {.desc ="mem_111968", .mem =futhark_mc_copy_parloop_struct_127911->free_mem_111968, .size =0, .references =NULL};
    int64_t gtid_118809 = futhark_mc_copy_parloop_struct_127911->free_gtid_118809;
    struct memblock mem_118814 = {.desc ="mem_118814", .mem =futhark_mc_copy_parloop_struct_127911->free_mem_118814, .size =0, .references =NULL};
    int64_t iterations = end - start;
    
    {
        int64_t start_123291;
        int64_t end_123292;
        
        start_123291 = start;
        end_123292 = end;
        
        int64_t n_123293 = end_123292 - start_123291;
        
        for (int64_t copy_i_123294 = start_123291; copy_i_123294 < start_123291 + n_123293; copy_i_123294++) {
            int64_t slice_123296 = m_33388;
            int64_t i_123295 = copy_i_123294;
            int64_t remnant_123297 = copy_i_123294 - i_123295;
            double tmp_123298 = ((double *) mem_118814.mem)[i_123295];
            
            ((double *) mem_111968.mem)[gtid_118809 * m_33388 + i_123295] = tmp_123298;
        }
    }
    
  cleanup:
    { }
    if (event_127913 != NULL) {
        event_127913->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_parloop_127912", strdup("nothing further"), event_127913, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_copy_123299_task_127910(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127909 *futhark_mc_task_127909 = (struct futhark_mc_task_127909 *) args;
    struct futhark_context *ctx = futhark_mc_task_127909->ctx;
    struct mc_event *event_127915 = mc_event_new(ctx);
    
    if (event_127915 != NULL)
        event_127915->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127909->free_m_33388;
    struct memblock mem_111968 = {.desc ="mem_111968", .mem =futhark_mc_task_127909->free_mem_111968, .size =0, .references =NULL};
    int64_t gtid_118809 = futhark_mc_task_127909->free_gtid_118809;
    struct memblock mem_118814 = {.desc ="mem_118814", .mem =futhark_mc_task_127909->free_mem_118814, .size =0, .references =NULL};
    struct futhark_mc_copy_parloop_struct_127911 futhark_mc_copy_parloop_struct_127911_;
    
    futhark_mc_copy_parloop_struct_127911_.ctx = ctx;
    futhark_mc_copy_parloop_struct_127911_.free_m_33388 = m_33388;
    futhark_mc_copy_parloop_struct_127911_.free_mem_111968 = mem_111968.mem;
    futhark_mc_copy_parloop_struct_127911_.free_gtid_118809 = gtid_118809;
    futhark_mc_copy_parloop_struct_127911_.free_mem_118814 = mem_118814.mem;
    
    struct scheduler_parloop futhark_mc_copy_parloop_127912_task;
    
    futhark_mc_copy_parloop_127912_task.name = "futhark_mc_copy_parloop_127912";
    futhark_mc_copy_parloop_127912_task.fn = futhark_mc_copy_parloop_127912;
    futhark_mc_copy_parloop_127912_task.args = &futhark_mc_copy_parloop_struct_127911_;
    futhark_mc_copy_parloop_127912_task.iterations = iterations;
    futhark_mc_copy_parloop_127912_task.info = info;
    
    struct mc_event *event_127914 = mc_event_new(ctx);
    
    if (event_127914 != NULL)
        event_127914->bef = get_wall_time();
    
    int futhark_mc_copy_parloop_127912_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_copy_parloop_127912_task);
    
    if (futhark_mc_copy_parloop_127912_err != 0) {
        err = futhark_mc_copy_parloop_127912_err;
        goto cleanup;
    }
    if (event_127914 != NULL) {
        event_127914->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_parloop_127912_total", strdup("nothing further"), event_127914, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_127915 != NULL) {
        event_127915->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_123299_task_127910", strdup("nothing further"), event_127915, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_127899(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127898 *futhark_mc_segred_stage_1_parloop_struct_127898 = (struct futhark_mc_segred_stage_1_parloop_struct_127898 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127898->ctx;
    struct mc_event *event_127916 = mc_event_new(ctx);
    
    if (event_127916 != NULL)
        event_127916->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127898->free_m_33388;
    int64_t bytes_111715 = futhark_mc_segred_stage_1_parloop_struct_127898->free_bytes_111715;
    int64_t ext_111948 = futhark_mc_segred_stage_1_parloop_struct_127898->free_ext_111948;
    int64_t ext_111949 = futhark_mc_segred_stage_1_parloop_struct_127898->free_ext_111949;
    int64_t ext_111950 = futhark_mc_segred_stage_1_parloop_struct_127898->free_ext_111950;
    struct memblock ext_mem_111953 = {.desc ="ext_mem_111953", .mem =futhark_mc_segred_stage_1_parloop_struct_127898->free_ext_mem_111953, .size =0, .references =NULL};
    struct memblock ext_mem_111954 = {.desc ="ext_mem_111954", .mem =futhark_mc_segred_stage_1_parloop_struct_127898->free_ext_mem_111954, .size =0, .references =NULL};
    struct memblock ext_mem_111955 = {.desc ="ext_mem_111955", .mem =futhark_mc_segred_stage_1_parloop_struct_127898->free_ext_mem_111955, .size =0, .references =NULL};
    struct memblock mem_111968 = {.desc ="mem_111968", .mem =futhark_mc_segred_stage_1_parloop_struct_127898->free_mem_111968, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_123263 = {.desc ="reduce_stage_1_tid_res_arr_mem_123263", .mem =futhark_mc_segred_stage_1_parloop_struct_127898->free_reduce_stage_1_tid_res_arr_mem_123263, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t mem_118814_cached_sizze_127900 = 0;
    unsigned char *mem_118814 = NULL;
    int64_t flat_tid_118808;
    
    flat_tid_118808 = subtask_id;
    {
        double eta_p_123265;
        double eta_p_123266;
        double local_acc_123268 = 0.0;
        double eta_p_118810;
        double eta_p_118811;
        double local_acc_123269 = 0.0;
        int64_t start_123270;
        int64_t end_123271;
        
        start_123270 = start;
        end_123271 = end;
        
        int64_t n_123272 = end_123271 - start_123270;
        
        if (mem_118814_cached_sizze_127900 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_118814, &mem_118814_cached_sizze_127900, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        for (int64_t SegRed_i_123273 = start_123270; SegRed_i_123273 < start_123270 + n_123272; SegRed_i_123273++) {
            int64_t gtid_118809 = SegRed_i_123273;
            double eta_p_118813 = ((double *) ext_mem_111954.mem)[gtid_118809];
            double defunc_res_118815;
            int64_t flat_tid_118817 = (int64_t) 0;
            
            defunc_res_118815 = 0.0;
            
            struct futhark_mc_task_127901 futhark_mc_task_127901_;
            
            futhark_mc_task_127901_.ctx = ctx;
            futhark_mc_task_127901_.free_ext_111948 = ext_111948;
            futhark_mc_task_127901_.free_ext_111949 = ext_111949;
            futhark_mc_task_127901_.free_ext_111950 = ext_111950;
            futhark_mc_task_127901_.free_ext_mem_111953 = ext_mem_111953.mem;
            futhark_mc_task_127901_.free_ext_mem_111955 = ext_mem_111955.mem;
            futhark_mc_task_127901_.free_gtid_118809 = gtid_118809;
            futhark_mc_task_127901_.free_eta_p_118813 = eta_p_118813;
            futhark_mc_task_127901_.free_flat_tid_118817 = flat_tid_118817;
            futhark_mc_task_127901_.retval_defunc_res_118815 = (double *) &defunc_res_118815;
            #if ISPC
            futhark_mc_task_127901_.retval_defunc_res_118815 += programIndex;
            #endif
            futhark_mc_task_127901_.retval_mem_118814 = mem_118814;
            
            struct scheduler_segop futhark_mc_task_127901_task;
            
            futhark_mc_task_127901_task.args = &futhark_mc_task_127901_;
            futhark_mc_task_127901_task.top_level_fn = futhark_mc_segred_task_127902;
            futhark_mc_task_127901_task.name = "futhark_mc_segred_task_127902";
            futhark_mc_task_127901_task.iterations = m_33388;
            futhark_mc_task_127901_task.task_time = &ctx->program->futhark_mc_segred_task_127902_total_time;
            futhark_mc_task_127901_task.task_iter = &ctx->program->futhark_mc_segred_task_127902_total_iter;
            futhark_mc_task_127901_task.sched = STATIC;
            futhark_mc_task_127901_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_127902_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127901_task);
            
            if (futhark_mc_segred_task_127902_err != 0) {
                err = futhark_mc_segred_task_127902_err;
                goto cleanup;
            }
            // save map-out results
            {
                int64_t iterations_123300 = m_33388;
                struct futhark_mc_task_127909 futhark_mc_task_127909_;
                
                futhark_mc_task_127909_.ctx = ctx;
                futhark_mc_task_127909_.free_m_33388 = m_33388;
                futhark_mc_task_127909_.free_mem_111968 = mem_111968.mem;
                futhark_mc_task_127909_.free_gtid_118809 = gtid_118809;
                futhark_mc_task_127909_.free_mem_118814 = mem_118814;
                
                struct scheduler_segop futhark_mc_task_127909_task;
                
                futhark_mc_task_127909_task.args = &futhark_mc_task_127909_;
                futhark_mc_task_127909_task.top_level_fn = futhark_mc_copy_123299_task_127910;
                futhark_mc_task_127909_task.name = "futhark_mc_copy_123299_task_127910";
                futhark_mc_task_127909_task.iterations = iterations_123300;
                futhark_mc_task_127909_task.task_time = &ctx->program->futhark_mc_copy_123299_task_127910_total_time;
                futhark_mc_task_127909_task.task_iter = &ctx->program->futhark_mc_copy_123299_task_127910_total_iter;
                futhark_mc_task_127909_task.sched = STATIC;
                futhark_mc_task_127909_task.nested_fn = NULL;
                
                int futhark_mc_copy_123299_task_127910_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127909_task);
                
                if (futhark_mc_copy_123299_task_127910_err != 0) {
                    err = futhark_mc_copy_123299_task_127910_err;
                    goto cleanup;
                }
            }
            // Load accum params
            {
                eta_p_118810 = local_acc_123269;
            }
            // Load next params
            {
                eta_p_118811 = defunc_res_118815;
            }
            // SegRed body
            {
                double zp_res_118812 = eta_p_118810 + eta_p_118811;
                
                local_acc_123269 = zp_res_118812;
            }
        }
        
        int64_t uni_i_123301 = 0;
        
        {
            int64_t gtid_118809 = uni_i_123301;
            
            // Load accum params
            {
                eta_p_123265 = local_acc_123268;
            }
            // Load next params
            {
                eta_p_123266 = local_acc_123269;
            }
            // SegRed body
            {
                double zp_res_123267 = eta_p_123265 + eta_p_123266;
                
                local_acc_123268 = zp_res_123267;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_123263.mem)[flat_tid_118808] = local_acc_123268;
    }
    
  cleanup:
    {
        free(mem_118814);
    }
    if (event_127916 != NULL) {
        event_127916->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127899", strdup("nothing further"), event_127916, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_127896(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127887 *futhark_mc_task_127887 = (struct futhark_mc_task_127887 *) args;
    struct futhark_context *ctx = futhark_mc_task_127887->ctx;
    struct mc_event *event_127918 = mc_event_new(ctx);
    
    if (event_127918 != NULL)
        event_127918->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127887->free_m_33388;
    int64_t bytes_111715 = futhark_mc_task_127887->free_bytes_111715;
    int64_t ext_111948 = futhark_mc_task_127887->free_ext_111948;
    int64_t ext_111949 = futhark_mc_task_127887->free_ext_111949;
    int64_t ext_111950 = futhark_mc_task_127887->free_ext_111950;
    struct memblock ext_mem_111953 = {.desc ="ext_mem_111953", .mem =futhark_mc_task_127887->free_ext_mem_111953, .size =0, .references =NULL};
    struct memblock ext_mem_111954 = {.desc ="ext_mem_111954", .mem =futhark_mc_task_127887->free_ext_mem_111954, .size =0, .references =NULL};
    struct memblock ext_mem_111955 = {.desc ="ext_mem_111955", .mem =futhark_mc_task_127887->free_ext_mem_111955, .size =0, .references =NULL};
    int64_t flat_tid_118808 = futhark_mc_task_127887->free_flat_tid_118808;
    int64_t flat_tid_118826 = futhark_mc_task_127887->free_flat_tid_118826;
    double defunc_res_107414 = *futhark_mc_task_127887->retval_defunc_res_107414;
    struct memblock mem_111968 = {.desc ="mem_111968", .mem =futhark_mc_task_127887->retval_mem_111968, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_123263_cached_sizze_127897 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123263 = NULL;
    int32_t nsubtasks_123262;
    
    nsubtasks_123262 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_123263_cached_sizze_127897 < (int64_t) 8 * nsubtasks_123262) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123263, &reduce_stage_1_tid_res_arr_mem_123263_cached_sizze_127897, (int64_t) 8 * nsubtasks_123262);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127898 futhark_mc_segred_stage_1_parloop_struct_127898_;
    
    futhark_mc_segred_stage_1_parloop_struct_127898_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127898_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127898_.free_bytes_111715 = bytes_111715;
    futhark_mc_segred_stage_1_parloop_struct_127898_.free_ext_111948 = ext_111948;
    futhark_mc_segred_stage_1_parloop_struct_127898_.free_ext_111949 = ext_111949;
    futhark_mc_segred_stage_1_parloop_struct_127898_.free_ext_111950 = ext_111950;
    futhark_mc_segred_stage_1_parloop_struct_127898_.free_ext_mem_111953 = ext_mem_111953.mem;
    futhark_mc_segred_stage_1_parloop_struct_127898_.free_ext_mem_111954 = ext_mem_111954.mem;
    futhark_mc_segred_stage_1_parloop_struct_127898_.free_ext_mem_111955 = ext_mem_111955.mem;
    futhark_mc_segred_stage_1_parloop_struct_127898_.free_mem_111968 = mem_111968.mem;
    futhark_mc_segred_stage_1_parloop_struct_127898_.free_reduce_stage_1_tid_res_arr_mem_123263 = reduce_stage_1_tid_res_arr_mem_123263;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127899_task;
    
    futhark_mc_segred_stage_1_parloop_127899_task.name = "futhark_mc_segred_stage_1_parloop_127899";
    futhark_mc_segred_stage_1_parloop_127899_task.fn = futhark_mc_segred_stage_1_parloop_127899;
    futhark_mc_segred_stage_1_parloop_127899_task.args = &futhark_mc_segred_stage_1_parloop_struct_127898_;
    futhark_mc_segred_stage_1_parloop_127899_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127899_task.info = info;
    
    struct mc_event *event_127917 = mc_event_new(ctx);
    
    if (event_127917 != NULL)
        event_127917->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127899_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127899_task);
    
    if (futhark_mc_segred_stage_1_parloop_127899_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127899_err;
        goto cleanup;
    }
    if (event_127917 != NULL) {
        event_127917->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127899_total", strdup("nothing further"), event_127917, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_107414 = 0.0;
    }
    
    double eta_p_123302;
    double eta_p_123303;
    
    for (int32_t i_123305 = 0; i_123305 < nsubtasks_123262; i_123305++) {
        flat_tid_118808 = i_123305;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_123302 = defunc_res_107414;
            }
            // load next params
            {
                eta_p_123303 = ((double *) reduce_stage_1_tid_res_arr_mem_123263)[flat_tid_118808];
            }
            // red body
            {
                double zp_res_123304 = eta_p_123302 + eta_p_123303;
                
                defunc_res_107414 = zp_res_123304;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_123263);
    }
    if (event_127918 != NULL) {
        event_127918->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_127896", strdup("nothing further"), event_127918, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127887->retval_defunc_res_107414 = defunc_res_107414;
        futhark_mc_task_127887->retval_mem_111968 = mem_111968.mem;
    }
    return err;
}
struct futhark_mc_task_127919 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_zp_res_43884;
    double free_sqrt_res_107451;
    int64_t free_bytes_111715;
    unsigned char *free_mem_111744;
    unsigned char *free_mem_111968;
    int64_t free_flat_tid_118845;
    int64_t free_flat_tid_118867;
    bool *retval_defunc_0_reduce_comm_res_107452;
    unsigned char *retval_mem_111981;
};
struct futhark_mc_segred_stage_1_parloop_struct_127922 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_zp_res_43884;
    double free_sqrt_res_107451;
    int64_t free_bytes_111715;
    unsigned char *free_mem_111744;
    unsigned char *free_mem_111968;
    unsigned char *free_mem_111981;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123307;
};
static int futhark_mc_segred_stage_1_parloop_127923(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127922 *futhark_mc_segred_stage_1_parloop_struct_127922 = (struct futhark_mc_segred_stage_1_parloop_struct_127922 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127922->ctx;
    struct mc_event *event_127925 = mc_event_new(ctx);
    
    if (event_127925 != NULL)
        event_127925->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127922->free_m_33388;
    double zp_res_43884 = futhark_mc_segred_stage_1_parloop_struct_127922->free_zp_res_43884;
    double sqrt_res_107451 = futhark_mc_segred_stage_1_parloop_struct_127922->free_sqrt_res_107451;
    int64_t bytes_111715 = futhark_mc_segred_stage_1_parloop_struct_127922->free_bytes_111715;
    struct memblock mem_111744 = {.desc ="mem_111744", .mem =futhark_mc_segred_stage_1_parloop_struct_127922->free_mem_111744, .size =0, .references =NULL};
    struct memblock mem_111968 = {.desc ="mem_111968", .mem =futhark_mc_segred_stage_1_parloop_struct_127922->free_mem_111968, .size =0, .references =NULL};
    struct memblock mem_111981 = {.desc ="mem_111981", .mem =futhark_mc_segred_stage_1_parloop_struct_127922->free_mem_111981, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_123307 = {.desc ="reduce_stage_1_tid_res_arr_mem_123307", .mem =futhark_mc_segred_stage_1_parloop_struct_127922->free_reduce_stage_1_tid_res_arr_mem_123307, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t mem_118872_cached_sizze_127924 = 0;
    unsigned char *mem_118872 = NULL;
    int64_t flat_tid_118867;
    
    flat_tid_118867 = subtask_id;
    {
        bool eta_p_123309;
        bool eta_p_123310;
        bool local_acc_123312 = 0;
        bool eta_p_118869;
        bool eta_p_118870;
        bool local_acc_123313 = 0;
        int64_t start_123314;
        int64_t end_123315;
        
        start_123314 = start;
        end_123315 = end;
        
        int64_t n_123316 = end_123315 - start_123314;
        
        if (mem_118872_cached_sizze_127924 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_118872, &mem_118872_cached_sizze_127924, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        for (int64_t SegRed_i_123317 = start_123314; SegRed_i_123317 < start_123314 + n_123316; SegRed_i_123317++) {
            int64_t gtid_118868 = SegRed_i_123317;
            bool defunc_0_reduce_comm_res_118874;
            bool redout_118877 = 0;
            
            for (int64_t i_118876 = 0; i_118876 < m_33388; i_118876++) {
                double eta_p_118879 = ((double *) mem_111968.mem)[gtid_118868 * m_33388 + i_118876];
                double eta_p_118880 = ((double *) mem_111744.mem)[gtid_118868 * m_33388 + i_118876];
                double zt_res_118881 = sqrt_res_107451 * eta_p_118879;
                double zt_res_118882 = zp_res_43884 * eta_p_118880;
                bool zgze_res_118883 = zt_res_118881 <= zt_res_118882;
                double zt_res_118884 = zp_res_43884 * zt_res_118881;
                bool zgze_res_118885 = eta_p_118880 <= zt_res_118884;
                bool x_118886 = zgze_res_118883 && zgze_res_118885;
                bool not_res_118887 = !x_118886;
                bool defunc_0_op_res_118888 = not_res_118887 || redout_118877;
                
                ((double *) mem_118872)[i_118876] = zt_res_118881;
                
                bool redout_tmp_123318 = defunc_0_op_res_118888;
                
                redout_118877 = redout_tmp_123318;
            }
            defunc_0_reduce_comm_res_118874 = redout_118877;
            // save map-out results
            {
                lmad_copy_8b(ctx, 1, (uint64_t *) mem_111981.mem, gtid_118868 * m_33388, (int64_t []) {(int64_t) 1}, (uint64_t *) mem_118872, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_33388});
            }
            // Load accum params
            {
                eta_p_118869 = local_acc_123313;
            }
            // Load next params
            {
                eta_p_118870 = defunc_0_reduce_comm_res_118874;
            }
            // SegRed body
            {
                bool defunc_0_op_res_118871 = eta_p_118869 || eta_p_118870;
                
                local_acc_123313 = defunc_0_op_res_118871;
            }
        }
        
        int64_t uni_i_123320 = 0;
        
        {
            int64_t gtid_118868 = uni_i_123320;
            
            // Load accum params
            {
                eta_p_123309 = local_acc_123312;
            }
            // Load next params
            {
                eta_p_123310 = local_acc_123313;
            }
            // SegRed body
            {
                bool defunc_0_op_res_123311 = eta_p_123309 || eta_p_123310;
                
                local_acc_123312 = defunc_0_op_res_123311;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_123307.mem)[flat_tid_118867] = local_acc_123312;
    }
    
  cleanup:
    {
        free(mem_118872);
    }
    if (event_127925 != NULL) {
        event_127925->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127923", strdup("nothing further"), event_127925, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127920(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127919 *futhark_mc_task_127919 = (struct futhark_mc_task_127919 *) args;
    struct futhark_context *ctx = futhark_mc_task_127919->ctx;
    struct mc_event *event_127927 = mc_event_new(ctx);
    
    if (event_127927 != NULL)
        event_127927->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127919->free_m_33388;
    double zp_res_43884 = futhark_mc_task_127919->free_zp_res_43884;
    double sqrt_res_107451 = futhark_mc_task_127919->free_sqrt_res_107451;
    int64_t bytes_111715 = futhark_mc_task_127919->free_bytes_111715;
    struct memblock mem_111744 = {.desc ="mem_111744", .mem =futhark_mc_task_127919->free_mem_111744, .size =0, .references =NULL};
    struct memblock mem_111968 = {.desc ="mem_111968", .mem =futhark_mc_task_127919->free_mem_111968, .size =0, .references =NULL};
    int64_t flat_tid_118845 = futhark_mc_task_127919->free_flat_tid_118845;
    int64_t flat_tid_118867 = futhark_mc_task_127919->free_flat_tid_118867;
    bool defunc_0_reduce_comm_res_107452 = *futhark_mc_task_127919->retval_defunc_0_reduce_comm_res_107452;
    struct memblock mem_111981 = {.desc ="mem_111981", .mem =futhark_mc_task_127919->retval_mem_111981, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_123307_cached_sizze_127921 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123307 = NULL;
    int32_t nsubtasks_123306;
    
    nsubtasks_123306 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_123307_cached_sizze_127921 < nsubtasks_123306) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123307, &reduce_stage_1_tid_res_arr_mem_123307_cached_sizze_127921, nsubtasks_123306);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127922 futhark_mc_segred_stage_1_parloop_struct_127922_;
    
    futhark_mc_segred_stage_1_parloop_struct_127922_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127922_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127922_.free_zp_res_43884 = zp_res_43884;
    futhark_mc_segred_stage_1_parloop_struct_127922_.free_sqrt_res_107451 = sqrt_res_107451;
    futhark_mc_segred_stage_1_parloop_struct_127922_.free_bytes_111715 = bytes_111715;
    futhark_mc_segred_stage_1_parloop_struct_127922_.free_mem_111744 = mem_111744.mem;
    futhark_mc_segred_stage_1_parloop_struct_127922_.free_mem_111968 = mem_111968.mem;
    futhark_mc_segred_stage_1_parloop_struct_127922_.free_mem_111981 = mem_111981.mem;
    futhark_mc_segred_stage_1_parloop_struct_127922_.free_reduce_stage_1_tid_res_arr_mem_123307 = reduce_stage_1_tid_res_arr_mem_123307;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127923_task;
    
    futhark_mc_segred_stage_1_parloop_127923_task.name = "futhark_mc_segred_stage_1_parloop_127923";
    futhark_mc_segred_stage_1_parloop_127923_task.fn = futhark_mc_segred_stage_1_parloop_127923;
    futhark_mc_segred_stage_1_parloop_127923_task.args = &futhark_mc_segred_stage_1_parloop_struct_127922_;
    futhark_mc_segred_stage_1_parloop_127923_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127923_task.info = info;
    
    struct mc_event *event_127926 = mc_event_new(ctx);
    
    if (event_127926 != NULL)
        event_127926->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127923_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127923_task);
    
    if (futhark_mc_segred_stage_1_parloop_127923_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127923_err;
        goto cleanup;
    }
    if (event_127926 != NULL) {
        event_127926->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127923_total", strdup("nothing further"), event_127926, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_comm_res_107452 = 0;
    }
    
    bool eta_p_123321;
    bool eta_p_123322;
    
    for (int32_t i_123324 = 0; i_123324 < nsubtasks_123306; i_123324++) {
        flat_tid_118867 = i_123324;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_123321 = defunc_0_reduce_comm_res_107452;
            }
            // load next params
            {
                eta_p_123322 = ((bool *) reduce_stage_1_tid_res_arr_mem_123307)[flat_tid_118867];
            }
            // red body
            {
                bool defunc_0_op_res_123323 = eta_p_123321 || eta_p_123322;
                
                defunc_0_reduce_comm_res_107452 = defunc_0_op_res_123323;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_123307);
    }
    if (event_127927 != NULL) {
        event_127927->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127920", strdup("nothing further"), event_127927, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127919->retval_defunc_0_reduce_comm_res_107452 = defunc_0_reduce_comm_res_107452;
        futhark_mc_task_127919->retval_mem_111981 = mem_111981.mem;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_127930 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_zp_res_43884;
    double free_sqrt_res_107451;
    int64_t free_bytes_111715;
    unsigned char *free_mem_111744;
    unsigned char *free_mem_111968;
    unsigned char *free_mem_111981;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123326;
};
struct futhark_mc_task_127933 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_zp_res_43884;
    double free_sqrt_res_107451;
    unsigned char *free_mem_111744;
    unsigned char *free_mem_111968;
    int64_t free_gtid_118846;
    int64_t free_flat_tid_118853;
    bool *retval_defunc_0_reduce_comm_res_118851;
    unsigned char *retval_mem_118850;
};
struct futhark_mc_segred_stage_1_parloop_struct_127936 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_zp_res_43884;
    double free_sqrt_res_107451;
    unsigned char *free_mem_111744;
    unsigned char *free_mem_111968;
    int64_t free_gtid_118846;
    unsigned char *free_mem_118850;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123338;
};
static int futhark_mc_segred_stage_1_parloop_127937(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127936 *futhark_mc_segred_stage_1_parloop_struct_127936 = (struct futhark_mc_segred_stage_1_parloop_struct_127936 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127936->ctx;
    struct mc_event *event_127938 = mc_event_new(ctx);
    
    if (event_127938 != NULL)
        event_127938->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127936->free_m_33388;
    double zp_res_43884 = futhark_mc_segred_stage_1_parloop_struct_127936->free_zp_res_43884;
    double sqrt_res_107451 = futhark_mc_segred_stage_1_parloop_struct_127936->free_sqrt_res_107451;
    struct memblock mem_111744 = {.desc ="mem_111744", .mem =futhark_mc_segred_stage_1_parloop_struct_127936->free_mem_111744, .size =0, .references =NULL};
    struct memblock mem_111968 = {.desc ="mem_111968", .mem =futhark_mc_segred_stage_1_parloop_struct_127936->free_mem_111968, .size =0, .references =NULL};
    int64_t gtid_118846 = futhark_mc_segred_stage_1_parloop_struct_127936->free_gtid_118846;
    struct memblock mem_118850 = {.desc ="mem_118850", .mem =futhark_mc_segred_stage_1_parloop_struct_127936->free_mem_118850, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_123338 = {.desc ="reduce_stage_1_tid_res_arr_mem_123338", .mem =futhark_mc_segred_stage_1_parloop_struct_127936->free_reduce_stage_1_tid_res_arr_mem_123338, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118853;
    
    flat_tid_118853 = subtask_id;
    {
        bool eta_p_123340;
        bool eta_p_123341;
        bool local_acc_123343 = 0;
        bool eta_p_118855;
        bool eta_p_118856;
        bool local_acc_123344 = 0;
        int64_t start_123345;
        int64_t end_123346;
        
        start_123345 = start;
        end_123346 = end;
        
        int64_t n_123347 = end_123346 - start_123345;
        
        for (int64_t SegRed_i_123348 = start_123345; SegRed_i_123348 < start_123345 + n_123347; SegRed_i_123348++) {
            int64_t gtid_118854 = SegRed_i_123348;
            double eta_p_118858 = ((double *) mem_111968.mem)[gtid_118846 * m_33388 + gtid_118854];
            double eta_p_118859 = ((double *) mem_111744.mem)[gtid_118846 * m_33388 + gtid_118854];
            double zt_res_118860 = sqrt_res_107451 * eta_p_118858;
            double zt_res_118861 = zp_res_43884 * eta_p_118859;
            bool zgze_res_118862 = zt_res_118860 <= zt_res_118861;
            double zt_res_118863 = zp_res_43884 * zt_res_118860;
            bool zgze_res_118864 = eta_p_118859 <= zt_res_118863;
            bool x_118865 = zgze_res_118862 && zgze_res_118864;
            bool not_res_118866 = !x_118865;
            
            // save map-out results
            {
                ((double *) mem_118850.mem)[gtid_118854] = zt_res_118860;
            }
            // Load accum params
            {
                eta_p_118855 = local_acc_123344;
            }
            // Load next params
            {
                eta_p_118856 = not_res_118866;
            }
            // SegRed body
            {
                bool defunc_0_op_res_118857 = eta_p_118855 || eta_p_118856;
                
                local_acc_123344 = defunc_0_op_res_118857;
            }
        }
        
        int64_t uni_i_123349 = 0;
        
        {
            int64_t gtid_118854 = uni_i_123349;
            
            // Load accum params
            {
                eta_p_123340 = local_acc_123343;
            }
            // Load next params
            {
                eta_p_123341 = local_acc_123344;
            }
            // SegRed body
            {
                bool defunc_0_op_res_123342 = eta_p_123340 || eta_p_123341;
                
                local_acc_123343 = defunc_0_op_res_123342;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_123338.mem)[flat_tid_118853] = local_acc_123343;
    }
    
  cleanup:
    { }
    if (event_127938 != NULL) {
        event_127938->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127937", strdup("nothing further"), event_127938, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127934(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127933 *futhark_mc_task_127933 = (struct futhark_mc_task_127933 *) args;
    struct futhark_context *ctx = futhark_mc_task_127933->ctx;
    struct mc_event *event_127940 = mc_event_new(ctx);
    
    if (event_127940 != NULL)
        event_127940->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127933->free_m_33388;
    double zp_res_43884 = futhark_mc_task_127933->free_zp_res_43884;
    double sqrt_res_107451 = futhark_mc_task_127933->free_sqrt_res_107451;
    struct memblock mem_111744 = {.desc ="mem_111744", .mem =futhark_mc_task_127933->free_mem_111744, .size =0, .references =NULL};
    struct memblock mem_111968 = {.desc ="mem_111968", .mem =futhark_mc_task_127933->free_mem_111968, .size =0, .references =NULL};
    int64_t gtid_118846 = futhark_mc_task_127933->free_gtid_118846;
    int64_t flat_tid_118853 = futhark_mc_task_127933->free_flat_tid_118853;
    bool defunc_0_reduce_comm_res_118851 = *futhark_mc_task_127933->retval_defunc_0_reduce_comm_res_118851;
    struct memblock mem_118850 = {.desc ="mem_118850", .mem =futhark_mc_task_127933->retval_mem_118850, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_123338_cached_sizze_127935 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123338 = NULL;
    int32_t nsubtasks_123337;
    
    nsubtasks_123337 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_123338_cached_sizze_127935 < nsubtasks_123337) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123338, &reduce_stage_1_tid_res_arr_mem_123338_cached_sizze_127935, nsubtasks_123337);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127936 futhark_mc_segred_stage_1_parloop_struct_127936_;
    
    futhark_mc_segred_stage_1_parloop_struct_127936_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127936_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127936_.free_zp_res_43884 = zp_res_43884;
    futhark_mc_segred_stage_1_parloop_struct_127936_.free_sqrt_res_107451 = sqrt_res_107451;
    futhark_mc_segred_stage_1_parloop_struct_127936_.free_mem_111744 = mem_111744.mem;
    futhark_mc_segred_stage_1_parloop_struct_127936_.free_mem_111968 = mem_111968.mem;
    futhark_mc_segred_stage_1_parloop_struct_127936_.free_gtid_118846 = gtid_118846;
    futhark_mc_segred_stage_1_parloop_struct_127936_.free_mem_118850 = mem_118850.mem;
    futhark_mc_segred_stage_1_parloop_struct_127936_.free_reduce_stage_1_tid_res_arr_mem_123338 = reduce_stage_1_tid_res_arr_mem_123338;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127937_task;
    
    futhark_mc_segred_stage_1_parloop_127937_task.name = "futhark_mc_segred_stage_1_parloop_127937";
    futhark_mc_segred_stage_1_parloop_127937_task.fn = futhark_mc_segred_stage_1_parloop_127937;
    futhark_mc_segred_stage_1_parloop_127937_task.args = &futhark_mc_segred_stage_1_parloop_struct_127936_;
    futhark_mc_segred_stage_1_parloop_127937_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127937_task.info = info;
    
    struct mc_event *event_127939 = mc_event_new(ctx);
    
    if (event_127939 != NULL)
        event_127939->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127937_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127937_task);
    
    if (futhark_mc_segred_stage_1_parloop_127937_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127937_err;
        goto cleanup;
    }
    if (event_127939 != NULL) {
        event_127939->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127937_total", strdup("nothing further"), event_127939, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_comm_res_118851 = 0;
    }
    
    bool eta_p_123350;
    bool eta_p_123351;
    
    for (int32_t i_123353 = 0; i_123353 < nsubtasks_123337; i_123353++) {
        flat_tid_118853 = i_123353;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_123350 = defunc_0_reduce_comm_res_118851;
            }
            // load next params
            {
                eta_p_123351 = ((bool *) reduce_stage_1_tid_res_arr_mem_123338)[flat_tid_118853];
            }
            // red body
            {
                bool defunc_0_op_res_123352 = eta_p_123350 || eta_p_123351;
                
                defunc_0_reduce_comm_res_118851 = defunc_0_op_res_123352;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_123338);
    }
    if (event_127940 != NULL) {
        event_127940->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127934", strdup("nothing further"), event_127940, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127933->retval_defunc_0_reduce_comm_res_118851 = defunc_0_reduce_comm_res_118851;
        futhark_mc_task_127933->retval_mem_118850 = mem_118850.mem;
    }
    return err;
}
struct futhark_mc_task_127941 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_111981;
    int64_t free_gtid_118846;
    unsigned char *free_mem_118850;
};
struct futhark_mc_copy_parloop_struct_127943 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_111981;
    int64_t free_gtid_118846;
    unsigned char *free_mem_118850;
};
static int futhark_mc_copy_parloop_127944(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_copy_parloop_struct_127943 *futhark_mc_copy_parloop_struct_127943 = (struct futhark_mc_copy_parloop_struct_127943 *) args;
    struct futhark_context *ctx = futhark_mc_copy_parloop_struct_127943->ctx;
    struct mc_event *event_127945 = mc_event_new(ctx);
    
    if (event_127945 != NULL)
        event_127945->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_copy_parloop_struct_127943->free_m_33388;
    struct memblock mem_111981 = {.desc ="mem_111981", .mem =futhark_mc_copy_parloop_struct_127943->free_mem_111981, .size =0, .references =NULL};
    int64_t gtid_118846 = futhark_mc_copy_parloop_struct_127943->free_gtid_118846;
    struct memblock mem_118850 = {.desc ="mem_118850", .mem =futhark_mc_copy_parloop_struct_127943->free_mem_118850, .size =0, .references =NULL};
    int64_t iterations = end - start;
    
    {
        int64_t start_123354;
        int64_t end_123355;
        
        start_123354 = start;
        end_123355 = end;
        
        int64_t n_123356 = end_123355 - start_123354;
        
        for (int64_t copy_i_123357 = start_123354; copy_i_123357 < start_123354 + n_123356; copy_i_123357++) {
            int64_t slice_123359 = m_33388;
            int64_t i_123358 = copy_i_123357;
            int64_t remnant_123360 = copy_i_123357 - i_123358;
            double tmp_123361 = ((double *) mem_118850.mem)[i_123358];
            
            ((double *) mem_111981.mem)[gtid_118846 * m_33388 + i_123358] = tmp_123361;
        }
    }
    
  cleanup:
    { }
    if (event_127945 != NULL) {
        event_127945->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_parloop_127944", strdup("nothing further"), event_127945, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_copy_123362_task_127942(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127941 *futhark_mc_task_127941 = (struct futhark_mc_task_127941 *) args;
    struct futhark_context *ctx = futhark_mc_task_127941->ctx;
    struct mc_event *event_127947 = mc_event_new(ctx);
    
    if (event_127947 != NULL)
        event_127947->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127941->free_m_33388;
    struct memblock mem_111981 = {.desc ="mem_111981", .mem =futhark_mc_task_127941->free_mem_111981, .size =0, .references =NULL};
    int64_t gtid_118846 = futhark_mc_task_127941->free_gtid_118846;
    struct memblock mem_118850 = {.desc ="mem_118850", .mem =futhark_mc_task_127941->free_mem_118850, .size =0, .references =NULL};
    struct futhark_mc_copy_parloop_struct_127943 futhark_mc_copy_parloop_struct_127943_;
    
    futhark_mc_copy_parloop_struct_127943_.ctx = ctx;
    futhark_mc_copy_parloop_struct_127943_.free_m_33388 = m_33388;
    futhark_mc_copy_parloop_struct_127943_.free_mem_111981 = mem_111981.mem;
    futhark_mc_copy_parloop_struct_127943_.free_gtid_118846 = gtid_118846;
    futhark_mc_copy_parloop_struct_127943_.free_mem_118850 = mem_118850.mem;
    
    struct scheduler_parloop futhark_mc_copy_parloop_127944_task;
    
    futhark_mc_copy_parloop_127944_task.name = "futhark_mc_copy_parloop_127944";
    futhark_mc_copy_parloop_127944_task.fn = futhark_mc_copy_parloop_127944;
    futhark_mc_copy_parloop_127944_task.args = &futhark_mc_copy_parloop_struct_127943_;
    futhark_mc_copy_parloop_127944_task.iterations = iterations;
    futhark_mc_copy_parloop_127944_task.info = info;
    
    struct mc_event *event_127946 = mc_event_new(ctx);
    
    if (event_127946 != NULL)
        event_127946->bef = get_wall_time();
    
    int futhark_mc_copy_parloop_127944_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_copy_parloop_127944_task);
    
    if (futhark_mc_copy_parloop_127944_err != 0) {
        err = futhark_mc_copy_parloop_127944_err;
        goto cleanup;
    }
    if (event_127946 != NULL) {
        event_127946->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_parloop_127944_total", strdup("nothing further"), event_127946, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_127947 != NULL) {
        event_127947->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_123362_task_127942", strdup("nothing further"), event_127947, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_127931(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127930 *futhark_mc_segred_stage_1_parloop_struct_127930 = (struct futhark_mc_segred_stage_1_parloop_struct_127930 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127930->ctx;
    struct mc_event *event_127948 = mc_event_new(ctx);
    
    if (event_127948 != NULL)
        event_127948->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127930->free_m_33388;
    double zp_res_43884 = futhark_mc_segred_stage_1_parloop_struct_127930->free_zp_res_43884;
    double sqrt_res_107451 = futhark_mc_segred_stage_1_parloop_struct_127930->free_sqrt_res_107451;
    int64_t bytes_111715 = futhark_mc_segred_stage_1_parloop_struct_127930->free_bytes_111715;
    struct memblock mem_111744 = {.desc ="mem_111744", .mem =futhark_mc_segred_stage_1_parloop_struct_127930->free_mem_111744, .size =0, .references =NULL};
    struct memblock mem_111968 = {.desc ="mem_111968", .mem =futhark_mc_segred_stage_1_parloop_struct_127930->free_mem_111968, .size =0, .references =NULL};
    struct memblock mem_111981 = {.desc ="mem_111981", .mem =futhark_mc_segred_stage_1_parloop_struct_127930->free_mem_111981, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_123326 = {.desc ="reduce_stage_1_tid_res_arr_mem_123326", .mem =futhark_mc_segred_stage_1_parloop_struct_127930->free_reduce_stage_1_tid_res_arr_mem_123326, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t mem_118850_cached_sizze_127932 = 0;
    unsigned char *mem_118850 = NULL;
    int64_t flat_tid_118845;
    
    flat_tid_118845 = subtask_id;
    {
        bool eta_p_123328;
        bool eta_p_123329;
        bool local_acc_123331 = 0;
        bool eta_p_118847;
        bool eta_p_118848;
        bool local_acc_123332 = 0;
        int64_t start_123333;
        int64_t end_123334;
        
        start_123333 = start;
        end_123334 = end;
        
        int64_t n_123335 = end_123334 - start_123333;
        
        if (mem_118850_cached_sizze_127932 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_118850, &mem_118850_cached_sizze_127932, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        for (int64_t SegRed_i_123336 = start_123333; SegRed_i_123336 < start_123333 + n_123335; SegRed_i_123336++) {
            int64_t gtid_118846 = SegRed_i_123336;
            bool defunc_0_reduce_comm_res_118851;
            int64_t flat_tid_118853 = (int64_t) 0;
            
            defunc_0_reduce_comm_res_118851 = 0;
            
            struct futhark_mc_task_127933 futhark_mc_task_127933_;
            
            futhark_mc_task_127933_.ctx = ctx;
            futhark_mc_task_127933_.free_m_33388 = m_33388;
            futhark_mc_task_127933_.free_zp_res_43884 = zp_res_43884;
            futhark_mc_task_127933_.free_sqrt_res_107451 = sqrt_res_107451;
            futhark_mc_task_127933_.free_mem_111744 = mem_111744.mem;
            futhark_mc_task_127933_.free_mem_111968 = mem_111968.mem;
            futhark_mc_task_127933_.free_gtid_118846 = gtid_118846;
            futhark_mc_task_127933_.free_flat_tid_118853 = flat_tid_118853;
            futhark_mc_task_127933_.retval_defunc_0_reduce_comm_res_118851 = (bool *) &defunc_0_reduce_comm_res_118851;
            #if ISPC
            futhark_mc_task_127933_.retval_defunc_0_reduce_comm_res_118851 += programIndex;
            #endif
            futhark_mc_task_127933_.retval_mem_118850 = mem_118850;
            
            struct scheduler_segop futhark_mc_task_127933_task;
            
            futhark_mc_task_127933_task.args = &futhark_mc_task_127933_;
            futhark_mc_task_127933_task.top_level_fn = futhark_mc_segred_task_127934;
            futhark_mc_task_127933_task.name = "futhark_mc_segred_task_127934";
            futhark_mc_task_127933_task.iterations = m_33388;
            futhark_mc_task_127933_task.task_time = &ctx->program->futhark_mc_segred_task_127934_total_time;
            futhark_mc_task_127933_task.task_iter = &ctx->program->futhark_mc_segred_task_127934_total_iter;
            futhark_mc_task_127933_task.sched = STATIC;
            futhark_mc_task_127933_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_127934_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127933_task);
            
            if (futhark_mc_segred_task_127934_err != 0) {
                err = futhark_mc_segred_task_127934_err;
                goto cleanup;
            }
            // save map-out results
            {
                int64_t iterations_123363 = m_33388;
                struct futhark_mc_task_127941 futhark_mc_task_127941_;
                
                futhark_mc_task_127941_.ctx = ctx;
                futhark_mc_task_127941_.free_m_33388 = m_33388;
                futhark_mc_task_127941_.free_mem_111981 = mem_111981.mem;
                futhark_mc_task_127941_.free_gtid_118846 = gtid_118846;
                futhark_mc_task_127941_.free_mem_118850 = mem_118850;
                
                struct scheduler_segop futhark_mc_task_127941_task;
                
                futhark_mc_task_127941_task.args = &futhark_mc_task_127941_;
                futhark_mc_task_127941_task.top_level_fn = futhark_mc_copy_123362_task_127942;
                futhark_mc_task_127941_task.name = "futhark_mc_copy_123362_task_127942";
                futhark_mc_task_127941_task.iterations = iterations_123363;
                futhark_mc_task_127941_task.task_time = &ctx->program->futhark_mc_copy_123362_task_127942_total_time;
                futhark_mc_task_127941_task.task_iter = &ctx->program->futhark_mc_copy_123362_task_127942_total_iter;
                futhark_mc_task_127941_task.sched = STATIC;
                futhark_mc_task_127941_task.nested_fn = NULL;
                
                int futhark_mc_copy_123362_task_127942_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127941_task);
                
                if (futhark_mc_copy_123362_task_127942_err != 0) {
                    err = futhark_mc_copy_123362_task_127942_err;
                    goto cleanup;
                }
            }
            // Load accum params
            {
                eta_p_118847 = local_acc_123332;
            }
            // Load next params
            {
                eta_p_118848 = defunc_0_reduce_comm_res_118851;
            }
            // SegRed body
            {
                bool defunc_0_op_res_118849 = eta_p_118847 || eta_p_118848;
                
                local_acc_123332 = defunc_0_op_res_118849;
            }
        }
        
        int64_t uni_i_123364 = 0;
        
        {
            int64_t gtid_118846 = uni_i_123364;
            
            // Load accum params
            {
                eta_p_123328 = local_acc_123331;
            }
            // Load next params
            {
                eta_p_123329 = local_acc_123332;
            }
            // SegRed body
            {
                bool defunc_0_op_res_123330 = eta_p_123328 || eta_p_123329;
                
                local_acc_123331 = defunc_0_op_res_123330;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_123326.mem)[flat_tid_118845] = local_acc_123331;
    }
    
  cleanup:
    {
        free(mem_118850);
    }
    if (event_127948 != NULL) {
        event_127948->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127931", strdup("nothing further"), event_127948, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_127928(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127919 *futhark_mc_task_127919 = (struct futhark_mc_task_127919 *) args;
    struct futhark_context *ctx = futhark_mc_task_127919->ctx;
    struct mc_event *event_127950 = mc_event_new(ctx);
    
    if (event_127950 != NULL)
        event_127950->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127919->free_m_33388;
    double zp_res_43884 = futhark_mc_task_127919->free_zp_res_43884;
    double sqrt_res_107451 = futhark_mc_task_127919->free_sqrt_res_107451;
    int64_t bytes_111715 = futhark_mc_task_127919->free_bytes_111715;
    struct memblock mem_111744 = {.desc ="mem_111744", .mem =futhark_mc_task_127919->free_mem_111744, .size =0, .references =NULL};
    struct memblock mem_111968 = {.desc ="mem_111968", .mem =futhark_mc_task_127919->free_mem_111968, .size =0, .references =NULL};
    int64_t flat_tid_118845 = futhark_mc_task_127919->free_flat_tid_118845;
    int64_t flat_tid_118867 = futhark_mc_task_127919->free_flat_tid_118867;
    bool defunc_0_reduce_comm_res_107452 = *futhark_mc_task_127919->retval_defunc_0_reduce_comm_res_107452;
    struct memblock mem_111981 = {.desc ="mem_111981", .mem =futhark_mc_task_127919->retval_mem_111981, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_123326_cached_sizze_127929 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123326 = NULL;
    int32_t nsubtasks_123325;
    
    nsubtasks_123325 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_123326_cached_sizze_127929 < nsubtasks_123325) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123326, &reduce_stage_1_tid_res_arr_mem_123326_cached_sizze_127929, nsubtasks_123325);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127930 futhark_mc_segred_stage_1_parloop_struct_127930_;
    
    futhark_mc_segred_stage_1_parloop_struct_127930_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127930_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127930_.free_zp_res_43884 = zp_res_43884;
    futhark_mc_segred_stage_1_parloop_struct_127930_.free_sqrt_res_107451 = sqrt_res_107451;
    futhark_mc_segred_stage_1_parloop_struct_127930_.free_bytes_111715 = bytes_111715;
    futhark_mc_segred_stage_1_parloop_struct_127930_.free_mem_111744 = mem_111744.mem;
    futhark_mc_segred_stage_1_parloop_struct_127930_.free_mem_111968 = mem_111968.mem;
    futhark_mc_segred_stage_1_parloop_struct_127930_.free_mem_111981 = mem_111981.mem;
    futhark_mc_segred_stage_1_parloop_struct_127930_.free_reduce_stage_1_tid_res_arr_mem_123326 = reduce_stage_1_tid_res_arr_mem_123326;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127931_task;
    
    futhark_mc_segred_stage_1_parloop_127931_task.name = "futhark_mc_segred_stage_1_parloop_127931";
    futhark_mc_segred_stage_1_parloop_127931_task.fn = futhark_mc_segred_stage_1_parloop_127931;
    futhark_mc_segred_stage_1_parloop_127931_task.args = &futhark_mc_segred_stage_1_parloop_struct_127930_;
    futhark_mc_segred_stage_1_parloop_127931_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127931_task.info = info;
    
    struct mc_event *event_127949 = mc_event_new(ctx);
    
    if (event_127949 != NULL)
        event_127949->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127931_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127931_task);
    
    if (futhark_mc_segred_stage_1_parloop_127931_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127931_err;
        goto cleanup;
    }
    if (event_127949 != NULL) {
        event_127949->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127931_total", strdup("nothing further"), event_127949, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_comm_res_107452 = 0;
    }
    
    bool eta_p_123365;
    bool eta_p_123366;
    
    for (int32_t i_123368 = 0; i_123368 < nsubtasks_123325; i_123368++) {
        flat_tid_118845 = i_123368;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_123365 = defunc_0_reduce_comm_res_107452;
            }
            // load next params
            {
                eta_p_123366 = ((bool *) reduce_stage_1_tid_res_arr_mem_123326)[flat_tid_118845];
            }
            // red body
            {
                bool defunc_0_op_res_123367 = eta_p_123365 || eta_p_123366;
                
                defunc_0_reduce_comm_res_107452 = defunc_0_op_res_123367;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_123326);
    }
    if (event_127950 != NULL) {
        event_127950->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_127928", strdup("nothing further"), event_127950, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127919->retval_defunc_0_reduce_comm_res_107452 = defunc_0_reduce_comm_res_107452;
        futhark_mc_task_127919->retval_mem_111981 = mem_111981.mem;
    }
    return err;
}
struct futhark_mc_task_127951 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_111981;
    int64_t free_flat_tid_118890;
    int64_t free_flat_tid_118903;
    bool *retval_defunc_0_reduce_res_107523;
};
struct futhark_mc_segred_stage_1_parloop_struct_127954 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_111981;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123370;
};
static int futhark_mc_segred_stage_1_parloop_127955(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127954 *futhark_mc_segred_stage_1_parloop_struct_127954 = (struct futhark_mc_segred_stage_1_parloop_struct_127954 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127954->ctx;
    struct mc_event *event_127956 = mc_event_new(ctx);
    
    if (event_127956 != NULL)
        event_127956->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127954->free_m_33388;
    struct memblock mem_111981 = {.desc ="mem_111981", .mem =futhark_mc_segred_stage_1_parloop_struct_127954->free_mem_111981, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_123370 = {.desc ="reduce_stage_1_tid_res_arr_mem_123370", .mem =futhark_mc_segred_stage_1_parloop_struct_127954->free_reduce_stage_1_tid_res_arr_mem_123370, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118903;
    
    flat_tid_118903 = subtask_id;
    {
        bool eta_p_123372;
        bool eta_p_123373;
        bool local_acc_123375 = 0;
        bool eta_p_118905;
        bool eta_p_118906;
        bool local_acc_123376 = 0;
        int64_t start_123377;
        int64_t end_123378;
        
        start_123377 = start;
        end_123378 = end;
        
        int64_t n_123379 = end_123378 - start_123377;
        
        for (int64_t SegRed_i_123380 = start_123377; SegRed_i_123380 < start_123377 + n_123379; SegRed_i_123380++) {
            int64_t gtid_118904 = SegRed_i_123380;
            bool defunc_0_reduce_res_118908;
            bool redout_118910 = 0;
            
            for (int64_t i_118909 = 0; i_118909 < m_33388; i_118909++) {
                double eta_p_118911 = ((double *) mem_111981.mem)[gtid_118904 * m_33388 + i_118909];
                bool zg_res_118912 = 0.0 < eta_p_118911;
                bool defunc_0_op_res_118913 = zg_res_118912 || redout_118910;
                bool redout_tmp_123381 = defunc_0_op_res_118913;
                
                redout_118910 = redout_tmp_123381;
            }
            defunc_0_reduce_res_118908 = redout_118910;
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_118905 = local_acc_123376;
            }
            // Load next params
            {
                eta_p_118906 = defunc_0_reduce_res_118908;
            }
            // SegRed body
            {
                bool defunc_0_op_res_118907 = eta_p_118905 || eta_p_118906;
                
                local_acc_123376 = defunc_0_op_res_118907;
            }
        }
        
        int64_t uni_i_123382 = 0;
        
        {
            int64_t gtid_118904 = uni_i_123382;
            
            // Load accum params
            {
                eta_p_123372 = local_acc_123375;
            }
            // Load next params
            {
                eta_p_123373 = local_acc_123376;
            }
            // SegRed body
            {
                bool defunc_0_op_res_123374 = eta_p_123372 || eta_p_123373;
                
                local_acc_123375 = defunc_0_op_res_123374;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_123370.mem)[flat_tid_118903] = local_acc_123375;
    }
    
  cleanup:
    { }
    if (event_127956 != NULL) {
        event_127956->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127955", strdup("nothing further"), event_127956, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127952(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127951 *futhark_mc_task_127951 = (struct futhark_mc_task_127951 *) args;
    struct futhark_context *ctx = futhark_mc_task_127951->ctx;
    struct mc_event *event_127958 = mc_event_new(ctx);
    
    if (event_127958 != NULL)
        event_127958->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127951->free_m_33388;
    struct memblock mem_111981 = {.desc ="mem_111981", .mem =futhark_mc_task_127951->free_mem_111981, .size =0, .references =NULL};
    int64_t flat_tid_118890 = futhark_mc_task_127951->free_flat_tid_118890;
    int64_t flat_tid_118903 = futhark_mc_task_127951->free_flat_tid_118903;
    bool defunc_0_reduce_res_107523 = *futhark_mc_task_127951->retval_defunc_0_reduce_res_107523;
    int64_t reduce_stage_1_tid_res_arr_mem_123370_cached_sizze_127953 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123370 = NULL;
    int32_t nsubtasks_123369;
    
    nsubtasks_123369 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_123370_cached_sizze_127953 < nsubtasks_123369) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123370, &reduce_stage_1_tid_res_arr_mem_123370_cached_sizze_127953, nsubtasks_123369);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127954 futhark_mc_segred_stage_1_parloop_struct_127954_;
    
    futhark_mc_segred_stage_1_parloop_struct_127954_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127954_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127954_.free_mem_111981 = mem_111981.mem;
    futhark_mc_segred_stage_1_parloop_struct_127954_.free_reduce_stage_1_tid_res_arr_mem_123370 = reduce_stage_1_tid_res_arr_mem_123370;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127955_task;
    
    futhark_mc_segred_stage_1_parloop_127955_task.name = "futhark_mc_segred_stage_1_parloop_127955";
    futhark_mc_segred_stage_1_parloop_127955_task.fn = futhark_mc_segred_stage_1_parloop_127955;
    futhark_mc_segred_stage_1_parloop_127955_task.args = &futhark_mc_segred_stage_1_parloop_struct_127954_;
    futhark_mc_segred_stage_1_parloop_127955_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127955_task.info = info;
    
    struct mc_event *event_127957 = mc_event_new(ctx);
    
    if (event_127957 != NULL)
        event_127957->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127955_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127955_task);
    
    if (futhark_mc_segred_stage_1_parloop_127955_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127955_err;
        goto cleanup;
    }
    if (event_127957 != NULL) {
        event_127957->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127955_total", strdup("nothing further"), event_127957, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_107523 = 0;
    }
    
    bool eta_p_123383;
    bool eta_p_123384;
    
    for (int32_t i_123386 = 0; i_123386 < nsubtasks_123369; i_123386++) {
        flat_tid_118903 = i_123386;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_123383 = defunc_0_reduce_res_107523;
            }
            // load next params
            {
                eta_p_123384 = ((bool *) reduce_stage_1_tid_res_arr_mem_123370)[flat_tid_118903];
            }
            // red body
            {
                bool defunc_0_op_res_123385 = eta_p_123383 || eta_p_123384;
                
                defunc_0_reduce_res_107523 = defunc_0_op_res_123385;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_123370);
    }
    if (event_127958 != NULL) {
        event_127958->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127952", strdup("nothing further"), event_127958, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127951->retval_defunc_0_reduce_res_107523 = defunc_0_reduce_res_107523;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_127961 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_111981;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123388;
};
struct futhark_mc_task_127963 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_111981;
    int64_t free_gtid_118891;
    int64_t free_flat_tid_118896;
    bool *retval_defunc_0_reduce_res_118895;
};
struct futhark_mc_segred_stage_1_parloop_struct_127966 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_111981;
    int64_t free_gtid_118891;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123400;
};
static int futhark_mc_segred_stage_1_parloop_127967(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127966 *futhark_mc_segred_stage_1_parloop_struct_127966 = (struct futhark_mc_segred_stage_1_parloop_struct_127966 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127966->ctx;
    struct mc_event *event_127968 = mc_event_new(ctx);
    
    if (event_127968 != NULL)
        event_127968->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127966->free_m_33388;
    struct memblock mem_111981 = {.desc ="mem_111981", .mem =futhark_mc_segred_stage_1_parloop_struct_127966->free_mem_111981, .size =0, .references =NULL};
    int64_t gtid_118891 = futhark_mc_segred_stage_1_parloop_struct_127966->free_gtid_118891;
    struct memblock reduce_stage_1_tid_res_arr_mem_123400 = {.desc ="reduce_stage_1_tid_res_arr_mem_123400", .mem =futhark_mc_segred_stage_1_parloop_struct_127966->free_reduce_stage_1_tid_res_arr_mem_123400, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118896;
    
    flat_tid_118896 = subtask_id;
    {
        bool eta_p_123402;
        bool eta_p_123403;
        bool local_acc_123405 = 0;
        bool eta_p_118898;
        bool eta_p_118899;
        bool local_acc_123406 = 0;
        int64_t start_123407;
        int64_t end_123408;
        
        start_123407 = start;
        end_123408 = end;
        
        int64_t n_123409 = end_123408 - start_123407;
        
        for (int64_t SegRed_i_123410 = start_123407; SegRed_i_123410 < start_123407 + n_123409; SegRed_i_123410++) {
            int64_t gtid_118897 = SegRed_i_123410;
            double eta_p_118901 = ((double *) mem_111981.mem)[gtid_118891 * m_33388 + gtid_118897];
            bool zg_res_118902 = 0.0 < eta_p_118901;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_118898 = local_acc_123406;
            }
            // Load next params
            {
                eta_p_118899 = zg_res_118902;
            }
            // SegRed body
            {
                bool defunc_0_op_res_118900 = eta_p_118898 || eta_p_118899;
                
                local_acc_123406 = defunc_0_op_res_118900;
            }
        }
        
        int64_t uni_i_123411 = 0;
        
        {
            int64_t gtid_118897 = uni_i_123411;
            
            // Load accum params
            {
                eta_p_123402 = local_acc_123405;
            }
            // Load next params
            {
                eta_p_123403 = local_acc_123406;
            }
            // SegRed body
            {
                bool defunc_0_op_res_123404 = eta_p_123402 || eta_p_123403;
                
                local_acc_123405 = defunc_0_op_res_123404;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_123400.mem)[flat_tid_118896] = local_acc_123405;
    }
    
  cleanup:
    { }
    if (event_127968 != NULL) {
        event_127968->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127967", strdup("nothing further"), event_127968, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127964(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127963 *futhark_mc_task_127963 = (struct futhark_mc_task_127963 *) args;
    struct futhark_context *ctx = futhark_mc_task_127963->ctx;
    struct mc_event *event_127970 = mc_event_new(ctx);
    
    if (event_127970 != NULL)
        event_127970->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127963->free_m_33388;
    struct memblock mem_111981 = {.desc ="mem_111981", .mem =futhark_mc_task_127963->free_mem_111981, .size =0, .references =NULL};
    int64_t gtid_118891 = futhark_mc_task_127963->free_gtid_118891;
    int64_t flat_tid_118896 = futhark_mc_task_127963->free_flat_tid_118896;
    bool defunc_0_reduce_res_118895 = *futhark_mc_task_127963->retval_defunc_0_reduce_res_118895;
    int64_t reduce_stage_1_tid_res_arr_mem_123400_cached_sizze_127965 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123400 = NULL;
    int32_t nsubtasks_123399;
    
    nsubtasks_123399 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_123400_cached_sizze_127965 < nsubtasks_123399) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123400, &reduce_stage_1_tid_res_arr_mem_123400_cached_sizze_127965, nsubtasks_123399);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127966 futhark_mc_segred_stage_1_parloop_struct_127966_;
    
    futhark_mc_segred_stage_1_parloop_struct_127966_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127966_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127966_.free_mem_111981 = mem_111981.mem;
    futhark_mc_segred_stage_1_parloop_struct_127966_.free_gtid_118891 = gtid_118891;
    futhark_mc_segred_stage_1_parloop_struct_127966_.free_reduce_stage_1_tid_res_arr_mem_123400 = reduce_stage_1_tid_res_arr_mem_123400;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127967_task;
    
    futhark_mc_segred_stage_1_parloop_127967_task.name = "futhark_mc_segred_stage_1_parloop_127967";
    futhark_mc_segred_stage_1_parloop_127967_task.fn = futhark_mc_segred_stage_1_parloop_127967;
    futhark_mc_segred_stage_1_parloop_127967_task.args = &futhark_mc_segred_stage_1_parloop_struct_127966_;
    futhark_mc_segred_stage_1_parloop_127967_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127967_task.info = info;
    
    struct mc_event *event_127969 = mc_event_new(ctx);
    
    if (event_127969 != NULL)
        event_127969->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127967_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127967_task);
    
    if (futhark_mc_segred_stage_1_parloop_127967_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127967_err;
        goto cleanup;
    }
    if (event_127969 != NULL) {
        event_127969->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127967_total", strdup("nothing further"), event_127969, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_118895 = 0;
    }
    
    bool eta_p_123412;
    bool eta_p_123413;
    
    for (int32_t i_123415 = 0; i_123415 < nsubtasks_123399; i_123415++) {
        flat_tid_118896 = i_123415;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_123412 = defunc_0_reduce_res_118895;
            }
            // load next params
            {
                eta_p_123413 = ((bool *) reduce_stage_1_tid_res_arr_mem_123400)[flat_tid_118896];
            }
            // red body
            {
                bool defunc_0_op_res_123414 = eta_p_123412 || eta_p_123413;
                
                defunc_0_reduce_res_118895 = defunc_0_op_res_123414;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_123400);
    }
    if (event_127970 != NULL) {
        event_127970->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127964", strdup("nothing further"), event_127970, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127963->retval_defunc_0_reduce_res_118895 = defunc_0_reduce_res_118895;
    }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_127962(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127961 *futhark_mc_segred_stage_1_parloop_struct_127961 = (struct futhark_mc_segred_stage_1_parloop_struct_127961 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127961->ctx;
    struct mc_event *event_127971 = mc_event_new(ctx);
    
    if (event_127971 != NULL)
        event_127971->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127961->free_m_33388;
    struct memblock mem_111981 = {.desc ="mem_111981", .mem =futhark_mc_segred_stage_1_parloop_struct_127961->free_mem_111981, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_123388 = {.desc ="reduce_stage_1_tid_res_arr_mem_123388", .mem =futhark_mc_segred_stage_1_parloop_struct_127961->free_reduce_stage_1_tid_res_arr_mem_123388, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118890;
    
    flat_tid_118890 = subtask_id;
    {
        bool eta_p_123390;
        bool eta_p_123391;
        bool local_acc_123393 = 0;
        bool eta_p_118892;
        bool eta_p_118893;
        bool local_acc_123394 = 0;
        int64_t start_123395;
        int64_t end_123396;
        
        start_123395 = start;
        end_123396 = end;
        
        int64_t n_123397 = end_123396 - start_123395;
        
        for (int64_t SegRed_i_123398 = start_123395; SegRed_i_123398 < start_123395 + n_123397; SegRed_i_123398++) {
            int64_t gtid_118891 = SegRed_i_123398;
            bool defunc_0_reduce_res_118895;
            int64_t flat_tid_118896 = (int64_t) 0;
            
            defunc_0_reduce_res_118895 = 0;
            
            struct futhark_mc_task_127963 futhark_mc_task_127963_;
            
            futhark_mc_task_127963_.ctx = ctx;
            futhark_mc_task_127963_.free_m_33388 = m_33388;
            futhark_mc_task_127963_.free_mem_111981 = mem_111981.mem;
            futhark_mc_task_127963_.free_gtid_118891 = gtid_118891;
            futhark_mc_task_127963_.free_flat_tid_118896 = flat_tid_118896;
            futhark_mc_task_127963_.retval_defunc_0_reduce_res_118895 = (bool *) &defunc_0_reduce_res_118895;
            #if ISPC
            futhark_mc_task_127963_.retval_defunc_0_reduce_res_118895 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_127963_task;
            
            futhark_mc_task_127963_task.args = &futhark_mc_task_127963_;
            futhark_mc_task_127963_task.top_level_fn = futhark_mc_segred_task_127964;
            futhark_mc_task_127963_task.name = "futhark_mc_segred_task_127964";
            futhark_mc_task_127963_task.iterations = m_33388;
            futhark_mc_task_127963_task.task_time = &ctx->program->futhark_mc_segred_task_127964_total_time;
            futhark_mc_task_127963_task.task_iter = &ctx->program->futhark_mc_segred_task_127964_total_iter;
            futhark_mc_task_127963_task.sched = STATIC;
            futhark_mc_task_127963_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_127964_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127963_task);
            
            if (futhark_mc_segred_task_127964_err != 0) {
                err = futhark_mc_segred_task_127964_err;
                goto cleanup;
            }
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_118892 = local_acc_123394;
            }
            // Load next params
            {
                eta_p_118893 = defunc_0_reduce_res_118895;
            }
            // SegRed body
            {
                bool defunc_0_op_res_118894 = eta_p_118892 || eta_p_118893;
                
                local_acc_123394 = defunc_0_op_res_118894;
            }
        }
        
        int64_t uni_i_123416 = 0;
        
        {
            int64_t gtid_118891 = uni_i_123416;
            
            // Load accum params
            {
                eta_p_123390 = local_acc_123393;
            }
            // Load next params
            {
                eta_p_123391 = local_acc_123394;
            }
            // SegRed body
            {
                bool defunc_0_op_res_123392 = eta_p_123390 || eta_p_123391;
                
                local_acc_123393 = defunc_0_op_res_123392;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_123388.mem)[flat_tid_118890] = local_acc_123393;
    }
    
  cleanup:
    { }
    if (event_127971 != NULL) {
        event_127971->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127962", strdup("nothing further"), event_127971, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_127959(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127951 *futhark_mc_task_127951 = (struct futhark_mc_task_127951 *) args;
    struct futhark_context *ctx = futhark_mc_task_127951->ctx;
    struct mc_event *event_127973 = mc_event_new(ctx);
    
    if (event_127973 != NULL)
        event_127973->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127951->free_m_33388;
    struct memblock mem_111981 = {.desc ="mem_111981", .mem =futhark_mc_task_127951->free_mem_111981, .size =0, .references =NULL};
    int64_t flat_tid_118890 = futhark_mc_task_127951->free_flat_tid_118890;
    int64_t flat_tid_118903 = futhark_mc_task_127951->free_flat_tid_118903;
    bool defunc_0_reduce_res_107523 = *futhark_mc_task_127951->retval_defunc_0_reduce_res_107523;
    int64_t reduce_stage_1_tid_res_arr_mem_123388_cached_sizze_127960 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123388 = NULL;
    int32_t nsubtasks_123387;
    
    nsubtasks_123387 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_123388_cached_sizze_127960 < nsubtasks_123387) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123388, &reduce_stage_1_tid_res_arr_mem_123388_cached_sizze_127960, nsubtasks_123387);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127961 futhark_mc_segred_stage_1_parloop_struct_127961_;
    
    futhark_mc_segred_stage_1_parloop_struct_127961_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127961_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127961_.free_mem_111981 = mem_111981.mem;
    futhark_mc_segred_stage_1_parloop_struct_127961_.free_reduce_stage_1_tid_res_arr_mem_123388 = reduce_stage_1_tid_res_arr_mem_123388;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127962_task;
    
    futhark_mc_segred_stage_1_parloop_127962_task.name = "futhark_mc_segred_stage_1_parloop_127962";
    futhark_mc_segred_stage_1_parloop_127962_task.fn = futhark_mc_segred_stage_1_parloop_127962;
    futhark_mc_segred_stage_1_parloop_127962_task.args = &futhark_mc_segred_stage_1_parloop_struct_127961_;
    futhark_mc_segred_stage_1_parloop_127962_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127962_task.info = info;
    
    struct mc_event *event_127972 = mc_event_new(ctx);
    
    if (event_127972 != NULL)
        event_127972->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127962_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127962_task);
    
    if (futhark_mc_segred_stage_1_parloop_127962_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127962_err;
        goto cleanup;
    }
    if (event_127972 != NULL) {
        event_127972->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127962_total", strdup("nothing further"), event_127972, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_107523 = 0;
    }
    
    bool eta_p_123417;
    bool eta_p_123418;
    
    for (int32_t i_123420 = 0; i_123420 < nsubtasks_123387; i_123420++) {
        flat_tid_118890 = i_123420;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_123417 = defunc_0_reduce_res_107523;
            }
            // load next params
            {
                eta_p_123418 = ((bool *) reduce_stage_1_tid_res_arr_mem_123388)[flat_tid_118890];
            }
            // red body
            {
                bool defunc_0_op_res_123419 = eta_p_123417 || eta_p_123418;
                
                defunc_0_reduce_res_107523 = defunc_0_op_res_123419;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_123388);
    }
    if (event_127973 != NULL) {
        event_127973->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_127959", strdup("nothing further"), event_127973, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127951->retval_defunc_0_reduce_res_107523 = defunc_0_reduce_res_107523;
    }
    return err;
}
struct futhark_mc_task_127974 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_distrs_mem_111708;
    int64_t free_flat_tid_118914;
    double *retval_x_114081;
};
struct futhark_mc_segred_stage_1_parloop_struct_127977 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123422;
};
static int futhark_mc_segred_stage_1_parloop_127978(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127977 *futhark_mc_segred_stage_1_parloop_struct_127977 = (struct futhark_mc_segred_stage_1_parloop_struct_127977 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127977->ctx;
    struct mc_event *event_127979 = mc_event_new(ctx);
    
    if (event_127979 != NULL)
        event_127979->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127977->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_127977->free_eta_p_106382;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_127977->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_123422 = {.desc ="reduce_stage_1_tid_res_arr_mem_123422", .mem =futhark_mc_segred_stage_1_parloop_struct_127977->free_reduce_stage_1_tid_res_arr_mem_123422, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118914;
    
    flat_tid_118914 = subtask_id;
    {
        double eta_p_123424;
        double eta_p_123425;
        double local_acc_123427 = 0.0;
        double eta_p_118916;
        double eta_p_118917;
        double local_acc_123428 = 0.0;
        int64_t start_123429;
        int64_t end_123430;
        
        start_123429 = start;
        end_123430 = end;
        
        int64_t n_123431 = end_123430 - start_123429;
        
        for (int64_t SegRed_i_123432 = start_123429; SegRed_i_123432 < start_123429 + n_123431; SegRed_i_123432++) {
            int64_t gtid_118915 = SegRed_i_123432;
            double x_118919 = ((double *) distrs_mem_111708.mem)[eta_p_106382 * m_33388 + gtid_118915];
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_118916 = local_acc_123428;
            }
            // Load next params
            {
                eta_p_118917 = x_118919;
            }
            // SegRed body
            {
                double zp_res_118918 = eta_p_118916 + eta_p_118917;
                
                local_acc_123428 = zp_res_118918;
            }
        }
        
        int64_t uni_i_123433 = 0;
        
        {
            int64_t gtid_118915 = uni_i_123433;
            
            // Load accum params
            {
                eta_p_123424 = local_acc_123427;
            }
            // Load next params
            {
                eta_p_123425 = local_acc_123428;
            }
            // SegRed body
            {
                double zp_res_123426 = eta_p_123424 + eta_p_123425;
                
                local_acc_123427 = zp_res_123426;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_123422.mem)[flat_tid_118914] = local_acc_123427;
    }
    
  cleanup:
    { }
    if (event_127979 != NULL) {
        event_127979->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127978", strdup("nothing further"), event_127979, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127975(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127974 *futhark_mc_task_127974 = (struct futhark_mc_task_127974 *) args;
    struct futhark_context *ctx = futhark_mc_task_127974->ctx;
    struct mc_event *event_127981 = mc_event_new(ctx);
    
    if (event_127981 != NULL)
        event_127981->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127974->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_127974->free_eta_p_106382;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_127974->free_distrs_mem_111708, .size =0, .references =NULL};
    int64_t flat_tid_118914 = futhark_mc_task_127974->free_flat_tid_118914;
    double x_114081 = *futhark_mc_task_127974->retval_x_114081;
    int64_t reduce_stage_1_tid_res_arr_mem_123422_cached_sizze_127976 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123422 = NULL;
    int32_t nsubtasks_123421;
    
    nsubtasks_123421 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_123422_cached_sizze_127976 < (int64_t) 8 * nsubtasks_123421) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123422, &reduce_stage_1_tid_res_arr_mem_123422_cached_sizze_127976, (int64_t) 8 * nsubtasks_123421);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127977 futhark_mc_segred_stage_1_parloop_struct_127977_;
    
    futhark_mc_segred_stage_1_parloop_struct_127977_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127977_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127977_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_127977_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_127977_.free_reduce_stage_1_tid_res_arr_mem_123422 = reduce_stage_1_tid_res_arr_mem_123422;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127978_task;
    
    futhark_mc_segred_stage_1_parloop_127978_task.name = "futhark_mc_segred_stage_1_parloop_127978";
    futhark_mc_segred_stage_1_parloop_127978_task.fn = futhark_mc_segred_stage_1_parloop_127978;
    futhark_mc_segred_stage_1_parloop_127978_task.args = &futhark_mc_segred_stage_1_parloop_struct_127977_;
    futhark_mc_segred_stage_1_parloop_127978_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127978_task.info = info;
    
    struct mc_event *event_127980 = mc_event_new(ctx);
    
    if (event_127980 != NULL)
        event_127980->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127978_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127978_task);
    
    if (futhark_mc_segred_stage_1_parloop_127978_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127978_err;
        goto cleanup;
    }
    if (event_127980 != NULL) {
        event_127980->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127978_total", strdup("nothing further"), event_127980, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        x_114081 = 0.0;
    }
    
    double eta_p_123434;
    double eta_p_123435;
    
    for (int32_t i_123437 = 0; i_123437 < nsubtasks_123421; i_123437++) {
        flat_tid_118914 = i_123437;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_123434 = x_114081;
            }
            // load next params
            {
                eta_p_123435 = ((double *) reduce_stage_1_tid_res_arr_mem_123422)[flat_tid_118914];
            }
            // red body
            {
                double zp_res_123436 = eta_p_123434 + eta_p_123435;
                
                x_114081 = zp_res_123436;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_123422);
    }
    if (event_127981 != NULL) {
        event_127981->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127975", strdup("nothing further"), event_127981, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127974->retval_x_114081 = x_114081;
    }
    return err;
}
struct futhark_mc_task_127982 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    int64_t free_flat_tid_118920;
    double *retval_x_114083;
};
struct futhark_mc_segred_stage_1_parloop_struct_127985 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123439;
};
static int futhark_mc_segred_stage_1_parloop_127986(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127985 *futhark_mc_segred_stage_1_parloop_struct_127985 = (struct futhark_mc_segred_stage_1_parloop_struct_127985 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127985->ctx;
    struct mc_event *event_127987 = mc_event_new(ctx);
    
    if (event_127987 != NULL)
        event_127987->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127985->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_127985->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_127985->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_123439 = {.desc ="reduce_stage_1_tid_res_arr_mem_123439", .mem =futhark_mc_segred_stage_1_parloop_struct_127985->free_reduce_stage_1_tid_res_arr_mem_123439, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118920;
    
    flat_tid_118920 = subtask_id;
    {
        double eta_p_123441;
        double eta_p_123442;
        double local_acc_123444 = 0.0;
        double eta_p_118922;
        double eta_p_118923;
        double local_acc_123445 = 0.0;
        int64_t start_123446;
        int64_t end_123447;
        
        start_123446 = start;
        end_123447 = end;
        
        int64_t n_123448 = end_123447 - start_123446;
        
        for (int64_t SegRed_i_123449 = start_123446; SegRed_i_123449 < start_123446 + n_123448; SegRed_i_123449++) {
            int64_t gtid_118921 = SegRed_i_123449;
            double x_118925 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + gtid_118921];
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_118922 = local_acc_123445;
            }
            // Load next params
            {
                eta_p_118923 = x_118925;
            }
            // SegRed body
            {
                double zp_res_118924 = eta_p_118922 + eta_p_118923;
                
                local_acc_123445 = zp_res_118924;
            }
        }
        
        int64_t uni_i_123450 = 0;
        
        {
            int64_t gtid_118921 = uni_i_123450;
            
            // Load accum params
            {
                eta_p_123441 = local_acc_123444;
            }
            // Load next params
            {
                eta_p_123442 = local_acc_123445;
            }
            // SegRed body
            {
                double zp_res_123443 = eta_p_123441 + eta_p_123442;
                
                local_acc_123444 = zp_res_123443;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_123439.mem)[flat_tid_118920] = local_acc_123444;
    }
    
  cleanup:
    { }
    if (event_127987 != NULL) {
        event_127987->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127986", strdup("nothing further"), event_127987, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127983(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127982 *futhark_mc_task_127982 = (struct futhark_mc_task_127982 *) args;
    struct futhark_context *ctx = futhark_mc_task_127982->ctx;
    struct mc_event *event_127989 = mc_event_new(ctx);
    
    if (event_127989 != NULL)
        event_127989->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127982->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_127982->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_127982->free_distrs_mem_111708, .size =0, .references =NULL};
    int64_t flat_tid_118920 = futhark_mc_task_127982->free_flat_tid_118920;
    double x_114083 = *futhark_mc_task_127982->retval_x_114083;
    int64_t reduce_stage_1_tid_res_arr_mem_123439_cached_sizze_127984 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123439 = NULL;
    int32_t nsubtasks_123438;
    
    nsubtasks_123438 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_123439_cached_sizze_127984 < (int64_t) 8 * nsubtasks_123438) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123439, &reduce_stage_1_tid_res_arr_mem_123439_cached_sizze_127984, (int64_t) 8 * nsubtasks_123438);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127985 futhark_mc_segred_stage_1_parloop_struct_127985_;
    
    futhark_mc_segred_stage_1_parloop_struct_127985_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127985_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127985_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_127985_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_127985_.free_reduce_stage_1_tid_res_arr_mem_123439 = reduce_stage_1_tid_res_arr_mem_123439;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127986_task;
    
    futhark_mc_segred_stage_1_parloop_127986_task.name = "futhark_mc_segred_stage_1_parloop_127986";
    futhark_mc_segred_stage_1_parloop_127986_task.fn = futhark_mc_segred_stage_1_parloop_127986;
    futhark_mc_segred_stage_1_parloop_127986_task.args = &futhark_mc_segred_stage_1_parloop_struct_127985_;
    futhark_mc_segred_stage_1_parloop_127986_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127986_task.info = info;
    
    struct mc_event *event_127988 = mc_event_new(ctx);
    
    if (event_127988 != NULL)
        event_127988->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127986_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127986_task);
    
    if (futhark_mc_segred_stage_1_parloop_127986_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127986_err;
        goto cleanup;
    }
    if (event_127988 != NULL) {
        event_127988->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127986_total", strdup("nothing further"), event_127988, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        x_114083 = 0.0;
    }
    
    double eta_p_123451;
    double eta_p_123452;
    
    for (int32_t i_123454 = 0; i_123454 < nsubtasks_123438; i_123454++) {
        flat_tid_118920 = i_123454;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_123451 = x_114083;
            }
            // load next params
            {
                eta_p_123452 = ((double *) reduce_stage_1_tid_res_arr_mem_123439)[flat_tid_118920];
            }
            // red body
            {
                double zp_res_123453 = eta_p_123451 + eta_p_123452;
                
                x_114083 = zp_res_123453;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_123439);
    }
    if (event_127989 != NULL) {
        event_127989->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127983", strdup("nothing further"), event_127989, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127982->retval_x_114083 = x_114083;
    }
    return err;
}
struct futhark_mc_task_127990 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_param_118928;
    int64_t free_flat_tid_118939;
    int64_t free_flat_tid_118989;
    double *retval_defunc_res_118934;
    double *retval_defunc_res_118935;
    double *retval_defunc_res_118936;
    double *retval_defunc_res_118937;
    unsigned char *retval_mem_111993;
};
struct futhark_mc_segred_stage_1_parloop_struct_127996 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_111993;
    unsigned char *free_mem_param_118928;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123464;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123466;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123468;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123470;
};
static int futhark_mc_segred_stage_1_parloop_127997(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_127996 *futhark_mc_segred_stage_1_parloop_struct_127996 = (struct futhark_mc_segred_stage_1_parloop_struct_127996 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_127996->ctx;
    struct mc_event *event_127998 = mc_event_new(ctx);
    
    if (event_127998 != NULL)
        event_127998->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_127996->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_127996->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_127996->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_127996->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_111993 = {.desc ="mem_111993", .mem =futhark_mc_segred_stage_1_parloop_struct_127996->free_mem_111993, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_segred_stage_1_parloop_struct_127996->free_mem_param_118928, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_123464 = {.desc ="reduce_stage_1_tid_res_arr_mem_123464", .mem =futhark_mc_segred_stage_1_parloop_struct_127996->free_reduce_stage_1_tid_res_arr_mem_123464, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_123466 = {.desc ="reduce_stage_1_tid_res_arr_mem_123466", .mem =futhark_mc_segred_stage_1_parloop_struct_127996->free_reduce_stage_1_tid_res_arr_mem_123466, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_123468 = {.desc ="reduce_stage_1_tid_res_arr_mem_123468", .mem =futhark_mc_segred_stage_1_parloop_struct_127996->free_reduce_stage_1_tid_res_arr_mem_123468, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_123470 = {.desc ="reduce_stage_1_tid_res_arr_mem_123470", .mem =futhark_mc_segred_stage_1_parloop_struct_127996->free_reduce_stage_1_tid_res_arr_mem_123470, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118989;
    
    flat_tid_118989 = subtask_id;
    {
        double eta_p_123472;
        double eta_p_123473;
        double eta_p_123475;
        double eta_p_123476;
        double eta_p_123478;
        double eta_p_123479;
        double eta_p_123481;
        double eta_p_123482;
        double local_acc_123484 = 0.0;
        double local_acc_123485 = 0.0;
        double local_acc_123486 = 0.0;
        double local_acc_123487 = 0.0;
        double eta_p_118991;
        double eta_p_118992;
        double eta_p_118994;
        double eta_p_118995;
        double eta_p_118997;
        double eta_p_118998;
        double eta_p_119000;
        double eta_p_119001;
        double local_acc_123488 = 0.0;
        double local_acc_123489 = 0.0;
        double local_acc_123490 = 0.0;
        double local_acc_123491 = 0.0;
        int64_t start_123492;
        int64_t end_123493;
        
        start_123492 = start;
        end_123493 = end;
        
        int64_t n_123494 = end_123493 - start_123492;
        
        for (int64_t SegRed_i_123495 = start_123492; SegRed_i_123495 < start_123492 + n_123494; SegRed_i_123495++) {
            int64_t gtid_118990 = SegRed_i_123495;
            double eta_p_119003 = ((double *) distrs_mem_111708.mem)[eta_p_106382 * m_33388 + gtid_118990];
            double defunc_res_119004;
            double defunc_res_119005;
            double defunc_res_119006;
            double defunc_res_119007;
            double defunc_res_119008;
            double redout_119010;
            double redout_119011;
            double redout_119012;
            double redout_119013;
            double redout_119014;
            
            redout_119010 = 0.0;
            redout_119011 = 0.0;
            redout_119012 = 0.0;
            redout_119013 = 0.0;
            redout_119014 = 0.0;
            for (int64_t i_119009 = 0; i_119009 < m_33388; i_119009++) {
                double x_119015 = ((double *) mem_param_118928.mem)[gtid_118990 * m_33388 + i_119009];
                double eta_p_119016 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + i_119009];
                double zt_res_119017 = eta_p_119003 * eta_p_119016;
                bool zeze_res_119018 = x_119015 == 0.0;
                double klu_res_119019;
                
                if (zeze_res_119018) {
                    klu_res_119019 = 0.0;
                } else {
                    double zs_res_119020 = x_119015 / zt_res_119017;
                    double log_res_119021 = futrts_log64(zs_res_119020);
                    double zt_res_119022 = x_119015 * log_res_119021;
                    
                    klu_res_119019 = zt_res_119022;
                }
                
                double zp_res_119023 = x_119015 + redout_119010;
                double zp_res_119024 = x_119015 + redout_119011;
                double zp_res_119025 = x_119015 + redout_119012;
                double zp_res_119026 = klu_res_119019 + redout_119013;
                double zp_res_119027 = x_119015 + redout_119014;
                double redout_tmp_123496 = zp_res_119023;
                double redout_tmp_123497 = zp_res_119024;
                double redout_tmp_123498 = zp_res_119025;
                double redout_tmp_123499 = zp_res_119026;
                double redout_tmp_123500 = zp_res_119027;
                
                redout_119010 = redout_tmp_123496;
                redout_119011 = redout_tmp_123497;
                redout_119012 = redout_tmp_123498;
                redout_119013 = redout_tmp_123499;
                redout_119014 = redout_tmp_123500;
            }
            defunc_res_119004 = redout_119010;
            defunc_res_119005 = redout_119011;
            defunc_res_119006 = redout_119012;
            defunc_res_119007 = redout_119013;
            defunc_res_119008 = redout_119014;
            
            bool zeze_res_119028 = defunc_res_119006 == 0.0;
            double klu_res_119029;
            
            if (zeze_res_119028) {
                klu_res_119029 = 0.0;
            } else {
                double zs_res_119030 = defunc_res_119006 / eta_p_119003;
                double log_res_119031 = futrts_log64(zs_res_119030);
                double zt_res_119032 = defunc_res_119006 * log_res_119031;
                
                klu_res_119029 = zt_res_119032;
            }
            // save map-out results
            {
                ((double *) mem_111993.mem)[gtid_118990] = defunc_res_119005;
            }
            // Load accum params
            {
                eta_p_118991 = local_acc_123488;
            }
            // Load next params
            {
                eta_p_118992 = defunc_res_119004;
            }
            // SegRed body
            {
                double zp_res_118993 = eta_p_118991 + eta_p_118992;
                
                local_acc_123488 = zp_res_118993;
            }
            // Load accum params
            {
                eta_p_118994 = local_acc_123489;
            }
            // Load next params
            {
                eta_p_118995 = klu_res_119029;
            }
            // SegRed body
            {
                double zp_res_118996 = eta_p_118994 + eta_p_118995;
                
                local_acc_123489 = zp_res_118996;
            }
            // Load accum params
            {
                eta_p_118997 = local_acc_123490;
            }
            // Load next params
            {
                eta_p_118998 = defunc_res_119007;
            }
            // SegRed body
            {
                double zp_res_118999 = eta_p_118997 + eta_p_118998;
                
                local_acc_123490 = zp_res_118999;
            }
            // Load accum params
            {
                eta_p_119000 = local_acc_123491;
            }
            // Load next params
            {
                eta_p_119001 = defunc_res_119008;
            }
            // SegRed body
            {
                double zp_res_119002 = eta_p_119000 + eta_p_119001;
                
                local_acc_123491 = zp_res_119002;
            }
        }
        
        int64_t uni_i_123501 = 0;
        
        {
            int64_t gtid_118990 = uni_i_123501;
            
            // Load accum params
            {
                eta_p_123472 = local_acc_123484;
            }
            // Load next params
            {
                eta_p_123473 = local_acc_123488;
            }
            // SegRed body
            {
                double zp_res_123474 = eta_p_123472 + eta_p_123473;
                
                local_acc_123484 = zp_res_123474;
            }
            // Load accum params
            {
                eta_p_123475 = local_acc_123485;
            }
            // Load next params
            {
                eta_p_123476 = local_acc_123489;
            }
            // SegRed body
            {
                double zp_res_123477 = eta_p_123475 + eta_p_123476;
                
                local_acc_123485 = zp_res_123477;
            }
            // Load accum params
            {
                eta_p_123478 = local_acc_123486;
            }
            // Load next params
            {
                eta_p_123479 = local_acc_123490;
            }
            // SegRed body
            {
                double zp_res_123480 = eta_p_123478 + eta_p_123479;
                
                local_acc_123486 = zp_res_123480;
            }
            // Load accum params
            {
                eta_p_123481 = local_acc_123487;
            }
            // Load next params
            {
                eta_p_123482 = local_acc_123491;
            }
            // SegRed body
            {
                double zp_res_123483 = eta_p_123481 + eta_p_123482;
                
                local_acc_123487 = zp_res_123483;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_123464.mem)[flat_tid_118989] = local_acc_123484;
        ((double *) reduce_stage_1_tid_res_arr_mem_123466.mem)[flat_tid_118989] = local_acc_123485;
        ((double *) reduce_stage_1_tid_res_arr_mem_123468.mem)[flat_tid_118989] = local_acc_123486;
        ((double *) reduce_stage_1_tid_res_arr_mem_123470.mem)[flat_tid_118989] = local_acc_123487;
    }
    
  cleanup:
    { }
    if (event_127998 != NULL) {
        event_127998->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127997", strdup("nothing further"), event_127998, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_127991(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127990 *futhark_mc_task_127990 = (struct futhark_mc_task_127990 *) args;
    struct futhark_context *ctx = futhark_mc_task_127990->ctx;
    struct mc_event *event_128000 = mc_event_new(ctx);
    
    if (event_128000 != NULL)
        event_128000->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127990->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_127990->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_127990->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_127990->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_task_127990->free_mem_param_118928, .size =0, .references =NULL};
    int64_t flat_tid_118939 = futhark_mc_task_127990->free_flat_tid_118939;
    int64_t flat_tid_118989 = futhark_mc_task_127990->free_flat_tid_118989;
    double defunc_res_118934 = *futhark_mc_task_127990->retval_defunc_res_118934;
    double defunc_res_118935 = *futhark_mc_task_127990->retval_defunc_res_118935;
    double defunc_res_118936 = *futhark_mc_task_127990->retval_defunc_res_118936;
    double defunc_res_118937 = *futhark_mc_task_127990->retval_defunc_res_118937;
    struct memblock mem_111993 = {.desc ="mem_111993", .mem =futhark_mc_task_127990->retval_mem_111993, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_123464_cached_sizze_127992 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123464 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_123466_cached_sizze_127993 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123466 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_123468_cached_sizze_127994 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123468 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_123470_cached_sizze_127995 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123470 = NULL;
    int32_t nsubtasks_123463;
    
    nsubtasks_123463 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_123464_cached_sizze_127992 < (int64_t) 8 * nsubtasks_123463) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123464, &reduce_stage_1_tid_res_arr_mem_123464_cached_sizze_127992, (int64_t) 8 * nsubtasks_123463);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_123466_cached_sizze_127993 < (int64_t) 8 * nsubtasks_123463) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123466, &reduce_stage_1_tid_res_arr_mem_123466_cached_sizze_127993, (int64_t) 8 * nsubtasks_123463);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_123468_cached_sizze_127994 < (int64_t) 8 * nsubtasks_123463) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123468, &reduce_stage_1_tid_res_arr_mem_123468_cached_sizze_127994, (int64_t) 8 * nsubtasks_123463);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_123470_cached_sizze_127995 < (int64_t) 8 * nsubtasks_123463) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123470, &reduce_stage_1_tid_res_arr_mem_123470_cached_sizze_127995, (int64_t) 8 * nsubtasks_123463);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_127996 futhark_mc_segred_stage_1_parloop_struct_127996_;
    
    futhark_mc_segred_stage_1_parloop_struct_127996_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_127996_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_127996_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_127996_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_127996_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_127996_.free_mem_111993 = mem_111993.mem;
    futhark_mc_segred_stage_1_parloop_struct_127996_.free_mem_param_118928 = mem_param_118928.mem;
    futhark_mc_segred_stage_1_parloop_struct_127996_.free_reduce_stage_1_tid_res_arr_mem_123464 = reduce_stage_1_tid_res_arr_mem_123464;
    futhark_mc_segred_stage_1_parloop_struct_127996_.free_reduce_stage_1_tid_res_arr_mem_123466 = reduce_stage_1_tid_res_arr_mem_123466;
    futhark_mc_segred_stage_1_parloop_struct_127996_.free_reduce_stage_1_tid_res_arr_mem_123468 = reduce_stage_1_tid_res_arr_mem_123468;
    futhark_mc_segred_stage_1_parloop_struct_127996_.free_reduce_stage_1_tid_res_arr_mem_123470 = reduce_stage_1_tid_res_arr_mem_123470;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_127997_task;
    
    futhark_mc_segred_stage_1_parloop_127997_task.name = "futhark_mc_segred_stage_1_parloop_127997";
    futhark_mc_segred_stage_1_parloop_127997_task.fn = futhark_mc_segred_stage_1_parloop_127997;
    futhark_mc_segred_stage_1_parloop_127997_task.args = &futhark_mc_segred_stage_1_parloop_struct_127996_;
    futhark_mc_segred_stage_1_parloop_127997_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_127997_task.info = info;
    
    struct mc_event *event_127999 = mc_event_new(ctx);
    
    if (event_127999 != NULL)
        event_127999->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_127997_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_127997_task);
    
    if (futhark_mc_segred_stage_1_parloop_127997_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_127997_err;
        goto cleanup;
    }
    if (event_127999 != NULL) {
        event_127999->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_127997_total", strdup("nothing further"), event_127999, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_118934 = 0.0;
        defunc_res_118935 = 0.0;
        defunc_res_118936 = 0.0;
        defunc_res_118937 = 0.0;
    }
    
    double eta_p_123502;
    double eta_p_123503;
    double eta_p_123505;
    double eta_p_123506;
    double eta_p_123508;
    double eta_p_123509;
    double eta_p_123511;
    double eta_p_123512;
    
    for (int32_t i_123514 = 0; i_123514 < nsubtasks_123463; i_123514++) {
        flat_tid_118989 = i_123514;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_123502 = defunc_res_118934;
            }
            // load next params
            {
                eta_p_123503 = ((double *) reduce_stage_1_tid_res_arr_mem_123464)[flat_tid_118989];
            }
            // red body
            {
                double zp_res_123504 = eta_p_123502 + eta_p_123503;
                
                defunc_res_118934 = zp_res_123504;
            }
            // load acc params
            {
                eta_p_123505 = defunc_res_118935;
            }
            // load next params
            {
                eta_p_123506 = ((double *) reduce_stage_1_tid_res_arr_mem_123466)[flat_tid_118989];
            }
            // red body
            {
                double zp_res_123507 = eta_p_123505 + eta_p_123506;
                
                defunc_res_118935 = zp_res_123507;
            }
            // load acc params
            {
                eta_p_123508 = defunc_res_118936;
            }
            // load next params
            {
                eta_p_123509 = ((double *) reduce_stage_1_tid_res_arr_mem_123468)[flat_tid_118989];
            }
            // red body
            {
                double zp_res_123510 = eta_p_123508 + eta_p_123509;
                
                defunc_res_118936 = zp_res_123510;
            }
            // load acc params
            {
                eta_p_123511 = defunc_res_118937;
            }
            // load next params
            {
                eta_p_123512 = ((double *) reduce_stage_1_tid_res_arr_mem_123470)[flat_tid_118989];
            }
            // red body
            {
                double zp_res_123513 = eta_p_123511 + eta_p_123512;
                
                defunc_res_118937 = zp_res_123513;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_123464);
        free(reduce_stage_1_tid_res_arr_mem_123466);
        free(reduce_stage_1_tid_res_arr_mem_123468);
        free(reduce_stage_1_tid_res_arr_mem_123470);
    }
    if (event_128000 != NULL) {
        event_128000->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_127991", strdup("nothing further"), event_128000, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127990->retval_defunc_res_118934 = defunc_res_118934;
        *futhark_mc_task_127990->retval_defunc_res_118935 = defunc_res_118935;
        *futhark_mc_task_127990->retval_defunc_res_118936 = defunc_res_118936;
        *futhark_mc_task_127990->retval_defunc_res_118937 = defunc_res_118937;
        futhark_mc_task_127990->retval_mem_111993 = mem_111993.mem;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_128006 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_111993;
    unsigned char *free_mem_param_118928;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123516;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123518;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123520;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123522;
};
struct futhark_mc_task_128008 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_param_118928;
    int64_t free_gtid_118940;
    double free_eta_p_118953;
    int64_t free_flat_tid_118959;
    double *retval_defunc_res_118954;
    double *retval_defunc_res_118955;
    double *retval_defunc_res_118956;
    double *retval_defunc_res_118957;
    double *retval_defunc_res_118958;
};
struct futhark_mc_segred_stage_1_parloop_struct_128015 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_param_118928;
    int64_t free_gtid_118940;
    double free_eta_p_118953;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123549;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123551;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123553;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123555;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123557;
};
static int futhark_mc_segred_stage_1_parloop_128016(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128015 *futhark_mc_segred_stage_1_parloop_struct_128015 = (struct futhark_mc_segred_stage_1_parloop_struct_128015 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128015->ctx;
    struct mc_event *event_128017 = mc_event_new(ctx);
    
    if (event_128017 != NULL)
        event_128017->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128015->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128015->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_128015->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_segred_stage_1_parloop_struct_128015->free_mem_param_118928, .size =0, .references =NULL};
    int64_t gtid_118940 = futhark_mc_segred_stage_1_parloop_struct_128015->free_gtid_118940;
    double eta_p_118953 = futhark_mc_segred_stage_1_parloop_struct_128015->free_eta_p_118953;
    struct memblock reduce_stage_1_tid_res_arr_mem_123549 = {.desc ="reduce_stage_1_tid_res_arr_mem_123549", .mem =futhark_mc_segred_stage_1_parloop_struct_128015->free_reduce_stage_1_tid_res_arr_mem_123549, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_123551 = {.desc ="reduce_stage_1_tid_res_arr_mem_123551", .mem =futhark_mc_segred_stage_1_parloop_struct_128015->free_reduce_stage_1_tid_res_arr_mem_123551, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_123553 = {.desc ="reduce_stage_1_tid_res_arr_mem_123553", .mem =futhark_mc_segred_stage_1_parloop_struct_128015->free_reduce_stage_1_tid_res_arr_mem_123553, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_123555 = {.desc ="reduce_stage_1_tid_res_arr_mem_123555", .mem =futhark_mc_segred_stage_1_parloop_struct_128015->free_reduce_stage_1_tid_res_arr_mem_123555, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_123557 = {.desc ="reduce_stage_1_tid_res_arr_mem_123557", .mem =futhark_mc_segred_stage_1_parloop_struct_128015->free_reduce_stage_1_tid_res_arr_mem_123557, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118959;
    
    flat_tid_118959 = subtask_id;
    {
        double eta_p_123559;
        double eta_p_123560;
        double eta_p_123562;
        double eta_p_123563;
        double eta_p_123565;
        double eta_p_123566;
        double eta_p_123568;
        double eta_p_123569;
        double eta_p_123571;
        double eta_p_123572;
        double local_acc_123574 = 0.0;
        double local_acc_123575 = 0.0;
        double local_acc_123576 = 0.0;
        double local_acc_123577 = 0.0;
        double local_acc_123578 = 0.0;
        double eta_p_118961;
        double eta_p_118962;
        double eta_p_118964;
        double eta_p_118965;
        double eta_p_118967;
        double eta_p_118968;
        double eta_p_118970;
        double eta_p_118971;
        double eta_p_118973;
        double eta_p_118974;
        double local_acc_123579 = 0.0;
        double local_acc_123580 = 0.0;
        double local_acc_123581 = 0.0;
        double local_acc_123582 = 0.0;
        double local_acc_123583 = 0.0;
        int64_t start_123584;
        int64_t end_123585;
        
        start_123584 = start;
        end_123585 = end;
        
        int64_t n_123586 = end_123585 - start_123584;
        
        for (int64_t SegRed_i_123587 = start_123584; SegRed_i_123587 < start_123584 + n_123586; SegRed_i_123587++) {
            int64_t gtid_118960 = SegRed_i_123587;
            double x_118976 = ((double *) mem_param_118928.mem)[gtid_118940 * m_33388 + gtid_118960];
            double eta_p_118977 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + gtid_118960];
            double zt_res_118978 = eta_p_118953 * eta_p_118977;
            bool zeze_res_118979 = x_118976 == 0.0;
            double klu_res_118980;
            
            if (zeze_res_118979) {
                klu_res_118980 = 0.0;
            } else {
                double zs_res_118981 = x_118976 / zt_res_118978;
                double log_res_118982 = futrts_log64(zs_res_118981);
                double zt_res_118983 = x_118976 * log_res_118982;
                
                klu_res_118980 = zt_res_118983;
            }
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_118961 = local_acc_123579;
            }
            // Load next params
            {
                eta_p_118962 = x_118976;
            }
            // SegRed body
            {
                double zp_res_118963 = eta_p_118961 + eta_p_118962;
                
                local_acc_123579 = zp_res_118963;
            }
            // Load accum params
            {
                eta_p_118964 = local_acc_123580;
            }
            // Load next params
            {
                eta_p_118965 = x_118976;
            }
            // SegRed body
            {
                double zp_res_118966 = eta_p_118964 + eta_p_118965;
                
                local_acc_123580 = zp_res_118966;
            }
            // Load accum params
            {
                eta_p_118967 = local_acc_123581;
            }
            // Load next params
            {
                eta_p_118968 = x_118976;
            }
            // SegRed body
            {
                double zp_res_118969 = eta_p_118967 + eta_p_118968;
                
                local_acc_123581 = zp_res_118969;
            }
            // Load accum params
            {
                eta_p_118970 = local_acc_123582;
            }
            // Load next params
            {
                eta_p_118971 = klu_res_118980;
            }
            // SegRed body
            {
                double zp_res_118972 = eta_p_118970 + eta_p_118971;
                
                local_acc_123582 = zp_res_118972;
            }
            // Load accum params
            {
                eta_p_118973 = local_acc_123583;
            }
            // Load next params
            {
                eta_p_118974 = x_118976;
            }
            // SegRed body
            {
                double zp_res_118975 = eta_p_118973 + eta_p_118974;
                
                local_acc_123583 = zp_res_118975;
            }
        }
        
        int64_t uni_i_123588 = 0;
        
        {
            int64_t gtid_118960 = uni_i_123588;
            
            // Load accum params
            {
                eta_p_123559 = local_acc_123574;
            }
            // Load next params
            {
                eta_p_123560 = local_acc_123579;
            }
            // SegRed body
            {
                double zp_res_123561 = eta_p_123559 + eta_p_123560;
                
                local_acc_123574 = zp_res_123561;
            }
            // Load accum params
            {
                eta_p_123562 = local_acc_123575;
            }
            // Load next params
            {
                eta_p_123563 = local_acc_123580;
            }
            // SegRed body
            {
                double zp_res_123564 = eta_p_123562 + eta_p_123563;
                
                local_acc_123575 = zp_res_123564;
            }
            // Load accum params
            {
                eta_p_123565 = local_acc_123576;
            }
            // Load next params
            {
                eta_p_123566 = local_acc_123581;
            }
            // SegRed body
            {
                double zp_res_123567 = eta_p_123565 + eta_p_123566;
                
                local_acc_123576 = zp_res_123567;
            }
            // Load accum params
            {
                eta_p_123568 = local_acc_123577;
            }
            // Load next params
            {
                eta_p_123569 = local_acc_123582;
            }
            // SegRed body
            {
                double zp_res_123570 = eta_p_123568 + eta_p_123569;
                
                local_acc_123577 = zp_res_123570;
            }
            // Load accum params
            {
                eta_p_123571 = local_acc_123578;
            }
            // Load next params
            {
                eta_p_123572 = local_acc_123583;
            }
            // SegRed body
            {
                double zp_res_123573 = eta_p_123571 + eta_p_123572;
                
                local_acc_123578 = zp_res_123573;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_123549.mem)[flat_tid_118959] = local_acc_123574;
        ((double *) reduce_stage_1_tid_res_arr_mem_123551.mem)[flat_tid_118959] = local_acc_123575;
        ((double *) reduce_stage_1_tid_res_arr_mem_123553.mem)[flat_tid_118959] = local_acc_123576;
        ((double *) reduce_stage_1_tid_res_arr_mem_123555.mem)[flat_tid_118959] = local_acc_123577;
        ((double *) reduce_stage_1_tid_res_arr_mem_123557.mem)[flat_tid_118959] = local_acc_123578;
    }
    
  cleanup:
    { }
    if (event_128017 != NULL) {
        event_128017->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128016", strdup("nothing further"), event_128017, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128009(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128008 *futhark_mc_task_128008 = (struct futhark_mc_task_128008 *) args;
    struct futhark_context *ctx = futhark_mc_task_128008->ctx;
    struct mc_event *event_128019 = mc_event_new(ctx);
    
    if (event_128019 != NULL)
        event_128019->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128008->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128008->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128008->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_task_128008->free_mem_param_118928, .size =0, .references =NULL};
    int64_t gtid_118940 = futhark_mc_task_128008->free_gtid_118940;
    double eta_p_118953 = futhark_mc_task_128008->free_eta_p_118953;
    int64_t flat_tid_118959 = futhark_mc_task_128008->free_flat_tid_118959;
    double defunc_res_118954 = *futhark_mc_task_128008->retval_defunc_res_118954;
    double defunc_res_118955 = *futhark_mc_task_128008->retval_defunc_res_118955;
    double defunc_res_118956 = *futhark_mc_task_128008->retval_defunc_res_118956;
    double defunc_res_118957 = *futhark_mc_task_128008->retval_defunc_res_118957;
    double defunc_res_118958 = *futhark_mc_task_128008->retval_defunc_res_118958;
    int64_t reduce_stage_1_tid_res_arr_mem_123549_cached_sizze_128010 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123549 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_123551_cached_sizze_128011 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123551 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_123553_cached_sizze_128012 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123553 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_123555_cached_sizze_128013 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123555 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_123557_cached_sizze_128014 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123557 = NULL;
    int32_t nsubtasks_123548;
    
    nsubtasks_123548 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_123549_cached_sizze_128010 < (int64_t) 8 * nsubtasks_123548) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123549, &reduce_stage_1_tid_res_arr_mem_123549_cached_sizze_128010, (int64_t) 8 * nsubtasks_123548);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_123551_cached_sizze_128011 < (int64_t) 8 * nsubtasks_123548) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123551, &reduce_stage_1_tid_res_arr_mem_123551_cached_sizze_128011, (int64_t) 8 * nsubtasks_123548);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_123553_cached_sizze_128012 < (int64_t) 8 * nsubtasks_123548) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123553, &reduce_stage_1_tid_res_arr_mem_123553_cached_sizze_128012, (int64_t) 8 * nsubtasks_123548);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_123555_cached_sizze_128013 < (int64_t) 8 * nsubtasks_123548) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123555, &reduce_stage_1_tid_res_arr_mem_123555_cached_sizze_128013, (int64_t) 8 * nsubtasks_123548);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_123557_cached_sizze_128014 < (int64_t) 8 * nsubtasks_123548) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123557, &reduce_stage_1_tid_res_arr_mem_123557_cached_sizze_128014, (int64_t) 8 * nsubtasks_123548);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128015 futhark_mc_segred_stage_1_parloop_struct_128015_;
    
    futhark_mc_segred_stage_1_parloop_struct_128015_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128015_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128015_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128015_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_128015_.free_mem_param_118928 = mem_param_118928.mem;
    futhark_mc_segred_stage_1_parloop_struct_128015_.free_gtid_118940 = gtid_118940;
    futhark_mc_segred_stage_1_parloop_struct_128015_.free_eta_p_118953 = eta_p_118953;
    futhark_mc_segred_stage_1_parloop_struct_128015_.free_reduce_stage_1_tid_res_arr_mem_123549 = reduce_stage_1_tid_res_arr_mem_123549;
    futhark_mc_segred_stage_1_parloop_struct_128015_.free_reduce_stage_1_tid_res_arr_mem_123551 = reduce_stage_1_tid_res_arr_mem_123551;
    futhark_mc_segred_stage_1_parloop_struct_128015_.free_reduce_stage_1_tid_res_arr_mem_123553 = reduce_stage_1_tid_res_arr_mem_123553;
    futhark_mc_segred_stage_1_parloop_struct_128015_.free_reduce_stage_1_tid_res_arr_mem_123555 = reduce_stage_1_tid_res_arr_mem_123555;
    futhark_mc_segred_stage_1_parloop_struct_128015_.free_reduce_stage_1_tid_res_arr_mem_123557 = reduce_stage_1_tid_res_arr_mem_123557;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128016_task;
    
    futhark_mc_segred_stage_1_parloop_128016_task.name = "futhark_mc_segred_stage_1_parloop_128016";
    futhark_mc_segred_stage_1_parloop_128016_task.fn = futhark_mc_segred_stage_1_parloop_128016;
    futhark_mc_segred_stage_1_parloop_128016_task.args = &futhark_mc_segred_stage_1_parloop_struct_128015_;
    futhark_mc_segred_stage_1_parloop_128016_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128016_task.info = info;
    
    struct mc_event *event_128018 = mc_event_new(ctx);
    
    if (event_128018 != NULL)
        event_128018->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128016_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128016_task);
    
    if (futhark_mc_segred_stage_1_parloop_128016_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128016_err;
        goto cleanup;
    }
    if (event_128018 != NULL) {
        event_128018->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128016_total", strdup("nothing further"), event_128018, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_118954 = 0.0;
        defunc_res_118955 = 0.0;
        defunc_res_118956 = 0.0;
        defunc_res_118957 = 0.0;
        defunc_res_118958 = 0.0;
    }
    
    double eta_p_123589;
    double eta_p_123590;
    double eta_p_123592;
    double eta_p_123593;
    double eta_p_123595;
    double eta_p_123596;
    double eta_p_123598;
    double eta_p_123599;
    double eta_p_123601;
    double eta_p_123602;
    
    for (int32_t i_123604 = 0; i_123604 < nsubtasks_123548; i_123604++) {
        flat_tid_118959 = i_123604;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_123589 = defunc_res_118954;
            }
            // load next params
            {
                eta_p_123590 = ((double *) reduce_stage_1_tid_res_arr_mem_123549)[flat_tid_118959];
            }
            // red body
            {
                double zp_res_123591 = eta_p_123589 + eta_p_123590;
                
                defunc_res_118954 = zp_res_123591;
            }
            // load acc params
            {
                eta_p_123592 = defunc_res_118955;
            }
            // load next params
            {
                eta_p_123593 = ((double *) reduce_stage_1_tid_res_arr_mem_123551)[flat_tid_118959];
            }
            // red body
            {
                double zp_res_123594 = eta_p_123592 + eta_p_123593;
                
                defunc_res_118955 = zp_res_123594;
            }
            // load acc params
            {
                eta_p_123595 = defunc_res_118956;
            }
            // load next params
            {
                eta_p_123596 = ((double *) reduce_stage_1_tid_res_arr_mem_123553)[flat_tid_118959];
            }
            // red body
            {
                double zp_res_123597 = eta_p_123595 + eta_p_123596;
                
                defunc_res_118956 = zp_res_123597;
            }
            // load acc params
            {
                eta_p_123598 = defunc_res_118957;
            }
            // load next params
            {
                eta_p_123599 = ((double *) reduce_stage_1_tid_res_arr_mem_123555)[flat_tid_118959];
            }
            // red body
            {
                double zp_res_123600 = eta_p_123598 + eta_p_123599;
                
                defunc_res_118957 = zp_res_123600;
            }
            // load acc params
            {
                eta_p_123601 = defunc_res_118958;
            }
            // load next params
            {
                eta_p_123602 = ((double *) reduce_stage_1_tid_res_arr_mem_123557)[flat_tid_118959];
            }
            // red body
            {
                double zp_res_123603 = eta_p_123601 + eta_p_123602;
                
                defunc_res_118958 = zp_res_123603;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_123549);
        free(reduce_stage_1_tid_res_arr_mem_123551);
        free(reduce_stage_1_tid_res_arr_mem_123553);
        free(reduce_stage_1_tid_res_arr_mem_123555);
        free(reduce_stage_1_tid_res_arr_mem_123557);
    }
    if (event_128019 != NULL) {
        event_128019->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128009", strdup("nothing further"), event_128019, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128008->retval_defunc_res_118954 = defunc_res_118954;
        *futhark_mc_task_128008->retval_defunc_res_118955 = defunc_res_118955;
        *futhark_mc_task_128008->retval_defunc_res_118956 = defunc_res_118956;
        *futhark_mc_task_128008->retval_defunc_res_118957 = defunc_res_118957;
        *futhark_mc_task_128008->retval_defunc_res_118958 = defunc_res_118958;
    }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_128007(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128006 *futhark_mc_segred_stage_1_parloop_struct_128006 = (struct futhark_mc_segred_stage_1_parloop_struct_128006 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128006->ctx;
    struct mc_event *event_128020 = mc_event_new(ctx);
    
    if (event_128020 != NULL)
        event_128020->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128006->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_128006->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128006->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_128006->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_111993 = {.desc ="mem_111993", .mem =futhark_mc_segred_stage_1_parloop_struct_128006->free_mem_111993, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_segred_stage_1_parloop_struct_128006->free_mem_param_118928, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_123516 = {.desc ="reduce_stage_1_tid_res_arr_mem_123516", .mem =futhark_mc_segred_stage_1_parloop_struct_128006->free_reduce_stage_1_tid_res_arr_mem_123516, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_123518 = {.desc ="reduce_stage_1_tid_res_arr_mem_123518", .mem =futhark_mc_segred_stage_1_parloop_struct_128006->free_reduce_stage_1_tid_res_arr_mem_123518, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_123520 = {.desc ="reduce_stage_1_tid_res_arr_mem_123520", .mem =futhark_mc_segred_stage_1_parloop_struct_128006->free_reduce_stage_1_tid_res_arr_mem_123520, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_123522 = {.desc ="reduce_stage_1_tid_res_arr_mem_123522", .mem =futhark_mc_segred_stage_1_parloop_struct_128006->free_reduce_stage_1_tid_res_arr_mem_123522, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_118939;
    
    flat_tid_118939 = subtask_id;
    {
        double eta_p_123524;
        double eta_p_123525;
        double eta_p_123527;
        double eta_p_123528;
        double eta_p_123530;
        double eta_p_123531;
        double eta_p_123533;
        double eta_p_123534;
        double local_acc_123536 = 0.0;
        double local_acc_123537 = 0.0;
        double local_acc_123538 = 0.0;
        double local_acc_123539 = 0.0;
        double eta_p_118941;
        double eta_p_118942;
        double eta_p_118944;
        double eta_p_118945;
        double eta_p_118947;
        double eta_p_118948;
        double eta_p_118950;
        double eta_p_118951;
        double local_acc_123540 = 0.0;
        double local_acc_123541 = 0.0;
        double local_acc_123542 = 0.0;
        double local_acc_123543 = 0.0;
        int64_t start_123544;
        int64_t end_123545;
        
        start_123544 = start;
        end_123545 = end;
        
        int64_t n_123546 = end_123545 - start_123544;
        
        for (int64_t SegRed_i_123547 = start_123544; SegRed_i_123547 < start_123544 + n_123546; SegRed_i_123547++) {
            int64_t gtid_118940 = SegRed_i_123547;
            double eta_p_118953 = ((double *) distrs_mem_111708.mem)[eta_p_106382 * m_33388 + gtid_118940];
            double defunc_res_118954;
            double defunc_res_118955;
            double defunc_res_118956;
            double defunc_res_118957;
            double defunc_res_118958;
            int64_t flat_tid_118959 = (int64_t) 0;
            
            defunc_res_118954 = 0.0;
            defunc_res_118955 = 0.0;
            defunc_res_118956 = 0.0;
            defunc_res_118957 = 0.0;
            defunc_res_118958 = 0.0;
            
            struct futhark_mc_task_128008 futhark_mc_task_128008_;
            
            futhark_mc_task_128008_.ctx = ctx;
            futhark_mc_task_128008_.free_m_33388 = m_33388;
            futhark_mc_task_128008_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
            futhark_mc_task_128008_.free_distrs_mem_111708 = distrs_mem_111708.mem;
            futhark_mc_task_128008_.free_mem_param_118928 = mem_param_118928.mem;
            futhark_mc_task_128008_.free_gtid_118940 = gtid_118940;
            futhark_mc_task_128008_.free_eta_p_118953 = eta_p_118953;
            futhark_mc_task_128008_.free_flat_tid_118959 = flat_tid_118959;
            futhark_mc_task_128008_.retval_defunc_res_118954 = (double *) &defunc_res_118954;
            #if ISPC
            futhark_mc_task_128008_.retval_defunc_res_118954 += programIndex;
            #endif
            futhark_mc_task_128008_.retval_defunc_res_118955 = (double *) &defunc_res_118955;
            #if ISPC
            futhark_mc_task_128008_.retval_defunc_res_118955 += programIndex;
            #endif
            futhark_mc_task_128008_.retval_defunc_res_118956 = (double *) &defunc_res_118956;
            #if ISPC
            futhark_mc_task_128008_.retval_defunc_res_118956 += programIndex;
            #endif
            futhark_mc_task_128008_.retval_defunc_res_118957 = (double *) &defunc_res_118957;
            #if ISPC
            futhark_mc_task_128008_.retval_defunc_res_118957 += programIndex;
            #endif
            futhark_mc_task_128008_.retval_defunc_res_118958 = (double *) &defunc_res_118958;
            #if ISPC
            futhark_mc_task_128008_.retval_defunc_res_118958 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_128008_task;
            
            futhark_mc_task_128008_task.args = &futhark_mc_task_128008_;
            futhark_mc_task_128008_task.top_level_fn = futhark_mc_segred_task_128009;
            futhark_mc_task_128008_task.name = "futhark_mc_segred_task_128009";
            futhark_mc_task_128008_task.iterations = m_33388;
            futhark_mc_task_128008_task.task_time = &ctx->program->futhark_mc_segred_task_128009_total_time;
            futhark_mc_task_128008_task.task_iter = &ctx->program->futhark_mc_segred_task_128009_total_iter;
            futhark_mc_task_128008_task.sched = STATIC;
            futhark_mc_task_128008_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_128009_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128008_task);
            
            if (futhark_mc_segred_task_128009_err != 0) {
                err = futhark_mc_segred_task_128009_err;
                goto cleanup;
            }
            
            bool zeze_res_118984 = defunc_res_118956 == 0.0;
            double klu_res_118985;
            
            if (zeze_res_118984) {
                klu_res_118985 = 0.0;
            } else {
                double zs_res_118986 = defunc_res_118956 / eta_p_118953;
                double log_res_118987 = futrts_log64(zs_res_118986);
                double zt_res_118988 = defunc_res_118956 * log_res_118987;
                
                klu_res_118985 = zt_res_118988;
            }
            // save map-out results
            {
                ((double *) mem_111993.mem)[gtid_118940] = defunc_res_118955;
            }
            // Load accum params
            {
                eta_p_118941 = local_acc_123540;
            }
            // Load next params
            {
                eta_p_118942 = defunc_res_118954;
            }
            // SegRed body
            {
                double zp_res_118943 = eta_p_118941 + eta_p_118942;
                
                local_acc_123540 = zp_res_118943;
            }
            // Load accum params
            {
                eta_p_118944 = local_acc_123541;
            }
            // Load next params
            {
                eta_p_118945 = klu_res_118985;
            }
            // SegRed body
            {
                double zp_res_118946 = eta_p_118944 + eta_p_118945;
                
                local_acc_123541 = zp_res_118946;
            }
            // Load accum params
            {
                eta_p_118947 = local_acc_123542;
            }
            // Load next params
            {
                eta_p_118948 = defunc_res_118957;
            }
            // SegRed body
            {
                double zp_res_118949 = eta_p_118947 + eta_p_118948;
                
                local_acc_123542 = zp_res_118949;
            }
            // Load accum params
            {
                eta_p_118950 = local_acc_123543;
            }
            // Load next params
            {
                eta_p_118951 = defunc_res_118958;
            }
            // SegRed body
            {
                double zp_res_118952 = eta_p_118950 + eta_p_118951;
                
                local_acc_123543 = zp_res_118952;
            }
        }
        
        int64_t uni_i_123605 = 0;
        
        {
            int64_t gtid_118940 = uni_i_123605;
            
            // Load accum params
            {
                eta_p_123524 = local_acc_123536;
            }
            // Load next params
            {
                eta_p_123525 = local_acc_123540;
            }
            // SegRed body
            {
                double zp_res_123526 = eta_p_123524 + eta_p_123525;
                
                local_acc_123536 = zp_res_123526;
            }
            // Load accum params
            {
                eta_p_123527 = local_acc_123537;
            }
            // Load next params
            {
                eta_p_123528 = local_acc_123541;
            }
            // SegRed body
            {
                double zp_res_123529 = eta_p_123527 + eta_p_123528;
                
                local_acc_123537 = zp_res_123529;
            }
            // Load accum params
            {
                eta_p_123530 = local_acc_123538;
            }
            // Load next params
            {
                eta_p_123531 = local_acc_123542;
            }
            // SegRed body
            {
                double zp_res_123532 = eta_p_123530 + eta_p_123531;
                
                local_acc_123538 = zp_res_123532;
            }
            // Load accum params
            {
                eta_p_123533 = local_acc_123539;
            }
            // Load next params
            {
                eta_p_123534 = local_acc_123543;
            }
            // SegRed body
            {
                double zp_res_123535 = eta_p_123533 + eta_p_123534;
                
                local_acc_123539 = zp_res_123535;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_123516.mem)[flat_tid_118939] = local_acc_123536;
        ((double *) reduce_stage_1_tid_res_arr_mem_123518.mem)[flat_tid_118939] = local_acc_123537;
        ((double *) reduce_stage_1_tid_res_arr_mem_123520.mem)[flat_tid_118939] = local_acc_123538;
        ((double *) reduce_stage_1_tid_res_arr_mem_123522.mem)[flat_tid_118939] = local_acc_123539;
    }
    
  cleanup:
    { }
    if (event_128020 != NULL) {
        event_128020->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128007", strdup("nothing further"), event_128020, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_128001(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127990 *futhark_mc_task_127990 = (struct futhark_mc_task_127990 *) args;
    struct futhark_context *ctx = futhark_mc_task_127990->ctx;
    struct mc_event *event_128022 = mc_event_new(ctx);
    
    if (event_128022 != NULL)
        event_128022->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_127990->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_127990->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_127990->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_127990->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_task_127990->free_mem_param_118928, .size =0, .references =NULL};
    int64_t flat_tid_118939 = futhark_mc_task_127990->free_flat_tid_118939;
    int64_t flat_tid_118989 = futhark_mc_task_127990->free_flat_tid_118989;
    double defunc_res_118934 = *futhark_mc_task_127990->retval_defunc_res_118934;
    double defunc_res_118935 = *futhark_mc_task_127990->retval_defunc_res_118935;
    double defunc_res_118936 = *futhark_mc_task_127990->retval_defunc_res_118936;
    double defunc_res_118937 = *futhark_mc_task_127990->retval_defunc_res_118937;
    struct memblock mem_111993 = {.desc ="mem_111993", .mem =futhark_mc_task_127990->retval_mem_111993, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_123516_cached_sizze_128002 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123516 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_123518_cached_sizze_128003 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123518 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_123520_cached_sizze_128004 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123520 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_123522_cached_sizze_128005 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123522 = NULL;
    int32_t nsubtasks_123515;
    
    nsubtasks_123515 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_123516_cached_sizze_128002 < (int64_t) 8 * nsubtasks_123515) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123516, &reduce_stage_1_tid_res_arr_mem_123516_cached_sizze_128002, (int64_t) 8 * nsubtasks_123515);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_123518_cached_sizze_128003 < (int64_t) 8 * nsubtasks_123515) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123518, &reduce_stage_1_tid_res_arr_mem_123518_cached_sizze_128003, (int64_t) 8 * nsubtasks_123515);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_123520_cached_sizze_128004 < (int64_t) 8 * nsubtasks_123515) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123520, &reduce_stage_1_tid_res_arr_mem_123520_cached_sizze_128004, (int64_t) 8 * nsubtasks_123515);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_123522_cached_sizze_128005 < (int64_t) 8 * nsubtasks_123515) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123522, &reduce_stage_1_tid_res_arr_mem_123522_cached_sizze_128005, (int64_t) 8 * nsubtasks_123515);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128006 futhark_mc_segred_stage_1_parloop_struct_128006_;
    
    futhark_mc_segred_stage_1_parloop_struct_128006_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128006_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128006_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_128006_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128006_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_128006_.free_mem_111993 = mem_111993.mem;
    futhark_mc_segred_stage_1_parloop_struct_128006_.free_mem_param_118928 = mem_param_118928.mem;
    futhark_mc_segred_stage_1_parloop_struct_128006_.free_reduce_stage_1_tid_res_arr_mem_123516 = reduce_stage_1_tid_res_arr_mem_123516;
    futhark_mc_segred_stage_1_parloop_struct_128006_.free_reduce_stage_1_tid_res_arr_mem_123518 = reduce_stage_1_tid_res_arr_mem_123518;
    futhark_mc_segred_stage_1_parloop_struct_128006_.free_reduce_stage_1_tid_res_arr_mem_123520 = reduce_stage_1_tid_res_arr_mem_123520;
    futhark_mc_segred_stage_1_parloop_struct_128006_.free_reduce_stage_1_tid_res_arr_mem_123522 = reduce_stage_1_tid_res_arr_mem_123522;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128007_task;
    
    futhark_mc_segred_stage_1_parloop_128007_task.name = "futhark_mc_segred_stage_1_parloop_128007";
    futhark_mc_segred_stage_1_parloop_128007_task.fn = futhark_mc_segred_stage_1_parloop_128007;
    futhark_mc_segred_stage_1_parloop_128007_task.args = &futhark_mc_segred_stage_1_parloop_struct_128006_;
    futhark_mc_segred_stage_1_parloop_128007_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128007_task.info = info;
    
    struct mc_event *event_128021 = mc_event_new(ctx);
    
    if (event_128021 != NULL)
        event_128021->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128007_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128007_task);
    
    if (futhark_mc_segred_stage_1_parloop_128007_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128007_err;
        goto cleanup;
    }
    if (event_128021 != NULL) {
        event_128021->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128007_total", strdup("nothing further"), event_128021, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_118934 = 0.0;
        defunc_res_118935 = 0.0;
        defunc_res_118936 = 0.0;
        defunc_res_118937 = 0.0;
    }
    
    double eta_p_123606;
    double eta_p_123607;
    double eta_p_123609;
    double eta_p_123610;
    double eta_p_123612;
    double eta_p_123613;
    double eta_p_123615;
    double eta_p_123616;
    
    for (int32_t i_123618 = 0; i_123618 < nsubtasks_123515; i_123618++) {
        flat_tid_118939 = i_123618;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_123606 = defunc_res_118934;
            }
            // load next params
            {
                eta_p_123607 = ((double *) reduce_stage_1_tid_res_arr_mem_123516)[flat_tid_118939];
            }
            // red body
            {
                double zp_res_123608 = eta_p_123606 + eta_p_123607;
                
                defunc_res_118934 = zp_res_123608;
            }
            // load acc params
            {
                eta_p_123609 = defunc_res_118935;
            }
            // load next params
            {
                eta_p_123610 = ((double *) reduce_stage_1_tid_res_arr_mem_123518)[flat_tid_118939];
            }
            // red body
            {
                double zp_res_123611 = eta_p_123609 + eta_p_123610;
                
                defunc_res_118935 = zp_res_123611;
            }
            // load acc params
            {
                eta_p_123612 = defunc_res_118936;
            }
            // load next params
            {
                eta_p_123613 = ((double *) reduce_stage_1_tid_res_arr_mem_123520)[flat_tid_118939];
            }
            // red body
            {
                double zp_res_123614 = eta_p_123612 + eta_p_123613;
                
                defunc_res_118936 = zp_res_123614;
            }
            // load acc params
            {
                eta_p_123615 = defunc_res_118937;
            }
            // load next params
            {
                eta_p_123616 = ((double *) reduce_stage_1_tid_res_arr_mem_123522)[flat_tid_118939];
            }
            // red body
            {
                double zp_res_123617 = eta_p_123615 + eta_p_123616;
                
                defunc_res_118937 = zp_res_123617;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_123516);
        free(reduce_stage_1_tid_res_arr_mem_123518);
        free(reduce_stage_1_tid_res_arr_mem_123520);
        free(reduce_stage_1_tid_res_arr_mem_123522);
    }
    if (event_128022 != NULL) {
        event_128022->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_128001", strdup("nothing further"), event_128022, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_127990->retval_defunc_res_118934 = defunc_res_118934;
        *futhark_mc_task_127990->retval_defunc_res_118935 = defunc_res_118935;
        *futhark_mc_task_127990->retval_defunc_res_118936 = defunc_res_118936;
        *futhark_mc_task_127990->retval_defunc_res_118937 = defunc_res_118937;
        futhark_mc_task_127990->retval_mem_111993 = mem_111993.mem;
    }
    return err;
}
struct futhark_mc_task_128023 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_param_118928;
    double free_zt_res_119033;
    int64_t free_flat_tid_119037;
    int64_t free_flat_tid_119061;
    double *retval_defunc_res_119034;
    unsigned char *retval_mem_111995;
    unsigned char *retval_mem_111997;
};
struct futhark_mc_segred_stage_1_parloop_struct_128026 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_111995;
    unsigned char *free_mem_111997;
    unsigned char *free_mem_param_118928;
    double free_zt_res_119033;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123620;
};
static int futhark_mc_segred_stage_1_parloop_128027(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128026 *futhark_mc_segred_stage_1_parloop_struct_128026 = (struct futhark_mc_segred_stage_1_parloop_struct_128026 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128026->ctx;
    struct mc_event *event_128028 = mc_event_new(ctx);
    
    if (event_128028 != NULL)
        event_128028->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128026->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128026->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_128026->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_111995 = {.desc ="mem_111995", .mem =futhark_mc_segred_stage_1_parloop_struct_128026->free_mem_111995, .size =0, .references =NULL};
    struct memblock mem_111997 = {.desc ="mem_111997", .mem =futhark_mc_segred_stage_1_parloop_struct_128026->free_mem_111997, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_segred_stage_1_parloop_struct_128026->free_mem_param_118928, .size =0, .references =NULL};
    double zt_res_119033 = futhark_mc_segred_stage_1_parloop_struct_128026->free_zt_res_119033;
    struct memblock reduce_stage_1_tid_res_arr_mem_123620 = {.desc ="reduce_stage_1_tid_res_arr_mem_123620", .mem =futhark_mc_segred_stage_1_parloop_struct_128026->free_reduce_stage_1_tid_res_arr_mem_123620, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_119061;
    
    flat_tid_119061 = subtask_id;
    {
        double eta_p_123622;
        double eta_p_123623;
        double local_acc_123625 = 0.0;
        double eta_p_119063;
        double eta_p_119064;
        double local_acc_123626 = 0.0;
        int64_t start_123627;
        int64_t end_123628;
        
        start_123627 = start;
        end_123628 = end;
        
        int64_t n_123629 = end_123628 - start_123627;
        
        for (int64_t SegRed_i_123630 = start_123627; SegRed_i_123630 < start_123627 + n_123629; SegRed_i_123630++) {
            int64_t gtid_119062 = SegRed_i_123630;
            double eta_p_119066 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + gtid_119062];
            double log_res_119067 = futrts_log64(eta_p_119066);
            double zt_res_119068 = zt_res_119033 * log_res_119067;
            double defunc_res_119069;
            double defunc_res_119070;
            double redout_119072;
            double redout_119073;
            
            redout_119072 = 0.0;
            redout_119073 = 0.0;
            for (int64_t i_119071 = 0; i_119071 < m_33388; i_119071++) {
                double x_119074 = ((double *) mem_param_118928.mem)[i_119071 * m_33388 + gtid_119062];
                double zp_res_119075 = x_119074 + redout_119072;
                double zp_res_119076 = x_119074 + redout_119073;
                double redout_tmp_123631 = zp_res_119075;
                double redout_tmp_123632 = zp_res_119076;
                
                redout_119072 = redout_tmp_123631;
                redout_119073 = redout_tmp_123632;
            }
            defunc_res_119069 = redout_119072;
            defunc_res_119070 = redout_119073;
            
            bool zeze_res_119077 = defunc_res_119069 == 0.0;
            double klu_res_119078;
            
            if (zeze_res_119077) {
                klu_res_119078 = 0.0;
            } else {
                double zs_res_119079 = defunc_res_119069 / eta_p_119066;
                double log_res_119080 = futrts_log64(zs_res_119079);
                double zt_res_119081 = defunc_res_119069 * log_res_119080;
                
                klu_res_119078 = zt_res_119081;
            }
            // save map-out results
            {
                ((double *) mem_111995.mem)[gtid_119062] = defunc_res_119070;
                ((double *) mem_111997.mem)[gtid_119062] = zt_res_119068;
            }
            // Load accum params
            {
                eta_p_119063 = local_acc_123626;
            }
            // Load next params
            {
                eta_p_119064 = klu_res_119078;
            }
            // SegRed body
            {
                double zp_res_119065 = eta_p_119063 + eta_p_119064;
                
                local_acc_123626 = zp_res_119065;
            }
        }
        
        int64_t uni_i_123633 = 0;
        
        {
            int64_t gtid_119062 = uni_i_123633;
            
            // Load accum params
            {
                eta_p_123622 = local_acc_123625;
            }
            // Load next params
            {
                eta_p_123623 = local_acc_123626;
            }
            // SegRed body
            {
                double zp_res_123624 = eta_p_123622 + eta_p_123623;
                
                local_acc_123625 = zp_res_123624;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_123620.mem)[flat_tid_119061] = local_acc_123625;
    }
    
  cleanup:
    { }
    if (event_128028 != NULL) {
        event_128028->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128027", strdup("nothing further"), event_128028, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128024(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128023 *futhark_mc_task_128023 = (struct futhark_mc_task_128023 *) args;
    struct futhark_context *ctx = futhark_mc_task_128023->ctx;
    struct mc_event *event_128030 = mc_event_new(ctx);
    
    if (event_128030 != NULL)
        event_128030->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128023->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128023->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128023->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_task_128023->free_mem_param_118928, .size =0, .references =NULL};
    double zt_res_119033 = futhark_mc_task_128023->free_zt_res_119033;
    int64_t flat_tid_119037 = futhark_mc_task_128023->free_flat_tid_119037;
    int64_t flat_tid_119061 = futhark_mc_task_128023->free_flat_tid_119061;
    double defunc_res_119034 = *futhark_mc_task_128023->retval_defunc_res_119034;
    struct memblock mem_111995 = {.desc ="mem_111995", .mem =futhark_mc_task_128023->retval_mem_111995, .size =0, .references =NULL};
    struct memblock mem_111997 = {.desc ="mem_111997", .mem =futhark_mc_task_128023->retval_mem_111997, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_123620_cached_sizze_128025 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123620 = NULL;
    int32_t nsubtasks_123619;
    
    nsubtasks_123619 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_123620_cached_sizze_128025 < (int64_t) 8 * nsubtasks_123619) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123620, &reduce_stage_1_tid_res_arr_mem_123620_cached_sizze_128025, (int64_t) 8 * nsubtasks_123619);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128026 futhark_mc_segred_stage_1_parloop_struct_128026_;
    
    futhark_mc_segred_stage_1_parloop_struct_128026_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128026_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128026_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128026_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_128026_.free_mem_111995 = mem_111995.mem;
    futhark_mc_segred_stage_1_parloop_struct_128026_.free_mem_111997 = mem_111997.mem;
    futhark_mc_segred_stage_1_parloop_struct_128026_.free_mem_param_118928 = mem_param_118928.mem;
    futhark_mc_segred_stage_1_parloop_struct_128026_.free_zt_res_119033 = zt_res_119033;
    futhark_mc_segred_stage_1_parloop_struct_128026_.free_reduce_stage_1_tid_res_arr_mem_123620 = reduce_stage_1_tid_res_arr_mem_123620;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128027_task;
    
    futhark_mc_segred_stage_1_parloop_128027_task.name = "futhark_mc_segred_stage_1_parloop_128027";
    futhark_mc_segred_stage_1_parloop_128027_task.fn = futhark_mc_segred_stage_1_parloop_128027;
    futhark_mc_segred_stage_1_parloop_128027_task.args = &futhark_mc_segred_stage_1_parloop_struct_128026_;
    futhark_mc_segred_stage_1_parloop_128027_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128027_task.info = info;
    
    struct mc_event *event_128029 = mc_event_new(ctx);
    
    if (event_128029 != NULL)
        event_128029->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128027_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128027_task);
    
    if (futhark_mc_segred_stage_1_parloop_128027_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128027_err;
        goto cleanup;
    }
    if (event_128029 != NULL) {
        event_128029->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128027_total", strdup("nothing further"), event_128029, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_119034 = 0.0;
    }
    
    double eta_p_123634;
    double eta_p_123635;
    
    for (int32_t i_123637 = 0; i_123637 < nsubtasks_123619; i_123637++) {
        flat_tid_119061 = i_123637;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_123634 = defunc_res_119034;
            }
            // load next params
            {
                eta_p_123635 = ((double *) reduce_stage_1_tid_res_arr_mem_123620)[flat_tid_119061];
            }
            // red body
            {
                double zp_res_123636 = eta_p_123634 + eta_p_123635;
                
                defunc_res_119034 = zp_res_123636;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_123620);
    }
    if (event_128030 != NULL) {
        event_128030->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128024", strdup("nothing further"), event_128030, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128023->retval_defunc_res_119034 = defunc_res_119034;
        futhark_mc_task_128023->retval_mem_111995 = mem_111995.mem;
        futhark_mc_task_128023->retval_mem_111997 = mem_111997.mem;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_128033 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_111995;
    unsigned char *free_mem_111997;
    unsigned char *free_mem_param_118928;
    double free_zt_res_119033;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123639;
};
struct futhark_mc_task_128035 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_param_118928;
    int64_t free_gtid_119038;
    int64_t free_flat_tid_119047;
    double *retval_defunc_res_119045;
    double *retval_defunc_res_119046;
};
struct futhark_mc_segred_stage_1_parloop_struct_128039 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_param_118928;
    int64_t free_gtid_119038;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123651;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123653;
};
static int futhark_mc_segred_stage_1_parloop_128040(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128039 *futhark_mc_segred_stage_1_parloop_struct_128039 = (struct futhark_mc_segred_stage_1_parloop_struct_128039 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128039->ctx;
    struct mc_event *event_128041 = mc_event_new(ctx);
    
    if (event_128041 != NULL)
        event_128041->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128039->free_m_33388;
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_segred_stage_1_parloop_struct_128039->free_mem_param_118928, .size =0, .references =NULL};
    int64_t gtid_119038 = futhark_mc_segred_stage_1_parloop_struct_128039->free_gtid_119038;
    struct memblock reduce_stage_1_tid_res_arr_mem_123651 = {.desc ="reduce_stage_1_tid_res_arr_mem_123651", .mem =futhark_mc_segred_stage_1_parloop_struct_128039->free_reduce_stage_1_tid_res_arr_mem_123651, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_123653 = {.desc ="reduce_stage_1_tid_res_arr_mem_123653", .mem =futhark_mc_segred_stage_1_parloop_struct_128039->free_reduce_stage_1_tid_res_arr_mem_123653, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_119047;
    
    flat_tid_119047 = subtask_id;
    {
        double eta_p_123655;
        double eta_p_123656;
        double eta_p_123658;
        double eta_p_123659;
        double local_acc_123661 = 0.0;
        double local_acc_123662 = 0.0;
        double eta_p_119049;
        double eta_p_119050;
        double eta_p_119052;
        double eta_p_119053;
        double local_acc_123663 = 0.0;
        double local_acc_123664 = 0.0;
        int64_t start_123665;
        int64_t end_123666;
        
        start_123665 = start;
        end_123666 = end;
        
        int64_t n_123667 = end_123666 - start_123665;
        
        for (int64_t SegRed_i_123668 = start_123665; SegRed_i_123668 < start_123665 + n_123667; SegRed_i_123668++) {
            int64_t gtid_119048 = SegRed_i_123668;
            double x_119055 = ((double *) mem_param_118928.mem)[gtid_119048 * m_33388 + gtid_119038];
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_119049 = local_acc_123663;
            }
            // Load next params
            {
                eta_p_119050 = x_119055;
            }
            // SegRed body
            {
                double zp_res_119051 = eta_p_119049 + eta_p_119050;
                
                local_acc_123663 = zp_res_119051;
            }
            // Load accum params
            {
                eta_p_119052 = local_acc_123664;
            }
            // Load next params
            {
                eta_p_119053 = x_119055;
            }
            // SegRed body
            {
                double zp_res_119054 = eta_p_119052 + eta_p_119053;
                
                local_acc_123664 = zp_res_119054;
            }
        }
        
        int64_t uni_i_123669 = 0;
        
        {
            int64_t gtid_119048 = uni_i_123669;
            
            // Load accum params
            {
                eta_p_123655 = local_acc_123661;
            }
            // Load next params
            {
                eta_p_123656 = local_acc_123663;
            }
            // SegRed body
            {
                double zp_res_123657 = eta_p_123655 + eta_p_123656;
                
                local_acc_123661 = zp_res_123657;
            }
            // Load accum params
            {
                eta_p_123658 = local_acc_123662;
            }
            // Load next params
            {
                eta_p_123659 = local_acc_123664;
            }
            // SegRed body
            {
                double zp_res_123660 = eta_p_123658 + eta_p_123659;
                
                local_acc_123662 = zp_res_123660;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_123651.mem)[flat_tid_119047] = local_acc_123661;
        ((double *) reduce_stage_1_tid_res_arr_mem_123653.mem)[flat_tid_119047] = local_acc_123662;
    }
    
  cleanup:
    { }
    if (event_128041 != NULL) {
        event_128041->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128040", strdup("nothing further"), event_128041, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128036(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128035 *futhark_mc_task_128035 = (struct futhark_mc_task_128035 *) args;
    struct futhark_context *ctx = futhark_mc_task_128035->ctx;
    struct mc_event *event_128043 = mc_event_new(ctx);
    
    if (event_128043 != NULL)
        event_128043->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128035->free_m_33388;
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_task_128035->free_mem_param_118928, .size =0, .references =NULL};
    int64_t gtid_119038 = futhark_mc_task_128035->free_gtid_119038;
    int64_t flat_tid_119047 = futhark_mc_task_128035->free_flat_tid_119047;
    double defunc_res_119045 = *futhark_mc_task_128035->retval_defunc_res_119045;
    double defunc_res_119046 = *futhark_mc_task_128035->retval_defunc_res_119046;
    int64_t reduce_stage_1_tid_res_arr_mem_123651_cached_sizze_128037 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123651 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_123653_cached_sizze_128038 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123653 = NULL;
    int32_t nsubtasks_123650;
    
    nsubtasks_123650 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_123651_cached_sizze_128037 < (int64_t) 8 * nsubtasks_123650) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123651, &reduce_stage_1_tid_res_arr_mem_123651_cached_sizze_128037, (int64_t) 8 * nsubtasks_123650);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_123653_cached_sizze_128038 < (int64_t) 8 * nsubtasks_123650) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123653, &reduce_stage_1_tid_res_arr_mem_123653_cached_sizze_128038, (int64_t) 8 * nsubtasks_123650);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128039 futhark_mc_segred_stage_1_parloop_struct_128039_;
    
    futhark_mc_segred_stage_1_parloop_struct_128039_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128039_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128039_.free_mem_param_118928 = mem_param_118928.mem;
    futhark_mc_segred_stage_1_parloop_struct_128039_.free_gtid_119038 = gtid_119038;
    futhark_mc_segred_stage_1_parloop_struct_128039_.free_reduce_stage_1_tid_res_arr_mem_123651 = reduce_stage_1_tid_res_arr_mem_123651;
    futhark_mc_segred_stage_1_parloop_struct_128039_.free_reduce_stage_1_tid_res_arr_mem_123653 = reduce_stage_1_tid_res_arr_mem_123653;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128040_task;
    
    futhark_mc_segred_stage_1_parloop_128040_task.name = "futhark_mc_segred_stage_1_parloop_128040";
    futhark_mc_segred_stage_1_parloop_128040_task.fn = futhark_mc_segred_stage_1_parloop_128040;
    futhark_mc_segred_stage_1_parloop_128040_task.args = &futhark_mc_segred_stage_1_parloop_struct_128039_;
    futhark_mc_segred_stage_1_parloop_128040_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128040_task.info = info;
    
    struct mc_event *event_128042 = mc_event_new(ctx);
    
    if (event_128042 != NULL)
        event_128042->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128040_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128040_task);
    
    if (futhark_mc_segred_stage_1_parloop_128040_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128040_err;
        goto cleanup;
    }
    if (event_128042 != NULL) {
        event_128042->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128040_total", strdup("nothing further"), event_128042, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_119045 = 0.0;
        defunc_res_119046 = 0.0;
    }
    
    double eta_p_123670;
    double eta_p_123671;
    double eta_p_123673;
    double eta_p_123674;
    
    for (int32_t i_123676 = 0; i_123676 < nsubtasks_123650; i_123676++) {
        flat_tid_119047 = i_123676;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_123670 = defunc_res_119045;
            }
            // load next params
            {
                eta_p_123671 = ((double *) reduce_stage_1_tid_res_arr_mem_123651)[flat_tid_119047];
            }
            // red body
            {
                double zp_res_123672 = eta_p_123670 + eta_p_123671;
                
                defunc_res_119045 = zp_res_123672;
            }
            // load acc params
            {
                eta_p_123673 = defunc_res_119046;
            }
            // load next params
            {
                eta_p_123674 = ((double *) reduce_stage_1_tid_res_arr_mem_123653)[flat_tid_119047];
            }
            // red body
            {
                double zp_res_123675 = eta_p_123673 + eta_p_123674;
                
                defunc_res_119046 = zp_res_123675;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_123651);
        free(reduce_stage_1_tid_res_arr_mem_123653);
    }
    if (event_128043 != NULL) {
        event_128043->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128036", strdup("nothing further"), event_128043, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128035->retval_defunc_res_119045 = defunc_res_119045;
        *futhark_mc_task_128035->retval_defunc_res_119046 = defunc_res_119046;
    }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_128034(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128033 *futhark_mc_segred_stage_1_parloop_struct_128033 = (struct futhark_mc_segred_stage_1_parloop_struct_128033 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128033->ctx;
    struct mc_event *event_128044 = mc_event_new(ctx);
    
    if (event_128044 != NULL)
        event_128044->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128033->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128033->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_128033->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_111995 = {.desc ="mem_111995", .mem =futhark_mc_segred_stage_1_parloop_struct_128033->free_mem_111995, .size =0, .references =NULL};
    struct memblock mem_111997 = {.desc ="mem_111997", .mem =futhark_mc_segred_stage_1_parloop_struct_128033->free_mem_111997, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_segred_stage_1_parloop_struct_128033->free_mem_param_118928, .size =0, .references =NULL};
    double zt_res_119033 = futhark_mc_segred_stage_1_parloop_struct_128033->free_zt_res_119033;
    struct memblock reduce_stage_1_tid_res_arr_mem_123639 = {.desc ="reduce_stage_1_tid_res_arr_mem_123639", .mem =futhark_mc_segred_stage_1_parloop_struct_128033->free_reduce_stage_1_tid_res_arr_mem_123639, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_119037;
    
    flat_tid_119037 = subtask_id;
    {
        double eta_p_123641;
        double eta_p_123642;
        double local_acc_123644 = 0.0;
        double eta_p_119039;
        double eta_p_119040;
        double local_acc_123645 = 0.0;
        int64_t start_123646;
        int64_t end_123647;
        
        start_123646 = start;
        end_123647 = end;
        
        int64_t n_123648 = end_123647 - start_123646;
        
        for (int64_t SegRed_i_123649 = start_123646; SegRed_i_123649 < start_123646 + n_123648; SegRed_i_123649++) {
            int64_t gtid_119038 = SegRed_i_123649;
            double eta_p_119042 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + gtid_119038];
            double log_res_119043 = futrts_log64(eta_p_119042);
            double zt_res_119044 = zt_res_119033 * log_res_119043;
            double defunc_res_119045;
            double defunc_res_119046;
            int64_t flat_tid_119047 = (int64_t) 0;
            
            defunc_res_119045 = 0.0;
            defunc_res_119046 = 0.0;
            
            struct futhark_mc_task_128035 futhark_mc_task_128035_;
            
            futhark_mc_task_128035_.ctx = ctx;
            futhark_mc_task_128035_.free_m_33388 = m_33388;
            futhark_mc_task_128035_.free_mem_param_118928 = mem_param_118928.mem;
            futhark_mc_task_128035_.free_gtid_119038 = gtid_119038;
            futhark_mc_task_128035_.free_flat_tid_119047 = flat_tid_119047;
            futhark_mc_task_128035_.retval_defunc_res_119045 = (double *) &defunc_res_119045;
            #if ISPC
            futhark_mc_task_128035_.retval_defunc_res_119045 += programIndex;
            #endif
            futhark_mc_task_128035_.retval_defunc_res_119046 = (double *) &defunc_res_119046;
            #if ISPC
            futhark_mc_task_128035_.retval_defunc_res_119046 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_128035_task;
            
            futhark_mc_task_128035_task.args = &futhark_mc_task_128035_;
            futhark_mc_task_128035_task.top_level_fn = futhark_mc_segred_task_128036;
            futhark_mc_task_128035_task.name = "futhark_mc_segred_task_128036";
            futhark_mc_task_128035_task.iterations = m_33388;
            futhark_mc_task_128035_task.task_time = &ctx->program->futhark_mc_segred_task_128036_total_time;
            futhark_mc_task_128035_task.task_iter = &ctx->program->futhark_mc_segred_task_128036_total_iter;
            futhark_mc_task_128035_task.sched = STATIC;
            futhark_mc_task_128035_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_128036_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128035_task);
            
            if (futhark_mc_segred_task_128036_err != 0) {
                err = futhark_mc_segred_task_128036_err;
                goto cleanup;
            }
            
            bool zeze_res_119056 = defunc_res_119045 == 0.0;
            double klu_res_119057;
            
            if (zeze_res_119056) {
                klu_res_119057 = 0.0;
            } else {
                double zs_res_119058 = defunc_res_119045 / eta_p_119042;
                double log_res_119059 = futrts_log64(zs_res_119058);
                double zt_res_119060 = defunc_res_119045 * log_res_119059;
                
                klu_res_119057 = zt_res_119060;
            }
            // save map-out results
            {
                ((double *) mem_111995.mem)[gtid_119038] = defunc_res_119046;
                ((double *) mem_111997.mem)[gtid_119038] = zt_res_119044;
            }
            // Load accum params
            {
                eta_p_119039 = local_acc_123645;
            }
            // Load next params
            {
                eta_p_119040 = klu_res_119057;
            }
            // SegRed body
            {
                double zp_res_119041 = eta_p_119039 + eta_p_119040;
                
                local_acc_123645 = zp_res_119041;
            }
        }
        
        int64_t uni_i_123677 = 0;
        
        {
            int64_t gtid_119038 = uni_i_123677;
            
            // Load accum params
            {
                eta_p_123641 = local_acc_123644;
            }
            // Load next params
            {
                eta_p_123642 = local_acc_123645;
            }
            // SegRed body
            {
                double zp_res_123643 = eta_p_123641 + eta_p_123642;
                
                local_acc_123644 = zp_res_123643;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_123639.mem)[flat_tid_119037] = local_acc_123644;
    }
    
  cleanup:
    { }
    if (event_128044 != NULL) {
        event_128044->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128034", strdup("nothing further"), event_128044, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_128031(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128023 *futhark_mc_task_128023 = (struct futhark_mc_task_128023 *) args;
    struct futhark_context *ctx = futhark_mc_task_128023->ctx;
    struct mc_event *event_128046 = mc_event_new(ctx);
    
    if (event_128046 != NULL)
        event_128046->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128023->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128023->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128023->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_task_128023->free_mem_param_118928, .size =0, .references =NULL};
    double zt_res_119033 = futhark_mc_task_128023->free_zt_res_119033;
    int64_t flat_tid_119037 = futhark_mc_task_128023->free_flat_tid_119037;
    int64_t flat_tid_119061 = futhark_mc_task_128023->free_flat_tid_119061;
    double defunc_res_119034 = *futhark_mc_task_128023->retval_defunc_res_119034;
    struct memblock mem_111995 = {.desc ="mem_111995", .mem =futhark_mc_task_128023->retval_mem_111995, .size =0, .references =NULL};
    struct memblock mem_111997 = {.desc ="mem_111997", .mem =futhark_mc_task_128023->retval_mem_111997, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_123639_cached_sizze_128032 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123639 = NULL;
    int32_t nsubtasks_123638;
    
    nsubtasks_123638 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_123639_cached_sizze_128032 < (int64_t) 8 * nsubtasks_123638) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123639, &reduce_stage_1_tid_res_arr_mem_123639_cached_sizze_128032, (int64_t) 8 * nsubtasks_123638);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128033 futhark_mc_segred_stage_1_parloop_struct_128033_;
    
    futhark_mc_segred_stage_1_parloop_struct_128033_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128033_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128033_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128033_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_128033_.free_mem_111995 = mem_111995.mem;
    futhark_mc_segred_stage_1_parloop_struct_128033_.free_mem_111997 = mem_111997.mem;
    futhark_mc_segred_stage_1_parloop_struct_128033_.free_mem_param_118928 = mem_param_118928.mem;
    futhark_mc_segred_stage_1_parloop_struct_128033_.free_zt_res_119033 = zt_res_119033;
    futhark_mc_segred_stage_1_parloop_struct_128033_.free_reduce_stage_1_tid_res_arr_mem_123639 = reduce_stage_1_tid_res_arr_mem_123639;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128034_task;
    
    futhark_mc_segred_stage_1_parloop_128034_task.name = "futhark_mc_segred_stage_1_parloop_128034";
    futhark_mc_segred_stage_1_parloop_128034_task.fn = futhark_mc_segred_stage_1_parloop_128034;
    futhark_mc_segred_stage_1_parloop_128034_task.args = &futhark_mc_segred_stage_1_parloop_struct_128033_;
    futhark_mc_segred_stage_1_parloop_128034_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128034_task.info = info;
    
    struct mc_event *event_128045 = mc_event_new(ctx);
    
    if (event_128045 != NULL)
        event_128045->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128034_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128034_task);
    
    if (futhark_mc_segred_stage_1_parloop_128034_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128034_err;
        goto cleanup;
    }
    if (event_128045 != NULL) {
        event_128045->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128034_total", strdup("nothing further"), event_128045, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_119034 = 0.0;
    }
    
    double eta_p_123678;
    double eta_p_123679;
    
    for (int32_t i_123681 = 0; i_123681 < nsubtasks_123638; i_123681++) {
        flat_tid_119037 = i_123681;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_123678 = defunc_res_119034;
            }
            // load next params
            {
                eta_p_123679 = ((double *) reduce_stage_1_tid_res_arr_mem_123639)[flat_tid_119037];
            }
            // red body
            {
                double zp_res_123680 = eta_p_123678 + eta_p_123679;
                
                defunc_res_119034 = zp_res_123680;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_123639);
    }
    if (event_128046 != NULL) {
        event_128046->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_128031", strdup("nothing further"), event_128046, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128023->retval_defunc_res_119034 = defunc_res_119034;
        futhark_mc_task_128023->retval_mem_111995 = mem_111995.mem;
        futhark_mc_task_128023->retval_mem_111997 = mem_111997.mem;
    }
    return err;
}
struct futhark_mc_task_128047 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_111995;
    unsigned char *free_mem_111999;
};
struct futhark_mc_segmap_parloop_struct_128049 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_111995;
    unsigned char *free_mem_111999;
};
static int futhark_mc_segmap_parloop_128050(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_128049 *futhark_mc_segmap_parloop_struct_128049 = (struct futhark_mc_segmap_parloop_struct_128049 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_128049->ctx;
    struct mc_event *event_128051 = mc_event_new(ctx);
    
    if (event_128051 != NULL)
        event_128051->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_128049->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segmap_parloop_struct_128049->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segmap_parloop_struct_128049->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_111995 = {.desc ="mem_111995", .mem =futhark_mc_segmap_parloop_struct_128049->free_mem_111995, .size =0, .references =NULL};
    struct memblock mem_111999 = {.desc ="mem_111999", .mem =futhark_mc_segmap_parloop_struct_128049->free_mem_111999, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_119100;
    
    flat_tid_119100 = subtask_id;
    {
        int64_t start_123690;
        int64_t end_123691;
        
        start_123690 = start;
        end_123691 = end;
        
        int64_t n_123692 = end_123691 - start_123690;
        
        for (int64_t SegMap_i_123693 = start_123690; SegMap_i_123693 < start_123690 + n_123692; SegMap_i_123693++) {
            int64_t slice_123694 = m_33388;
            int64_t gtid_119101 = SegMap_i_123693;
            int64_t remnant_123695 = SegMap_i_123693 - gtid_119101;
            double defunc_0_reduce_res_119102;
            double redout_123684 = 0.0;
            
            for (int64_t i_123683 = 0; i_123683 < m_33388; i_123683++) {
                double eta_p_123685 = ((double *) A_mem_111707.mem)[lifted_lambda_res_106391 * (m_33388 * m_33388) + gtid_119101 * m_33388 + i_123683];
                double eta_p_123686 = ((double *) mem_111995.mem)[i_123683];
                double zt_res_123687 = eta_p_123685 * eta_p_123685;
                double zt_res_123688 = eta_p_123686 * zt_res_123687;
                double zp_res_123689 = zt_res_123688 + redout_123684;
                double redout_tmp_123696 = zp_res_123689;
                
                redout_123684 = redout_tmp_123696;
            }
            defunc_0_reduce_res_119102 = redout_123684;
            ((double *) mem_111999.mem)[gtid_119101] = defunc_0_reduce_res_119102;
        }
    }
    
  cleanup:
    { }
    if (event_128051 != NULL) {
        event_128051->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128050", strdup("nothing further"), event_128051, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_task_128048(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128047 *futhark_mc_task_128047 = (struct futhark_mc_task_128047 *) args;
    struct futhark_context *ctx = futhark_mc_task_128047->ctx;
    struct mc_event *event_128053 = mc_event_new(ctx);
    
    if (event_128053 != NULL)
        event_128053->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128047->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128047->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_128047->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_111995 = {.desc ="mem_111995", .mem =futhark_mc_task_128047->free_mem_111995, .size =0, .references =NULL};
    struct memblock mem_111999 = {.desc ="mem_111999", .mem =futhark_mc_task_128047->free_mem_111999, .size =0, .references =NULL};
    int32_t nsubtasks_123682;
    
    nsubtasks_123682 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_128049 futhark_mc_segmap_parloop_struct_128049_;
    
    futhark_mc_segmap_parloop_struct_128049_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_128049_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_128049_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segmap_parloop_struct_128049_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segmap_parloop_struct_128049_.free_mem_111995 = mem_111995.mem;
    futhark_mc_segmap_parloop_struct_128049_.free_mem_111999 = mem_111999.mem;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_128050_task;
    
    futhark_mc_segmap_parloop_128050_task.name = "futhark_mc_segmap_parloop_128050";
    futhark_mc_segmap_parloop_128050_task.fn = futhark_mc_segmap_parloop_128050;
    futhark_mc_segmap_parloop_128050_task.args = &futhark_mc_segmap_parloop_struct_128049_;
    futhark_mc_segmap_parloop_128050_task.iterations = iterations;
    futhark_mc_segmap_parloop_128050_task.info = info;
    
    struct mc_event *event_128052 = mc_event_new(ctx);
    
    if (event_128052 != NULL)
        event_128052->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_128050_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_128050_task);
    
    if (futhark_mc_segmap_parloop_128050_err != 0) {
        err = futhark_mc_segmap_parloop_128050_err;
        goto cleanup;
    }
    if (event_128052 != NULL) {
        event_128052->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128050_total", strdup("nothing further"), event_128052, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_128053 != NULL) {
        event_128053->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_task_128048", strdup("nothing further"), event_128053, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_segmap_parloop_struct_128055 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_111995;
    unsigned char *free_mem_111999;
};
struct futhark_mc_task_128057 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_111995;
    int64_t free_gtid_119089;
    int64_t free_flat_tid_123698;
    double *retval_defunc_0_reduce_res_119090;
};
struct futhark_mc_segred_stage_1_parloop_struct_128060 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_111995;
    int64_t free_gtid_119089;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123714;
};
static int futhark_mc_segred_stage_1_parloop_128061(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128060 *futhark_mc_segred_stage_1_parloop_struct_128060 = (struct futhark_mc_segred_stage_1_parloop_struct_128060 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128060->ctx;
    struct mc_event *event_128062 = mc_event_new(ctx);
    
    if (event_128062 != NULL)
        event_128062->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128060->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128060->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_128060->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_111995 = {.desc ="mem_111995", .mem =futhark_mc_segred_stage_1_parloop_struct_128060->free_mem_111995, .size =0, .references =NULL};
    int64_t gtid_119089 = futhark_mc_segred_stage_1_parloop_struct_128060->free_gtid_119089;
    struct memblock reduce_stage_1_tid_res_arr_mem_123714 = {.desc ="reduce_stage_1_tid_res_arr_mem_123714", .mem =futhark_mc_segred_stage_1_parloop_struct_128060->free_reduce_stage_1_tid_res_arr_mem_123714, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_123698;
    
    flat_tid_123698 = subtask_id;
    {
        double eta_p_123716;
        double eta_p_123717;
        double local_acc_123719 = 0.0;
        double eta_p_123700;
        double eta_p_123701;
        double local_acc_123720 = 0.0;
        int64_t start_123721;
        int64_t end_123722;
        
        start_123721 = start;
        end_123722 = end;
        
        int64_t n_123723 = end_123722 - start_123721;
        
        for (int64_t SegRed_i_123724 = start_123721; SegRed_i_123724 < start_123721 + n_123723; SegRed_i_123724++) {
            int64_t gtid_123699 = SegRed_i_123724;
            double eta_p_123703 = ((double *) A_mem_111707.mem)[lifted_lambda_res_106391 * (m_33388 * m_33388) + gtid_119089 * m_33388 + gtid_123699];
            double eta_p_123704 = ((double *) mem_111995.mem)[gtid_123699];
            double zt_res_123705 = eta_p_123703 * eta_p_123703;
            double zt_res_123706 = eta_p_123704 * zt_res_123705;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_123700 = local_acc_123720;
            }
            // Load next params
            {
                eta_p_123701 = zt_res_123706;
            }
            // SegRed body
            {
                double zp_res_123702 = eta_p_123700 + eta_p_123701;
                
                local_acc_123720 = zp_res_123702;
            }
        }
        
        int64_t uni_i_123725 = 0;
        
        {
            int64_t gtid_123699 = uni_i_123725;
            
            // Load accum params
            {
                eta_p_123716 = local_acc_123719;
            }
            // Load next params
            {
                eta_p_123717 = local_acc_123720;
            }
            // SegRed body
            {
                double zp_res_123718 = eta_p_123716 + eta_p_123717;
                
                local_acc_123719 = zp_res_123718;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_123714.mem)[flat_tid_123698] = local_acc_123719;
    }
    
  cleanup:
    { }
    if (event_128062 != NULL) {
        event_128062->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128061", strdup("nothing further"), event_128062, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128058(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128057 *futhark_mc_task_128057 = (struct futhark_mc_task_128057 *) args;
    struct futhark_context *ctx = futhark_mc_task_128057->ctx;
    struct mc_event *event_128064 = mc_event_new(ctx);
    
    if (event_128064 != NULL)
        event_128064->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128057->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128057->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_128057->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_111995 = {.desc ="mem_111995", .mem =futhark_mc_task_128057->free_mem_111995, .size =0, .references =NULL};
    int64_t gtid_119089 = futhark_mc_task_128057->free_gtid_119089;
    int64_t flat_tid_123698 = futhark_mc_task_128057->free_flat_tid_123698;
    double defunc_0_reduce_res_119090 = *futhark_mc_task_128057->retval_defunc_0_reduce_res_119090;
    int64_t reduce_stage_1_tid_res_arr_mem_123714_cached_sizze_128059 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123714 = NULL;
    int32_t nsubtasks_123713;
    
    nsubtasks_123713 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_123714_cached_sizze_128059 < (int64_t) 8 * nsubtasks_123713) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123714, &reduce_stage_1_tid_res_arr_mem_123714_cached_sizze_128059, (int64_t) 8 * nsubtasks_123713);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128060 futhark_mc_segred_stage_1_parloop_struct_128060_;
    
    futhark_mc_segred_stage_1_parloop_struct_128060_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128060_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128060_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128060_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_128060_.free_mem_111995 = mem_111995.mem;
    futhark_mc_segred_stage_1_parloop_struct_128060_.free_gtid_119089 = gtid_119089;
    futhark_mc_segred_stage_1_parloop_struct_128060_.free_reduce_stage_1_tid_res_arr_mem_123714 = reduce_stage_1_tid_res_arr_mem_123714;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128061_task;
    
    futhark_mc_segred_stage_1_parloop_128061_task.name = "futhark_mc_segred_stage_1_parloop_128061";
    futhark_mc_segred_stage_1_parloop_128061_task.fn = futhark_mc_segred_stage_1_parloop_128061;
    futhark_mc_segred_stage_1_parloop_128061_task.args = &futhark_mc_segred_stage_1_parloop_struct_128060_;
    futhark_mc_segred_stage_1_parloop_128061_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128061_task.info = info;
    
    struct mc_event *event_128063 = mc_event_new(ctx);
    
    if (event_128063 != NULL)
        event_128063->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128061_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128061_task);
    
    if (futhark_mc_segred_stage_1_parloop_128061_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128061_err;
        goto cleanup;
    }
    if (event_128063 != NULL) {
        event_128063->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128061_total", strdup("nothing further"), event_128063, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_119090 = 0.0;
    }
    
    double eta_p_123726;
    double eta_p_123727;
    
    for (int32_t i_123729 = 0; i_123729 < nsubtasks_123713; i_123729++) {
        flat_tid_123698 = i_123729;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_123726 = defunc_0_reduce_res_119090;
            }
            // load next params
            {
                eta_p_123727 = ((double *) reduce_stage_1_tid_res_arr_mem_123714)[flat_tid_123698];
            }
            // red body
            {
                double zp_res_123728 = eta_p_123726 + eta_p_123727;
                
                defunc_0_reduce_res_119090 = zp_res_123728;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_123714);
    }
    if (event_128064 != NULL) {
        event_128064->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128058", strdup("nothing further"), event_128064, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128057->retval_defunc_0_reduce_res_119090 = defunc_0_reduce_res_119090;
    }
    return err;
}
static int futhark_mc_segmap_parloop_128056(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_128055 *futhark_mc_segmap_parloop_struct_128055 = (struct futhark_mc_segmap_parloop_struct_128055 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_128055->ctx;
    struct mc_event *event_128065 = mc_event_new(ctx);
    
    if (event_128065 != NULL)
        event_128065->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_128055->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segmap_parloop_struct_128055->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segmap_parloop_struct_128055->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_111995 = {.desc ="mem_111995", .mem =futhark_mc_segmap_parloop_struct_128055->free_mem_111995, .size =0, .references =NULL};
    struct memblock mem_111999 = {.desc ="mem_111999", .mem =futhark_mc_segmap_parloop_struct_128055->free_mem_111999, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_119088;
    
    flat_tid_119088 = subtask_id;
    {
        int64_t start_123707;
        int64_t end_123708;
        
        start_123707 = start;
        end_123708 = end;
        
        int64_t n_123709 = end_123708 - start_123707;
        
        for (int64_t SegMap_i_123710 = start_123707; SegMap_i_123710 < start_123707 + n_123709; SegMap_i_123710++) {
            int64_t slice_123711 = m_33388;
            int64_t gtid_119089 = SegMap_i_123710;
            int64_t remnant_123712 = SegMap_i_123710 - gtid_119089;
            double defunc_0_reduce_res_119090;
            int64_t flat_tid_123698 = (int64_t) 0;
            
            defunc_0_reduce_res_119090 = 0.0;
            
            struct futhark_mc_task_128057 futhark_mc_task_128057_;
            
            futhark_mc_task_128057_.ctx = ctx;
            futhark_mc_task_128057_.free_m_33388 = m_33388;
            futhark_mc_task_128057_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
            futhark_mc_task_128057_.free_A_mem_111707 = A_mem_111707.mem;
            futhark_mc_task_128057_.free_mem_111995 = mem_111995.mem;
            futhark_mc_task_128057_.free_gtid_119089 = gtid_119089;
            futhark_mc_task_128057_.free_flat_tid_123698 = flat_tid_123698;
            futhark_mc_task_128057_.retval_defunc_0_reduce_res_119090 = (double *) &defunc_0_reduce_res_119090;
            #if ISPC
            futhark_mc_task_128057_.retval_defunc_0_reduce_res_119090 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_128057_task;
            
            futhark_mc_task_128057_task.args = &futhark_mc_task_128057_;
            futhark_mc_task_128057_task.top_level_fn = futhark_mc_segred_task_128058;
            futhark_mc_task_128057_task.name = "futhark_mc_segred_task_128058";
            futhark_mc_task_128057_task.iterations = m_33388;
            futhark_mc_task_128057_task.task_time = &ctx->program->futhark_mc_segred_task_128058_total_time;
            futhark_mc_task_128057_task.task_iter = &ctx->program->futhark_mc_segred_task_128058_total_iter;
            futhark_mc_task_128057_task.sched = STATIC;
            futhark_mc_task_128057_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_128058_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128057_task);
            
            if (futhark_mc_segred_task_128058_err != 0) {
                err = futhark_mc_segred_task_128058_err;
                goto cleanup;
            }
            ((double *) mem_111999.mem)[gtid_119089] = defunc_0_reduce_res_119090;
        }
    }
    
  cleanup:
    { }
    if (event_128065 != NULL) {
        event_128065->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128056", strdup("nothing further"), event_128065, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_nested_task_128054(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128047 *futhark_mc_task_128047 = (struct futhark_mc_task_128047 *) args;
    struct futhark_context *ctx = futhark_mc_task_128047->ctx;
    struct mc_event *event_128067 = mc_event_new(ctx);
    
    if (event_128067 != NULL)
        event_128067->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128047->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128047->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_128047->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_111995 = {.desc ="mem_111995", .mem =futhark_mc_task_128047->free_mem_111995, .size =0, .references =NULL};
    struct memblock mem_111999 = {.desc ="mem_111999", .mem =futhark_mc_task_128047->free_mem_111999, .size =0, .references =NULL};
    int32_t nsubtasks_123697;
    
    nsubtasks_123697 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_128055 futhark_mc_segmap_parloop_struct_128055_;
    
    futhark_mc_segmap_parloop_struct_128055_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_128055_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_128055_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segmap_parloop_struct_128055_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segmap_parloop_struct_128055_.free_mem_111995 = mem_111995.mem;
    futhark_mc_segmap_parloop_struct_128055_.free_mem_111999 = mem_111999.mem;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_128056_task;
    
    futhark_mc_segmap_parloop_128056_task.name = "futhark_mc_segmap_parloop_128056";
    futhark_mc_segmap_parloop_128056_task.fn = futhark_mc_segmap_parloop_128056;
    futhark_mc_segmap_parloop_128056_task.args = &futhark_mc_segmap_parloop_struct_128055_;
    futhark_mc_segmap_parloop_128056_task.iterations = iterations;
    futhark_mc_segmap_parloop_128056_task.info = info;
    
    struct mc_event *event_128066 = mc_event_new(ctx);
    
    if (event_128066 != NULL)
        event_128066->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_128056_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_128056_task);
    
    if (futhark_mc_segmap_parloop_128056_err != 0) {
        err = futhark_mc_segmap_parloop_128056_err;
        goto cleanup;
    }
    if (event_128066 != NULL) {
        event_128066->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128056_total", strdup("nothing further"), event_128066, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_128067 != NULL) {
        event_128067->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_nested_task_128054", strdup("nothing further"), event_128067, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_128068 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_neg_res_43882;
    int64_t free_eta_p_106382;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_distrs_mem_111708;
    int64_t free_bytes_111715;
    unsigned char *free_mem_111727;
    unsigned char *free_mem_111993;
    unsigned char *free_mem_111997;
    unsigned char *free_mem_111999;
    unsigned char *free_mem_112032;
    unsigned char *free_mem_112034;
    unsigned char *free_mem_param_118926;
    unsigned char *free_mem_param_118927;
    unsigned char *free_mem_param_118928;
    double free_defunc_res_118937;
    double free_zt_res_119033;
    double free_zp_res_119086;
};
struct futhark_mc_segmap_parloop_struct_128070 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_neg_res_43882;
    int64_t free_eta_p_106382;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_distrs_mem_111708;
    int64_t free_bytes_111715;
    unsigned char *free_mem_111727;
    unsigned char *free_mem_111993;
    unsigned char *free_mem_111997;
    unsigned char *free_mem_111999;
    unsigned char *free_mem_112032;
    unsigned char *free_mem_112034;
    unsigned char *free_mem_param_118926;
    unsigned char *free_mem_param_118927;
    unsigned char *free_mem_param_118928;
    double free_defunc_res_118937;
    double free_zt_res_119033;
    double free_zp_res_119086;
};
static int futhark_mc_segmap_parloop_128071(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_128070 *futhark_mc_segmap_parloop_struct_128070 = (struct futhark_mc_segmap_parloop_struct_128070 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_128070->ctx;
    struct mc_event *event_128074 = mc_event_new(ctx);
    
    if (event_128074 != NULL)
        event_128074->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_128070->free_m_33388;
    double neg_res_43882 = futhark_mc_segmap_parloop_struct_128070->free_neg_res_43882;
    int64_t eta_p_106382 = futhark_mc_segmap_parloop_struct_128070->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_segmap_parloop_struct_128070->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segmap_parloop_struct_128070->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segmap_parloop_struct_128070->free_distrs_mem_111708, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_segmap_parloop_struct_128070->free_bytes_111715;
    struct memblock mem_111727 = {.desc ="mem_111727", .mem =futhark_mc_segmap_parloop_struct_128070->free_mem_111727, .size =0, .references =NULL};
    struct memblock mem_111993 = {.desc ="mem_111993", .mem =futhark_mc_segmap_parloop_struct_128070->free_mem_111993, .size =0, .references =NULL};
    struct memblock mem_111997 = {.desc ="mem_111997", .mem =futhark_mc_segmap_parloop_struct_128070->free_mem_111997, .size =0, .references =NULL};
    struct memblock mem_111999 = {.desc ="mem_111999", .mem =futhark_mc_segmap_parloop_struct_128070->free_mem_111999, .size =0, .references =NULL};
    struct memblock mem_112032 = {.desc ="mem_112032", .mem =futhark_mc_segmap_parloop_struct_128070->free_mem_112032, .size =0, .references =NULL};
    struct memblock mem_112034 = {.desc ="mem_112034", .mem =futhark_mc_segmap_parloop_struct_128070->free_mem_112034, .size =0, .references =NULL};
    struct memblock mem_param_118926 = {.desc ="mem_param_118926", .mem =futhark_mc_segmap_parloop_struct_128070->free_mem_param_118926, .size =0, .references =NULL};
    struct memblock mem_param_118927 = {.desc ="mem_param_118927", .mem =futhark_mc_segmap_parloop_struct_128070->free_mem_param_118927, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_segmap_parloop_struct_128070->free_mem_param_118928, .size =0, .references =NULL};
    double defunc_res_118937 = futhark_mc_segmap_parloop_struct_128070->free_defunc_res_118937;
    double zt_res_119033 = futhark_mc_segmap_parloop_struct_128070->free_zt_res_119033;
    double zp_res_119086 = futhark_mc_segmap_parloop_struct_128070->free_zp_res_119086;
    int64_t iterations = end - start;
    int64_t mem_119225_cached_sizze_128072 = 0;
    unsigned char *mem_119225 = NULL;
    int64_t mem_119238_cached_sizze_128073 = 0;
    unsigned char *mem_119238 = NULL;
    int64_t flat_tid_119211;
    
    flat_tid_119211 = subtask_id;
    {
        int64_t start_123779;
        int64_t end_123780;
        
        start_123779 = start;
        end_123780 = end;
        
        int64_t n_123781 = end_123780 - start_123779;
        
        if (mem_119225_cached_sizze_128072 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_119225, &mem_119225_cached_sizze_128072, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_119238_cached_sizze_128073 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_119238, &mem_119238_cached_sizze_128073, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        for (int64_t SegMap_i_123782 = start_123779; SegMap_i_123782 < start_123779 + n_123781; SegMap_i_123782++) {
            int64_t slice_123783 = m_33388;
            int64_t gtid_119212 = SegMap_i_123782;
            int64_t remnant_123784 = SegMap_i_123782 - gtid_119212;
            double eta_p_119213 = ((double *) distrs_mem_111708.mem)[eta_p_106382 * m_33388 + gtid_119212];
            double eta_p_119214 = ((double *) mem_param_118926.mem)[gtid_119212];
            double log_res_119215 = futrts_log64(eta_p_119213);
            double zt_res_119216 = zt_res_119033 * log_res_119215;
            double defunc_0_reduce_res_119217;
            double redout_123732 = 0.0;
            
            for (int64_t i_123731 = 0; i_123731 < m_33388; i_123731++) {
                double eta_p_123733 = ((double *) A_mem_111707.mem)[eta_p_106382 * (m_33388 * m_33388) + gtid_119212 * m_33388 + i_123731];
                double eta_p_123734 = ((double *) mem_111993.mem)[i_123731];
                double zt_res_123735 = eta_p_123733 * eta_p_123733;
                double zt_res_123736 = eta_p_123734 * zt_res_123735;
                double zp_res_123737 = zt_res_123736 + redout_123732;
                double redout_tmp_123785 = zp_res_123737;
                
                redout_123732 = redout_tmp_123785;
            }
            defunc_0_reduce_res_119217 = redout_123732;
            for (int64_t i_123738 = 0; i_123738 < m_33388; i_123738++) {
                double defunc_0_reduce_res_123740;
                double redout_123742 = 0.0;
                
                for (int64_t i_123741 = 0; i_123741 < m_33388; i_123741++) {
                    double eta_p_123743 = ((double *) A_mem_111707.mem)[eta_p_106382 * (m_33388 * m_33388) + gtid_119212 * m_33388 + i_123741];
                    double eta_p_123744 = ((double *) mem_param_118928.mem)[i_123741 * m_33388 + i_123738];
                    double zt_res_123745 = eta_p_123743 * eta_p_123744;
                    double zp_res_123746 = zt_res_123745 + redout_123742;
                    double redout_tmp_123787 = zp_res_123746;
                    
                    redout_123742 = redout_tmp_123787;
                }
                defunc_0_reduce_res_123740 = redout_123742;
                ((double *) mem_119225)[i_123738] = defunc_0_reduce_res_123740;
            }
            
            double defunc_0_reduce_res_119240;
            double redout_123749 = INFINITY;
            
            for (int64_t i_123748 = 0; i_123748 < m_33388; i_123748++) {
                double eta_p_wasfree_123751 = ((double *) mem_111999.mem)[i_123748];
                double eta_p_wasfree_123752 = ((double *) mem_111997.mem)[i_123748];
                double eta_p_wasfree_123753 = ((double *) mem_param_118927.mem)[i_123748];
                double defunc_0_reduce_res_123754;
                double redout_123756 = 0.0;
                
                for (int64_t i_123755 = 0; i_123755 < m_33388; i_123755++) {
                    double eta_p_123757 = ((double *) mem_119225)[i_123755];
                    double eta_p_123758 = ((double *) mem_111727.mem)[lifted_lambda_res_106391 * (m_33388 * m_33388) + i_123755 * m_33388 + i_123748];
                    double zt_res_123759 = eta_p_123757 * eta_p_123758;
                    double zp_res_123760 = zt_res_123759 + redout_123756;
                    double redout_tmp_123790 = zp_res_123760;
                    
                    redout_123756 = redout_tmp_123790;
                }
                defunc_0_reduce_res_123754 = redout_123756;
                
                double zt_res_123761 = -2.0 * defunc_0_reduce_res_123754;
                double zp_res_123762 = defunc_0_reduce_res_119217 + zt_res_123761;
                double zp_res_123763 = eta_p_wasfree_123751 + zp_res_123762;
                double zp_res_123764 = zp_res_119086 + zp_res_123763;
                double zm_res_123765 = zp_res_123764 - zt_res_119216;
                double zm_res_123766 = zm_res_123765 - eta_p_wasfree_123752;
                double zs_res_123767 = zm_res_123766 / defunc_res_118937;
                double zs_res_123768 = zs_res_123767 / neg_res_43882;
                double zp_res_123769 = eta_p_119214 + zs_res_123768;
                double zp_res_123770 = eta_p_wasfree_123753 + zp_res_123769;
                double zm_res_123771 = 30.0 - zp_res_123770;
                double min_res_123772 = fmin64(zm_res_123771, redout_123749);
                
                ((double *) mem_119238)[i_123748] = zp_res_123770;
                
                double redout_tmp_123788 = min_res_123772;
                
                redout_123749 = redout_tmp_123788;
            }
            defunc_0_reduce_res_119240 = redout_123749;
            for (int64_t i_123774 = 0; i_123774 < m_33388; i_123774++) {
                double eta_p_123776 = ((double *) mem_119238)[i_123774];
                double zp_res_123777 = defunc_0_reduce_res_119240 + eta_p_123776;
                
                ((double *) mem_112032.mem)[gtid_119212 * m_33388 + i_123774] = zp_res_123777;
            }
            ((double *) mem_112034.mem)[gtid_119212] = defunc_0_reduce_res_119240;
        }
    }
    
  cleanup:
    {
        free(mem_119225);
        free(mem_119238);
    }
    if (event_128074 != NULL) {
        event_128074->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128071", strdup("nothing further"), event_128074, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_task_128069(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128068 *futhark_mc_task_128068 = (struct futhark_mc_task_128068 *) args;
    struct futhark_context *ctx = futhark_mc_task_128068->ctx;
    struct mc_event *event_128076 = mc_event_new(ctx);
    
    if (event_128076 != NULL)
        event_128076->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128068->free_m_33388;
    double neg_res_43882 = futhark_mc_task_128068->free_neg_res_43882;
    int64_t eta_p_106382 = futhark_mc_task_128068->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128068->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_128068->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128068->free_distrs_mem_111708, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_task_128068->free_bytes_111715;
    struct memblock mem_111727 = {.desc ="mem_111727", .mem =futhark_mc_task_128068->free_mem_111727, .size =0, .references =NULL};
    struct memblock mem_111993 = {.desc ="mem_111993", .mem =futhark_mc_task_128068->free_mem_111993, .size =0, .references =NULL};
    struct memblock mem_111997 = {.desc ="mem_111997", .mem =futhark_mc_task_128068->free_mem_111997, .size =0, .references =NULL};
    struct memblock mem_111999 = {.desc ="mem_111999", .mem =futhark_mc_task_128068->free_mem_111999, .size =0, .references =NULL};
    struct memblock mem_112032 = {.desc ="mem_112032", .mem =futhark_mc_task_128068->free_mem_112032, .size =0, .references =NULL};
    struct memblock mem_112034 = {.desc ="mem_112034", .mem =futhark_mc_task_128068->free_mem_112034, .size =0, .references =NULL};
    struct memblock mem_param_118926 = {.desc ="mem_param_118926", .mem =futhark_mc_task_128068->free_mem_param_118926, .size =0, .references =NULL};
    struct memblock mem_param_118927 = {.desc ="mem_param_118927", .mem =futhark_mc_task_128068->free_mem_param_118927, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_task_128068->free_mem_param_118928, .size =0, .references =NULL};
    double defunc_res_118937 = futhark_mc_task_128068->free_defunc_res_118937;
    double zt_res_119033 = futhark_mc_task_128068->free_zt_res_119033;
    double zp_res_119086 = futhark_mc_task_128068->free_zp_res_119086;
    int32_t nsubtasks_123730;
    
    nsubtasks_123730 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_128070 futhark_mc_segmap_parloop_struct_128070_;
    
    futhark_mc_segmap_parloop_struct_128070_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_128070_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_128070_.free_neg_res_43882 = neg_res_43882;
    futhark_mc_segmap_parloop_struct_128070_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segmap_parloop_struct_128070_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segmap_parloop_struct_128070_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segmap_parloop_struct_128070_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segmap_parloop_struct_128070_.free_bytes_111715 = bytes_111715;
    futhark_mc_segmap_parloop_struct_128070_.free_mem_111727 = mem_111727.mem;
    futhark_mc_segmap_parloop_struct_128070_.free_mem_111993 = mem_111993.mem;
    futhark_mc_segmap_parloop_struct_128070_.free_mem_111997 = mem_111997.mem;
    futhark_mc_segmap_parloop_struct_128070_.free_mem_111999 = mem_111999.mem;
    futhark_mc_segmap_parloop_struct_128070_.free_mem_112032 = mem_112032.mem;
    futhark_mc_segmap_parloop_struct_128070_.free_mem_112034 = mem_112034.mem;
    futhark_mc_segmap_parloop_struct_128070_.free_mem_param_118926 = mem_param_118926.mem;
    futhark_mc_segmap_parloop_struct_128070_.free_mem_param_118927 = mem_param_118927.mem;
    futhark_mc_segmap_parloop_struct_128070_.free_mem_param_118928 = mem_param_118928.mem;
    futhark_mc_segmap_parloop_struct_128070_.free_defunc_res_118937 = defunc_res_118937;
    futhark_mc_segmap_parloop_struct_128070_.free_zt_res_119033 = zt_res_119033;
    futhark_mc_segmap_parloop_struct_128070_.free_zp_res_119086 = zp_res_119086;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_128071_task;
    
    futhark_mc_segmap_parloop_128071_task.name = "futhark_mc_segmap_parloop_128071";
    futhark_mc_segmap_parloop_128071_task.fn = futhark_mc_segmap_parloop_128071;
    futhark_mc_segmap_parloop_128071_task.args = &futhark_mc_segmap_parloop_struct_128070_;
    futhark_mc_segmap_parloop_128071_task.iterations = iterations;
    futhark_mc_segmap_parloop_128071_task.info = info;
    
    struct mc_event *event_128075 = mc_event_new(ctx);
    
    if (event_128075 != NULL)
        event_128075->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_128071_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_128071_task);
    
    if (futhark_mc_segmap_parloop_128071_err != 0) {
        err = futhark_mc_segmap_parloop_128071_err;
        goto cleanup;
    }
    if (event_128075 != NULL) {
        event_128075->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128071_total", strdup("nothing further"), event_128075, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_128076 != NULL) {
        event_128076->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_task_128069", strdup("nothing further"), event_128076, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_segmap_parloop_struct_128078 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_neg_res_43882;
    int64_t free_eta_p_106382;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_distrs_mem_111708;
    int64_t free_bytes_111715;
    unsigned char *free_mem_111727;
    unsigned char *free_mem_111993;
    unsigned char *free_mem_111997;
    unsigned char *free_mem_111999;
    unsigned char *free_mem_112032;
    unsigned char *free_mem_112034;
    unsigned char *free_mem_param_118926;
    unsigned char *free_mem_param_118927;
    unsigned char *free_mem_param_118928;
    double free_defunc_res_118937;
    double free_zt_res_119033;
    double free_zp_res_119086;
};
struct futhark_mc_task_128081 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_111993;
    int64_t free_gtid_119113;
    int64_t free_flat_tid_123793;
    double *retval_defunc_0_reduce_res_119118;
};
struct futhark_mc_segred_stage_1_parloop_struct_128084 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_111993;
    int64_t free_gtid_119113;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123887;
};
static int futhark_mc_segred_stage_1_parloop_128085(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128084 *futhark_mc_segred_stage_1_parloop_struct_128084 = (struct futhark_mc_segred_stage_1_parloop_struct_128084 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128084->ctx;
    struct mc_event *event_128086 = mc_event_new(ctx);
    
    if (event_128086 != NULL)
        event_128086->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128084->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_128084->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_128084->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_111993 = {.desc ="mem_111993", .mem =futhark_mc_segred_stage_1_parloop_struct_128084->free_mem_111993, .size =0, .references =NULL};
    int64_t gtid_119113 = futhark_mc_segred_stage_1_parloop_struct_128084->free_gtid_119113;
    struct memblock reduce_stage_1_tid_res_arr_mem_123887 = {.desc ="reduce_stage_1_tid_res_arr_mem_123887", .mem =futhark_mc_segred_stage_1_parloop_struct_128084->free_reduce_stage_1_tid_res_arr_mem_123887, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_123793;
    
    flat_tid_123793 = subtask_id;
    {
        double eta_p_123889;
        double eta_p_123890;
        double local_acc_123892 = 0.0;
        double eta_p_123795;
        double eta_p_123796;
        double local_acc_123893 = 0.0;
        int64_t start_123894;
        int64_t end_123895;
        
        start_123894 = start;
        end_123895 = end;
        
        int64_t n_123896 = end_123895 - start_123894;
        
        for (int64_t SegRed_i_123897 = start_123894; SegRed_i_123897 < start_123894 + n_123896; SegRed_i_123897++) {
            int64_t gtid_123794 = SegRed_i_123897;
            double eta_p_123798 = ((double *) A_mem_111707.mem)[eta_p_106382 * (m_33388 * m_33388) + gtid_119113 * m_33388 + gtid_123794];
            double eta_p_123799 = ((double *) mem_111993.mem)[gtid_123794];
            double zt_res_123800 = eta_p_123798 * eta_p_123798;
            double zt_res_123801 = eta_p_123799 * zt_res_123800;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_123795 = local_acc_123893;
            }
            // Load next params
            {
                eta_p_123796 = zt_res_123801;
            }
            // SegRed body
            {
                double zp_res_123797 = eta_p_123795 + eta_p_123796;
                
                local_acc_123893 = zp_res_123797;
            }
        }
        
        int64_t uni_i_123898 = 0;
        
        {
            int64_t gtid_123794 = uni_i_123898;
            
            // Load accum params
            {
                eta_p_123889 = local_acc_123892;
            }
            // Load next params
            {
                eta_p_123890 = local_acc_123893;
            }
            // SegRed body
            {
                double zp_res_123891 = eta_p_123889 + eta_p_123890;
                
                local_acc_123892 = zp_res_123891;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_123887.mem)[flat_tid_123793] = local_acc_123892;
    }
    
  cleanup:
    { }
    if (event_128086 != NULL) {
        event_128086->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128085", strdup("nothing further"), event_128086, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128082(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128081 *futhark_mc_task_128081 = (struct futhark_mc_task_128081 *) args;
    struct futhark_context *ctx = futhark_mc_task_128081->ctx;
    struct mc_event *event_128088 = mc_event_new(ctx);
    
    if (event_128088 != NULL)
        event_128088->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128081->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_128081->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_128081->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_111993 = {.desc ="mem_111993", .mem =futhark_mc_task_128081->free_mem_111993, .size =0, .references =NULL};
    int64_t gtid_119113 = futhark_mc_task_128081->free_gtid_119113;
    int64_t flat_tid_123793 = futhark_mc_task_128081->free_flat_tid_123793;
    double defunc_0_reduce_res_119118 = *futhark_mc_task_128081->retval_defunc_0_reduce_res_119118;
    int64_t reduce_stage_1_tid_res_arr_mem_123887_cached_sizze_128083 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123887 = NULL;
    int32_t nsubtasks_123886;
    
    nsubtasks_123886 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_123887_cached_sizze_128083 < (int64_t) 8 * nsubtasks_123886) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123887, &reduce_stage_1_tid_res_arr_mem_123887_cached_sizze_128083, (int64_t) 8 * nsubtasks_123886);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128084 futhark_mc_segred_stage_1_parloop_struct_128084_;
    
    futhark_mc_segred_stage_1_parloop_struct_128084_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128084_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128084_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_128084_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_128084_.free_mem_111993 = mem_111993.mem;
    futhark_mc_segred_stage_1_parloop_struct_128084_.free_gtid_119113 = gtid_119113;
    futhark_mc_segred_stage_1_parloop_struct_128084_.free_reduce_stage_1_tid_res_arr_mem_123887 = reduce_stage_1_tid_res_arr_mem_123887;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128085_task;
    
    futhark_mc_segred_stage_1_parloop_128085_task.name = "futhark_mc_segred_stage_1_parloop_128085";
    futhark_mc_segred_stage_1_parloop_128085_task.fn = futhark_mc_segred_stage_1_parloop_128085;
    futhark_mc_segred_stage_1_parloop_128085_task.args = &futhark_mc_segred_stage_1_parloop_struct_128084_;
    futhark_mc_segred_stage_1_parloop_128085_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128085_task.info = info;
    
    struct mc_event *event_128087 = mc_event_new(ctx);
    
    if (event_128087 != NULL)
        event_128087->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128085_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128085_task);
    
    if (futhark_mc_segred_stage_1_parloop_128085_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128085_err;
        goto cleanup;
    }
    if (event_128087 != NULL) {
        event_128087->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128085_total", strdup("nothing further"), event_128087, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_119118 = 0.0;
    }
    
    double eta_p_123899;
    double eta_p_123900;
    
    for (int32_t i_123902 = 0; i_123902 < nsubtasks_123886; i_123902++) {
        flat_tid_123793 = i_123902;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_123899 = defunc_0_reduce_res_119118;
            }
            // load next params
            {
                eta_p_123900 = ((double *) reduce_stage_1_tid_res_arr_mem_123887)[flat_tid_123793];
            }
            // red body
            {
                double zp_res_123901 = eta_p_123899 + eta_p_123900;
                
                defunc_0_reduce_res_119118 = zp_res_123901;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_123887);
    }
    if (event_128088 != NULL) {
        event_128088->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128082", strdup("nothing further"), event_128088, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128081->retval_defunc_0_reduce_res_119118 = defunc_0_reduce_res_119118;
    }
    return err;
}
struct futhark_mc_task_128089 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_param_118928;
    int64_t free_gtid_119113;
    unsigned char *free_mem_119128;
};
struct futhark_mc_segmap_parloop_struct_128091 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_param_118928;
    int64_t free_gtid_119113;
    unsigned char *free_mem_119128;
};
static int futhark_mc_segmap_parloop_128092(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_128091 *futhark_mc_segmap_parloop_struct_128091 = (struct futhark_mc_segmap_parloop_struct_128091 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_128091->ctx;
    struct mc_event *event_128093 = mc_event_new(ctx);
    
    if (event_128093 != NULL)
        event_128093->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_128091->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segmap_parloop_struct_128091->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segmap_parloop_struct_128091->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_segmap_parloop_struct_128091->free_mem_param_118928, .size =0, .references =NULL};
    int64_t gtid_119113 = futhark_mc_segmap_parloop_struct_128091->free_gtid_119113;
    struct memblock mem_119128 = {.desc ="mem_119128", .mem =futhark_mc_segmap_parloop_struct_128091->free_mem_119128, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_123813;
    
    flat_tid_123813 = subtask_id;
    {
        int64_t start_123910;
        int64_t end_123911;
        
        start_123910 = start;
        end_123911 = end;
        
        int64_t n_123912 = end_123911 - start_123910;
        
        for (int64_t SegMap_i_123913 = start_123910; SegMap_i_123913 < start_123910 + n_123912; SegMap_i_123913++) {
            int64_t slice_123914 = m_33388;
            int64_t gtid_123814 = SegMap_i_123913;
            int64_t remnant_123915 = SegMap_i_123913 - gtid_123814;
            double defunc_0_reduce_res_123815;
            double redout_123905 = 0.0;
            
            for (int64_t i_123904 = 0; i_123904 < m_33388; i_123904++) {
                double eta_p_123906 = ((double *) A_mem_111707.mem)[eta_p_106382 * (m_33388 * m_33388) + gtid_119113 * m_33388 + i_123904];
                double eta_p_123907 = ((double *) mem_param_118928.mem)[i_123904 * m_33388 + gtid_123814];
                double zt_res_123908 = eta_p_123906 * eta_p_123907;
                double zp_res_123909 = zt_res_123908 + redout_123905;
                double redout_tmp_123916 = zp_res_123909;
                
                redout_123905 = redout_tmp_123916;
            }
            defunc_0_reduce_res_123815 = redout_123905;
            ((double *) mem_119128.mem)[gtid_123814] = defunc_0_reduce_res_123815;
        }
    }
    
  cleanup:
    { }
    if (event_128093 != NULL) {
        event_128093->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128092", strdup("nothing further"), event_128093, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_task_128090(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128089 *futhark_mc_task_128089 = (struct futhark_mc_task_128089 *) args;
    struct futhark_context *ctx = futhark_mc_task_128089->ctx;
    struct mc_event *event_128095 = mc_event_new(ctx);
    
    if (event_128095 != NULL)
        event_128095->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128089->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_128089->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_128089->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_task_128089->free_mem_param_118928, .size =0, .references =NULL};
    int64_t gtid_119113 = futhark_mc_task_128089->free_gtid_119113;
    struct memblock mem_119128 = {.desc ="mem_119128", .mem =futhark_mc_task_128089->free_mem_119128, .size =0, .references =NULL};
    int32_t nsubtasks_123903;
    
    nsubtasks_123903 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_128091 futhark_mc_segmap_parloop_struct_128091_;
    
    futhark_mc_segmap_parloop_struct_128091_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_128091_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_128091_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segmap_parloop_struct_128091_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segmap_parloop_struct_128091_.free_mem_param_118928 = mem_param_118928.mem;
    futhark_mc_segmap_parloop_struct_128091_.free_gtid_119113 = gtid_119113;
    futhark_mc_segmap_parloop_struct_128091_.free_mem_119128 = mem_119128.mem;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_128092_task;
    
    futhark_mc_segmap_parloop_128092_task.name = "futhark_mc_segmap_parloop_128092";
    futhark_mc_segmap_parloop_128092_task.fn = futhark_mc_segmap_parloop_128092;
    futhark_mc_segmap_parloop_128092_task.args = &futhark_mc_segmap_parloop_struct_128091_;
    futhark_mc_segmap_parloop_128092_task.iterations = iterations;
    futhark_mc_segmap_parloop_128092_task.info = info;
    
    struct mc_event *event_128094 = mc_event_new(ctx);
    
    if (event_128094 != NULL)
        event_128094->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_128092_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_128092_task);
    
    if (futhark_mc_segmap_parloop_128092_err != 0) {
        err = futhark_mc_segmap_parloop_128092_err;
        goto cleanup;
    }
    if (event_128094 != NULL) {
        event_128094->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128092_total", strdup("nothing further"), event_128094, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_128095 != NULL) {
        event_128095->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_task_128090", strdup("nothing further"), event_128095, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_segmap_parloop_struct_128097 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_param_118928;
    int64_t free_gtid_119113;
    unsigned char *free_mem_119128;
};
struct futhark_mc_task_128099 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_param_118928;
    int64_t free_gtid_119113;
    int64_t free_gtid_123803;
    int64_t free_flat_tid_123918;
    double *retval_defunc_0_reduce_res_123804;
};
struct futhark_mc_segred_stage_1_parloop_struct_128102 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_param_118928;
    int64_t free_gtid_119113;
    int64_t free_gtid_123803;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123933;
};
static int futhark_mc_segred_stage_1_parloop_128103(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128102 *futhark_mc_segred_stage_1_parloop_struct_128102 = (struct futhark_mc_segred_stage_1_parloop_struct_128102 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128102->ctx;
    struct mc_event *event_128104 = mc_event_new(ctx);
    
    if (event_128104 != NULL)
        event_128104->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128102->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_128102->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_128102->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_segred_stage_1_parloop_struct_128102->free_mem_param_118928, .size =0, .references =NULL};
    int64_t gtid_119113 = futhark_mc_segred_stage_1_parloop_struct_128102->free_gtid_119113;
    int64_t gtid_123803 = futhark_mc_segred_stage_1_parloop_struct_128102->free_gtid_123803;
    struct memblock reduce_stage_1_tid_res_arr_mem_123933 = {.desc ="reduce_stage_1_tid_res_arr_mem_123933", .mem =futhark_mc_segred_stage_1_parloop_struct_128102->free_reduce_stage_1_tid_res_arr_mem_123933, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_123918;
    
    flat_tid_123918 = subtask_id;
    {
        double eta_p_123935;
        double eta_p_123936;
        double local_acc_123938 = 0.0;
        double eta_p_123920;
        double eta_p_123921;
        double local_acc_123939 = 0.0;
        int64_t start_123940;
        int64_t end_123941;
        
        start_123940 = start;
        end_123941 = end;
        
        int64_t n_123942 = end_123941 - start_123940;
        
        for (int64_t SegRed_i_123943 = start_123940; SegRed_i_123943 < start_123940 + n_123942; SegRed_i_123943++) {
            int64_t gtid_123919 = SegRed_i_123943;
            double eta_p_123923 = ((double *) A_mem_111707.mem)[eta_p_106382 * (m_33388 * m_33388) + gtid_119113 * m_33388 + gtid_123919];
            double eta_p_123924 = ((double *) mem_param_118928.mem)[gtid_123919 * m_33388 + gtid_123803];
            double zt_res_123925 = eta_p_123923 * eta_p_123924;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_123920 = local_acc_123939;
            }
            // Load next params
            {
                eta_p_123921 = zt_res_123925;
            }
            // SegRed body
            {
                double zp_res_123922 = eta_p_123920 + eta_p_123921;
                
                local_acc_123939 = zp_res_123922;
            }
        }
        
        int64_t uni_i_123944 = 0;
        
        {
            int64_t gtid_123919 = uni_i_123944;
            
            // Load accum params
            {
                eta_p_123935 = local_acc_123938;
            }
            // Load next params
            {
                eta_p_123936 = local_acc_123939;
            }
            // SegRed body
            {
                double zp_res_123937 = eta_p_123935 + eta_p_123936;
                
                local_acc_123938 = zp_res_123937;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_123933.mem)[flat_tid_123918] = local_acc_123938;
    }
    
  cleanup:
    { }
    if (event_128104 != NULL) {
        event_128104->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128103", strdup("nothing further"), event_128104, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128100(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128099 *futhark_mc_task_128099 = (struct futhark_mc_task_128099 *) args;
    struct futhark_context *ctx = futhark_mc_task_128099->ctx;
    struct mc_event *event_128106 = mc_event_new(ctx);
    
    if (event_128106 != NULL)
        event_128106->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128099->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_128099->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_128099->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_task_128099->free_mem_param_118928, .size =0, .references =NULL};
    int64_t gtid_119113 = futhark_mc_task_128099->free_gtid_119113;
    int64_t gtid_123803 = futhark_mc_task_128099->free_gtid_123803;
    int64_t flat_tid_123918 = futhark_mc_task_128099->free_flat_tid_123918;
    double defunc_0_reduce_res_123804 = *futhark_mc_task_128099->retval_defunc_0_reduce_res_123804;
    int64_t reduce_stage_1_tid_res_arr_mem_123933_cached_sizze_128101 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123933 = NULL;
    int32_t nsubtasks_123932;
    
    nsubtasks_123932 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_123933_cached_sizze_128101 < (int64_t) 8 * nsubtasks_123932) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123933, &reduce_stage_1_tid_res_arr_mem_123933_cached_sizze_128101, (int64_t) 8 * nsubtasks_123932);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128102 futhark_mc_segred_stage_1_parloop_struct_128102_;
    
    futhark_mc_segred_stage_1_parloop_struct_128102_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128102_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128102_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_128102_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_128102_.free_mem_param_118928 = mem_param_118928.mem;
    futhark_mc_segred_stage_1_parloop_struct_128102_.free_gtid_119113 = gtid_119113;
    futhark_mc_segred_stage_1_parloop_struct_128102_.free_gtid_123803 = gtid_123803;
    futhark_mc_segred_stage_1_parloop_struct_128102_.free_reduce_stage_1_tid_res_arr_mem_123933 = reduce_stage_1_tid_res_arr_mem_123933;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128103_task;
    
    futhark_mc_segred_stage_1_parloop_128103_task.name = "futhark_mc_segred_stage_1_parloop_128103";
    futhark_mc_segred_stage_1_parloop_128103_task.fn = futhark_mc_segred_stage_1_parloop_128103;
    futhark_mc_segred_stage_1_parloop_128103_task.args = &futhark_mc_segred_stage_1_parloop_struct_128102_;
    futhark_mc_segred_stage_1_parloop_128103_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128103_task.info = info;
    
    struct mc_event *event_128105 = mc_event_new(ctx);
    
    if (event_128105 != NULL)
        event_128105->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128103_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128103_task);
    
    if (futhark_mc_segred_stage_1_parloop_128103_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128103_err;
        goto cleanup;
    }
    if (event_128105 != NULL) {
        event_128105->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128103_total", strdup("nothing further"), event_128105, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_123804 = 0.0;
    }
    
    double eta_p_123945;
    double eta_p_123946;
    
    for (int32_t i_123948 = 0; i_123948 < nsubtasks_123932; i_123948++) {
        flat_tid_123918 = i_123948;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_123945 = defunc_0_reduce_res_123804;
            }
            // load next params
            {
                eta_p_123946 = ((double *) reduce_stage_1_tid_res_arr_mem_123933)[flat_tid_123918];
            }
            // red body
            {
                double zp_res_123947 = eta_p_123945 + eta_p_123946;
                
                defunc_0_reduce_res_123804 = zp_res_123947;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_123933);
    }
    if (event_128106 != NULL) {
        event_128106->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128100", strdup("nothing further"), event_128106, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128099->retval_defunc_0_reduce_res_123804 = defunc_0_reduce_res_123804;
    }
    return err;
}
static int futhark_mc_segmap_parloop_128098(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_128097 *futhark_mc_segmap_parloop_struct_128097 = (struct futhark_mc_segmap_parloop_struct_128097 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_128097->ctx;
    struct mc_event *event_128107 = mc_event_new(ctx);
    
    if (event_128107 != NULL)
        event_128107->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_128097->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segmap_parloop_struct_128097->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segmap_parloop_struct_128097->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_segmap_parloop_struct_128097->free_mem_param_118928, .size =0, .references =NULL};
    int64_t gtid_119113 = futhark_mc_segmap_parloop_struct_128097->free_gtid_119113;
    struct memblock mem_119128 = {.desc ="mem_119128", .mem =futhark_mc_segmap_parloop_struct_128097->free_mem_119128, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_123802;
    
    flat_tid_123802 = subtask_id;
    {
        int64_t start_123926;
        int64_t end_123927;
        
        start_123926 = start;
        end_123927 = end;
        
        int64_t n_123928 = end_123927 - start_123926;
        
        for (int64_t SegMap_i_123929 = start_123926; SegMap_i_123929 < start_123926 + n_123928; SegMap_i_123929++) {
            int64_t slice_123930 = m_33388;
            int64_t gtid_123803 = SegMap_i_123929;
            int64_t remnant_123931 = SegMap_i_123929 - gtid_123803;
            double defunc_0_reduce_res_123804;
            int64_t flat_tid_123918 = (int64_t) 0;
            
            defunc_0_reduce_res_123804 = 0.0;
            
            struct futhark_mc_task_128099 futhark_mc_task_128099_;
            
            futhark_mc_task_128099_.ctx = ctx;
            futhark_mc_task_128099_.free_m_33388 = m_33388;
            futhark_mc_task_128099_.free_eta_p_106382 = eta_p_106382;
            futhark_mc_task_128099_.free_A_mem_111707 = A_mem_111707.mem;
            futhark_mc_task_128099_.free_mem_param_118928 = mem_param_118928.mem;
            futhark_mc_task_128099_.free_gtid_119113 = gtid_119113;
            futhark_mc_task_128099_.free_gtid_123803 = gtid_123803;
            futhark_mc_task_128099_.free_flat_tid_123918 = flat_tid_123918;
            futhark_mc_task_128099_.retval_defunc_0_reduce_res_123804 = (double *) &defunc_0_reduce_res_123804;
            #if ISPC
            futhark_mc_task_128099_.retval_defunc_0_reduce_res_123804 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_128099_task;
            
            futhark_mc_task_128099_task.args = &futhark_mc_task_128099_;
            futhark_mc_task_128099_task.top_level_fn = futhark_mc_segred_task_128100;
            futhark_mc_task_128099_task.name = "futhark_mc_segred_task_128100";
            futhark_mc_task_128099_task.iterations = m_33388;
            futhark_mc_task_128099_task.task_time = &ctx->program->futhark_mc_segred_task_128100_total_time;
            futhark_mc_task_128099_task.task_iter = &ctx->program->futhark_mc_segred_task_128100_total_iter;
            futhark_mc_task_128099_task.sched = STATIC;
            futhark_mc_task_128099_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_128100_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128099_task);
            
            if (futhark_mc_segred_task_128100_err != 0) {
                err = futhark_mc_segred_task_128100_err;
                goto cleanup;
            }
            ((double *) mem_119128.mem)[gtid_123803] = defunc_0_reduce_res_123804;
        }
    }
    
  cleanup:
    { }
    if (event_128107 != NULL) {
        event_128107->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128098", strdup("nothing further"), event_128107, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_nested_task_128096(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128089 *futhark_mc_task_128089 = (struct futhark_mc_task_128089 *) args;
    struct futhark_context *ctx = futhark_mc_task_128089->ctx;
    struct mc_event *event_128109 = mc_event_new(ctx);
    
    if (event_128109 != NULL)
        event_128109->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128089->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_128089->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_128089->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_task_128089->free_mem_param_118928, .size =0, .references =NULL};
    int64_t gtid_119113 = futhark_mc_task_128089->free_gtid_119113;
    struct memblock mem_119128 = {.desc ="mem_119128", .mem =futhark_mc_task_128089->free_mem_119128, .size =0, .references =NULL};
    int32_t nsubtasks_123917;
    
    nsubtasks_123917 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_128097 futhark_mc_segmap_parloop_struct_128097_;
    
    futhark_mc_segmap_parloop_struct_128097_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_128097_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_128097_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segmap_parloop_struct_128097_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segmap_parloop_struct_128097_.free_mem_param_118928 = mem_param_118928.mem;
    futhark_mc_segmap_parloop_struct_128097_.free_gtid_119113 = gtid_119113;
    futhark_mc_segmap_parloop_struct_128097_.free_mem_119128 = mem_119128.mem;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_128098_task;
    
    futhark_mc_segmap_parloop_128098_task.name = "futhark_mc_segmap_parloop_128098";
    futhark_mc_segmap_parloop_128098_task.fn = futhark_mc_segmap_parloop_128098;
    futhark_mc_segmap_parloop_128098_task.args = &futhark_mc_segmap_parloop_struct_128097_;
    futhark_mc_segmap_parloop_128098_task.iterations = iterations;
    futhark_mc_segmap_parloop_128098_task.info = info;
    
    struct mc_event *event_128108 = mc_event_new(ctx);
    
    if (event_128108 != NULL)
        event_128108->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_128098_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_128098_task);
    
    if (futhark_mc_segmap_parloop_128098_err != 0) {
        err = futhark_mc_segmap_parloop_128098_err;
        goto cleanup;
    }
    if (event_128108 != NULL) {
        event_128108->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128098_total", strdup("nothing further"), event_128108, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_128109 != NULL) {
        event_128109->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_nested_task_128096", strdup("nothing further"), event_128109, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_128110 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_neg_res_43882;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_mem_111727;
    unsigned char *free_mem_111997;
    unsigned char *free_mem_111999;
    unsigned char *free_mem_param_118927;
    double free_defunc_res_118937;
    double free_zp_res_119086;
    int64_t free_gtid_119113;
    double free_eta_p_119115;
    double free_zt_res_119117;
    double free_defunc_0_reduce_res_119118;
    unsigned char *free_mem_119128;
    int64_t free_flat_tid_123822;
    int64_t free_flat_tid_123850;
    double *retval_defunc_0_reduce_res_119150;
    unsigned char *retval_mem_112032;
};
struct futhark_mc_segred_stage_1_parloop_struct_128113 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_neg_res_43882;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_mem_111727;
    unsigned char *free_mem_111997;
    unsigned char *free_mem_111999;
    unsigned char *free_mem_112032;
    unsigned char *free_mem_param_118927;
    double free_defunc_res_118937;
    double free_zp_res_119086;
    int64_t free_gtid_119113;
    double free_eta_p_119115;
    double free_zt_res_119117;
    double free_defunc_0_reduce_res_119118;
    unsigned char *free_mem_119128;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123950;
};
static int futhark_mc_segred_stage_1_parloop_128114(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128113 *futhark_mc_segred_stage_1_parloop_struct_128113 = (struct futhark_mc_segred_stage_1_parloop_struct_128113 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128113->ctx;
    struct mc_event *event_128115 = mc_event_new(ctx);
    
    if (event_128115 != NULL)
        event_128115->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128113->free_m_33388;
    double neg_res_43882 = futhark_mc_segred_stage_1_parloop_struct_128113->free_neg_res_43882;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128113->free_lifted_lambda_res_106391;
    struct memblock mem_111727 = {.desc ="mem_111727", .mem =futhark_mc_segred_stage_1_parloop_struct_128113->free_mem_111727, .size =0, .references =NULL};
    struct memblock mem_111997 = {.desc ="mem_111997", .mem =futhark_mc_segred_stage_1_parloop_struct_128113->free_mem_111997, .size =0, .references =NULL};
    struct memblock mem_111999 = {.desc ="mem_111999", .mem =futhark_mc_segred_stage_1_parloop_struct_128113->free_mem_111999, .size =0, .references =NULL};
    struct memblock mem_112032 = {.desc ="mem_112032", .mem =futhark_mc_segred_stage_1_parloop_struct_128113->free_mem_112032, .size =0, .references =NULL};
    struct memblock mem_param_118927 = {.desc ="mem_param_118927", .mem =futhark_mc_segred_stage_1_parloop_struct_128113->free_mem_param_118927, .size =0, .references =NULL};
    double defunc_res_118937 = futhark_mc_segred_stage_1_parloop_struct_128113->free_defunc_res_118937;
    double zp_res_119086 = futhark_mc_segred_stage_1_parloop_struct_128113->free_zp_res_119086;
    int64_t gtid_119113 = futhark_mc_segred_stage_1_parloop_struct_128113->free_gtid_119113;
    double eta_p_119115 = futhark_mc_segred_stage_1_parloop_struct_128113->free_eta_p_119115;
    double zt_res_119117 = futhark_mc_segred_stage_1_parloop_struct_128113->free_zt_res_119117;
    double defunc_0_reduce_res_119118 = futhark_mc_segred_stage_1_parloop_struct_128113->free_defunc_0_reduce_res_119118;
    struct memblock mem_119128 = {.desc ="mem_119128", .mem =futhark_mc_segred_stage_1_parloop_struct_128113->free_mem_119128, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_123950 = {.desc ="reduce_stage_1_tid_res_arr_mem_123950", .mem =futhark_mc_segred_stage_1_parloop_struct_128113->free_reduce_stage_1_tid_res_arr_mem_123950, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_123850;
    
    flat_tid_123850 = subtask_id;
    {
        double eta_p_123952;
        double eta_p_123953;
        double local_acc_123955 = INFINITY;
        double eta_p_123852;
        double eta_p_123853;
        double local_acc_123956 = INFINITY;
        int64_t start_123957;
        int64_t end_123958;
        
        start_123957 = start;
        end_123958 = end;
        
        int64_t n_123959 = end_123958 - start_123957;
        
        for (int64_t SegRed_i_123960 = start_123957; SegRed_i_123960 < start_123957 + n_123959; SegRed_i_123960++) {
            int64_t gtid_123851 = SegRed_i_123960;
            double eta_p_wasfree_123855 = ((double *) mem_111999.mem)[gtid_123851];
            double eta_p_wasfree_123856 = ((double *) mem_111997.mem)[gtid_123851];
            double eta_p_wasfree_123857 = ((double *) mem_param_118927.mem)[gtid_123851];
            double defunc_0_reduce_res_123858;
            double redout_123860 = 0.0;
            
            for (int64_t i_123859 = 0; i_123859 < m_33388; i_123859++) {
                double eta_p_123861 = ((double *) mem_119128.mem)[i_123859];
                double eta_p_123862 = ((double *) mem_111727.mem)[lifted_lambda_res_106391 * (m_33388 * m_33388) + i_123859 * m_33388 + gtid_123851];
                double zt_res_123863 = eta_p_123861 * eta_p_123862;
                double zp_res_123864 = zt_res_123863 + redout_123860;
                double redout_tmp_123961 = zp_res_123864;
                
                redout_123860 = redout_tmp_123961;
            }
            defunc_0_reduce_res_123858 = redout_123860;
            
            double zt_res_123865 = -2.0 * defunc_0_reduce_res_123858;
            double zp_res_123866 = defunc_0_reduce_res_119118 + zt_res_123865;
            double zp_res_123867 = eta_p_wasfree_123855 + zp_res_123866;
            double zp_res_123868 = zp_res_119086 + zp_res_123867;
            double zm_res_123869 = zp_res_123868 - zt_res_119117;
            double zm_res_123870 = zm_res_123869 - eta_p_wasfree_123856;
            double zs_res_123871 = zm_res_123870 / defunc_res_118937;
            double zs_res_123872 = zs_res_123871 / neg_res_43882;
            double zp_res_123873 = eta_p_119115 + zs_res_123872;
            double zp_res_123874 = eta_p_wasfree_123857 + zp_res_123873;
            double zm_res_123875 = 30.0 - zp_res_123874;
            
            // save map-out results
            {
                ((double *) mem_112032.mem)[gtid_119113 * m_33388 + gtid_123851] = zp_res_123874;
            }
            // Load accum params
            {
                eta_p_123852 = local_acc_123956;
            }
            // Load next params
            {
                eta_p_123853 = zm_res_123875;
            }
            // SegRed body
            {
                double min_res_123854 = fmin64(eta_p_123852, eta_p_123853);
                
                local_acc_123956 = min_res_123854;
            }
        }
        
        int64_t uni_i_123962 = 0;
        
        {
            int64_t gtid_123851 = uni_i_123962;
            
            // Load accum params
            {
                eta_p_123952 = local_acc_123955;
            }
            // Load next params
            {
                eta_p_123953 = local_acc_123956;
            }
            // SegRed body
            {
                double min_res_123954 = fmin64(eta_p_123952, eta_p_123953);
                
                local_acc_123955 = min_res_123954;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_123950.mem)[flat_tid_123850] = local_acc_123955;
    }
    
  cleanup:
    { }
    if (event_128115 != NULL) {
        event_128115->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128114", strdup("nothing further"), event_128115, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128111(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128110 *futhark_mc_task_128110 = (struct futhark_mc_task_128110 *) args;
    struct futhark_context *ctx = futhark_mc_task_128110->ctx;
    struct mc_event *event_128117 = mc_event_new(ctx);
    
    if (event_128117 != NULL)
        event_128117->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128110->free_m_33388;
    double neg_res_43882 = futhark_mc_task_128110->free_neg_res_43882;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128110->free_lifted_lambda_res_106391;
    struct memblock mem_111727 = {.desc ="mem_111727", .mem =futhark_mc_task_128110->free_mem_111727, .size =0, .references =NULL};
    struct memblock mem_111997 = {.desc ="mem_111997", .mem =futhark_mc_task_128110->free_mem_111997, .size =0, .references =NULL};
    struct memblock mem_111999 = {.desc ="mem_111999", .mem =futhark_mc_task_128110->free_mem_111999, .size =0, .references =NULL};
    struct memblock mem_param_118927 = {.desc ="mem_param_118927", .mem =futhark_mc_task_128110->free_mem_param_118927, .size =0, .references =NULL};
    double defunc_res_118937 = futhark_mc_task_128110->free_defunc_res_118937;
    double zp_res_119086 = futhark_mc_task_128110->free_zp_res_119086;
    int64_t gtid_119113 = futhark_mc_task_128110->free_gtid_119113;
    double eta_p_119115 = futhark_mc_task_128110->free_eta_p_119115;
    double zt_res_119117 = futhark_mc_task_128110->free_zt_res_119117;
    double defunc_0_reduce_res_119118 = futhark_mc_task_128110->free_defunc_0_reduce_res_119118;
    struct memblock mem_119128 = {.desc ="mem_119128", .mem =futhark_mc_task_128110->free_mem_119128, .size =0, .references =NULL};
    int64_t flat_tid_123822 = futhark_mc_task_128110->free_flat_tid_123822;
    int64_t flat_tid_123850 = futhark_mc_task_128110->free_flat_tid_123850;
    double defunc_0_reduce_res_119150 = *futhark_mc_task_128110->retval_defunc_0_reduce_res_119150;
    struct memblock mem_112032 = {.desc ="mem_112032", .mem =futhark_mc_task_128110->retval_mem_112032, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_123950_cached_sizze_128112 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123950 = NULL;
    int32_t nsubtasks_123949;
    
    nsubtasks_123949 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_123950_cached_sizze_128112 < (int64_t) 8 * nsubtasks_123949) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123950, &reduce_stage_1_tid_res_arr_mem_123950_cached_sizze_128112, (int64_t) 8 * nsubtasks_123949);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128113 futhark_mc_segred_stage_1_parloop_struct_128113_;
    
    futhark_mc_segred_stage_1_parloop_struct_128113_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128113_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128113_.free_neg_res_43882 = neg_res_43882;
    futhark_mc_segred_stage_1_parloop_struct_128113_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128113_.free_mem_111727 = mem_111727.mem;
    futhark_mc_segred_stage_1_parloop_struct_128113_.free_mem_111997 = mem_111997.mem;
    futhark_mc_segred_stage_1_parloop_struct_128113_.free_mem_111999 = mem_111999.mem;
    futhark_mc_segred_stage_1_parloop_struct_128113_.free_mem_112032 = mem_112032.mem;
    futhark_mc_segred_stage_1_parloop_struct_128113_.free_mem_param_118927 = mem_param_118927.mem;
    futhark_mc_segred_stage_1_parloop_struct_128113_.free_defunc_res_118937 = defunc_res_118937;
    futhark_mc_segred_stage_1_parloop_struct_128113_.free_zp_res_119086 = zp_res_119086;
    futhark_mc_segred_stage_1_parloop_struct_128113_.free_gtid_119113 = gtid_119113;
    futhark_mc_segred_stage_1_parloop_struct_128113_.free_eta_p_119115 = eta_p_119115;
    futhark_mc_segred_stage_1_parloop_struct_128113_.free_zt_res_119117 = zt_res_119117;
    futhark_mc_segred_stage_1_parloop_struct_128113_.free_defunc_0_reduce_res_119118 = defunc_0_reduce_res_119118;
    futhark_mc_segred_stage_1_parloop_struct_128113_.free_mem_119128 = mem_119128.mem;
    futhark_mc_segred_stage_1_parloop_struct_128113_.free_reduce_stage_1_tid_res_arr_mem_123950 = reduce_stage_1_tid_res_arr_mem_123950;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128114_task;
    
    futhark_mc_segred_stage_1_parloop_128114_task.name = "futhark_mc_segred_stage_1_parloop_128114";
    futhark_mc_segred_stage_1_parloop_128114_task.fn = futhark_mc_segred_stage_1_parloop_128114;
    futhark_mc_segred_stage_1_parloop_128114_task.args = &futhark_mc_segred_stage_1_parloop_struct_128113_;
    futhark_mc_segred_stage_1_parloop_128114_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128114_task.info = info;
    
    struct mc_event *event_128116 = mc_event_new(ctx);
    
    if (event_128116 != NULL)
        event_128116->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128114_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128114_task);
    
    if (futhark_mc_segred_stage_1_parloop_128114_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128114_err;
        goto cleanup;
    }
    if (event_128116 != NULL) {
        event_128116->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128114_total", strdup("nothing further"), event_128116, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_119150 = INFINITY;
    }
    
    double eta_p_123963;
    double eta_p_123964;
    
    for (int32_t i_123966 = 0; i_123966 < nsubtasks_123949; i_123966++) {
        flat_tid_123850 = i_123966;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_123963 = defunc_0_reduce_res_119150;
            }
            // load next params
            {
                eta_p_123964 = ((double *) reduce_stage_1_tid_res_arr_mem_123950)[flat_tid_123850];
            }
            // red body
            {
                double min_res_123965 = fmin64(eta_p_123963, eta_p_123964);
                
                defunc_0_reduce_res_119150 = min_res_123965;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_123950);
    }
    if (event_128117 != NULL) {
        event_128117->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128111", strdup("nothing further"), event_128117, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128110->retval_defunc_0_reduce_res_119150 = defunc_0_reduce_res_119150;
        futhark_mc_task_128110->retval_mem_112032 = mem_112032.mem;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_128120 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_neg_res_43882;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_mem_111727;
    unsigned char *free_mem_111997;
    unsigned char *free_mem_111999;
    unsigned char *free_mem_112032;
    unsigned char *free_mem_param_118927;
    double free_defunc_res_118937;
    double free_zp_res_119086;
    int64_t free_gtid_119113;
    double free_eta_p_119115;
    double free_zt_res_119117;
    double free_defunc_0_reduce_res_119118;
    unsigned char *free_mem_119128;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123968;
};
struct futhark_mc_task_128122 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_mem_111727;
    unsigned char *free_mem_119128;
    int64_t free_gtid_123823;
    int64_t free_flat_tid_123831;
    double *retval_defunc_0_reduce_res_123830;
};
struct futhark_mc_segred_stage_1_parloop_struct_128125 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_mem_111727;
    unsigned char *free_mem_119128;
    int64_t free_gtid_123823;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_123980;
};
static int futhark_mc_segred_stage_1_parloop_128126(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128125 *futhark_mc_segred_stage_1_parloop_struct_128125 = (struct futhark_mc_segred_stage_1_parloop_struct_128125 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128125->ctx;
    struct mc_event *event_128127 = mc_event_new(ctx);
    
    if (event_128127 != NULL)
        event_128127->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128125->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128125->free_lifted_lambda_res_106391;
    struct memblock mem_111727 = {.desc ="mem_111727", .mem =futhark_mc_segred_stage_1_parloop_struct_128125->free_mem_111727, .size =0, .references =NULL};
    struct memblock mem_119128 = {.desc ="mem_119128", .mem =futhark_mc_segred_stage_1_parloop_struct_128125->free_mem_119128, .size =0, .references =NULL};
    int64_t gtid_123823 = futhark_mc_segred_stage_1_parloop_struct_128125->free_gtid_123823;
    struct memblock reduce_stage_1_tid_res_arr_mem_123980 = {.desc ="reduce_stage_1_tid_res_arr_mem_123980", .mem =futhark_mc_segred_stage_1_parloop_struct_128125->free_reduce_stage_1_tid_res_arr_mem_123980, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_123831;
    
    flat_tid_123831 = subtask_id;
    {
        double eta_p_123982;
        double eta_p_123983;
        double local_acc_123985 = 0.0;
        double eta_p_123833;
        double eta_p_123834;
        double local_acc_123986 = 0.0;
        int64_t start_123987;
        int64_t end_123988;
        
        start_123987 = start;
        end_123988 = end;
        
        int64_t n_123989 = end_123988 - start_123987;
        
        for (int64_t SegRed_i_123990 = start_123987; SegRed_i_123990 < start_123987 + n_123989; SegRed_i_123990++) {
            int64_t gtid_123832 = SegRed_i_123990;
            double eta_p_123836 = ((double *) mem_119128.mem)[gtid_123832];
            double eta_p_123837 = ((double *) mem_111727.mem)[lifted_lambda_res_106391 * (m_33388 * m_33388) + gtid_123832 * m_33388 + gtid_123823];
            double zt_res_123838 = eta_p_123836 * eta_p_123837;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_123833 = local_acc_123986;
            }
            // Load next params
            {
                eta_p_123834 = zt_res_123838;
            }
            // SegRed body
            {
                double zp_res_123835 = eta_p_123833 + eta_p_123834;
                
                local_acc_123986 = zp_res_123835;
            }
        }
        
        int64_t uni_i_123991 = 0;
        
        {
            int64_t gtid_123832 = uni_i_123991;
            
            // Load accum params
            {
                eta_p_123982 = local_acc_123985;
            }
            // Load next params
            {
                eta_p_123983 = local_acc_123986;
            }
            // SegRed body
            {
                double zp_res_123984 = eta_p_123982 + eta_p_123983;
                
                local_acc_123985 = zp_res_123984;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_123980.mem)[flat_tid_123831] = local_acc_123985;
    }
    
  cleanup:
    { }
    if (event_128127 != NULL) {
        event_128127->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128126", strdup("nothing further"), event_128127, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128123(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128122 *futhark_mc_task_128122 = (struct futhark_mc_task_128122 *) args;
    struct futhark_context *ctx = futhark_mc_task_128122->ctx;
    struct mc_event *event_128129 = mc_event_new(ctx);
    
    if (event_128129 != NULL)
        event_128129->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128122->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128122->free_lifted_lambda_res_106391;
    struct memblock mem_111727 = {.desc ="mem_111727", .mem =futhark_mc_task_128122->free_mem_111727, .size =0, .references =NULL};
    struct memblock mem_119128 = {.desc ="mem_119128", .mem =futhark_mc_task_128122->free_mem_119128, .size =0, .references =NULL};
    int64_t gtid_123823 = futhark_mc_task_128122->free_gtid_123823;
    int64_t flat_tid_123831 = futhark_mc_task_128122->free_flat_tid_123831;
    double defunc_0_reduce_res_123830 = *futhark_mc_task_128122->retval_defunc_0_reduce_res_123830;
    int64_t reduce_stage_1_tid_res_arr_mem_123980_cached_sizze_128124 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123980 = NULL;
    int32_t nsubtasks_123979;
    
    nsubtasks_123979 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_123980_cached_sizze_128124 < (int64_t) 8 * nsubtasks_123979) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123980, &reduce_stage_1_tid_res_arr_mem_123980_cached_sizze_128124, (int64_t) 8 * nsubtasks_123979);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128125 futhark_mc_segred_stage_1_parloop_struct_128125_;
    
    futhark_mc_segred_stage_1_parloop_struct_128125_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128125_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128125_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128125_.free_mem_111727 = mem_111727.mem;
    futhark_mc_segred_stage_1_parloop_struct_128125_.free_mem_119128 = mem_119128.mem;
    futhark_mc_segred_stage_1_parloop_struct_128125_.free_gtid_123823 = gtid_123823;
    futhark_mc_segred_stage_1_parloop_struct_128125_.free_reduce_stage_1_tid_res_arr_mem_123980 = reduce_stage_1_tid_res_arr_mem_123980;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128126_task;
    
    futhark_mc_segred_stage_1_parloop_128126_task.name = "futhark_mc_segred_stage_1_parloop_128126";
    futhark_mc_segred_stage_1_parloop_128126_task.fn = futhark_mc_segred_stage_1_parloop_128126;
    futhark_mc_segred_stage_1_parloop_128126_task.args = &futhark_mc_segred_stage_1_parloop_struct_128125_;
    futhark_mc_segred_stage_1_parloop_128126_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128126_task.info = info;
    
    struct mc_event *event_128128 = mc_event_new(ctx);
    
    if (event_128128 != NULL)
        event_128128->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128126_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128126_task);
    
    if (futhark_mc_segred_stage_1_parloop_128126_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128126_err;
        goto cleanup;
    }
    if (event_128128 != NULL) {
        event_128128->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128126_total", strdup("nothing further"), event_128128, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_123830 = 0.0;
    }
    
    double eta_p_123992;
    double eta_p_123993;
    
    for (int32_t i_123995 = 0; i_123995 < nsubtasks_123979; i_123995++) {
        flat_tid_123831 = i_123995;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_123992 = defunc_0_reduce_res_123830;
            }
            // load next params
            {
                eta_p_123993 = ((double *) reduce_stage_1_tid_res_arr_mem_123980)[flat_tid_123831];
            }
            // red body
            {
                double zp_res_123994 = eta_p_123992 + eta_p_123993;
                
                defunc_0_reduce_res_123830 = zp_res_123994;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_123980);
    }
    if (event_128129 != NULL) {
        event_128129->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128123", strdup("nothing further"), event_128129, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128122->retval_defunc_0_reduce_res_123830 = defunc_0_reduce_res_123830;
    }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_128121(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128120 *futhark_mc_segred_stage_1_parloop_struct_128120 = (struct futhark_mc_segred_stage_1_parloop_struct_128120 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128120->ctx;
    struct mc_event *event_128130 = mc_event_new(ctx);
    
    if (event_128130 != NULL)
        event_128130->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128120->free_m_33388;
    double neg_res_43882 = futhark_mc_segred_stage_1_parloop_struct_128120->free_neg_res_43882;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128120->free_lifted_lambda_res_106391;
    struct memblock mem_111727 = {.desc ="mem_111727", .mem =futhark_mc_segred_stage_1_parloop_struct_128120->free_mem_111727, .size =0, .references =NULL};
    struct memblock mem_111997 = {.desc ="mem_111997", .mem =futhark_mc_segred_stage_1_parloop_struct_128120->free_mem_111997, .size =0, .references =NULL};
    struct memblock mem_111999 = {.desc ="mem_111999", .mem =futhark_mc_segred_stage_1_parloop_struct_128120->free_mem_111999, .size =0, .references =NULL};
    struct memblock mem_112032 = {.desc ="mem_112032", .mem =futhark_mc_segred_stage_1_parloop_struct_128120->free_mem_112032, .size =0, .references =NULL};
    struct memblock mem_param_118927 = {.desc ="mem_param_118927", .mem =futhark_mc_segred_stage_1_parloop_struct_128120->free_mem_param_118927, .size =0, .references =NULL};
    double defunc_res_118937 = futhark_mc_segred_stage_1_parloop_struct_128120->free_defunc_res_118937;
    double zp_res_119086 = futhark_mc_segred_stage_1_parloop_struct_128120->free_zp_res_119086;
    int64_t gtid_119113 = futhark_mc_segred_stage_1_parloop_struct_128120->free_gtid_119113;
    double eta_p_119115 = futhark_mc_segred_stage_1_parloop_struct_128120->free_eta_p_119115;
    double zt_res_119117 = futhark_mc_segred_stage_1_parloop_struct_128120->free_zt_res_119117;
    double defunc_0_reduce_res_119118 = futhark_mc_segred_stage_1_parloop_struct_128120->free_defunc_0_reduce_res_119118;
    struct memblock mem_119128 = {.desc ="mem_119128", .mem =futhark_mc_segred_stage_1_parloop_struct_128120->free_mem_119128, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_123968 = {.desc ="reduce_stage_1_tid_res_arr_mem_123968", .mem =futhark_mc_segred_stage_1_parloop_struct_128120->free_reduce_stage_1_tid_res_arr_mem_123968, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_123822;
    
    flat_tid_123822 = subtask_id;
    {
        double eta_p_123970;
        double eta_p_123971;
        double local_acc_123973 = INFINITY;
        double eta_p_123824;
        double eta_p_123825;
        double local_acc_123974 = INFINITY;
        int64_t start_123975;
        int64_t end_123976;
        
        start_123975 = start;
        end_123976 = end;
        
        int64_t n_123977 = end_123976 - start_123975;
        
        for (int64_t SegRed_i_123978 = start_123975; SegRed_i_123978 < start_123975 + n_123977; SegRed_i_123978++) {
            int64_t gtid_123823 = SegRed_i_123978;
            double eta_p_wasfree_123827 = ((double *) mem_111999.mem)[gtid_123823];
            double eta_p_wasfree_123828 = ((double *) mem_111997.mem)[gtid_123823];
            double eta_p_wasfree_123829 = ((double *) mem_param_118927.mem)[gtid_123823];
            double defunc_0_reduce_res_123830;
            int64_t flat_tid_123831 = (int64_t) 0;
            
            defunc_0_reduce_res_123830 = 0.0;
            
            struct futhark_mc_task_128122 futhark_mc_task_128122_;
            
            futhark_mc_task_128122_.ctx = ctx;
            futhark_mc_task_128122_.free_m_33388 = m_33388;
            futhark_mc_task_128122_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
            futhark_mc_task_128122_.free_mem_111727 = mem_111727.mem;
            futhark_mc_task_128122_.free_mem_119128 = mem_119128.mem;
            futhark_mc_task_128122_.free_gtid_123823 = gtid_123823;
            futhark_mc_task_128122_.free_flat_tid_123831 = flat_tid_123831;
            futhark_mc_task_128122_.retval_defunc_0_reduce_res_123830 = (double *) &defunc_0_reduce_res_123830;
            #if ISPC
            futhark_mc_task_128122_.retval_defunc_0_reduce_res_123830 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_128122_task;
            
            futhark_mc_task_128122_task.args = &futhark_mc_task_128122_;
            futhark_mc_task_128122_task.top_level_fn = futhark_mc_segred_task_128123;
            futhark_mc_task_128122_task.name = "futhark_mc_segred_task_128123";
            futhark_mc_task_128122_task.iterations = m_33388;
            futhark_mc_task_128122_task.task_time = &ctx->program->futhark_mc_segred_task_128123_total_time;
            futhark_mc_task_128122_task.task_iter = &ctx->program->futhark_mc_segred_task_128123_total_iter;
            futhark_mc_task_128122_task.sched = STATIC;
            futhark_mc_task_128122_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_128123_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128122_task);
            
            if (futhark_mc_segred_task_128123_err != 0) {
                err = futhark_mc_segred_task_128123_err;
                goto cleanup;
            }
            
            double zt_res_123839 = -2.0 * defunc_0_reduce_res_123830;
            double zp_res_123840 = defunc_0_reduce_res_119118 + zt_res_123839;
            double zp_res_123841 = eta_p_wasfree_123827 + zp_res_123840;
            double zp_res_123842 = zp_res_119086 + zp_res_123841;
            double zm_res_123843 = zp_res_123842 - zt_res_119117;
            double zm_res_123844 = zm_res_123843 - eta_p_wasfree_123828;
            double zs_res_123845 = zm_res_123844 / defunc_res_118937;
            double zs_res_123846 = zs_res_123845 / neg_res_43882;
            double zp_res_123847 = eta_p_119115 + zs_res_123846;
            double zp_res_123848 = eta_p_wasfree_123829 + zp_res_123847;
            double zm_res_123849 = 30.0 - zp_res_123848;
            
            // save map-out results
            {
                ((double *) mem_112032.mem)[gtid_119113 * m_33388 + gtid_123823] = zp_res_123848;
            }
            // Load accum params
            {
                eta_p_123824 = local_acc_123974;
            }
            // Load next params
            {
                eta_p_123825 = zm_res_123849;
            }
            // SegRed body
            {
                double min_res_123826 = fmin64(eta_p_123824, eta_p_123825);
                
                local_acc_123974 = min_res_123826;
            }
        }
        
        int64_t uni_i_123996 = 0;
        
        {
            int64_t gtid_123823 = uni_i_123996;
            
            // Load accum params
            {
                eta_p_123970 = local_acc_123973;
            }
            // Load next params
            {
                eta_p_123971 = local_acc_123974;
            }
            // SegRed body
            {
                double min_res_123972 = fmin64(eta_p_123970, eta_p_123971);
                
                local_acc_123973 = min_res_123972;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_123968.mem)[flat_tid_123822] = local_acc_123973;
    }
    
  cleanup:
    { }
    if (event_128130 != NULL) {
        event_128130->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128121", strdup("nothing further"), event_128130, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_128118(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128110 *futhark_mc_task_128110 = (struct futhark_mc_task_128110 *) args;
    struct futhark_context *ctx = futhark_mc_task_128110->ctx;
    struct mc_event *event_128132 = mc_event_new(ctx);
    
    if (event_128132 != NULL)
        event_128132->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128110->free_m_33388;
    double neg_res_43882 = futhark_mc_task_128110->free_neg_res_43882;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128110->free_lifted_lambda_res_106391;
    struct memblock mem_111727 = {.desc ="mem_111727", .mem =futhark_mc_task_128110->free_mem_111727, .size =0, .references =NULL};
    struct memblock mem_111997 = {.desc ="mem_111997", .mem =futhark_mc_task_128110->free_mem_111997, .size =0, .references =NULL};
    struct memblock mem_111999 = {.desc ="mem_111999", .mem =futhark_mc_task_128110->free_mem_111999, .size =0, .references =NULL};
    struct memblock mem_param_118927 = {.desc ="mem_param_118927", .mem =futhark_mc_task_128110->free_mem_param_118927, .size =0, .references =NULL};
    double defunc_res_118937 = futhark_mc_task_128110->free_defunc_res_118937;
    double zp_res_119086 = futhark_mc_task_128110->free_zp_res_119086;
    int64_t gtid_119113 = futhark_mc_task_128110->free_gtid_119113;
    double eta_p_119115 = futhark_mc_task_128110->free_eta_p_119115;
    double zt_res_119117 = futhark_mc_task_128110->free_zt_res_119117;
    double defunc_0_reduce_res_119118 = futhark_mc_task_128110->free_defunc_0_reduce_res_119118;
    struct memblock mem_119128 = {.desc ="mem_119128", .mem =futhark_mc_task_128110->free_mem_119128, .size =0, .references =NULL};
    int64_t flat_tid_123822 = futhark_mc_task_128110->free_flat_tid_123822;
    int64_t flat_tid_123850 = futhark_mc_task_128110->free_flat_tid_123850;
    double defunc_0_reduce_res_119150 = *futhark_mc_task_128110->retval_defunc_0_reduce_res_119150;
    struct memblock mem_112032 = {.desc ="mem_112032", .mem =futhark_mc_task_128110->retval_mem_112032, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_123968_cached_sizze_128119 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_123968 = NULL;
    int32_t nsubtasks_123967;
    
    nsubtasks_123967 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_123968_cached_sizze_128119 < (int64_t) 8 * nsubtasks_123967) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_123968, &reduce_stage_1_tid_res_arr_mem_123968_cached_sizze_128119, (int64_t) 8 * nsubtasks_123967);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128120 futhark_mc_segred_stage_1_parloop_struct_128120_;
    
    futhark_mc_segred_stage_1_parloop_struct_128120_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128120_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128120_.free_neg_res_43882 = neg_res_43882;
    futhark_mc_segred_stage_1_parloop_struct_128120_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128120_.free_mem_111727 = mem_111727.mem;
    futhark_mc_segred_stage_1_parloop_struct_128120_.free_mem_111997 = mem_111997.mem;
    futhark_mc_segred_stage_1_parloop_struct_128120_.free_mem_111999 = mem_111999.mem;
    futhark_mc_segred_stage_1_parloop_struct_128120_.free_mem_112032 = mem_112032.mem;
    futhark_mc_segred_stage_1_parloop_struct_128120_.free_mem_param_118927 = mem_param_118927.mem;
    futhark_mc_segred_stage_1_parloop_struct_128120_.free_defunc_res_118937 = defunc_res_118937;
    futhark_mc_segred_stage_1_parloop_struct_128120_.free_zp_res_119086 = zp_res_119086;
    futhark_mc_segred_stage_1_parloop_struct_128120_.free_gtid_119113 = gtid_119113;
    futhark_mc_segred_stage_1_parloop_struct_128120_.free_eta_p_119115 = eta_p_119115;
    futhark_mc_segred_stage_1_parloop_struct_128120_.free_zt_res_119117 = zt_res_119117;
    futhark_mc_segred_stage_1_parloop_struct_128120_.free_defunc_0_reduce_res_119118 = defunc_0_reduce_res_119118;
    futhark_mc_segred_stage_1_parloop_struct_128120_.free_mem_119128 = mem_119128.mem;
    futhark_mc_segred_stage_1_parloop_struct_128120_.free_reduce_stage_1_tid_res_arr_mem_123968 = reduce_stage_1_tid_res_arr_mem_123968;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128121_task;
    
    futhark_mc_segred_stage_1_parloop_128121_task.name = "futhark_mc_segred_stage_1_parloop_128121";
    futhark_mc_segred_stage_1_parloop_128121_task.fn = futhark_mc_segred_stage_1_parloop_128121;
    futhark_mc_segred_stage_1_parloop_128121_task.args = &futhark_mc_segred_stage_1_parloop_struct_128120_;
    futhark_mc_segred_stage_1_parloop_128121_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128121_task.info = info;
    
    struct mc_event *event_128131 = mc_event_new(ctx);
    
    if (event_128131 != NULL)
        event_128131->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128121_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128121_task);
    
    if (futhark_mc_segred_stage_1_parloop_128121_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128121_err;
        goto cleanup;
    }
    if (event_128131 != NULL) {
        event_128131->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128121_total", strdup("nothing further"), event_128131, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_119150 = INFINITY;
    }
    
    double eta_p_123997;
    double eta_p_123998;
    
    for (int32_t i_124000 = 0; i_124000 < nsubtasks_123967; i_124000++) {
        flat_tid_123822 = i_124000;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_123997 = defunc_0_reduce_res_119150;
            }
            // load next params
            {
                eta_p_123998 = ((double *) reduce_stage_1_tid_res_arr_mem_123968)[flat_tid_123822];
            }
            // red body
            {
                double min_res_123999 = fmin64(eta_p_123997, eta_p_123998);
                
                defunc_0_reduce_res_119150 = min_res_123999;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_123968);
    }
    if (event_128132 != NULL) {
        event_128132->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_128118", strdup("nothing further"), event_128132, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128110->retval_defunc_0_reduce_res_119150 = defunc_0_reduce_res_119150;
        futhark_mc_task_128110->retval_mem_112032 = mem_112032.mem;
    }
    return err;
}
struct futhark_mc_task_128133 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_112032;
    int64_t free_gtid_119113;
    double free_defunc_0_reduce_res_119150;
};
struct futhark_mc_segmap_parloop_struct_128135 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_112032;
    int64_t free_gtid_119113;
    double free_defunc_0_reduce_res_119150;
};
static int futhark_mc_segmap_parloop_128136(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_128135 *futhark_mc_segmap_parloop_struct_128135 = (struct futhark_mc_segmap_parloop_struct_128135 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_128135->ctx;
    struct mc_event *event_128137 = mc_event_new(ctx);
    
    if (event_128137 != NULL)
        event_128137->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_128135->free_m_33388;
    struct memblock mem_112032 = {.desc ="mem_112032", .mem =futhark_mc_segmap_parloop_struct_128135->free_mem_112032, .size =0, .references =NULL};
    int64_t gtid_119113 = futhark_mc_segmap_parloop_struct_128135->free_gtid_119113;
    double defunc_0_reduce_res_119150 = futhark_mc_segmap_parloop_struct_128135->free_defunc_0_reduce_res_119150;
    int64_t iterations = end - start;
    int64_t flat_tid_123876;
    
    flat_tid_123876 = subtask_id;
    {
        int64_t start_124002;
        int64_t end_124003;
        
        start_124002 = start;
        end_124003 = end;
        
        int64_t n_124004 = end_124003 - start_124002;
        
        for (int64_t SegMap_i_124005 = start_124002; SegMap_i_124005 < start_124002 + n_124004; SegMap_i_124005++) {
            int64_t slice_124006 = m_33388;
            int64_t gtid_123877 = SegMap_i_124005;
            int64_t remnant_124007 = SegMap_i_124005 - gtid_123877;
            double eta_p_123878 = ((double *) mem_112032.mem)[gtid_119113 * m_33388 + gtid_123877];
            double zp_res_123879 = defunc_0_reduce_res_119150 + eta_p_123878;
            
            ((double *) mem_112032.mem)[gtid_119113 * m_33388 + gtid_123877] = zp_res_123879;
        }
    }
    
  cleanup:
    { }
    if (event_128137 != NULL) {
        event_128137->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128136", strdup("nothing further"), event_128137, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_task_128134(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128133 *futhark_mc_task_128133 = (struct futhark_mc_task_128133 *) args;
    struct futhark_context *ctx = futhark_mc_task_128133->ctx;
    struct mc_event *event_128139 = mc_event_new(ctx);
    
    if (event_128139 != NULL)
        event_128139->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128133->free_m_33388;
    struct memblock mem_112032 = {.desc ="mem_112032", .mem =futhark_mc_task_128133->free_mem_112032, .size =0, .references =NULL};
    int64_t gtid_119113 = futhark_mc_task_128133->free_gtid_119113;
    double defunc_0_reduce_res_119150 = futhark_mc_task_128133->free_defunc_0_reduce_res_119150;
    int32_t nsubtasks_124001;
    
    nsubtasks_124001 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_128135 futhark_mc_segmap_parloop_struct_128135_;
    
    futhark_mc_segmap_parloop_struct_128135_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_128135_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_128135_.free_mem_112032 = mem_112032.mem;
    futhark_mc_segmap_parloop_struct_128135_.free_gtid_119113 = gtid_119113;
    futhark_mc_segmap_parloop_struct_128135_.free_defunc_0_reduce_res_119150 = defunc_0_reduce_res_119150;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_128136_task;
    
    futhark_mc_segmap_parloop_128136_task.name = "futhark_mc_segmap_parloop_128136";
    futhark_mc_segmap_parloop_128136_task.fn = futhark_mc_segmap_parloop_128136;
    futhark_mc_segmap_parloop_128136_task.args = &futhark_mc_segmap_parloop_struct_128135_;
    futhark_mc_segmap_parloop_128136_task.iterations = iterations;
    futhark_mc_segmap_parloop_128136_task.info = info;
    
    struct mc_event *event_128138 = mc_event_new(ctx);
    
    if (event_128138 != NULL)
        event_128138->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_128136_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_128136_task);
    
    if (futhark_mc_segmap_parloop_128136_err != 0) {
        err = futhark_mc_segmap_parloop_128136_err;
        goto cleanup;
    }
    if (event_128138 != NULL) {
        event_128138->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128136_total", strdup("nothing further"), event_128138, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_128139 != NULL) {
        event_128139->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_task_128134", strdup("nothing further"), event_128139, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
static int futhark_mc_segmap_parloop_128079(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_128078 *futhark_mc_segmap_parloop_struct_128078 = (struct futhark_mc_segmap_parloop_struct_128078 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_128078->ctx;
    struct mc_event *event_128140 = mc_event_new(ctx);
    
    if (event_128140 != NULL)
        event_128140->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_128078->free_m_33388;
    double neg_res_43882 = futhark_mc_segmap_parloop_struct_128078->free_neg_res_43882;
    int64_t eta_p_106382 = futhark_mc_segmap_parloop_struct_128078->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_segmap_parloop_struct_128078->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segmap_parloop_struct_128078->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segmap_parloop_struct_128078->free_distrs_mem_111708, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_segmap_parloop_struct_128078->free_bytes_111715;
    struct memblock mem_111727 = {.desc ="mem_111727", .mem =futhark_mc_segmap_parloop_struct_128078->free_mem_111727, .size =0, .references =NULL};
    struct memblock mem_111993 = {.desc ="mem_111993", .mem =futhark_mc_segmap_parloop_struct_128078->free_mem_111993, .size =0, .references =NULL};
    struct memblock mem_111997 = {.desc ="mem_111997", .mem =futhark_mc_segmap_parloop_struct_128078->free_mem_111997, .size =0, .references =NULL};
    struct memblock mem_111999 = {.desc ="mem_111999", .mem =futhark_mc_segmap_parloop_struct_128078->free_mem_111999, .size =0, .references =NULL};
    struct memblock mem_112032 = {.desc ="mem_112032", .mem =futhark_mc_segmap_parloop_struct_128078->free_mem_112032, .size =0, .references =NULL};
    struct memblock mem_112034 = {.desc ="mem_112034", .mem =futhark_mc_segmap_parloop_struct_128078->free_mem_112034, .size =0, .references =NULL};
    struct memblock mem_param_118926 = {.desc ="mem_param_118926", .mem =futhark_mc_segmap_parloop_struct_128078->free_mem_param_118926, .size =0, .references =NULL};
    struct memblock mem_param_118927 = {.desc ="mem_param_118927", .mem =futhark_mc_segmap_parloop_struct_128078->free_mem_param_118927, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_segmap_parloop_struct_128078->free_mem_param_118928, .size =0, .references =NULL};
    double defunc_res_118937 = futhark_mc_segmap_parloop_struct_128078->free_defunc_res_118937;
    double zt_res_119033 = futhark_mc_segmap_parloop_struct_128078->free_zt_res_119033;
    double zp_res_119086 = futhark_mc_segmap_parloop_struct_128078->free_zp_res_119086;
    int64_t iterations = end - start;
    int64_t mem_119128_cached_sizze_128080 = 0;
    unsigned char *mem_119128 = NULL;
    int64_t flat_tid_119112;
    
    flat_tid_119112 = subtask_id;
    {
        int64_t start_123880;
        int64_t end_123881;
        
        start_123880 = start;
        end_123881 = end;
        
        int64_t n_123882 = end_123881 - start_123880;
        
        if (mem_119128_cached_sizze_128080 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_119128, &mem_119128_cached_sizze_128080, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        for (int64_t SegMap_i_123883 = start_123880; SegMap_i_123883 < start_123880 + n_123882; SegMap_i_123883++) {
            int64_t slice_123884 = m_33388;
            int64_t gtid_119113 = SegMap_i_123883;
            int64_t remnant_123885 = SegMap_i_123883 - gtid_119113;
            double eta_p_119114 = ((double *) distrs_mem_111708.mem)[eta_p_106382 * m_33388 + gtid_119113];
            double eta_p_119115 = ((double *) mem_param_118926.mem)[gtid_119113];
            double log_res_119116 = futrts_log64(eta_p_119114);
            double zt_res_119117 = zt_res_119033 * log_res_119116;
            double defunc_0_reduce_res_119118;
            int64_t flat_tid_123793 = (int64_t) 0;
            
            defunc_0_reduce_res_119118 = 0.0;
            
            struct futhark_mc_task_128081 futhark_mc_task_128081_;
            
            futhark_mc_task_128081_.ctx = ctx;
            futhark_mc_task_128081_.free_m_33388 = m_33388;
            futhark_mc_task_128081_.free_eta_p_106382 = eta_p_106382;
            futhark_mc_task_128081_.free_A_mem_111707 = A_mem_111707.mem;
            futhark_mc_task_128081_.free_mem_111993 = mem_111993.mem;
            futhark_mc_task_128081_.free_gtid_119113 = gtid_119113;
            futhark_mc_task_128081_.free_flat_tid_123793 = flat_tid_123793;
            futhark_mc_task_128081_.retval_defunc_0_reduce_res_119118 = (double *) &defunc_0_reduce_res_119118;
            #if ISPC
            futhark_mc_task_128081_.retval_defunc_0_reduce_res_119118 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_128081_task;
            
            futhark_mc_task_128081_task.args = &futhark_mc_task_128081_;
            futhark_mc_task_128081_task.top_level_fn = futhark_mc_segred_task_128082;
            futhark_mc_task_128081_task.name = "futhark_mc_segred_task_128082";
            futhark_mc_task_128081_task.iterations = m_33388;
            futhark_mc_task_128081_task.task_time = &ctx->program->futhark_mc_segred_task_128082_total_time;
            futhark_mc_task_128081_task.task_iter = &ctx->program->futhark_mc_segred_task_128082_total_iter;
            futhark_mc_task_128081_task.sched = STATIC;
            futhark_mc_task_128081_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_128082_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128081_task);
            
            if (futhark_mc_segred_task_128082_err != 0) {
                err = futhark_mc_segred_task_128082_err;
                goto cleanup;
            }
            
            int64_t flat_tid_123813 = (int64_t) 0;
            int64_t flat_tid_123802 = (int64_t) 0;
            struct futhark_mc_task_128089 futhark_mc_task_128089_;
            
            futhark_mc_task_128089_.ctx = ctx;
            futhark_mc_task_128089_.free_m_33388 = m_33388;
            futhark_mc_task_128089_.free_eta_p_106382 = eta_p_106382;
            futhark_mc_task_128089_.free_A_mem_111707 = A_mem_111707.mem;
            futhark_mc_task_128089_.free_mem_param_118928 = mem_param_118928.mem;
            futhark_mc_task_128089_.free_gtid_119113 = gtid_119113;
            futhark_mc_task_128089_.free_mem_119128 = mem_119128;
            
            struct scheduler_segop futhark_mc_task_128089_task;
            
            futhark_mc_task_128089_task.args = &futhark_mc_task_128089_;
            futhark_mc_task_128089_task.top_level_fn = futhark_mc_segmap_task_128090;
            futhark_mc_task_128089_task.name = "futhark_mc_segmap_task_128090";
            futhark_mc_task_128089_task.iterations = m_33388;
            futhark_mc_task_128089_task.task_time = &ctx->program->futhark_mc_segmap_task_128090_total_time;
            futhark_mc_task_128089_task.task_iter = &ctx->program->futhark_mc_segmap_task_128090_total_iter;
            futhark_mc_task_128089_task.sched = STATIC;
            futhark_mc_task_128089_task.nested_fn = futhark_mc_segmap_nested_task_128096;
            
            int futhark_mc_segmap_task_128090_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128089_task);
            
            if (futhark_mc_segmap_task_128090_err != 0) {
                err = futhark_mc_segmap_task_128090_err;
                goto cleanup;
            }
            
            double defunc_0_reduce_res_119150;
            int64_t flat_tid_123850 = (int64_t) 0;
            
            defunc_0_reduce_res_119150 = 0.0;
            
            int64_t flat_tid_123822 = (int64_t) 0;
            struct futhark_mc_task_128110 futhark_mc_task_128110_;
            
            futhark_mc_task_128110_.ctx = ctx;
            futhark_mc_task_128110_.free_m_33388 = m_33388;
            futhark_mc_task_128110_.free_neg_res_43882 = neg_res_43882;
            futhark_mc_task_128110_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
            futhark_mc_task_128110_.free_mem_111727 = mem_111727.mem;
            futhark_mc_task_128110_.free_mem_111997 = mem_111997.mem;
            futhark_mc_task_128110_.free_mem_111999 = mem_111999.mem;
            futhark_mc_task_128110_.free_mem_param_118927 = mem_param_118927.mem;
            futhark_mc_task_128110_.free_defunc_res_118937 = defunc_res_118937;
            futhark_mc_task_128110_.free_zp_res_119086 = zp_res_119086;
            futhark_mc_task_128110_.free_gtid_119113 = gtid_119113;
            futhark_mc_task_128110_.free_eta_p_119115 = eta_p_119115;
            futhark_mc_task_128110_.free_zt_res_119117 = zt_res_119117;
            futhark_mc_task_128110_.free_defunc_0_reduce_res_119118 = defunc_0_reduce_res_119118;
            futhark_mc_task_128110_.free_mem_119128 = mem_119128;
            futhark_mc_task_128110_.free_flat_tid_123822 = flat_tid_123822;
            futhark_mc_task_128110_.free_flat_tid_123850 = flat_tid_123850;
            futhark_mc_task_128110_.retval_defunc_0_reduce_res_119150 = (double *) &defunc_0_reduce_res_119150;
            #if ISPC
            futhark_mc_task_128110_.retval_defunc_0_reduce_res_119150 += programIndex;
            #endif
            futhark_mc_task_128110_.retval_mem_112032 = mem_112032.mem;
            
            struct scheduler_segop futhark_mc_task_128110_task;
            
            futhark_mc_task_128110_task.args = &futhark_mc_task_128110_;
            futhark_mc_task_128110_task.top_level_fn = futhark_mc_segred_task_128111;
            futhark_mc_task_128110_task.name = "futhark_mc_segred_task_128111";
            futhark_mc_task_128110_task.iterations = m_33388;
            futhark_mc_task_128110_task.task_time = &ctx->program->futhark_mc_segred_task_128111_total_time;
            futhark_mc_task_128110_task.task_iter = &ctx->program->futhark_mc_segred_task_128111_total_iter;
            futhark_mc_task_128110_task.sched = STATIC;
            futhark_mc_task_128110_task.nested_fn = futhark_mc_segred_nested_task_128118;
            
            int futhark_mc_segred_task_128111_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128110_task);
            
            if (futhark_mc_segred_task_128111_err != 0) {
                err = futhark_mc_segred_task_128111_err;
                goto cleanup;
            }
            
            int64_t flat_tid_123876 = (int64_t) 0;
            struct futhark_mc_task_128133 futhark_mc_task_128133_;
            
            futhark_mc_task_128133_.ctx = ctx;
            futhark_mc_task_128133_.free_m_33388 = m_33388;
            futhark_mc_task_128133_.free_mem_112032 = mem_112032.mem;
            futhark_mc_task_128133_.free_gtid_119113 = gtid_119113;
            futhark_mc_task_128133_.free_defunc_0_reduce_res_119150 = defunc_0_reduce_res_119150;
            
            struct scheduler_segop futhark_mc_task_128133_task;
            
            futhark_mc_task_128133_task.args = &futhark_mc_task_128133_;
            futhark_mc_task_128133_task.top_level_fn = futhark_mc_segmap_task_128134;
            futhark_mc_task_128133_task.name = "futhark_mc_segmap_task_128134";
            futhark_mc_task_128133_task.iterations = m_33388;
            futhark_mc_task_128133_task.task_time = &ctx->program->futhark_mc_segmap_task_128134_total_time;
            futhark_mc_task_128133_task.task_iter = &ctx->program->futhark_mc_segmap_task_128134_total_iter;
            futhark_mc_task_128133_task.sched = STATIC;
            futhark_mc_task_128133_task.nested_fn = NULL;
            
            int futhark_mc_segmap_task_128134_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128133_task);
            
            if (futhark_mc_segmap_task_128134_err != 0) {
                err = futhark_mc_segmap_task_128134_err;
                goto cleanup;
            }
            ((double *) mem_112034.mem)[gtid_119113] = defunc_0_reduce_res_119150;
        }
    }
    
  cleanup:
    {
        free(mem_119128);
    }
    if (event_128140 != NULL) {
        event_128140->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128079", strdup("nothing further"), event_128140, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_nested_task_128077(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128068 *futhark_mc_task_128068 = (struct futhark_mc_task_128068 *) args;
    struct futhark_context *ctx = futhark_mc_task_128068->ctx;
    struct mc_event *event_128142 = mc_event_new(ctx);
    
    if (event_128142 != NULL)
        event_128142->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128068->free_m_33388;
    double neg_res_43882 = futhark_mc_task_128068->free_neg_res_43882;
    int64_t eta_p_106382 = futhark_mc_task_128068->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128068->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_128068->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128068->free_distrs_mem_111708, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_task_128068->free_bytes_111715;
    struct memblock mem_111727 = {.desc ="mem_111727", .mem =futhark_mc_task_128068->free_mem_111727, .size =0, .references =NULL};
    struct memblock mem_111993 = {.desc ="mem_111993", .mem =futhark_mc_task_128068->free_mem_111993, .size =0, .references =NULL};
    struct memblock mem_111997 = {.desc ="mem_111997", .mem =futhark_mc_task_128068->free_mem_111997, .size =0, .references =NULL};
    struct memblock mem_111999 = {.desc ="mem_111999", .mem =futhark_mc_task_128068->free_mem_111999, .size =0, .references =NULL};
    struct memblock mem_112032 = {.desc ="mem_112032", .mem =futhark_mc_task_128068->free_mem_112032, .size =0, .references =NULL};
    struct memblock mem_112034 = {.desc ="mem_112034", .mem =futhark_mc_task_128068->free_mem_112034, .size =0, .references =NULL};
    struct memblock mem_param_118926 = {.desc ="mem_param_118926", .mem =futhark_mc_task_128068->free_mem_param_118926, .size =0, .references =NULL};
    struct memblock mem_param_118927 = {.desc ="mem_param_118927", .mem =futhark_mc_task_128068->free_mem_param_118927, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_task_128068->free_mem_param_118928, .size =0, .references =NULL};
    double defunc_res_118937 = futhark_mc_task_128068->free_defunc_res_118937;
    double zt_res_119033 = futhark_mc_task_128068->free_zt_res_119033;
    double zp_res_119086 = futhark_mc_task_128068->free_zp_res_119086;
    int32_t nsubtasks_123792;
    
    nsubtasks_123792 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_128078 futhark_mc_segmap_parloop_struct_128078_;
    
    futhark_mc_segmap_parloop_struct_128078_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_128078_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_128078_.free_neg_res_43882 = neg_res_43882;
    futhark_mc_segmap_parloop_struct_128078_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segmap_parloop_struct_128078_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segmap_parloop_struct_128078_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segmap_parloop_struct_128078_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segmap_parloop_struct_128078_.free_bytes_111715 = bytes_111715;
    futhark_mc_segmap_parloop_struct_128078_.free_mem_111727 = mem_111727.mem;
    futhark_mc_segmap_parloop_struct_128078_.free_mem_111993 = mem_111993.mem;
    futhark_mc_segmap_parloop_struct_128078_.free_mem_111997 = mem_111997.mem;
    futhark_mc_segmap_parloop_struct_128078_.free_mem_111999 = mem_111999.mem;
    futhark_mc_segmap_parloop_struct_128078_.free_mem_112032 = mem_112032.mem;
    futhark_mc_segmap_parloop_struct_128078_.free_mem_112034 = mem_112034.mem;
    futhark_mc_segmap_parloop_struct_128078_.free_mem_param_118926 = mem_param_118926.mem;
    futhark_mc_segmap_parloop_struct_128078_.free_mem_param_118927 = mem_param_118927.mem;
    futhark_mc_segmap_parloop_struct_128078_.free_mem_param_118928 = mem_param_118928.mem;
    futhark_mc_segmap_parloop_struct_128078_.free_defunc_res_118937 = defunc_res_118937;
    futhark_mc_segmap_parloop_struct_128078_.free_zt_res_119033 = zt_res_119033;
    futhark_mc_segmap_parloop_struct_128078_.free_zp_res_119086 = zp_res_119086;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_128079_task;
    
    futhark_mc_segmap_parloop_128079_task.name = "futhark_mc_segmap_parloop_128079";
    futhark_mc_segmap_parloop_128079_task.fn = futhark_mc_segmap_parloop_128079;
    futhark_mc_segmap_parloop_128079_task.args = &futhark_mc_segmap_parloop_struct_128078_;
    futhark_mc_segmap_parloop_128079_task.iterations = iterations;
    futhark_mc_segmap_parloop_128079_task.info = info;
    
    struct mc_event *event_128141 = mc_event_new(ctx);
    
    if (event_128141 != NULL)
        event_128141->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_128079_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_128079_task);
    
    if (futhark_mc_segmap_parloop_128079_err != 0) {
        err = futhark_mc_segmap_parloop_128079_err;
        goto cleanup;
    }
    if (event_128141 != NULL) {
        event_128141->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128079_total", strdup("nothing further"), event_128141, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_128142 != NULL) {
        event_128142->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_nested_task_128077", strdup("nothing further"), event_128142, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_128143 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_44883;
    double free_zs_res_44885;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    int64_t free_bytes_111715;
    unsigned char *free_mem_112032;
    unsigned char *free_mem_param_118927;
    int64_t free_flat_tid_119279;
    int64_t free_flat_tid_119312;
    bool *retval_defunc_0_reduce_res_119275;
    unsigned char *retval_mem_112046;
    unsigned char *retval_mem_112048;
    unsigned char *retval_mem_112051;
};
struct futhark_mc_segred_stage_1_parloop_struct_128146 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_44883;
    double free_zs_res_44885;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    int64_t free_bytes_111715;
    unsigned char *free_mem_112032;
    unsigned char *free_mem_112046;
    unsigned char *free_mem_112048;
    unsigned char *free_mem_112051;
    unsigned char *free_mem_param_118927;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124009;
};
static int futhark_mc_segred_stage_1_parloop_128147(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128146 *futhark_mc_segred_stage_1_parloop_struct_128146 = (struct futhark_mc_segred_stage_1_parloop_struct_128146 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128146->ctx;
    struct mc_event *event_128149 = mc_event_new(ctx);
    
    if (event_128149 != NULL)
        event_128149->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128146->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_segred_stage_1_parloop_struct_128146->free_exp_absorb_cutoff_33394;
    double zs_res_44883 = futhark_mc_segred_stage_1_parloop_struct_128146->free_zs_res_44883;
    double zs_res_44885 = futhark_mc_segred_stage_1_parloop_struct_128146->free_zs_res_44885;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128146->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_128146->free_distrs_mem_111708, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_segred_stage_1_parloop_struct_128146->free_bytes_111715;
    struct memblock mem_112032 = {.desc ="mem_112032", .mem =futhark_mc_segred_stage_1_parloop_struct_128146->free_mem_112032, .size =0, .references =NULL};
    struct memblock mem_112046 = {.desc ="mem_112046", .mem =futhark_mc_segred_stage_1_parloop_struct_128146->free_mem_112046, .size =0, .references =NULL};
    struct memblock mem_112048 = {.desc ="mem_112048", .mem =futhark_mc_segred_stage_1_parloop_struct_128146->free_mem_112048, .size =0, .references =NULL};
    struct memblock mem_112051 = {.desc ="mem_112051", .mem =futhark_mc_segred_stage_1_parloop_struct_128146->free_mem_112051, .size =0, .references =NULL};
    struct memblock mem_param_118927 = {.desc ="mem_param_118927", .mem =futhark_mc_segred_stage_1_parloop_struct_128146->free_mem_param_118927, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_124009 = {.desc ="reduce_stage_1_tid_res_arr_mem_124009", .mem =futhark_mc_segred_stage_1_parloop_struct_128146->free_reduce_stage_1_tid_res_arr_mem_124009, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t mem_119325_cached_sizze_128148 = 0;
    unsigned char *mem_119325 = NULL;
    int64_t flat_tid_119312;
    
    flat_tid_119312 = subtask_id;
    {
        bool eta_p_124011;
        bool eta_p_124012;
        bool local_acc_124014 = 0;
        bool eta_p_119314;
        bool eta_p_119315;
        bool local_acc_124015 = 0;
        int64_t start_124016;
        int64_t end_124017;
        
        start_124016 = start;
        end_124017 = end;
        
        int64_t n_124018 = end_124017 - start_124016;
        
        if (mem_119325_cached_sizze_128148 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_119325, &mem_119325_cached_sizze_128148, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        for (int64_t SegRed_i_124019 = start_124016; SegRed_i_124019 < start_124016 + n_124018; SegRed_i_124019++) {
            int64_t gtid_119313 = SegRed_i_124019;
            double eta_p_119317 = ((double *) mem_param_118927.mem)[gtid_119313];
            double eta_p_119318 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + gtid_119313];
            double defunc_0_reduce_res_119319;
            double redout_119321 = INFINITY;
            
            for (int64_t i_119320 = 0; i_119320 < m_33388; i_119320++) {
                double eta_p_119322 = ((double *) mem_112032.mem)[i_119320 * m_33388 + gtid_119313];
                double zm_res_119323 = 30.0 - eta_p_119322;
                double min_res_119324 = fmin64(zm_res_119323, redout_119321);
                double redout_tmp_124020 = min_res_119324;
                
                redout_119321 = redout_tmp_124020;
            }
            defunc_0_reduce_res_119319 = redout_119321;
            
            double defunc_0_reduce_res_119327;
            double redout_119330 = 0.0;
            
            for (int64_t i_119329 = 0; i_119329 < m_33388; i_119329++) {
                double eta_p_119332 = ((double *) mem_112032.mem)[i_119329 * m_33388 + gtid_119313];
                double zp_res_119333 = defunc_0_reduce_res_119319 + eta_p_119332;
                double exp_res_119334 = futrts_exp64(zp_res_119333);
                double zp_res_119335 = exp_res_119334 + redout_119330;
                
                ((double *) mem_119325)[i_119329] = exp_res_119334;
                
                double redout_tmp_124021 = zp_res_119335;
                
                redout_119330 = redout_tmp_124021;
            }
            defunc_0_reduce_res_119327 = redout_119330;
            
            double zp_res_119337 = eta_p_119317 + defunc_0_reduce_res_119319;
            double zs_res_119338 = defunc_0_reduce_res_119327 / eta_p_119318;
            double ztzt_res_119339 = fpow64(zs_res_119338, zs_res_44883);
            double zt_res_119340 = zs_res_44885 * zp_res_119337;
            double exp_res_119341 = futrts_exp64(zt_res_119340);
            double zt_res_119342 = ztzt_res_119339 * exp_res_119341;
            bool zgze_res_119343 = exp_absorb_cutoff_33394 <= zt_res_119342;
            
            // save map-out results
            {
                ((double *) mem_112046.mem)[gtid_119313] = zt_res_119342;
                ((double *) mem_112048.mem)[gtid_119313] = zp_res_119337;
                lmad_copy_8b(ctx, 1, (uint64_t *) mem_112051.mem, gtid_119313 * m_33388, (int64_t []) {(int64_t) 1}, (uint64_t *) mem_119325, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_33388});
            }
            // Load accum params
            {
                eta_p_119314 = local_acc_124015;
            }
            // Load next params
            {
                eta_p_119315 = zgze_res_119343;
            }
            // SegRed body
            {
                bool defunc_0_op_res_119316 = eta_p_119314 || eta_p_119315;
                
                local_acc_124015 = defunc_0_op_res_119316;
            }
        }
        
        int64_t uni_i_124023 = 0;
        
        {
            int64_t gtid_119313 = uni_i_124023;
            
            // Load accum params
            {
                eta_p_124011 = local_acc_124014;
            }
            // Load next params
            {
                eta_p_124012 = local_acc_124015;
            }
            // SegRed body
            {
                bool defunc_0_op_res_124013 = eta_p_124011 || eta_p_124012;
                
                local_acc_124014 = defunc_0_op_res_124013;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_124009.mem)[flat_tid_119312] = local_acc_124014;
    }
    
  cleanup:
    {
        free(mem_119325);
    }
    if (event_128149 != NULL) {
        event_128149->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128147", strdup("nothing further"), event_128149, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128144(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128143 *futhark_mc_task_128143 = (struct futhark_mc_task_128143 *) args;
    struct futhark_context *ctx = futhark_mc_task_128143->ctx;
    struct mc_event *event_128151 = mc_event_new(ctx);
    
    if (event_128151 != NULL)
        event_128151->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128143->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_task_128143->free_exp_absorb_cutoff_33394;
    double zs_res_44883 = futhark_mc_task_128143->free_zs_res_44883;
    double zs_res_44885 = futhark_mc_task_128143->free_zs_res_44885;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128143->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128143->free_distrs_mem_111708, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_task_128143->free_bytes_111715;
    struct memblock mem_112032 = {.desc ="mem_112032", .mem =futhark_mc_task_128143->free_mem_112032, .size =0, .references =NULL};
    struct memblock mem_param_118927 = {.desc ="mem_param_118927", .mem =futhark_mc_task_128143->free_mem_param_118927, .size =0, .references =NULL};
    int64_t flat_tid_119279 = futhark_mc_task_128143->free_flat_tid_119279;
    int64_t flat_tid_119312 = futhark_mc_task_128143->free_flat_tid_119312;
    bool defunc_0_reduce_res_119275 = *futhark_mc_task_128143->retval_defunc_0_reduce_res_119275;
    struct memblock mem_112046 = {.desc ="mem_112046", .mem =futhark_mc_task_128143->retval_mem_112046, .size =0, .references =NULL};
    struct memblock mem_112048 = {.desc ="mem_112048", .mem =futhark_mc_task_128143->retval_mem_112048, .size =0, .references =NULL};
    struct memblock mem_112051 = {.desc ="mem_112051", .mem =futhark_mc_task_128143->retval_mem_112051, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_124009_cached_sizze_128145 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124009 = NULL;
    int32_t nsubtasks_124008;
    
    nsubtasks_124008 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124009_cached_sizze_128145 < nsubtasks_124008) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124009, &reduce_stage_1_tid_res_arr_mem_124009_cached_sizze_128145, nsubtasks_124008);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128146 futhark_mc_segred_stage_1_parloop_struct_128146_;
    
    futhark_mc_segred_stage_1_parloop_struct_128146_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128146_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128146_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segred_stage_1_parloop_struct_128146_.free_zs_res_44883 = zs_res_44883;
    futhark_mc_segred_stage_1_parloop_struct_128146_.free_zs_res_44885 = zs_res_44885;
    futhark_mc_segred_stage_1_parloop_struct_128146_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128146_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_128146_.free_bytes_111715 = bytes_111715;
    futhark_mc_segred_stage_1_parloop_struct_128146_.free_mem_112032 = mem_112032.mem;
    futhark_mc_segred_stage_1_parloop_struct_128146_.free_mem_112046 = mem_112046.mem;
    futhark_mc_segred_stage_1_parloop_struct_128146_.free_mem_112048 = mem_112048.mem;
    futhark_mc_segred_stage_1_parloop_struct_128146_.free_mem_112051 = mem_112051.mem;
    futhark_mc_segred_stage_1_parloop_struct_128146_.free_mem_param_118927 = mem_param_118927.mem;
    futhark_mc_segred_stage_1_parloop_struct_128146_.free_reduce_stage_1_tid_res_arr_mem_124009 = reduce_stage_1_tid_res_arr_mem_124009;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128147_task;
    
    futhark_mc_segred_stage_1_parloop_128147_task.name = "futhark_mc_segred_stage_1_parloop_128147";
    futhark_mc_segred_stage_1_parloop_128147_task.fn = futhark_mc_segred_stage_1_parloop_128147;
    futhark_mc_segred_stage_1_parloop_128147_task.args = &futhark_mc_segred_stage_1_parloop_struct_128146_;
    futhark_mc_segred_stage_1_parloop_128147_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128147_task.info = info;
    
    struct mc_event *event_128150 = mc_event_new(ctx);
    
    if (event_128150 != NULL)
        event_128150->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128147_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128147_task);
    
    if (futhark_mc_segred_stage_1_parloop_128147_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128147_err;
        goto cleanup;
    }
    if (event_128150 != NULL) {
        event_128150->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128147_total", strdup("nothing further"), event_128150, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_119275 = 0;
    }
    
    bool eta_p_124024;
    bool eta_p_124025;
    
    for (int32_t i_124027 = 0; i_124027 < nsubtasks_124008; i_124027++) {
        flat_tid_119312 = i_124027;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124024 = defunc_0_reduce_res_119275;
            }
            // load next params
            {
                eta_p_124025 = ((bool *) reduce_stage_1_tid_res_arr_mem_124009)[flat_tid_119312];
            }
            // red body
            {
                bool defunc_0_op_res_124026 = eta_p_124024 || eta_p_124025;
                
                defunc_0_reduce_res_119275 = defunc_0_op_res_124026;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124009);
    }
    if (event_128151 != NULL) {
        event_128151->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128144", strdup("nothing further"), event_128151, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128143->retval_defunc_0_reduce_res_119275 = defunc_0_reduce_res_119275;
        futhark_mc_task_128143->retval_mem_112046 = mem_112046.mem;
        futhark_mc_task_128143->retval_mem_112048 = mem_112048.mem;
        futhark_mc_task_128143->retval_mem_112051 = mem_112051.mem;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_128154 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_44883;
    double free_zs_res_44885;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    int64_t free_bytes_111715;
    unsigned char *free_mem_112032;
    unsigned char *free_mem_112046;
    unsigned char *free_mem_112048;
    unsigned char *free_mem_112051;
    unsigned char *free_mem_param_118927;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124029;
};
struct futhark_mc_task_128157 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_112032;
    int64_t free_gtid_119280;
    int64_t free_flat_tid_119287;
    double *retval_defunc_0_reduce_res_119286;
};
struct futhark_mc_segred_stage_1_parloop_struct_128160 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_112032;
    int64_t free_gtid_119280;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124041;
};
static int futhark_mc_segred_stage_1_parloop_128161(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128160 *futhark_mc_segred_stage_1_parloop_struct_128160 = (struct futhark_mc_segred_stage_1_parloop_struct_128160 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128160->ctx;
    struct mc_event *event_128162 = mc_event_new(ctx);
    
    if (event_128162 != NULL)
        event_128162->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128160->free_m_33388;
    struct memblock mem_112032 = {.desc ="mem_112032", .mem =futhark_mc_segred_stage_1_parloop_struct_128160->free_mem_112032, .size =0, .references =NULL};
    int64_t gtid_119280 = futhark_mc_segred_stage_1_parloop_struct_128160->free_gtid_119280;
    struct memblock reduce_stage_1_tid_res_arr_mem_124041 = {.desc ="reduce_stage_1_tid_res_arr_mem_124041", .mem =futhark_mc_segred_stage_1_parloop_struct_128160->free_reduce_stage_1_tid_res_arr_mem_124041, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_119287;
    
    flat_tid_119287 = subtask_id;
    {
        double eta_p_124043;
        double eta_p_124044;
        double local_acc_124046 = INFINITY;
        double eta_p_119289;
        double eta_p_119290;
        double local_acc_124047 = INFINITY;
        int64_t start_124048;
        int64_t end_124049;
        
        start_124048 = start;
        end_124049 = end;
        
        int64_t n_124050 = end_124049 - start_124048;
        
        for (int64_t SegRed_i_124051 = start_124048; SegRed_i_124051 < start_124048 + n_124050; SegRed_i_124051++) {
            int64_t gtid_119288 = SegRed_i_124051;
            double eta_p_119292 = ((double *) mem_112032.mem)[gtid_119288 * m_33388 + gtid_119280];
            double zm_res_119293 = 30.0 - eta_p_119292;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_119289 = local_acc_124047;
            }
            // Load next params
            {
                eta_p_119290 = zm_res_119293;
            }
            // SegRed body
            {
                double min_res_119291 = fmin64(eta_p_119289, eta_p_119290);
                
                local_acc_124047 = min_res_119291;
            }
        }
        
        int64_t uni_i_124052 = 0;
        
        {
            int64_t gtid_119288 = uni_i_124052;
            
            // Load accum params
            {
                eta_p_124043 = local_acc_124046;
            }
            // Load next params
            {
                eta_p_124044 = local_acc_124047;
            }
            // SegRed body
            {
                double min_res_124045 = fmin64(eta_p_124043, eta_p_124044);
                
                local_acc_124046 = min_res_124045;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_124041.mem)[flat_tid_119287] = local_acc_124046;
    }
    
  cleanup:
    { }
    if (event_128162 != NULL) {
        event_128162->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128161", strdup("nothing further"), event_128162, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128158(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128157 *futhark_mc_task_128157 = (struct futhark_mc_task_128157 *) args;
    struct futhark_context *ctx = futhark_mc_task_128157->ctx;
    struct mc_event *event_128164 = mc_event_new(ctx);
    
    if (event_128164 != NULL)
        event_128164->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128157->free_m_33388;
    struct memblock mem_112032 = {.desc ="mem_112032", .mem =futhark_mc_task_128157->free_mem_112032, .size =0, .references =NULL};
    int64_t gtid_119280 = futhark_mc_task_128157->free_gtid_119280;
    int64_t flat_tid_119287 = futhark_mc_task_128157->free_flat_tid_119287;
    double defunc_0_reduce_res_119286 = *futhark_mc_task_128157->retval_defunc_0_reduce_res_119286;
    int64_t reduce_stage_1_tid_res_arr_mem_124041_cached_sizze_128159 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124041 = NULL;
    int32_t nsubtasks_124040;
    
    nsubtasks_124040 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124041_cached_sizze_128159 < (int64_t) 8 * nsubtasks_124040) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124041, &reduce_stage_1_tid_res_arr_mem_124041_cached_sizze_128159, (int64_t) 8 * nsubtasks_124040);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128160 futhark_mc_segred_stage_1_parloop_struct_128160_;
    
    futhark_mc_segred_stage_1_parloop_struct_128160_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128160_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128160_.free_mem_112032 = mem_112032.mem;
    futhark_mc_segred_stage_1_parloop_struct_128160_.free_gtid_119280 = gtid_119280;
    futhark_mc_segred_stage_1_parloop_struct_128160_.free_reduce_stage_1_tid_res_arr_mem_124041 = reduce_stage_1_tid_res_arr_mem_124041;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128161_task;
    
    futhark_mc_segred_stage_1_parloop_128161_task.name = "futhark_mc_segred_stage_1_parloop_128161";
    futhark_mc_segred_stage_1_parloop_128161_task.fn = futhark_mc_segred_stage_1_parloop_128161;
    futhark_mc_segred_stage_1_parloop_128161_task.args = &futhark_mc_segred_stage_1_parloop_struct_128160_;
    futhark_mc_segred_stage_1_parloop_128161_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128161_task.info = info;
    
    struct mc_event *event_128163 = mc_event_new(ctx);
    
    if (event_128163 != NULL)
        event_128163->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128161_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128161_task);
    
    if (futhark_mc_segred_stage_1_parloop_128161_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128161_err;
        goto cleanup;
    }
    if (event_128163 != NULL) {
        event_128163->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128161_total", strdup("nothing further"), event_128163, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_119286 = INFINITY;
    }
    
    double eta_p_124053;
    double eta_p_124054;
    
    for (int32_t i_124056 = 0; i_124056 < nsubtasks_124040; i_124056++) {
        flat_tid_119287 = i_124056;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124053 = defunc_0_reduce_res_119286;
            }
            // load next params
            {
                eta_p_124054 = ((double *) reduce_stage_1_tid_res_arr_mem_124041)[flat_tid_119287];
            }
            // red body
            {
                double min_res_124055 = fmin64(eta_p_124053, eta_p_124054);
                
                defunc_0_reduce_res_119286 = min_res_124055;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124041);
    }
    if (event_128164 != NULL) {
        event_128164->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128158", strdup("nothing further"), event_128164, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128157->retval_defunc_0_reduce_res_119286 = defunc_0_reduce_res_119286;
    }
    return err;
}
struct futhark_mc_task_128165 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_112032;
    int64_t free_gtid_119280;
    double free_defunc_0_reduce_res_119286;
    int64_t free_flat_tid_119297;
    double *retval_defunc_0_reduce_res_119295;
    unsigned char *retval_mem_119294;
};
struct futhark_mc_segred_stage_1_parloop_struct_128168 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_112032;
    int64_t free_gtid_119280;
    double free_defunc_0_reduce_res_119286;
    unsigned char *free_mem_119294;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124058;
};
static int futhark_mc_segred_stage_1_parloop_128169(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128168 *futhark_mc_segred_stage_1_parloop_struct_128168 = (struct futhark_mc_segred_stage_1_parloop_struct_128168 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128168->ctx;
    struct mc_event *event_128170 = mc_event_new(ctx);
    
    if (event_128170 != NULL)
        event_128170->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128168->free_m_33388;
    struct memblock mem_112032 = {.desc ="mem_112032", .mem =futhark_mc_segred_stage_1_parloop_struct_128168->free_mem_112032, .size =0, .references =NULL};
    int64_t gtid_119280 = futhark_mc_segred_stage_1_parloop_struct_128168->free_gtid_119280;
    double defunc_0_reduce_res_119286 = futhark_mc_segred_stage_1_parloop_struct_128168->free_defunc_0_reduce_res_119286;
    struct memblock mem_119294 = {.desc ="mem_119294", .mem =futhark_mc_segred_stage_1_parloop_struct_128168->free_mem_119294, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_124058 = {.desc ="reduce_stage_1_tid_res_arr_mem_124058", .mem =futhark_mc_segred_stage_1_parloop_struct_128168->free_reduce_stage_1_tid_res_arr_mem_124058, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_119297;
    
    flat_tid_119297 = subtask_id;
    {
        double eta_p_124060;
        double eta_p_124061;
        double local_acc_124063 = 0.0;
        double eta_p_119299;
        double eta_p_119300;
        double local_acc_124064 = 0.0;
        int64_t start_124065;
        int64_t end_124066;
        
        start_124065 = start;
        end_124066 = end;
        
        int64_t n_124067 = end_124066 - start_124065;
        
        for (int64_t SegRed_i_124068 = start_124065; SegRed_i_124068 < start_124065 + n_124067; SegRed_i_124068++) {
            int64_t gtid_119298 = SegRed_i_124068;
            double eta_p_119302 = ((double *) mem_112032.mem)[gtid_119298 * m_33388 + gtid_119280];
            double zp_res_119303 = defunc_0_reduce_res_119286 + eta_p_119302;
            double exp_res_119304 = futrts_exp64(zp_res_119303);
            
            // save map-out results
            {
                ((double *) mem_119294.mem)[gtid_119298] = exp_res_119304;
            }
            // Load accum params
            {
                eta_p_119299 = local_acc_124064;
            }
            // Load next params
            {
                eta_p_119300 = exp_res_119304;
            }
            // SegRed body
            {
                double zp_res_119301 = eta_p_119299 + eta_p_119300;
                
                local_acc_124064 = zp_res_119301;
            }
        }
        
        int64_t uni_i_124069 = 0;
        
        {
            int64_t gtid_119298 = uni_i_124069;
            
            // Load accum params
            {
                eta_p_124060 = local_acc_124063;
            }
            // Load next params
            {
                eta_p_124061 = local_acc_124064;
            }
            // SegRed body
            {
                double zp_res_124062 = eta_p_124060 + eta_p_124061;
                
                local_acc_124063 = zp_res_124062;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_124058.mem)[flat_tid_119297] = local_acc_124063;
    }
    
  cleanup:
    { }
    if (event_128170 != NULL) {
        event_128170->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128169", strdup("nothing further"), event_128170, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128166(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128165 *futhark_mc_task_128165 = (struct futhark_mc_task_128165 *) args;
    struct futhark_context *ctx = futhark_mc_task_128165->ctx;
    struct mc_event *event_128172 = mc_event_new(ctx);
    
    if (event_128172 != NULL)
        event_128172->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128165->free_m_33388;
    struct memblock mem_112032 = {.desc ="mem_112032", .mem =futhark_mc_task_128165->free_mem_112032, .size =0, .references =NULL};
    int64_t gtid_119280 = futhark_mc_task_128165->free_gtid_119280;
    double defunc_0_reduce_res_119286 = futhark_mc_task_128165->free_defunc_0_reduce_res_119286;
    int64_t flat_tid_119297 = futhark_mc_task_128165->free_flat_tid_119297;
    double defunc_0_reduce_res_119295 = *futhark_mc_task_128165->retval_defunc_0_reduce_res_119295;
    struct memblock mem_119294 = {.desc ="mem_119294", .mem =futhark_mc_task_128165->retval_mem_119294, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_124058_cached_sizze_128167 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124058 = NULL;
    int32_t nsubtasks_124057;
    
    nsubtasks_124057 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124058_cached_sizze_128167 < (int64_t) 8 * nsubtasks_124057) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124058, &reduce_stage_1_tid_res_arr_mem_124058_cached_sizze_128167, (int64_t) 8 * nsubtasks_124057);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128168 futhark_mc_segred_stage_1_parloop_struct_128168_;
    
    futhark_mc_segred_stage_1_parloop_struct_128168_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128168_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128168_.free_mem_112032 = mem_112032.mem;
    futhark_mc_segred_stage_1_parloop_struct_128168_.free_gtid_119280 = gtid_119280;
    futhark_mc_segred_stage_1_parloop_struct_128168_.free_defunc_0_reduce_res_119286 = defunc_0_reduce_res_119286;
    futhark_mc_segred_stage_1_parloop_struct_128168_.free_mem_119294 = mem_119294.mem;
    futhark_mc_segred_stage_1_parloop_struct_128168_.free_reduce_stage_1_tid_res_arr_mem_124058 = reduce_stage_1_tid_res_arr_mem_124058;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128169_task;
    
    futhark_mc_segred_stage_1_parloop_128169_task.name = "futhark_mc_segred_stage_1_parloop_128169";
    futhark_mc_segred_stage_1_parloop_128169_task.fn = futhark_mc_segred_stage_1_parloop_128169;
    futhark_mc_segred_stage_1_parloop_128169_task.args = &futhark_mc_segred_stage_1_parloop_struct_128168_;
    futhark_mc_segred_stage_1_parloop_128169_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128169_task.info = info;
    
    struct mc_event *event_128171 = mc_event_new(ctx);
    
    if (event_128171 != NULL)
        event_128171->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128169_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128169_task);
    
    if (futhark_mc_segred_stage_1_parloop_128169_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128169_err;
        goto cleanup;
    }
    if (event_128171 != NULL) {
        event_128171->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128169_total", strdup("nothing further"), event_128171, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_119295 = 0.0;
    }
    
    double eta_p_124070;
    double eta_p_124071;
    
    for (int32_t i_124073 = 0; i_124073 < nsubtasks_124057; i_124073++) {
        flat_tid_119297 = i_124073;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124070 = defunc_0_reduce_res_119295;
            }
            // load next params
            {
                eta_p_124071 = ((double *) reduce_stage_1_tid_res_arr_mem_124058)[flat_tid_119297];
            }
            // red body
            {
                double zp_res_124072 = eta_p_124070 + eta_p_124071;
                
                defunc_0_reduce_res_119295 = zp_res_124072;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124058);
    }
    if (event_128172 != NULL) {
        event_128172->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128166", strdup("nothing further"), event_128172, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128165->retval_defunc_0_reduce_res_119295 = defunc_0_reduce_res_119295;
        futhark_mc_task_128165->retval_mem_119294 = mem_119294.mem;
    }
    return err;
}
struct futhark_mc_task_128173 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_112051;
    int64_t free_gtid_119280;
    unsigned char *free_mem_119294;
};
struct futhark_mc_copy_parloop_struct_128175 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_112051;
    int64_t free_gtid_119280;
    unsigned char *free_mem_119294;
};
static int futhark_mc_copy_parloop_128176(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_copy_parloop_struct_128175 *futhark_mc_copy_parloop_struct_128175 = (struct futhark_mc_copy_parloop_struct_128175 *) args;
    struct futhark_context *ctx = futhark_mc_copy_parloop_struct_128175->ctx;
    struct mc_event *event_128177 = mc_event_new(ctx);
    
    if (event_128177 != NULL)
        event_128177->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_copy_parloop_struct_128175->free_m_33388;
    struct memblock mem_112051 = {.desc ="mem_112051", .mem =futhark_mc_copy_parloop_struct_128175->free_mem_112051, .size =0, .references =NULL};
    int64_t gtid_119280 = futhark_mc_copy_parloop_struct_128175->free_gtid_119280;
    struct memblock mem_119294 = {.desc ="mem_119294", .mem =futhark_mc_copy_parloop_struct_128175->free_mem_119294, .size =0, .references =NULL};
    int64_t iterations = end - start;
    
    {
        int64_t start_124074;
        int64_t end_124075;
        
        start_124074 = start;
        end_124075 = end;
        
        int64_t n_124076 = end_124075 - start_124074;
        
        for (int64_t copy_i_124077 = start_124074; copy_i_124077 < start_124074 + n_124076; copy_i_124077++) {
            int64_t slice_124079 = m_33388;
            int64_t i_124078 = copy_i_124077;
            int64_t remnant_124080 = copy_i_124077 - i_124078;
            double tmp_124081 = ((double *) mem_119294.mem)[i_124078];
            
            ((double *) mem_112051.mem)[gtid_119280 * m_33388 + i_124078] = tmp_124081;
        }
    }
    
  cleanup:
    { }
    if (event_128177 != NULL) {
        event_128177->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_parloop_128176", strdup("nothing further"), event_128177, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_copy_124082_task_128174(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128173 *futhark_mc_task_128173 = (struct futhark_mc_task_128173 *) args;
    struct futhark_context *ctx = futhark_mc_task_128173->ctx;
    struct mc_event *event_128179 = mc_event_new(ctx);
    
    if (event_128179 != NULL)
        event_128179->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128173->free_m_33388;
    struct memblock mem_112051 = {.desc ="mem_112051", .mem =futhark_mc_task_128173->free_mem_112051, .size =0, .references =NULL};
    int64_t gtid_119280 = futhark_mc_task_128173->free_gtid_119280;
    struct memblock mem_119294 = {.desc ="mem_119294", .mem =futhark_mc_task_128173->free_mem_119294, .size =0, .references =NULL};
    struct futhark_mc_copy_parloop_struct_128175 futhark_mc_copy_parloop_struct_128175_;
    
    futhark_mc_copy_parloop_struct_128175_.ctx = ctx;
    futhark_mc_copy_parloop_struct_128175_.free_m_33388 = m_33388;
    futhark_mc_copy_parloop_struct_128175_.free_mem_112051 = mem_112051.mem;
    futhark_mc_copy_parloop_struct_128175_.free_gtid_119280 = gtid_119280;
    futhark_mc_copy_parloop_struct_128175_.free_mem_119294 = mem_119294.mem;
    
    struct scheduler_parloop futhark_mc_copy_parloop_128176_task;
    
    futhark_mc_copy_parloop_128176_task.name = "futhark_mc_copy_parloop_128176";
    futhark_mc_copy_parloop_128176_task.fn = futhark_mc_copy_parloop_128176;
    futhark_mc_copy_parloop_128176_task.args = &futhark_mc_copy_parloop_struct_128175_;
    futhark_mc_copy_parloop_128176_task.iterations = iterations;
    futhark_mc_copy_parloop_128176_task.info = info;
    
    struct mc_event *event_128178 = mc_event_new(ctx);
    
    if (event_128178 != NULL)
        event_128178->bef = get_wall_time();
    
    int futhark_mc_copy_parloop_128176_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_copy_parloop_128176_task);
    
    if (futhark_mc_copy_parloop_128176_err != 0) {
        err = futhark_mc_copy_parloop_128176_err;
        goto cleanup;
    }
    if (event_128178 != NULL) {
        event_128178->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_parloop_128176_total", strdup("nothing further"), event_128178, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_128179 != NULL) {
        event_128179->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_124082_task_128174", strdup("nothing further"), event_128179, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_128155(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128154 *futhark_mc_segred_stage_1_parloop_struct_128154 = (struct futhark_mc_segred_stage_1_parloop_struct_128154 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128154->ctx;
    struct mc_event *event_128180 = mc_event_new(ctx);
    
    if (event_128180 != NULL)
        event_128180->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128154->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_segred_stage_1_parloop_struct_128154->free_exp_absorb_cutoff_33394;
    double zs_res_44883 = futhark_mc_segred_stage_1_parloop_struct_128154->free_zs_res_44883;
    double zs_res_44885 = futhark_mc_segred_stage_1_parloop_struct_128154->free_zs_res_44885;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128154->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_128154->free_distrs_mem_111708, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_segred_stage_1_parloop_struct_128154->free_bytes_111715;
    struct memblock mem_112032 = {.desc ="mem_112032", .mem =futhark_mc_segred_stage_1_parloop_struct_128154->free_mem_112032, .size =0, .references =NULL};
    struct memblock mem_112046 = {.desc ="mem_112046", .mem =futhark_mc_segred_stage_1_parloop_struct_128154->free_mem_112046, .size =0, .references =NULL};
    struct memblock mem_112048 = {.desc ="mem_112048", .mem =futhark_mc_segred_stage_1_parloop_struct_128154->free_mem_112048, .size =0, .references =NULL};
    struct memblock mem_112051 = {.desc ="mem_112051", .mem =futhark_mc_segred_stage_1_parloop_struct_128154->free_mem_112051, .size =0, .references =NULL};
    struct memblock mem_param_118927 = {.desc ="mem_param_118927", .mem =futhark_mc_segred_stage_1_parloop_struct_128154->free_mem_param_118927, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_124029 = {.desc ="reduce_stage_1_tid_res_arr_mem_124029", .mem =futhark_mc_segred_stage_1_parloop_struct_128154->free_reduce_stage_1_tid_res_arr_mem_124029, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t mem_119294_cached_sizze_128156 = 0;
    unsigned char *mem_119294 = NULL;
    int64_t flat_tid_119279;
    
    flat_tid_119279 = subtask_id;
    {
        bool eta_p_124031;
        bool eta_p_124032;
        bool local_acc_124034 = 0;
        bool eta_p_119281;
        bool eta_p_119282;
        bool local_acc_124035 = 0;
        int64_t start_124036;
        int64_t end_124037;
        
        start_124036 = start;
        end_124037 = end;
        
        int64_t n_124038 = end_124037 - start_124036;
        
        if (mem_119294_cached_sizze_128156 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_119294, &mem_119294_cached_sizze_128156, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        for (int64_t SegRed_i_124039 = start_124036; SegRed_i_124039 < start_124036 + n_124038; SegRed_i_124039++) {
            int64_t gtid_119280 = SegRed_i_124039;
            double eta_p_119284 = ((double *) mem_param_118927.mem)[gtid_119280];
            double eta_p_119285 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + gtid_119280];
            double defunc_0_reduce_res_119286;
            int64_t flat_tid_119287 = (int64_t) 0;
            
            defunc_0_reduce_res_119286 = 0.0;
            
            struct futhark_mc_task_128157 futhark_mc_task_128157_;
            
            futhark_mc_task_128157_.ctx = ctx;
            futhark_mc_task_128157_.free_m_33388 = m_33388;
            futhark_mc_task_128157_.free_mem_112032 = mem_112032.mem;
            futhark_mc_task_128157_.free_gtid_119280 = gtid_119280;
            futhark_mc_task_128157_.free_flat_tid_119287 = flat_tid_119287;
            futhark_mc_task_128157_.retval_defunc_0_reduce_res_119286 = (double *) &defunc_0_reduce_res_119286;
            #if ISPC
            futhark_mc_task_128157_.retval_defunc_0_reduce_res_119286 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_128157_task;
            
            futhark_mc_task_128157_task.args = &futhark_mc_task_128157_;
            futhark_mc_task_128157_task.top_level_fn = futhark_mc_segred_task_128158;
            futhark_mc_task_128157_task.name = "futhark_mc_segred_task_128158";
            futhark_mc_task_128157_task.iterations = m_33388;
            futhark_mc_task_128157_task.task_time = &ctx->program->futhark_mc_segred_task_128158_total_time;
            futhark_mc_task_128157_task.task_iter = &ctx->program->futhark_mc_segred_task_128158_total_iter;
            futhark_mc_task_128157_task.sched = STATIC;
            futhark_mc_task_128157_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_128158_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128157_task);
            
            if (futhark_mc_segred_task_128158_err != 0) {
                err = futhark_mc_segred_task_128158_err;
                goto cleanup;
            }
            
            double defunc_0_reduce_res_119295;
            int64_t flat_tid_119297 = (int64_t) 0;
            
            defunc_0_reduce_res_119295 = 0.0;
            
            struct futhark_mc_task_128165 futhark_mc_task_128165_;
            
            futhark_mc_task_128165_.ctx = ctx;
            futhark_mc_task_128165_.free_m_33388 = m_33388;
            futhark_mc_task_128165_.free_mem_112032 = mem_112032.mem;
            futhark_mc_task_128165_.free_gtid_119280 = gtid_119280;
            futhark_mc_task_128165_.free_defunc_0_reduce_res_119286 = defunc_0_reduce_res_119286;
            futhark_mc_task_128165_.free_flat_tid_119297 = flat_tid_119297;
            futhark_mc_task_128165_.retval_defunc_0_reduce_res_119295 = (double *) &defunc_0_reduce_res_119295;
            #if ISPC
            futhark_mc_task_128165_.retval_defunc_0_reduce_res_119295 += programIndex;
            #endif
            futhark_mc_task_128165_.retval_mem_119294 = mem_119294;
            
            struct scheduler_segop futhark_mc_task_128165_task;
            
            futhark_mc_task_128165_task.args = &futhark_mc_task_128165_;
            futhark_mc_task_128165_task.top_level_fn = futhark_mc_segred_task_128166;
            futhark_mc_task_128165_task.name = "futhark_mc_segred_task_128166";
            futhark_mc_task_128165_task.iterations = m_33388;
            futhark_mc_task_128165_task.task_time = &ctx->program->futhark_mc_segred_task_128166_total_time;
            futhark_mc_task_128165_task.task_iter = &ctx->program->futhark_mc_segred_task_128166_total_iter;
            futhark_mc_task_128165_task.sched = STATIC;
            futhark_mc_task_128165_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_128166_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128165_task);
            
            if (futhark_mc_segred_task_128166_err != 0) {
                err = futhark_mc_segred_task_128166_err;
                goto cleanup;
            }
            
            double zp_res_119305 = eta_p_119284 + defunc_0_reduce_res_119286;
            double zs_res_119306 = defunc_0_reduce_res_119295 / eta_p_119285;
            double ztzt_res_119307 = fpow64(zs_res_119306, zs_res_44883);
            double zt_res_119308 = zs_res_44885 * zp_res_119305;
            double exp_res_119309 = futrts_exp64(zt_res_119308);
            double zt_res_119310 = ztzt_res_119307 * exp_res_119309;
            bool zgze_res_119311 = exp_absorb_cutoff_33394 <= zt_res_119310;
            
            // save map-out results
            {
                ((double *) mem_112046.mem)[gtid_119280] = zt_res_119310;
                ((double *) mem_112048.mem)[gtid_119280] = zp_res_119305;
                
                int64_t iterations_124083 = m_33388;
                struct futhark_mc_task_128173 futhark_mc_task_128173_;
                
                futhark_mc_task_128173_.ctx = ctx;
                futhark_mc_task_128173_.free_m_33388 = m_33388;
                futhark_mc_task_128173_.free_mem_112051 = mem_112051.mem;
                futhark_mc_task_128173_.free_gtid_119280 = gtid_119280;
                futhark_mc_task_128173_.free_mem_119294 = mem_119294;
                
                struct scheduler_segop futhark_mc_task_128173_task;
                
                futhark_mc_task_128173_task.args = &futhark_mc_task_128173_;
                futhark_mc_task_128173_task.top_level_fn = futhark_mc_copy_124082_task_128174;
                futhark_mc_task_128173_task.name = "futhark_mc_copy_124082_task_128174";
                futhark_mc_task_128173_task.iterations = iterations_124083;
                futhark_mc_task_128173_task.task_time = &ctx->program->futhark_mc_copy_124082_task_128174_total_time;
                futhark_mc_task_128173_task.task_iter = &ctx->program->futhark_mc_copy_124082_task_128174_total_iter;
                futhark_mc_task_128173_task.sched = STATIC;
                futhark_mc_task_128173_task.nested_fn = NULL;
                
                int futhark_mc_copy_124082_task_128174_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128173_task);
                
                if (futhark_mc_copy_124082_task_128174_err != 0) {
                    err = futhark_mc_copy_124082_task_128174_err;
                    goto cleanup;
                }
            }
            // Load accum params
            {
                eta_p_119281 = local_acc_124035;
            }
            // Load next params
            {
                eta_p_119282 = zgze_res_119311;
            }
            // SegRed body
            {
                bool defunc_0_op_res_119283 = eta_p_119281 || eta_p_119282;
                
                local_acc_124035 = defunc_0_op_res_119283;
            }
        }
        
        int64_t uni_i_124084 = 0;
        
        {
            int64_t gtid_119280 = uni_i_124084;
            
            // Load accum params
            {
                eta_p_124031 = local_acc_124034;
            }
            // Load next params
            {
                eta_p_124032 = local_acc_124035;
            }
            // SegRed body
            {
                bool defunc_0_op_res_124033 = eta_p_124031 || eta_p_124032;
                
                local_acc_124034 = defunc_0_op_res_124033;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_124029.mem)[flat_tid_119279] = local_acc_124034;
    }
    
  cleanup:
    {
        free(mem_119294);
    }
    if (event_128180 != NULL) {
        event_128180->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128155", strdup("nothing further"), event_128180, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_128152(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128143 *futhark_mc_task_128143 = (struct futhark_mc_task_128143 *) args;
    struct futhark_context *ctx = futhark_mc_task_128143->ctx;
    struct mc_event *event_128182 = mc_event_new(ctx);
    
    if (event_128182 != NULL)
        event_128182->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128143->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_task_128143->free_exp_absorb_cutoff_33394;
    double zs_res_44883 = futhark_mc_task_128143->free_zs_res_44883;
    double zs_res_44885 = futhark_mc_task_128143->free_zs_res_44885;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128143->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128143->free_distrs_mem_111708, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_task_128143->free_bytes_111715;
    struct memblock mem_112032 = {.desc ="mem_112032", .mem =futhark_mc_task_128143->free_mem_112032, .size =0, .references =NULL};
    struct memblock mem_param_118927 = {.desc ="mem_param_118927", .mem =futhark_mc_task_128143->free_mem_param_118927, .size =0, .references =NULL};
    int64_t flat_tid_119279 = futhark_mc_task_128143->free_flat_tid_119279;
    int64_t flat_tid_119312 = futhark_mc_task_128143->free_flat_tid_119312;
    bool defunc_0_reduce_res_119275 = *futhark_mc_task_128143->retval_defunc_0_reduce_res_119275;
    struct memblock mem_112046 = {.desc ="mem_112046", .mem =futhark_mc_task_128143->retval_mem_112046, .size =0, .references =NULL};
    struct memblock mem_112048 = {.desc ="mem_112048", .mem =futhark_mc_task_128143->retval_mem_112048, .size =0, .references =NULL};
    struct memblock mem_112051 = {.desc ="mem_112051", .mem =futhark_mc_task_128143->retval_mem_112051, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_124029_cached_sizze_128153 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124029 = NULL;
    int32_t nsubtasks_124028;
    
    nsubtasks_124028 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124029_cached_sizze_128153 < nsubtasks_124028) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124029, &reduce_stage_1_tid_res_arr_mem_124029_cached_sizze_128153, nsubtasks_124028);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128154 futhark_mc_segred_stage_1_parloop_struct_128154_;
    
    futhark_mc_segred_stage_1_parloop_struct_128154_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128154_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128154_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segred_stage_1_parloop_struct_128154_.free_zs_res_44883 = zs_res_44883;
    futhark_mc_segred_stage_1_parloop_struct_128154_.free_zs_res_44885 = zs_res_44885;
    futhark_mc_segred_stage_1_parloop_struct_128154_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128154_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_128154_.free_bytes_111715 = bytes_111715;
    futhark_mc_segred_stage_1_parloop_struct_128154_.free_mem_112032 = mem_112032.mem;
    futhark_mc_segred_stage_1_parloop_struct_128154_.free_mem_112046 = mem_112046.mem;
    futhark_mc_segred_stage_1_parloop_struct_128154_.free_mem_112048 = mem_112048.mem;
    futhark_mc_segred_stage_1_parloop_struct_128154_.free_mem_112051 = mem_112051.mem;
    futhark_mc_segred_stage_1_parloop_struct_128154_.free_mem_param_118927 = mem_param_118927.mem;
    futhark_mc_segred_stage_1_parloop_struct_128154_.free_reduce_stage_1_tid_res_arr_mem_124029 = reduce_stage_1_tid_res_arr_mem_124029;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128155_task;
    
    futhark_mc_segred_stage_1_parloop_128155_task.name = "futhark_mc_segred_stage_1_parloop_128155";
    futhark_mc_segred_stage_1_parloop_128155_task.fn = futhark_mc_segred_stage_1_parloop_128155;
    futhark_mc_segred_stage_1_parloop_128155_task.args = &futhark_mc_segred_stage_1_parloop_struct_128154_;
    futhark_mc_segred_stage_1_parloop_128155_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128155_task.info = info;
    
    struct mc_event *event_128181 = mc_event_new(ctx);
    
    if (event_128181 != NULL)
        event_128181->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128155_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128155_task);
    
    if (futhark_mc_segred_stage_1_parloop_128155_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128155_err;
        goto cleanup;
    }
    if (event_128181 != NULL) {
        event_128181->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128155_total", strdup("nothing further"), event_128181, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_119275 = 0;
    }
    
    bool eta_p_124085;
    bool eta_p_124086;
    
    for (int32_t i_124088 = 0; i_124088 < nsubtasks_124028; i_124088++) {
        flat_tid_119279 = i_124088;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124085 = defunc_0_reduce_res_119275;
            }
            // load next params
            {
                eta_p_124086 = ((bool *) reduce_stage_1_tid_res_arr_mem_124029)[flat_tid_119279];
            }
            // red body
            {
                bool defunc_0_op_res_124087 = eta_p_124085 || eta_p_124086;
                
                defunc_0_reduce_res_119275 = defunc_0_op_res_124087;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124029);
    }
    if (event_128182 != NULL) {
        event_128182->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_128152", strdup("nothing further"), event_128182, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128143->retval_defunc_0_reduce_res_119275 = defunc_0_reduce_res_119275;
        futhark_mc_task_128143->retval_mem_112046 = mem_112046.mem;
        futhark_mc_task_128143->retval_mem_112048 = mem_112048.mem;
        futhark_mc_task_128143->retval_mem_112051 = mem_112051.mem;
    }
    return err;
}
struct futhark_mc_task_128183 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_44842;
    double free_zs_res_44844;
    int64_t free_eta_p_106382;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_112034;
    unsigned char *free_mem_112046;
    unsigned char *free_mem_112051;
    unsigned char *free_mem_param_118926;
    int64_t free_flat_tid_119348;
    int64_t free_flat_tid_119372;
    bool *retval_defunc_0_reduce_res_119345;
    unsigned char *retval_mem_112053;
    unsigned char *retval_mem_112055;
};
struct futhark_mc_segred_stage_1_parloop_struct_128186 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_44842;
    double free_zs_res_44844;
    int64_t free_eta_p_106382;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_112034;
    unsigned char *free_mem_112046;
    unsigned char *free_mem_112051;
    unsigned char *free_mem_112053;
    unsigned char *free_mem_112055;
    unsigned char *free_mem_param_118926;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124090;
};
static int futhark_mc_segred_stage_1_parloop_128187(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128186 *futhark_mc_segred_stage_1_parloop_struct_128186 = (struct futhark_mc_segred_stage_1_parloop_struct_128186 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128186->ctx;
    struct mc_event *event_128188 = mc_event_new(ctx);
    
    if (event_128188 != NULL)
        event_128188->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128186->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_segred_stage_1_parloop_struct_128186->free_exp_absorb_cutoff_33394;
    double zs_res_44842 = futhark_mc_segred_stage_1_parloop_struct_128186->free_zs_res_44842;
    double zs_res_44844 = futhark_mc_segred_stage_1_parloop_struct_128186->free_zs_res_44844;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_128186->free_eta_p_106382;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_128186->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112034 = {.desc ="mem_112034", .mem =futhark_mc_segred_stage_1_parloop_struct_128186->free_mem_112034, .size =0, .references =NULL};
    struct memblock mem_112046 = {.desc ="mem_112046", .mem =futhark_mc_segred_stage_1_parloop_struct_128186->free_mem_112046, .size =0, .references =NULL};
    struct memblock mem_112051 = {.desc ="mem_112051", .mem =futhark_mc_segred_stage_1_parloop_struct_128186->free_mem_112051, .size =0, .references =NULL};
    struct memblock mem_112053 = {.desc ="mem_112053", .mem =futhark_mc_segred_stage_1_parloop_struct_128186->free_mem_112053, .size =0, .references =NULL};
    struct memblock mem_112055 = {.desc ="mem_112055", .mem =futhark_mc_segred_stage_1_parloop_struct_128186->free_mem_112055, .size =0, .references =NULL};
    struct memblock mem_param_118926 = {.desc ="mem_param_118926", .mem =futhark_mc_segred_stage_1_parloop_struct_128186->free_mem_param_118926, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_124090 = {.desc ="reduce_stage_1_tid_res_arr_mem_124090", .mem =futhark_mc_segred_stage_1_parloop_struct_128186->free_reduce_stage_1_tid_res_arr_mem_124090, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_119372;
    
    flat_tid_119372 = subtask_id;
    {
        bool eta_p_124092;
        bool eta_p_124093;
        bool local_acc_124095 = 0;
        bool eta_p_119374;
        bool eta_p_119375;
        bool local_acc_124096 = 0;
        int64_t start_124097;
        int64_t end_124098;
        
        start_124097 = start;
        end_124098 = end;
        
        int64_t n_124099 = end_124098 - start_124097;
        
        for (int64_t SegRed_i_124100 = start_124097; SegRed_i_124100 < start_124097 + n_124099; SegRed_i_124100++) {
            int64_t gtid_119373 = SegRed_i_124100;
            double eta_p_119377 = ((double *) mem_param_118926.mem)[gtid_119373];
            double eta_p_119378 = ((double *) mem_112034.mem)[gtid_119373];
            double eta_p_119379 = ((double *) distrs_mem_111708.mem)[eta_p_106382 * m_33388 + gtid_119373];
            double zp_res_119380 = eta_p_119377 + eta_p_119378;
            double defunc_0_reduce_res_119381;
            double redout_119383 = 0.0;
            
            for (int64_t i_119382 = 0; i_119382 < m_33388; i_119382++) {
                double eta_p_119384 = ((double *) mem_112046.mem)[i_119382];
                double eta_p_119385 = ((double *) mem_112051.mem)[i_119382 * m_33388 + gtid_119373];
                double zt_res_119386 = eta_p_119384 * eta_p_119385;
                double zp_res_119387 = zt_res_119386 + redout_119383;
                double redout_tmp_124101 = zp_res_119387;
                
                redout_119383 = redout_tmp_124101;
            }
            defunc_0_reduce_res_119381 = redout_119383;
            
            double zs_res_119388 = defunc_0_reduce_res_119381 / eta_p_119379;
            double ztzt_res_119389 = fpow64(zs_res_119388, zs_res_44842);
            double zt_res_119390 = zs_res_44844 * zp_res_119380;
            double exp_res_119391 = futrts_exp64(zt_res_119390);
            double zt_res_119392 = ztzt_res_119389 * exp_res_119391;
            bool zgze_res_119393 = exp_absorb_cutoff_33394 <= zt_res_119392;
            
            // save map-out results
            {
                ((double *) mem_112053.mem)[gtid_119373] = zt_res_119392;
                ((double *) mem_112055.mem)[gtid_119373] = zp_res_119380;
            }
            // Load accum params
            {
                eta_p_119374 = local_acc_124096;
            }
            // Load next params
            {
                eta_p_119375 = zgze_res_119393;
            }
            // SegRed body
            {
                bool defunc_0_op_res_119376 = eta_p_119374 || eta_p_119375;
                
                local_acc_124096 = defunc_0_op_res_119376;
            }
        }
        
        int64_t uni_i_124102 = 0;
        
        {
            int64_t gtid_119373 = uni_i_124102;
            
            // Load accum params
            {
                eta_p_124092 = local_acc_124095;
            }
            // Load next params
            {
                eta_p_124093 = local_acc_124096;
            }
            // SegRed body
            {
                bool defunc_0_op_res_124094 = eta_p_124092 || eta_p_124093;
                
                local_acc_124095 = defunc_0_op_res_124094;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_124090.mem)[flat_tid_119372] = local_acc_124095;
    }
    
  cleanup:
    { }
    if (event_128188 != NULL) {
        event_128188->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128187", strdup("nothing further"), event_128188, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128184(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128183 *futhark_mc_task_128183 = (struct futhark_mc_task_128183 *) args;
    struct futhark_context *ctx = futhark_mc_task_128183->ctx;
    struct mc_event *event_128190 = mc_event_new(ctx);
    
    if (event_128190 != NULL)
        event_128190->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128183->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_task_128183->free_exp_absorb_cutoff_33394;
    double zs_res_44842 = futhark_mc_task_128183->free_zs_res_44842;
    double zs_res_44844 = futhark_mc_task_128183->free_zs_res_44844;
    int64_t eta_p_106382 = futhark_mc_task_128183->free_eta_p_106382;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128183->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112034 = {.desc ="mem_112034", .mem =futhark_mc_task_128183->free_mem_112034, .size =0, .references =NULL};
    struct memblock mem_112046 = {.desc ="mem_112046", .mem =futhark_mc_task_128183->free_mem_112046, .size =0, .references =NULL};
    struct memblock mem_112051 = {.desc ="mem_112051", .mem =futhark_mc_task_128183->free_mem_112051, .size =0, .references =NULL};
    struct memblock mem_param_118926 = {.desc ="mem_param_118926", .mem =futhark_mc_task_128183->free_mem_param_118926, .size =0, .references =NULL};
    int64_t flat_tid_119348 = futhark_mc_task_128183->free_flat_tid_119348;
    int64_t flat_tid_119372 = futhark_mc_task_128183->free_flat_tid_119372;
    bool defunc_0_reduce_res_119345 = *futhark_mc_task_128183->retval_defunc_0_reduce_res_119345;
    struct memblock mem_112053 = {.desc ="mem_112053", .mem =futhark_mc_task_128183->retval_mem_112053, .size =0, .references =NULL};
    struct memblock mem_112055 = {.desc ="mem_112055", .mem =futhark_mc_task_128183->retval_mem_112055, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_124090_cached_sizze_128185 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124090 = NULL;
    int32_t nsubtasks_124089;
    
    nsubtasks_124089 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124090_cached_sizze_128185 < nsubtasks_124089) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124090, &reduce_stage_1_tid_res_arr_mem_124090_cached_sizze_128185, nsubtasks_124089);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128186 futhark_mc_segred_stage_1_parloop_struct_128186_;
    
    futhark_mc_segred_stage_1_parloop_struct_128186_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128186_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128186_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segred_stage_1_parloop_struct_128186_.free_zs_res_44842 = zs_res_44842;
    futhark_mc_segred_stage_1_parloop_struct_128186_.free_zs_res_44844 = zs_res_44844;
    futhark_mc_segred_stage_1_parloop_struct_128186_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_128186_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_128186_.free_mem_112034 = mem_112034.mem;
    futhark_mc_segred_stage_1_parloop_struct_128186_.free_mem_112046 = mem_112046.mem;
    futhark_mc_segred_stage_1_parloop_struct_128186_.free_mem_112051 = mem_112051.mem;
    futhark_mc_segred_stage_1_parloop_struct_128186_.free_mem_112053 = mem_112053.mem;
    futhark_mc_segred_stage_1_parloop_struct_128186_.free_mem_112055 = mem_112055.mem;
    futhark_mc_segred_stage_1_parloop_struct_128186_.free_mem_param_118926 = mem_param_118926.mem;
    futhark_mc_segred_stage_1_parloop_struct_128186_.free_reduce_stage_1_tid_res_arr_mem_124090 = reduce_stage_1_tid_res_arr_mem_124090;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128187_task;
    
    futhark_mc_segred_stage_1_parloop_128187_task.name = "futhark_mc_segred_stage_1_parloop_128187";
    futhark_mc_segred_stage_1_parloop_128187_task.fn = futhark_mc_segred_stage_1_parloop_128187;
    futhark_mc_segred_stage_1_parloop_128187_task.args = &futhark_mc_segred_stage_1_parloop_struct_128186_;
    futhark_mc_segred_stage_1_parloop_128187_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128187_task.info = info;
    
    struct mc_event *event_128189 = mc_event_new(ctx);
    
    if (event_128189 != NULL)
        event_128189->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128187_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128187_task);
    
    if (futhark_mc_segred_stage_1_parloop_128187_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128187_err;
        goto cleanup;
    }
    if (event_128189 != NULL) {
        event_128189->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128187_total", strdup("nothing further"), event_128189, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_119345 = 0;
    }
    
    bool eta_p_124103;
    bool eta_p_124104;
    
    for (int32_t i_124106 = 0; i_124106 < nsubtasks_124089; i_124106++) {
        flat_tid_119372 = i_124106;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124103 = defunc_0_reduce_res_119345;
            }
            // load next params
            {
                eta_p_124104 = ((bool *) reduce_stage_1_tid_res_arr_mem_124090)[flat_tid_119372];
            }
            // red body
            {
                bool defunc_0_op_res_124105 = eta_p_124103 || eta_p_124104;
                
                defunc_0_reduce_res_119345 = defunc_0_op_res_124105;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124090);
    }
    if (event_128190 != NULL) {
        event_128190->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128184", strdup("nothing further"), event_128190, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128183->retval_defunc_0_reduce_res_119345 = defunc_0_reduce_res_119345;
        futhark_mc_task_128183->retval_mem_112053 = mem_112053.mem;
        futhark_mc_task_128183->retval_mem_112055 = mem_112055.mem;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_128193 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_44842;
    double free_zs_res_44844;
    int64_t free_eta_p_106382;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_112034;
    unsigned char *free_mem_112046;
    unsigned char *free_mem_112051;
    unsigned char *free_mem_112053;
    unsigned char *free_mem_112055;
    unsigned char *free_mem_param_118926;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124108;
};
struct futhark_mc_task_128195 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_112046;
    unsigned char *free_mem_112051;
    int64_t free_gtid_119349;
    int64_t free_flat_tid_119358;
    double *retval_defunc_0_reduce_res_119357;
};
struct futhark_mc_segred_stage_1_parloop_struct_128198 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_112046;
    unsigned char *free_mem_112051;
    int64_t free_gtid_119349;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124120;
};
static int futhark_mc_segred_stage_1_parloop_128199(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128198 *futhark_mc_segred_stage_1_parloop_struct_128198 = (struct futhark_mc_segred_stage_1_parloop_struct_128198 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128198->ctx;
    struct mc_event *event_128200 = mc_event_new(ctx);
    
    if (event_128200 != NULL)
        event_128200->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128198->free_m_33388;
    struct memblock mem_112046 = {.desc ="mem_112046", .mem =futhark_mc_segred_stage_1_parloop_struct_128198->free_mem_112046, .size =0, .references =NULL};
    struct memblock mem_112051 = {.desc ="mem_112051", .mem =futhark_mc_segred_stage_1_parloop_struct_128198->free_mem_112051, .size =0, .references =NULL};
    int64_t gtid_119349 = futhark_mc_segred_stage_1_parloop_struct_128198->free_gtid_119349;
    struct memblock reduce_stage_1_tid_res_arr_mem_124120 = {.desc ="reduce_stage_1_tid_res_arr_mem_124120", .mem =futhark_mc_segred_stage_1_parloop_struct_128198->free_reduce_stage_1_tid_res_arr_mem_124120, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_119358;
    
    flat_tid_119358 = subtask_id;
    {
        double eta_p_124122;
        double eta_p_124123;
        double local_acc_124125 = 0.0;
        double eta_p_119360;
        double eta_p_119361;
        double local_acc_124126 = 0.0;
        int64_t start_124127;
        int64_t end_124128;
        
        start_124127 = start;
        end_124128 = end;
        
        int64_t n_124129 = end_124128 - start_124127;
        
        for (int64_t SegRed_i_124130 = start_124127; SegRed_i_124130 < start_124127 + n_124129; SegRed_i_124130++) {
            int64_t gtid_119359 = SegRed_i_124130;
            double eta_p_119363 = ((double *) mem_112046.mem)[gtid_119359];
            double eta_p_119364 = ((double *) mem_112051.mem)[gtid_119359 * m_33388 + gtid_119349];
            double zt_res_119365 = eta_p_119363 * eta_p_119364;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_119360 = local_acc_124126;
            }
            // Load next params
            {
                eta_p_119361 = zt_res_119365;
            }
            // SegRed body
            {
                double zp_res_119362 = eta_p_119360 + eta_p_119361;
                
                local_acc_124126 = zp_res_119362;
            }
        }
        
        int64_t uni_i_124131 = 0;
        
        {
            int64_t gtid_119359 = uni_i_124131;
            
            // Load accum params
            {
                eta_p_124122 = local_acc_124125;
            }
            // Load next params
            {
                eta_p_124123 = local_acc_124126;
            }
            // SegRed body
            {
                double zp_res_124124 = eta_p_124122 + eta_p_124123;
                
                local_acc_124125 = zp_res_124124;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_124120.mem)[flat_tid_119358] = local_acc_124125;
    }
    
  cleanup:
    { }
    if (event_128200 != NULL) {
        event_128200->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128199", strdup("nothing further"), event_128200, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128196(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128195 *futhark_mc_task_128195 = (struct futhark_mc_task_128195 *) args;
    struct futhark_context *ctx = futhark_mc_task_128195->ctx;
    struct mc_event *event_128202 = mc_event_new(ctx);
    
    if (event_128202 != NULL)
        event_128202->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128195->free_m_33388;
    struct memblock mem_112046 = {.desc ="mem_112046", .mem =futhark_mc_task_128195->free_mem_112046, .size =0, .references =NULL};
    struct memblock mem_112051 = {.desc ="mem_112051", .mem =futhark_mc_task_128195->free_mem_112051, .size =0, .references =NULL};
    int64_t gtid_119349 = futhark_mc_task_128195->free_gtid_119349;
    int64_t flat_tid_119358 = futhark_mc_task_128195->free_flat_tid_119358;
    double defunc_0_reduce_res_119357 = *futhark_mc_task_128195->retval_defunc_0_reduce_res_119357;
    int64_t reduce_stage_1_tid_res_arr_mem_124120_cached_sizze_128197 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124120 = NULL;
    int32_t nsubtasks_124119;
    
    nsubtasks_124119 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124120_cached_sizze_128197 < (int64_t) 8 * nsubtasks_124119) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124120, &reduce_stage_1_tid_res_arr_mem_124120_cached_sizze_128197, (int64_t) 8 * nsubtasks_124119);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128198 futhark_mc_segred_stage_1_parloop_struct_128198_;
    
    futhark_mc_segred_stage_1_parloop_struct_128198_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128198_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128198_.free_mem_112046 = mem_112046.mem;
    futhark_mc_segred_stage_1_parloop_struct_128198_.free_mem_112051 = mem_112051.mem;
    futhark_mc_segred_stage_1_parloop_struct_128198_.free_gtid_119349 = gtid_119349;
    futhark_mc_segred_stage_1_parloop_struct_128198_.free_reduce_stage_1_tid_res_arr_mem_124120 = reduce_stage_1_tid_res_arr_mem_124120;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128199_task;
    
    futhark_mc_segred_stage_1_parloop_128199_task.name = "futhark_mc_segred_stage_1_parloop_128199";
    futhark_mc_segred_stage_1_parloop_128199_task.fn = futhark_mc_segred_stage_1_parloop_128199;
    futhark_mc_segred_stage_1_parloop_128199_task.args = &futhark_mc_segred_stage_1_parloop_struct_128198_;
    futhark_mc_segred_stage_1_parloop_128199_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128199_task.info = info;
    
    struct mc_event *event_128201 = mc_event_new(ctx);
    
    if (event_128201 != NULL)
        event_128201->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128199_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128199_task);
    
    if (futhark_mc_segred_stage_1_parloop_128199_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128199_err;
        goto cleanup;
    }
    if (event_128201 != NULL) {
        event_128201->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128199_total", strdup("nothing further"), event_128201, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_119357 = 0.0;
    }
    
    double eta_p_124132;
    double eta_p_124133;
    
    for (int32_t i_124135 = 0; i_124135 < nsubtasks_124119; i_124135++) {
        flat_tid_119358 = i_124135;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124132 = defunc_0_reduce_res_119357;
            }
            // load next params
            {
                eta_p_124133 = ((double *) reduce_stage_1_tid_res_arr_mem_124120)[flat_tid_119358];
            }
            // red body
            {
                double zp_res_124134 = eta_p_124132 + eta_p_124133;
                
                defunc_0_reduce_res_119357 = zp_res_124134;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124120);
    }
    if (event_128202 != NULL) {
        event_128202->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128196", strdup("nothing further"), event_128202, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128195->retval_defunc_0_reduce_res_119357 = defunc_0_reduce_res_119357;
    }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_128194(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128193 *futhark_mc_segred_stage_1_parloop_struct_128193 = (struct futhark_mc_segred_stage_1_parloop_struct_128193 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128193->ctx;
    struct mc_event *event_128203 = mc_event_new(ctx);
    
    if (event_128203 != NULL)
        event_128203->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128193->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_segred_stage_1_parloop_struct_128193->free_exp_absorb_cutoff_33394;
    double zs_res_44842 = futhark_mc_segred_stage_1_parloop_struct_128193->free_zs_res_44842;
    double zs_res_44844 = futhark_mc_segred_stage_1_parloop_struct_128193->free_zs_res_44844;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_128193->free_eta_p_106382;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_128193->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112034 = {.desc ="mem_112034", .mem =futhark_mc_segred_stage_1_parloop_struct_128193->free_mem_112034, .size =0, .references =NULL};
    struct memblock mem_112046 = {.desc ="mem_112046", .mem =futhark_mc_segred_stage_1_parloop_struct_128193->free_mem_112046, .size =0, .references =NULL};
    struct memblock mem_112051 = {.desc ="mem_112051", .mem =futhark_mc_segred_stage_1_parloop_struct_128193->free_mem_112051, .size =0, .references =NULL};
    struct memblock mem_112053 = {.desc ="mem_112053", .mem =futhark_mc_segred_stage_1_parloop_struct_128193->free_mem_112053, .size =0, .references =NULL};
    struct memblock mem_112055 = {.desc ="mem_112055", .mem =futhark_mc_segred_stage_1_parloop_struct_128193->free_mem_112055, .size =0, .references =NULL};
    struct memblock mem_param_118926 = {.desc ="mem_param_118926", .mem =futhark_mc_segred_stage_1_parloop_struct_128193->free_mem_param_118926, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_124108 = {.desc ="reduce_stage_1_tid_res_arr_mem_124108", .mem =futhark_mc_segred_stage_1_parloop_struct_128193->free_reduce_stage_1_tid_res_arr_mem_124108, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_119348;
    
    flat_tid_119348 = subtask_id;
    {
        bool eta_p_124110;
        bool eta_p_124111;
        bool local_acc_124113 = 0;
        bool eta_p_119350;
        bool eta_p_119351;
        bool local_acc_124114 = 0;
        int64_t start_124115;
        int64_t end_124116;
        
        start_124115 = start;
        end_124116 = end;
        
        int64_t n_124117 = end_124116 - start_124115;
        
        for (int64_t SegRed_i_124118 = start_124115; SegRed_i_124118 < start_124115 + n_124117; SegRed_i_124118++) {
            int64_t gtid_119349 = SegRed_i_124118;
            double eta_p_119353 = ((double *) mem_param_118926.mem)[gtid_119349];
            double eta_p_119354 = ((double *) mem_112034.mem)[gtid_119349];
            double eta_p_119355 = ((double *) distrs_mem_111708.mem)[eta_p_106382 * m_33388 + gtid_119349];
            double zp_res_119356 = eta_p_119353 + eta_p_119354;
            double defunc_0_reduce_res_119357;
            int64_t flat_tid_119358 = (int64_t) 0;
            
            defunc_0_reduce_res_119357 = 0.0;
            
            struct futhark_mc_task_128195 futhark_mc_task_128195_;
            
            futhark_mc_task_128195_.ctx = ctx;
            futhark_mc_task_128195_.free_m_33388 = m_33388;
            futhark_mc_task_128195_.free_mem_112046 = mem_112046.mem;
            futhark_mc_task_128195_.free_mem_112051 = mem_112051.mem;
            futhark_mc_task_128195_.free_gtid_119349 = gtid_119349;
            futhark_mc_task_128195_.free_flat_tid_119358 = flat_tid_119358;
            futhark_mc_task_128195_.retval_defunc_0_reduce_res_119357 = (double *) &defunc_0_reduce_res_119357;
            #if ISPC
            futhark_mc_task_128195_.retval_defunc_0_reduce_res_119357 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_128195_task;
            
            futhark_mc_task_128195_task.args = &futhark_mc_task_128195_;
            futhark_mc_task_128195_task.top_level_fn = futhark_mc_segred_task_128196;
            futhark_mc_task_128195_task.name = "futhark_mc_segred_task_128196";
            futhark_mc_task_128195_task.iterations = m_33388;
            futhark_mc_task_128195_task.task_time = &ctx->program->futhark_mc_segred_task_128196_total_time;
            futhark_mc_task_128195_task.task_iter = &ctx->program->futhark_mc_segred_task_128196_total_iter;
            futhark_mc_task_128195_task.sched = STATIC;
            futhark_mc_task_128195_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_128196_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128195_task);
            
            if (futhark_mc_segred_task_128196_err != 0) {
                err = futhark_mc_segred_task_128196_err;
                goto cleanup;
            }
            
            double zs_res_119366 = defunc_0_reduce_res_119357 / eta_p_119355;
            double ztzt_res_119367 = fpow64(zs_res_119366, zs_res_44842);
            double zt_res_119368 = zs_res_44844 * zp_res_119356;
            double exp_res_119369 = futrts_exp64(zt_res_119368);
            double zt_res_119370 = ztzt_res_119367 * exp_res_119369;
            bool zgze_res_119371 = exp_absorb_cutoff_33394 <= zt_res_119370;
            
            // save map-out results
            {
                ((double *) mem_112053.mem)[gtid_119349] = zt_res_119370;
                ((double *) mem_112055.mem)[gtid_119349] = zp_res_119356;
            }
            // Load accum params
            {
                eta_p_119350 = local_acc_124114;
            }
            // Load next params
            {
                eta_p_119351 = zgze_res_119371;
            }
            // SegRed body
            {
                bool defunc_0_op_res_119352 = eta_p_119350 || eta_p_119351;
                
                local_acc_124114 = defunc_0_op_res_119352;
            }
        }
        
        int64_t uni_i_124136 = 0;
        
        {
            int64_t gtid_119349 = uni_i_124136;
            
            // Load accum params
            {
                eta_p_124110 = local_acc_124113;
            }
            // Load next params
            {
                eta_p_124111 = local_acc_124114;
            }
            // SegRed body
            {
                bool defunc_0_op_res_124112 = eta_p_124110 || eta_p_124111;
                
                local_acc_124113 = defunc_0_op_res_124112;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_124108.mem)[flat_tid_119348] = local_acc_124113;
    }
    
  cleanup:
    { }
    if (event_128203 != NULL) {
        event_128203->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128194", strdup("nothing further"), event_128203, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_128191(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128183 *futhark_mc_task_128183 = (struct futhark_mc_task_128183 *) args;
    struct futhark_context *ctx = futhark_mc_task_128183->ctx;
    struct mc_event *event_128205 = mc_event_new(ctx);
    
    if (event_128205 != NULL)
        event_128205->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128183->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_task_128183->free_exp_absorb_cutoff_33394;
    double zs_res_44842 = futhark_mc_task_128183->free_zs_res_44842;
    double zs_res_44844 = futhark_mc_task_128183->free_zs_res_44844;
    int64_t eta_p_106382 = futhark_mc_task_128183->free_eta_p_106382;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128183->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112034 = {.desc ="mem_112034", .mem =futhark_mc_task_128183->free_mem_112034, .size =0, .references =NULL};
    struct memblock mem_112046 = {.desc ="mem_112046", .mem =futhark_mc_task_128183->free_mem_112046, .size =0, .references =NULL};
    struct memblock mem_112051 = {.desc ="mem_112051", .mem =futhark_mc_task_128183->free_mem_112051, .size =0, .references =NULL};
    struct memblock mem_param_118926 = {.desc ="mem_param_118926", .mem =futhark_mc_task_128183->free_mem_param_118926, .size =0, .references =NULL};
    int64_t flat_tid_119348 = futhark_mc_task_128183->free_flat_tid_119348;
    int64_t flat_tid_119372 = futhark_mc_task_128183->free_flat_tid_119372;
    bool defunc_0_reduce_res_119345 = *futhark_mc_task_128183->retval_defunc_0_reduce_res_119345;
    struct memblock mem_112053 = {.desc ="mem_112053", .mem =futhark_mc_task_128183->retval_mem_112053, .size =0, .references =NULL};
    struct memblock mem_112055 = {.desc ="mem_112055", .mem =futhark_mc_task_128183->retval_mem_112055, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_124108_cached_sizze_128192 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124108 = NULL;
    int32_t nsubtasks_124107;
    
    nsubtasks_124107 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124108_cached_sizze_128192 < nsubtasks_124107) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124108, &reduce_stage_1_tid_res_arr_mem_124108_cached_sizze_128192, nsubtasks_124107);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128193 futhark_mc_segred_stage_1_parloop_struct_128193_;
    
    futhark_mc_segred_stage_1_parloop_struct_128193_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128193_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128193_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segred_stage_1_parloop_struct_128193_.free_zs_res_44842 = zs_res_44842;
    futhark_mc_segred_stage_1_parloop_struct_128193_.free_zs_res_44844 = zs_res_44844;
    futhark_mc_segred_stage_1_parloop_struct_128193_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_128193_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_128193_.free_mem_112034 = mem_112034.mem;
    futhark_mc_segred_stage_1_parloop_struct_128193_.free_mem_112046 = mem_112046.mem;
    futhark_mc_segred_stage_1_parloop_struct_128193_.free_mem_112051 = mem_112051.mem;
    futhark_mc_segred_stage_1_parloop_struct_128193_.free_mem_112053 = mem_112053.mem;
    futhark_mc_segred_stage_1_parloop_struct_128193_.free_mem_112055 = mem_112055.mem;
    futhark_mc_segred_stage_1_parloop_struct_128193_.free_mem_param_118926 = mem_param_118926.mem;
    futhark_mc_segred_stage_1_parloop_struct_128193_.free_reduce_stage_1_tid_res_arr_mem_124108 = reduce_stage_1_tid_res_arr_mem_124108;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128194_task;
    
    futhark_mc_segred_stage_1_parloop_128194_task.name = "futhark_mc_segred_stage_1_parloop_128194";
    futhark_mc_segred_stage_1_parloop_128194_task.fn = futhark_mc_segred_stage_1_parloop_128194;
    futhark_mc_segred_stage_1_parloop_128194_task.args = &futhark_mc_segred_stage_1_parloop_struct_128193_;
    futhark_mc_segred_stage_1_parloop_128194_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128194_task.info = info;
    
    struct mc_event *event_128204 = mc_event_new(ctx);
    
    if (event_128204 != NULL)
        event_128204->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128194_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128194_task);
    
    if (futhark_mc_segred_stage_1_parloop_128194_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128194_err;
        goto cleanup;
    }
    if (event_128204 != NULL) {
        event_128204->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128194_total", strdup("nothing further"), event_128204, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_119345 = 0;
    }
    
    bool eta_p_124137;
    bool eta_p_124138;
    
    for (int32_t i_124140 = 0; i_124140 < nsubtasks_124107; i_124140++) {
        flat_tid_119348 = i_124140;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124137 = defunc_0_reduce_res_119345;
            }
            // load next params
            {
                eta_p_124138 = ((bool *) reduce_stage_1_tid_res_arr_mem_124108)[flat_tid_119348];
            }
            // red body
            {
                bool defunc_0_op_res_124139 = eta_p_124137 || eta_p_124138;
                
                defunc_0_reduce_res_119345 = defunc_0_op_res_124139;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124108);
    }
    if (event_128205 != NULL) {
        event_128205->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_128191", strdup("nothing further"), event_128205, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128183->retval_defunc_0_reduce_res_119345 = defunc_0_reduce_res_119345;
        futhark_mc_task_128183->retval_mem_112053 = mem_112053.mem;
        futhark_mc_task_128183->retval_mem_112055 = mem_112055.mem;
    }
    return err;
}
struct futhark_mc_task_128206 {
    struct futhark_context *ctx;
    double free_zs_res_107134;
    unsigned char *free_mem_112053;
    int64_t free_flat_tid_119395;
    bool *retval_defunc_0_reduce_res_119394;
};
struct futhark_mc_segred_stage_1_parloop_struct_128209 {
    struct futhark_context *ctx;
    double free_zs_res_107134;
    unsigned char *free_mem_112053;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124142;
};
static int futhark_mc_segred_stage_1_parloop_128210(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128209 *futhark_mc_segred_stage_1_parloop_struct_128209 = (struct futhark_mc_segred_stage_1_parloop_struct_128209 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128209->ctx;
    struct mc_event *event_128211 = mc_event_new(ctx);
    
    if (event_128211 != NULL)
        event_128211->bef = get_wall_time();
    
    double zs_res_107134 = futhark_mc_segred_stage_1_parloop_struct_128209->free_zs_res_107134;
    struct memblock mem_112053 = {.desc ="mem_112053", .mem =futhark_mc_segred_stage_1_parloop_struct_128209->free_mem_112053, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_124142 = {.desc ="reduce_stage_1_tid_res_arr_mem_124142", .mem =futhark_mc_segred_stage_1_parloop_struct_128209->free_reduce_stage_1_tid_res_arr_mem_124142, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_119395;
    
    flat_tid_119395 = subtask_id;
    {
        bool eta_p_124144;
        bool eta_p_124145;
        bool local_acc_124147 = 0;
        bool eta_p_119397;
        bool eta_p_119398;
        bool local_acc_124148 = 0;
        int64_t start_124149;
        int64_t end_124150;
        
        start_124149 = start;
        end_124150 = end;
        
        int64_t n_124151 = end_124150 - start_124149;
        
        for (int64_t SegRed_i_124152 = start_124149; SegRed_i_124152 < start_124149 + n_124151; SegRed_i_124152++) {
            int64_t gtid_119396 = SegRed_i_124152;
            double eta_p_119400 = ((double *) mem_112053.mem)[gtid_119396];
            bool zlze_res_119401 = eta_p_119400 <= zs_res_107134;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_119397 = local_acc_124148;
            }
            // Load next params
            {
                eta_p_119398 = zlze_res_119401;
            }
            // SegRed body
            {
                bool defunc_0_op_res_119399 = eta_p_119397 || eta_p_119398;
                
                local_acc_124148 = defunc_0_op_res_119399;
            }
        }
        
        int64_t uni_i_124153 = 0;
        
        {
            int64_t gtid_119396 = uni_i_124153;
            
            // Load accum params
            {
                eta_p_124144 = local_acc_124147;
            }
            // Load next params
            {
                eta_p_124145 = local_acc_124148;
            }
            // SegRed body
            {
                bool defunc_0_op_res_124146 = eta_p_124144 || eta_p_124145;
                
                local_acc_124147 = defunc_0_op_res_124146;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_124142.mem)[flat_tid_119395] = local_acc_124147;
    }
    
  cleanup:
    { }
    if (event_128211 != NULL) {
        event_128211->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128210", strdup("nothing further"), event_128211, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128207(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128206 *futhark_mc_task_128206 = (struct futhark_mc_task_128206 *) args;
    struct futhark_context *ctx = futhark_mc_task_128206->ctx;
    struct mc_event *event_128213 = mc_event_new(ctx);
    
    if (event_128213 != NULL)
        event_128213->bef = get_wall_time();
    
    double zs_res_107134 = futhark_mc_task_128206->free_zs_res_107134;
    struct memblock mem_112053 = {.desc ="mem_112053", .mem =futhark_mc_task_128206->free_mem_112053, .size =0, .references =NULL};
    int64_t flat_tid_119395 = futhark_mc_task_128206->free_flat_tid_119395;
    bool defunc_0_reduce_res_119394 = *futhark_mc_task_128206->retval_defunc_0_reduce_res_119394;
    int64_t reduce_stage_1_tid_res_arr_mem_124142_cached_sizze_128208 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124142 = NULL;
    int32_t nsubtasks_124141;
    
    nsubtasks_124141 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124142_cached_sizze_128208 < nsubtasks_124141) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124142, &reduce_stage_1_tid_res_arr_mem_124142_cached_sizze_128208, nsubtasks_124141);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128209 futhark_mc_segred_stage_1_parloop_struct_128209_;
    
    futhark_mc_segred_stage_1_parloop_struct_128209_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128209_.free_zs_res_107134 = zs_res_107134;
    futhark_mc_segred_stage_1_parloop_struct_128209_.free_mem_112053 = mem_112053.mem;
    futhark_mc_segred_stage_1_parloop_struct_128209_.free_reduce_stage_1_tid_res_arr_mem_124142 = reduce_stage_1_tid_res_arr_mem_124142;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128210_task;
    
    futhark_mc_segred_stage_1_parloop_128210_task.name = "futhark_mc_segred_stage_1_parloop_128210";
    futhark_mc_segred_stage_1_parloop_128210_task.fn = futhark_mc_segred_stage_1_parloop_128210;
    futhark_mc_segred_stage_1_parloop_128210_task.args = &futhark_mc_segred_stage_1_parloop_struct_128209_;
    futhark_mc_segred_stage_1_parloop_128210_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128210_task.info = info;
    
    struct mc_event *event_128212 = mc_event_new(ctx);
    
    if (event_128212 != NULL)
        event_128212->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128210_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128210_task);
    
    if (futhark_mc_segred_stage_1_parloop_128210_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128210_err;
        goto cleanup;
    }
    if (event_128212 != NULL) {
        event_128212->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128210_total", strdup("nothing further"), event_128212, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_119394 = 0;
    }
    
    bool eta_p_124154;
    bool eta_p_124155;
    
    for (int32_t i_124157 = 0; i_124157 < nsubtasks_124141; i_124157++) {
        flat_tid_119395 = i_124157;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124154 = defunc_0_reduce_res_119394;
            }
            // load next params
            {
                eta_p_124155 = ((bool *) reduce_stage_1_tid_res_arr_mem_124142)[flat_tid_119395];
            }
            // red body
            {
                bool defunc_0_op_res_124156 = eta_p_124154 || eta_p_124155;
                
                defunc_0_reduce_res_119394 = defunc_0_op_res_124156;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124142);
    }
    if (event_128213 != NULL) {
        event_128213->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128207", strdup("nothing further"), event_128213, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128206->retval_defunc_0_reduce_res_119394 = defunc_0_reduce_res_119394;
    }
    return err;
}
struct futhark_mc_task_128214 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_107134;
    int64_t free_bytes_111715;
    unsigned char *free_mem_112051;
    unsigned char *free_mem_112053;
    unsigned char *free_mem_112055;
    unsigned char *free_mem_112068;
    unsigned char *free_mem_112070;
    unsigned char *free_mem_112073;
};
struct futhark_mc_segmap_parloop_struct_128216 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_107134;
    int64_t free_bytes_111715;
    unsigned char *free_mem_112051;
    unsigned char *free_mem_112053;
    unsigned char *free_mem_112055;
    unsigned char *free_mem_112068;
    unsigned char *free_mem_112070;
    unsigned char *free_mem_112073;
};
static int futhark_mc_segmap_parloop_128217(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_128216 *futhark_mc_segmap_parloop_struct_128216 = (struct futhark_mc_segmap_parloop_struct_128216 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_128216->ctx;
    struct mc_event *event_128218 = mc_event_new(ctx);
    
    if (event_128218 != NULL)
        event_128218->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_128216->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_segmap_parloop_struct_128216->free_exp_absorb_cutoff_33394;
    double zs_res_107134 = futhark_mc_segmap_parloop_struct_128216->free_zs_res_107134;
    int64_t bytes_111715 = futhark_mc_segmap_parloop_struct_128216->free_bytes_111715;
    struct memblock mem_112051 = {.desc ="mem_112051", .mem =futhark_mc_segmap_parloop_struct_128216->free_mem_112051, .size =0, .references =NULL};
    struct memblock mem_112053 = {.desc ="mem_112053", .mem =futhark_mc_segmap_parloop_struct_128216->free_mem_112053, .size =0, .references =NULL};
    struct memblock mem_112055 = {.desc ="mem_112055", .mem =futhark_mc_segmap_parloop_struct_128216->free_mem_112055, .size =0, .references =NULL};
    struct memblock mem_112068 = {.desc ="mem_112068", .mem =futhark_mc_segmap_parloop_struct_128216->free_mem_112068, .size =0, .references =NULL};
    struct memblock mem_112070 = {.desc ="mem_112070", .mem =futhark_mc_segmap_parloop_struct_128216->free_mem_112070, .size =0, .references =NULL};
    struct memblock mem_112073 = {.desc ="mem_112073", .mem =futhark_mc_segmap_parloop_struct_128216->free_mem_112073, .size =0, .references =NULL};
    int64_t iterations = end - start;
    struct memblock ext_mem_119429;
    
    ext_mem_119429.references = NULL;
    
    struct memblock mem_119428;
    
    mem_119428.references = NULL;
    
    int64_t flat_tid_119416;
    
    flat_tid_119416 = subtask_id;
    {
        int64_t start_124170;
        int64_t end_124171;
        
        start_124170 = start;
        end_124171 = end;
        
        int64_t n_124172 = end_124171 - start_124170;
        
        if (memblock_alloc(ctx, &mem_119428, bytes_111715, "mem_119428")) {
            err = 1;
            goto cleanup;
        }
        for (int64_t SegMap_i_124173 = start_124170; SegMap_i_124173 < start_124170 + n_124172; SegMap_i_124173++) {
            int64_t slice_124174 = m_33388;
            int64_t gtid_119417 = SegMap_i_124173;
            int64_t remnant_124175 = SegMap_i_124173 - gtid_119417;
            double eta_p_119418 = ((double *) mem_112053.mem)[gtid_119417];
            double eta_p_119419 = ((double *) mem_112055.mem)[gtid_119417];
            bool zgze_res_119421 = exp_absorb_cutoff_33394 <= eta_p_119418;
            bool zl_res_119422 = eta_p_119418 < zs_res_107134;
            bool x_119423 = !zgze_res_119421;
            bool y_119424 = zl_res_119422 && x_119423;
            bool cond_119425 = zgze_res_119421 || y_119424;
            int64_t ext_119426;
            
            if (cond_119425) {
                ext_119426 = (int64_t) 0;
            } else {
                ext_119426 = gtid_119417;
            }
            
            int64_t ext_119427;
            
            if (cond_119425) {
                ext_119427 = (int64_t) 1;
            } else {
                ext_119427 = m_33388;
            }
            
            double rescale_res_119430;
            double rescale_res_119431;
            
            if (cond_119425) {
                double log_res_124159 = futrts_log64(eta_p_119418);
                double sqrt_res_124160 = futrts_sqrt64(eta_p_119418);
                double zs_res_124161 = log_res_124159 / 2.0;
                double zp_res_124162 = eta_p_119419 + zs_res_124161;
                
                for (int64_t i_124165 = 0; i_124165 < m_33388; i_124165++) {
                    double eta_p_124167 = ((double *) mem_112051.mem)[i_124165 * m_33388 + gtid_119417];
                    double zt_res_124168 = sqrt_res_124160 * eta_p_124167;
                    
                    ((double *) mem_119428.mem)[i_124165] = zt_res_124168;
                }
                if (memblock_set(ctx, &ext_mem_119429, &mem_119428, "mem_119428") != 0)
                    return 1;
                rescale_res_119430 = sqrt_res_124160;
                rescale_res_119431 = zp_res_124162;
            } else {
                if (memblock_set(ctx, &ext_mem_119429, &mem_112051, "mem_112051") != 0)
                    return 1;
                rescale_res_119430 = eta_p_119418;
                rescale_res_119431 = eta_p_119419;
            }
            ((double *) mem_112068.mem)[gtid_119417] = rescale_res_119430;
            ((double *) mem_112070.mem)[gtid_119417] = rescale_res_119431;
            lmad_copy_8b(ctx, 1, (uint64_t *) mem_112073.mem, gtid_119417 * m_33388, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_119429.mem, ext_119426, (int64_t []) {ext_119427}, (int64_t []) {m_33388});
        }
    }
    
  cleanup:
    {
        if (memblock_unref(ctx, &ext_mem_119429, "ext_mem_119429") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_119428, "mem_119428") != 0)
            return 1;
    }
    if (event_128218 != NULL) {
        event_128218->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128217", strdup("nothing further"), event_128218, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_task_128215(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128214 *futhark_mc_task_128214 = (struct futhark_mc_task_128214 *) args;
    struct futhark_context *ctx = futhark_mc_task_128214->ctx;
    struct mc_event *event_128220 = mc_event_new(ctx);
    
    if (event_128220 != NULL)
        event_128220->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128214->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_task_128214->free_exp_absorb_cutoff_33394;
    double zs_res_107134 = futhark_mc_task_128214->free_zs_res_107134;
    int64_t bytes_111715 = futhark_mc_task_128214->free_bytes_111715;
    struct memblock mem_112051 = {.desc ="mem_112051", .mem =futhark_mc_task_128214->free_mem_112051, .size =0, .references =NULL};
    struct memblock mem_112053 = {.desc ="mem_112053", .mem =futhark_mc_task_128214->free_mem_112053, .size =0, .references =NULL};
    struct memblock mem_112055 = {.desc ="mem_112055", .mem =futhark_mc_task_128214->free_mem_112055, .size =0, .references =NULL};
    struct memblock mem_112068 = {.desc ="mem_112068", .mem =futhark_mc_task_128214->free_mem_112068, .size =0, .references =NULL};
    struct memblock mem_112070 = {.desc ="mem_112070", .mem =futhark_mc_task_128214->free_mem_112070, .size =0, .references =NULL};
    struct memblock mem_112073 = {.desc ="mem_112073", .mem =futhark_mc_task_128214->free_mem_112073, .size =0, .references =NULL};
    int32_t nsubtasks_124158;
    
    nsubtasks_124158 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_128216 futhark_mc_segmap_parloop_struct_128216_;
    
    futhark_mc_segmap_parloop_struct_128216_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_128216_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_128216_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segmap_parloop_struct_128216_.free_zs_res_107134 = zs_res_107134;
    futhark_mc_segmap_parloop_struct_128216_.free_bytes_111715 = bytes_111715;
    futhark_mc_segmap_parloop_struct_128216_.free_mem_112051 = mem_112051.mem;
    futhark_mc_segmap_parloop_struct_128216_.free_mem_112053 = mem_112053.mem;
    futhark_mc_segmap_parloop_struct_128216_.free_mem_112055 = mem_112055.mem;
    futhark_mc_segmap_parloop_struct_128216_.free_mem_112068 = mem_112068.mem;
    futhark_mc_segmap_parloop_struct_128216_.free_mem_112070 = mem_112070.mem;
    futhark_mc_segmap_parloop_struct_128216_.free_mem_112073 = mem_112073.mem;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_128217_task;
    
    futhark_mc_segmap_parloop_128217_task.name = "futhark_mc_segmap_parloop_128217";
    futhark_mc_segmap_parloop_128217_task.fn = futhark_mc_segmap_parloop_128217;
    futhark_mc_segmap_parloop_128217_task.args = &futhark_mc_segmap_parloop_struct_128216_;
    futhark_mc_segmap_parloop_128217_task.iterations = iterations;
    futhark_mc_segmap_parloop_128217_task.info = info;
    
    struct mc_event *event_128219 = mc_event_new(ctx);
    
    if (event_128219 != NULL)
        event_128219->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_128217_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_128217_task);
    
    if (futhark_mc_segmap_parloop_128217_err != 0) {
        err = futhark_mc_segmap_parloop_128217_err;
        goto cleanup;
    }
    if (event_128219 != NULL) {
        event_128219->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128217_total", strdup("nothing further"), event_128219, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_128220 != NULL) {
        event_128220->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_task_128215", strdup("nothing further"), event_128220, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_128221 {
    struct futhark_context *ctx;
    double free_zs_res_107134;
    unsigned char *free_mem_112046;
    int64_t free_flat_tid_119445;
    bool *retval_defunc_0_reduce_res_119444;
};
struct futhark_mc_segred_stage_1_parloop_struct_128224 {
    struct futhark_context *ctx;
    double free_zs_res_107134;
    unsigned char *free_mem_112046;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124178;
};
static int futhark_mc_segred_stage_1_parloop_128225(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128224 *futhark_mc_segred_stage_1_parloop_struct_128224 = (struct futhark_mc_segred_stage_1_parloop_struct_128224 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128224->ctx;
    struct mc_event *event_128226 = mc_event_new(ctx);
    
    if (event_128226 != NULL)
        event_128226->bef = get_wall_time();
    
    double zs_res_107134 = futhark_mc_segred_stage_1_parloop_struct_128224->free_zs_res_107134;
    struct memblock mem_112046 = {.desc ="mem_112046", .mem =futhark_mc_segred_stage_1_parloop_struct_128224->free_mem_112046, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_124178 = {.desc ="reduce_stage_1_tid_res_arr_mem_124178", .mem =futhark_mc_segred_stage_1_parloop_struct_128224->free_reduce_stage_1_tid_res_arr_mem_124178, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_119445;
    
    flat_tid_119445 = subtask_id;
    {
        bool eta_p_124180;
        bool eta_p_124181;
        bool local_acc_124183 = 0;
        bool eta_p_119447;
        bool eta_p_119448;
        bool local_acc_124184 = 0;
        int64_t start_124185;
        int64_t end_124186;
        
        start_124185 = start;
        end_124186 = end;
        
        int64_t n_124187 = end_124186 - start_124185;
        
        for (int64_t SegRed_i_124188 = start_124185; SegRed_i_124188 < start_124185 + n_124187; SegRed_i_124188++) {
            int64_t gtid_119446 = SegRed_i_124188;
            double eta_p_119450 = ((double *) mem_112046.mem)[gtid_119446];
            bool zlze_res_119451 = eta_p_119450 <= zs_res_107134;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_119447 = local_acc_124184;
            }
            // Load next params
            {
                eta_p_119448 = zlze_res_119451;
            }
            // SegRed body
            {
                bool defunc_0_op_res_119449 = eta_p_119447 || eta_p_119448;
                
                local_acc_124184 = defunc_0_op_res_119449;
            }
        }
        
        int64_t uni_i_124189 = 0;
        
        {
            int64_t gtid_119446 = uni_i_124189;
            
            // Load accum params
            {
                eta_p_124180 = local_acc_124183;
            }
            // Load next params
            {
                eta_p_124181 = local_acc_124184;
            }
            // SegRed body
            {
                bool defunc_0_op_res_124182 = eta_p_124180 || eta_p_124181;
                
                local_acc_124183 = defunc_0_op_res_124182;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_124178.mem)[flat_tid_119445] = local_acc_124183;
    }
    
  cleanup:
    { }
    if (event_128226 != NULL) {
        event_128226->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128225", strdup("nothing further"), event_128226, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128222(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128221 *futhark_mc_task_128221 = (struct futhark_mc_task_128221 *) args;
    struct futhark_context *ctx = futhark_mc_task_128221->ctx;
    struct mc_event *event_128228 = mc_event_new(ctx);
    
    if (event_128228 != NULL)
        event_128228->bef = get_wall_time();
    
    double zs_res_107134 = futhark_mc_task_128221->free_zs_res_107134;
    struct memblock mem_112046 = {.desc ="mem_112046", .mem =futhark_mc_task_128221->free_mem_112046, .size =0, .references =NULL};
    int64_t flat_tid_119445 = futhark_mc_task_128221->free_flat_tid_119445;
    bool defunc_0_reduce_res_119444 = *futhark_mc_task_128221->retval_defunc_0_reduce_res_119444;
    int64_t reduce_stage_1_tid_res_arr_mem_124178_cached_sizze_128223 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124178 = NULL;
    int32_t nsubtasks_124177;
    
    nsubtasks_124177 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124178_cached_sizze_128223 < nsubtasks_124177) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124178, &reduce_stage_1_tid_res_arr_mem_124178_cached_sizze_128223, nsubtasks_124177);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128224 futhark_mc_segred_stage_1_parloop_struct_128224_;
    
    futhark_mc_segred_stage_1_parloop_struct_128224_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128224_.free_zs_res_107134 = zs_res_107134;
    futhark_mc_segred_stage_1_parloop_struct_128224_.free_mem_112046 = mem_112046.mem;
    futhark_mc_segred_stage_1_parloop_struct_128224_.free_reduce_stage_1_tid_res_arr_mem_124178 = reduce_stage_1_tid_res_arr_mem_124178;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128225_task;
    
    futhark_mc_segred_stage_1_parloop_128225_task.name = "futhark_mc_segred_stage_1_parloop_128225";
    futhark_mc_segred_stage_1_parloop_128225_task.fn = futhark_mc_segred_stage_1_parloop_128225;
    futhark_mc_segred_stage_1_parloop_128225_task.args = &futhark_mc_segred_stage_1_parloop_struct_128224_;
    futhark_mc_segred_stage_1_parloop_128225_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128225_task.info = info;
    
    struct mc_event *event_128227 = mc_event_new(ctx);
    
    if (event_128227 != NULL)
        event_128227->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128225_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128225_task);
    
    if (futhark_mc_segred_stage_1_parloop_128225_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128225_err;
        goto cleanup;
    }
    if (event_128227 != NULL) {
        event_128227->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128225_total", strdup("nothing further"), event_128227, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_119444 = 0;
    }
    
    bool eta_p_124190;
    bool eta_p_124191;
    
    for (int32_t i_124193 = 0; i_124193 < nsubtasks_124177; i_124193++) {
        flat_tid_119445 = i_124193;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124190 = defunc_0_reduce_res_119444;
            }
            // load next params
            {
                eta_p_124191 = ((bool *) reduce_stage_1_tid_res_arr_mem_124178)[flat_tid_119445];
            }
            // red body
            {
                bool defunc_0_op_res_124192 = eta_p_124190 || eta_p_124191;
                
                defunc_0_reduce_res_119444 = defunc_0_op_res_124192;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124178);
    }
    if (event_128228 != NULL) {
        event_128228->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128222", strdup("nothing further"), event_128228, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128221->retval_defunc_0_reduce_res_119444 = defunc_0_reduce_res_119444;
    }
    return err;
}
struct futhark_mc_task_128229 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_107134;
    int64_t free_bytes_111715;
    unsigned char *free_mem_112046;
    unsigned char *free_mem_112048;
    unsigned char *free_mem_112092;
    unsigned char *free_mem_112094;
    unsigned char *free_mem_112097;
    int64_t free_ext_119405;
    int64_t free_ext_119406;
    unsigned char *free_ext_mem_119409;
};
struct futhark_mc_segmap_parloop_struct_128231 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_107134;
    int64_t free_bytes_111715;
    unsigned char *free_mem_112046;
    unsigned char *free_mem_112048;
    unsigned char *free_mem_112092;
    unsigned char *free_mem_112094;
    unsigned char *free_mem_112097;
    int64_t free_ext_119405;
    int64_t free_ext_119406;
    unsigned char *free_ext_mem_119409;
};
static int futhark_mc_segmap_parloop_128232(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_128231 *futhark_mc_segmap_parloop_struct_128231 = (struct futhark_mc_segmap_parloop_struct_128231 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_128231->ctx;
    struct mc_event *event_128233 = mc_event_new(ctx);
    
    if (event_128233 != NULL)
        event_128233->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_128231->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_segmap_parloop_struct_128231->free_exp_absorb_cutoff_33394;
    double zs_res_107134 = futhark_mc_segmap_parloop_struct_128231->free_zs_res_107134;
    int64_t bytes_111715 = futhark_mc_segmap_parloop_struct_128231->free_bytes_111715;
    struct memblock mem_112046 = {.desc ="mem_112046", .mem =futhark_mc_segmap_parloop_struct_128231->free_mem_112046, .size =0, .references =NULL};
    struct memblock mem_112048 = {.desc ="mem_112048", .mem =futhark_mc_segmap_parloop_struct_128231->free_mem_112048, .size =0, .references =NULL};
    struct memblock mem_112092 = {.desc ="mem_112092", .mem =futhark_mc_segmap_parloop_struct_128231->free_mem_112092, .size =0, .references =NULL};
    struct memblock mem_112094 = {.desc ="mem_112094", .mem =futhark_mc_segmap_parloop_struct_128231->free_mem_112094, .size =0, .references =NULL};
    struct memblock mem_112097 = {.desc ="mem_112097", .mem =futhark_mc_segmap_parloop_struct_128231->free_mem_112097, .size =0, .references =NULL};
    int64_t ext_119405 = futhark_mc_segmap_parloop_struct_128231->free_ext_119405;
    int64_t ext_119406 = futhark_mc_segmap_parloop_struct_128231->free_ext_119406;
    struct memblock ext_mem_119409 = {.desc ="ext_mem_119409", .mem =futhark_mc_segmap_parloop_struct_128231->free_ext_mem_119409, .size =0, .references =NULL};
    int64_t iterations = end - start;
    struct memblock ext_mem_119481;
    
    ext_mem_119481.references = NULL;
    
    struct memblock mem_119480;
    
    mem_119480.references = NULL;
    
    int64_t flat_tid_119467;
    
    flat_tid_119467 = subtask_id;
    {
        int64_t start_124206;
        int64_t end_124207;
        
        start_124206 = start;
        end_124207 = end;
        
        int64_t n_124208 = end_124207 - start_124206;
        
        if (memblock_alloc(ctx, &mem_119480, bytes_111715, "mem_119480")) {
            err = 1;
            goto cleanup;
        }
        for (int64_t SegMap_i_124209 = start_124206; SegMap_i_124209 < start_124206 + n_124208; SegMap_i_124209++) {
            int64_t slice_124210 = m_33388;
            int64_t gtid_119468 = SegMap_i_124209;
            int64_t remnant_124211 = SegMap_i_124209 - gtid_119468;
            double eta_p_119469 = ((double *) mem_112046.mem)[gtid_119468];
            double eta_p_119470 = ((double *) mem_112048.mem)[gtid_119468];
            bool zgze_res_119472 = exp_absorb_cutoff_33394 <= eta_p_119469;
            bool zl_res_119473 = eta_p_119469 < zs_res_107134;
            bool x_119474 = !zgze_res_119472;
            bool y_119475 = zl_res_119473 && x_119474;
            bool cond_119476 = zgze_res_119472 || y_119475;
            int64_t lmad_ext_119477 = gtid_119468 * ext_119406;
            int64_t ext_119478;
            
            if (cond_119476) {
                ext_119478 = (int64_t) 0;
            } else {
                ext_119478 = lmad_ext_119477;
            }
            
            int64_t ext_119479;
            
            if (cond_119476) {
                ext_119479 = (int64_t) 1;
            } else {
                ext_119479 = ext_119405;
            }
            
            double rescale_res_119482;
            double rescale_res_119483;
            
            if (cond_119476) {
                double log_res_124195 = futrts_log64(eta_p_119469);
                double sqrt_res_124196 = futrts_sqrt64(eta_p_119469);
                double zs_res_124197 = log_res_124195 / 2.0;
                double zp_res_124198 = eta_p_119470 + zs_res_124197;
                
                for (int64_t i_124201 = 0; i_124201 < m_33388; i_124201++) {
                    double eta_p_124203 = ((double *) ext_mem_119409.mem)[i_124201 * ext_119405 + gtid_119468 * ext_119406];
                    double zt_res_124204 = sqrt_res_124196 * eta_p_124203;
                    
                    ((double *) mem_119480.mem)[i_124201] = zt_res_124204;
                }
                if (memblock_set(ctx, &ext_mem_119481, &mem_119480, "mem_119480") != 0)
                    return 1;
                rescale_res_119482 = sqrt_res_124196;
                rescale_res_119483 = zp_res_124198;
            } else {
                if (memblock_set(ctx, &ext_mem_119481, &ext_mem_119409, "ext_mem_119409") != 0)
                    return 1;
                rescale_res_119482 = eta_p_119469;
                rescale_res_119483 = eta_p_119470;
            }
            ((double *) mem_112092.mem)[gtid_119468] = rescale_res_119482;
            ((double *) mem_112094.mem)[gtid_119468] = rescale_res_119483;
            lmad_copy_8b(ctx, 1, (uint64_t *) mem_112097.mem, gtid_119468 * m_33388, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_119481.mem, ext_119478, (int64_t []) {ext_119479}, (int64_t []) {m_33388});
        }
    }
    
  cleanup:
    {
        if (memblock_unref(ctx, &ext_mem_119481, "ext_mem_119481") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_119480, "mem_119480") != 0)
            return 1;
    }
    if (event_128233 != NULL) {
        event_128233->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128232", strdup("nothing further"), event_128233, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_task_128230(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128229 *futhark_mc_task_128229 = (struct futhark_mc_task_128229 *) args;
    struct futhark_context *ctx = futhark_mc_task_128229->ctx;
    struct mc_event *event_128235 = mc_event_new(ctx);
    
    if (event_128235 != NULL)
        event_128235->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128229->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_task_128229->free_exp_absorb_cutoff_33394;
    double zs_res_107134 = futhark_mc_task_128229->free_zs_res_107134;
    int64_t bytes_111715 = futhark_mc_task_128229->free_bytes_111715;
    struct memblock mem_112046 = {.desc ="mem_112046", .mem =futhark_mc_task_128229->free_mem_112046, .size =0, .references =NULL};
    struct memblock mem_112048 = {.desc ="mem_112048", .mem =futhark_mc_task_128229->free_mem_112048, .size =0, .references =NULL};
    struct memblock mem_112092 = {.desc ="mem_112092", .mem =futhark_mc_task_128229->free_mem_112092, .size =0, .references =NULL};
    struct memblock mem_112094 = {.desc ="mem_112094", .mem =futhark_mc_task_128229->free_mem_112094, .size =0, .references =NULL};
    struct memblock mem_112097 = {.desc ="mem_112097", .mem =futhark_mc_task_128229->free_mem_112097, .size =0, .references =NULL};
    int64_t ext_119405 = futhark_mc_task_128229->free_ext_119405;
    int64_t ext_119406 = futhark_mc_task_128229->free_ext_119406;
    struct memblock ext_mem_119409 = {.desc ="ext_mem_119409", .mem =futhark_mc_task_128229->free_ext_mem_119409, .size =0, .references =NULL};
    int32_t nsubtasks_124194;
    
    nsubtasks_124194 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_128231 futhark_mc_segmap_parloop_struct_128231_;
    
    futhark_mc_segmap_parloop_struct_128231_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_128231_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_128231_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segmap_parloop_struct_128231_.free_zs_res_107134 = zs_res_107134;
    futhark_mc_segmap_parloop_struct_128231_.free_bytes_111715 = bytes_111715;
    futhark_mc_segmap_parloop_struct_128231_.free_mem_112046 = mem_112046.mem;
    futhark_mc_segmap_parloop_struct_128231_.free_mem_112048 = mem_112048.mem;
    futhark_mc_segmap_parloop_struct_128231_.free_mem_112092 = mem_112092.mem;
    futhark_mc_segmap_parloop_struct_128231_.free_mem_112094 = mem_112094.mem;
    futhark_mc_segmap_parloop_struct_128231_.free_mem_112097 = mem_112097.mem;
    futhark_mc_segmap_parloop_struct_128231_.free_ext_119405 = ext_119405;
    futhark_mc_segmap_parloop_struct_128231_.free_ext_119406 = ext_119406;
    futhark_mc_segmap_parloop_struct_128231_.free_ext_mem_119409 = ext_mem_119409.mem;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_128232_task;
    
    futhark_mc_segmap_parloop_128232_task.name = "futhark_mc_segmap_parloop_128232";
    futhark_mc_segmap_parloop_128232_task.fn = futhark_mc_segmap_parloop_128232;
    futhark_mc_segmap_parloop_128232_task.args = &futhark_mc_segmap_parloop_struct_128231_;
    futhark_mc_segmap_parloop_128232_task.iterations = iterations;
    futhark_mc_segmap_parloop_128232_task.info = info;
    
    struct mc_event *event_128234 = mc_event_new(ctx);
    
    if (event_128234 != NULL)
        event_128234->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_128232_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_128232_task);
    
    if (futhark_mc_segmap_parloop_128232_err != 0) {
        err = futhark_mc_segmap_parloop_128232_err;
        goto cleanup;
    }
    if (event_128234 != NULL) {
        event_128234->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128232_total", strdup("nothing further"), event_128234, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_128235 != NULL) {
        event_128235->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_task_128230", strdup("nothing further"), event_128235, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_128236 {
    struct futhark_context *ctx;
    unsigned char *free_ext_mem_119407;
    int64_t free_flat_tid_119498;
    bool *retval_defunc_0_reduce_res_119497;
};
struct futhark_mc_segred_stage_1_parloop_struct_128239 {
    struct futhark_context *ctx;
    unsigned char *free_ext_mem_119407;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124214;
};
static int futhark_mc_segred_stage_1_parloop_128240(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128239 *futhark_mc_segred_stage_1_parloop_struct_128239 = (struct futhark_mc_segred_stage_1_parloop_struct_128239 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128239->ctx;
    struct mc_event *event_128241 = mc_event_new(ctx);
    
    if (event_128241 != NULL)
        event_128241->bef = get_wall_time();
    
    struct memblock ext_mem_119407 = {.desc ="ext_mem_119407", .mem =futhark_mc_segred_stage_1_parloop_struct_128239->free_ext_mem_119407, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_124214 = {.desc ="reduce_stage_1_tid_res_arr_mem_124214", .mem =futhark_mc_segred_stage_1_parloop_struct_128239->free_reduce_stage_1_tid_res_arr_mem_124214, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_119498;
    
    flat_tid_119498 = subtask_id;
    {
        bool eta_p_124216;
        bool eta_p_124217;
        bool local_acc_124219 = 1;
        bool eta_p_119500;
        bool eta_p_119501;
        bool local_acc_124220 = 1;
        int64_t start_124221;
        int64_t end_124222;
        
        start_124221 = start;
        end_124222 = end;
        
        int64_t n_124223 = end_124222 - start_124221;
        
        for (int64_t SegRed_i_124224 = start_124221; SegRed_i_124224 < start_124221 + n_124223; SegRed_i_124224++) {
            int64_t gtid_119499 = SegRed_i_124224;
            double eta_p_119503 = ((double *) ext_mem_119407.mem)[gtid_119499];
            bool isnan_res_119504 = futrts_isnan64(eta_p_119503);
            bool not_res_119505 = !isnan_res_119504;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_119500 = local_acc_124220;
            }
            // Load next params
            {
                eta_p_119501 = not_res_119505;
            }
            // SegRed body
            {
                bool x_119502 = eta_p_119500 && eta_p_119501;
                
                local_acc_124220 = x_119502;
            }
        }
        
        int64_t uni_i_124225 = 0;
        
        {
            int64_t gtid_119499 = uni_i_124225;
            
            // Load accum params
            {
                eta_p_124216 = local_acc_124219;
            }
            // Load next params
            {
                eta_p_124217 = local_acc_124220;
            }
            // SegRed body
            {
                bool x_124218 = eta_p_124216 && eta_p_124217;
                
                local_acc_124219 = x_124218;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_124214.mem)[flat_tid_119498] = local_acc_124219;
    }
    
  cleanup:
    { }
    if (event_128241 != NULL) {
        event_128241->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128240", strdup("nothing further"), event_128241, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128237(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128236 *futhark_mc_task_128236 = (struct futhark_mc_task_128236 *) args;
    struct futhark_context *ctx = futhark_mc_task_128236->ctx;
    struct mc_event *event_128243 = mc_event_new(ctx);
    
    if (event_128243 != NULL)
        event_128243->bef = get_wall_time();
    
    struct memblock ext_mem_119407 = {.desc ="ext_mem_119407", .mem =futhark_mc_task_128236->free_ext_mem_119407, .size =0, .references =NULL};
    int64_t flat_tid_119498 = futhark_mc_task_128236->free_flat_tid_119498;
    bool defunc_0_reduce_res_119497 = *futhark_mc_task_128236->retval_defunc_0_reduce_res_119497;
    int64_t reduce_stage_1_tid_res_arr_mem_124214_cached_sizze_128238 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124214 = NULL;
    int32_t nsubtasks_124213;
    
    nsubtasks_124213 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124214_cached_sizze_128238 < nsubtasks_124213) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124214, &reduce_stage_1_tid_res_arr_mem_124214_cached_sizze_128238, nsubtasks_124213);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128239 futhark_mc_segred_stage_1_parloop_struct_128239_;
    
    futhark_mc_segred_stage_1_parloop_struct_128239_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128239_.free_ext_mem_119407 = ext_mem_119407.mem;
    futhark_mc_segred_stage_1_parloop_struct_128239_.free_reduce_stage_1_tid_res_arr_mem_124214 = reduce_stage_1_tid_res_arr_mem_124214;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128240_task;
    
    futhark_mc_segred_stage_1_parloop_128240_task.name = "futhark_mc_segred_stage_1_parloop_128240";
    futhark_mc_segred_stage_1_parloop_128240_task.fn = futhark_mc_segred_stage_1_parloop_128240;
    futhark_mc_segred_stage_1_parloop_128240_task.args = &futhark_mc_segred_stage_1_parloop_struct_128239_;
    futhark_mc_segred_stage_1_parloop_128240_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128240_task.info = info;
    
    struct mc_event *event_128242 = mc_event_new(ctx);
    
    if (event_128242 != NULL)
        event_128242->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128240_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128240_task);
    
    if (futhark_mc_segred_stage_1_parloop_128240_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128240_err;
        goto cleanup;
    }
    if (event_128242 != NULL) {
        event_128242->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128240_total", strdup("nothing further"), event_128242, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_119497 = 1;
    }
    
    bool eta_p_124226;
    bool eta_p_124227;
    
    for (int32_t i_124229 = 0; i_124229 < nsubtasks_124213; i_124229++) {
        flat_tid_119498 = i_124229;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124226 = defunc_0_reduce_res_119497;
            }
            // load next params
            {
                eta_p_124227 = ((bool *) reduce_stage_1_tid_res_arr_mem_124214)[flat_tid_119498];
            }
            // red body
            {
                bool x_124228 = eta_p_124226 && eta_p_124227;
                
                defunc_0_reduce_res_119497 = x_124228;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124214);
    }
    if (event_128243 != NULL) {
        event_128243->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128237", strdup("nothing further"), event_128243, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128236->retval_defunc_0_reduce_res_119497 = defunc_0_reduce_res_119497;
    }
    return err;
}
struct futhark_mc_task_128244 {
    struct futhark_context *ctx;
    double free_zp_res_108112;
    unsigned char *free_ext_mem_119407;
    int64_t free_flat_tid_119507;
    bool *retval_defunc_0_reduce_comm_res_119506;
};
struct futhark_mc_segred_stage_1_parloop_struct_128247 {
    struct futhark_context *ctx;
    double free_zp_res_108112;
    unsigned char *free_ext_mem_119407;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124231;
};
static int futhark_mc_segred_stage_1_parloop_128248(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128247 *futhark_mc_segred_stage_1_parloop_struct_128247 = (struct futhark_mc_segred_stage_1_parloop_struct_128247 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128247->ctx;
    struct mc_event *event_128249 = mc_event_new(ctx);
    
    if (event_128249 != NULL)
        event_128249->bef = get_wall_time();
    
    double zp_res_108112 = futhark_mc_segred_stage_1_parloop_struct_128247->free_zp_res_108112;
    struct memblock ext_mem_119407 = {.desc ="ext_mem_119407", .mem =futhark_mc_segred_stage_1_parloop_struct_128247->free_ext_mem_119407, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_124231 = {.desc ="reduce_stage_1_tid_res_arr_mem_124231", .mem =futhark_mc_segred_stage_1_parloop_struct_128247->free_reduce_stage_1_tid_res_arr_mem_124231, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_119507;
    
    flat_tid_119507 = subtask_id;
    {
        bool eta_p_124233;
        bool eta_p_124234;
        bool local_acc_124236 = 0;
        bool eta_p_119509;
        bool eta_p_119510;
        bool local_acc_124237 = 0;
        int64_t start_124238;
        int64_t end_124239;
        
        start_124238 = start;
        end_124239 = end;
        
        int64_t n_124240 = end_124239 - start_124238;
        
        for (int64_t SegRed_i_124241 = start_124238; SegRed_i_124241 < start_124238 + n_124240; SegRed_i_124241++) {
            int64_t gtid_119508 = SegRed_i_124241;
            double eta_p_119512 = ((double *) ext_mem_119407.mem)[gtid_119508];
            double zt_res_119513 = zp_res_108112 * eta_p_119512;
            bool zgze_res_119514 = 1.0 <= zt_res_119513;
            bool zgze_res_119515 = eta_p_119512 <= zp_res_108112;
            bool x_119516 = zgze_res_119514 && zgze_res_119515;
            bool not_res_119517 = !x_119516;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_119509 = local_acc_124237;
            }
            // Load next params
            {
                eta_p_119510 = not_res_119517;
            }
            // SegRed body
            {
                bool defunc_0_op_res_119511 = eta_p_119509 || eta_p_119510;
                
                local_acc_124237 = defunc_0_op_res_119511;
            }
        }
        
        int64_t uni_i_124242 = 0;
        
        {
            int64_t gtid_119508 = uni_i_124242;
            
            // Load accum params
            {
                eta_p_124233 = local_acc_124236;
            }
            // Load next params
            {
                eta_p_124234 = local_acc_124237;
            }
            // SegRed body
            {
                bool defunc_0_op_res_124235 = eta_p_124233 || eta_p_124234;
                
                local_acc_124236 = defunc_0_op_res_124235;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_124231.mem)[flat_tid_119507] = local_acc_124236;
    }
    
  cleanup:
    { }
    if (event_128249 != NULL) {
        event_128249->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128248", strdup("nothing further"), event_128249, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128245(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128244 *futhark_mc_task_128244 = (struct futhark_mc_task_128244 *) args;
    struct futhark_context *ctx = futhark_mc_task_128244->ctx;
    struct mc_event *event_128251 = mc_event_new(ctx);
    
    if (event_128251 != NULL)
        event_128251->bef = get_wall_time();
    
    double zp_res_108112 = futhark_mc_task_128244->free_zp_res_108112;
    struct memblock ext_mem_119407 = {.desc ="ext_mem_119407", .mem =futhark_mc_task_128244->free_ext_mem_119407, .size =0, .references =NULL};
    int64_t flat_tid_119507 = futhark_mc_task_128244->free_flat_tid_119507;
    bool defunc_0_reduce_comm_res_119506 = *futhark_mc_task_128244->retval_defunc_0_reduce_comm_res_119506;
    int64_t reduce_stage_1_tid_res_arr_mem_124231_cached_sizze_128246 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124231 = NULL;
    int32_t nsubtasks_124230;
    
    nsubtasks_124230 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124231_cached_sizze_128246 < nsubtasks_124230) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124231, &reduce_stage_1_tid_res_arr_mem_124231_cached_sizze_128246, nsubtasks_124230);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128247 futhark_mc_segred_stage_1_parloop_struct_128247_;
    
    futhark_mc_segred_stage_1_parloop_struct_128247_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128247_.free_zp_res_108112 = zp_res_108112;
    futhark_mc_segred_stage_1_parloop_struct_128247_.free_ext_mem_119407 = ext_mem_119407.mem;
    futhark_mc_segred_stage_1_parloop_struct_128247_.free_reduce_stage_1_tid_res_arr_mem_124231 = reduce_stage_1_tid_res_arr_mem_124231;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128248_task;
    
    futhark_mc_segred_stage_1_parloop_128248_task.name = "futhark_mc_segred_stage_1_parloop_128248";
    futhark_mc_segred_stage_1_parloop_128248_task.fn = futhark_mc_segred_stage_1_parloop_128248;
    futhark_mc_segred_stage_1_parloop_128248_task.args = &futhark_mc_segred_stage_1_parloop_struct_128247_;
    futhark_mc_segred_stage_1_parloop_128248_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128248_task.info = info;
    
    struct mc_event *event_128250 = mc_event_new(ctx);
    
    if (event_128250 != NULL)
        event_128250->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128248_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128248_task);
    
    if (futhark_mc_segred_stage_1_parloop_128248_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128248_err;
        goto cleanup;
    }
    if (event_128250 != NULL) {
        event_128250->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128248_total", strdup("nothing further"), event_128250, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_comm_res_119506 = 0;
    }
    
    bool eta_p_124243;
    bool eta_p_124244;
    
    for (int32_t i_124246 = 0; i_124246 < nsubtasks_124230; i_124246++) {
        flat_tid_119507 = i_124246;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124243 = defunc_0_reduce_comm_res_119506;
            }
            // load next params
            {
                eta_p_124244 = ((bool *) reduce_stage_1_tid_res_arr_mem_124231)[flat_tid_119507];
            }
            // red body
            {
                bool defunc_0_op_res_124245 = eta_p_124243 || eta_p_124244;
                
                defunc_0_reduce_comm_res_119506 = defunc_0_op_res_124245;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124231);
    }
    if (event_128251 != NULL) {
        event_128251->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128245", strdup("nothing further"), event_128251, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128244->retval_defunc_0_reduce_comm_res_119506 = defunc_0_reduce_comm_res_119506;
    }
    return err;
}
struct futhark_mc_task_128252 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_44883;
    double free_zs_res_44885;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_param_119548;
    unsigned char *free_mem_param_119549;
    unsigned char *free_mem_param_119552;
    int64_t free_ctx_param_ext_119556;
    int64_t free_ctx_param_ext_119557;
    int64_t free_ctx_param_ext_119558;
    int64_t free_flat_tid_119572;
    int64_t free_flat_tid_119594;
    bool *retval_defunc_0_reduce_res_119570;
    unsigned char *retval_mem_119569;
};
struct futhark_mc_segred_stage_1_parloop_struct_128255 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_44883;
    double free_zs_res_44885;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_param_119548;
    unsigned char *free_mem_param_119549;
    unsigned char *free_mem_param_119552;
    int64_t free_ctx_param_ext_119556;
    int64_t free_ctx_param_ext_119557;
    int64_t free_ctx_param_ext_119558;
    unsigned char *free_mem_119569;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124273;
};
static int futhark_mc_segred_stage_1_parloop_128256(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128255 *futhark_mc_segred_stage_1_parloop_struct_128255 = (struct futhark_mc_segred_stage_1_parloop_struct_128255 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128255->ctx;
    struct mc_event *event_128257 = mc_event_new(ctx);
    
    if (event_128257 != NULL)
        event_128257->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128255->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_segred_stage_1_parloop_struct_128255->free_exp_absorb_cutoff_33394;
    double zs_res_44883 = futhark_mc_segred_stage_1_parloop_struct_128255->free_zs_res_44883;
    double zs_res_44885 = futhark_mc_segred_stage_1_parloop_struct_128255->free_zs_res_44885;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128255->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_128255->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_119548 = {.desc ="mem_param_119548", .mem =futhark_mc_segred_stage_1_parloop_struct_128255->free_mem_param_119548, .size =0, .references =NULL};
    struct memblock mem_param_119549 = {.desc ="mem_param_119549", .mem =futhark_mc_segred_stage_1_parloop_struct_128255->free_mem_param_119549, .size =0, .references =NULL};
    struct memblock mem_param_119552 = {.desc ="mem_param_119552", .mem =futhark_mc_segred_stage_1_parloop_struct_128255->free_mem_param_119552, .size =0, .references =NULL};
    int64_t ctx_param_ext_119556 = futhark_mc_segred_stage_1_parloop_struct_128255->free_ctx_param_ext_119556;
    int64_t ctx_param_ext_119557 = futhark_mc_segred_stage_1_parloop_struct_128255->free_ctx_param_ext_119557;
    int64_t ctx_param_ext_119558 = futhark_mc_segred_stage_1_parloop_struct_128255->free_ctx_param_ext_119558;
    struct memblock mem_119569 = {.desc ="mem_119569", .mem =futhark_mc_segred_stage_1_parloop_struct_128255->free_mem_119569, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_124273 = {.desc ="reduce_stage_1_tid_res_arr_mem_124273", .mem =futhark_mc_segred_stage_1_parloop_struct_128255->free_reduce_stage_1_tid_res_arr_mem_124273, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_119594;
    
    flat_tid_119594 = subtask_id;
    {
        bool eta_p_124275;
        bool eta_p_124276;
        bool local_acc_124278 = 0;
        bool eta_p_119596;
        bool eta_p_119597;
        bool local_acc_124279 = 0;
        int64_t start_124280;
        int64_t end_124281;
        
        start_124280 = start;
        end_124281 = end;
        
        int64_t n_124282 = end_124281 - start_124280;
        
        for (int64_t SegRed_i_124283 = start_124280; SegRed_i_124283 < start_124280 + n_124282; SegRed_i_124283++) {
            int64_t gtid_119595 = SegRed_i_124283;
            double eta_p_119599 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + gtid_119595];
            double eta_p_119600 = ((double *) mem_param_119552.mem)[gtid_119595];
            double defunc_0_reduce_res_119601;
            double redout_119603 = 0.0;
            
            for (int64_t i_119602 = 0; i_119602 < m_33388; i_119602++) {
                double eta_p_119604 = ((double *) mem_param_119549.mem)[i_119602];
                double eta_p_119605 = ((double *) mem_param_119548.mem)[ctx_param_ext_119556 + (i_119602 * ctx_param_ext_119557 + gtid_119595 * ctx_param_ext_119558)];
                double zt_res_119606 = eta_p_119604 * eta_p_119605;
                double zp_res_119607 = zt_res_119606 + redout_119603;
                double redout_tmp_124284 = zp_res_119607;
                
                redout_119603 = redout_tmp_124284;
            }
            defunc_0_reduce_res_119601 = redout_119603;
            
            double zs_res_119608 = defunc_0_reduce_res_119601 / eta_p_119599;
            double ztzt_res_119609 = fpow64(zs_res_119608, zs_res_44883);
            double zt_res_119610 = zs_res_44885 * eta_p_119600;
            double exp_res_119611 = futrts_exp64(zt_res_119610);
            double zt_res_119612 = ztzt_res_119609 * exp_res_119611;
            bool zgze_res_119613 = exp_absorb_cutoff_33394 <= zt_res_119612;
            
            // save map-out results
            {
                ((double *) mem_119569.mem)[gtid_119595] = zt_res_119612;
            }
            // Load accum params
            {
                eta_p_119596 = local_acc_124279;
            }
            // Load next params
            {
                eta_p_119597 = zgze_res_119613;
            }
            // SegRed body
            {
                bool defunc_0_op_res_119598 = eta_p_119596 || eta_p_119597;
                
                local_acc_124279 = defunc_0_op_res_119598;
            }
        }
        
        int64_t uni_i_124285 = 0;
        
        {
            int64_t gtid_119595 = uni_i_124285;
            
            // Load accum params
            {
                eta_p_124275 = local_acc_124278;
            }
            // Load next params
            {
                eta_p_124276 = local_acc_124279;
            }
            // SegRed body
            {
                bool defunc_0_op_res_124277 = eta_p_124275 || eta_p_124276;
                
                local_acc_124278 = defunc_0_op_res_124277;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_124273.mem)[flat_tid_119594] = local_acc_124278;
    }
    
  cleanup:
    { }
    if (event_128257 != NULL) {
        event_128257->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128256", strdup("nothing further"), event_128257, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128253(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128252 *futhark_mc_task_128252 = (struct futhark_mc_task_128252 *) args;
    struct futhark_context *ctx = futhark_mc_task_128252->ctx;
    struct mc_event *event_128259 = mc_event_new(ctx);
    
    if (event_128259 != NULL)
        event_128259->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128252->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_task_128252->free_exp_absorb_cutoff_33394;
    double zs_res_44883 = futhark_mc_task_128252->free_zs_res_44883;
    double zs_res_44885 = futhark_mc_task_128252->free_zs_res_44885;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128252->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128252->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_119548 = {.desc ="mem_param_119548", .mem =futhark_mc_task_128252->free_mem_param_119548, .size =0, .references =NULL};
    struct memblock mem_param_119549 = {.desc ="mem_param_119549", .mem =futhark_mc_task_128252->free_mem_param_119549, .size =0, .references =NULL};
    struct memblock mem_param_119552 = {.desc ="mem_param_119552", .mem =futhark_mc_task_128252->free_mem_param_119552, .size =0, .references =NULL};
    int64_t ctx_param_ext_119556 = futhark_mc_task_128252->free_ctx_param_ext_119556;
    int64_t ctx_param_ext_119557 = futhark_mc_task_128252->free_ctx_param_ext_119557;
    int64_t ctx_param_ext_119558 = futhark_mc_task_128252->free_ctx_param_ext_119558;
    int64_t flat_tid_119572 = futhark_mc_task_128252->free_flat_tid_119572;
    int64_t flat_tid_119594 = futhark_mc_task_128252->free_flat_tid_119594;
    bool defunc_0_reduce_res_119570 = *futhark_mc_task_128252->retval_defunc_0_reduce_res_119570;
    struct memblock mem_119569 = {.desc ="mem_119569", .mem =futhark_mc_task_128252->retval_mem_119569, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_124273_cached_sizze_128254 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124273 = NULL;
    int32_t nsubtasks_124272;
    
    nsubtasks_124272 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124273_cached_sizze_128254 < nsubtasks_124272) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124273, &reduce_stage_1_tid_res_arr_mem_124273_cached_sizze_128254, nsubtasks_124272);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128255 futhark_mc_segred_stage_1_parloop_struct_128255_;
    
    futhark_mc_segred_stage_1_parloop_struct_128255_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128255_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128255_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segred_stage_1_parloop_struct_128255_.free_zs_res_44883 = zs_res_44883;
    futhark_mc_segred_stage_1_parloop_struct_128255_.free_zs_res_44885 = zs_res_44885;
    futhark_mc_segred_stage_1_parloop_struct_128255_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128255_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_128255_.free_mem_param_119548 = mem_param_119548.mem;
    futhark_mc_segred_stage_1_parloop_struct_128255_.free_mem_param_119549 = mem_param_119549.mem;
    futhark_mc_segred_stage_1_parloop_struct_128255_.free_mem_param_119552 = mem_param_119552.mem;
    futhark_mc_segred_stage_1_parloop_struct_128255_.free_ctx_param_ext_119556 = ctx_param_ext_119556;
    futhark_mc_segred_stage_1_parloop_struct_128255_.free_ctx_param_ext_119557 = ctx_param_ext_119557;
    futhark_mc_segred_stage_1_parloop_struct_128255_.free_ctx_param_ext_119558 = ctx_param_ext_119558;
    futhark_mc_segred_stage_1_parloop_struct_128255_.free_mem_119569 = mem_119569.mem;
    futhark_mc_segred_stage_1_parloop_struct_128255_.free_reduce_stage_1_tid_res_arr_mem_124273 = reduce_stage_1_tid_res_arr_mem_124273;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128256_task;
    
    futhark_mc_segred_stage_1_parloop_128256_task.name = "futhark_mc_segred_stage_1_parloop_128256";
    futhark_mc_segred_stage_1_parloop_128256_task.fn = futhark_mc_segred_stage_1_parloop_128256;
    futhark_mc_segred_stage_1_parloop_128256_task.args = &futhark_mc_segred_stage_1_parloop_struct_128255_;
    futhark_mc_segred_stage_1_parloop_128256_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128256_task.info = info;
    
    struct mc_event *event_128258 = mc_event_new(ctx);
    
    if (event_128258 != NULL)
        event_128258->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128256_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128256_task);
    
    if (futhark_mc_segred_stage_1_parloop_128256_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128256_err;
        goto cleanup;
    }
    if (event_128258 != NULL) {
        event_128258->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128256_total", strdup("nothing further"), event_128258, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_119570 = 0;
    }
    
    bool eta_p_124286;
    bool eta_p_124287;
    
    for (int32_t i_124289 = 0; i_124289 < nsubtasks_124272; i_124289++) {
        flat_tid_119594 = i_124289;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124286 = defunc_0_reduce_res_119570;
            }
            // load next params
            {
                eta_p_124287 = ((bool *) reduce_stage_1_tid_res_arr_mem_124273)[flat_tid_119594];
            }
            // red body
            {
                bool defunc_0_op_res_124288 = eta_p_124286 || eta_p_124287;
                
                defunc_0_reduce_res_119570 = defunc_0_op_res_124288;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124273);
    }
    if (event_128259 != NULL) {
        event_128259->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128253", strdup("nothing further"), event_128259, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128252->retval_defunc_0_reduce_res_119570 = defunc_0_reduce_res_119570;
        futhark_mc_task_128252->retval_mem_119569 = mem_119569.mem;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_128262 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_44883;
    double free_zs_res_44885;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_param_119548;
    unsigned char *free_mem_param_119549;
    unsigned char *free_mem_param_119552;
    int64_t free_ctx_param_ext_119556;
    int64_t free_ctx_param_ext_119557;
    int64_t free_ctx_param_ext_119558;
    unsigned char *free_mem_119569;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124291;
};
struct futhark_mc_task_128264 {
    struct futhark_context *ctx;
    unsigned char *free_mem_param_119548;
    unsigned char *free_mem_param_119549;
    int64_t free_ctx_param_ext_119556;
    int64_t free_ctx_param_ext_119557;
    int64_t free_ctx_param_ext_119558;
    int64_t free_gtid_119573;
    int64_t free_flat_tid_119580;
    double *retval_defunc_0_reduce_res_119579;
};
struct futhark_mc_segred_stage_1_parloop_struct_128267 {
    struct futhark_context *ctx;
    unsigned char *free_mem_param_119548;
    unsigned char *free_mem_param_119549;
    int64_t free_ctx_param_ext_119556;
    int64_t free_ctx_param_ext_119557;
    int64_t free_ctx_param_ext_119558;
    int64_t free_gtid_119573;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124303;
};
static int futhark_mc_segred_stage_1_parloop_128268(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128267 *futhark_mc_segred_stage_1_parloop_struct_128267 = (struct futhark_mc_segred_stage_1_parloop_struct_128267 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128267->ctx;
    struct mc_event *event_128269 = mc_event_new(ctx);
    
    if (event_128269 != NULL)
        event_128269->bef = get_wall_time();
    
    struct memblock mem_param_119548 = {.desc ="mem_param_119548", .mem =futhark_mc_segred_stage_1_parloop_struct_128267->free_mem_param_119548, .size =0, .references =NULL};
    struct memblock mem_param_119549 = {.desc ="mem_param_119549", .mem =futhark_mc_segred_stage_1_parloop_struct_128267->free_mem_param_119549, .size =0, .references =NULL};
    int64_t ctx_param_ext_119556 = futhark_mc_segred_stage_1_parloop_struct_128267->free_ctx_param_ext_119556;
    int64_t ctx_param_ext_119557 = futhark_mc_segred_stage_1_parloop_struct_128267->free_ctx_param_ext_119557;
    int64_t ctx_param_ext_119558 = futhark_mc_segred_stage_1_parloop_struct_128267->free_ctx_param_ext_119558;
    int64_t gtid_119573 = futhark_mc_segred_stage_1_parloop_struct_128267->free_gtid_119573;
    struct memblock reduce_stage_1_tid_res_arr_mem_124303 = {.desc ="reduce_stage_1_tid_res_arr_mem_124303", .mem =futhark_mc_segred_stage_1_parloop_struct_128267->free_reduce_stage_1_tid_res_arr_mem_124303, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_119580;
    
    flat_tid_119580 = subtask_id;
    {
        double eta_p_124305;
        double eta_p_124306;
        double local_acc_124308 = 0.0;
        double eta_p_119582;
        double eta_p_119583;
        double local_acc_124309 = 0.0;
        int64_t start_124310;
        int64_t end_124311;
        
        start_124310 = start;
        end_124311 = end;
        
        int64_t n_124312 = end_124311 - start_124310;
        
        for (int64_t SegRed_i_124313 = start_124310; SegRed_i_124313 < start_124310 + n_124312; SegRed_i_124313++) {
            int64_t gtid_119581 = SegRed_i_124313;
            double eta_p_119585 = ((double *) mem_param_119549.mem)[gtid_119581];
            double eta_p_119586 = ((double *) mem_param_119548.mem)[ctx_param_ext_119556 + (gtid_119581 * ctx_param_ext_119557 + gtid_119573 * ctx_param_ext_119558)];
            double zt_res_119587 = eta_p_119585 * eta_p_119586;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_119582 = local_acc_124309;
            }
            // Load next params
            {
                eta_p_119583 = zt_res_119587;
            }
            // SegRed body
            {
                double zp_res_119584 = eta_p_119582 + eta_p_119583;
                
                local_acc_124309 = zp_res_119584;
            }
        }
        
        int64_t uni_i_124314 = 0;
        
        {
            int64_t gtid_119581 = uni_i_124314;
            
            // Load accum params
            {
                eta_p_124305 = local_acc_124308;
            }
            // Load next params
            {
                eta_p_124306 = local_acc_124309;
            }
            // SegRed body
            {
                double zp_res_124307 = eta_p_124305 + eta_p_124306;
                
                local_acc_124308 = zp_res_124307;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_124303.mem)[flat_tid_119580] = local_acc_124308;
    }
    
  cleanup:
    { }
    if (event_128269 != NULL) {
        event_128269->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128268", strdup("nothing further"), event_128269, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128265(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128264 *futhark_mc_task_128264 = (struct futhark_mc_task_128264 *) args;
    struct futhark_context *ctx = futhark_mc_task_128264->ctx;
    struct mc_event *event_128271 = mc_event_new(ctx);
    
    if (event_128271 != NULL)
        event_128271->bef = get_wall_time();
    
    struct memblock mem_param_119548 = {.desc ="mem_param_119548", .mem =futhark_mc_task_128264->free_mem_param_119548, .size =0, .references =NULL};
    struct memblock mem_param_119549 = {.desc ="mem_param_119549", .mem =futhark_mc_task_128264->free_mem_param_119549, .size =0, .references =NULL};
    int64_t ctx_param_ext_119556 = futhark_mc_task_128264->free_ctx_param_ext_119556;
    int64_t ctx_param_ext_119557 = futhark_mc_task_128264->free_ctx_param_ext_119557;
    int64_t ctx_param_ext_119558 = futhark_mc_task_128264->free_ctx_param_ext_119558;
    int64_t gtid_119573 = futhark_mc_task_128264->free_gtid_119573;
    int64_t flat_tid_119580 = futhark_mc_task_128264->free_flat_tid_119580;
    double defunc_0_reduce_res_119579 = *futhark_mc_task_128264->retval_defunc_0_reduce_res_119579;
    int64_t reduce_stage_1_tid_res_arr_mem_124303_cached_sizze_128266 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124303 = NULL;
    int32_t nsubtasks_124302;
    
    nsubtasks_124302 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124303_cached_sizze_128266 < (int64_t) 8 * nsubtasks_124302) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124303, &reduce_stage_1_tid_res_arr_mem_124303_cached_sizze_128266, (int64_t) 8 * nsubtasks_124302);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128267 futhark_mc_segred_stage_1_parloop_struct_128267_;
    
    futhark_mc_segred_stage_1_parloop_struct_128267_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128267_.free_mem_param_119548 = mem_param_119548.mem;
    futhark_mc_segred_stage_1_parloop_struct_128267_.free_mem_param_119549 = mem_param_119549.mem;
    futhark_mc_segred_stage_1_parloop_struct_128267_.free_ctx_param_ext_119556 = ctx_param_ext_119556;
    futhark_mc_segred_stage_1_parloop_struct_128267_.free_ctx_param_ext_119557 = ctx_param_ext_119557;
    futhark_mc_segred_stage_1_parloop_struct_128267_.free_ctx_param_ext_119558 = ctx_param_ext_119558;
    futhark_mc_segred_stage_1_parloop_struct_128267_.free_gtid_119573 = gtid_119573;
    futhark_mc_segred_stage_1_parloop_struct_128267_.free_reduce_stage_1_tid_res_arr_mem_124303 = reduce_stage_1_tid_res_arr_mem_124303;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128268_task;
    
    futhark_mc_segred_stage_1_parloop_128268_task.name = "futhark_mc_segred_stage_1_parloop_128268";
    futhark_mc_segred_stage_1_parloop_128268_task.fn = futhark_mc_segred_stage_1_parloop_128268;
    futhark_mc_segred_stage_1_parloop_128268_task.args = &futhark_mc_segred_stage_1_parloop_struct_128267_;
    futhark_mc_segred_stage_1_parloop_128268_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128268_task.info = info;
    
    struct mc_event *event_128270 = mc_event_new(ctx);
    
    if (event_128270 != NULL)
        event_128270->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128268_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128268_task);
    
    if (futhark_mc_segred_stage_1_parloop_128268_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128268_err;
        goto cleanup;
    }
    if (event_128270 != NULL) {
        event_128270->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128268_total", strdup("nothing further"), event_128270, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_119579 = 0.0;
    }
    
    double eta_p_124315;
    double eta_p_124316;
    
    for (int32_t i_124318 = 0; i_124318 < nsubtasks_124302; i_124318++) {
        flat_tid_119580 = i_124318;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124315 = defunc_0_reduce_res_119579;
            }
            // load next params
            {
                eta_p_124316 = ((double *) reduce_stage_1_tid_res_arr_mem_124303)[flat_tid_119580];
            }
            // red body
            {
                double zp_res_124317 = eta_p_124315 + eta_p_124316;
                
                defunc_0_reduce_res_119579 = zp_res_124317;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124303);
    }
    if (event_128271 != NULL) {
        event_128271->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128265", strdup("nothing further"), event_128271, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128264->retval_defunc_0_reduce_res_119579 = defunc_0_reduce_res_119579;
    }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_128263(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128262 *futhark_mc_segred_stage_1_parloop_struct_128262 = (struct futhark_mc_segred_stage_1_parloop_struct_128262 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128262->ctx;
    struct mc_event *event_128272 = mc_event_new(ctx);
    
    if (event_128272 != NULL)
        event_128272->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128262->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_segred_stage_1_parloop_struct_128262->free_exp_absorb_cutoff_33394;
    double zs_res_44883 = futhark_mc_segred_stage_1_parloop_struct_128262->free_zs_res_44883;
    double zs_res_44885 = futhark_mc_segred_stage_1_parloop_struct_128262->free_zs_res_44885;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128262->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_128262->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_119548 = {.desc ="mem_param_119548", .mem =futhark_mc_segred_stage_1_parloop_struct_128262->free_mem_param_119548, .size =0, .references =NULL};
    struct memblock mem_param_119549 = {.desc ="mem_param_119549", .mem =futhark_mc_segred_stage_1_parloop_struct_128262->free_mem_param_119549, .size =0, .references =NULL};
    struct memblock mem_param_119552 = {.desc ="mem_param_119552", .mem =futhark_mc_segred_stage_1_parloop_struct_128262->free_mem_param_119552, .size =0, .references =NULL};
    int64_t ctx_param_ext_119556 = futhark_mc_segred_stage_1_parloop_struct_128262->free_ctx_param_ext_119556;
    int64_t ctx_param_ext_119557 = futhark_mc_segred_stage_1_parloop_struct_128262->free_ctx_param_ext_119557;
    int64_t ctx_param_ext_119558 = futhark_mc_segred_stage_1_parloop_struct_128262->free_ctx_param_ext_119558;
    struct memblock mem_119569 = {.desc ="mem_119569", .mem =futhark_mc_segred_stage_1_parloop_struct_128262->free_mem_119569, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_124291 = {.desc ="reduce_stage_1_tid_res_arr_mem_124291", .mem =futhark_mc_segred_stage_1_parloop_struct_128262->free_reduce_stage_1_tid_res_arr_mem_124291, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_119572;
    
    flat_tid_119572 = subtask_id;
    {
        bool eta_p_124293;
        bool eta_p_124294;
        bool local_acc_124296 = 0;
        bool eta_p_119574;
        bool eta_p_119575;
        bool local_acc_124297 = 0;
        int64_t start_124298;
        int64_t end_124299;
        
        start_124298 = start;
        end_124299 = end;
        
        int64_t n_124300 = end_124299 - start_124298;
        
        for (int64_t SegRed_i_124301 = start_124298; SegRed_i_124301 < start_124298 + n_124300; SegRed_i_124301++) {
            int64_t gtid_119573 = SegRed_i_124301;
            double eta_p_119577 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + gtid_119573];
            double eta_p_119578 = ((double *) mem_param_119552.mem)[gtid_119573];
            double defunc_0_reduce_res_119579;
            int64_t flat_tid_119580 = (int64_t) 0;
            
            defunc_0_reduce_res_119579 = 0.0;
            
            struct futhark_mc_task_128264 futhark_mc_task_128264_;
            
            futhark_mc_task_128264_.ctx = ctx;
            futhark_mc_task_128264_.free_mem_param_119548 = mem_param_119548.mem;
            futhark_mc_task_128264_.free_mem_param_119549 = mem_param_119549.mem;
            futhark_mc_task_128264_.free_ctx_param_ext_119556 = ctx_param_ext_119556;
            futhark_mc_task_128264_.free_ctx_param_ext_119557 = ctx_param_ext_119557;
            futhark_mc_task_128264_.free_ctx_param_ext_119558 = ctx_param_ext_119558;
            futhark_mc_task_128264_.free_gtid_119573 = gtid_119573;
            futhark_mc_task_128264_.free_flat_tid_119580 = flat_tid_119580;
            futhark_mc_task_128264_.retval_defunc_0_reduce_res_119579 = (double *) &defunc_0_reduce_res_119579;
            #if ISPC
            futhark_mc_task_128264_.retval_defunc_0_reduce_res_119579 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_128264_task;
            
            futhark_mc_task_128264_task.args = &futhark_mc_task_128264_;
            futhark_mc_task_128264_task.top_level_fn = futhark_mc_segred_task_128265;
            futhark_mc_task_128264_task.name = "futhark_mc_segred_task_128265";
            futhark_mc_task_128264_task.iterations = m_33388;
            futhark_mc_task_128264_task.task_time = &ctx->program->futhark_mc_segred_task_128265_total_time;
            futhark_mc_task_128264_task.task_iter = &ctx->program->futhark_mc_segred_task_128265_total_iter;
            futhark_mc_task_128264_task.sched = STATIC;
            futhark_mc_task_128264_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_128265_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128264_task);
            
            if (futhark_mc_segred_task_128265_err != 0) {
                err = futhark_mc_segred_task_128265_err;
                goto cleanup;
            }
            
            double zs_res_119588 = defunc_0_reduce_res_119579 / eta_p_119577;
            double ztzt_res_119589 = fpow64(zs_res_119588, zs_res_44883);
            double zt_res_119590 = zs_res_44885 * eta_p_119578;
            double exp_res_119591 = futrts_exp64(zt_res_119590);
            double zt_res_119592 = ztzt_res_119589 * exp_res_119591;
            bool zgze_res_119593 = exp_absorb_cutoff_33394 <= zt_res_119592;
            
            // save map-out results
            {
                ((double *) mem_119569.mem)[gtid_119573] = zt_res_119592;
            }
            // Load accum params
            {
                eta_p_119574 = local_acc_124297;
            }
            // Load next params
            {
                eta_p_119575 = zgze_res_119593;
            }
            // SegRed body
            {
                bool defunc_0_op_res_119576 = eta_p_119574 || eta_p_119575;
                
                local_acc_124297 = defunc_0_op_res_119576;
            }
        }
        
        int64_t uni_i_124319 = 0;
        
        {
            int64_t gtid_119573 = uni_i_124319;
            
            // Load accum params
            {
                eta_p_124293 = local_acc_124296;
            }
            // Load next params
            {
                eta_p_124294 = local_acc_124297;
            }
            // SegRed body
            {
                bool defunc_0_op_res_124295 = eta_p_124293 || eta_p_124294;
                
                local_acc_124296 = defunc_0_op_res_124295;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_124291.mem)[flat_tid_119572] = local_acc_124296;
    }
    
  cleanup:
    { }
    if (event_128272 != NULL) {
        event_128272->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128263", strdup("nothing further"), event_128272, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_128260(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128252 *futhark_mc_task_128252 = (struct futhark_mc_task_128252 *) args;
    struct futhark_context *ctx = futhark_mc_task_128252->ctx;
    struct mc_event *event_128274 = mc_event_new(ctx);
    
    if (event_128274 != NULL)
        event_128274->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128252->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_task_128252->free_exp_absorb_cutoff_33394;
    double zs_res_44883 = futhark_mc_task_128252->free_zs_res_44883;
    double zs_res_44885 = futhark_mc_task_128252->free_zs_res_44885;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128252->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128252->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_119548 = {.desc ="mem_param_119548", .mem =futhark_mc_task_128252->free_mem_param_119548, .size =0, .references =NULL};
    struct memblock mem_param_119549 = {.desc ="mem_param_119549", .mem =futhark_mc_task_128252->free_mem_param_119549, .size =0, .references =NULL};
    struct memblock mem_param_119552 = {.desc ="mem_param_119552", .mem =futhark_mc_task_128252->free_mem_param_119552, .size =0, .references =NULL};
    int64_t ctx_param_ext_119556 = futhark_mc_task_128252->free_ctx_param_ext_119556;
    int64_t ctx_param_ext_119557 = futhark_mc_task_128252->free_ctx_param_ext_119557;
    int64_t ctx_param_ext_119558 = futhark_mc_task_128252->free_ctx_param_ext_119558;
    int64_t flat_tid_119572 = futhark_mc_task_128252->free_flat_tid_119572;
    int64_t flat_tid_119594 = futhark_mc_task_128252->free_flat_tid_119594;
    bool defunc_0_reduce_res_119570 = *futhark_mc_task_128252->retval_defunc_0_reduce_res_119570;
    struct memblock mem_119569 = {.desc ="mem_119569", .mem =futhark_mc_task_128252->retval_mem_119569, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_124291_cached_sizze_128261 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124291 = NULL;
    int32_t nsubtasks_124290;
    
    nsubtasks_124290 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124291_cached_sizze_128261 < nsubtasks_124290) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124291, &reduce_stage_1_tid_res_arr_mem_124291_cached_sizze_128261, nsubtasks_124290);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128262 futhark_mc_segred_stage_1_parloop_struct_128262_;
    
    futhark_mc_segred_stage_1_parloop_struct_128262_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128262_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128262_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segred_stage_1_parloop_struct_128262_.free_zs_res_44883 = zs_res_44883;
    futhark_mc_segred_stage_1_parloop_struct_128262_.free_zs_res_44885 = zs_res_44885;
    futhark_mc_segred_stage_1_parloop_struct_128262_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128262_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_128262_.free_mem_param_119548 = mem_param_119548.mem;
    futhark_mc_segred_stage_1_parloop_struct_128262_.free_mem_param_119549 = mem_param_119549.mem;
    futhark_mc_segred_stage_1_parloop_struct_128262_.free_mem_param_119552 = mem_param_119552.mem;
    futhark_mc_segred_stage_1_parloop_struct_128262_.free_ctx_param_ext_119556 = ctx_param_ext_119556;
    futhark_mc_segred_stage_1_parloop_struct_128262_.free_ctx_param_ext_119557 = ctx_param_ext_119557;
    futhark_mc_segred_stage_1_parloop_struct_128262_.free_ctx_param_ext_119558 = ctx_param_ext_119558;
    futhark_mc_segred_stage_1_parloop_struct_128262_.free_mem_119569 = mem_119569.mem;
    futhark_mc_segred_stage_1_parloop_struct_128262_.free_reduce_stage_1_tid_res_arr_mem_124291 = reduce_stage_1_tid_res_arr_mem_124291;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128263_task;
    
    futhark_mc_segred_stage_1_parloop_128263_task.name = "futhark_mc_segred_stage_1_parloop_128263";
    futhark_mc_segred_stage_1_parloop_128263_task.fn = futhark_mc_segred_stage_1_parloop_128263;
    futhark_mc_segred_stage_1_parloop_128263_task.args = &futhark_mc_segred_stage_1_parloop_struct_128262_;
    futhark_mc_segred_stage_1_parloop_128263_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128263_task.info = info;
    
    struct mc_event *event_128273 = mc_event_new(ctx);
    
    if (event_128273 != NULL)
        event_128273->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128263_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128263_task);
    
    if (futhark_mc_segred_stage_1_parloop_128263_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128263_err;
        goto cleanup;
    }
    if (event_128273 != NULL) {
        event_128273->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128263_total", strdup("nothing further"), event_128273, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_119570 = 0;
    }
    
    bool eta_p_124320;
    bool eta_p_124321;
    
    for (int32_t i_124323 = 0; i_124323 < nsubtasks_124290; i_124323++) {
        flat_tid_119572 = i_124323;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124320 = defunc_0_reduce_res_119570;
            }
            // load next params
            {
                eta_p_124321 = ((bool *) reduce_stage_1_tid_res_arr_mem_124291)[flat_tid_119572];
            }
            // red body
            {
                bool defunc_0_op_res_124322 = eta_p_124320 || eta_p_124321;
                
                defunc_0_reduce_res_119570 = defunc_0_op_res_124322;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124291);
    }
    if (event_128274 != NULL) {
        event_128274->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_128260", strdup("nothing further"), event_128274, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128252->retval_defunc_0_reduce_res_119570 = defunc_0_reduce_res_119570;
        futhark_mc_task_128252->retval_mem_119569 = mem_119569.mem;
    }
    return err;
}
struct futhark_mc_task_128275 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_44842;
    double free_zs_res_44844;
    int64_t free_eta_p_106382;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_param_119548;
    unsigned char *free_mem_param_119551;
    int64_t free_ctx_param_ext_119556;
    int64_t free_ctx_param_ext_119557;
    int64_t free_ctx_param_ext_119558;
    unsigned char *free_mem_119569;
    int64_t free_flat_tid_119617;
    int64_t free_flat_tid_119639;
    bool *retval_defunc_0_reduce_res_119615;
    unsigned char *retval_mem_119614;
};
struct futhark_mc_segred_stage_1_parloop_struct_128278 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_44842;
    double free_zs_res_44844;
    int64_t free_eta_p_106382;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_param_119548;
    unsigned char *free_mem_param_119551;
    int64_t free_ctx_param_ext_119556;
    int64_t free_ctx_param_ext_119557;
    int64_t free_ctx_param_ext_119558;
    unsigned char *free_mem_119569;
    unsigned char *free_mem_119614;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124325;
};
static int futhark_mc_segred_stage_1_parloop_128279(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128278 *futhark_mc_segred_stage_1_parloop_struct_128278 = (struct futhark_mc_segred_stage_1_parloop_struct_128278 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128278->ctx;
    struct mc_event *event_128280 = mc_event_new(ctx);
    
    if (event_128280 != NULL)
        event_128280->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128278->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_segred_stage_1_parloop_struct_128278->free_exp_absorb_cutoff_33394;
    double zs_res_44842 = futhark_mc_segred_stage_1_parloop_struct_128278->free_zs_res_44842;
    double zs_res_44844 = futhark_mc_segred_stage_1_parloop_struct_128278->free_zs_res_44844;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_128278->free_eta_p_106382;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_128278->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_119548 = {.desc ="mem_param_119548", .mem =futhark_mc_segred_stage_1_parloop_struct_128278->free_mem_param_119548, .size =0, .references =NULL};
    struct memblock mem_param_119551 = {.desc ="mem_param_119551", .mem =futhark_mc_segred_stage_1_parloop_struct_128278->free_mem_param_119551, .size =0, .references =NULL};
    int64_t ctx_param_ext_119556 = futhark_mc_segred_stage_1_parloop_struct_128278->free_ctx_param_ext_119556;
    int64_t ctx_param_ext_119557 = futhark_mc_segred_stage_1_parloop_struct_128278->free_ctx_param_ext_119557;
    int64_t ctx_param_ext_119558 = futhark_mc_segred_stage_1_parloop_struct_128278->free_ctx_param_ext_119558;
    struct memblock mem_119569 = {.desc ="mem_119569", .mem =futhark_mc_segred_stage_1_parloop_struct_128278->free_mem_119569, .size =0, .references =NULL};
    struct memblock mem_119614 = {.desc ="mem_119614", .mem =futhark_mc_segred_stage_1_parloop_struct_128278->free_mem_119614, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_124325 = {.desc ="reduce_stage_1_tid_res_arr_mem_124325", .mem =futhark_mc_segred_stage_1_parloop_struct_128278->free_reduce_stage_1_tid_res_arr_mem_124325, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_119639;
    
    flat_tid_119639 = subtask_id;
    {
        bool eta_p_124327;
        bool eta_p_124328;
        bool local_acc_124330 = 0;
        bool eta_p_119641;
        bool eta_p_119642;
        bool local_acc_124331 = 0;
        int64_t start_124332;
        int64_t end_124333;
        
        start_124332 = start;
        end_124333 = end;
        
        int64_t n_124334 = end_124333 - start_124332;
        
        for (int64_t SegRed_i_124335 = start_124332; SegRed_i_124335 < start_124332 + n_124334; SegRed_i_124335++) {
            int64_t gtid_119640 = SegRed_i_124335;
            double eta_p_119644 = ((double *) distrs_mem_111708.mem)[eta_p_106382 * m_33388 + gtid_119640];
            double eta_p_119645 = ((double *) mem_param_119551.mem)[gtid_119640];
            double defunc_0_reduce_res_119646;
            double redout_119648 = 0.0;
            
            for (int64_t i_119647 = 0; i_119647 < m_33388; i_119647++) {
                double eta_p_119649 = ((double *) mem_119569.mem)[i_119647];
                double eta_p_119650 = ((double *) mem_param_119548.mem)[ctx_param_ext_119556 + (gtid_119640 * ctx_param_ext_119557 + i_119647 * ctx_param_ext_119558)];
                double zt_res_119651 = eta_p_119649 * eta_p_119650;
                double zp_res_119652 = zt_res_119651 + redout_119648;
                double redout_tmp_124336 = zp_res_119652;
                
                redout_119648 = redout_tmp_124336;
            }
            defunc_0_reduce_res_119646 = redout_119648;
            
            double zs_res_119653 = defunc_0_reduce_res_119646 / eta_p_119644;
            double ztzt_res_119654 = fpow64(zs_res_119653, zs_res_44842);
            double zt_res_119655 = zs_res_44844 * eta_p_119645;
            double exp_res_119656 = futrts_exp64(zt_res_119655);
            double zt_res_119657 = ztzt_res_119654 * exp_res_119656;
            bool zgze_res_119658 = exp_absorb_cutoff_33394 <= zt_res_119657;
            
            // save map-out results
            {
                ((double *) mem_119614.mem)[gtid_119640] = zt_res_119657;
            }
            // Load accum params
            {
                eta_p_119641 = local_acc_124331;
            }
            // Load next params
            {
                eta_p_119642 = zgze_res_119658;
            }
            // SegRed body
            {
                bool defunc_0_op_res_119643 = eta_p_119641 || eta_p_119642;
                
                local_acc_124331 = defunc_0_op_res_119643;
            }
        }
        
        int64_t uni_i_124337 = 0;
        
        {
            int64_t gtid_119640 = uni_i_124337;
            
            // Load accum params
            {
                eta_p_124327 = local_acc_124330;
            }
            // Load next params
            {
                eta_p_124328 = local_acc_124331;
            }
            // SegRed body
            {
                bool defunc_0_op_res_124329 = eta_p_124327 || eta_p_124328;
                
                local_acc_124330 = defunc_0_op_res_124329;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_124325.mem)[flat_tid_119639] = local_acc_124330;
    }
    
  cleanup:
    { }
    if (event_128280 != NULL) {
        event_128280->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128279", strdup("nothing further"), event_128280, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128276(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128275 *futhark_mc_task_128275 = (struct futhark_mc_task_128275 *) args;
    struct futhark_context *ctx = futhark_mc_task_128275->ctx;
    struct mc_event *event_128282 = mc_event_new(ctx);
    
    if (event_128282 != NULL)
        event_128282->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128275->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_task_128275->free_exp_absorb_cutoff_33394;
    double zs_res_44842 = futhark_mc_task_128275->free_zs_res_44842;
    double zs_res_44844 = futhark_mc_task_128275->free_zs_res_44844;
    int64_t eta_p_106382 = futhark_mc_task_128275->free_eta_p_106382;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128275->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_119548 = {.desc ="mem_param_119548", .mem =futhark_mc_task_128275->free_mem_param_119548, .size =0, .references =NULL};
    struct memblock mem_param_119551 = {.desc ="mem_param_119551", .mem =futhark_mc_task_128275->free_mem_param_119551, .size =0, .references =NULL};
    int64_t ctx_param_ext_119556 = futhark_mc_task_128275->free_ctx_param_ext_119556;
    int64_t ctx_param_ext_119557 = futhark_mc_task_128275->free_ctx_param_ext_119557;
    int64_t ctx_param_ext_119558 = futhark_mc_task_128275->free_ctx_param_ext_119558;
    struct memblock mem_119569 = {.desc ="mem_119569", .mem =futhark_mc_task_128275->free_mem_119569, .size =0, .references =NULL};
    int64_t flat_tid_119617 = futhark_mc_task_128275->free_flat_tid_119617;
    int64_t flat_tid_119639 = futhark_mc_task_128275->free_flat_tid_119639;
    bool defunc_0_reduce_res_119615 = *futhark_mc_task_128275->retval_defunc_0_reduce_res_119615;
    struct memblock mem_119614 = {.desc ="mem_119614", .mem =futhark_mc_task_128275->retval_mem_119614, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_124325_cached_sizze_128277 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124325 = NULL;
    int32_t nsubtasks_124324;
    
    nsubtasks_124324 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124325_cached_sizze_128277 < nsubtasks_124324) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124325, &reduce_stage_1_tid_res_arr_mem_124325_cached_sizze_128277, nsubtasks_124324);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128278 futhark_mc_segred_stage_1_parloop_struct_128278_;
    
    futhark_mc_segred_stage_1_parloop_struct_128278_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128278_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128278_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segred_stage_1_parloop_struct_128278_.free_zs_res_44842 = zs_res_44842;
    futhark_mc_segred_stage_1_parloop_struct_128278_.free_zs_res_44844 = zs_res_44844;
    futhark_mc_segred_stage_1_parloop_struct_128278_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_128278_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_128278_.free_mem_param_119548 = mem_param_119548.mem;
    futhark_mc_segred_stage_1_parloop_struct_128278_.free_mem_param_119551 = mem_param_119551.mem;
    futhark_mc_segred_stage_1_parloop_struct_128278_.free_ctx_param_ext_119556 = ctx_param_ext_119556;
    futhark_mc_segred_stage_1_parloop_struct_128278_.free_ctx_param_ext_119557 = ctx_param_ext_119557;
    futhark_mc_segred_stage_1_parloop_struct_128278_.free_ctx_param_ext_119558 = ctx_param_ext_119558;
    futhark_mc_segred_stage_1_parloop_struct_128278_.free_mem_119569 = mem_119569.mem;
    futhark_mc_segred_stage_1_parloop_struct_128278_.free_mem_119614 = mem_119614.mem;
    futhark_mc_segred_stage_1_parloop_struct_128278_.free_reduce_stage_1_tid_res_arr_mem_124325 = reduce_stage_1_tid_res_arr_mem_124325;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128279_task;
    
    futhark_mc_segred_stage_1_parloop_128279_task.name = "futhark_mc_segred_stage_1_parloop_128279";
    futhark_mc_segred_stage_1_parloop_128279_task.fn = futhark_mc_segred_stage_1_parloop_128279;
    futhark_mc_segred_stage_1_parloop_128279_task.args = &futhark_mc_segred_stage_1_parloop_struct_128278_;
    futhark_mc_segred_stage_1_parloop_128279_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128279_task.info = info;
    
    struct mc_event *event_128281 = mc_event_new(ctx);
    
    if (event_128281 != NULL)
        event_128281->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128279_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128279_task);
    
    if (futhark_mc_segred_stage_1_parloop_128279_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128279_err;
        goto cleanup;
    }
    if (event_128281 != NULL) {
        event_128281->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128279_total", strdup("nothing further"), event_128281, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_119615 = 0;
    }
    
    bool eta_p_124338;
    bool eta_p_124339;
    
    for (int32_t i_124341 = 0; i_124341 < nsubtasks_124324; i_124341++) {
        flat_tid_119639 = i_124341;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124338 = defunc_0_reduce_res_119615;
            }
            // load next params
            {
                eta_p_124339 = ((bool *) reduce_stage_1_tid_res_arr_mem_124325)[flat_tid_119639];
            }
            // red body
            {
                bool defunc_0_op_res_124340 = eta_p_124338 || eta_p_124339;
                
                defunc_0_reduce_res_119615 = defunc_0_op_res_124340;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124325);
    }
    if (event_128282 != NULL) {
        event_128282->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128276", strdup("nothing further"), event_128282, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128275->retval_defunc_0_reduce_res_119615 = defunc_0_reduce_res_119615;
        futhark_mc_task_128275->retval_mem_119614 = mem_119614.mem;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_128285 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_44842;
    double free_zs_res_44844;
    int64_t free_eta_p_106382;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_param_119548;
    unsigned char *free_mem_param_119551;
    int64_t free_ctx_param_ext_119556;
    int64_t free_ctx_param_ext_119557;
    int64_t free_ctx_param_ext_119558;
    unsigned char *free_mem_119569;
    unsigned char *free_mem_119614;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124343;
};
struct futhark_mc_task_128287 {
    struct futhark_context *ctx;
    unsigned char *free_mem_param_119548;
    int64_t free_ctx_param_ext_119556;
    int64_t free_ctx_param_ext_119557;
    int64_t free_ctx_param_ext_119558;
    unsigned char *free_mem_119569;
    int64_t free_gtid_119618;
    int64_t free_flat_tid_119625;
    double *retval_defunc_0_reduce_res_119624;
};
struct futhark_mc_segred_stage_1_parloop_struct_128290 {
    struct futhark_context *ctx;
    unsigned char *free_mem_param_119548;
    int64_t free_ctx_param_ext_119556;
    int64_t free_ctx_param_ext_119557;
    int64_t free_ctx_param_ext_119558;
    unsigned char *free_mem_119569;
    int64_t free_gtid_119618;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124355;
};
static int futhark_mc_segred_stage_1_parloop_128291(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128290 *futhark_mc_segred_stage_1_parloop_struct_128290 = (struct futhark_mc_segred_stage_1_parloop_struct_128290 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128290->ctx;
    struct mc_event *event_128292 = mc_event_new(ctx);
    
    if (event_128292 != NULL)
        event_128292->bef = get_wall_time();
    
    struct memblock mem_param_119548 = {.desc ="mem_param_119548", .mem =futhark_mc_segred_stage_1_parloop_struct_128290->free_mem_param_119548, .size =0, .references =NULL};
    int64_t ctx_param_ext_119556 = futhark_mc_segred_stage_1_parloop_struct_128290->free_ctx_param_ext_119556;
    int64_t ctx_param_ext_119557 = futhark_mc_segred_stage_1_parloop_struct_128290->free_ctx_param_ext_119557;
    int64_t ctx_param_ext_119558 = futhark_mc_segred_stage_1_parloop_struct_128290->free_ctx_param_ext_119558;
    struct memblock mem_119569 = {.desc ="mem_119569", .mem =futhark_mc_segred_stage_1_parloop_struct_128290->free_mem_119569, .size =0, .references =NULL};
    int64_t gtid_119618 = futhark_mc_segred_stage_1_parloop_struct_128290->free_gtid_119618;
    struct memblock reduce_stage_1_tid_res_arr_mem_124355 = {.desc ="reduce_stage_1_tid_res_arr_mem_124355", .mem =futhark_mc_segred_stage_1_parloop_struct_128290->free_reduce_stage_1_tid_res_arr_mem_124355, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_119625;
    
    flat_tid_119625 = subtask_id;
    {
        double eta_p_124357;
        double eta_p_124358;
        double local_acc_124360 = 0.0;
        double eta_p_119627;
        double eta_p_119628;
        double local_acc_124361 = 0.0;
        int64_t start_124362;
        int64_t end_124363;
        
        start_124362 = start;
        end_124363 = end;
        
        int64_t n_124364 = end_124363 - start_124362;
        
        for (int64_t SegRed_i_124365 = start_124362; SegRed_i_124365 < start_124362 + n_124364; SegRed_i_124365++) {
            int64_t gtid_119626 = SegRed_i_124365;
            double eta_p_119630 = ((double *) mem_119569.mem)[gtid_119626];
            double eta_p_119631 = ((double *) mem_param_119548.mem)[ctx_param_ext_119556 + (gtid_119618 * ctx_param_ext_119557 + gtid_119626 * ctx_param_ext_119558)];
            double zt_res_119632 = eta_p_119630 * eta_p_119631;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_119627 = local_acc_124361;
            }
            // Load next params
            {
                eta_p_119628 = zt_res_119632;
            }
            // SegRed body
            {
                double zp_res_119629 = eta_p_119627 + eta_p_119628;
                
                local_acc_124361 = zp_res_119629;
            }
        }
        
        int64_t uni_i_124366 = 0;
        
        {
            int64_t gtid_119626 = uni_i_124366;
            
            // Load accum params
            {
                eta_p_124357 = local_acc_124360;
            }
            // Load next params
            {
                eta_p_124358 = local_acc_124361;
            }
            // SegRed body
            {
                double zp_res_124359 = eta_p_124357 + eta_p_124358;
                
                local_acc_124360 = zp_res_124359;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_124355.mem)[flat_tid_119625] = local_acc_124360;
    }
    
  cleanup:
    { }
    if (event_128292 != NULL) {
        event_128292->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128291", strdup("nothing further"), event_128292, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128288(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128287 *futhark_mc_task_128287 = (struct futhark_mc_task_128287 *) args;
    struct futhark_context *ctx = futhark_mc_task_128287->ctx;
    struct mc_event *event_128294 = mc_event_new(ctx);
    
    if (event_128294 != NULL)
        event_128294->bef = get_wall_time();
    
    struct memblock mem_param_119548 = {.desc ="mem_param_119548", .mem =futhark_mc_task_128287->free_mem_param_119548, .size =0, .references =NULL};
    int64_t ctx_param_ext_119556 = futhark_mc_task_128287->free_ctx_param_ext_119556;
    int64_t ctx_param_ext_119557 = futhark_mc_task_128287->free_ctx_param_ext_119557;
    int64_t ctx_param_ext_119558 = futhark_mc_task_128287->free_ctx_param_ext_119558;
    struct memblock mem_119569 = {.desc ="mem_119569", .mem =futhark_mc_task_128287->free_mem_119569, .size =0, .references =NULL};
    int64_t gtid_119618 = futhark_mc_task_128287->free_gtid_119618;
    int64_t flat_tid_119625 = futhark_mc_task_128287->free_flat_tid_119625;
    double defunc_0_reduce_res_119624 = *futhark_mc_task_128287->retval_defunc_0_reduce_res_119624;
    int64_t reduce_stage_1_tid_res_arr_mem_124355_cached_sizze_128289 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124355 = NULL;
    int32_t nsubtasks_124354;
    
    nsubtasks_124354 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124355_cached_sizze_128289 < (int64_t) 8 * nsubtasks_124354) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124355, &reduce_stage_1_tid_res_arr_mem_124355_cached_sizze_128289, (int64_t) 8 * nsubtasks_124354);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128290 futhark_mc_segred_stage_1_parloop_struct_128290_;
    
    futhark_mc_segred_stage_1_parloop_struct_128290_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128290_.free_mem_param_119548 = mem_param_119548.mem;
    futhark_mc_segred_stage_1_parloop_struct_128290_.free_ctx_param_ext_119556 = ctx_param_ext_119556;
    futhark_mc_segred_stage_1_parloop_struct_128290_.free_ctx_param_ext_119557 = ctx_param_ext_119557;
    futhark_mc_segred_stage_1_parloop_struct_128290_.free_ctx_param_ext_119558 = ctx_param_ext_119558;
    futhark_mc_segred_stage_1_parloop_struct_128290_.free_mem_119569 = mem_119569.mem;
    futhark_mc_segred_stage_1_parloop_struct_128290_.free_gtid_119618 = gtid_119618;
    futhark_mc_segred_stage_1_parloop_struct_128290_.free_reduce_stage_1_tid_res_arr_mem_124355 = reduce_stage_1_tid_res_arr_mem_124355;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128291_task;
    
    futhark_mc_segred_stage_1_parloop_128291_task.name = "futhark_mc_segred_stage_1_parloop_128291";
    futhark_mc_segred_stage_1_parloop_128291_task.fn = futhark_mc_segred_stage_1_parloop_128291;
    futhark_mc_segred_stage_1_parloop_128291_task.args = &futhark_mc_segred_stage_1_parloop_struct_128290_;
    futhark_mc_segred_stage_1_parloop_128291_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128291_task.info = info;
    
    struct mc_event *event_128293 = mc_event_new(ctx);
    
    if (event_128293 != NULL)
        event_128293->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128291_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128291_task);
    
    if (futhark_mc_segred_stage_1_parloop_128291_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128291_err;
        goto cleanup;
    }
    if (event_128293 != NULL) {
        event_128293->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128291_total", strdup("nothing further"), event_128293, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_119624 = 0.0;
    }
    
    double eta_p_124367;
    double eta_p_124368;
    
    for (int32_t i_124370 = 0; i_124370 < nsubtasks_124354; i_124370++) {
        flat_tid_119625 = i_124370;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124367 = defunc_0_reduce_res_119624;
            }
            // load next params
            {
                eta_p_124368 = ((double *) reduce_stage_1_tid_res_arr_mem_124355)[flat_tid_119625];
            }
            // red body
            {
                double zp_res_124369 = eta_p_124367 + eta_p_124368;
                
                defunc_0_reduce_res_119624 = zp_res_124369;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124355);
    }
    if (event_128294 != NULL) {
        event_128294->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128288", strdup("nothing further"), event_128294, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128287->retval_defunc_0_reduce_res_119624 = defunc_0_reduce_res_119624;
    }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_128286(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128285 *futhark_mc_segred_stage_1_parloop_struct_128285 = (struct futhark_mc_segred_stage_1_parloop_struct_128285 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128285->ctx;
    struct mc_event *event_128295 = mc_event_new(ctx);
    
    if (event_128295 != NULL)
        event_128295->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128285->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_segred_stage_1_parloop_struct_128285->free_exp_absorb_cutoff_33394;
    double zs_res_44842 = futhark_mc_segred_stage_1_parloop_struct_128285->free_zs_res_44842;
    double zs_res_44844 = futhark_mc_segred_stage_1_parloop_struct_128285->free_zs_res_44844;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_128285->free_eta_p_106382;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_128285->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_119548 = {.desc ="mem_param_119548", .mem =futhark_mc_segred_stage_1_parloop_struct_128285->free_mem_param_119548, .size =0, .references =NULL};
    struct memblock mem_param_119551 = {.desc ="mem_param_119551", .mem =futhark_mc_segred_stage_1_parloop_struct_128285->free_mem_param_119551, .size =0, .references =NULL};
    int64_t ctx_param_ext_119556 = futhark_mc_segred_stage_1_parloop_struct_128285->free_ctx_param_ext_119556;
    int64_t ctx_param_ext_119557 = futhark_mc_segred_stage_1_parloop_struct_128285->free_ctx_param_ext_119557;
    int64_t ctx_param_ext_119558 = futhark_mc_segred_stage_1_parloop_struct_128285->free_ctx_param_ext_119558;
    struct memblock mem_119569 = {.desc ="mem_119569", .mem =futhark_mc_segred_stage_1_parloop_struct_128285->free_mem_119569, .size =0, .references =NULL};
    struct memblock mem_119614 = {.desc ="mem_119614", .mem =futhark_mc_segred_stage_1_parloop_struct_128285->free_mem_119614, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_124343 = {.desc ="reduce_stage_1_tid_res_arr_mem_124343", .mem =futhark_mc_segred_stage_1_parloop_struct_128285->free_reduce_stage_1_tid_res_arr_mem_124343, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_119617;
    
    flat_tid_119617 = subtask_id;
    {
        bool eta_p_124345;
        bool eta_p_124346;
        bool local_acc_124348 = 0;
        bool eta_p_119619;
        bool eta_p_119620;
        bool local_acc_124349 = 0;
        int64_t start_124350;
        int64_t end_124351;
        
        start_124350 = start;
        end_124351 = end;
        
        int64_t n_124352 = end_124351 - start_124350;
        
        for (int64_t SegRed_i_124353 = start_124350; SegRed_i_124353 < start_124350 + n_124352; SegRed_i_124353++) {
            int64_t gtid_119618 = SegRed_i_124353;
            double eta_p_119622 = ((double *) distrs_mem_111708.mem)[eta_p_106382 * m_33388 + gtid_119618];
            double eta_p_119623 = ((double *) mem_param_119551.mem)[gtid_119618];
            double defunc_0_reduce_res_119624;
            int64_t flat_tid_119625 = (int64_t) 0;
            
            defunc_0_reduce_res_119624 = 0.0;
            
            struct futhark_mc_task_128287 futhark_mc_task_128287_;
            
            futhark_mc_task_128287_.ctx = ctx;
            futhark_mc_task_128287_.free_mem_param_119548 = mem_param_119548.mem;
            futhark_mc_task_128287_.free_ctx_param_ext_119556 = ctx_param_ext_119556;
            futhark_mc_task_128287_.free_ctx_param_ext_119557 = ctx_param_ext_119557;
            futhark_mc_task_128287_.free_ctx_param_ext_119558 = ctx_param_ext_119558;
            futhark_mc_task_128287_.free_mem_119569 = mem_119569.mem;
            futhark_mc_task_128287_.free_gtid_119618 = gtid_119618;
            futhark_mc_task_128287_.free_flat_tid_119625 = flat_tid_119625;
            futhark_mc_task_128287_.retval_defunc_0_reduce_res_119624 = (double *) &defunc_0_reduce_res_119624;
            #if ISPC
            futhark_mc_task_128287_.retval_defunc_0_reduce_res_119624 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_128287_task;
            
            futhark_mc_task_128287_task.args = &futhark_mc_task_128287_;
            futhark_mc_task_128287_task.top_level_fn = futhark_mc_segred_task_128288;
            futhark_mc_task_128287_task.name = "futhark_mc_segred_task_128288";
            futhark_mc_task_128287_task.iterations = m_33388;
            futhark_mc_task_128287_task.task_time = &ctx->program->futhark_mc_segred_task_128288_total_time;
            futhark_mc_task_128287_task.task_iter = &ctx->program->futhark_mc_segred_task_128288_total_iter;
            futhark_mc_task_128287_task.sched = STATIC;
            futhark_mc_task_128287_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_128288_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128287_task);
            
            if (futhark_mc_segred_task_128288_err != 0) {
                err = futhark_mc_segred_task_128288_err;
                goto cleanup;
            }
            
            double zs_res_119633 = defunc_0_reduce_res_119624 / eta_p_119622;
            double ztzt_res_119634 = fpow64(zs_res_119633, zs_res_44842);
            double zt_res_119635 = zs_res_44844 * eta_p_119623;
            double exp_res_119636 = futrts_exp64(zt_res_119635);
            double zt_res_119637 = ztzt_res_119634 * exp_res_119636;
            bool zgze_res_119638 = exp_absorb_cutoff_33394 <= zt_res_119637;
            
            // save map-out results
            {
                ((double *) mem_119614.mem)[gtid_119618] = zt_res_119637;
            }
            // Load accum params
            {
                eta_p_119619 = local_acc_124349;
            }
            // Load next params
            {
                eta_p_119620 = zgze_res_119638;
            }
            // SegRed body
            {
                bool defunc_0_op_res_119621 = eta_p_119619 || eta_p_119620;
                
                local_acc_124349 = defunc_0_op_res_119621;
            }
        }
        
        int64_t uni_i_124371 = 0;
        
        {
            int64_t gtid_119618 = uni_i_124371;
            
            // Load accum params
            {
                eta_p_124345 = local_acc_124348;
            }
            // Load next params
            {
                eta_p_124346 = local_acc_124349;
            }
            // SegRed body
            {
                bool defunc_0_op_res_124347 = eta_p_124345 || eta_p_124346;
                
                local_acc_124348 = defunc_0_op_res_124347;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_124343.mem)[flat_tid_119617] = local_acc_124348;
    }
    
  cleanup:
    { }
    if (event_128295 != NULL) {
        event_128295->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128286", strdup("nothing further"), event_128295, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_128283(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128275 *futhark_mc_task_128275 = (struct futhark_mc_task_128275 *) args;
    struct futhark_context *ctx = futhark_mc_task_128275->ctx;
    struct mc_event *event_128297 = mc_event_new(ctx);
    
    if (event_128297 != NULL)
        event_128297->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128275->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_task_128275->free_exp_absorb_cutoff_33394;
    double zs_res_44842 = futhark_mc_task_128275->free_zs_res_44842;
    double zs_res_44844 = futhark_mc_task_128275->free_zs_res_44844;
    int64_t eta_p_106382 = futhark_mc_task_128275->free_eta_p_106382;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128275->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_119548 = {.desc ="mem_param_119548", .mem =futhark_mc_task_128275->free_mem_param_119548, .size =0, .references =NULL};
    struct memblock mem_param_119551 = {.desc ="mem_param_119551", .mem =futhark_mc_task_128275->free_mem_param_119551, .size =0, .references =NULL};
    int64_t ctx_param_ext_119556 = futhark_mc_task_128275->free_ctx_param_ext_119556;
    int64_t ctx_param_ext_119557 = futhark_mc_task_128275->free_ctx_param_ext_119557;
    int64_t ctx_param_ext_119558 = futhark_mc_task_128275->free_ctx_param_ext_119558;
    struct memblock mem_119569 = {.desc ="mem_119569", .mem =futhark_mc_task_128275->free_mem_119569, .size =0, .references =NULL};
    int64_t flat_tid_119617 = futhark_mc_task_128275->free_flat_tid_119617;
    int64_t flat_tid_119639 = futhark_mc_task_128275->free_flat_tid_119639;
    bool defunc_0_reduce_res_119615 = *futhark_mc_task_128275->retval_defunc_0_reduce_res_119615;
    struct memblock mem_119614 = {.desc ="mem_119614", .mem =futhark_mc_task_128275->retval_mem_119614, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_124343_cached_sizze_128284 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124343 = NULL;
    int32_t nsubtasks_124342;
    
    nsubtasks_124342 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124343_cached_sizze_128284 < nsubtasks_124342) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124343, &reduce_stage_1_tid_res_arr_mem_124343_cached_sizze_128284, nsubtasks_124342);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128285 futhark_mc_segred_stage_1_parloop_struct_128285_;
    
    futhark_mc_segred_stage_1_parloop_struct_128285_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128285_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128285_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segred_stage_1_parloop_struct_128285_.free_zs_res_44842 = zs_res_44842;
    futhark_mc_segred_stage_1_parloop_struct_128285_.free_zs_res_44844 = zs_res_44844;
    futhark_mc_segred_stage_1_parloop_struct_128285_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_128285_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_128285_.free_mem_param_119548 = mem_param_119548.mem;
    futhark_mc_segred_stage_1_parloop_struct_128285_.free_mem_param_119551 = mem_param_119551.mem;
    futhark_mc_segred_stage_1_parloop_struct_128285_.free_ctx_param_ext_119556 = ctx_param_ext_119556;
    futhark_mc_segred_stage_1_parloop_struct_128285_.free_ctx_param_ext_119557 = ctx_param_ext_119557;
    futhark_mc_segred_stage_1_parloop_struct_128285_.free_ctx_param_ext_119558 = ctx_param_ext_119558;
    futhark_mc_segred_stage_1_parloop_struct_128285_.free_mem_119569 = mem_119569.mem;
    futhark_mc_segred_stage_1_parloop_struct_128285_.free_mem_119614 = mem_119614.mem;
    futhark_mc_segred_stage_1_parloop_struct_128285_.free_reduce_stage_1_tid_res_arr_mem_124343 = reduce_stage_1_tid_res_arr_mem_124343;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128286_task;
    
    futhark_mc_segred_stage_1_parloop_128286_task.name = "futhark_mc_segred_stage_1_parloop_128286";
    futhark_mc_segred_stage_1_parloop_128286_task.fn = futhark_mc_segred_stage_1_parloop_128286;
    futhark_mc_segred_stage_1_parloop_128286_task.args = &futhark_mc_segred_stage_1_parloop_struct_128285_;
    futhark_mc_segred_stage_1_parloop_128286_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128286_task.info = info;
    
    struct mc_event *event_128296 = mc_event_new(ctx);
    
    if (event_128296 != NULL)
        event_128296->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128286_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128286_task);
    
    if (futhark_mc_segred_stage_1_parloop_128286_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128286_err;
        goto cleanup;
    }
    if (event_128296 != NULL) {
        event_128296->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128286_total", strdup("nothing further"), event_128296, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_119615 = 0;
    }
    
    bool eta_p_124372;
    bool eta_p_124373;
    
    for (int32_t i_124375 = 0; i_124375 < nsubtasks_124342; i_124375++) {
        flat_tid_119617 = i_124375;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124372 = defunc_0_reduce_res_119615;
            }
            // load next params
            {
                eta_p_124373 = ((bool *) reduce_stage_1_tid_res_arr_mem_124343)[flat_tid_119617];
            }
            // red body
            {
                bool defunc_0_op_res_124374 = eta_p_124372 || eta_p_124373;
                
                defunc_0_reduce_res_119615 = defunc_0_op_res_124374;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124343);
    }
    if (event_128297 != NULL) {
        event_128297->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_128283", strdup("nothing further"), event_128297, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128275->retval_defunc_0_reduce_res_119615 = defunc_0_reduce_res_119615;
        futhark_mc_task_128275->retval_mem_119614 = mem_119614.mem;
    }
    return err;
}
struct futhark_mc_task_128298 {
    struct futhark_context *ctx;
    double free_zs_res_107134;
    unsigned char *free_mem_119614;
    int64_t free_flat_tid_119660;
    bool *retval_defunc_0_reduce_res_119659;
};
struct futhark_mc_segred_stage_1_parloop_struct_128301 {
    struct futhark_context *ctx;
    double free_zs_res_107134;
    unsigned char *free_mem_119614;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124377;
};
static int futhark_mc_segred_stage_1_parloop_128302(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128301 *futhark_mc_segred_stage_1_parloop_struct_128301 = (struct futhark_mc_segred_stage_1_parloop_struct_128301 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128301->ctx;
    struct mc_event *event_128303 = mc_event_new(ctx);
    
    if (event_128303 != NULL)
        event_128303->bef = get_wall_time();
    
    double zs_res_107134 = futhark_mc_segred_stage_1_parloop_struct_128301->free_zs_res_107134;
    struct memblock mem_119614 = {.desc ="mem_119614", .mem =futhark_mc_segred_stage_1_parloop_struct_128301->free_mem_119614, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_124377 = {.desc ="reduce_stage_1_tid_res_arr_mem_124377", .mem =futhark_mc_segred_stage_1_parloop_struct_128301->free_reduce_stage_1_tid_res_arr_mem_124377, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_119660;
    
    flat_tid_119660 = subtask_id;
    {
        bool eta_p_124379;
        bool eta_p_124380;
        bool local_acc_124382 = 0;
        bool eta_p_119662;
        bool eta_p_119663;
        bool local_acc_124383 = 0;
        int64_t start_124384;
        int64_t end_124385;
        
        start_124384 = start;
        end_124385 = end;
        
        int64_t n_124386 = end_124385 - start_124384;
        
        for (int64_t SegRed_i_124387 = start_124384; SegRed_i_124387 < start_124384 + n_124386; SegRed_i_124387++) {
            int64_t gtid_119661 = SegRed_i_124387;
            double eta_p_119665 = ((double *) mem_119614.mem)[gtid_119661];
            bool zlze_res_119666 = eta_p_119665 <= zs_res_107134;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_119662 = local_acc_124383;
            }
            // Load next params
            {
                eta_p_119663 = zlze_res_119666;
            }
            // SegRed body
            {
                bool defunc_0_op_res_119664 = eta_p_119662 || eta_p_119663;
                
                local_acc_124383 = defunc_0_op_res_119664;
            }
        }
        
        int64_t uni_i_124388 = 0;
        
        {
            int64_t gtid_119661 = uni_i_124388;
            
            // Load accum params
            {
                eta_p_124379 = local_acc_124382;
            }
            // Load next params
            {
                eta_p_124380 = local_acc_124383;
            }
            // SegRed body
            {
                bool defunc_0_op_res_124381 = eta_p_124379 || eta_p_124380;
                
                local_acc_124382 = defunc_0_op_res_124381;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_124377.mem)[flat_tid_119660] = local_acc_124382;
    }
    
  cleanup:
    { }
    if (event_128303 != NULL) {
        event_128303->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128302", strdup("nothing further"), event_128303, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128299(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128298 *futhark_mc_task_128298 = (struct futhark_mc_task_128298 *) args;
    struct futhark_context *ctx = futhark_mc_task_128298->ctx;
    struct mc_event *event_128305 = mc_event_new(ctx);
    
    if (event_128305 != NULL)
        event_128305->bef = get_wall_time();
    
    double zs_res_107134 = futhark_mc_task_128298->free_zs_res_107134;
    struct memblock mem_119614 = {.desc ="mem_119614", .mem =futhark_mc_task_128298->free_mem_119614, .size =0, .references =NULL};
    int64_t flat_tid_119660 = futhark_mc_task_128298->free_flat_tid_119660;
    bool defunc_0_reduce_res_119659 = *futhark_mc_task_128298->retval_defunc_0_reduce_res_119659;
    int64_t reduce_stage_1_tid_res_arr_mem_124377_cached_sizze_128300 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124377 = NULL;
    int32_t nsubtasks_124376;
    
    nsubtasks_124376 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124377_cached_sizze_128300 < nsubtasks_124376) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124377, &reduce_stage_1_tid_res_arr_mem_124377_cached_sizze_128300, nsubtasks_124376);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128301 futhark_mc_segred_stage_1_parloop_struct_128301_;
    
    futhark_mc_segred_stage_1_parloop_struct_128301_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128301_.free_zs_res_107134 = zs_res_107134;
    futhark_mc_segred_stage_1_parloop_struct_128301_.free_mem_119614 = mem_119614.mem;
    futhark_mc_segred_stage_1_parloop_struct_128301_.free_reduce_stage_1_tid_res_arr_mem_124377 = reduce_stage_1_tid_res_arr_mem_124377;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128302_task;
    
    futhark_mc_segred_stage_1_parloop_128302_task.name = "futhark_mc_segred_stage_1_parloop_128302";
    futhark_mc_segred_stage_1_parloop_128302_task.fn = futhark_mc_segred_stage_1_parloop_128302;
    futhark_mc_segred_stage_1_parloop_128302_task.args = &futhark_mc_segred_stage_1_parloop_struct_128301_;
    futhark_mc_segred_stage_1_parloop_128302_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128302_task.info = info;
    
    struct mc_event *event_128304 = mc_event_new(ctx);
    
    if (event_128304 != NULL)
        event_128304->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128302_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128302_task);
    
    if (futhark_mc_segred_stage_1_parloop_128302_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128302_err;
        goto cleanup;
    }
    if (event_128304 != NULL) {
        event_128304->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128302_total", strdup("nothing further"), event_128304, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_119659 = 0;
    }
    
    bool eta_p_124389;
    bool eta_p_124390;
    
    for (int32_t i_124392 = 0; i_124392 < nsubtasks_124376; i_124392++) {
        flat_tid_119660 = i_124392;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124389 = defunc_0_reduce_res_119659;
            }
            // load next params
            {
                eta_p_124390 = ((bool *) reduce_stage_1_tid_res_arr_mem_124377)[flat_tid_119660];
            }
            // red body
            {
                bool defunc_0_op_res_124391 = eta_p_124389 || eta_p_124390;
                
                defunc_0_reduce_res_119659 = defunc_0_op_res_124391;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124377);
    }
    if (event_128305 != NULL) {
        event_128305->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128299", strdup("nothing further"), event_128305, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128298->retval_defunc_0_reduce_res_119659 = defunc_0_reduce_res_119659;
    }
    return err;
}
struct futhark_mc_task_128306 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    unsigned char *free_mem_param_119548;
    unsigned char *free_mem_param_119551;
    int64_t free_ctx_param_ext_119556;
    int64_t free_ctx_param_ext_119557;
    int64_t free_ctx_param_ext_119558;
    unsigned char *free_mem_119614;
    unsigned char *free_mem_119673;
    unsigned char *free_mem_119674;
    unsigned char *free_mem_119675;
    double free_zs_res_119682;
    int64_t free_bytes_119683;
};
struct futhark_mc_segmap_parloop_struct_128308 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    unsigned char *free_mem_param_119548;
    unsigned char *free_mem_param_119551;
    int64_t free_ctx_param_ext_119556;
    int64_t free_ctx_param_ext_119557;
    int64_t free_ctx_param_ext_119558;
    unsigned char *free_mem_119614;
    unsigned char *free_mem_119673;
    unsigned char *free_mem_119674;
    unsigned char *free_mem_119675;
    double free_zs_res_119682;
    int64_t free_bytes_119683;
};
static int futhark_mc_segmap_parloop_128309(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_128308 *futhark_mc_segmap_parloop_struct_128308 = (struct futhark_mc_segmap_parloop_struct_128308 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_128308->ctx;
    struct mc_event *event_128310 = mc_event_new(ctx);
    
    if (event_128310 != NULL)
        event_128310->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_128308->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_segmap_parloop_struct_128308->free_exp_absorb_cutoff_33394;
    struct memblock mem_param_119548 = {.desc ="mem_param_119548", .mem =futhark_mc_segmap_parloop_struct_128308->free_mem_param_119548, .size =0, .references =NULL};
    struct memblock mem_param_119551 = {.desc ="mem_param_119551", .mem =futhark_mc_segmap_parloop_struct_128308->free_mem_param_119551, .size =0, .references =NULL};
    int64_t ctx_param_ext_119556 = futhark_mc_segmap_parloop_struct_128308->free_ctx_param_ext_119556;
    int64_t ctx_param_ext_119557 = futhark_mc_segmap_parloop_struct_128308->free_ctx_param_ext_119557;
    int64_t ctx_param_ext_119558 = futhark_mc_segmap_parloop_struct_128308->free_ctx_param_ext_119558;
    struct memblock mem_119614 = {.desc ="mem_119614", .mem =futhark_mc_segmap_parloop_struct_128308->free_mem_119614, .size =0, .references =NULL};
    struct memblock mem_119673 = {.desc ="mem_119673", .mem =futhark_mc_segmap_parloop_struct_128308->free_mem_119673, .size =0, .references =NULL};
    struct memblock mem_119674 = {.desc ="mem_119674", .mem =futhark_mc_segmap_parloop_struct_128308->free_mem_119674, .size =0, .references =NULL};
    struct memblock mem_119675 = {.desc ="mem_119675", .mem =futhark_mc_segmap_parloop_struct_128308->free_mem_119675, .size =0, .references =NULL};
    double zs_res_119682 = futhark_mc_segmap_parloop_struct_128308->free_zs_res_119682;
    int64_t bytes_119683 = futhark_mc_segmap_parloop_struct_128308->free_bytes_119683;
    int64_t iterations = end - start;
    struct memblock ext_mem_119702;
    
    ext_mem_119702.references = NULL;
    
    struct memblock mem_119701;
    
    mem_119701.references = NULL;
    
    int64_t flat_tid_119687;
    
    flat_tid_119687 = subtask_id;
    {
        int64_t start_124405;
        int64_t end_124406;
        
        start_124405 = start;
        end_124406 = end;
        
        int64_t n_124407 = end_124406 - start_124405;
        
        if (memblock_alloc(ctx, &mem_119701, bytes_119683, "mem_119701")) {
            err = 1;
            goto cleanup;
        }
        for (int64_t SegMap_i_124408 = start_124405; SegMap_i_124408 < start_124405 + n_124407; SegMap_i_124408++) {
            int64_t slice_124409 = m_33388;
            int64_t gtid_119688 = SegMap_i_124408;
            int64_t remnant_124410 = SegMap_i_124408 - gtid_119688;
            double eta_p_119689 = ((double *) mem_119614.mem)[gtid_119688];
            double eta_p_119690 = ((double *) mem_param_119551.mem)[gtid_119688];
            bool zgze_res_119692 = exp_absorb_cutoff_33394 <= eta_p_119689;
            bool zl_res_119693 = eta_p_119689 < zs_res_119682;
            bool x_119694 = !zgze_res_119692;
            bool y_119695 = zl_res_119693 && x_119694;
            bool cond_119696 = zgze_res_119692 || y_119695;
            int64_t binop_y_119697 = gtid_119688 * ctx_param_ext_119557;
            int64_t lmad_ext_119698 = ctx_param_ext_119556 + binop_y_119697;
            int64_t ext_119699;
            
            if (cond_119696) {
                ext_119699 = (int64_t) 0;
            } else {
                ext_119699 = lmad_ext_119698;
            }
            
            int64_t ext_119700;
            
            if (cond_119696) {
                ext_119700 = (int64_t) 1;
            } else {
                ext_119700 = ctx_param_ext_119558;
            }
            
            double rescale_res_119703;
            double rescale_res_119704;
            
            if (cond_119696) {
                double log_res_124394 = futrts_log64(eta_p_119689);
                double sqrt_res_124395 = futrts_sqrt64(eta_p_119689);
                double zs_res_124396 = log_res_124394 / 2.0;
                double zp_res_124397 = eta_p_119690 + zs_res_124396;
                
                for (int64_t i_124400 = 0; i_124400 < m_33388; i_124400++) {
                    double eta_p_124402 = ((double *) mem_param_119548.mem)[ctx_param_ext_119556 + (gtid_119688 * ctx_param_ext_119557 + i_124400 * ctx_param_ext_119558)];
                    double zt_res_124403 = sqrt_res_124395 * eta_p_124402;
                    
                    ((double *) mem_119701.mem)[i_124400] = zt_res_124403;
                }
                if (memblock_set(ctx, &ext_mem_119702, &mem_119701, "mem_119701") != 0)
                    return 1;
                rescale_res_119703 = sqrt_res_124395;
                rescale_res_119704 = zp_res_124397;
            } else {
                if (memblock_set(ctx, &ext_mem_119702, &mem_param_119548, "mem_param_119548") != 0)
                    return 1;
                rescale_res_119703 = eta_p_119689;
                rescale_res_119704 = eta_p_119690;
            }
            ((double *) mem_119673.mem)[gtid_119688] = rescale_res_119703;
            ((double *) mem_119674.mem)[gtid_119688] = rescale_res_119704;
            lmad_copy_8b(ctx, 1, (uint64_t *) mem_119675.mem, gtid_119688 * m_33388, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_119702.mem, ext_119699, (int64_t []) {ext_119700}, (int64_t []) {m_33388});
        }
    }
    
  cleanup:
    {
        if (memblock_unref(ctx, &ext_mem_119702, "ext_mem_119702") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_119701, "mem_119701") != 0)
            return 1;
    }
    if (event_128310 != NULL) {
        event_128310->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128309", strdup("nothing further"), event_128310, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_task_128307(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128306 *futhark_mc_task_128306 = (struct futhark_mc_task_128306 *) args;
    struct futhark_context *ctx = futhark_mc_task_128306->ctx;
    struct mc_event *event_128312 = mc_event_new(ctx);
    
    if (event_128312 != NULL)
        event_128312->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128306->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_task_128306->free_exp_absorb_cutoff_33394;
    struct memblock mem_param_119548 = {.desc ="mem_param_119548", .mem =futhark_mc_task_128306->free_mem_param_119548, .size =0, .references =NULL};
    struct memblock mem_param_119551 = {.desc ="mem_param_119551", .mem =futhark_mc_task_128306->free_mem_param_119551, .size =0, .references =NULL};
    int64_t ctx_param_ext_119556 = futhark_mc_task_128306->free_ctx_param_ext_119556;
    int64_t ctx_param_ext_119557 = futhark_mc_task_128306->free_ctx_param_ext_119557;
    int64_t ctx_param_ext_119558 = futhark_mc_task_128306->free_ctx_param_ext_119558;
    struct memblock mem_119614 = {.desc ="mem_119614", .mem =futhark_mc_task_128306->free_mem_119614, .size =0, .references =NULL};
    struct memblock mem_119673 = {.desc ="mem_119673", .mem =futhark_mc_task_128306->free_mem_119673, .size =0, .references =NULL};
    struct memblock mem_119674 = {.desc ="mem_119674", .mem =futhark_mc_task_128306->free_mem_119674, .size =0, .references =NULL};
    struct memblock mem_119675 = {.desc ="mem_119675", .mem =futhark_mc_task_128306->free_mem_119675, .size =0, .references =NULL};
    double zs_res_119682 = futhark_mc_task_128306->free_zs_res_119682;
    int64_t bytes_119683 = futhark_mc_task_128306->free_bytes_119683;
    int32_t nsubtasks_124393;
    
    nsubtasks_124393 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_128308 futhark_mc_segmap_parloop_struct_128308_;
    
    futhark_mc_segmap_parloop_struct_128308_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_128308_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_128308_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segmap_parloop_struct_128308_.free_mem_param_119548 = mem_param_119548.mem;
    futhark_mc_segmap_parloop_struct_128308_.free_mem_param_119551 = mem_param_119551.mem;
    futhark_mc_segmap_parloop_struct_128308_.free_ctx_param_ext_119556 = ctx_param_ext_119556;
    futhark_mc_segmap_parloop_struct_128308_.free_ctx_param_ext_119557 = ctx_param_ext_119557;
    futhark_mc_segmap_parloop_struct_128308_.free_ctx_param_ext_119558 = ctx_param_ext_119558;
    futhark_mc_segmap_parloop_struct_128308_.free_mem_119614 = mem_119614.mem;
    futhark_mc_segmap_parloop_struct_128308_.free_mem_119673 = mem_119673.mem;
    futhark_mc_segmap_parloop_struct_128308_.free_mem_119674 = mem_119674.mem;
    futhark_mc_segmap_parloop_struct_128308_.free_mem_119675 = mem_119675.mem;
    futhark_mc_segmap_parloop_struct_128308_.free_zs_res_119682 = zs_res_119682;
    futhark_mc_segmap_parloop_struct_128308_.free_bytes_119683 = bytes_119683;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_128309_task;
    
    futhark_mc_segmap_parloop_128309_task.name = "futhark_mc_segmap_parloop_128309";
    futhark_mc_segmap_parloop_128309_task.fn = futhark_mc_segmap_parloop_128309;
    futhark_mc_segmap_parloop_128309_task.args = &futhark_mc_segmap_parloop_struct_128308_;
    futhark_mc_segmap_parloop_128309_task.iterations = iterations;
    futhark_mc_segmap_parloop_128309_task.info = info;
    
    struct mc_event *event_128311 = mc_event_new(ctx);
    
    if (event_128311 != NULL)
        event_128311->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_128309_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_128309_task);
    
    if (futhark_mc_segmap_parloop_128309_err != 0) {
        err = futhark_mc_segmap_parloop_128309_err;
        goto cleanup;
    }
    if (event_128311 != NULL) {
        event_128311->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128309_total", strdup("nothing further"), event_128311, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_128312 != NULL) {
        event_128312->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_task_128307", strdup("nothing further"), event_128312, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_128313 {
    struct futhark_context *ctx;
    double free_zs_res_107134;
    unsigned char *free_mem_119569;
    int64_t free_flat_tid_119718;
    bool *retval_defunc_0_reduce_res_119717;
};
struct futhark_mc_segred_stage_1_parloop_struct_128316 {
    struct futhark_context *ctx;
    double free_zs_res_107134;
    unsigned char *free_mem_119569;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124413;
};
static int futhark_mc_segred_stage_1_parloop_128317(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128316 *futhark_mc_segred_stage_1_parloop_struct_128316 = (struct futhark_mc_segred_stage_1_parloop_struct_128316 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128316->ctx;
    struct mc_event *event_128318 = mc_event_new(ctx);
    
    if (event_128318 != NULL)
        event_128318->bef = get_wall_time();
    
    double zs_res_107134 = futhark_mc_segred_stage_1_parloop_struct_128316->free_zs_res_107134;
    struct memblock mem_119569 = {.desc ="mem_119569", .mem =futhark_mc_segred_stage_1_parloop_struct_128316->free_mem_119569, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_124413 = {.desc ="reduce_stage_1_tid_res_arr_mem_124413", .mem =futhark_mc_segred_stage_1_parloop_struct_128316->free_reduce_stage_1_tid_res_arr_mem_124413, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_119718;
    
    flat_tid_119718 = subtask_id;
    {
        bool eta_p_124415;
        bool eta_p_124416;
        bool local_acc_124418 = 0;
        bool eta_p_119720;
        bool eta_p_119721;
        bool local_acc_124419 = 0;
        int64_t start_124420;
        int64_t end_124421;
        
        start_124420 = start;
        end_124421 = end;
        
        int64_t n_124422 = end_124421 - start_124420;
        
        for (int64_t SegRed_i_124423 = start_124420; SegRed_i_124423 < start_124420 + n_124422; SegRed_i_124423++) {
            int64_t gtid_119719 = SegRed_i_124423;
            double eta_p_119723 = ((double *) mem_119569.mem)[gtid_119719];
            bool zlze_res_119724 = eta_p_119723 <= zs_res_107134;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_119720 = local_acc_124419;
            }
            // Load next params
            {
                eta_p_119721 = zlze_res_119724;
            }
            // SegRed body
            {
                bool defunc_0_op_res_119722 = eta_p_119720 || eta_p_119721;
                
                local_acc_124419 = defunc_0_op_res_119722;
            }
        }
        
        int64_t uni_i_124424 = 0;
        
        {
            int64_t gtid_119719 = uni_i_124424;
            
            // Load accum params
            {
                eta_p_124415 = local_acc_124418;
            }
            // Load next params
            {
                eta_p_124416 = local_acc_124419;
            }
            // SegRed body
            {
                bool defunc_0_op_res_124417 = eta_p_124415 || eta_p_124416;
                
                local_acc_124418 = defunc_0_op_res_124417;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_124413.mem)[flat_tid_119718] = local_acc_124418;
    }
    
  cleanup:
    { }
    if (event_128318 != NULL) {
        event_128318->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128317", strdup("nothing further"), event_128318, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128314(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128313 *futhark_mc_task_128313 = (struct futhark_mc_task_128313 *) args;
    struct futhark_context *ctx = futhark_mc_task_128313->ctx;
    struct mc_event *event_128320 = mc_event_new(ctx);
    
    if (event_128320 != NULL)
        event_128320->bef = get_wall_time();
    
    double zs_res_107134 = futhark_mc_task_128313->free_zs_res_107134;
    struct memblock mem_119569 = {.desc ="mem_119569", .mem =futhark_mc_task_128313->free_mem_119569, .size =0, .references =NULL};
    int64_t flat_tid_119718 = futhark_mc_task_128313->free_flat_tid_119718;
    bool defunc_0_reduce_res_119717 = *futhark_mc_task_128313->retval_defunc_0_reduce_res_119717;
    int64_t reduce_stage_1_tid_res_arr_mem_124413_cached_sizze_128315 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124413 = NULL;
    int32_t nsubtasks_124412;
    
    nsubtasks_124412 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124413_cached_sizze_128315 < nsubtasks_124412) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124413, &reduce_stage_1_tid_res_arr_mem_124413_cached_sizze_128315, nsubtasks_124412);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128316 futhark_mc_segred_stage_1_parloop_struct_128316_;
    
    futhark_mc_segred_stage_1_parloop_struct_128316_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128316_.free_zs_res_107134 = zs_res_107134;
    futhark_mc_segred_stage_1_parloop_struct_128316_.free_mem_119569 = mem_119569.mem;
    futhark_mc_segred_stage_1_parloop_struct_128316_.free_reduce_stage_1_tid_res_arr_mem_124413 = reduce_stage_1_tid_res_arr_mem_124413;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128317_task;
    
    futhark_mc_segred_stage_1_parloop_128317_task.name = "futhark_mc_segred_stage_1_parloop_128317";
    futhark_mc_segred_stage_1_parloop_128317_task.fn = futhark_mc_segred_stage_1_parloop_128317;
    futhark_mc_segred_stage_1_parloop_128317_task.args = &futhark_mc_segred_stage_1_parloop_struct_128316_;
    futhark_mc_segred_stage_1_parloop_128317_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128317_task.info = info;
    
    struct mc_event *event_128319 = mc_event_new(ctx);
    
    if (event_128319 != NULL)
        event_128319->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128317_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128317_task);
    
    if (futhark_mc_segred_stage_1_parloop_128317_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128317_err;
        goto cleanup;
    }
    if (event_128319 != NULL) {
        event_128319->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128317_total", strdup("nothing further"), event_128319, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_119717 = 0;
    }
    
    bool eta_p_124425;
    bool eta_p_124426;
    
    for (int32_t i_124428 = 0; i_124428 < nsubtasks_124412; i_124428++) {
        flat_tid_119718 = i_124428;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124425 = defunc_0_reduce_res_119717;
            }
            // load next params
            {
                eta_p_124426 = ((bool *) reduce_stage_1_tid_res_arr_mem_124413)[flat_tid_119718];
            }
            // red body
            {
                bool defunc_0_op_res_124427 = eta_p_124425 || eta_p_124426;
                
                defunc_0_reduce_res_119717 = defunc_0_op_res_124427;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124413);
    }
    if (event_128320 != NULL) {
        event_128320->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128314", strdup("nothing further"), event_128320, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128313->retval_defunc_0_reduce_res_119717 = defunc_0_reduce_res_119717;
    }
    return err;
}
struct futhark_mc_task_128321 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    unsigned char *free_mem_param_119552;
    unsigned char *free_mem_119569;
    int64_t free_ext_119670;
    int64_t free_ext_119671;
    int64_t free_ext_119672;
    unsigned char *free_ext_mem_119678;
    unsigned char *free_mem_119732;
    unsigned char *free_mem_119733;
    unsigned char *free_mem_119734;
    double free_zs_res_119741;
    int64_t free_bytes_119742;
};
struct futhark_mc_segmap_parloop_struct_128323 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    unsigned char *free_mem_param_119552;
    unsigned char *free_mem_119569;
    int64_t free_ext_119670;
    int64_t free_ext_119671;
    int64_t free_ext_119672;
    unsigned char *free_ext_mem_119678;
    unsigned char *free_mem_119732;
    unsigned char *free_mem_119733;
    unsigned char *free_mem_119734;
    double free_zs_res_119741;
    int64_t free_bytes_119742;
};
static int futhark_mc_segmap_parloop_128324(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_128323 *futhark_mc_segmap_parloop_struct_128323 = (struct futhark_mc_segmap_parloop_struct_128323 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_128323->ctx;
    struct mc_event *event_128325 = mc_event_new(ctx);
    
    if (event_128325 != NULL)
        event_128325->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_128323->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_segmap_parloop_struct_128323->free_exp_absorb_cutoff_33394;
    struct memblock mem_param_119552 = {.desc ="mem_param_119552", .mem =futhark_mc_segmap_parloop_struct_128323->free_mem_param_119552, .size =0, .references =NULL};
    struct memblock mem_119569 = {.desc ="mem_119569", .mem =futhark_mc_segmap_parloop_struct_128323->free_mem_119569, .size =0, .references =NULL};
    int64_t ext_119670 = futhark_mc_segmap_parloop_struct_128323->free_ext_119670;
    int64_t ext_119671 = futhark_mc_segmap_parloop_struct_128323->free_ext_119671;
    int64_t ext_119672 = futhark_mc_segmap_parloop_struct_128323->free_ext_119672;
    struct memblock ext_mem_119678 = {.desc ="ext_mem_119678", .mem =futhark_mc_segmap_parloop_struct_128323->free_ext_mem_119678, .size =0, .references =NULL};
    struct memblock mem_119732 = {.desc ="mem_119732", .mem =futhark_mc_segmap_parloop_struct_128323->free_mem_119732, .size =0, .references =NULL};
    struct memblock mem_119733 = {.desc ="mem_119733", .mem =futhark_mc_segmap_parloop_struct_128323->free_mem_119733, .size =0, .references =NULL};
    struct memblock mem_119734 = {.desc ="mem_119734", .mem =futhark_mc_segmap_parloop_struct_128323->free_mem_119734, .size =0, .references =NULL};
    double zs_res_119741 = futhark_mc_segmap_parloop_struct_128323->free_zs_res_119741;
    int64_t bytes_119742 = futhark_mc_segmap_parloop_struct_128323->free_bytes_119742;
    int64_t iterations = end - start;
    struct memblock ext_mem_119761;
    
    ext_mem_119761.references = NULL;
    
    struct memblock mem_119760;
    
    mem_119760.references = NULL;
    
    int64_t flat_tid_119746;
    
    flat_tid_119746 = subtask_id;
    {
        int64_t start_124441;
        int64_t end_124442;
        
        start_124441 = start;
        end_124442 = end;
        
        int64_t n_124443 = end_124442 - start_124441;
        
        if (memblock_alloc(ctx, &mem_119760, bytes_119742, "mem_119760")) {
            err = 1;
            goto cleanup;
        }
        for (int64_t SegMap_i_124444 = start_124441; SegMap_i_124444 < start_124441 + n_124443; SegMap_i_124444++) {
            int64_t slice_124445 = m_33388;
            int64_t gtid_119747 = SegMap_i_124444;
            int64_t remnant_124446 = SegMap_i_124444 - gtid_119747;
            double eta_p_119748 = ((double *) mem_119569.mem)[gtid_119747];
            double eta_p_119749 = ((double *) mem_param_119552.mem)[gtid_119747];
            bool zgze_res_119751 = exp_absorb_cutoff_33394 <= eta_p_119748;
            bool zl_res_119752 = eta_p_119748 < zs_res_119741;
            bool x_119753 = !zgze_res_119751;
            bool y_119754 = zl_res_119752 && x_119753;
            bool cond_119755 = zgze_res_119751 || y_119754;
            int64_t binop_y_119756 = gtid_119747 * ext_119672;
            int64_t lmad_ext_119757 = ext_119670 + binop_y_119756;
            int64_t ext_119758;
            
            if (cond_119755) {
                ext_119758 = (int64_t) 0;
            } else {
                ext_119758 = lmad_ext_119757;
            }
            
            int64_t ext_119759;
            
            if (cond_119755) {
                ext_119759 = (int64_t) 1;
            } else {
                ext_119759 = ext_119671;
            }
            
            double rescale_res_119762;
            double rescale_res_119763;
            
            if (cond_119755) {
                double log_res_124430 = futrts_log64(eta_p_119748);
                double sqrt_res_124431 = futrts_sqrt64(eta_p_119748);
                double zs_res_124432 = log_res_124430 / 2.0;
                double zp_res_124433 = eta_p_119749 + zs_res_124432;
                
                for (int64_t i_124436 = 0; i_124436 < m_33388; i_124436++) {
                    double eta_p_124438 = ((double *) ext_mem_119678.mem)[ext_119670 + (i_124436 * ext_119671 + gtid_119747 * ext_119672)];
                    double zt_res_124439 = sqrt_res_124431 * eta_p_124438;
                    
                    ((double *) mem_119760.mem)[i_124436] = zt_res_124439;
                }
                if (memblock_set(ctx, &ext_mem_119761, &mem_119760, "mem_119760") != 0)
                    return 1;
                rescale_res_119762 = sqrt_res_124431;
                rescale_res_119763 = zp_res_124433;
            } else {
                if (memblock_set(ctx, &ext_mem_119761, &ext_mem_119678, "ext_mem_119678") != 0)
                    return 1;
                rescale_res_119762 = eta_p_119748;
                rescale_res_119763 = eta_p_119749;
            }
            ((double *) mem_119732.mem)[gtid_119747] = rescale_res_119762;
            ((double *) mem_119733.mem)[gtid_119747] = rescale_res_119763;
            lmad_copy_8b(ctx, 1, (uint64_t *) mem_119734.mem, gtid_119747 * m_33388, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_119761.mem, ext_119758, (int64_t []) {ext_119759}, (int64_t []) {m_33388});
        }
    }
    
  cleanup:
    {
        if (memblock_unref(ctx, &ext_mem_119761, "ext_mem_119761") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_119760, "mem_119760") != 0)
            return 1;
    }
    if (event_128325 != NULL) {
        event_128325->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128324", strdup("nothing further"), event_128325, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_task_128322(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128321 *futhark_mc_task_128321 = (struct futhark_mc_task_128321 *) args;
    struct futhark_context *ctx = futhark_mc_task_128321->ctx;
    struct mc_event *event_128327 = mc_event_new(ctx);
    
    if (event_128327 != NULL)
        event_128327->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128321->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_task_128321->free_exp_absorb_cutoff_33394;
    struct memblock mem_param_119552 = {.desc ="mem_param_119552", .mem =futhark_mc_task_128321->free_mem_param_119552, .size =0, .references =NULL};
    struct memblock mem_119569 = {.desc ="mem_119569", .mem =futhark_mc_task_128321->free_mem_119569, .size =0, .references =NULL};
    int64_t ext_119670 = futhark_mc_task_128321->free_ext_119670;
    int64_t ext_119671 = futhark_mc_task_128321->free_ext_119671;
    int64_t ext_119672 = futhark_mc_task_128321->free_ext_119672;
    struct memblock ext_mem_119678 = {.desc ="ext_mem_119678", .mem =futhark_mc_task_128321->free_ext_mem_119678, .size =0, .references =NULL};
    struct memblock mem_119732 = {.desc ="mem_119732", .mem =futhark_mc_task_128321->free_mem_119732, .size =0, .references =NULL};
    struct memblock mem_119733 = {.desc ="mem_119733", .mem =futhark_mc_task_128321->free_mem_119733, .size =0, .references =NULL};
    struct memblock mem_119734 = {.desc ="mem_119734", .mem =futhark_mc_task_128321->free_mem_119734, .size =0, .references =NULL};
    double zs_res_119741 = futhark_mc_task_128321->free_zs_res_119741;
    int64_t bytes_119742 = futhark_mc_task_128321->free_bytes_119742;
    int32_t nsubtasks_124429;
    
    nsubtasks_124429 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_128323 futhark_mc_segmap_parloop_struct_128323_;
    
    futhark_mc_segmap_parloop_struct_128323_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_128323_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_128323_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segmap_parloop_struct_128323_.free_mem_param_119552 = mem_param_119552.mem;
    futhark_mc_segmap_parloop_struct_128323_.free_mem_119569 = mem_119569.mem;
    futhark_mc_segmap_parloop_struct_128323_.free_ext_119670 = ext_119670;
    futhark_mc_segmap_parloop_struct_128323_.free_ext_119671 = ext_119671;
    futhark_mc_segmap_parloop_struct_128323_.free_ext_119672 = ext_119672;
    futhark_mc_segmap_parloop_struct_128323_.free_ext_mem_119678 = ext_mem_119678.mem;
    futhark_mc_segmap_parloop_struct_128323_.free_mem_119732 = mem_119732.mem;
    futhark_mc_segmap_parloop_struct_128323_.free_mem_119733 = mem_119733.mem;
    futhark_mc_segmap_parloop_struct_128323_.free_mem_119734 = mem_119734.mem;
    futhark_mc_segmap_parloop_struct_128323_.free_zs_res_119741 = zs_res_119741;
    futhark_mc_segmap_parloop_struct_128323_.free_bytes_119742 = bytes_119742;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_128324_task;
    
    futhark_mc_segmap_parloop_128324_task.name = "futhark_mc_segmap_parloop_128324";
    futhark_mc_segmap_parloop_128324_task.fn = futhark_mc_segmap_parloop_128324;
    futhark_mc_segmap_parloop_128324_task.args = &futhark_mc_segmap_parloop_struct_128323_;
    futhark_mc_segmap_parloop_128324_task.iterations = iterations;
    futhark_mc_segmap_parloop_128324_task.info = info;
    
    struct mc_event *event_128326 = mc_event_new(ctx);
    
    if (event_128326 != NULL)
        event_128326->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_128324_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_128324_task);
    
    if (futhark_mc_segmap_parloop_128324_err != 0) {
        err = futhark_mc_segmap_parloop_128324_err;
        goto cleanup;
    }
    if (event_128326 != NULL) {
        event_128326->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128324_total", strdup("nothing further"), event_128326, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_128327 != NULL) {
        event_128327->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_task_128322", strdup("nothing further"), event_128327, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_128328 {
    struct futhark_context *ctx;
    unsigned char *free_ext_mem_119676;
    int64_t free_flat_tid_119778;
    bool *retval_defunc_0_reduce_res_119777;
};
struct futhark_mc_segred_stage_1_parloop_struct_128331 {
    struct futhark_context *ctx;
    unsigned char *free_ext_mem_119676;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124449;
};
static int futhark_mc_segred_stage_1_parloop_128332(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128331 *futhark_mc_segred_stage_1_parloop_struct_128331 = (struct futhark_mc_segred_stage_1_parloop_struct_128331 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128331->ctx;
    struct mc_event *event_128333 = mc_event_new(ctx);
    
    if (event_128333 != NULL)
        event_128333->bef = get_wall_time();
    
    struct memblock ext_mem_119676 = {.desc ="ext_mem_119676", .mem =futhark_mc_segred_stage_1_parloop_struct_128331->free_ext_mem_119676, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_124449 = {.desc ="reduce_stage_1_tid_res_arr_mem_124449", .mem =futhark_mc_segred_stage_1_parloop_struct_128331->free_reduce_stage_1_tid_res_arr_mem_124449, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_119778;
    
    flat_tid_119778 = subtask_id;
    {
        bool eta_p_124451;
        bool eta_p_124452;
        bool local_acc_124454 = 1;
        bool eta_p_119780;
        bool eta_p_119781;
        bool local_acc_124455 = 1;
        int64_t start_124456;
        int64_t end_124457;
        
        start_124456 = start;
        end_124457 = end;
        
        int64_t n_124458 = end_124457 - start_124456;
        
        for (int64_t SegRed_i_124459 = start_124456; SegRed_i_124459 < start_124456 + n_124458; SegRed_i_124459++) {
            int64_t gtid_119779 = SegRed_i_124459;
            double eta_p_119783 = ((double *) ext_mem_119676.mem)[gtid_119779];
            bool isnan_res_119784 = futrts_isnan64(eta_p_119783);
            bool not_res_119785 = !isnan_res_119784;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_119780 = local_acc_124455;
            }
            // Load next params
            {
                eta_p_119781 = not_res_119785;
            }
            // SegRed body
            {
                bool x_119782 = eta_p_119780 && eta_p_119781;
                
                local_acc_124455 = x_119782;
            }
        }
        
        int64_t uni_i_124460 = 0;
        
        {
            int64_t gtid_119779 = uni_i_124460;
            
            // Load accum params
            {
                eta_p_124451 = local_acc_124454;
            }
            // Load next params
            {
                eta_p_124452 = local_acc_124455;
            }
            // SegRed body
            {
                bool x_124453 = eta_p_124451 && eta_p_124452;
                
                local_acc_124454 = x_124453;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_124449.mem)[flat_tid_119778] = local_acc_124454;
    }
    
  cleanup:
    { }
    if (event_128333 != NULL) {
        event_128333->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128332", strdup("nothing further"), event_128333, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128329(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128328 *futhark_mc_task_128328 = (struct futhark_mc_task_128328 *) args;
    struct futhark_context *ctx = futhark_mc_task_128328->ctx;
    struct mc_event *event_128335 = mc_event_new(ctx);
    
    if (event_128335 != NULL)
        event_128335->bef = get_wall_time();
    
    struct memblock ext_mem_119676 = {.desc ="ext_mem_119676", .mem =futhark_mc_task_128328->free_ext_mem_119676, .size =0, .references =NULL};
    int64_t flat_tid_119778 = futhark_mc_task_128328->free_flat_tid_119778;
    bool defunc_0_reduce_res_119777 = *futhark_mc_task_128328->retval_defunc_0_reduce_res_119777;
    int64_t reduce_stage_1_tid_res_arr_mem_124449_cached_sizze_128330 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124449 = NULL;
    int32_t nsubtasks_124448;
    
    nsubtasks_124448 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124449_cached_sizze_128330 < nsubtasks_124448) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124449, &reduce_stage_1_tid_res_arr_mem_124449_cached_sizze_128330, nsubtasks_124448);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128331 futhark_mc_segred_stage_1_parloop_struct_128331_;
    
    futhark_mc_segred_stage_1_parloop_struct_128331_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128331_.free_ext_mem_119676 = ext_mem_119676.mem;
    futhark_mc_segred_stage_1_parloop_struct_128331_.free_reduce_stage_1_tid_res_arr_mem_124449 = reduce_stage_1_tid_res_arr_mem_124449;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128332_task;
    
    futhark_mc_segred_stage_1_parloop_128332_task.name = "futhark_mc_segred_stage_1_parloop_128332";
    futhark_mc_segred_stage_1_parloop_128332_task.fn = futhark_mc_segred_stage_1_parloop_128332;
    futhark_mc_segred_stage_1_parloop_128332_task.args = &futhark_mc_segred_stage_1_parloop_struct_128331_;
    futhark_mc_segred_stage_1_parloop_128332_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128332_task.info = info;
    
    struct mc_event *event_128334 = mc_event_new(ctx);
    
    if (event_128334 != NULL)
        event_128334->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128332_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128332_task);
    
    if (futhark_mc_segred_stage_1_parloop_128332_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128332_err;
        goto cleanup;
    }
    if (event_128334 != NULL) {
        event_128334->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128332_total", strdup("nothing further"), event_128334, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_119777 = 1;
    }
    
    bool eta_p_124461;
    bool eta_p_124462;
    
    for (int32_t i_124464 = 0; i_124464 < nsubtasks_124448; i_124464++) {
        flat_tid_119778 = i_124464;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124461 = defunc_0_reduce_res_119777;
            }
            // load next params
            {
                eta_p_124462 = ((bool *) reduce_stage_1_tid_res_arr_mem_124449)[flat_tid_119778];
            }
            // red body
            {
                bool x_124463 = eta_p_124461 && eta_p_124462;
                
                defunc_0_reduce_res_119777 = x_124463;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124449);
    }
    if (event_128335 != NULL) {
        event_128335->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128329", strdup("nothing further"), event_128335, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128328->retval_defunc_0_reduce_res_119777 = defunc_0_reduce_res_119777;
    }
    return err;
}
struct futhark_mc_task_128336 {
    struct futhark_context *ctx;
    double free_zp_res_108112;
    unsigned char *free_mem_param_119549;
    unsigned char *free_ext_mem_119676;
    int64_t free_flat_tid_119787;
    bool *retval_defunc_0_reduce_comm_res_119786;
};
struct futhark_mc_segred_stage_1_parloop_struct_128339 {
    struct futhark_context *ctx;
    double free_zp_res_108112;
    unsigned char *free_mem_param_119549;
    unsigned char *free_ext_mem_119676;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124466;
};
static int futhark_mc_segred_stage_1_parloop_128340(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128339 *futhark_mc_segred_stage_1_parloop_struct_128339 = (struct futhark_mc_segred_stage_1_parloop_struct_128339 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128339->ctx;
    struct mc_event *event_128341 = mc_event_new(ctx);
    
    if (event_128341 != NULL)
        event_128341->bef = get_wall_time();
    
    double zp_res_108112 = futhark_mc_segred_stage_1_parloop_struct_128339->free_zp_res_108112;
    struct memblock mem_param_119549 = {.desc ="mem_param_119549", .mem =futhark_mc_segred_stage_1_parloop_struct_128339->free_mem_param_119549, .size =0, .references =NULL};
    struct memblock ext_mem_119676 = {.desc ="ext_mem_119676", .mem =futhark_mc_segred_stage_1_parloop_struct_128339->free_ext_mem_119676, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_124466 = {.desc ="reduce_stage_1_tid_res_arr_mem_124466", .mem =futhark_mc_segred_stage_1_parloop_struct_128339->free_reduce_stage_1_tid_res_arr_mem_124466, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_119787;
    
    flat_tid_119787 = subtask_id;
    {
        bool eta_p_124468;
        bool eta_p_124469;
        bool local_acc_124471 = 0;
        bool eta_p_119789;
        bool eta_p_119790;
        bool local_acc_124472 = 0;
        int64_t start_124473;
        int64_t end_124474;
        
        start_124473 = start;
        end_124474 = end;
        
        int64_t n_124475 = end_124474 - start_124473;
        
        for (int64_t SegRed_i_124476 = start_124473; SegRed_i_124476 < start_124473 + n_124475; SegRed_i_124476++) {
            int64_t gtid_119788 = SegRed_i_124476;
            double eta_p_119792 = ((double *) ext_mem_119676.mem)[gtid_119788];
            double eta_p_119793 = ((double *) mem_param_119549.mem)[gtid_119788];
            double zt_res_119794 = zp_res_108112 * eta_p_119792;
            bool zgze_res_119795 = eta_p_119793 <= zt_res_119794;
            double zt_res_119796 = zp_res_108112 * eta_p_119793;
            bool zgze_res_119797 = eta_p_119792 <= zt_res_119796;
            bool x_119798 = zgze_res_119795 && zgze_res_119797;
            bool not_res_119799 = !x_119798;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_119789 = local_acc_124472;
            }
            // Load next params
            {
                eta_p_119790 = not_res_119799;
            }
            // SegRed body
            {
                bool defunc_0_op_res_119791 = eta_p_119789 || eta_p_119790;
                
                local_acc_124472 = defunc_0_op_res_119791;
            }
        }
        
        int64_t uni_i_124477 = 0;
        
        {
            int64_t gtid_119788 = uni_i_124477;
            
            // Load accum params
            {
                eta_p_124468 = local_acc_124471;
            }
            // Load next params
            {
                eta_p_124469 = local_acc_124472;
            }
            // SegRed body
            {
                bool defunc_0_op_res_124470 = eta_p_124468 || eta_p_124469;
                
                local_acc_124471 = defunc_0_op_res_124470;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_124466.mem)[flat_tid_119787] = local_acc_124471;
    }
    
  cleanup:
    { }
    if (event_128341 != NULL) {
        event_128341->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128340", strdup("nothing further"), event_128341, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128337(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128336 *futhark_mc_task_128336 = (struct futhark_mc_task_128336 *) args;
    struct futhark_context *ctx = futhark_mc_task_128336->ctx;
    struct mc_event *event_128343 = mc_event_new(ctx);
    
    if (event_128343 != NULL)
        event_128343->bef = get_wall_time();
    
    double zp_res_108112 = futhark_mc_task_128336->free_zp_res_108112;
    struct memblock mem_param_119549 = {.desc ="mem_param_119549", .mem =futhark_mc_task_128336->free_mem_param_119549, .size =0, .references =NULL};
    struct memblock ext_mem_119676 = {.desc ="ext_mem_119676", .mem =futhark_mc_task_128336->free_ext_mem_119676, .size =0, .references =NULL};
    int64_t flat_tid_119787 = futhark_mc_task_128336->free_flat_tid_119787;
    bool defunc_0_reduce_comm_res_119786 = *futhark_mc_task_128336->retval_defunc_0_reduce_comm_res_119786;
    int64_t reduce_stage_1_tid_res_arr_mem_124466_cached_sizze_128338 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124466 = NULL;
    int32_t nsubtasks_124465;
    
    nsubtasks_124465 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124466_cached_sizze_128338 < nsubtasks_124465) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124466, &reduce_stage_1_tid_res_arr_mem_124466_cached_sizze_128338, nsubtasks_124465);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128339 futhark_mc_segred_stage_1_parloop_struct_128339_;
    
    futhark_mc_segred_stage_1_parloop_struct_128339_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128339_.free_zp_res_108112 = zp_res_108112;
    futhark_mc_segred_stage_1_parloop_struct_128339_.free_mem_param_119549 = mem_param_119549.mem;
    futhark_mc_segred_stage_1_parloop_struct_128339_.free_ext_mem_119676 = ext_mem_119676.mem;
    futhark_mc_segred_stage_1_parloop_struct_128339_.free_reduce_stage_1_tid_res_arr_mem_124466 = reduce_stage_1_tid_res_arr_mem_124466;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128340_task;
    
    futhark_mc_segred_stage_1_parloop_128340_task.name = "futhark_mc_segred_stage_1_parloop_128340";
    futhark_mc_segred_stage_1_parloop_128340_task.fn = futhark_mc_segred_stage_1_parloop_128340;
    futhark_mc_segred_stage_1_parloop_128340_task.args = &futhark_mc_segred_stage_1_parloop_struct_128339_;
    futhark_mc_segred_stage_1_parloop_128340_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128340_task.info = info;
    
    struct mc_event *event_128342 = mc_event_new(ctx);
    
    if (event_128342 != NULL)
        event_128342->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128340_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128340_task);
    
    if (futhark_mc_segred_stage_1_parloop_128340_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128340_err;
        goto cleanup;
    }
    if (event_128342 != NULL) {
        event_128342->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128340_total", strdup("nothing further"), event_128342, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_comm_res_119786 = 0;
    }
    
    bool eta_p_124478;
    bool eta_p_124479;
    
    for (int32_t i_124481 = 0; i_124481 < nsubtasks_124465; i_124481++) {
        flat_tid_119787 = i_124481;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124478 = defunc_0_reduce_comm_res_119786;
            }
            // load next params
            {
                eta_p_124479 = ((bool *) reduce_stage_1_tid_res_arr_mem_124466)[flat_tid_119787];
            }
            // red body
            {
                bool defunc_0_op_res_124480 = eta_p_124478 || eta_p_124479;
                
                defunc_0_reduce_comm_res_119786 = defunc_0_op_res_124480;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124466);
    }
    if (event_128343 != NULL) {
        event_128343->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128337", strdup("nothing further"), event_128343, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128336->retval_defunc_0_reduce_comm_res_119786 = defunc_0_reduce_comm_res_119786;
    }
    return err;
}
struct futhark_mc_task_128344 {
    struct futhark_context *ctx;
    unsigned char *free_ext_mem_119524;
    int64_t free_flat_tid_119802;
    bool *retval_defunc_0_reduce_res_119801;
};
struct futhark_mc_segred_stage_1_parloop_struct_128347 {
    struct futhark_context *ctx;
    unsigned char *free_ext_mem_119524;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124483;
};
static int futhark_mc_segred_stage_1_parloop_128348(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128347 *futhark_mc_segred_stage_1_parloop_struct_128347 = (struct futhark_mc_segred_stage_1_parloop_struct_128347 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128347->ctx;
    struct mc_event *event_128349 = mc_event_new(ctx);
    
    if (event_128349 != NULL)
        event_128349->bef = get_wall_time();
    
    struct memblock ext_mem_119524 = {.desc ="ext_mem_119524", .mem =futhark_mc_segred_stage_1_parloop_struct_128347->free_ext_mem_119524, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_124483 = {.desc ="reduce_stage_1_tid_res_arr_mem_124483", .mem =futhark_mc_segred_stage_1_parloop_struct_128347->free_reduce_stage_1_tid_res_arr_mem_124483, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_119802;
    
    flat_tid_119802 = subtask_id;
    {
        bool eta_p_124485;
        bool eta_p_124486;
        bool local_acc_124488 = 1;
        bool eta_p_119804;
        bool eta_p_119805;
        bool local_acc_124489 = 1;
        int64_t start_124490;
        int64_t end_124491;
        
        start_124490 = start;
        end_124491 = end;
        
        int64_t n_124492 = end_124491 - start_124490;
        
        for (int64_t SegRed_i_124493 = start_124490; SegRed_i_124493 < start_124490 + n_124492; SegRed_i_124493++) {
            int64_t gtid_119803 = SegRed_i_124493;
            double eta_p_119807 = ((double *) ext_mem_119524.mem)[gtid_119803];
            bool isnan_res_119808 = futrts_isnan64(eta_p_119807);
            bool not_res_119809 = !isnan_res_119808;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_119804 = local_acc_124489;
            }
            // Load next params
            {
                eta_p_119805 = not_res_119809;
            }
            // SegRed body
            {
                bool x_119806 = eta_p_119804 && eta_p_119805;
                
                local_acc_124489 = x_119806;
            }
        }
        
        int64_t uni_i_124494 = 0;
        
        {
            int64_t gtid_119803 = uni_i_124494;
            
            // Load accum params
            {
                eta_p_124485 = local_acc_124488;
            }
            // Load next params
            {
                eta_p_124486 = local_acc_124489;
            }
            // SegRed body
            {
                bool x_124487 = eta_p_124485 && eta_p_124486;
                
                local_acc_124488 = x_124487;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_124483.mem)[flat_tid_119802] = local_acc_124488;
    }
    
  cleanup:
    { }
    if (event_128349 != NULL) {
        event_128349->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128348", strdup("nothing further"), event_128349, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128345(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128344 *futhark_mc_task_128344 = (struct futhark_mc_task_128344 *) args;
    struct futhark_context *ctx = futhark_mc_task_128344->ctx;
    struct mc_event *event_128351 = mc_event_new(ctx);
    
    if (event_128351 != NULL)
        event_128351->bef = get_wall_time();
    
    struct memblock ext_mem_119524 = {.desc ="ext_mem_119524", .mem =futhark_mc_task_128344->free_ext_mem_119524, .size =0, .references =NULL};
    int64_t flat_tid_119802 = futhark_mc_task_128344->free_flat_tid_119802;
    bool defunc_0_reduce_res_119801 = *futhark_mc_task_128344->retval_defunc_0_reduce_res_119801;
    int64_t reduce_stage_1_tid_res_arr_mem_124483_cached_sizze_128346 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124483 = NULL;
    int32_t nsubtasks_124482;
    
    nsubtasks_124482 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124483_cached_sizze_128346 < nsubtasks_124482) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124483, &reduce_stage_1_tid_res_arr_mem_124483_cached_sizze_128346, nsubtasks_124482);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128347 futhark_mc_segred_stage_1_parloop_struct_128347_;
    
    futhark_mc_segred_stage_1_parloop_struct_128347_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128347_.free_ext_mem_119524 = ext_mem_119524.mem;
    futhark_mc_segred_stage_1_parloop_struct_128347_.free_reduce_stage_1_tid_res_arr_mem_124483 = reduce_stage_1_tid_res_arr_mem_124483;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128348_task;
    
    futhark_mc_segred_stage_1_parloop_128348_task.name = "futhark_mc_segred_stage_1_parloop_128348";
    futhark_mc_segred_stage_1_parloop_128348_task.fn = futhark_mc_segred_stage_1_parloop_128348;
    futhark_mc_segred_stage_1_parloop_128348_task.args = &futhark_mc_segred_stage_1_parloop_struct_128347_;
    futhark_mc_segred_stage_1_parloop_128348_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128348_task.info = info;
    
    struct mc_event *event_128350 = mc_event_new(ctx);
    
    if (event_128350 != NULL)
        event_128350->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128348_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128348_task);
    
    if (futhark_mc_segred_stage_1_parloop_128348_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128348_err;
        goto cleanup;
    }
    if (event_128350 != NULL) {
        event_128350->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128348_total", strdup("nothing further"), event_128350, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_119801 = 1;
    }
    
    bool eta_p_124495;
    bool eta_p_124496;
    
    for (int32_t i_124498 = 0; i_124498 < nsubtasks_124482; i_124498++) {
        flat_tid_119802 = i_124498;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124495 = defunc_0_reduce_res_119801;
            }
            // load next params
            {
                eta_p_124496 = ((bool *) reduce_stage_1_tid_res_arr_mem_124483)[flat_tid_119802];
            }
            // red body
            {
                bool x_124497 = eta_p_124495 && eta_p_124496;
                
                defunc_0_reduce_res_119801 = x_124497;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124483);
    }
    if (event_128351 != NULL) {
        event_128351->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128345", strdup("nothing further"), event_128351, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128344->retval_defunc_0_reduce_res_119801 = defunc_0_reduce_res_119801;
    }
    return err;
}
struct futhark_mc_task_128352 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_44883;
    double free_zs_res_44885;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_ext_mem_119519;
    unsigned char *free_ext_mem_119520;
    unsigned char *free_ext_mem_119522;
    int64_t free_ext_119528;
    int64_t free_ext_119529;
    int64_t free_ext_119530;
    int64_t free_flat_tid_119825;
    int64_t free_flat_tid_119847;
    bool *retval_defunc_0_reduce_res_119823;
    unsigned char *retval_mem_112222;
};
struct futhark_mc_segred_stage_1_parloop_struct_128355 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_44883;
    double free_zs_res_44885;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_112222;
    unsigned char *free_ext_mem_119519;
    unsigned char *free_ext_mem_119520;
    unsigned char *free_ext_mem_119522;
    int64_t free_ext_119528;
    int64_t free_ext_119529;
    int64_t free_ext_119530;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124500;
};
static int futhark_mc_segred_stage_1_parloop_128356(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128355 *futhark_mc_segred_stage_1_parloop_struct_128355 = (struct futhark_mc_segred_stage_1_parloop_struct_128355 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128355->ctx;
    struct mc_event *event_128357 = mc_event_new(ctx);
    
    if (event_128357 != NULL)
        event_128357->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128355->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_segred_stage_1_parloop_struct_128355->free_exp_absorb_cutoff_33394;
    double zs_res_44883 = futhark_mc_segred_stage_1_parloop_struct_128355->free_zs_res_44883;
    double zs_res_44885 = futhark_mc_segred_stage_1_parloop_struct_128355->free_zs_res_44885;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128355->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_128355->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112222 = {.desc ="mem_112222", .mem =futhark_mc_segred_stage_1_parloop_struct_128355->free_mem_112222, .size =0, .references =NULL};
    struct memblock ext_mem_119519 = {.desc ="ext_mem_119519", .mem =futhark_mc_segred_stage_1_parloop_struct_128355->free_ext_mem_119519, .size =0, .references =NULL};
    struct memblock ext_mem_119520 = {.desc ="ext_mem_119520", .mem =futhark_mc_segred_stage_1_parloop_struct_128355->free_ext_mem_119520, .size =0, .references =NULL};
    struct memblock ext_mem_119522 = {.desc ="ext_mem_119522", .mem =futhark_mc_segred_stage_1_parloop_struct_128355->free_ext_mem_119522, .size =0, .references =NULL};
    int64_t ext_119528 = futhark_mc_segred_stage_1_parloop_struct_128355->free_ext_119528;
    int64_t ext_119529 = futhark_mc_segred_stage_1_parloop_struct_128355->free_ext_119529;
    int64_t ext_119530 = futhark_mc_segred_stage_1_parloop_struct_128355->free_ext_119530;
    struct memblock reduce_stage_1_tid_res_arr_mem_124500 = {.desc ="reduce_stage_1_tid_res_arr_mem_124500", .mem =futhark_mc_segred_stage_1_parloop_struct_128355->free_reduce_stage_1_tid_res_arr_mem_124500, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_119847;
    
    flat_tid_119847 = subtask_id;
    {
        bool eta_p_124502;
        bool eta_p_124503;
        bool local_acc_124505 = 0;
        bool eta_p_119849;
        bool eta_p_119850;
        bool local_acc_124506 = 0;
        int64_t start_124507;
        int64_t end_124508;
        
        start_124507 = start;
        end_124508 = end;
        
        int64_t n_124509 = end_124508 - start_124507;
        
        for (int64_t SegRed_i_124510 = start_124507; SegRed_i_124510 < start_124507 + n_124509; SegRed_i_124510++) {
            int64_t gtid_119848 = SegRed_i_124510;
            double eta_p_119852 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + gtid_119848];
            double eta_p_119853 = ((double *) ext_mem_119522.mem)[gtid_119848];
            double defunc_0_reduce_res_119854;
            double redout_119856 = 0.0;
            
            for (int64_t i_119855 = 0; i_119855 < m_33388; i_119855++) {
                double eta_p_119857 = ((double *) ext_mem_119520.mem)[i_119855];
                double eta_p_119858 = ((double *) ext_mem_119519.mem)[ext_119528 + (i_119855 * ext_119529 + gtid_119848 * ext_119530)];
                double zt_res_119859 = eta_p_119857 * eta_p_119858;
                double zp_res_119860 = zt_res_119859 + redout_119856;
                double redout_tmp_124511 = zp_res_119860;
                
                redout_119856 = redout_tmp_124511;
            }
            defunc_0_reduce_res_119854 = redout_119856;
            
            double zs_res_119861 = defunc_0_reduce_res_119854 / eta_p_119852;
            double ztzt_res_119862 = fpow64(zs_res_119861, zs_res_44883);
            double zt_res_119863 = zs_res_44885 * eta_p_119853;
            double exp_res_119864 = futrts_exp64(zt_res_119863);
            double zt_res_119865 = ztzt_res_119862 * exp_res_119864;
            bool zgze_res_119866 = exp_absorb_cutoff_33394 <= zt_res_119865;
            
            // save map-out results
            {
                ((double *) mem_112222.mem)[gtid_119848] = zt_res_119865;
            }
            // Load accum params
            {
                eta_p_119849 = local_acc_124506;
            }
            // Load next params
            {
                eta_p_119850 = zgze_res_119866;
            }
            // SegRed body
            {
                bool defunc_0_op_res_119851 = eta_p_119849 || eta_p_119850;
                
                local_acc_124506 = defunc_0_op_res_119851;
            }
        }
        
        int64_t uni_i_124512 = 0;
        
        {
            int64_t gtid_119848 = uni_i_124512;
            
            // Load accum params
            {
                eta_p_124502 = local_acc_124505;
            }
            // Load next params
            {
                eta_p_124503 = local_acc_124506;
            }
            // SegRed body
            {
                bool defunc_0_op_res_124504 = eta_p_124502 || eta_p_124503;
                
                local_acc_124505 = defunc_0_op_res_124504;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_124500.mem)[flat_tid_119847] = local_acc_124505;
    }
    
  cleanup:
    { }
    if (event_128357 != NULL) {
        event_128357->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128356", strdup("nothing further"), event_128357, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128353(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128352 *futhark_mc_task_128352 = (struct futhark_mc_task_128352 *) args;
    struct futhark_context *ctx = futhark_mc_task_128352->ctx;
    struct mc_event *event_128359 = mc_event_new(ctx);
    
    if (event_128359 != NULL)
        event_128359->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128352->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_task_128352->free_exp_absorb_cutoff_33394;
    double zs_res_44883 = futhark_mc_task_128352->free_zs_res_44883;
    double zs_res_44885 = futhark_mc_task_128352->free_zs_res_44885;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128352->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128352->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock ext_mem_119519 = {.desc ="ext_mem_119519", .mem =futhark_mc_task_128352->free_ext_mem_119519, .size =0, .references =NULL};
    struct memblock ext_mem_119520 = {.desc ="ext_mem_119520", .mem =futhark_mc_task_128352->free_ext_mem_119520, .size =0, .references =NULL};
    struct memblock ext_mem_119522 = {.desc ="ext_mem_119522", .mem =futhark_mc_task_128352->free_ext_mem_119522, .size =0, .references =NULL};
    int64_t ext_119528 = futhark_mc_task_128352->free_ext_119528;
    int64_t ext_119529 = futhark_mc_task_128352->free_ext_119529;
    int64_t ext_119530 = futhark_mc_task_128352->free_ext_119530;
    int64_t flat_tid_119825 = futhark_mc_task_128352->free_flat_tid_119825;
    int64_t flat_tid_119847 = futhark_mc_task_128352->free_flat_tid_119847;
    bool defunc_0_reduce_res_119823 = *futhark_mc_task_128352->retval_defunc_0_reduce_res_119823;
    struct memblock mem_112222 = {.desc ="mem_112222", .mem =futhark_mc_task_128352->retval_mem_112222, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_124500_cached_sizze_128354 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124500 = NULL;
    int32_t nsubtasks_124499;
    
    nsubtasks_124499 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124500_cached_sizze_128354 < nsubtasks_124499) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124500, &reduce_stage_1_tid_res_arr_mem_124500_cached_sizze_128354, nsubtasks_124499);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128355 futhark_mc_segred_stage_1_parloop_struct_128355_;
    
    futhark_mc_segred_stage_1_parloop_struct_128355_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128355_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128355_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segred_stage_1_parloop_struct_128355_.free_zs_res_44883 = zs_res_44883;
    futhark_mc_segred_stage_1_parloop_struct_128355_.free_zs_res_44885 = zs_res_44885;
    futhark_mc_segred_stage_1_parloop_struct_128355_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128355_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_128355_.free_mem_112222 = mem_112222.mem;
    futhark_mc_segred_stage_1_parloop_struct_128355_.free_ext_mem_119519 = ext_mem_119519.mem;
    futhark_mc_segred_stage_1_parloop_struct_128355_.free_ext_mem_119520 = ext_mem_119520.mem;
    futhark_mc_segred_stage_1_parloop_struct_128355_.free_ext_mem_119522 = ext_mem_119522.mem;
    futhark_mc_segred_stage_1_parloop_struct_128355_.free_ext_119528 = ext_119528;
    futhark_mc_segred_stage_1_parloop_struct_128355_.free_ext_119529 = ext_119529;
    futhark_mc_segred_stage_1_parloop_struct_128355_.free_ext_119530 = ext_119530;
    futhark_mc_segred_stage_1_parloop_struct_128355_.free_reduce_stage_1_tid_res_arr_mem_124500 = reduce_stage_1_tid_res_arr_mem_124500;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128356_task;
    
    futhark_mc_segred_stage_1_parloop_128356_task.name = "futhark_mc_segred_stage_1_parloop_128356";
    futhark_mc_segred_stage_1_parloop_128356_task.fn = futhark_mc_segred_stage_1_parloop_128356;
    futhark_mc_segred_stage_1_parloop_128356_task.args = &futhark_mc_segred_stage_1_parloop_struct_128355_;
    futhark_mc_segred_stage_1_parloop_128356_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128356_task.info = info;
    
    struct mc_event *event_128358 = mc_event_new(ctx);
    
    if (event_128358 != NULL)
        event_128358->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128356_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128356_task);
    
    if (futhark_mc_segred_stage_1_parloop_128356_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128356_err;
        goto cleanup;
    }
    if (event_128358 != NULL) {
        event_128358->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128356_total", strdup("nothing further"), event_128358, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_119823 = 0;
    }
    
    bool eta_p_124513;
    bool eta_p_124514;
    
    for (int32_t i_124516 = 0; i_124516 < nsubtasks_124499; i_124516++) {
        flat_tid_119847 = i_124516;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124513 = defunc_0_reduce_res_119823;
            }
            // load next params
            {
                eta_p_124514 = ((bool *) reduce_stage_1_tid_res_arr_mem_124500)[flat_tid_119847];
            }
            // red body
            {
                bool defunc_0_op_res_124515 = eta_p_124513 || eta_p_124514;
                
                defunc_0_reduce_res_119823 = defunc_0_op_res_124515;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124500);
    }
    if (event_128359 != NULL) {
        event_128359->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128353", strdup("nothing further"), event_128359, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128352->retval_defunc_0_reduce_res_119823 = defunc_0_reduce_res_119823;
        futhark_mc_task_128352->retval_mem_112222 = mem_112222.mem;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_128362 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_44883;
    double free_zs_res_44885;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_112222;
    unsigned char *free_ext_mem_119519;
    unsigned char *free_ext_mem_119520;
    unsigned char *free_ext_mem_119522;
    int64_t free_ext_119528;
    int64_t free_ext_119529;
    int64_t free_ext_119530;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124518;
};
struct futhark_mc_task_128364 {
    struct futhark_context *ctx;
    unsigned char *free_ext_mem_119519;
    unsigned char *free_ext_mem_119520;
    int64_t free_ext_119528;
    int64_t free_ext_119529;
    int64_t free_ext_119530;
    int64_t free_gtid_119826;
    int64_t free_flat_tid_119833;
    double *retval_defunc_0_reduce_res_119832;
};
struct futhark_mc_segred_stage_1_parloop_struct_128367 {
    struct futhark_context *ctx;
    unsigned char *free_ext_mem_119519;
    unsigned char *free_ext_mem_119520;
    int64_t free_ext_119528;
    int64_t free_ext_119529;
    int64_t free_ext_119530;
    int64_t free_gtid_119826;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124530;
};
static int futhark_mc_segred_stage_1_parloop_128368(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128367 *futhark_mc_segred_stage_1_parloop_struct_128367 = (struct futhark_mc_segred_stage_1_parloop_struct_128367 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128367->ctx;
    struct mc_event *event_128369 = mc_event_new(ctx);
    
    if (event_128369 != NULL)
        event_128369->bef = get_wall_time();
    
    struct memblock ext_mem_119519 = {.desc ="ext_mem_119519", .mem =futhark_mc_segred_stage_1_parloop_struct_128367->free_ext_mem_119519, .size =0, .references =NULL};
    struct memblock ext_mem_119520 = {.desc ="ext_mem_119520", .mem =futhark_mc_segred_stage_1_parloop_struct_128367->free_ext_mem_119520, .size =0, .references =NULL};
    int64_t ext_119528 = futhark_mc_segred_stage_1_parloop_struct_128367->free_ext_119528;
    int64_t ext_119529 = futhark_mc_segred_stage_1_parloop_struct_128367->free_ext_119529;
    int64_t ext_119530 = futhark_mc_segred_stage_1_parloop_struct_128367->free_ext_119530;
    int64_t gtid_119826 = futhark_mc_segred_stage_1_parloop_struct_128367->free_gtid_119826;
    struct memblock reduce_stage_1_tid_res_arr_mem_124530 = {.desc ="reduce_stage_1_tid_res_arr_mem_124530", .mem =futhark_mc_segred_stage_1_parloop_struct_128367->free_reduce_stage_1_tid_res_arr_mem_124530, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_119833;
    
    flat_tid_119833 = subtask_id;
    {
        double eta_p_124532;
        double eta_p_124533;
        double local_acc_124535 = 0.0;
        double eta_p_119835;
        double eta_p_119836;
        double local_acc_124536 = 0.0;
        int64_t start_124537;
        int64_t end_124538;
        
        start_124537 = start;
        end_124538 = end;
        
        int64_t n_124539 = end_124538 - start_124537;
        
        for (int64_t SegRed_i_124540 = start_124537; SegRed_i_124540 < start_124537 + n_124539; SegRed_i_124540++) {
            int64_t gtid_119834 = SegRed_i_124540;
            double eta_p_119838 = ((double *) ext_mem_119520.mem)[gtid_119834];
            double eta_p_119839 = ((double *) ext_mem_119519.mem)[ext_119528 + (gtid_119834 * ext_119529 + gtid_119826 * ext_119530)];
            double zt_res_119840 = eta_p_119838 * eta_p_119839;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_119835 = local_acc_124536;
            }
            // Load next params
            {
                eta_p_119836 = zt_res_119840;
            }
            // SegRed body
            {
                double zp_res_119837 = eta_p_119835 + eta_p_119836;
                
                local_acc_124536 = zp_res_119837;
            }
        }
        
        int64_t uni_i_124541 = 0;
        
        {
            int64_t gtid_119834 = uni_i_124541;
            
            // Load accum params
            {
                eta_p_124532 = local_acc_124535;
            }
            // Load next params
            {
                eta_p_124533 = local_acc_124536;
            }
            // SegRed body
            {
                double zp_res_124534 = eta_p_124532 + eta_p_124533;
                
                local_acc_124535 = zp_res_124534;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_124530.mem)[flat_tid_119833] = local_acc_124535;
    }
    
  cleanup:
    { }
    if (event_128369 != NULL) {
        event_128369->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128368", strdup("nothing further"), event_128369, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128365(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128364 *futhark_mc_task_128364 = (struct futhark_mc_task_128364 *) args;
    struct futhark_context *ctx = futhark_mc_task_128364->ctx;
    struct mc_event *event_128371 = mc_event_new(ctx);
    
    if (event_128371 != NULL)
        event_128371->bef = get_wall_time();
    
    struct memblock ext_mem_119519 = {.desc ="ext_mem_119519", .mem =futhark_mc_task_128364->free_ext_mem_119519, .size =0, .references =NULL};
    struct memblock ext_mem_119520 = {.desc ="ext_mem_119520", .mem =futhark_mc_task_128364->free_ext_mem_119520, .size =0, .references =NULL};
    int64_t ext_119528 = futhark_mc_task_128364->free_ext_119528;
    int64_t ext_119529 = futhark_mc_task_128364->free_ext_119529;
    int64_t ext_119530 = futhark_mc_task_128364->free_ext_119530;
    int64_t gtid_119826 = futhark_mc_task_128364->free_gtid_119826;
    int64_t flat_tid_119833 = futhark_mc_task_128364->free_flat_tid_119833;
    double defunc_0_reduce_res_119832 = *futhark_mc_task_128364->retval_defunc_0_reduce_res_119832;
    int64_t reduce_stage_1_tid_res_arr_mem_124530_cached_sizze_128366 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124530 = NULL;
    int32_t nsubtasks_124529;
    
    nsubtasks_124529 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124530_cached_sizze_128366 < (int64_t) 8 * nsubtasks_124529) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124530, &reduce_stage_1_tid_res_arr_mem_124530_cached_sizze_128366, (int64_t) 8 * nsubtasks_124529);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128367 futhark_mc_segred_stage_1_parloop_struct_128367_;
    
    futhark_mc_segred_stage_1_parloop_struct_128367_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128367_.free_ext_mem_119519 = ext_mem_119519.mem;
    futhark_mc_segred_stage_1_parloop_struct_128367_.free_ext_mem_119520 = ext_mem_119520.mem;
    futhark_mc_segred_stage_1_parloop_struct_128367_.free_ext_119528 = ext_119528;
    futhark_mc_segred_stage_1_parloop_struct_128367_.free_ext_119529 = ext_119529;
    futhark_mc_segred_stage_1_parloop_struct_128367_.free_ext_119530 = ext_119530;
    futhark_mc_segred_stage_1_parloop_struct_128367_.free_gtid_119826 = gtid_119826;
    futhark_mc_segred_stage_1_parloop_struct_128367_.free_reduce_stage_1_tid_res_arr_mem_124530 = reduce_stage_1_tid_res_arr_mem_124530;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128368_task;
    
    futhark_mc_segred_stage_1_parloop_128368_task.name = "futhark_mc_segred_stage_1_parloop_128368";
    futhark_mc_segred_stage_1_parloop_128368_task.fn = futhark_mc_segred_stage_1_parloop_128368;
    futhark_mc_segred_stage_1_parloop_128368_task.args = &futhark_mc_segred_stage_1_parloop_struct_128367_;
    futhark_mc_segred_stage_1_parloop_128368_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128368_task.info = info;
    
    struct mc_event *event_128370 = mc_event_new(ctx);
    
    if (event_128370 != NULL)
        event_128370->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128368_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128368_task);
    
    if (futhark_mc_segred_stage_1_parloop_128368_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128368_err;
        goto cleanup;
    }
    if (event_128370 != NULL) {
        event_128370->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128368_total", strdup("nothing further"), event_128370, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_119832 = 0.0;
    }
    
    double eta_p_124542;
    double eta_p_124543;
    
    for (int32_t i_124545 = 0; i_124545 < nsubtasks_124529; i_124545++) {
        flat_tid_119833 = i_124545;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124542 = defunc_0_reduce_res_119832;
            }
            // load next params
            {
                eta_p_124543 = ((double *) reduce_stage_1_tid_res_arr_mem_124530)[flat_tid_119833];
            }
            // red body
            {
                double zp_res_124544 = eta_p_124542 + eta_p_124543;
                
                defunc_0_reduce_res_119832 = zp_res_124544;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124530);
    }
    if (event_128371 != NULL) {
        event_128371->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128365", strdup("nothing further"), event_128371, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128364->retval_defunc_0_reduce_res_119832 = defunc_0_reduce_res_119832;
    }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_128363(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128362 *futhark_mc_segred_stage_1_parloop_struct_128362 = (struct futhark_mc_segred_stage_1_parloop_struct_128362 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128362->ctx;
    struct mc_event *event_128372 = mc_event_new(ctx);
    
    if (event_128372 != NULL)
        event_128372->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128362->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_segred_stage_1_parloop_struct_128362->free_exp_absorb_cutoff_33394;
    double zs_res_44883 = futhark_mc_segred_stage_1_parloop_struct_128362->free_zs_res_44883;
    double zs_res_44885 = futhark_mc_segred_stage_1_parloop_struct_128362->free_zs_res_44885;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128362->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_128362->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112222 = {.desc ="mem_112222", .mem =futhark_mc_segred_stage_1_parloop_struct_128362->free_mem_112222, .size =0, .references =NULL};
    struct memblock ext_mem_119519 = {.desc ="ext_mem_119519", .mem =futhark_mc_segred_stage_1_parloop_struct_128362->free_ext_mem_119519, .size =0, .references =NULL};
    struct memblock ext_mem_119520 = {.desc ="ext_mem_119520", .mem =futhark_mc_segred_stage_1_parloop_struct_128362->free_ext_mem_119520, .size =0, .references =NULL};
    struct memblock ext_mem_119522 = {.desc ="ext_mem_119522", .mem =futhark_mc_segred_stage_1_parloop_struct_128362->free_ext_mem_119522, .size =0, .references =NULL};
    int64_t ext_119528 = futhark_mc_segred_stage_1_parloop_struct_128362->free_ext_119528;
    int64_t ext_119529 = futhark_mc_segred_stage_1_parloop_struct_128362->free_ext_119529;
    int64_t ext_119530 = futhark_mc_segred_stage_1_parloop_struct_128362->free_ext_119530;
    struct memblock reduce_stage_1_tid_res_arr_mem_124518 = {.desc ="reduce_stage_1_tid_res_arr_mem_124518", .mem =futhark_mc_segred_stage_1_parloop_struct_128362->free_reduce_stage_1_tid_res_arr_mem_124518, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_119825;
    
    flat_tid_119825 = subtask_id;
    {
        bool eta_p_124520;
        bool eta_p_124521;
        bool local_acc_124523 = 0;
        bool eta_p_119827;
        bool eta_p_119828;
        bool local_acc_124524 = 0;
        int64_t start_124525;
        int64_t end_124526;
        
        start_124525 = start;
        end_124526 = end;
        
        int64_t n_124527 = end_124526 - start_124525;
        
        for (int64_t SegRed_i_124528 = start_124525; SegRed_i_124528 < start_124525 + n_124527; SegRed_i_124528++) {
            int64_t gtid_119826 = SegRed_i_124528;
            double eta_p_119830 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + gtid_119826];
            double eta_p_119831 = ((double *) ext_mem_119522.mem)[gtid_119826];
            double defunc_0_reduce_res_119832;
            int64_t flat_tid_119833 = (int64_t) 0;
            
            defunc_0_reduce_res_119832 = 0.0;
            
            struct futhark_mc_task_128364 futhark_mc_task_128364_;
            
            futhark_mc_task_128364_.ctx = ctx;
            futhark_mc_task_128364_.free_ext_mem_119519 = ext_mem_119519.mem;
            futhark_mc_task_128364_.free_ext_mem_119520 = ext_mem_119520.mem;
            futhark_mc_task_128364_.free_ext_119528 = ext_119528;
            futhark_mc_task_128364_.free_ext_119529 = ext_119529;
            futhark_mc_task_128364_.free_ext_119530 = ext_119530;
            futhark_mc_task_128364_.free_gtid_119826 = gtid_119826;
            futhark_mc_task_128364_.free_flat_tid_119833 = flat_tid_119833;
            futhark_mc_task_128364_.retval_defunc_0_reduce_res_119832 = (double *) &defunc_0_reduce_res_119832;
            #if ISPC
            futhark_mc_task_128364_.retval_defunc_0_reduce_res_119832 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_128364_task;
            
            futhark_mc_task_128364_task.args = &futhark_mc_task_128364_;
            futhark_mc_task_128364_task.top_level_fn = futhark_mc_segred_task_128365;
            futhark_mc_task_128364_task.name = "futhark_mc_segred_task_128365";
            futhark_mc_task_128364_task.iterations = m_33388;
            futhark_mc_task_128364_task.task_time = &ctx->program->futhark_mc_segred_task_128365_total_time;
            futhark_mc_task_128364_task.task_iter = &ctx->program->futhark_mc_segred_task_128365_total_iter;
            futhark_mc_task_128364_task.sched = STATIC;
            futhark_mc_task_128364_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_128365_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128364_task);
            
            if (futhark_mc_segred_task_128365_err != 0) {
                err = futhark_mc_segred_task_128365_err;
                goto cleanup;
            }
            
            double zs_res_119841 = defunc_0_reduce_res_119832 / eta_p_119830;
            double ztzt_res_119842 = fpow64(zs_res_119841, zs_res_44883);
            double zt_res_119843 = zs_res_44885 * eta_p_119831;
            double exp_res_119844 = futrts_exp64(zt_res_119843);
            double zt_res_119845 = ztzt_res_119842 * exp_res_119844;
            bool zgze_res_119846 = exp_absorb_cutoff_33394 <= zt_res_119845;
            
            // save map-out results
            {
                ((double *) mem_112222.mem)[gtid_119826] = zt_res_119845;
            }
            // Load accum params
            {
                eta_p_119827 = local_acc_124524;
            }
            // Load next params
            {
                eta_p_119828 = zgze_res_119846;
            }
            // SegRed body
            {
                bool defunc_0_op_res_119829 = eta_p_119827 || eta_p_119828;
                
                local_acc_124524 = defunc_0_op_res_119829;
            }
        }
        
        int64_t uni_i_124546 = 0;
        
        {
            int64_t gtid_119826 = uni_i_124546;
            
            // Load accum params
            {
                eta_p_124520 = local_acc_124523;
            }
            // Load next params
            {
                eta_p_124521 = local_acc_124524;
            }
            // SegRed body
            {
                bool defunc_0_op_res_124522 = eta_p_124520 || eta_p_124521;
                
                local_acc_124523 = defunc_0_op_res_124522;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_124518.mem)[flat_tid_119825] = local_acc_124523;
    }
    
  cleanup:
    { }
    if (event_128372 != NULL) {
        event_128372->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128363", strdup("nothing further"), event_128372, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_128360(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128352 *futhark_mc_task_128352 = (struct futhark_mc_task_128352 *) args;
    struct futhark_context *ctx = futhark_mc_task_128352->ctx;
    struct mc_event *event_128374 = mc_event_new(ctx);
    
    if (event_128374 != NULL)
        event_128374->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128352->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_task_128352->free_exp_absorb_cutoff_33394;
    double zs_res_44883 = futhark_mc_task_128352->free_zs_res_44883;
    double zs_res_44885 = futhark_mc_task_128352->free_zs_res_44885;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128352->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128352->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock ext_mem_119519 = {.desc ="ext_mem_119519", .mem =futhark_mc_task_128352->free_ext_mem_119519, .size =0, .references =NULL};
    struct memblock ext_mem_119520 = {.desc ="ext_mem_119520", .mem =futhark_mc_task_128352->free_ext_mem_119520, .size =0, .references =NULL};
    struct memblock ext_mem_119522 = {.desc ="ext_mem_119522", .mem =futhark_mc_task_128352->free_ext_mem_119522, .size =0, .references =NULL};
    int64_t ext_119528 = futhark_mc_task_128352->free_ext_119528;
    int64_t ext_119529 = futhark_mc_task_128352->free_ext_119529;
    int64_t ext_119530 = futhark_mc_task_128352->free_ext_119530;
    int64_t flat_tid_119825 = futhark_mc_task_128352->free_flat_tid_119825;
    int64_t flat_tid_119847 = futhark_mc_task_128352->free_flat_tid_119847;
    bool defunc_0_reduce_res_119823 = *futhark_mc_task_128352->retval_defunc_0_reduce_res_119823;
    struct memblock mem_112222 = {.desc ="mem_112222", .mem =futhark_mc_task_128352->retval_mem_112222, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_124518_cached_sizze_128361 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124518 = NULL;
    int32_t nsubtasks_124517;
    
    nsubtasks_124517 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124518_cached_sizze_128361 < nsubtasks_124517) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124518, &reduce_stage_1_tid_res_arr_mem_124518_cached_sizze_128361, nsubtasks_124517);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128362 futhark_mc_segred_stage_1_parloop_struct_128362_;
    
    futhark_mc_segred_stage_1_parloop_struct_128362_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128362_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128362_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segred_stage_1_parloop_struct_128362_.free_zs_res_44883 = zs_res_44883;
    futhark_mc_segred_stage_1_parloop_struct_128362_.free_zs_res_44885 = zs_res_44885;
    futhark_mc_segred_stage_1_parloop_struct_128362_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128362_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_128362_.free_mem_112222 = mem_112222.mem;
    futhark_mc_segred_stage_1_parloop_struct_128362_.free_ext_mem_119519 = ext_mem_119519.mem;
    futhark_mc_segred_stage_1_parloop_struct_128362_.free_ext_mem_119520 = ext_mem_119520.mem;
    futhark_mc_segred_stage_1_parloop_struct_128362_.free_ext_mem_119522 = ext_mem_119522.mem;
    futhark_mc_segred_stage_1_parloop_struct_128362_.free_ext_119528 = ext_119528;
    futhark_mc_segred_stage_1_parloop_struct_128362_.free_ext_119529 = ext_119529;
    futhark_mc_segred_stage_1_parloop_struct_128362_.free_ext_119530 = ext_119530;
    futhark_mc_segred_stage_1_parloop_struct_128362_.free_reduce_stage_1_tid_res_arr_mem_124518 = reduce_stage_1_tid_res_arr_mem_124518;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128363_task;
    
    futhark_mc_segred_stage_1_parloop_128363_task.name = "futhark_mc_segred_stage_1_parloop_128363";
    futhark_mc_segred_stage_1_parloop_128363_task.fn = futhark_mc_segred_stage_1_parloop_128363;
    futhark_mc_segred_stage_1_parloop_128363_task.args = &futhark_mc_segred_stage_1_parloop_struct_128362_;
    futhark_mc_segred_stage_1_parloop_128363_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128363_task.info = info;
    
    struct mc_event *event_128373 = mc_event_new(ctx);
    
    if (event_128373 != NULL)
        event_128373->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128363_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128363_task);
    
    if (futhark_mc_segred_stage_1_parloop_128363_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128363_err;
        goto cleanup;
    }
    if (event_128373 != NULL) {
        event_128373->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128363_total", strdup("nothing further"), event_128373, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_119823 = 0;
    }
    
    bool eta_p_124547;
    bool eta_p_124548;
    
    for (int32_t i_124550 = 0; i_124550 < nsubtasks_124517; i_124550++) {
        flat_tid_119825 = i_124550;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124547 = defunc_0_reduce_res_119823;
            }
            // load next params
            {
                eta_p_124548 = ((bool *) reduce_stage_1_tid_res_arr_mem_124518)[flat_tid_119825];
            }
            // red body
            {
                bool defunc_0_op_res_124549 = eta_p_124547 || eta_p_124548;
                
                defunc_0_reduce_res_119823 = defunc_0_op_res_124549;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124518);
    }
    if (event_128374 != NULL) {
        event_128374->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_128360", strdup("nothing further"), event_128374, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128352->retval_defunc_0_reduce_res_119823 = defunc_0_reduce_res_119823;
        futhark_mc_task_128352->retval_mem_112222 = mem_112222.mem;
    }
    return err;
}
struct futhark_mc_task_128375 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_44842;
    double free_zs_res_44844;
    int64_t free_eta_p_106382;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_112222;
    unsigned char *free_ext_mem_119519;
    unsigned char *free_ext_mem_119521;
    int64_t free_ext_119528;
    int64_t free_ext_119529;
    int64_t free_ext_119530;
    int64_t free_flat_tid_119869;
    int64_t free_flat_tid_119891;
    bool *retval_defunc_0_reduce_res_119867;
    unsigned char *retval_mem_112224;
};
struct futhark_mc_segred_stage_1_parloop_struct_128378 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_44842;
    double free_zs_res_44844;
    int64_t free_eta_p_106382;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_112222;
    unsigned char *free_mem_112224;
    unsigned char *free_ext_mem_119519;
    unsigned char *free_ext_mem_119521;
    int64_t free_ext_119528;
    int64_t free_ext_119529;
    int64_t free_ext_119530;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124552;
};
static int futhark_mc_segred_stage_1_parloop_128379(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128378 *futhark_mc_segred_stage_1_parloop_struct_128378 = (struct futhark_mc_segred_stage_1_parloop_struct_128378 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128378->ctx;
    struct mc_event *event_128380 = mc_event_new(ctx);
    
    if (event_128380 != NULL)
        event_128380->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128378->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_segred_stage_1_parloop_struct_128378->free_exp_absorb_cutoff_33394;
    double zs_res_44842 = futhark_mc_segred_stage_1_parloop_struct_128378->free_zs_res_44842;
    double zs_res_44844 = futhark_mc_segred_stage_1_parloop_struct_128378->free_zs_res_44844;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_128378->free_eta_p_106382;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_128378->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112222 = {.desc ="mem_112222", .mem =futhark_mc_segred_stage_1_parloop_struct_128378->free_mem_112222, .size =0, .references =NULL};
    struct memblock mem_112224 = {.desc ="mem_112224", .mem =futhark_mc_segred_stage_1_parloop_struct_128378->free_mem_112224, .size =0, .references =NULL};
    struct memblock ext_mem_119519 = {.desc ="ext_mem_119519", .mem =futhark_mc_segred_stage_1_parloop_struct_128378->free_ext_mem_119519, .size =0, .references =NULL};
    struct memblock ext_mem_119521 = {.desc ="ext_mem_119521", .mem =futhark_mc_segred_stage_1_parloop_struct_128378->free_ext_mem_119521, .size =0, .references =NULL};
    int64_t ext_119528 = futhark_mc_segred_stage_1_parloop_struct_128378->free_ext_119528;
    int64_t ext_119529 = futhark_mc_segred_stage_1_parloop_struct_128378->free_ext_119529;
    int64_t ext_119530 = futhark_mc_segred_stage_1_parloop_struct_128378->free_ext_119530;
    struct memblock reduce_stage_1_tid_res_arr_mem_124552 = {.desc ="reduce_stage_1_tid_res_arr_mem_124552", .mem =futhark_mc_segred_stage_1_parloop_struct_128378->free_reduce_stage_1_tid_res_arr_mem_124552, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_119891;
    
    flat_tid_119891 = subtask_id;
    {
        bool eta_p_124554;
        bool eta_p_124555;
        bool local_acc_124557 = 0;
        bool eta_p_119893;
        bool eta_p_119894;
        bool local_acc_124558 = 0;
        int64_t start_124559;
        int64_t end_124560;
        
        start_124559 = start;
        end_124560 = end;
        
        int64_t n_124561 = end_124560 - start_124559;
        
        for (int64_t SegRed_i_124562 = start_124559; SegRed_i_124562 < start_124559 + n_124561; SegRed_i_124562++) {
            int64_t gtid_119892 = SegRed_i_124562;
            double eta_p_119896 = ((double *) distrs_mem_111708.mem)[eta_p_106382 * m_33388 + gtid_119892];
            double eta_p_119897 = ((double *) ext_mem_119521.mem)[gtid_119892];
            double defunc_0_reduce_res_119898;
            double redout_119900 = 0.0;
            
            for (int64_t i_119899 = 0; i_119899 < m_33388; i_119899++) {
                double eta_p_119901 = ((double *) mem_112222.mem)[i_119899];
                double eta_p_119902 = ((double *) ext_mem_119519.mem)[ext_119528 + (gtid_119892 * ext_119529 + i_119899 * ext_119530)];
                double zt_res_119903 = eta_p_119901 * eta_p_119902;
                double zp_res_119904 = zt_res_119903 + redout_119900;
                double redout_tmp_124563 = zp_res_119904;
                
                redout_119900 = redout_tmp_124563;
            }
            defunc_0_reduce_res_119898 = redout_119900;
            
            double zs_res_119905 = defunc_0_reduce_res_119898 / eta_p_119896;
            double ztzt_res_119906 = fpow64(zs_res_119905, zs_res_44842);
            double zt_res_119907 = zs_res_44844 * eta_p_119897;
            double exp_res_119908 = futrts_exp64(zt_res_119907);
            double zt_res_119909 = ztzt_res_119906 * exp_res_119908;
            bool zgze_res_119910 = exp_absorb_cutoff_33394 <= zt_res_119909;
            
            // save map-out results
            {
                ((double *) mem_112224.mem)[gtid_119892] = zt_res_119909;
            }
            // Load accum params
            {
                eta_p_119893 = local_acc_124558;
            }
            // Load next params
            {
                eta_p_119894 = zgze_res_119910;
            }
            // SegRed body
            {
                bool defunc_0_op_res_119895 = eta_p_119893 || eta_p_119894;
                
                local_acc_124558 = defunc_0_op_res_119895;
            }
        }
        
        int64_t uni_i_124564 = 0;
        
        {
            int64_t gtid_119892 = uni_i_124564;
            
            // Load accum params
            {
                eta_p_124554 = local_acc_124557;
            }
            // Load next params
            {
                eta_p_124555 = local_acc_124558;
            }
            // SegRed body
            {
                bool defunc_0_op_res_124556 = eta_p_124554 || eta_p_124555;
                
                local_acc_124557 = defunc_0_op_res_124556;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_124552.mem)[flat_tid_119891] = local_acc_124557;
    }
    
  cleanup:
    { }
    if (event_128380 != NULL) {
        event_128380->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128379", strdup("nothing further"), event_128380, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128376(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128375 *futhark_mc_task_128375 = (struct futhark_mc_task_128375 *) args;
    struct futhark_context *ctx = futhark_mc_task_128375->ctx;
    struct mc_event *event_128382 = mc_event_new(ctx);
    
    if (event_128382 != NULL)
        event_128382->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128375->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_task_128375->free_exp_absorb_cutoff_33394;
    double zs_res_44842 = futhark_mc_task_128375->free_zs_res_44842;
    double zs_res_44844 = futhark_mc_task_128375->free_zs_res_44844;
    int64_t eta_p_106382 = futhark_mc_task_128375->free_eta_p_106382;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128375->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112222 = {.desc ="mem_112222", .mem =futhark_mc_task_128375->free_mem_112222, .size =0, .references =NULL};
    struct memblock ext_mem_119519 = {.desc ="ext_mem_119519", .mem =futhark_mc_task_128375->free_ext_mem_119519, .size =0, .references =NULL};
    struct memblock ext_mem_119521 = {.desc ="ext_mem_119521", .mem =futhark_mc_task_128375->free_ext_mem_119521, .size =0, .references =NULL};
    int64_t ext_119528 = futhark_mc_task_128375->free_ext_119528;
    int64_t ext_119529 = futhark_mc_task_128375->free_ext_119529;
    int64_t ext_119530 = futhark_mc_task_128375->free_ext_119530;
    int64_t flat_tid_119869 = futhark_mc_task_128375->free_flat_tid_119869;
    int64_t flat_tid_119891 = futhark_mc_task_128375->free_flat_tid_119891;
    bool defunc_0_reduce_res_119867 = *futhark_mc_task_128375->retval_defunc_0_reduce_res_119867;
    struct memblock mem_112224 = {.desc ="mem_112224", .mem =futhark_mc_task_128375->retval_mem_112224, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_124552_cached_sizze_128377 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124552 = NULL;
    int32_t nsubtasks_124551;
    
    nsubtasks_124551 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124552_cached_sizze_128377 < nsubtasks_124551) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124552, &reduce_stage_1_tid_res_arr_mem_124552_cached_sizze_128377, nsubtasks_124551);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128378 futhark_mc_segred_stage_1_parloop_struct_128378_;
    
    futhark_mc_segred_stage_1_parloop_struct_128378_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128378_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128378_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segred_stage_1_parloop_struct_128378_.free_zs_res_44842 = zs_res_44842;
    futhark_mc_segred_stage_1_parloop_struct_128378_.free_zs_res_44844 = zs_res_44844;
    futhark_mc_segred_stage_1_parloop_struct_128378_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_128378_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_128378_.free_mem_112222 = mem_112222.mem;
    futhark_mc_segred_stage_1_parloop_struct_128378_.free_mem_112224 = mem_112224.mem;
    futhark_mc_segred_stage_1_parloop_struct_128378_.free_ext_mem_119519 = ext_mem_119519.mem;
    futhark_mc_segred_stage_1_parloop_struct_128378_.free_ext_mem_119521 = ext_mem_119521.mem;
    futhark_mc_segred_stage_1_parloop_struct_128378_.free_ext_119528 = ext_119528;
    futhark_mc_segred_stage_1_parloop_struct_128378_.free_ext_119529 = ext_119529;
    futhark_mc_segred_stage_1_parloop_struct_128378_.free_ext_119530 = ext_119530;
    futhark_mc_segred_stage_1_parloop_struct_128378_.free_reduce_stage_1_tid_res_arr_mem_124552 = reduce_stage_1_tid_res_arr_mem_124552;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128379_task;
    
    futhark_mc_segred_stage_1_parloop_128379_task.name = "futhark_mc_segred_stage_1_parloop_128379";
    futhark_mc_segred_stage_1_parloop_128379_task.fn = futhark_mc_segred_stage_1_parloop_128379;
    futhark_mc_segred_stage_1_parloop_128379_task.args = &futhark_mc_segred_stage_1_parloop_struct_128378_;
    futhark_mc_segred_stage_1_parloop_128379_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128379_task.info = info;
    
    struct mc_event *event_128381 = mc_event_new(ctx);
    
    if (event_128381 != NULL)
        event_128381->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128379_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128379_task);
    
    if (futhark_mc_segred_stage_1_parloop_128379_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128379_err;
        goto cleanup;
    }
    if (event_128381 != NULL) {
        event_128381->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128379_total", strdup("nothing further"), event_128381, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_119867 = 0;
    }
    
    bool eta_p_124565;
    bool eta_p_124566;
    
    for (int32_t i_124568 = 0; i_124568 < nsubtasks_124551; i_124568++) {
        flat_tid_119891 = i_124568;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124565 = defunc_0_reduce_res_119867;
            }
            // load next params
            {
                eta_p_124566 = ((bool *) reduce_stage_1_tid_res_arr_mem_124552)[flat_tid_119891];
            }
            // red body
            {
                bool defunc_0_op_res_124567 = eta_p_124565 || eta_p_124566;
                
                defunc_0_reduce_res_119867 = defunc_0_op_res_124567;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124552);
    }
    if (event_128382 != NULL) {
        event_128382->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128376", strdup("nothing further"), event_128382, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128375->retval_defunc_0_reduce_res_119867 = defunc_0_reduce_res_119867;
        futhark_mc_task_128375->retval_mem_112224 = mem_112224.mem;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_128385 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_44842;
    double free_zs_res_44844;
    int64_t free_eta_p_106382;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_112222;
    unsigned char *free_mem_112224;
    unsigned char *free_ext_mem_119519;
    unsigned char *free_ext_mem_119521;
    int64_t free_ext_119528;
    int64_t free_ext_119529;
    int64_t free_ext_119530;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124570;
};
struct futhark_mc_task_128387 {
    struct futhark_context *ctx;
    unsigned char *free_mem_112222;
    unsigned char *free_ext_mem_119519;
    int64_t free_ext_119528;
    int64_t free_ext_119529;
    int64_t free_ext_119530;
    int64_t free_gtid_119870;
    int64_t free_flat_tid_119877;
    double *retval_defunc_0_reduce_res_119876;
};
struct futhark_mc_segred_stage_1_parloop_struct_128390 {
    struct futhark_context *ctx;
    unsigned char *free_mem_112222;
    unsigned char *free_ext_mem_119519;
    int64_t free_ext_119528;
    int64_t free_ext_119529;
    int64_t free_ext_119530;
    int64_t free_gtid_119870;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124582;
};
static int futhark_mc_segred_stage_1_parloop_128391(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128390 *futhark_mc_segred_stage_1_parloop_struct_128390 = (struct futhark_mc_segred_stage_1_parloop_struct_128390 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128390->ctx;
    struct mc_event *event_128392 = mc_event_new(ctx);
    
    if (event_128392 != NULL)
        event_128392->bef = get_wall_time();
    
    struct memblock mem_112222 = {.desc ="mem_112222", .mem =futhark_mc_segred_stage_1_parloop_struct_128390->free_mem_112222, .size =0, .references =NULL};
    struct memblock ext_mem_119519 = {.desc ="ext_mem_119519", .mem =futhark_mc_segred_stage_1_parloop_struct_128390->free_ext_mem_119519, .size =0, .references =NULL};
    int64_t ext_119528 = futhark_mc_segred_stage_1_parloop_struct_128390->free_ext_119528;
    int64_t ext_119529 = futhark_mc_segred_stage_1_parloop_struct_128390->free_ext_119529;
    int64_t ext_119530 = futhark_mc_segred_stage_1_parloop_struct_128390->free_ext_119530;
    int64_t gtid_119870 = futhark_mc_segred_stage_1_parloop_struct_128390->free_gtid_119870;
    struct memblock reduce_stage_1_tid_res_arr_mem_124582 = {.desc ="reduce_stage_1_tid_res_arr_mem_124582", .mem =futhark_mc_segred_stage_1_parloop_struct_128390->free_reduce_stage_1_tid_res_arr_mem_124582, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_119877;
    
    flat_tid_119877 = subtask_id;
    {
        double eta_p_124584;
        double eta_p_124585;
        double local_acc_124587 = 0.0;
        double eta_p_119879;
        double eta_p_119880;
        double local_acc_124588 = 0.0;
        int64_t start_124589;
        int64_t end_124590;
        
        start_124589 = start;
        end_124590 = end;
        
        int64_t n_124591 = end_124590 - start_124589;
        
        for (int64_t SegRed_i_124592 = start_124589; SegRed_i_124592 < start_124589 + n_124591; SegRed_i_124592++) {
            int64_t gtid_119878 = SegRed_i_124592;
            double eta_p_119882 = ((double *) mem_112222.mem)[gtid_119878];
            double eta_p_119883 = ((double *) ext_mem_119519.mem)[ext_119528 + (gtid_119870 * ext_119529 + gtid_119878 * ext_119530)];
            double zt_res_119884 = eta_p_119882 * eta_p_119883;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_119879 = local_acc_124588;
            }
            // Load next params
            {
                eta_p_119880 = zt_res_119884;
            }
            // SegRed body
            {
                double zp_res_119881 = eta_p_119879 + eta_p_119880;
                
                local_acc_124588 = zp_res_119881;
            }
        }
        
        int64_t uni_i_124593 = 0;
        
        {
            int64_t gtid_119878 = uni_i_124593;
            
            // Load accum params
            {
                eta_p_124584 = local_acc_124587;
            }
            // Load next params
            {
                eta_p_124585 = local_acc_124588;
            }
            // SegRed body
            {
                double zp_res_124586 = eta_p_124584 + eta_p_124585;
                
                local_acc_124587 = zp_res_124586;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_124582.mem)[flat_tid_119877] = local_acc_124587;
    }
    
  cleanup:
    { }
    if (event_128392 != NULL) {
        event_128392->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128391", strdup("nothing further"), event_128392, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128388(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128387 *futhark_mc_task_128387 = (struct futhark_mc_task_128387 *) args;
    struct futhark_context *ctx = futhark_mc_task_128387->ctx;
    struct mc_event *event_128394 = mc_event_new(ctx);
    
    if (event_128394 != NULL)
        event_128394->bef = get_wall_time();
    
    struct memblock mem_112222 = {.desc ="mem_112222", .mem =futhark_mc_task_128387->free_mem_112222, .size =0, .references =NULL};
    struct memblock ext_mem_119519 = {.desc ="ext_mem_119519", .mem =futhark_mc_task_128387->free_ext_mem_119519, .size =0, .references =NULL};
    int64_t ext_119528 = futhark_mc_task_128387->free_ext_119528;
    int64_t ext_119529 = futhark_mc_task_128387->free_ext_119529;
    int64_t ext_119530 = futhark_mc_task_128387->free_ext_119530;
    int64_t gtid_119870 = futhark_mc_task_128387->free_gtid_119870;
    int64_t flat_tid_119877 = futhark_mc_task_128387->free_flat_tid_119877;
    double defunc_0_reduce_res_119876 = *futhark_mc_task_128387->retval_defunc_0_reduce_res_119876;
    int64_t reduce_stage_1_tid_res_arr_mem_124582_cached_sizze_128389 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124582 = NULL;
    int32_t nsubtasks_124581;
    
    nsubtasks_124581 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124582_cached_sizze_128389 < (int64_t) 8 * nsubtasks_124581) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124582, &reduce_stage_1_tid_res_arr_mem_124582_cached_sizze_128389, (int64_t) 8 * nsubtasks_124581);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128390 futhark_mc_segred_stage_1_parloop_struct_128390_;
    
    futhark_mc_segred_stage_1_parloop_struct_128390_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128390_.free_mem_112222 = mem_112222.mem;
    futhark_mc_segred_stage_1_parloop_struct_128390_.free_ext_mem_119519 = ext_mem_119519.mem;
    futhark_mc_segred_stage_1_parloop_struct_128390_.free_ext_119528 = ext_119528;
    futhark_mc_segred_stage_1_parloop_struct_128390_.free_ext_119529 = ext_119529;
    futhark_mc_segred_stage_1_parloop_struct_128390_.free_ext_119530 = ext_119530;
    futhark_mc_segred_stage_1_parloop_struct_128390_.free_gtid_119870 = gtid_119870;
    futhark_mc_segred_stage_1_parloop_struct_128390_.free_reduce_stage_1_tid_res_arr_mem_124582 = reduce_stage_1_tid_res_arr_mem_124582;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128391_task;
    
    futhark_mc_segred_stage_1_parloop_128391_task.name = "futhark_mc_segred_stage_1_parloop_128391";
    futhark_mc_segred_stage_1_parloop_128391_task.fn = futhark_mc_segred_stage_1_parloop_128391;
    futhark_mc_segred_stage_1_parloop_128391_task.args = &futhark_mc_segred_stage_1_parloop_struct_128390_;
    futhark_mc_segred_stage_1_parloop_128391_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128391_task.info = info;
    
    struct mc_event *event_128393 = mc_event_new(ctx);
    
    if (event_128393 != NULL)
        event_128393->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128391_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128391_task);
    
    if (futhark_mc_segred_stage_1_parloop_128391_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128391_err;
        goto cleanup;
    }
    if (event_128393 != NULL) {
        event_128393->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128391_total", strdup("nothing further"), event_128393, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_119876 = 0.0;
    }
    
    double eta_p_124594;
    double eta_p_124595;
    
    for (int32_t i_124597 = 0; i_124597 < nsubtasks_124581; i_124597++) {
        flat_tid_119877 = i_124597;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124594 = defunc_0_reduce_res_119876;
            }
            // load next params
            {
                eta_p_124595 = ((double *) reduce_stage_1_tid_res_arr_mem_124582)[flat_tid_119877];
            }
            // red body
            {
                double zp_res_124596 = eta_p_124594 + eta_p_124595;
                
                defunc_0_reduce_res_119876 = zp_res_124596;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124582);
    }
    if (event_128394 != NULL) {
        event_128394->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128388", strdup("nothing further"), event_128394, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128387->retval_defunc_0_reduce_res_119876 = defunc_0_reduce_res_119876;
    }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_128386(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128385 *futhark_mc_segred_stage_1_parloop_struct_128385 = (struct futhark_mc_segred_stage_1_parloop_struct_128385 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128385->ctx;
    struct mc_event *event_128395 = mc_event_new(ctx);
    
    if (event_128395 != NULL)
        event_128395->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128385->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_segred_stage_1_parloop_struct_128385->free_exp_absorb_cutoff_33394;
    double zs_res_44842 = futhark_mc_segred_stage_1_parloop_struct_128385->free_zs_res_44842;
    double zs_res_44844 = futhark_mc_segred_stage_1_parloop_struct_128385->free_zs_res_44844;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_128385->free_eta_p_106382;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_128385->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112222 = {.desc ="mem_112222", .mem =futhark_mc_segred_stage_1_parloop_struct_128385->free_mem_112222, .size =0, .references =NULL};
    struct memblock mem_112224 = {.desc ="mem_112224", .mem =futhark_mc_segred_stage_1_parloop_struct_128385->free_mem_112224, .size =0, .references =NULL};
    struct memblock ext_mem_119519 = {.desc ="ext_mem_119519", .mem =futhark_mc_segred_stage_1_parloop_struct_128385->free_ext_mem_119519, .size =0, .references =NULL};
    struct memblock ext_mem_119521 = {.desc ="ext_mem_119521", .mem =futhark_mc_segred_stage_1_parloop_struct_128385->free_ext_mem_119521, .size =0, .references =NULL};
    int64_t ext_119528 = futhark_mc_segred_stage_1_parloop_struct_128385->free_ext_119528;
    int64_t ext_119529 = futhark_mc_segred_stage_1_parloop_struct_128385->free_ext_119529;
    int64_t ext_119530 = futhark_mc_segred_stage_1_parloop_struct_128385->free_ext_119530;
    struct memblock reduce_stage_1_tid_res_arr_mem_124570 = {.desc ="reduce_stage_1_tid_res_arr_mem_124570", .mem =futhark_mc_segred_stage_1_parloop_struct_128385->free_reduce_stage_1_tid_res_arr_mem_124570, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_119869;
    
    flat_tid_119869 = subtask_id;
    {
        bool eta_p_124572;
        bool eta_p_124573;
        bool local_acc_124575 = 0;
        bool eta_p_119871;
        bool eta_p_119872;
        bool local_acc_124576 = 0;
        int64_t start_124577;
        int64_t end_124578;
        
        start_124577 = start;
        end_124578 = end;
        
        int64_t n_124579 = end_124578 - start_124577;
        
        for (int64_t SegRed_i_124580 = start_124577; SegRed_i_124580 < start_124577 + n_124579; SegRed_i_124580++) {
            int64_t gtid_119870 = SegRed_i_124580;
            double eta_p_119874 = ((double *) distrs_mem_111708.mem)[eta_p_106382 * m_33388 + gtid_119870];
            double eta_p_119875 = ((double *) ext_mem_119521.mem)[gtid_119870];
            double defunc_0_reduce_res_119876;
            int64_t flat_tid_119877 = (int64_t) 0;
            
            defunc_0_reduce_res_119876 = 0.0;
            
            struct futhark_mc_task_128387 futhark_mc_task_128387_;
            
            futhark_mc_task_128387_.ctx = ctx;
            futhark_mc_task_128387_.free_mem_112222 = mem_112222.mem;
            futhark_mc_task_128387_.free_ext_mem_119519 = ext_mem_119519.mem;
            futhark_mc_task_128387_.free_ext_119528 = ext_119528;
            futhark_mc_task_128387_.free_ext_119529 = ext_119529;
            futhark_mc_task_128387_.free_ext_119530 = ext_119530;
            futhark_mc_task_128387_.free_gtid_119870 = gtid_119870;
            futhark_mc_task_128387_.free_flat_tid_119877 = flat_tid_119877;
            futhark_mc_task_128387_.retval_defunc_0_reduce_res_119876 = (double *) &defunc_0_reduce_res_119876;
            #if ISPC
            futhark_mc_task_128387_.retval_defunc_0_reduce_res_119876 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_128387_task;
            
            futhark_mc_task_128387_task.args = &futhark_mc_task_128387_;
            futhark_mc_task_128387_task.top_level_fn = futhark_mc_segred_task_128388;
            futhark_mc_task_128387_task.name = "futhark_mc_segred_task_128388";
            futhark_mc_task_128387_task.iterations = m_33388;
            futhark_mc_task_128387_task.task_time = &ctx->program->futhark_mc_segred_task_128388_total_time;
            futhark_mc_task_128387_task.task_iter = &ctx->program->futhark_mc_segred_task_128388_total_iter;
            futhark_mc_task_128387_task.sched = STATIC;
            futhark_mc_task_128387_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_128388_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128387_task);
            
            if (futhark_mc_segred_task_128388_err != 0) {
                err = futhark_mc_segred_task_128388_err;
                goto cleanup;
            }
            
            double zs_res_119885 = defunc_0_reduce_res_119876 / eta_p_119874;
            double ztzt_res_119886 = fpow64(zs_res_119885, zs_res_44842);
            double zt_res_119887 = zs_res_44844 * eta_p_119875;
            double exp_res_119888 = futrts_exp64(zt_res_119887);
            double zt_res_119889 = ztzt_res_119886 * exp_res_119888;
            bool zgze_res_119890 = exp_absorb_cutoff_33394 <= zt_res_119889;
            
            // save map-out results
            {
                ((double *) mem_112224.mem)[gtid_119870] = zt_res_119889;
            }
            // Load accum params
            {
                eta_p_119871 = local_acc_124576;
            }
            // Load next params
            {
                eta_p_119872 = zgze_res_119890;
            }
            // SegRed body
            {
                bool defunc_0_op_res_119873 = eta_p_119871 || eta_p_119872;
                
                local_acc_124576 = defunc_0_op_res_119873;
            }
        }
        
        int64_t uni_i_124598 = 0;
        
        {
            int64_t gtid_119870 = uni_i_124598;
            
            // Load accum params
            {
                eta_p_124572 = local_acc_124575;
            }
            // Load next params
            {
                eta_p_124573 = local_acc_124576;
            }
            // SegRed body
            {
                bool defunc_0_op_res_124574 = eta_p_124572 || eta_p_124573;
                
                local_acc_124575 = defunc_0_op_res_124574;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_124570.mem)[flat_tid_119869] = local_acc_124575;
    }
    
  cleanup:
    { }
    if (event_128395 != NULL) {
        event_128395->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128386", strdup("nothing further"), event_128395, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_128383(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128375 *futhark_mc_task_128375 = (struct futhark_mc_task_128375 *) args;
    struct futhark_context *ctx = futhark_mc_task_128375->ctx;
    struct mc_event *event_128397 = mc_event_new(ctx);
    
    if (event_128397 != NULL)
        event_128397->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128375->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_task_128375->free_exp_absorb_cutoff_33394;
    double zs_res_44842 = futhark_mc_task_128375->free_zs_res_44842;
    double zs_res_44844 = futhark_mc_task_128375->free_zs_res_44844;
    int64_t eta_p_106382 = futhark_mc_task_128375->free_eta_p_106382;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128375->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112222 = {.desc ="mem_112222", .mem =futhark_mc_task_128375->free_mem_112222, .size =0, .references =NULL};
    struct memblock ext_mem_119519 = {.desc ="ext_mem_119519", .mem =futhark_mc_task_128375->free_ext_mem_119519, .size =0, .references =NULL};
    struct memblock ext_mem_119521 = {.desc ="ext_mem_119521", .mem =futhark_mc_task_128375->free_ext_mem_119521, .size =0, .references =NULL};
    int64_t ext_119528 = futhark_mc_task_128375->free_ext_119528;
    int64_t ext_119529 = futhark_mc_task_128375->free_ext_119529;
    int64_t ext_119530 = futhark_mc_task_128375->free_ext_119530;
    int64_t flat_tid_119869 = futhark_mc_task_128375->free_flat_tid_119869;
    int64_t flat_tid_119891 = futhark_mc_task_128375->free_flat_tid_119891;
    bool defunc_0_reduce_res_119867 = *futhark_mc_task_128375->retval_defunc_0_reduce_res_119867;
    struct memblock mem_112224 = {.desc ="mem_112224", .mem =futhark_mc_task_128375->retval_mem_112224, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_124570_cached_sizze_128384 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124570 = NULL;
    int32_t nsubtasks_124569;
    
    nsubtasks_124569 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124570_cached_sizze_128384 < nsubtasks_124569) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124570, &reduce_stage_1_tid_res_arr_mem_124570_cached_sizze_128384, nsubtasks_124569);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128385 futhark_mc_segred_stage_1_parloop_struct_128385_;
    
    futhark_mc_segred_stage_1_parloop_struct_128385_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128385_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128385_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segred_stage_1_parloop_struct_128385_.free_zs_res_44842 = zs_res_44842;
    futhark_mc_segred_stage_1_parloop_struct_128385_.free_zs_res_44844 = zs_res_44844;
    futhark_mc_segred_stage_1_parloop_struct_128385_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_128385_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_128385_.free_mem_112222 = mem_112222.mem;
    futhark_mc_segred_stage_1_parloop_struct_128385_.free_mem_112224 = mem_112224.mem;
    futhark_mc_segred_stage_1_parloop_struct_128385_.free_ext_mem_119519 = ext_mem_119519.mem;
    futhark_mc_segred_stage_1_parloop_struct_128385_.free_ext_mem_119521 = ext_mem_119521.mem;
    futhark_mc_segred_stage_1_parloop_struct_128385_.free_ext_119528 = ext_119528;
    futhark_mc_segred_stage_1_parloop_struct_128385_.free_ext_119529 = ext_119529;
    futhark_mc_segred_stage_1_parloop_struct_128385_.free_ext_119530 = ext_119530;
    futhark_mc_segred_stage_1_parloop_struct_128385_.free_reduce_stage_1_tid_res_arr_mem_124570 = reduce_stage_1_tid_res_arr_mem_124570;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128386_task;
    
    futhark_mc_segred_stage_1_parloop_128386_task.name = "futhark_mc_segred_stage_1_parloop_128386";
    futhark_mc_segred_stage_1_parloop_128386_task.fn = futhark_mc_segred_stage_1_parloop_128386;
    futhark_mc_segred_stage_1_parloop_128386_task.args = &futhark_mc_segred_stage_1_parloop_struct_128385_;
    futhark_mc_segred_stage_1_parloop_128386_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128386_task.info = info;
    
    struct mc_event *event_128396 = mc_event_new(ctx);
    
    if (event_128396 != NULL)
        event_128396->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128386_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128386_task);
    
    if (futhark_mc_segred_stage_1_parloop_128386_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128386_err;
        goto cleanup;
    }
    if (event_128396 != NULL) {
        event_128396->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128386_total", strdup("nothing further"), event_128396, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_119867 = 0;
    }
    
    bool eta_p_124599;
    bool eta_p_124600;
    
    for (int32_t i_124602 = 0; i_124602 < nsubtasks_124569; i_124602++) {
        flat_tid_119869 = i_124602;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124599 = defunc_0_reduce_res_119867;
            }
            // load next params
            {
                eta_p_124600 = ((bool *) reduce_stage_1_tid_res_arr_mem_124570)[flat_tid_119869];
            }
            // red body
            {
                bool defunc_0_op_res_124601 = eta_p_124599 || eta_p_124600;
                
                defunc_0_reduce_res_119867 = defunc_0_op_res_124601;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124570);
    }
    if (event_128397 != NULL) {
        event_128397->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_128383", strdup("nothing further"), event_128397, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128375->retval_defunc_0_reduce_res_119867 = defunc_0_reduce_res_119867;
        futhark_mc_task_128375->retval_mem_112224 = mem_112224.mem;
    }
    return err;
}
struct futhark_mc_task_128398 {
    struct futhark_context *ctx;
    double free_zs_res_107134;
    unsigned char *free_mem_112224;
    int64_t free_flat_tid_119912;
    bool *retval_defunc_0_reduce_res_119911;
};
struct futhark_mc_segred_stage_1_parloop_struct_128401 {
    struct futhark_context *ctx;
    double free_zs_res_107134;
    unsigned char *free_mem_112224;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124604;
};
static int futhark_mc_segred_stage_1_parloop_128402(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128401 *futhark_mc_segred_stage_1_parloop_struct_128401 = (struct futhark_mc_segred_stage_1_parloop_struct_128401 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128401->ctx;
    struct mc_event *event_128403 = mc_event_new(ctx);
    
    if (event_128403 != NULL)
        event_128403->bef = get_wall_time();
    
    double zs_res_107134 = futhark_mc_segred_stage_1_parloop_struct_128401->free_zs_res_107134;
    struct memblock mem_112224 = {.desc ="mem_112224", .mem =futhark_mc_segred_stage_1_parloop_struct_128401->free_mem_112224, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_124604 = {.desc ="reduce_stage_1_tid_res_arr_mem_124604", .mem =futhark_mc_segred_stage_1_parloop_struct_128401->free_reduce_stage_1_tid_res_arr_mem_124604, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_119912;
    
    flat_tid_119912 = subtask_id;
    {
        bool eta_p_124606;
        bool eta_p_124607;
        bool local_acc_124609 = 0;
        bool eta_p_119914;
        bool eta_p_119915;
        bool local_acc_124610 = 0;
        int64_t start_124611;
        int64_t end_124612;
        
        start_124611 = start;
        end_124612 = end;
        
        int64_t n_124613 = end_124612 - start_124611;
        
        for (int64_t SegRed_i_124614 = start_124611; SegRed_i_124614 < start_124611 + n_124613; SegRed_i_124614++) {
            int64_t gtid_119913 = SegRed_i_124614;
            double eta_p_119917 = ((double *) mem_112224.mem)[gtid_119913];
            bool zlze_res_119918 = eta_p_119917 <= zs_res_107134;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_119914 = local_acc_124610;
            }
            // Load next params
            {
                eta_p_119915 = zlze_res_119918;
            }
            // SegRed body
            {
                bool defunc_0_op_res_119916 = eta_p_119914 || eta_p_119915;
                
                local_acc_124610 = defunc_0_op_res_119916;
            }
        }
        
        int64_t uni_i_124615 = 0;
        
        {
            int64_t gtid_119913 = uni_i_124615;
            
            // Load accum params
            {
                eta_p_124606 = local_acc_124609;
            }
            // Load next params
            {
                eta_p_124607 = local_acc_124610;
            }
            // SegRed body
            {
                bool defunc_0_op_res_124608 = eta_p_124606 || eta_p_124607;
                
                local_acc_124609 = defunc_0_op_res_124608;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_124604.mem)[flat_tid_119912] = local_acc_124609;
    }
    
  cleanup:
    { }
    if (event_128403 != NULL) {
        event_128403->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128402", strdup("nothing further"), event_128403, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128399(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128398 *futhark_mc_task_128398 = (struct futhark_mc_task_128398 *) args;
    struct futhark_context *ctx = futhark_mc_task_128398->ctx;
    struct mc_event *event_128405 = mc_event_new(ctx);
    
    if (event_128405 != NULL)
        event_128405->bef = get_wall_time();
    
    double zs_res_107134 = futhark_mc_task_128398->free_zs_res_107134;
    struct memblock mem_112224 = {.desc ="mem_112224", .mem =futhark_mc_task_128398->free_mem_112224, .size =0, .references =NULL};
    int64_t flat_tid_119912 = futhark_mc_task_128398->free_flat_tid_119912;
    bool defunc_0_reduce_res_119911 = *futhark_mc_task_128398->retval_defunc_0_reduce_res_119911;
    int64_t reduce_stage_1_tid_res_arr_mem_124604_cached_sizze_128400 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124604 = NULL;
    int32_t nsubtasks_124603;
    
    nsubtasks_124603 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124604_cached_sizze_128400 < nsubtasks_124603) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124604, &reduce_stage_1_tid_res_arr_mem_124604_cached_sizze_128400, nsubtasks_124603);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128401 futhark_mc_segred_stage_1_parloop_struct_128401_;
    
    futhark_mc_segred_stage_1_parloop_struct_128401_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128401_.free_zs_res_107134 = zs_res_107134;
    futhark_mc_segred_stage_1_parloop_struct_128401_.free_mem_112224 = mem_112224.mem;
    futhark_mc_segred_stage_1_parloop_struct_128401_.free_reduce_stage_1_tid_res_arr_mem_124604 = reduce_stage_1_tid_res_arr_mem_124604;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128402_task;
    
    futhark_mc_segred_stage_1_parloop_128402_task.name = "futhark_mc_segred_stage_1_parloop_128402";
    futhark_mc_segred_stage_1_parloop_128402_task.fn = futhark_mc_segred_stage_1_parloop_128402;
    futhark_mc_segred_stage_1_parloop_128402_task.args = &futhark_mc_segred_stage_1_parloop_struct_128401_;
    futhark_mc_segred_stage_1_parloop_128402_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128402_task.info = info;
    
    struct mc_event *event_128404 = mc_event_new(ctx);
    
    if (event_128404 != NULL)
        event_128404->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128402_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128402_task);
    
    if (futhark_mc_segred_stage_1_parloop_128402_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128402_err;
        goto cleanup;
    }
    if (event_128404 != NULL) {
        event_128404->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128402_total", strdup("nothing further"), event_128404, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_119911 = 0;
    }
    
    bool eta_p_124616;
    bool eta_p_124617;
    
    for (int32_t i_124619 = 0; i_124619 < nsubtasks_124603; i_124619++) {
        flat_tid_119912 = i_124619;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124616 = defunc_0_reduce_res_119911;
            }
            // load next params
            {
                eta_p_124617 = ((bool *) reduce_stage_1_tid_res_arr_mem_124604)[flat_tid_119912];
            }
            // red body
            {
                bool defunc_0_op_res_124618 = eta_p_124616 || eta_p_124617;
                
                defunc_0_reduce_res_119911 = defunc_0_op_res_124618;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124604);
    }
    if (event_128405 != NULL) {
        event_128405->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128399", strdup("nothing further"), event_128405, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128398->retval_defunc_0_reduce_res_119911 = defunc_0_reduce_res_119911;
    }
    return err;
}
struct futhark_mc_task_128406 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_107134;
    int64_t free_bytes_111715;
    unsigned char *free_mem_112224;
    unsigned char *free_mem_112239;
    unsigned char *free_mem_112241;
    unsigned char *free_mem_112244;
    unsigned char *free_ext_mem_119519;
    unsigned char *free_ext_mem_119521;
    int64_t free_ext_119528;
    int64_t free_ext_119529;
    int64_t free_ext_119530;
};
struct futhark_mc_segmap_parloop_struct_128408 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_107134;
    int64_t free_bytes_111715;
    unsigned char *free_mem_112224;
    unsigned char *free_mem_112239;
    unsigned char *free_mem_112241;
    unsigned char *free_mem_112244;
    unsigned char *free_ext_mem_119519;
    unsigned char *free_ext_mem_119521;
    int64_t free_ext_119528;
    int64_t free_ext_119529;
    int64_t free_ext_119530;
};
static int futhark_mc_segmap_parloop_128409(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_128408 *futhark_mc_segmap_parloop_struct_128408 = (struct futhark_mc_segmap_parloop_struct_128408 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_128408->ctx;
    struct mc_event *event_128410 = mc_event_new(ctx);
    
    if (event_128410 != NULL)
        event_128410->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_128408->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_segmap_parloop_struct_128408->free_exp_absorb_cutoff_33394;
    double zs_res_107134 = futhark_mc_segmap_parloop_struct_128408->free_zs_res_107134;
    int64_t bytes_111715 = futhark_mc_segmap_parloop_struct_128408->free_bytes_111715;
    struct memblock mem_112224 = {.desc ="mem_112224", .mem =futhark_mc_segmap_parloop_struct_128408->free_mem_112224, .size =0, .references =NULL};
    struct memblock mem_112239 = {.desc ="mem_112239", .mem =futhark_mc_segmap_parloop_struct_128408->free_mem_112239, .size =0, .references =NULL};
    struct memblock mem_112241 = {.desc ="mem_112241", .mem =futhark_mc_segmap_parloop_struct_128408->free_mem_112241, .size =0, .references =NULL};
    struct memblock mem_112244 = {.desc ="mem_112244", .mem =futhark_mc_segmap_parloop_struct_128408->free_mem_112244, .size =0, .references =NULL};
    struct memblock ext_mem_119519 = {.desc ="ext_mem_119519", .mem =futhark_mc_segmap_parloop_struct_128408->free_ext_mem_119519, .size =0, .references =NULL};
    struct memblock ext_mem_119521 = {.desc ="ext_mem_119521", .mem =futhark_mc_segmap_parloop_struct_128408->free_ext_mem_119521, .size =0, .references =NULL};
    int64_t ext_119528 = futhark_mc_segmap_parloop_struct_128408->free_ext_119528;
    int64_t ext_119529 = futhark_mc_segmap_parloop_struct_128408->free_ext_119529;
    int64_t ext_119530 = futhark_mc_segmap_parloop_struct_128408->free_ext_119530;
    int64_t iterations = end - start;
    struct memblock ext_mem_119949;
    
    ext_mem_119949.references = NULL;
    
    struct memblock mem_119948;
    
    mem_119948.references = NULL;
    
    int64_t flat_tid_119934;
    
    flat_tid_119934 = subtask_id;
    {
        int64_t start_124632;
        int64_t end_124633;
        
        start_124632 = start;
        end_124633 = end;
        
        int64_t n_124634 = end_124633 - start_124632;
        
        if (memblock_alloc(ctx, &mem_119948, bytes_111715, "mem_119948")) {
            err = 1;
            goto cleanup;
        }
        for (int64_t SegMap_i_124635 = start_124632; SegMap_i_124635 < start_124632 + n_124634; SegMap_i_124635++) {
            int64_t slice_124636 = m_33388;
            int64_t gtid_119935 = SegMap_i_124635;
            int64_t remnant_124637 = SegMap_i_124635 - gtid_119935;
            double eta_p_119936 = ((double *) mem_112224.mem)[gtid_119935];
            double eta_p_119937 = ((double *) ext_mem_119521.mem)[gtid_119935];
            bool zgze_res_119939 = exp_absorb_cutoff_33394 <= eta_p_119936;
            bool zl_res_119940 = eta_p_119936 < zs_res_107134;
            bool x_119941 = !zgze_res_119939;
            bool y_119942 = zl_res_119940 && x_119941;
            bool cond_119943 = zgze_res_119939 || y_119942;
            int64_t binop_y_119944 = gtid_119935 * ext_119529;
            int64_t lmad_ext_119945 = ext_119528 + binop_y_119944;
            int64_t ext_119946;
            
            if (cond_119943) {
                ext_119946 = (int64_t) 0;
            } else {
                ext_119946 = lmad_ext_119945;
            }
            
            int64_t ext_119947;
            
            if (cond_119943) {
                ext_119947 = (int64_t) 1;
            } else {
                ext_119947 = ext_119530;
            }
            
            double rescale_res_119950;
            double rescale_res_119951;
            
            if (cond_119943) {
                double log_res_124621 = futrts_log64(eta_p_119936);
                double sqrt_res_124622 = futrts_sqrt64(eta_p_119936);
                double zs_res_124623 = log_res_124621 / 2.0;
                double zp_res_124624 = eta_p_119937 + zs_res_124623;
                
                for (int64_t i_124627 = 0; i_124627 < m_33388; i_124627++) {
                    double eta_p_124629 = ((double *) ext_mem_119519.mem)[ext_119528 + (gtid_119935 * ext_119529 + i_124627 * ext_119530)];
                    double zt_res_124630 = sqrt_res_124622 * eta_p_124629;
                    
                    ((double *) mem_119948.mem)[i_124627] = zt_res_124630;
                }
                if (memblock_set(ctx, &ext_mem_119949, &mem_119948, "mem_119948") != 0)
                    return 1;
                rescale_res_119950 = sqrt_res_124622;
                rescale_res_119951 = zp_res_124624;
            } else {
                if (memblock_set(ctx, &ext_mem_119949, &ext_mem_119519, "ext_mem_119519") != 0)
                    return 1;
                rescale_res_119950 = eta_p_119936;
                rescale_res_119951 = eta_p_119937;
            }
            ((double *) mem_112239.mem)[gtid_119935] = rescale_res_119950;
            ((double *) mem_112241.mem)[gtid_119935] = rescale_res_119951;
            lmad_copy_8b(ctx, 1, (uint64_t *) mem_112244.mem, gtid_119935 * m_33388, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_119949.mem, ext_119946, (int64_t []) {ext_119947}, (int64_t []) {m_33388});
        }
    }
    
  cleanup:
    {
        if (memblock_unref(ctx, &ext_mem_119949, "ext_mem_119949") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_119948, "mem_119948") != 0)
            return 1;
    }
    if (event_128410 != NULL) {
        event_128410->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128409", strdup("nothing further"), event_128410, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_task_128407(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128406 *futhark_mc_task_128406 = (struct futhark_mc_task_128406 *) args;
    struct futhark_context *ctx = futhark_mc_task_128406->ctx;
    struct mc_event *event_128412 = mc_event_new(ctx);
    
    if (event_128412 != NULL)
        event_128412->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128406->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_task_128406->free_exp_absorb_cutoff_33394;
    double zs_res_107134 = futhark_mc_task_128406->free_zs_res_107134;
    int64_t bytes_111715 = futhark_mc_task_128406->free_bytes_111715;
    struct memblock mem_112224 = {.desc ="mem_112224", .mem =futhark_mc_task_128406->free_mem_112224, .size =0, .references =NULL};
    struct memblock mem_112239 = {.desc ="mem_112239", .mem =futhark_mc_task_128406->free_mem_112239, .size =0, .references =NULL};
    struct memblock mem_112241 = {.desc ="mem_112241", .mem =futhark_mc_task_128406->free_mem_112241, .size =0, .references =NULL};
    struct memblock mem_112244 = {.desc ="mem_112244", .mem =futhark_mc_task_128406->free_mem_112244, .size =0, .references =NULL};
    struct memblock ext_mem_119519 = {.desc ="ext_mem_119519", .mem =futhark_mc_task_128406->free_ext_mem_119519, .size =0, .references =NULL};
    struct memblock ext_mem_119521 = {.desc ="ext_mem_119521", .mem =futhark_mc_task_128406->free_ext_mem_119521, .size =0, .references =NULL};
    int64_t ext_119528 = futhark_mc_task_128406->free_ext_119528;
    int64_t ext_119529 = futhark_mc_task_128406->free_ext_119529;
    int64_t ext_119530 = futhark_mc_task_128406->free_ext_119530;
    int32_t nsubtasks_124620;
    
    nsubtasks_124620 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_128408 futhark_mc_segmap_parloop_struct_128408_;
    
    futhark_mc_segmap_parloop_struct_128408_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_128408_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_128408_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segmap_parloop_struct_128408_.free_zs_res_107134 = zs_res_107134;
    futhark_mc_segmap_parloop_struct_128408_.free_bytes_111715 = bytes_111715;
    futhark_mc_segmap_parloop_struct_128408_.free_mem_112224 = mem_112224.mem;
    futhark_mc_segmap_parloop_struct_128408_.free_mem_112239 = mem_112239.mem;
    futhark_mc_segmap_parloop_struct_128408_.free_mem_112241 = mem_112241.mem;
    futhark_mc_segmap_parloop_struct_128408_.free_mem_112244 = mem_112244.mem;
    futhark_mc_segmap_parloop_struct_128408_.free_ext_mem_119519 = ext_mem_119519.mem;
    futhark_mc_segmap_parloop_struct_128408_.free_ext_mem_119521 = ext_mem_119521.mem;
    futhark_mc_segmap_parloop_struct_128408_.free_ext_119528 = ext_119528;
    futhark_mc_segmap_parloop_struct_128408_.free_ext_119529 = ext_119529;
    futhark_mc_segmap_parloop_struct_128408_.free_ext_119530 = ext_119530;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_128409_task;
    
    futhark_mc_segmap_parloop_128409_task.name = "futhark_mc_segmap_parloop_128409";
    futhark_mc_segmap_parloop_128409_task.fn = futhark_mc_segmap_parloop_128409;
    futhark_mc_segmap_parloop_128409_task.args = &futhark_mc_segmap_parloop_struct_128408_;
    futhark_mc_segmap_parloop_128409_task.iterations = iterations;
    futhark_mc_segmap_parloop_128409_task.info = info;
    
    struct mc_event *event_128411 = mc_event_new(ctx);
    
    if (event_128411 != NULL)
        event_128411->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_128409_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_128409_task);
    
    if (futhark_mc_segmap_parloop_128409_err != 0) {
        err = futhark_mc_segmap_parloop_128409_err;
        goto cleanup;
    }
    if (event_128411 != NULL) {
        event_128411->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128409_total", strdup("nothing further"), event_128411, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_128412 != NULL) {
        event_128412->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_task_128407", strdup("nothing further"), event_128412, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_128413 {
    struct futhark_context *ctx;
    double free_zs_res_107134;
    unsigned char *free_mem_112222;
    int64_t free_flat_tid_119965;
    bool *retval_defunc_0_reduce_res_119964;
};
struct futhark_mc_segred_stage_1_parloop_struct_128416 {
    struct futhark_context *ctx;
    double free_zs_res_107134;
    unsigned char *free_mem_112222;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124640;
};
static int futhark_mc_segred_stage_1_parloop_128417(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128416 *futhark_mc_segred_stage_1_parloop_struct_128416 = (struct futhark_mc_segred_stage_1_parloop_struct_128416 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128416->ctx;
    struct mc_event *event_128418 = mc_event_new(ctx);
    
    if (event_128418 != NULL)
        event_128418->bef = get_wall_time();
    
    double zs_res_107134 = futhark_mc_segred_stage_1_parloop_struct_128416->free_zs_res_107134;
    struct memblock mem_112222 = {.desc ="mem_112222", .mem =futhark_mc_segred_stage_1_parloop_struct_128416->free_mem_112222, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_124640 = {.desc ="reduce_stage_1_tid_res_arr_mem_124640", .mem =futhark_mc_segred_stage_1_parloop_struct_128416->free_reduce_stage_1_tid_res_arr_mem_124640, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_119965;
    
    flat_tid_119965 = subtask_id;
    {
        bool eta_p_124642;
        bool eta_p_124643;
        bool local_acc_124645 = 0;
        bool eta_p_119967;
        bool eta_p_119968;
        bool local_acc_124646 = 0;
        int64_t start_124647;
        int64_t end_124648;
        
        start_124647 = start;
        end_124648 = end;
        
        int64_t n_124649 = end_124648 - start_124647;
        
        for (int64_t SegRed_i_124650 = start_124647; SegRed_i_124650 < start_124647 + n_124649; SegRed_i_124650++) {
            int64_t gtid_119966 = SegRed_i_124650;
            double eta_p_119970 = ((double *) mem_112222.mem)[gtid_119966];
            bool zlze_res_119971 = eta_p_119970 <= zs_res_107134;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_119967 = local_acc_124646;
            }
            // Load next params
            {
                eta_p_119968 = zlze_res_119971;
            }
            // SegRed body
            {
                bool defunc_0_op_res_119969 = eta_p_119967 || eta_p_119968;
                
                local_acc_124646 = defunc_0_op_res_119969;
            }
        }
        
        int64_t uni_i_124651 = 0;
        
        {
            int64_t gtid_119966 = uni_i_124651;
            
            // Load accum params
            {
                eta_p_124642 = local_acc_124645;
            }
            // Load next params
            {
                eta_p_124643 = local_acc_124646;
            }
            // SegRed body
            {
                bool defunc_0_op_res_124644 = eta_p_124642 || eta_p_124643;
                
                local_acc_124645 = defunc_0_op_res_124644;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_124640.mem)[flat_tid_119965] = local_acc_124645;
    }
    
  cleanup:
    { }
    if (event_128418 != NULL) {
        event_128418->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128417", strdup("nothing further"), event_128418, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128414(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128413 *futhark_mc_task_128413 = (struct futhark_mc_task_128413 *) args;
    struct futhark_context *ctx = futhark_mc_task_128413->ctx;
    struct mc_event *event_128420 = mc_event_new(ctx);
    
    if (event_128420 != NULL)
        event_128420->bef = get_wall_time();
    
    double zs_res_107134 = futhark_mc_task_128413->free_zs_res_107134;
    struct memblock mem_112222 = {.desc ="mem_112222", .mem =futhark_mc_task_128413->free_mem_112222, .size =0, .references =NULL};
    int64_t flat_tid_119965 = futhark_mc_task_128413->free_flat_tid_119965;
    bool defunc_0_reduce_res_119964 = *futhark_mc_task_128413->retval_defunc_0_reduce_res_119964;
    int64_t reduce_stage_1_tid_res_arr_mem_124640_cached_sizze_128415 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124640 = NULL;
    int32_t nsubtasks_124639;
    
    nsubtasks_124639 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124640_cached_sizze_128415 < nsubtasks_124639) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124640, &reduce_stage_1_tid_res_arr_mem_124640_cached_sizze_128415, nsubtasks_124639);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128416 futhark_mc_segred_stage_1_parloop_struct_128416_;
    
    futhark_mc_segred_stage_1_parloop_struct_128416_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128416_.free_zs_res_107134 = zs_res_107134;
    futhark_mc_segred_stage_1_parloop_struct_128416_.free_mem_112222 = mem_112222.mem;
    futhark_mc_segred_stage_1_parloop_struct_128416_.free_reduce_stage_1_tid_res_arr_mem_124640 = reduce_stage_1_tid_res_arr_mem_124640;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128417_task;
    
    futhark_mc_segred_stage_1_parloop_128417_task.name = "futhark_mc_segred_stage_1_parloop_128417";
    futhark_mc_segred_stage_1_parloop_128417_task.fn = futhark_mc_segred_stage_1_parloop_128417;
    futhark_mc_segred_stage_1_parloop_128417_task.args = &futhark_mc_segred_stage_1_parloop_struct_128416_;
    futhark_mc_segred_stage_1_parloop_128417_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128417_task.info = info;
    
    struct mc_event *event_128419 = mc_event_new(ctx);
    
    if (event_128419 != NULL)
        event_128419->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128417_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128417_task);
    
    if (futhark_mc_segred_stage_1_parloop_128417_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128417_err;
        goto cleanup;
    }
    if (event_128419 != NULL) {
        event_128419->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128417_total", strdup("nothing further"), event_128419, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_119964 = 0;
    }
    
    bool eta_p_124652;
    bool eta_p_124653;
    
    for (int32_t i_124655 = 0; i_124655 < nsubtasks_124639; i_124655++) {
        flat_tid_119965 = i_124655;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124652 = defunc_0_reduce_res_119964;
            }
            // load next params
            {
                eta_p_124653 = ((bool *) reduce_stage_1_tid_res_arr_mem_124640)[flat_tid_119965];
            }
            // red body
            {
                bool defunc_0_op_res_124654 = eta_p_124652 || eta_p_124653;
                
                defunc_0_reduce_res_119964 = defunc_0_op_res_124654;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124640);
    }
    if (event_128420 != NULL) {
        event_128420->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128414", strdup("nothing further"), event_128420, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128413->retval_defunc_0_reduce_res_119964 = defunc_0_reduce_res_119964;
    }
    return err;
}
struct futhark_mc_task_128421 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_107134;
    int64_t free_bytes_111715;
    unsigned char *free_mem_112222;
    unsigned char *free_mem_112267;
    unsigned char *free_mem_112269;
    unsigned char *free_mem_112272;
    unsigned char *free_ext_mem_119522;
    int64_t free_ext_119922;
    int64_t free_ext_119923;
    int64_t free_ext_119924;
    unsigned char *free_ext_mem_119927;
};
struct futhark_mc_segmap_parloop_struct_128423 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_107134;
    int64_t free_bytes_111715;
    unsigned char *free_mem_112222;
    unsigned char *free_mem_112267;
    unsigned char *free_mem_112269;
    unsigned char *free_mem_112272;
    unsigned char *free_ext_mem_119522;
    int64_t free_ext_119922;
    int64_t free_ext_119923;
    int64_t free_ext_119924;
    unsigned char *free_ext_mem_119927;
};
static int futhark_mc_segmap_parloop_128424(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_128423 *futhark_mc_segmap_parloop_struct_128423 = (struct futhark_mc_segmap_parloop_struct_128423 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_128423->ctx;
    struct mc_event *event_128425 = mc_event_new(ctx);
    
    if (event_128425 != NULL)
        event_128425->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_128423->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_segmap_parloop_struct_128423->free_exp_absorb_cutoff_33394;
    double zs_res_107134 = futhark_mc_segmap_parloop_struct_128423->free_zs_res_107134;
    int64_t bytes_111715 = futhark_mc_segmap_parloop_struct_128423->free_bytes_111715;
    struct memblock mem_112222 = {.desc ="mem_112222", .mem =futhark_mc_segmap_parloop_struct_128423->free_mem_112222, .size =0, .references =NULL};
    struct memblock mem_112267 = {.desc ="mem_112267", .mem =futhark_mc_segmap_parloop_struct_128423->free_mem_112267, .size =0, .references =NULL};
    struct memblock mem_112269 = {.desc ="mem_112269", .mem =futhark_mc_segmap_parloop_struct_128423->free_mem_112269, .size =0, .references =NULL};
    struct memblock mem_112272 = {.desc ="mem_112272", .mem =futhark_mc_segmap_parloop_struct_128423->free_mem_112272, .size =0, .references =NULL};
    struct memblock ext_mem_119522 = {.desc ="ext_mem_119522", .mem =futhark_mc_segmap_parloop_struct_128423->free_ext_mem_119522, .size =0, .references =NULL};
    int64_t ext_119922 = futhark_mc_segmap_parloop_struct_128423->free_ext_119922;
    int64_t ext_119923 = futhark_mc_segmap_parloop_struct_128423->free_ext_119923;
    int64_t ext_119924 = futhark_mc_segmap_parloop_struct_128423->free_ext_119924;
    struct memblock ext_mem_119927 = {.desc ="ext_mem_119927", .mem =futhark_mc_segmap_parloop_struct_128423->free_ext_mem_119927, .size =0, .references =NULL};
    int64_t iterations = end - start;
    struct memblock ext_mem_120003;
    
    ext_mem_120003.references = NULL;
    
    struct memblock mem_120002;
    
    mem_120002.references = NULL;
    
    int64_t flat_tid_119988;
    
    flat_tid_119988 = subtask_id;
    {
        int64_t start_124668;
        int64_t end_124669;
        
        start_124668 = start;
        end_124669 = end;
        
        int64_t n_124670 = end_124669 - start_124668;
        
        if (memblock_alloc(ctx, &mem_120002, bytes_111715, "mem_120002")) {
            err = 1;
            goto cleanup;
        }
        for (int64_t SegMap_i_124671 = start_124668; SegMap_i_124671 < start_124668 + n_124670; SegMap_i_124671++) {
            int64_t slice_124672 = m_33388;
            int64_t gtid_119989 = SegMap_i_124671;
            int64_t remnant_124673 = SegMap_i_124671 - gtid_119989;
            double eta_p_119990 = ((double *) mem_112222.mem)[gtid_119989];
            double eta_p_119991 = ((double *) ext_mem_119522.mem)[gtid_119989];
            bool zgze_res_119993 = exp_absorb_cutoff_33394 <= eta_p_119990;
            bool zl_res_119994 = eta_p_119990 < zs_res_107134;
            bool x_119995 = !zgze_res_119993;
            bool y_119996 = zl_res_119994 && x_119995;
            bool cond_119997 = zgze_res_119993 || y_119996;
            int64_t binop_y_119998 = gtid_119989 * ext_119924;
            int64_t lmad_ext_119999 = ext_119922 + binop_y_119998;
            int64_t ext_120000;
            
            if (cond_119997) {
                ext_120000 = (int64_t) 0;
            } else {
                ext_120000 = lmad_ext_119999;
            }
            
            int64_t ext_120001;
            
            if (cond_119997) {
                ext_120001 = (int64_t) 1;
            } else {
                ext_120001 = ext_119923;
            }
            
            double rescale_res_120004;
            double rescale_res_120005;
            
            if (cond_119997) {
                double log_res_124657 = futrts_log64(eta_p_119990);
                double sqrt_res_124658 = futrts_sqrt64(eta_p_119990);
                double zs_res_124659 = log_res_124657 / 2.0;
                double zp_res_124660 = eta_p_119991 + zs_res_124659;
                
                for (int64_t i_124663 = 0; i_124663 < m_33388; i_124663++) {
                    double eta_p_124665 = ((double *) ext_mem_119927.mem)[ext_119922 + (i_124663 * ext_119923 + gtid_119989 * ext_119924)];
                    double zt_res_124666 = sqrt_res_124658 * eta_p_124665;
                    
                    ((double *) mem_120002.mem)[i_124663] = zt_res_124666;
                }
                if (memblock_set(ctx, &ext_mem_120003, &mem_120002, "mem_120002") != 0)
                    return 1;
                rescale_res_120004 = sqrt_res_124658;
                rescale_res_120005 = zp_res_124660;
            } else {
                if (memblock_set(ctx, &ext_mem_120003, &ext_mem_119927, "ext_mem_119927") != 0)
                    return 1;
                rescale_res_120004 = eta_p_119990;
                rescale_res_120005 = eta_p_119991;
            }
            ((double *) mem_112267.mem)[gtid_119989] = rescale_res_120004;
            ((double *) mem_112269.mem)[gtid_119989] = rescale_res_120005;
            lmad_copy_8b(ctx, 1, (uint64_t *) mem_112272.mem, gtid_119989 * m_33388, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_120003.mem, ext_120000, (int64_t []) {ext_120001}, (int64_t []) {m_33388});
        }
    }
    
  cleanup:
    {
        if (memblock_unref(ctx, &ext_mem_120003, "ext_mem_120003") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_120002, "mem_120002") != 0)
            return 1;
    }
    if (event_128425 != NULL) {
        event_128425->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128424", strdup("nothing further"), event_128425, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_task_128422(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128421 *futhark_mc_task_128421 = (struct futhark_mc_task_128421 *) args;
    struct futhark_context *ctx = futhark_mc_task_128421->ctx;
    struct mc_event *event_128427 = mc_event_new(ctx);
    
    if (event_128427 != NULL)
        event_128427->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128421->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_task_128421->free_exp_absorb_cutoff_33394;
    double zs_res_107134 = futhark_mc_task_128421->free_zs_res_107134;
    int64_t bytes_111715 = futhark_mc_task_128421->free_bytes_111715;
    struct memblock mem_112222 = {.desc ="mem_112222", .mem =futhark_mc_task_128421->free_mem_112222, .size =0, .references =NULL};
    struct memblock mem_112267 = {.desc ="mem_112267", .mem =futhark_mc_task_128421->free_mem_112267, .size =0, .references =NULL};
    struct memblock mem_112269 = {.desc ="mem_112269", .mem =futhark_mc_task_128421->free_mem_112269, .size =0, .references =NULL};
    struct memblock mem_112272 = {.desc ="mem_112272", .mem =futhark_mc_task_128421->free_mem_112272, .size =0, .references =NULL};
    struct memblock ext_mem_119522 = {.desc ="ext_mem_119522", .mem =futhark_mc_task_128421->free_ext_mem_119522, .size =0, .references =NULL};
    int64_t ext_119922 = futhark_mc_task_128421->free_ext_119922;
    int64_t ext_119923 = futhark_mc_task_128421->free_ext_119923;
    int64_t ext_119924 = futhark_mc_task_128421->free_ext_119924;
    struct memblock ext_mem_119927 = {.desc ="ext_mem_119927", .mem =futhark_mc_task_128421->free_ext_mem_119927, .size =0, .references =NULL};
    int32_t nsubtasks_124656;
    
    nsubtasks_124656 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_128423 futhark_mc_segmap_parloop_struct_128423_;
    
    futhark_mc_segmap_parloop_struct_128423_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_128423_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_128423_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segmap_parloop_struct_128423_.free_zs_res_107134 = zs_res_107134;
    futhark_mc_segmap_parloop_struct_128423_.free_bytes_111715 = bytes_111715;
    futhark_mc_segmap_parloop_struct_128423_.free_mem_112222 = mem_112222.mem;
    futhark_mc_segmap_parloop_struct_128423_.free_mem_112267 = mem_112267.mem;
    futhark_mc_segmap_parloop_struct_128423_.free_mem_112269 = mem_112269.mem;
    futhark_mc_segmap_parloop_struct_128423_.free_mem_112272 = mem_112272.mem;
    futhark_mc_segmap_parloop_struct_128423_.free_ext_mem_119522 = ext_mem_119522.mem;
    futhark_mc_segmap_parloop_struct_128423_.free_ext_119922 = ext_119922;
    futhark_mc_segmap_parloop_struct_128423_.free_ext_119923 = ext_119923;
    futhark_mc_segmap_parloop_struct_128423_.free_ext_119924 = ext_119924;
    futhark_mc_segmap_parloop_struct_128423_.free_ext_mem_119927 = ext_mem_119927.mem;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_128424_task;
    
    futhark_mc_segmap_parloop_128424_task.name = "futhark_mc_segmap_parloop_128424";
    futhark_mc_segmap_parloop_128424_task.fn = futhark_mc_segmap_parloop_128424;
    futhark_mc_segmap_parloop_128424_task.args = &futhark_mc_segmap_parloop_struct_128423_;
    futhark_mc_segmap_parloop_128424_task.iterations = iterations;
    futhark_mc_segmap_parloop_128424_task.info = info;
    
    struct mc_event *event_128426 = mc_event_new(ctx);
    
    if (event_128426 != NULL)
        event_128426->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_128424_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_128424_task);
    
    if (futhark_mc_segmap_parloop_128424_err != 0) {
        err = futhark_mc_segmap_parloop_128424_err;
        goto cleanup;
    }
    if (event_128426 != NULL) {
        event_128426->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128424_total", strdup("nothing further"), event_128426, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_128427 != NULL) {
        event_128427->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_task_128422", strdup("nothing further"), event_128427, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_128428 {
    struct futhark_context *ctx;
    unsigned char *free_ext_mem_119925;
    int64_t free_flat_tid_120020;
    bool *retval_defunc_0_reduce_res_120019;
};
struct futhark_mc_segred_stage_1_parloop_struct_128431 {
    struct futhark_context *ctx;
    unsigned char *free_ext_mem_119925;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124676;
};
static int futhark_mc_segred_stage_1_parloop_128432(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128431 *futhark_mc_segred_stage_1_parloop_struct_128431 = (struct futhark_mc_segred_stage_1_parloop_struct_128431 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128431->ctx;
    struct mc_event *event_128433 = mc_event_new(ctx);
    
    if (event_128433 != NULL)
        event_128433->bef = get_wall_time();
    
    struct memblock ext_mem_119925 = {.desc ="ext_mem_119925", .mem =futhark_mc_segred_stage_1_parloop_struct_128431->free_ext_mem_119925, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_124676 = {.desc ="reduce_stage_1_tid_res_arr_mem_124676", .mem =futhark_mc_segred_stage_1_parloop_struct_128431->free_reduce_stage_1_tid_res_arr_mem_124676, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_120020;
    
    flat_tid_120020 = subtask_id;
    {
        bool eta_p_124678;
        bool eta_p_124679;
        bool local_acc_124681 = 1;
        bool eta_p_120022;
        bool eta_p_120023;
        bool local_acc_124682 = 1;
        int64_t start_124683;
        int64_t end_124684;
        
        start_124683 = start;
        end_124684 = end;
        
        int64_t n_124685 = end_124684 - start_124683;
        
        for (int64_t SegRed_i_124686 = start_124683; SegRed_i_124686 < start_124683 + n_124685; SegRed_i_124686++) {
            int64_t gtid_120021 = SegRed_i_124686;
            double eta_p_120025 = ((double *) ext_mem_119925.mem)[gtid_120021];
            bool isnan_res_120026 = futrts_isnan64(eta_p_120025);
            bool not_res_120027 = !isnan_res_120026;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_120022 = local_acc_124682;
            }
            // Load next params
            {
                eta_p_120023 = not_res_120027;
            }
            // SegRed body
            {
                bool x_120024 = eta_p_120022 && eta_p_120023;
                
                local_acc_124682 = x_120024;
            }
        }
        
        int64_t uni_i_124687 = 0;
        
        {
            int64_t gtid_120021 = uni_i_124687;
            
            // Load accum params
            {
                eta_p_124678 = local_acc_124681;
            }
            // Load next params
            {
                eta_p_124679 = local_acc_124682;
            }
            // SegRed body
            {
                bool x_124680 = eta_p_124678 && eta_p_124679;
                
                local_acc_124681 = x_124680;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_124676.mem)[flat_tid_120020] = local_acc_124681;
    }
    
  cleanup:
    { }
    if (event_128433 != NULL) {
        event_128433->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128432", strdup("nothing further"), event_128433, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128429(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128428 *futhark_mc_task_128428 = (struct futhark_mc_task_128428 *) args;
    struct futhark_context *ctx = futhark_mc_task_128428->ctx;
    struct mc_event *event_128435 = mc_event_new(ctx);
    
    if (event_128435 != NULL)
        event_128435->bef = get_wall_time();
    
    struct memblock ext_mem_119925 = {.desc ="ext_mem_119925", .mem =futhark_mc_task_128428->free_ext_mem_119925, .size =0, .references =NULL};
    int64_t flat_tid_120020 = futhark_mc_task_128428->free_flat_tid_120020;
    bool defunc_0_reduce_res_120019 = *futhark_mc_task_128428->retval_defunc_0_reduce_res_120019;
    int64_t reduce_stage_1_tid_res_arr_mem_124676_cached_sizze_128430 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124676 = NULL;
    int32_t nsubtasks_124675;
    
    nsubtasks_124675 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124676_cached_sizze_128430 < nsubtasks_124675) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124676, &reduce_stage_1_tid_res_arr_mem_124676_cached_sizze_128430, nsubtasks_124675);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128431 futhark_mc_segred_stage_1_parloop_struct_128431_;
    
    futhark_mc_segred_stage_1_parloop_struct_128431_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128431_.free_ext_mem_119925 = ext_mem_119925.mem;
    futhark_mc_segred_stage_1_parloop_struct_128431_.free_reduce_stage_1_tid_res_arr_mem_124676 = reduce_stage_1_tid_res_arr_mem_124676;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128432_task;
    
    futhark_mc_segred_stage_1_parloop_128432_task.name = "futhark_mc_segred_stage_1_parloop_128432";
    futhark_mc_segred_stage_1_parloop_128432_task.fn = futhark_mc_segred_stage_1_parloop_128432;
    futhark_mc_segred_stage_1_parloop_128432_task.args = &futhark_mc_segred_stage_1_parloop_struct_128431_;
    futhark_mc_segred_stage_1_parloop_128432_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128432_task.info = info;
    
    struct mc_event *event_128434 = mc_event_new(ctx);
    
    if (event_128434 != NULL)
        event_128434->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128432_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128432_task);
    
    if (futhark_mc_segred_stage_1_parloop_128432_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128432_err;
        goto cleanup;
    }
    if (event_128434 != NULL) {
        event_128434->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128432_total", strdup("nothing further"), event_128434, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_120019 = 1;
    }
    
    bool eta_p_124688;
    bool eta_p_124689;
    
    for (int32_t i_124691 = 0; i_124691 < nsubtasks_124675; i_124691++) {
        flat_tid_120020 = i_124691;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124688 = defunc_0_reduce_res_120019;
            }
            // load next params
            {
                eta_p_124689 = ((bool *) reduce_stage_1_tid_res_arr_mem_124676)[flat_tid_120020];
            }
            // red body
            {
                bool x_124690 = eta_p_124688 && eta_p_124689;
                
                defunc_0_reduce_res_120019 = x_124690;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124676);
    }
    if (event_128435 != NULL) {
        event_128435->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128429", strdup("nothing further"), event_128435, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128428->retval_defunc_0_reduce_res_120019 = defunc_0_reduce_res_120019;
    }
    return err;
}
struct futhark_mc_task_128436 {
    struct futhark_context *ctx;
    double free_zp_res_108112;
    unsigned char *free_ext_mem_119520;
    unsigned char *free_ext_mem_119925;
    int64_t free_flat_tid_120029;
    bool *retval_defunc_0_reduce_comm_res_120028;
};
struct futhark_mc_segred_stage_1_parloop_struct_128439 {
    struct futhark_context *ctx;
    double free_zp_res_108112;
    unsigned char *free_ext_mem_119520;
    unsigned char *free_ext_mem_119925;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124693;
};
static int futhark_mc_segred_stage_1_parloop_128440(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128439 *futhark_mc_segred_stage_1_parloop_struct_128439 = (struct futhark_mc_segred_stage_1_parloop_struct_128439 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128439->ctx;
    struct mc_event *event_128441 = mc_event_new(ctx);
    
    if (event_128441 != NULL)
        event_128441->bef = get_wall_time();
    
    double zp_res_108112 = futhark_mc_segred_stage_1_parloop_struct_128439->free_zp_res_108112;
    struct memblock ext_mem_119520 = {.desc ="ext_mem_119520", .mem =futhark_mc_segred_stage_1_parloop_struct_128439->free_ext_mem_119520, .size =0, .references =NULL};
    struct memblock ext_mem_119925 = {.desc ="ext_mem_119925", .mem =futhark_mc_segred_stage_1_parloop_struct_128439->free_ext_mem_119925, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_124693 = {.desc ="reduce_stage_1_tid_res_arr_mem_124693", .mem =futhark_mc_segred_stage_1_parloop_struct_128439->free_reduce_stage_1_tid_res_arr_mem_124693, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_120029;
    
    flat_tid_120029 = subtask_id;
    {
        bool eta_p_124695;
        bool eta_p_124696;
        bool local_acc_124698 = 0;
        bool eta_p_120031;
        bool eta_p_120032;
        bool local_acc_124699 = 0;
        int64_t start_124700;
        int64_t end_124701;
        
        start_124700 = start;
        end_124701 = end;
        
        int64_t n_124702 = end_124701 - start_124700;
        
        for (int64_t SegRed_i_124703 = start_124700; SegRed_i_124703 < start_124700 + n_124702; SegRed_i_124703++) {
            int64_t gtid_120030 = SegRed_i_124703;
            double eta_p_120034 = ((double *) ext_mem_119925.mem)[gtid_120030];
            double eta_p_120035 = ((double *) ext_mem_119520.mem)[gtid_120030];
            double zt_res_120036 = zp_res_108112 * eta_p_120034;
            bool zgze_res_120037 = eta_p_120035 <= zt_res_120036;
            double zt_res_120038 = zp_res_108112 * eta_p_120035;
            bool zgze_res_120039 = eta_p_120034 <= zt_res_120038;
            bool x_120040 = zgze_res_120037 && zgze_res_120039;
            bool not_res_120041 = !x_120040;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_120031 = local_acc_124699;
            }
            // Load next params
            {
                eta_p_120032 = not_res_120041;
            }
            // SegRed body
            {
                bool defunc_0_op_res_120033 = eta_p_120031 || eta_p_120032;
                
                local_acc_124699 = defunc_0_op_res_120033;
            }
        }
        
        int64_t uni_i_124704 = 0;
        
        {
            int64_t gtid_120030 = uni_i_124704;
            
            // Load accum params
            {
                eta_p_124695 = local_acc_124698;
            }
            // Load next params
            {
                eta_p_124696 = local_acc_124699;
            }
            // SegRed body
            {
                bool defunc_0_op_res_124697 = eta_p_124695 || eta_p_124696;
                
                local_acc_124698 = defunc_0_op_res_124697;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_124693.mem)[flat_tid_120029] = local_acc_124698;
    }
    
  cleanup:
    { }
    if (event_128441 != NULL) {
        event_128441->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128440", strdup("nothing further"), event_128441, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128437(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128436 *futhark_mc_task_128436 = (struct futhark_mc_task_128436 *) args;
    struct futhark_context *ctx = futhark_mc_task_128436->ctx;
    struct mc_event *event_128443 = mc_event_new(ctx);
    
    if (event_128443 != NULL)
        event_128443->bef = get_wall_time();
    
    double zp_res_108112 = futhark_mc_task_128436->free_zp_res_108112;
    struct memblock ext_mem_119520 = {.desc ="ext_mem_119520", .mem =futhark_mc_task_128436->free_ext_mem_119520, .size =0, .references =NULL};
    struct memblock ext_mem_119925 = {.desc ="ext_mem_119925", .mem =futhark_mc_task_128436->free_ext_mem_119925, .size =0, .references =NULL};
    int64_t flat_tid_120029 = futhark_mc_task_128436->free_flat_tid_120029;
    bool defunc_0_reduce_comm_res_120028 = *futhark_mc_task_128436->retval_defunc_0_reduce_comm_res_120028;
    int64_t reduce_stage_1_tid_res_arr_mem_124693_cached_sizze_128438 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124693 = NULL;
    int32_t nsubtasks_124692;
    
    nsubtasks_124692 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124693_cached_sizze_128438 < nsubtasks_124692) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124693, &reduce_stage_1_tid_res_arr_mem_124693_cached_sizze_128438, nsubtasks_124692);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128439 futhark_mc_segred_stage_1_parloop_struct_128439_;
    
    futhark_mc_segred_stage_1_parloop_struct_128439_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128439_.free_zp_res_108112 = zp_res_108112;
    futhark_mc_segred_stage_1_parloop_struct_128439_.free_ext_mem_119520 = ext_mem_119520.mem;
    futhark_mc_segred_stage_1_parloop_struct_128439_.free_ext_mem_119925 = ext_mem_119925.mem;
    futhark_mc_segred_stage_1_parloop_struct_128439_.free_reduce_stage_1_tid_res_arr_mem_124693 = reduce_stage_1_tid_res_arr_mem_124693;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128440_task;
    
    futhark_mc_segred_stage_1_parloop_128440_task.name = "futhark_mc_segred_stage_1_parloop_128440";
    futhark_mc_segred_stage_1_parloop_128440_task.fn = futhark_mc_segred_stage_1_parloop_128440;
    futhark_mc_segred_stage_1_parloop_128440_task.args = &futhark_mc_segred_stage_1_parloop_struct_128439_;
    futhark_mc_segred_stage_1_parloop_128440_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128440_task.info = info;
    
    struct mc_event *event_128442 = mc_event_new(ctx);
    
    if (event_128442 != NULL)
        event_128442->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128440_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128440_task);
    
    if (futhark_mc_segred_stage_1_parloop_128440_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128440_err;
        goto cleanup;
    }
    if (event_128442 != NULL) {
        event_128442->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128440_total", strdup("nothing further"), event_128442, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_comm_res_120028 = 0;
    }
    
    bool eta_p_124705;
    bool eta_p_124706;
    
    for (int32_t i_124708 = 0; i_124708 < nsubtasks_124692; i_124708++) {
        flat_tid_120029 = i_124708;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124705 = defunc_0_reduce_comm_res_120028;
            }
            // load next params
            {
                eta_p_124706 = ((bool *) reduce_stage_1_tid_res_arr_mem_124693)[flat_tid_120029];
            }
            // red body
            {
                bool defunc_0_op_res_124707 = eta_p_124705 || eta_p_124706;
                
                defunc_0_reduce_comm_res_120028 = defunc_0_op_res_124707;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124693);
    }
    if (event_128443 != NULL) {
        event_128443->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128437", strdup("nothing further"), event_128443, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128436->retval_defunc_0_reduce_comm_res_120028 = defunc_0_reduce_comm_res_120028;
    }
    return err;
}
struct futhark_mc_task_128444 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_44883;
    double free_zs_res_44885;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_param_120057;
    unsigned char *free_mem_param_120058;
    unsigned char *free_mem_param_120061;
    int64_t free_ctx_param_ext_120062;
    int64_t free_ctx_param_ext_120063;
    int64_t free_ctx_param_ext_120064;
    int64_t free_flat_tid_120074;
    int64_t free_flat_tid_120096;
    bool *retval_defunc_0_reduce_res_120072;
    unsigned char *retval_mem_120071;
};
struct futhark_mc_segred_stage_1_parloop_struct_128447 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_44883;
    double free_zs_res_44885;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_param_120057;
    unsigned char *free_mem_param_120058;
    unsigned char *free_mem_param_120061;
    int64_t free_ctx_param_ext_120062;
    int64_t free_ctx_param_ext_120063;
    int64_t free_ctx_param_ext_120064;
    unsigned char *free_mem_120071;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124724;
};
static int futhark_mc_segred_stage_1_parloop_128448(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128447 *futhark_mc_segred_stage_1_parloop_struct_128447 = (struct futhark_mc_segred_stage_1_parloop_struct_128447 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128447->ctx;
    struct mc_event *event_128449 = mc_event_new(ctx);
    
    if (event_128449 != NULL)
        event_128449->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128447->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_segred_stage_1_parloop_struct_128447->free_exp_absorb_cutoff_33394;
    double zs_res_44883 = futhark_mc_segred_stage_1_parloop_struct_128447->free_zs_res_44883;
    double zs_res_44885 = futhark_mc_segred_stage_1_parloop_struct_128447->free_zs_res_44885;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128447->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_128447->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_120057 = {.desc ="mem_param_120057", .mem =futhark_mc_segred_stage_1_parloop_struct_128447->free_mem_param_120057, .size =0, .references =NULL};
    struct memblock mem_param_120058 = {.desc ="mem_param_120058", .mem =futhark_mc_segred_stage_1_parloop_struct_128447->free_mem_param_120058, .size =0, .references =NULL};
    struct memblock mem_param_120061 = {.desc ="mem_param_120061", .mem =futhark_mc_segred_stage_1_parloop_struct_128447->free_mem_param_120061, .size =0, .references =NULL};
    int64_t ctx_param_ext_120062 = futhark_mc_segred_stage_1_parloop_struct_128447->free_ctx_param_ext_120062;
    int64_t ctx_param_ext_120063 = futhark_mc_segred_stage_1_parloop_struct_128447->free_ctx_param_ext_120063;
    int64_t ctx_param_ext_120064 = futhark_mc_segred_stage_1_parloop_struct_128447->free_ctx_param_ext_120064;
    struct memblock mem_120071 = {.desc ="mem_120071", .mem =futhark_mc_segred_stage_1_parloop_struct_128447->free_mem_120071, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_124724 = {.desc ="reduce_stage_1_tid_res_arr_mem_124724", .mem =futhark_mc_segred_stage_1_parloop_struct_128447->free_reduce_stage_1_tid_res_arr_mem_124724, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_120096;
    
    flat_tid_120096 = subtask_id;
    {
        bool eta_p_124726;
        bool eta_p_124727;
        bool local_acc_124729 = 0;
        bool eta_p_120098;
        bool eta_p_120099;
        bool local_acc_124730 = 0;
        int64_t start_124731;
        int64_t end_124732;
        
        start_124731 = start;
        end_124732 = end;
        
        int64_t n_124733 = end_124732 - start_124731;
        
        for (int64_t SegRed_i_124734 = start_124731; SegRed_i_124734 < start_124731 + n_124733; SegRed_i_124734++) {
            int64_t gtid_120097 = SegRed_i_124734;
            double eta_p_120101 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + gtid_120097];
            double eta_p_120102 = ((double *) mem_param_120061.mem)[gtid_120097];
            double defunc_0_reduce_res_120103;
            double redout_120105 = 0.0;
            
            for (int64_t i_120104 = 0; i_120104 < m_33388; i_120104++) {
                double eta_p_120106 = ((double *) mem_param_120058.mem)[i_120104];
                double eta_p_120107 = ((double *) mem_param_120057.mem)[ctx_param_ext_120062 + (i_120104 * ctx_param_ext_120063 + gtid_120097 * ctx_param_ext_120064)];
                double zt_res_120108 = eta_p_120106 * eta_p_120107;
                double zp_res_120109 = zt_res_120108 + redout_120105;
                double redout_tmp_124735 = zp_res_120109;
                
                redout_120105 = redout_tmp_124735;
            }
            defunc_0_reduce_res_120103 = redout_120105;
            
            double zs_res_120110 = defunc_0_reduce_res_120103 / eta_p_120101;
            double ztzt_res_120111 = fpow64(zs_res_120110, zs_res_44883);
            double zt_res_120112 = zs_res_44885 * eta_p_120102;
            double exp_res_120113 = futrts_exp64(zt_res_120112);
            double zt_res_120114 = ztzt_res_120111 * exp_res_120113;
            bool zgze_res_120115 = exp_absorb_cutoff_33394 <= zt_res_120114;
            
            // save map-out results
            {
                ((double *) mem_120071.mem)[gtid_120097] = zt_res_120114;
            }
            // Load accum params
            {
                eta_p_120098 = local_acc_124730;
            }
            // Load next params
            {
                eta_p_120099 = zgze_res_120115;
            }
            // SegRed body
            {
                bool defunc_0_op_res_120100 = eta_p_120098 || eta_p_120099;
                
                local_acc_124730 = defunc_0_op_res_120100;
            }
        }
        
        int64_t uni_i_124736 = 0;
        
        {
            int64_t gtid_120097 = uni_i_124736;
            
            // Load accum params
            {
                eta_p_124726 = local_acc_124729;
            }
            // Load next params
            {
                eta_p_124727 = local_acc_124730;
            }
            // SegRed body
            {
                bool defunc_0_op_res_124728 = eta_p_124726 || eta_p_124727;
                
                local_acc_124729 = defunc_0_op_res_124728;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_124724.mem)[flat_tid_120096] = local_acc_124729;
    }
    
  cleanup:
    { }
    if (event_128449 != NULL) {
        event_128449->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128448", strdup("nothing further"), event_128449, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128445(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128444 *futhark_mc_task_128444 = (struct futhark_mc_task_128444 *) args;
    struct futhark_context *ctx = futhark_mc_task_128444->ctx;
    struct mc_event *event_128451 = mc_event_new(ctx);
    
    if (event_128451 != NULL)
        event_128451->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128444->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_task_128444->free_exp_absorb_cutoff_33394;
    double zs_res_44883 = futhark_mc_task_128444->free_zs_res_44883;
    double zs_res_44885 = futhark_mc_task_128444->free_zs_res_44885;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128444->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128444->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_120057 = {.desc ="mem_param_120057", .mem =futhark_mc_task_128444->free_mem_param_120057, .size =0, .references =NULL};
    struct memblock mem_param_120058 = {.desc ="mem_param_120058", .mem =futhark_mc_task_128444->free_mem_param_120058, .size =0, .references =NULL};
    struct memblock mem_param_120061 = {.desc ="mem_param_120061", .mem =futhark_mc_task_128444->free_mem_param_120061, .size =0, .references =NULL};
    int64_t ctx_param_ext_120062 = futhark_mc_task_128444->free_ctx_param_ext_120062;
    int64_t ctx_param_ext_120063 = futhark_mc_task_128444->free_ctx_param_ext_120063;
    int64_t ctx_param_ext_120064 = futhark_mc_task_128444->free_ctx_param_ext_120064;
    int64_t flat_tid_120074 = futhark_mc_task_128444->free_flat_tid_120074;
    int64_t flat_tid_120096 = futhark_mc_task_128444->free_flat_tid_120096;
    bool defunc_0_reduce_res_120072 = *futhark_mc_task_128444->retval_defunc_0_reduce_res_120072;
    struct memblock mem_120071 = {.desc ="mem_120071", .mem =futhark_mc_task_128444->retval_mem_120071, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_124724_cached_sizze_128446 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124724 = NULL;
    int32_t nsubtasks_124723;
    
    nsubtasks_124723 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124724_cached_sizze_128446 < nsubtasks_124723) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124724, &reduce_stage_1_tid_res_arr_mem_124724_cached_sizze_128446, nsubtasks_124723);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128447 futhark_mc_segred_stage_1_parloop_struct_128447_;
    
    futhark_mc_segred_stage_1_parloop_struct_128447_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128447_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128447_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segred_stage_1_parloop_struct_128447_.free_zs_res_44883 = zs_res_44883;
    futhark_mc_segred_stage_1_parloop_struct_128447_.free_zs_res_44885 = zs_res_44885;
    futhark_mc_segred_stage_1_parloop_struct_128447_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128447_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_128447_.free_mem_param_120057 = mem_param_120057.mem;
    futhark_mc_segred_stage_1_parloop_struct_128447_.free_mem_param_120058 = mem_param_120058.mem;
    futhark_mc_segred_stage_1_parloop_struct_128447_.free_mem_param_120061 = mem_param_120061.mem;
    futhark_mc_segred_stage_1_parloop_struct_128447_.free_ctx_param_ext_120062 = ctx_param_ext_120062;
    futhark_mc_segred_stage_1_parloop_struct_128447_.free_ctx_param_ext_120063 = ctx_param_ext_120063;
    futhark_mc_segred_stage_1_parloop_struct_128447_.free_ctx_param_ext_120064 = ctx_param_ext_120064;
    futhark_mc_segred_stage_1_parloop_struct_128447_.free_mem_120071 = mem_120071.mem;
    futhark_mc_segred_stage_1_parloop_struct_128447_.free_reduce_stage_1_tid_res_arr_mem_124724 = reduce_stage_1_tid_res_arr_mem_124724;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128448_task;
    
    futhark_mc_segred_stage_1_parloop_128448_task.name = "futhark_mc_segred_stage_1_parloop_128448";
    futhark_mc_segred_stage_1_parloop_128448_task.fn = futhark_mc_segred_stage_1_parloop_128448;
    futhark_mc_segred_stage_1_parloop_128448_task.args = &futhark_mc_segred_stage_1_parloop_struct_128447_;
    futhark_mc_segred_stage_1_parloop_128448_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128448_task.info = info;
    
    struct mc_event *event_128450 = mc_event_new(ctx);
    
    if (event_128450 != NULL)
        event_128450->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128448_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128448_task);
    
    if (futhark_mc_segred_stage_1_parloop_128448_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128448_err;
        goto cleanup;
    }
    if (event_128450 != NULL) {
        event_128450->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128448_total", strdup("nothing further"), event_128450, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_120072 = 0;
    }
    
    bool eta_p_124737;
    bool eta_p_124738;
    
    for (int32_t i_124740 = 0; i_124740 < nsubtasks_124723; i_124740++) {
        flat_tid_120096 = i_124740;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124737 = defunc_0_reduce_res_120072;
            }
            // load next params
            {
                eta_p_124738 = ((bool *) reduce_stage_1_tid_res_arr_mem_124724)[flat_tid_120096];
            }
            // red body
            {
                bool defunc_0_op_res_124739 = eta_p_124737 || eta_p_124738;
                
                defunc_0_reduce_res_120072 = defunc_0_op_res_124739;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124724);
    }
    if (event_128451 != NULL) {
        event_128451->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128445", strdup("nothing further"), event_128451, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128444->retval_defunc_0_reduce_res_120072 = defunc_0_reduce_res_120072;
        futhark_mc_task_128444->retval_mem_120071 = mem_120071.mem;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_128454 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_44883;
    double free_zs_res_44885;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_param_120057;
    unsigned char *free_mem_param_120058;
    unsigned char *free_mem_param_120061;
    int64_t free_ctx_param_ext_120062;
    int64_t free_ctx_param_ext_120063;
    int64_t free_ctx_param_ext_120064;
    unsigned char *free_mem_120071;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124742;
};
struct futhark_mc_task_128456 {
    struct futhark_context *ctx;
    unsigned char *free_mem_param_120057;
    unsigned char *free_mem_param_120058;
    int64_t free_ctx_param_ext_120062;
    int64_t free_ctx_param_ext_120063;
    int64_t free_ctx_param_ext_120064;
    int64_t free_gtid_120075;
    int64_t free_flat_tid_120082;
    double *retval_defunc_0_reduce_res_120081;
};
struct futhark_mc_segred_stage_1_parloop_struct_128459 {
    struct futhark_context *ctx;
    unsigned char *free_mem_param_120057;
    unsigned char *free_mem_param_120058;
    int64_t free_ctx_param_ext_120062;
    int64_t free_ctx_param_ext_120063;
    int64_t free_ctx_param_ext_120064;
    int64_t free_gtid_120075;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124754;
};
static int futhark_mc_segred_stage_1_parloop_128460(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128459 *futhark_mc_segred_stage_1_parloop_struct_128459 = (struct futhark_mc_segred_stage_1_parloop_struct_128459 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128459->ctx;
    struct mc_event *event_128461 = mc_event_new(ctx);
    
    if (event_128461 != NULL)
        event_128461->bef = get_wall_time();
    
    struct memblock mem_param_120057 = {.desc ="mem_param_120057", .mem =futhark_mc_segred_stage_1_parloop_struct_128459->free_mem_param_120057, .size =0, .references =NULL};
    struct memblock mem_param_120058 = {.desc ="mem_param_120058", .mem =futhark_mc_segred_stage_1_parloop_struct_128459->free_mem_param_120058, .size =0, .references =NULL};
    int64_t ctx_param_ext_120062 = futhark_mc_segred_stage_1_parloop_struct_128459->free_ctx_param_ext_120062;
    int64_t ctx_param_ext_120063 = futhark_mc_segred_stage_1_parloop_struct_128459->free_ctx_param_ext_120063;
    int64_t ctx_param_ext_120064 = futhark_mc_segred_stage_1_parloop_struct_128459->free_ctx_param_ext_120064;
    int64_t gtid_120075 = futhark_mc_segred_stage_1_parloop_struct_128459->free_gtid_120075;
    struct memblock reduce_stage_1_tid_res_arr_mem_124754 = {.desc ="reduce_stage_1_tid_res_arr_mem_124754", .mem =futhark_mc_segred_stage_1_parloop_struct_128459->free_reduce_stage_1_tid_res_arr_mem_124754, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_120082;
    
    flat_tid_120082 = subtask_id;
    {
        double eta_p_124756;
        double eta_p_124757;
        double local_acc_124759 = 0.0;
        double eta_p_120084;
        double eta_p_120085;
        double local_acc_124760 = 0.0;
        int64_t start_124761;
        int64_t end_124762;
        
        start_124761 = start;
        end_124762 = end;
        
        int64_t n_124763 = end_124762 - start_124761;
        
        for (int64_t SegRed_i_124764 = start_124761; SegRed_i_124764 < start_124761 + n_124763; SegRed_i_124764++) {
            int64_t gtid_120083 = SegRed_i_124764;
            double eta_p_120087 = ((double *) mem_param_120058.mem)[gtid_120083];
            double eta_p_120088 = ((double *) mem_param_120057.mem)[ctx_param_ext_120062 + (gtid_120083 * ctx_param_ext_120063 + gtid_120075 * ctx_param_ext_120064)];
            double zt_res_120089 = eta_p_120087 * eta_p_120088;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_120084 = local_acc_124760;
            }
            // Load next params
            {
                eta_p_120085 = zt_res_120089;
            }
            // SegRed body
            {
                double zp_res_120086 = eta_p_120084 + eta_p_120085;
                
                local_acc_124760 = zp_res_120086;
            }
        }
        
        int64_t uni_i_124765 = 0;
        
        {
            int64_t gtid_120083 = uni_i_124765;
            
            // Load accum params
            {
                eta_p_124756 = local_acc_124759;
            }
            // Load next params
            {
                eta_p_124757 = local_acc_124760;
            }
            // SegRed body
            {
                double zp_res_124758 = eta_p_124756 + eta_p_124757;
                
                local_acc_124759 = zp_res_124758;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_124754.mem)[flat_tid_120082] = local_acc_124759;
    }
    
  cleanup:
    { }
    if (event_128461 != NULL) {
        event_128461->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128460", strdup("nothing further"), event_128461, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128457(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128456 *futhark_mc_task_128456 = (struct futhark_mc_task_128456 *) args;
    struct futhark_context *ctx = futhark_mc_task_128456->ctx;
    struct mc_event *event_128463 = mc_event_new(ctx);
    
    if (event_128463 != NULL)
        event_128463->bef = get_wall_time();
    
    struct memblock mem_param_120057 = {.desc ="mem_param_120057", .mem =futhark_mc_task_128456->free_mem_param_120057, .size =0, .references =NULL};
    struct memblock mem_param_120058 = {.desc ="mem_param_120058", .mem =futhark_mc_task_128456->free_mem_param_120058, .size =0, .references =NULL};
    int64_t ctx_param_ext_120062 = futhark_mc_task_128456->free_ctx_param_ext_120062;
    int64_t ctx_param_ext_120063 = futhark_mc_task_128456->free_ctx_param_ext_120063;
    int64_t ctx_param_ext_120064 = futhark_mc_task_128456->free_ctx_param_ext_120064;
    int64_t gtid_120075 = futhark_mc_task_128456->free_gtid_120075;
    int64_t flat_tid_120082 = futhark_mc_task_128456->free_flat_tid_120082;
    double defunc_0_reduce_res_120081 = *futhark_mc_task_128456->retval_defunc_0_reduce_res_120081;
    int64_t reduce_stage_1_tid_res_arr_mem_124754_cached_sizze_128458 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124754 = NULL;
    int32_t nsubtasks_124753;
    
    nsubtasks_124753 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124754_cached_sizze_128458 < (int64_t) 8 * nsubtasks_124753) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124754, &reduce_stage_1_tid_res_arr_mem_124754_cached_sizze_128458, (int64_t) 8 * nsubtasks_124753);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128459 futhark_mc_segred_stage_1_parloop_struct_128459_;
    
    futhark_mc_segred_stage_1_parloop_struct_128459_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128459_.free_mem_param_120057 = mem_param_120057.mem;
    futhark_mc_segred_stage_1_parloop_struct_128459_.free_mem_param_120058 = mem_param_120058.mem;
    futhark_mc_segred_stage_1_parloop_struct_128459_.free_ctx_param_ext_120062 = ctx_param_ext_120062;
    futhark_mc_segred_stage_1_parloop_struct_128459_.free_ctx_param_ext_120063 = ctx_param_ext_120063;
    futhark_mc_segred_stage_1_parloop_struct_128459_.free_ctx_param_ext_120064 = ctx_param_ext_120064;
    futhark_mc_segred_stage_1_parloop_struct_128459_.free_gtid_120075 = gtid_120075;
    futhark_mc_segred_stage_1_parloop_struct_128459_.free_reduce_stage_1_tid_res_arr_mem_124754 = reduce_stage_1_tid_res_arr_mem_124754;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128460_task;
    
    futhark_mc_segred_stage_1_parloop_128460_task.name = "futhark_mc_segred_stage_1_parloop_128460";
    futhark_mc_segred_stage_1_parloop_128460_task.fn = futhark_mc_segred_stage_1_parloop_128460;
    futhark_mc_segred_stage_1_parloop_128460_task.args = &futhark_mc_segred_stage_1_parloop_struct_128459_;
    futhark_mc_segred_stage_1_parloop_128460_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128460_task.info = info;
    
    struct mc_event *event_128462 = mc_event_new(ctx);
    
    if (event_128462 != NULL)
        event_128462->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128460_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128460_task);
    
    if (futhark_mc_segred_stage_1_parloop_128460_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128460_err;
        goto cleanup;
    }
    if (event_128462 != NULL) {
        event_128462->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128460_total", strdup("nothing further"), event_128462, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_120081 = 0.0;
    }
    
    double eta_p_124766;
    double eta_p_124767;
    
    for (int32_t i_124769 = 0; i_124769 < nsubtasks_124753; i_124769++) {
        flat_tid_120082 = i_124769;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124766 = defunc_0_reduce_res_120081;
            }
            // load next params
            {
                eta_p_124767 = ((double *) reduce_stage_1_tid_res_arr_mem_124754)[flat_tid_120082];
            }
            // red body
            {
                double zp_res_124768 = eta_p_124766 + eta_p_124767;
                
                defunc_0_reduce_res_120081 = zp_res_124768;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124754);
    }
    if (event_128463 != NULL) {
        event_128463->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128457", strdup("nothing further"), event_128463, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128456->retval_defunc_0_reduce_res_120081 = defunc_0_reduce_res_120081;
    }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_128455(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128454 *futhark_mc_segred_stage_1_parloop_struct_128454 = (struct futhark_mc_segred_stage_1_parloop_struct_128454 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128454->ctx;
    struct mc_event *event_128464 = mc_event_new(ctx);
    
    if (event_128464 != NULL)
        event_128464->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128454->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_segred_stage_1_parloop_struct_128454->free_exp_absorb_cutoff_33394;
    double zs_res_44883 = futhark_mc_segred_stage_1_parloop_struct_128454->free_zs_res_44883;
    double zs_res_44885 = futhark_mc_segred_stage_1_parloop_struct_128454->free_zs_res_44885;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128454->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_128454->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_120057 = {.desc ="mem_param_120057", .mem =futhark_mc_segred_stage_1_parloop_struct_128454->free_mem_param_120057, .size =0, .references =NULL};
    struct memblock mem_param_120058 = {.desc ="mem_param_120058", .mem =futhark_mc_segred_stage_1_parloop_struct_128454->free_mem_param_120058, .size =0, .references =NULL};
    struct memblock mem_param_120061 = {.desc ="mem_param_120061", .mem =futhark_mc_segred_stage_1_parloop_struct_128454->free_mem_param_120061, .size =0, .references =NULL};
    int64_t ctx_param_ext_120062 = futhark_mc_segred_stage_1_parloop_struct_128454->free_ctx_param_ext_120062;
    int64_t ctx_param_ext_120063 = futhark_mc_segred_stage_1_parloop_struct_128454->free_ctx_param_ext_120063;
    int64_t ctx_param_ext_120064 = futhark_mc_segred_stage_1_parloop_struct_128454->free_ctx_param_ext_120064;
    struct memblock mem_120071 = {.desc ="mem_120071", .mem =futhark_mc_segred_stage_1_parloop_struct_128454->free_mem_120071, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_124742 = {.desc ="reduce_stage_1_tid_res_arr_mem_124742", .mem =futhark_mc_segred_stage_1_parloop_struct_128454->free_reduce_stage_1_tid_res_arr_mem_124742, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_120074;
    
    flat_tid_120074 = subtask_id;
    {
        bool eta_p_124744;
        bool eta_p_124745;
        bool local_acc_124747 = 0;
        bool eta_p_120076;
        bool eta_p_120077;
        bool local_acc_124748 = 0;
        int64_t start_124749;
        int64_t end_124750;
        
        start_124749 = start;
        end_124750 = end;
        
        int64_t n_124751 = end_124750 - start_124749;
        
        for (int64_t SegRed_i_124752 = start_124749; SegRed_i_124752 < start_124749 + n_124751; SegRed_i_124752++) {
            int64_t gtid_120075 = SegRed_i_124752;
            double eta_p_120079 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + gtid_120075];
            double eta_p_120080 = ((double *) mem_param_120061.mem)[gtid_120075];
            double defunc_0_reduce_res_120081;
            int64_t flat_tid_120082 = (int64_t) 0;
            
            defunc_0_reduce_res_120081 = 0.0;
            
            struct futhark_mc_task_128456 futhark_mc_task_128456_;
            
            futhark_mc_task_128456_.ctx = ctx;
            futhark_mc_task_128456_.free_mem_param_120057 = mem_param_120057.mem;
            futhark_mc_task_128456_.free_mem_param_120058 = mem_param_120058.mem;
            futhark_mc_task_128456_.free_ctx_param_ext_120062 = ctx_param_ext_120062;
            futhark_mc_task_128456_.free_ctx_param_ext_120063 = ctx_param_ext_120063;
            futhark_mc_task_128456_.free_ctx_param_ext_120064 = ctx_param_ext_120064;
            futhark_mc_task_128456_.free_gtid_120075 = gtid_120075;
            futhark_mc_task_128456_.free_flat_tid_120082 = flat_tid_120082;
            futhark_mc_task_128456_.retval_defunc_0_reduce_res_120081 = (double *) &defunc_0_reduce_res_120081;
            #if ISPC
            futhark_mc_task_128456_.retval_defunc_0_reduce_res_120081 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_128456_task;
            
            futhark_mc_task_128456_task.args = &futhark_mc_task_128456_;
            futhark_mc_task_128456_task.top_level_fn = futhark_mc_segred_task_128457;
            futhark_mc_task_128456_task.name = "futhark_mc_segred_task_128457";
            futhark_mc_task_128456_task.iterations = m_33388;
            futhark_mc_task_128456_task.task_time = &ctx->program->futhark_mc_segred_task_128457_total_time;
            futhark_mc_task_128456_task.task_iter = &ctx->program->futhark_mc_segred_task_128457_total_iter;
            futhark_mc_task_128456_task.sched = STATIC;
            futhark_mc_task_128456_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_128457_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128456_task);
            
            if (futhark_mc_segred_task_128457_err != 0) {
                err = futhark_mc_segred_task_128457_err;
                goto cleanup;
            }
            
            double zs_res_120090 = defunc_0_reduce_res_120081 / eta_p_120079;
            double ztzt_res_120091 = fpow64(zs_res_120090, zs_res_44883);
            double zt_res_120092 = zs_res_44885 * eta_p_120080;
            double exp_res_120093 = futrts_exp64(zt_res_120092);
            double zt_res_120094 = ztzt_res_120091 * exp_res_120093;
            bool zgze_res_120095 = exp_absorb_cutoff_33394 <= zt_res_120094;
            
            // save map-out results
            {
                ((double *) mem_120071.mem)[gtid_120075] = zt_res_120094;
            }
            // Load accum params
            {
                eta_p_120076 = local_acc_124748;
            }
            // Load next params
            {
                eta_p_120077 = zgze_res_120095;
            }
            // SegRed body
            {
                bool defunc_0_op_res_120078 = eta_p_120076 || eta_p_120077;
                
                local_acc_124748 = defunc_0_op_res_120078;
            }
        }
        
        int64_t uni_i_124770 = 0;
        
        {
            int64_t gtid_120075 = uni_i_124770;
            
            // Load accum params
            {
                eta_p_124744 = local_acc_124747;
            }
            // Load next params
            {
                eta_p_124745 = local_acc_124748;
            }
            // SegRed body
            {
                bool defunc_0_op_res_124746 = eta_p_124744 || eta_p_124745;
                
                local_acc_124747 = defunc_0_op_res_124746;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_124742.mem)[flat_tid_120074] = local_acc_124747;
    }
    
  cleanup:
    { }
    if (event_128464 != NULL) {
        event_128464->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128455", strdup("nothing further"), event_128464, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_128452(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128444 *futhark_mc_task_128444 = (struct futhark_mc_task_128444 *) args;
    struct futhark_context *ctx = futhark_mc_task_128444->ctx;
    struct mc_event *event_128466 = mc_event_new(ctx);
    
    if (event_128466 != NULL)
        event_128466->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128444->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_task_128444->free_exp_absorb_cutoff_33394;
    double zs_res_44883 = futhark_mc_task_128444->free_zs_res_44883;
    double zs_res_44885 = futhark_mc_task_128444->free_zs_res_44885;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128444->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128444->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_120057 = {.desc ="mem_param_120057", .mem =futhark_mc_task_128444->free_mem_param_120057, .size =0, .references =NULL};
    struct memblock mem_param_120058 = {.desc ="mem_param_120058", .mem =futhark_mc_task_128444->free_mem_param_120058, .size =0, .references =NULL};
    struct memblock mem_param_120061 = {.desc ="mem_param_120061", .mem =futhark_mc_task_128444->free_mem_param_120061, .size =0, .references =NULL};
    int64_t ctx_param_ext_120062 = futhark_mc_task_128444->free_ctx_param_ext_120062;
    int64_t ctx_param_ext_120063 = futhark_mc_task_128444->free_ctx_param_ext_120063;
    int64_t ctx_param_ext_120064 = futhark_mc_task_128444->free_ctx_param_ext_120064;
    int64_t flat_tid_120074 = futhark_mc_task_128444->free_flat_tid_120074;
    int64_t flat_tid_120096 = futhark_mc_task_128444->free_flat_tid_120096;
    bool defunc_0_reduce_res_120072 = *futhark_mc_task_128444->retval_defunc_0_reduce_res_120072;
    struct memblock mem_120071 = {.desc ="mem_120071", .mem =futhark_mc_task_128444->retval_mem_120071, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_124742_cached_sizze_128453 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124742 = NULL;
    int32_t nsubtasks_124741;
    
    nsubtasks_124741 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124742_cached_sizze_128453 < nsubtasks_124741) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124742, &reduce_stage_1_tid_res_arr_mem_124742_cached_sizze_128453, nsubtasks_124741);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128454 futhark_mc_segred_stage_1_parloop_struct_128454_;
    
    futhark_mc_segred_stage_1_parloop_struct_128454_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128454_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128454_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segred_stage_1_parloop_struct_128454_.free_zs_res_44883 = zs_res_44883;
    futhark_mc_segred_stage_1_parloop_struct_128454_.free_zs_res_44885 = zs_res_44885;
    futhark_mc_segred_stage_1_parloop_struct_128454_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128454_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_128454_.free_mem_param_120057 = mem_param_120057.mem;
    futhark_mc_segred_stage_1_parloop_struct_128454_.free_mem_param_120058 = mem_param_120058.mem;
    futhark_mc_segred_stage_1_parloop_struct_128454_.free_mem_param_120061 = mem_param_120061.mem;
    futhark_mc_segred_stage_1_parloop_struct_128454_.free_ctx_param_ext_120062 = ctx_param_ext_120062;
    futhark_mc_segred_stage_1_parloop_struct_128454_.free_ctx_param_ext_120063 = ctx_param_ext_120063;
    futhark_mc_segred_stage_1_parloop_struct_128454_.free_ctx_param_ext_120064 = ctx_param_ext_120064;
    futhark_mc_segred_stage_1_parloop_struct_128454_.free_mem_120071 = mem_120071.mem;
    futhark_mc_segred_stage_1_parloop_struct_128454_.free_reduce_stage_1_tid_res_arr_mem_124742 = reduce_stage_1_tid_res_arr_mem_124742;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128455_task;
    
    futhark_mc_segred_stage_1_parloop_128455_task.name = "futhark_mc_segred_stage_1_parloop_128455";
    futhark_mc_segred_stage_1_parloop_128455_task.fn = futhark_mc_segred_stage_1_parloop_128455;
    futhark_mc_segred_stage_1_parloop_128455_task.args = &futhark_mc_segred_stage_1_parloop_struct_128454_;
    futhark_mc_segred_stage_1_parloop_128455_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128455_task.info = info;
    
    struct mc_event *event_128465 = mc_event_new(ctx);
    
    if (event_128465 != NULL)
        event_128465->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128455_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128455_task);
    
    if (futhark_mc_segred_stage_1_parloop_128455_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128455_err;
        goto cleanup;
    }
    if (event_128465 != NULL) {
        event_128465->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128455_total", strdup("nothing further"), event_128465, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_120072 = 0;
    }
    
    bool eta_p_124771;
    bool eta_p_124772;
    
    for (int32_t i_124774 = 0; i_124774 < nsubtasks_124741; i_124774++) {
        flat_tid_120074 = i_124774;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124771 = defunc_0_reduce_res_120072;
            }
            // load next params
            {
                eta_p_124772 = ((bool *) reduce_stage_1_tid_res_arr_mem_124742)[flat_tid_120074];
            }
            // red body
            {
                bool defunc_0_op_res_124773 = eta_p_124771 || eta_p_124772;
                
                defunc_0_reduce_res_120072 = defunc_0_op_res_124773;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124742);
    }
    if (event_128466 != NULL) {
        event_128466->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_128452", strdup("nothing further"), event_128466, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128444->retval_defunc_0_reduce_res_120072 = defunc_0_reduce_res_120072;
        futhark_mc_task_128444->retval_mem_120071 = mem_120071.mem;
    }
    return err;
}
struct futhark_mc_task_128467 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_44842;
    double free_zs_res_44844;
    int64_t free_eta_p_106382;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_param_120057;
    unsigned char *free_mem_param_120060;
    int64_t free_ctx_param_ext_120062;
    int64_t free_ctx_param_ext_120063;
    int64_t free_ctx_param_ext_120064;
    unsigned char *free_mem_120071;
    int64_t free_flat_tid_120119;
    int64_t free_flat_tid_120141;
    bool *retval_defunc_0_reduce_res_120117;
    unsigned char *retval_mem_120116;
};
struct futhark_mc_segred_stage_1_parloop_struct_128470 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_44842;
    double free_zs_res_44844;
    int64_t free_eta_p_106382;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_param_120057;
    unsigned char *free_mem_param_120060;
    int64_t free_ctx_param_ext_120062;
    int64_t free_ctx_param_ext_120063;
    int64_t free_ctx_param_ext_120064;
    unsigned char *free_mem_120071;
    unsigned char *free_mem_120116;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124776;
};
static int futhark_mc_segred_stage_1_parloop_128471(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128470 *futhark_mc_segred_stage_1_parloop_struct_128470 = (struct futhark_mc_segred_stage_1_parloop_struct_128470 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128470->ctx;
    struct mc_event *event_128472 = mc_event_new(ctx);
    
    if (event_128472 != NULL)
        event_128472->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128470->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_segred_stage_1_parloop_struct_128470->free_exp_absorb_cutoff_33394;
    double zs_res_44842 = futhark_mc_segred_stage_1_parloop_struct_128470->free_zs_res_44842;
    double zs_res_44844 = futhark_mc_segred_stage_1_parloop_struct_128470->free_zs_res_44844;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_128470->free_eta_p_106382;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_128470->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_120057 = {.desc ="mem_param_120057", .mem =futhark_mc_segred_stage_1_parloop_struct_128470->free_mem_param_120057, .size =0, .references =NULL};
    struct memblock mem_param_120060 = {.desc ="mem_param_120060", .mem =futhark_mc_segred_stage_1_parloop_struct_128470->free_mem_param_120060, .size =0, .references =NULL};
    int64_t ctx_param_ext_120062 = futhark_mc_segred_stage_1_parloop_struct_128470->free_ctx_param_ext_120062;
    int64_t ctx_param_ext_120063 = futhark_mc_segred_stage_1_parloop_struct_128470->free_ctx_param_ext_120063;
    int64_t ctx_param_ext_120064 = futhark_mc_segred_stage_1_parloop_struct_128470->free_ctx_param_ext_120064;
    struct memblock mem_120071 = {.desc ="mem_120071", .mem =futhark_mc_segred_stage_1_parloop_struct_128470->free_mem_120071, .size =0, .references =NULL};
    struct memblock mem_120116 = {.desc ="mem_120116", .mem =futhark_mc_segred_stage_1_parloop_struct_128470->free_mem_120116, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_124776 = {.desc ="reduce_stage_1_tid_res_arr_mem_124776", .mem =futhark_mc_segred_stage_1_parloop_struct_128470->free_reduce_stage_1_tid_res_arr_mem_124776, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_120141;
    
    flat_tid_120141 = subtask_id;
    {
        bool eta_p_124778;
        bool eta_p_124779;
        bool local_acc_124781 = 0;
        bool eta_p_120143;
        bool eta_p_120144;
        bool local_acc_124782 = 0;
        int64_t start_124783;
        int64_t end_124784;
        
        start_124783 = start;
        end_124784 = end;
        
        int64_t n_124785 = end_124784 - start_124783;
        
        for (int64_t SegRed_i_124786 = start_124783; SegRed_i_124786 < start_124783 + n_124785; SegRed_i_124786++) {
            int64_t gtid_120142 = SegRed_i_124786;
            double eta_p_120146 = ((double *) distrs_mem_111708.mem)[eta_p_106382 * m_33388 + gtid_120142];
            double eta_p_120147 = ((double *) mem_param_120060.mem)[gtid_120142];
            double defunc_0_reduce_res_120148;
            double redout_120150 = 0.0;
            
            for (int64_t i_120149 = 0; i_120149 < m_33388; i_120149++) {
                double eta_p_120151 = ((double *) mem_120071.mem)[i_120149];
                double eta_p_120152 = ((double *) mem_param_120057.mem)[ctx_param_ext_120062 + (gtid_120142 * ctx_param_ext_120063 + i_120149 * ctx_param_ext_120064)];
                double zt_res_120153 = eta_p_120151 * eta_p_120152;
                double zp_res_120154 = zt_res_120153 + redout_120150;
                double redout_tmp_124787 = zp_res_120154;
                
                redout_120150 = redout_tmp_124787;
            }
            defunc_0_reduce_res_120148 = redout_120150;
            
            double zs_res_120155 = defunc_0_reduce_res_120148 / eta_p_120146;
            double ztzt_res_120156 = fpow64(zs_res_120155, zs_res_44842);
            double zt_res_120157 = zs_res_44844 * eta_p_120147;
            double exp_res_120158 = futrts_exp64(zt_res_120157);
            double zt_res_120159 = ztzt_res_120156 * exp_res_120158;
            bool zgze_res_120160 = exp_absorb_cutoff_33394 <= zt_res_120159;
            
            // save map-out results
            {
                ((double *) mem_120116.mem)[gtid_120142] = zt_res_120159;
            }
            // Load accum params
            {
                eta_p_120143 = local_acc_124782;
            }
            // Load next params
            {
                eta_p_120144 = zgze_res_120160;
            }
            // SegRed body
            {
                bool defunc_0_op_res_120145 = eta_p_120143 || eta_p_120144;
                
                local_acc_124782 = defunc_0_op_res_120145;
            }
        }
        
        int64_t uni_i_124788 = 0;
        
        {
            int64_t gtid_120142 = uni_i_124788;
            
            // Load accum params
            {
                eta_p_124778 = local_acc_124781;
            }
            // Load next params
            {
                eta_p_124779 = local_acc_124782;
            }
            // SegRed body
            {
                bool defunc_0_op_res_124780 = eta_p_124778 || eta_p_124779;
                
                local_acc_124781 = defunc_0_op_res_124780;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_124776.mem)[flat_tid_120141] = local_acc_124781;
    }
    
  cleanup:
    { }
    if (event_128472 != NULL) {
        event_128472->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128471", strdup("nothing further"), event_128472, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128468(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128467 *futhark_mc_task_128467 = (struct futhark_mc_task_128467 *) args;
    struct futhark_context *ctx = futhark_mc_task_128467->ctx;
    struct mc_event *event_128474 = mc_event_new(ctx);
    
    if (event_128474 != NULL)
        event_128474->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128467->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_task_128467->free_exp_absorb_cutoff_33394;
    double zs_res_44842 = futhark_mc_task_128467->free_zs_res_44842;
    double zs_res_44844 = futhark_mc_task_128467->free_zs_res_44844;
    int64_t eta_p_106382 = futhark_mc_task_128467->free_eta_p_106382;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128467->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_120057 = {.desc ="mem_param_120057", .mem =futhark_mc_task_128467->free_mem_param_120057, .size =0, .references =NULL};
    struct memblock mem_param_120060 = {.desc ="mem_param_120060", .mem =futhark_mc_task_128467->free_mem_param_120060, .size =0, .references =NULL};
    int64_t ctx_param_ext_120062 = futhark_mc_task_128467->free_ctx_param_ext_120062;
    int64_t ctx_param_ext_120063 = futhark_mc_task_128467->free_ctx_param_ext_120063;
    int64_t ctx_param_ext_120064 = futhark_mc_task_128467->free_ctx_param_ext_120064;
    struct memblock mem_120071 = {.desc ="mem_120071", .mem =futhark_mc_task_128467->free_mem_120071, .size =0, .references =NULL};
    int64_t flat_tid_120119 = futhark_mc_task_128467->free_flat_tid_120119;
    int64_t flat_tid_120141 = futhark_mc_task_128467->free_flat_tid_120141;
    bool defunc_0_reduce_res_120117 = *futhark_mc_task_128467->retval_defunc_0_reduce_res_120117;
    struct memblock mem_120116 = {.desc ="mem_120116", .mem =futhark_mc_task_128467->retval_mem_120116, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_124776_cached_sizze_128469 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124776 = NULL;
    int32_t nsubtasks_124775;
    
    nsubtasks_124775 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124776_cached_sizze_128469 < nsubtasks_124775) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124776, &reduce_stage_1_tid_res_arr_mem_124776_cached_sizze_128469, nsubtasks_124775);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128470 futhark_mc_segred_stage_1_parloop_struct_128470_;
    
    futhark_mc_segred_stage_1_parloop_struct_128470_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128470_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128470_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segred_stage_1_parloop_struct_128470_.free_zs_res_44842 = zs_res_44842;
    futhark_mc_segred_stage_1_parloop_struct_128470_.free_zs_res_44844 = zs_res_44844;
    futhark_mc_segred_stage_1_parloop_struct_128470_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_128470_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_128470_.free_mem_param_120057 = mem_param_120057.mem;
    futhark_mc_segred_stage_1_parloop_struct_128470_.free_mem_param_120060 = mem_param_120060.mem;
    futhark_mc_segred_stage_1_parloop_struct_128470_.free_ctx_param_ext_120062 = ctx_param_ext_120062;
    futhark_mc_segred_stage_1_parloop_struct_128470_.free_ctx_param_ext_120063 = ctx_param_ext_120063;
    futhark_mc_segred_stage_1_parloop_struct_128470_.free_ctx_param_ext_120064 = ctx_param_ext_120064;
    futhark_mc_segred_stage_1_parloop_struct_128470_.free_mem_120071 = mem_120071.mem;
    futhark_mc_segred_stage_1_parloop_struct_128470_.free_mem_120116 = mem_120116.mem;
    futhark_mc_segred_stage_1_parloop_struct_128470_.free_reduce_stage_1_tid_res_arr_mem_124776 = reduce_stage_1_tid_res_arr_mem_124776;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128471_task;
    
    futhark_mc_segred_stage_1_parloop_128471_task.name = "futhark_mc_segred_stage_1_parloop_128471";
    futhark_mc_segred_stage_1_parloop_128471_task.fn = futhark_mc_segred_stage_1_parloop_128471;
    futhark_mc_segred_stage_1_parloop_128471_task.args = &futhark_mc_segred_stage_1_parloop_struct_128470_;
    futhark_mc_segred_stage_1_parloop_128471_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128471_task.info = info;
    
    struct mc_event *event_128473 = mc_event_new(ctx);
    
    if (event_128473 != NULL)
        event_128473->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128471_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128471_task);
    
    if (futhark_mc_segred_stage_1_parloop_128471_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128471_err;
        goto cleanup;
    }
    if (event_128473 != NULL) {
        event_128473->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128471_total", strdup("nothing further"), event_128473, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_120117 = 0;
    }
    
    bool eta_p_124789;
    bool eta_p_124790;
    
    for (int32_t i_124792 = 0; i_124792 < nsubtasks_124775; i_124792++) {
        flat_tid_120141 = i_124792;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124789 = defunc_0_reduce_res_120117;
            }
            // load next params
            {
                eta_p_124790 = ((bool *) reduce_stage_1_tid_res_arr_mem_124776)[flat_tid_120141];
            }
            // red body
            {
                bool defunc_0_op_res_124791 = eta_p_124789 || eta_p_124790;
                
                defunc_0_reduce_res_120117 = defunc_0_op_res_124791;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124776);
    }
    if (event_128474 != NULL) {
        event_128474->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128468", strdup("nothing further"), event_128474, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128467->retval_defunc_0_reduce_res_120117 = defunc_0_reduce_res_120117;
        futhark_mc_task_128467->retval_mem_120116 = mem_120116.mem;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_128477 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_44842;
    double free_zs_res_44844;
    int64_t free_eta_p_106382;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_param_120057;
    unsigned char *free_mem_param_120060;
    int64_t free_ctx_param_ext_120062;
    int64_t free_ctx_param_ext_120063;
    int64_t free_ctx_param_ext_120064;
    unsigned char *free_mem_120071;
    unsigned char *free_mem_120116;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124794;
};
struct futhark_mc_task_128479 {
    struct futhark_context *ctx;
    unsigned char *free_mem_param_120057;
    int64_t free_ctx_param_ext_120062;
    int64_t free_ctx_param_ext_120063;
    int64_t free_ctx_param_ext_120064;
    unsigned char *free_mem_120071;
    int64_t free_gtid_120120;
    int64_t free_flat_tid_120127;
    double *retval_defunc_0_reduce_res_120126;
};
struct futhark_mc_segred_stage_1_parloop_struct_128482 {
    struct futhark_context *ctx;
    unsigned char *free_mem_param_120057;
    int64_t free_ctx_param_ext_120062;
    int64_t free_ctx_param_ext_120063;
    int64_t free_ctx_param_ext_120064;
    unsigned char *free_mem_120071;
    int64_t free_gtid_120120;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124806;
};
static int futhark_mc_segred_stage_1_parloop_128483(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128482 *futhark_mc_segred_stage_1_parloop_struct_128482 = (struct futhark_mc_segred_stage_1_parloop_struct_128482 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128482->ctx;
    struct mc_event *event_128484 = mc_event_new(ctx);
    
    if (event_128484 != NULL)
        event_128484->bef = get_wall_time();
    
    struct memblock mem_param_120057 = {.desc ="mem_param_120057", .mem =futhark_mc_segred_stage_1_parloop_struct_128482->free_mem_param_120057, .size =0, .references =NULL};
    int64_t ctx_param_ext_120062 = futhark_mc_segred_stage_1_parloop_struct_128482->free_ctx_param_ext_120062;
    int64_t ctx_param_ext_120063 = futhark_mc_segred_stage_1_parloop_struct_128482->free_ctx_param_ext_120063;
    int64_t ctx_param_ext_120064 = futhark_mc_segred_stage_1_parloop_struct_128482->free_ctx_param_ext_120064;
    struct memblock mem_120071 = {.desc ="mem_120071", .mem =futhark_mc_segred_stage_1_parloop_struct_128482->free_mem_120071, .size =0, .references =NULL};
    int64_t gtid_120120 = futhark_mc_segred_stage_1_parloop_struct_128482->free_gtid_120120;
    struct memblock reduce_stage_1_tid_res_arr_mem_124806 = {.desc ="reduce_stage_1_tid_res_arr_mem_124806", .mem =futhark_mc_segred_stage_1_parloop_struct_128482->free_reduce_stage_1_tid_res_arr_mem_124806, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_120127;
    
    flat_tid_120127 = subtask_id;
    {
        double eta_p_124808;
        double eta_p_124809;
        double local_acc_124811 = 0.0;
        double eta_p_120129;
        double eta_p_120130;
        double local_acc_124812 = 0.0;
        int64_t start_124813;
        int64_t end_124814;
        
        start_124813 = start;
        end_124814 = end;
        
        int64_t n_124815 = end_124814 - start_124813;
        
        for (int64_t SegRed_i_124816 = start_124813; SegRed_i_124816 < start_124813 + n_124815; SegRed_i_124816++) {
            int64_t gtid_120128 = SegRed_i_124816;
            double eta_p_120132 = ((double *) mem_120071.mem)[gtid_120128];
            double eta_p_120133 = ((double *) mem_param_120057.mem)[ctx_param_ext_120062 + (gtid_120120 * ctx_param_ext_120063 + gtid_120128 * ctx_param_ext_120064)];
            double zt_res_120134 = eta_p_120132 * eta_p_120133;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_120129 = local_acc_124812;
            }
            // Load next params
            {
                eta_p_120130 = zt_res_120134;
            }
            // SegRed body
            {
                double zp_res_120131 = eta_p_120129 + eta_p_120130;
                
                local_acc_124812 = zp_res_120131;
            }
        }
        
        int64_t uni_i_124817 = 0;
        
        {
            int64_t gtid_120128 = uni_i_124817;
            
            // Load accum params
            {
                eta_p_124808 = local_acc_124811;
            }
            // Load next params
            {
                eta_p_124809 = local_acc_124812;
            }
            // SegRed body
            {
                double zp_res_124810 = eta_p_124808 + eta_p_124809;
                
                local_acc_124811 = zp_res_124810;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_124806.mem)[flat_tid_120127] = local_acc_124811;
    }
    
  cleanup:
    { }
    if (event_128484 != NULL) {
        event_128484->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128483", strdup("nothing further"), event_128484, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128480(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128479 *futhark_mc_task_128479 = (struct futhark_mc_task_128479 *) args;
    struct futhark_context *ctx = futhark_mc_task_128479->ctx;
    struct mc_event *event_128486 = mc_event_new(ctx);
    
    if (event_128486 != NULL)
        event_128486->bef = get_wall_time();
    
    struct memblock mem_param_120057 = {.desc ="mem_param_120057", .mem =futhark_mc_task_128479->free_mem_param_120057, .size =0, .references =NULL};
    int64_t ctx_param_ext_120062 = futhark_mc_task_128479->free_ctx_param_ext_120062;
    int64_t ctx_param_ext_120063 = futhark_mc_task_128479->free_ctx_param_ext_120063;
    int64_t ctx_param_ext_120064 = futhark_mc_task_128479->free_ctx_param_ext_120064;
    struct memblock mem_120071 = {.desc ="mem_120071", .mem =futhark_mc_task_128479->free_mem_120071, .size =0, .references =NULL};
    int64_t gtid_120120 = futhark_mc_task_128479->free_gtid_120120;
    int64_t flat_tid_120127 = futhark_mc_task_128479->free_flat_tid_120127;
    double defunc_0_reduce_res_120126 = *futhark_mc_task_128479->retval_defunc_0_reduce_res_120126;
    int64_t reduce_stage_1_tid_res_arr_mem_124806_cached_sizze_128481 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124806 = NULL;
    int32_t nsubtasks_124805;
    
    nsubtasks_124805 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124806_cached_sizze_128481 < (int64_t) 8 * nsubtasks_124805) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124806, &reduce_stage_1_tid_res_arr_mem_124806_cached_sizze_128481, (int64_t) 8 * nsubtasks_124805);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128482 futhark_mc_segred_stage_1_parloop_struct_128482_;
    
    futhark_mc_segred_stage_1_parloop_struct_128482_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128482_.free_mem_param_120057 = mem_param_120057.mem;
    futhark_mc_segred_stage_1_parloop_struct_128482_.free_ctx_param_ext_120062 = ctx_param_ext_120062;
    futhark_mc_segred_stage_1_parloop_struct_128482_.free_ctx_param_ext_120063 = ctx_param_ext_120063;
    futhark_mc_segred_stage_1_parloop_struct_128482_.free_ctx_param_ext_120064 = ctx_param_ext_120064;
    futhark_mc_segred_stage_1_parloop_struct_128482_.free_mem_120071 = mem_120071.mem;
    futhark_mc_segred_stage_1_parloop_struct_128482_.free_gtid_120120 = gtid_120120;
    futhark_mc_segred_stage_1_parloop_struct_128482_.free_reduce_stage_1_tid_res_arr_mem_124806 = reduce_stage_1_tid_res_arr_mem_124806;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128483_task;
    
    futhark_mc_segred_stage_1_parloop_128483_task.name = "futhark_mc_segred_stage_1_parloop_128483";
    futhark_mc_segred_stage_1_parloop_128483_task.fn = futhark_mc_segred_stage_1_parloop_128483;
    futhark_mc_segred_stage_1_parloop_128483_task.args = &futhark_mc_segred_stage_1_parloop_struct_128482_;
    futhark_mc_segred_stage_1_parloop_128483_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128483_task.info = info;
    
    struct mc_event *event_128485 = mc_event_new(ctx);
    
    if (event_128485 != NULL)
        event_128485->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128483_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128483_task);
    
    if (futhark_mc_segred_stage_1_parloop_128483_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128483_err;
        goto cleanup;
    }
    if (event_128485 != NULL) {
        event_128485->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128483_total", strdup("nothing further"), event_128485, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_120126 = 0.0;
    }
    
    double eta_p_124818;
    double eta_p_124819;
    
    for (int32_t i_124821 = 0; i_124821 < nsubtasks_124805; i_124821++) {
        flat_tid_120127 = i_124821;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124818 = defunc_0_reduce_res_120126;
            }
            // load next params
            {
                eta_p_124819 = ((double *) reduce_stage_1_tid_res_arr_mem_124806)[flat_tid_120127];
            }
            // red body
            {
                double zp_res_124820 = eta_p_124818 + eta_p_124819;
                
                defunc_0_reduce_res_120126 = zp_res_124820;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124806);
    }
    if (event_128486 != NULL) {
        event_128486->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128480", strdup("nothing further"), event_128486, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128479->retval_defunc_0_reduce_res_120126 = defunc_0_reduce_res_120126;
    }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_128478(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128477 *futhark_mc_segred_stage_1_parloop_struct_128477 = (struct futhark_mc_segred_stage_1_parloop_struct_128477 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128477->ctx;
    struct mc_event *event_128487 = mc_event_new(ctx);
    
    if (event_128487 != NULL)
        event_128487->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128477->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_segred_stage_1_parloop_struct_128477->free_exp_absorb_cutoff_33394;
    double zs_res_44842 = futhark_mc_segred_stage_1_parloop_struct_128477->free_zs_res_44842;
    double zs_res_44844 = futhark_mc_segred_stage_1_parloop_struct_128477->free_zs_res_44844;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_128477->free_eta_p_106382;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_128477->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_120057 = {.desc ="mem_param_120057", .mem =futhark_mc_segred_stage_1_parloop_struct_128477->free_mem_param_120057, .size =0, .references =NULL};
    struct memblock mem_param_120060 = {.desc ="mem_param_120060", .mem =futhark_mc_segred_stage_1_parloop_struct_128477->free_mem_param_120060, .size =0, .references =NULL};
    int64_t ctx_param_ext_120062 = futhark_mc_segred_stage_1_parloop_struct_128477->free_ctx_param_ext_120062;
    int64_t ctx_param_ext_120063 = futhark_mc_segred_stage_1_parloop_struct_128477->free_ctx_param_ext_120063;
    int64_t ctx_param_ext_120064 = futhark_mc_segred_stage_1_parloop_struct_128477->free_ctx_param_ext_120064;
    struct memblock mem_120071 = {.desc ="mem_120071", .mem =futhark_mc_segred_stage_1_parloop_struct_128477->free_mem_120071, .size =0, .references =NULL};
    struct memblock mem_120116 = {.desc ="mem_120116", .mem =futhark_mc_segred_stage_1_parloop_struct_128477->free_mem_120116, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_124794 = {.desc ="reduce_stage_1_tid_res_arr_mem_124794", .mem =futhark_mc_segred_stage_1_parloop_struct_128477->free_reduce_stage_1_tid_res_arr_mem_124794, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_120119;
    
    flat_tid_120119 = subtask_id;
    {
        bool eta_p_124796;
        bool eta_p_124797;
        bool local_acc_124799 = 0;
        bool eta_p_120121;
        bool eta_p_120122;
        bool local_acc_124800 = 0;
        int64_t start_124801;
        int64_t end_124802;
        
        start_124801 = start;
        end_124802 = end;
        
        int64_t n_124803 = end_124802 - start_124801;
        
        for (int64_t SegRed_i_124804 = start_124801; SegRed_i_124804 < start_124801 + n_124803; SegRed_i_124804++) {
            int64_t gtid_120120 = SegRed_i_124804;
            double eta_p_120124 = ((double *) distrs_mem_111708.mem)[eta_p_106382 * m_33388 + gtid_120120];
            double eta_p_120125 = ((double *) mem_param_120060.mem)[gtid_120120];
            double defunc_0_reduce_res_120126;
            int64_t flat_tid_120127 = (int64_t) 0;
            
            defunc_0_reduce_res_120126 = 0.0;
            
            struct futhark_mc_task_128479 futhark_mc_task_128479_;
            
            futhark_mc_task_128479_.ctx = ctx;
            futhark_mc_task_128479_.free_mem_param_120057 = mem_param_120057.mem;
            futhark_mc_task_128479_.free_ctx_param_ext_120062 = ctx_param_ext_120062;
            futhark_mc_task_128479_.free_ctx_param_ext_120063 = ctx_param_ext_120063;
            futhark_mc_task_128479_.free_ctx_param_ext_120064 = ctx_param_ext_120064;
            futhark_mc_task_128479_.free_mem_120071 = mem_120071.mem;
            futhark_mc_task_128479_.free_gtid_120120 = gtid_120120;
            futhark_mc_task_128479_.free_flat_tid_120127 = flat_tid_120127;
            futhark_mc_task_128479_.retval_defunc_0_reduce_res_120126 = (double *) &defunc_0_reduce_res_120126;
            #if ISPC
            futhark_mc_task_128479_.retval_defunc_0_reduce_res_120126 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_128479_task;
            
            futhark_mc_task_128479_task.args = &futhark_mc_task_128479_;
            futhark_mc_task_128479_task.top_level_fn = futhark_mc_segred_task_128480;
            futhark_mc_task_128479_task.name = "futhark_mc_segred_task_128480";
            futhark_mc_task_128479_task.iterations = m_33388;
            futhark_mc_task_128479_task.task_time = &ctx->program->futhark_mc_segred_task_128480_total_time;
            futhark_mc_task_128479_task.task_iter = &ctx->program->futhark_mc_segred_task_128480_total_iter;
            futhark_mc_task_128479_task.sched = STATIC;
            futhark_mc_task_128479_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_128480_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128479_task);
            
            if (futhark_mc_segred_task_128480_err != 0) {
                err = futhark_mc_segred_task_128480_err;
                goto cleanup;
            }
            
            double zs_res_120135 = defunc_0_reduce_res_120126 / eta_p_120124;
            double ztzt_res_120136 = fpow64(zs_res_120135, zs_res_44842);
            double zt_res_120137 = zs_res_44844 * eta_p_120125;
            double exp_res_120138 = futrts_exp64(zt_res_120137);
            double zt_res_120139 = ztzt_res_120136 * exp_res_120138;
            bool zgze_res_120140 = exp_absorb_cutoff_33394 <= zt_res_120139;
            
            // save map-out results
            {
                ((double *) mem_120116.mem)[gtid_120120] = zt_res_120139;
            }
            // Load accum params
            {
                eta_p_120121 = local_acc_124800;
            }
            // Load next params
            {
                eta_p_120122 = zgze_res_120140;
            }
            // SegRed body
            {
                bool defunc_0_op_res_120123 = eta_p_120121 || eta_p_120122;
                
                local_acc_124800 = defunc_0_op_res_120123;
            }
        }
        
        int64_t uni_i_124822 = 0;
        
        {
            int64_t gtid_120120 = uni_i_124822;
            
            // Load accum params
            {
                eta_p_124796 = local_acc_124799;
            }
            // Load next params
            {
                eta_p_124797 = local_acc_124800;
            }
            // SegRed body
            {
                bool defunc_0_op_res_124798 = eta_p_124796 || eta_p_124797;
                
                local_acc_124799 = defunc_0_op_res_124798;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_124794.mem)[flat_tid_120119] = local_acc_124799;
    }
    
  cleanup:
    { }
    if (event_128487 != NULL) {
        event_128487->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128478", strdup("nothing further"), event_128487, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_128475(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128467 *futhark_mc_task_128467 = (struct futhark_mc_task_128467 *) args;
    struct futhark_context *ctx = futhark_mc_task_128467->ctx;
    struct mc_event *event_128489 = mc_event_new(ctx);
    
    if (event_128489 != NULL)
        event_128489->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128467->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_task_128467->free_exp_absorb_cutoff_33394;
    double zs_res_44842 = futhark_mc_task_128467->free_zs_res_44842;
    double zs_res_44844 = futhark_mc_task_128467->free_zs_res_44844;
    int64_t eta_p_106382 = futhark_mc_task_128467->free_eta_p_106382;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128467->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_120057 = {.desc ="mem_param_120057", .mem =futhark_mc_task_128467->free_mem_param_120057, .size =0, .references =NULL};
    struct memblock mem_param_120060 = {.desc ="mem_param_120060", .mem =futhark_mc_task_128467->free_mem_param_120060, .size =0, .references =NULL};
    int64_t ctx_param_ext_120062 = futhark_mc_task_128467->free_ctx_param_ext_120062;
    int64_t ctx_param_ext_120063 = futhark_mc_task_128467->free_ctx_param_ext_120063;
    int64_t ctx_param_ext_120064 = futhark_mc_task_128467->free_ctx_param_ext_120064;
    struct memblock mem_120071 = {.desc ="mem_120071", .mem =futhark_mc_task_128467->free_mem_120071, .size =0, .references =NULL};
    int64_t flat_tid_120119 = futhark_mc_task_128467->free_flat_tid_120119;
    int64_t flat_tid_120141 = futhark_mc_task_128467->free_flat_tid_120141;
    bool defunc_0_reduce_res_120117 = *futhark_mc_task_128467->retval_defunc_0_reduce_res_120117;
    struct memblock mem_120116 = {.desc ="mem_120116", .mem =futhark_mc_task_128467->retval_mem_120116, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_124794_cached_sizze_128476 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124794 = NULL;
    int32_t nsubtasks_124793;
    
    nsubtasks_124793 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124794_cached_sizze_128476 < nsubtasks_124793) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124794, &reduce_stage_1_tid_res_arr_mem_124794_cached_sizze_128476, nsubtasks_124793);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128477 futhark_mc_segred_stage_1_parloop_struct_128477_;
    
    futhark_mc_segred_stage_1_parloop_struct_128477_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128477_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128477_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segred_stage_1_parloop_struct_128477_.free_zs_res_44842 = zs_res_44842;
    futhark_mc_segred_stage_1_parloop_struct_128477_.free_zs_res_44844 = zs_res_44844;
    futhark_mc_segred_stage_1_parloop_struct_128477_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_128477_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_128477_.free_mem_param_120057 = mem_param_120057.mem;
    futhark_mc_segred_stage_1_parloop_struct_128477_.free_mem_param_120060 = mem_param_120060.mem;
    futhark_mc_segred_stage_1_parloop_struct_128477_.free_ctx_param_ext_120062 = ctx_param_ext_120062;
    futhark_mc_segred_stage_1_parloop_struct_128477_.free_ctx_param_ext_120063 = ctx_param_ext_120063;
    futhark_mc_segred_stage_1_parloop_struct_128477_.free_ctx_param_ext_120064 = ctx_param_ext_120064;
    futhark_mc_segred_stage_1_parloop_struct_128477_.free_mem_120071 = mem_120071.mem;
    futhark_mc_segred_stage_1_parloop_struct_128477_.free_mem_120116 = mem_120116.mem;
    futhark_mc_segred_stage_1_parloop_struct_128477_.free_reduce_stage_1_tid_res_arr_mem_124794 = reduce_stage_1_tid_res_arr_mem_124794;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128478_task;
    
    futhark_mc_segred_stage_1_parloop_128478_task.name = "futhark_mc_segred_stage_1_parloop_128478";
    futhark_mc_segred_stage_1_parloop_128478_task.fn = futhark_mc_segred_stage_1_parloop_128478;
    futhark_mc_segred_stage_1_parloop_128478_task.args = &futhark_mc_segred_stage_1_parloop_struct_128477_;
    futhark_mc_segred_stage_1_parloop_128478_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128478_task.info = info;
    
    struct mc_event *event_128488 = mc_event_new(ctx);
    
    if (event_128488 != NULL)
        event_128488->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128478_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128478_task);
    
    if (futhark_mc_segred_stage_1_parloop_128478_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128478_err;
        goto cleanup;
    }
    if (event_128488 != NULL) {
        event_128488->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128478_total", strdup("nothing further"), event_128488, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_120117 = 0;
    }
    
    bool eta_p_124823;
    bool eta_p_124824;
    
    for (int32_t i_124826 = 0; i_124826 < nsubtasks_124793; i_124826++) {
        flat_tid_120119 = i_124826;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124823 = defunc_0_reduce_res_120117;
            }
            // load next params
            {
                eta_p_124824 = ((bool *) reduce_stage_1_tid_res_arr_mem_124794)[flat_tid_120119];
            }
            // red body
            {
                bool defunc_0_op_res_124825 = eta_p_124823 || eta_p_124824;
                
                defunc_0_reduce_res_120117 = defunc_0_op_res_124825;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124794);
    }
    if (event_128489 != NULL) {
        event_128489->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_128475", strdup("nothing further"), event_128489, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128467->retval_defunc_0_reduce_res_120117 = defunc_0_reduce_res_120117;
        futhark_mc_task_128467->retval_mem_120116 = mem_120116.mem;
    }
    return err;
}
struct futhark_mc_task_128490 {
    struct futhark_context *ctx;
    double free_zs_res_107134;
    unsigned char *free_mem_120116;
    int64_t free_flat_tid_120162;
    bool *retval_defunc_0_reduce_res_120161;
};
struct futhark_mc_segred_stage_1_parloop_struct_128493 {
    struct futhark_context *ctx;
    double free_zs_res_107134;
    unsigned char *free_mem_120116;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124828;
};
static int futhark_mc_segred_stage_1_parloop_128494(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128493 *futhark_mc_segred_stage_1_parloop_struct_128493 = (struct futhark_mc_segred_stage_1_parloop_struct_128493 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128493->ctx;
    struct mc_event *event_128495 = mc_event_new(ctx);
    
    if (event_128495 != NULL)
        event_128495->bef = get_wall_time();
    
    double zs_res_107134 = futhark_mc_segred_stage_1_parloop_struct_128493->free_zs_res_107134;
    struct memblock mem_120116 = {.desc ="mem_120116", .mem =futhark_mc_segred_stage_1_parloop_struct_128493->free_mem_120116, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_124828 = {.desc ="reduce_stage_1_tid_res_arr_mem_124828", .mem =futhark_mc_segred_stage_1_parloop_struct_128493->free_reduce_stage_1_tid_res_arr_mem_124828, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_120162;
    
    flat_tid_120162 = subtask_id;
    {
        bool eta_p_124830;
        bool eta_p_124831;
        bool local_acc_124833 = 0;
        bool eta_p_120164;
        bool eta_p_120165;
        bool local_acc_124834 = 0;
        int64_t start_124835;
        int64_t end_124836;
        
        start_124835 = start;
        end_124836 = end;
        
        int64_t n_124837 = end_124836 - start_124835;
        
        for (int64_t SegRed_i_124838 = start_124835; SegRed_i_124838 < start_124835 + n_124837; SegRed_i_124838++) {
            int64_t gtid_120163 = SegRed_i_124838;
            double eta_p_120167 = ((double *) mem_120116.mem)[gtid_120163];
            bool zlze_res_120168 = eta_p_120167 <= zs_res_107134;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_120164 = local_acc_124834;
            }
            // Load next params
            {
                eta_p_120165 = zlze_res_120168;
            }
            // SegRed body
            {
                bool defunc_0_op_res_120166 = eta_p_120164 || eta_p_120165;
                
                local_acc_124834 = defunc_0_op_res_120166;
            }
        }
        
        int64_t uni_i_124839 = 0;
        
        {
            int64_t gtid_120163 = uni_i_124839;
            
            // Load accum params
            {
                eta_p_124830 = local_acc_124833;
            }
            // Load next params
            {
                eta_p_124831 = local_acc_124834;
            }
            // SegRed body
            {
                bool defunc_0_op_res_124832 = eta_p_124830 || eta_p_124831;
                
                local_acc_124833 = defunc_0_op_res_124832;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_124828.mem)[flat_tid_120162] = local_acc_124833;
    }
    
  cleanup:
    { }
    if (event_128495 != NULL) {
        event_128495->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128494", strdup("nothing further"), event_128495, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128491(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128490 *futhark_mc_task_128490 = (struct futhark_mc_task_128490 *) args;
    struct futhark_context *ctx = futhark_mc_task_128490->ctx;
    struct mc_event *event_128497 = mc_event_new(ctx);
    
    if (event_128497 != NULL)
        event_128497->bef = get_wall_time();
    
    double zs_res_107134 = futhark_mc_task_128490->free_zs_res_107134;
    struct memblock mem_120116 = {.desc ="mem_120116", .mem =futhark_mc_task_128490->free_mem_120116, .size =0, .references =NULL};
    int64_t flat_tid_120162 = futhark_mc_task_128490->free_flat_tid_120162;
    bool defunc_0_reduce_res_120161 = *futhark_mc_task_128490->retval_defunc_0_reduce_res_120161;
    int64_t reduce_stage_1_tid_res_arr_mem_124828_cached_sizze_128492 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124828 = NULL;
    int32_t nsubtasks_124827;
    
    nsubtasks_124827 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124828_cached_sizze_128492 < nsubtasks_124827) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124828, &reduce_stage_1_tid_res_arr_mem_124828_cached_sizze_128492, nsubtasks_124827);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128493 futhark_mc_segred_stage_1_parloop_struct_128493_;
    
    futhark_mc_segred_stage_1_parloop_struct_128493_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128493_.free_zs_res_107134 = zs_res_107134;
    futhark_mc_segred_stage_1_parloop_struct_128493_.free_mem_120116 = mem_120116.mem;
    futhark_mc_segred_stage_1_parloop_struct_128493_.free_reduce_stage_1_tid_res_arr_mem_124828 = reduce_stage_1_tid_res_arr_mem_124828;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128494_task;
    
    futhark_mc_segred_stage_1_parloop_128494_task.name = "futhark_mc_segred_stage_1_parloop_128494";
    futhark_mc_segred_stage_1_parloop_128494_task.fn = futhark_mc_segred_stage_1_parloop_128494;
    futhark_mc_segred_stage_1_parloop_128494_task.args = &futhark_mc_segred_stage_1_parloop_struct_128493_;
    futhark_mc_segred_stage_1_parloop_128494_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128494_task.info = info;
    
    struct mc_event *event_128496 = mc_event_new(ctx);
    
    if (event_128496 != NULL)
        event_128496->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128494_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128494_task);
    
    if (futhark_mc_segred_stage_1_parloop_128494_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128494_err;
        goto cleanup;
    }
    if (event_128496 != NULL) {
        event_128496->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128494_total", strdup("nothing further"), event_128496, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_120161 = 0;
    }
    
    bool eta_p_124840;
    bool eta_p_124841;
    
    for (int32_t i_124843 = 0; i_124843 < nsubtasks_124827; i_124843++) {
        flat_tid_120162 = i_124843;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124840 = defunc_0_reduce_res_120161;
            }
            // load next params
            {
                eta_p_124841 = ((bool *) reduce_stage_1_tid_res_arr_mem_124828)[flat_tid_120162];
            }
            // red body
            {
                bool defunc_0_op_res_124842 = eta_p_124840 || eta_p_124841;
                
                defunc_0_reduce_res_120161 = defunc_0_op_res_124842;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124828);
    }
    if (event_128497 != NULL) {
        event_128497->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128491", strdup("nothing further"), event_128497, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128490->retval_defunc_0_reduce_res_120161 = defunc_0_reduce_res_120161;
    }
    return err;
}
struct futhark_mc_task_128498 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_107134;
    unsigned char *free_mem_param_120057;
    unsigned char *free_mem_param_120060;
    int64_t free_ctx_param_ext_120062;
    int64_t free_ctx_param_ext_120063;
    int64_t free_ctx_param_ext_120064;
    unsigned char *free_mem_120116;
    unsigned char *free_mem_120175;
    unsigned char *free_mem_120176;
    unsigned char *free_mem_120177;
    int64_t free_bytes_120184;
};
struct futhark_mc_segmap_parloop_struct_128500 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_107134;
    unsigned char *free_mem_param_120057;
    unsigned char *free_mem_param_120060;
    int64_t free_ctx_param_ext_120062;
    int64_t free_ctx_param_ext_120063;
    int64_t free_ctx_param_ext_120064;
    unsigned char *free_mem_120116;
    unsigned char *free_mem_120175;
    unsigned char *free_mem_120176;
    unsigned char *free_mem_120177;
    int64_t free_bytes_120184;
};
static int futhark_mc_segmap_parloop_128501(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_128500 *futhark_mc_segmap_parloop_struct_128500 = (struct futhark_mc_segmap_parloop_struct_128500 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_128500->ctx;
    struct mc_event *event_128502 = mc_event_new(ctx);
    
    if (event_128502 != NULL)
        event_128502->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_128500->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_segmap_parloop_struct_128500->free_exp_absorb_cutoff_33394;
    double zs_res_107134 = futhark_mc_segmap_parloop_struct_128500->free_zs_res_107134;
    struct memblock mem_param_120057 = {.desc ="mem_param_120057", .mem =futhark_mc_segmap_parloop_struct_128500->free_mem_param_120057, .size =0, .references =NULL};
    struct memblock mem_param_120060 = {.desc ="mem_param_120060", .mem =futhark_mc_segmap_parloop_struct_128500->free_mem_param_120060, .size =0, .references =NULL};
    int64_t ctx_param_ext_120062 = futhark_mc_segmap_parloop_struct_128500->free_ctx_param_ext_120062;
    int64_t ctx_param_ext_120063 = futhark_mc_segmap_parloop_struct_128500->free_ctx_param_ext_120063;
    int64_t ctx_param_ext_120064 = futhark_mc_segmap_parloop_struct_128500->free_ctx_param_ext_120064;
    struct memblock mem_120116 = {.desc ="mem_120116", .mem =futhark_mc_segmap_parloop_struct_128500->free_mem_120116, .size =0, .references =NULL};
    struct memblock mem_120175 = {.desc ="mem_120175", .mem =futhark_mc_segmap_parloop_struct_128500->free_mem_120175, .size =0, .references =NULL};
    struct memblock mem_120176 = {.desc ="mem_120176", .mem =futhark_mc_segmap_parloop_struct_128500->free_mem_120176, .size =0, .references =NULL};
    struct memblock mem_120177 = {.desc ="mem_120177", .mem =futhark_mc_segmap_parloop_struct_128500->free_mem_120177, .size =0, .references =NULL};
    int64_t bytes_120184 = futhark_mc_segmap_parloop_struct_128500->free_bytes_120184;
    int64_t iterations = end - start;
    struct memblock ext_mem_120203;
    
    ext_mem_120203.references = NULL;
    
    struct memblock mem_120202;
    
    mem_120202.references = NULL;
    
    int64_t flat_tid_120188;
    
    flat_tid_120188 = subtask_id;
    {
        int64_t start_124856;
        int64_t end_124857;
        
        start_124856 = start;
        end_124857 = end;
        
        int64_t n_124858 = end_124857 - start_124856;
        
        if (memblock_alloc(ctx, &mem_120202, bytes_120184, "mem_120202")) {
            err = 1;
            goto cleanup;
        }
        for (int64_t SegMap_i_124859 = start_124856; SegMap_i_124859 < start_124856 + n_124858; SegMap_i_124859++) {
            int64_t slice_124860 = m_33388;
            int64_t gtid_120189 = SegMap_i_124859;
            int64_t remnant_124861 = SegMap_i_124859 - gtid_120189;
            double eta_p_120190 = ((double *) mem_120116.mem)[gtid_120189];
            double eta_p_120191 = ((double *) mem_param_120060.mem)[gtid_120189];
            bool zgze_res_120193 = exp_absorb_cutoff_33394 <= eta_p_120190;
            bool zl_res_120194 = eta_p_120190 < zs_res_107134;
            bool x_120195 = !zgze_res_120193;
            bool y_120196 = zl_res_120194 && x_120195;
            bool cond_120197 = zgze_res_120193 || y_120196;
            int64_t binop_y_120198 = gtid_120189 * ctx_param_ext_120063;
            int64_t lmad_ext_120199 = ctx_param_ext_120062 + binop_y_120198;
            int64_t ext_120200;
            
            if (cond_120197) {
                ext_120200 = (int64_t) 0;
            } else {
                ext_120200 = lmad_ext_120199;
            }
            
            int64_t ext_120201;
            
            if (cond_120197) {
                ext_120201 = (int64_t) 1;
            } else {
                ext_120201 = ctx_param_ext_120064;
            }
            
            double rescale_res_120204;
            double rescale_res_120205;
            
            if (cond_120197) {
                double log_res_124845 = futrts_log64(eta_p_120190);
                double sqrt_res_124846 = futrts_sqrt64(eta_p_120190);
                double zs_res_124847 = log_res_124845 / 2.0;
                double zp_res_124848 = eta_p_120191 + zs_res_124847;
                
                for (int64_t i_124851 = 0; i_124851 < m_33388; i_124851++) {
                    double eta_p_124853 = ((double *) mem_param_120057.mem)[ctx_param_ext_120062 + (gtid_120189 * ctx_param_ext_120063 + i_124851 * ctx_param_ext_120064)];
                    double zt_res_124854 = sqrt_res_124846 * eta_p_124853;
                    
                    ((double *) mem_120202.mem)[i_124851] = zt_res_124854;
                }
                if (memblock_set(ctx, &ext_mem_120203, &mem_120202, "mem_120202") != 0)
                    return 1;
                rescale_res_120204 = sqrt_res_124846;
                rescale_res_120205 = zp_res_124848;
            } else {
                if (memblock_set(ctx, &ext_mem_120203, &mem_param_120057, "mem_param_120057") != 0)
                    return 1;
                rescale_res_120204 = eta_p_120190;
                rescale_res_120205 = eta_p_120191;
            }
            ((double *) mem_120175.mem)[gtid_120189] = rescale_res_120204;
            ((double *) mem_120176.mem)[gtid_120189] = rescale_res_120205;
            lmad_copy_8b(ctx, 1, (uint64_t *) mem_120177.mem, gtid_120189 * m_33388, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_120203.mem, ext_120200, (int64_t []) {ext_120201}, (int64_t []) {m_33388});
        }
    }
    
  cleanup:
    {
        if (memblock_unref(ctx, &ext_mem_120203, "ext_mem_120203") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_120202, "mem_120202") != 0)
            return 1;
    }
    if (event_128502 != NULL) {
        event_128502->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128501", strdup("nothing further"), event_128502, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_task_128499(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128498 *futhark_mc_task_128498 = (struct futhark_mc_task_128498 *) args;
    struct futhark_context *ctx = futhark_mc_task_128498->ctx;
    struct mc_event *event_128504 = mc_event_new(ctx);
    
    if (event_128504 != NULL)
        event_128504->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128498->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_task_128498->free_exp_absorb_cutoff_33394;
    double zs_res_107134 = futhark_mc_task_128498->free_zs_res_107134;
    struct memblock mem_param_120057 = {.desc ="mem_param_120057", .mem =futhark_mc_task_128498->free_mem_param_120057, .size =0, .references =NULL};
    struct memblock mem_param_120060 = {.desc ="mem_param_120060", .mem =futhark_mc_task_128498->free_mem_param_120060, .size =0, .references =NULL};
    int64_t ctx_param_ext_120062 = futhark_mc_task_128498->free_ctx_param_ext_120062;
    int64_t ctx_param_ext_120063 = futhark_mc_task_128498->free_ctx_param_ext_120063;
    int64_t ctx_param_ext_120064 = futhark_mc_task_128498->free_ctx_param_ext_120064;
    struct memblock mem_120116 = {.desc ="mem_120116", .mem =futhark_mc_task_128498->free_mem_120116, .size =0, .references =NULL};
    struct memblock mem_120175 = {.desc ="mem_120175", .mem =futhark_mc_task_128498->free_mem_120175, .size =0, .references =NULL};
    struct memblock mem_120176 = {.desc ="mem_120176", .mem =futhark_mc_task_128498->free_mem_120176, .size =0, .references =NULL};
    struct memblock mem_120177 = {.desc ="mem_120177", .mem =futhark_mc_task_128498->free_mem_120177, .size =0, .references =NULL};
    int64_t bytes_120184 = futhark_mc_task_128498->free_bytes_120184;
    int32_t nsubtasks_124844;
    
    nsubtasks_124844 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_128500 futhark_mc_segmap_parloop_struct_128500_;
    
    futhark_mc_segmap_parloop_struct_128500_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_128500_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_128500_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segmap_parloop_struct_128500_.free_zs_res_107134 = zs_res_107134;
    futhark_mc_segmap_parloop_struct_128500_.free_mem_param_120057 = mem_param_120057.mem;
    futhark_mc_segmap_parloop_struct_128500_.free_mem_param_120060 = mem_param_120060.mem;
    futhark_mc_segmap_parloop_struct_128500_.free_ctx_param_ext_120062 = ctx_param_ext_120062;
    futhark_mc_segmap_parloop_struct_128500_.free_ctx_param_ext_120063 = ctx_param_ext_120063;
    futhark_mc_segmap_parloop_struct_128500_.free_ctx_param_ext_120064 = ctx_param_ext_120064;
    futhark_mc_segmap_parloop_struct_128500_.free_mem_120116 = mem_120116.mem;
    futhark_mc_segmap_parloop_struct_128500_.free_mem_120175 = mem_120175.mem;
    futhark_mc_segmap_parloop_struct_128500_.free_mem_120176 = mem_120176.mem;
    futhark_mc_segmap_parloop_struct_128500_.free_mem_120177 = mem_120177.mem;
    futhark_mc_segmap_parloop_struct_128500_.free_bytes_120184 = bytes_120184;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_128501_task;
    
    futhark_mc_segmap_parloop_128501_task.name = "futhark_mc_segmap_parloop_128501";
    futhark_mc_segmap_parloop_128501_task.fn = futhark_mc_segmap_parloop_128501;
    futhark_mc_segmap_parloop_128501_task.args = &futhark_mc_segmap_parloop_struct_128500_;
    futhark_mc_segmap_parloop_128501_task.iterations = iterations;
    futhark_mc_segmap_parloop_128501_task.info = info;
    
    struct mc_event *event_128503 = mc_event_new(ctx);
    
    if (event_128503 != NULL)
        event_128503->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_128501_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_128501_task);
    
    if (futhark_mc_segmap_parloop_128501_err != 0) {
        err = futhark_mc_segmap_parloop_128501_err;
        goto cleanup;
    }
    if (event_128503 != NULL) {
        event_128503->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128501_total", strdup("nothing further"), event_128503, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_128504 != NULL) {
        event_128504->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_task_128499", strdup("nothing further"), event_128504, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_128505 {
    struct futhark_context *ctx;
    double free_zs_res_107134;
    unsigned char *free_mem_120071;
    int64_t free_flat_tid_120219;
    bool *retval_defunc_0_reduce_res_120218;
};
struct futhark_mc_segred_stage_1_parloop_struct_128508 {
    struct futhark_context *ctx;
    double free_zs_res_107134;
    unsigned char *free_mem_120071;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124864;
};
static int futhark_mc_segred_stage_1_parloop_128509(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128508 *futhark_mc_segred_stage_1_parloop_struct_128508 = (struct futhark_mc_segred_stage_1_parloop_struct_128508 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128508->ctx;
    struct mc_event *event_128510 = mc_event_new(ctx);
    
    if (event_128510 != NULL)
        event_128510->bef = get_wall_time();
    
    double zs_res_107134 = futhark_mc_segred_stage_1_parloop_struct_128508->free_zs_res_107134;
    struct memblock mem_120071 = {.desc ="mem_120071", .mem =futhark_mc_segred_stage_1_parloop_struct_128508->free_mem_120071, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_124864 = {.desc ="reduce_stage_1_tid_res_arr_mem_124864", .mem =futhark_mc_segred_stage_1_parloop_struct_128508->free_reduce_stage_1_tid_res_arr_mem_124864, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_120219;
    
    flat_tid_120219 = subtask_id;
    {
        bool eta_p_124866;
        bool eta_p_124867;
        bool local_acc_124869 = 0;
        bool eta_p_120221;
        bool eta_p_120222;
        bool local_acc_124870 = 0;
        int64_t start_124871;
        int64_t end_124872;
        
        start_124871 = start;
        end_124872 = end;
        
        int64_t n_124873 = end_124872 - start_124871;
        
        for (int64_t SegRed_i_124874 = start_124871; SegRed_i_124874 < start_124871 + n_124873; SegRed_i_124874++) {
            int64_t gtid_120220 = SegRed_i_124874;
            double eta_p_120224 = ((double *) mem_120071.mem)[gtid_120220];
            bool zlze_res_120225 = eta_p_120224 <= zs_res_107134;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_120221 = local_acc_124870;
            }
            // Load next params
            {
                eta_p_120222 = zlze_res_120225;
            }
            // SegRed body
            {
                bool defunc_0_op_res_120223 = eta_p_120221 || eta_p_120222;
                
                local_acc_124870 = defunc_0_op_res_120223;
            }
        }
        
        int64_t uni_i_124875 = 0;
        
        {
            int64_t gtid_120220 = uni_i_124875;
            
            // Load accum params
            {
                eta_p_124866 = local_acc_124869;
            }
            // Load next params
            {
                eta_p_124867 = local_acc_124870;
            }
            // SegRed body
            {
                bool defunc_0_op_res_124868 = eta_p_124866 || eta_p_124867;
                
                local_acc_124869 = defunc_0_op_res_124868;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_124864.mem)[flat_tid_120219] = local_acc_124869;
    }
    
  cleanup:
    { }
    if (event_128510 != NULL) {
        event_128510->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128509", strdup("nothing further"), event_128510, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128506(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128505 *futhark_mc_task_128505 = (struct futhark_mc_task_128505 *) args;
    struct futhark_context *ctx = futhark_mc_task_128505->ctx;
    struct mc_event *event_128512 = mc_event_new(ctx);
    
    if (event_128512 != NULL)
        event_128512->bef = get_wall_time();
    
    double zs_res_107134 = futhark_mc_task_128505->free_zs_res_107134;
    struct memblock mem_120071 = {.desc ="mem_120071", .mem =futhark_mc_task_128505->free_mem_120071, .size =0, .references =NULL};
    int64_t flat_tid_120219 = futhark_mc_task_128505->free_flat_tid_120219;
    bool defunc_0_reduce_res_120218 = *futhark_mc_task_128505->retval_defunc_0_reduce_res_120218;
    int64_t reduce_stage_1_tid_res_arr_mem_124864_cached_sizze_128507 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124864 = NULL;
    int32_t nsubtasks_124863;
    
    nsubtasks_124863 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124864_cached_sizze_128507 < nsubtasks_124863) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124864, &reduce_stage_1_tid_res_arr_mem_124864_cached_sizze_128507, nsubtasks_124863);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128508 futhark_mc_segred_stage_1_parloop_struct_128508_;
    
    futhark_mc_segred_stage_1_parloop_struct_128508_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128508_.free_zs_res_107134 = zs_res_107134;
    futhark_mc_segred_stage_1_parloop_struct_128508_.free_mem_120071 = mem_120071.mem;
    futhark_mc_segred_stage_1_parloop_struct_128508_.free_reduce_stage_1_tid_res_arr_mem_124864 = reduce_stage_1_tid_res_arr_mem_124864;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128509_task;
    
    futhark_mc_segred_stage_1_parloop_128509_task.name = "futhark_mc_segred_stage_1_parloop_128509";
    futhark_mc_segred_stage_1_parloop_128509_task.fn = futhark_mc_segred_stage_1_parloop_128509;
    futhark_mc_segred_stage_1_parloop_128509_task.args = &futhark_mc_segred_stage_1_parloop_struct_128508_;
    futhark_mc_segred_stage_1_parloop_128509_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128509_task.info = info;
    
    struct mc_event *event_128511 = mc_event_new(ctx);
    
    if (event_128511 != NULL)
        event_128511->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128509_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128509_task);
    
    if (futhark_mc_segred_stage_1_parloop_128509_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128509_err;
        goto cleanup;
    }
    if (event_128511 != NULL) {
        event_128511->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128509_total", strdup("nothing further"), event_128511, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_120218 = 0;
    }
    
    bool eta_p_124876;
    bool eta_p_124877;
    
    for (int32_t i_124879 = 0; i_124879 < nsubtasks_124863; i_124879++) {
        flat_tid_120219 = i_124879;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124876 = defunc_0_reduce_res_120218;
            }
            // load next params
            {
                eta_p_124877 = ((bool *) reduce_stage_1_tid_res_arr_mem_124864)[flat_tid_120219];
            }
            // red body
            {
                bool defunc_0_op_res_124878 = eta_p_124876 || eta_p_124877;
                
                defunc_0_reduce_res_120218 = defunc_0_op_res_124878;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124864);
    }
    if (event_128512 != NULL) {
        event_128512->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128506", strdup("nothing further"), event_128512, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128505->retval_defunc_0_reduce_res_120218 = defunc_0_reduce_res_120218;
    }
    return err;
}
struct futhark_mc_task_128513 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_107134;
    unsigned char *free_mem_param_120061;
    unsigned char *free_mem_120071;
    int64_t free_ext_120172;
    int64_t free_ext_120173;
    int64_t free_ext_120174;
    unsigned char *free_ext_mem_120180;
    unsigned char *free_mem_120233;
    unsigned char *free_mem_120234;
    unsigned char *free_mem_120235;
    int64_t free_bytes_120242;
};
struct futhark_mc_segmap_parloop_struct_128515 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_exp_absorb_cutoff_33394;
    double free_zs_res_107134;
    unsigned char *free_mem_param_120061;
    unsigned char *free_mem_120071;
    int64_t free_ext_120172;
    int64_t free_ext_120173;
    int64_t free_ext_120174;
    unsigned char *free_ext_mem_120180;
    unsigned char *free_mem_120233;
    unsigned char *free_mem_120234;
    unsigned char *free_mem_120235;
    int64_t free_bytes_120242;
};
static int futhark_mc_segmap_parloop_128516(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_128515 *futhark_mc_segmap_parloop_struct_128515 = (struct futhark_mc_segmap_parloop_struct_128515 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_128515->ctx;
    struct mc_event *event_128517 = mc_event_new(ctx);
    
    if (event_128517 != NULL)
        event_128517->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_128515->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_segmap_parloop_struct_128515->free_exp_absorb_cutoff_33394;
    double zs_res_107134 = futhark_mc_segmap_parloop_struct_128515->free_zs_res_107134;
    struct memblock mem_param_120061 = {.desc ="mem_param_120061", .mem =futhark_mc_segmap_parloop_struct_128515->free_mem_param_120061, .size =0, .references =NULL};
    struct memblock mem_120071 = {.desc ="mem_120071", .mem =futhark_mc_segmap_parloop_struct_128515->free_mem_120071, .size =0, .references =NULL};
    int64_t ext_120172 = futhark_mc_segmap_parloop_struct_128515->free_ext_120172;
    int64_t ext_120173 = futhark_mc_segmap_parloop_struct_128515->free_ext_120173;
    int64_t ext_120174 = futhark_mc_segmap_parloop_struct_128515->free_ext_120174;
    struct memblock ext_mem_120180 = {.desc ="ext_mem_120180", .mem =futhark_mc_segmap_parloop_struct_128515->free_ext_mem_120180, .size =0, .references =NULL};
    struct memblock mem_120233 = {.desc ="mem_120233", .mem =futhark_mc_segmap_parloop_struct_128515->free_mem_120233, .size =0, .references =NULL};
    struct memblock mem_120234 = {.desc ="mem_120234", .mem =futhark_mc_segmap_parloop_struct_128515->free_mem_120234, .size =0, .references =NULL};
    struct memblock mem_120235 = {.desc ="mem_120235", .mem =futhark_mc_segmap_parloop_struct_128515->free_mem_120235, .size =0, .references =NULL};
    int64_t bytes_120242 = futhark_mc_segmap_parloop_struct_128515->free_bytes_120242;
    int64_t iterations = end - start;
    struct memblock ext_mem_120261;
    
    ext_mem_120261.references = NULL;
    
    struct memblock mem_120260;
    
    mem_120260.references = NULL;
    
    int64_t flat_tid_120246;
    
    flat_tid_120246 = subtask_id;
    {
        int64_t start_124892;
        int64_t end_124893;
        
        start_124892 = start;
        end_124893 = end;
        
        int64_t n_124894 = end_124893 - start_124892;
        
        if (memblock_alloc(ctx, &mem_120260, bytes_120242, "mem_120260")) {
            err = 1;
            goto cleanup;
        }
        for (int64_t SegMap_i_124895 = start_124892; SegMap_i_124895 < start_124892 + n_124894; SegMap_i_124895++) {
            int64_t slice_124896 = m_33388;
            int64_t gtid_120247 = SegMap_i_124895;
            int64_t remnant_124897 = SegMap_i_124895 - gtid_120247;
            double eta_p_120248 = ((double *) mem_120071.mem)[gtid_120247];
            double eta_p_120249 = ((double *) mem_param_120061.mem)[gtid_120247];
            bool zgze_res_120251 = exp_absorb_cutoff_33394 <= eta_p_120248;
            bool zl_res_120252 = eta_p_120248 < zs_res_107134;
            bool x_120253 = !zgze_res_120251;
            bool y_120254 = zl_res_120252 && x_120253;
            bool cond_120255 = zgze_res_120251 || y_120254;
            int64_t binop_y_120256 = gtid_120247 * ext_120174;
            int64_t lmad_ext_120257 = ext_120172 + binop_y_120256;
            int64_t ext_120258;
            
            if (cond_120255) {
                ext_120258 = (int64_t) 0;
            } else {
                ext_120258 = lmad_ext_120257;
            }
            
            int64_t ext_120259;
            
            if (cond_120255) {
                ext_120259 = (int64_t) 1;
            } else {
                ext_120259 = ext_120173;
            }
            
            double rescale_res_120262;
            double rescale_res_120263;
            
            if (cond_120255) {
                double log_res_124881 = futrts_log64(eta_p_120248);
                double sqrt_res_124882 = futrts_sqrt64(eta_p_120248);
                double zs_res_124883 = log_res_124881 / 2.0;
                double zp_res_124884 = eta_p_120249 + zs_res_124883;
                
                for (int64_t i_124887 = 0; i_124887 < m_33388; i_124887++) {
                    double eta_p_124889 = ((double *) ext_mem_120180.mem)[ext_120172 + (i_124887 * ext_120173 + gtid_120247 * ext_120174)];
                    double zt_res_124890 = sqrt_res_124882 * eta_p_124889;
                    
                    ((double *) mem_120260.mem)[i_124887] = zt_res_124890;
                }
                if (memblock_set(ctx, &ext_mem_120261, &mem_120260, "mem_120260") != 0)
                    return 1;
                rescale_res_120262 = sqrt_res_124882;
                rescale_res_120263 = zp_res_124884;
            } else {
                if (memblock_set(ctx, &ext_mem_120261, &ext_mem_120180, "ext_mem_120180") != 0)
                    return 1;
                rescale_res_120262 = eta_p_120248;
                rescale_res_120263 = eta_p_120249;
            }
            ((double *) mem_120233.mem)[gtid_120247] = rescale_res_120262;
            ((double *) mem_120234.mem)[gtid_120247] = rescale_res_120263;
            lmad_copy_8b(ctx, 1, (uint64_t *) mem_120235.mem, gtid_120247 * m_33388, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_120261.mem, ext_120258, (int64_t []) {ext_120259}, (int64_t []) {m_33388});
        }
    }
    
  cleanup:
    {
        if (memblock_unref(ctx, &ext_mem_120261, "ext_mem_120261") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_120260, "mem_120260") != 0)
            return 1;
    }
    if (event_128517 != NULL) {
        event_128517->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128516", strdup("nothing further"), event_128517, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_task_128514(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128513 *futhark_mc_task_128513 = (struct futhark_mc_task_128513 *) args;
    struct futhark_context *ctx = futhark_mc_task_128513->ctx;
    struct mc_event *event_128519 = mc_event_new(ctx);
    
    if (event_128519 != NULL)
        event_128519->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128513->free_m_33388;
    double exp_absorb_cutoff_33394 = futhark_mc_task_128513->free_exp_absorb_cutoff_33394;
    double zs_res_107134 = futhark_mc_task_128513->free_zs_res_107134;
    struct memblock mem_param_120061 = {.desc ="mem_param_120061", .mem =futhark_mc_task_128513->free_mem_param_120061, .size =0, .references =NULL};
    struct memblock mem_120071 = {.desc ="mem_120071", .mem =futhark_mc_task_128513->free_mem_120071, .size =0, .references =NULL};
    int64_t ext_120172 = futhark_mc_task_128513->free_ext_120172;
    int64_t ext_120173 = futhark_mc_task_128513->free_ext_120173;
    int64_t ext_120174 = futhark_mc_task_128513->free_ext_120174;
    struct memblock ext_mem_120180 = {.desc ="ext_mem_120180", .mem =futhark_mc_task_128513->free_ext_mem_120180, .size =0, .references =NULL};
    struct memblock mem_120233 = {.desc ="mem_120233", .mem =futhark_mc_task_128513->free_mem_120233, .size =0, .references =NULL};
    struct memblock mem_120234 = {.desc ="mem_120234", .mem =futhark_mc_task_128513->free_mem_120234, .size =0, .references =NULL};
    struct memblock mem_120235 = {.desc ="mem_120235", .mem =futhark_mc_task_128513->free_mem_120235, .size =0, .references =NULL};
    int64_t bytes_120242 = futhark_mc_task_128513->free_bytes_120242;
    int32_t nsubtasks_124880;
    
    nsubtasks_124880 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_128515 futhark_mc_segmap_parloop_struct_128515_;
    
    futhark_mc_segmap_parloop_struct_128515_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_128515_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_128515_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segmap_parloop_struct_128515_.free_zs_res_107134 = zs_res_107134;
    futhark_mc_segmap_parloop_struct_128515_.free_mem_param_120061 = mem_param_120061.mem;
    futhark_mc_segmap_parloop_struct_128515_.free_mem_120071 = mem_120071.mem;
    futhark_mc_segmap_parloop_struct_128515_.free_ext_120172 = ext_120172;
    futhark_mc_segmap_parloop_struct_128515_.free_ext_120173 = ext_120173;
    futhark_mc_segmap_parloop_struct_128515_.free_ext_120174 = ext_120174;
    futhark_mc_segmap_parloop_struct_128515_.free_ext_mem_120180 = ext_mem_120180.mem;
    futhark_mc_segmap_parloop_struct_128515_.free_mem_120233 = mem_120233.mem;
    futhark_mc_segmap_parloop_struct_128515_.free_mem_120234 = mem_120234.mem;
    futhark_mc_segmap_parloop_struct_128515_.free_mem_120235 = mem_120235.mem;
    futhark_mc_segmap_parloop_struct_128515_.free_bytes_120242 = bytes_120242;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_128516_task;
    
    futhark_mc_segmap_parloop_128516_task.name = "futhark_mc_segmap_parloop_128516";
    futhark_mc_segmap_parloop_128516_task.fn = futhark_mc_segmap_parloop_128516;
    futhark_mc_segmap_parloop_128516_task.args = &futhark_mc_segmap_parloop_struct_128515_;
    futhark_mc_segmap_parloop_128516_task.iterations = iterations;
    futhark_mc_segmap_parloop_128516_task.info = info;
    
    struct mc_event *event_128518 = mc_event_new(ctx);
    
    if (event_128518 != NULL)
        event_128518->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_128516_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_128516_task);
    
    if (futhark_mc_segmap_parloop_128516_err != 0) {
        err = futhark_mc_segmap_parloop_128516_err;
        goto cleanup;
    }
    if (event_128518 != NULL) {
        event_128518->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128516_total", strdup("nothing further"), event_128518, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_128519 != NULL) {
        event_128519->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_task_128514", strdup("nothing further"), event_128519, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_128520 {
    struct futhark_context *ctx;
    unsigned char *free_ext_mem_120178;
    int64_t free_flat_tid_120278;
    bool *retval_defunc_0_reduce_res_120277;
};
struct futhark_mc_segred_stage_1_parloop_struct_128523 {
    struct futhark_context *ctx;
    unsigned char *free_ext_mem_120178;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124900;
};
static int futhark_mc_segred_stage_1_parloop_128524(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128523 *futhark_mc_segred_stage_1_parloop_struct_128523 = (struct futhark_mc_segred_stage_1_parloop_struct_128523 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128523->ctx;
    struct mc_event *event_128525 = mc_event_new(ctx);
    
    if (event_128525 != NULL)
        event_128525->bef = get_wall_time();
    
    struct memblock ext_mem_120178 = {.desc ="ext_mem_120178", .mem =futhark_mc_segred_stage_1_parloop_struct_128523->free_ext_mem_120178, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_124900 = {.desc ="reduce_stage_1_tid_res_arr_mem_124900", .mem =futhark_mc_segred_stage_1_parloop_struct_128523->free_reduce_stage_1_tid_res_arr_mem_124900, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_120278;
    
    flat_tid_120278 = subtask_id;
    {
        bool eta_p_124902;
        bool eta_p_124903;
        bool local_acc_124905 = 1;
        bool eta_p_120280;
        bool eta_p_120281;
        bool local_acc_124906 = 1;
        int64_t start_124907;
        int64_t end_124908;
        
        start_124907 = start;
        end_124908 = end;
        
        int64_t n_124909 = end_124908 - start_124907;
        
        for (int64_t SegRed_i_124910 = start_124907; SegRed_i_124910 < start_124907 + n_124909; SegRed_i_124910++) {
            int64_t gtid_120279 = SegRed_i_124910;
            double eta_p_120283 = ((double *) ext_mem_120178.mem)[gtid_120279];
            bool isnan_res_120284 = futrts_isnan64(eta_p_120283);
            bool not_res_120285 = !isnan_res_120284;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_120280 = local_acc_124906;
            }
            // Load next params
            {
                eta_p_120281 = not_res_120285;
            }
            // SegRed body
            {
                bool x_120282 = eta_p_120280 && eta_p_120281;
                
                local_acc_124906 = x_120282;
            }
        }
        
        int64_t uni_i_124911 = 0;
        
        {
            int64_t gtid_120279 = uni_i_124911;
            
            // Load accum params
            {
                eta_p_124902 = local_acc_124905;
            }
            // Load next params
            {
                eta_p_124903 = local_acc_124906;
            }
            // SegRed body
            {
                bool x_124904 = eta_p_124902 && eta_p_124903;
                
                local_acc_124905 = x_124904;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_124900.mem)[flat_tid_120278] = local_acc_124905;
    }
    
  cleanup:
    { }
    if (event_128525 != NULL) {
        event_128525->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128524", strdup("nothing further"), event_128525, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128521(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128520 *futhark_mc_task_128520 = (struct futhark_mc_task_128520 *) args;
    struct futhark_context *ctx = futhark_mc_task_128520->ctx;
    struct mc_event *event_128527 = mc_event_new(ctx);
    
    if (event_128527 != NULL)
        event_128527->bef = get_wall_time();
    
    struct memblock ext_mem_120178 = {.desc ="ext_mem_120178", .mem =futhark_mc_task_128520->free_ext_mem_120178, .size =0, .references =NULL};
    int64_t flat_tid_120278 = futhark_mc_task_128520->free_flat_tid_120278;
    bool defunc_0_reduce_res_120277 = *futhark_mc_task_128520->retval_defunc_0_reduce_res_120277;
    int64_t reduce_stage_1_tid_res_arr_mem_124900_cached_sizze_128522 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124900 = NULL;
    int32_t nsubtasks_124899;
    
    nsubtasks_124899 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124900_cached_sizze_128522 < nsubtasks_124899) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124900, &reduce_stage_1_tid_res_arr_mem_124900_cached_sizze_128522, nsubtasks_124899);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128523 futhark_mc_segred_stage_1_parloop_struct_128523_;
    
    futhark_mc_segred_stage_1_parloop_struct_128523_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128523_.free_ext_mem_120178 = ext_mem_120178.mem;
    futhark_mc_segred_stage_1_parloop_struct_128523_.free_reduce_stage_1_tid_res_arr_mem_124900 = reduce_stage_1_tid_res_arr_mem_124900;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128524_task;
    
    futhark_mc_segred_stage_1_parloop_128524_task.name = "futhark_mc_segred_stage_1_parloop_128524";
    futhark_mc_segred_stage_1_parloop_128524_task.fn = futhark_mc_segred_stage_1_parloop_128524;
    futhark_mc_segred_stage_1_parloop_128524_task.args = &futhark_mc_segred_stage_1_parloop_struct_128523_;
    futhark_mc_segred_stage_1_parloop_128524_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128524_task.info = info;
    
    struct mc_event *event_128526 = mc_event_new(ctx);
    
    if (event_128526 != NULL)
        event_128526->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128524_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128524_task);
    
    if (futhark_mc_segred_stage_1_parloop_128524_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128524_err;
        goto cleanup;
    }
    if (event_128526 != NULL) {
        event_128526->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128524_total", strdup("nothing further"), event_128526, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_120277 = 1;
    }
    
    bool eta_p_124912;
    bool eta_p_124913;
    
    for (int32_t i_124915 = 0; i_124915 < nsubtasks_124899; i_124915++) {
        flat_tid_120278 = i_124915;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124912 = defunc_0_reduce_res_120277;
            }
            // load next params
            {
                eta_p_124913 = ((bool *) reduce_stage_1_tid_res_arr_mem_124900)[flat_tid_120278];
            }
            // red body
            {
                bool x_124914 = eta_p_124912 && eta_p_124913;
                
                defunc_0_reduce_res_120277 = x_124914;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124900);
    }
    if (event_128527 != NULL) {
        event_128527->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128521", strdup("nothing further"), event_128527, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128520->retval_defunc_0_reduce_res_120277 = defunc_0_reduce_res_120277;
    }
    return err;
}
struct futhark_mc_task_128528 {
    struct futhark_context *ctx;
    double free_zp_res_108112;
    unsigned char *free_mem_param_120058;
    unsigned char *free_ext_mem_120178;
    int64_t free_flat_tid_120287;
    bool *retval_defunc_0_reduce_comm_res_120286;
};
struct futhark_mc_segred_stage_1_parloop_struct_128531 {
    struct futhark_context *ctx;
    double free_zp_res_108112;
    unsigned char *free_mem_param_120058;
    unsigned char *free_ext_mem_120178;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124917;
};
static int futhark_mc_segred_stage_1_parloop_128532(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128531 *futhark_mc_segred_stage_1_parloop_struct_128531 = (struct futhark_mc_segred_stage_1_parloop_struct_128531 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128531->ctx;
    struct mc_event *event_128533 = mc_event_new(ctx);
    
    if (event_128533 != NULL)
        event_128533->bef = get_wall_time();
    
    double zp_res_108112 = futhark_mc_segred_stage_1_parloop_struct_128531->free_zp_res_108112;
    struct memblock mem_param_120058 = {.desc ="mem_param_120058", .mem =futhark_mc_segred_stage_1_parloop_struct_128531->free_mem_param_120058, .size =0, .references =NULL};
    struct memblock ext_mem_120178 = {.desc ="ext_mem_120178", .mem =futhark_mc_segred_stage_1_parloop_struct_128531->free_ext_mem_120178, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_124917 = {.desc ="reduce_stage_1_tid_res_arr_mem_124917", .mem =futhark_mc_segred_stage_1_parloop_struct_128531->free_reduce_stage_1_tid_res_arr_mem_124917, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_120287;
    
    flat_tid_120287 = subtask_id;
    {
        bool eta_p_124919;
        bool eta_p_124920;
        bool local_acc_124922 = 0;
        bool eta_p_120289;
        bool eta_p_120290;
        bool local_acc_124923 = 0;
        int64_t start_124924;
        int64_t end_124925;
        
        start_124924 = start;
        end_124925 = end;
        
        int64_t n_124926 = end_124925 - start_124924;
        
        for (int64_t SegRed_i_124927 = start_124924; SegRed_i_124927 < start_124924 + n_124926; SegRed_i_124927++) {
            int64_t gtid_120288 = SegRed_i_124927;
            double eta_p_120292 = ((double *) ext_mem_120178.mem)[gtid_120288];
            double eta_p_120293 = ((double *) mem_param_120058.mem)[gtid_120288];
            double zt_res_120294 = zp_res_108112 * eta_p_120292;
            bool zgze_res_120295 = eta_p_120293 <= zt_res_120294;
            double zt_res_120296 = zp_res_108112 * eta_p_120293;
            bool zgze_res_120297 = eta_p_120292 <= zt_res_120296;
            bool x_120298 = zgze_res_120295 && zgze_res_120297;
            bool not_res_120299 = !x_120298;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_120289 = local_acc_124923;
            }
            // Load next params
            {
                eta_p_120290 = not_res_120299;
            }
            // SegRed body
            {
                bool defunc_0_op_res_120291 = eta_p_120289 || eta_p_120290;
                
                local_acc_124923 = defunc_0_op_res_120291;
            }
        }
        
        int64_t uni_i_124928 = 0;
        
        {
            int64_t gtid_120288 = uni_i_124928;
            
            // Load accum params
            {
                eta_p_124919 = local_acc_124922;
            }
            // Load next params
            {
                eta_p_124920 = local_acc_124923;
            }
            // SegRed body
            {
                bool defunc_0_op_res_124921 = eta_p_124919 || eta_p_124920;
                
                local_acc_124922 = defunc_0_op_res_124921;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_124917.mem)[flat_tid_120287] = local_acc_124922;
    }
    
  cleanup:
    { }
    if (event_128533 != NULL) {
        event_128533->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128532", strdup("nothing further"), event_128533, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128529(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128528 *futhark_mc_task_128528 = (struct futhark_mc_task_128528 *) args;
    struct futhark_context *ctx = futhark_mc_task_128528->ctx;
    struct mc_event *event_128535 = mc_event_new(ctx);
    
    if (event_128535 != NULL)
        event_128535->bef = get_wall_time();
    
    double zp_res_108112 = futhark_mc_task_128528->free_zp_res_108112;
    struct memblock mem_param_120058 = {.desc ="mem_param_120058", .mem =futhark_mc_task_128528->free_mem_param_120058, .size =0, .references =NULL};
    struct memblock ext_mem_120178 = {.desc ="ext_mem_120178", .mem =futhark_mc_task_128528->free_ext_mem_120178, .size =0, .references =NULL};
    int64_t flat_tid_120287 = futhark_mc_task_128528->free_flat_tid_120287;
    bool defunc_0_reduce_comm_res_120286 = *futhark_mc_task_128528->retval_defunc_0_reduce_comm_res_120286;
    int64_t reduce_stage_1_tid_res_arr_mem_124917_cached_sizze_128530 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124917 = NULL;
    int32_t nsubtasks_124916;
    
    nsubtasks_124916 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124917_cached_sizze_128530 < nsubtasks_124916) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124917, &reduce_stage_1_tid_res_arr_mem_124917_cached_sizze_128530, nsubtasks_124916);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128531 futhark_mc_segred_stage_1_parloop_struct_128531_;
    
    futhark_mc_segred_stage_1_parloop_struct_128531_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128531_.free_zp_res_108112 = zp_res_108112;
    futhark_mc_segred_stage_1_parloop_struct_128531_.free_mem_param_120058 = mem_param_120058.mem;
    futhark_mc_segred_stage_1_parloop_struct_128531_.free_ext_mem_120178 = ext_mem_120178.mem;
    futhark_mc_segred_stage_1_parloop_struct_128531_.free_reduce_stage_1_tid_res_arr_mem_124917 = reduce_stage_1_tid_res_arr_mem_124917;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128532_task;
    
    futhark_mc_segred_stage_1_parloop_128532_task.name = "futhark_mc_segred_stage_1_parloop_128532";
    futhark_mc_segred_stage_1_parloop_128532_task.fn = futhark_mc_segred_stage_1_parloop_128532;
    futhark_mc_segred_stage_1_parloop_128532_task.args = &futhark_mc_segred_stage_1_parloop_struct_128531_;
    futhark_mc_segred_stage_1_parloop_128532_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128532_task.info = info;
    
    struct mc_event *event_128534 = mc_event_new(ctx);
    
    if (event_128534 != NULL)
        event_128534->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128532_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128532_task);
    
    if (futhark_mc_segred_stage_1_parloop_128532_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128532_err;
        goto cleanup;
    }
    if (event_128534 != NULL) {
        event_128534->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128532_total", strdup("nothing further"), event_128534, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_comm_res_120286 = 0;
    }
    
    bool eta_p_124929;
    bool eta_p_124930;
    
    for (int32_t i_124932 = 0; i_124932 < nsubtasks_124916; i_124932++) {
        flat_tid_120287 = i_124932;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124929 = defunc_0_reduce_comm_res_120286;
            }
            // load next params
            {
                eta_p_124930 = ((bool *) reduce_stage_1_tid_res_arr_mem_124917)[flat_tid_120287];
            }
            // red body
            {
                bool defunc_0_op_res_124931 = eta_p_124929 || eta_p_124930;
                
                defunc_0_reduce_comm_res_120286 = defunc_0_op_res_124931;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124917);
    }
    if (event_128535 != NULL) {
        event_128535->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128529", strdup("nothing further"), event_128535, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128528->retval_defunc_0_reduce_comm_res_120286 = defunc_0_reduce_comm_res_120286;
    }
    return err;
}
struct futhark_mc_task_128536 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_bytes_111715;
    unsigned char *free_ext_mem_119810;
    int64_t free_ext_119811;
    int64_t free_ext_119812;
    int64_t free_ext_119813;
    unsigned char *free_ext_mem_119814;
    unsigned char *free_ext_mem_119815;
    unsigned char *free_ext_mem_119816;
    unsigned char *free_ext_mem_119817;
    int64_t free_flat_tid_120307;
    int64_t free_flat_tid_120332;
    double *retval_defunc_res_120303;
    unsigned char *retval_mem_120301;
    unsigned char *retval_mem_112403;
    unsigned char *retval_mem_120302;
};
struct futhark_mc_segred_stage_1_parloop_struct_128539 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_bytes_111715;
    unsigned char *free_mem_112403;
    unsigned char *free_ext_mem_119810;
    int64_t free_ext_119811;
    int64_t free_ext_119812;
    int64_t free_ext_119813;
    unsigned char *free_ext_mem_119814;
    unsigned char *free_ext_mem_119815;
    unsigned char *free_ext_mem_119816;
    unsigned char *free_ext_mem_119817;
    unsigned char *free_mem_120301;
    unsigned char *free_mem_120302;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124934;
};
static int futhark_mc_segred_stage_1_parloop_128540(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128539 *futhark_mc_segred_stage_1_parloop_struct_128539 = (struct futhark_mc_segred_stage_1_parloop_struct_128539 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128539->ctx;
    struct mc_event *event_128542 = mc_event_new(ctx);
    
    if (event_128542 != NULL)
        event_128542->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128539->free_m_33388;
    int64_t bytes_111715 = futhark_mc_segred_stage_1_parloop_struct_128539->free_bytes_111715;
    struct memblock mem_112403 = {.desc ="mem_112403", .mem =futhark_mc_segred_stage_1_parloop_struct_128539->free_mem_112403, .size =0, .references =NULL};
    struct memblock ext_mem_119810 = {.desc ="ext_mem_119810", .mem =futhark_mc_segred_stage_1_parloop_struct_128539->free_ext_mem_119810, .size =0, .references =NULL};
    int64_t ext_119811 = futhark_mc_segred_stage_1_parloop_struct_128539->free_ext_119811;
    int64_t ext_119812 = futhark_mc_segred_stage_1_parloop_struct_128539->free_ext_119812;
    int64_t ext_119813 = futhark_mc_segred_stage_1_parloop_struct_128539->free_ext_119813;
    struct memblock ext_mem_119814 = {.desc ="ext_mem_119814", .mem =futhark_mc_segred_stage_1_parloop_struct_128539->free_ext_mem_119814, .size =0, .references =NULL};
    struct memblock ext_mem_119815 = {.desc ="ext_mem_119815", .mem =futhark_mc_segred_stage_1_parloop_struct_128539->free_ext_mem_119815, .size =0, .references =NULL};
    struct memblock ext_mem_119816 = {.desc ="ext_mem_119816", .mem =futhark_mc_segred_stage_1_parloop_struct_128539->free_ext_mem_119816, .size =0, .references =NULL};
    struct memblock ext_mem_119817 = {.desc ="ext_mem_119817", .mem =futhark_mc_segred_stage_1_parloop_struct_128539->free_ext_mem_119817, .size =0, .references =NULL};
    struct memblock mem_120301 = {.desc ="mem_120301", .mem =futhark_mc_segred_stage_1_parloop_struct_128539->free_mem_120301, .size =0, .references =NULL};
    struct memblock mem_120302 = {.desc ="mem_120302", .mem =futhark_mc_segred_stage_1_parloop_struct_128539->free_mem_120302, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_124934 = {.desc ="reduce_stage_1_tid_res_arr_mem_124934", .mem =futhark_mc_segred_stage_1_parloop_struct_128539->free_reduce_stage_1_tid_res_arr_mem_124934, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t mem_120343_cached_sizze_128541 = 0;
    unsigned char *mem_120343 = NULL;
    int64_t flat_tid_120332;
    
    flat_tid_120332 = subtask_id;
    {
        double eta_p_124936;
        double eta_p_124937;
        double local_acc_124939 = 0.0;
        double eta_p_120334;
        double eta_p_120335;
        double local_acc_124940 = 0.0;
        int64_t start_124941;
        int64_t end_124942;
        
        start_124941 = start;
        end_124942 = end;
        
        int64_t n_124943 = end_124942 - start_124941;
        
        if (mem_120343_cached_sizze_128541 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_120343, &mem_120343_cached_sizze_128541, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        for (int64_t SegRed_i_124944 = start_124941; SegRed_i_124944 < start_124941 + n_124943; SegRed_i_124944++) {
            int64_t gtid_120333 = SegRed_i_124944;
            double eta_p_120337 = ((double *) ext_mem_119815.mem)[gtid_120333];
            double eta_p_120338 = ((double *) ext_mem_119817.mem)[gtid_120333];
            double eta_p_120339 = ((double *) ext_mem_119814.mem)[gtid_120333];
            double eta_p_120340 = ((double *) ext_mem_119816.mem)[gtid_120333];
            double log_res_120341 = futrts_log64(eta_p_120339);
            double zp_res_120342 = eta_p_120340 + log_res_120341;
            double defunc_res_120345;
            double redout_120348 = 0.0;
            
            for (int64_t i_120347 = 0; i_120347 < m_33388; i_120347++) {
                double eta_p_120350 = ((double *) ext_mem_119810.mem)[ext_119811 + (gtid_120333 * ext_119812 + i_120347 * ext_119813)];
                double eta_p_wasfree_120351 = ((double *) ext_mem_119815.mem)[i_120347];
                double zt_res_120352 = eta_p_120339 * eta_p_120350;
                double zt_res_120353 = eta_p_wasfree_120351 * zt_res_120352;
                double zp_res_120354 = zt_res_120353 + redout_120348;
                
                ((double *) mem_120343)[i_120347] = zt_res_120353;
                
                double redout_tmp_124945 = zp_res_120354;
                
                redout_120348 = redout_tmp_124945;
            }
            defunc_res_120345 = redout_120348;
            
            double log_res_120356 = futrts_log64(eta_p_120337);
            double zp_res_120357 = eta_p_120338 + log_res_120356;
            
            // save map-out results
            {
                ((double *) mem_120301.mem)[gtid_120333] = zp_res_120357;
                lmad_copy_8b(ctx, 1, (uint64_t *) mem_112403.mem, gtid_120333 * m_33388, (int64_t []) {(int64_t) 1}, (uint64_t *) mem_120343, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_33388});
                ((double *) mem_120302.mem)[gtid_120333] = zp_res_120342;
            }
            // Load accum params
            {
                eta_p_120334 = local_acc_124940;
            }
            // Load next params
            {
                eta_p_120335 = defunc_res_120345;
            }
            // SegRed body
            {
                double zp_res_120336 = eta_p_120334 + eta_p_120335;
                
                local_acc_124940 = zp_res_120336;
            }
        }
        
        int64_t uni_i_124947 = 0;
        
        {
            int64_t gtid_120333 = uni_i_124947;
            
            // Load accum params
            {
                eta_p_124936 = local_acc_124939;
            }
            // Load next params
            {
                eta_p_124937 = local_acc_124940;
            }
            // SegRed body
            {
                double zp_res_124938 = eta_p_124936 + eta_p_124937;
                
                local_acc_124939 = zp_res_124938;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_124934.mem)[flat_tid_120332] = local_acc_124939;
    }
    
  cleanup:
    {
        free(mem_120343);
    }
    if (event_128542 != NULL) {
        event_128542->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128540", strdup("nothing further"), event_128542, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128537(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128536 *futhark_mc_task_128536 = (struct futhark_mc_task_128536 *) args;
    struct futhark_context *ctx = futhark_mc_task_128536->ctx;
    struct mc_event *event_128544 = mc_event_new(ctx);
    
    if (event_128544 != NULL)
        event_128544->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128536->free_m_33388;
    int64_t bytes_111715 = futhark_mc_task_128536->free_bytes_111715;
    struct memblock ext_mem_119810 = {.desc ="ext_mem_119810", .mem =futhark_mc_task_128536->free_ext_mem_119810, .size =0, .references =NULL};
    int64_t ext_119811 = futhark_mc_task_128536->free_ext_119811;
    int64_t ext_119812 = futhark_mc_task_128536->free_ext_119812;
    int64_t ext_119813 = futhark_mc_task_128536->free_ext_119813;
    struct memblock ext_mem_119814 = {.desc ="ext_mem_119814", .mem =futhark_mc_task_128536->free_ext_mem_119814, .size =0, .references =NULL};
    struct memblock ext_mem_119815 = {.desc ="ext_mem_119815", .mem =futhark_mc_task_128536->free_ext_mem_119815, .size =0, .references =NULL};
    struct memblock ext_mem_119816 = {.desc ="ext_mem_119816", .mem =futhark_mc_task_128536->free_ext_mem_119816, .size =0, .references =NULL};
    struct memblock ext_mem_119817 = {.desc ="ext_mem_119817", .mem =futhark_mc_task_128536->free_ext_mem_119817, .size =0, .references =NULL};
    int64_t flat_tid_120307 = futhark_mc_task_128536->free_flat_tid_120307;
    int64_t flat_tid_120332 = futhark_mc_task_128536->free_flat_tid_120332;
    double defunc_res_120303 = *futhark_mc_task_128536->retval_defunc_res_120303;
    struct memblock mem_120301 = {.desc ="mem_120301", .mem =futhark_mc_task_128536->retval_mem_120301, .size =0, .references =NULL};
    struct memblock mem_112403 = {.desc ="mem_112403", .mem =futhark_mc_task_128536->retval_mem_112403, .size =0, .references =NULL};
    struct memblock mem_120302 = {.desc ="mem_120302", .mem =futhark_mc_task_128536->retval_mem_120302, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_124934_cached_sizze_128538 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124934 = NULL;
    int32_t nsubtasks_124933;
    
    nsubtasks_124933 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124934_cached_sizze_128538 < (int64_t) 8 * nsubtasks_124933) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124934, &reduce_stage_1_tid_res_arr_mem_124934_cached_sizze_128538, (int64_t) 8 * nsubtasks_124933);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128539 futhark_mc_segred_stage_1_parloop_struct_128539_;
    
    futhark_mc_segred_stage_1_parloop_struct_128539_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128539_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128539_.free_bytes_111715 = bytes_111715;
    futhark_mc_segred_stage_1_parloop_struct_128539_.free_mem_112403 = mem_112403.mem;
    futhark_mc_segred_stage_1_parloop_struct_128539_.free_ext_mem_119810 = ext_mem_119810.mem;
    futhark_mc_segred_stage_1_parloop_struct_128539_.free_ext_119811 = ext_119811;
    futhark_mc_segred_stage_1_parloop_struct_128539_.free_ext_119812 = ext_119812;
    futhark_mc_segred_stage_1_parloop_struct_128539_.free_ext_119813 = ext_119813;
    futhark_mc_segred_stage_1_parloop_struct_128539_.free_ext_mem_119814 = ext_mem_119814.mem;
    futhark_mc_segred_stage_1_parloop_struct_128539_.free_ext_mem_119815 = ext_mem_119815.mem;
    futhark_mc_segred_stage_1_parloop_struct_128539_.free_ext_mem_119816 = ext_mem_119816.mem;
    futhark_mc_segred_stage_1_parloop_struct_128539_.free_ext_mem_119817 = ext_mem_119817.mem;
    futhark_mc_segred_stage_1_parloop_struct_128539_.free_mem_120301 = mem_120301.mem;
    futhark_mc_segred_stage_1_parloop_struct_128539_.free_mem_120302 = mem_120302.mem;
    futhark_mc_segred_stage_1_parloop_struct_128539_.free_reduce_stage_1_tid_res_arr_mem_124934 = reduce_stage_1_tid_res_arr_mem_124934;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128540_task;
    
    futhark_mc_segred_stage_1_parloop_128540_task.name = "futhark_mc_segred_stage_1_parloop_128540";
    futhark_mc_segred_stage_1_parloop_128540_task.fn = futhark_mc_segred_stage_1_parloop_128540;
    futhark_mc_segred_stage_1_parloop_128540_task.args = &futhark_mc_segred_stage_1_parloop_struct_128539_;
    futhark_mc_segred_stage_1_parloop_128540_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128540_task.info = info;
    
    struct mc_event *event_128543 = mc_event_new(ctx);
    
    if (event_128543 != NULL)
        event_128543->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128540_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128540_task);
    
    if (futhark_mc_segred_stage_1_parloop_128540_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128540_err;
        goto cleanup;
    }
    if (event_128543 != NULL) {
        event_128543->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128540_total", strdup("nothing further"), event_128543, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_120303 = 0.0;
    }
    
    double eta_p_124948;
    double eta_p_124949;
    
    for (int32_t i_124951 = 0; i_124951 < nsubtasks_124933; i_124951++) {
        flat_tid_120332 = i_124951;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124948 = defunc_res_120303;
            }
            // load next params
            {
                eta_p_124949 = ((double *) reduce_stage_1_tid_res_arr_mem_124934)[flat_tid_120332];
            }
            // red body
            {
                double zp_res_124950 = eta_p_124948 + eta_p_124949;
                
                defunc_res_120303 = zp_res_124950;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124934);
    }
    if (event_128544 != NULL) {
        event_128544->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128537", strdup("nothing further"), event_128544, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128536->retval_defunc_res_120303 = defunc_res_120303;
        futhark_mc_task_128536->retval_mem_120301 = mem_120301.mem;
        futhark_mc_task_128536->retval_mem_112403 = mem_112403.mem;
        futhark_mc_task_128536->retval_mem_120302 = mem_120302.mem;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_128547 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_bytes_111715;
    unsigned char *free_mem_112403;
    unsigned char *free_ext_mem_119810;
    int64_t free_ext_119811;
    int64_t free_ext_119812;
    int64_t free_ext_119813;
    unsigned char *free_ext_mem_119814;
    unsigned char *free_ext_mem_119815;
    unsigned char *free_ext_mem_119816;
    unsigned char *free_ext_mem_119817;
    unsigned char *free_mem_120301;
    unsigned char *free_mem_120302;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124953;
};
struct futhark_mc_task_128550 {
    struct futhark_context *ctx;
    unsigned char *free_ext_mem_119810;
    int64_t free_ext_119811;
    int64_t free_ext_119812;
    int64_t free_ext_119813;
    unsigned char *free_ext_mem_119815;
    int64_t free_gtid_120308;
    double free_eta_p_120314;
    int64_t free_flat_tid_120321;
    double *retval_defunc_res_120319;
    unsigned char *retval_mem_120318;
};
struct futhark_mc_segred_stage_1_parloop_struct_128553 {
    struct futhark_context *ctx;
    unsigned char *free_ext_mem_119810;
    int64_t free_ext_119811;
    int64_t free_ext_119812;
    int64_t free_ext_119813;
    unsigned char *free_ext_mem_119815;
    int64_t free_gtid_120308;
    double free_eta_p_120314;
    unsigned char *free_mem_120318;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124965;
};
static int futhark_mc_segred_stage_1_parloop_128554(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128553 *futhark_mc_segred_stage_1_parloop_struct_128553 = (struct futhark_mc_segred_stage_1_parloop_struct_128553 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128553->ctx;
    struct mc_event *event_128555 = mc_event_new(ctx);
    
    if (event_128555 != NULL)
        event_128555->bef = get_wall_time();
    
    struct memblock ext_mem_119810 = {.desc ="ext_mem_119810", .mem =futhark_mc_segred_stage_1_parloop_struct_128553->free_ext_mem_119810, .size =0, .references =NULL};
    int64_t ext_119811 = futhark_mc_segred_stage_1_parloop_struct_128553->free_ext_119811;
    int64_t ext_119812 = futhark_mc_segred_stage_1_parloop_struct_128553->free_ext_119812;
    int64_t ext_119813 = futhark_mc_segred_stage_1_parloop_struct_128553->free_ext_119813;
    struct memblock ext_mem_119815 = {.desc ="ext_mem_119815", .mem =futhark_mc_segred_stage_1_parloop_struct_128553->free_ext_mem_119815, .size =0, .references =NULL};
    int64_t gtid_120308 = futhark_mc_segred_stage_1_parloop_struct_128553->free_gtid_120308;
    double eta_p_120314 = futhark_mc_segred_stage_1_parloop_struct_128553->free_eta_p_120314;
    struct memblock mem_120318 = {.desc ="mem_120318", .mem =futhark_mc_segred_stage_1_parloop_struct_128553->free_mem_120318, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_124965 = {.desc ="reduce_stage_1_tid_res_arr_mem_124965", .mem =futhark_mc_segred_stage_1_parloop_struct_128553->free_reduce_stage_1_tid_res_arr_mem_124965, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_120321;
    
    flat_tid_120321 = subtask_id;
    {
        double eta_p_124967;
        double eta_p_124968;
        double local_acc_124970 = 0.0;
        double eta_p_120323;
        double eta_p_120324;
        double local_acc_124971 = 0.0;
        int64_t start_124972;
        int64_t end_124973;
        
        start_124972 = start;
        end_124973 = end;
        
        int64_t n_124974 = end_124973 - start_124972;
        
        for (int64_t SegRed_i_124975 = start_124972; SegRed_i_124975 < start_124972 + n_124974; SegRed_i_124975++) {
            int64_t gtid_120322 = SegRed_i_124975;
            double eta_p_120326 = ((double *) ext_mem_119810.mem)[ext_119811 + (gtid_120308 * ext_119812 + gtid_120322 * ext_119813)];
            double eta_p_wasfree_120327 = ((double *) ext_mem_119815.mem)[gtid_120322];
            double zt_res_120328 = eta_p_120314 * eta_p_120326;
            double zt_res_120329 = eta_p_wasfree_120327 * zt_res_120328;
            
            // save map-out results
            {
                ((double *) mem_120318.mem)[gtid_120322] = zt_res_120329;
            }
            // Load accum params
            {
                eta_p_120323 = local_acc_124971;
            }
            // Load next params
            {
                eta_p_120324 = zt_res_120329;
            }
            // SegRed body
            {
                double zp_res_120325 = eta_p_120323 + eta_p_120324;
                
                local_acc_124971 = zp_res_120325;
            }
        }
        
        int64_t uni_i_124976 = 0;
        
        {
            int64_t gtid_120322 = uni_i_124976;
            
            // Load accum params
            {
                eta_p_124967 = local_acc_124970;
            }
            // Load next params
            {
                eta_p_124968 = local_acc_124971;
            }
            // SegRed body
            {
                double zp_res_124969 = eta_p_124967 + eta_p_124968;
                
                local_acc_124970 = zp_res_124969;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_124965.mem)[flat_tid_120321] = local_acc_124970;
    }
    
  cleanup:
    { }
    if (event_128555 != NULL) {
        event_128555->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128554", strdup("nothing further"), event_128555, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128551(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128550 *futhark_mc_task_128550 = (struct futhark_mc_task_128550 *) args;
    struct futhark_context *ctx = futhark_mc_task_128550->ctx;
    struct mc_event *event_128557 = mc_event_new(ctx);
    
    if (event_128557 != NULL)
        event_128557->bef = get_wall_time();
    
    struct memblock ext_mem_119810 = {.desc ="ext_mem_119810", .mem =futhark_mc_task_128550->free_ext_mem_119810, .size =0, .references =NULL};
    int64_t ext_119811 = futhark_mc_task_128550->free_ext_119811;
    int64_t ext_119812 = futhark_mc_task_128550->free_ext_119812;
    int64_t ext_119813 = futhark_mc_task_128550->free_ext_119813;
    struct memblock ext_mem_119815 = {.desc ="ext_mem_119815", .mem =futhark_mc_task_128550->free_ext_mem_119815, .size =0, .references =NULL};
    int64_t gtid_120308 = futhark_mc_task_128550->free_gtid_120308;
    double eta_p_120314 = futhark_mc_task_128550->free_eta_p_120314;
    int64_t flat_tid_120321 = futhark_mc_task_128550->free_flat_tid_120321;
    double defunc_res_120319 = *futhark_mc_task_128550->retval_defunc_res_120319;
    struct memblock mem_120318 = {.desc ="mem_120318", .mem =futhark_mc_task_128550->retval_mem_120318, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_124965_cached_sizze_128552 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124965 = NULL;
    int32_t nsubtasks_124964;
    
    nsubtasks_124964 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124965_cached_sizze_128552 < (int64_t) 8 * nsubtasks_124964) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124965, &reduce_stage_1_tid_res_arr_mem_124965_cached_sizze_128552, (int64_t) 8 * nsubtasks_124964);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128553 futhark_mc_segred_stage_1_parloop_struct_128553_;
    
    futhark_mc_segred_stage_1_parloop_struct_128553_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128553_.free_ext_mem_119810 = ext_mem_119810.mem;
    futhark_mc_segred_stage_1_parloop_struct_128553_.free_ext_119811 = ext_119811;
    futhark_mc_segred_stage_1_parloop_struct_128553_.free_ext_119812 = ext_119812;
    futhark_mc_segred_stage_1_parloop_struct_128553_.free_ext_119813 = ext_119813;
    futhark_mc_segred_stage_1_parloop_struct_128553_.free_ext_mem_119815 = ext_mem_119815.mem;
    futhark_mc_segred_stage_1_parloop_struct_128553_.free_gtid_120308 = gtid_120308;
    futhark_mc_segred_stage_1_parloop_struct_128553_.free_eta_p_120314 = eta_p_120314;
    futhark_mc_segred_stage_1_parloop_struct_128553_.free_mem_120318 = mem_120318.mem;
    futhark_mc_segred_stage_1_parloop_struct_128553_.free_reduce_stage_1_tid_res_arr_mem_124965 = reduce_stage_1_tid_res_arr_mem_124965;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128554_task;
    
    futhark_mc_segred_stage_1_parloop_128554_task.name = "futhark_mc_segred_stage_1_parloop_128554";
    futhark_mc_segred_stage_1_parloop_128554_task.fn = futhark_mc_segred_stage_1_parloop_128554;
    futhark_mc_segred_stage_1_parloop_128554_task.args = &futhark_mc_segred_stage_1_parloop_struct_128553_;
    futhark_mc_segred_stage_1_parloop_128554_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128554_task.info = info;
    
    struct mc_event *event_128556 = mc_event_new(ctx);
    
    if (event_128556 != NULL)
        event_128556->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128554_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128554_task);
    
    if (futhark_mc_segred_stage_1_parloop_128554_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128554_err;
        goto cleanup;
    }
    if (event_128556 != NULL) {
        event_128556->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128554_total", strdup("nothing further"), event_128556, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_120319 = 0.0;
    }
    
    double eta_p_124977;
    double eta_p_124978;
    
    for (int32_t i_124980 = 0; i_124980 < nsubtasks_124964; i_124980++) {
        flat_tid_120321 = i_124980;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124977 = defunc_res_120319;
            }
            // load next params
            {
                eta_p_124978 = ((double *) reduce_stage_1_tid_res_arr_mem_124965)[flat_tid_120321];
            }
            // red body
            {
                double zp_res_124979 = eta_p_124977 + eta_p_124978;
                
                defunc_res_120319 = zp_res_124979;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124965);
    }
    if (event_128557 != NULL) {
        event_128557->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128551", strdup("nothing further"), event_128557, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128550->retval_defunc_res_120319 = defunc_res_120319;
        futhark_mc_task_128550->retval_mem_120318 = mem_120318.mem;
    }
    return err;
}
struct futhark_mc_task_128558 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_112403;
    int64_t free_gtid_120308;
    unsigned char *free_mem_120318;
};
struct futhark_mc_copy_parloop_struct_128560 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_112403;
    int64_t free_gtid_120308;
    unsigned char *free_mem_120318;
};
static int futhark_mc_copy_parloop_128561(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_copy_parloop_struct_128560 *futhark_mc_copy_parloop_struct_128560 = (struct futhark_mc_copy_parloop_struct_128560 *) args;
    struct futhark_context *ctx = futhark_mc_copy_parloop_struct_128560->ctx;
    struct mc_event *event_128562 = mc_event_new(ctx);
    
    if (event_128562 != NULL)
        event_128562->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_copy_parloop_struct_128560->free_m_33388;
    struct memblock mem_112403 = {.desc ="mem_112403", .mem =futhark_mc_copy_parloop_struct_128560->free_mem_112403, .size =0, .references =NULL};
    int64_t gtid_120308 = futhark_mc_copy_parloop_struct_128560->free_gtid_120308;
    struct memblock mem_120318 = {.desc ="mem_120318", .mem =futhark_mc_copy_parloop_struct_128560->free_mem_120318, .size =0, .references =NULL};
    int64_t iterations = end - start;
    
    {
        int64_t start_124981;
        int64_t end_124982;
        
        start_124981 = start;
        end_124982 = end;
        
        int64_t n_124983 = end_124982 - start_124981;
        
        for (int64_t copy_i_124984 = start_124981; copy_i_124984 < start_124981 + n_124983; copy_i_124984++) {
            int64_t slice_124986 = m_33388;
            int64_t i_124985 = copy_i_124984;
            int64_t remnant_124987 = copy_i_124984 - i_124985;
            double tmp_124988 = ((double *) mem_120318.mem)[i_124985];
            
            ((double *) mem_112403.mem)[gtid_120308 * m_33388 + i_124985] = tmp_124988;
        }
    }
    
  cleanup:
    { }
    if (event_128562 != NULL) {
        event_128562->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_parloop_128561", strdup("nothing further"), event_128562, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_copy_124989_task_128559(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128558 *futhark_mc_task_128558 = (struct futhark_mc_task_128558 *) args;
    struct futhark_context *ctx = futhark_mc_task_128558->ctx;
    struct mc_event *event_128564 = mc_event_new(ctx);
    
    if (event_128564 != NULL)
        event_128564->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128558->free_m_33388;
    struct memblock mem_112403 = {.desc ="mem_112403", .mem =futhark_mc_task_128558->free_mem_112403, .size =0, .references =NULL};
    int64_t gtid_120308 = futhark_mc_task_128558->free_gtid_120308;
    struct memblock mem_120318 = {.desc ="mem_120318", .mem =futhark_mc_task_128558->free_mem_120318, .size =0, .references =NULL};
    struct futhark_mc_copy_parloop_struct_128560 futhark_mc_copy_parloop_struct_128560_;
    
    futhark_mc_copy_parloop_struct_128560_.ctx = ctx;
    futhark_mc_copy_parloop_struct_128560_.free_m_33388 = m_33388;
    futhark_mc_copy_parloop_struct_128560_.free_mem_112403 = mem_112403.mem;
    futhark_mc_copy_parloop_struct_128560_.free_gtid_120308 = gtid_120308;
    futhark_mc_copy_parloop_struct_128560_.free_mem_120318 = mem_120318.mem;
    
    struct scheduler_parloop futhark_mc_copy_parloop_128561_task;
    
    futhark_mc_copy_parloop_128561_task.name = "futhark_mc_copy_parloop_128561";
    futhark_mc_copy_parloop_128561_task.fn = futhark_mc_copy_parloop_128561;
    futhark_mc_copy_parloop_128561_task.args = &futhark_mc_copy_parloop_struct_128560_;
    futhark_mc_copy_parloop_128561_task.iterations = iterations;
    futhark_mc_copy_parloop_128561_task.info = info;
    
    struct mc_event *event_128563 = mc_event_new(ctx);
    
    if (event_128563 != NULL)
        event_128563->bef = get_wall_time();
    
    int futhark_mc_copy_parloop_128561_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_copy_parloop_128561_task);
    
    if (futhark_mc_copy_parloop_128561_err != 0) {
        err = futhark_mc_copy_parloop_128561_err;
        goto cleanup;
    }
    if (event_128563 != NULL) {
        event_128563->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_parloop_128561_total", strdup("nothing further"), event_128563, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_128564 != NULL) {
        event_128564->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_124989_task_128559", strdup("nothing further"), event_128564, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_128548(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128547 *futhark_mc_segred_stage_1_parloop_struct_128547 = (struct futhark_mc_segred_stage_1_parloop_struct_128547 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128547->ctx;
    struct mc_event *event_128565 = mc_event_new(ctx);
    
    if (event_128565 != NULL)
        event_128565->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128547->free_m_33388;
    int64_t bytes_111715 = futhark_mc_segred_stage_1_parloop_struct_128547->free_bytes_111715;
    struct memblock mem_112403 = {.desc ="mem_112403", .mem =futhark_mc_segred_stage_1_parloop_struct_128547->free_mem_112403, .size =0, .references =NULL};
    struct memblock ext_mem_119810 = {.desc ="ext_mem_119810", .mem =futhark_mc_segred_stage_1_parloop_struct_128547->free_ext_mem_119810, .size =0, .references =NULL};
    int64_t ext_119811 = futhark_mc_segred_stage_1_parloop_struct_128547->free_ext_119811;
    int64_t ext_119812 = futhark_mc_segred_stage_1_parloop_struct_128547->free_ext_119812;
    int64_t ext_119813 = futhark_mc_segred_stage_1_parloop_struct_128547->free_ext_119813;
    struct memblock ext_mem_119814 = {.desc ="ext_mem_119814", .mem =futhark_mc_segred_stage_1_parloop_struct_128547->free_ext_mem_119814, .size =0, .references =NULL};
    struct memblock ext_mem_119815 = {.desc ="ext_mem_119815", .mem =futhark_mc_segred_stage_1_parloop_struct_128547->free_ext_mem_119815, .size =0, .references =NULL};
    struct memblock ext_mem_119816 = {.desc ="ext_mem_119816", .mem =futhark_mc_segred_stage_1_parloop_struct_128547->free_ext_mem_119816, .size =0, .references =NULL};
    struct memblock ext_mem_119817 = {.desc ="ext_mem_119817", .mem =futhark_mc_segred_stage_1_parloop_struct_128547->free_ext_mem_119817, .size =0, .references =NULL};
    struct memblock mem_120301 = {.desc ="mem_120301", .mem =futhark_mc_segred_stage_1_parloop_struct_128547->free_mem_120301, .size =0, .references =NULL};
    struct memblock mem_120302 = {.desc ="mem_120302", .mem =futhark_mc_segred_stage_1_parloop_struct_128547->free_mem_120302, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_124953 = {.desc ="reduce_stage_1_tid_res_arr_mem_124953", .mem =futhark_mc_segred_stage_1_parloop_struct_128547->free_reduce_stage_1_tid_res_arr_mem_124953, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t mem_120318_cached_sizze_128549 = 0;
    unsigned char *mem_120318 = NULL;
    int64_t flat_tid_120307;
    
    flat_tid_120307 = subtask_id;
    {
        double eta_p_124955;
        double eta_p_124956;
        double local_acc_124958 = 0.0;
        double eta_p_120309;
        double eta_p_120310;
        double local_acc_124959 = 0.0;
        int64_t start_124960;
        int64_t end_124961;
        
        start_124960 = start;
        end_124961 = end;
        
        int64_t n_124962 = end_124961 - start_124960;
        
        if (mem_120318_cached_sizze_128549 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_120318, &mem_120318_cached_sizze_128549, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        for (int64_t SegRed_i_124963 = start_124960; SegRed_i_124963 < start_124960 + n_124962; SegRed_i_124963++) {
            int64_t gtid_120308 = SegRed_i_124963;
            double eta_p_120312 = ((double *) ext_mem_119815.mem)[gtid_120308];
            double eta_p_120313 = ((double *) ext_mem_119817.mem)[gtid_120308];
            double eta_p_120314 = ((double *) ext_mem_119814.mem)[gtid_120308];
            double eta_p_120315 = ((double *) ext_mem_119816.mem)[gtid_120308];
            double log_res_120316 = futrts_log64(eta_p_120314);
            double zp_res_120317 = eta_p_120315 + log_res_120316;
            double defunc_res_120319;
            int64_t flat_tid_120321 = (int64_t) 0;
            
            defunc_res_120319 = 0.0;
            
            struct futhark_mc_task_128550 futhark_mc_task_128550_;
            
            futhark_mc_task_128550_.ctx = ctx;
            futhark_mc_task_128550_.free_ext_mem_119810 = ext_mem_119810.mem;
            futhark_mc_task_128550_.free_ext_119811 = ext_119811;
            futhark_mc_task_128550_.free_ext_119812 = ext_119812;
            futhark_mc_task_128550_.free_ext_119813 = ext_119813;
            futhark_mc_task_128550_.free_ext_mem_119815 = ext_mem_119815.mem;
            futhark_mc_task_128550_.free_gtid_120308 = gtid_120308;
            futhark_mc_task_128550_.free_eta_p_120314 = eta_p_120314;
            futhark_mc_task_128550_.free_flat_tid_120321 = flat_tid_120321;
            futhark_mc_task_128550_.retval_defunc_res_120319 = (double *) &defunc_res_120319;
            #if ISPC
            futhark_mc_task_128550_.retval_defunc_res_120319 += programIndex;
            #endif
            futhark_mc_task_128550_.retval_mem_120318 = mem_120318;
            
            struct scheduler_segop futhark_mc_task_128550_task;
            
            futhark_mc_task_128550_task.args = &futhark_mc_task_128550_;
            futhark_mc_task_128550_task.top_level_fn = futhark_mc_segred_task_128551;
            futhark_mc_task_128550_task.name = "futhark_mc_segred_task_128551";
            futhark_mc_task_128550_task.iterations = m_33388;
            futhark_mc_task_128550_task.task_time = &ctx->program->futhark_mc_segred_task_128551_total_time;
            futhark_mc_task_128550_task.task_iter = &ctx->program->futhark_mc_segred_task_128551_total_iter;
            futhark_mc_task_128550_task.sched = STATIC;
            futhark_mc_task_128550_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_128551_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128550_task);
            
            if (futhark_mc_segred_task_128551_err != 0) {
                err = futhark_mc_segred_task_128551_err;
                goto cleanup;
            }
            
            double log_res_120330 = futrts_log64(eta_p_120312);
            double zp_res_120331 = eta_p_120313 + log_res_120330;
            
            // save map-out results
            {
                ((double *) mem_120301.mem)[gtid_120308] = zp_res_120331;
                
                int64_t iterations_124990 = m_33388;
                struct futhark_mc_task_128558 futhark_mc_task_128558_;
                
                futhark_mc_task_128558_.ctx = ctx;
                futhark_mc_task_128558_.free_m_33388 = m_33388;
                futhark_mc_task_128558_.free_mem_112403 = mem_112403.mem;
                futhark_mc_task_128558_.free_gtid_120308 = gtid_120308;
                futhark_mc_task_128558_.free_mem_120318 = mem_120318;
                
                struct scheduler_segop futhark_mc_task_128558_task;
                
                futhark_mc_task_128558_task.args = &futhark_mc_task_128558_;
                futhark_mc_task_128558_task.top_level_fn = futhark_mc_copy_124989_task_128559;
                futhark_mc_task_128558_task.name = "futhark_mc_copy_124989_task_128559";
                futhark_mc_task_128558_task.iterations = iterations_124990;
                futhark_mc_task_128558_task.task_time = &ctx->program->futhark_mc_copy_124989_task_128559_total_time;
                futhark_mc_task_128558_task.task_iter = &ctx->program->futhark_mc_copy_124989_task_128559_total_iter;
                futhark_mc_task_128558_task.sched = STATIC;
                futhark_mc_task_128558_task.nested_fn = NULL;
                
                int futhark_mc_copy_124989_task_128559_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128558_task);
                
                if (futhark_mc_copy_124989_task_128559_err != 0) {
                    err = futhark_mc_copy_124989_task_128559_err;
                    goto cleanup;
                }
                ((double *) mem_120302.mem)[gtid_120308] = zp_res_120317;
            }
            // Load accum params
            {
                eta_p_120309 = local_acc_124959;
            }
            // Load next params
            {
                eta_p_120310 = defunc_res_120319;
            }
            // SegRed body
            {
                double zp_res_120311 = eta_p_120309 + eta_p_120310;
                
                local_acc_124959 = zp_res_120311;
            }
        }
        
        int64_t uni_i_124991 = 0;
        
        {
            int64_t gtid_120308 = uni_i_124991;
            
            // Load accum params
            {
                eta_p_124955 = local_acc_124958;
            }
            // Load next params
            {
                eta_p_124956 = local_acc_124959;
            }
            // SegRed body
            {
                double zp_res_124957 = eta_p_124955 + eta_p_124956;
                
                local_acc_124958 = zp_res_124957;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_124953.mem)[flat_tid_120307] = local_acc_124958;
    }
    
  cleanup:
    {
        free(mem_120318);
    }
    if (event_128565 != NULL) {
        event_128565->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128548", strdup("nothing further"), event_128565, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_128545(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128536 *futhark_mc_task_128536 = (struct futhark_mc_task_128536 *) args;
    struct futhark_context *ctx = futhark_mc_task_128536->ctx;
    struct mc_event *event_128567 = mc_event_new(ctx);
    
    if (event_128567 != NULL)
        event_128567->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128536->free_m_33388;
    int64_t bytes_111715 = futhark_mc_task_128536->free_bytes_111715;
    struct memblock ext_mem_119810 = {.desc ="ext_mem_119810", .mem =futhark_mc_task_128536->free_ext_mem_119810, .size =0, .references =NULL};
    int64_t ext_119811 = futhark_mc_task_128536->free_ext_119811;
    int64_t ext_119812 = futhark_mc_task_128536->free_ext_119812;
    int64_t ext_119813 = futhark_mc_task_128536->free_ext_119813;
    struct memblock ext_mem_119814 = {.desc ="ext_mem_119814", .mem =futhark_mc_task_128536->free_ext_mem_119814, .size =0, .references =NULL};
    struct memblock ext_mem_119815 = {.desc ="ext_mem_119815", .mem =futhark_mc_task_128536->free_ext_mem_119815, .size =0, .references =NULL};
    struct memblock ext_mem_119816 = {.desc ="ext_mem_119816", .mem =futhark_mc_task_128536->free_ext_mem_119816, .size =0, .references =NULL};
    struct memblock ext_mem_119817 = {.desc ="ext_mem_119817", .mem =futhark_mc_task_128536->free_ext_mem_119817, .size =0, .references =NULL};
    int64_t flat_tid_120307 = futhark_mc_task_128536->free_flat_tid_120307;
    int64_t flat_tid_120332 = futhark_mc_task_128536->free_flat_tid_120332;
    double defunc_res_120303 = *futhark_mc_task_128536->retval_defunc_res_120303;
    struct memblock mem_120301 = {.desc ="mem_120301", .mem =futhark_mc_task_128536->retval_mem_120301, .size =0, .references =NULL};
    struct memblock mem_112403 = {.desc ="mem_112403", .mem =futhark_mc_task_128536->retval_mem_112403, .size =0, .references =NULL};
    struct memblock mem_120302 = {.desc ="mem_120302", .mem =futhark_mc_task_128536->retval_mem_120302, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_124953_cached_sizze_128546 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124953 = NULL;
    int32_t nsubtasks_124952;
    
    nsubtasks_124952 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124953_cached_sizze_128546 < (int64_t) 8 * nsubtasks_124952) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124953, &reduce_stage_1_tid_res_arr_mem_124953_cached_sizze_128546, (int64_t) 8 * nsubtasks_124952);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128547 futhark_mc_segred_stage_1_parloop_struct_128547_;
    
    futhark_mc_segred_stage_1_parloop_struct_128547_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128547_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128547_.free_bytes_111715 = bytes_111715;
    futhark_mc_segred_stage_1_parloop_struct_128547_.free_mem_112403 = mem_112403.mem;
    futhark_mc_segred_stage_1_parloop_struct_128547_.free_ext_mem_119810 = ext_mem_119810.mem;
    futhark_mc_segred_stage_1_parloop_struct_128547_.free_ext_119811 = ext_119811;
    futhark_mc_segred_stage_1_parloop_struct_128547_.free_ext_119812 = ext_119812;
    futhark_mc_segred_stage_1_parloop_struct_128547_.free_ext_119813 = ext_119813;
    futhark_mc_segred_stage_1_parloop_struct_128547_.free_ext_mem_119814 = ext_mem_119814.mem;
    futhark_mc_segred_stage_1_parloop_struct_128547_.free_ext_mem_119815 = ext_mem_119815.mem;
    futhark_mc_segred_stage_1_parloop_struct_128547_.free_ext_mem_119816 = ext_mem_119816.mem;
    futhark_mc_segred_stage_1_parloop_struct_128547_.free_ext_mem_119817 = ext_mem_119817.mem;
    futhark_mc_segred_stage_1_parloop_struct_128547_.free_mem_120301 = mem_120301.mem;
    futhark_mc_segred_stage_1_parloop_struct_128547_.free_mem_120302 = mem_120302.mem;
    futhark_mc_segred_stage_1_parloop_struct_128547_.free_reduce_stage_1_tid_res_arr_mem_124953 = reduce_stage_1_tid_res_arr_mem_124953;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128548_task;
    
    futhark_mc_segred_stage_1_parloop_128548_task.name = "futhark_mc_segred_stage_1_parloop_128548";
    futhark_mc_segred_stage_1_parloop_128548_task.fn = futhark_mc_segred_stage_1_parloop_128548;
    futhark_mc_segred_stage_1_parloop_128548_task.args = &futhark_mc_segred_stage_1_parloop_struct_128547_;
    futhark_mc_segred_stage_1_parloop_128548_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128548_task.info = info;
    
    struct mc_event *event_128566 = mc_event_new(ctx);
    
    if (event_128566 != NULL)
        event_128566->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128548_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128548_task);
    
    if (futhark_mc_segred_stage_1_parloop_128548_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128548_err;
        goto cleanup;
    }
    if (event_128566 != NULL) {
        event_128566->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128548_total", strdup("nothing further"), event_128566, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_120303 = 0.0;
    }
    
    double eta_p_124992;
    double eta_p_124993;
    
    for (int32_t i_124995 = 0; i_124995 < nsubtasks_124952; i_124995++) {
        flat_tid_120307 = i_124995;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_124992 = defunc_res_120303;
            }
            // load next params
            {
                eta_p_124993 = ((double *) reduce_stage_1_tid_res_arr_mem_124953)[flat_tid_120307];
            }
            // red body
            {
                double zp_res_124994 = eta_p_124992 + eta_p_124993;
                
                defunc_res_120303 = zp_res_124994;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124953);
    }
    if (event_128567 != NULL) {
        event_128567->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_128545", strdup("nothing further"), event_128567, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128536->retval_defunc_res_120303 = defunc_res_120303;
        futhark_mc_task_128536->retval_mem_120301 = mem_120301.mem;
        futhark_mc_task_128536->retval_mem_112403 = mem_112403.mem;
        futhark_mc_task_128536->retval_mem_120302 = mem_120302.mem;
    }
    return err;
}
struct futhark_mc_task_128568 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_param_118928;
    int64_t free_flat_tid_120377;
    int64_t free_flat_tid_120410;
    double *retval_defunc_res_120371;
    double *retval_defunc_res_120372;
    double *retval_defunc_res_120373;
    unsigned char *retval_mem_112412;
    unsigned char *retval_mem_112414;
    unsigned char *retval_mem_112416;
};
struct futhark_mc_segred_stage_1_parloop_struct_128573 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_112412;
    unsigned char *free_mem_112414;
    unsigned char *free_mem_112416;
    unsigned char *free_mem_param_118928;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124997;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_124999;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125001;
};
static int futhark_mc_segred_stage_1_parloop_128574(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128573 *futhark_mc_segred_stage_1_parloop_struct_128573 = (struct futhark_mc_segred_stage_1_parloop_struct_128573 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128573->ctx;
    struct mc_event *event_128575 = mc_event_new(ctx);
    
    if (event_128575 != NULL)
        event_128575->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128573->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128573->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_128573->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112412 = {.desc ="mem_112412", .mem =futhark_mc_segred_stage_1_parloop_struct_128573->free_mem_112412, .size =0, .references =NULL};
    struct memblock mem_112414 = {.desc ="mem_112414", .mem =futhark_mc_segred_stage_1_parloop_struct_128573->free_mem_112414, .size =0, .references =NULL};
    struct memblock mem_112416 = {.desc ="mem_112416", .mem =futhark_mc_segred_stage_1_parloop_struct_128573->free_mem_112416, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_segred_stage_1_parloop_struct_128573->free_mem_param_118928, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_124997 = {.desc ="reduce_stage_1_tid_res_arr_mem_124997", .mem =futhark_mc_segred_stage_1_parloop_struct_128573->free_reduce_stage_1_tid_res_arr_mem_124997, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_124999 = {.desc ="reduce_stage_1_tid_res_arr_mem_124999", .mem =futhark_mc_segred_stage_1_parloop_struct_128573->free_reduce_stage_1_tid_res_arr_mem_124999, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125001 = {.desc ="reduce_stage_1_tid_res_arr_mem_125001", .mem =futhark_mc_segred_stage_1_parloop_struct_128573->free_reduce_stage_1_tid_res_arr_mem_125001, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_120410;
    
    flat_tid_120410 = subtask_id;
    {
        double eta_p_125003;
        double eta_p_125004;
        double eta_p_125006;
        double eta_p_125007;
        double eta_p_125009;
        double eta_p_125010;
        double local_acc_125012 = 0.0;
        double local_acc_125013 = 0.0;
        double local_acc_125014 = 0.0;
        double eta_p_120412;
        double eta_p_120413;
        double eta_p_120415;
        double eta_p_120416;
        double eta_p_120418;
        double eta_p_120419;
        double local_acc_125015 = 0.0;
        double local_acc_125016 = 0.0;
        double local_acc_125017 = 0.0;
        int64_t start_125018;
        int64_t end_125019;
        
        start_125018 = start;
        end_125019 = end;
        
        int64_t n_125020 = end_125019 - start_125018;
        
        for (int64_t SegRed_i_125021 = start_125018; SegRed_i_125021 < start_125018 + n_125020; SegRed_i_125021++) {
            int64_t gtid_120411 = SegRed_i_125021;
            double x_120421 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + gtid_120411];
            double log_res_120422 = futrts_log64(x_120421);
            double defunc_res_120423;
            double defunc_res_120424;
            double defunc_res_120425;
            double redout_120427;
            double redout_120428;
            double redout_120429;
            
            redout_120427 = 0.0;
            redout_120428 = 0.0;
            redout_120429 = 0.0;
            for (int64_t i_120426 = 0; i_120426 < m_33388; i_120426++) {
                double x_120430 = ((double *) mem_param_118928.mem)[i_120426 * m_33388 + gtid_120411];
                double zp_res_120431 = x_120430 + redout_120427;
                double zp_res_120432 = x_120430 + redout_120428;
                double zp_res_120433 = x_120430 + redout_120429;
                double redout_tmp_125022 = zp_res_120431;
                double redout_tmp_125023 = zp_res_120432;
                double redout_tmp_125024 = zp_res_120433;
                
                redout_120427 = redout_tmp_125022;
                redout_120428 = redout_tmp_125023;
                redout_120429 = redout_tmp_125024;
            }
            defunc_res_120423 = redout_120427;
            defunc_res_120424 = redout_120428;
            defunc_res_120425 = redout_120429;
            
            bool zeze_res_120434 = defunc_res_120423 == 0.0;
            double klu_res_120435;
            
            if (zeze_res_120434) {
                klu_res_120435 = 0.0;
            } else {
                double zs_res_120436 = defunc_res_120423 / x_120421;
                double log_res_120437 = futrts_log64(zs_res_120436);
                double zt_res_120438 = defunc_res_120423 * log_res_120437;
                
                klu_res_120435 = zt_res_120438;
            }
            // save map-out results
            {
                ((double *) mem_112412.mem)[gtid_120411] = defunc_res_120424;
                ((double *) mem_112414.mem)[gtid_120411] = defunc_res_120423;
                ((double *) mem_112416.mem)[gtid_120411] = log_res_120422;
            }
            // Load accum params
            {
                eta_p_120412 = local_acc_125015;
            }
            // Load next params
            {
                eta_p_120413 = klu_res_120435;
            }
            // SegRed body
            {
                double zp_res_120414 = eta_p_120412 + eta_p_120413;
                
                local_acc_125015 = zp_res_120414;
            }
            // Load accum params
            {
                eta_p_120415 = local_acc_125016;
            }
            // Load next params
            {
                eta_p_120416 = x_120421;
            }
            // SegRed body
            {
                double zp_res_120417 = eta_p_120415 + eta_p_120416;
                
                local_acc_125016 = zp_res_120417;
            }
            // Load accum params
            {
                eta_p_120418 = local_acc_125017;
            }
            // Load next params
            {
                eta_p_120419 = defunc_res_120425;
            }
            // SegRed body
            {
                double zp_res_120420 = eta_p_120418 + eta_p_120419;
                
                local_acc_125017 = zp_res_120420;
            }
        }
        
        int64_t uni_i_125025 = 0;
        
        {
            int64_t gtid_120411 = uni_i_125025;
            
            // Load accum params
            {
                eta_p_125003 = local_acc_125012;
            }
            // Load next params
            {
                eta_p_125004 = local_acc_125015;
            }
            // SegRed body
            {
                double zp_res_125005 = eta_p_125003 + eta_p_125004;
                
                local_acc_125012 = zp_res_125005;
            }
            // Load accum params
            {
                eta_p_125006 = local_acc_125013;
            }
            // Load next params
            {
                eta_p_125007 = local_acc_125016;
            }
            // SegRed body
            {
                double zp_res_125008 = eta_p_125006 + eta_p_125007;
                
                local_acc_125013 = zp_res_125008;
            }
            // Load accum params
            {
                eta_p_125009 = local_acc_125014;
            }
            // Load next params
            {
                eta_p_125010 = local_acc_125017;
            }
            // SegRed body
            {
                double zp_res_125011 = eta_p_125009 + eta_p_125010;
                
                local_acc_125014 = zp_res_125011;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_124997.mem)[flat_tid_120410] = local_acc_125012;
        ((double *) reduce_stage_1_tid_res_arr_mem_124999.mem)[flat_tid_120410] = local_acc_125013;
        ((double *) reduce_stage_1_tid_res_arr_mem_125001.mem)[flat_tid_120410] = local_acc_125014;
    }
    
  cleanup:
    { }
    if (event_128575 != NULL) {
        event_128575->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128574", strdup("nothing further"), event_128575, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128569(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128568 *futhark_mc_task_128568 = (struct futhark_mc_task_128568 *) args;
    struct futhark_context *ctx = futhark_mc_task_128568->ctx;
    struct mc_event *event_128577 = mc_event_new(ctx);
    
    if (event_128577 != NULL)
        event_128577->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128568->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128568->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128568->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_task_128568->free_mem_param_118928, .size =0, .references =NULL};
    int64_t flat_tid_120377 = futhark_mc_task_128568->free_flat_tid_120377;
    int64_t flat_tid_120410 = futhark_mc_task_128568->free_flat_tid_120410;
    double defunc_res_120371 = *futhark_mc_task_128568->retval_defunc_res_120371;
    double defunc_res_120372 = *futhark_mc_task_128568->retval_defunc_res_120372;
    double defunc_res_120373 = *futhark_mc_task_128568->retval_defunc_res_120373;
    struct memblock mem_112412 = {.desc ="mem_112412", .mem =futhark_mc_task_128568->retval_mem_112412, .size =0, .references =NULL};
    struct memblock mem_112414 = {.desc ="mem_112414", .mem =futhark_mc_task_128568->retval_mem_112414, .size =0, .references =NULL};
    struct memblock mem_112416 = {.desc ="mem_112416", .mem =futhark_mc_task_128568->retval_mem_112416, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_124997_cached_sizze_128570 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124997 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_124999_cached_sizze_128571 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_124999 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_125001_cached_sizze_128572 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125001 = NULL;
    int32_t nsubtasks_124996;
    
    nsubtasks_124996 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_124997_cached_sizze_128570 < (int64_t) 8 * nsubtasks_124996) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124997, &reduce_stage_1_tid_res_arr_mem_124997_cached_sizze_128570, (int64_t) 8 * nsubtasks_124996);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_124999_cached_sizze_128571 < (int64_t) 8 * nsubtasks_124996) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_124999, &reduce_stage_1_tid_res_arr_mem_124999_cached_sizze_128571, (int64_t) 8 * nsubtasks_124996);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_125001_cached_sizze_128572 < (int64_t) 8 * nsubtasks_124996) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125001, &reduce_stage_1_tid_res_arr_mem_125001_cached_sizze_128572, (int64_t) 8 * nsubtasks_124996);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128573 futhark_mc_segred_stage_1_parloop_struct_128573_;
    
    futhark_mc_segred_stage_1_parloop_struct_128573_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128573_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128573_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128573_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_128573_.free_mem_112412 = mem_112412.mem;
    futhark_mc_segred_stage_1_parloop_struct_128573_.free_mem_112414 = mem_112414.mem;
    futhark_mc_segred_stage_1_parloop_struct_128573_.free_mem_112416 = mem_112416.mem;
    futhark_mc_segred_stage_1_parloop_struct_128573_.free_mem_param_118928 = mem_param_118928.mem;
    futhark_mc_segred_stage_1_parloop_struct_128573_.free_reduce_stage_1_tid_res_arr_mem_124997 = reduce_stage_1_tid_res_arr_mem_124997;
    futhark_mc_segred_stage_1_parloop_struct_128573_.free_reduce_stage_1_tid_res_arr_mem_124999 = reduce_stage_1_tid_res_arr_mem_124999;
    futhark_mc_segred_stage_1_parloop_struct_128573_.free_reduce_stage_1_tid_res_arr_mem_125001 = reduce_stage_1_tid_res_arr_mem_125001;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128574_task;
    
    futhark_mc_segred_stage_1_parloop_128574_task.name = "futhark_mc_segred_stage_1_parloop_128574";
    futhark_mc_segred_stage_1_parloop_128574_task.fn = futhark_mc_segred_stage_1_parloop_128574;
    futhark_mc_segred_stage_1_parloop_128574_task.args = &futhark_mc_segred_stage_1_parloop_struct_128573_;
    futhark_mc_segred_stage_1_parloop_128574_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128574_task.info = info;
    
    struct mc_event *event_128576 = mc_event_new(ctx);
    
    if (event_128576 != NULL)
        event_128576->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128574_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128574_task);
    
    if (futhark_mc_segred_stage_1_parloop_128574_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128574_err;
        goto cleanup;
    }
    if (event_128576 != NULL) {
        event_128576->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128574_total", strdup("nothing further"), event_128576, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_120371 = 0.0;
        defunc_res_120372 = 0.0;
        defunc_res_120373 = 0.0;
    }
    
    double eta_p_125026;
    double eta_p_125027;
    double eta_p_125029;
    double eta_p_125030;
    double eta_p_125032;
    double eta_p_125033;
    
    for (int32_t i_125035 = 0; i_125035 < nsubtasks_124996; i_125035++) {
        flat_tid_120410 = i_125035;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_125026 = defunc_res_120371;
            }
            // load next params
            {
                eta_p_125027 = ((double *) reduce_stage_1_tid_res_arr_mem_124997)[flat_tid_120410];
            }
            // red body
            {
                double zp_res_125028 = eta_p_125026 + eta_p_125027;
                
                defunc_res_120371 = zp_res_125028;
            }
            // load acc params
            {
                eta_p_125029 = defunc_res_120372;
            }
            // load next params
            {
                eta_p_125030 = ((double *) reduce_stage_1_tid_res_arr_mem_124999)[flat_tid_120410];
            }
            // red body
            {
                double zp_res_125031 = eta_p_125029 + eta_p_125030;
                
                defunc_res_120372 = zp_res_125031;
            }
            // load acc params
            {
                eta_p_125032 = defunc_res_120373;
            }
            // load next params
            {
                eta_p_125033 = ((double *) reduce_stage_1_tid_res_arr_mem_125001)[flat_tid_120410];
            }
            // red body
            {
                double zp_res_125034 = eta_p_125032 + eta_p_125033;
                
                defunc_res_120373 = zp_res_125034;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_124997);
        free(reduce_stage_1_tid_res_arr_mem_124999);
        free(reduce_stage_1_tid_res_arr_mem_125001);
    }
    if (event_128577 != NULL) {
        event_128577->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128569", strdup("nothing further"), event_128577, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128568->retval_defunc_res_120371 = defunc_res_120371;
        *futhark_mc_task_128568->retval_defunc_res_120372 = defunc_res_120372;
        *futhark_mc_task_128568->retval_defunc_res_120373 = defunc_res_120373;
        futhark_mc_task_128568->retval_mem_112412 = mem_112412.mem;
        futhark_mc_task_128568->retval_mem_112414 = mem_112414.mem;
        futhark_mc_task_128568->retval_mem_112416 = mem_112416.mem;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_128582 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_112412;
    unsigned char *free_mem_112414;
    unsigned char *free_mem_112416;
    unsigned char *free_mem_param_118928;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125037;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125039;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125041;
};
struct futhark_mc_task_128584 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_param_118928;
    int64_t free_gtid_120378;
    int64_t free_flat_tid_120393;
    double *retval_defunc_res_120390;
    double *retval_defunc_res_120391;
    double *retval_defunc_res_120392;
};
struct futhark_mc_segred_stage_1_parloop_struct_128589 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_param_118928;
    int64_t free_gtid_120378;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125063;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125065;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125067;
};
static int futhark_mc_segred_stage_1_parloop_128590(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128589 *futhark_mc_segred_stage_1_parloop_struct_128589 = (struct futhark_mc_segred_stage_1_parloop_struct_128589 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128589->ctx;
    struct mc_event *event_128591 = mc_event_new(ctx);
    
    if (event_128591 != NULL)
        event_128591->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128589->free_m_33388;
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_segred_stage_1_parloop_struct_128589->free_mem_param_118928, .size =0, .references =NULL};
    int64_t gtid_120378 = futhark_mc_segred_stage_1_parloop_struct_128589->free_gtid_120378;
    struct memblock reduce_stage_1_tid_res_arr_mem_125063 = {.desc ="reduce_stage_1_tid_res_arr_mem_125063", .mem =futhark_mc_segred_stage_1_parloop_struct_128589->free_reduce_stage_1_tid_res_arr_mem_125063, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125065 = {.desc ="reduce_stage_1_tid_res_arr_mem_125065", .mem =futhark_mc_segred_stage_1_parloop_struct_128589->free_reduce_stage_1_tid_res_arr_mem_125065, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125067 = {.desc ="reduce_stage_1_tid_res_arr_mem_125067", .mem =futhark_mc_segred_stage_1_parloop_struct_128589->free_reduce_stage_1_tid_res_arr_mem_125067, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_120393;
    
    flat_tid_120393 = subtask_id;
    {
        double eta_p_125069;
        double eta_p_125070;
        double eta_p_125072;
        double eta_p_125073;
        double eta_p_125075;
        double eta_p_125076;
        double local_acc_125078 = 0.0;
        double local_acc_125079 = 0.0;
        double local_acc_125080 = 0.0;
        double eta_p_120395;
        double eta_p_120396;
        double eta_p_120398;
        double eta_p_120399;
        double eta_p_120401;
        double eta_p_120402;
        double local_acc_125081 = 0.0;
        double local_acc_125082 = 0.0;
        double local_acc_125083 = 0.0;
        int64_t start_125084;
        int64_t end_125085;
        
        start_125084 = start;
        end_125085 = end;
        
        int64_t n_125086 = end_125085 - start_125084;
        
        for (int64_t SegRed_i_125087 = start_125084; SegRed_i_125087 < start_125084 + n_125086; SegRed_i_125087++) {
            int64_t gtid_120394 = SegRed_i_125087;
            double x_120404 = ((double *) mem_param_118928.mem)[gtid_120394 * m_33388 + gtid_120378];
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_120395 = local_acc_125081;
            }
            // Load next params
            {
                eta_p_120396 = x_120404;
            }
            // SegRed body
            {
                double zp_res_120397 = eta_p_120395 + eta_p_120396;
                
                local_acc_125081 = zp_res_120397;
            }
            // Load accum params
            {
                eta_p_120398 = local_acc_125082;
            }
            // Load next params
            {
                eta_p_120399 = x_120404;
            }
            // SegRed body
            {
                double zp_res_120400 = eta_p_120398 + eta_p_120399;
                
                local_acc_125082 = zp_res_120400;
            }
            // Load accum params
            {
                eta_p_120401 = local_acc_125083;
            }
            // Load next params
            {
                eta_p_120402 = x_120404;
            }
            // SegRed body
            {
                double zp_res_120403 = eta_p_120401 + eta_p_120402;
                
                local_acc_125083 = zp_res_120403;
            }
        }
        
        int64_t uni_i_125088 = 0;
        
        {
            int64_t gtid_120394 = uni_i_125088;
            
            // Load accum params
            {
                eta_p_125069 = local_acc_125078;
            }
            // Load next params
            {
                eta_p_125070 = local_acc_125081;
            }
            // SegRed body
            {
                double zp_res_125071 = eta_p_125069 + eta_p_125070;
                
                local_acc_125078 = zp_res_125071;
            }
            // Load accum params
            {
                eta_p_125072 = local_acc_125079;
            }
            // Load next params
            {
                eta_p_125073 = local_acc_125082;
            }
            // SegRed body
            {
                double zp_res_125074 = eta_p_125072 + eta_p_125073;
                
                local_acc_125079 = zp_res_125074;
            }
            // Load accum params
            {
                eta_p_125075 = local_acc_125080;
            }
            // Load next params
            {
                eta_p_125076 = local_acc_125083;
            }
            // SegRed body
            {
                double zp_res_125077 = eta_p_125075 + eta_p_125076;
                
                local_acc_125080 = zp_res_125077;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_125063.mem)[flat_tid_120393] = local_acc_125078;
        ((double *) reduce_stage_1_tid_res_arr_mem_125065.mem)[flat_tid_120393] = local_acc_125079;
        ((double *) reduce_stage_1_tid_res_arr_mem_125067.mem)[flat_tid_120393] = local_acc_125080;
    }
    
  cleanup:
    { }
    if (event_128591 != NULL) {
        event_128591->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128590", strdup("nothing further"), event_128591, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128585(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128584 *futhark_mc_task_128584 = (struct futhark_mc_task_128584 *) args;
    struct futhark_context *ctx = futhark_mc_task_128584->ctx;
    struct mc_event *event_128593 = mc_event_new(ctx);
    
    if (event_128593 != NULL)
        event_128593->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128584->free_m_33388;
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_task_128584->free_mem_param_118928, .size =0, .references =NULL};
    int64_t gtid_120378 = futhark_mc_task_128584->free_gtid_120378;
    int64_t flat_tid_120393 = futhark_mc_task_128584->free_flat_tid_120393;
    double defunc_res_120390 = *futhark_mc_task_128584->retval_defunc_res_120390;
    double defunc_res_120391 = *futhark_mc_task_128584->retval_defunc_res_120391;
    double defunc_res_120392 = *futhark_mc_task_128584->retval_defunc_res_120392;
    int64_t reduce_stage_1_tid_res_arr_mem_125063_cached_sizze_128586 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125063 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_125065_cached_sizze_128587 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125065 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_125067_cached_sizze_128588 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125067 = NULL;
    int32_t nsubtasks_125062;
    
    nsubtasks_125062 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_125063_cached_sizze_128586 < (int64_t) 8 * nsubtasks_125062) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125063, &reduce_stage_1_tid_res_arr_mem_125063_cached_sizze_128586, (int64_t) 8 * nsubtasks_125062);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_125065_cached_sizze_128587 < (int64_t) 8 * nsubtasks_125062) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125065, &reduce_stage_1_tid_res_arr_mem_125065_cached_sizze_128587, (int64_t) 8 * nsubtasks_125062);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_125067_cached_sizze_128588 < (int64_t) 8 * nsubtasks_125062) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125067, &reduce_stage_1_tid_res_arr_mem_125067_cached_sizze_128588, (int64_t) 8 * nsubtasks_125062);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128589 futhark_mc_segred_stage_1_parloop_struct_128589_;
    
    futhark_mc_segred_stage_1_parloop_struct_128589_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128589_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128589_.free_mem_param_118928 = mem_param_118928.mem;
    futhark_mc_segred_stage_1_parloop_struct_128589_.free_gtid_120378 = gtid_120378;
    futhark_mc_segred_stage_1_parloop_struct_128589_.free_reduce_stage_1_tid_res_arr_mem_125063 = reduce_stage_1_tid_res_arr_mem_125063;
    futhark_mc_segred_stage_1_parloop_struct_128589_.free_reduce_stage_1_tid_res_arr_mem_125065 = reduce_stage_1_tid_res_arr_mem_125065;
    futhark_mc_segred_stage_1_parloop_struct_128589_.free_reduce_stage_1_tid_res_arr_mem_125067 = reduce_stage_1_tid_res_arr_mem_125067;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128590_task;
    
    futhark_mc_segred_stage_1_parloop_128590_task.name = "futhark_mc_segred_stage_1_parloop_128590";
    futhark_mc_segred_stage_1_parloop_128590_task.fn = futhark_mc_segred_stage_1_parloop_128590;
    futhark_mc_segred_stage_1_parloop_128590_task.args = &futhark_mc_segred_stage_1_parloop_struct_128589_;
    futhark_mc_segred_stage_1_parloop_128590_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128590_task.info = info;
    
    struct mc_event *event_128592 = mc_event_new(ctx);
    
    if (event_128592 != NULL)
        event_128592->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128590_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128590_task);
    
    if (futhark_mc_segred_stage_1_parloop_128590_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128590_err;
        goto cleanup;
    }
    if (event_128592 != NULL) {
        event_128592->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128590_total", strdup("nothing further"), event_128592, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_120390 = 0.0;
        defunc_res_120391 = 0.0;
        defunc_res_120392 = 0.0;
    }
    
    double eta_p_125089;
    double eta_p_125090;
    double eta_p_125092;
    double eta_p_125093;
    double eta_p_125095;
    double eta_p_125096;
    
    for (int32_t i_125098 = 0; i_125098 < nsubtasks_125062; i_125098++) {
        flat_tid_120393 = i_125098;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_125089 = defunc_res_120390;
            }
            // load next params
            {
                eta_p_125090 = ((double *) reduce_stage_1_tid_res_arr_mem_125063)[flat_tid_120393];
            }
            // red body
            {
                double zp_res_125091 = eta_p_125089 + eta_p_125090;
                
                defunc_res_120390 = zp_res_125091;
            }
            // load acc params
            {
                eta_p_125092 = defunc_res_120391;
            }
            // load next params
            {
                eta_p_125093 = ((double *) reduce_stage_1_tid_res_arr_mem_125065)[flat_tid_120393];
            }
            // red body
            {
                double zp_res_125094 = eta_p_125092 + eta_p_125093;
                
                defunc_res_120391 = zp_res_125094;
            }
            // load acc params
            {
                eta_p_125095 = defunc_res_120392;
            }
            // load next params
            {
                eta_p_125096 = ((double *) reduce_stage_1_tid_res_arr_mem_125067)[flat_tid_120393];
            }
            // red body
            {
                double zp_res_125097 = eta_p_125095 + eta_p_125096;
                
                defunc_res_120392 = zp_res_125097;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_125063);
        free(reduce_stage_1_tid_res_arr_mem_125065);
        free(reduce_stage_1_tid_res_arr_mem_125067);
    }
    if (event_128593 != NULL) {
        event_128593->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128585", strdup("nothing further"), event_128593, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128584->retval_defunc_res_120390 = defunc_res_120390;
        *futhark_mc_task_128584->retval_defunc_res_120391 = defunc_res_120391;
        *futhark_mc_task_128584->retval_defunc_res_120392 = defunc_res_120392;
    }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_128583(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128582 *futhark_mc_segred_stage_1_parloop_struct_128582 = (struct futhark_mc_segred_stage_1_parloop_struct_128582 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128582->ctx;
    struct mc_event *event_128594 = mc_event_new(ctx);
    
    if (event_128594 != NULL)
        event_128594->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128582->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128582->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_128582->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112412 = {.desc ="mem_112412", .mem =futhark_mc_segred_stage_1_parloop_struct_128582->free_mem_112412, .size =0, .references =NULL};
    struct memblock mem_112414 = {.desc ="mem_112414", .mem =futhark_mc_segred_stage_1_parloop_struct_128582->free_mem_112414, .size =0, .references =NULL};
    struct memblock mem_112416 = {.desc ="mem_112416", .mem =futhark_mc_segred_stage_1_parloop_struct_128582->free_mem_112416, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_segred_stage_1_parloop_struct_128582->free_mem_param_118928, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125037 = {.desc ="reduce_stage_1_tid_res_arr_mem_125037", .mem =futhark_mc_segred_stage_1_parloop_struct_128582->free_reduce_stage_1_tid_res_arr_mem_125037, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125039 = {.desc ="reduce_stage_1_tid_res_arr_mem_125039", .mem =futhark_mc_segred_stage_1_parloop_struct_128582->free_reduce_stage_1_tid_res_arr_mem_125039, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125041 = {.desc ="reduce_stage_1_tid_res_arr_mem_125041", .mem =futhark_mc_segred_stage_1_parloop_struct_128582->free_reduce_stage_1_tid_res_arr_mem_125041, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_120377;
    
    flat_tid_120377 = subtask_id;
    {
        double eta_p_125043;
        double eta_p_125044;
        double eta_p_125046;
        double eta_p_125047;
        double eta_p_125049;
        double eta_p_125050;
        double local_acc_125052 = 0.0;
        double local_acc_125053 = 0.0;
        double local_acc_125054 = 0.0;
        double eta_p_120379;
        double eta_p_120380;
        double eta_p_120382;
        double eta_p_120383;
        double eta_p_120385;
        double eta_p_120386;
        double local_acc_125055 = 0.0;
        double local_acc_125056 = 0.0;
        double local_acc_125057 = 0.0;
        int64_t start_125058;
        int64_t end_125059;
        
        start_125058 = start;
        end_125059 = end;
        
        int64_t n_125060 = end_125059 - start_125058;
        
        for (int64_t SegRed_i_125061 = start_125058; SegRed_i_125061 < start_125058 + n_125060; SegRed_i_125061++) {
            int64_t gtid_120378 = SegRed_i_125061;
            double x_120388 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + gtid_120378];
            double log_res_120389 = futrts_log64(x_120388);
            double defunc_res_120390;
            double defunc_res_120391;
            double defunc_res_120392;
            int64_t flat_tid_120393 = (int64_t) 0;
            
            defunc_res_120390 = 0.0;
            defunc_res_120391 = 0.0;
            defunc_res_120392 = 0.0;
            
            struct futhark_mc_task_128584 futhark_mc_task_128584_;
            
            futhark_mc_task_128584_.ctx = ctx;
            futhark_mc_task_128584_.free_m_33388 = m_33388;
            futhark_mc_task_128584_.free_mem_param_118928 = mem_param_118928.mem;
            futhark_mc_task_128584_.free_gtid_120378 = gtid_120378;
            futhark_mc_task_128584_.free_flat_tid_120393 = flat_tid_120393;
            futhark_mc_task_128584_.retval_defunc_res_120390 = (double *) &defunc_res_120390;
            #if ISPC
            futhark_mc_task_128584_.retval_defunc_res_120390 += programIndex;
            #endif
            futhark_mc_task_128584_.retval_defunc_res_120391 = (double *) &defunc_res_120391;
            #if ISPC
            futhark_mc_task_128584_.retval_defunc_res_120391 += programIndex;
            #endif
            futhark_mc_task_128584_.retval_defunc_res_120392 = (double *) &defunc_res_120392;
            #if ISPC
            futhark_mc_task_128584_.retval_defunc_res_120392 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_128584_task;
            
            futhark_mc_task_128584_task.args = &futhark_mc_task_128584_;
            futhark_mc_task_128584_task.top_level_fn = futhark_mc_segred_task_128585;
            futhark_mc_task_128584_task.name = "futhark_mc_segred_task_128585";
            futhark_mc_task_128584_task.iterations = m_33388;
            futhark_mc_task_128584_task.task_time = &ctx->program->futhark_mc_segred_task_128585_total_time;
            futhark_mc_task_128584_task.task_iter = &ctx->program->futhark_mc_segred_task_128585_total_iter;
            futhark_mc_task_128584_task.sched = STATIC;
            futhark_mc_task_128584_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_128585_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128584_task);
            
            if (futhark_mc_segred_task_128585_err != 0) {
                err = futhark_mc_segred_task_128585_err;
                goto cleanup;
            }
            
            bool zeze_res_120405 = defunc_res_120390 == 0.0;
            double klu_res_120406;
            
            if (zeze_res_120405) {
                klu_res_120406 = 0.0;
            } else {
                double zs_res_120407 = defunc_res_120390 / x_120388;
                double log_res_120408 = futrts_log64(zs_res_120407);
                double zt_res_120409 = defunc_res_120390 * log_res_120408;
                
                klu_res_120406 = zt_res_120409;
            }
            // save map-out results
            {
                ((double *) mem_112412.mem)[gtid_120378] = defunc_res_120391;
                ((double *) mem_112414.mem)[gtid_120378] = defunc_res_120390;
                ((double *) mem_112416.mem)[gtid_120378] = log_res_120389;
            }
            // Load accum params
            {
                eta_p_120379 = local_acc_125055;
            }
            // Load next params
            {
                eta_p_120380 = klu_res_120406;
            }
            // SegRed body
            {
                double zp_res_120381 = eta_p_120379 + eta_p_120380;
                
                local_acc_125055 = zp_res_120381;
            }
            // Load accum params
            {
                eta_p_120382 = local_acc_125056;
            }
            // Load next params
            {
                eta_p_120383 = x_120388;
            }
            // SegRed body
            {
                double zp_res_120384 = eta_p_120382 + eta_p_120383;
                
                local_acc_125056 = zp_res_120384;
            }
            // Load accum params
            {
                eta_p_120385 = local_acc_125057;
            }
            // Load next params
            {
                eta_p_120386 = defunc_res_120392;
            }
            // SegRed body
            {
                double zp_res_120387 = eta_p_120385 + eta_p_120386;
                
                local_acc_125057 = zp_res_120387;
            }
        }
        
        int64_t uni_i_125099 = 0;
        
        {
            int64_t gtid_120378 = uni_i_125099;
            
            // Load accum params
            {
                eta_p_125043 = local_acc_125052;
            }
            // Load next params
            {
                eta_p_125044 = local_acc_125055;
            }
            // SegRed body
            {
                double zp_res_125045 = eta_p_125043 + eta_p_125044;
                
                local_acc_125052 = zp_res_125045;
            }
            // Load accum params
            {
                eta_p_125046 = local_acc_125053;
            }
            // Load next params
            {
                eta_p_125047 = local_acc_125056;
            }
            // SegRed body
            {
                double zp_res_125048 = eta_p_125046 + eta_p_125047;
                
                local_acc_125053 = zp_res_125048;
            }
            // Load accum params
            {
                eta_p_125049 = local_acc_125054;
            }
            // Load next params
            {
                eta_p_125050 = local_acc_125057;
            }
            // SegRed body
            {
                double zp_res_125051 = eta_p_125049 + eta_p_125050;
                
                local_acc_125054 = zp_res_125051;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_125037.mem)[flat_tid_120377] = local_acc_125052;
        ((double *) reduce_stage_1_tid_res_arr_mem_125039.mem)[flat_tid_120377] = local_acc_125053;
        ((double *) reduce_stage_1_tid_res_arr_mem_125041.mem)[flat_tid_120377] = local_acc_125054;
    }
    
  cleanup:
    { }
    if (event_128594 != NULL) {
        event_128594->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128583", strdup("nothing further"), event_128594, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_128578(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128568 *futhark_mc_task_128568 = (struct futhark_mc_task_128568 *) args;
    struct futhark_context *ctx = futhark_mc_task_128568->ctx;
    struct mc_event *event_128596 = mc_event_new(ctx);
    
    if (event_128596 != NULL)
        event_128596->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128568->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128568->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128568->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_task_128568->free_mem_param_118928, .size =0, .references =NULL};
    int64_t flat_tid_120377 = futhark_mc_task_128568->free_flat_tid_120377;
    int64_t flat_tid_120410 = futhark_mc_task_128568->free_flat_tid_120410;
    double defunc_res_120371 = *futhark_mc_task_128568->retval_defunc_res_120371;
    double defunc_res_120372 = *futhark_mc_task_128568->retval_defunc_res_120372;
    double defunc_res_120373 = *futhark_mc_task_128568->retval_defunc_res_120373;
    struct memblock mem_112412 = {.desc ="mem_112412", .mem =futhark_mc_task_128568->retval_mem_112412, .size =0, .references =NULL};
    struct memblock mem_112414 = {.desc ="mem_112414", .mem =futhark_mc_task_128568->retval_mem_112414, .size =0, .references =NULL};
    struct memblock mem_112416 = {.desc ="mem_112416", .mem =futhark_mc_task_128568->retval_mem_112416, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_125037_cached_sizze_128579 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125037 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_125039_cached_sizze_128580 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125039 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_125041_cached_sizze_128581 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125041 = NULL;
    int32_t nsubtasks_125036;
    
    nsubtasks_125036 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_125037_cached_sizze_128579 < (int64_t) 8 * nsubtasks_125036) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125037, &reduce_stage_1_tid_res_arr_mem_125037_cached_sizze_128579, (int64_t) 8 * nsubtasks_125036);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_125039_cached_sizze_128580 < (int64_t) 8 * nsubtasks_125036) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125039, &reduce_stage_1_tid_res_arr_mem_125039_cached_sizze_128580, (int64_t) 8 * nsubtasks_125036);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_125041_cached_sizze_128581 < (int64_t) 8 * nsubtasks_125036) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125041, &reduce_stage_1_tid_res_arr_mem_125041_cached_sizze_128581, (int64_t) 8 * nsubtasks_125036);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128582 futhark_mc_segred_stage_1_parloop_struct_128582_;
    
    futhark_mc_segred_stage_1_parloop_struct_128582_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128582_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128582_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128582_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_128582_.free_mem_112412 = mem_112412.mem;
    futhark_mc_segred_stage_1_parloop_struct_128582_.free_mem_112414 = mem_112414.mem;
    futhark_mc_segred_stage_1_parloop_struct_128582_.free_mem_112416 = mem_112416.mem;
    futhark_mc_segred_stage_1_parloop_struct_128582_.free_mem_param_118928 = mem_param_118928.mem;
    futhark_mc_segred_stage_1_parloop_struct_128582_.free_reduce_stage_1_tid_res_arr_mem_125037 = reduce_stage_1_tid_res_arr_mem_125037;
    futhark_mc_segred_stage_1_parloop_struct_128582_.free_reduce_stage_1_tid_res_arr_mem_125039 = reduce_stage_1_tid_res_arr_mem_125039;
    futhark_mc_segred_stage_1_parloop_struct_128582_.free_reduce_stage_1_tid_res_arr_mem_125041 = reduce_stage_1_tid_res_arr_mem_125041;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128583_task;
    
    futhark_mc_segred_stage_1_parloop_128583_task.name = "futhark_mc_segred_stage_1_parloop_128583";
    futhark_mc_segred_stage_1_parloop_128583_task.fn = futhark_mc_segred_stage_1_parloop_128583;
    futhark_mc_segred_stage_1_parloop_128583_task.args = &futhark_mc_segred_stage_1_parloop_struct_128582_;
    futhark_mc_segred_stage_1_parloop_128583_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128583_task.info = info;
    
    struct mc_event *event_128595 = mc_event_new(ctx);
    
    if (event_128595 != NULL)
        event_128595->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128583_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128583_task);
    
    if (futhark_mc_segred_stage_1_parloop_128583_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128583_err;
        goto cleanup;
    }
    if (event_128595 != NULL) {
        event_128595->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128583_total", strdup("nothing further"), event_128595, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_120371 = 0.0;
        defunc_res_120372 = 0.0;
        defunc_res_120373 = 0.0;
    }
    
    double eta_p_125100;
    double eta_p_125101;
    double eta_p_125103;
    double eta_p_125104;
    double eta_p_125106;
    double eta_p_125107;
    
    for (int32_t i_125109 = 0; i_125109 < nsubtasks_125036; i_125109++) {
        flat_tid_120377 = i_125109;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_125100 = defunc_res_120371;
            }
            // load next params
            {
                eta_p_125101 = ((double *) reduce_stage_1_tid_res_arr_mem_125037)[flat_tid_120377];
            }
            // red body
            {
                double zp_res_125102 = eta_p_125100 + eta_p_125101;
                
                defunc_res_120371 = zp_res_125102;
            }
            // load acc params
            {
                eta_p_125103 = defunc_res_120372;
            }
            // load next params
            {
                eta_p_125104 = ((double *) reduce_stage_1_tid_res_arr_mem_125039)[flat_tid_120377];
            }
            // red body
            {
                double zp_res_125105 = eta_p_125103 + eta_p_125104;
                
                defunc_res_120372 = zp_res_125105;
            }
            // load acc params
            {
                eta_p_125106 = defunc_res_120373;
            }
            // load next params
            {
                eta_p_125107 = ((double *) reduce_stage_1_tid_res_arr_mem_125041)[flat_tid_120377];
            }
            // red body
            {
                double zp_res_125108 = eta_p_125106 + eta_p_125107;
                
                defunc_res_120373 = zp_res_125108;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_125037);
        free(reduce_stage_1_tid_res_arr_mem_125039);
        free(reduce_stage_1_tid_res_arr_mem_125041);
    }
    if (event_128596 != NULL) {
        event_128596->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_128578", strdup("nothing further"), event_128596, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128568->retval_defunc_res_120371 = defunc_res_120371;
        *futhark_mc_task_128568->retval_defunc_res_120372 = defunc_res_120372;
        *futhark_mc_task_128568->retval_defunc_res_120373 = defunc_res_120373;
        futhark_mc_task_128568->retval_mem_112412 = mem_112412.mem;
        futhark_mc_task_128568->retval_mem_112414 = mem_112414.mem;
        futhark_mc_task_128568->retval_mem_112416 = mem_112416.mem;
    }
    return err;
}
struct futhark_mc_task_128597 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_112414;
    unsigned char *free_mem_112421;
    double free_zt_res_120440;
    double free_zt_res_120441;
};
struct futhark_mc_segmap_parloop_struct_128599 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_112414;
    unsigned char *free_mem_112421;
    double free_zt_res_120440;
    double free_zt_res_120441;
};
static int futhark_mc_segmap_parloop_128600(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_128599 *futhark_mc_segmap_parloop_struct_128599 = (struct futhark_mc_segmap_parloop_struct_128599 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_128599->ctx;
    struct mc_event *event_128601 = mc_event_new(ctx);
    
    if (event_128601 != NULL)
        event_128601->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_128599->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segmap_parloop_struct_128599->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segmap_parloop_struct_128599->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112414 = {.desc ="mem_112414", .mem =futhark_mc_segmap_parloop_struct_128599->free_mem_112414, .size =0, .references =NULL};
    struct memblock mem_112421 = {.desc ="mem_112421", .mem =futhark_mc_segmap_parloop_struct_128599->free_mem_112421, .size =0, .references =NULL};
    double zt_res_120440 = futhark_mc_segmap_parloop_struct_128599->free_zt_res_120440;
    double zt_res_120441 = futhark_mc_segmap_parloop_struct_128599->free_zt_res_120441;
    int64_t iterations = end - start;
    int64_t flat_tid_120443;
    
    flat_tid_120443 = subtask_id;
    {
        int64_t start_125111;
        int64_t end_125112;
        
        start_125111 = start;
        end_125112 = end;
        
        int64_t n_125113 = end_125112 - start_125111;
        
        for (int64_t SegMap_i_125114 = start_125111; SegMap_i_125114 < start_125111 + n_125113; SegMap_i_125114++) {
            int64_t slice_125115 = m_33388;
            int64_t gtid_120444 = SegMap_i_125114;
            int64_t remnant_125116 = SegMap_i_125114 - gtid_120444;
            double eta_p_120445 = ((double *) mem_112414.mem)[gtid_120444];
            double eta_p_120446 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + gtid_120444];
            double log_res_120447 = futrts_log64(eta_p_120445);
            double log_res_120448 = futrts_log64(eta_p_120446);
            double zm_res_120449 = log_res_120447 - log_res_120448;
            double zp_res_120450 = 1.0 + zm_res_120449;
            double fma_res_120451 = futrts_fma64(zt_res_120441, zp_res_120450, zt_res_120440);
            
            for (int64_t nest_i_125117 = 0; nest_i_125117 < m_33388; nest_i_125117++) {
                ((double *) mem_112421.mem)[gtid_120444 * m_33388 + nest_i_125117] = fma_res_120451;
            }
        }
    }
    
  cleanup:
    { }
    if (event_128601 != NULL) {
        event_128601->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128600", strdup("nothing further"), event_128601, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_task_128598(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128597 *futhark_mc_task_128597 = (struct futhark_mc_task_128597 *) args;
    struct futhark_context *ctx = futhark_mc_task_128597->ctx;
    struct mc_event *event_128603 = mc_event_new(ctx);
    
    if (event_128603 != NULL)
        event_128603->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128597->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128597->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128597->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112414 = {.desc ="mem_112414", .mem =futhark_mc_task_128597->free_mem_112414, .size =0, .references =NULL};
    struct memblock mem_112421 = {.desc ="mem_112421", .mem =futhark_mc_task_128597->free_mem_112421, .size =0, .references =NULL};
    double zt_res_120440 = futhark_mc_task_128597->free_zt_res_120440;
    double zt_res_120441 = futhark_mc_task_128597->free_zt_res_120441;
    int32_t nsubtasks_125110;
    
    nsubtasks_125110 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_128599 futhark_mc_segmap_parloop_struct_128599_;
    
    futhark_mc_segmap_parloop_struct_128599_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_128599_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_128599_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segmap_parloop_struct_128599_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segmap_parloop_struct_128599_.free_mem_112414 = mem_112414.mem;
    futhark_mc_segmap_parloop_struct_128599_.free_mem_112421 = mem_112421.mem;
    futhark_mc_segmap_parloop_struct_128599_.free_zt_res_120440 = zt_res_120440;
    futhark_mc_segmap_parloop_struct_128599_.free_zt_res_120441 = zt_res_120441;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_128600_task;
    
    futhark_mc_segmap_parloop_128600_task.name = "futhark_mc_segmap_parloop_128600";
    futhark_mc_segmap_parloop_128600_task.fn = futhark_mc_segmap_parloop_128600;
    futhark_mc_segmap_parloop_128600_task.args = &futhark_mc_segmap_parloop_struct_128599_;
    futhark_mc_segmap_parloop_128600_task.iterations = iterations;
    futhark_mc_segmap_parloop_128600_task.info = info;
    
    struct mc_event *event_128602 = mc_event_new(ctx);
    
    if (event_128602 != NULL)
        event_128602->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_128600_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_128600_task);
    
    if (futhark_mc_segmap_parloop_128600_err != 0) {
        err = futhark_mc_segmap_parloop_128600_err;
        goto cleanup;
    }
    if (event_128602 != NULL) {
        event_128602->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128600_total", strdup("nothing further"), event_128602, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_128603 != NULL) {
        event_128603->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_task_128598", strdup("nothing further"), event_128603, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_128604 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_param_118928;
    int64_t free_flat_tid_120459;
    int64_t free_flat_tid_120509;
    double *retval_defunc_res_120453;
    double *retval_defunc_res_120454;
    double *retval_defunc_res_120455;
    double *retval_defunc_res_120456;
    unsigned char *retval_mem_112423;
    unsigned char *retval_mem_112425;
};
struct futhark_mc_segred_stage_1_parloop_struct_128610 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_112423;
    unsigned char *free_mem_112425;
    unsigned char *free_mem_param_118928;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125119;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125121;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125123;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125125;
};
static int futhark_mc_segred_stage_1_parloop_128611(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128610 *futhark_mc_segred_stage_1_parloop_struct_128610 = (struct futhark_mc_segred_stage_1_parloop_struct_128610 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128610->ctx;
    struct mc_event *event_128612 = mc_event_new(ctx);
    
    if (event_128612 != NULL)
        event_128612->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128610->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_128610->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128610->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_128610->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112423 = {.desc ="mem_112423", .mem =futhark_mc_segred_stage_1_parloop_struct_128610->free_mem_112423, .size =0, .references =NULL};
    struct memblock mem_112425 = {.desc ="mem_112425", .mem =futhark_mc_segred_stage_1_parloop_struct_128610->free_mem_112425, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_segred_stage_1_parloop_struct_128610->free_mem_param_118928, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125119 = {.desc ="reduce_stage_1_tid_res_arr_mem_125119", .mem =futhark_mc_segred_stage_1_parloop_struct_128610->free_reduce_stage_1_tid_res_arr_mem_125119, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125121 = {.desc ="reduce_stage_1_tid_res_arr_mem_125121", .mem =futhark_mc_segred_stage_1_parloop_struct_128610->free_reduce_stage_1_tid_res_arr_mem_125121, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125123 = {.desc ="reduce_stage_1_tid_res_arr_mem_125123", .mem =futhark_mc_segred_stage_1_parloop_struct_128610->free_reduce_stage_1_tid_res_arr_mem_125123, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125125 = {.desc ="reduce_stage_1_tid_res_arr_mem_125125", .mem =futhark_mc_segred_stage_1_parloop_struct_128610->free_reduce_stage_1_tid_res_arr_mem_125125, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_120509;
    
    flat_tid_120509 = subtask_id;
    {
        double eta_p_125127;
        double eta_p_125128;
        double eta_p_125130;
        double eta_p_125131;
        double eta_p_125133;
        double eta_p_125134;
        double eta_p_125136;
        double eta_p_125137;
        double local_acc_125139 = 0.0;
        double local_acc_125140 = 0.0;
        double local_acc_125141 = 0.0;
        double local_acc_125142 = 0.0;
        double eta_p_120511;
        double eta_p_120512;
        double eta_p_120514;
        double eta_p_120515;
        double eta_p_120517;
        double eta_p_120518;
        double eta_p_120520;
        double eta_p_120521;
        double local_acc_125143 = 0.0;
        double local_acc_125144 = 0.0;
        double local_acc_125145 = 0.0;
        double local_acc_125146 = 0.0;
        int64_t start_125147;
        int64_t end_125148;
        
        start_125147 = start;
        end_125148 = end;
        
        int64_t n_125149 = end_125148 - start_125147;
        
        for (int64_t SegRed_i_125150 = start_125147; SegRed_i_125150 < start_125147 + n_125149; SegRed_i_125150++) {
            int64_t gtid_120510 = SegRed_i_125150;
            double eta_p_120523 = ((double *) distrs_mem_111708.mem)[eta_p_106382 * m_33388 + gtid_120510];
            double defunc_res_120524;
            double defunc_res_120525;
            double defunc_res_120526;
            double defunc_res_120527;
            double defunc_res_120528;
            double redout_120530;
            double redout_120531;
            double redout_120532;
            double redout_120533;
            double redout_120534;
            
            redout_120530 = 0.0;
            redout_120531 = 0.0;
            redout_120532 = 0.0;
            redout_120533 = 0.0;
            redout_120534 = 0.0;
            for (int64_t i_120529 = 0; i_120529 < m_33388; i_120529++) {
                double x_120535 = ((double *) mem_param_118928.mem)[gtid_120510 * m_33388 + i_120529];
                double eta_p_120536 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + i_120529];
                double zt_res_120537 = eta_p_120523 * eta_p_120536;
                bool zeze_res_120538 = x_120535 == 0.0;
                double klu_res_120539;
                
                if (zeze_res_120538) {
                    klu_res_120539 = 0.0;
                } else {
                    double zs_res_120540 = x_120535 / zt_res_120537;
                    double log_res_120541 = futrts_log64(zs_res_120540);
                    double zt_res_120542 = x_120535 * log_res_120541;
                    
                    klu_res_120539 = zt_res_120542;
                }
                
                double zp_res_120543 = x_120535 + redout_120530;
                double zp_res_120544 = klu_res_120539 + redout_120531;
                double zp_res_120545 = x_120535 + redout_120532;
                double zp_res_120546 = x_120535 + redout_120533;
                double zp_res_120547 = x_120535 + redout_120534;
                double redout_tmp_125151 = zp_res_120543;
                double redout_tmp_125152 = zp_res_120544;
                double redout_tmp_125153 = zp_res_120545;
                double redout_tmp_125154 = zp_res_120546;
                double redout_tmp_125155 = zp_res_120547;
                
                redout_120530 = redout_tmp_125151;
                redout_120531 = redout_tmp_125152;
                redout_120532 = redout_tmp_125153;
                redout_120533 = redout_tmp_125154;
                redout_120534 = redout_tmp_125155;
            }
            defunc_res_120524 = redout_120530;
            defunc_res_120525 = redout_120531;
            defunc_res_120526 = redout_120532;
            defunc_res_120527 = redout_120533;
            defunc_res_120528 = redout_120534;
            
            bool zeze_res_120548 = defunc_res_120528 == 0.0;
            double klu_res_120549;
            
            if (zeze_res_120548) {
                klu_res_120549 = 0.0;
            } else {
                double zs_res_120550 = defunc_res_120528 / eta_p_120523;
                double log_res_120551 = futrts_log64(zs_res_120550);
                double zt_res_120552 = defunc_res_120528 * log_res_120551;
                
                klu_res_120549 = zt_res_120552;
            }
            // save map-out results
            {
                ((double *) mem_112423.mem)[gtid_120510] = defunc_res_120528;
                ((double *) mem_112425.mem)[gtid_120510] = defunc_res_120526;
            }
            // Load accum params
            {
                eta_p_120511 = local_acc_125143;
            }
            // Load next params
            {
                eta_p_120512 = defunc_res_120524;
            }
            // SegRed body
            {
                double zp_res_120513 = eta_p_120511 + eta_p_120512;
                
                local_acc_125143 = zp_res_120513;
            }
            // Load accum params
            {
                eta_p_120514 = local_acc_125144;
            }
            // Load next params
            {
                eta_p_120515 = defunc_res_120525;
            }
            // SegRed body
            {
                double zp_res_120516 = eta_p_120514 + eta_p_120515;
                
                local_acc_125144 = zp_res_120516;
            }
            // Load accum params
            {
                eta_p_120517 = local_acc_125145;
            }
            // Load next params
            {
                eta_p_120518 = defunc_res_120527;
            }
            // SegRed body
            {
                double zp_res_120519 = eta_p_120517 + eta_p_120518;
                
                local_acc_125145 = zp_res_120519;
            }
            // Load accum params
            {
                eta_p_120520 = local_acc_125146;
            }
            // Load next params
            {
                eta_p_120521 = klu_res_120549;
            }
            // SegRed body
            {
                double zp_res_120522 = eta_p_120520 + eta_p_120521;
                
                local_acc_125146 = zp_res_120522;
            }
        }
        
        int64_t uni_i_125156 = 0;
        
        {
            int64_t gtid_120510 = uni_i_125156;
            
            // Load accum params
            {
                eta_p_125127 = local_acc_125139;
            }
            // Load next params
            {
                eta_p_125128 = local_acc_125143;
            }
            // SegRed body
            {
                double zp_res_125129 = eta_p_125127 + eta_p_125128;
                
                local_acc_125139 = zp_res_125129;
            }
            // Load accum params
            {
                eta_p_125130 = local_acc_125140;
            }
            // Load next params
            {
                eta_p_125131 = local_acc_125144;
            }
            // SegRed body
            {
                double zp_res_125132 = eta_p_125130 + eta_p_125131;
                
                local_acc_125140 = zp_res_125132;
            }
            // Load accum params
            {
                eta_p_125133 = local_acc_125141;
            }
            // Load next params
            {
                eta_p_125134 = local_acc_125145;
            }
            // SegRed body
            {
                double zp_res_125135 = eta_p_125133 + eta_p_125134;
                
                local_acc_125141 = zp_res_125135;
            }
            // Load accum params
            {
                eta_p_125136 = local_acc_125142;
            }
            // Load next params
            {
                eta_p_125137 = local_acc_125146;
            }
            // SegRed body
            {
                double zp_res_125138 = eta_p_125136 + eta_p_125137;
                
                local_acc_125142 = zp_res_125138;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_125119.mem)[flat_tid_120509] = local_acc_125139;
        ((double *) reduce_stage_1_tid_res_arr_mem_125121.mem)[flat_tid_120509] = local_acc_125140;
        ((double *) reduce_stage_1_tid_res_arr_mem_125123.mem)[flat_tid_120509] = local_acc_125141;
        ((double *) reduce_stage_1_tid_res_arr_mem_125125.mem)[flat_tid_120509] = local_acc_125142;
    }
    
  cleanup:
    { }
    if (event_128612 != NULL) {
        event_128612->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128611", strdup("nothing further"), event_128612, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128605(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128604 *futhark_mc_task_128604 = (struct futhark_mc_task_128604 *) args;
    struct futhark_context *ctx = futhark_mc_task_128604->ctx;
    struct mc_event *event_128614 = mc_event_new(ctx);
    
    if (event_128614 != NULL)
        event_128614->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128604->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_128604->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128604->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128604->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_task_128604->free_mem_param_118928, .size =0, .references =NULL};
    int64_t flat_tid_120459 = futhark_mc_task_128604->free_flat_tid_120459;
    int64_t flat_tid_120509 = futhark_mc_task_128604->free_flat_tid_120509;
    double defunc_res_120453 = *futhark_mc_task_128604->retval_defunc_res_120453;
    double defunc_res_120454 = *futhark_mc_task_128604->retval_defunc_res_120454;
    double defunc_res_120455 = *futhark_mc_task_128604->retval_defunc_res_120455;
    double defunc_res_120456 = *futhark_mc_task_128604->retval_defunc_res_120456;
    struct memblock mem_112423 = {.desc ="mem_112423", .mem =futhark_mc_task_128604->retval_mem_112423, .size =0, .references =NULL};
    struct memblock mem_112425 = {.desc ="mem_112425", .mem =futhark_mc_task_128604->retval_mem_112425, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_125119_cached_sizze_128606 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125119 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_125121_cached_sizze_128607 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125121 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_125123_cached_sizze_128608 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125123 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_125125_cached_sizze_128609 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125125 = NULL;
    int32_t nsubtasks_125118;
    
    nsubtasks_125118 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_125119_cached_sizze_128606 < (int64_t) 8 * nsubtasks_125118) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125119, &reduce_stage_1_tid_res_arr_mem_125119_cached_sizze_128606, (int64_t) 8 * nsubtasks_125118);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_125121_cached_sizze_128607 < (int64_t) 8 * nsubtasks_125118) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125121, &reduce_stage_1_tid_res_arr_mem_125121_cached_sizze_128607, (int64_t) 8 * nsubtasks_125118);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_125123_cached_sizze_128608 < (int64_t) 8 * nsubtasks_125118) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125123, &reduce_stage_1_tid_res_arr_mem_125123_cached_sizze_128608, (int64_t) 8 * nsubtasks_125118);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_125125_cached_sizze_128609 < (int64_t) 8 * nsubtasks_125118) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125125, &reduce_stage_1_tid_res_arr_mem_125125_cached_sizze_128609, (int64_t) 8 * nsubtasks_125118);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128610 futhark_mc_segred_stage_1_parloop_struct_128610_;
    
    futhark_mc_segred_stage_1_parloop_struct_128610_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128610_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128610_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_128610_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128610_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_128610_.free_mem_112423 = mem_112423.mem;
    futhark_mc_segred_stage_1_parloop_struct_128610_.free_mem_112425 = mem_112425.mem;
    futhark_mc_segred_stage_1_parloop_struct_128610_.free_mem_param_118928 = mem_param_118928.mem;
    futhark_mc_segred_stage_1_parloop_struct_128610_.free_reduce_stage_1_tid_res_arr_mem_125119 = reduce_stage_1_tid_res_arr_mem_125119;
    futhark_mc_segred_stage_1_parloop_struct_128610_.free_reduce_stage_1_tid_res_arr_mem_125121 = reduce_stage_1_tid_res_arr_mem_125121;
    futhark_mc_segred_stage_1_parloop_struct_128610_.free_reduce_stage_1_tid_res_arr_mem_125123 = reduce_stage_1_tid_res_arr_mem_125123;
    futhark_mc_segred_stage_1_parloop_struct_128610_.free_reduce_stage_1_tid_res_arr_mem_125125 = reduce_stage_1_tid_res_arr_mem_125125;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128611_task;
    
    futhark_mc_segred_stage_1_parloop_128611_task.name = "futhark_mc_segred_stage_1_parloop_128611";
    futhark_mc_segred_stage_1_parloop_128611_task.fn = futhark_mc_segred_stage_1_parloop_128611;
    futhark_mc_segred_stage_1_parloop_128611_task.args = &futhark_mc_segred_stage_1_parloop_struct_128610_;
    futhark_mc_segred_stage_1_parloop_128611_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128611_task.info = info;
    
    struct mc_event *event_128613 = mc_event_new(ctx);
    
    if (event_128613 != NULL)
        event_128613->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128611_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128611_task);
    
    if (futhark_mc_segred_stage_1_parloop_128611_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128611_err;
        goto cleanup;
    }
    if (event_128613 != NULL) {
        event_128613->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128611_total", strdup("nothing further"), event_128613, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_120453 = 0.0;
        defunc_res_120454 = 0.0;
        defunc_res_120455 = 0.0;
        defunc_res_120456 = 0.0;
    }
    
    double eta_p_125157;
    double eta_p_125158;
    double eta_p_125160;
    double eta_p_125161;
    double eta_p_125163;
    double eta_p_125164;
    double eta_p_125166;
    double eta_p_125167;
    
    for (int32_t i_125169 = 0; i_125169 < nsubtasks_125118; i_125169++) {
        flat_tid_120509 = i_125169;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_125157 = defunc_res_120453;
            }
            // load next params
            {
                eta_p_125158 = ((double *) reduce_stage_1_tid_res_arr_mem_125119)[flat_tid_120509];
            }
            // red body
            {
                double zp_res_125159 = eta_p_125157 + eta_p_125158;
                
                defunc_res_120453 = zp_res_125159;
            }
            // load acc params
            {
                eta_p_125160 = defunc_res_120454;
            }
            // load next params
            {
                eta_p_125161 = ((double *) reduce_stage_1_tid_res_arr_mem_125121)[flat_tid_120509];
            }
            // red body
            {
                double zp_res_125162 = eta_p_125160 + eta_p_125161;
                
                defunc_res_120454 = zp_res_125162;
            }
            // load acc params
            {
                eta_p_125163 = defunc_res_120455;
            }
            // load next params
            {
                eta_p_125164 = ((double *) reduce_stage_1_tid_res_arr_mem_125123)[flat_tid_120509];
            }
            // red body
            {
                double zp_res_125165 = eta_p_125163 + eta_p_125164;
                
                defunc_res_120455 = zp_res_125165;
            }
            // load acc params
            {
                eta_p_125166 = defunc_res_120456;
            }
            // load next params
            {
                eta_p_125167 = ((double *) reduce_stage_1_tid_res_arr_mem_125125)[flat_tid_120509];
            }
            // red body
            {
                double zp_res_125168 = eta_p_125166 + eta_p_125167;
                
                defunc_res_120456 = zp_res_125168;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_125119);
        free(reduce_stage_1_tid_res_arr_mem_125121);
        free(reduce_stage_1_tid_res_arr_mem_125123);
        free(reduce_stage_1_tid_res_arr_mem_125125);
    }
    if (event_128614 != NULL) {
        event_128614->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128605", strdup("nothing further"), event_128614, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128604->retval_defunc_res_120453 = defunc_res_120453;
        *futhark_mc_task_128604->retval_defunc_res_120454 = defunc_res_120454;
        *futhark_mc_task_128604->retval_defunc_res_120455 = defunc_res_120455;
        *futhark_mc_task_128604->retval_defunc_res_120456 = defunc_res_120456;
        futhark_mc_task_128604->retval_mem_112423 = mem_112423.mem;
        futhark_mc_task_128604->retval_mem_112425 = mem_112425.mem;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_128620 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_112423;
    unsigned char *free_mem_112425;
    unsigned char *free_mem_param_118928;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125171;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125173;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125175;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125177;
};
struct futhark_mc_task_128622 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_param_118928;
    int64_t free_gtid_120460;
    double free_eta_p_120473;
    int64_t free_flat_tid_120479;
    double *retval_defunc_res_120474;
    double *retval_defunc_res_120475;
    double *retval_defunc_res_120476;
    double *retval_defunc_res_120477;
    double *retval_defunc_res_120478;
};
struct futhark_mc_segred_stage_1_parloop_struct_128629 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_param_118928;
    int64_t free_gtid_120460;
    double free_eta_p_120473;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125204;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125206;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125208;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125210;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125212;
};
static int futhark_mc_segred_stage_1_parloop_128630(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128629 *futhark_mc_segred_stage_1_parloop_struct_128629 = (struct futhark_mc_segred_stage_1_parloop_struct_128629 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128629->ctx;
    struct mc_event *event_128631 = mc_event_new(ctx);
    
    if (event_128631 != NULL)
        event_128631->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128629->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128629->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_128629->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_segred_stage_1_parloop_struct_128629->free_mem_param_118928, .size =0, .references =NULL};
    int64_t gtid_120460 = futhark_mc_segred_stage_1_parloop_struct_128629->free_gtid_120460;
    double eta_p_120473 = futhark_mc_segred_stage_1_parloop_struct_128629->free_eta_p_120473;
    struct memblock reduce_stage_1_tid_res_arr_mem_125204 = {.desc ="reduce_stage_1_tid_res_arr_mem_125204", .mem =futhark_mc_segred_stage_1_parloop_struct_128629->free_reduce_stage_1_tid_res_arr_mem_125204, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125206 = {.desc ="reduce_stage_1_tid_res_arr_mem_125206", .mem =futhark_mc_segred_stage_1_parloop_struct_128629->free_reduce_stage_1_tid_res_arr_mem_125206, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125208 = {.desc ="reduce_stage_1_tid_res_arr_mem_125208", .mem =futhark_mc_segred_stage_1_parloop_struct_128629->free_reduce_stage_1_tid_res_arr_mem_125208, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125210 = {.desc ="reduce_stage_1_tid_res_arr_mem_125210", .mem =futhark_mc_segred_stage_1_parloop_struct_128629->free_reduce_stage_1_tid_res_arr_mem_125210, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125212 = {.desc ="reduce_stage_1_tid_res_arr_mem_125212", .mem =futhark_mc_segred_stage_1_parloop_struct_128629->free_reduce_stage_1_tid_res_arr_mem_125212, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_120479;
    
    flat_tid_120479 = subtask_id;
    {
        double eta_p_125214;
        double eta_p_125215;
        double eta_p_125217;
        double eta_p_125218;
        double eta_p_125220;
        double eta_p_125221;
        double eta_p_125223;
        double eta_p_125224;
        double eta_p_125226;
        double eta_p_125227;
        double local_acc_125229 = 0.0;
        double local_acc_125230 = 0.0;
        double local_acc_125231 = 0.0;
        double local_acc_125232 = 0.0;
        double local_acc_125233 = 0.0;
        double eta_p_120481;
        double eta_p_120482;
        double eta_p_120484;
        double eta_p_120485;
        double eta_p_120487;
        double eta_p_120488;
        double eta_p_120490;
        double eta_p_120491;
        double eta_p_120493;
        double eta_p_120494;
        double local_acc_125234 = 0.0;
        double local_acc_125235 = 0.0;
        double local_acc_125236 = 0.0;
        double local_acc_125237 = 0.0;
        double local_acc_125238 = 0.0;
        int64_t start_125239;
        int64_t end_125240;
        
        start_125239 = start;
        end_125240 = end;
        
        int64_t n_125241 = end_125240 - start_125239;
        
        for (int64_t SegRed_i_125242 = start_125239; SegRed_i_125242 < start_125239 + n_125241; SegRed_i_125242++) {
            int64_t gtid_120480 = SegRed_i_125242;
            double x_120496 = ((double *) mem_param_118928.mem)[gtid_120460 * m_33388 + gtid_120480];
            double eta_p_120497 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + gtid_120480];
            double zt_res_120498 = eta_p_120473 * eta_p_120497;
            bool zeze_res_120499 = x_120496 == 0.0;
            double klu_res_120500;
            
            if (zeze_res_120499) {
                klu_res_120500 = 0.0;
            } else {
                double zs_res_120501 = x_120496 / zt_res_120498;
                double log_res_120502 = futrts_log64(zs_res_120501);
                double zt_res_120503 = x_120496 * log_res_120502;
                
                klu_res_120500 = zt_res_120503;
            }
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_120481 = local_acc_125234;
            }
            // Load next params
            {
                eta_p_120482 = x_120496;
            }
            // SegRed body
            {
                double zp_res_120483 = eta_p_120481 + eta_p_120482;
                
                local_acc_125234 = zp_res_120483;
            }
            // Load accum params
            {
                eta_p_120484 = local_acc_125235;
            }
            // Load next params
            {
                eta_p_120485 = klu_res_120500;
            }
            // SegRed body
            {
                double zp_res_120486 = eta_p_120484 + eta_p_120485;
                
                local_acc_125235 = zp_res_120486;
            }
            // Load accum params
            {
                eta_p_120487 = local_acc_125236;
            }
            // Load next params
            {
                eta_p_120488 = x_120496;
            }
            // SegRed body
            {
                double zp_res_120489 = eta_p_120487 + eta_p_120488;
                
                local_acc_125236 = zp_res_120489;
            }
            // Load accum params
            {
                eta_p_120490 = local_acc_125237;
            }
            // Load next params
            {
                eta_p_120491 = x_120496;
            }
            // SegRed body
            {
                double zp_res_120492 = eta_p_120490 + eta_p_120491;
                
                local_acc_125237 = zp_res_120492;
            }
            // Load accum params
            {
                eta_p_120493 = local_acc_125238;
            }
            // Load next params
            {
                eta_p_120494 = x_120496;
            }
            // SegRed body
            {
                double zp_res_120495 = eta_p_120493 + eta_p_120494;
                
                local_acc_125238 = zp_res_120495;
            }
        }
        
        int64_t uni_i_125243 = 0;
        
        {
            int64_t gtid_120480 = uni_i_125243;
            
            // Load accum params
            {
                eta_p_125214 = local_acc_125229;
            }
            // Load next params
            {
                eta_p_125215 = local_acc_125234;
            }
            // SegRed body
            {
                double zp_res_125216 = eta_p_125214 + eta_p_125215;
                
                local_acc_125229 = zp_res_125216;
            }
            // Load accum params
            {
                eta_p_125217 = local_acc_125230;
            }
            // Load next params
            {
                eta_p_125218 = local_acc_125235;
            }
            // SegRed body
            {
                double zp_res_125219 = eta_p_125217 + eta_p_125218;
                
                local_acc_125230 = zp_res_125219;
            }
            // Load accum params
            {
                eta_p_125220 = local_acc_125231;
            }
            // Load next params
            {
                eta_p_125221 = local_acc_125236;
            }
            // SegRed body
            {
                double zp_res_125222 = eta_p_125220 + eta_p_125221;
                
                local_acc_125231 = zp_res_125222;
            }
            // Load accum params
            {
                eta_p_125223 = local_acc_125232;
            }
            // Load next params
            {
                eta_p_125224 = local_acc_125237;
            }
            // SegRed body
            {
                double zp_res_125225 = eta_p_125223 + eta_p_125224;
                
                local_acc_125232 = zp_res_125225;
            }
            // Load accum params
            {
                eta_p_125226 = local_acc_125233;
            }
            // Load next params
            {
                eta_p_125227 = local_acc_125238;
            }
            // SegRed body
            {
                double zp_res_125228 = eta_p_125226 + eta_p_125227;
                
                local_acc_125233 = zp_res_125228;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_125204.mem)[flat_tid_120479] = local_acc_125229;
        ((double *) reduce_stage_1_tid_res_arr_mem_125206.mem)[flat_tid_120479] = local_acc_125230;
        ((double *) reduce_stage_1_tid_res_arr_mem_125208.mem)[flat_tid_120479] = local_acc_125231;
        ((double *) reduce_stage_1_tid_res_arr_mem_125210.mem)[flat_tid_120479] = local_acc_125232;
        ((double *) reduce_stage_1_tid_res_arr_mem_125212.mem)[flat_tid_120479] = local_acc_125233;
    }
    
  cleanup:
    { }
    if (event_128631 != NULL) {
        event_128631->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128630", strdup("nothing further"), event_128631, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128623(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128622 *futhark_mc_task_128622 = (struct futhark_mc_task_128622 *) args;
    struct futhark_context *ctx = futhark_mc_task_128622->ctx;
    struct mc_event *event_128633 = mc_event_new(ctx);
    
    if (event_128633 != NULL)
        event_128633->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128622->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128622->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128622->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_task_128622->free_mem_param_118928, .size =0, .references =NULL};
    int64_t gtid_120460 = futhark_mc_task_128622->free_gtid_120460;
    double eta_p_120473 = futhark_mc_task_128622->free_eta_p_120473;
    int64_t flat_tid_120479 = futhark_mc_task_128622->free_flat_tid_120479;
    double defunc_res_120474 = *futhark_mc_task_128622->retval_defunc_res_120474;
    double defunc_res_120475 = *futhark_mc_task_128622->retval_defunc_res_120475;
    double defunc_res_120476 = *futhark_mc_task_128622->retval_defunc_res_120476;
    double defunc_res_120477 = *futhark_mc_task_128622->retval_defunc_res_120477;
    double defunc_res_120478 = *futhark_mc_task_128622->retval_defunc_res_120478;
    int64_t reduce_stage_1_tid_res_arr_mem_125204_cached_sizze_128624 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125204 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_125206_cached_sizze_128625 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125206 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_125208_cached_sizze_128626 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125208 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_125210_cached_sizze_128627 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125210 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_125212_cached_sizze_128628 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125212 = NULL;
    int32_t nsubtasks_125203;
    
    nsubtasks_125203 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_125204_cached_sizze_128624 < (int64_t) 8 * nsubtasks_125203) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125204, &reduce_stage_1_tid_res_arr_mem_125204_cached_sizze_128624, (int64_t) 8 * nsubtasks_125203);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_125206_cached_sizze_128625 < (int64_t) 8 * nsubtasks_125203) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125206, &reduce_stage_1_tid_res_arr_mem_125206_cached_sizze_128625, (int64_t) 8 * nsubtasks_125203);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_125208_cached_sizze_128626 < (int64_t) 8 * nsubtasks_125203) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125208, &reduce_stage_1_tid_res_arr_mem_125208_cached_sizze_128626, (int64_t) 8 * nsubtasks_125203);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_125210_cached_sizze_128627 < (int64_t) 8 * nsubtasks_125203) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125210, &reduce_stage_1_tid_res_arr_mem_125210_cached_sizze_128627, (int64_t) 8 * nsubtasks_125203);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_125212_cached_sizze_128628 < (int64_t) 8 * nsubtasks_125203) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125212, &reduce_stage_1_tid_res_arr_mem_125212_cached_sizze_128628, (int64_t) 8 * nsubtasks_125203);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128629 futhark_mc_segred_stage_1_parloop_struct_128629_;
    
    futhark_mc_segred_stage_1_parloop_struct_128629_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128629_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128629_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128629_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_128629_.free_mem_param_118928 = mem_param_118928.mem;
    futhark_mc_segred_stage_1_parloop_struct_128629_.free_gtid_120460 = gtid_120460;
    futhark_mc_segred_stage_1_parloop_struct_128629_.free_eta_p_120473 = eta_p_120473;
    futhark_mc_segred_stage_1_parloop_struct_128629_.free_reduce_stage_1_tid_res_arr_mem_125204 = reduce_stage_1_tid_res_arr_mem_125204;
    futhark_mc_segred_stage_1_parloop_struct_128629_.free_reduce_stage_1_tid_res_arr_mem_125206 = reduce_stage_1_tid_res_arr_mem_125206;
    futhark_mc_segred_stage_1_parloop_struct_128629_.free_reduce_stage_1_tid_res_arr_mem_125208 = reduce_stage_1_tid_res_arr_mem_125208;
    futhark_mc_segred_stage_1_parloop_struct_128629_.free_reduce_stage_1_tid_res_arr_mem_125210 = reduce_stage_1_tid_res_arr_mem_125210;
    futhark_mc_segred_stage_1_parloop_struct_128629_.free_reduce_stage_1_tid_res_arr_mem_125212 = reduce_stage_1_tid_res_arr_mem_125212;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128630_task;
    
    futhark_mc_segred_stage_1_parloop_128630_task.name = "futhark_mc_segred_stage_1_parloop_128630";
    futhark_mc_segred_stage_1_parloop_128630_task.fn = futhark_mc_segred_stage_1_parloop_128630;
    futhark_mc_segred_stage_1_parloop_128630_task.args = &futhark_mc_segred_stage_1_parloop_struct_128629_;
    futhark_mc_segred_stage_1_parloop_128630_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128630_task.info = info;
    
    struct mc_event *event_128632 = mc_event_new(ctx);
    
    if (event_128632 != NULL)
        event_128632->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128630_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128630_task);
    
    if (futhark_mc_segred_stage_1_parloop_128630_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128630_err;
        goto cleanup;
    }
    if (event_128632 != NULL) {
        event_128632->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128630_total", strdup("nothing further"), event_128632, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_120474 = 0.0;
        defunc_res_120475 = 0.0;
        defunc_res_120476 = 0.0;
        defunc_res_120477 = 0.0;
        defunc_res_120478 = 0.0;
    }
    
    double eta_p_125244;
    double eta_p_125245;
    double eta_p_125247;
    double eta_p_125248;
    double eta_p_125250;
    double eta_p_125251;
    double eta_p_125253;
    double eta_p_125254;
    double eta_p_125256;
    double eta_p_125257;
    
    for (int32_t i_125259 = 0; i_125259 < nsubtasks_125203; i_125259++) {
        flat_tid_120479 = i_125259;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_125244 = defunc_res_120474;
            }
            // load next params
            {
                eta_p_125245 = ((double *) reduce_stage_1_tid_res_arr_mem_125204)[flat_tid_120479];
            }
            // red body
            {
                double zp_res_125246 = eta_p_125244 + eta_p_125245;
                
                defunc_res_120474 = zp_res_125246;
            }
            // load acc params
            {
                eta_p_125247 = defunc_res_120475;
            }
            // load next params
            {
                eta_p_125248 = ((double *) reduce_stage_1_tid_res_arr_mem_125206)[flat_tid_120479];
            }
            // red body
            {
                double zp_res_125249 = eta_p_125247 + eta_p_125248;
                
                defunc_res_120475 = zp_res_125249;
            }
            // load acc params
            {
                eta_p_125250 = defunc_res_120476;
            }
            // load next params
            {
                eta_p_125251 = ((double *) reduce_stage_1_tid_res_arr_mem_125208)[flat_tid_120479];
            }
            // red body
            {
                double zp_res_125252 = eta_p_125250 + eta_p_125251;
                
                defunc_res_120476 = zp_res_125252;
            }
            // load acc params
            {
                eta_p_125253 = defunc_res_120477;
            }
            // load next params
            {
                eta_p_125254 = ((double *) reduce_stage_1_tid_res_arr_mem_125210)[flat_tid_120479];
            }
            // red body
            {
                double zp_res_125255 = eta_p_125253 + eta_p_125254;
                
                defunc_res_120477 = zp_res_125255;
            }
            // load acc params
            {
                eta_p_125256 = defunc_res_120478;
            }
            // load next params
            {
                eta_p_125257 = ((double *) reduce_stage_1_tid_res_arr_mem_125212)[flat_tid_120479];
            }
            // red body
            {
                double zp_res_125258 = eta_p_125256 + eta_p_125257;
                
                defunc_res_120478 = zp_res_125258;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_125204);
        free(reduce_stage_1_tid_res_arr_mem_125206);
        free(reduce_stage_1_tid_res_arr_mem_125208);
        free(reduce_stage_1_tid_res_arr_mem_125210);
        free(reduce_stage_1_tid_res_arr_mem_125212);
    }
    if (event_128633 != NULL) {
        event_128633->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128623", strdup("nothing further"), event_128633, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128622->retval_defunc_res_120474 = defunc_res_120474;
        *futhark_mc_task_128622->retval_defunc_res_120475 = defunc_res_120475;
        *futhark_mc_task_128622->retval_defunc_res_120476 = defunc_res_120476;
        *futhark_mc_task_128622->retval_defunc_res_120477 = defunc_res_120477;
        *futhark_mc_task_128622->retval_defunc_res_120478 = defunc_res_120478;
    }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_128621(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128620 *futhark_mc_segred_stage_1_parloop_struct_128620 = (struct futhark_mc_segred_stage_1_parloop_struct_128620 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128620->ctx;
    struct mc_event *event_128634 = mc_event_new(ctx);
    
    if (event_128634 != NULL)
        event_128634->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128620->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_128620->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128620->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_128620->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112423 = {.desc ="mem_112423", .mem =futhark_mc_segred_stage_1_parloop_struct_128620->free_mem_112423, .size =0, .references =NULL};
    struct memblock mem_112425 = {.desc ="mem_112425", .mem =futhark_mc_segred_stage_1_parloop_struct_128620->free_mem_112425, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_segred_stage_1_parloop_struct_128620->free_mem_param_118928, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125171 = {.desc ="reduce_stage_1_tid_res_arr_mem_125171", .mem =futhark_mc_segred_stage_1_parloop_struct_128620->free_reduce_stage_1_tid_res_arr_mem_125171, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125173 = {.desc ="reduce_stage_1_tid_res_arr_mem_125173", .mem =futhark_mc_segred_stage_1_parloop_struct_128620->free_reduce_stage_1_tid_res_arr_mem_125173, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125175 = {.desc ="reduce_stage_1_tid_res_arr_mem_125175", .mem =futhark_mc_segred_stage_1_parloop_struct_128620->free_reduce_stage_1_tid_res_arr_mem_125175, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125177 = {.desc ="reduce_stage_1_tid_res_arr_mem_125177", .mem =futhark_mc_segred_stage_1_parloop_struct_128620->free_reduce_stage_1_tid_res_arr_mem_125177, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_120459;
    
    flat_tid_120459 = subtask_id;
    {
        double eta_p_125179;
        double eta_p_125180;
        double eta_p_125182;
        double eta_p_125183;
        double eta_p_125185;
        double eta_p_125186;
        double eta_p_125188;
        double eta_p_125189;
        double local_acc_125191 = 0.0;
        double local_acc_125192 = 0.0;
        double local_acc_125193 = 0.0;
        double local_acc_125194 = 0.0;
        double eta_p_120461;
        double eta_p_120462;
        double eta_p_120464;
        double eta_p_120465;
        double eta_p_120467;
        double eta_p_120468;
        double eta_p_120470;
        double eta_p_120471;
        double local_acc_125195 = 0.0;
        double local_acc_125196 = 0.0;
        double local_acc_125197 = 0.0;
        double local_acc_125198 = 0.0;
        int64_t start_125199;
        int64_t end_125200;
        
        start_125199 = start;
        end_125200 = end;
        
        int64_t n_125201 = end_125200 - start_125199;
        
        for (int64_t SegRed_i_125202 = start_125199; SegRed_i_125202 < start_125199 + n_125201; SegRed_i_125202++) {
            int64_t gtid_120460 = SegRed_i_125202;
            double eta_p_120473 = ((double *) distrs_mem_111708.mem)[eta_p_106382 * m_33388 + gtid_120460];
            double defunc_res_120474;
            double defunc_res_120475;
            double defunc_res_120476;
            double defunc_res_120477;
            double defunc_res_120478;
            int64_t flat_tid_120479 = (int64_t) 0;
            
            defunc_res_120474 = 0.0;
            defunc_res_120475 = 0.0;
            defunc_res_120476 = 0.0;
            defunc_res_120477 = 0.0;
            defunc_res_120478 = 0.0;
            
            struct futhark_mc_task_128622 futhark_mc_task_128622_;
            
            futhark_mc_task_128622_.ctx = ctx;
            futhark_mc_task_128622_.free_m_33388 = m_33388;
            futhark_mc_task_128622_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
            futhark_mc_task_128622_.free_distrs_mem_111708 = distrs_mem_111708.mem;
            futhark_mc_task_128622_.free_mem_param_118928 = mem_param_118928.mem;
            futhark_mc_task_128622_.free_gtid_120460 = gtid_120460;
            futhark_mc_task_128622_.free_eta_p_120473 = eta_p_120473;
            futhark_mc_task_128622_.free_flat_tid_120479 = flat_tid_120479;
            futhark_mc_task_128622_.retval_defunc_res_120474 = (double *) &defunc_res_120474;
            #if ISPC
            futhark_mc_task_128622_.retval_defunc_res_120474 += programIndex;
            #endif
            futhark_mc_task_128622_.retval_defunc_res_120475 = (double *) &defunc_res_120475;
            #if ISPC
            futhark_mc_task_128622_.retval_defunc_res_120475 += programIndex;
            #endif
            futhark_mc_task_128622_.retval_defunc_res_120476 = (double *) &defunc_res_120476;
            #if ISPC
            futhark_mc_task_128622_.retval_defunc_res_120476 += programIndex;
            #endif
            futhark_mc_task_128622_.retval_defunc_res_120477 = (double *) &defunc_res_120477;
            #if ISPC
            futhark_mc_task_128622_.retval_defunc_res_120477 += programIndex;
            #endif
            futhark_mc_task_128622_.retval_defunc_res_120478 = (double *) &defunc_res_120478;
            #if ISPC
            futhark_mc_task_128622_.retval_defunc_res_120478 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_128622_task;
            
            futhark_mc_task_128622_task.args = &futhark_mc_task_128622_;
            futhark_mc_task_128622_task.top_level_fn = futhark_mc_segred_task_128623;
            futhark_mc_task_128622_task.name = "futhark_mc_segred_task_128623";
            futhark_mc_task_128622_task.iterations = m_33388;
            futhark_mc_task_128622_task.task_time = &ctx->program->futhark_mc_segred_task_128623_total_time;
            futhark_mc_task_128622_task.task_iter = &ctx->program->futhark_mc_segred_task_128623_total_iter;
            futhark_mc_task_128622_task.sched = STATIC;
            futhark_mc_task_128622_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_128623_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128622_task);
            
            if (futhark_mc_segred_task_128623_err != 0) {
                err = futhark_mc_segred_task_128623_err;
                goto cleanup;
            }
            
            bool zeze_res_120504 = defunc_res_120478 == 0.0;
            double klu_res_120505;
            
            if (zeze_res_120504) {
                klu_res_120505 = 0.0;
            } else {
                double zs_res_120506 = defunc_res_120478 / eta_p_120473;
                double log_res_120507 = futrts_log64(zs_res_120506);
                double zt_res_120508 = defunc_res_120478 * log_res_120507;
                
                klu_res_120505 = zt_res_120508;
            }
            // save map-out results
            {
                ((double *) mem_112423.mem)[gtid_120460] = defunc_res_120478;
                ((double *) mem_112425.mem)[gtid_120460] = defunc_res_120476;
            }
            // Load accum params
            {
                eta_p_120461 = local_acc_125195;
            }
            // Load next params
            {
                eta_p_120462 = defunc_res_120474;
            }
            // SegRed body
            {
                double zp_res_120463 = eta_p_120461 + eta_p_120462;
                
                local_acc_125195 = zp_res_120463;
            }
            // Load accum params
            {
                eta_p_120464 = local_acc_125196;
            }
            // Load next params
            {
                eta_p_120465 = defunc_res_120475;
            }
            // SegRed body
            {
                double zp_res_120466 = eta_p_120464 + eta_p_120465;
                
                local_acc_125196 = zp_res_120466;
            }
            // Load accum params
            {
                eta_p_120467 = local_acc_125197;
            }
            // Load next params
            {
                eta_p_120468 = defunc_res_120477;
            }
            // SegRed body
            {
                double zp_res_120469 = eta_p_120467 + eta_p_120468;
                
                local_acc_125197 = zp_res_120469;
            }
            // Load accum params
            {
                eta_p_120470 = local_acc_125198;
            }
            // Load next params
            {
                eta_p_120471 = klu_res_120505;
            }
            // SegRed body
            {
                double zp_res_120472 = eta_p_120470 + eta_p_120471;
                
                local_acc_125198 = zp_res_120472;
            }
        }
        
        int64_t uni_i_125260 = 0;
        
        {
            int64_t gtid_120460 = uni_i_125260;
            
            // Load accum params
            {
                eta_p_125179 = local_acc_125191;
            }
            // Load next params
            {
                eta_p_125180 = local_acc_125195;
            }
            // SegRed body
            {
                double zp_res_125181 = eta_p_125179 + eta_p_125180;
                
                local_acc_125191 = zp_res_125181;
            }
            // Load accum params
            {
                eta_p_125182 = local_acc_125192;
            }
            // Load next params
            {
                eta_p_125183 = local_acc_125196;
            }
            // SegRed body
            {
                double zp_res_125184 = eta_p_125182 + eta_p_125183;
                
                local_acc_125192 = zp_res_125184;
            }
            // Load accum params
            {
                eta_p_125185 = local_acc_125193;
            }
            // Load next params
            {
                eta_p_125186 = local_acc_125197;
            }
            // SegRed body
            {
                double zp_res_125187 = eta_p_125185 + eta_p_125186;
                
                local_acc_125193 = zp_res_125187;
            }
            // Load accum params
            {
                eta_p_125188 = local_acc_125194;
            }
            // Load next params
            {
                eta_p_125189 = local_acc_125198;
            }
            // SegRed body
            {
                double zp_res_125190 = eta_p_125188 + eta_p_125189;
                
                local_acc_125194 = zp_res_125190;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_125171.mem)[flat_tid_120459] = local_acc_125191;
        ((double *) reduce_stage_1_tid_res_arr_mem_125173.mem)[flat_tid_120459] = local_acc_125192;
        ((double *) reduce_stage_1_tid_res_arr_mem_125175.mem)[flat_tid_120459] = local_acc_125193;
        ((double *) reduce_stage_1_tid_res_arr_mem_125177.mem)[flat_tid_120459] = local_acc_125194;
    }
    
  cleanup:
    { }
    if (event_128634 != NULL) {
        event_128634->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128621", strdup("nothing further"), event_128634, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_128615(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128604 *futhark_mc_task_128604 = (struct futhark_mc_task_128604 *) args;
    struct futhark_context *ctx = futhark_mc_task_128604->ctx;
    struct mc_event *event_128636 = mc_event_new(ctx);
    
    if (event_128636 != NULL)
        event_128636->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128604->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_128604->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128604->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128604->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_task_128604->free_mem_param_118928, .size =0, .references =NULL};
    int64_t flat_tid_120459 = futhark_mc_task_128604->free_flat_tid_120459;
    int64_t flat_tid_120509 = futhark_mc_task_128604->free_flat_tid_120509;
    double defunc_res_120453 = *futhark_mc_task_128604->retval_defunc_res_120453;
    double defunc_res_120454 = *futhark_mc_task_128604->retval_defunc_res_120454;
    double defunc_res_120455 = *futhark_mc_task_128604->retval_defunc_res_120455;
    double defunc_res_120456 = *futhark_mc_task_128604->retval_defunc_res_120456;
    struct memblock mem_112423 = {.desc ="mem_112423", .mem =futhark_mc_task_128604->retval_mem_112423, .size =0, .references =NULL};
    struct memblock mem_112425 = {.desc ="mem_112425", .mem =futhark_mc_task_128604->retval_mem_112425, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_125171_cached_sizze_128616 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125171 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_125173_cached_sizze_128617 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125173 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_125175_cached_sizze_128618 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125175 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_125177_cached_sizze_128619 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125177 = NULL;
    int32_t nsubtasks_125170;
    
    nsubtasks_125170 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_125171_cached_sizze_128616 < (int64_t) 8 * nsubtasks_125170) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125171, &reduce_stage_1_tid_res_arr_mem_125171_cached_sizze_128616, (int64_t) 8 * nsubtasks_125170);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_125173_cached_sizze_128617 < (int64_t) 8 * nsubtasks_125170) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125173, &reduce_stage_1_tid_res_arr_mem_125173_cached_sizze_128617, (int64_t) 8 * nsubtasks_125170);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_125175_cached_sizze_128618 < (int64_t) 8 * nsubtasks_125170) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125175, &reduce_stage_1_tid_res_arr_mem_125175_cached_sizze_128618, (int64_t) 8 * nsubtasks_125170);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_125177_cached_sizze_128619 < (int64_t) 8 * nsubtasks_125170) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125177, &reduce_stage_1_tid_res_arr_mem_125177_cached_sizze_128619, (int64_t) 8 * nsubtasks_125170);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128620 futhark_mc_segred_stage_1_parloop_struct_128620_;
    
    futhark_mc_segred_stage_1_parloop_struct_128620_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128620_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128620_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_128620_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128620_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_128620_.free_mem_112423 = mem_112423.mem;
    futhark_mc_segred_stage_1_parloop_struct_128620_.free_mem_112425 = mem_112425.mem;
    futhark_mc_segred_stage_1_parloop_struct_128620_.free_mem_param_118928 = mem_param_118928.mem;
    futhark_mc_segred_stage_1_parloop_struct_128620_.free_reduce_stage_1_tid_res_arr_mem_125171 = reduce_stage_1_tid_res_arr_mem_125171;
    futhark_mc_segred_stage_1_parloop_struct_128620_.free_reduce_stage_1_tid_res_arr_mem_125173 = reduce_stage_1_tid_res_arr_mem_125173;
    futhark_mc_segred_stage_1_parloop_struct_128620_.free_reduce_stage_1_tid_res_arr_mem_125175 = reduce_stage_1_tid_res_arr_mem_125175;
    futhark_mc_segred_stage_1_parloop_struct_128620_.free_reduce_stage_1_tid_res_arr_mem_125177 = reduce_stage_1_tid_res_arr_mem_125177;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128621_task;
    
    futhark_mc_segred_stage_1_parloop_128621_task.name = "futhark_mc_segred_stage_1_parloop_128621";
    futhark_mc_segred_stage_1_parloop_128621_task.fn = futhark_mc_segred_stage_1_parloop_128621;
    futhark_mc_segred_stage_1_parloop_128621_task.args = &futhark_mc_segred_stage_1_parloop_struct_128620_;
    futhark_mc_segred_stage_1_parloop_128621_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128621_task.info = info;
    
    struct mc_event *event_128635 = mc_event_new(ctx);
    
    if (event_128635 != NULL)
        event_128635->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128621_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128621_task);
    
    if (futhark_mc_segred_stage_1_parloop_128621_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128621_err;
        goto cleanup;
    }
    if (event_128635 != NULL) {
        event_128635->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128621_total", strdup("nothing further"), event_128635, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_120453 = 0.0;
        defunc_res_120454 = 0.0;
        defunc_res_120455 = 0.0;
        defunc_res_120456 = 0.0;
    }
    
    double eta_p_125261;
    double eta_p_125262;
    double eta_p_125264;
    double eta_p_125265;
    double eta_p_125267;
    double eta_p_125268;
    double eta_p_125270;
    double eta_p_125271;
    
    for (int32_t i_125273 = 0; i_125273 < nsubtasks_125170; i_125273++) {
        flat_tid_120459 = i_125273;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_125261 = defunc_res_120453;
            }
            // load next params
            {
                eta_p_125262 = ((double *) reduce_stage_1_tid_res_arr_mem_125171)[flat_tid_120459];
            }
            // red body
            {
                double zp_res_125263 = eta_p_125261 + eta_p_125262;
                
                defunc_res_120453 = zp_res_125263;
            }
            // load acc params
            {
                eta_p_125264 = defunc_res_120454;
            }
            // load next params
            {
                eta_p_125265 = ((double *) reduce_stage_1_tid_res_arr_mem_125173)[flat_tid_120459];
            }
            // red body
            {
                double zp_res_125266 = eta_p_125264 + eta_p_125265;
                
                defunc_res_120454 = zp_res_125266;
            }
            // load acc params
            {
                eta_p_125267 = defunc_res_120455;
            }
            // load next params
            {
                eta_p_125268 = ((double *) reduce_stage_1_tid_res_arr_mem_125175)[flat_tid_120459];
            }
            // red body
            {
                double zp_res_125269 = eta_p_125267 + eta_p_125268;
                
                defunc_res_120455 = zp_res_125269;
            }
            // load acc params
            {
                eta_p_125270 = defunc_res_120456;
            }
            // load next params
            {
                eta_p_125271 = ((double *) reduce_stage_1_tid_res_arr_mem_125177)[flat_tid_120459];
            }
            // red body
            {
                double zp_res_125272 = eta_p_125270 + eta_p_125271;
                
                defunc_res_120456 = zp_res_125272;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_125171);
        free(reduce_stage_1_tid_res_arr_mem_125173);
        free(reduce_stage_1_tid_res_arr_mem_125175);
        free(reduce_stage_1_tid_res_arr_mem_125177);
    }
    if (event_128636 != NULL) {
        event_128636->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_128615", strdup("nothing further"), event_128636, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128604->retval_defunc_res_120453 = defunc_res_120453;
        *futhark_mc_task_128604->retval_defunc_res_120454 = defunc_res_120454;
        *futhark_mc_task_128604->retval_defunc_res_120455 = defunc_res_120455;
        *futhark_mc_task_128604->retval_defunc_res_120456 = defunc_res_120456;
        futhark_mc_task_128604->retval_mem_112423 = mem_112423.mem;
        futhark_mc_task_128604->retval_mem_112425 = mem_112425.mem;
    }
    return err;
}
struct futhark_mc_task_128637 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112412;
    unsigned char *free_mem_112427;
};
struct futhark_mc_segmap_parloop_struct_128639 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112412;
    unsigned char *free_mem_112427;
};
static int futhark_mc_segmap_parloop_128640(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_128639 *futhark_mc_segmap_parloop_struct_128639 = (struct futhark_mc_segmap_parloop_struct_128639 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_128639->ctx;
    struct mc_event *event_128641 = mc_event_new(ctx);
    
    if (event_128641 != NULL)
        event_128641->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_128639->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segmap_parloop_struct_128639->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segmap_parloop_struct_128639->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112412 = {.desc ="mem_112412", .mem =futhark_mc_segmap_parloop_struct_128639->free_mem_112412, .size =0, .references =NULL};
    struct memblock mem_112427 = {.desc ="mem_112427", .mem =futhark_mc_segmap_parloop_struct_128639->free_mem_112427, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_120569;
    
    flat_tid_120569 = subtask_id;
    {
        int64_t start_125282;
        int64_t end_125283;
        
        start_125282 = start;
        end_125283 = end;
        
        int64_t n_125284 = end_125283 - start_125282;
        
        for (int64_t SegMap_i_125285 = start_125282; SegMap_i_125285 < start_125282 + n_125284; SegMap_i_125285++) {
            int64_t slice_125286 = m_33388;
            int64_t gtid_120570 = SegMap_i_125285;
            int64_t remnant_125287 = SegMap_i_125285 - gtid_120570;
            double defunc_0_reduce_res_120571;
            double redout_125276 = 0.0;
            
            for (int64_t i_125275 = 0; i_125275 < m_33388; i_125275++) {
                double eta_p_125277 = ((double *) A_mem_111707.mem)[lifted_lambda_res_106391 * (m_33388 * m_33388) + gtid_120570 * m_33388 + i_125275];
                double eta_p_125278 = ((double *) mem_112412.mem)[i_125275];
                double zt_res_125279 = eta_p_125277 * eta_p_125277;
                double zt_res_125280 = eta_p_125278 * zt_res_125279;
                double zp_res_125281 = zt_res_125280 + redout_125276;
                double redout_tmp_125288 = zp_res_125281;
                
                redout_125276 = redout_tmp_125288;
            }
            defunc_0_reduce_res_120571 = redout_125276;
            ((double *) mem_112427.mem)[gtid_120570] = defunc_0_reduce_res_120571;
        }
    }
    
  cleanup:
    { }
    if (event_128641 != NULL) {
        event_128641->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128640", strdup("nothing further"), event_128641, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_task_128638(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128637 *futhark_mc_task_128637 = (struct futhark_mc_task_128637 *) args;
    struct futhark_context *ctx = futhark_mc_task_128637->ctx;
    struct mc_event *event_128643 = mc_event_new(ctx);
    
    if (event_128643 != NULL)
        event_128643->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128637->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128637->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_128637->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112412 = {.desc ="mem_112412", .mem =futhark_mc_task_128637->free_mem_112412, .size =0, .references =NULL};
    struct memblock mem_112427 = {.desc ="mem_112427", .mem =futhark_mc_task_128637->free_mem_112427, .size =0, .references =NULL};
    int32_t nsubtasks_125274;
    
    nsubtasks_125274 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_128639 futhark_mc_segmap_parloop_struct_128639_;
    
    futhark_mc_segmap_parloop_struct_128639_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_128639_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_128639_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segmap_parloop_struct_128639_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segmap_parloop_struct_128639_.free_mem_112412 = mem_112412.mem;
    futhark_mc_segmap_parloop_struct_128639_.free_mem_112427 = mem_112427.mem;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_128640_task;
    
    futhark_mc_segmap_parloop_128640_task.name = "futhark_mc_segmap_parloop_128640";
    futhark_mc_segmap_parloop_128640_task.fn = futhark_mc_segmap_parloop_128640;
    futhark_mc_segmap_parloop_128640_task.args = &futhark_mc_segmap_parloop_struct_128639_;
    futhark_mc_segmap_parloop_128640_task.iterations = iterations;
    futhark_mc_segmap_parloop_128640_task.info = info;
    
    struct mc_event *event_128642 = mc_event_new(ctx);
    
    if (event_128642 != NULL)
        event_128642->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_128640_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_128640_task);
    
    if (futhark_mc_segmap_parloop_128640_err != 0) {
        err = futhark_mc_segmap_parloop_128640_err;
        goto cleanup;
    }
    if (event_128642 != NULL) {
        event_128642->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128640_total", strdup("nothing further"), event_128642, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_128643 != NULL) {
        event_128643->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_task_128638", strdup("nothing further"), event_128643, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_segmap_parloop_struct_128645 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112412;
    unsigned char *free_mem_112427;
};
struct futhark_mc_task_128647 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112412;
    int64_t free_gtid_120558;
    int64_t free_flat_tid_125290;
    double *retval_defunc_0_reduce_res_120559;
};
struct futhark_mc_segred_stage_1_parloop_struct_128650 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112412;
    int64_t free_gtid_120558;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125306;
};
static int futhark_mc_segred_stage_1_parloop_128651(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128650 *futhark_mc_segred_stage_1_parloop_struct_128650 = (struct futhark_mc_segred_stage_1_parloop_struct_128650 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128650->ctx;
    struct mc_event *event_128652 = mc_event_new(ctx);
    
    if (event_128652 != NULL)
        event_128652->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128650->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128650->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_128650->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112412 = {.desc ="mem_112412", .mem =futhark_mc_segred_stage_1_parloop_struct_128650->free_mem_112412, .size =0, .references =NULL};
    int64_t gtid_120558 = futhark_mc_segred_stage_1_parloop_struct_128650->free_gtid_120558;
    struct memblock reduce_stage_1_tid_res_arr_mem_125306 = {.desc ="reduce_stage_1_tid_res_arr_mem_125306", .mem =futhark_mc_segred_stage_1_parloop_struct_128650->free_reduce_stage_1_tid_res_arr_mem_125306, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_125290;
    
    flat_tid_125290 = subtask_id;
    {
        double eta_p_125308;
        double eta_p_125309;
        double local_acc_125311 = 0.0;
        double eta_p_125292;
        double eta_p_125293;
        double local_acc_125312 = 0.0;
        int64_t start_125313;
        int64_t end_125314;
        
        start_125313 = start;
        end_125314 = end;
        
        int64_t n_125315 = end_125314 - start_125313;
        
        for (int64_t SegRed_i_125316 = start_125313; SegRed_i_125316 < start_125313 + n_125315; SegRed_i_125316++) {
            int64_t gtid_125291 = SegRed_i_125316;
            double eta_p_125295 = ((double *) A_mem_111707.mem)[lifted_lambda_res_106391 * (m_33388 * m_33388) + gtid_120558 * m_33388 + gtid_125291];
            double eta_p_125296 = ((double *) mem_112412.mem)[gtid_125291];
            double zt_res_125297 = eta_p_125295 * eta_p_125295;
            double zt_res_125298 = eta_p_125296 * zt_res_125297;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_125292 = local_acc_125312;
            }
            // Load next params
            {
                eta_p_125293 = zt_res_125298;
            }
            // SegRed body
            {
                double zp_res_125294 = eta_p_125292 + eta_p_125293;
                
                local_acc_125312 = zp_res_125294;
            }
        }
        
        int64_t uni_i_125317 = 0;
        
        {
            int64_t gtid_125291 = uni_i_125317;
            
            // Load accum params
            {
                eta_p_125308 = local_acc_125311;
            }
            // Load next params
            {
                eta_p_125309 = local_acc_125312;
            }
            // SegRed body
            {
                double zp_res_125310 = eta_p_125308 + eta_p_125309;
                
                local_acc_125311 = zp_res_125310;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_125306.mem)[flat_tid_125290] = local_acc_125311;
    }
    
  cleanup:
    { }
    if (event_128652 != NULL) {
        event_128652->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128651", strdup("nothing further"), event_128652, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128648(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128647 *futhark_mc_task_128647 = (struct futhark_mc_task_128647 *) args;
    struct futhark_context *ctx = futhark_mc_task_128647->ctx;
    struct mc_event *event_128654 = mc_event_new(ctx);
    
    if (event_128654 != NULL)
        event_128654->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128647->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128647->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_128647->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112412 = {.desc ="mem_112412", .mem =futhark_mc_task_128647->free_mem_112412, .size =0, .references =NULL};
    int64_t gtid_120558 = futhark_mc_task_128647->free_gtid_120558;
    int64_t flat_tid_125290 = futhark_mc_task_128647->free_flat_tid_125290;
    double defunc_0_reduce_res_120559 = *futhark_mc_task_128647->retval_defunc_0_reduce_res_120559;
    int64_t reduce_stage_1_tid_res_arr_mem_125306_cached_sizze_128649 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125306 = NULL;
    int32_t nsubtasks_125305;
    
    nsubtasks_125305 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_125306_cached_sizze_128649 < (int64_t) 8 * nsubtasks_125305) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125306, &reduce_stage_1_tid_res_arr_mem_125306_cached_sizze_128649, (int64_t) 8 * nsubtasks_125305);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128650 futhark_mc_segred_stage_1_parloop_struct_128650_;
    
    futhark_mc_segred_stage_1_parloop_struct_128650_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128650_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128650_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128650_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_128650_.free_mem_112412 = mem_112412.mem;
    futhark_mc_segred_stage_1_parloop_struct_128650_.free_gtid_120558 = gtid_120558;
    futhark_mc_segred_stage_1_parloop_struct_128650_.free_reduce_stage_1_tid_res_arr_mem_125306 = reduce_stage_1_tid_res_arr_mem_125306;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128651_task;
    
    futhark_mc_segred_stage_1_parloop_128651_task.name = "futhark_mc_segred_stage_1_parloop_128651";
    futhark_mc_segred_stage_1_parloop_128651_task.fn = futhark_mc_segred_stage_1_parloop_128651;
    futhark_mc_segred_stage_1_parloop_128651_task.args = &futhark_mc_segred_stage_1_parloop_struct_128650_;
    futhark_mc_segred_stage_1_parloop_128651_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128651_task.info = info;
    
    struct mc_event *event_128653 = mc_event_new(ctx);
    
    if (event_128653 != NULL)
        event_128653->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128651_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128651_task);
    
    if (futhark_mc_segred_stage_1_parloop_128651_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128651_err;
        goto cleanup;
    }
    if (event_128653 != NULL) {
        event_128653->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128651_total", strdup("nothing further"), event_128653, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_120559 = 0.0;
    }
    
    double eta_p_125318;
    double eta_p_125319;
    
    for (int32_t i_125321 = 0; i_125321 < nsubtasks_125305; i_125321++) {
        flat_tid_125290 = i_125321;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_125318 = defunc_0_reduce_res_120559;
            }
            // load next params
            {
                eta_p_125319 = ((double *) reduce_stage_1_tid_res_arr_mem_125306)[flat_tid_125290];
            }
            // red body
            {
                double zp_res_125320 = eta_p_125318 + eta_p_125319;
                
                defunc_0_reduce_res_120559 = zp_res_125320;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_125306);
    }
    if (event_128654 != NULL) {
        event_128654->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128648", strdup("nothing further"), event_128654, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128647->retval_defunc_0_reduce_res_120559 = defunc_0_reduce_res_120559;
    }
    return err;
}
static int futhark_mc_segmap_parloop_128646(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_128645 *futhark_mc_segmap_parloop_struct_128645 = (struct futhark_mc_segmap_parloop_struct_128645 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_128645->ctx;
    struct mc_event *event_128655 = mc_event_new(ctx);
    
    if (event_128655 != NULL)
        event_128655->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_128645->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segmap_parloop_struct_128645->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segmap_parloop_struct_128645->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112412 = {.desc ="mem_112412", .mem =futhark_mc_segmap_parloop_struct_128645->free_mem_112412, .size =0, .references =NULL};
    struct memblock mem_112427 = {.desc ="mem_112427", .mem =futhark_mc_segmap_parloop_struct_128645->free_mem_112427, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_120557;
    
    flat_tid_120557 = subtask_id;
    {
        int64_t start_125299;
        int64_t end_125300;
        
        start_125299 = start;
        end_125300 = end;
        
        int64_t n_125301 = end_125300 - start_125299;
        
        for (int64_t SegMap_i_125302 = start_125299; SegMap_i_125302 < start_125299 + n_125301; SegMap_i_125302++) {
            int64_t slice_125303 = m_33388;
            int64_t gtid_120558 = SegMap_i_125302;
            int64_t remnant_125304 = SegMap_i_125302 - gtid_120558;
            double defunc_0_reduce_res_120559;
            int64_t flat_tid_125290 = (int64_t) 0;
            
            defunc_0_reduce_res_120559 = 0.0;
            
            struct futhark_mc_task_128647 futhark_mc_task_128647_;
            
            futhark_mc_task_128647_.ctx = ctx;
            futhark_mc_task_128647_.free_m_33388 = m_33388;
            futhark_mc_task_128647_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
            futhark_mc_task_128647_.free_A_mem_111707 = A_mem_111707.mem;
            futhark_mc_task_128647_.free_mem_112412 = mem_112412.mem;
            futhark_mc_task_128647_.free_gtid_120558 = gtid_120558;
            futhark_mc_task_128647_.free_flat_tid_125290 = flat_tid_125290;
            futhark_mc_task_128647_.retval_defunc_0_reduce_res_120559 = (double *) &defunc_0_reduce_res_120559;
            #if ISPC
            futhark_mc_task_128647_.retval_defunc_0_reduce_res_120559 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_128647_task;
            
            futhark_mc_task_128647_task.args = &futhark_mc_task_128647_;
            futhark_mc_task_128647_task.top_level_fn = futhark_mc_segred_task_128648;
            futhark_mc_task_128647_task.name = "futhark_mc_segred_task_128648";
            futhark_mc_task_128647_task.iterations = m_33388;
            futhark_mc_task_128647_task.task_time = &ctx->program->futhark_mc_segred_task_128648_total_time;
            futhark_mc_task_128647_task.task_iter = &ctx->program->futhark_mc_segred_task_128648_total_iter;
            futhark_mc_task_128647_task.sched = STATIC;
            futhark_mc_task_128647_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_128648_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128647_task);
            
            if (futhark_mc_segred_task_128648_err != 0) {
                err = futhark_mc_segred_task_128648_err;
                goto cleanup;
            }
            ((double *) mem_112427.mem)[gtid_120558] = defunc_0_reduce_res_120559;
        }
    }
    
  cleanup:
    { }
    if (event_128655 != NULL) {
        event_128655->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128646", strdup("nothing further"), event_128655, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_nested_task_128644(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128637 *futhark_mc_task_128637 = (struct futhark_mc_task_128637 *) args;
    struct futhark_context *ctx = futhark_mc_task_128637->ctx;
    struct mc_event *event_128657 = mc_event_new(ctx);
    
    if (event_128657 != NULL)
        event_128657->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128637->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128637->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_128637->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112412 = {.desc ="mem_112412", .mem =futhark_mc_task_128637->free_mem_112412, .size =0, .references =NULL};
    struct memblock mem_112427 = {.desc ="mem_112427", .mem =futhark_mc_task_128637->free_mem_112427, .size =0, .references =NULL};
    int32_t nsubtasks_125289;
    
    nsubtasks_125289 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_128645 futhark_mc_segmap_parloop_struct_128645_;
    
    futhark_mc_segmap_parloop_struct_128645_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_128645_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_128645_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segmap_parloop_struct_128645_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segmap_parloop_struct_128645_.free_mem_112412 = mem_112412.mem;
    futhark_mc_segmap_parloop_struct_128645_.free_mem_112427 = mem_112427.mem;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_128646_task;
    
    futhark_mc_segmap_parloop_128646_task.name = "futhark_mc_segmap_parloop_128646";
    futhark_mc_segmap_parloop_128646_task.fn = futhark_mc_segmap_parloop_128646;
    futhark_mc_segmap_parloop_128646_task.args = &futhark_mc_segmap_parloop_struct_128645_;
    futhark_mc_segmap_parloop_128646_task.iterations = iterations;
    futhark_mc_segmap_parloop_128646_task.info = info;
    
    struct mc_event *event_128656 = mc_event_new(ctx);
    
    if (event_128656 != NULL)
        event_128656->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_128646_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_128646_task);
    
    if (futhark_mc_segmap_parloop_128646_err != 0) {
        err = futhark_mc_segmap_parloop_128646_err;
        goto cleanup;
    }
    if (event_128656 != NULL) {
        event_128656->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128646_total", strdup("nothing further"), event_128656, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_128657 != NULL) {
        event_128657->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_nested_task_128644", strdup("nothing further"), event_128657, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_128658 {
    struct futhark_context *ctx;
    int64_t free_k_33387;
    int64_t free_m_33388;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112431;
};
struct futhark_mc_copy_parloop_struct_128660 {
    struct futhark_context *ctx;
    int64_t free_k_33387;
    int64_t free_m_33388;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112431;
};
static int futhark_mc_copy_parloop_128661(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_copy_parloop_struct_128660 *futhark_mc_copy_parloop_struct_128660 = (struct futhark_mc_copy_parloop_struct_128660 *) args;
    struct futhark_context *ctx = futhark_mc_copy_parloop_struct_128660->ctx;
    struct mc_event *event_128662 = mc_event_new(ctx);
    
    if (event_128662 != NULL)
        event_128662->bef = get_wall_time();
    
    int64_t k_33387 = futhark_mc_copy_parloop_struct_128660->free_k_33387;
    int64_t m_33388 = futhark_mc_copy_parloop_struct_128660->free_m_33388;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_copy_parloop_struct_128660->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112431 = {.desc ="mem_112431", .mem =futhark_mc_copy_parloop_struct_128660->free_mem_112431, .size =0, .references =NULL};
    int64_t iterations = end - start;
    
    {
        int64_t start_125322;
        int64_t end_125323;
        
        start_125322 = start;
        end_125323 = end;
        
        int64_t n_125324 = end_125323 - start_125322;
        
        for (int64_t copy_i_125325 = start_125322; copy_i_125325 < start_125322 + n_125324; copy_i_125325++) {
            int64_t slice_125329 = m_33388;
            int64_t slice_125330 = m_33388 * slice_125329;
            int64_t slice_125331 = k_33387 * slice_125330;
            int64_t i_125326 = squot64(copy_i_125325, slice_125330);
            int64_t remnant_125332 = copy_i_125325 - i_125326 * slice_125330;
            int64_t i_125327 = squot64(remnant_125332, slice_125329);
            int64_t remnant_125333 = remnant_125332 - i_125327 * slice_125329;
            int64_t i_125328 = remnant_125333;
            int64_t remnant_125334 = remnant_125333 - i_125328;
            double tmp_125335 = ((double *) A_mem_111707.mem)[i_125326 * (m_33388 * m_33388) + i_125327 * m_33388 + i_125328];
            
            ((double *) mem_112431.mem)[i_125326 * (m_33388 * m_33388) + i_125327 * m_33388 + i_125328] = tmp_125335;
        }
    }
    
  cleanup:
    { }
    if (event_128662 != NULL) {
        event_128662->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_parloop_128661", strdup("nothing further"), event_128662, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_copy_125336_task_128659(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128658 *futhark_mc_task_128658 = (struct futhark_mc_task_128658 *) args;
    struct futhark_context *ctx = futhark_mc_task_128658->ctx;
    struct mc_event *event_128664 = mc_event_new(ctx);
    
    if (event_128664 != NULL)
        event_128664->bef = get_wall_time();
    
    int64_t k_33387 = futhark_mc_task_128658->free_k_33387;
    int64_t m_33388 = futhark_mc_task_128658->free_m_33388;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_128658->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112431 = {.desc ="mem_112431", .mem =futhark_mc_task_128658->free_mem_112431, .size =0, .references =NULL};
    struct futhark_mc_copy_parloop_struct_128660 futhark_mc_copy_parloop_struct_128660_;
    
    futhark_mc_copy_parloop_struct_128660_.ctx = ctx;
    futhark_mc_copy_parloop_struct_128660_.free_k_33387 = k_33387;
    futhark_mc_copy_parloop_struct_128660_.free_m_33388 = m_33388;
    futhark_mc_copy_parloop_struct_128660_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_copy_parloop_struct_128660_.free_mem_112431 = mem_112431.mem;
    
    struct scheduler_parloop futhark_mc_copy_parloop_128661_task;
    
    futhark_mc_copy_parloop_128661_task.name = "futhark_mc_copy_parloop_128661";
    futhark_mc_copy_parloop_128661_task.fn = futhark_mc_copy_parloop_128661;
    futhark_mc_copy_parloop_128661_task.args = &futhark_mc_copy_parloop_struct_128660_;
    futhark_mc_copy_parloop_128661_task.iterations = iterations;
    futhark_mc_copy_parloop_128661_task.info = info;
    
    struct mc_event *event_128663 = mc_event_new(ctx);
    
    if (event_128663 != NULL)
        event_128663->bef = get_wall_time();
    
    int futhark_mc_copy_parloop_128661_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_copy_parloop_128661_task);
    
    if (futhark_mc_copy_parloop_128661_err != 0) {
        err = futhark_mc_copy_parloop_128661_err;
        goto cleanup;
    }
    if (event_128663 != NULL) {
        event_128663->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_parloop_128661_total", strdup("nothing further"), event_128663, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_128664 != NULL) {
        event_128664->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_125336_task_128659", strdup("nothing further"), event_128664, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_128665 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_rho1_33389;
    double free_rho2_33390;
    double free_eps_33391;
    int64_t free_eta_p_106382;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_distrs_mem_111708;
    int64_t free_bytes_111715;
    unsigned char *free_mem_112403;
    unsigned char *free_mem_112416;
    unsigned char *free_mem_112421;
    unsigned char *free_mem_112423;
    unsigned char *free_mem_112425;
    unsigned char *free_mem_112427;
    unsigned char *free_mem_112431;
    unsigned char *free_mem_param_118928;
    double free_sqrt_res_120360;
    double free_zt_res_120554;
    double free_zt_res_120555;
    double free_zt_res_120579;
    double free_zt_res_120580;
    int64_t free_flat_tid_120590;
    int64_t free_flat_tid_120759;
    double *retval_defunc_res_120582;
    double *retval_defunc_res_120583;
    double *retval_defunc_res_120584;
    double *retval_defunc_res_120585;
    double *retval_defunc_res_120586;
    unsigned char *retval_mem_112463;
    unsigned char *retval_mem_112466;
    unsigned char *retval_mem_in_114669;
};
struct futhark_mc_segred_stage_1_parloop_struct_128672 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_rho1_33389;
    double free_rho2_33390;
    double free_eps_33391;
    int64_t free_eta_p_106382;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_distrs_mem_111708;
    int64_t free_bytes_111715;
    unsigned char *free_mem_112403;
    unsigned char *free_mem_112416;
    unsigned char *free_mem_112421;
    unsigned char *free_mem_112423;
    unsigned char *free_mem_112425;
    unsigned char *free_mem_112427;
    unsigned char *free_mem_112431;
    unsigned char *free_mem_112463;
    unsigned char *free_mem_112466;
    unsigned char *free_mem_in_114669;
    unsigned char *free_mem_param_118928;
    double free_sqrt_res_120360;
    double free_zt_res_120554;
    double free_zt_res_120555;
    double free_zt_res_120579;
    double free_zt_res_120580;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125339;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125341;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125343;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125345;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125347;
};
static int futhark_mc_segred_stage_1_parloop_128673(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128672 *futhark_mc_segred_stage_1_parloop_struct_128672 = (struct futhark_mc_segred_stage_1_parloop_struct_128672 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128672->ctx;
    struct mc_event *event_128677 = mc_event_new(ctx);
    
    if (event_128677 != NULL)
        event_128677->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128672->free_m_33388;
    double rho1_33389 = futhark_mc_segred_stage_1_parloop_struct_128672->free_rho1_33389;
    double rho2_33390 = futhark_mc_segred_stage_1_parloop_struct_128672->free_rho2_33390;
    double eps_33391 = futhark_mc_segred_stage_1_parloop_struct_128672->free_eps_33391;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_128672->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128672->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_128672->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_128672->free_distrs_mem_111708, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_segred_stage_1_parloop_struct_128672->free_bytes_111715;
    struct memblock mem_112403 = {.desc ="mem_112403", .mem =futhark_mc_segred_stage_1_parloop_struct_128672->free_mem_112403, .size =0, .references =NULL};
    struct memblock mem_112416 = {.desc ="mem_112416", .mem =futhark_mc_segred_stage_1_parloop_struct_128672->free_mem_112416, .size =0, .references =NULL};
    struct memblock mem_112421 = {.desc ="mem_112421", .mem =futhark_mc_segred_stage_1_parloop_struct_128672->free_mem_112421, .size =0, .references =NULL};
    struct memblock mem_112423 = {.desc ="mem_112423", .mem =futhark_mc_segred_stage_1_parloop_struct_128672->free_mem_112423, .size =0, .references =NULL};
    struct memblock mem_112425 = {.desc ="mem_112425", .mem =futhark_mc_segred_stage_1_parloop_struct_128672->free_mem_112425, .size =0, .references =NULL};
    struct memblock mem_112427 = {.desc ="mem_112427", .mem =futhark_mc_segred_stage_1_parloop_struct_128672->free_mem_112427, .size =0, .references =NULL};
    struct memblock mem_112431 = {.desc ="mem_112431", .mem =futhark_mc_segred_stage_1_parloop_struct_128672->free_mem_112431, .size =0, .references =NULL};
    struct memblock mem_112463 = {.desc ="mem_112463", .mem =futhark_mc_segred_stage_1_parloop_struct_128672->free_mem_112463, .size =0, .references =NULL};
    struct memblock mem_112466 = {.desc ="mem_112466", .mem =futhark_mc_segred_stage_1_parloop_struct_128672->free_mem_112466, .size =0, .references =NULL};
    struct memblock mem_in_114669 = {.desc ="mem_in_114669", .mem =futhark_mc_segred_stage_1_parloop_struct_128672->free_mem_in_114669, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_segred_stage_1_parloop_struct_128672->free_mem_param_118928, .size =0, .references =NULL};
    double sqrt_res_120360 = futhark_mc_segred_stage_1_parloop_struct_128672->free_sqrt_res_120360;
    double zt_res_120554 = futhark_mc_segred_stage_1_parloop_struct_128672->free_zt_res_120554;
    double zt_res_120555 = futhark_mc_segred_stage_1_parloop_struct_128672->free_zt_res_120555;
    double zt_res_120579 = futhark_mc_segred_stage_1_parloop_struct_128672->free_zt_res_120579;
    double zt_res_120580 = futhark_mc_segred_stage_1_parloop_struct_128672->free_zt_res_120580;
    struct memblock reduce_stage_1_tid_res_arr_mem_125339 = {.desc ="reduce_stage_1_tid_res_arr_mem_125339", .mem =futhark_mc_segred_stage_1_parloop_struct_128672->free_reduce_stage_1_tid_res_arr_mem_125339, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125341 = {.desc ="reduce_stage_1_tid_res_arr_mem_125341", .mem =futhark_mc_segred_stage_1_parloop_struct_128672->free_reduce_stage_1_tid_res_arr_mem_125341, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125343 = {.desc ="reduce_stage_1_tid_res_arr_mem_125343", .mem =futhark_mc_segred_stage_1_parloop_struct_128672->free_reduce_stage_1_tid_res_arr_mem_125343, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125345 = {.desc ="reduce_stage_1_tid_res_arr_mem_125345", .mem =futhark_mc_segred_stage_1_parloop_struct_128672->free_reduce_stage_1_tid_res_arr_mem_125345, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125347 = {.desc ="reduce_stage_1_tid_res_arr_mem_125347", .mem =futhark_mc_segred_stage_1_parloop_struct_128672->free_reduce_stage_1_tid_res_arr_mem_125347, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t mem_120783_cached_sizze_128674 = 0;
    unsigned char *mem_120783 = NULL;
    int64_t mem_120804_cached_sizze_128675 = 0;
    unsigned char *mem_120804 = NULL;
    int64_t mem_120806_cached_sizze_128676 = 0;
    unsigned char *mem_120806 = NULL;
    int64_t flat_tid_120759;
    
    flat_tid_120759 = subtask_id;
    {
        double eta_p_125349;
        double eta_p_125350;
        double eta_p_125352;
        double eta_p_125353;
        double eta_p_125355;
        double eta_p_125356;
        double eta_p_125358;
        double eta_p_125359;
        double eta_p_125361;
        double eta_p_125362;
        double local_acc_125364 = 0.0;
        double local_acc_125365 = 0.0;
        double local_acc_125366 = 0.0;
        double local_acc_125367 = 0.0;
        double local_acc_125368 = 0.0;
        double eta_p_120761;
        double eta_p_120762;
        double eta_p_120764;
        double eta_p_120765;
        double eta_p_120767;
        double eta_p_120768;
        double eta_p_120770;
        double eta_p_120771;
        double eta_p_120773;
        double eta_p_120774;
        double local_acc_125369 = 0.0;
        double local_acc_125370 = 0.0;
        double local_acc_125371 = 0.0;
        double local_acc_125372 = 0.0;
        double local_acc_125373 = 0.0;
        int64_t start_125374;
        int64_t end_125375;
        
        start_125374 = start;
        end_125375 = end;
        
        int64_t n_125376 = end_125375 - start_125374;
        
        if (mem_120783_cached_sizze_128674 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_120783, &mem_120783_cached_sizze_128674, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_120804_cached_sizze_128675 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_120804, &mem_120804_cached_sizze_128675, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_120806_cached_sizze_128676 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_120806, &mem_120806_cached_sizze_128676, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        for (int64_t SegRed_i_125377 = start_125374; SegRed_i_125377 < start_125374 + n_125376; SegRed_i_125377++) {
            int64_t gtid_120760 = SegRed_i_125377;
            double x_120776 = ((double *) distrs_mem_111708.mem)[eta_p_106382 * m_33388 + gtid_120760];
            double eta_p_120777 = ((double *) mem_112423.mem)[gtid_120760];
            double log_res_120778 = futrts_log64(x_120776);
            double log_res_120779 = futrts_log64(eta_p_120777);
            double zm_res_120780 = log_res_120779 - log_res_120778;
            double zp_res_120781 = 1.0 + zm_res_120780;
            double fma_res_120782 = futrts_fma64(zt_res_120555, zp_res_120781, zt_res_120554);
            
            for (int64_t i_120786 = 0; i_120786 < m_33388; i_120786++) {
                double defunc_0_reduce_res_120788;
                double redout_120790 = 0.0;
                
                for (int64_t i_120789 = 0; i_120789 < m_33388; i_120789++) {
                    double eta_p_120791 = ((double *) A_mem_111707.mem)[eta_p_106382 * (m_33388 * m_33388) + gtid_120760 * m_33388 + i_120789];
                    double eta_p_120792 = ((double *) mem_param_118928.mem)[i_120789 * m_33388 + i_120786];
                    double zt_res_120793 = eta_p_120791 * eta_p_120792;
                    double zp_res_120794 = zt_res_120793 + redout_120790;
                    double redout_tmp_125379 = zp_res_120794;
                    
                    redout_120790 = redout_tmp_125379;
                }
                defunc_0_reduce_res_120788 = redout_120790;
                ((double *) mem_120783)[i_120786] = defunc_0_reduce_res_120788;
            }
            
            double defunc_0_reduce_res_120796;
            double redout_120798 = 0.0;
            
            for (int64_t i_120797 = 0; i_120797 < m_33388; i_120797++) {
                double eta_p_120799 = ((double *) A_mem_111707.mem)[eta_p_106382 * (m_33388 * m_33388) + gtid_120760 * m_33388 + i_120797];
                double eta_p_120800 = ((double *) mem_112425.mem)[i_120797];
                double zt_res_120801 = eta_p_120799 * eta_p_120799;
                double zt_res_120802 = eta_p_120800 * zt_res_120801;
                double zp_res_120803 = zt_res_120802 + redout_120798;
                double redout_tmp_125380 = zp_res_120803;
                
                redout_120798 = redout_tmp_125380;
            }
            defunc_0_reduce_res_120796 = redout_120798;
            
            double defunc_0_reduce_res_120808;
            double defunc_res_120809;
            double defunc_res_120810;
            double defunc_res_120811;
            double redout_120815;
            double redout_120816;
            double redout_120817;
            double redout_120818;
            
            redout_120815 = 0.0;
            redout_120816 = 0.0;
            redout_120817 = 0.0;
            redout_120818 = 0.0;
            for (int64_t i_120814 = 0; i_120814 < m_33388; i_120814++) {
                double eta_p_120821 = ((double *) mem_112403.mem)[gtid_120760 * m_33388 + i_120814];
                double eta_p_120822 = ((double *) mem_param_118928.mem)[gtid_120760 * m_33388 + i_120814];
                double eta_p_120823 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + i_120814];
                double eta_p_wasfree_120824 = ((double *) mem_112416.mem)[i_120814];
                double eta_p_wasfree_120825 = ((double *) mem_112427.mem)[i_120814];
                double eta_p_120826 = ((double *) mem_112421.mem)[i_120814 * m_33388 + gtid_120760];
                double zt_res_120827 = sqrt_res_120360 * eta_p_120821;
                double zm_res_120828 = zt_res_120827 - eta_p_120822;
                double log_res_120829 = futrts_log64(eta_p_120822);
                double zm_res_120830 = log_res_120829 - eta_p_wasfree_120824;
                double zm_res_120831 = zm_res_120830 - log_res_120778;
                double fma_res_120832 = futrts_fma64(zt_res_120579, zm_res_120831, zt_res_120580);
                double defunc_0_reduce_res_120833;
                double redout_120835 = 0.0;
                
                for (int64_t i_120834 = 0; i_120834 < m_33388; i_120834++) {
                    double eta_p_120836 = ((double *) mem_120783)[i_120834];
                    double eta_p_120837 = ((double *) mem_112431.mem)[lifted_lambda_res_106391 * (m_33388 * m_33388) + i_120834 * m_33388 + i_120814];
                    double zt_res_120838 = eta_p_120836 * eta_p_120837;
                    double zp_res_120839 = zt_res_120838 + redout_120835;
                    double redout_tmp_125387 = zp_res_120839;
                    
                    redout_120835 = redout_tmp_125387;
                }
                defunc_0_reduce_res_120833 = redout_120835;
                
                double zt_res_120840 = -2.0 * defunc_0_reduce_res_120833;
                double zp_res_120841 = defunc_0_reduce_res_120796 + zt_res_120840;
                double zp_res_120842 = eta_p_wasfree_120825 + zp_res_120841;
                double zt_res_120843 = 2.0 * zp_res_120842;
                double fma_res_120844 = futrts_fma64(fma_res_120782, rho1_33389, zt_res_120843);
                double fma_res_120845 = futrts_fma64(eta_p_120826, rho2_33390, fma_res_120844);
                double fma_res_120846 = futrts_fma64(fma_res_120832, eps_33391, fma_res_120845);
                double max_res_120847 = fmax64(-1.0e100, fma_res_120846);
                double zt_res_120848 = zm_res_120828 * max_res_120847;
                double zp_res_120849 = eta_p_120822 + zm_res_120828;
                double zt_res_120850 = x_120776 * eta_p_120823;
                bool zeze_res_120851 = zp_res_120849 == 0.0;
                double klu_res_120852;
                
                if (zeze_res_120851) {
                    klu_res_120852 = 0.0;
                } else {
                    double zs_res_120853 = zp_res_120849 / zt_res_120850;
                    double log_res_120854 = futrts_log64(zs_res_120853);
                    double zt_res_120855 = zp_res_120849 * log_res_120854;
                    
                    klu_res_120852 = zt_res_120855;
                }
                
                double zp_res_120856 = zt_res_120848 + redout_120815;
                double zp_res_120857 = klu_res_120852 + redout_120816;
                double zp_res_120858 = zp_res_120849 + redout_120817;
                double zp_res_120859 = zp_res_120849 + redout_120818;
                
                ((double *) mem_120804)[i_120814] = zp_res_120849;
                ((double *) mem_120806)[i_120814] = zm_res_120828;
                
                double redout_tmp_125381 = zp_res_120856;
                double redout_tmp_125382 = zp_res_120857;
                double redout_tmp_125383 = zp_res_120858;
                double redout_tmp_125384 = zp_res_120859;
                
                redout_120815 = redout_tmp_125381;
                redout_120816 = redout_tmp_125382;
                redout_120817 = redout_tmp_125383;
                redout_120818 = redout_tmp_125384;
            }
            defunc_0_reduce_res_120808 = redout_120815;
            defunc_res_120809 = redout_120816;
            defunc_res_120810 = redout_120817;
            defunc_res_120811 = redout_120818;
            
            bool zeze_res_120862 = defunc_res_120811 == 0.0;
            double klu_res_120863;
            
            if (zeze_res_120862) {
                klu_res_120863 = 0.0;
            } else {
                double zs_res_120864 = defunc_res_120811 / x_120776;
                double log_res_120865 = futrts_log64(zs_res_120864);
                double zt_res_120866 = defunc_res_120811 * log_res_120865;
                
                klu_res_120863 = zt_res_120866;
            }
            // save map-out results
            {
                ((double *) mem_112463.mem)[gtid_120760] = defunc_res_120810;
                lmad_copy_8b(ctx, 1, (uint64_t *) mem_112466.mem, gtid_120760 * m_33388, (int64_t []) {(int64_t) 1}, (uint64_t *) mem_120804, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_33388});
                lmad_copy_8b(ctx, 1, (uint64_t *) mem_in_114669.mem, gtid_120760 * m_33388, (int64_t []) {(int64_t) 1}, (uint64_t *) mem_120806, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_33388});
            }
            // Load accum params
            {
                eta_p_120761 = local_acc_125369;
            }
            // Load next params
            {
                eta_p_120762 = defunc_0_reduce_res_120808;
            }
            // SegRed body
            {
                double zp_res_120763 = eta_p_120761 + eta_p_120762;
                
                local_acc_125369 = zp_res_120763;
            }
            // Load accum params
            {
                eta_p_120764 = local_acc_125370;
            }
            // Load next params
            {
                eta_p_120765 = klu_res_120863;
            }
            // SegRed body
            {
                double zp_res_120766 = eta_p_120764 + eta_p_120765;
                
                local_acc_125370 = zp_res_120766;
            }
            // Load accum params
            {
                eta_p_120767 = local_acc_125371;
            }
            // Load next params
            {
                eta_p_120768 = defunc_res_120811;
            }
            // SegRed body
            {
                double zp_res_120769 = eta_p_120767 + eta_p_120768;
                
                local_acc_125371 = zp_res_120769;
            }
            // Load accum params
            {
                eta_p_120770 = local_acc_125372;
            }
            // Load next params
            {
                eta_p_120771 = defunc_res_120809;
            }
            // SegRed body
            {
                double zp_res_120772 = eta_p_120770 + eta_p_120771;
                
                local_acc_125372 = zp_res_120772;
            }
            // Load accum params
            {
                eta_p_120773 = local_acc_125373;
            }
            // Load next params
            {
                eta_p_120774 = x_120776;
            }
            // SegRed body
            {
                double zp_res_120775 = eta_p_120773 + eta_p_120774;
                
                local_acc_125373 = zp_res_120775;
            }
        }
        
        int64_t uni_i_125388 = 0;
        
        {
            int64_t gtid_120760 = uni_i_125388;
            
            // Load accum params
            {
                eta_p_125349 = local_acc_125364;
            }
            // Load next params
            {
                eta_p_125350 = local_acc_125369;
            }
            // SegRed body
            {
                double zp_res_125351 = eta_p_125349 + eta_p_125350;
                
                local_acc_125364 = zp_res_125351;
            }
            // Load accum params
            {
                eta_p_125352 = local_acc_125365;
            }
            // Load next params
            {
                eta_p_125353 = local_acc_125370;
            }
            // SegRed body
            {
                double zp_res_125354 = eta_p_125352 + eta_p_125353;
                
                local_acc_125365 = zp_res_125354;
            }
            // Load accum params
            {
                eta_p_125355 = local_acc_125366;
            }
            // Load next params
            {
                eta_p_125356 = local_acc_125371;
            }
            // SegRed body
            {
                double zp_res_125357 = eta_p_125355 + eta_p_125356;
                
                local_acc_125366 = zp_res_125357;
            }
            // Load accum params
            {
                eta_p_125358 = local_acc_125367;
            }
            // Load next params
            {
                eta_p_125359 = local_acc_125372;
            }
            // SegRed body
            {
                double zp_res_125360 = eta_p_125358 + eta_p_125359;
                
                local_acc_125367 = zp_res_125360;
            }
            // Load accum params
            {
                eta_p_125361 = local_acc_125368;
            }
            // Load next params
            {
                eta_p_125362 = local_acc_125373;
            }
            // SegRed body
            {
                double zp_res_125363 = eta_p_125361 + eta_p_125362;
                
                local_acc_125368 = zp_res_125363;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_125339.mem)[flat_tid_120759] = local_acc_125364;
        ((double *) reduce_stage_1_tid_res_arr_mem_125341.mem)[flat_tid_120759] = local_acc_125365;
        ((double *) reduce_stage_1_tid_res_arr_mem_125343.mem)[flat_tid_120759] = local_acc_125366;
        ((double *) reduce_stage_1_tid_res_arr_mem_125345.mem)[flat_tid_120759] = local_acc_125367;
        ((double *) reduce_stage_1_tid_res_arr_mem_125347.mem)[flat_tid_120759] = local_acc_125368;
    }
    
  cleanup:
    {
        free(mem_120783);
        free(mem_120804);
        free(mem_120806);
    }
    if (event_128677 != NULL) {
        event_128677->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128673", strdup("nothing further"), event_128677, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128666(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128665 *futhark_mc_task_128665 = (struct futhark_mc_task_128665 *) args;
    struct futhark_context *ctx = futhark_mc_task_128665->ctx;
    struct mc_event *event_128679 = mc_event_new(ctx);
    
    if (event_128679 != NULL)
        event_128679->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128665->free_m_33388;
    double rho1_33389 = futhark_mc_task_128665->free_rho1_33389;
    double rho2_33390 = futhark_mc_task_128665->free_rho2_33390;
    double eps_33391 = futhark_mc_task_128665->free_eps_33391;
    int64_t eta_p_106382 = futhark_mc_task_128665->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128665->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_128665->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128665->free_distrs_mem_111708, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_task_128665->free_bytes_111715;
    struct memblock mem_112403 = {.desc ="mem_112403", .mem =futhark_mc_task_128665->free_mem_112403, .size =0, .references =NULL};
    struct memblock mem_112416 = {.desc ="mem_112416", .mem =futhark_mc_task_128665->free_mem_112416, .size =0, .references =NULL};
    struct memblock mem_112421 = {.desc ="mem_112421", .mem =futhark_mc_task_128665->free_mem_112421, .size =0, .references =NULL};
    struct memblock mem_112423 = {.desc ="mem_112423", .mem =futhark_mc_task_128665->free_mem_112423, .size =0, .references =NULL};
    struct memblock mem_112425 = {.desc ="mem_112425", .mem =futhark_mc_task_128665->free_mem_112425, .size =0, .references =NULL};
    struct memblock mem_112427 = {.desc ="mem_112427", .mem =futhark_mc_task_128665->free_mem_112427, .size =0, .references =NULL};
    struct memblock mem_112431 = {.desc ="mem_112431", .mem =futhark_mc_task_128665->free_mem_112431, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_task_128665->free_mem_param_118928, .size =0, .references =NULL};
    double sqrt_res_120360 = futhark_mc_task_128665->free_sqrt_res_120360;
    double zt_res_120554 = futhark_mc_task_128665->free_zt_res_120554;
    double zt_res_120555 = futhark_mc_task_128665->free_zt_res_120555;
    double zt_res_120579 = futhark_mc_task_128665->free_zt_res_120579;
    double zt_res_120580 = futhark_mc_task_128665->free_zt_res_120580;
    int64_t flat_tid_120590 = futhark_mc_task_128665->free_flat_tid_120590;
    int64_t flat_tid_120759 = futhark_mc_task_128665->free_flat_tid_120759;
    double defunc_res_120582 = *futhark_mc_task_128665->retval_defunc_res_120582;
    double defunc_res_120583 = *futhark_mc_task_128665->retval_defunc_res_120583;
    double defunc_res_120584 = *futhark_mc_task_128665->retval_defunc_res_120584;
    double defunc_res_120585 = *futhark_mc_task_128665->retval_defunc_res_120585;
    double defunc_res_120586 = *futhark_mc_task_128665->retval_defunc_res_120586;
    struct memblock mem_112463 = {.desc ="mem_112463", .mem =futhark_mc_task_128665->retval_mem_112463, .size =0, .references =NULL};
    struct memblock mem_112466 = {.desc ="mem_112466", .mem =futhark_mc_task_128665->retval_mem_112466, .size =0, .references =NULL};
    struct memblock mem_in_114669 = {.desc ="mem_in_114669", .mem =futhark_mc_task_128665->retval_mem_in_114669, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_125339_cached_sizze_128667 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125339 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_125341_cached_sizze_128668 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125341 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_125343_cached_sizze_128669 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125343 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_125345_cached_sizze_128670 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125345 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_125347_cached_sizze_128671 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125347 = NULL;
    int32_t nsubtasks_125338;
    
    nsubtasks_125338 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_125339_cached_sizze_128667 < (int64_t) 8 * nsubtasks_125338) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125339, &reduce_stage_1_tid_res_arr_mem_125339_cached_sizze_128667, (int64_t) 8 * nsubtasks_125338);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_125341_cached_sizze_128668 < (int64_t) 8 * nsubtasks_125338) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125341, &reduce_stage_1_tid_res_arr_mem_125341_cached_sizze_128668, (int64_t) 8 * nsubtasks_125338);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_125343_cached_sizze_128669 < (int64_t) 8 * nsubtasks_125338) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125343, &reduce_stage_1_tid_res_arr_mem_125343_cached_sizze_128669, (int64_t) 8 * nsubtasks_125338);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_125345_cached_sizze_128670 < (int64_t) 8 * nsubtasks_125338) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125345, &reduce_stage_1_tid_res_arr_mem_125345_cached_sizze_128670, (int64_t) 8 * nsubtasks_125338);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_125347_cached_sizze_128671 < (int64_t) 8 * nsubtasks_125338) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125347, &reduce_stage_1_tid_res_arr_mem_125347_cached_sizze_128671, (int64_t) 8 * nsubtasks_125338);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128672 futhark_mc_segred_stage_1_parloop_struct_128672_;
    
    futhark_mc_segred_stage_1_parloop_struct_128672_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128672_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128672_.free_rho1_33389 = rho1_33389;
    futhark_mc_segred_stage_1_parloop_struct_128672_.free_rho2_33390 = rho2_33390;
    futhark_mc_segred_stage_1_parloop_struct_128672_.free_eps_33391 = eps_33391;
    futhark_mc_segred_stage_1_parloop_struct_128672_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_128672_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128672_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_128672_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_128672_.free_bytes_111715 = bytes_111715;
    futhark_mc_segred_stage_1_parloop_struct_128672_.free_mem_112403 = mem_112403.mem;
    futhark_mc_segred_stage_1_parloop_struct_128672_.free_mem_112416 = mem_112416.mem;
    futhark_mc_segred_stage_1_parloop_struct_128672_.free_mem_112421 = mem_112421.mem;
    futhark_mc_segred_stage_1_parloop_struct_128672_.free_mem_112423 = mem_112423.mem;
    futhark_mc_segred_stage_1_parloop_struct_128672_.free_mem_112425 = mem_112425.mem;
    futhark_mc_segred_stage_1_parloop_struct_128672_.free_mem_112427 = mem_112427.mem;
    futhark_mc_segred_stage_1_parloop_struct_128672_.free_mem_112431 = mem_112431.mem;
    futhark_mc_segred_stage_1_parloop_struct_128672_.free_mem_112463 = mem_112463.mem;
    futhark_mc_segred_stage_1_parloop_struct_128672_.free_mem_112466 = mem_112466.mem;
    futhark_mc_segred_stage_1_parloop_struct_128672_.free_mem_in_114669 = mem_in_114669.mem;
    futhark_mc_segred_stage_1_parloop_struct_128672_.free_mem_param_118928 = mem_param_118928.mem;
    futhark_mc_segred_stage_1_parloop_struct_128672_.free_sqrt_res_120360 = sqrt_res_120360;
    futhark_mc_segred_stage_1_parloop_struct_128672_.free_zt_res_120554 = zt_res_120554;
    futhark_mc_segred_stage_1_parloop_struct_128672_.free_zt_res_120555 = zt_res_120555;
    futhark_mc_segred_stage_1_parloop_struct_128672_.free_zt_res_120579 = zt_res_120579;
    futhark_mc_segred_stage_1_parloop_struct_128672_.free_zt_res_120580 = zt_res_120580;
    futhark_mc_segred_stage_1_parloop_struct_128672_.free_reduce_stage_1_tid_res_arr_mem_125339 = reduce_stage_1_tid_res_arr_mem_125339;
    futhark_mc_segred_stage_1_parloop_struct_128672_.free_reduce_stage_1_tid_res_arr_mem_125341 = reduce_stage_1_tid_res_arr_mem_125341;
    futhark_mc_segred_stage_1_parloop_struct_128672_.free_reduce_stage_1_tid_res_arr_mem_125343 = reduce_stage_1_tid_res_arr_mem_125343;
    futhark_mc_segred_stage_1_parloop_struct_128672_.free_reduce_stage_1_tid_res_arr_mem_125345 = reduce_stage_1_tid_res_arr_mem_125345;
    futhark_mc_segred_stage_1_parloop_struct_128672_.free_reduce_stage_1_tid_res_arr_mem_125347 = reduce_stage_1_tid_res_arr_mem_125347;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128673_task;
    
    futhark_mc_segred_stage_1_parloop_128673_task.name = "futhark_mc_segred_stage_1_parloop_128673";
    futhark_mc_segred_stage_1_parloop_128673_task.fn = futhark_mc_segred_stage_1_parloop_128673;
    futhark_mc_segred_stage_1_parloop_128673_task.args = &futhark_mc_segred_stage_1_parloop_struct_128672_;
    futhark_mc_segred_stage_1_parloop_128673_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128673_task.info = info;
    
    struct mc_event *event_128678 = mc_event_new(ctx);
    
    if (event_128678 != NULL)
        event_128678->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128673_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128673_task);
    
    if (futhark_mc_segred_stage_1_parloop_128673_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128673_err;
        goto cleanup;
    }
    if (event_128678 != NULL) {
        event_128678->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128673_total", strdup("nothing further"), event_128678, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_120582 = 0.0;
        defunc_res_120583 = 0.0;
        defunc_res_120584 = 0.0;
        defunc_res_120585 = 0.0;
        defunc_res_120586 = 0.0;
    }
    
    double eta_p_125389;
    double eta_p_125390;
    double eta_p_125392;
    double eta_p_125393;
    double eta_p_125395;
    double eta_p_125396;
    double eta_p_125398;
    double eta_p_125399;
    double eta_p_125401;
    double eta_p_125402;
    
    for (int32_t i_125404 = 0; i_125404 < nsubtasks_125338; i_125404++) {
        flat_tid_120759 = i_125404;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_125389 = defunc_res_120582;
            }
            // load next params
            {
                eta_p_125390 = ((double *) reduce_stage_1_tid_res_arr_mem_125339)[flat_tid_120759];
            }
            // red body
            {
                double zp_res_125391 = eta_p_125389 + eta_p_125390;
                
                defunc_res_120582 = zp_res_125391;
            }
            // load acc params
            {
                eta_p_125392 = defunc_res_120583;
            }
            // load next params
            {
                eta_p_125393 = ((double *) reduce_stage_1_tid_res_arr_mem_125341)[flat_tid_120759];
            }
            // red body
            {
                double zp_res_125394 = eta_p_125392 + eta_p_125393;
                
                defunc_res_120583 = zp_res_125394;
            }
            // load acc params
            {
                eta_p_125395 = defunc_res_120584;
            }
            // load next params
            {
                eta_p_125396 = ((double *) reduce_stage_1_tid_res_arr_mem_125343)[flat_tid_120759];
            }
            // red body
            {
                double zp_res_125397 = eta_p_125395 + eta_p_125396;
                
                defunc_res_120584 = zp_res_125397;
            }
            // load acc params
            {
                eta_p_125398 = defunc_res_120585;
            }
            // load next params
            {
                eta_p_125399 = ((double *) reduce_stage_1_tid_res_arr_mem_125345)[flat_tid_120759];
            }
            // red body
            {
                double zp_res_125400 = eta_p_125398 + eta_p_125399;
                
                defunc_res_120585 = zp_res_125400;
            }
            // load acc params
            {
                eta_p_125401 = defunc_res_120586;
            }
            // load next params
            {
                eta_p_125402 = ((double *) reduce_stage_1_tid_res_arr_mem_125347)[flat_tid_120759];
            }
            // red body
            {
                double zp_res_125403 = eta_p_125401 + eta_p_125402;
                
                defunc_res_120586 = zp_res_125403;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_125339);
        free(reduce_stage_1_tid_res_arr_mem_125341);
        free(reduce_stage_1_tid_res_arr_mem_125343);
        free(reduce_stage_1_tid_res_arr_mem_125345);
        free(reduce_stage_1_tid_res_arr_mem_125347);
    }
    if (event_128679 != NULL) {
        event_128679->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128666", strdup("nothing further"), event_128679, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128665->retval_defunc_res_120582 = defunc_res_120582;
        *futhark_mc_task_128665->retval_defunc_res_120583 = defunc_res_120583;
        *futhark_mc_task_128665->retval_defunc_res_120584 = defunc_res_120584;
        *futhark_mc_task_128665->retval_defunc_res_120585 = defunc_res_120585;
        *futhark_mc_task_128665->retval_defunc_res_120586 = defunc_res_120586;
        futhark_mc_task_128665->retval_mem_112463 = mem_112463.mem;
        futhark_mc_task_128665->retval_mem_112466 = mem_112466.mem;
        futhark_mc_task_128665->retval_mem_in_114669 = mem_in_114669.mem;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_128686 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_rho1_33389;
    double free_rho2_33390;
    double free_eps_33391;
    int64_t free_eta_p_106382;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_distrs_mem_111708;
    int64_t free_bytes_111715;
    unsigned char *free_mem_112403;
    unsigned char *free_mem_112416;
    unsigned char *free_mem_112421;
    unsigned char *free_mem_112423;
    unsigned char *free_mem_112425;
    unsigned char *free_mem_112427;
    unsigned char *free_mem_112431;
    unsigned char *free_mem_112463;
    unsigned char *free_mem_112466;
    unsigned char *free_mem_in_114669;
    unsigned char *free_mem_param_118928;
    double free_sqrt_res_120360;
    double free_zt_res_120554;
    double free_zt_res_120555;
    double free_zt_res_120579;
    double free_zt_res_120580;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125406;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125408;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125410;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125412;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125414;
};
struct futhark_mc_task_128691 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_param_118928;
    int64_t free_gtid_120591;
    unsigned char *free_mem_120614;
};
struct futhark_mc_segmap_parloop_struct_128693 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_param_118928;
    int64_t free_gtid_120591;
    unsigned char *free_mem_120614;
};
static int futhark_mc_segmap_parloop_128694(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_128693 *futhark_mc_segmap_parloop_struct_128693 = (struct futhark_mc_segmap_parloop_struct_128693 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_128693->ctx;
    struct mc_event *event_128695 = mc_event_new(ctx);
    
    if (event_128695 != NULL)
        event_128695->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_128693->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segmap_parloop_struct_128693->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segmap_parloop_struct_128693->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_segmap_parloop_struct_128693->free_mem_param_118928, .size =0, .references =NULL};
    int64_t gtid_120591 = futhark_mc_segmap_parloop_struct_128693->free_gtid_120591;
    struct memblock mem_120614 = {.desc ="mem_120614", .mem =futhark_mc_segmap_parloop_struct_128693->free_mem_120614, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_120627;
    
    flat_tid_120627 = subtask_id;
    {
        int64_t start_125452;
        int64_t end_125453;
        
        start_125452 = start;
        end_125453 = end;
        
        int64_t n_125454 = end_125453 - start_125452;
        
        for (int64_t SegMap_i_125455 = start_125452; SegMap_i_125455 < start_125452 + n_125454; SegMap_i_125455++) {
            int64_t slice_125456 = m_33388;
            int64_t gtid_120628 = SegMap_i_125455;
            int64_t remnant_125457 = SegMap_i_125455 - gtid_120628;
            double defunc_0_reduce_res_120629;
            double redout_125447 = 0.0;
            
            for (int64_t i_125446 = 0; i_125446 < m_33388; i_125446++) {
                double eta_p_125448 = ((double *) A_mem_111707.mem)[eta_p_106382 * (m_33388 * m_33388) + gtid_120591 * m_33388 + i_125446];
                double eta_p_125449 = ((double *) mem_param_118928.mem)[i_125446 * m_33388 + gtid_120628];
                double zt_res_125450 = eta_p_125448 * eta_p_125449;
                double zp_res_125451 = zt_res_125450 + redout_125447;
                double redout_tmp_125458 = zp_res_125451;
                
                redout_125447 = redout_tmp_125458;
            }
            defunc_0_reduce_res_120629 = redout_125447;
            ((double *) mem_120614.mem)[gtid_120628] = defunc_0_reduce_res_120629;
        }
    }
    
  cleanup:
    { }
    if (event_128695 != NULL) {
        event_128695->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128694", strdup("nothing further"), event_128695, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_task_128692(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128691 *futhark_mc_task_128691 = (struct futhark_mc_task_128691 *) args;
    struct futhark_context *ctx = futhark_mc_task_128691->ctx;
    struct mc_event *event_128697 = mc_event_new(ctx);
    
    if (event_128697 != NULL)
        event_128697->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128691->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_128691->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_128691->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_task_128691->free_mem_param_118928, .size =0, .references =NULL};
    int64_t gtid_120591 = futhark_mc_task_128691->free_gtid_120591;
    struct memblock mem_120614 = {.desc ="mem_120614", .mem =futhark_mc_task_128691->free_mem_120614, .size =0, .references =NULL};
    int32_t nsubtasks_125445;
    
    nsubtasks_125445 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_128693 futhark_mc_segmap_parloop_struct_128693_;
    
    futhark_mc_segmap_parloop_struct_128693_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_128693_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_128693_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segmap_parloop_struct_128693_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segmap_parloop_struct_128693_.free_mem_param_118928 = mem_param_118928.mem;
    futhark_mc_segmap_parloop_struct_128693_.free_gtid_120591 = gtid_120591;
    futhark_mc_segmap_parloop_struct_128693_.free_mem_120614 = mem_120614.mem;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_128694_task;
    
    futhark_mc_segmap_parloop_128694_task.name = "futhark_mc_segmap_parloop_128694";
    futhark_mc_segmap_parloop_128694_task.fn = futhark_mc_segmap_parloop_128694;
    futhark_mc_segmap_parloop_128694_task.args = &futhark_mc_segmap_parloop_struct_128693_;
    futhark_mc_segmap_parloop_128694_task.iterations = iterations;
    futhark_mc_segmap_parloop_128694_task.info = info;
    
    struct mc_event *event_128696 = mc_event_new(ctx);
    
    if (event_128696 != NULL)
        event_128696->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_128694_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_128694_task);
    
    if (futhark_mc_segmap_parloop_128694_err != 0) {
        err = futhark_mc_segmap_parloop_128694_err;
        goto cleanup;
    }
    if (event_128696 != NULL) {
        event_128696->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128694_total", strdup("nothing further"), event_128696, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_128697 != NULL) {
        event_128697->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_task_128692", strdup("nothing further"), event_128697, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_segmap_parloop_struct_128699 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_param_118928;
    int64_t free_gtid_120591;
    unsigned char *free_mem_120614;
};
struct futhark_mc_task_128701 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_param_118928;
    int64_t free_gtid_120591;
    int64_t free_gtid_120617;
    int64_t free_flat_tid_125460;
    double *retval_defunc_0_reduce_res_120618;
};
struct futhark_mc_segred_stage_1_parloop_struct_128704 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_param_118928;
    int64_t free_gtid_120591;
    int64_t free_gtid_120617;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125475;
};
static int futhark_mc_segred_stage_1_parloop_128705(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128704 *futhark_mc_segred_stage_1_parloop_struct_128704 = (struct futhark_mc_segred_stage_1_parloop_struct_128704 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128704->ctx;
    struct mc_event *event_128706 = mc_event_new(ctx);
    
    if (event_128706 != NULL)
        event_128706->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128704->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_128704->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_128704->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_segred_stage_1_parloop_struct_128704->free_mem_param_118928, .size =0, .references =NULL};
    int64_t gtid_120591 = futhark_mc_segred_stage_1_parloop_struct_128704->free_gtid_120591;
    int64_t gtid_120617 = futhark_mc_segred_stage_1_parloop_struct_128704->free_gtid_120617;
    struct memblock reduce_stage_1_tid_res_arr_mem_125475 = {.desc ="reduce_stage_1_tid_res_arr_mem_125475", .mem =futhark_mc_segred_stage_1_parloop_struct_128704->free_reduce_stage_1_tid_res_arr_mem_125475, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_125460;
    
    flat_tid_125460 = subtask_id;
    {
        double eta_p_125477;
        double eta_p_125478;
        double local_acc_125480 = 0.0;
        double eta_p_125462;
        double eta_p_125463;
        double local_acc_125481 = 0.0;
        int64_t start_125482;
        int64_t end_125483;
        
        start_125482 = start;
        end_125483 = end;
        
        int64_t n_125484 = end_125483 - start_125482;
        
        for (int64_t SegRed_i_125485 = start_125482; SegRed_i_125485 < start_125482 + n_125484; SegRed_i_125485++) {
            int64_t gtid_125461 = SegRed_i_125485;
            double eta_p_125465 = ((double *) A_mem_111707.mem)[eta_p_106382 * (m_33388 * m_33388) + gtid_120591 * m_33388 + gtid_125461];
            double eta_p_125466 = ((double *) mem_param_118928.mem)[gtid_125461 * m_33388 + gtid_120617];
            double zt_res_125467 = eta_p_125465 * eta_p_125466;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_125462 = local_acc_125481;
            }
            // Load next params
            {
                eta_p_125463 = zt_res_125467;
            }
            // SegRed body
            {
                double zp_res_125464 = eta_p_125462 + eta_p_125463;
                
                local_acc_125481 = zp_res_125464;
            }
        }
        
        int64_t uni_i_125486 = 0;
        
        {
            int64_t gtid_125461 = uni_i_125486;
            
            // Load accum params
            {
                eta_p_125477 = local_acc_125480;
            }
            // Load next params
            {
                eta_p_125478 = local_acc_125481;
            }
            // SegRed body
            {
                double zp_res_125479 = eta_p_125477 + eta_p_125478;
                
                local_acc_125480 = zp_res_125479;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_125475.mem)[flat_tid_125460] = local_acc_125480;
    }
    
  cleanup:
    { }
    if (event_128706 != NULL) {
        event_128706->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128705", strdup("nothing further"), event_128706, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128702(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128701 *futhark_mc_task_128701 = (struct futhark_mc_task_128701 *) args;
    struct futhark_context *ctx = futhark_mc_task_128701->ctx;
    struct mc_event *event_128708 = mc_event_new(ctx);
    
    if (event_128708 != NULL)
        event_128708->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128701->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_128701->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_128701->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_task_128701->free_mem_param_118928, .size =0, .references =NULL};
    int64_t gtid_120591 = futhark_mc_task_128701->free_gtid_120591;
    int64_t gtid_120617 = futhark_mc_task_128701->free_gtid_120617;
    int64_t flat_tid_125460 = futhark_mc_task_128701->free_flat_tid_125460;
    double defunc_0_reduce_res_120618 = *futhark_mc_task_128701->retval_defunc_0_reduce_res_120618;
    int64_t reduce_stage_1_tid_res_arr_mem_125475_cached_sizze_128703 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125475 = NULL;
    int32_t nsubtasks_125474;
    
    nsubtasks_125474 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_125475_cached_sizze_128703 < (int64_t) 8 * nsubtasks_125474) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125475, &reduce_stage_1_tid_res_arr_mem_125475_cached_sizze_128703, (int64_t) 8 * nsubtasks_125474);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128704 futhark_mc_segred_stage_1_parloop_struct_128704_;
    
    futhark_mc_segred_stage_1_parloop_struct_128704_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128704_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128704_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_128704_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_128704_.free_mem_param_118928 = mem_param_118928.mem;
    futhark_mc_segred_stage_1_parloop_struct_128704_.free_gtid_120591 = gtid_120591;
    futhark_mc_segred_stage_1_parloop_struct_128704_.free_gtid_120617 = gtid_120617;
    futhark_mc_segred_stage_1_parloop_struct_128704_.free_reduce_stage_1_tid_res_arr_mem_125475 = reduce_stage_1_tid_res_arr_mem_125475;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128705_task;
    
    futhark_mc_segred_stage_1_parloop_128705_task.name = "futhark_mc_segred_stage_1_parloop_128705";
    futhark_mc_segred_stage_1_parloop_128705_task.fn = futhark_mc_segred_stage_1_parloop_128705;
    futhark_mc_segred_stage_1_parloop_128705_task.args = &futhark_mc_segred_stage_1_parloop_struct_128704_;
    futhark_mc_segred_stage_1_parloop_128705_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128705_task.info = info;
    
    struct mc_event *event_128707 = mc_event_new(ctx);
    
    if (event_128707 != NULL)
        event_128707->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128705_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128705_task);
    
    if (futhark_mc_segred_stage_1_parloop_128705_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128705_err;
        goto cleanup;
    }
    if (event_128707 != NULL) {
        event_128707->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128705_total", strdup("nothing further"), event_128707, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_120618 = 0.0;
    }
    
    double eta_p_125487;
    double eta_p_125488;
    
    for (int32_t i_125490 = 0; i_125490 < nsubtasks_125474; i_125490++) {
        flat_tid_125460 = i_125490;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_125487 = defunc_0_reduce_res_120618;
            }
            // load next params
            {
                eta_p_125488 = ((double *) reduce_stage_1_tid_res_arr_mem_125475)[flat_tid_125460];
            }
            // red body
            {
                double zp_res_125489 = eta_p_125487 + eta_p_125488;
                
                defunc_0_reduce_res_120618 = zp_res_125489;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_125475);
    }
    if (event_128708 != NULL) {
        event_128708->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128702", strdup("nothing further"), event_128708, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128701->retval_defunc_0_reduce_res_120618 = defunc_0_reduce_res_120618;
    }
    return err;
}
static int futhark_mc_segmap_parloop_128700(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_128699 *futhark_mc_segmap_parloop_struct_128699 = (struct futhark_mc_segmap_parloop_struct_128699 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_128699->ctx;
    struct mc_event *event_128709 = mc_event_new(ctx);
    
    if (event_128709 != NULL)
        event_128709->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_128699->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segmap_parloop_struct_128699->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segmap_parloop_struct_128699->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_segmap_parloop_struct_128699->free_mem_param_118928, .size =0, .references =NULL};
    int64_t gtid_120591 = futhark_mc_segmap_parloop_struct_128699->free_gtid_120591;
    struct memblock mem_120614 = {.desc ="mem_120614", .mem =futhark_mc_segmap_parloop_struct_128699->free_mem_120614, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_120616;
    
    flat_tid_120616 = subtask_id;
    {
        int64_t start_125468;
        int64_t end_125469;
        
        start_125468 = start;
        end_125469 = end;
        
        int64_t n_125470 = end_125469 - start_125468;
        
        for (int64_t SegMap_i_125471 = start_125468; SegMap_i_125471 < start_125468 + n_125470; SegMap_i_125471++) {
            int64_t slice_125472 = m_33388;
            int64_t gtid_120617 = SegMap_i_125471;
            int64_t remnant_125473 = SegMap_i_125471 - gtid_120617;
            double defunc_0_reduce_res_120618;
            int64_t flat_tid_125460 = (int64_t) 0;
            
            defunc_0_reduce_res_120618 = 0.0;
            
            struct futhark_mc_task_128701 futhark_mc_task_128701_;
            
            futhark_mc_task_128701_.ctx = ctx;
            futhark_mc_task_128701_.free_m_33388 = m_33388;
            futhark_mc_task_128701_.free_eta_p_106382 = eta_p_106382;
            futhark_mc_task_128701_.free_A_mem_111707 = A_mem_111707.mem;
            futhark_mc_task_128701_.free_mem_param_118928 = mem_param_118928.mem;
            futhark_mc_task_128701_.free_gtid_120591 = gtid_120591;
            futhark_mc_task_128701_.free_gtid_120617 = gtid_120617;
            futhark_mc_task_128701_.free_flat_tid_125460 = flat_tid_125460;
            futhark_mc_task_128701_.retval_defunc_0_reduce_res_120618 = (double *) &defunc_0_reduce_res_120618;
            #if ISPC
            futhark_mc_task_128701_.retval_defunc_0_reduce_res_120618 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_128701_task;
            
            futhark_mc_task_128701_task.args = &futhark_mc_task_128701_;
            futhark_mc_task_128701_task.top_level_fn = futhark_mc_segred_task_128702;
            futhark_mc_task_128701_task.name = "futhark_mc_segred_task_128702";
            futhark_mc_task_128701_task.iterations = m_33388;
            futhark_mc_task_128701_task.task_time = &ctx->program->futhark_mc_segred_task_128702_total_time;
            futhark_mc_task_128701_task.task_iter = &ctx->program->futhark_mc_segred_task_128702_total_iter;
            futhark_mc_task_128701_task.sched = STATIC;
            futhark_mc_task_128701_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_128702_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128701_task);
            
            if (futhark_mc_segred_task_128702_err != 0) {
                err = futhark_mc_segred_task_128702_err;
                goto cleanup;
            }
            ((double *) mem_120614.mem)[gtid_120617] = defunc_0_reduce_res_120618;
        }
    }
    
  cleanup:
    { }
    if (event_128709 != NULL) {
        event_128709->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128700", strdup("nothing further"), event_128709, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_nested_task_128698(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128691 *futhark_mc_task_128691 = (struct futhark_mc_task_128691 *) args;
    struct futhark_context *ctx = futhark_mc_task_128691->ctx;
    struct mc_event *event_128711 = mc_event_new(ctx);
    
    if (event_128711 != NULL)
        event_128711->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128691->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_128691->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_128691->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_task_128691->free_mem_param_118928, .size =0, .references =NULL};
    int64_t gtid_120591 = futhark_mc_task_128691->free_gtid_120591;
    struct memblock mem_120614 = {.desc ="mem_120614", .mem =futhark_mc_task_128691->free_mem_120614, .size =0, .references =NULL};
    int32_t nsubtasks_125459;
    
    nsubtasks_125459 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_128699 futhark_mc_segmap_parloop_struct_128699_;
    
    futhark_mc_segmap_parloop_struct_128699_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_128699_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_128699_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segmap_parloop_struct_128699_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segmap_parloop_struct_128699_.free_mem_param_118928 = mem_param_118928.mem;
    futhark_mc_segmap_parloop_struct_128699_.free_gtid_120591 = gtid_120591;
    futhark_mc_segmap_parloop_struct_128699_.free_mem_120614 = mem_120614.mem;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_128700_task;
    
    futhark_mc_segmap_parloop_128700_task.name = "futhark_mc_segmap_parloop_128700";
    futhark_mc_segmap_parloop_128700_task.fn = futhark_mc_segmap_parloop_128700;
    futhark_mc_segmap_parloop_128700_task.args = &futhark_mc_segmap_parloop_struct_128699_;
    futhark_mc_segmap_parloop_128700_task.iterations = iterations;
    futhark_mc_segmap_parloop_128700_task.info = info;
    
    struct mc_event *event_128710 = mc_event_new(ctx);
    
    if (event_128710 != NULL)
        event_128710->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_128700_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_128700_task);
    
    if (futhark_mc_segmap_parloop_128700_err != 0) {
        err = futhark_mc_segmap_parloop_128700_err;
        goto cleanup;
    }
    if (event_128710 != NULL) {
        event_128710->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128700_total", strdup("nothing further"), event_128710, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_128711 != NULL) {
        event_128711->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_nested_task_128698", strdup("nothing further"), event_128711, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_128712 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112425;
    int64_t free_gtid_120591;
    int64_t free_flat_tid_120637;
    double *retval_defunc_0_reduce_res_120636;
};
struct futhark_mc_segred_stage_1_parloop_struct_128715 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112425;
    int64_t free_gtid_120591;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125492;
};
static int futhark_mc_segred_stage_1_parloop_128716(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128715 *futhark_mc_segred_stage_1_parloop_struct_128715 = (struct futhark_mc_segred_stage_1_parloop_struct_128715 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128715->ctx;
    struct mc_event *event_128717 = mc_event_new(ctx);
    
    if (event_128717 != NULL)
        event_128717->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128715->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_128715->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_128715->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112425 = {.desc ="mem_112425", .mem =futhark_mc_segred_stage_1_parloop_struct_128715->free_mem_112425, .size =0, .references =NULL};
    int64_t gtid_120591 = futhark_mc_segred_stage_1_parloop_struct_128715->free_gtid_120591;
    struct memblock reduce_stage_1_tid_res_arr_mem_125492 = {.desc ="reduce_stage_1_tid_res_arr_mem_125492", .mem =futhark_mc_segred_stage_1_parloop_struct_128715->free_reduce_stage_1_tid_res_arr_mem_125492, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_120637;
    
    flat_tid_120637 = subtask_id;
    {
        double eta_p_125494;
        double eta_p_125495;
        double local_acc_125497 = 0.0;
        double eta_p_120639;
        double eta_p_120640;
        double local_acc_125498 = 0.0;
        int64_t start_125499;
        int64_t end_125500;
        
        start_125499 = start;
        end_125500 = end;
        
        int64_t n_125501 = end_125500 - start_125499;
        
        for (int64_t SegRed_i_125502 = start_125499; SegRed_i_125502 < start_125499 + n_125501; SegRed_i_125502++) {
            int64_t gtid_120638 = SegRed_i_125502;
            double eta_p_120642 = ((double *) A_mem_111707.mem)[eta_p_106382 * (m_33388 * m_33388) + gtid_120591 * m_33388 + gtid_120638];
            double eta_p_120643 = ((double *) mem_112425.mem)[gtid_120638];
            double zt_res_120644 = eta_p_120642 * eta_p_120642;
            double zt_res_120645 = eta_p_120643 * zt_res_120644;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_120639 = local_acc_125498;
            }
            // Load next params
            {
                eta_p_120640 = zt_res_120645;
            }
            // SegRed body
            {
                double zp_res_120641 = eta_p_120639 + eta_p_120640;
                
                local_acc_125498 = zp_res_120641;
            }
        }
        
        int64_t uni_i_125503 = 0;
        
        {
            int64_t gtid_120638 = uni_i_125503;
            
            // Load accum params
            {
                eta_p_125494 = local_acc_125497;
            }
            // Load next params
            {
                eta_p_125495 = local_acc_125498;
            }
            // SegRed body
            {
                double zp_res_125496 = eta_p_125494 + eta_p_125495;
                
                local_acc_125497 = zp_res_125496;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_125492.mem)[flat_tid_120637] = local_acc_125497;
    }
    
  cleanup:
    { }
    if (event_128717 != NULL) {
        event_128717->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128716", strdup("nothing further"), event_128717, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128713(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128712 *futhark_mc_task_128712 = (struct futhark_mc_task_128712 *) args;
    struct futhark_context *ctx = futhark_mc_task_128712->ctx;
    struct mc_event *event_128719 = mc_event_new(ctx);
    
    if (event_128719 != NULL)
        event_128719->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128712->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_128712->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_128712->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112425 = {.desc ="mem_112425", .mem =futhark_mc_task_128712->free_mem_112425, .size =0, .references =NULL};
    int64_t gtid_120591 = futhark_mc_task_128712->free_gtid_120591;
    int64_t flat_tid_120637 = futhark_mc_task_128712->free_flat_tid_120637;
    double defunc_0_reduce_res_120636 = *futhark_mc_task_128712->retval_defunc_0_reduce_res_120636;
    int64_t reduce_stage_1_tid_res_arr_mem_125492_cached_sizze_128714 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125492 = NULL;
    int32_t nsubtasks_125491;
    
    nsubtasks_125491 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_125492_cached_sizze_128714 < (int64_t) 8 * nsubtasks_125491) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125492, &reduce_stage_1_tid_res_arr_mem_125492_cached_sizze_128714, (int64_t) 8 * nsubtasks_125491);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128715 futhark_mc_segred_stage_1_parloop_struct_128715_;
    
    futhark_mc_segred_stage_1_parloop_struct_128715_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128715_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128715_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_128715_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_128715_.free_mem_112425 = mem_112425.mem;
    futhark_mc_segred_stage_1_parloop_struct_128715_.free_gtid_120591 = gtid_120591;
    futhark_mc_segred_stage_1_parloop_struct_128715_.free_reduce_stage_1_tid_res_arr_mem_125492 = reduce_stage_1_tid_res_arr_mem_125492;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128716_task;
    
    futhark_mc_segred_stage_1_parloop_128716_task.name = "futhark_mc_segred_stage_1_parloop_128716";
    futhark_mc_segred_stage_1_parloop_128716_task.fn = futhark_mc_segred_stage_1_parloop_128716;
    futhark_mc_segred_stage_1_parloop_128716_task.args = &futhark_mc_segred_stage_1_parloop_struct_128715_;
    futhark_mc_segred_stage_1_parloop_128716_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128716_task.info = info;
    
    struct mc_event *event_128718 = mc_event_new(ctx);
    
    if (event_128718 != NULL)
        event_128718->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128716_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128716_task);
    
    if (futhark_mc_segred_stage_1_parloop_128716_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128716_err;
        goto cleanup;
    }
    if (event_128718 != NULL) {
        event_128718->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128716_total", strdup("nothing further"), event_128718, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_120636 = 0.0;
    }
    
    double eta_p_125504;
    double eta_p_125505;
    
    for (int32_t i_125507 = 0; i_125507 < nsubtasks_125491; i_125507++) {
        flat_tid_120637 = i_125507;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_125504 = defunc_0_reduce_res_120636;
            }
            // load next params
            {
                eta_p_125505 = ((double *) reduce_stage_1_tid_res_arr_mem_125492)[flat_tid_120637];
            }
            // red body
            {
                double zp_res_125506 = eta_p_125504 + eta_p_125505;
                
                defunc_0_reduce_res_120636 = zp_res_125506;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_125492);
    }
    if (event_128719 != NULL) {
        event_128719->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128713", strdup("nothing further"), event_128719, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128712->retval_defunc_0_reduce_res_120636 = defunc_0_reduce_res_120636;
    }
    return err;
}
struct futhark_mc_task_128720 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_rho1_33389;
    double free_rho2_33390;
    double free_eps_33391;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_112403;
    unsigned char *free_mem_112416;
    unsigned char *free_mem_112421;
    unsigned char *free_mem_112427;
    unsigned char *free_mem_112431;
    unsigned char *free_mem_param_118928;
    double free_sqrt_res_120360;
    double free_zt_res_120579;
    double free_zt_res_120580;
    int64_t free_gtid_120591;
    double free_x_120607;
    double free_log_res_120609;
    double free_fma_res_120613;
    unsigned char *free_mem_120614;
    double free_defunc_0_reduce_res_120636;
    int64_t free_flat_tid_120654;
    int64_t free_flat_tid_120705;
    double *retval_defunc_0_reduce_res_120648;
    double *retval_defunc_res_120649;
    double *retval_defunc_res_120650;
    double *retval_defunc_res_120651;
    unsigned char *retval_mem_120646;
    unsigned char *retval_mem_120647;
};
struct futhark_mc_segred_stage_1_parloop_struct_128726 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_rho1_33389;
    double free_rho2_33390;
    double free_eps_33391;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_112403;
    unsigned char *free_mem_112416;
    unsigned char *free_mem_112421;
    unsigned char *free_mem_112427;
    unsigned char *free_mem_112431;
    unsigned char *free_mem_param_118928;
    double free_sqrt_res_120360;
    double free_zt_res_120579;
    double free_zt_res_120580;
    int64_t free_gtid_120591;
    double free_x_120607;
    double free_log_res_120609;
    double free_fma_res_120613;
    unsigned char *free_mem_120614;
    double free_defunc_0_reduce_res_120636;
    unsigned char *free_mem_120646;
    unsigned char *free_mem_120647;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125509;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125511;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125513;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125515;
};
static int futhark_mc_segred_stage_1_parloop_128727(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128726 *futhark_mc_segred_stage_1_parloop_struct_128726 = (struct futhark_mc_segred_stage_1_parloop_struct_128726 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128726->ctx;
    struct mc_event *event_128728 = mc_event_new(ctx);
    
    if (event_128728 != NULL)
        event_128728->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128726->free_m_33388;
    double rho1_33389 = futhark_mc_segred_stage_1_parloop_struct_128726->free_rho1_33389;
    double rho2_33390 = futhark_mc_segred_stage_1_parloop_struct_128726->free_rho2_33390;
    double eps_33391 = futhark_mc_segred_stage_1_parloop_struct_128726->free_eps_33391;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128726->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_128726->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112403 = {.desc ="mem_112403", .mem =futhark_mc_segred_stage_1_parloop_struct_128726->free_mem_112403, .size =0, .references =NULL};
    struct memblock mem_112416 = {.desc ="mem_112416", .mem =futhark_mc_segred_stage_1_parloop_struct_128726->free_mem_112416, .size =0, .references =NULL};
    struct memblock mem_112421 = {.desc ="mem_112421", .mem =futhark_mc_segred_stage_1_parloop_struct_128726->free_mem_112421, .size =0, .references =NULL};
    struct memblock mem_112427 = {.desc ="mem_112427", .mem =futhark_mc_segred_stage_1_parloop_struct_128726->free_mem_112427, .size =0, .references =NULL};
    struct memblock mem_112431 = {.desc ="mem_112431", .mem =futhark_mc_segred_stage_1_parloop_struct_128726->free_mem_112431, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_segred_stage_1_parloop_struct_128726->free_mem_param_118928, .size =0, .references =NULL};
    double sqrt_res_120360 = futhark_mc_segred_stage_1_parloop_struct_128726->free_sqrt_res_120360;
    double zt_res_120579 = futhark_mc_segred_stage_1_parloop_struct_128726->free_zt_res_120579;
    double zt_res_120580 = futhark_mc_segred_stage_1_parloop_struct_128726->free_zt_res_120580;
    int64_t gtid_120591 = futhark_mc_segred_stage_1_parloop_struct_128726->free_gtid_120591;
    double x_120607 = futhark_mc_segred_stage_1_parloop_struct_128726->free_x_120607;
    double log_res_120609 = futhark_mc_segred_stage_1_parloop_struct_128726->free_log_res_120609;
    double fma_res_120613 = futhark_mc_segred_stage_1_parloop_struct_128726->free_fma_res_120613;
    struct memblock mem_120614 = {.desc ="mem_120614", .mem =futhark_mc_segred_stage_1_parloop_struct_128726->free_mem_120614, .size =0, .references =NULL};
    double defunc_0_reduce_res_120636 = futhark_mc_segred_stage_1_parloop_struct_128726->free_defunc_0_reduce_res_120636;
    struct memblock mem_120646 = {.desc ="mem_120646", .mem =futhark_mc_segred_stage_1_parloop_struct_128726->free_mem_120646, .size =0, .references =NULL};
    struct memblock mem_120647 = {.desc ="mem_120647", .mem =futhark_mc_segred_stage_1_parloop_struct_128726->free_mem_120647, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125509 = {.desc ="reduce_stage_1_tid_res_arr_mem_125509", .mem =futhark_mc_segred_stage_1_parloop_struct_128726->free_reduce_stage_1_tid_res_arr_mem_125509, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125511 = {.desc ="reduce_stage_1_tid_res_arr_mem_125511", .mem =futhark_mc_segred_stage_1_parloop_struct_128726->free_reduce_stage_1_tid_res_arr_mem_125511, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125513 = {.desc ="reduce_stage_1_tid_res_arr_mem_125513", .mem =futhark_mc_segred_stage_1_parloop_struct_128726->free_reduce_stage_1_tid_res_arr_mem_125513, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125515 = {.desc ="reduce_stage_1_tid_res_arr_mem_125515", .mem =futhark_mc_segred_stage_1_parloop_struct_128726->free_reduce_stage_1_tid_res_arr_mem_125515, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_120705;
    
    flat_tid_120705 = subtask_id;
    {
        double eta_p_125517;
        double eta_p_125518;
        double eta_p_125520;
        double eta_p_125521;
        double eta_p_125523;
        double eta_p_125524;
        double eta_p_125526;
        double eta_p_125527;
        double local_acc_125529 = 0.0;
        double local_acc_125530 = 0.0;
        double local_acc_125531 = 0.0;
        double local_acc_125532 = 0.0;
        double eta_p_120707;
        double eta_p_120708;
        double eta_p_120710;
        double eta_p_120711;
        double eta_p_120713;
        double eta_p_120714;
        double eta_p_120716;
        double eta_p_120717;
        double local_acc_125533 = 0.0;
        double local_acc_125534 = 0.0;
        double local_acc_125535 = 0.0;
        double local_acc_125536 = 0.0;
        int64_t start_125537;
        int64_t end_125538;
        
        start_125537 = start;
        end_125538 = end;
        
        int64_t n_125539 = end_125538 - start_125537;
        
        for (int64_t SegRed_i_125540 = start_125537; SegRed_i_125540 < start_125537 + n_125539; SegRed_i_125540++) {
            int64_t gtid_120706 = SegRed_i_125540;
            double eta_p_120719 = ((double *) mem_112403.mem)[gtid_120591 * m_33388 + gtid_120706];
            double eta_p_120720 = ((double *) mem_param_118928.mem)[gtid_120591 * m_33388 + gtid_120706];
            double eta_p_120721 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + gtid_120706];
            double eta_p_wasfree_120722 = ((double *) mem_112416.mem)[gtid_120706];
            double eta_p_wasfree_120723 = ((double *) mem_112427.mem)[gtid_120706];
            double eta_p_120724 = ((double *) mem_112421.mem)[gtid_120706 * m_33388 + gtid_120591];
            double zt_res_120725 = sqrt_res_120360 * eta_p_120719;
            double zm_res_120726 = zt_res_120725 - eta_p_120720;
            double log_res_120727 = futrts_log64(eta_p_120720);
            double zm_res_120728 = log_res_120727 - eta_p_wasfree_120722;
            double zm_res_120729 = zm_res_120728 - log_res_120609;
            double fma_res_120730 = futrts_fma64(zt_res_120579, zm_res_120729, zt_res_120580);
            double defunc_0_reduce_res_120731;
            double redout_120733 = 0.0;
            
            for (int64_t i_120732 = 0; i_120732 < m_33388; i_120732++) {
                double eta_p_120734 = ((double *) mem_120614.mem)[i_120732];
                double eta_p_120735 = ((double *) mem_112431.mem)[lifted_lambda_res_106391 * (m_33388 * m_33388) + i_120732 * m_33388 + gtid_120706];
                double zt_res_120736 = eta_p_120734 * eta_p_120735;
                double zp_res_120737 = zt_res_120736 + redout_120733;
                double redout_tmp_125541 = zp_res_120737;
                
                redout_120733 = redout_tmp_125541;
            }
            defunc_0_reduce_res_120731 = redout_120733;
            
            double zt_res_120738 = -2.0 * defunc_0_reduce_res_120731;
            double zp_res_120739 = defunc_0_reduce_res_120636 + zt_res_120738;
            double zp_res_120740 = eta_p_wasfree_120723 + zp_res_120739;
            double zt_res_120741 = 2.0 * zp_res_120740;
            double fma_res_120742 = futrts_fma64(fma_res_120613, rho1_33389, zt_res_120741);
            double fma_res_120743 = futrts_fma64(eta_p_120724, rho2_33390, fma_res_120742);
            double fma_res_120744 = futrts_fma64(fma_res_120730, eps_33391, fma_res_120743);
            double max_res_120745 = fmax64(-1.0e100, fma_res_120744);
            double zt_res_120746 = zm_res_120726 * max_res_120745;
            double zp_res_120747 = eta_p_120720 + zm_res_120726;
            double zt_res_120748 = x_120607 * eta_p_120721;
            bool zeze_res_120749 = zp_res_120747 == 0.0;
            double klu_res_120750;
            
            if (zeze_res_120749) {
                klu_res_120750 = 0.0;
            } else {
                double zs_res_120751 = zp_res_120747 / zt_res_120748;
                double log_res_120752 = futrts_log64(zs_res_120751);
                double zt_res_120753 = zp_res_120747 * log_res_120752;
                
                klu_res_120750 = zt_res_120753;
            }
            // save map-out results
            {
                ((double *) mem_120646.mem)[gtid_120706] = zp_res_120747;
                ((double *) mem_120647.mem)[gtid_120706] = zm_res_120726;
            }
            // Load accum params
            {
                eta_p_120707 = local_acc_125533;
            }
            // Load next params
            {
                eta_p_120708 = zt_res_120746;
            }
            // SegRed body
            {
                double zp_res_120709 = eta_p_120707 + eta_p_120708;
                
                local_acc_125533 = zp_res_120709;
            }
            // Load accum params
            {
                eta_p_120710 = local_acc_125534;
            }
            // Load next params
            {
                eta_p_120711 = klu_res_120750;
            }
            // SegRed body
            {
                double zp_res_120712 = eta_p_120710 + eta_p_120711;
                
                local_acc_125534 = zp_res_120712;
            }
            // Load accum params
            {
                eta_p_120713 = local_acc_125535;
            }
            // Load next params
            {
                eta_p_120714 = zp_res_120747;
            }
            // SegRed body
            {
                double zp_res_120715 = eta_p_120713 + eta_p_120714;
                
                local_acc_125535 = zp_res_120715;
            }
            // Load accum params
            {
                eta_p_120716 = local_acc_125536;
            }
            // Load next params
            {
                eta_p_120717 = zp_res_120747;
            }
            // SegRed body
            {
                double zp_res_120718 = eta_p_120716 + eta_p_120717;
                
                local_acc_125536 = zp_res_120718;
            }
        }
        
        int64_t uni_i_125542 = 0;
        
        {
            int64_t gtid_120706 = uni_i_125542;
            
            // Load accum params
            {
                eta_p_125517 = local_acc_125529;
            }
            // Load next params
            {
                eta_p_125518 = local_acc_125533;
            }
            // SegRed body
            {
                double zp_res_125519 = eta_p_125517 + eta_p_125518;
                
                local_acc_125529 = zp_res_125519;
            }
            // Load accum params
            {
                eta_p_125520 = local_acc_125530;
            }
            // Load next params
            {
                eta_p_125521 = local_acc_125534;
            }
            // SegRed body
            {
                double zp_res_125522 = eta_p_125520 + eta_p_125521;
                
                local_acc_125530 = zp_res_125522;
            }
            // Load accum params
            {
                eta_p_125523 = local_acc_125531;
            }
            // Load next params
            {
                eta_p_125524 = local_acc_125535;
            }
            // SegRed body
            {
                double zp_res_125525 = eta_p_125523 + eta_p_125524;
                
                local_acc_125531 = zp_res_125525;
            }
            // Load accum params
            {
                eta_p_125526 = local_acc_125532;
            }
            // Load next params
            {
                eta_p_125527 = local_acc_125536;
            }
            // SegRed body
            {
                double zp_res_125528 = eta_p_125526 + eta_p_125527;
                
                local_acc_125532 = zp_res_125528;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_125509.mem)[flat_tid_120705] = local_acc_125529;
        ((double *) reduce_stage_1_tid_res_arr_mem_125511.mem)[flat_tid_120705] = local_acc_125530;
        ((double *) reduce_stage_1_tid_res_arr_mem_125513.mem)[flat_tid_120705] = local_acc_125531;
        ((double *) reduce_stage_1_tid_res_arr_mem_125515.mem)[flat_tid_120705] = local_acc_125532;
    }
    
  cleanup:
    { }
    if (event_128728 != NULL) {
        event_128728->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128727", strdup("nothing further"), event_128728, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128721(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128720 *futhark_mc_task_128720 = (struct futhark_mc_task_128720 *) args;
    struct futhark_context *ctx = futhark_mc_task_128720->ctx;
    struct mc_event *event_128730 = mc_event_new(ctx);
    
    if (event_128730 != NULL)
        event_128730->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128720->free_m_33388;
    double rho1_33389 = futhark_mc_task_128720->free_rho1_33389;
    double rho2_33390 = futhark_mc_task_128720->free_rho2_33390;
    double eps_33391 = futhark_mc_task_128720->free_eps_33391;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128720->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128720->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112403 = {.desc ="mem_112403", .mem =futhark_mc_task_128720->free_mem_112403, .size =0, .references =NULL};
    struct memblock mem_112416 = {.desc ="mem_112416", .mem =futhark_mc_task_128720->free_mem_112416, .size =0, .references =NULL};
    struct memblock mem_112421 = {.desc ="mem_112421", .mem =futhark_mc_task_128720->free_mem_112421, .size =0, .references =NULL};
    struct memblock mem_112427 = {.desc ="mem_112427", .mem =futhark_mc_task_128720->free_mem_112427, .size =0, .references =NULL};
    struct memblock mem_112431 = {.desc ="mem_112431", .mem =futhark_mc_task_128720->free_mem_112431, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_task_128720->free_mem_param_118928, .size =0, .references =NULL};
    double sqrt_res_120360 = futhark_mc_task_128720->free_sqrt_res_120360;
    double zt_res_120579 = futhark_mc_task_128720->free_zt_res_120579;
    double zt_res_120580 = futhark_mc_task_128720->free_zt_res_120580;
    int64_t gtid_120591 = futhark_mc_task_128720->free_gtid_120591;
    double x_120607 = futhark_mc_task_128720->free_x_120607;
    double log_res_120609 = futhark_mc_task_128720->free_log_res_120609;
    double fma_res_120613 = futhark_mc_task_128720->free_fma_res_120613;
    struct memblock mem_120614 = {.desc ="mem_120614", .mem =futhark_mc_task_128720->free_mem_120614, .size =0, .references =NULL};
    double defunc_0_reduce_res_120636 = futhark_mc_task_128720->free_defunc_0_reduce_res_120636;
    int64_t flat_tid_120654 = futhark_mc_task_128720->free_flat_tid_120654;
    int64_t flat_tid_120705 = futhark_mc_task_128720->free_flat_tid_120705;
    double defunc_0_reduce_res_120648 = *futhark_mc_task_128720->retval_defunc_0_reduce_res_120648;
    double defunc_res_120649 = *futhark_mc_task_128720->retval_defunc_res_120649;
    double defunc_res_120650 = *futhark_mc_task_128720->retval_defunc_res_120650;
    double defunc_res_120651 = *futhark_mc_task_128720->retval_defunc_res_120651;
    struct memblock mem_120646 = {.desc ="mem_120646", .mem =futhark_mc_task_128720->retval_mem_120646, .size =0, .references =NULL};
    struct memblock mem_120647 = {.desc ="mem_120647", .mem =futhark_mc_task_128720->retval_mem_120647, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_125509_cached_sizze_128722 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125509 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_125511_cached_sizze_128723 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125511 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_125513_cached_sizze_128724 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125513 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_125515_cached_sizze_128725 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125515 = NULL;
    int32_t nsubtasks_125508;
    
    nsubtasks_125508 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_125509_cached_sizze_128722 < (int64_t) 8 * nsubtasks_125508) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125509, &reduce_stage_1_tid_res_arr_mem_125509_cached_sizze_128722, (int64_t) 8 * nsubtasks_125508);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_125511_cached_sizze_128723 < (int64_t) 8 * nsubtasks_125508) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125511, &reduce_stage_1_tid_res_arr_mem_125511_cached_sizze_128723, (int64_t) 8 * nsubtasks_125508);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_125513_cached_sizze_128724 < (int64_t) 8 * nsubtasks_125508) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125513, &reduce_stage_1_tid_res_arr_mem_125513_cached_sizze_128724, (int64_t) 8 * nsubtasks_125508);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_125515_cached_sizze_128725 < (int64_t) 8 * nsubtasks_125508) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125515, &reduce_stage_1_tid_res_arr_mem_125515_cached_sizze_128725, (int64_t) 8 * nsubtasks_125508);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128726 futhark_mc_segred_stage_1_parloop_struct_128726_;
    
    futhark_mc_segred_stage_1_parloop_struct_128726_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128726_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128726_.free_rho1_33389 = rho1_33389;
    futhark_mc_segred_stage_1_parloop_struct_128726_.free_rho2_33390 = rho2_33390;
    futhark_mc_segred_stage_1_parloop_struct_128726_.free_eps_33391 = eps_33391;
    futhark_mc_segred_stage_1_parloop_struct_128726_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128726_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_128726_.free_mem_112403 = mem_112403.mem;
    futhark_mc_segred_stage_1_parloop_struct_128726_.free_mem_112416 = mem_112416.mem;
    futhark_mc_segred_stage_1_parloop_struct_128726_.free_mem_112421 = mem_112421.mem;
    futhark_mc_segred_stage_1_parloop_struct_128726_.free_mem_112427 = mem_112427.mem;
    futhark_mc_segred_stage_1_parloop_struct_128726_.free_mem_112431 = mem_112431.mem;
    futhark_mc_segred_stage_1_parloop_struct_128726_.free_mem_param_118928 = mem_param_118928.mem;
    futhark_mc_segred_stage_1_parloop_struct_128726_.free_sqrt_res_120360 = sqrt_res_120360;
    futhark_mc_segred_stage_1_parloop_struct_128726_.free_zt_res_120579 = zt_res_120579;
    futhark_mc_segred_stage_1_parloop_struct_128726_.free_zt_res_120580 = zt_res_120580;
    futhark_mc_segred_stage_1_parloop_struct_128726_.free_gtid_120591 = gtid_120591;
    futhark_mc_segred_stage_1_parloop_struct_128726_.free_x_120607 = x_120607;
    futhark_mc_segred_stage_1_parloop_struct_128726_.free_log_res_120609 = log_res_120609;
    futhark_mc_segred_stage_1_parloop_struct_128726_.free_fma_res_120613 = fma_res_120613;
    futhark_mc_segred_stage_1_parloop_struct_128726_.free_mem_120614 = mem_120614.mem;
    futhark_mc_segred_stage_1_parloop_struct_128726_.free_defunc_0_reduce_res_120636 = defunc_0_reduce_res_120636;
    futhark_mc_segred_stage_1_parloop_struct_128726_.free_mem_120646 = mem_120646.mem;
    futhark_mc_segred_stage_1_parloop_struct_128726_.free_mem_120647 = mem_120647.mem;
    futhark_mc_segred_stage_1_parloop_struct_128726_.free_reduce_stage_1_tid_res_arr_mem_125509 = reduce_stage_1_tid_res_arr_mem_125509;
    futhark_mc_segred_stage_1_parloop_struct_128726_.free_reduce_stage_1_tid_res_arr_mem_125511 = reduce_stage_1_tid_res_arr_mem_125511;
    futhark_mc_segred_stage_1_parloop_struct_128726_.free_reduce_stage_1_tid_res_arr_mem_125513 = reduce_stage_1_tid_res_arr_mem_125513;
    futhark_mc_segred_stage_1_parloop_struct_128726_.free_reduce_stage_1_tid_res_arr_mem_125515 = reduce_stage_1_tid_res_arr_mem_125515;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128727_task;
    
    futhark_mc_segred_stage_1_parloop_128727_task.name = "futhark_mc_segred_stage_1_parloop_128727";
    futhark_mc_segred_stage_1_parloop_128727_task.fn = futhark_mc_segred_stage_1_parloop_128727;
    futhark_mc_segred_stage_1_parloop_128727_task.args = &futhark_mc_segred_stage_1_parloop_struct_128726_;
    futhark_mc_segred_stage_1_parloop_128727_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128727_task.info = info;
    
    struct mc_event *event_128729 = mc_event_new(ctx);
    
    if (event_128729 != NULL)
        event_128729->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128727_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128727_task);
    
    if (futhark_mc_segred_stage_1_parloop_128727_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128727_err;
        goto cleanup;
    }
    if (event_128729 != NULL) {
        event_128729->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128727_total", strdup("nothing further"), event_128729, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_120648 = 0.0;
        defunc_res_120649 = 0.0;
        defunc_res_120650 = 0.0;
        defunc_res_120651 = 0.0;
    }
    
    double eta_p_125543;
    double eta_p_125544;
    double eta_p_125546;
    double eta_p_125547;
    double eta_p_125549;
    double eta_p_125550;
    double eta_p_125552;
    double eta_p_125553;
    
    for (int32_t i_125555 = 0; i_125555 < nsubtasks_125508; i_125555++) {
        flat_tid_120705 = i_125555;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_125543 = defunc_0_reduce_res_120648;
            }
            // load next params
            {
                eta_p_125544 = ((double *) reduce_stage_1_tid_res_arr_mem_125509)[flat_tid_120705];
            }
            // red body
            {
                double zp_res_125545 = eta_p_125543 + eta_p_125544;
                
                defunc_0_reduce_res_120648 = zp_res_125545;
            }
            // load acc params
            {
                eta_p_125546 = defunc_res_120649;
            }
            // load next params
            {
                eta_p_125547 = ((double *) reduce_stage_1_tid_res_arr_mem_125511)[flat_tid_120705];
            }
            // red body
            {
                double zp_res_125548 = eta_p_125546 + eta_p_125547;
                
                defunc_res_120649 = zp_res_125548;
            }
            // load acc params
            {
                eta_p_125549 = defunc_res_120650;
            }
            // load next params
            {
                eta_p_125550 = ((double *) reduce_stage_1_tid_res_arr_mem_125513)[flat_tid_120705];
            }
            // red body
            {
                double zp_res_125551 = eta_p_125549 + eta_p_125550;
                
                defunc_res_120650 = zp_res_125551;
            }
            // load acc params
            {
                eta_p_125552 = defunc_res_120651;
            }
            // load next params
            {
                eta_p_125553 = ((double *) reduce_stage_1_tid_res_arr_mem_125515)[flat_tid_120705];
            }
            // red body
            {
                double zp_res_125554 = eta_p_125552 + eta_p_125553;
                
                defunc_res_120651 = zp_res_125554;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_125509);
        free(reduce_stage_1_tid_res_arr_mem_125511);
        free(reduce_stage_1_tid_res_arr_mem_125513);
        free(reduce_stage_1_tid_res_arr_mem_125515);
    }
    if (event_128730 != NULL) {
        event_128730->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128721", strdup("nothing further"), event_128730, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128720->retval_defunc_0_reduce_res_120648 = defunc_0_reduce_res_120648;
        *futhark_mc_task_128720->retval_defunc_res_120649 = defunc_res_120649;
        *futhark_mc_task_128720->retval_defunc_res_120650 = defunc_res_120650;
        *futhark_mc_task_128720->retval_defunc_res_120651 = defunc_res_120651;
        futhark_mc_task_128720->retval_mem_120646 = mem_120646.mem;
        futhark_mc_task_128720->retval_mem_120647 = mem_120647.mem;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_128736 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_rho1_33389;
    double free_rho2_33390;
    double free_eps_33391;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_112403;
    unsigned char *free_mem_112416;
    unsigned char *free_mem_112421;
    unsigned char *free_mem_112427;
    unsigned char *free_mem_112431;
    unsigned char *free_mem_param_118928;
    double free_sqrt_res_120360;
    double free_zt_res_120579;
    double free_zt_res_120580;
    int64_t free_gtid_120591;
    double free_x_120607;
    double free_log_res_120609;
    double free_fma_res_120613;
    unsigned char *free_mem_120614;
    double free_defunc_0_reduce_res_120636;
    unsigned char *free_mem_120646;
    unsigned char *free_mem_120647;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125557;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125559;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125561;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125563;
};
struct futhark_mc_task_128738 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_mem_112431;
    unsigned char *free_mem_120614;
    int64_t free_gtid_120655;
    int64_t free_flat_tid_120681;
    double *retval_defunc_0_reduce_res_120680;
};
struct futhark_mc_segred_stage_1_parloop_struct_128741 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_mem_112431;
    unsigned char *free_mem_120614;
    int64_t free_gtid_120655;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125590;
};
static int futhark_mc_segred_stage_1_parloop_128742(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128741 *futhark_mc_segred_stage_1_parloop_struct_128741 = (struct futhark_mc_segred_stage_1_parloop_struct_128741 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128741->ctx;
    struct mc_event *event_128743 = mc_event_new(ctx);
    
    if (event_128743 != NULL)
        event_128743->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128741->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128741->free_lifted_lambda_res_106391;
    struct memblock mem_112431 = {.desc ="mem_112431", .mem =futhark_mc_segred_stage_1_parloop_struct_128741->free_mem_112431, .size =0, .references =NULL};
    struct memblock mem_120614 = {.desc ="mem_120614", .mem =futhark_mc_segred_stage_1_parloop_struct_128741->free_mem_120614, .size =0, .references =NULL};
    int64_t gtid_120655 = futhark_mc_segred_stage_1_parloop_struct_128741->free_gtid_120655;
    struct memblock reduce_stage_1_tid_res_arr_mem_125590 = {.desc ="reduce_stage_1_tid_res_arr_mem_125590", .mem =futhark_mc_segred_stage_1_parloop_struct_128741->free_reduce_stage_1_tid_res_arr_mem_125590, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_120681;
    
    flat_tid_120681 = subtask_id;
    {
        double eta_p_125592;
        double eta_p_125593;
        double local_acc_125595 = 0.0;
        double eta_p_120683;
        double eta_p_120684;
        double local_acc_125596 = 0.0;
        int64_t start_125597;
        int64_t end_125598;
        
        start_125597 = start;
        end_125598 = end;
        
        int64_t n_125599 = end_125598 - start_125597;
        
        for (int64_t SegRed_i_125600 = start_125597; SegRed_i_125600 < start_125597 + n_125599; SegRed_i_125600++) {
            int64_t gtid_120682 = SegRed_i_125600;
            double eta_p_120686 = ((double *) mem_120614.mem)[gtid_120682];
            double eta_p_120687 = ((double *) mem_112431.mem)[lifted_lambda_res_106391 * (m_33388 * m_33388) + gtid_120682 * m_33388 + gtid_120655];
            double zt_res_120688 = eta_p_120686 * eta_p_120687;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_120683 = local_acc_125596;
            }
            // Load next params
            {
                eta_p_120684 = zt_res_120688;
            }
            // SegRed body
            {
                double zp_res_120685 = eta_p_120683 + eta_p_120684;
                
                local_acc_125596 = zp_res_120685;
            }
        }
        
        int64_t uni_i_125601 = 0;
        
        {
            int64_t gtid_120682 = uni_i_125601;
            
            // Load accum params
            {
                eta_p_125592 = local_acc_125595;
            }
            // Load next params
            {
                eta_p_125593 = local_acc_125596;
            }
            // SegRed body
            {
                double zp_res_125594 = eta_p_125592 + eta_p_125593;
                
                local_acc_125595 = zp_res_125594;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_125590.mem)[flat_tid_120681] = local_acc_125595;
    }
    
  cleanup:
    { }
    if (event_128743 != NULL) {
        event_128743->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128742", strdup("nothing further"), event_128743, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128739(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128738 *futhark_mc_task_128738 = (struct futhark_mc_task_128738 *) args;
    struct futhark_context *ctx = futhark_mc_task_128738->ctx;
    struct mc_event *event_128745 = mc_event_new(ctx);
    
    if (event_128745 != NULL)
        event_128745->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128738->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128738->free_lifted_lambda_res_106391;
    struct memblock mem_112431 = {.desc ="mem_112431", .mem =futhark_mc_task_128738->free_mem_112431, .size =0, .references =NULL};
    struct memblock mem_120614 = {.desc ="mem_120614", .mem =futhark_mc_task_128738->free_mem_120614, .size =0, .references =NULL};
    int64_t gtid_120655 = futhark_mc_task_128738->free_gtid_120655;
    int64_t flat_tid_120681 = futhark_mc_task_128738->free_flat_tid_120681;
    double defunc_0_reduce_res_120680 = *futhark_mc_task_128738->retval_defunc_0_reduce_res_120680;
    int64_t reduce_stage_1_tid_res_arr_mem_125590_cached_sizze_128740 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125590 = NULL;
    int32_t nsubtasks_125589;
    
    nsubtasks_125589 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_125590_cached_sizze_128740 < (int64_t) 8 * nsubtasks_125589) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125590, &reduce_stage_1_tid_res_arr_mem_125590_cached_sizze_128740, (int64_t) 8 * nsubtasks_125589);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128741 futhark_mc_segred_stage_1_parloop_struct_128741_;
    
    futhark_mc_segred_stage_1_parloop_struct_128741_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128741_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128741_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128741_.free_mem_112431 = mem_112431.mem;
    futhark_mc_segred_stage_1_parloop_struct_128741_.free_mem_120614 = mem_120614.mem;
    futhark_mc_segred_stage_1_parloop_struct_128741_.free_gtid_120655 = gtid_120655;
    futhark_mc_segred_stage_1_parloop_struct_128741_.free_reduce_stage_1_tid_res_arr_mem_125590 = reduce_stage_1_tid_res_arr_mem_125590;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128742_task;
    
    futhark_mc_segred_stage_1_parloop_128742_task.name = "futhark_mc_segred_stage_1_parloop_128742";
    futhark_mc_segred_stage_1_parloop_128742_task.fn = futhark_mc_segred_stage_1_parloop_128742;
    futhark_mc_segred_stage_1_parloop_128742_task.args = &futhark_mc_segred_stage_1_parloop_struct_128741_;
    futhark_mc_segred_stage_1_parloop_128742_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128742_task.info = info;
    
    struct mc_event *event_128744 = mc_event_new(ctx);
    
    if (event_128744 != NULL)
        event_128744->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128742_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128742_task);
    
    if (futhark_mc_segred_stage_1_parloop_128742_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128742_err;
        goto cleanup;
    }
    if (event_128744 != NULL) {
        event_128744->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128742_total", strdup("nothing further"), event_128744, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_120680 = 0.0;
    }
    
    double eta_p_125602;
    double eta_p_125603;
    
    for (int32_t i_125605 = 0; i_125605 < nsubtasks_125589; i_125605++) {
        flat_tid_120681 = i_125605;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_125602 = defunc_0_reduce_res_120680;
            }
            // load next params
            {
                eta_p_125603 = ((double *) reduce_stage_1_tid_res_arr_mem_125590)[flat_tid_120681];
            }
            // red body
            {
                double zp_res_125604 = eta_p_125602 + eta_p_125603;
                
                defunc_0_reduce_res_120680 = zp_res_125604;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_125590);
    }
    if (event_128745 != NULL) {
        event_128745->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128739", strdup("nothing further"), event_128745, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128738->retval_defunc_0_reduce_res_120680 = defunc_0_reduce_res_120680;
    }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_128737(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128736 *futhark_mc_segred_stage_1_parloop_struct_128736 = (struct futhark_mc_segred_stage_1_parloop_struct_128736 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128736->ctx;
    struct mc_event *event_128746 = mc_event_new(ctx);
    
    if (event_128746 != NULL)
        event_128746->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128736->free_m_33388;
    double rho1_33389 = futhark_mc_segred_stage_1_parloop_struct_128736->free_rho1_33389;
    double rho2_33390 = futhark_mc_segred_stage_1_parloop_struct_128736->free_rho2_33390;
    double eps_33391 = futhark_mc_segred_stage_1_parloop_struct_128736->free_eps_33391;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128736->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_128736->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112403 = {.desc ="mem_112403", .mem =futhark_mc_segred_stage_1_parloop_struct_128736->free_mem_112403, .size =0, .references =NULL};
    struct memblock mem_112416 = {.desc ="mem_112416", .mem =futhark_mc_segred_stage_1_parloop_struct_128736->free_mem_112416, .size =0, .references =NULL};
    struct memblock mem_112421 = {.desc ="mem_112421", .mem =futhark_mc_segred_stage_1_parloop_struct_128736->free_mem_112421, .size =0, .references =NULL};
    struct memblock mem_112427 = {.desc ="mem_112427", .mem =futhark_mc_segred_stage_1_parloop_struct_128736->free_mem_112427, .size =0, .references =NULL};
    struct memblock mem_112431 = {.desc ="mem_112431", .mem =futhark_mc_segred_stage_1_parloop_struct_128736->free_mem_112431, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_segred_stage_1_parloop_struct_128736->free_mem_param_118928, .size =0, .references =NULL};
    double sqrt_res_120360 = futhark_mc_segred_stage_1_parloop_struct_128736->free_sqrt_res_120360;
    double zt_res_120579 = futhark_mc_segred_stage_1_parloop_struct_128736->free_zt_res_120579;
    double zt_res_120580 = futhark_mc_segred_stage_1_parloop_struct_128736->free_zt_res_120580;
    int64_t gtid_120591 = futhark_mc_segred_stage_1_parloop_struct_128736->free_gtid_120591;
    double x_120607 = futhark_mc_segred_stage_1_parloop_struct_128736->free_x_120607;
    double log_res_120609 = futhark_mc_segred_stage_1_parloop_struct_128736->free_log_res_120609;
    double fma_res_120613 = futhark_mc_segred_stage_1_parloop_struct_128736->free_fma_res_120613;
    struct memblock mem_120614 = {.desc ="mem_120614", .mem =futhark_mc_segred_stage_1_parloop_struct_128736->free_mem_120614, .size =0, .references =NULL};
    double defunc_0_reduce_res_120636 = futhark_mc_segred_stage_1_parloop_struct_128736->free_defunc_0_reduce_res_120636;
    struct memblock mem_120646 = {.desc ="mem_120646", .mem =futhark_mc_segred_stage_1_parloop_struct_128736->free_mem_120646, .size =0, .references =NULL};
    struct memblock mem_120647 = {.desc ="mem_120647", .mem =futhark_mc_segred_stage_1_parloop_struct_128736->free_mem_120647, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125557 = {.desc ="reduce_stage_1_tid_res_arr_mem_125557", .mem =futhark_mc_segred_stage_1_parloop_struct_128736->free_reduce_stage_1_tid_res_arr_mem_125557, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125559 = {.desc ="reduce_stage_1_tid_res_arr_mem_125559", .mem =futhark_mc_segred_stage_1_parloop_struct_128736->free_reduce_stage_1_tid_res_arr_mem_125559, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125561 = {.desc ="reduce_stage_1_tid_res_arr_mem_125561", .mem =futhark_mc_segred_stage_1_parloop_struct_128736->free_reduce_stage_1_tid_res_arr_mem_125561, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125563 = {.desc ="reduce_stage_1_tid_res_arr_mem_125563", .mem =futhark_mc_segred_stage_1_parloop_struct_128736->free_reduce_stage_1_tid_res_arr_mem_125563, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_120654;
    
    flat_tid_120654 = subtask_id;
    {
        double eta_p_125565;
        double eta_p_125566;
        double eta_p_125568;
        double eta_p_125569;
        double eta_p_125571;
        double eta_p_125572;
        double eta_p_125574;
        double eta_p_125575;
        double local_acc_125577 = 0.0;
        double local_acc_125578 = 0.0;
        double local_acc_125579 = 0.0;
        double local_acc_125580 = 0.0;
        double eta_p_120656;
        double eta_p_120657;
        double eta_p_120659;
        double eta_p_120660;
        double eta_p_120662;
        double eta_p_120663;
        double eta_p_120665;
        double eta_p_120666;
        double local_acc_125581 = 0.0;
        double local_acc_125582 = 0.0;
        double local_acc_125583 = 0.0;
        double local_acc_125584 = 0.0;
        int64_t start_125585;
        int64_t end_125586;
        
        start_125585 = start;
        end_125586 = end;
        
        int64_t n_125587 = end_125586 - start_125585;
        
        for (int64_t SegRed_i_125588 = start_125585; SegRed_i_125588 < start_125585 + n_125587; SegRed_i_125588++) {
            int64_t gtid_120655 = SegRed_i_125588;
            double eta_p_120668 = ((double *) mem_112403.mem)[gtid_120591 * m_33388 + gtid_120655];
            double eta_p_120669 = ((double *) mem_param_118928.mem)[gtid_120591 * m_33388 + gtid_120655];
            double eta_p_120670 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + gtid_120655];
            double eta_p_wasfree_120671 = ((double *) mem_112416.mem)[gtid_120655];
            double eta_p_wasfree_120672 = ((double *) mem_112427.mem)[gtid_120655];
            double eta_p_120673 = ((double *) mem_112421.mem)[gtid_120655 * m_33388 + gtid_120591];
            double zt_res_120674 = sqrt_res_120360 * eta_p_120668;
            double zm_res_120675 = zt_res_120674 - eta_p_120669;
            double log_res_120676 = futrts_log64(eta_p_120669);
            double zm_res_120677 = log_res_120676 - eta_p_wasfree_120671;
            double zm_res_120678 = zm_res_120677 - log_res_120609;
            double fma_res_120679 = futrts_fma64(zt_res_120579, zm_res_120678, zt_res_120580);
            double defunc_0_reduce_res_120680;
            int64_t flat_tid_120681 = (int64_t) 0;
            
            defunc_0_reduce_res_120680 = 0.0;
            
            struct futhark_mc_task_128738 futhark_mc_task_128738_;
            
            futhark_mc_task_128738_.ctx = ctx;
            futhark_mc_task_128738_.free_m_33388 = m_33388;
            futhark_mc_task_128738_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
            futhark_mc_task_128738_.free_mem_112431 = mem_112431.mem;
            futhark_mc_task_128738_.free_mem_120614 = mem_120614.mem;
            futhark_mc_task_128738_.free_gtid_120655 = gtid_120655;
            futhark_mc_task_128738_.free_flat_tid_120681 = flat_tid_120681;
            futhark_mc_task_128738_.retval_defunc_0_reduce_res_120680 = (double *) &defunc_0_reduce_res_120680;
            #if ISPC
            futhark_mc_task_128738_.retval_defunc_0_reduce_res_120680 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_128738_task;
            
            futhark_mc_task_128738_task.args = &futhark_mc_task_128738_;
            futhark_mc_task_128738_task.top_level_fn = futhark_mc_segred_task_128739;
            futhark_mc_task_128738_task.name = "futhark_mc_segred_task_128739";
            futhark_mc_task_128738_task.iterations = m_33388;
            futhark_mc_task_128738_task.task_time = &ctx->program->futhark_mc_segred_task_128739_total_time;
            futhark_mc_task_128738_task.task_iter = &ctx->program->futhark_mc_segred_task_128739_total_iter;
            futhark_mc_task_128738_task.sched = STATIC;
            futhark_mc_task_128738_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_128739_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128738_task);
            
            if (futhark_mc_segred_task_128739_err != 0) {
                err = futhark_mc_segred_task_128739_err;
                goto cleanup;
            }
            
            double zt_res_120689 = -2.0 * defunc_0_reduce_res_120680;
            double zp_res_120690 = defunc_0_reduce_res_120636 + zt_res_120689;
            double zp_res_120691 = eta_p_wasfree_120672 + zp_res_120690;
            double zt_res_120692 = 2.0 * zp_res_120691;
            double fma_res_120693 = futrts_fma64(fma_res_120613, rho1_33389, zt_res_120692);
            double fma_res_120694 = futrts_fma64(eta_p_120673, rho2_33390, fma_res_120693);
            double fma_res_120695 = futrts_fma64(fma_res_120679, eps_33391, fma_res_120694);
            double max_res_120696 = fmax64(-1.0e100, fma_res_120695);
            double zt_res_120697 = zm_res_120675 * max_res_120696;
            double zp_res_120698 = eta_p_120669 + zm_res_120675;
            double zt_res_120699 = x_120607 * eta_p_120670;
            bool zeze_res_120700 = zp_res_120698 == 0.0;
            double klu_res_120701;
            
            if (zeze_res_120700) {
                klu_res_120701 = 0.0;
            } else {
                double zs_res_120702 = zp_res_120698 / zt_res_120699;
                double log_res_120703 = futrts_log64(zs_res_120702);
                double zt_res_120704 = zp_res_120698 * log_res_120703;
                
                klu_res_120701 = zt_res_120704;
            }
            // save map-out results
            {
                ((double *) mem_120646.mem)[gtid_120655] = zp_res_120698;
                ((double *) mem_120647.mem)[gtid_120655] = zm_res_120675;
            }
            // Load accum params
            {
                eta_p_120656 = local_acc_125581;
            }
            // Load next params
            {
                eta_p_120657 = zt_res_120697;
            }
            // SegRed body
            {
                double zp_res_120658 = eta_p_120656 + eta_p_120657;
                
                local_acc_125581 = zp_res_120658;
            }
            // Load accum params
            {
                eta_p_120659 = local_acc_125582;
            }
            // Load next params
            {
                eta_p_120660 = klu_res_120701;
            }
            // SegRed body
            {
                double zp_res_120661 = eta_p_120659 + eta_p_120660;
                
                local_acc_125582 = zp_res_120661;
            }
            // Load accum params
            {
                eta_p_120662 = local_acc_125583;
            }
            // Load next params
            {
                eta_p_120663 = zp_res_120698;
            }
            // SegRed body
            {
                double zp_res_120664 = eta_p_120662 + eta_p_120663;
                
                local_acc_125583 = zp_res_120664;
            }
            // Load accum params
            {
                eta_p_120665 = local_acc_125584;
            }
            // Load next params
            {
                eta_p_120666 = zp_res_120698;
            }
            // SegRed body
            {
                double zp_res_120667 = eta_p_120665 + eta_p_120666;
                
                local_acc_125584 = zp_res_120667;
            }
        }
        
        int64_t uni_i_125606 = 0;
        
        {
            int64_t gtid_120655 = uni_i_125606;
            
            // Load accum params
            {
                eta_p_125565 = local_acc_125577;
            }
            // Load next params
            {
                eta_p_125566 = local_acc_125581;
            }
            // SegRed body
            {
                double zp_res_125567 = eta_p_125565 + eta_p_125566;
                
                local_acc_125577 = zp_res_125567;
            }
            // Load accum params
            {
                eta_p_125568 = local_acc_125578;
            }
            // Load next params
            {
                eta_p_125569 = local_acc_125582;
            }
            // SegRed body
            {
                double zp_res_125570 = eta_p_125568 + eta_p_125569;
                
                local_acc_125578 = zp_res_125570;
            }
            // Load accum params
            {
                eta_p_125571 = local_acc_125579;
            }
            // Load next params
            {
                eta_p_125572 = local_acc_125583;
            }
            // SegRed body
            {
                double zp_res_125573 = eta_p_125571 + eta_p_125572;
                
                local_acc_125579 = zp_res_125573;
            }
            // Load accum params
            {
                eta_p_125574 = local_acc_125580;
            }
            // Load next params
            {
                eta_p_125575 = local_acc_125584;
            }
            // SegRed body
            {
                double zp_res_125576 = eta_p_125574 + eta_p_125575;
                
                local_acc_125580 = zp_res_125576;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_125557.mem)[flat_tid_120654] = local_acc_125577;
        ((double *) reduce_stage_1_tid_res_arr_mem_125559.mem)[flat_tid_120654] = local_acc_125578;
        ((double *) reduce_stage_1_tid_res_arr_mem_125561.mem)[flat_tid_120654] = local_acc_125579;
        ((double *) reduce_stage_1_tid_res_arr_mem_125563.mem)[flat_tid_120654] = local_acc_125580;
    }
    
  cleanup:
    { }
    if (event_128746 != NULL) {
        event_128746->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128737", strdup("nothing further"), event_128746, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_128731(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128720 *futhark_mc_task_128720 = (struct futhark_mc_task_128720 *) args;
    struct futhark_context *ctx = futhark_mc_task_128720->ctx;
    struct mc_event *event_128748 = mc_event_new(ctx);
    
    if (event_128748 != NULL)
        event_128748->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128720->free_m_33388;
    double rho1_33389 = futhark_mc_task_128720->free_rho1_33389;
    double rho2_33390 = futhark_mc_task_128720->free_rho2_33390;
    double eps_33391 = futhark_mc_task_128720->free_eps_33391;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128720->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128720->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112403 = {.desc ="mem_112403", .mem =futhark_mc_task_128720->free_mem_112403, .size =0, .references =NULL};
    struct memblock mem_112416 = {.desc ="mem_112416", .mem =futhark_mc_task_128720->free_mem_112416, .size =0, .references =NULL};
    struct memblock mem_112421 = {.desc ="mem_112421", .mem =futhark_mc_task_128720->free_mem_112421, .size =0, .references =NULL};
    struct memblock mem_112427 = {.desc ="mem_112427", .mem =futhark_mc_task_128720->free_mem_112427, .size =0, .references =NULL};
    struct memblock mem_112431 = {.desc ="mem_112431", .mem =futhark_mc_task_128720->free_mem_112431, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_task_128720->free_mem_param_118928, .size =0, .references =NULL};
    double sqrt_res_120360 = futhark_mc_task_128720->free_sqrt_res_120360;
    double zt_res_120579 = futhark_mc_task_128720->free_zt_res_120579;
    double zt_res_120580 = futhark_mc_task_128720->free_zt_res_120580;
    int64_t gtid_120591 = futhark_mc_task_128720->free_gtid_120591;
    double x_120607 = futhark_mc_task_128720->free_x_120607;
    double log_res_120609 = futhark_mc_task_128720->free_log_res_120609;
    double fma_res_120613 = futhark_mc_task_128720->free_fma_res_120613;
    struct memblock mem_120614 = {.desc ="mem_120614", .mem =futhark_mc_task_128720->free_mem_120614, .size =0, .references =NULL};
    double defunc_0_reduce_res_120636 = futhark_mc_task_128720->free_defunc_0_reduce_res_120636;
    int64_t flat_tid_120654 = futhark_mc_task_128720->free_flat_tid_120654;
    int64_t flat_tid_120705 = futhark_mc_task_128720->free_flat_tid_120705;
    double defunc_0_reduce_res_120648 = *futhark_mc_task_128720->retval_defunc_0_reduce_res_120648;
    double defunc_res_120649 = *futhark_mc_task_128720->retval_defunc_res_120649;
    double defunc_res_120650 = *futhark_mc_task_128720->retval_defunc_res_120650;
    double defunc_res_120651 = *futhark_mc_task_128720->retval_defunc_res_120651;
    struct memblock mem_120646 = {.desc ="mem_120646", .mem =futhark_mc_task_128720->retval_mem_120646, .size =0, .references =NULL};
    struct memblock mem_120647 = {.desc ="mem_120647", .mem =futhark_mc_task_128720->retval_mem_120647, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_125557_cached_sizze_128732 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125557 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_125559_cached_sizze_128733 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125559 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_125561_cached_sizze_128734 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125561 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_125563_cached_sizze_128735 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125563 = NULL;
    int32_t nsubtasks_125556;
    
    nsubtasks_125556 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_125557_cached_sizze_128732 < (int64_t) 8 * nsubtasks_125556) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125557, &reduce_stage_1_tid_res_arr_mem_125557_cached_sizze_128732, (int64_t) 8 * nsubtasks_125556);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_125559_cached_sizze_128733 < (int64_t) 8 * nsubtasks_125556) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125559, &reduce_stage_1_tid_res_arr_mem_125559_cached_sizze_128733, (int64_t) 8 * nsubtasks_125556);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_125561_cached_sizze_128734 < (int64_t) 8 * nsubtasks_125556) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125561, &reduce_stage_1_tid_res_arr_mem_125561_cached_sizze_128734, (int64_t) 8 * nsubtasks_125556);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_125563_cached_sizze_128735 < (int64_t) 8 * nsubtasks_125556) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125563, &reduce_stage_1_tid_res_arr_mem_125563_cached_sizze_128735, (int64_t) 8 * nsubtasks_125556);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128736 futhark_mc_segred_stage_1_parloop_struct_128736_;
    
    futhark_mc_segred_stage_1_parloop_struct_128736_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128736_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128736_.free_rho1_33389 = rho1_33389;
    futhark_mc_segred_stage_1_parloop_struct_128736_.free_rho2_33390 = rho2_33390;
    futhark_mc_segred_stage_1_parloop_struct_128736_.free_eps_33391 = eps_33391;
    futhark_mc_segred_stage_1_parloop_struct_128736_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128736_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_128736_.free_mem_112403 = mem_112403.mem;
    futhark_mc_segred_stage_1_parloop_struct_128736_.free_mem_112416 = mem_112416.mem;
    futhark_mc_segred_stage_1_parloop_struct_128736_.free_mem_112421 = mem_112421.mem;
    futhark_mc_segred_stage_1_parloop_struct_128736_.free_mem_112427 = mem_112427.mem;
    futhark_mc_segred_stage_1_parloop_struct_128736_.free_mem_112431 = mem_112431.mem;
    futhark_mc_segred_stage_1_parloop_struct_128736_.free_mem_param_118928 = mem_param_118928.mem;
    futhark_mc_segred_stage_1_parloop_struct_128736_.free_sqrt_res_120360 = sqrt_res_120360;
    futhark_mc_segred_stage_1_parloop_struct_128736_.free_zt_res_120579 = zt_res_120579;
    futhark_mc_segred_stage_1_parloop_struct_128736_.free_zt_res_120580 = zt_res_120580;
    futhark_mc_segred_stage_1_parloop_struct_128736_.free_gtid_120591 = gtid_120591;
    futhark_mc_segred_stage_1_parloop_struct_128736_.free_x_120607 = x_120607;
    futhark_mc_segred_stage_1_parloop_struct_128736_.free_log_res_120609 = log_res_120609;
    futhark_mc_segred_stage_1_parloop_struct_128736_.free_fma_res_120613 = fma_res_120613;
    futhark_mc_segred_stage_1_parloop_struct_128736_.free_mem_120614 = mem_120614.mem;
    futhark_mc_segred_stage_1_parloop_struct_128736_.free_defunc_0_reduce_res_120636 = defunc_0_reduce_res_120636;
    futhark_mc_segred_stage_1_parloop_struct_128736_.free_mem_120646 = mem_120646.mem;
    futhark_mc_segred_stage_1_parloop_struct_128736_.free_mem_120647 = mem_120647.mem;
    futhark_mc_segred_stage_1_parloop_struct_128736_.free_reduce_stage_1_tid_res_arr_mem_125557 = reduce_stage_1_tid_res_arr_mem_125557;
    futhark_mc_segred_stage_1_parloop_struct_128736_.free_reduce_stage_1_tid_res_arr_mem_125559 = reduce_stage_1_tid_res_arr_mem_125559;
    futhark_mc_segred_stage_1_parloop_struct_128736_.free_reduce_stage_1_tid_res_arr_mem_125561 = reduce_stage_1_tid_res_arr_mem_125561;
    futhark_mc_segred_stage_1_parloop_struct_128736_.free_reduce_stage_1_tid_res_arr_mem_125563 = reduce_stage_1_tid_res_arr_mem_125563;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128737_task;
    
    futhark_mc_segred_stage_1_parloop_128737_task.name = "futhark_mc_segred_stage_1_parloop_128737";
    futhark_mc_segred_stage_1_parloop_128737_task.fn = futhark_mc_segred_stage_1_parloop_128737;
    futhark_mc_segred_stage_1_parloop_128737_task.args = &futhark_mc_segred_stage_1_parloop_struct_128736_;
    futhark_mc_segred_stage_1_parloop_128737_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128737_task.info = info;
    
    struct mc_event *event_128747 = mc_event_new(ctx);
    
    if (event_128747 != NULL)
        event_128747->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128737_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128737_task);
    
    if (futhark_mc_segred_stage_1_parloop_128737_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128737_err;
        goto cleanup;
    }
    if (event_128747 != NULL) {
        event_128747->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128737_total", strdup("nothing further"), event_128747, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_120648 = 0.0;
        defunc_res_120649 = 0.0;
        defunc_res_120650 = 0.0;
        defunc_res_120651 = 0.0;
    }
    
    double eta_p_125607;
    double eta_p_125608;
    double eta_p_125610;
    double eta_p_125611;
    double eta_p_125613;
    double eta_p_125614;
    double eta_p_125616;
    double eta_p_125617;
    
    for (int32_t i_125619 = 0; i_125619 < nsubtasks_125556; i_125619++) {
        flat_tid_120654 = i_125619;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_125607 = defunc_0_reduce_res_120648;
            }
            // load next params
            {
                eta_p_125608 = ((double *) reduce_stage_1_tid_res_arr_mem_125557)[flat_tid_120654];
            }
            // red body
            {
                double zp_res_125609 = eta_p_125607 + eta_p_125608;
                
                defunc_0_reduce_res_120648 = zp_res_125609;
            }
            // load acc params
            {
                eta_p_125610 = defunc_res_120649;
            }
            // load next params
            {
                eta_p_125611 = ((double *) reduce_stage_1_tid_res_arr_mem_125559)[flat_tid_120654];
            }
            // red body
            {
                double zp_res_125612 = eta_p_125610 + eta_p_125611;
                
                defunc_res_120649 = zp_res_125612;
            }
            // load acc params
            {
                eta_p_125613 = defunc_res_120650;
            }
            // load next params
            {
                eta_p_125614 = ((double *) reduce_stage_1_tid_res_arr_mem_125561)[flat_tid_120654];
            }
            // red body
            {
                double zp_res_125615 = eta_p_125613 + eta_p_125614;
                
                defunc_res_120650 = zp_res_125615;
            }
            // load acc params
            {
                eta_p_125616 = defunc_res_120651;
            }
            // load next params
            {
                eta_p_125617 = ((double *) reduce_stage_1_tid_res_arr_mem_125563)[flat_tid_120654];
            }
            // red body
            {
                double zp_res_125618 = eta_p_125616 + eta_p_125617;
                
                defunc_res_120651 = zp_res_125618;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_125557);
        free(reduce_stage_1_tid_res_arr_mem_125559);
        free(reduce_stage_1_tid_res_arr_mem_125561);
        free(reduce_stage_1_tid_res_arr_mem_125563);
    }
    if (event_128748 != NULL) {
        event_128748->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_128731", strdup("nothing further"), event_128748, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128720->retval_defunc_0_reduce_res_120648 = defunc_0_reduce_res_120648;
        *futhark_mc_task_128720->retval_defunc_res_120649 = defunc_res_120649;
        *futhark_mc_task_128720->retval_defunc_res_120650 = defunc_res_120650;
        *futhark_mc_task_128720->retval_defunc_res_120651 = defunc_res_120651;
        futhark_mc_task_128720->retval_mem_120646 = mem_120646.mem;
        futhark_mc_task_128720->retval_mem_120647 = mem_120647.mem;
    }
    return err;
}
struct futhark_mc_task_128749 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_112466;
    int64_t free_gtid_120591;
    unsigned char *free_mem_120646;
};
struct futhark_mc_copy_parloop_struct_128751 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_112466;
    int64_t free_gtid_120591;
    unsigned char *free_mem_120646;
};
static int futhark_mc_copy_parloop_128752(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_copy_parloop_struct_128751 *futhark_mc_copy_parloop_struct_128751 = (struct futhark_mc_copy_parloop_struct_128751 *) args;
    struct futhark_context *ctx = futhark_mc_copy_parloop_struct_128751->ctx;
    struct mc_event *event_128753 = mc_event_new(ctx);
    
    if (event_128753 != NULL)
        event_128753->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_copy_parloop_struct_128751->free_m_33388;
    struct memblock mem_112466 = {.desc ="mem_112466", .mem =futhark_mc_copy_parloop_struct_128751->free_mem_112466, .size =0, .references =NULL};
    int64_t gtid_120591 = futhark_mc_copy_parloop_struct_128751->free_gtid_120591;
    struct memblock mem_120646 = {.desc ="mem_120646", .mem =futhark_mc_copy_parloop_struct_128751->free_mem_120646, .size =0, .references =NULL};
    int64_t iterations = end - start;
    
    {
        int64_t start_125620;
        int64_t end_125621;
        
        start_125620 = start;
        end_125621 = end;
        
        int64_t n_125622 = end_125621 - start_125620;
        
        for (int64_t copy_i_125623 = start_125620; copy_i_125623 < start_125620 + n_125622; copy_i_125623++) {
            int64_t slice_125625 = m_33388;
            int64_t i_125624 = copy_i_125623;
            int64_t remnant_125626 = copy_i_125623 - i_125624;
            double tmp_125627 = ((double *) mem_120646.mem)[i_125624];
            
            ((double *) mem_112466.mem)[gtid_120591 * m_33388 + i_125624] = tmp_125627;
        }
    }
    
  cleanup:
    { }
    if (event_128753 != NULL) {
        event_128753->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_parloop_128752", strdup("nothing further"), event_128753, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_copy_125628_task_128750(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128749 *futhark_mc_task_128749 = (struct futhark_mc_task_128749 *) args;
    struct futhark_context *ctx = futhark_mc_task_128749->ctx;
    struct mc_event *event_128755 = mc_event_new(ctx);
    
    if (event_128755 != NULL)
        event_128755->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128749->free_m_33388;
    struct memblock mem_112466 = {.desc ="mem_112466", .mem =futhark_mc_task_128749->free_mem_112466, .size =0, .references =NULL};
    int64_t gtid_120591 = futhark_mc_task_128749->free_gtid_120591;
    struct memblock mem_120646 = {.desc ="mem_120646", .mem =futhark_mc_task_128749->free_mem_120646, .size =0, .references =NULL};
    struct futhark_mc_copy_parloop_struct_128751 futhark_mc_copy_parloop_struct_128751_;
    
    futhark_mc_copy_parloop_struct_128751_.ctx = ctx;
    futhark_mc_copy_parloop_struct_128751_.free_m_33388 = m_33388;
    futhark_mc_copy_parloop_struct_128751_.free_mem_112466 = mem_112466.mem;
    futhark_mc_copy_parloop_struct_128751_.free_gtid_120591 = gtid_120591;
    futhark_mc_copy_parloop_struct_128751_.free_mem_120646 = mem_120646.mem;
    
    struct scheduler_parloop futhark_mc_copy_parloop_128752_task;
    
    futhark_mc_copy_parloop_128752_task.name = "futhark_mc_copy_parloop_128752";
    futhark_mc_copy_parloop_128752_task.fn = futhark_mc_copy_parloop_128752;
    futhark_mc_copy_parloop_128752_task.args = &futhark_mc_copy_parloop_struct_128751_;
    futhark_mc_copy_parloop_128752_task.iterations = iterations;
    futhark_mc_copy_parloop_128752_task.info = info;
    
    struct mc_event *event_128754 = mc_event_new(ctx);
    
    if (event_128754 != NULL)
        event_128754->bef = get_wall_time();
    
    int futhark_mc_copy_parloop_128752_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_copy_parloop_128752_task);
    
    if (futhark_mc_copy_parloop_128752_err != 0) {
        err = futhark_mc_copy_parloop_128752_err;
        goto cleanup;
    }
    if (event_128754 != NULL) {
        event_128754->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_parloop_128752_total", strdup("nothing further"), event_128754, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_128755 != NULL) {
        event_128755->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_125628_task_128750", strdup("nothing further"), event_128755, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_128756 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_in_114669;
    int64_t free_gtid_120591;
    unsigned char *free_mem_120647;
};
struct futhark_mc_copy_parloop_struct_128758 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_in_114669;
    int64_t free_gtid_120591;
    unsigned char *free_mem_120647;
};
static int futhark_mc_copy_parloop_128759(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_copy_parloop_struct_128758 *futhark_mc_copy_parloop_struct_128758 = (struct futhark_mc_copy_parloop_struct_128758 *) args;
    struct futhark_context *ctx = futhark_mc_copy_parloop_struct_128758->ctx;
    struct mc_event *event_128760 = mc_event_new(ctx);
    
    if (event_128760 != NULL)
        event_128760->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_copy_parloop_struct_128758->free_m_33388;
    struct memblock mem_in_114669 = {.desc ="mem_in_114669", .mem =futhark_mc_copy_parloop_struct_128758->free_mem_in_114669, .size =0, .references =NULL};
    int64_t gtid_120591 = futhark_mc_copy_parloop_struct_128758->free_gtid_120591;
    struct memblock mem_120647 = {.desc ="mem_120647", .mem =futhark_mc_copy_parloop_struct_128758->free_mem_120647, .size =0, .references =NULL};
    int64_t iterations = end - start;
    
    {
        int64_t start_125630;
        int64_t end_125631;
        
        start_125630 = start;
        end_125631 = end;
        
        int64_t n_125632 = end_125631 - start_125630;
        
        for (int64_t copy_i_125633 = start_125630; copy_i_125633 < start_125630 + n_125632; copy_i_125633++) {
            int64_t slice_125635 = m_33388;
            int64_t i_125634 = copy_i_125633;
            int64_t remnant_125636 = copy_i_125633 - i_125634;
            double tmp_125637 = ((double *) mem_120647.mem)[i_125634];
            
            ((double *) mem_in_114669.mem)[gtid_120591 * m_33388 + i_125634] = tmp_125637;
        }
    }
    
  cleanup:
    { }
    if (event_128760 != NULL) {
        event_128760->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_parloop_128759", strdup("nothing further"), event_128760, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_copy_125638_task_128757(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128756 *futhark_mc_task_128756 = (struct futhark_mc_task_128756 *) args;
    struct futhark_context *ctx = futhark_mc_task_128756->ctx;
    struct mc_event *event_128762 = mc_event_new(ctx);
    
    if (event_128762 != NULL)
        event_128762->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128756->free_m_33388;
    struct memblock mem_in_114669 = {.desc ="mem_in_114669", .mem =futhark_mc_task_128756->free_mem_in_114669, .size =0, .references =NULL};
    int64_t gtid_120591 = futhark_mc_task_128756->free_gtid_120591;
    struct memblock mem_120647 = {.desc ="mem_120647", .mem =futhark_mc_task_128756->free_mem_120647, .size =0, .references =NULL};
    struct futhark_mc_copy_parloop_struct_128758 futhark_mc_copy_parloop_struct_128758_;
    
    futhark_mc_copy_parloop_struct_128758_.ctx = ctx;
    futhark_mc_copy_parloop_struct_128758_.free_m_33388 = m_33388;
    futhark_mc_copy_parloop_struct_128758_.free_mem_in_114669 = mem_in_114669.mem;
    futhark_mc_copy_parloop_struct_128758_.free_gtid_120591 = gtid_120591;
    futhark_mc_copy_parloop_struct_128758_.free_mem_120647 = mem_120647.mem;
    
    struct scheduler_parloop futhark_mc_copy_parloop_128759_task;
    
    futhark_mc_copy_parloop_128759_task.name = "futhark_mc_copy_parloop_128759";
    futhark_mc_copy_parloop_128759_task.fn = futhark_mc_copy_parloop_128759;
    futhark_mc_copy_parloop_128759_task.args = &futhark_mc_copy_parloop_struct_128758_;
    futhark_mc_copy_parloop_128759_task.iterations = iterations;
    futhark_mc_copy_parloop_128759_task.info = info;
    
    struct mc_event *event_128761 = mc_event_new(ctx);
    
    if (event_128761 != NULL)
        event_128761->bef = get_wall_time();
    
    int futhark_mc_copy_parloop_128759_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_copy_parloop_128759_task);
    
    if (futhark_mc_copy_parloop_128759_err != 0) {
        err = futhark_mc_copy_parloop_128759_err;
        goto cleanup;
    }
    if (event_128761 != NULL) {
        event_128761->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_parloop_128759_total", strdup("nothing further"), event_128761, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_128762 != NULL) {
        event_128762->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_125638_task_128757", strdup("nothing further"), event_128762, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_128687(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128686 *futhark_mc_segred_stage_1_parloop_struct_128686 = (struct futhark_mc_segred_stage_1_parloop_struct_128686 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128686->ctx;
    struct mc_event *event_128763 = mc_event_new(ctx);
    
    if (event_128763 != NULL)
        event_128763->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128686->free_m_33388;
    double rho1_33389 = futhark_mc_segred_stage_1_parloop_struct_128686->free_rho1_33389;
    double rho2_33390 = futhark_mc_segred_stage_1_parloop_struct_128686->free_rho2_33390;
    double eps_33391 = futhark_mc_segred_stage_1_parloop_struct_128686->free_eps_33391;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_128686->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128686->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_128686->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_128686->free_distrs_mem_111708, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_segred_stage_1_parloop_struct_128686->free_bytes_111715;
    struct memblock mem_112403 = {.desc ="mem_112403", .mem =futhark_mc_segred_stage_1_parloop_struct_128686->free_mem_112403, .size =0, .references =NULL};
    struct memblock mem_112416 = {.desc ="mem_112416", .mem =futhark_mc_segred_stage_1_parloop_struct_128686->free_mem_112416, .size =0, .references =NULL};
    struct memblock mem_112421 = {.desc ="mem_112421", .mem =futhark_mc_segred_stage_1_parloop_struct_128686->free_mem_112421, .size =0, .references =NULL};
    struct memblock mem_112423 = {.desc ="mem_112423", .mem =futhark_mc_segred_stage_1_parloop_struct_128686->free_mem_112423, .size =0, .references =NULL};
    struct memblock mem_112425 = {.desc ="mem_112425", .mem =futhark_mc_segred_stage_1_parloop_struct_128686->free_mem_112425, .size =0, .references =NULL};
    struct memblock mem_112427 = {.desc ="mem_112427", .mem =futhark_mc_segred_stage_1_parloop_struct_128686->free_mem_112427, .size =0, .references =NULL};
    struct memblock mem_112431 = {.desc ="mem_112431", .mem =futhark_mc_segred_stage_1_parloop_struct_128686->free_mem_112431, .size =0, .references =NULL};
    struct memblock mem_112463 = {.desc ="mem_112463", .mem =futhark_mc_segred_stage_1_parloop_struct_128686->free_mem_112463, .size =0, .references =NULL};
    struct memblock mem_112466 = {.desc ="mem_112466", .mem =futhark_mc_segred_stage_1_parloop_struct_128686->free_mem_112466, .size =0, .references =NULL};
    struct memblock mem_in_114669 = {.desc ="mem_in_114669", .mem =futhark_mc_segred_stage_1_parloop_struct_128686->free_mem_in_114669, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_segred_stage_1_parloop_struct_128686->free_mem_param_118928, .size =0, .references =NULL};
    double sqrt_res_120360 = futhark_mc_segred_stage_1_parloop_struct_128686->free_sqrt_res_120360;
    double zt_res_120554 = futhark_mc_segred_stage_1_parloop_struct_128686->free_zt_res_120554;
    double zt_res_120555 = futhark_mc_segred_stage_1_parloop_struct_128686->free_zt_res_120555;
    double zt_res_120579 = futhark_mc_segred_stage_1_parloop_struct_128686->free_zt_res_120579;
    double zt_res_120580 = futhark_mc_segred_stage_1_parloop_struct_128686->free_zt_res_120580;
    struct memblock reduce_stage_1_tid_res_arr_mem_125406 = {.desc ="reduce_stage_1_tid_res_arr_mem_125406", .mem =futhark_mc_segred_stage_1_parloop_struct_128686->free_reduce_stage_1_tid_res_arr_mem_125406, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125408 = {.desc ="reduce_stage_1_tid_res_arr_mem_125408", .mem =futhark_mc_segred_stage_1_parloop_struct_128686->free_reduce_stage_1_tid_res_arr_mem_125408, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125410 = {.desc ="reduce_stage_1_tid_res_arr_mem_125410", .mem =futhark_mc_segred_stage_1_parloop_struct_128686->free_reduce_stage_1_tid_res_arr_mem_125410, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125412 = {.desc ="reduce_stage_1_tid_res_arr_mem_125412", .mem =futhark_mc_segred_stage_1_parloop_struct_128686->free_reduce_stage_1_tid_res_arr_mem_125412, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125414 = {.desc ="reduce_stage_1_tid_res_arr_mem_125414", .mem =futhark_mc_segred_stage_1_parloop_struct_128686->free_reduce_stage_1_tid_res_arr_mem_125414, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t mem_120614_cached_sizze_128688 = 0;
    unsigned char *mem_120614 = NULL;
    int64_t mem_120646_cached_sizze_128689 = 0;
    unsigned char *mem_120646 = NULL;
    int64_t mem_120647_cached_sizze_128690 = 0;
    unsigned char *mem_120647 = NULL;
    int64_t flat_tid_120590;
    
    flat_tid_120590 = subtask_id;
    {
        double eta_p_125416;
        double eta_p_125417;
        double eta_p_125419;
        double eta_p_125420;
        double eta_p_125422;
        double eta_p_125423;
        double eta_p_125425;
        double eta_p_125426;
        double eta_p_125428;
        double eta_p_125429;
        double local_acc_125431 = 0.0;
        double local_acc_125432 = 0.0;
        double local_acc_125433 = 0.0;
        double local_acc_125434 = 0.0;
        double local_acc_125435 = 0.0;
        double eta_p_120592;
        double eta_p_120593;
        double eta_p_120595;
        double eta_p_120596;
        double eta_p_120598;
        double eta_p_120599;
        double eta_p_120601;
        double eta_p_120602;
        double eta_p_120604;
        double eta_p_120605;
        double local_acc_125436 = 0.0;
        double local_acc_125437 = 0.0;
        double local_acc_125438 = 0.0;
        double local_acc_125439 = 0.0;
        double local_acc_125440 = 0.0;
        int64_t start_125441;
        int64_t end_125442;
        
        start_125441 = start;
        end_125442 = end;
        
        int64_t n_125443 = end_125442 - start_125441;
        
        if (mem_120614_cached_sizze_128688 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_120614, &mem_120614_cached_sizze_128688, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_120646_cached_sizze_128689 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_120646, &mem_120646_cached_sizze_128689, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_120647_cached_sizze_128690 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_120647, &mem_120647_cached_sizze_128690, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        for (int64_t SegRed_i_125444 = start_125441; SegRed_i_125444 < start_125441 + n_125443; SegRed_i_125444++) {
            int64_t gtid_120591 = SegRed_i_125444;
            double x_120607 = ((double *) distrs_mem_111708.mem)[eta_p_106382 * m_33388 + gtid_120591];
            double eta_p_120608 = ((double *) mem_112423.mem)[gtid_120591];
            double log_res_120609 = futrts_log64(x_120607);
            double log_res_120610 = futrts_log64(eta_p_120608);
            double zm_res_120611 = log_res_120610 - log_res_120609;
            double zp_res_120612 = 1.0 + zm_res_120611;
            double fma_res_120613 = futrts_fma64(zt_res_120555, zp_res_120612, zt_res_120554);
            int64_t flat_tid_120627 = (int64_t) 0;
            int64_t flat_tid_120616 = (int64_t) 0;
            struct futhark_mc_task_128691 futhark_mc_task_128691_;
            
            futhark_mc_task_128691_.ctx = ctx;
            futhark_mc_task_128691_.free_m_33388 = m_33388;
            futhark_mc_task_128691_.free_eta_p_106382 = eta_p_106382;
            futhark_mc_task_128691_.free_A_mem_111707 = A_mem_111707.mem;
            futhark_mc_task_128691_.free_mem_param_118928 = mem_param_118928.mem;
            futhark_mc_task_128691_.free_gtid_120591 = gtid_120591;
            futhark_mc_task_128691_.free_mem_120614 = mem_120614;
            
            struct scheduler_segop futhark_mc_task_128691_task;
            
            futhark_mc_task_128691_task.args = &futhark_mc_task_128691_;
            futhark_mc_task_128691_task.top_level_fn = futhark_mc_segmap_task_128692;
            futhark_mc_task_128691_task.name = "futhark_mc_segmap_task_128692";
            futhark_mc_task_128691_task.iterations = m_33388;
            futhark_mc_task_128691_task.task_time = &ctx->program->futhark_mc_segmap_task_128692_total_time;
            futhark_mc_task_128691_task.task_iter = &ctx->program->futhark_mc_segmap_task_128692_total_iter;
            futhark_mc_task_128691_task.sched = STATIC;
            futhark_mc_task_128691_task.nested_fn = futhark_mc_segmap_nested_task_128698;
            
            int futhark_mc_segmap_task_128692_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128691_task);
            
            if (futhark_mc_segmap_task_128692_err != 0) {
                err = futhark_mc_segmap_task_128692_err;
                goto cleanup;
            }
            
            double defunc_0_reduce_res_120636;
            int64_t flat_tid_120637 = (int64_t) 0;
            
            defunc_0_reduce_res_120636 = 0.0;
            
            struct futhark_mc_task_128712 futhark_mc_task_128712_;
            
            futhark_mc_task_128712_.ctx = ctx;
            futhark_mc_task_128712_.free_m_33388 = m_33388;
            futhark_mc_task_128712_.free_eta_p_106382 = eta_p_106382;
            futhark_mc_task_128712_.free_A_mem_111707 = A_mem_111707.mem;
            futhark_mc_task_128712_.free_mem_112425 = mem_112425.mem;
            futhark_mc_task_128712_.free_gtid_120591 = gtid_120591;
            futhark_mc_task_128712_.free_flat_tid_120637 = flat_tid_120637;
            futhark_mc_task_128712_.retval_defunc_0_reduce_res_120636 = (double *) &defunc_0_reduce_res_120636;
            #if ISPC
            futhark_mc_task_128712_.retval_defunc_0_reduce_res_120636 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_128712_task;
            
            futhark_mc_task_128712_task.args = &futhark_mc_task_128712_;
            futhark_mc_task_128712_task.top_level_fn = futhark_mc_segred_task_128713;
            futhark_mc_task_128712_task.name = "futhark_mc_segred_task_128713";
            futhark_mc_task_128712_task.iterations = m_33388;
            futhark_mc_task_128712_task.task_time = &ctx->program->futhark_mc_segred_task_128713_total_time;
            futhark_mc_task_128712_task.task_iter = &ctx->program->futhark_mc_segred_task_128713_total_iter;
            futhark_mc_task_128712_task.sched = STATIC;
            futhark_mc_task_128712_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_128713_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128712_task);
            
            if (futhark_mc_segred_task_128713_err != 0) {
                err = futhark_mc_segred_task_128713_err;
                goto cleanup;
            }
            
            double defunc_0_reduce_res_120648;
            double defunc_res_120649;
            double defunc_res_120650;
            double defunc_res_120651;
            int64_t flat_tid_120705 = (int64_t) 0;
            
            defunc_0_reduce_res_120648 = 0.0;
            defunc_res_120649 = 0.0;
            defunc_res_120650 = 0.0;
            defunc_res_120651 = 0.0;
            
            int64_t flat_tid_120654 = (int64_t) 0;
            struct futhark_mc_task_128720 futhark_mc_task_128720_;
            
            futhark_mc_task_128720_.ctx = ctx;
            futhark_mc_task_128720_.free_m_33388 = m_33388;
            futhark_mc_task_128720_.free_rho1_33389 = rho1_33389;
            futhark_mc_task_128720_.free_rho2_33390 = rho2_33390;
            futhark_mc_task_128720_.free_eps_33391 = eps_33391;
            futhark_mc_task_128720_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
            futhark_mc_task_128720_.free_distrs_mem_111708 = distrs_mem_111708.mem;
            futhark_mc_task_128720_.free_mem_112403 = mem_112403.mem;
            futhark_mc_task_128720_.free_mem_112416 = mem_112416.mem;
            futhark_mc_task_128720_.free_mem_112421 = mem_112421.mem;
            futhark_mc_task_128720_.free_mem_112427 = mem_112427.mem;
            futhark_mc_task_128720_.free_mem_112431 = mem_112431.mem;
            futhark_mc_task_128720_.free_mem_param_118928 = mem_param_118928.mem;
            futhark_mc_task_128720_.free_sqrt_res_120360 = sqrt_res_120360;
            futhark_mc_task_128720_.free_zt_res_120579 = zt_res_120579;
            futhark_mc_task_128720_.free_zt_res_120580 = zt_res_120580;
            futhark_mc_task_128720_.free_gtid_120591 = gtid_120591;
            futhark_mc_task_128720_.free_x_120607 = x_120607;
            futhark_mc_task_128720_.free_log_res_120609 = log_res_120609;
            futhark_mc_task_128720_.free_fma_res_120613 = fma_res_120613;
            futhark_mc_task_128720_.free_mem_120614 = mem_120614;
            futhark_mc_task_128720_.free_defunc_0_reduce_res_120636 = defunc_0_reduce_res_120636;
            futhark_mc_task_128720_.free_flat_tid_120654 = flat_tid_120654;
            futhark_mc_task_128720_.free_flat_tid_120705 = flat_tid_120705;
            futhark_mc_task_128720_.retval_defunc_0_reduce_res_120648 = (double *) &defunc_0_reduce_res_120648;
            #if ISPC
            futhark_mc_task_128720_.retval_defunc_0_reduce_res_120648 += programIndex;
            #endif
            futhark_mc_task_128720_.retval_defunc_res_120649 = (double *) &defunc_res_120649;
            #if ISPC
            futhark_mc_task_128720_.retval_defunc_res_120649 += programIndex;
            #endif
            futhark_mc_task_128720_.retval_defunc_res_120650 = (double *) &defunc_res_120650;
            #if ISPC
            futhark_mc_task_128720_.retval_defunc_res_120650 += programIndex;
            #endif
            futhark_mc_task_128720_.retval_defunc_res_120651 = (double *) &defunc_res_120651;
            #if ISPC
            futhark_mc_task_128720_.retval_defunc_res_120651 += programIndex;
            #endif
            futhark_mc_task_128720_.retval_mem_120646 = mem_120646;
            futhark_mc_task_128720_.retval_mem_120647 = mem_120647;
            
            struct scheduler_segop futhark_mc_task_128720_task;
            
            futhark_mc_task_128720_task.args = &futhark_mc_task_128720_;
            futhark_mc_task_128720_task.top_level_fn = futhark_mc_segred_task_128721;
            futhark_mc_task_128720_task.name = "futhark_mc_segred_task_128721";
            futhark_mc_task_128720_task.iterations = m_33388;
            futhark_mc_task_128720_task.task_time = &ctx->program->futhark_mc_segred_task_128721_total_time;
            futhark_mc_task_128720_task.task_iter = &ctx->program->futhark_mc_segred_task_128721_total_iter;
            futhark_mc_task_128720_task.sched = STATIC;
            futhark_mc_task_128720_task.nested_fn = futhark_mc_segred_nested_task_128731;
            
            int futhark_mc_segred_task_128721_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128720_task);
            
            if (futhark_mc_segred_task_128721_err != 0) {
                err = futhark_mc_segred_task_128721_err;
                goto cleanup;
            }
            
            bool zeze_res_120754 = defunc_res_120651 == 0.0;
            double klu_res_120755;
            
            if (zeze_res_120754) {
                klu_res_120755 = 0.0;
            } else {
                double zs_res_120756 = defunc_res_120651 / x_120607;
                double log_res_120757 = futrts_log64(zs_res_120756);
                double zt_res_120758 = defunc_res_120651 * log_res_120757;
                
                klu_res_120755 = zt_res_120758;
            }
            // save map-out results
            {
                ((double *) mem_112463.mem)[gtid_120591] = defunc_res_120650;
                
                int64_t iterations_125629 = m_33388;
                struct futhark_mc_task_128749 futhark_mc_task_128749_;
                
                futhark_mc_task_128749_.ctx = ctx;
                futhark_mc_task_128749_.free_m_33388 = m_33388;
                futhark_mc_task_128749_.free_mem_112466 = mem_112466.mem;
                futhark_mc_task_128749_.free_gtid_120591 = gtid_120591;
                futhark_mc_task_128749_.free_mem_120646 = mem_120646;
                
                struct scheduler_segop futhark_mc_task_128749_task;
                
                futhark_mc_task_128749_task.args = &futhark_mc_task_128749_;
                futhark_mc_task_128749_task.top_level_fn = futhark_mc_copy_125628_task_128750;
                futhark_mc_task_128749_task.name = "futhark_mc_copy_125628_task_128750";
                futhark_mc_task_128749_task.iterations = iterations_125629;
                futhark_mc_task_128749_task.task_time = &ctx->program->futhark_mc_copy_125628_task_128750_total_time;
                futhark_mc_task_128749_task.task_iter = &ctx->program->futhark_mc_copy_125628_task_128750_total_iter;
                futhark_mc_task_128749_task.sched = STATIC;
                futhark_mc_task_128749_task.nested_fn = NULL;
                
                int futhark_mc_copy_125628_task_128750_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128749_task);
                
                if (futhark_mc_copy_125628_task_128750_err != 0) {
                    err = futhark_mc_copy_125628_task_128750_err;
                    goto cleanup;
                }
                
                int64_t iterations_125639 = m_33388;
                struct futhark_mc_task_128756 futhark_mc_task_128756_;
                
                futhark_mc_task_128756_.ctx = ctx;
                futhark_mc_task_128756_.free_m_33388 = m_33388;
                futhark_mc_task_128756_.free_mem_in_114669 = mem_in_114669.mem;
                futhark_mc_task_128756_.free_gtid_120591 = gtid_120591;
                futhark_mc_task_128756_.free_mem_120647 = mem_120647;
                
                struct scheduler_segop futhark_mc_task_128756_task;
                
                futhark_mc_task_128756_task.args = &futhark_mc_task_128756_;
                futhark_mc_task_128756_task.top_level_fn = futhark_mc_copy_125638_task_128757;
                futhark_mc_task_128756_task.name = "futhark_mc_copy_125638_task_128757";
                futhark_mc_task_128756_task.iterations = iterations_125639;
                futhark_mc_task_128756_task.task_time = &ctx->program->futhark_mc_copy_125638_task_128757_total_time;
                futhark_mc_task_128756_task.task_iter = &ctx->program->futhark_mc_copy_125638_task_128757_total_iter;
                futhark_mc_task_128756_task.sched = STATIC;
                futhark_mc_task_128756_task.nested_fn = NULL;
                
                int futhark_mc_copy_125638_task_128757_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128756_task);
                
                if (futhark_mc_copy_125638_task_128757_err != 0) {
                    err = futhark_mc_copy_125638_task_128757_err;
                    goto cleanup;
                }
            }
            // Load accum params
            {
                eta_p_120592 = local_acc_125436;
            }
            // Load next params
            {
                eta_p_120593 = defunc_0_reduce_res_120648;
            }
            // SegRed body
            {
                double zp_res_120594 = eta_p_120592 + eta_p_120593;
                
                local_acc_125436 = zp_res_120594;
            }
            // Load accum params
            {
                eta_p_120595 = local_acc_125437;
            }
            // Load next params
            {
                eta_p_120596 = klu_res_120755;
            }
            // SegRed body
            {
                double zp_res_120597 = eta_p_120595 + eta_p_120596;
                
                local_acc_125437 = zp_res_120597;
            }
            // Load accum params
            {
                eta_p_120598 = local_acc_125438;
            }
            // Load next params
            {
                eta_p_120599 = defunc_res_120651;
            }
            // SegRed body
            {
                double zp_res_120600 = eta_p_120598 + eta_p_120599;
                
                local_acc_125438 = zp_res_120600;
            }
            // Load accum params
            {
                eta_p_120601 = local_acc_125439;
            }
            // Load next params
            {
                eta_p_120602 = defunc_res_120649;
            }
            // SegRed body
            {
                double zp_res_120603 = eta_p_120601 + eta_p_120602;
                
                local_acc_125439 = zp_res_120603;
            }
            // Load accum params
            {
                eta_p_120604 = local_acc_125440;
            }
            // Load next params
            {
                eta_p_120605 = x_120607;
            }
            // SegRed body
            {
                double zp_res_120606 = eta_p_120604 + eta_p_120605;
                
                local_acc_125440 = zp_res_120606;
            }
        }
        
        int64_t uni_i_125640 = 0;
        
        {
            int64_t gtid_120591 = uni_i_125640;
            
            // Load accum params
            {
                eta_p_125416 = local_acc_125431;
            }
            // Load next params
            {
                eta_p_125417 = local_acc_125436;
            }
            // SegRed body
            {
                double zp_res_125418 = eta_p_125416 + eta_p_125417;
                
                local_acc_125431 = zp_res_125418;
            }
            // Load accum params
            {
                eta_p_125419 = local_acc_125432;
            }
            // Load next params
            {
                eta_p_125420 = local_acc_125437;
            }
            // SegRed body
            {
                double zp_res_125421 = eta_p_125419 + eta_p_125420;
                
                local_acc_125432 = zp_res_125421;
            }
            // Load accum params
            {
                eta_p_125422 = local_acc_125433;
            }
            // Load next params
            {
                eta_p_125423 = local_acc_125438;
            }
            // SegRed body
            {
                double zp_res_125424 = eta_p_125422 + eta_p_125423;
                
                local_acc_125433 = zp_res_125424;
            }
            // Load accum params
            {
                eta_p_125425 = local_acc_125434;
            }
            // Load next params
            {
                eta_p_125426 = local_acc_125439;
            }
            // SegRed body
            {
                double zp_res_125427 = eta_p_125425 + eta_p_125426;
                
                local_acc_125434 = zp_res_125427;
            }
            // Load accum params
            {
                eta_p_125428 = local_acc_125435;
            }
            // Load next params
            {
                eta_p_125429 = local_acc_125440;
            }
            // SegRed body
            {
                double zp_res_125430 = eta_p_125428 + eta_p_125429;
                
                local_acc_125435 = zp_res_125430;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_125406.mem)[flat_tid_120590] = local_acc_125431;
        ((double *) reduce_stage_1_tid_res_arr_mem_125408.mem)[flat_tid_120590] = local_acc_125432;
        ((double *) reduce_stage_1_tid_res_arr_mem_125410.mem)[flat_tid_120590] = local_acc_125433;
        ((double *) reduce_stage_1_tid_res_arr_mem_125412.mem)[flat_tid_120590] = local_acc_125434;
        ((double *) reduce_stage_1_tid_res_arr_mem_125414.mem)[flat_tid_120590] = local_acc_125435;
    }
    
  cleanup:
    {
        free(mem_120614);
        free(mem_120646);
        free(mem_120647);
    }
    if (event_128763 != NULL) {
        event_128763->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128687", strdup("nothing further"), event_128763, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_128680(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128665 *futhark_mc_task_128665 = (struct futhark_mc_task_128665 *) args;
    struct futhark_context *ctx = futhark_mc_task_128665->ctx;
    struct mc_event *event_128765 = mc_event_new(ctx);
    
    if (event_128765 != NULL)
        event_128765->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128665->free_m_33388;
    double rho1_33389 = futhark_mc_task_128665->free_rho1_33389;
    double rho2_33390 = futhark_mc_task_128665->free_rho2_33390;
    double eps_33391 = futhark_mc_task_128665->free_eps_33391;
    int64_t eta_p_106382 = futhark_mc_task_128665->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128665->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_128665->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128665->free_distrs_mem_111708, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_task_128665->free_bytes_111715;
    struct memblock mem_112403 = {.desc ="mem_112403", .mem =futhark_mc_task_128665->free_mem_112403, .size =0, .references =NULL};
    struct memblock mem_112416 = {.desc ="mem_112416", .mem =futhark_mc_task_128665->free_mem_112416, .size =0, .references =NULL};
    struct memblock mem_112421 = {.desc ="mem_112421", .mem =futhark_mc_task_128665->free_mem_112421, .size =0, .references =NULL};
    struct memblock mem_112423 = {.desc ="mem_112423", .mem =futhark_mc_task_128665->free_mem_112423, .size =0, .references =NULL};
    struct memblock mem_112425 = {.desc ="mem_112425", .mem =futhark_mc_task_128665->free_mem_112425, .size =0, .references =NULL};
    struct memblock mem_112427 = {.desc ="mem_112427", .mem =futhark_mc_task_128665->free_mem_112427, .size =0, .references =NULL};
    struct memblock mem_112431 = {.desc ="mem_112431", .mem =futhark_mc_task_128665->free_mem_112431, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_task_128665->free_mem_param_118928, .size =0, .references =NULL};
    double sqrt_res_120360 = futhark_mc_task_128665->free_sqrt_res_120360;
    double zt_res_120554 = futhark_mc_task_128665->free_zt_res_120554;
    double zt_res_120555 = futhark_mc_task_128665->free_zt_res_120555;
    double zt_res_120579 = futhark_mc_task_128665->free_zt_res_120579;
    double zt_res_120580 = futhark_mc_task_128665->free_zt_res_120580;
    int64_t flat_tid_120590 = futhark_mc_task_128665->free_flat_tid_120590;
    int64_t flat_tid_120759 = futhark_mc_task_128665->free_flat_tid_120759;
    double defunc_res_120582 = *futhark_mc_task_128665->retval_defunc_res_120582;
    double defunc_res_120583 = *futhark_mc_task_128665->retval_defunc_res_120583;
    double defunc_res_120584 = *futhark_mc_task_128665->retval_defunc_res_120584;
    double defunc_res_120585 = *futhark_mc_task_128665->retval_defunc_res_120585;
    double defunc_res_120586 = *futhark_mc_task_128665->retval_defunc_res_120586;
    struct memblock mem_112463 = {.desc ="mem_112463", .mem =futhark_mc_task_128665->retval_mem_112463, .size =0, .references =NULL};
    struct memblock mem_112466 = {.desc ="mem_112466", .mem =futhark_mc_task_128665->retval_mem_112466, .size =0, .references =NULL};
    struct memblock mem_in_114669 = {.desc ="mem_in_114669", .mem =futhark_mc_task_128665->retval_mem_in_114669, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_125406_cached_sizze_128681 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125406 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_125408_cached_sizze_128682 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125408 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_125410_cached_sizze_128683 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125410 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_125412_cached_sizze_128684 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125412 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_125414_cached_sizze_128685 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125414 = NULL;
    int32_t nsubtasks_125405;
    
    nsubtasks_125405 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_125406_cached_sizze_128681 < (int64_t) 8 * nsubtasks_125405) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125406, &reduce_stage_1_tid_res_arr_mem_125406_cached_sizze_128681, (int64_t) 8 * nsubtasks_125405);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_125408_cached_sizze_128682 < (int64_t) 8 * nsubtasks_125405) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125408, &reduce_stage_1_tid_res_arr_mem_125408_cached_sizze_128682, (int64_t) 8 * nsubtasks_125405);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_125410_cached_sizze_128683 < (int64_t) 8 * nsubtasks_125405) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125410, &reduce_stage_1_tid_res_arr_mem_125410_cached_sizze_128683, (int64_t) 8 * nsubtasks_125405);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_125412_cached_sizze_128684 < (int64_t) 8 * nsubtasks_125405) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125412, &reduce_stage_1_tid_res_arr_mem_125412_cached_sizze_128684, (int64_t) 8 * nsubtasks_125405);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_125414_cached_sizze_128685 < (int64_t) 8 * nsubtasks_125405) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125414, &reduce_stage_1_tid_res_arr_mem_125414_cached_sizze_128685, (int64_t) 8 * nsubtasks_125405);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128686 futhark_mc_segred_stage_1_parloop_struct_128686_;
    
    futhark_mc_segred_stage_1_parloop_struct_128686_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128686_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128686_.free_rho1_33389 = rho1_33389;
    futhark_mc_segred_stage_1_parloop_struct_128686_.free_rho2_33390 = rho2_33390;
    futhark_mc_segred_stage_1_parloop_struct_128686_.free_eps_33391 = eps_33391;
    futhark_mc_segred_stage_1_parloop_struct_128686_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_128686_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128686_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_128686_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_128686_.free_bytes_111715 = bytes_111715;
    futhark_mc_segred_stage_1_parloop_struct_128686_.free_mem_112403 = mem_112403.mem;
    futhark_mc_segred_stage_1_parloop_struct_128686_.free_mem_112416 = mem_112416.mem;
    futhark_mc_segred_stage_1_parloop_struct_128686_.free_mem_112421 = mem_112421.mem;
    futhark_mc_segred_stage_1_parloop_struct_128686_.free_mem_112423 = mem_112423.mem;
    futhark_mc_segred_stage_1_parloop_struct_128686_.free_mem_112425 = mem_112425.mem;
    futhark_mc_segred_stage_1_parloop_struct_128686_.free_mem_112427 = mem_112427.mem;
    futhark_mc_segred_stage_1_parloop_struct_128686_.free_mem_112431 = mem_112431.mem;
    futhark_mc_segred_stage_1_parloop_struct_128686_.free_mem_112463 = mem_112463.mem;
    futhark_mc_segred_stage_1_parloop_struct_128686_.free_mem_112466 = mem_112466.mem;
    futhark_mc_segred_stage_1_parloop_struct_128686_.free_mem_in_114669 = mem_in_114669.mem;
    futhark_mc_segred_stage_1_parloop_struct_128686_.free_mem_param_118928 = mem_param_118928.mem;
    futhark_mc_segred_stage_1_parloop_struct_128686_.free_sqrt_res_120360 = sqrt_res_120360;
    futhark_mc_segred_stage_1_parloop_struct_128686_.free_zt_res_120554 = zt_res_120554;
    futhark_mc_segred_stage_1_parloop_struct_128686_.free_zt_res_120555 = zt_res_120555;
    futhark_mc_segred_stage_1_parloop_struct_128686_.free_zt_res_120579 = zt_res_120579;
    futhark_mc_segred_stage_1_parloop_struct_128686_.free_zt_res_120580 = zt_res_120580;
    futhark_mc_segred_stage_1_parloop_struct_128686_.free_reduce_stage_1_tid_res_arr_mem_125406 = reduce_stage_1_tid_res_arr_mem_125406;
    futhark_mc_segred_stage_1_parloop_struct_128686_.free_reduce_stage_1_tid_res_arr_mem_125408 = reduce_stage_1_tid_res_arr_mem_125408;
    futhark_mc_segred_stage_1_parloop_struct_128686_.free_reduce_stage_1_tid_res_arr_mem_125410 = reduce_stage_1_tid_res_arr_mem_125410;
    futhark_mc_segred_stage_1_parloop_struct_128686_.free_reduce_stage_1_tid_res_arr_mem_125412 = reduce_stage_1_tid_res_arr_mem_125412;
    futhark_mc_segred_stage_1_parloop_struct_128686_.free_reduce_stage_1_tid_res_arr_mem_125414 = reduce_stage_1_tid_res_arr_mem_125414;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128687_task;
    
    futhark_mc_segred_stage_1_parloop_128687_task.name = "futhark_mc_segred_stage_1_parloop_128687";
    futhark_mc_segred_stage_1_parloop_128687_task.fn = futhark_mc_segred_stage_1_parloop_128687;
    futhark_mc_segred_stage_1_parloop_128687_task.args = &futhark_mc_segred_stage_1_parloop_struct_128686_;
    futhark_mc_segred_stage_1_parloop_128687_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128687_task.info = info;
    
    struct mc_event *event_128764 = mc_event_new(ctx);
    
    if (event_128764 != NULL)
        event_128764->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128687_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128687_task);
    
    if (futhark_mc_segred_stage_1_parloop_128687_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128687_err;
        goto cleanup;
    }
    if (event_128764 != NULL) {
        event_128764->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128687_total", strdup("nothing further"), event_128764, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_120582 = 0.0;
        defunc_res_120583 = 0.0;
        defunc_res_120584 = 0.0;
        defunc_res_120585 = 0.0;
        defunc_res_120586 = 0.0;
    }
    
    double eta_p_125641;
    double eta_p_125642;
    double eta_p_125644;
    double eta_p_125645;
    double eta_p_125647;
    double eta_p_125648;
    double eta_p_125650;
    double eta_p_125651;
    double eta_p_125653;
    double eta_p_125654;
    
    for (int32_t i_125656 = 0; i_125656 < nsubtasks_125405; i_125656++) {
        flat_tid_120590 = i_125656;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_125641 = defunc_res_120582;
            }
            // load next params
            {
                eta_p_125642 = ((double *) reduce_stage_1_tid_res_arr_mem_125406)[flat_tid_120590];
            }
            // red body
            {
                double zp_res_125643 = eta_p_125641 + eta_p_125642;
                
                defunc_res_120582 = zp_res_125643;
            }
            // load acc params
            {
                eta_p_125644 = defunc_res_120583;
            }
            // load next params
            {
                eta_p_125645 = ((double *) reduce_stage_1_tid_res_arr_mem_125408)[flat_tid_120590];
            }
            // red body
            {
                double zp_res_125646 = eta_p_125644 + eta_p_125645;
                
                defunc_res_120583 = zp_res_125646;
            }
            // load acc params
            {
                eta_p_125647 = defunc_res_120584;
            }
            // load next params
            {
                eta_p_125648 = ((double *) reduce_stage_1_tid_res_arr_mem_125410)[flat_tid_120590];
            }
            // red body
            {
                double zp_res_125649 = eta_p_125647 + eta_p_125648;
                
                defunc_res_120584 = zp_res_125649;
            }
            // load acc params
            {
                eta_p_125650 = defunc_res_120585;
            }
            // load next params
            {
                eta_p_125651 = ((double *) reduce_stage_1_tid_res_arr_mem_125412)[flat_tid_120590];
            }
            // red body
            {
                double zp_res_125652 = eta_p_125650 + eta_p_125651;
                
                defunc_res_120585 = zp_res_125652;
            }
            // load acc params
            {
                eta_p_125653 = defunc_res_120586;
            }
            // load next params
            {
                eta_p_125654 = ((double *) reduce_stage_1_tid_res_arr_mem_125414)[flat_tid_120590];
            }
            // red body
            {
                double zp_res_125655 = eta_p_125653 + eta_p_125654;
                
                defunc_res_120586 = zp_res_125655;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_125406);
        free(reduce_stage_1_tid_res_arr_mem_125408);
        free(reduce_stage_1_tid_res_arr_mem_125410);
        free(reduce_stage_1_tid_res_arr_mem_125412);
        free(reduce_stage_1_tid_res_arr_mem_125414);
    }
    if (event_128765 != NULL) {
        event_128765->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_128680", strdup("nothing further"), event_128765, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128665->retval_defunc_res_120582 = defunc_res_120582;
        *futhark_mc_task_128665->retval_defunc_res_120583 = defunc_res_120583;
        *futhark_mc_task_128665->retval_defunc_res_120584 = defunc_res_120584;
        *futhark_mc_task_128665->retval_defunc_res_120585 = defunc_res_120585;
        *futhark_mc_task_128665->retval_defunc_res_120586 = defunc_res_120586;
        futhark_mc_task_128665->retval_mem_112463 = mem_112463.mem;
        futhark_mc_task_128665->retval_mem_112466 = mem_112466.mem;
        futhark_mc_task_128665->retval_mem_in_114669 = mem_in_114669.mem;
    }
    return err;
}
struct futhark_mc_task_128766 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_112466;
    int64_t free_flat_tid_120871;
    int64_t free_flat_tid_120893;
    double *retval_defunc_res_120869;
    unsigned char *retval_mem_112471;
};
struct futhark_mc_segred_stage_1_parloop_struct_128769 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_112466;
    unsigned char *free_mem_112471;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125658;
};
static int futhark_mc_segred_stage_1_parloop_128770(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128769 *futhark_mc_segred_stage_1_parloop_struct_128769 = (struct futhark_mc_segred_stage_1_parloop_struct_128769 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128769->ctx;
    struct mc_event *event_128771 = mc_event_new(ctx);
    
    if (event_128771 != NULL)
        event_128771->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128769->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128769->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_128769->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112466 = {.desc ="mem_112466", .mem =futhark_mc_segred_stage_1_parloop_struct_128769->free_mem_112466, .size =0, .references =NULL};
    struct memblock mem_112471 = {.desc ="mem_112471", .mem =futhark_mc_segred_stage_1_parloop_struct_128769->free_mem_112471, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125658 = {.desc ="reduce_stage_1_tid_res_arr_mem_125658", .mem =futhark_mc_segred_stage_1_parloop_struct_128769->free_reduce_stage_1_tid_res_arr_mem_125658, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_120893;
    
    flat_tid_120893 = subtask_id;
    {
        double eta_p_125660;
        double eta_p_125661;
        double local_acc_125663 = 0.0;
        double eta_p_120895;
        double eta_p_120896;
        double local_acc_125664 = 0.0;
        int64_t start_125665;
        int64_t end_125666;
        
        start_125665 = start;
        end_125666 = end;
        
        int64_t n_125667 = end_125666 - start_125665;
        
        for (int64_t SegRed_i_125668 = start_125665; SegRed_i_125668 < start_125665 + n_125667; SegRed_i_125668++) {
            int64_t gtid_120894 = SegRed_i_125668;
            double defunc_res_120898;
            double defunc_res_120899;
            double redout_120901;
            double redout_120902;
            
            redout_120901 = 0.0;
            redout_120902 = 0.0;
            for (int64_t i_120900 = 0; i_120900 < m_33388; i_120900++) {
                double x_120903 = ((double *) mem_112466.mem)[i_120900 * m_33388 + gtid_120894];
                double zp_res_120904 = x_120903 + redout_120901;
                double zp_res_120905 = x_120903 + redout_120902;
                double redout_tmp_125669 = zp_res_120904;
                double redout_tmp_125670 = zp_res_120905;
                
                redout_120901 = redout_tmp_125669;
                redout_120902 = redout_tmp_125670;
            }
            defunc_res_120898 = redout_120901;
            defunc_res_120899 = redout_120902;
            
            bool zeze_res_120906 = defunc_res_120899 == 0.0;
            double klu_res_120907;
            
            if (zeze_res_120906) {
                klu_res_120907 = 0.0;
            } else {
                double eta_p_120908 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + gtid_120894];
                double zs_res_120909 = defunc_res_120899 / eta_p_120908;
                double log_res_120910 = futrts_log64(zs_res_120909);
                double zt_res_120911 = defunc_res_120899 * log_res_120910;
                
                klu_res_120907 = zt_res_120911;
            }
            // save map-out results
            {
                ((double *) mem_112471.mem)[gtid_120894] = defunc_res_120898;
            }
            // Load accum params
            {
                eta_p_120895 = local_acc_125664;
            }
            // Load next params
            {
                eta_p_120896 = klu_res_120907;
            }
            // SegRed body
            {
                double zp_res_120897 = eta_p_120895 + eta_p_120896;
                
                local_acc_125664 = zp_res_120897;
            }
        }
        
        int64_t uni_i_125671 = 0;
        
        {
            int64_t gtid_120894 = uni_i_125671;
            
            // Load accum params
            {
                eta_p_125660 = local_acc_125663;
            }
            // Load next params
            {
                eta_p_125661 = local_acc_125664;
            }
            // SegRed body
            {
                double zp_res_125662 = eta_p_125660 + eta_p_125661;
                
                local_acc_125663 = zp_res_125662;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_125658.mem)[flat_tid_120893] = local_acc_125663;
    }
    
  cleanup:
    { }
    if (event_128771 != NULL) {
        event_128771->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128770", strdup("nothing further"), event_128771, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128767(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128766 *futhark_mc_task_128766 = (struct futhark_mc_task_128766 *) args;
    struct futhark_context *ctx = futhark_mc_task_128766->ctx;
    struct mc_event *event_128773 = mc_event_new(ctx);
    
    if (event_128773 != NULL)
        event_128773->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128766->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128766->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128766->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112466 = {.desc ="mem_112466", .mem =futhark_mc_task_128766->free_mem_112466, .size =0, .references =NULL};
    int64_t flat_tid_120871 = futhark_mc_task_128766->free_flat_tid_120871;
    int64_t flat_tid_120893 = futhark_mc_task_128766->free_flat_tid_120893;
    double defunc_res_120869 = *futhark_mc_task_128766->retval_defunc_res_120869;
    struct memblock mem_112471 = {.desc ="mem_112471", .mem =futhark_mc_task_128766->retval_mem_112471, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_125658_cached_sizze_128768 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125658 = NULL;
    int32_t nsubtasks_125657;
    
    nsubtasks_125657 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_125658_cached_sizze_128768 < (int64_t) 8 * nsubtasks_125657) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125658, &reduce_stage_1_tid_res_arr_mem_125658_cached_sizze_128768, (int64_t) 8 * nsubtasks_125657);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128769 futhark_mc_segred_stage_1_parloop_struct_128769_;
    
    futhark_mc_segred_stage_1_parloop_struct_128769_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128769_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128769_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128769_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_128769_.free_mem_112466 = mem_112466.mem;
    futhark_mc_segred_stage_1_parloop_struct_128769_.free_mem_112471 = mem_112471.mem;
    futhark_mc_segred_stage_1_parloop_struct_128769_.free_reduce_stage_1_tid_res_arr_mem_125658 = reduce_stage_1_tid_res_arr_mem_125658;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128770_task;
    
    futhark_mc_segred_stage_1_parloop_128770_task.name = "futhark_mc_segred_stage_1_parloop_128770";
    futhark_mc_segred_stage_1_parloop_128770_task.fn = futhark_mc_segred_stage_1_parloop_128770;
    futhark_mc_segred_stage_1_parloop_128770_task.args = &futhark_mc_segred_stage_1_parloop_struct_128769_;
    futhark_mc_segred_stage_1_parloop_128770_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128770_task.info = info;
    
    struct mc_event *event_128772 = mc_event_new(ctx);
    
    if (event_128772 != NULL)
        event_128772->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128770_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128770_task);
    
    if (futhark_mc_segred_stage_1_parloop_128770_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128770_err;
        goto cleanup;
    }
    if (event_128772 != NULL) {
        event_128772->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128770_total", strdup("nothing further"), event_128772, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_120869 = 0.0;
    }
    
    double eta_p_125672;
    double eta_p_125673;
    
    for (int32_t i_125675 = 0; i_125675 < nsubtasks_125657; i_125675++) {
        flat_tid_120893 = i_125675;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_125672 = defunc_res_120869;
            }
            // load next params
            {
                eta_p_125673 = ((double *) reduce_stage_1_tid_res_arr_mem_125658)[flat_tid_120893];
            }
            // red body
            {
                double zp_res_125674 = eta_p_125672 + eta_p_125673;
                
                defunc_res_120869 = zp_res_125674;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_125658);
    }
    if (event_128773 != NULL) {
        event_128773->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128767", strdup("nothing further"), event_128773, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128766->retval_defunc_res_120869 = defunc_res_120869;
        futhark_mc_task_128766->retval_mem_112471 = mem_112471.mem;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_128776 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_112466;
    unsigned char *free_mem_112471;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125677;
};
struct futhark_mc_task_128778 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_112466;
    int64_t free_gtid_120872;
    int64_t free_flat_tid_120878;
    double *retval_defunc_res_120876;
    double *retval_defunc_res_120877;
};
struct futhark_mc_segred_stage_1_parloop_struct_128782 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_112466;
    int64_t free_gtid_120872;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125689;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125691;
};
static int futhark_mc_segred_stage_1_parloop_128783(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128782 *futhark_mc_segred_stage_1_parloop_struct_128782 = (struct futhark_mc_segred_stage_1_parloop_struct_128782 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128782->ctx;
    struct mc_event *event_128784 = mc_event_new(ctx);
    
    if (event_128784 != NULL)
        event_128784->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128782->free_m_33388;
    struct memblock mem_112466 = {.desc ="mem_112466", .mem =futhark_mc_segred_stage_1_parloop_struct_128782->free_mem_112466, .size =0, .references =NULL};
    int64_t gtid_120872 = futhark_mc_segred_stage_1_parloop_struct_128782->free_gtid_120872;
    struct memblock reduce_stage_1_tid_res_arr_mem_125689 = {.desc ="reduce_stage_1_tid_res_arr_mem_125689", .mem =futhark_mc_segred_stage_1_parloop_struct_128782->free_reduce_stage_1_tid_res_arr_mem_125689, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125691 = {.desc ="reduce_stage_1_tid_res_arr_mem_125691", .mem =futhark_mc_segred_stage_1_parloop_struct_128782->free_reduce_stage_1_tid_res_arr_mem_125691, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_120878;
    
    flat_tid_120878 = subtask_id;
    {
        double eta_p_125693;
        double eta_p_125694;
        double eta_p_125696;
        double eta_p_125697;
        double local_acc_125699 = 0.0;
        double local_acc_125700 = 0.0;
        double eta_p_120880;
        double eta_p_120881;
        double eta_p_120883;
        double eta_p_120884;
        double local_acc_125701 = 0.0;
        double local_acc_125702 = 0.0;
        int64_t start_125703;
        int64_t end_125704;
        
        start_125703 = start;
        end_125704 = end;
        
        int64_t n_125705 = end_125704 - start_125703;
        
        for (int64_t SegRed_i_125706 = start_125703; SegRed_i_125706 < start_125703 + n_125705; SegRed_i_125706++) {
            int64_t gtid_120879 = SegRed_i_125706;
            double x_120886 = ((double *) mem_112466.mem)[gtid_120879 * m_33388 + gtid_120872];
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_120880 = local_acc_125701;
            }
            // Load next params
            {
                eta_p_120881 = x_120886;
            }
            // SegRed body
            {
                double zp_res_120882 = eta_p_120880 + eta_p_120881;
                
                local_acc_125701 = zp_res_120882;
            }
            // Load accum params
            {
                eta_p_120883 = local_acc_125702;
            }
            // Load next params
            {
                eta_p_120884 = x_120886;
            }
            // SegRed body
            {
                double zp_res_120885 = eta_p_120883 + eta_p_120884;
                
                local_acc_125702 = zp_res_120885;
            }
        }
        
        int64_t uni_i_125707 = 0;
        
        {
            int64_t gtid_120879 = uni_i_125707;
            
            // Load accum params
            {
                eta_p_125693 = local_acc_125699;
            }
            // Load next params
            {
                eta_p_125694 = local_acc_125701;
            }
            // SegRed body
            {
                double zp_res_125695 = eta_p_125693 + eta_p_125694;
                
                local_acc_125699 = zp_res_125695;
            }
            // Load accum params
            {
                eta_p_125696 = local_acc_125700;
            }
            // Load next params
            {
                eta_p_125697 = local_acc_125702;
            }
            // SegRed body
            {
                double zp_res_125698 = eta_p_125696 + eta_p_125697;
                
                local_acc_125700 = zp_res_125698;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_125689.mem)[flat_tid_120878] = local_acc_125699;
        ((double *) reduce_stage_1_tid_res_arr_mem_125691.mem)[flat_tid_120878] = local_acc_125700;
    }
    
  cleanup:
    { }
    if (event_128784 != NULL) {
        event_128784->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128783", strdup("nothing further"), event_128784, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128779(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128778 *futhark_mc_task_128778 = (struct futhark_mc_task_128778 *) args;
    struct futhark_context *ctx = futhark_mc_task_128778->ctx;
    struct mc_event *event_128786 = mc_event_new(ctx);
    
    if (event_128786 != NULL)
        event_128786->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128778->free_m_33388;
    struct memblock mem_112466 = {.desc ="mem_112466", .mem =futhark_mc_task_128778->free_mem_112466, .size =0, .references =NULL};
    int64_t gtid_120872 = futhark_mc_task_128778->free_gtid_120872;
    int64_t flat_tid_120878 = futhark_mc_task_128778->free_flat_tid_120878;
    double defunc_res_120876 = *futhark_mc_task_128778->retval_defunc_res_120876;
    double defunc_res_120877 = *futhark_mc_task_128778->retval_defunc_res_120877;
    int64_t reduce_stage_1_tid_res_arr_mem_125689_cached_sizze_128780 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125689 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_125691_cached_sizze_128781 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125691 = NULL;
    int32_t nsubtasks_125688;
    
    nsubtasks_125688 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_125689_cached_sizze_128780 < (int64_t) 8 * nsubtasks_125688) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125689, &reduce_stage_1_tid_res_arr_mem_125689_cached_sizze_128780, (int64_t) 8 * nsubtasks_125688);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_125691_cached_sizze_128781 < (int64_t) 8 * nsubtasks_125688) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125691, &reduce_stage_1_tid_res_arr_mem_125691_cached_sizze_128781, (int64_t) 8 * nsubtasks_125688);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128782 futhark_mc_segred_stage_1_parloop_struct_128782_;
    
    futhark_mc_segred_stage_1_parloop_struct_128782_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128782_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128782_.free_mem_112466 = mem_112466.mem;
    futhark_mc_segred_stage_1_parloop_struct_128782_.free_gtid_120872 = gtid_120872;
    futhark_mc_segred_stage_1_parloop_struct_128782_.free_reduce_stage_1_tid_res_arr_mem_125689 = reduce_stage_1_tid_res_arr_mem_125689;
    futhark_mc_segred_stage_1_parloop_struct_128782_.free_reduce_stage_1_tid_res_arr_mem_125691 = reduce_stage_1_tid_res_arr_mem_125691;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128783_task;
    
    futhark_mc_segred_stage_1_parloop_128783_task.name = "futhark_mc_segred_stage_1_parloop_128783";
    futhark_mc_segred_stage_1_parloop_128783_task.fn = futhark_mc_segred_stage_1_parloop_128783;
    futhark_mc_segred_stage_1_parloop_128783_task.args = &futhark_mc_segred_stage_1_parloop_struct_128782_;
    futhark_mc_segred_stage_1_parloop_128783_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128783_task.info = info;
    
    struct mc_event *event_128785 = mc_event_new(ctx);
    
    if (event_128785 != NULL)
        event_128785->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128783_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128783_task);
    
    if (futhark_mc_segred_stage_1_parloop_128783_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128783_err;
        goto cleanup;
    }
    if (event_128785 != NULL) {
        event_128785->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128783_total", strdup("nothing further"), event_128785, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_120876 = 0.0;
        defunc_res_120877 = 0.0;
    }
    
    double eta_p_125708;
    double eta_p_125709;
    double eta_p_125711;
    double eta_p_125712;
    
    for (int32_t i_125714 = 0; i_125714 < nsubtasks_125688; i_125714++) {
        flat_tid_120878 = i_125714;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_125708 = defunc_res_120876;
            }
            // load next params
            {
                eta_p_125709 = ((double *) reduce_stage_1_tid_res_arr_mem_125689)[flat_tid_120878];
            }
            // red body
            {
                double zp_res_125710 = eta_p_125708 + eta_p_125709;
                
                defunc_res_120876 = zp_res_125710;
            }
            // load acc params
            {
                eta_p_125711 = defunc_res_120877;
            }
            // load next params
            {
                eta_p_125712 = ((double *) reduce_stage_1_tid_res_arr_mem_125691)[flat_tid_120878];
            }
            // red body
            {
                double zp_res_125713 = eta_p_125711 + eta_p_125712;
                
                defunc_res_120877 = zp_res_125713;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_125689);
        free(reduce_stage_1_tid_res_arr_mem_125691);
    }
    if (event_128786 != NULL) {
        event_128786->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128779", strdup("nothing further"), event_128786, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128778->retval_defunc_res_120876 = defunc_res_120876;
        *futhark_mc_task_128778->retval_defunc_res_120877 = defunc_res_120877;
    }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_128777(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128776 *futhark_mc_segred_stage_1_parloop_struct_128776 = (struct futhark_mc_segred_stage_1_parloop_struct_128776 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128776->ctx;
    struct mc_event *event_128787 = mc_event_new(ctx);
    
    if (event_128787 != NULL)
        event_128787->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128776->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128776->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_128776->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112466 = {.desc ="mem_112466", .mem =futhark_mc_segred_stage_1_parloop_struct_128776->free_mem_112466, .size =0, .references =NULL};
    struct memblock mem_112471 = {.desc ="mem_112471", .mem =futhark_mc_segred_stage_1_parloop_struct_128776->free_mem_112471, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125677 = {.desc ="reduce_stage_1_tid_res_arr_mem_125677", .mem =futhark_mc_segred_stage_1_parloop_struct_128776->free_reduce_stage_1_tid_res_arr_mem_125677, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_120871;
    
    flat_tid_120871 = subtask_id;
    {
        double eta_p_125679;
        double eta_p_125680;
        double local_acc_125682 = 0.0;
        double eta_p_120873;
        double eta_p_120874;
        double local_acc_125683 = 0.0;
        int64_t start_125684;
        int64_t end_125685;
        
        start_125684 = start;
        end_125685 = end;
        
        int64_t n_125686 = end_125685 - start_125684;
        
        for (int64_t SegRed_i_125687 = start_125684; SegRed_i_125687 < start_125684 + n_125686; SegRed_i_125687++) {
            int64_t gtid_120872 = SegRed_i_125687;
            double defunc_res_120876;
            double defunc_res_120877;
            int64_t flat_tid_120878 = (int64_t) 0;
            
            defunc_res_120876 = 0.0;
            defunc_res_120877 = 0.0;
            
            struct futhark_mc_task_128778 futhark_mc_task_128778_;
            
            futhark_mc_task_128778_.ctx = ctx;
            futhark_mc_task_128778_.free_m_33388 = m_33388;
            futhark_mc_task_128778_.free_mem_112466 = mem_112466.mem;
            futhark_mc_task_128778_.free_gtid_120872 = gtid_120872;
            futhark_mc_task_128778_.free_flat_tid_120878 = flat_tid_120878;
            futhark_mc_task_128778_.retval_defunc_res_120876 = (double *) &defunc_res_120876;
            #if ISPC
            futhark_mc_task_128778_.retval_defunc_res_120876 += programIndex;
            #endif
            futhark_mc_task_128778_.retval_defunc_res_120877 = (double *) &defunc_res_120877;
            #if ISPC
            futhark_mc_task_128778_.retval_defunc_res_120877 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_128778_task;
            
            futhark_mc_task_128778_task.args = &futhark_mc_task_128778_;
            futhark_mc_task_128778_task.top_level_fn = futhark_mc_segred_task_128779;
            futhark_mc_task_128778_task.name = "futhark_mc_segred_task_128779";
            futhark_mc_task_128778_task.iterations = m_33388;
            futhark_mc_task_128778_task.task_time = &ctx->program->futhark_mc_segred_task_128779_total_time;
            futhark_mc_task_128778_task.task_iter = &ctx->program->futhark_mc_segred_task_128779_total_iter;
            futhark_mc_task_128778_task.sched = STATIC;
            futhark_mc_task_128778_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_128779_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128778_task);
            
            if (futhark_mc_segred_task_128779_err != 0) {
                err = futhark_mc_segred_task_128779_err;
                goto cleanup;
            }
            
            bool zeze_res_120887 = defunc_res_120877 == 0.0;
            double klu_res_120888;
            
            if (zeze_res_120887) {
                klu_res_120888 = 0.0;
            } else {
                double eta_p_120889 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + gtid_120872];
                double zs_res_120890 = defunc_res_120877 / eta_p_120889;
                double log_res_120891 = futrts_log64(zs_res_120890);
                double zt_res_120892 = defunc_res_120877 * log_res_120891;
                
                klu_res_120888 = zt_res_120892;
            }
            // save map-out results
            {
                ((double *) mem_112471.mem)[gtid_120872] = defunc_res_120876;
            }
            // Load accum params
            {
                eta_p_120873 = local_acc_125683;
            }
            // Load next params
            {
                eta_p_120874 = klu_res_120888;
            }
            // SegRed body
            {
                double zp_res_120875 = eta_p_120873 + eta_p_120874;
                
                local_acc_125683 = zp_res_120875;
            }
        }
        
        int64_t uni_i_125715 = 0;
        
        {
            int64_t gtid_120872 = uni_i_125715;
            
            // Load accum params
            {
                eta_p_125679 = local_acc_125682;
            }
            // Load next params
            {
                eta_p_125680 = local_acc_125683;
            }
            // SegRed body
            {
                double zp_res_125681 = eta_p_125679 + eta_p_125680;
                
                local_acc_125682 = zp_res_125681;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_125677.mem)[flat_tid_120871] = local_acc_125682;
    }
    
  cleanup:
    { }
    if (event_128787 != NULL) {
        event_128787->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128777", strdup("nothing further"), event_128787, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_128774(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128766 *futhark_mc_task_128766 = (struct futhark_mc_task_128766 *) args;
    struct futhark_context *ctx = futhark_mc_task_128766->ctx;
    struct mc_event *event_128789 = mc_event_new(ctx);
    
    if (event_128789 != NULL)
        event_128789->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128766->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128766->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128766->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112466 = {.desc ="mem_112466", .mem =futhark_mc_task_128766->free_mem_112466, .size =0, .references =NULL};
    int64_t flat_tid_120871 = futhark_mc_task_128766->free_flat_tid_120871;
    int64_t flat_tid_120893 = futhark_mc_task_128766->free_flat_tid_120893;
    double defunc_res_120869 = *futhark_mc_task_128766->retval_defunc_res_120869;
    struct memblock mem_112471 = {.desc ="mem_112471", .mem =futhark_mc_task_128766->retval_mem_112471, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_125677_cached_sizze_128775 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125677 = NULL;
    int32_t nsubtasks_125676;
    
    nsubtasks_125676 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_125677_cached_sizze_128775 < (int64_t) 8 * nsubtasks_125676) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125677, &reduce_stage_1_tid_res_arr_mem_125677_cached_sizze_128775, (int64_t) 8 * nsubtasks_125676);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128776 futhark_mc_segred_stage_1_parloop_struct_128776_;
    
    futhark_mc_segred_stage_1_parloop_struct_128776_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128776_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128776_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128776_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_128776_.free_mem_112466 = mem_112466.mem;
    futhark_mc_segred_stage_1_parloop_struct_128776_.free_mem_112471 = mem_112471.mem;
    futhark_mc_segred_stage_1_parloop_struct_128776_.free_reduce_stage_1_tid_res_arr_mem_125677 = reduce_stage_1_tid_res_arr_mem_125677;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128777_task;
    
    futhark_mc_segred_stage_1_parloop_128777_task.name = "futhark_mc_segred_stage_1_parloop_128777";
    futhark_mc_segred_stage_1_parloop_128777_task.fn = futhark_mc_segred_stage_1_parloop_128777;
    futhark_mc_segred_stage_1_parloop_128777_task.args = &futhark_mc_segred_stage_1_parloop_struct_128776_;
    futhark_mc_segred_stage_1_parloop_128777_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128777_task.info = info;
    
    struct mc_event *event_128788 = mc_event_new(ctx);
    
    if (event_128788 != NULL)
        event_128788->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128777_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128777_task);
    
    if (futhark_mc_segred_stage_1_parloop_128777_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128777_err;
        goto cleanup;
    }
    if (event_128788 != NULL) {
        event_128788->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128777_total", strdup("nothing further"), event_128788, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_120869 = 0.0;
    }
    
    double eta_p_125716;
    double eta_p_125717;
    
    for (int32_t i_125719 = 0; i_125719 < nsubtasks_125676; i_125719++) {
        flat_tid_120871 = i_125719;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_125716 = defunc_res_120869;
            }
            // load next params
            {
                eta_p_125717 = ((double *) reduce_stage_1_tid_res_arr_mem_125677)[flat_tid_120871];
            }
            // red body
            {
                double zp_res_125718 = eta_p_125716 + eta_p_125717;
                
                defunc_res_120869 = zp_res_125718;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_125677);
    }
    if (event_128789 != NULL) {
        event_128789->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_128774", strdup("nothing further"), event_128789, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128766->retval_defunc_res_120869 = defunc_res_120869;
        futhark_mc_task_128766->retval_mem_112471 = mem_112471.mem;
    }
    return err;
}
struct futhark_mc_task_128790 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    int64_t free_bytes_111715;
    unsigned char *free_mem_112431;
    unsigned char *free_mem_112463;
    unsigned char *free_mem_112466;
    int64_t free_flat_tid_120914;
    int64_t free_flat_tid_120987;
    double *retval_defunc_0_reduce_res_120912;
    double *retval_defunc_res_120913;
};
struct futhark_mc_segred_stage_1_parloop_struct_128794 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    int64_t free_bytes_111715;
    unsigned char *free_mem_112431;
    unsigned char *free_mem_112463;
    unsigned char *free_mem_112466;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125721;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125723;
};
static int futhark_mc_segred_stage_1_parloop_128795(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128794 *futhark_mc_segred_stage_1_parloop_struct_128794 = (struct futhark_mc_segred_stage_1_parloop_struct_128794 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128794->ctx;
    struct mc_event *event_128797 = mc_event_new(ctx);
    
    if (event_128797 != NULL)
        event_128797->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128794->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_128794->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128794->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_128794->free_A_mem_111707, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_segred_stage_1_parloop_struct_128794->free_bytes_111715;
    struct memblock mem_112431 = {.desc ="mem_112431", .mem =futhark_mc_segred_stage_1_parloop_struct_128794->free_mem_112431, .size =0, .references =NULL};
    struct memblock mem_112463 = {.desc ="mem_112463", .mem =futhark_mc_segred_stage_1_parloop_struct_128794->free_mem_112463, .size =0, .references =NULL};
    struct memblock mem_112466 = {.desc ="mem_112466", .mem =futhark_mc_segred_stage_1_parloop_struct_128794->free_mem_112466, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125721 = {.desc ="reduce_stage_1_tid_res_arr_mem_125721", .mem =futhark_mc_segred_stage_1_parloop_struct_128794->free_reduce_stage_1_tid_res_arr_mem_125721, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125723 = {.desc ="reduce_stage_1_tid_res_arr_mem_125723", .mem =futhark_mc_segred_stage_1_parloop_struct_128794->free_reduce_stage_1_tid_res_arr_mem_125723, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t mem_121005_cached_sizze_128796 = 0;
    unsigned char *mem_121005 = NULL;
    int64_t flat_tid_120987;
    
    flat_tid_120987 = subtask_id;
    {
        double eta_p_125725;
        double eta_p_125726;
        double eta_p_125728;
        double eta_p_125729;
        double local_acc_125731 = 0.0;
        double local_acc_125732 = 0.0;
        double eta_p_120989;
        double eta_p_120990;
        double eta_p_120992;
        double eta_p_120993;
        double local_acc_125733 = 0.0;
        double local_acc_125734 = 0.0;
        int64_t start_125735;
        int64_t end_125736;
        
        start_125735 = start;
        end_125736 = end;
        
        int64_t n_125737 = end_125736 - start_125735;
        
        if (mem_121005_cached_sizze_128796 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_121005, &mem_121005_cached_sizze_128796, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        for (int64_t SegRed_i_125738 = start_125735; SegRed_i_125738 < start_125735 + n_125737; SegRed_i_125738++) {
            int64_t gtid_120988 = SegRed_i_125738;
            double eta_p_120995 = ((double *) mem_112463.mem)[gtid_120988];
            double defunc_0_reduce_res_120996;
            double redout_120998 = 0.0;
            
            for (int64_t i_120997 = 0; i_120997 < m_33388; i_120997++) {
                double eta_p_120999 = ((double *) A_mem_111707.mem)[eta_p_106382 * (m_33388 * m_33388) + gtid_120988 * m_33388 + i_120997];
                double eta_p_121000 = ((double *) mem_112463.mem)[i_120997];
                double zt_res_121001 = eta_p_120999 * eta_p_120999;
                double zt_res_121002 = eta_p_121000 * zt_res_121001;
                double zp_res_121003 = zt_res_121002 + redout_120998;
                double redout_tmp_125739 = zp_res_121003;
                
                redout_120998 = redout_tmp_125739;
            }
            defunc_0_reduce_res_120996 = redout_120998;
            
            double zt_res_121004 = eta_p_120995 * defunc_0_reduce_res_120996;
            
            for (int64_t i_121008 = 0; i_121008 < m_33388; i_121008++) {
                double defunc_0_reduce_res_121010;
                double redout_121012 = 0.0;
                
                for (int64_t i_121011 = 0; i_121011 < m_33388; i_121011++) {
                    double eta_p_121013 = ((double *) A_mem_111707.mem)[eta_p_106382 * (m_33388 * m_33388) + gtid_120988 * m_33388 + i_121011];
                    double eta_p_121014 = ((double *) mem_112466.mem)[i_121011 * m_33388 + i_121008];
                    double zt_res_121015 = eta_p_121013 * eta_p_121014;
                    double zp_res_121016 = zt_res_121015 + redout_121012;
                    double redout_tmp_125741 = zp_res_121016;
                    
                    redout_121012 = redout_tmp_125741;
                }
                defunc_0_reduce_res_121010 = redout_121012;
                ((double *) mem_121005)[i_121008] = defunc_0_reduce_res_121010;
            }
            
            double defunc_0_reduce_res_121018;
            double redout_121020 = 0.0;
            
            for (int64_t i_121019 = 0; i_121019 < m_33388; i_121019++) {
                double eta_p_121021 = ((double *) mem_112466.mem)[gtid_120988 * m_33388 + i_121019];
                double defunc_0_reduce_res_121022;
                double redout_121024 = 0.0;
                
                for (int64_t i_121023 = 0; i_121023 < m_33388; i_121023++) {
                    double eta_p_121025 = ((double *) mem_121005)[i_121023];
                    double eta_p_121026 = ((double *) mem_112431.mem)[lifted_lambda_res_106391 * (m_33388 * m_33388) + i_121023 * m_33388 + i_121019];
                    double zt_res_121027 = eta_p_121025 * eta_p_121026;
                    double zp_res_121028 = zt_res_121027 + redout_121024;
                    double redout_tmp_125743 = zp_res_121028;
                    
                    redout_121024 = redout_tmp_125743;
                }
                defunc_0_reduce_res_121022 = redout_121024;
                
                double zt_res_121029 = eta_p_121021 * defunc_0_reduce_res_121022;
                double zp_res_121030 = zt_res_121029 + redout_121020;
                double redout_tmp_125742 = zp_res_121030;
                
                redout_121020 = redout_tmp_125742;
            }
            defunc_0_reduce_res_121018 = redout_121020;
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_120989 = local_acc_125733;
            }
            // Load next params
            {
                eta_p_120990 = zt_res_121004;
            }
            // SegRed body
            {
                double zp_res_120991 = eta_p_120989 + eta_p_120990;
                
                local_acc_125733 = zp_res_120991;
            }
            // Load accum params
            {
                eta_p_120992 = local_acc_125734;
            }
            // Load next params
            {
                eta_p_120993 = defunc_0_reduce_res_121018;
            }
            // SegRed body
            {
                double zp_res_120994 = eta_p_120992 + eta_p_120993;
                
                local_acc_125734 = zp_res_120994;
            }
        }
        
        int64_t uni_i_125744 = 0;
        
        {
            int64_t gtid_120988 = uni_i_125744;
            
            // Load accum params
            {
                eta_p_125725 = local_acc_125731;
            }
            // Load next params
            {
                eta_p_125726 = local_acc_125733;
            }
            // SegRed body
            {
                double zp_res_125727 = eta_p_125725 + eta_p_125726;
                
                local_acc_125731 = zp_res_125727;
            }
            // Load accum params
            {
                eta_p_125728 = local_acc_125732;
            }
            // Load next params
            {
                eta_p_125729 = local_acc_125734;
            }
            // SegRed body
            {
                double zp_res_125730 = eta_p_125728 + eta_p_125729;
                
                local_acc_125732 = zp_res_125730;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_125721.mem)[flat_tid_120987] = local_acc_125731;
        ((double *) reduce_stage_1_tid_res_arr_mem_125723.mem)[flat_tid_120987] = local_acc_125732;
    }
    
  cleanup:
    {
        free(mem_121005);
    }
    if (event_128797 != NULL) {
        event_128797->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128795", strdup("nothing further"), event_128797, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128791(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128790 *futhark_mc_task_128790 = (struct futhark_mc_task_128790 *) args;
    struct futhark_context *ctx = futhark_mc_task_128790->ctx;
    struct mc_event *event_128799 = mc_event_new(ctx);
    
    if (event_128799 != NULL)
        event_128799->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128790->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_128790->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128790->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_128790->free_A_mem_111707, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_task_128790->free_bytes_111715;
    struct memblock mem_112431 = {.desc ="mem_112431", .mem =futhark_mc_task_128790->free_mem_112431, .size =0, .references =NULL};
    struct memblock mem_112463 = {.desc ="mem_112463", .mem =futhark_mc_task_128790->free_mem_112463, .size =0, .references =NULL};
    struct memblock mem_112466 = {.desc ="mem_112466", .mem =futhark_mc_task_128790->free_mem_112466, .size =0, .references =NULL};
    int64_t flat_tid_120914 = futhark_mc_task_128790->free_flat_tid_120914;
    int64_t flat_tid_120987 = futhark_mc_task_128790->free_flat_tid_120987;
    double defunc_0_reduce_res_120912 = *futhark_mc_task_128790->retval_defunc_0_reduce_res_120912;
    double defunc_res_120913 = *futhark_mc_task_128790->retval_defunc_res_120913;
    int64_t reduce_stage_1_tid_res_arr_mem_125721_cached_sizze_128792 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125721 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_125723_cached_sizze_128793 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125723 = NULL;
    int32_t nsubtasks_125720;
    
    nsubtasks_125720 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_125721_cached_sizze_128792 < (int64_t) 8 * nsubtasks_125720) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125721, &reduce_stage_1_tid_res_arr_mem_125721_cached_sizze_128792, (int64_t) 8 * nsubtasks_125720);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_125723_cached_sizze_128793 < (int64_t) 8 * nsubtasks_125720) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125723, &reduce_stage_1_tid_res_arr_mem_125723_cached_sizze_128793, (int64_t) 8 * nsubtasks_125720);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128794 futhark_mc_segred_stage_1_parloop_struct_128794_;
    
    futhark_mc_segred_stage_1_parloop_struct_128794_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128794_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128794_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_128794_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128794_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_128794_.free_bytes_111715 = bytes_111715;
    futhark_mc_segred_stage_1_parloop_struct_128794_.free_mem_112431 = mem_112431.mem;
    futhark_mc_segred_stage_1_parloop_struct_128794_.free_mem_112463 = mem_112463.mem;
    futhark_mc_segred_stage_1_parloop_struct_128794_.free_mem_112466 = mem_112466.mem;
    futhark_mc_segred_stage_1_parloop_struct_128794_.free_reduce_stage_1_tid_res_arr_mem_125721 = reduce_stage_1_tid_res_arr_mem_125721;
    futhark_mc_segred_stage_1_parloop_struct_128794_.free_reduce_stage_1_tid_res_arr_mem_125723 = reduce_stage_1_tid_res_arr_mem_125723;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128795_task;
    
    futhark_mc_segred_stage_1_parloop_128795_task.name = "futhark_mc_segred_stage_1_parloop_128795";
    futhark_mc_segred_stage_1_parloop_128795_task.fn = futhark_mc_segred_stage_1_parloop_128795;
    futhark_mc_segred_stage_1_parloop_128795_task.args = &futhark_mc_segred_stage_1_parloop_struct_128794_;
    futhark_mc_segred_stage_1_parloop_128795_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128795_task.info = info;
    
    struct mc_event *event_128798 = mc_event_new(ctx);
    
    if (event_128798 != NULL)
        event_128798->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128795_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128795_task);
    
    if (futhark_mc_segred_stage_1_parloop_128795_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128795_err;
        goto cleanup;
    }
    if (event_128798 != NULL) {
        event_128798->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128795_total", strdup("nothing further"), event_128798, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_120912 = 0.0;
        defunc_res_120913 = 0.0;
    }
    
    double eta_p_125745;
    double eta_p_125746;
    double eta_p_125748;
    double eta_p_125749;
    
    for (int32_t i_125751 = 0; i_125751 < nsubtasks_125720; i_125751++) {
        flat_tid_120987 = i_125751;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_125745 = defunc_0_reduce_res_120912;
            }
            // load next params
            {
                eta_p_125746 = ((double *) reduce_stage_1_tid_res_arr_mem_125721)[flat_tid_120987];
            }
            // red body
            {
                double zp_res_125747 = eta_p_125745 + eta_p_125746;
                
                defunc_0_reduce_res_120912 = zp_res_125747;
            }
            // load acc params
            {
                eta_p_125748 = defunc_res_120913;
            }
            // load next params
            {
                eta_p_125749 = ((double *) reduce_stage_1_tid_res_arr_mem_125723)[flat_tid_120987];
            }
            // red body
            {
                double zp_res_125750 = eta_p_125748 + eta_p_125749;
                
                defunc_res_120913 = zp_res_125750;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_125721);
        free(reduce_stage_1_tid_res_arr_mem_125723);
    }
    if (event_128799 != NULL) {
        event_128799->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128791", strdup("nothing further"), event_128799, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128790->retval_defunc_0_reduce_res_120912 = defunc_0_reduce_res_120912;
        *futhark_mc_task_128790->retval_defunc_res_120913 = defunc_res_120913;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_128803 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    int64_t free_bytes_111715;
    unsigned char *free_mem_112431;
    unsigned char *free_mem_112463;
    unsigned char *free_mem_112466;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125753;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125755;
};
struct futhark_mc_task_128806 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112463;
    int64_t free_gtid_120915;
    int64_t free_flat_tid_120924;
    double *retval_defunc_0_reduce_res_120923;
};
struct futhark_mc_segred_stage_1_parloop_struct_128809 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112463;
    int64_t free_gtid_120915;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125772;
};
static int futhark_mc_segred_stage_1_parloop_128810(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128809 *futhark_mc_segred_stage_1_parloop_struct_128809 = (struct futhark_mc_segred_stage_1_parloop_struct_128809 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128809->ctx;
    struct mc_event *event_128811 = mc_event_new(ctx);
    
    if (event_128811 != NULL)
        event_128811->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128809->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_128809->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_128809->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112463 = {.desc ="mem_112463", .mem =futhark_mc_segred_stage_1_parloop_struct_128809->free_mem_112463, .size =0, .references =NULL};
    int64_t gtid_120915 = futhark_mc_segred_stage_1_parloop_struct_128809->free_gtid_120915;
    struct memblock reduce_stage_1_tid_res_arr_mem_125772 = {.desc ="reduce_stage_1_tid_res_arr_mem_125772", .mem =futhark_mc_segred_stage_1_parloop_struct_128809->free_reduce_stage_1_tid_res_arr_mem_125772, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_120924;
    
    flat_tid_120924 = subtask_id;
    {
        double eta_p_125774;
        double eta_p_125775;
        double local_acc_125777 = 0.0;
        double eta_p_120926;
        double eta_p_120927;
        double local_acc_125778 = 0.0;
        int64_t start_125779;
        int64_t end_125780;
        
        start_125779 = start;
        end_125780 = end;
        
        int64_t n_125781 = end_125780 - start_125779;
        
        for (int64_t SegRed_i_125782 = start_125779; SegRed_i_125782 < start_125779 + n_125781; SegRed_i_125782++) {
            int64_t gtid_120925 = SegRed_i_125782;
            double eta_p_120929 = ((double *) A_mem_111707.mem)[eta_p_106382 * (m_33388 * m_33388) + gtid_120915 * m_33388 + gtid_120925];
            double eta_p_120930 = ((double *) mem_112463.mem)[gtid_120925];
            double zt_res_120931 = eta_p_120929 * eta_p_120929;
            double zt_res_120932 = eta_p_120930 * zt_res_120931;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_120926 = local_acc_125778;
            }
            // Load next params
            {
                eta_p_120927 = zt_res_120932;
            }
            // SegRed body
            {
                double zp_res_120928 = eta_p_120926 + eta_p_120927;
                
                local_acc_125778 = zp_res_120928;
            }
        }
        
        int64_t uni_i_125783 = 0;
        
        {
            int64_t gtid_120925 = uni_i_125783;
            
            // Load accum params
            {
                eta_p_125774 = local_acc_125777;
            }
            // Load next params
            {
                eta_p_125775 = local_acc_125778;
            }
            // SegRed body
            {
                double zp_res_125776 = eta_p_125774 + eta_p_125775;
                
                local_acc_125777 = zp_res_125776;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_125772.mem)[flat_tid_120924] = local_acc_125777;
    }
    
  cleanup:
    { }
    if (event_128811 != NULL) {
        event_128811->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128810", strdup("nothing further"), event_128811, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128807(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128806 *futhark_mc_task_128806 = (struct futhark_mc_task_128806 *) args;
    struct futhark_context *ctx = futhark_mc_task_128806->ctx;
    struct mc_event *event_128813 = mc_event_new(ctx);
    
    if (event_128813 != NULL)
        event_128813->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128806->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_128806->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_128806->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112463 = {.desc ="mem_112463", .mem =futhark_mc_task_128806->free_mem_112463, .size =0, .references =NULL};
    int64_t gtid_120915 = futhark_mc_task_128806->free_gtid_120915;
    int64_t flat_tid_120924 = futhark_mc_task_128806->free_flat_tid_120924;
    double defunc_0_reduce_res_120923 = *futhark_mc_task_128806->retval_defunc_0_reduce_res_120923;
    int64_t reduce_stage_1_tid_res_arr_mem_125772_cached_sizze_128808 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125772 = NULL;
    int32_t nsubtasks_125771;
    
    nsubtasks_125771 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_125772_cached_sizze_128808 < (int64_t) 8 * nsubtasks_125771) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125772, &reduce_stage_1_tid_res_arr_mem_125772_cached_sizze_128808, (int64_t) 8 * nsubtasks_125771);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128809 futhark_mc_segred_stage_1_parloop_struct_128809_;
    
    futhark_mc_segred_stage_1_parloop_struct_128809_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128809_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128809_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_128809_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_128809_.free_mem_112463 = mem_112463.mem;
    futhark_mc_segred_stage_1_parloop_struct_128809_.free_gtid_120915 = gtid_120915;
    futhark_mc_segred_stage_1_parloop_struct_128809_.free_reduce_stage_1_tid_res_arr_mem_125772 = reduce_stage_1_tid_res_arr_mem_125772;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128810_task;
    
    futhark_mc_segred_stage_1_parloop_128810_task.name = "futhark_mc_segred_stage_1_parloop_128810";
    futhark_mc_segred_stage_1_parloop_128810_task.fn = futhark_mc_segred_stage_1_parloop_128810;
    futhark_mc_segred_stage_1_parloop_128810_task.args = &futhark_mc_segred_stage_1_parloop_struct_128809_;
    futhark_mc_segred_stage_1_parloop_128810_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128810_task.info = info;
    
    struct mc_event *event_128812 = mc_event_new(ctx);
    
    if (event_128812 != NULL)
        event_128812->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128810_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128810_task);
    
    if (futhark_mc_segred_stage_1_parloop_128810_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128810_err;
        goto cleanup;
    }
    if (event_128812 != NULL) {
        event_128812->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128810_total", strdup("nothing further"), event_128812, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_120923 = 0.0;
    }
    
    double eta_p_125784;
    double eta_p_125785;
    
    for (int32_t i_125787 = 0; i_125787 < nsubtasks_125771; i_125787++) {
        flat_tid_120924 = i_125787;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_125784 = defunc_0_reduce_res_120923;
            }
            // load next params
            {
                eta_p_125785 = ((double *) reduce_stage_1_tid_res_arr_mem_125772)[flat_tid_120924];
            }
            // red body
            {
                double zp_res_125786 = eta_p_125784 + eta_p_125785;
                
                defunc_0_reduce_res_120923 = zp_res_125786;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_125772);
    }
    if (event_128813 != NULL) {
        event_128813->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128807", strdup("nothing further"), event_128813, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128806->retval_defunc_0_reduce_res_120923 = defunc_0_reduce_res_120923;
    }
    return err;
}
struct futhark_mc_task_128814 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112466;
    int64_t free_gtid_120915;
    unsigned char *free_mem_120934;
};
struct futhark_mc_segmap_parloop_struct_128816 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112466;
    int64_t free_gtid_120915;
    unsigned char *free_mem_120934;
};
static int futhark_mc_segmap_parloop_128817(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_128816 *futhark_mc_segmap_parloop_struct_128816 = (struct futhark_mc_segmap_parloop_struct_128816 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_128816->ctx;
    struct mc_event *event_128818 = mc_event_new(ctx);
    
    if (event_128818 != NULL)
        event_128818->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_128816->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segmap_parloop_struct_128816->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segmap_parloop_struct_128816->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112466 = {.desc ="mem_112466", .mem =futhark_mc_segmap_parloop_struct_128816->free_mem_112466, .size =0, .references =NULL};
    int64_t gtid_120915 = futhark_mc_segmap_parloop_struct_128816->free_gtid_120915;
    struct memblock mem_120934 = {.desc ="mem_120934", .mem =futhark_mc_segmap_parloop_struct_128816->free_mem_120934, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_120947;
    
    flat_tid_120947 = subtask_id;
    {
        int64_t start_125795;
        int64_t end_125796;
        
        start_125795 = start;
        end_125796 = end;
        
        int64_t n_125797 = end_125796 - start_125795;
        
        for (int64_t SegMap_i_125798 = start_125795; SegMap_i_125798 < start_125795 + n_125797; SegMap_i_125798++) {
            int64_t slice_125799 = m_33388;
            int64_t gtid_120948 = SegMap_i_125798;
            int64_t remnant_125800 = SegMap_i_125798 - gtid_120948;
            double defunc_0_reduce_res_120949;
            double redout_125790 = 0.0;
            
            for (int64_t i_125789 = 0; i_125789 < m_33388; i_125789++) {
                double eta_p_125791 = ((double *) A_mem_111707.mem)[eta_p_106382 * (m_33388 * m_33388) + gtid_120915 * m_33388 + i_125789];
                double eta_p_125792 = ((double *) mem_112466.mem)[i_125789 * m_33388 + gtid_120948];
                double zt_res_125793 = eta_p_125791 * eta_p_125792;
                double zp_res_125794 = zt_res_125793 + redout_125790;
                double redout_tmp_125801 = zp_res_125794;
                
                redout_125790 = redout_tmp_125801;
            }
            defunc_0_reduce_res_120949 = redout_125790;
            ((double *) mem_120934.mem)[gtid_120948] = defunc_0_reduce_res_120949;
        }
    }
    
  cleanup:
    { }
    if (event_128818 != NULL) {
        event_128818->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128817", strdup("nothing further"), event_128818, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_task_128815(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128814 *futhark_mc_task_128814 = (struct futhark_mc_task_128814 *) args;
    struct futhark_context *ctx = futhark_mc_task_128814->ctx;
    struct mc_event *event_128820 = mc_event_new(ctx);
    
    if (event_128820 != NULL)
        event_128820->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128814->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_128814->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_128814->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112466 = {.desc ="mem_112466", .mem =futhark_mc_task_128814->free_mem_112466, .size =0, .references =NULL};
    int64_t gtid_120915 = futhark_mc_task_128814->free_gtid_120915;
    struct memblock mem_120934 = {.desc ="mem_120934", .mem =futhark_mc_task_128814->free_mem_120934, .size =0, .references =NULL};
    int32_t nsubtasks_125788;
    
    nsubtasks_125788 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_128816 futhark_mc_segmap_parloop_struct_128816_;
    
    futhark_mc_segmap_parloop_struct_128816_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_128816_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_128816_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segmap_parloop_struct_128816_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segmap_parloop_struct_128816_.free_mem_112466 = mem_112466.mem;
    futhark_mc_segmap_parloop_struct_128816_.free_gtid_120915 = gtid_120915;
    futhark_mc_segmap_parloop_struct_128816_.free_mem_120934 = mem_120934.mem;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_128817_task;
    
    futhark_mc_segmap_parloop_128817_task.name = "futhark_mc_segmap_parloop_128817";
    futhark_mc_segmap_parloop_128817_task.fn = futhark_mc_segmap_parloop_128817;
    futhark_mc_segmap_parloop_128817_task.args = &futhark_mc_segmap_parloop_struct_128816_;
    futhark_mc_segmap_parloop_128817_task.iterations = iterations;
    futhark_mc_segmap_parloop_128817_task.info = info;
    
    struct mc_event *event_128819 = mc_event_new(ctx);
    
    if (event_128819 != NULL)
        event_128819->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_128817_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_128817_task);
    
    if (futhark_mc_segmap_parloop_128817_err != 0) {
        err = futhark_mc_segmap_parloop_128817_err;
        goto cleanup;
    }
    if (event_128819 != NULL) {
        event_128819->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128817_total", strdup("nothing further"), event_128819, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_128820 != NULL) {
        event_128820->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_task_128815", strdup("nothing further"), event_128820, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_segmap_parloop_struct_128822 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112466;
    int64_t free_gtid_120915;
    unsigned char *free_mem_120934;
};
struct futhark_mc_task_128824 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112466;
    int64_t free_gtid_120915;
    int64_t free_gtid_120937;
    int64_t free_flat_tid_125803;
    double *retval_defunc_0_reduce_res_120938;
};
struct futhark_mc_segred_stage_1_parloop_struct_128827 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112466;
    int64_t free_gtid_120915;
    int64_t free_gtid_120937;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125818;
};
static int futhark_mc_segred_stage_1_parloop_128828(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128827 *futhark_mc_segred_stage_1_parloop_struct_128827 = (struct futhark_mc_segred_stage_1_parloop_struct_128827 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128827->ctx;
    struct mc_event *event_128829 = mc_event_new(ctx);
    
    if (event_128829 != NULL)
        event_128829->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128827->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_128827->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_128827->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112466 = {.desc ="mem_112466", .mem =futhark_mc_segred_stage_1_parloop_struct_128827->free_mem_112466, .size =0, .references =NULL};
    int64_t gtid_120915 = futhark_mc_segred_stage_1_parloop_struct_128827->free_gtid_120915;
    int64_t gtid_120937 = futhark_mc_segred_stage_1_parloop_struct_128827->free_gtid_120937;
    struct memblock reduce_stage_1_tid_res_arr_mem_125818 = {.desc ="reduce_stage_1_tid_res_arr_mem_125818", .mem =futhark_mc_segred_stage_1_parloop_struct_128827->free_reduce_stage_1_tid_res_arr_mem_125818, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_125803;
    
    flat_tid_125803 = subtask_id;
    {
        double eta_p_125820;
        double eta_p_125821;
        double local_acc_125823 = 0.0;
        double eta_p_125805;
        double eta_p_125806;
        double local_acc_125824 = 0.0;
        int64_t start_125825;
        int64_t end_125826;
        
        start_125825 = start;
        end_125826 = end;
        
        int64_t n_125827 = end_125826 - start_125825;
        
        for (int64_t SegRed_i_125828 = start_125825; SegRed_i_125828 < start_125825 + n_125827; SegRed_i_125828++) {
            int64_t gtid_125804 = SegRed_i_125828;
            double eta_p_125808 = ((double *) A_mem_111707.mem)[eta_p_106382 * (m_33388 * m_33388) + gtid_120915 * m_33388 + gtid_125804];
            double eta_p_125809 = ((double *) mem_112466.mem)[gtid_125804 * m_33388 + gtid_120937];
            double zt_res_125810 = eta_p_125808 * eta_p_125809;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_125805 = local_acc_125824;
            }
            // Load next params
            {
                eta_p_125806 = zt_res_125810;
            }
            // SegRed body
            {
                double zp_res_125807 = eta_p_125805 + eta_p_125806;
                
                local_acc_125824 = zp_res_125807;
            }
        }
        
        int64_t uni_i_125829 = 0;
        
        {
            int64_t gtid_125804 = uni_i_125829;
            
            // Load accum params
            {
                eta_p_125820 = local_acc_125823;
            }
            // Load next params
            {
                eta_p_125821 = local_acc_125824;
            }
            // SegRed body
            {
                double zp_res_125822 = eta_p_125820 + eta_p_125821;
                
                local_acc_125823 = zp_res_125822;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_125818.mem)[flat_tid_125803] = local_acc_125823;
    }
    
  cleanup:
    { }
    if (event_128829 != NULL) {
        event_128829->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128828", strdup("nothing further"), event_128829, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128825(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128824 *futhark_mc_task_128824 = (struct futhark_mc_task_128824 *) args;
    struct futhark_context *ctx = futhark_mc_task_128824->ctx;
    struct mc_event *event_128831 = mc_event_new(ctx);
    
    if (event_128831 != NULL)
        event_128831->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128824->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_128824->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_128824->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112466 = {.desc ="mem_112466", .mem =futhark_mc_task_128824->free_mem_112466, .size =0, .references =NULL};
    int64_t gtid_120915 = futhark_mc_task_128824->free_gtid_120915;
    int64_t gtid_120937 = futhark_mc_task_128824->free_gtid_120937;
    int64_t flat_tid_125803 = futhark_mc_task_128824->free_flat_tid_125803;
    double defunc_0_reduce_res_120938 = *futhark_mc_task_128824->retval_defunc_0_reduce_res_120938;
    int64_t reduce_stage_1_tid_res_arr_mem_125818_cached_sizze_128826 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125818 = NULL;
    int32_t nsubtasks_125817;
    
    nsubtasks_125817 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_125818_cached_sizze_128826 < (int64_t) 8 * nsubtasks_125817) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125818, &reduce_stage_1_tid_res_arr_mem_125818_cached_sizze_128826, (int64_t) 8 * nsubtasks_125817);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128827 futhark_mc_segred_stage_1_parloop_struct_128827_;
    
    futhark_mc_segred_stage_1_parloop_struct_128827_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128827_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128827_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_128827_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_128827_.free_mem_112466 = mem_112466.mem;
    futhark_mc_segred_stage_1_parloop_struct_128827_.free_gtid_120915 = gtid_120915;
    futhark_mc_segred_stage_1_parloop_struct_128827_.free_gtid_120937 = gtid_120937;
    futhark_mc_segred_stage_1_parloop_struct_128827_.free_reduce_stage_1_tid_res_arr_mem_125818 = reduce_stage_1_tid_res_arr_mem_125818;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128828_task;
    
    futhark_mc_segred_stage_1_parloop_128828_task.name = "futhark_mc_segred_stage_1_parloop_128828";
    futhark_mc_segred_stage_1_parloop_128828_task.fn = futhark_mc_segred_stage_1_parloop_128828;
    futhark_mc_segred_stage_1_parloop_128828_task.args = &futhark_mc_segred_stage_1_parloop_struct_128827_;
    futhark_mc_segred_stage_1_parloop_128828_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128828_task.info = info;
    
    struct mc_event *event_128830 = mc_event_new(ctx);
    
    if (event_128830 != NULL)
        event_128830->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128828_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128828_task);
    
    if (futhark_mc_segred_stage_1_parloop_128828_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128828_err;
        goto cleanup;
    }
    if (event_128830 != NULL) {
        event_128830->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128828_total", strdup("nothing further"), event_128830, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_120938 = 0.0;
    }
    
    double eta_p_125830;
    double eta_p_125831;
    
    for (int32_t i_125833 = 0; i_125833 < nsubtasks_125817; i_125833++) {
        flat_tid_125803 = i_125833;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_125830 = defunc_0_reduce_res_120938;
            }
            // load next params
            {
                eta_p_125831 = ((double *) reduce_stage_1_tid_res_arr_mem_125818)[flat_tid_125803];
            }
            // red body
            {
                double zp_res_125832 = eta_p_125830 + eta_p_125831;
                
                defunc_0_reduce_res_120938 = zp_res_125832;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_125818);
    }
    if (event_128831 != NULL) {
        event_128831->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128825", strdup("nothing further"), event_128831, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128824->retval_defunc_0_reduce_res_120938 = defunc_0_reduce_res_120938;
    }
    return err;
}
static int futhark_mc_segmap_parloop_128823(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_128822 *futhark_mc_segmap_parloop_struct_128822 = (struct futhark_mc_segmap_parloop_struct_128822 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_128822->ctx;
    struct mc_event *event_128832 = mc_event_new(ctx);
    
    if (event_128832 != NULL)
        event_128832->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_128822->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segmap_parloop_struct_128822->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segmap_parloop_struct_128822->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112466 = {.desc ="mem_112466", .mem =futhark_mc_segmap_parloop_struct_128822->free_mem_112466, .size =0, .references =NULL};
    int64_t gtid_120915 = futhark_mc_segmap_parloop_struct_128822->free_gtid_120915;
    struct memblock mem_120934 = {.desc ="mem_120934", .mem =futhark_mc_segmap_parloop_struct_128822->free_mem_120934, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_120936;
    
    flat_tid_120936 = subtask_id;
    {
        int64_t start_125811;
        int64_t end_125812;
        
        start_125811 = start;
        end_125812 = end;
        
        int64_t n_125813 = end_125812 - start_125811;
        
        for (int64_t SegMap_i_125814 = start_125811; SegMap_i_125814 < start_125811 + n_125813; SegMap_i_125814++) {
            int64_t slice_125815 = m_33388;
            int64_t gtid_120937 = SegMap_i_125814;
            int64_t remnant_125816 = SegMap_i_125814 - gtid_120937;
            double defunc_0_reduce_res_120938;
            int64_t flat_tid_125803 = (int64_t) 0;
            
            defunc_0_reduce_res_120938 = 0.0;
            
            struct futhark_mc_task_128824 futhark_mc_task_128824_;
            
            futhark_mc_task_128824_.ctx = ctx;
            futhark_mc_task_128824_.free_m_33388 = m_33388;
            futhark_mc_task_128824_.free_eta_p_106382 = eta_p_106382;
            futhark_mc_task_128824_.free_A_mem_111707 = A_mem_111707.mem;
            futhark_mc_task_128824_.free_mem_112466 = mem_112466.mem;
            futhark_mc_task_128824_.free_gtid_120915 = gtid_120915;
            futhark_mc_task_128824_.free_gtid_120937 = gtid_120937;
            futhark_mc_task_128824_.free_flat_tid_125803 = flat_tid_125803;
            futhark_mc_task_128824_.retval_defunc_0_reduce_res_120938 = (double *) &defunc_0_reduce_res_120938;
            #if ISPC
            futhark_mc_task_128824_.retval_defunc_0_reduce_res_120938 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_128824_task;
            
            futhark_mc_task_128824_task.args = &futhark_mc_task_128824_;
            futhark_mc_task_128824_task.top_level_fn = futhark_mc_segred_task_128825;
            futhark_mc_task_128824_task.name = "futhark_mc_segred_task_128825";
            futhark_mc_task_128824_task.iterations = m_33388;
            futhark_mc_task_128824_task.task_time = &ctx->program->futhark_mc_segred_task_128825_total_time;
            futhark_mc_task_128824_task.task_iter = &ctx->program->futhark_mc_segred_task_128825_total_iter;
            futhark_mc_task_128824_task.sched = STATIC;
            futhark_mc_task_128824_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_128825_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128824_task);
            
            if (futhark_mc_segred_task_128825_err != 0) {
                err = futhark_mc_segred_task_128825_err;
                goto cleanup;
            }
            ((double *) mem_120934.mem)[gtid_120937] = defunc_0_reduce_res_120938;
        }
    }
    
  cleanup:
    { }
    if (event_128832 != NULL) {
        event_128832->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128823", strdup("nothing further"), event_128832, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_nested_task_128821(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128814 *futhark_mc_task_128814 = (struct futhark_mc_task_128814 *) args;
    struct futhark_context *ctx = futhark_mc_task_128814->ctx;
    struct mc_event *event_128834 = mc_event_new(ctx);
    
    if (event_128834 != NULL)
        event_128834->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128814->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_128814->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_128814->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112466 = {.desc ="mem_112466", .mem =futhark_mc_task_128814->free_mem_112466, .size =0, .references =NULL};
    int64_t gtid_120915 = futhark_mc_task_128814->free_gtid_120915;
    struct memblock mem_120934 = {.desc ="mem_120934", .mem =futhark_mc_task_128814->free_mem_120934, .size =0, .references =NULL};
    int32_t nsubtasks_125802;
    
    nsubtasks_125802 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_128822 futhark_mc_segmap_parloop_struct_128822_;
    
    futhark_mc_segmap_parloop_struct_128822_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_128822_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_128822_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segmap_parloop_struct_128822_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segmap_parloop_struct_128822_.free_mem_112466 = mem_112466.mem;
    futhark_mc_segmap_parloop_struct_128822_.free_gtid_120915 = gtid_120915;
    futhark_mc_segmap_parloop_struct_128822_.free_mem_120934 = mem_120934.mem;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_128823_task;
    
    futhark_mc_segmap_parloop_128823_task.name = "futhark_mc_segmap_parloop_128823";
    futhark_mc_segmap_parloop_128823_task.fn = futhark_mc_segmap_parloop_128823;
    futhark_mc_segmap_parloop_128823_task.args = &futhark_mc_segmap_parloop_struct_128822_;
    futhark_mc_segmap_parloop_128823_task.iterations = iterations;
    futhark_mc_segmap_parloop_128823_task.info = info;
    
    struct mc_event *event_128833 = mc_event_new(ctx);
    
    if (event_128833 != NULL)
        event_128833->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_128823_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_128823_task);
    
    if (futhark_mc_segmap_parloop_128823_err != 0) {
        err = futhark_mc_segmap_parloop_128823_err;
        goto cleanup;
    }
    if (event_128833 != NULL) {
        event_128833->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128823_total", strdup("nothing further"), event_128833, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_128834 != NULL) {
        event_128834->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_nested_task_128821", strdup("nothing further"), event_128834, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_128835 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_mem_112431;
    unsigned char *free_mem_112466;
    int64_t free_gtid_120915;
    unsigned char *free_mem_120934;
    int64_t free_flat_tid_120957;
    int64_t free_flat_tid_120973;
    double *retval_defunc_0_reduce_res_120956;
};
struct futhark_mc_segred_stage_1_parloop_struct_128838 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_mem_112431;
    unsigned char *free_mem_112466;
    int64_t free_gtid_120915;
    unsigned char *free_mem_120934;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125835;
};
static int futhark_mc_segred_stage_1_parloop_128839(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128838 *futhark_mc_segred_stage_1_parloop_struct_128838 = (struct futhark_mc_segred_stage_1_parloop_struct_128838 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128838->ctx;
    struct mc_event *event_128840 = mc_event_new(ctx);
    
    if (event_128840 != NULL)
        event_128840->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128838->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128838->free_lifted_lambda_res_106391;
    struct memblock mem_112431 = {.desc ="mem_112431", .mem =futhark_mc_segred_stage_1_parloop_struct_128838->free_mem_112431, .size =0, .references =NULL};
    struct memblock mem_112466 = {.desc ="mem_112466", .mem =futhark_mc_segred_stage_1_parloop_struct_128838->free_mem_112466, .size =0, .references =NULL};
    int64_t gtid_120915 = futhark_mc_segred_stage_1_parloop_struct_128838->free_gtid_120915;
    struct memblock mem_120934 = {.desc ="mem_120934", .mem =futhark_mc_segred_stage_1_parloop_struct_128838->free_mem_120934, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125835 = {.desc ="reduce_stage_1_tid_res_arr_mem_125835", .mem =futhark_mc_segred_stage_1_parloop_struct_128838->free_reduce_stage_1_tid_res_arr_mem_125835, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_120973;
    
    flat_tid_120973 = subtask_id;
    {
        double eta_p_125837;
        double eta_p_125838;
        double local_acc_125840 = 0.0;
        double eta_p_120975;
        double eta_p_120976;
        double local_acc_125841 = 0.0;
        int64_t start_125842;
        int64_t end_125843;
        
        start_125842 = start;
        end_125843 = end;
        
        int64_t n_125844 = end_125843 - start_125842;
        
        for (int64_t SegRed_i_125845 = start_125842; SegRed_i_125845 < start_125842 + n_125844; SegRed_i_125845++) {
            int64_t gtid_120974 = SegRed_i_125845;
            double eta_p_120978 = ((double *) mem_112466.mem)[gtid_120915 * m_33388 + gtid_120974];
            double defunc_0_reduce_res_120979;
            double redout_120981 = 0.0;
            
            for (int64_t i_120980 = 0; i_120980 < m_33388; i_120980++) {
                double eta_p_120982 = ((double *) mem_120934.mem)[i_120980];
                double eta_p_120983 = ((double *) mem_112431.mem)[lifted_lambda_res_106391 * (m_33388 * m_33388) + i_120980 * m_33388 + gtid_120974];
                double zt_res_120984 = eta_p_120982 * eta_p_120983;
                double zp_res_120985 = zt_res_120984 + redout_120981;
                double redout_tmp_125846 = zp_res_120985;
                
                redout_120981 = redout_tmp_125846;
            }
            defunc_0_reduce_res_120979 = redout_120981;
            
            double zt_res_120986 = eta_p_120978 * defunc_0_reduce_res_120979;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_120975 = local_acc_125841;
            }
            // Load next params
            {
                eta_p_120976 = zt_res_120986;
            }
            // SegRed body
            {
                double zp_res_120977 = eta_p_120975 + eta_p_120976;
                
                local_acc_125841 = zp_res_120977;
            }
        }
        
        int64_t uni_i_125847 = 0;
        
        {
            int64_t gtid_120974 = uni_i_125847;
            
            // Load accum params
            {
                eta_p_125837 = local_acc_125840;
            }
            // Load next params
            {
                eta_p_125838 = local_acc_125841;
            }
            // SegRed body
            {
                double zp_res_125839 = eta_p_125837 + eta_p_125838;
                
                local_acc_125840 = zp_res_125839;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_125835.mem)[flat_tid_120973] = local_acc_125840;
    }
    
  cleanup:
    { }
    if (event_128840 != NULL) {
        event_128840->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128839", strdup("nothing further"), event_128840, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128836(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128835 *futhark_mc_task_128835 = (struct futhark_mc_task_128835 *) args;
    struct futhark_context *ctx = futhark_mc_task_128835->ctx;
    struct mc_event *event_128842 = mc_event_new(ctx);
    
    if (event_128842 != NULL)
        event_128842->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128835->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128835->free_lifted_lambda_res_106391;
    struct memblock mem_112431 = {.desc ="mem_112431", .mem =futhark_mc_task_128835->free_mem_112431, .size =0, .references =NULL};
    struct memblock mem_112466 = {.desc ="mem_112466", .mem =futhark_mc_task_128835->free_mem_112466, .size =0, .references =NULL};
    int64_t gtid_120915 = futhark_mc_task_128835->free_gtid_120915;
    struct memblock mem_120934 = {.desc ="mem_120934", .mem =futhark_mc_task_128835->free_mem_120934, .size =0, .references =NULL};
    int64_t flat_tid_120957 = futhark_mc_task_128835->free_flat_tid_120957;
    int64_t flat_tid_120973 = futhark_mc_task_128835->free_flat_tid_120973;
    double defunc_0_reduce_res_120956 = *futhark_mc_task_128835->retval_defunc_0_reduce_res_120956;
    int64_t reduce_stage_1_tid_res_arr_mem_125835_cached_sizze_128837 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125835 = NULL;
    int32_t nsubtasks_125834;
    
    nsubtasks_125834 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_125835_cached_sizze_128837 < (int64_t) 8 * nsubtasks_125834) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125835, &reduce_stage_1_tid_res_arr_mem_125835_cached_sizze_128837, (int64_t) 8 * nsubtasks_125834);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128838 futhark_mc_segred_stage_1_parloop_struct_128838_;
    
    futhark_mc_segred_stage_1_parloop_struct_128838_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128838_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128838_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128838_.free_mem_112431 = mem_112431.mem;
    futhark_mc_segred_stage_1_parloop_struct_128838_.free_mem_112466 = mem_112466.mem;
    futhark_mc_segred_stage_1_parloop_struct_128838_.free_gtid_120915 = gtid_120915;
    futhark_mc_segred_stage_1_parloop_struct_128838_.free_mem_120934 = mem_120934.mem;
    futhark_mc_segred_stage_1_parloop_struct_128838_.free_reduce_stage_1_tid_res_arr_mem_125835 = reduce_stage_1_tid_res_arr_mem_125835;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128839_task;
    
    futhark_mc_segred_stage_1_parloop_128839_task.name = "futhark_mc_segred_stage_1_parloop_128839";
    futhark_mc_segred_stage_1_parloop_128839_task.fn = futhark_mc_segred_stage_1_parloop_128839;
    futhark_mc_segred_stage_1_parloop_128839_task.args = &futhark_mc_segred_stage_1_parloop_struct_128838_;
    futhark_mc_segred_stage_1_parloop_128839_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128839_task.info = info;
    
    struct mc_event *event_128841 = mc_event_new(ctx);
    
    if (event_128841 != NULL)
        event_128841->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128839_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128839_task);
    
    if (futhark_mc_segred_stage_1_parloop_128839_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128839_err;
        goto cleanup;
    }
    if (event_128841 != NULL) {
        event_128841->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128839_total", strdup("nothing further"), event_128841, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_120956 = 0.0;
    }
    
    double eta_p_125848;
    double eta_p_125849;
    
    for (int32_t i_125851 = 0; i_125851 < nsubtasks_125834; i_125851++) {
        flat_tid_120973 = i_125851;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_125848 = defunc_0_reduce_res_120956;
            }
            // load next params
            {
                eta_p_125849 = ((double *) reduce_stage_1_tid_res_arr_mem_125835)[flat_tid_120973];
            }
            // red body
            {
                double zp_res_125850 = eta_p_125848 + eta_p_125849;
                
                defunc_0_reduce_res_120956 = zp_res_125850;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_125835);
    }
    if (event_128842 != NULL) {
        event_128842->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128836", strdup("nothing further"), event_128842, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128835->retval_defunc_0_reduce_res_120956 = defunc_0_reduce_res_120956;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_128845 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_mem_112431;
    unsigned char *free_mem_112466;
    int64_t free_gtid_120915;
    unsigned char *free_mem_120934;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125853;
};
struct futhark_mc_task_128847 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_mem_112431;
    unsigned char *free_mem_120934;
    int64_t free_gtid_120958;
    int64_t free_flat_tid_120964;
    double *retval_defunc_0_reduce_res_120963;
};
struct futhark_mc_segred_stage_1_parloop_struct_128850 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_mem_112431;
    unsigned char *free_mem_120934;
    int64_t free_gtid_120958;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125865;
};
static int futhark_mc_segred_stage_1_parloop_128851(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128850 *futhark_mc_segred_stage_1_parloop_struct_128850 = (struct futhark_mc_segred_stage_1_parloop_struct_128850 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128850->ctx;
    struct mc_event *event_128852 = mc_event_new(ctx);
    
    if (event_128852 != NULL)
        event_128852->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128850->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128850->free_lifted_lambda_res_106391;
    struct memblock mem_112431 = {.desc ="mem_112431", .mem =futhark_mc_segred_stage_1_parloop_struct_128850->free_mem_112431, .size =0, .references =NULL};
    struct memblock mem_120934 = {.desc ="mem_120934", .mem =futhark_mc_segred_stage_1_parloop_struct_128850->free_mem_120934, .size =0, .references =NULL};
    int64_t gtid_120958 = futhark_mc_segred_stage_1_parloop_struct_128850->free_gtid_120958;
    struct memblock reduce_stage_1_tid_res_arr_mem_125865 = {.desc ="reduce_stage_1_tid_res_arr_mem_125865", .mem =futhark_mc_segred_stage_1_parloop_struct_128850->free_reduce_stage_1_tid_res_arr_mem_125865, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_120964;
    
    flat_tid_120964 = subtask_id;
    {
        double eta_p_125867;
        double eta_p_125868;
        double local_acc_125870 = 0.0;
        double eta_p_120966;
        double eta_p_120967;
        double local_acc_125871 = 0.0;
        int64_t start_125872;
        int64_t end_125873;
        
        start_125872 = start;
        end_125873 = end;
        
        int64_t n_125874 = end_125873 - start_125872;
        
        for (int64_t SegRed_i_125875 = start_125872; SegRed_i_125875 < start_125872 + n_125874; SegRed_i_125875++) {
            int64_t gtid_120965 = SegRed_i_125875;
            double eta_p_120969 = ((double *) mem_120934.mem)[gtid_120965];
            double eta_p_120970 = ((double *) mem_112431.mem)[lifted_lambda_res_106391 * (m_33388 * m_33388) + gtid_120965 * m_33388 + gtid_120958];
            double zt_res_120971 = eta_p_120969 * eta_p_120970;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_120966 = local_acc_125871;
            }
            // Load next params
            {
                eta_p_120967 = zt_res_120971;
            }
            // SegRed body
            {
                double zp_res_120968 = eta_p_120966 + eta_p_120967;
                
                local_acc_125871 = zp_res_120968;
            }
        }
        
        int64_t uni_i_125876 = 0;
        
        {
            int64_t gtid_120965 = uni_i_125876;
            
            // Load accum params
            {
                eta_p_125867 = local_acc_125870;
            }
            // Load next params
            {
                eta_p_125868 = local_acc_125871;
            }
            // SegRed body
            {
                double zp_res_125869 = eta_p_125867 + eta_p_125868;
                
                local_acc_125870 = zp_res_125869;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_125865.mem)[flat_tid_120964] = local_acc_125870;
    }
    
  cleanup:
    { }
    if (event_128852 != NULL) {
        event_128852->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128851", strdup("nothing further"), event_128852, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128848(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128847 *futhark_mc_task_128847 = (struct futhark_mc_task_128847 *) args;
    struct futhark_context *ctx = futhark_mc_task_128847->ctx;
    struct mc_event *event_128854 = mc_event_new(ctx);
    
    if (event_128854 != NULL)
        event_128854->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128847->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128847->free_lifted_lambda_res_106391;
    struct memblock mem_112431 = {.desc ="mem_112431", .mem =futhark_mc_task_128847->free_mem_112431, .size =0, .references =NULL};
    struct memblock mem_120934 = {.desc ="mem_120934", .mem =futhark_mc_task_128847->free_mem_120934, .size =0, .references =NULL};
    int64_t gtid_120958 = futhark_mc_task_128847->free_gtid_120958;
    int64_t flat_tid_120964 = futhark_mc_task_128847->free_flat_tid_120964;
    double defunc_0_reduce_res_120963 = *futhark_mc_task_128847->retval_defunc_0_reduce_res_120963;
    int64_t reduce_stage_1_tid_res_arr_mem_125865_cached_sizze_128849 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125865 = NULL;
    int32_t nsubtasks_125864;
    
    nsubtasks_125864 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_125865_cached_sizze_128849 < (int64_t) 8 * nsubtasks_125864) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125865, &reduce_stage_1_tid_res_arr_mem_125865_cached_sizze_128849, (int64_t) 8 * nsubtasks_125864);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128850 futhark_mc_segred_stage_1_parloop_struct_128850_;
    
    futhark_mc_segred_stage_1_parloop_struct_128850_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128850_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128850_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128850_.free_mem_112431 = mem_112431.mem;
    futhark_mc_segred_stage_1_parloop_struct_128850_.free_mem_120934 = mem_120934.mem;
    futhark_mc_segred_stage_1_parloop_struct_128850_.free_gtid_120958 = gtid_120958;
    futhark_mc_segred_stage_1_parloop_struct_128850_.free_reduce_stage_1_tid_res_arr_mem_125865 = reduce_stage_1_tid_res_arr_mem_125865;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128851_task;
    
    futhark_mc_segred_stage_1_parloop_128851_task.name = "futhark_mc_segred_stage_1_parloop_128851";
    futhark_mc_segred_stage_1_parloop_128851_task.fn = futhark_mc_segred_stage_1_parloop_128851;
    futhark_mc_segred_stage_1_parloop_128851_task.args = &futhark_mc_segred_stage_1_parloop_struct_128850_;
    futhark_mc_segred_stage_1_parloop_128851_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128851_task.info = info;
    
    struct mc_event *event_128853 = mc_event_new(ctx);
    
    if (event_128853 != NULL)
        event_128853->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128851_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128851_task);
    
    if (futhark_mc_segred_stage_1_parloop_128851_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128851_err;
        goto cleanup;
    }
    if (event_128853 != NULL) {
        event_128853->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128851_total", strdup("nothing further"), event_128853, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_120963 = 0.0;
    }
    
    double eta_p_125877;
    double eta_p_125878;
    
    for (int32_t i_125880 = 0; i_125880 < nsubtasks_125864; i_125880++) {
        flat_tid_120964 = i_125880;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_125877 = defunc_0_reduce_res_120963;
            }
            // load next params
            {
                eta_p_125878 = ((double *) reduce_stage_1_tid_res_arr_mem_125865)[flat_tid_120964];
            }
            // red body
            {
                double zp_res_125879 = eta_p_125877 + eta_p_125878;
                
                defunc_0_reduce_res_120963 = zp_res_125879;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_125865);
    }
    if (event_128854 != NULL) {
        event_128854->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128848", strdup("nothing further"), event_128854, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128847->retval_defunc_0_reduce_res_120963 = defunc_0_reduce_res_120963;
    }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_128846(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128845 *futhark_mc_segred_stage_1_parloop_struct_128845 = (struct futhark_mc_segred_stage_1_parloop_struct_128845 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128845->ctx;
    struct mc_event *event_128855 = mc_event_new(ctx);
    
    if (event_128855 != NULL)
        event_128855->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128845->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128845->free_lifted_lambda_res_106391;
    struct memblock mem_112431 = {.desc ="mem_112431", .mem =futhark_mc_segred_stage_1_parloop_struct_128845->free_mem_112431, .size =0, .references =NULL};
    struct memblock mem_112466 = {.desc ="mem_112466", .mem =futhark_mc_segred_stage_1_parloop_struct_128845->free_mem_112466, .size =0, .references =NULL};
    int64_t gtid_120915 = futhark_mc_segred_stage_1_parloop_struct_128845->free_gtid_120915;
    struct memblock mem_120934 = {.desc ="mem_120934", .mem =futhark_mc_segred_stage_1_parloop_struct_128845->free_mem_120934, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125853 = {.desc ="reduce_stage_1_tid_res_arr_mem_125853", .mem =futhark_mc_segred_stage_1_parloop_struct_128845->free_reduce_stage_1_tid_res_arr_mem_125853, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_120957;
    
    flat_tid_120957 = subtask_id;
    {
        double eta_p_125855;
        double eta_p_125856;
        double local_acc_125858 = 0.0;
        double eta_p_120959;
        double eta_p_120960;
        double local_acc_125859 = 0.0;
        int64_t start_125860;
        int64_t end_125861;
        
        start_125860 = start;
        end_125861 = end;
        
        int64_t n_125862 = end_125861 - start_125860;
        
        for (int64_t SegRed_i_125863 = start_125860; SegRed_i_125863 < start_125860 + n_125862; SegRed_i_125863++) {
            int64_t gtid_120958 = SegRed_i_125863;
            double eta_p_120962 = ((double *) mem_112466.mem)[gtid_120915 * m_33388 + gtid_120958];
            double defunc_0_reduce_res_120963;
            int64_t flat_tid_120964 = (int64_t) 0;
            
            defunc_0_reduce_res_120963 = 0.0;
            
            struct futhark_mc_task_128847 futhark_mc_task_128847_;
            
            futhark_mc_task_128847_.ctx = ctx;
            futhark_mc_task_128847_.free_m_33388 = m_33388;
            futhark_mc_task_128847_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
            futhark_mc_task_128847_.free_mem_112431 = mem_112431.mem;
            futhark_mc_task_128847_.free_mem_120934 = mem_120934.mem;
            futhark_mc_task_128847_.free_gtid_120958 = gtid_120958;
            futhark_mc_task_128847_.free_flat_tid_120964 = flat_tid_120964;
            futhark_mc_task_128847_.retval_defunc_0_reduce_res_120963 = (double *) &defunc_0_reduce_res_120963;
            #if ISPC
            futhark_mc_task_128847_.retval_defunc_0_reduce_res_120963 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_128847_task;
            
            futhark_mc_task_128847_task.args = &futhark_mc_task_128847_;
            futhark_mc_task_128847_task.top_level_fn = futhark_mc_segred_task_128848;
            futhark_mc_task_128847_task.name = "futhark_mc_segred_task_128848";
            futhark_mc_task_128847_task.iterations = m_33388;
            futhark_mc_task_128847_task.task_time = &ctx->program->futhark_mc_segred_task_128848_total_time;
            futhark_mc_task_128847_task.task_iter = &ctx->program->futhark_mc_segred_task_128848_total_iter;
            futhark_mc_task_128847_task.sched = STATIC;
            futhark_mc_task_128847_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_128848_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128847_task);
            
            if (futhark_mc_segred_task_128848_err != 0) {
                err = futhark_mc_segred_task_128848_err;
                goto cleanup;
            }
            
            double zt_res_120972 = eta_p_120962 * defunc_0_reduce_res_120963;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_120959 = local_acc_125859;
            }
            // Load next params
            {
                eta_p_120960 = zt_res_120972;
            }
            // SegRed body
            {
                double zp_res_120961 = eta_p_120959 + eta_p_120960;
                
                local_acc_125859 = zp_res_120961;
            }
        }
        
        int64_t uni_i_125881 = 0;
        
        {
            int64_t gtid_120958 = uni_i_125881;
            
            // Load accum params
            {
                eta_p_125855 = local_acc_125858;
            }
            // Load next params
            {
                eta_p_125856 = local_acc_125859;
            }
            // SegRed body
            {
                double zp_res_125857 = eta_p_125855 + eta_p_125856;
                
                local_acc_125858 = zp_res_125857;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_125853.mem)[flat_tid_120957] = local_acc_125858;
    }
    
  cleanup:
    { }
    if (event_128855 != NULL) {
        event_128855->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128846", strdup("nothing further"), event_128855, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_128843(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128835 *futhark_mc_task_128835 = (struct futhark_mc_task_128835 *) args;
    struct futhark_context *ctx = futhark_mc_task_128835->ctx;
    struct mc_event *event_128857 = mc_event_new(ctx);
    
    if (event_128857 != NULL)
        event_128857->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128835->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128835->free_lifted_lambda_res_106391;
    struct memblock mem_112431 = {.desc ="mem_112431", .mem =futhark_mc_task_128835->free_mem_112431, .size =0, .references =NULL};
    struct memblock mem_112466 = {.desc ="mem_112466", .mem =futhark_mc_task_128835->free_mem_112466, .size =0, .references =NULL};
    int64_t gtid_120915 = futhark_mc_task_128835->free_gtid_120915;
    struct memblock mem_120934 = {.desc ="mem_120934", .mem =futhark_mc_task_128835->free_mem_120934, .size =0, .references =NULL};
    int64_t flat_tid_120957 = futhark_mc_task_128835->free_flat_tid_120957;
    int64_t flat_tid_120973 = futhark_mc_task_128835->free_flat_tid_120973;
    double defunc_0_reduce_res_120956 = *futhark_mc_task_128835->retval_defunc_0_reduce_res_120956;
    int64_t reduce_stage_1_tid_res_arr_mem_125853_cached_sizze_128844 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125853 = NULL;
    int32_t nsubtasks_125852;
    
    nsubtasks_125852 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_125853_cached_sizze_128844 < (int64_t) 8 * nsubtasks_125852) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125853, &reduce_stage_1_tid_res_arr_mem_125853_cached_sizze_128844, (int64_t) 8 * nsubtasks_125852);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128845 futhark_mc_segred_stage_1_parloop_struct_128845_;
    
    futhark_mc_segred_stage_1_parloop_struct_128845_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128845_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128845_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128845_.free_mem_112431 = mem_112431.mem;
    futhark_mc_segred_stage_1_parloop_struct_128845_.free_mem_112466 = mem_112466.mem;
    futhark_mc_segred_stage_1_parloop_struct_128845_.free_gtid_120915 = gtid_120915;
    futhark_mc_segred_stage_1_parloop_struct_128845_.free_mem_120934 = mem_120934.mem;
    futhark_mc_segred_stage_1_parloop_struct_128845_.free_reduce_stage_1_tid_res_arr_mem_125853 = reduce_stage_1_tid_res_arr_mem_125853;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128846_task;
    
    futhark_mc_segred_stage_1_parloop_128846_task.name = "futhark_mc_segred_stage_1_parloop_128846";
    futhark_mc_segred_stage_1_parloop_128846_task.fn = futhark_mc_segred_stage_1_parloop_128846;
    futhark_mc_segred_stage_1_parloop_128846_task.args = &futhark_mc_segred_stage_1_parloop_struct_128845_;
    futhark_mc_segred_stage_1_parloop_128846_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128846_task.info = info;
    
    struct mc_event *event_128856 = mc_event_new(ctx);
    
    if (event_128856 != NULL)
        event_128856->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128846_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128846_task);
    
    if (futhark_mc_segred_stage_1_parloop_128846_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128846_err;
        goto cleanup;
    }
    if (event_128856 != NULL) {
        event_128856->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128846_total", strdup("nothing further"), event_128856, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_120956 = 0.0;
    }
    
    double eta_p_125882;
    double eta_p_125883;
    
    for (int32_t i_125885 = 0; i_125885 < nsubtasks_125852; i_125885++) {
        flat_tid_120957 = i_125885;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_125882 = defunc_0_reduce_res_120956;
            }
            // load next params
            {
                eta_p_125883 = ((double *) reduce_stage_1_tid_res_arr_mem_125853)[flat_tid_120957];
            }
            // red body
            {
                double zp_res_125884 = eta_p_125882 + eta_p_125883;
                
                defunc_0_reduce_res_120956 = zp_res_125884;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_125853);
    }
    if (event_128857 != NULL) {
        event_128857->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_128843", strdup("nothing further"), event_128857, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128835->retval_defunc_0_reduce_res_120956 = defunc_0_reduce_res_120956;
    }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_128804(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128803 *futhark_mc_segred_stage_1_parloop_struct_128803 = (struct futhark_mc_segred_stage_1_parloop_struct_128803 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128803->ctx;
    struct mc_event *event_128858 = mc_event_new(ctx);
    
    if (event_128858 != NULL)
        event_128858->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128803->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_128803->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128803->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_128803->free_A_mem_111707, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_segred_stage_1_parloop_struct_128803->free_bytes_111715;
    struct memblock mem_112431 = {.desc ="mem_112431", .mem =futhark_mc_segred_stage_1_parloop_struct_128803->free_mem_112431, .size =0, .references =NULL};
    struct memblock mem_112463 = {.desc ="mem_112463", .mem =futhark_mc_segred_stage_1_parloop_struct_128803->free_mem_112463, .size =0, .references =NULL};
    struct memblock mem_112466 = {.desc ="mem_112466", .mem =futhark_mc_segred_stage_1_parloop_struct_128803->free_mem_112466, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125753 = {.desc ="reduce_stage_1_tid_res_arr_mem_125753", .mem =futhark_mc_segred_stage_1_parloop_struct_128803->free_reduce_stage_1_tid_res_arr_mem_125753, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125755 = {.desc ="reduce_stage_1_tid_res_arr_mem_125755", .mem =futhark_mc_segred_stage_1_parloop_struct_128803->free_reduce_stage_1_tid_res_arr_mem_125755, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t mem_120934_cached_sizze_128805 = 0;
    unsigned char *mem_120934 = NULL;
    int64_t flat_tid_120914;
    
    flat_tid_120914 = subtask_id;
    {
        double eta_p_125757;
        double eta_p_125758;
        double eta_p_125760;
        double eta_p_125761;
        double local_acc_125763 = 0.0;
        double local_acc_125764 = 0.0;
        double eta_p_120916;
        double eta_p_120917;
        double eta_p_120919;
        double eta_p_120920;
        double local_acc_125765 = 0.0;
        double local_acc_125766 = 0.0;
        int64_t start_125767;
        int64_t end_125768;
        
        start_125767 = start;
        end_125768 = end;
        
        int64_t n_125769 = end_125768 - start_125767;
        
        if (mem_120934_cached_sizze_128805 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_120934, &mem_120934_cached_sizze_128805, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        for (int64_t SegRed_i_125770 = start_125767; SegRed_i_125770 < start_125767 + n_125769; SegRed_i_125770++) {
            int64_t gtid_120915 = SegRed_i_125770;
            double eta_p_120922 = ((double *) mem_112463.mem)[gtid_120915];
            double defunc_0_reduce_res_120923;
            int64_t flat_tid_120924 = (int64_t) 0;
            
            defunc_0_reduce_res_120923 = 0.0;
            
            struct futhark_mc_task_128806 futhark_mc_task_128806_;
            
            futhark_mc_task_128806_.ctx = ctx;
            futhark_mc_task_128806_.free_m_33388 = m_33388;
            futhark_mc_task_128806_.free_eta_p_106382 = eta_p_106382;
            futhark_mc_task_128806_.free_A_mem_111707 = A_mem_111707.mem;
            futhark_mc_task_128806_.free_mem_112463 = mem_112463.mem;
            futhark_mc_task_128806_.free_gtid_120915 = gtid_120915;
            futhark_mc_task_128806_.free_flat_tid_120924 = flat_tid_120924;
            futhark_mc_task_128806_.retval_defunc_0_reduce_res_120923 = (double *) &defunc_0_reduce_res_120923;
            #if ISPC
            futhark_mc_task_128806_.retval_defunc_0_reduce_res_120923 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_128806_task;
            
            futhark_mc_task_128806_task.args = &futhark_mc_task_128806_;
            futhark_mc_task_128806_task.top_level_fn = futhark_mc_segred_task_128807;
            futhark_mc_task_128806_task.name = "futhark_mc_segred_task_128807";
            futhark_mc_task_128806_task.iterations = m_33388;
            futhark_mc_task_128806_task.task_time = &ctx->program->futhark_mc_segred_task_128807_total_time;
            futhark_mc_task_128806_task.task_iter = &ctx->program->futhark_mc_segred_task_128807_total_iter;
            futhark_mc_task_128806_task.sched = STATIC;
            futhark_mc_task_128806_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_128807_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128806_task);
            
            if (futhark_mc_segred_task_128807_err != 0) {
                err = futhark_mc_segred_task_128807_err;
                goto cleanup;
            }
            
            double zt_res_120933 = eta_p_120922 * defunc_0_reduce_res_120923;
            int64_t flat_tid_120947 = (int64_t) 0;
            int64_t flat_tid_120936 = (int64_t) 0;
            struct futhark_mc_task_128814 futhark_mc_task_128814_;
            
            futhark_mc_task_128814_.ctx = ctx;
            futhark_mc_task_128814_.free_m_33388 = m_33388;
            futhark_mc_task_128814_.free_eta_p_106382 = eta_p_106382;
            futhark_mc_task_128814_.free_A_mem_111707 = A_mem_111707.mem;
            futhark_mc_task_128814_.free_mem_112466 = mem_112466.mem;
            futhark_mc_task_128814_.free_gtid_120915 = gtid_120915;
            futhark_mc_task_128814_.free_mem_120934 = mem_120934;
            
            struct scheduler_segop futhark_mc_task_128814_task;
            
            futhark_mc_task_128814_task.args = &futhark_mc_task_128814_;
            futhark_mc_task_128814_task.top_level_fn = futhark_mc_segmap_task_128815;
            futhark_mc_task_128814_task.name = "futhark_mc_segmap_task_128815";
            futhark_mc_task_128814_task.iterations = m_33388;
            futhark_mc_task_128814_task.task_time = &ctx->program->futhark_mc_segmap_task_128815_total_time;
            futhark_mc_task_128814_task.task_iter = &ctx->program->futhark_mc_segmap_task_128815_total_iter;
            futhark_mc_task_128814_task.sched = STATIC;
            futhark_mc_task_128814_task.nested_fn = futhark_mc_segmap_nested_task_128821;
            
            int futhark_mc_segmap_task_128815_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128814_task);
            
            if (futhark_mc_segmap_task_128815_err != 0) {
                err = futhark_mc_segmap_task_128815_err;
                goto cleanup;
            }
            
            double defunc_0_reduce_res_120956;
            int64_t flat_tid_120973 = (int64_t) 0;
            
            defunc_0_reduce_res_120956 = 0.0;
            
            int64_t flat_tid_120957 = (int64_t) 0;
            struct futhark_mc_task_128835 futhark_mc_task_128835_;
            
            futhark_mc_task_128835_.ctx = ctx;
            futhark_mc_task_128835_.free_m_33388 = m_33388;
            futhark_mc_task_128835_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
            futhark_mc_task_128835_.free_mem_112431 = mem_112431.mem;
            futhark_mc_task_128835_.free_mem_112466 = mem_112466.mem;
            futhark_mc_task_128835_.free_gtid_120915 = gtid_120915;
            futhark_mc_task_128835_.free_mem_120934 = mem_120934;
            futhark_mc_task_128835_.free_flat_tid_120957 = flat_tid_120957;
            futhark_mc_task_128835_.free_flat_tid_120973 = flat_tid_120973;
            futhark_mc_task_128835_.retval_defunc_0_reduce_res_120956 = (double *) &defunc_0_reduce_res_120956;
            #if ISPC
            futhark_mc_task_128835_.retval_defunc_0_reduce_res_120956 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_128835_task;
            
            futhark_mc_task_128835_task.args = &futhark_mc_task_128835_;
            futhark_mc_task_128835_task.top_level_fn = futhark_mc_segred_task_128836;
            futhark_mc_task_128835_task.name = "futhark_mc_segred_task_128836";
            futhark_mc_task_128835_task.iterations = m_33388;
            futhark_mc_task_128835_task.task_time = &ctx->program->futhark_mc_segred_task_128836_total_time;
            futhark_mc_task_128835_task.task_iter = &ctx->program->futhark_mc_segred_task_128836_total_iter;
            futhark_mc_task_128835_task.sched = STATIC;
            futhark_mc_task_128835_task.nested_fn = futhark_mc_segred_nested_task_128843;
            
            int futhark_mc_segred_task_128836_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128835_task);
            
            if (futhark_mc_segred_task_128836_err != 0) {
                err = futhark_mc_segred_task_128836_err;
                goto cleanup;
            }
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_120916 = local_acc_125765;
            }
            // Load next params
            {
                eta_p_120917 = zt_res_120933;
            }
            // SegRed body
            {
                double zp_res_120918 = eta_p_120916 + eta_p_120917;
                
                local_acc_125765 = zp_res_120918;
            }
            // Load accum params
            {
                eta_p_120919 = local_acc_125766;
            }
            // Load next params
            {
                eta_p_120920 = defunc_0_reduce_res_120956;
            }
            // SegRed body
            {
                double zp_res_120921 = eta_p_120919 + eta_p_120920;
                
                local_acc_125766 = zp_res_120921;
            }
        }
        
        int64_t uni_i_125886 = 0;
        
        {
            int64_t gtid_120915 = uni_i_125886;
            
            // Load accum params
            {
                eta_p_125757 = local_acc_125763;
            }
            // Load next params
            {
                eta_p_125758 = local_acc_125765;
            }
            // SegRed body
            {
                double zp_res_125759 = eta_p_125757 + eta_p_125758;
                
                local_acc_125763 = zp_res_125759;
            }
            // Load accum params
            {
                eta_p_125760 = local_acc_125764;
            }
            // Load next params
            {
                eta_p_125761 = local_acc_125766;
            }
            // SegRed body
            {
                double zp_res_125762 = eta_p_125760 + eta_p_125761;
                
                local_acc_125764 = zp_res_125762;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_125753.mem)[flat_tid_120914] = local_acc_125763;
        ((double *) reduce_stage_1_tid_res_arr_mem_125755.mem)[flat_tid_120914] = local_acc_125764;
    }
    
  cleanup:
    {
        free(mem_120934);
    }
    if (event_128858 != NULL) {
        event_128858->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128804", strdup("nothing further"), event_128858, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_128800(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128790 *futhark_mc_task_128790 = (struct futhark_mc_task_128790 *) args;
    struct futhark_context *ctx = futhark_mc_task_128790->ctx;
    struct mc_event *event_128860 = mc_event_new(ctx);
    
    if (event_128860 != NULL)
        event_128860->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128790->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_128790->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128790->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_128790->free_A_mem_111707, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_task_128790->free_bytes_111715;
    struct memblock mem_112431 = {.desc ="mem_112431", .mem =futhark_mc_task_128790->free_mem_112431, .size =0, .references =NULL};
    struct memblock mem_112463 = {.desc ="mem_112463", .mem =futhark_mc_task_128790->free_mem_112463, .size =0, .references =NULL};
    struct memblock mem_112466 = {.desc ="mem_112466", .mem =futhark_mc_task_128790->free_mem_112466, .size =0, .references =NULL};
    int64_t flat_tid_120914 = futhark_mc_task_128790->free_flat_tid_120914;
    int64_t flat_tid_120987 = futhark_mc_task_128790->free_flat_tid_120987;
    double defunc_0_reduce_res_120912 = *futhark_mc_task_128790->retval_defunc_0_reduce_res_120912;
    double defunc_res_120913 = *futhark_mc_task_128790->retval_defunc_res_120913;
    int64_t reduce_stage_1_tid_res_arr_mem_125753_cached_sizze_128801 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125753 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_125755_cached_sizze_128802 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125755 = NULL;
    int32_t nsubtasks_125752;
    
    nsubtasks_125752 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_125753_cached_sizze_128801 < (int64_t) 8 * nsubtasks_125752) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125753, &reduce_stage_1_tid_res_arr_mem_125753_cached_sizze_128801, (int64_t) 8 * nsubtasks_125752);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_125755_cached_sizze_128802 < (int64_t) 8 * nsubtasks_125752) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125755, &reduce_stage_1_tid_res_arr_mem_125755_cached_sizze_128802, (int64_t) 8 * nsubtasks_125752);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128803 futhark_mc_segred_stage_1_parloop_struct_128803_;
    
    futhark_mc_segred_stage_1_parloop_struct_128803_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128803_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128803_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_128803_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128803_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_128803_.free_bytes_111715 = bytes_111715;
    futhark_mc_segred_stage_1_parloop_struct_128803_.free_mem_112431 = mem_112431.mem;
    futhark_mc_segred_stage_1_parloop_struct_128803_.free_mem_112463 = mem_112463.mem;
    futhark_mc_segred_stage_1_parloop_struct_128803_.free_mem_112466 = mem_112466.mem;
    futhark_mc_segred_stage_1_parloop_struct_128803_.free_reduce_stage_1_tid_res_arr_mem_125753 = reduce_stage_1_tid_res_arr_mem_125753;
    futhark_mc_segred_stage_1_parloop_struct_128803_.free_reduce_stage_1_tid_res_arr_mem_125755 = reduce_stage_1_tid_res_arr_mem_125755;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128804_task;
    
    futhark_mc_segred_stage_1_parloop_128804_task.name = "futhark_mc_segred_stage_1_parloop_128804";
    futhark_mc_segred_stage_1_parloop_128804_task.fn = futhark_mc_segred_stage_1_parloop_128804;
    futhark_mc_segred_stage_1_parloop_128804_task.args = &futhark_mc_segred_stage_1_parloop_struct_128803_;
    futhark_mc_segred_stage_1_parloop_128804_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128804_task.info = info;
    
    struct mc_event *event_128859 = mc_event_new(ctx);
    
    if (event_128859 != NULL)
        event_128859->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128804_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128804_task);
    
    if (futhark_mc_segred_stage_1_parloop_128804_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128804_err;
        goto cleanup;
    }
    if (event_128859 != NULL) {
        event_128859->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128804_total", strdup("nothing further"), event_128859, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_120912 = 0.0;
        defunc_res_120913 = 0.0;
    }
    
    double eta_p_125887;
    double eta_p_125888;
    double eta_p_125890;
    double eta_p_125891;
    
    for (int32_t i_125893 = 0; i_125893 < nsubtasks_125752; i_125893++) {
        flat_tid_120914 = i_125893;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_125887 = defunc_0_reduce_res_120912;
            }
            // load next params
            {
                eta_p_125888 = ((double *) reduce_stage_1_tid_res_arr_mem_125753)[flat_tid_120914];
            }
            // red body
            {
                double zp_res_125889 = eta_p_125887 + eta_p_125888;
                
                defunc_0_reduce_res_120912 = zp_res_125889;
            }
            // load acc params
            {
                eta_p_125890 = defunc_res_120913;
            }
            // load next params
            {
                eta_p_125891 = ((double *) reduce_stage_1_tid_res_arr_mem_125755)[flat_tid_120914];
            }
            // red body
            {
                double zp_res_125892 = eta_p_125890 + eta_p_125891;
                
                defunc_res_120913 = zp_res_125892;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_125753);
        free(reduce_stage_1_tid_res_arr_mem_125755);
    }
    if (event_128860 != NULL) {
        event_128860->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_128800", strdup("nothing further"), event_128860, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128790->retval_defunc_0_reduce_res_120912 = defunc_0_reduce_res_120912;
        *futhark_mc_task_128790->retval_defunc_res_120913 = defunc_res_120913;
    }
    return err;
}
struct futhark_mc_task_128861 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112471;
    int64_t free_flat_tid_121032;
    int64_t free_flat_tid_121049;
    double *retval_defunc_0_reduce_res_121031;
};
struct futhark_mc_segred_stage_1_parloop_struct_128864 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112471;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125895;
};
static int futhark_mc_segred_stage_1_parloop_128865(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128864 *futhark_mc_segred_stage_1_parloop_struct_128864 = (struct futhark_mc_segred_stage_1_parloop_struct_128864 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128864->ctx;
    struct mc_event *event_128866 = mc_event_new(ctx);
    
    if (event_128866 != NULL)
        event_128866->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128864->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128864->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_128864->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112471 = {.desc ="mem_112471", .mem =futhark_mc_segred_stage_1_parloop_struct_128864->free_mem_112471, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125895 = {.desc ="reduce_stage_1_tid_res_arr_mem_125895", .mem =futhark_mc_segred_stage_1_parloop_struct_128864->free_reduce_stage_1_tid_res_arr_mem_125895, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121049;
    
    flat_tid_121049 = subtask_id;
    {
        double eta_p_125897;
        double eta_p_125898;
        double local_acc_125900 = 0.0;
        double eta_p_121051;
        double eta_p_121052;
        double local_acc_125901 = 0.0;
        int64_t start_125902;
        int64_t end_125903;
        
        start_125902 = start;
        end_125903 = end;
        
        int64_t n_125904 = end_125903 - start_125902;
        
        for (int64_t SegRed_i_125905 = start_125902; SegRed_i_125905 < start_125902 + n_125904; SegRed_i_125905++) {
            int64_t gtid_121050 = SegRed_i_125905;
            double eta_p_121054 = ((double *) mem_112471.mem)[gtid_121050];
            double defunc_0_reduce_res_121055;
            double redout_121057 = 0.0;
            
            for (int64_t i_121056 = 0; i_121056 < m_33388; i_121056++) {
                double eta_p_121058 = ((double *) A_mem_111707.mem)[lifted_lambda_res_106391 * (m_33388 * m_33388) + gtid_121050 * m_33388 + i_121056];
                double eta_p_121059 = ((double *) mem_112471.mem)[i_121056];
                double zt_res_121060 = eta_p_121058 * eta_p_121058;
                double zt_res_121061 = eta_p_121059 * zt_res_121060;
                double zp_res_121062 = zt_res_121061 + redout_121057;
                double redout_tmp_125906 = zp_res_121062;
                
                redout_121057 = redout_tmp_125906;
            }
            defunc_0_reduce_res_121055 = redout_121057;
            
            double zt_res_121063 = eta_p_121054 * defunc_0_reduce_res_121055;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_121051 = local_acc_125901;
            }
            // Load next params
            {
                eta_p_121052 = zt_res_121063;
            }
            // SegRed body
            {
                double zp_res_121053 = eta_p_121051 + eta_p_121052;
                
                local_acc_125901 = zp_res_121053;
            }
        }
        
        int64_t uni_i_125907 = 0;
        
        {
            int64_t gtid_121050 = uni_i_125907;
            
            // Load accum params
            {
                eta_p_125897 = local_acc_125900;
            }
            // Load next params
            {
                eta_p_125898 = local_acc_125901;
            }
            // SegRed body
            {
                double zp_res_125899 = eta_p_125897 + eta_p_125898;
                
                local_acc_125900 = zp_res_125899;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_125895.mem)[flat_tid_121049] = local_acc_125900;
    }
    
  cleanup:
    { }
    if (event_128866 != NULL) {
        event_128866->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128865", strdup("nothing further"), event_128866, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128862(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128861 *futhark_mc_task_128861 = (struct futhark_mc_task_128861 *) args;
    struct futhark_context *ctx = futhark_mc_task_128861->ctx;
    struct mc_event *event_128868 = mc_event_new(ctx);
    
    if (event_128868 != NULL)
        event_128868->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128861->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128861->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_128861->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112471 = {.desc ="mem_112471", .mem =futhark_mc_task_128861->free_mem_112471, .size =0, .references =NULL};
    int64_t flat_tid_121032 = futhark_mc_task_128861->free_flat_tid_121032;
    int64_t flat_tid_121049 = futhark_mc_task_128861->free_flat_tid_121049;
    double defunc_0_reduce_res_121031 = *futhark_mc_task_128861->retval_defunc_0_reduce_res_121031;
    int64_t reduce_stage_1_tid_res_arr_mem_125895_cached_sizze_128863 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125895 = NULL;
    int32_t nsubtasks_125894;
    
    nsubtasks_125894 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_125895_cached_sizze_128863 < (int64_t) 8 * nsubtasks_125894) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125895, &reduce_stage_1_tid_res_arr_mem_125895_cached_sizze_128863, (int64_t) 8 * nsubtasks_125894);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128864 futhark_mc_segred_stage_1_parloop_struct_128864_;
    
    futhark_mc_segred_stage_1_parloop_struct_128864_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128864_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128864_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128864_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_128864_.free_mem_112471 = mem_112471.mem;
    futhark_mc_segred_stage_1_parloop_struct_128864_.free_reduce_stage_1_tid_res_arr_mem_125895 = reduce_stage_1_tid_res_arr_mem_125895;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128865_task;
    
    futhark_mc_segred_stage_1_parloop_128865_task.name = "futhark_mc_segred_stage_1_parloop_128865";
    futhark_mc_segred_stage_1_parloop_128865_task.fn = futhark_mc_segred_stage_1_parloop_128865;
    futhark_mc_segred_stage_1_parloop_128865_task.args = &futhark_mc_segred_stage_1_parloop_struct_128864_;
    futhark_mc_segred_stage_1_parloop_128865_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128865_task.info = info;
    
    struct mc_event *event_128867 = mc_event_new(ctx);
    
    if (event_128867 != NULL)
        event_128867->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128865_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128865_task);
    
    if (futhark_mc_segred_stage_1_parloop_128865_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128865_err;
        goto cleanup;
    }
    if (event_128867 != NULL) {
        event_128867->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128865_total", strdup("nothing further"), event_128867, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_121031 = 0.0;
    }
    
    double eta_p_125908;
    double eta_p_125909;
    
    for (int32_t i_125911 = 0; i_125911 < nsubtasks_125894; i_125911++) {
        flat_tid_121049 = i_125911;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_125908 = defunc_0_reduce_res_121031;
            }
            // load next params
            {
                eta_p_125909 = ((double *) reduce_stage_1_tid_res_arr_mem_125895)[flat_tid_121049];
            }
            // red body
            {
                double zp_res_125910 = eta_p_125908 + eta_p_125909;
                
                defunc_0_reduce_res_121031 = zp_res_125910;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_125895);
    }
    if (event_128868 != NULL) {
        event_128868->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128862", strdup("nothing further"), event_128868, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128861->retval_defunc_0_reduce_res_121031 = defunc_0_reduce_res_121031;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_128871 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112471;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125913;
};
struct futhark_mc_task_128873 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112471;
    int64_t free_gtid_121033;
    int64_t free_flat_tid_121039;
    double *retval_defunc_0_reduce_res_121038;
};
struct futhark_mc_segred_stage_1_parloop_struct_128876 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112471;
    int64_t free_gtid_121033;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125925;
};
static int futhark_mc_segred_stage_1_parloop_128877(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128876 *futhark_mc_segred_stage_1_parloop_struct_128876 = (struct futhark_mc_segred_stage_1_parloop_struct_128876 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128876->ctx;
    struct mc_event *event_128878 = mc_event_new(ctx);
    
    if (event_128878 != NULL)
        event_128878->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128876->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128876->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_128876->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112471 = {.desc ="mem_112471", .mem =futhark_mc_segred_stage_1_parloop_struct_128876->free_mem_112471, .size =0, .references =NULL};
    int64_t gtid_121033 = futhark_mc_segred_stage_1_parloop_struct_128876->free_gtid_121033;
    struct memblock reduce_stage_1_tid_res_arr_mem_125925 = {.desc ="reduce_stage_1_tid_res_arr_mem_125925", .mem =futhark_mc_segred_stage_1_parloop_struct_128876->free_reduce_stage_1_tid_res_arr_mem_125925, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121039;
    
    flat_tid_121039 = subtask_id;
    {
        double eta_p_125927;
        double eta_p_125928;
        double local_acc_125930 = 0.0;
        double eta_p_121041;
        double eta_p_121042;
        double local_acc_125931 = 0.0;
        int64_t start_125932;
        int64_t end_125933;
        
        start_125932 = start;
        end_125933 = end;
        
        int64_t n_125934 = end_125933 - start_125932;
        
        for (int64_t SegRed_i_125935 = start_125932; SegRed_i_125935 < start_125932 + n_125934; SegRed_i_125935++) {
            int64_t gtid_121040 = SegRed_i_125935;
            double eta_p_121044 = ((double *) A_mem_111707.mem)[lifted_lambda_res_106391 * (m_33388 * m_33388) + gtid_121033 * m_33388 + gtid_121040];
            double eta_p_121045 = ((double *) mem_112471.mem)[gtid_121040];
            double zt_res_121046 = eta_p_121044 * eta_p_121044;
            double zt_res_121047 = eta_p_121045 * zt_res_121046;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_121041 = local_acc_125931;
            }
            // Load next params
            {
                eta_p_121042 = zt_res_121047;
            }
            // SegRed body
            {
                double zp_res_121043 = eta_p_121041 + eta_p_121042;
                
                local_acc_125931 = zp_res_121043;
            }
        }
        
        int64_t uni_i_125936 = 0;
        
        {
            int64_t gtid_121040 = uni_i_125936;
            
            // Load accum params
            {
                eta_p_125927 = local_acc_125930;
            }
            // Load next params
            {
                eta_p_125928 = local_acc_125931;
            }
            // SegRed body
            {
                double zp_res_125929 = eta_p_125927 + eta_p_125928;
                
                local_acc_125930 = zp_res_125929;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_125925.mem)[flat_tid_121039] = local_acc_125930;
    }
    
  cleanup:
    { }
    if (event_128878 != NULL) {
        event_128878->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128877", strdup("nothing further"), event_128878, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128874(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128873 *futhark_mc_task_128873 = (struct futhark_mc_task_128873 *) args;
    struct futhark_context *ctx = futhark_mc_task_128873->ctx;
    struct mc_event *event_128880 = mc_event_new(ctx);
    
    if (event_128880 != NULL)
        event_128880->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128873->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128873->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_128873->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112471 = {.desc ="mem_112471", .mem =futhark_mc_task_128873->free_mem_112471, .size =0, .references =NULL};
    int64_t gtid_121033 = futhark_mc_task_128873->free_gtid_121033;
    int64_t flat_tid_121039 = futhark_mc_task_128873->free_flat_tid_121039;
    double defunc_0_reduce_res_121038 = *futhark_mc_task_128873->retval_defunc_0_reduce_res_121038;
    int64_t reduce_stage_1_tid_res_arr_mem_125925_cached_sizze_128875 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125925 = NULL;
    int32_t nsubtasks_125924;
    
    nsubtasks_125924 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_125925_cached_sizze_128875 < (int64_t) 8 * nsubtasks_125924) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125925, &reduce_stage_1_tid_res_arr_mem_125925_cached_sizze_128875, (int64_t) 8 * nsubtasks_125924);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128876 futhark_mc_segred_stage_1_parloop_struct_128876_;
    
    futhark_mc_segred_stage_1_parloop_struct_128876_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128876_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128876_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128876_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_128876_.free_mem_112471 = mem_112471.mem;
    futhark_mc_segred_stage_1_parloop_struct_128876_.free_gtid_121033 = gtid_121033;
    futhark_mc_segred_stage_1_parloop_struct_128876_.free_reduce_stage_1_tid_res_arr_mem_125925 = reduce_stage_1_tid_res_arr_mem_125925;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128877_task;
    
    futhark_mc_segred_stage_1_parloop_128877_task.name = "futhark_mc_segred_stage_1_parloop_128877";
    futhark_mc_segred_stage_1_parloop_128877_task.fn = futhark_mc_segred_stage_1_parloop_128877;
    futhark_mc_segred_stage_1_parloop_128877_task.args = &futhark_mc_segred_stage_1_parloop_struct_128876_;
    futhark_mc_segred_stage_1_parloop_128877_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128877_task.info = info;
    
    struct mc_event *event_128879 = mc_event_new(ctx);
    
    if (event_128879 != NULL)
        event_128879->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128877_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128877_task);
    
    if (futhark_mc_segred_stage_1_parloop_128877_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128877_err;
        goto cleanup;
    }
    if (event_128879 != NULL) {
        event_128879->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128877_total", strdup("nothing further"), event_128879, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_121038 = 0.0;
    }
    
    double eta_p_125937;
    double eta_p_125938;
    
    for (int32_t i_125940 = 0; i_125940 < nsubtasks_125924; i_125940++) {
        flat_tid_121039 = i_125940;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_125937 = defunc_0_reduce_res_121038;
            }
            // load next params
            {
                eta_p_125938 = ((double *) reduce_stage_1_tid_res_arr_mem_125925)[flat_tid_121039];
            }
            // red body
            {
                double zp_res_125939 = eta_p_125937 + eta_p_125938;
                
                defunc_0_reduce_res_121038 = zp_res_125939;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_125925);
    }
    if (event_128880 != NULL) {
        event_128880->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128874", strdup("nothing further"), event_128880, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128873->retval_defunc_0_reduce_res_121038 = defunc_0_reduce_res_121038;
    }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_128872(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128871 *futhark_mc_segred_stage_1_parloop_struct_128871 = (struct futhark_mc_segred_stage_1_parloop_struct_128871 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128871->ctx;
    struct mc_event *event_128881 = mc_event_new(ctx);
    
    if (event_128881 != NULL)
        event_128881->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128871->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128871->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_128871->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112471 = {.desc ="mem_112471", .mem =futhark_mc_segred_stage_1_parloop_struct_128871->free_mem_112471, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125913 = {.desc ="reduce_stage_1_tid_res_arr_mem_125913", .mem =futhark_mc_segred_stage_1_parloop_struct_128871->free_reduce_stage_1_tid_res_arr_mem_125913, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121032;
    
    flat_tid_121032 = subtask_id;
    {
        double eta_p_125915;
        double eta_p_125916;
        double local_acc_125918 = 0.0;
        double eta_p_121034;
        double eta_p_121035;
        double local_acc_125919 = 0.0;
        int64_t start_125920;
        int64_t end_125921;
        
        start_125920 = start;
        end_125921 = end;
        
        int64_t n_125922 = end_125921 - start_125920;
        
        for (int64_t SegRed_i_125923 = start_125920; SegRed_i_125923 < start_125920 + n_125922; SegRed_i_125923++) {
            int64_t gtid_121033 = SegRed_i_125923;
            double eta_p_121037 = ((double *) mem_112471.mem)[gtid_121033];
            double defunc_0_reduce_res_121038;
            int64_t flat_tid_121039 = (int64_t) 0;
            
            defunc_0_reduce_res_121038 = 0.0;
            
            struct futhark_mc_task_128873 futhark_mc_task_128873_;
            
            futhark_mc_task_128873_.ctx = ctx;
            futhark_mc_task_128873_.free_m_33388 = m_33388;
            futhark_mc_task_128873_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
            futhark_mc_task_128873_.free_A_mem_111707 = A_mem_111707.mem;
            futhark_mc_task_128873_.free_mem_112471 = mem_112471.mem;
            futhark_mc_task_128873_.free_gtid_121033 = gtid_121033;
            futhark_mc_task_128873_.free_flat_tid_121039 = flat_tid_121039;
            futhark_mc_task_128873_.retval_defunc_0_reduce_res_121038 = (double *) &defunc_0_reduce_res_121038;
            #if ISPC
            futhark_mc_task_128873_.retval_defunc_0_reduce_res_121038 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_128873_task;
            
            futhark_mc_task_128873_task.args = &futhark_mc_task_128873_;
            futhark_mc_task_128873_task.top_level_fn = futhark_mc_segred_task_128874;
            futhark_mc_task_128873_task.name = "futhark_mc_segred_task_128874";
            futhark_mc_task_128873_task.iterations = m_33388;
            futhark_mc_task_128873_task.task_time = &ctx->program->futhark_mc_segred_task_128874_total_time;
            futhark_mc_task_128873_task.task_iter = &ctx->program->futhark_mc_segred_task_128874_total_iter;
            futhark_mc_task_128873_task.sched = STATIC;
            futhark_mc_task_128873_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_128874_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128873_task);
            
            if (futhark_mc_segred_task_128874_err != 0) {
                err = futhark_mc_segred_task_128874_err;
                goto cleanup;
            }
            
            double zt_res_121048 = eta_p_121037 * defunc_0_reduce_res_121038;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_121034 = local_acc_125919;
            }
            // Load next params
            {
                eta_p_121035 = zt_res_121048;
            }
            // SegRed body
            {
                double zp_res_121036 = eta_p_121034 + eta_p_121035;
                
                local_acc_125919 = zp_res_121036;
            }
        }
        
        int64_t uni_i_125941 = 0;
        
        {
            int64_t gtid_121033 = uni_i_125941;
            
            // Load accum params
            {
                eta_p_125915 = local_acc_125918;
            }
            // Load next params
            {
                eta_p_125916 = local_acc_125919;
            }
            // SegRed body
            {
                double zp_res_125917 = eta_p_125915 + eta_p_125916;
                
                local_acc_125918 = zp_res_125917;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_125913.mem)[flat_tid_121032] = local_acc_125918;
    }
    
  cleanup:
    { }
    if (event_128881 != NULL) {
        event_128881->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128872", strdup("nothing further"), event_128881, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_128869(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128861 *futhark_mc_task_128861 = (struct futhark_mc_task_128861 *) args;
    struct futhark_context *ctx = futhark_mc_task_128861->ctx;
    struct mc_event *event_128883 = mc_event_new(ctx);
    
    if (event_128883 != NULL)
        event_128883->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128861->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128861->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_128861->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112471 = {.desc ="mem_112471", .mem =futhark_mc_task_128861->free_mem_112471, .size =0, .references =NULL};
    int64_t flat_tid_121032 = futhark_mc_task_128861->free_flat_tid_121032;
    int64_t flat_tid_121049 = futhark_mc_task_128861->free_flat_tid_121049;
    double defunc_0_reduce_res_121031 = *futhark_mc_task_128861->retval_defunc_0_reduce_res_121031;
    int64_t reduce_stage_1_tid_res_arr_mem_125913_cached_sizze_128870 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125913 = NULL;
    int32_t nsubtasks_125912;
    
    nsubtasks_125912 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_125913_cached_sizze_128870 < (int64_t) 8 * nsubtasks_125912) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125913, &reduce_stage_1_tid_res_arr_mem_125913_cached_sizze_128870, (int64_t) 8 * nsubtasks_125912);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128871 futhark_mc_segred_stage_1_parloop_struct_128871_;
    
    futhark_mc_segred_stage_1_parloop_struct_128871_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128871_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128871_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128871_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_128871_.free_mem_112471 = mem_112471.mem;
    futhark_mc_segred_stage_1_parloop_struct_128871_.free_reduce_stage_1_tid_res_arr_mem_125913 = reduce_stage_1_tid_res_arr_mem_125913;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128872_task;
    
    futhark_mc_segred_stage_1_parloop_128872_task.name = "futhark_mc_segred_stage_1_parloop_128872";
    futhark_mc_segred_stage_1_parloop_128872_task.fn = futhark_mc_segred_stage_1_parloop_128872;
    futhark_mc_segred_stage_1_parloop_128872_task.args = &futhark_mc_segred_stage_1_parloop_struct_128871_;
    futhark_mc_segred_stage_1_parloop_128872_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128872_task.info = info;
    
    struct mc_event *event_128882 = mc_event_new(ctx);
    
    if (event_128882 != NULL)
        event_128882->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128872_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128872_task);
    
    if (futhark_mc_segred_stage_1_parloop_128872_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128872_err;
        goto cleanup;
    }
    if (event_128882 != NULL) {
        event_128882->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128872_total", strdup("nothing further"), event_128882, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_121031 = 0.0;
    }
    
    double eta_p_125942;
    double eta_p_125943;
    
    for (int32_t i_125945 = 0; i_125945 < nsubtasks_125912; i_125945++) {
        flat_tid_121032 = i_125945;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_125942 = defunc_0_reduce_res_121031;
            }
            // load next params
            {
                eta_p_125943 = ((double *) reduce_stage_1_tid_res_arr_mem_125913)[flat_tid_121032];
            }
            // red body
            {
                double zp_res_125944 = eta_p_125942 + eta_p_125943;
                
                defunc_0_reduce_res_121031 = zp_res_125944;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_125913);
    }
    if (event_128883 != NULL) {
        event_128883->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_128869", strdup("nothing further"), event_128883, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128861->retval_defunc_0_reduce_res_121031 = defunc_0_reduce_res_121031;
    }
    return err;
}
struct futhark_mc_task_128884 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    int64_t free_bytes_111715;
    unsigned char *free_mem_param_118928;
    unsigned char *free_mem_param_121100;
    int64_t free_flat_tid_121113;
    int64_t free_flat_tid_121159;
    double *retval_defunc_res_121107;
    double *retval_defunc_res_121108;
    double *retval_defunc_res_121109;
    unsigned char *retval_mem_112507;
    unsigned char *retval_mem_112510;
    unsigned char *retval_mem_param_out_121101;
};
struct futhark_mc_segred_stage_1_parloop_struct_128889 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    int64_t free_bytes_111715;
    unsigned char *free_mem_112507;
    unsigned char *free_mem_112510;
    unsigned char *free_mem_param_118928;
    unsigned char *free_mem_param_121100;
    unsigned char *free_mem_param_out_121101;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125953;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125955;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125957;
};
static int futhark_mc_segred_stage_1_parloop_128890(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128889 *futhark_mc_segred_stage_1_parloop_struct_128889 = (struct futhark_mc_segred_stage_1_parloop_struct_128889 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128889->ctx;
    struct mc_event *event_128893 = mc_event_new(ctx);
    
    if (event_128893 != NULL)
        event_128893->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128889->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_128889->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128889->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_128889->free_distrs_mem_111708, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_segred_stage_1_parloop_struct_128889->free_bytes_111715;
    struct memblock mem_112507 = {.desc ="mem_112507", .mem =futhark_mc_segred_stage_1_parloop_struct_128889->free_mem_112507, .size =0, .references =NULL};
    struct memblock mem_112510 = {.desc ="mem_112510", .mem =futhark_mc_segred_stage_1_parloop_struct_128889->free_mem_112510, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_segred_stage_1_parloop_struct_128889->free_mem_param_118928, .size =0, .references =NULL};
    struct memblock mem_param_121100 = {.desc ="mem_param_121100", .mem =futhark_mc_segred_stage_1_parloop_struct_128889->free_mem_param_121100, .size =0, .references =NULL};
    struct memblock mem_param_out_121101 = {.desc ="mem_param_out_121101", .mem =futhark_mc_segred_stage_1_parloop_struct_128889->free_mem_param_out_121101, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125953 = {.desc ="reduce_stage_1_tid_res_arr_mem_125953", .mem =futhark_mc_segred_stage_1_parloop_struct_128889->free_reduce_stage_1_tid_res_arr_mem_125953, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125955 = {.desc ="reduce_stage_1_tid_res_arr_mem_125955", .mem =futhark_mc_segred_stage_1_parloop_struct_128889->free_reduce_stage_1_tid_res_arr_mem_125955, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125957 = {.desc ="reduce_stage_1_tid_res_arr_mem_125957", .mem =futhark_mc_segred_stage_1_parloop_struct_128889->free_reduce_stage_1_tid_res_arr_mem_125957, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t mem_121171_cached_sizze_128891 = 0;
    unsigned char *mem_121171 = NULL;
    int64_t mem_121173_cached_sizze_128892 = 0;
    unsigned char *mem_121173 = NULL;
    int64_t flat_tid_121159;
    
    flat_tid_121159 = subtask_id;
    {
        double eta_p_125959;
        double eta_p_125960;
        double eta_p_125962;
        double eta_p_125963;
        double eta_p_125965;
        double eta_p_125966;
        double local_acc_125968 = 0.0;
        double local_acc_125969 = 0.0;
        double local_acc_125970 = 0.0;
        double eta_p_121161;
        double eta_p_121162;
        double eta_p_121164;
        double eta_p_121165;
        double eta_p_121167;
        double eta_p_121168;
        double local_acc_125971 = 0.0;
        double local_acc_125972 = 0.0;
        double local_acc_125973 = 0.0;
        int64_t start_125974;
        int64_t end_125975;
        
        start_125974 = start;
        end_125975 = end;
        
        int64_t n_125976 = end_125975 - start_125974;
        
        if (mem_121171_cached_sizze_128891 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_121171, &mem_121171_cached_sizze_128891, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_121173_cached_sizze_128892 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_121173, &mem_121173_cached_sizze_128892, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        for (int64_t SegRed_i_125977 = start_125974; SegRed_i_125977 < start_125974 + n_125976; SegRed_i_125977++) {
            int64_t gtid_121160 = SegRed_i_125977;
            double eta_p_121170 = ((double *) distrs_mem_111708.mem)[eta_p_106382 * m_33388 + gtid_121160];
            double defunc_res_121175;
            double defunc_res_121176;
            double defunc_res_121177;
            double redout_121181;
            double redout_121182;
            double redout_121183;
            
            redout_121181 = 0.0;
            redout_121182 = 0.0;
            redout_121183 = 0.0;
            for (int64_t i_121180 = 0; i_121180 < m_33388; i_121180++) {
                double eta_p_121186 = ((double *) mem_param_121100.mem)[gtid_121160 * m_33388 + i_121180];
                double eta_p_121187 = ((double *) mem_param_118928.mem)[gtid_121160 * m_33388 + i_121180];
                double eta_p_121188 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + i_121180];
                double zt_res_121189 = 0.5 * eta_p_121186;
                double zp_res_121190 = eta_p_121187 + zt_res_121189;
                double zt_res_121191 = eta_p_121170 * eta_p_121188;
                bool zeze_res_121192 = zp_res_121190 == 0.0;
                double klu_res_121193;
                
                if (zeze_res_121192) {
                    klu_res_121193 = 0.0;
                } else {
                    double zs_res_121194 = zp_res_121190 / zt_res_121191;
                    double log_res_121195 = futrts_log64(zs_res_121194);
                    double zt_res_121196 = zp_res_121190 * log_res_121195;
                    
                    klu_res_121193 = zt_res_121196;
                }
                
                double zp_res_121197 = klu_res_121193 + redout_121181;
                double zp_res_121198 = zp_res_121190 + redout_121182;
                double zp_res_121199 = zp_res_121190 + redout_121183;
                
                ((double *) mem_121171)[i_121180] = zp_res_121190;
                ((double *) mem_121173)[i_121180] = zt_res_121189;
                
                double redout_tmp_125978 = zp_res_121197;
                double redout_tmp_125979 = zp_res_121198;
                double redout_tmp_125980 = zp_res_121199;
                
                redout_121181 = redout_tmp_125978;
                redout_121182 = redout_tmp_125979;
                redout_121183 = redout_tmp_125980;
            }
            defunc_res_121175 = redout_121181;
            defunc_res_121176 = redout_121182;
            defunc_res_121177 = redout_121183;
            
            bool zeze_res_121202 = defunc_res_121177 == 0.0;
            double klu_res_121203;
            
            if (zeze_res_121202) {
                klu_res_121203 = 0.0;
            } else {
                double zs_res_121204 = defunc_res_121177 / eta_p_121170;
                double log_res_121205 = futrts_log64(zs_res_121204);
                double zt_res_121206 = defunc_res_121177 * log_res_121205;
                
                klu_res_121203 = zt_res_121206;
            }
            // save map-out results
            {
                ((double *) mem_112507.mem)[gtid_121160] = defunc_res_121176;
                lmad_copy_8b(ctx, 1, (uint64_t *) mem_112510.mem, gtid_121160 * m_33388, (int64_t []) {(int64_t) 1}, (uint64_t *) mem_121171, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_33388});
                lmad_copy_8b(ctx, 1, (uint64_t *) mem_param_out_121101.mem, gtid_121160 * m_33388, (int64_t []) {(int64_t) 1}, (uint64_t *) mem_121173, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_33388});
            }
            // Load accum params
            {
                eta_p_121161 = local_acc_125971;
            }
            // Load next params
            {
                eta_p_121162 = klu_res_121203;
            }
            // SegRed body
            {
                double zp_res_121163 = eta_p_121161 + eta_p_121162;
                
                local_acc_125971 = zp_res_121163;
            }
            // Load accum params
            {
                eta_p_121164 = local_acc_125972;
            }
            // Load next params
            {
                eta_p_121165 = defunc_res_121177;
            }
            // SegRed body
            {
                double zp_res_121166 = eta_p_121164 + eta_p_121165;
                
                local_acc_125972 = zp_res_121166;
            }
            // Load accum params
            {
                eta_p_121167 = local_acc_125973;
            }
            // Load next params
            {
                eta_p_121168 = defunc_res_121175;
            }
            // SegRed body
            {
                double zp_res_121169 = eta_p_121167 + eta_p_121168;
                
                local_acc_125973 = zp_res_121169;
            }
        }
        
        int64_t uni_i_125983 = 0;
        
        {
            int64_t gtid_121160 = uni_i_125983;
            
            // Load accum params
            {
                eta_p_125959 = local_acc_125968;
            }
            // Load next params
            {
                eta_p_125960 = local_acc_125971;
            }
            // SegRed body
            {
                double zp_res_125961 = eta_p_125959 + eta_p_125960;
                
                local_acc_125968 = zp_res_125961;
            }
            // Load accum params
            {
                eta_p_125962 = local_acc_125969;
            }
            // Load next params
            {
                eta_p_125963 = local_acc_125972;
            }
            // SegRed body
            {
                double zp_res_125964 = eta_p_125962 + eta_p_125963;
                
                local_acc_125969 = zp_res_125964;
            }
            // Load accum params
            {
                eta_p_125965 = local_acc_125970;
            }
            // Load next params
            {
                eta_p_125966 = local_acc_125973;
            }
            // SegRed body
            {
                double zp_res_125967 = eta_p_125965 + eta_p_125966;
                
                local_acc_125970 = zp_res_125967;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_125953.mem)[flat_tid_121159] = local_acc_125968;
        ((double *) reduce_stage_1_tid_res_arr_mem_125955.mem)[flat_tid_121159] = local_acc_125969;
        ((double *) reduce_stage_1_tid_res_arr_mem_125957.mem)[flat_tid_121159] = local_acc_125970;
    }
    
  cleanup:
    {
        free(mem_121171);
        free(mem_121173);
    }
    if (event_128893 != NULL) {
        event_128893->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128890", strdup("nothing further"), event_128893, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128885(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128884 *futhark_mc_task_128884 = (struct futhark_mc_task_128884 *) args;
    struct futhark_context *ctx = futhark_mc_task_128884->ctx;
    struct mc_event *event_128895 = mc_event_new(ctx);
    
    if (event_128895 != NULL)
        event_128895->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128884->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_128884->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128884->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128884->free_distrs_mem_111708, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_task_128884->free_bytes_111715;
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_task_128884->free_mem_param_118928, .size =0, .references =NULL};
    struct memblock mem_param_121100 = {.desc ="mem_param_121100", .mem =futhark_mc_task_128884->free_mem_param_121100, .size =0, .references =NULL};
    int64_t flat_tid_121113 = futhark_mc_task_128884->free_flat_tid_121113;
    int64_t flat_tid_121159 = futhark_mc_task_128884->free_flat_tid_121159;
    double defunc_res_121107 = *futhark_mc_task_128884->retval_defunc_res_121107;
    double defunc_res_121108 = *futhark_mc_task_128884->retval_defunc_res_121108;
    double defunc_res_121109 = *futhark_mc_task_128884->retval_defunc_res_121109;
    struct memblock mem_112507 = {.desc ="mem_112507", .mem =futhark_mc_task_128884->retval_mem_112507, .size =0, .references =NULL};
    struct memblock mem_112510 = {.desc ="mem_112510", .mem =futhark_mc_task_128884->retval_mem_112510, .size =0, .references =NULL};
    struct memblock mem_param_out_121101 = {.desc ="mem_param_out_121101", .mem =futhark_mc_task_128884->retval_mem_param_out_121101, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_125953_cached_sizze_128886 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125953 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_125955_cached_sizze_128887 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125955 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_125957_cached_sizze_128888 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125957 = NULL;
    int32_t nsubtasks_125952;
    
    nsubtasks_125952 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_125953_cached_sizze_128886 < (int64_t) 8 * nsubtasks_125952) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125953, &reduce_stage_1_tid_res_arr_mem_125953_cached_sizze_128886, (int64_t) 8 * nsubtasks_125952);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_125955_cached_sizze_128887 < (int64_t) 8 * nsubtasks_125952) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125955, &reduce_stage_1_tid_res_arr_mem_125955_cached_sizze_128887, (int64_t) 8 * nsubtasks_125952);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_125957_cached_sizze_128888 < (int64_t) 8 * nsubtasks_125952) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125957, &reduce_stage_1_tid_res_arr_mem_125957_cached_sizze_128888, (int64_t) 8 * nsubtasks_125952);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128889 futhark_mc_segred_stage_1_parloop_struct_128889_;
    
    futhark_mc_segred_stage_1_parloop_struct_128889_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128889_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128889_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_128889_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128889_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_128889_.free_bytes_111715 = bytes_111715;
    futhark_mc_segred_stage_1_parloop_struct_128889_.free_mem_112507 = mem_112507.mem;
    futhark_mc_segred_stage_1_parloop_struct_128889_.free_mem_112510 = mem_112510.mem;
    futhark_mc_segred_stage_1_parloop_struct_128889_.free_mem_param_118928 = mem_param_118928.mem;
    futhark_mc_segred_stage_1_parloop_struct_128889_.free_mem_param_121100 = mem_param_121100.mem;
    futhark_mc_segred_stage_1_parloop_struct_128889_.free_mem_param_out_121101 = mem_param_out_121101.mem;
    futhark_mc_segred_stage_1_parloop_struct_128889_.free_reduce_stage_1_tid_res_arr_mem_125953 = reduce_stage_1_tid_res_arr_mem_125953;
    futhark_mc_segred_stage_1_parloop_struct_128889_.free_reduce_stage_1_tid_res_arr_mem_125955 = reduce_stage_1_tid_res_arr_mem_125955;
    futhark_mc_segred_stage_1_parloop_struct_128889_.free_reduce_stage_1_tid_res_arr_mem_125957 = reduce_stage_1_tid_res_arr_mem_125957;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128890_task;
    
    futhark_mc_segred_stage_1_parloop_128890_task.name = "futhark_mc_segred_stage_1_parloop_128890";
    futhark_mc_segred_stage_1_parloop_128890_task.fn = futhark_mc_segred_stage_1_parloop_128890;
    futhark_mc_segred_stage_1_parloop_128890_task.args = &futhark_mc_segred_stage_1_parloop_struct_128889_;
    futhark_mc_segred_stage_1_parloop_128890_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128890_task.info = info;
    
    struct mc_event *event_128894 = mc_event_new(ctx);
    
    if (event_128894 != NULL)
        event_128894->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128890_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128890_task);
    
    if (futhark_mc_segred_stage_1_parloop_128890_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128890_err;
        goto cleanup;
    }
    if (event_128894 != NULL) {
        event_128894->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128890_total", strdup("nothing further"), event_128894, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_121107 = 0.0;
        defunc_res_121108 = 0.0;
        defunc_res_121109 = 0.0;
    }
    
    double eta_p_125984;
    double eta_p_125985;
    double eta_p_125987;
    double eta_p_125988;
    double eta_p_125990;
    double eta_p_125991;
    
    for (int32_t i_125993 = 0; i_125993 < nsubtasks_125952; i_125993++) {
        flat_tid_121159 = i_125993;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_125984 = defunc_res_121107;
            }
            // load next params
            {
                eta_p_125985 = ((double *) reduce_stage_1_tid_res_arr_mem_125953)[flat_tid_121159];
            }
            // red body
            {
                double zp_res_125986 = eta_p_125984 + eta_p_125985;
                
                defunc_res_121107 = zp_res_125986;
            }
            // load acc params
            {
                eta_p_125987 = defunc_res_121108;
            }
            // load next params
            {
                eta_p_125988 = ((double *) reduce_stage_1_tid_res_arr_mem_125955)[flat_tid_121159];
            }
            // red body
            {
                double zp_res_125989 = eta_p_125987 + eta_p_125988;
                
                defunc_res_121108 = zp_res_125989;
            }
            // load acc params
            {
                eta_p_125990 = defunc_res_121109;
            }
            // load next params
            {
                eta_p_125991 = ((double *) reduce_stage_1_tid_res_arr_mem_125957)[flat_tid_121159];
            }
            // red body
            {
                double zp_res_125992 = eta_p_125990 + eta_p_125991;
                
                defunc_res_121109 = zp_res_125992;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_125953);
        free(reduce_stage_1_tid_res_arr_mem_125955);
        free(reduce_stage_1_tid_res_arr_mem_125957);
    }
    if (event_128895 != NULL) {
        event_128895->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128885", strdup("nothing further"), event_128895, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128884->retval_defunc_res_121107 = defunc_res_121107;
        *futhark_mc_task_128884->retval_defunc_res_121108 = defunc_res_121108;
        *futhark_mc_task_128884->retval_defunc_res_121109 = defunc_res_121109;
        futhark_mc_task_128884->retval_mem_112507 = mem_112507.mem;
        futhark_mc_task_128884->retval_mem_112510 = mem_112510.mem;
        futhark_mc_task_128884->retval_mem_param_out_121101 = mem_param_out_121101.mem;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_128900 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    int64_t free_bytes_111715;
    unsigned char *free_mem_112507;
    unsigned char *free_mem_112510;
    unsigned char *free_mem_param_118928;
    unsigned char *free_mem_param_121100;
    unsigned char *free_mem_param_out_121101;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125995;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125997;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_125999;
};
struct futhark_mc_task_128904 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_param_118928;
    unsigned char *free_mem_param_121100;
    int64_t free_gtid_121114;
    double free_eta_p_121124;
    int64_t free_flat_tid_121132;
    double *retval_defunc_res_121127;
    double *retval_defunc_res_121128;
    double *retval_defunc_res_121129;
    unsigned char *retval_mem_121125;
    unsigned char *retval_mem_121126;
};
struct futhark_mc_segred_stage_1_parloop_struct_128909 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_param_118928;
    unsigned char *free_mem_param_121100;
    int64_t free_gtid_121114;
    double free_eta_p_121124;
    unsigned char *free_mem_121125;
    unsigned char *free_mem_121126;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126021;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126023;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126025;
};
static int futhark_mc_segred_stage_1_parloop_128910(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128909 *futhark_mc_segred_stage_1_parloop_struct_128909 = (struct futhark_mc_segred_stage_1_parloop_struct_128909 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128909->ctx;
    struct mc_event *event_128911 = mc_event_new(ctx);
    
    if (event_128911 != NULL)
        event_128911->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128909->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128909->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_128909->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_segred_stage_1_parloop_struct_128909->free_mem_param_118928, .size =0, .references =NULL};
    struct memblock mem_param_121100 = {.desc ="mem_param_121100", .mem =futhark_mc_segred_stage_1_parloop_struct_128909->free_mem_param_121100, .size =0, .references =NULL};
    int64_t gtid_121114 = futhark_mc_segred_stage_1_parloop_struct_128909->free_gtid_121114;
    double eta_p_121124 = futhark_mc_segred_stage_1_parloop_struct_128909->free_eta_p_121124;
    struct memblock mem_121125 = {.desc ="mem_121125", .mem =futhark_mc_segred_stage_1_parloop_struct_128909->free_mem_121125, .size =0, .references =NULL};
    struct memblock mem_121126 = {.desc ="mem_121126", .mem =futhark_mc_segred_stage_1_parloop_struct_128909->free_mem_121126, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126021 = {.desc ="reduce_stage_1_tid_res_arr_mem_126021", .mem =futhark_mc_segred_stage_1_parloop_struct_128909->free_reduce_stage_1_tid_res_arr_mem_126021, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126023 = {.desc ="reduce_stage_1_tid_res_arr_mem_126023", .mem =futhark_mc_segred_stage_1_parloop_struct_128909->free_reduce_stage_1_tid_res_arr_mem_126023, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126025 = {.desc ="reduce_stage_1_tid_res_arr_mem_126025", .mem =futhark_mc_segred_stage_1_parloop_struct_128909->free_reduce_stage_1_tid_res_arr_mem_126025, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121132;
    
    flat_tid_121132 = subtask_id;
    {
        double eta_p_126027;
        double eta_p_126028;
        double eta_p_126030;
        double eta_p_126031;
        double eta_p_126033;
        double eta_p_126034;
        double local_acc_126036 = 0.0;
        double local_acc_126037 = 0.0;
        double local_acc_126038 = 0.0;
        double eta_p_121134;
        double eta_p_121135;
        double eta_p_121137;
        double eta_p_121138;
        double eta_p_121140;
        double eta_p_121141;
        double local_acc_126039 = 0.0;
        double local_acc_126040 = 0.0;
        double local_acc_126041 = 0.0;
        int64_t start_126042;
        int64_t end_126043;
        
        start_126042 = start;
        end_126043 = end;
        
        int64_t n_126044 = end_126043 - start_126042;
        
        for (int64_t SegRed_i_126045 = start_126042; SegRed_i_126045 < start_126042 + n_126044; SegRed_i_126045++) {
            int64_t gtid_121133 = SegRed_i_126045;
            double eta_p_121143 = ((double *) mem_param_121100.mem)[gtid_121114 * m_33388 + gtid_121133];
            double eta_p_121144 = ((double *) mem_param_118928.mem)[gtid_121114 * m_33388 + gtid_121133];
            double eta_p_121145 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + gtid_121133];
            double zt_res_121146 = 0.5 * eta_p_121143;
            double zp_res_121147 = eta_p_121144 + zt_res_121146;
            double zt_res_121148 = eta_p_121124 * eta_p_121145;
            bool zeze_res_121149 = zp_res_121147 == 0.0;
            double klu_res_121150;
            
            if (zeze_res_121149) {
                klu_res_121150 = 0.0;
            } else {
                double zs_res_121151 = zp_res_121147 / zt_res_121148;
                double log_res_121152 = futrts_log64(zs_res_121151);
                double zt_res_121153 = zp_res_121147 * log_res_121152;
                
                klu_res_121150 = zt_res_121153;
            }
            // save map-out results
            {
                ((double *) mem_121125.mem)[gtid_121133] = zp_res_121147;
                ((double *) mem_121126.mem)[gtid_121133] = zt_res_121146;
            }
            // Load accum params
            {
                eta_p_121134 = local_acc_126039;
            }
            // Load next params
            {
                eta_p_121135 = klu_res_121150;
            }
            // SegRed body
            {
                double zp_res_121136 = eta_p_121134 + eta_p_121135;
                
                local_acc_126039 = zp_res_121136;
            }
            // Load accum params
            {
                eta_p_121137 = local_acc_126040;
            }
            // Load next params
            {
                eta_p_121138 = zp_res_121147;
            }
            // SegRed body
            {
                double zp_res_121139 = eta_p_121137 + eta_p_121138;
                
                local_acc_126040 = zp_res_121139;
            }
            // Load accum params
            {
                eta_p_121140 = local_acc_126041;
            }
            // Load next params
            {
                eta_p_121141 = zp_res_121147;
            }
            // SegRed body
            {
                double zp_res_121142 = eta_p_121140 + eta_p_121141;
                
                local_acc_126041 = zp_res_121142;
            }
        }
        
        int64_t uni_i_126046 = 0;
        
        {
            int64_t gtid_121133 = uni_i_126046;
            
            // Load accum params
            {
                eta_p_126027 = local_acc_126036;
            }
            // Load next params
            {
                eta_p_126028 = local_acc_126039;
            }
            // SegRed body
            {
                double zp_res_126029 = eta_p_126027 + eta_p_126028;
                
                local_acc_126036 = zp_res_126029;
            }
            // Load accum params
            {
                eta_p_126030 = local_acc_126037;
            }
            // Load next params
            {
                eta_p_126031 = local_acc_126040;
            }
            // SegRed body
            {
                double zp_res_126032 = eta_p_126030 + eta_p_126031;
                
                local_acc_126037 = zp_res_126032;
            }
            // Load accum params
            {
                eta_p_126033 = local_acc_126038;
            }
            // Load next params
            {
                eta_p_126034 = local_acc_126041;
            }
            // SegRed body
            {
                double zp_res_126035 = eta_p_126033 + eta_p_126034;
                
                local_acc_126038 = zp_res_126035;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_126021.mem)[flat_tid_121132] = local_acc_126036;
        ((double *) reduce_stage_1_tid_res_arr_mem_126023.mem)[flat_tid_121132] = local_acc_126037;
        ((double *) reduce_stage_1_tid_res_arr_mem_126025.mem)[flat_tid_121132] = local_acc_126038;
    }
    
  cleanup:
    { }
    if (event_128911 != NULL) {
        event_128911->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128910", strdup("nothing further"), event_128911, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128905(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128904 *futhark_mc_task_128904 = (struct futhark_mc_task_128904 *) args;
    struct futhark_context *ctx = futhark_mc_task_128904->ctx;
    struct mc_event *event_128913 = mc_event_new(ctx);
    
    if (event_128913 != NULL)
        event_128913->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128904->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128904->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128904->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_task_128904->free_mem_param_118928, .size =0, .references =NULL};
    struct memblock mem_param_121100 = {.desc ="mem_param_121100", .mem =futhark_mc_task_128904->free_mem_param_121100, .size =0, .references =NULL};
    int64_t gtid_121114 = futhark_mc_task_128904->free_gtid_121114;
    double eta_p_121124 = futhark_mc_task_128904->free_eta_p_121124;
    int64_t flat_tid_121132 = futhark_mc_task_128904->free_flat_tid_121132;
    double defunc_res_121127 = *futhark_mc_task_128904->retval_defunc_res_121127;
    double defunc_res_121128 = *futhark_mc_task_128904->retval_defunc_res_121128;
    double defunc_res_121129 = *futhark_mc_task_128904->retval_defunc_res_121129;
    struct memblock mem_121125 = {.desc ="mem_121125", .mem =futhark_mc_task_128904->retval_mem_121125, .size =0, .references =NULL};
    struct memblock mem_121126 = {.desc ="mem_121126", .mem =futhark_mc_task_128904->retval_mem_121126, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_126021_cached_sizze_128906 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126021 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_126023_cached_sizze_128907 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126023 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_126025_cached_sizze_128908 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126025 = NULL;
    int32_t nsubtasks_126020;
    
    nsubtasks_126020 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_126021_cached_sizze_128906 < (int64_t) 8 * nsubtasks_126020) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126021, &reduce_stage_1_tid_res_arr_mem_126021_cached_sizze_128906, (int64_t) 8 * nsubtasks_126020);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_126023_cached_sizze_128907 < (int64_t) 8 * nsubtasks_126020) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126023, &reduce_stage_1_tid_res_arr_mem_126023_cached_sizze_128907, (int64_t) 8 * nsubtasks_126020);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_126025_cached_sizze_128908 < (int64_t) 8 * nsubtasks_126020) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126025, &reduce_stage_1_tid_res_arr_mem_126025_cached_sizze_128908, (int64_t) 8 * nsubtasks_126020);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128909 futhark_mc_segred_stage_1_parloop_struct_128909_;
    
    futhark_mc_segred_stage_1_parloop_struct_128909_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128909_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128909_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128909_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_128909_.free_mem_param_118928 = mem_param_118928.mem;
    futhark_mc_segred_stage_1_parloop_struct_128909_.free_mem_param_121100 = mem_param_121100.mem;
    futhark_mc_segred_stage_1_parloop_struct_128909_.free_gtid_121114 = gtid_121114;
    futhark_mc_segred_stage_1_parloop_struct_128909_.free_eta_p_121124 = eta_p_121124;
    futhark_mc_segred_stage_1_parloop_struct_128909_.free_mem_121125 = mem_121125.mem;
    futhark_mc_segred_stage_1_parloop_struct_128909_.free_mem_121126 = mem_121126.mem;
    futhark_mc_segred_stage_1_parloop_struct_128909_.free_reduce_stage_1_tid_res_arr_mem_126021 = reduce_stage_1_tid_res_arr_mem_126021;
    futhark_mc_segred_stage_1_parloop_struct_128909_.free_reduce_stage_1_tid_res_arr_mem_126023 = reduce_stage_1_tid_res_arr_mem_126023;
    futhark_mc_segred_stage_1_parloop_struct_128909_.free_reduce_stage_1_tid_res_arr_mem_126025 = reduce_stage_1_tid_res_arr_mem_126025;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128910_task;
    
    futhark_mc_segred_stage_1_parloop_128910_task.name = "futhark_mc_segred_stage_1_parloop_128910";
    futhark_mc_segred_stage_1_parloop_128910_task.fn = futhark_mc_segred_stage_1_parloop_128910;
    futhark_mc_segred_stage_1_parloop_128910_task.args = &futhark_mc_segred_stage_1_parloop_struct_128909_;
    futhark_mc_segred_stage_1_parloop_128910_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128910_task.info = info;
    
    struct mc_event *event_128912 = mc_event_new(ctx);
    
    if (event_128912 != NULL)
        event_128912->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128910_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128910_task);
    
    if (futhark_mc_segred_stage_1_parloop_128910_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128910_err;
        goto cleanup;
    }
    if (event_128912 != NULL) {
        event_128912->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128910_total", strdup("nothing further"), event_128912, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_121127 = 0.0;
        defunc_res_121128 = 0.0;
        defunc_res_121129 = 0.0;
    }
    
    double eta_p_126047;
    double eta_p_126048;
    double eta_p_126050;
    double eta_p_126051;
    double eta_p_126053;
    double eta_p_126054;
    
    for (int32_t i_126056 = 0; i_126056 < nsubtasks_126020; i_126056++) {
        flat_tid_121132 = i_126056;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_126047 = defunc_res_121127;
            }
            // load next params
            {
                eta_p_126048 = ((double *) reduce_stage_1_tid_res_arr_mem_126021)[flat_tid_121132];
            }
            // red body
            {
                double zp_res_126049 = eta_p_126047 + eta_p_126048;
                
                defunc_res_121127 = zp_res_126049;
            }
            // load acc params
            {
                eta_p_126050 = defunc_res_121128;
            }
            // load next params
            {
                eta_p_126051 = ((double *) reduce_stage_1_tid_res_arr_mem_126023)[flat_tid_121132];
            }
            // red body
            {
                double zp_res_126052 = eta_p_126050 + eta_p_126051;
                
                defunc_res_121128 = zp_res_126052;
            }
            // load acc params
            {
                eta_p_126053 = defunc_res_121129;
            }
            // load next params
            {
                eta_p_126054 = ((double *) reduce_stage_1_tid_res_arr_mem_126025)[flat_tid_121132];
            }
            // red body
            {
                double zp_res_126055 = eta_p_126053 + eta_p_126054;
                
                defunc_res_121129 = zp_res_126055;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_126021);
        free(reduce_stage_1_tid_res_arr_mem_126023);
        free(reduce_stage_1_tid_res_arr_mem_126025);
    }
    if (event_128913 != NULL) {
        event_128913->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128905", strdup("nothing further"), event_128913, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128904->retval_defunc_res_121127 = defunc_res_121127;
        *futhark_mc_task_128904->retval_defunc_res_121128 = defunc_res_121128;
        *futhark_mc_task_128904->retval_defunc_res_121129 = defunc_res_121129;
        futhark_mc_task_128904->retval_mem_121125 = mem_121125.mem;
        futhark_mc_task_128904->retval_mem_121126 = mem_121126.mem;
    }
    return err;
}
struct futhark_mc_task_128914 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_112510;
    int64_t free_gtid_121114;
    unsigned char *free_mem_121125;
};
struct futhark_mc_copy_parloop_struct_128916 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_112510;
    int64_t free_gtid_121114;
    unsigned char *free_mem_121125;
};
static int futhark_mc_copy_parloop_128917(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_copy_parloop_struct_128916 *futhark_mc_copy_parloop_struct_128916 = (struct futhark_mc_copy_parloop_struct_128916 *) args;
    struct futhark_context *ctx = futhark_mc_copy_parloop_struct_128916->ctx;
    struct mc_event *event_128918 = mc_event_new(ctx);
    
    if (event_128918 != NULL)
        event_128918->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_copy_parloop_struct_128916->free_m_33388;
    struct memblock mem_112510 = {.desc ="mem_112510", .mem =futhark_mc_copy_parloop_struct_128916->free_mem_112510, .size =0, .references =NULL};
    int64_t gtid_121114 = futhark_mc_copy_parloop_struct_128916->free_gtid_121114;
    struct memblock mem_121125 = {.desc ="mem_121125", .mem =futhark_mc_copy_parloop_struct_128916->free_mem_121125, .size =0, .references =NULL};
    int64_t iterations = end - start;
    
    {
        int64_t start_126057;
        int64_t end_126058;
        
        start_126057 = start;
        end_126058 = end;
        
        int64_t n_126059 = end_126058 - start_126057;
        
        for (int64_t copy_i_126060 = start_126057; copy_i_126060 < start_126057 + n_126059; copy_i_126060++) {
            int64_t slice_126062 = m_33388;
            int64_t i_126061 = copy_i_126060;
            int64_t remnant_126063 = copy_i_126060 - i_126061;
            double tmp_126064 = ((double *) mem_121125.mem)[i_126061];
            
            ((double *) mem_112510.mem)[gtid_121114 * m_33388 + i_126061] = tmp_126064;
        }
    }
    
  cleanup:
    { }
    if (event_128918 != NULL) {
        event_128918->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_parloop_128917", strdup("nothing further"), event_128918, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_copy_126065_task_128915(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128914 *futhark_mc_task_128914 = (struct futhark_mc_task_128914 *) args;
    struct futhark_context *ctx = futhark_mc_task_128914->ctx;
    struct mc_event *event_128920 = mc_event_new(ctx);
    
    if (event_128920 != NULL)
        event_128920->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128914->free_m_33388;
    struct memblock mem_112510 = {.desc ="mem_112510", .mem =futhark_mc_task_128914->free_mem_112510, .size =0, .references =NULL};
    int64_t gtid_121114 = futhark_mc_task_128914->free_gtid_121114;
    struct memblock mem_121125 = {.desc ="mem_121125", .mem =futhark_mc_task_128914->free_mem_121125, .size =0, .references =NULL};
    struct futhark_mc_copy_parloop_struct_128916 futhark_mc_copy_parloop_struct_128916_;
    
    futhark_mc_copy_parloop_struct_128916_.ctx = ctx;
    futhark_mc_copy_parloop_struct_128916_.free_m_33388 = m_33388;
    futhark_mc_copy_parloop_struct_128916_.free_mem_112510 = mem_112510.mem;
    futhark_mc_copy_parloop_struct_128916_.free_gtid_121114 = gtid_121114;
    futhark_mc_copy_parloop_struct_128916_.free_mem_121125 = mem_121125.mem;
    
    struct scheduler_parloop futhark_mc_copy_parloop_128917_task;
    
    futhark_mc_copy_parloop_128917_task.name = "futhark_mc_copy_parloop_128917";
    futhark_mc_copy_parloop_128917_task.fn = futhark_mc_copy_parloop_128917;
    futhark_mc_copy_parloop_128917_task.args = &futhark_mc_copy_parloop_struct_128916_;
    futhark_mc_copy_parloop_128917_task.iterations = iterations;
    futhark_mc_copy_parloop_128917_task.info = info;
    
    struct mc_event *event_128919 = mc_event_new(ctx);
    
    if (event_128919 != NULL)
        event_128919->bef = get_wall_time();
    
    int futhark_mc_copy_parloop_128917_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_copy_parloop_128917_task);
    
    if (futhark_mc_copy_parloop_128917_err != 0) {
        err = futhark_mc_copy_parloop_128917_err;
        goto cleanup;
    }
    if (event_128919 != NULL) {
        event_128919->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_parloop_128917_total", strdup("nothing further"), event_128919, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_128920 != NULL) {
        event_128920->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_126065_task_128915", strdup("nothing further"), event_128920, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_128921 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_param_out_121101;
    int64_t free_gtid_121114;
    unsigned char *free_mem_121126;
};
struct futhark_mc_copy_parloop_struct_128923 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_param_out_121101;
    int64_t free_gtid_121114;
    unsigned char *free_mem_121126;
};
static int futhark_mc_copy_parloop_128924(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_copy_parloop_struct_128923 *futhark_mc_copy_parloop_struct_128923 = (struct futhark_mc_copy_parloop_struct_128923 *) args;
    struct futhark_context *ctx = futhark_mc_copy_parloop_struct_128923->ctx;
    struct mc_event *event_128925 = mc_event_new(ctx);
    
    if (event_128925 != NULL)
        event_128925->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_copy_parloop_struct_128923->free_m_33388;
    struct memblock mem_param_out_121101 = {.desc ="mem_param_out_121101", .mem =futhark_mc_copy_parloop_struct_128923->free_mem_param_out_121101, .size =0, .references =NULL};
    int64_t gtid_121114 = futhark_mc_copy_parloop_struct_128923->free_gtid_121114;
    struct memblock mem_121126 = {.desc ="mem_121126", .mem =futhark_mc_copy_parloop_struct_128923->free_mem_121126, .size =0, .references =NULL};
    int64_t iterations = end - start;
    
    {
        int64_t start_126067;
        int64_t end_126068;
        
        start_126067 = start;
        end_126068 = end;
        
        int64_t n_126069 = end_126068 - start_126067;
        
        for (int64_t copy_i_126070 = start_126067; copy_i_126070 < start_126067 + n_126069; copy_i_126070++) {
            int64_t slice_126072 = m_33388;
            int64_t i_126071 = copy_i_126070;
            int64_t remnant_126073 = copy_i_126070 - i_126071;
            double tmp_126074 = ((double *) mem_121126.mem)[i_126071];
            
            ((double *) mem_param_out_121101.mem)[gtid_121114 * m_33388 + i_126071] = tmp_126074;
        }
    }
    
  cleanup:
    { }
    if (event_128925 != NULL) {
        event_128925->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_parloop_128924", strdup("nothing further"), event_128925, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_copy_126075_task_128922(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128921 *futhark_mc_task_128921 = (struct futhark_mc_task_128921 *) args;
    struct futhark_context *ctx = futhark_mc_task_128921->ctx;
    struct mc_event *event_128927 = mc_event_new(ctx);
    
    if (event_128927 != NULL)
        event_128927->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128921->free_m_33388;
    struct memblock mem_param_out_121101 = {.desc ="mem_param_out_121101", .mem =futhark_mc_task_128921->free_mem_param_out_121101, .size =0, .references =NULL};
    int64_t gtid_121114 = futhark_mc_task_128921->free_gtid_121114;
    struct memblock mem_121126 = {.desc ="mem_121126", .mem =futhark_mc_task_128921->free_mem_121126, .size =0, .references =NULL};
    struct futhark_mc_copy_parloop_struct_128923 futhark_mc_copy_parloop_struct_128923_;
    
    futhark_mc_copy_parloop_struct_128923_.ctx = ctx;
    futhark_mc_copy_parloop_struct_128923_.free_m_33388 = m_33388;
    futhark_mc_copy_parloop_struct_128923_.free_mem_param_out_121101 = mem_param_out_121101.mem;
    futhark_mc_copy_parloop_struct_128923_.free_gtid_121114 = gtid_121114;
    futhark_mc_copy_parloop_struct_128923_.free_mem_121126 = mem_121126.mem;
    
    struct scheduler_parloop futhark_mc_copy_parloop_128924_task;
    
    futhark_mc_copy_parloop_128924_task.name = "futhark_mc_copy_parloop_128924";
    futhark_mc_copy_parloop_128924_task.fn = futhark_mc_copy_parloop_128924;
    futhark_mc_copy_parloop_128924_task.args = &futhark_mc_copy_parloop_struct_128923_;
    futhark_mc_copy_parloop_128924_task.iterations = iterations;
    futhark_mc_copy_parloop_128924_task.info = info;
    
    struct mc_event *event_128926 = mc_event_new(ctx);
    
    if (event_128926 != NULL)
        event_128926->bef = get_wall_time();
    
    int futhark_mc_copy_parloop_128924_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_copy_parloop_128924_task);
    
    if (futhark_mc_copy_parloop_128924_err != 0) {
        err = futhark_mc_copy_parloop_128924_err;
        goto cleanup;
    }
    if (event_128926 != NULL) {
        event_128926->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_parloop_128924_total", strdup("nothing further"), event_128926, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_128927 != NULL) {
        event_128927->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_copy_126075_task_128922", strdup("nothing further"), event_128927, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_128901(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128900 *futhark_mc_segred_stage_1_parloop_struct_128900 = (struct futhark_mc_segred_stage_1_parloop_struct_128900 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128900->ctx;
    struct mc_event *event_128928 = mc_event_new(ctx);
    
    if (event_128928 != NULL)
        event_128928->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128900->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_128900->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128900->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_128900->free_distrs_mem_111708, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_segred_stage_1_parloop_struct_128900->free_bytes_111715;
    struct memblock mem_112507 = {.desc ="mem_112507", .mem =futhark_mc_segred_stage_1_parloop_struct_128900->free_mem_112507, .size =0, .references =NULL};
    struct memblock mem_112510 = {.desc ="mem_112510", .mem =futhark_mc_segred_stage_1_parloop_struct_128900->free_mem_112510, .size =0, .references =NULL};
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_segred_stage_1_parloop_struct_128900->free_mem_param_118928, .size =0, .references =NULL};
    struct memblock mem_param_121100 = {.desc ="mem_param_121100", .mem =futhark_mc_segred_stage_1_parloop_struct_128900->free_mem_param_121100, .size =0, .references =NULL};
    struct memblock mem_param_out_121101 = {.desc ="mem_param_out_121101", .mem =futhark_mc_segred_stage_1_parloop_struct_128900->free_mem_param_out_121101, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125995 = {.desc ="reduce_stage_1_tid_res_arr_mem_125995", .mem =futhark_mc_segred_stage_1_parloop_struct_128900->free_reduce_stage_1_tid_res_arr_mem_125995, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125997 = {.desc ="reduce_stage_1_tid_res_arr_mem_125997", .mem =futhark_mc_segred_stage_1_parloop_struct_128900->free_reduce_stage_1_tid_res_arr_mem_125997, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_125999 = {.desc ="reduce_stage_1_tid_res_arr_mem_125999", .mem =futhark_mc_segred_stage_1_parloop_struct_128900->free_reduce_stage_1_tid_res_arr_mem_125999, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t mem_121125_cached_sizze_128902 = 0;
    unsigned char *mem_121125 = NULL;
    int64_t mem_121126_cached_sizze_128903 = 0;
    unsigned char *mem_121126 = NULL;
    int64_t flat_tid_121113;
    
    flat_tid_121113 = subtask_id;
    {
        double eta_p_126001;
        double eta_p_126002;
        double eta_p_126004;
        double eta_p_126005;
        double eta_p_126007;
        double eta_p_126008;
        double local_acc_126010 = 0.0;
        double local_acc_126011 = 0.0;
        double local_acc_126012 = 0.0;
        double eta_p_121115;
        double eta_p_121116;
        double eta_p_121118;
        double eta_p_121119;
        double eta_p_121121;
        double eta_p_121122;
        double local_acc_126013 = 0.0;
        double local_acc_126014 = 0.0;
        double local_acc_126015 = 0.0;
        int64_t start_126016;
        int64_t end_126017;
        
        start_126016 = start;
        end_126017 = end;
        
        int64_t n_126018 = end_126017 - start_126016;
        
        if (mem_121125_cached_sizze_128902 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_121125, &mem_121125_cached_sizze_128902, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_121126_cached_sizze_128903 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_121126, &mem_121126_cached_sizze_128903, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        for (int64_t SegRed_i_126019 = start_126016; SegRed_i_126019 < start_126016 + n_126018; SegRed_i_126019++) {
            int64_t gtid_121114 = SegRed_i_126019;
            double eta_p_121124 = ((double *) distrs_mem_111708.mem)[eta_p_106382 * m_33388 + gtid_121114];
            double defunc_res_121127;
            double defunc_res_121128;
            double defunc_res_121129;
            int64_t flat_tid_121132 = (int64_t) 0;
            
            defunc_res_121127 = 0.0;
            defunc_res_121128 = 0.0;
            defunc_res_121129 = 0.0;
            
            struct futhark_mc_task_128904 futhark_mc_task_128904_;
            
            futhark_mc_task_128904_.ctx = ctx;
            futhark_mc_task_128904_.free_m_33388 = m_33388;
            futhark_mc_task_128904_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
            futhark_mc_task_128904_.free_distrs_mem_111708 = distrs_mem_111708.mem;
            futhark_mc_task_128904_.free_mem_param_118928 = mem_param_118928.mem;
            futhark_mc_task_128904_.free_mem_param_121100 = mem_param_121100.mem;
            futhark_mc_task_128904_.free_gtid_121114 = gtid_121114;
            futhark_mc_task_128904_.free_eta_p_121124 = eta_p_121124;
            futhark_mc_task_128904_.free_flat_tid_121132 = flat_tid_121132;
            futhark_mc_task_128904_.retval_defunc_res_121127 = (double *) &defunc_res_121127;
            #if ISPC
            futhark_mc_task_128904_.retval_defunc_res_121127 += programIndex;
            #endif
            futhark_mc_task_128904_.retval_defunc_res_121128 = (double *) &defunc_res_121128;
            #if ISPC
            futhark_mc_task_128904_.retval_defunc_res_121128 += programIndex;
            #endif
            futhark_mc_task_128904_.retval_defunc_res_121129 = (double *) &defunc_res_121129;
            #if ISPC
            futhark_mc_task_128904_.retval_defunc_res_121129 += programIndex;
            #endif
            futhark_mc_task_128904_.retval_mem_121125 = mem_121125;
            futhark_mc_task_128904_.retval_mem_121126 = mem_121126;
            
            struct scheduler_segop futhark_mc_task_128904_task;
            
            futhark_mc_task_128904_task.args = &futhark_mc_task_128904_;
            futhark_mc_task_128904_task.top_level_fn = futhark_mc_segred_task_128905;
            futhark_mc_task_128904_task.name = "futhark_mc_segred_task_128905";
            futhark_mc_task_128904_task.iterations = m_33388;
            futhark_mc_task_128904_task.task_time = &ctx->program->futhark_mc_segred_task_128905_total_time;
            futhark_mc_task_128904_task.task_iter = &ctx->program->futhark_mc_segred_task_128905_total_iter;
            futhark_mc_task_128904_task.sched = STATIC;
            futhark_mc_task_128904_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_128905_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128904_task);
            
            if (futhark_mc_segred_task_128905_err != 0) {
                err = futhark_mc_segred_task_128905_err;
                goto cleanup;
            }
            
            bool zeze_res_121154 = defunc_res_121129 == 0.0;
            double klu_res_121155;
            
            if (zeze_res_121154) {
                klu_res_121155 = 0.0;
            } else {
                double zs_res_121156 = defunc_res_121129 / eta_p_121124;
                double log_res_121157 = futrts_log64(zs_res_121156);
                double zt_res_121158 = defunc_res_121129 * log_res_121157;
                
                klu_res_121155 = zt_res_121158;
            }
            // save map-out results
            {
                ((double *) mem_112507.mem)[gtid_121114] = defunc_res_121128;
                
                int64_t iterations_126066 = m_33388;
                struct futhark_mc_task_128914 futhark_mc_task_128914_;
                
                futhark_mc_task_128914_.ctx = ctx;
                futhark_mc_task_128914_.free_m_33388 = m_33388;
                futhark_mc_task_128914_.free_mem_112510 = mem_112510.mem;
                futhark_mc_task_128914_.free_gtid_121114 = gtid_121114;
                futhark_mc_task_128914_.free_mem_121125 = mem_121125;
                
                struct scheduler_segop futhark_mc_task_128914_task;
                
                futhark_mc_task_128914_task.args = &futhark_mc_task_128914_;
                futhark_mc_task_128914_task.top_level_fn = futhark_mc_copy_126065_task_128915;
                futhark_mc_task_128914_task.name = "futhark_mc_copy_126065_task_128915";
                futhark_mc_task_128914_task.iterations = iterations_126066;
                futhark_mc_task_128914_task.task_time = &ctx->program->futhark_mc_copy_126065_task_128915_total_time;
                futhark_mc_task_128914_task.task_iter = &ctx->program->futhark_mc_copy_126065_task_128915_total_iter;
                futhark_mc_task_128914_task.sched = STATIC;
                futhark_mc_task_128914_task.nested_fn = NULL;
                
                int futhark_mc_copy_126065_task_128915_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128914_task);
                
                if (futhark_mc_copy_126065_task_128915_err != 0) {
                    err = futhark_mc_copy_126065_task_128915_err;
                    goto cleanup;
                }
                
                int64_t iterations_126076 = m_33388;
                struct futhark_mc_task_128921 futhark_mc_task_128921_;
                
                futhark_mc_task_128921_.ctx = ctx;
                futhark_mc_task_128921_.free_m_33388 = m_33388;
                futhark_mc_task_128921_.free_mem_param_out_121101 = mem_param_out_121101.mem;
                futhark_mc_task_128921_.free_gtid_121114 = gtid_121114;
                futhark_mc_task_128921_.free_mem_121126 = mem_121126;
                
                struct scheduler_segop futhark_mc_task_128921_task;
                
                futhark_mc_task_128921_task.args = &futhark_mc_task_128921_;
                futhark_mc_task_128921_task.top_level_fn = futhark_mc_copy_126075_task_128922;
                futhark_mc_task_128921_task.name = "futhark_mc_copy_126075_task_128922";
                futhark_mc_task_128921_task.iterations = iterations_126076;
                futhark_mc_task_128921_task.task_time = &ctx->program->futhark_mc_copy_126075_task_128922_total_time;
                futhark_mc_task_128921_task.task_iter = &ctx->program->futhark_mc_copy_126075_task_128922_total_iter;
                futhark_mc_task_128921_task.sched = STATIC;
                futhark_mc_task_128921_task.nested_fn = NULL;
                
                int futhark_mc_copy_126075_task_128922_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128921_task);
                
                if (futhark_mc_copy_126075_task_128922_err != 0) {
                    err = futhark_mc_copy_126075_task_128922_err;
                    goto cleanup;
                }
            }
            // Load accum params
            {
                eta_p_121115 = local_acc_126013;
            }
            // Load next params
            {
                eta_p_121116 = klu_res_121155;
            }
            // SegRed body
            {
                double zp_res_121117 = eta_p_121115 + eta_p_121116;
                
                local_acc_126013 = zp_res_121117;
            }
            // Load accum params
            {
                eta_p_121118 = local_acc_126014;
            }
            // Load next params
            {
                eta_p_121119 = defunc_res_121129;
            }
            // SegRed body
            {
                double zp_res_121120 = eta_p_121118 + eta_p_121119;
                
                local_acc_126014 = zp_res_121120;
            }
            // Load accum params
            {
                eta_p_121121 = local_acc_126015;
            }
            // Load next params
            {
                eta_p_121122 = defunc_res_121127;
            }
            // SegRed body
            {
                double zp_res_121123 = eta_p_121121 + eta_p_121122;
                
                local_acc_126015 = zp_res_121123;
            }
        }
        
        int64_t uni_i_126077 = 0;
        
        {
            int64_t gtid_121114 = uni_i_126077;
            
            // Load accum params
            {
                eta_p_126001 = local_acc_126010;
            }
            // Load next params
            {
                eta_p_126002 = local_acc_126013;
            }
            // SegRed body
            {
                double zp_res_126003 = eta_p_126001 + eta_p_126002;
                
                local_acc_126010 = zp_res_126003;
            }
            // Load accum params
            {
                eta_p_126004 = local_acc_126011;
            }
            // Load next params
            {
                eta_p_126005 = local_acc_126014;
            }
            // SegRed body
            {
                double zp_res_126006 = eta_p_126004 + eta_p_126005;
                
                local_acc_126011 = zp_res_126006;
            }
            // Load accum params
            {
                eta_p_126007 = local_acc_126012;
            }
            // Load next params
            {
                eta_p_126008 = local_acc_126015;
            }
            // SegRed body
            {
                double zp_res_126009 = eta_p_126007 + eta_p_126008;
                
                local_acc_126012 = zp_res_126009;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_125995.mem)[flat_tid_121113] = local_acc_126010;
        ((double *) reduce_stage_1_tid_res_arr_mem_125997.mem)[flat_tid_121113] = local_acc_126011;
        ((double *) reduce_stage_1_tid_res_arr_mem_125999.mem)[flat_tid_121113] = local_acc_126012;
    }
    
  cleanup:
    {
        free(mem_121125);
        free(mem_121126);
    }
    if (event_128928 != NULL) {
        event_128928->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128901", strdup("nothing further"), event_128928, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_128896(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128884 *futhark_mc_task_128884 = (struct futhark_mc_task_128884 *) args;
    struct futhark_context *ctx = futhark_mc_task_128884->ctx;
    struct mc_event *event_128930 = mc_event_new(ctx);
    
    if (event_128930 != NULL)
        event_128930->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128884->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_128884->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128884->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128884->free_distrs_mem_111708, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_task_128884->free_bytes_111715;
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_task_128884->free_mem_param_118928, .size =0, .references =NULL};
    struct memblock mem_param_121100 = {.desc ="mem_param_121100", .mem =futhark_mc_task_128884->free_mem_param_121100, .size =0, .references =NULL};
    int64_t flat_tid_121113 = futhark_mc_task_128884->free_flat_tid_121113;
    int64_t flat_tid_121159 = futhark_mc_task_128884->free_flat_tid_121159;
    double defunc_res_121107 = *futhark_mc_task_128884->retval_defunc_res_121107;
    double defunc_res_121108 = *futhark_mc_task_128884->retval_defunc_res_121108;
    double defunc_res_121109 = *futhark_mc_task_128884->retval_defunc_res_121109;
    struct memblock mem_112507 = {.desc ="mem_112507", .mem =futhark_mc_task_128884->retval_mem_112507, .size =0, .references =NULL};
    struct memblock mem_112510 = {.desc ="mem_112510", .mem =futhark_mc_task_128884->retval_mem_112510, .size =0, .references =NULL};
    struct memblock mem_param_out_121101 = {.desc ="mem_param_out_121101", .mem =futhark_mc_task_128884->retval_mem_param_out_121101, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_125995_cached_sizze_128897 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125995 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_125997_cached_sizze_128898 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125997 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_125999_cached_sizze_128899 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_125999 = NULL;
    int32_t nsubtasks_125994;
    
    nsubtasks_125994 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_125995_cached_sizze_128897 < (int64_t) 8 * nsubtasks_125994) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125995, &reduce_stage_1_tid_res_arr_mem_125995_cached_sizze_128897, (int64_t) 8 * nsubtasks_125994);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_125997_cached_sizze_128898 < (int64_t) 8 * nsubtasks_125994) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125997, &reduce_stage_1_tid_res_arr_mem_125997_cached_sizze_128898, (int64_t) 8 * nsubtasks_125994);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_125999_cached_sizze_128899 < (int64_t) 8 * nsubtasks_125994) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_125999, &reduce_stage_1_tid_res_arr_mem_125999_cached_sizze_128899, (int64_t) 8 * nsubtasks_125994);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128900 futhark_mc_segred_stage_1_parloop_struct_128900_;
    
    futhark_mc_segred_stage_1_parloop_struct_128900_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128900_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128900_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_128900_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128900_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_128900_.free_bytes_111715 = bytes_111715;
    futhark_mc_segred_stage_1_parloop_struct_128900_.free_mem_112507 = mem_112507.mem;
    futhark_mc_segred_stage_1_parloop_struct_128900_.free_mem_112510 = mem_112510.mem;
    futhark_mc_segred_stage_1_parloop_struct_128900_.free_mem_param_118928 = mem_param_118928.mem;
    futhark_mc_segred_stage_1_parloop_struct_128900_.free_mem_param_121100 = mem_param_121100.mem;
    futhark_mc_segred_stage_1_parloop_struct_128900_.free_mem_param_out_121101 = mem_param_out_121101.mem;
    futhark_mc_segred_stage_1_parloop_struct_128900_.free_reduce_stage_1_tid_res_arr_mem_125995 = reduce_stage_1_tid_res_arr_mem_125995;
    futhark_mc_segred_stage_1_parloop_struct_128900_.free_reduce_stage_1_tid_res_arr_mem_125997 = reduce_stage_1_tid_res_arr_mem_125997;
    futhark_mc_segred_stage_1_parloop_struct_128900_.free_reduce_stage_1_tid_res_arr_mem_125999 = reduce_stage_1_tid_res_arr_mem_125999;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128901_task;
    
    futhark_mc_segred_stage_1_parloop_128901_task.name = "futhark_mc_segred_stage_1_parloop_128901";
    futhark_mc_segred_stage_1_parloop_128901_task.fn = futhark_mc_segred_stage_1_parloop_128901;
    futhark_mc_segred_stage_1_parloop_128901_task.args = &futhark_mc_segred_stage_1_parloop_struct_128900_;
    futhark_mc_segred_stage_1_parloop_128901_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128901_task.info = info;
    
    struct mc_event *event_128929 = mc_event_new(ctx);
    
    if (event_128929 != NULL)
        event_128929->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128901_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128901_task);
    
    if (futhark_mc_segred_stage_1_parloop_128901_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128901_err;
        goto cleanup;
    }
    if (event_128929 != NULL) {
        event_128929->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128901_total", strdup("nothing further"), event_128929, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_121107 = 0.0;
        defunc_res_121108 = 0.0;
        defunc_res_121109 = 0.0;
    }
    
    double eta_p_126078;
    double eta_p_126079;
    double eta_p_126081;
    double eta_p_126082;
    double eta_p_126084;
    double eta_p_126085;
    
    for (int32_t i_126087 = 0; i_126087 < nsubtasks_125994; i_126087++) {
        flat_tid_121113 = i_126087;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_126078 = defunc_res_121107;
            }
            // load next params
            {
                eta_p_126079 = ((double *) reduce_stage_1_tid_res_arr_mem_125995)[flat_tid_121113];
            }
            // red body
            {
                double zp_res_126080 = eta_p_126078 + eta_p_126079;
                
                defunc_res_121107 = zp_res_126080;
            }
            // load acc params
            {
                eta_p_126081 = defunc_res_121108;
            }
            // load next params
            {
                eta_p_126082 = ((double *) reduce_stage_1_tid_res_arr_mem_125997)[flat_tid_121113];
            }
            // red body
            {
                double zp_res_126083 = eta_p_126081 + eta_p_126082;
                
                defunc_res_121108 = zp_res_126083;
            }
            // load acc params
            {
                eta_p_126084 = defunc_res_121109;
            }
            // load next params
            {
                eta_p_126085 = ((double *) reduce_stage_1_tid_res_arr_mem_125999)[flat_tid_121113];
            }
            // red body
            {
                double zp_res_126086 = eta_p_126084 + eta_p_126085;
                
                defunc_res_121109 = zp_res_126086;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_125995);
        free(reduce_stage_1_tid_res_arr_mem_125997);
        free(reduce_stage_1_tid_res_arr_mem_125999);
    }
    if (event_128930 != NULL) {
        event_128930->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_128896", strdup("nothing further"), event_128930, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128884->retval_defunc_res_121107 = defunc_res_121107;
        *futhark_mc_task_128884->retval_defunc_res_121108 = defunc_res_121108;
        *futhark_mc_task_128884->retval_defunc_res_121109 = defunc_res_121109;
        futhark_mc_task_128884->retval_mem_112507 = mem_112507.mem;
        futhark_mc_task_128884->retval_mem_112510 = mem_112510.mem;
        futhark_mc_task_128884->retval_mem_param_out_121101 = mem_param_out_121101.mem;
    }
    return err;
}
struct futhark_mc_task_128931 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_112510;
    int64_t free_flat_tid_121209;
    int64_t free_flat_tid_121231;
    double *retval_defunc_res_121207;
    unsigned char *retval_mem_112515;
};
struct futhark_mc_segred_stage_1_parloop_struct_128934 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_112510;
    unsigned char *free_mem_112515;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126089;
};
static int futhark_mc_segred_stage_1_parloop_128935(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128934 *futhark_mc_segred_stage_1_parloop_struct_128934 = (struct futhark_mc_segred_stage_1_parloop_struct_128934 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128934->ctx;
    struct mc_event *event_128936 = mc_event_new(ctx);
    
    if (event_128936 != NULL)
        event_128936->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128934->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128934->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_128934->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112510 = {.desc ="mem_112510", .mem =futhark_mc_segred_stage_1_parloop_struct_128934->free_mem_112510, .size =0, .references =NULL};
    struct memblock mem_112515 = {.desc ="mem_112515", .mem =futhark_mc_segred_stage_1_parloop_struct_128934->free_mem_112515, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126089 = {.desc ="reduce_stage_1_tid_res_arr_mem_126089", .mem =futhark_mc_segred_stage_1_parloop_struct_128934->free_reduce_stage_1_tid_res_arr_mem_126089, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121231;
    
    flat_tid_121231 = subtask_id;
    {
        double eta_p_126091;
        double eta_p_126092;
        double local_acc_126094 = 0.0;
        double eta_p_121233;
        double eta_p_121234;
        double local_acc_126095 = 0.0;
        int64_t start_126096;
        int64_t end_126097;
        
        start_126096 = start;
        end_126097 = end;
        
        int64_t n_126098 = end_126097 - start_126096;
        
        for (int64_t SegRed_i_126099 = start_126096; SegRed_i_126099 < start_126096 + n_126098; SegRed_i_126099++) {
            int64_t gtid_121232 = SegRed_i_126099;
            double defunc_res_121236;
            double defunc_res_121237;
            double redout_121239;
            double redout_121240;
            
            redout_121239 = 0.0;
            redout_121240 = 0.0;
            for (int64_t i_121238 = 0; i_121238 < m_33388; i_121238++) {
                double x_121241 = ((double *) mem_112510.mem)[i_121238 * m_33388 + gtid_121232];
                double zp_res_121242 = x_121241 + redout_121239;
                double zp_res_121243 = x_121241 + redout_121240;
                double redout_tmp_126100 = zp_res_121242;
                double redout_tmp_126101 = zp_res_121243;
                
                redout_121239 = redout_tmp_126100;
                redout_121240 = redout_tmp_126101;
            }
            defunc_res_121236 = redout_121239;
            defunc_res_121237 = redout_121240;
            
            bool zeze_res_121244 = defunc_res_121237 == 0.0;
            double klu_res_121245;
            
            if (zeze_res_121244) {
                klu_res_121245 = 0.0;
            } else {
                double eta_p_121246 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + gtid_121232];
                double zs_res_121247 = defunc_res_121237 / eta_p_121246;
                double log_res_121248 = futrts_log64(zs_res_121247);
                double zt_res_121249 = defunc_res_121237 * log_res_121248;
                
                klu_res_121245 = zt_res_121249;
            }
            // save map-out results
            {
                ((double *) mem_112515.mem)[gtid_121232] = defunc_res_121236;
            }
            // Load accum params
            {
                eta_p_121233 = local_acc_126095;
            }
            // Load next params
            {
                eta_p_121234 = klu_res_121245;
            }
            // SegRed body
            {
                double zp_res_121235 = eta_p_121233 + eta_p_121234;
                
                local_acc_126095 = zp_res_121235;
            }
        }
        
        int64_t uni_i_126102 = 0;
        
        {
            int64_t gtid_121232 = uni_i_126102;
            
            // Load accum params
            {
                eta_p_126091 = local_acc_126094;
            }
            // Load next params
            {
                eta_p_126092 = local_acc_126095;
            }
            // SegRed body
            {
                double zp_res_126093 = eta_p_126091 + eta_p_126092;
                
                local_acc_126094 = zp_res_126093;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_126089.mem)[flat_tid_121231] = local_acc_126094;
    }
    
  cleanup:
    { }
    if (event_128936 != NULL) {
        event_128936->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128935", strdup("nothing further"), event_128936, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128932(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128931 *futhark_mc_task_128931 = (struct futhark_mc_task_128931 *) args;
    struct futhark_context *ctx = futhark_mc_task_128931->ctx;
    struct mc_event *event_128938 = mc_event_new(ctx);
    
    if (event_128938 != NULL)
        event_128938->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128931->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128931->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128931->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112510 = {.desc ="mem_112510", .mem =futhark_mc_task_128931->free_mem_112510, .size =0, .references =NULL};
    int64_t flat_tid_121209 = futhark_mc_task_128931->free_flat_tid_121209;
    int64_t flat_tid_121231 = futhark_mc_task_128931->free_flat_tid_121231;
    double defunc_res_121207 = *futhark_mc_task_128931->retval_defunc_res_121207;
    struct memblock mem_112515 = {.desc ="mem_112515", .mem =futhark_mc_task_128931->retval_mem_112515, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_126089_cached_sizze_128933 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126089 = NULL;
    int32_t nsubtasks_126088;
    
    nsubtasks_126088 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_126089_cached_sizze_128933 < (int64_t) 8 * nsubtasks_126088) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126089, &reduce_stage_1_tid_res_arr_mem_126089_cached_sizze_128933, (int64_t) 8 * nsubtasks_126088);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128934 futhark_mc_segred_stage_1_parloop_struct_128934_;
    
    futhark_mc_segred_stage_1_parloop_struct_128934_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128934_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128934_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128934_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_128934_.free_mem_112510 = mem_112510.mem;
    futhark_mc_segred_stage_1_parloop_struct_128934_.free_mem_112515 = mem_112515.mem;
    futhark_mc_segred_stage_1_parloop_struct_128934_.free_reduce_stage_1_tid_res_arr_mem_126089 = reduce_stage_1_tid_res_arr_mem_126089;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128935_task;
    
    futhark_mc_segred_stage_1_parloop_128935_task.name = "futhark_mc_segred_stage_1_parloop_128935";
    futhark_mc_segred_stage_1_parloop_128935_task.fn = futhark_mc_segred_stage_1_parloop_128935;
    futhark_mc_segred_stage_1_parloop_128935_task.args = &futhark_mc_segred_stage_1_parloop_struct_128934_;
    futhark_mc_segred_stage_1_parloop_128935_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128935_task.info = info;
    
    struct mc_event *event_128937 = mc_event_new(ctx);
    
    if (event_128937 != NULL)
        event_128937->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128935_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128935_task);
    
    if (futhark_mc_segred_stage_1_parloop_128935_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128935_err;
        goto cleanup;
    }
    if (event_128937 != NULL) {
        event_128937->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128935_total", strdup("nothing further"), event_128937, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_121207 = 0.0;
    }
    
    double eta_p_126103;
    double eta_p_126104;
    
    for (int32_t i_126106 = 0; i_126106 < nsubtasks_126088; i_126106++) {
        flat_tid_121231 = i_126106;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_126103 = defunc_res_121207;
            }
            // load next params
            {
                eta_p_126104 = ((double *) reduce_stage_1_tid_res_arr_mem_126089)[flat_tid_121231];
            }
            // red body
            {
                double zp_res_126105 = eta_p_126103 + eta_p_126104;
                
                defunc_res_121207 = zp_res_126105;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_126089);
    }
    if (event_128938 != NULL) {
        event_128938->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128932", strdup("nothing further"), event_128938, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128931->retval_defunc_res_121207 = defunc_res_121207;
        futhark_mc_task_128931->retval_mem_112515 = mem_112515.mem;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_128941 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_112510;
    unsigned char *free_mem_112515;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126108;
};
struct futhark_mc_task_128943 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_112510;
    int64_t free_gtid_121210;
    int64_t free_flat_tid_121216;
    double *retval_defunc_res_121214;
    double *retval_defunc_res_121215;
};
struct futhark_mc_segred_stage_1_parloop_struct_128947 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_112510;
    int64_t free_gtid_121210;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126120;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126122;
};
static int futhark_mc_segred_stage_1_parloop_128948(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128947 *futhark_mc_segred_stage_1_parloop_struct_128947 = (struct futhark_mc_segred_stage_1_parloop_struct_128947 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128947->ctx;
    struct mc_event *event_128949 = mc_event_new(ctx);
    
    if (event_128949 != NULL)
        event_128949->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128947->free_m_33388;
    struct memblock mem_112510 = {.desc ="mem_112510", .mem =futhark_mc_segred_stage_1_parloop_struct_128947->free_mem_112510, .size =0, .references =NULL};
    int64_t gtid_121210 = futhark_mc_segred_stage_1_parloop_struct_128947->free_gtid_121210;
    struct memblock reduce_stage_1_tid_res_arr_mem_126120 = {.desc ="reduce_stage_1_tid_res_arr_mem_126120", .mem =futhark_mc_segred_stage_1_parloop_struct_128947->free_reduce_stage_1_tid_res_arr_mem_126120, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126122 = {.desc ="reduce_stage_1_tid_res_arr_mem_126122", .mem =futhark_mc_segred_stage_1_parloop_struct_128947->free_reduce_stage_1_tid_res_arr_mem_126122, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121216;
    
    flat_tid_121216 = subtask_id;
    {
        double eta_p_126124;
        double eta_p_126125;
        double eta_p_126127;
        double eta_p_126128;
        double local_acc_126130 = 0.0;
        double local_acc_126131 = 0.0;
        double eta_p_121218;
        double eta_p_121219;
        double eta_p_121221;
        double eta_p_121222;
        double local_acc_126132 = 0.0;
        double local_acc_126133 = 0.0;
        int64_t start_126134;
        int64_t end_126135;
        
        start_126134 = start;
        end_126135 = end;
        
        int64_t n_126136 = end_126135 - start_126134;
        
        for (int64_t SegRed_i_126137 = start_126134; SegRed_i_126137 < start_126134 + n_126136; SegRed_i_126137++) {
            int64_t gtid_121217 = SegRed_i_126137;
            double x_121224 = ((double *) mem_112510.mem)[gtid_121217 * m_33388 + gtid_121210];
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_121218 = local_acc_126132;
            }
            // Load next params
            {
                eta_p_121219 = x_121224;
            }
            // SegRed body
            {
                double zp_res_121220 = eta_p_121218 + eta_p_121219;
                
                local_acc_126132 = zp_res_121220;
            }
            // Load accum params
            {
                eta_p_121221 = local_acc_126133;
            }
            // Load next params
            {
                eta_p_121222 = x_121224;
            }
            // SegRed body
            {
                double zp_res_121223 = eta_p_121221 + eta_p_121222;
                
                local_acc_126133 = zp_res_121223;
            }
        }
        
        int64_t uni_i_126138 = 0;
        
        {
            int64_t gtid_121217 = uni_i_126138;
            
            // Load accum params
            {
                eta_p_126124 = local_acc_126130;
            }
            // Load next params
            {
                eta_p_126125 = local_acc_126132;
            }
            // SegRed body
            {
                double zp_res_126126 = eta_p_126124 + eta_p_126125;
                
                local_acc_126130 = zp_res_126126;
            }
            // Load accum params
            {
                eta_p_126127 = local_acc_126131;
            }
            // Load next params
            {
                eta_p_126128 = local_acc_126133;
            }
            // SegRed body
            {
                double zp_res_126129 = eta_p_126127 + eta_p_126128;
                
                local_acc_126131 = zp_res_126129;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_126120.mem)[flat_tid_121216] = local_acc_126130;
        ((double *) reduce_stage_1_tid_res_arr_mem_126122.mem)[flat_tid_121216] = local_acc_126131;
    }
    
  cleanup:
    { }
    if (event_128949 != NULL) {
        event_128949->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128948", strdup("nothing further"), event_128949, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128944(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128943 *futhark_mc_task_128943 = (struct futhark_mc_task_128943 *) args;
    struct futhark_context *ctx = futhark_mc_task_128943->ctx;
    struct mc_event *event_128951 = mc_event_new(ctx);
    
    if (event_128951 != NULL)
        event_128951->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128943->free_m_33388;
    struct memblock mem_112510 = {.desc ="mem_112510", .mem =futhark_mc_task_128943->free_mem_112510, .size =0, .references =NULL};
    int64_t gtid_121210 = futhark_mc_task_128943->free_gtid_121210;
    int64_t flat_tid_121216 = futhark_mc_task_128943->free_flat_tid_121216;
    double defunc_res_121214 = *futhark_mc_task_128943->retval_defunc_res_121214;
    double defunc_res_121215 = *futhark_mc_task_128943->retval_defunc_res_121215;
    int64_t reduce_stage_1_tid_res_arr_mem_126120_cached_sizze_128945 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126120 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_126122_cached_sizze_128946 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126122 = NULL;
    int32_t nsubtasks_126119;
    
    nsubtasks_126119 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_126120_cached_sizze_128945 < (int64_t) 8 * nsubtasks_126119) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126120, &reduce_stage_1_tid_res_arr_mem_126120_cached_sizze_128945, (int64_t) 8 * nsubtasks_126119);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_126122_cached_sizze_128946 < (int64_t) 8 * nsubtasks_126119) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126122, &reduce_stage_1_tid_res_arr_mem_126122_cached_sizze_128946, (int64_t) 8 * nsubtasks_126119);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128947 futhark_mc_segred_stage_1_parloop_struct_128947_;
    
    futhark_mc_segred_stage_1_parloop_struct_128947_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128947_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128947_.free_mem_112510 = mem_112510.mem;
    futhark_mc_segred_stage_1_parloop_struct_128947_.free_gtid_121210 = gtid_121210;
    futhark_mc_segred_stage_1_parloop_struct_128947_.free_reduce_stage_1_tid_res_arr_mem_126120 = reduce_stage_1_tid_res_arr_mem_126120;
    futhark_mc_segred_stage_1_parloop_struct_128947_.free_reduce_stage_1_tid_res_arr_mem_126122 = reduce_stage_1_tid_res_arr_mem_126122;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128948_task;
    
    futhark_mc_segred_stage_1_parloop_128948_task.name = "futhark_mc_segred_stage_1_parloop_128948";
    futhark_mc_segred_stage_1_parloop_128948_task.fn = futhark_mc_segred_stage_1_parloop_128948;
    futhark_mc_segred_stage_1_parloop_128948_task.args = &futhark_mc_segred_stage_1_parloop_struct_128947_;
    futhark_mc_segred_stage_1_parloop_128948_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128948_task.info = info;
    
    struct mc_event *event_128950 = mc_event_new(ctx);
    
    if (event_128950 != NULL)
        event_128950->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128948_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128948_task);
    
    if (futhark_mc_segred_stage_1_parloop_128948_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128948_err;
        goto cleanup;
    }
    if (event_128950 != NULL) {
        event_128950->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128948_total", strdup("nothing further"), event_128950, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_121214 = 0.0;
        defunc_res_121215 = 0.0;
    }
    
    double eta_p_126139;
    double eta_p_126140;
    double eta_p_126142;
    double eta_p_126143;
    
    for (int32_t i_126145 = 0; i_126145 < nsubtasks_126119; i_126145++) {
        flat_tid_121216 = i_126145;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_126139 = defunc_res_121214;
            }
            // load next params
            {
                eta_p_126140 = ((double *) reduce_stage_1_tid_res_arr_mem_126120)[flat_tid_121216];
            }
            // red body
            {
                double zp_res_126141 = eta_p_126139 + eta_p_126140;
                
                defunc_res_121214 = zp_res_126141;
            }
            // load acc params
            {
                eta_p_126142 = defunc_res_121215;
            }
            // load next params
            {
                eta_p_126143 = ((double *) reduce_stage_1_tid_res_arr_mem_126122)[flat_tid_121216];
            }
            // red body
            {
                double zp_res_126144 = eta_p_126142 + eta_p_126143;
                
                defunc_res_121215 = zp_res_126144;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_126120);
        free(reduce_stage_1_tid_res_arr_mem_126122);
    }
    if (event_128951 != NULL) {
        event_128951->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128944", strdup("nothing further"), event_128951, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128943->retval_defunc_res_121214 = defunc_res_121214;
        *futhark_mc_task_128943->retval_defunc_res_121215 = defunc_res_121215;
    }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_128942(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128941 *futhark_mc_segred_stage_1_parloop_struct_128941 = (struct futhark_mc_segred_stage_1_parloop_struct_128941 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128941->ctx;
    struct mc_event *event_128952 = mc_event_new(ctx);
    
    if (event_128952 != NULL)
        event_128952->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128941->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128941->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_128941->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112510 = {.desc ="mem_112510", .mem =futhark_mc_segred_stage_1_parloop_struct_128941->free_mem_112510, .size =0, .references =NULL};
    struct memblock mem_112515 = {.desc ="mem_112515", .mem =futhark_mc_segred_stage_1_parloop_struct_128941->free_mem_112515, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126108 = {.desc ="reduce_stage_1_tid_res_arr_mem_126108", .mem =futhark_mc_segred_stage_1_parloop_struct_128941->free_reduce_stage_1_tid_res_arr_mem_126108, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121209;
    
    flat_tid_121209 = subtask_id;
    {
        double eta_p_126110;
        double eta_p_126111;
        double local_acc_126113 = 0.0;
        double eta_p_121211;
        double eta_p_121212;
        double local_acc_126114 = 0.0;
        int64_t start_126115;
        int64_t end_126116;
        
        start_126115 = start;
        end_126116 = end;
        
        int64_t n_126117 = end_126116 - start_126115;
        
        for (int64_t SegRed_i_126118 = start_126115; SegRed_i_126118 < start_126115 + n_126117; SegRed_i_126118++) {
            int64_t gtid_121210 = SegRed_i_126118;
            double defunc_res_121214;
            double defunc_res_121215;
            int64_t flat_tid_121216 = (int64_t) 0;
            
            defunc_res_121214 = 0.0;
            defunc_res_121215 = 0.0;
            
            struct futhark_mc_task_128943 futhark_mc_task_128943_;
            
            futhark_mc_task_128943_.ctx = ctx;
            futhark_mc_task_128943_.free_m_33388 = m_33388;
            futhark_mc_task_128943_.free_mem_112510 = mem_112510.mem;
            futhark_mc_task_128943_.free_gtid_121210 = gtid_121210;
            futhark_mc_task_128943_.free_flat_tid_121216 = flat_tid_121216;
            futhark_mc_task_128943_.retval_defunc_res_121214 = (double *) &defunc_res_121214;
            #if ISPC
            futhark_mc_task_128943_.retval_defunc_res_121214 += programIndex;
            #endif
            futhark_mc_task_128943_.retval_defunc_res_121215 = (double *) &defunc_res_121215;
            #if ISPC
            futhark_mc_task_128943_.retval_defunc_res_121215 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_128943_task;
            
            futhark_mc_task_128943_task.args = &futhark_mc_task_128943_;
            futhark_mc_task_128943_task.top_level_fn = futhark_mc_segred_task_128944;
            futhark_mc_task_128943_task.name = "futhark_mc_segred_task_128944";
            futhark_mc_task_128943_task.iterations = m_33388;
            futhark_mc_task_128943_task.task_time = &ctx->program->futhark_mc_segred_task_128944_total_time;
            futhark_mc_task_128943_task.task_iter = &ctx->program->futhark_mc_segred_task_128944_total_iter;
            futhark_mc_task_128943_task.sched = STATIC;
            futhark_mc_task_128943_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_128944_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128943_task);
            
            if (futhark_mc_segred_task_128944_err != 0) {
                err = futhark_mc_segred_task_128944_err;
                goto cleanup;
            }
            
            bool zeze_res_121225 = defunc_res_121215 == 0.0;
            double klu_res_121226;
            
            if (zeze_res_121225) {
                klu_res_121226 = 0.0;
            } else {
                double eta_p_121227 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + gtid_121210];
                double zs_res_121228 = defunc_res_121215 / eta_p_121227;
                double log_res_121229 = futrts_log64(zs_res_121228);
                double zt_res_121230 = defunc_res_121215 * log_res_121229;
                
                klu_res_121226 = zt_res_121230;
            }
            // save map-out results
            {
                ((double *) mem_112515.mem)[gtid_121210] = defunc_res_121214;
            }
            // Load accum params
            {
                eta_p_121211 = local_acc_126114;
            }
            // Load next params
            {
                eta_p_121212 = klu_res_121226;
            }
            // SegRed body
            {
                double zp_res_121213 = eta_p_121211 + eta_p_121212;
                
                local_acc_126114 = zp_res_121213;
            }
        }
        
        int64_t uni_i_126146 = 0;
        
        {
            int64_t gtid_121210 = uni_i_126146;
            
            // Load accum params
            {
                eta_p_126110 = local_acc_126113;
            }
            // Load next params
            {
                eta_p_126111 = local_acc_126114;
            }
            // SegRed body
            {
                double zp_res_126112 = eta_p_126110 + eta_p_126111;
                
                local_acc_126113 = zp_res_126112;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_126108.mem)[flat_tid_121209] = local_acc_126113;
    }
    
  cleanup:
    { }
    if (event_128952 != NULL) {
        event_128952->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128942", strdup("nothing further"), event_128952, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_128939(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128931 *futhark_mc_task_128931 = (struct futhark_mc_task_128931 *) args;
    struct futhark_context *ctx = futhark_mc_task_128931->ctx;
    struct mc_event *event_128954 = mc_event_new(ctx);
    
    if (event_128954 != NULL)
        event_128954->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128931->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128931->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_128931->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112510 = {.desc ="mem_112510", .mem =futhark_mc_task_128931->free_mem_112510, .size =0, .references =NULL};
    int64_t flat_tid_121209 = futhark_mc_task_128931->free_flat_tid_121209;
    int64_t flat_tid_121231 = futhark_mc_task_128931->free_flat_tid_121231;
    double defunc_res_121207 = *futhark_mc_task_128931->retval_defunc_res_121207;
    struct memblock mem_112515 = {.desc ="mem_112515", .mem =futhark_mc_task_128931->retval_mem_112515, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_126108_cached_sizze_128940 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126108 = NULL;
    int32_t nsubtasks_126107;
    
    nsubtasks_126107 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_126108_cached_sizze_128940 < (int64_t) 8 * nsubtasks_126107) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126108, &reduce_stage_1_tid_res_arr_mem_126108_cached_sizze_128940, (int64_t) 8 * nsubtasks_126107);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128941 futhark_mc_segred_stage_1_parloop_struct_128941_;
    
    futhark_mc_segred_stage_1_parloop_struct_128941_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128941_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128941_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128941_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_128941_.free_mem_112510 = mem_112510.mem;
    futhark_mc_segred_stage_1_parloop_struct_128941_.free_mem_112515 = mem_112515.mem;
    futhark_mc_segred_stage_1_parloop_struct_128941_.free_reduce_stage_1_tid_res_arr_mem_126108 = reduce_stage_1_tid_res_arr_mem_126108;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128942_task;
    
    futhark_mc_segred_stage_1_parloop_128942_task.name = "futhark_mc_segred_stage_1_parloop_128942";
    futhark_mc_segred_stage_1_parloop_128942_task.fn = futhark_mc_segred_stage_1_parloop_128942;
    futhark_mc_segred_stage_1_parloop_128942_task.args = &futhark_mc_segred_stage_1_parloop_struct_128941_;
    futhark_mc_segred_stage_1_parloop_128942_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128942_task.info = info;
    
    struct mc_event *event_128953 = mc_event_new(ctx);
    
    if (event_128953 != NULL)
        event_128953->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128942_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128942_task);
    
    if (futhark_mc_segred_stage_1_parloop_128942_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128942_err;
        goto cleanup;
    }
    if (event_128953 != NULL) {
        event_128953->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128942_total", strdup("nothing further"), event_128953, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_121207 = 0.0;
    }
    
    double eta_p_126147;
    double eta_p_126148;
    
    for (int32_t i_126150 = 0; i_126150 < nsubtasks_126107; i_126150++) {
        flat_tid_121209 = i_126150;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_126147 = defunc_res_121207;
            }
            // load next params
            {
                eta_p_126148 = ((double *) reduce_stage_1_tid_res_arr_mem_126108)[flat_tid_121209];
            }
            // red body
            {
                double zp_res_126149 = eta_p_126147 + eta_p_126148;
                
                defunc_res_121207 = zp_res_126149;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_126108);
    }
    if (event_128954 != NULL) {
        event_128954->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_128939", strdup("nothing further"), event_128954, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128931->retval_defunc_res_121207 = defunc_res_121207;
        futhark_mc_task_128931->retval_mem_112515 = mem_112515.mem;
    }
    return err;
}
struct futhark_mc_task_128955 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    int64_t free_bytes_111715;
    unsigned char *free_mem_112431;
    unsigned char *free_mem_112507;
    unsigned char *free_mem_112510;
    int64_t free_flat_tid_121252;
    int64_t free_flat_tid_121325;
    double *retval_defunc_0_reduce_res_121250;
    double *retval_defunc_res_121251;
};
struct futhark_mc_segred_stage_1_parloop_struct_128959 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    int64_t free_bytes_111715;
    unsigned char *free_mem_112431;
    unsigned char *free_mem_112507;
    unsigned char *free_mem_112510;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126152;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126154;
};
static int futhark_mc_segred_stage_1_parloop_128960(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128959 *futhark_mc_segred_stage_1_parloop_struct_128959 = (struct futhark_mc_segred_stage_1_parloop_struct_128959 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128959->ctx;
    struct mc_event *event_128962 = mc_event_new(ctx);
    
    if (event_128962 != NULL)
        event_128962->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128959->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_128959->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128959->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_128959->free_A_mem_111707, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_segred_stage_1_parloop_struct_128959->free_bytes_111715;
    struct memblock mem_112431 = {.desc ="mem_112431", .mem =futhark_mc_segred_stage_1_parloop_struct_128959->free_mem_112431, .size =0, .references =NULL};
    struct memblock mem_112507 = {.desc ="mem_112507", .mem =futhark_mc_segred_stage_1_parloop_struct_128959->free_mem_112507, .size =0, .references =NULL};
    struct memblock mem_112510 = {.desc ="mem_112510", .mem =futhark_mc_segred_stage_1_parloop_struct_128959->free_mem_112510, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126152 = {.desc ="reduce_stage_1_tid_res_arr_mem_126152", .mem =futhark_mc_segred_stage_1_parloop_struct_128959->free_reduce_stage_1_tid_res_arr_mem_126152, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126154 = {.desc ="reduce_stage_1_tid_res_arr_mem_126154", .mem =futhark_mc_segred_stage_1_parloop_struct_128959->free_reduce_stage_1_tid_res_arr_mem_126154, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t mem_121343_cached_sizze_128961 = 0;
    unsigned char *mem_121343 = NULL;
    int64_t flat_tid_121325;
    
    flat_tid_121325 = subtask_id;
    {
        double eta_p_126156;
        double eta_p_126157;
        double eta_p_126159;
        double eta_p_126160;
        double local_acc_126162 = 0.0;
        double local_acc_126163 = 0.0;
        double eta_p_121327;
        double eta_p_121328;
        double eta_p_121330;
        double eta_p_121331;
        double local_acc_126164 = 0.0;
        double local_acc_126165 = 0.0;
        int64_t start_126166;
        int64_t end_126167;
        
        start_126166 = start;
        end_126167 = end;
        
        int64_t n_126168 = end_126167 - start_126166;
        
        if (mem_121343_cached_sizze_128961 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_121343, &mem_121343_cached_sizze_128961, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        for (int64_t SegRed_i_126169 = start_126166; SegRed_i_126169 < start_126166 + n_126168; SegRed_i_126169++) {
            int64_t gtid_121326 = SegRed_i_126169;
            double eta_p_121333 = ((double *) mem_112507.mem)[gtid_121326];
            double defunc_0_reduce_res_121334;
            double redout_121336 = 0.0;
            
            for (int64_t i_121335 = 0; i_121335 < m_33388; i_121335++) {
                double eta_p_121337 = ((double *) A_mem_111707.mem)[eta_p_106382 * (m_33388 * m_33388) + gtid_121326 * m_33388 + i_121335];
                double eta_p_121338 = ((double *) mem_112507.mem)[i_121335];
                double zt_res_121339 = eta_p_121337 * eta_p_121337;
                double zt_res_121340 = eta_p_121338 * zt_res_121339;
                double zp_res_121341 = zt_res_121340 + redout_121336;
                double redout_tmp_126170 = zp_res_121341;
                
                redout_121336 = redout_tmp_126170;
            }
            defunc_0_reduce_res_121334 = redout_121336;
            
            double zt_res_121342 = eta_p_121333 * defunc_0_reduce_res_121334;
            
            for (int64_t i_121346 = 0; i_121346 < m_33388; i_121346++) {
                double defunc_0_reduce_res_121348;
                double redout_121350 = 0.0;
                
                for (int64_t i_121349 = 0; i_121349 < m_33388; i_121349++) {
                    double eta_p_121351 = ((double *) A_mem_111707.mem)[eta_p_106382 * (m_33388 * m_33388) + gtid_121326 * m_33388 + i_121349];
                    double eta_p_121352 = ((double *) mem_112510.mem)[i_121349 * m_33388 + i_121346];
                    double zt_res_121353 = eta_p_121351 * eta_p_121352;
                    double zp_res_121354 = zt_res_121353 + redout_121350;
                    double redout_tmp_126172 = zp_res_121354;
                    
                    redout_121350 = redout_tmp_126172;
                }
                defunc_0_reduce_res_121348 = redout_121350;
                ((double *) mem_121343)[i_121346] = defunc_0_reduce_res_121348;
            }
            
            double defunc_0_reduce_res_121356;
            double redout_121358 = 0.0;
            
            for (int64_t i_121357 = 0; i_121357 < m_33388; i_121357++) {
                double eta_p_121359 = ((double *) mem_112510.mem)[gtid_121326 * m_33388 + i_121357];
                double defunc_0_reduce_res_121360;
                double redout_121362 = 0.0;
                
                for (int64_t i_121361 = 0; i_121361 < m_33388; i_121361++) {
                    double eta_p_121363 = ((double *) mem_121343)[i_121361];
                    double eta_p_121364 = ((double *) mem_112431.mem)[lifted_lambda_res_106391 * (m_33388 * m_33388) + i_121361 * m_33388 + i_121357];
                    double zt_res_121365 = eta_p_121363 * eta_p_121364;
                    double zp_res_121366 = zt_res_121365 + redout_121362;
                    double redout_tmp_126174 = zp_res_121366;
                    
                    redout_121362 = redout_tmp_126174;
                }
                defunc_0_reduce_res_121360 = redout_121362;
                
                double zt_res_121367 = eta_p_121359 * defunc_0_reduce_res_121360;
                double zp_res_121368 = zt_res_121367 + redout_121358;
                double redout_tmp_126173 = zp_res_121368;
                
                redout_121358 = redout_tmp_126173;
            }
            defunc_0_reduce_res_121356 = redout_121358;
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_121327 = local_acc_126164;
            }
            // Load next params
            {
                eta_p_121328 = zt_res_121342;
            }
            // SegRed body
            {
                double zp_res_121329 = eta_p_121327 + eta_p_121328;
                
                local_acc_126164 = zp_res_121329;
            }
            // Load accum params
            {
                eta_p_121330 = local_acc_126165;
            }
            // Load next params
            {
                eta_p_121331 = defunc_0_reduce_res_121356;
            }
            // SegRed body
            {
                double zp_res_121332 = eta_p_121330 + eta_p_121331;
                
                local_acc_126165 = zp_res_121332;
            }
        }
        
        int64_t uni_i_126175 = 0;
        
        {
            int64_t gtid_121326 = uni_i_126175;
            
            // Load accum params
            {
                eta_p_126156 = local_acc_126162;
            }
            // Load next params
            {
                eta_p_126157 = local_acc_126164;
            }
            // SegRed body
            {
                double zp_res_126158 = eta_p_126156 + eta_p_126157;
                
                local_acc_126162 = zp_res_126158;
            }
            // Load accum params
            {
                eta_p_126159 = local_acc_126163;
            }
            // Load next params
            {
                eta_p_126160 = local_acc_126165;
            }
            // SegRed body
            {
                double zp_res_126161 = eta_p_126159 + eta_p_126160;
                
                local_acc_126163 = zp_res_126161;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_126152.mem)[flat_tid_121325] = local_acc_126162;
        ((double *) reduce_stage_1_tid_res_arr_mem_126154.mem)[flat_tid_121325] = local_acc_126163;
    }
    
  cleanup:
    {
        free(mem_121343);
    }
    if (event_128962 != NULL) {
        event_128962->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128960", strdup("nothing further"), event_128962, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128956(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128955 *futhark_mc_task_128955 = (struct futhark_mc_task_128955 *) args;
    struct futhark_context *ctx = futhark_mc_task_128955->ctx;
    struct mc_event *event_128964 = mc_event_new(ctx);
    
    if (event_128964 != NULL)
        event_128964->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128955->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_128955->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128955->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_128955->free_A_mem_111707, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_task_128955->free_bytes_111715;
    struct memblock mem_112431 = {.desc ="mem_112431", .mem =futhark_mc_task_128955->free_mem_112431, .size =0, .references =NULL};
    struct memblock mem_112507 = {.desc ="mem_112507", .mem =futhark_mc_task_128955->free_mem_112507, .size =0, .references =NULL};
    struct memblock mem_112510 = {.desc ="mem_112510", .mem =futhark_mc_task_128955->free_mem_112510, .size =0, .references =NULL};
    int64_t flat_tid_121252 = futhark_mc_task_128955->free_flat_tid_121252;
    int64_t flat_tid_121325 = futhark_mc_task_128955->free_flat_tid_121325;
    double defunc_0_reduce_res_121250 = *futhark_mc_task_128955->retval_defunc_0_reduce_res_121250;
    double defunc_res_121251 = *futhark_mc_task_128955->retval_defunc_res_121251;
    int64_t reduce_stage_1_tid_res_arr_mem_126152_cached_sizze_128957 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126152 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_126154_cached_sizze_128958 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126154 = NULL;
    int32_t nsubtasks_126151;
    
    nsubtasks_126151 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_126152_cached_sizze_128957 < (int64_t) 8 * nsubtasks_126151) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126152, &reduce_stage_1_tid_res_arr_mem_126152_cached_sizze_128957, (int64_t) 8 * nsubtasks_126151);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_126154_cached_sizze_128958 < (int64_t) 8 * nsubtasks_126151) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126154, &reduce_stage_1_tid_res_arr_mem_126154_cached_sizze_128958, (int64_t) 8 * nsubtasks_126151);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128959 futhark_mc_segred_stage_1_parloop_struct_128959_;
    
    futhark_mc_segred_stage_1_parloop_struct_128959_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128959_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128959_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_128959_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128959_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_128959_.free_bytes_111715 = bytes_111715;
    futhark_mc_segred_stage_1_parloop_struct_128959_.free_mem_112431 = mem_112431.mem;
    futhark_mc_segred_stage_1_parloop_struct_128959_.free_mem_112507 = mem_112507.mem;
    futhark_mc_segred_stage_1_parloop_struct_128959_.free_mem_112510 = mem_112510.mem;
    futhark_mc_segred_stage_1_parloop_struct_128959_.free_reduce_stage_1_tid_res_arr_mem_126152 = reduce_stage_1_tid_res_arr_mem_126152;
    futhark_mc_segred_stage_1_parloop_struct_128959_.free_reduce_stage_1_tid_res_arr_mem_126154 = reduce_stage_1_tid_res_arr_mem_126154;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128960_task;
    
    futhark_mc_segred_stage_1_parloop_128960_task.name = "futhark_mc_segred_stage_1_parloop_128960";
    futhark_mc_segred_stage_1_parloop_128960_task.fn = futhark_mc_segred_stage_1_parloop_128960;
    futhark_mc_segred_stage_1_parloop_128960_task.args = &futhark_mc_segred_stage_1_parloop_struct_128959_;
    futhark_mc_segred_stage_1_parloop_128960_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128960_task.info = info;
    
    struct mc_event *event_128963 = mc_event_new(ctx);
    
    if (event_128963 != NULL)
        event_128963->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128960_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128960_task);
    
    if (futhark_mc_segred_stage_1_parloop_128960_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128960_err;
        goto cleanup;
    }
    if (event_128963 != NULL) {
        event_128963->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128960_total", strdup("nothing further"), event_128963, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_121250 = 0.0;
        defunc_res_121251 = 0.0;
    }
    
    double eta_p_126176;
    double eta_p_126177;
    double eta_p_126179;
    double eta_p_126180;
    
    for (int32_t i_126182 = 0; i_126182 < nsubtasks_126151; i_126182++) {
        flat_tid_121325 = i_126182;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_126176 = defunc_0_reduce_res_121250;
            }
            // load next params
            {
                eta_p_126177 = ((double *) reduce_stage_1_tid_res_arr_mem_126152)[flat_tid_121325];
            }
            // red body
            {
                double zp_res_126178 = eta_p_126176 + eta_p_126177;
                
                defunc_0_reduce_res_121250 = zp_res_126178;
            }
            // load acc params
            {
                eta_p_126179 = defunc_res_121251;
            }
            // load next params
            {
                eta_p_126180 = ((double *) reduce_stage_1_tid_res_arr_mem_126154)[flat_tid_121325];
            }
            // red body
            {
                double zp_res_126181 = eta_p_126179 + eta_p_126180;
                
                defunc_res_121251 = zp_res_126181;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_126152);
        free(reduce_stage_1_tid_res_arr_mem_126154);
    }
    if (event_128964 != NULL) {
        event_128964->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128956", strdup("nothing further"), event_128964, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128955->retval_defunc_0_reduce_res_121250 = defunc_0_reduce_res_121250;
        *futhark_mc_task_128955->retval_defunc_res_121251 = defunc_res_121251;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_128968 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    int64_t free_bytes_111715;
    unsigned char *free_mem_112431;
    unsigned char *free_mem_112507;
    unsigned char *free_mem_112510;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126184;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126186;
};
struct futhark_mc_task_128971 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112507;
    int64_t free_gtid_121253;
    int64_t free_flat_tid_121262;
    double *retval_defunc_0_reduce_res_121261;
};
struct futhark_mc_segred_stage_1_parloop_struct_128974 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112507;
    int64_t free_gtid_121253;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126203;
};
static int futhark_mc_segred_stage_1_parloop_128975(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128974 *futhark_mc_segred_stage_1_parloop_struct_128974 = (struct futhark_mc_segred_stage_1_parloop_struct_128974 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128974->ctx;
    struct mc_event *event_128976 = mc_event_new(ctx);
    
    if (event_128976 != NULL)
        event_128976->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128974->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_128974->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_128974->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112507 = {.desc ="mem_112507", .mem =futhark_mc_segred_stage_1_parloop_struct_128974->free_mem_112507, .size =0, .references =NULL};
    int64_t gtid_121253 = futhark_mc_segred_stage_1_parloop_struct_128974->free_gtid_121253;
    struct memblock reduce_stage_1_tid_res_arr_mem_126203 = {.desc ="reduce_stage_1_tid_res_arr_mem_126203", .mem =futhark_mc_segred_stage_1_parloop_struct_128974->free_reduce_stage_1_tid_res_arr_mem_126203, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121262;
    
    flat_tid_121262 = subtask_id;
    {
        double eta_p_126205;
        double eta_p_126206;
        double local_acc_126208 = 0.0;
        double eta_p_121264;
        double eta_p_121265;
        double local_acc_126209 = 0.0;
        int64_t start_126210;
        int64_t end_126211;
        
        start_126210 = start;
        end_126211 = end;
        
        int64_t n_126212 = end_126211 - start_126210;
        
        for (int64_t SegRed_i_126213 = start_126210; SegRed_i_126213 < start_126210 + n_126212; SegRed_i_126213++) {
            int64_t gtid_121263 = SegRed_i_126213;
            double eta_p_121267 = ((double *) A_mem_111707.mem)[eta_p_106382 * (m_33388 * m_33388) + gtid_121253 * m_33388 + gtid_121263];
            double eta_p_121268 = ((double *) mem_112507.mem)[gtid_121263];
            double zt_res_121269 = eta_p_121267 * eta_p_121267;
            double zt_res_121270 = eta_p_121268 * zt_res_121269;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_121264 = local_acc_126209;
            }
            // Load next params
            {
                eta_p_121265 = zt_res_121270;
            }
            // SegRed body
            {
                double zp_res_121266 = eta_p_121264 + eta_p_121265;
                
                local_acc_126209 = zp_res_121266;
            }
        }
        
        int64_t uni_i_126214 = 0;
        
        {
            int64_t gtid_121263 = uni_i_126214;
            
            // Load accum params
            {
                eta_p_126205 = local_acc_126208;
            }
            // Load next params
            {
                eta_p_126206 = local_acc_126209;
            }
            // SegRed body
            {
                double zp_res_126207 = eta_p_126205 + eta_p_126206;
                
                local_acc_126208 = zp_res_126207;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_126203.mem)[flat_tid_121262] = local_acc_126208;
    }
    
  cleanup:
    { }
    if (event_128976 != NULL) {
        event_128976->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128975", strdup("nothing further"), event_128976, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128972(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128971 *futhark_mc_task_128971 = (struct futhark_mc_task_128971 *) args;
    struct futhark_context *ctx = futhark_mc_task_128971->ctx;
    struct mc_event *event_128978 = mc_event_new(ctx);
    
    if (event_128978 != NULL)
        event_128978->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128971->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_128971->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_128971->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112507 = {.desc ="mem_112507", .mem =futhark_mc_task_128971->free_mem_112507, .size =0, .references =NULL};
    int64_t gtid_121253 = futhark_mc_task_128971->free_gtid_121253;
    int64_t flat_tid_121262 = futhark_mc_task_128971->free_flat_tid_121262;
    double defunc_0_reduce_res_121261 = *futhark_mc_task_128971->retval_defunc_0_reduce_res_121261;
    int64_t reduce_stage_1_tid_res_arr_mem_126203_cached_sizze_128973 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126203 = NULL;
    int32_t nsubtasks_126202;
    
    nsubtasks_126202 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_126203_cached_sizze_128973 < (int64_t) 8 * nsubtasks_126202) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126203, &reduce_stage_1_tid_res_arr_mem_126203_cached_sizze_128973, (int64_t) 8 * nsubtasks_126202);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128974 futhark_mc_segred_stage_1_parloop_struct_128974_;
    
    futhark_mc_segred_stage_1_parloop_struct_128974_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128974_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128974_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_128974_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_128974_.free_mem_112507 = mem_112507.mem;
    futhark_mc_segred_stage_1_parloop_struct_128974_.free_gtid_121253 = gtid_121253;
    futhark_mc_segred_stage_1_parloop_struct_128974_.free_reduce_stage_1_tid_res_arr_mem_126203 = reduce_stage_1_tid_res_arr_mem_126203;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128975_task;
    
    futhark_mc_segred_stage_1_parloop_128975_task.name = "futhark_mc_segred_stage_1_parloop_128975";
    futhark_mc_segred_stage_1_parloop_128975_task.fn = futhark_mc_segred_stage_1_parloop_128975;
    futhark_mc_segred_stage_1_parloop_128975_task.args = &futhark_mc_segred_stage_1_parloop_struct_128974_;
    futhark_mc_segred_stage_1_parloop_128975_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128975_task.info = info;
    
    struct mc_event *event_128977 = mc_event_new(ctx);
    
    if (event_128977 != NULL)
        event_128977->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128975_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128975_task);
    
    if (futhark_mc_segred_stage_1_parloop_128975_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128975_err;
        goto cleanup;
    }
    if (event_128977 != NULL) {
        event_128977->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128975_total", strdup("nothing further"), event_128977, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_121261 = 0.0;
    }
    
    double eta_p_126215;
    double eta_p_126216;
    
    for (int32_t i_126218 = 0; i_126218 < nsubtasks_126202; i_126218++) {
        flat_tid_121262 = i_126218;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_126215 = defunc_0_reduce_res_121261;
            }
            // load next params
            {
                eta_p_126216 = ((double *) reduce_stage_1_tid_res_arr_mem_126203)[flat_tid_121262];
            }
            // red body
            {
                double zp_res_126217 = eta_p_126215 + eta_p_126216;
                
                defunc_0_reduce_res_121261 = zp_res_126217;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_126203);
    }
    if (event_128978 != NULL) {
        event_128978->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128972", strdup("nothing further"), event_128978, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128971->retval_defunc_0_reduce_res_121261 = defunc_0_reduce_res_121261;
    }
    return err;
}
struct futhark_mc_task_128979 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112510;
    int64_t free_gtid_121253;
    unsigned char *free_mem_121272;
};
struct futhark_mc_segmap_parloop_struct_128981 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112510;
    int64_t free_gtid_121253;
    unsigned char *free_mem_121272;
};
static int futhark_mc_segmap_parloop_128982(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_128981 *futhark_mc_segmap_parloop_struct_128981 = (struct futhark_mc_segmap_parloop_struct_128981 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_128981->ctx;
    struct mc_event *event_128983 = mc_event_new(ctx);
    
    if (event_128983 != NULL)
        event_128983->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_128981->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segmap_parloop_struct_128981->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segmap_parloop_struct_128981->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112510 = {.desc ="mem_112510", .mem =futhark_mc_segmap_parloop_struct_128981->free_mem_112510, .size =0, .references =NULL};
    int64_t gtid_121253 = futhark_mc_segmap_parloop_struct_128981->free_gtid_121253;
    struct memblock mem_121272 = {.desc ="mem_121272", .mem =futhark_mc_segmap_parloop_struct_128981->free_mem_121272, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121285;
    
    flat_tid_121285 = subtask_id;
    {
        int64_t start_126226;
        int64_t end_126227;
        
        start_126226 = start;
        end_126227 = end;
        
        int64_t n_126228 = end_126227 - start_126226;
        
        for (int64_t SegMap_i_126229 = start_126226; SegMap_i_126229 < start_126226 + n_126228; SegMap_i_126229++) {
            int64_t slice_126230 = m_33388;
            int64_t gtid_121286 = SegMap_i_126229;
            int64_t remnant_126231 = SegMap_i_126229 - gtid_121286;
            double defunc_0_reduce_res_121287;
            double redout_126221 = 0.0;
            
            for (int64_t i_126220 = 0; i_126220 < m_33388; i_126220++) {
                double eta_p_126222 = ((double *) A_mem_111707.mem)[eta_p_106382 * (m_33388 * m_33388) + gtid_121253 * m_33388 + i_126220];
                double eta_p_126223 = ((double *) mem_112510.mem)[i_126220 * m_33388 + gtid_121286];
                double zt_res_126224 = eta_p_126222 * eta_p_126223;
                double zp_res_126225 = zt_res_126224 + redout_126221;
                double redout_tmp_126232 = zp_res_126225;
                
                redout_126221 = redout_tmp_126232;
            }
            defunc_0_reduce_res_121287 = redout_126221;
            ((double *) mem_121272.mem)[gtid_121286] = defunc_0_reduce_res_121287;
        }
    }
    
  cleanup:
    { }
    if (event_128983 != NULL) {
        event_128983->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128982", strdup("nothing further"), event_128983, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_task_128980(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128979 *futhark_mc_task_128979 = (struct futhark_mc_task_128979 *) args;
    struct futhark_context *ctx = futhark_mc_task_128979->ctx;
    struct mc_event *event_128985 = mc_event_new(ctx);
    
    if (event_128985 != NULL)
        event_128985->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128979->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_128979->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_128979->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112510 = {.desc ="mem_112510", .mem =futhark_mc_task_128979->free_mem_112510, .size =0, .references =NULL};
    int64_t gtid_121253 = futhark_mc_task_128979->free_gtid_121253;
    struct memblock mem_121272 = {.desc ="mem_121272", .mem =futhark_mc_task_128979->free_mem_121272, .size =0, .references =NULL};
    int32_t nsubtasks_126219;
    
    nsubtasks_126219 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_128981 futhark_mc_segmap_parloop_struct_128981_;
    
    futhark_mc_segmap_parloop_struct_128981_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_128981_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_128981_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segmap_parloop_struct_128981_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segmap_parloop_struct_128981_.free_mem_112510 = mem_112510.mem;
    futhark_mc_segmap_parloop_struct_128981_.free_gtid_121253 = gtid_121253;
    futhark_mc_segmap_parloop_struct_128981_.free_mem_121272 = mem_121272.mem;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_128982_task;
    
    futhark_mc_segmap_parloop_128982_task.name = "futhark_mc_segmap_parloop_128982";
    futhark_mc_segmap_parloop_128982_task.fn = futhark_mc_segmap_parloop_128982;
    futhark_mc_segmap_parloop_128982_task.args = &futhark_mc_segmap_parloop_struct_128981_;
    futhark_mc_segmap_parloop_128982_task.iterations = iterations;
    futhark_mc_segmap_parloop_128982_task.info = info;
    
    struct mc_event *event_128984 = mc_event_new(ctx);
    
    if (event_128984 != NULL)
        event_128984->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_128982_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_128982_task);
    
    if (futhark_mc_segmap_parloop_128982_err != 0) {
        err = futhark_mc_segmap_parloop_128982_err;
        goto cleanup;
    }
    if (event_128984 != NULL) {
        event_128984->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128982_total", strdup("nothing further"), event_128984, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_128985 != NULL) {
        event_128985->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_task_128980", strdup("nothing further"), event_128985, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_segmap_parloop_struct_128987 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112510;
    int64_t free_gtid_121253;
    unsigned char *free_mem_121272;
};
struct futhark_mc_task_128989 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112510;
    int64_t free_gtid_121253;
    int64_t free_gtid_121275;
    int64_t free_flat_tid_126234;
    double *retval_defunc_0_reduce_res_121276;
};
struct futhark_mc_segred_stage_1_parloop_struct_128992 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112510;
    int64_t free_gtid_121253;
    int64_t free_gtid_121275;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126249;
};
static int futhark_mc_segred_stage_1_parloop_128993(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128992 *futhark_mc_segred_stage_1_parloop_struct_128992 = (struct futhark_mc_segred_stage_1_parloop_struct_128992 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128992->ctx;
    struct mc_event *event_128994 = mc_event_new(ctx);
    
    if (event_128994 != NULL)
        event_128994->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128992->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_128992->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_128992->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112510 = {.desc ="mem_112510", .mem =futhark_mc_segred_stage_1_parloop_struct_128992->free_mem_112510, .size =0, .references =NULL};
    int64_t gtid_121253 = futhark_mc_segred_stage_1_parloop_struct_128992->free_gtid_121253;
    int64_t gtid_121275 = futhark_mc_segred_stage_1_parloop_struct_128992->free_gtid_121275;
    struct memblock reduce_stage_1_tid_res_arr_mem_126249 = {.desc ="reduce_stage_1_tid_res_arr_mem_126249", .mem =futhark_mc_segred_stage_1_parloop_struct_128992->free_reduce_stage_1_tid_res_arr_mem_126249, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_126234;
    
    flat_tid_126234 = subtask_id;
    {
        double eta_p_126251;
        double eta_p_126252;
        double local_acc_126254 = 0.0;
        double eta_p_126236;
        double eta_p_126237;
        double local_acc_126255 = 0.0;
        int64_t start_126256;
        int64_t end_126257;
        
        start_126256 = start;
        end_126257 = end;
        
        int64_t n_126258 = end_126257 - start_126256;
        
        for (int64_t SegRed_i_126259 = start_126256; SegRed_i_126259 < start_126256 + n_126258; SegRed_i_126259++) {
            int64_t gtid_126235 = SegRed_i_126259;
            double eta_p_126239 = ((double *) A_mem_111707.mem)[eta_p_106382 * (m_33388 * m_33388) + gtid_121253 * m_33388 + gtid_126235];
            double eta_p_126240 = ((double *) mem_112510.mem)[gtid_126235 * m_33388 + gtid_121275];
            double zt_res_126241 = eta_p_126239 * eta_p_126240;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_126236 = local_acc_126255;
            }
            // Load next params
            {
                eta_p_126237 = zt_res_126241;
            }
            // SegRed body
            {
                double zp_res_126238 = eta_p_126236 + eta_p_126237;
                
                local_acc_126255 = zp_res_126238;
            }
        }
        
        int64_t uni_i_126260 = 0;
        
        {
            int64_t gtid_126235 = uni_i_126260;
            
            // Load accum params
            {
                eta_p_126251 = local_acc_126254;
            }
            // Load next params
            {
                eta_p_126252 = local_acc_126255;
            }
            // SegRed body
            {
                double zp_res_126253 = eta_p_126251 + eta_p_126252;
                
                local_acc_126254 = zp_res_126253;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_126249.mem)[flat_tid_126234] = local_acc_126254;
    }
    
  cleanup:
    { }
    if (event_128994 != NULL) {
        event_128994->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128993", strdup("nothing further"), event_128994, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_128990(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128989 *futhark_mc_task_128989 = (struct futhark_mc_task_128989 *) args;
    struct futhark_context *ctx = futhark_mc_task_128989->ctx;
    struct mc_event *event_128996 = mc_event_new(ctx);
    
    if (event_128996 != NULL)
        event_128996->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128989->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_128989->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_128989->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112510 = {.desc ="mem_112510", .mem =futhark_mc_task_128989->free_mem_112510, .size =0, .references =NULL};
    int64_t gtid_121253 = futhark_mc_task_128989->free_gtid_121253;
    int64_t gtid_121275 = futhark_mc_task_128989->free_gtid_121275;
    int64_t flat_tid_126234 = futhark_mc_task_128989->free_flat_tid_126234;
    double defunc_0_reduce_res_121276 = *futhark_mc_task_128989->retval_defunc_0_reduce_res_121276;
    int64_t reduce_stage_1_tid_res_arr_mem_126249_cached_sizze_128991 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126249 = NULL;
    int32_t nsubtasks_126248;
    
    nsubtasks_126248 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_126249_cached_sizze_128991 < (int64_t) 8 * nsubtasks_126248) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126249, &reduce_stage_1_tid_res_arr_mem_126249_cached_sizze_128991, (int64_t) 8 * nsubtasks_126248);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128992 futhark_mc_segred_stage_1_parloop_struct_128992_;
    
    futhark_mc_segred_stage_1_parloop_struct_128992_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128992_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128992_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_128992_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_128992_.free_mem_112510 = mem_112510.mem;
    futhark_mc_segred_stage_1_parloop_struct_128992_.free_gtid_121253 = gtid_121253;
    futhark_mc_segred_stage_1_parloop_struct_128992_.free_gtid_121275 = gtid_121275;
    futhark_mc_segred_stage_1_parloop_struct_128992_.free_reduce_stage_1_tid_res_arr_mem_126249 = reduce_stage_1_tid_res_arr_mem_126249;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128993_task;
    
    futhark_mc_segred_stage_1_parloop_128993_task.name = "futhark_mc_segred_stage_1_parloop_128993";
    futhark_mc_segred_stage_1_parloop_128993_task.fn = futhark_mc_segred_stage_1_parloop_128993;
    futhark_mc_segred_stage_1_parloop_128993_task.args = &futhark_mc_segred_stage_1_parloop_struct_128992_;
    futhark_mc_segred_stage_1_parloop_128993_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128993_task.info = info;
    
    struct mc_event *event_128995 = mc_event_new(ctx);
    
    if (event_128995 != NULL)
        event_128995->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128993_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128993_task);
    
    if (futhark_mc_segred_stage_1_parloop_128993_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128993_err;
        goto cleanup;
    }
    if (event_128995 != NULL) {
        event_128995->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128993_total", strdup("nothing further"), event_128995, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_121276 = 0.0;
    }
    
    double eta_p_126261;
    double eta_p_126262;
    
    for (int32_t i_126264 = 0; i_126264 < nsubtasks_126248; i_126264++) {
        flat_tid_126234 = i_126264;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_126261 = defunc_0_reduce_res_121276;
            }
            // load next params
            {
                eta_p_126262 = ((double *) reduce_stage_1_tid_res_arr_mem_126249)[flat_tid_126234];
            }
            // red body
            {
                double zp_res_126263 = eta_p_126261 + eta_p_126262;
                
                defunc_0_reduce_res_121276 = zp_res_126263;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_126249);
    }
    if (event_128996 != NULL) {
        event_128996->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_128990", strdup("nothing further"), event_128996, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128989->retval_defunc_0_reduce_res_121276 = defunc_0_reduce_res_121276;
    }
    return err;
}
static int futhark_mc_segmap_parloop_128988(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_128987 *futhark_mc_segmap_parloop_struct_128987 = (struct futhark_mc_segmap_parloop_struct_128987 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_128987->ctx;
    struct mc_event *event_128997 = mc_event_new(ctx);
    
    if (event_128997 != NULL)
        event_128997->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_128987->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segmap_parloop_struct_128987->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segmap_parloop_struct_128987->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112510 = {.desc ="mem_112510", .mem =futhark_mc_segmap_parloop_struct_128987->free_mem_112510, .size =0, .references =NULL};
    int64_t gtid_121253 = futhark_mc_segmap_parloop_struct_128987->free_gtid_121253;
    struct memblock mem_121272 = {.desc ="mem_121272", .mem =futhark_mc_segmap_parloop_struct_128987->free_mem_121272, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121274;
    
    flat_tid_121274 = subtask_id;
    {
        int64_t start_126242;
        int64_t end_126243;
        
        start_126242 = start;
        end_126243 = end;
        
        int64_t n_126244 = end_126243 - start_126242;
        
        for (int64_t SegMap_i_126245 = start_126242; SegMap_i_126245 < start_126242 + n_126244; SegMap_i_126245++) {
            int64_t slice_126246 = m_33388;
            int64_t gtid_121275 = SegMap_i_126245;
            int64_t remnant_126247 = SegMap_i_126245 - gtid_121275;
            double defunc_0_reduce_res_121276;
            int64_t flat_tid_126234 = (int64_t) 0;
            
            defunc_0_reduce_res_121276 = 0.0;
            
            struct futhark_mc_task_128989 futhark_mc_task_128989_;
            
            futhark_mc_task_128989_.ctx = ctx;
            futhark_mc_task_128989_.free_m_33388 = m_33388;
            futhark_mc_task_128989_.free_eta_p_106382 = eta_p_106382;
            futhark_mc_task_128989_.free_A_mem_111707 = A_mem_111707.mem;
            futhark_mc_task_128989_.free_mem_112510 = mem_112510.mem;
            futhark_mc_task_128989_.free_gtid_121253 = gtid_121253;
            futhark_mc_task_128989_.free_gtid_121275 = gtid_121275;
            futhark_mc_task_128989_.free_flat_tid_126234 = flat_tid_126234;
            futhark_mc_task_128989_.retval_defunc_0_reduce_res_121276 = (double *) &defunc_0_reduce_res_121276;
            #if ISPC
            futhark_mc_task_128989_.retval_defunc_0_reduce_res_121276 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_128989_task;
            
            futhark_mc_task_128989_task.args = &futhark_mc_task_128989_;
            futhark_mc_task_128989_task.top_level_fn = futhark_mc_segred_task_128990;
            futhark_mc_task_128989_task.name = "futhark_mc_segred_task_128990";
            futhark_mc_task_128989_task.iterations = m_33388;
            futhark_mc_task_128989_task.task_time = &ctx->program->futhark_mc_segred_task_128990_total_time;
            futhark_mc_task_128989_task.task_iter = &ctx->program->futhark_mc_segred_task_128990_total_iter;
            futhark_mc_task_128989_task.sched = STATIC;
            futhark_mc_task_128989_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_128990_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128989_task);
            
            if (futhark_mc_segred_task_128990_err != 0) {
                err = futhark_mc_segred_task_128990_err;
                goto cleanup;
            }
            ((double *) mem_121272.mem)[gtid_121275] = defunc_0_reduce_res_121276;
        }
    }
    
  cleanup:
    { }
    if (event_128997 != NULL) {
        event_128997->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128988", strdup("nothing further"), event_128997, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_nested_task_128986(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128979 *futhark_mc_task_128979 = (struct futhark_mc_task_128979 *) args;
    struct futhark_context *ctx = futhark_mc_task_128979->ctx;
    struct mc_event *event_128999 = mc_event_new(ctx);
    
    if (event_128999 != NULL)
        event_128999->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128979->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_128979->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_128979->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112510 = {.desc ="mem_112510", .mem =futhark_mc_task_128979->free_mem_112510, .size =0, .references =NULL};
    int64_t gtid_121253 = futhark_mc_task_128979->free_gtid_121253;
    struct memblock mem_121272 = {.desc ="mem_121272", .mem =futhark_mc_task_128979->free_mem_121272, .size =0, .references =NULL};
    int32_t nsubtasks_126233;
    
    nsubtasks_126233 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_128987 futhark_mc_segmap_parloop_struct_128987_;
    
    futhark_mc_segmap_parloop_struct_128987_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_128987_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_128987_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segmap_parloop_struct_128987_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segmap_parloop_struct_128987_.free_mem_112510 = mem_112510.mem;
    futhark_mc_segmap_parloop_struct_128987_.free_gtid_121253 = gtid_121253;
    futhark_mc_segmap_parloop_struct_128987_.free_mem_121272 = mem_121272.mem;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_128988_task;
    
    futhark_mc_segmap_parloop_128988_task.name = "futhark_mc_segmap_parloop_128988";
    futhark_mc_segmap_parloop_128988_task.fn = futhark_mc_segmap_parloop_128988;
    futhark_mc_segmap_parloop_128988_task.args = &futhark_mc_segmap_parloop_struct_128987_;
    futhark_mc_segmap_parloop_128988_task.iterations = iterations;
    futhark_mc_segmap_parloop_128988_task.info = info;
    
    struct mc_event *event_128998 = mc_event_new(ctx);
    
    if (event_128998 != NULL)
        event_128998->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_128988_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_128988_task);
    
    if (futhark_mc_segmap_parloop_128988_err != 0) {
        err = futhark_mc_segmap_parloop_128988_err;
        goto cleanup;
    }
    if (event_128998 != NULL) {
        event_128998->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_128988_total", strdup("nothing further"), event_128998, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_128999 != NULL) {
        event_128999->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_nested_task_128986", strdup("nothing further"), event_128999, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_129000 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_mem_112431;
    unsigned char *free_mem_112510;
    int64_t free_gtid_121253;
    unsigned char *free_mem_121272;
    int64_t free_flat_tid_121295;
    int64_t free_flat_tid_121311;
    double *retval_defunc_0_reduce_res_121294;
};
struct futhark_mc_segred_stage_1_parloop_struct_129003 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_mem_112431;
    unsigned char *free_mem_112510;
    int64_t free_gtid_121253;
    unsigned char *free_mem_121272;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126266;
};
static int futhark_mc_segred_stage_1_parloop_129004(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_129003 *futhark_mc_segred_stage_1_parloop_struct_129003 = (struct futhark_mc_segred_stage_1_parloop_struct_129003 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_129003->ctx;
    struct mc_event *event_129005 = mc_event_new(ctx);
    
    if (event_129005 != NULL)
        event_129005->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_129003->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_129003->free_lifted_lambda_res_106391;
    struct memblock mem_112431 = {.desc ="mem_112431", .mem =futhark_mc_segred_stage_1_parloop_struct_129003->free_mem_112431, .size =0, .references =NULL};
    struct memblock mem_112510 = {.desc ="mem_112510", .mem =futhark_mc_segred_stage_1_parloop_struct_129003->free_mem_112510, .size =0, .references =NULL};
    int64_t gtid_121253 = futhark_mc_segred_stage_1_parloop_struct_129003->free_gtid_121253;
    struct memblock mem_121272 = {.desc ="mem_121272", .mem =futhark_mc_segred_stage_1_parloop_struct_129003->free_mem_121272, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126266 = {.desc ="reduce_stage_1_tid_res_arr_mem_126266", .mem =futhark_mc_segred_stage_1_parloop_struct_129003->free_reduce_stage_1_tid_res_arr_mem_126266, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121311;
    
    flat_tid_121311 = subtask_id;
    {
        double eta_p_126268;
        double eta_p_126269;
        double local_acc_126271 = 0.0;
        double eta_p_121313;
        double eta_p_121314;
        double local_acc_126272 = 0.0;
        int64_t start_126273;
        int64_t end_126274;
        
        start_126273 = start;
        end_126274 = end;
        
        int64_t n_126275 = end_126274 - start_126273;
        
        for (int64_t SegRed_i_126276 = start_126273; SegRed_i_126276 < start_126273 + n_126275; SegRed_i_126276++) {
            int64_t gtid_121312 = SegRed_i_126276;
            double eta_p_121316 = ((double *) mem_112510.mem)[gtid_121253 * m_33388 + gtid_121312];
            double defunc_0_reduce_res_121317;
            double redout_121319 = 0.0;
            
            for (int64_t i_121318 = 0; i_121318 < m_33388; i_121318++) {
                double eta_p_121320 = ((double *) mem_121272.mem)[i_121318];
                double eta_p_121321 = ((double *) mem_112431.mem)[lifted_lambda_res_106391 * (m_33388 * m_33388) + i_121318 * m_33388 + gtid_121312];
                double zt_res_121322 = eta_p_121320 * eta_p_121321;
                double zp_res_121323 = zt_res_121322 + redout_121319;
                double redout_tmp_126277 = zp_res_121323;
                
                redout_121319 = redout_tmp_126277;
            }
            defunc_0_reduce_res_121317 = redout_121319;
            
            double zt_res_121324 = eta_p_121316 * defunc_0_reduce_res_121317;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_121313 = local_acc_126272;
            }
            // Load next params
            {
                eta_p_121314 = zt_res_121324;
            }
            // SegRed body
            {
                double zp_res_121315 = eta_p_121313 + eta_p_121314;
                
                local_acc_126272 = zp_res_121315;
            }
        }
        
        int64_t uni_i_126278 = 0;
        
        {
            int64_t gtid_121312 = uni_i_126278;
            
            // Load accum params
            {
                eta_p_126268 = local_acc_126271;
            }
            // Load next params
            {
                eta_p_126269 = local_acc_126272;
            }
            // SegRed body
            {
                double zp_res_126270 = eta_p_126268 + eta_p_126269;
                
                local_acc_126271 = zp_res_126270;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_126266.mem)[flat_tid_121311] = local_acc_126271;
    }
    
  cleanup:
    { }
    if (event_129005 != NULL) {
        event_129005->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129004", strdup("nothing further"), event_129005, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_129001(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129000 *futhark_mc_task_129000 = (struct futhark_mc_task_129000 *) args;
    struct futhark_context *ctx = futhark_mc_task_129000->ctx;
    struct mc_event *event_129007 = mc_event_new(ctx);
    
    if (event_129007 != NULL)
        event_129007->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129000->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_129000->free_lifted_lambda_res_106391;
    struct memblock mem_112431 = {.desc ="mem_112431", .mem =futhark_mc_task_129000->free_mem_112431, .size =0, .references =NULL};
    struct memblock mem_112510 = {.desc ="mem_112510", .mem =futhark_mc_task_129000->free_mem_112510, .size =0, .references =NULL};
    int64_t gtid_121253 = futhark_mc_task_129000->free_gtid_121253;
    struct memblock mem_121272 = {.desc ="mem_121272", .mem =futhark_mc_task_129000->free_mem_121272, .size =0, .references =NULL};
    int64_t flat_tid_121295 = futhark_mc_task_129000->free_flat_tid_121295;
    int64_t flat_tid_121311 = futhark_mc_task_129000->free_flat_tid_121311;
    double defunc_0_reduce_res_121294 = *futhark_mc_task_129000->retval_defunc_0_reduce_res_121294;
    int64_t reduce_stage_1_tid_res_arr_mem_126266_cached_sizze_129002 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126266 = NULL;
    int32_t nsubtasks_126265;
    
    nsubtasks_126265 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_126266_cached_sizze_129002 < (int64_t) 8 * nsubtasks_126265) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126266, &reduce_stage_1_tid_res_arr_mem_126266_cached_sizze_129002, (int64_t) 8 * nsubtasks_126265);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_129003 futhark_mc_segred_stage_1_parloop_struct_129003_;
    
    futhark_mc_segred_stage_1_parloop_struct_129003_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_129003_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_129003_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_129003_.free_mem_112431 = mem_112431.mem;
    futhark_mc_segred_stage_1_parloop_struct_129003_.free_mem_112510 = mem_112510.mem;
    futhark_mc_segred_stage_1_parloop_struct_129003_.free_gtid_121253 = gtid_121253;
    futhark_mc_segred_stage_1_parloop_struct_129003_.free_mem_121272 = mem_121272.mem;
    futhark_mc_segred_stage_1_parloop_struct_129003_.free_reduce_stage_1_tid_res_arr_mem_126266 = reduce_stage_1_tid_res_arr_mem_126266;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_129004_task;
    
    futhark_mc_segred_stage_1_parloop_129004_task.name = "futhark_mc_segred_stage_1_parloop_129004";
    futhark_mc_segred_stage_1_parloop_129004_task.fn = futhark_mc_segred_stage_1_parloop_129004;
    futhark_mc_segred_stage_1_parloop_129004_task.args = &futhark_mc_segred_stage_1_parloop_struct_129003_;
    futhark_mc_segred_stage_1_parloop_129004_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_129004_task.info = info;
    
    struct mc_event *event_129006 = mc_event_new(ctx);
    
    if (event_129006 != NULL)
        event_129006->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_129004_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_129004_task);
    
    if (futhark_mc_segred_stage_1_parloop_129004_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_129004_err;
        goto cleanup;
    }
    if (event_129006 != NULL) {
        event_129006->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129004_total", strdup("nothing further"), event_129006, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_121294 = 0.0;
    }
    
    double eta_p_126279;
    double eta_p_126280;
    
    for (int32_t i_126282 = 0; i_126282 < nsubtasks_126265; i_126282++) {
        flat_tid_121311 = i_126282;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_126279 = defunc_0_reduce_res_121294;
            }
            // load next params
            {
                eta_p_126280 = ((double *) reduce_stage_1_tid_res_arr_mem_126266)[flat_tid_121311];
            }
            // red body
            {
                double zp_res_126281 = eta_p_126279 + eta_p_126280;
                
                defunc_0_reduce_res_121294 = zp_res_126281;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_126266);
    }
    if (event_129007 != NULL) {
        event_129007->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_129001", strdup("nothing further"), event_129007, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_129000->retval_defunc_0_reduce_res_121294 = defunc_0_reduce_res_121294;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_129010 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_mem_112431;
    unsigned char *free_mem_112510;
    int64_t free_gtid_121253;
    unsigned char *free_mem_121272;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126284;
};
struct futhark_mc_task_129012 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_mem_112431;
    unsigned char *free_mem_121272;
    int64_t free_gtid_121296;
    int64_t free_flat_tid_121302;
    double *retval_defunc_0_reduce_res_121301;
};
struct futhark_mc_segred_stage_1_parloop_struct_129015 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_mem_112431;
    unsigned char *free_mem_121272;
    int64_t free_gtid_121296;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126296;
};
static int futhark_mc_segred_stage_1_parloop_129016(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_129015 *futhark_mc_segred_stage_1_parloop_struct_129015 = (struct futhark_mc_segred_stage_1_parloop_struct_129015 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_129015->ctx;
    struct mc_event *event_129017 = mc_event_new(ctx);
    
    if (event_129017 != NULL)
        event_129017->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_129015->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_129015->free_lifted_lambda_res_106391;
    struct memblock mem_112431 = {.desc ="mem_112431", .mem =futhark_mc_segred_stage_1_parloop_struct_129015->free_mem_112431, .size =0, .references =NULL};
    struct memblock mem_121272 = {.desc ="mem_121272", .mem =futhark_mc_segred_stage_1_parloop_struct_129015->free_mem_121272, .size =0, .references =NULL};
    int64_t gtid_121296 = futhark_mc_segred_stage_1_parloop_struct_129015->free_gtid_121296;
    struct memblock reduce_stage_1_tid_res_arr_mem_126296 = {.desc ="reduce_stage_1_tid_res_arr_mem_126296", .mem =futhark_mc_segred_stage_1_parloop_struct_129015->free_reduce_stage_1_tid_res_arr_mem_126296, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121302;
    
    flat_tid_121302 = subtask_id;
    {
        double eta_p_126298;
        double eta_p_126299;
        double local_acc_126301 = 0.0;
        double eta_p_121304;
        double eta_p_121305;
        double local_acc_126302 = 0.0;
        int64_t start_126303;
        int64_t end_126304;
        
        start_126303 = start;
        end_126304 = end;
        
        int64_t n_126305 = end_126304 - start_126303;
        
        for (int64_t SegRed_i_126306 = start_126303; SegRed_i_126306 < start_126303 + n_126305; SegRed_i_126306++) {
            int64_t gtid_121303 = SegRed_i_126306;
            double eta_p_121307 = ((double *) mem_121272.mem)[gtid_121303];
            double eta_p_121308 = ((double *) mem_112431.mem)[lifted_lambda_res_106391 * (m_33388 * m_33388) + gtid_121303 * m_33388 + gtid_121296];
            double zt_res_121309 = eta_p_121307 * eta_p_121308;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_121304 = local_acc_126302;
            }
            // Load next params
            {
                eta_p_121305 = zt_res_121309;
            }
            // SegRed body
            {
                double zp_res_121306 = eta_p_121304 + eta_p_121305;
                
                local_acc_126302 = zp_res_121306;
            }
        }
        
        int64_t uni_i_126307 = 0;
        
        {
            int64_t gtid_121303 = uni_i_126307;
            
            // Load accum params
            {
                eta_p_126298 = local_acc_126301;
            }
            // Load next params
            {
                eta_p_126299 = local_acc_126302;
            }
            // SegRed body
            {
                double zp_res_126300 = eta_p_126298 + eta_p_126299;
                
                local_acc_126301 = zp_res_126300;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_126296.mem)[flat_tid_121302] = local_acc_126301;
    }
    
  cleanup:
    { }
    if (event_129017 != NULL) {
        event_129017->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129016", strdup("nothing further"), event_129017, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_129013(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129012 *futhark_mc_task_129012 = (struct futhark_mc_task_129012 *) args;
    struct futhark_context *ctx = futhark_mc_task_129012->ctx;
    struct mc_event *event_129019 = mc_event_new(ctx);
    
    if (event_129019 != NULL)
        event_129019->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129012->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_129012->free_lifted_lambda_res_106391;
    struct memblock mem_112431 = {.desc ="mem_112431", .mem =futhark_mc_task_129012->free_mem_112431, .size =0, .references =NULL};
    struct memblock mem_121272 = {.desc ="mem_121272", .mem =futhark_mc_task_129012->free_mem_121272, .size =0, .references =NULL};
    int64_t gtid_121296 = futhark_mc_task_129012->free_gtid_121296;
    int64_t flat_tid_121302 = futhark_mc_task_129012->free_flat_tid_121302;
    double defunc_0_reduce_res_121301 = *futhark_mc_task_129012->retval_defunc_0_reduce_res_121301;
    int64_t reduce_stage_1_tid_res_arr_mem_126296_cached_sizze_129014 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126296 = NULL;
    int32_t nsubtasks_126295;
    
    nsubtasks_126295 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_126296_cached_sizze_129014 < (int64_t) 8 * nsubtasks_126295) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126296, &reduce_stage_1_tid_res_arr_mem_126296_cached_sizze_129014, (int64_t) 8 * nsubtasks_126295);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_129015 futhark_mc_segred_stage_1_parloop_struct_129015_;
    
    futhark_mc_segred_stage_1_parloop_struct_129015_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_129015_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_129015_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_129015_.free_mem_112431 = mem_112431.mem;
    futhark_mc_segred_stage_1_parloop_struct_129015_.free_mem_121272 = mem_121272.mem;
    futhark_mc_segred_stage_1_parloop_struct_129015_.free_gtid_121296 = gtid_121296;
    futhark_mc_segred_stage_1_parloop_struct_129015_.free_reduce_stage_1_tid_res_arr_mem_126296 = reduce_stage_1_tid_res_arr_mem_126296;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_129016_task;
    
    futhark_mc_segred_stage_1_parloop_129016_task.name = "futhark_mc_segred_stage_1_parloop_129016";
    futhark_mc_segred_stage_1_parloop_129016_task.fn = futhark_mc_segred_stage_1_parloop_129016;
    futhark_mc_segred_stage_1_parloop_129016_task.args = &futhark_mc_segred_stage_1_parloop_struct_129015_;
    futhark_mc_segred_stage_1_parloop_129016_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_129016_task.info = info;
    
    struct mc_event *event_129018 = mc_event_new(ctx);
    
    if (event_129018 != NULL)
        event_129018->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_129016_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_129016_task);
    
    if (futhark_mc_segred_stage_1_parloop_129016_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_129016_err;
        goto cleanup;
    }
    if (event_129018 != NULL) {
        event_129018->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129016_total", strdup("nothing further"), event_129018, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_121301 = 0.0;
    }
    
    double eta_p_126308;
    double eta_p_126309;
    
    for (int32_t i_126311 = 0; i_126311 < nsubtasks_126295; i_126311++) {
        flat_tid_121302 = i_126311;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_126308 = defunc_0_reduce_res_121301;
            }
            // load next params
            {
                eta_p_126309 = ((double *) reduce_stage_1_tid_res_arr_mem_126296)[flat_tid_121302];
            }
            // red body
            {
                double zp_res_126310 = eta_p_126308 + eta_p_126309;
                
                defunc_0_reduce_res_121301 = zp_res_126310;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_126296);
    }
    if (event_129019 != NULL) {
        event_129019->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_129013", strdup("nothing further"), event_129019, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_129012->retval_defunc_0_reduce_res_121301 = defunc_0_reduce_res_121301;
    }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_129011(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_129010 *futhark_mc_segred_stage_1_parloop_struct_129010 = (struct futhark_mc_segred_stage_1_parloop_struct_129010 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_129010->ctx;
    struct mc_event *event_129020 = mc_event_new(ctx);
    
    if (event_129020 != NULL)
        event_129020->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_129010->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_129010->free_lifted_lambda_res_106391;
    struct memblock mem_112431 = {.desc ="mem_112431", .mem =futhark_mc_segred_stage_1_parloop_struct_129010->free_mem_112431, .size =0, .references =NULL};
    struct memblock mem_112510 = {.desc ="mem_112510", .mem =futhark_mc_segred_stage_1_parloop_struct_129010->free_mem_112510, .size =0, .references =NULL};
    int64_t gtid_121253 = futhark_mc_segred_stage_1_parloop_struct_129010->free_gtid_121253;
    struct memblock mem_121272 = {.desc ="mem_121272", .mem =futhark_mc_segred_stage_1_parloop_struct_129010->free_mem_121272, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126284 = {.desc ="reduce_stage_1_tid_res_arr_mem_126284", .mem =futhark_mc_segred_stage_1_parloop_struct_129010->free_reduce_stage_1_tid_res_arr_mem_126284, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121295;
    
    flat_tid_121295 = subtask_id;
    {
        double eta_p_126286;
        double eta_p_126287;
        double local_acc_126289 = 0.0;
        double eta_p_121297;
        double eta_p_121298;
        double local_acc_126290 = 0.0;
        int64_t start_126291;
        int64_t end_126292;
        
        start_126291 = start;
        end_126292 = end;
        
        int64_t n_126293 = end_126292 - start_126291;
        
        for (int64_t SegRed_i_126294 = start_126291; SegRed_i_126294 < start_126291 + n_126293; SegRed_i_126294++) {
            int64_t gtid_121296 = SegRed_i_126294;
            double eta_p_121300 = ((double *) mem_112510.mem)[gtid_121253 * m_33388 + gtid_121296];
            double defunc_0_reduce_res_121301;
            int64_t flat_tid_121302 = (int64_t) 0;
            
            defunc_0_reduce_res_121301 = 0.0;
            
            struct futhark_mc_task_129012 futhark_mc_task_129012_;
            
            futhark_mc_task_129012_.ctx = ctx;
            futhark_mc_task_129012_.free_m_33388 = m_33388;
            futhark_mc_task_129012_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
            futhark_mc_task_129012_.free_mem_112431 = mem_112431.mem;
            futhark_mc_task_129012_.free_mem_121272 = mem_121272.mem;
            futhark_mc_task_129012_.free_gtid_121296 = gtid_121296;
            futhark_mc_task_129012_.free_flat_tid_121302 = flat_tid_121302;
            futhark_mc_task_129012_.retval_defunc_0_reduce_res_121301 = (double *) &defunc_0_reduce_res_121301;
            #if ISPC
            futhark_mc_task_129012_.retval_defunc_0_reduce_res_121301 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_129012_task;
            
            futhark_mc_task_129012_task.args = &futhark_mc_task_129012_;
            futhark_mc_task_129012_task.top_level_fn = futhark_mc_segred_task_129013;
            futhark_mc_task_129012_task.name = "futhark_mc_segred_task_129013";
            futhark_mc_task_129012_task.iterations = m_33388;
            futhark_mc_task_129012_task.task_time = &ctx->program->futhark_mc_segred_task_129013_total_time;
            futhark_mc_task_129012_task.task_iter = &ctx->program->futhark_mc_segred_task_129013_total_iter;
            futhark_mc_task_129012_task.sched = STATIC;
            futhark_mc_task_129012_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_129013_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_129012_task);
            
            if (futhark_mc_segred_task_129013_err != 0) {
                err = futhark_mc_segred_task_129013_err;
                goto cleanup;
            }
            
            double zt_res_121310 = eta_p_121300 * defunc_0_reduce_res_121301;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_121297 = local_acc_126290;
            }
            // Load next params
            {
                eta_p_121298 = zt_res_121310;
            }
            // SegRed body
            {
                double zp_res_121299 = eta_p_121297 + eta_p_121298;
                
                local_acc_126290 = zp_res_121299;
            }
        }
        
        int64_t uni_i_126312 = 0;
        
        {
            int64_t gtid_121296 = uni_i_126312;
            
            // Load accum params
            {
                eta_p_126286 = local_acc_126289;
            }
            // Load next params
            {
                eta_p_126287 = local_acc_126290;
            }
            // SegRed body
            {
                double zp_res_126288 = eta_p_126286 + eta_p_126287;
                
                local_acc_126289 = zp_res_126288;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_126284.mem)[flat_tid_121295] = local_acc_126289;
    }
    
  cleanup:
    { }
    if (event_129020 != NULL) {
        event_129020->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129011", strdup("nothing further"), event_129020, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_129008(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129000 *futhark_mc_task_129000 = (struct futhark_mc_task_129000 *) args;
    struct futhark_context *ctx = futhark_mc_task_129000->ctx;
    struct mc_event *event_129022 = mc_event_new(ctx);
    
    if (event_129022 != NULL)
        event_129022->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129000->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_129000->free_lifted_lambda_res_106391;
    struct memblock mem_112431 = {.desc ="mem_112431", .mem =futhark_mc_task_129000->free_mem_112431, .size =0, .references =NULL};
    struct memblock mem_112510 = {.desc ="mem_112510", .mem =futhark_mc_task_129000->free_mem_112510, .size =0, .references =NULL};
    int64_t gtid_121253 = futhark_mc_task_129000->free_gtid_121253;
    struct memblock mem_121272 = {.desc ="mem_121272", .mem =futhark_mc_task_129000->free_mem_121272, .size =0, .references =NULL};
    int64_t flat_tid_121295 = futhark_mc_task_129000->free_flat_tid_121295;
    int64_t flat_tid_121311 = futhark_mc_task_129000->free_flat_tid_121311;
    double defunc_0_reduce_res_121294 = *futhark_mc_task_129000->retval_defunc_0_reduce_res_121294;
    int64_t reduce_stage_1_tid_res_arr_mem_126284_cached_sizze_129009 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126284 = NULL;
    int32_t nsubtasks_126283;
    
    nsubtasks_126283 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_126284_cached_sizze_129009 < (int64_t) 8 * nsubtasks_126283) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126284, &reduce_stage_1_tid_res_arr_mem_126284_cached_sizze_129009, (int64_t) 8 * nsubtasks_126283);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_129010 futhark_mc_segred_stage_1_parloop_struct_129010_;
    
    futhark_mc_segred_stage_1_parloop_struct_129010_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_129010_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_129010_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_129010_.free_mem_112431 = mem_112431.mem;
    futhark_mc_segred_stage_1_parloop_struct_129010_.free_mem_112510 = mem_112510.mem;
    futhark_mc_segred_stage_1_parloop_struct_129010_.free_gtid_121253 = gtid_121253;
    futhark_mc_segred_stage_1_parloop_struct_129010_.free_mem_121272 = mem_121272.mem;
    futhark_mc_segred_stage_1_parloop_struct_129010_.free_reduce_stage_1_tid_res_arr_mem_126284 = reduce_stage_1_tid_res_arr_mem_126284;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_129011_task;
    
    futhark_mc_segred_stage_1_parloop_129011_task.name = "futhark_mc_segred_stage_1_parloop_129011";
    futhark_mc_segred_stage_1_parloop_129011_task.fn = futhark_mc_segred_stage_1_parloop_129011;
    futhark_mc_segred_stage_1_parloop_129011_task.args = &futhark_mc_segred_stage_1_parloop_struct_129010_;
    futhark_mc_segred_stage_1_parloop_129011_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_129011_task.info = info;
    
    struct mc_event *event_129021 = mc_event_new(ctx);
    
    if (event_129021 != NULL)
        event_129021->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_129011_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_129011_task);
    
    if (futhark_mc_segred_stage_1_parloop_129011_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_129011_err;
        goto cleanup;
    }
    if (event_129021 != NULL) {
        event_129021->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129011_total", strdup("nothing further"), event_129021, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_121294 = 0.0;
    }
    
    double eta_p_126313;
    double eta_p_126314;
    
    for (int32_t i_126316 = 0; i_126316 < nsubtasks_126283; i_126316++) {
        flat_tid_121295 = i_126316;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_126313 = defunc_0_reduce_res_121294;
            }
            // load next params
            {
                eta_p_126314 = ((double *) reduce_stage_1_tid_res_arr_mem_126284)[flat_tid_121295];
            }
            // red body
            {
                double zp_res_126315 = eta_p_126313 + eta_p_126314;
                
                defunc_0_reduce_res_121294 = zp_res_126315;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_126284);
    }
    if (event_129022 != NULL) {
        event_129022->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_129008", strdup("nothing further"), event_129022, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_129000->retval_defunc_0_reduce_res_121294 = defunc_0_reduce_res_121294;
    }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_128969(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_128968 *futhark_mc_segred_stage_1_parloop_struct_128968 = (struct futhark_mc_segred_stage_1_parloop_struct_128968 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_128968->ctx;
    struct mc_event *event_129023 = mc_event_new(ctx);
    
    if (event_129023 != NULL)
        event_129023->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_128968->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_128968->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_128968->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_128968->free_A_mem_111707, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_segred_stage_1_parloop_struct_128968->free_bytes_111715;
    struct memblock mem_112431 = {.desc ="mem_112431", .mem =futhark_mc_segred_stage_1_parloop_struct_128968->free_mem_112431, .size =0, .references =NULL};
    struct memblock mem_112507 = {.desc ="mem_112507", .mem =futhark_mc_segred_stage_1_parloop_struct_128968->free_mem_112507, .size =0, .references =NULL};
    struct memblock mem_112510 = {.desc ="mem_112510", .mem =futhark_mc_segred_stage_1_parloop_struct_128968->free_mem_112510, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126184 = {.desc ="reduce_stage_1_tid_res_arr_mem_126184", .mem =futhark_mc_segred_stage_1_parloop_struct_128968->free_reduce_stage_1_tid_res_arr_mem_126184, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126186 = {.desc ="reduce_stage_1_tid_res_arr_mem_126186", .mem =futhark_mc_segred_stage_1_parloop_struct_128968->free_reduce_stage_1_tid_res_arr_mem_126186, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t mem_121272_cached_sizze_128970 = 0;
    unsigned char *mem_121272 = NULL;
    int64_t flat_tid_121252;
    
    flat_tid_121252 = subtask_id;
    {
        double eta_p_126188;
        double eta_p_126189;
        double eta_p_126191;
        double eta_p_126192;
        double local_acc_126194 = 0.0;
        double local_acc_126195 = 0.0;
        double eta_p_121254;
        double eta_p_121255;
        double eta_p_121257;
        double eta_p_121258;
        double local_acc_126196 = 0.0;
        double local_acc_126197 = 0.0;
        int64_t start_126198;
        int64_t end_126199;
        
        start_126198 = start;
        end_126199 = end;
        
        int64_t n_126200 = end_126199 - start_126198;
        
        if (mem_121272_cached_sizze_128970 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_121272, &mem_121272_cached_sizze_128970, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        for (int64_t SegRed_i_126201 = start_126198; SegRed_i_126201 < start_126198 + n_126200; SegRed_i_126201++) {
            int64_t gtid_121253 = SegRed_i_126201;
            double eta_p_121260 = ((double *) mem_112507.mem)[gtid_121253];
            double defunc_0_reduce_res_121261;
            int64_t flat_tid_121262 = (int64_t) 0;
            
            defunc_0_reduce_res_121261 = 0.0;
            
            struct futhark_mc_task_128971 futhark_mc_task_128971_;
            
            futhark_mc_task_128971_.ctx = ctx;
            futhark_mc_task_128971_.free_m_33388 = m_33388;
            futhark_mc_task_128971_.free_eta_p_106382 = eta_p_106382;
            futhark_mc_task_128971_.free_A_mem_111707 = A_mem_111707.mem;
            futhark_mc_task_128971_.free_mem_112507 = mem_112507.mem;
            futhark_mc_task_128971_.free_gtid_121253 = gtid_121253;
            futhark_mc_task_128971_.free_flat_tid_121262 = flat_tid_121262;
            futhark_mc_task_128971_.retval_defunc_0_reduce_res_121261 = (double *) &defunc_0_reduce_res_121261;
            #if ISPC
            futhark_mc_task_128971_.retval_defunc_0_reduce_res_121261 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_128971_task;
            
            futhark_mc_task_128971_task.args = &futhark_mc_task_128971_;
            futhark_mc_task_128971_task.top_level_fn = futhark_mc_segred_task_128972;
            futhark_mc_task_128971_task.name = "futhark_mc_segred_task_128972";
            futhark_mc_task_128971_task.iterations = m_33388;
            futhark_mc_task_128971_task.task_time = &ctx->program->futhark_mc_segred_task_128972_total_time;
            futhark_mc_task_128971_task.task_iter = &ctx->program->futhark_mc_segred_task_128972_total_iter;
            futhark_mc_task_128971_task.sched = STATIC;
            futhark_mc_task_128971_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_128972_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128971_task);
            
            if (futhark_mc_segred_task_128972_err != 0) {
                err = futhark_mc_segred_task_128972_err;
                goto cleanup;
            }
            
            double zt_res_121271 = eta_p_121260 * defunc_0_reduce_res_121261;
            int64_t flat_tid_121285 = (int64_t) 0;
            int64_t flat_tid_121274 = (int64_t) 0;
            struct futhark_mc_task_128979 futhark_mc_task_128979_;
            
            futhark_mc_task_128979_.ctx = ctx;
            futhark_mc_task_128979_.free_m_33388 = m_33388;
            futhark_mc_task_128979_.free_eta_p_106382 = eta_p_106382;
            futhark_mc_task_128979_.free_A_mem_111707 = A_mem_111707.mem;
            futhark_mc_task_128979_.free_mem_112510 = mem_112510.mem;
            futhark_mc_task_128979_.free_gtid_121253 = gtid_121253;
            futhark_mc_task_128979_.free_mem_121272 = mem_121272;
            
            struct scheduler_segop futhark_mc_task_128979_task;
            
            futhark_mc_task_128979_task.args = &futhark_mc_task_128979_;
            futhark_mc_task_128979_task.top_level_fn = futhark_mc_segmap_task_128980;
            futhark_mc_task_128979_task.name = "futhark_mc_segmap_task_128980";
            futhark_mc_task_128979_task.iterations = m_33388;
            futhark_mc_task_128979_task.task_time = &ctx->program->futhark_mc_segmap_task_128980_total_time;
            futhark_mc_task_128979_task.task_iter = &ctx->program->futhark_mc_segmap_task_128980_total_iter;
            futhark_mc_task_128979_task.sched = STATIC;
            futhark_mc_task_128979_task.nested_fn = futhark_mc_segmap_nested_task_128986;
            
            int futhark_mc_segmap_task_128980_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128979_task);
            
            if (futhark_mc_segmap_task_128980_err != 0) {
                err = futhark_mc_segmap_task_128980_err;
                goto cleanup;
            }
            
            double defunc_0_reduce_res_121294;
            int64_t flat_tid_121311 = (int64_t) 0;
            
            defunc_0_reduce_res_121294 = 0.0;
            
            int64_t flat_tid_121295 = (int64_t) 0;
            struct futhark_mc_task_129000 futhark_mc_task_129000_;
            
            futhark_mc_task_129000_.ctx = ctx;
            futhark_mc_task_129000_.free_m_33388 = m_33388;
            futhark_mc_task_129000_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
            futhark_mc_task_129000_.free_mem_112431 = mem_112431.mem;
            futhark_mc_task_129000_.free_mem_112510 = mem_112510.mem;
            futhark_mc_task_129000_.free_gtid_121253 = gtid_121253;
            futhark_mc_task_129000_.free_mem_121272 = mem_121272;
            futhark_mc_task_129000_.free_flat_tid_121295 = flat_tid_121295;
            futhark_mc_task_129000_.free_flat_tid_121311 = flat_tid_121311;
            futhark_mc_task_129000_.retval_defunc_0_reduce_res_121294 = (double *) &defunc_0_reduce_res_121294;
            #if ISPC
            futhark_mc_task_129000_.retval_defunc_0_reduce_res_121294 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_129000_task;
            
            futhark_mc_task_129000_task.args = &futhark_mc_task_129000_;
            futhark_mc_task_129000_task.top_level_fn = futhark_mc_segred_task_129001;
            futhark_mc_task_129000_task.name = "futhark_mc_segred_task_129001";
            futhark_mc_task_129000_task.iterations = m_33388;
            futhark_mc_task_129000_task.task_time = &ctx->program->futhark_mc_segred_task_129001_total_time;
            futhark_mc_task_129000_task.task_iter = &ctx->program->futhark_mc_segred_task_129001_total_iter;
            futhark_mc_task_129000_task.sched = STATIC;
            futhark_mc_task_129000_task.nested_fn = futhark_mc_segred_nested_task_129008;
            
            int futhark_mc_segred_task_129001_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_129000_task);
            
            if (futhark_mc_segred_task_129001_err != 0) {
                err = futhark_mc_segred_task_129001_err;
                goto cleanup;
            }
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_121254 = local_acc_126196;
            }
            // Load next params
            {
                eta_p_121255 = zt_res_121271;
            }
            // SegRed body
            {
                double zp_res_121256 = eta_p_121254 + eta_p_121255;
                
                local_acc_126196 = zp_res_121256;
            }
            // Load accum params
            {
                eta_p_121257 = local_acc_126197;
            }
            // Load next params
            {
                eta_p_121258 = defunc_0_reduce_res_121294;
            }
            // SegRed body
            {
                double zp_res_121259 = eta_p_121257 + eta_p_121258;
                
                local_acc_126197 = zp_res_121259;
            }
        }
        
        int64_t uni_i_126317 = 0;
        
        {
            int64_t gtid_121253 = uni_i_126317;
            
            // Load accum params
            {
                eta_p_126188 = local_acc_126194;
            }
            // Load next params
            {
                eta_p_126189 = local_acc_126196;
            }
            // SegRed body
            {
                double zp_res_126190 = eta_p_126188 + eta_p_126189;
                
                local_acc_126194 = zp_res_126190;
            }
            // Load accum params
            {
                eta_p_126191 = local_acc_126195;
            }
            // Load next params
            {
                eta_p_126192 = local_acc_126197;
            }
            // SegRed body
            {
                double zp_res_126193 = eta_p_126191 + eta_p_126192;
                
                local_acc_126195 = zp_res_126193;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_126184.mem)[flat_tid_121252] = local_acc_126194;
        ((double *) reduce_stage_1_tid_res_arr_mem_126186.mem)[flat_tid_121252] = local_acc_126195;
    }
    
  cleanup:
    {
        free(mem_121272);
    }
    if (event_129023 != NULL) {
        event_129023->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128969", strdup("nothing further"), event_129023, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_128965(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_128955 *futhark_mc_task_128955 = (struct futhark_mc_task_128955 *) args;
    struct futhark_context *ctx = futhark_mc_task_128955->ctx;
    struct mc_event *event_129025 = mc_event_new(ctx);
    
    if (event_129025 != NULL)
        event_129025->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_128955->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_128955->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_128955->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_128955->free_A_mem_111707, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_task_128955->free_bytes_111715;
    struct memblock mem_112431 = {.desc ="mem_112431", .mem =futhark_mc_task_128955->free_mem_112431, .size =0, .references =NULL};
    struct memblock mem_112507 = {.desc ="mem_112507", .mem =futhark_mc_task_128955->free_mem_112507, .size =0, .references =NULL};
    struct memblock mem_112510 = {.desc ="mem_112510", .mem =futhark_mc_task_128955->free_mem_112510, .size =0, .references =NULL};
    int64_t flat_tid_121252 = futhark_mc_task_128955->free_flat_tid_121252;
    int64_t flat_tid_121325 = futhark_mc_task_128955->free_flat_tid_121325;
    double defunc_0_reduce_res_121250 = *futhark_mc_task_128955->retval_defunc_0_reduce_res_121250;
    double defunc_res_121251 = *futhark_mc_task_128955->retval_defunc_res_121251;
    int64_t reduce_stage_1_tid_res_arr_mem_126184_cached_sizze_128966 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126184 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_126186_cached_sizze_128967 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126186 = NULL;
    int32_t nsubtasks_126183;
    
    nsubtasks_126183 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_126184_cached_sizze_128966 < (int64_t) 8 * nsubtasks_126183) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126184, &reduce_stage_1_tid_res_arr_mem_126184_cached_sizze_128966, (int64_t) 8 * nsubtasks_126183);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_126186_cached_sizze_128967 < (int64_t) 8 * nsubtasks_126183) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126186, &reduce_stage_1_tid_res_arr_mem_126186_cached_sizze_128967, (int64_t) 8 * nsubtasks_126183);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_128968 futhark_mc_segred_stage_1_parloop_struct_128968_;
    
    futhark_mc_segred_stage_1_parloop_struct_128968_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_128968_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_128968_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_128968_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_128968_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_128968_.free_bytes_111715 = bytes_111715;
    futhark_mc_segred_stage_1_parloop_struct_128968_.free_mem_112431 = mem_112431.mem;
    futhark_mc_segred_stage_1_parloop_struct_128968_.free_mem_112507 = mem_112507.mem;
    futhark_mc_segred_stage_1_parloop_struct_128968_.free_mem_112510 = mem_112510.mem;
    futhark_mc_segred_stage_1_parloop_struct_128968_.free_reduce_stage_1_tid_res_arr_mem_126184 = reduce_stage_1_tid_res_arr_mem_126184;
    futhark_mc_segred_stage_1_parloop_struct_128968_.free_reduce_stage_1_tid_res_arr_mem_126186 = reduce_stage_1_tid_res_arr_mem_126186;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_128969_task;
    
    futhark_mc_segred_stage_1_parloop_128969_task.name = "futhark_mc_segred_stage_1_parloop_128969";
    futhark_mc_segred_stage_1_parloop_128969_task.fn = futhark_mc_segred_stage_1_parloop_128969;
    futhark_mc_segred_stage_1_parloop_128969_task.args = &futhark_mc_segred_stage_1_parloop_struct_128968_;
    futhark_mc_segred_stage_1_parloop_128969_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_128969_task.info = info;
    
    struct mc_event *event_129024 = mc_event_new(ctx);
    
    if (event_129024 != NULL)
        event_129024->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_128969_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_128969_task);
    
    if (futhark_mc_segred_stage_1_parloop_128969_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_128969_err;
        goto cleanup;
    }
    if (event_129024 != NULL) {
        event_129024->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_128969_total", strdup("nothing further"), event_129024, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_121250 = 0.0;
        defunc_res_121251 = 0.0;
    }
    
    double eta_p_126318;
    double eta_p_126319;
    double eta_p_126321;
    double eta_p_126322;
    
    for (int32_t i_126324 = 0; i_126324 < nsubtasks_126183; i_126324++) {
        flat_tid_121252 = i_126324;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_126318 = defunc_0_reduce_res_121250;
            }
            // load next params
            {
                eta_p_126319 = ((double *) reduce_stage_1_tid_res_arr_mem_126184)[flat_tid_121252];
            }
            // red body
            {
                double zp_res_126320 = eta_p_126318 + eta_p_126319;
                
                defunc_0_reduce_res_121250 = zp_res_126320;
            }
            // load acc params
            {
                eta_p_126321 = defunc_res_121251;
            }
            // load next params
            {
                eta_p_126322 = ((double *) reduce_stage_1_tid_res_arr_mem_126186)[flat_tid_121252];
            }
            // red body
            {
                double zp_res_126323 = eta_p_126321 + eta_p_126322;
                
                defunc_res_121251 = zp_res_126323;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_126184);
        free(reduce_stage_1_tid_res_arr_mem_126186);
    }
    if (event_129025 != NULL) {
        event_129025->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_128965", strdup("nothing further"), event_129025, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_128955->retval_defunc_0_reduce_res_121250 = defunc_0_reduce_res_121250;
        *futhark_mc_task_128955->retval_defunc_res_121251 = defunc_res_121251;
    }
    return err;
}
struct futhark_mc_task_129026 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112515;
    int64_t free_flat_tid_121370;
    int64_t free_flat_tid_121387;
    double *retval_defunc_0_reduce_res_121369;
};
struct futhark_mc_segred_stage_1_parloop_struct_129029 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112515;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126326;
};
static int futhark_mc_segred_stage_1_parloop_129030(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_129029 *futhark_mc_segred_stage_1_parloop_struct_129029 = (struct futhark_mc_segred_stage_1_parloop_struct_129029 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_129029->ctx;
    struct mc_event *event_129031 = mc_event_new(ctx);
    
    if (event_129031 != NULL)
        event_129031->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_129029->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_129029->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_129029->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112515 = {.desc ="mem_112515", .mem =futhark_mc_segred_stage_1_parloop_struct_129029->free_mem_112515, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126326 = {.desc ="reduce_stage_1_tid_res_arr_mem_126326", .mem =futhark_mc_segred_stage_1_parloop_struct_129029->free_reduce_stage_1_tid_res_arr_mem_126326, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121387;
    
    flat_tid_121387 = subtask_id;
    {
        double eta_p_126328;
        double eta_p_126329;
        double local_acc_126331 = 0.0;
        double eta_p_121389;
        double eta_p_121390;
        double local_acc_126332 = 0.0;
        int64_t start_126333;
        int64_t end_126334;
        
        start_126333 = start;
        end_126334 = end;
        
        int64_t n_126335 = end_126334 - start_126333;
        
        for (int64_t SegRed_i_126336 = start_126333; SegRed_i_126336 < start_126333 + n_126335; SegRed_i_126336++) {
            int64_t gtid_121388 = SegRed_i_126336;
            double eta_p_121392 = ((double *) mem_112515.mem)[gtid_121388];
            double defunc_0_reduce_res_121393;
            double redout_121395 = 0.0;
            
            for (int64_t i_121394 = 0; i_121394 < m_33388; i_121394++) {
                double eta_p_121396 = ((double *) A_mem_111707.mem)[lifted_lambda_res_106391 * (m_33388 * m_33388) + gtid_121388 * m_33388 + i_121394];
                double eta_p_121397 = ((double *) mem_112515.mem)[i_121394];
                double zt_res_121398 = eta_p_121396 * eta_p_121396;
                double zt_res_121399 = eta_p_121397 * zt_res_121398;
                double zp_res_121400 = zt_res_121399 + redout_121395;
                double redout_tmp_126337 = zp_res_121400;
                
                redout_121395 = redout_tmp_126337;
            }
            defunc_0_reduce_res_121393 = redout_121395;
            
            double zt_res_121401 = eta_p_121392 * defunc_0_reduce_res_121393;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_121389 = local_acc_126332;
            }
            // Load next params
            {
                eta_p_121390 = zt_res_121401;
            }
            // SegRed body
            {
                double zp_res_121391 = eta_p_121389 + eta_p_121390;
                
                local_acc_126332 = zp_res_121391;
            }
        }
        
        int64_t uni_i_126338 = 0;
        
        {
            int64_t gtid_121388 = uni_i_126338;
            
            // Load accum params
            {
                eta_p_126328 = local_acc_126331;
            }
            // Load next params
            {
                eta_p_126329 = local_acc_126332;
            }
            // SegRed body
            {
                double zp_res_126330 = eta_p_126328 + eta_p_126329;
                
                local_acc_126331 = zp_res_126330;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_126326.mem)[flat_tid_121387] = local_acc_126331;
    }
    
  cleanup:
    { }
    if (event_129031 != NULL) {
        event_129031->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129030", strdup("nothing further"), event_129031, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_129027(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129026 *futhark_mc_task_129026 = (struct futhark_mc_task_129026 *) args;
    struct futhark_context *ctx = futhark_mc_task_129026->ctx;
    struct mc_event *event_129033 = mc_event_new(ctx);
    
    if (event_129033 != NULL)
        event_129033->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129026->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_129026->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_129026->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112515 = {.desc ="mem_112515", .mem =futhark_mc_task_129026->free_mem_112515, .size =0, .references =NULL};
    int64_t flat_tid_121370 = futhark_mc_task_129026->free_flat_tid_121370;
    int64_t flat_tid_121387 = futhark_mc_task_129026->free_flat_tid_121387;
    double defunc_0_reduce_res_121369 = *futhark_mc_task_129026->retval_defunc_0_reduce_res_121369;
    int64_t reduce_stage_1_tid_res_arr_mem_126326_cached_sizze_129028 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126326 = NULL;
    int32_t nsubtasks_126325;
    
    nsubtasks_126325 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_126326_cached_sizze_129028 < (int64_t) 8 * nsubtasks_126325) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126326, &reduce_stage_1_tid_res_arr_mem_126326_cached_sizze_129028, (int64_t) 8 * nsubtasks_126325);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_129029 futhark_mc_segred_stage_1_parloop_struct_129029_;
    
    futhark_mc_segred_stage_1_parloop_struct_129029_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_129029_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_129029_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_129029_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_129029_.free_mem_112515 = mem_112515.mem;
    futhark_mc_segred_stage_1_parloop_struct_129029_.free_reduce_stage_1_tid_res_arr_mem_126326 = reduce_stage_1_tid_res_arr_mem_126326;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_129030_task;
    
    futhark_mc_segred_stage_1_parloop_129030_task.name = "futhark_mc_segred_stage_1_parloop_129030";
    futhark_mc_segred_stage_1_parloop_129030_task.fn = futhark_mc_segred_stage_1_parloop_129030;
    futhark_mc_segred_stage_1_parloop_129030_task.args = &futhark_mc_segred_stage_1_parloop_struct_129029_;
    futhark_mc_segred_stage_1_parloop_129030_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_129030_task.info = info;
    
    struct mc_event *event_129032 = mc_event_new(ctx);
    
    if (event_129032 != NULL)
        event_129032->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_129030_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_129030_task);
    
    if (futhark_mc_segred_stage_1_parloop_129030_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_129030_err;
        goto cleanup;
    }
    if (event_129032 != NULL) {
        event_129032->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129030_total", strdup("nothing further"), event_129032, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_121369 = 0.0;
    }
    
    double eta_p_126339;
    double eta_p_126340;
    
    for (int32_t i_126342 = 0; i_126342 < nsubtasks_126325; i_126342++) {
        flat_tid_121387 = i_126342;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_126339 = defunc_0_reduce_res_121369;
            }
            // load next params
            {
                eta_p_126340 = ((double *) reduce_stage_1_tid_res_arr_mem_126326)[flat_tid_121387];
            }
            // red body
            {
                double zp_res_126341 = eta_p_126339 + eta_p_126340;
                
                defunc_0_reduce_res_121369 = zp_res_126341;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_126326);
    }
    if (event_129033 != NULL) {
        event_129033->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_129027", strdup("nothing further"), event_129033, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_129026->retval_defunc_0_reduce_res_121369 = defunc_0_reduce_res_121369;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_129036 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112515;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126344;
};
struct futhark_mc_task_129038 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112515;
    int64_t free_gtid_121371;
    int64_t free_flat_tid_121377;
    double *retval_defunc_0_reduce_res_121376;
};
struct futhark_mc_segred_stage_1_parloop_struct_129041 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112515;
    int64_t free_gtid_121371;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126356;
};
static int futhark_mc_segred_stage_1_parloop_129042(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_129041 *futhark_mc_segred_stage_1_parloop_struct_129041 = (struct futhark_mc_segred_stage_1_parloop_struct_129041 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_129041->ctx;
    struct mc_event *event_129043 = mc_event_new(ctx);
    
    if (event_129043 != NULL)
        event_129043->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_129041->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_129041->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_129041->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112515 = {.desc ="mem_112515", .mem =futhark_mc_segred_stage_1_parloop_struct_129041->free_mem_112515, .size =0, .references =NULL};
    int64_t gtid_121371 = futhark_mc_segred_stage_1_parloop_struct_129041->free_gtid_121371;
    struct memblock reduce_stage_1_tid_res_arr_mem_126356 = {.desc ="reduce_stage_1_tid_res_arr_mem_126356", .mem =futhark_mc_segred_stage_1_parloop_struct_129041->free_reduce_stage_1_tid_res_arr_mem_126356, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121377;
    
    flat_tid_121377 = subtask_id;
    {
        double eta_p_126358;
        double eta_p_126359;
        double local_acc_126361 = 0.0;
        double eta_p_121379;
        double eta_p_121380;
        double local_acc_126362 = 0.0;
        int64_t start_126363;
        int64_t end_126364;
        
        start_126363 = start;
        end_126364 = end;
        
        int64_t n_126365 = end_126364 - start_126363;
        
        for (int64_t SegRed_i_126366 = start_126363; SegRed_i_126366 < start_126363 + n_126365; SegRed_i_126366++) {
            int64_t gtid_121378 = SegRed_i_126366;
            double eta_p_121382 = ((double *) A_mem_111707.mem)[lifted_lambda_res_106391 * (m_33388 * m_33388) + gtid_121371 * m_33388 + gtid_121378];
            double eta_p_121383 = ((double *) mem_112515.mem)[gtid_121378];
            double zt_res_121384 = eta_p_121382 * eta_p_121382;
            double zt_res_121385 = eta_p_121383 * zt_res_121384;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_121379 = local_acc_126362;
            }
            // Load next params
            {
                eta_p_121380 = zt_res_121385;
            }
            // SegRed body
            {
                double zp_res_121381 = eta_p_121379 + eta_p_121380;
                
                local_acc_126362 = zp_res_121381;
            }
        }
        
        int64_t uni_i_126367 = 0;
        
        {
            int64_t gtid_121378 = uni_i_126367;
            
            // Load accum params
            {
                eta_p_126358 = local_acc_126361;
            }
            // Load next params
            {
                eta_p_126359 = local_acc_126362;
            }
            // SegRed body
            {
                double zp_res_126360 = eta_p_126358 + eta_p_126359;
                
                local_acc_126361 = zp_res_126360;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_126356.mem)[flat_tid_121377] = local_acc_126361;
    }
    
  cleanup:
    { }
    if (event_129043 != NULL) {
        event_129043->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129042", strdup("nothing further"), event_129043, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_129039(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129038 *futhark_mc_task_129038 = (struct futhark_mc_task_129038 *) args;
    struct futhark_context *ctx = futhark_mc_task_129038->ctx;
    struct mc_event *event_129045 = mc_event_new(ctx);
    
    if (event_129045 != NULL)
        event_129045->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129038->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_129038->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_129038->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112515 = {.desc ="mem_112515", .mem =futhark_mc_task_129038->free_mem_112515, .size =0, .references =NULL};
    int64_t gtid_121371 = futhark_mc_task_129038->free_gtid_121371;
    int64_t flat_tid_121377 = futhark_mc_task_129038->free_flat_tid_121377;
    double defunc_0_reduce_res_121376 = *futhark_mc_task_129038->retval_defunc_0_reduce_res_121376;
    int64_t reduce_stage_1_tid_res_arr_mem_126356_cached_sizze_129040 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126356 = NULL;
    int32_t nsubtasks_126355;
    
    nsubtasks_126355 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_126356_cached_sizze_129040 < (int64_t) 8 * nsubtasks_126355) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126356, &reduce_stage_1_tid_res_arr_mem_126356_cached_sizze_129040, (int64_t) 8 * nsubtasks_126355);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_129041 futhark_mc_segred_stage_1_parloop_struct_129041_;
    
    futhark_mc_segred_stage_1_parloop_struct_129041_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_129041_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_129041_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_129041_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_129041_.free_mem_112515 = mem_112515.mem;
    futhark_mc_segred_stage_1_parloop_struct_129041_.free_gtid_121371 = gtid_121371;
    futhark_mc_segred_stage_1_parloop_struct_129041_.free_reduce_stage_1_tid_res_arr_mem_126356 = reduce_stage_1_tid_res_arr_mem_126356;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_129042_task;
    
    futhark_mc_segred_stage_1_parloop_129042_task.name = "futhark_mc_segred_stage_1_parloop_129042";
    futhark_mc_segred_stage_1_parloop_129042_task.fn = futhark_mc_segred_stage_1_parloop_129042;
    futhark_mc_segred_stage_1_parloop_129042_task.args = &futhark_mc_segred_stage_1_parloop_struct_129041_;
    futhark_mc_segred_stage_1_parloop_129042_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_129042_task.info = info;
    
    struct mc_event *event_129044 = mc_event_new(ctx);
    
    if (event_129044 != NULL)
        event_129044->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_129042_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_129042_task);
    
    if (futhark_mc_segred_stage_1_parloop_129042_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_129042_err;
        goto cleanup;
    }
    if (event_129044 != NULL) {
        event_129044->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129042_total", strdup("nothing further"), event_129044, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_121376 = 0.0;
    }
    
    double eta_p_126368;
    double eta_p_126369;
    
    for (int32_t i_126371 = 0; i_126371 < nsubtasks_126355; i_126371++) {
        flat_tid_121377 = i_126371;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_126368 = defunc_0_reduce_res_121376;
            }
            // load next params
            {
                eta_p_126369 = ((double *) reduce_stage_1_tid_res_arr_mem_126356)[flat_tid_121377];
            }
            // red body
            {
                double zp_res_126370 = eta_p_126368 + eta_p_126369;
                
                defunc_0_reduce_res_121376 = zp_res_126370;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_126356);
    }
    if (event_129045 != NULL) {
        event_129045->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_129039", strdup("nothing further"), event_129045, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_129038->retval_defunc_0_reduce_res_121376 = defunc_0_reduce_res_121376;
    }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_129037(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_129036 *futhark_mc_segred_stage_1_parloop_struct_129036 = (struct futhark_mc_segred_stage_1_parloop_struct_129036 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_129036->ctx;
    struct mc_event *event_129046 = mc_event_new(ctx);
    
    if (event_129046 != NULL)
        event_129046->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_129036->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_129036->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_129036->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112515 = {.desc ="mem_112515", .mem =futhark_mc_segred_stage_1_parloop_struct_129036->free_mem_112515, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126344 = {.desc ="reduce_stage_1_tid_res_arr_mem_126344", .mem =futhark_mc_segred_stage_1_parloop_struct_129036->free_reduce_stage_1_tid_res_arr_mem_126344, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121370;
    
    flat_tid_121370 = subtask_id;
    {
        double eta_p_126346;
        double eta_p_126347;
        double local_acc_126349 = 0.0;
        double eta_p_121372;
        double eta_p_121373;
        double local_acc_126350 = 0.0;
        int64_t start_126351;
        int64_t end_126352;
        
        start_126351 = start;
        end_126352 = end;
        
        int64_t n_126353 = end_126352 - start_126351;
        
        for (int64_t SegRed_i_126354 = start_126351; SegRed_i_126354 < start_126351 + n_126353; SegRed_i_126354++) {
            int64_t gtid_121371 = SegRed_i_126354;
            double eta_p_121375 = ((double *) mem_112515.mem)[gtid_121371];
            double defunc_0_reduce_res_121376;
            int64_t flat_tid_121377 = (int64_t) 0;
            
            defunc_0_reduce_res_121376 = 0.0;
            
            struct futhark_mc_task_129038 futhark_mc_task_129038_;
            
            futhark_mc_task_129038_.ctx = ctx;
            futhark_mc_task_129038_.free_m_33388 = m_33388;
            futhark_mc_task_129038_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
            futhark_mc_task_129038_.free_A_mem_111707 = A_mem_111707.mem;
            futhark_mc_task_129038_.free_mem_112515 = mem_112515.mem;
            futhark_mc_task_129038_.free_gtid_121371 = gtid_121371;
            futhark_mc_task_129038_.free_flat_tid_121377 = flat_tid_121377;
            futhark_mc_task_129038_.retval_defunc_0_reduce_res_121376 = (double *) &defunc_0_reduce_res_121376;
            #if ISPC
            futhark_mc_task_129038_.retval_defunc_0_reduce_res_121376 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_129038_task;
            
            futhark_mc_task_129038_task.args = &futhark_mc_task_129038_;
            futhark_mc_task_129038_task.top_level_fn = futhark_mc_segred_task_129039;
            futhark_mc_task_129038_task.name = "futhark_mc_segred_task_129039";
            futhark_mc_task_129038_task.iterations = m_33388;
            futhark_mc_task_129038_task.task_time = &ctx->program->futhark_mc_segred_task_129039_total_time;
            futhark_mc_task_129038_task.task_iter = &ctx->program->futhark_mc_segred_task_129039_total_iter;
            futhark_mc_task_129038_task.sched = STATIC;
            futhark_mc_task_129038_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_129039_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_129038_task);
            
            if (futhark_mc_segred_task_129039_err != 0) {
                err = futhark_mc_segred_task_129039_err;
                goto cleanup;
            }
            
            double zt_res_121386 = eta_p_121375 * defunc_0_reduce_res_121376;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_121372 = local_acc_126350;
            }
            // Load next params
            {
                eta_p_121373 = zt_res_121386;
            }
            // SegRed body
            {
                double zp_res_121374 = eta_p_121372 + eta_p_121373;
                
                local_acc_126350 = zp_res_121374;
            }
        }
        
        int64_t uni_i_126372 = 0;
        
        {
            int64_t gtid_121371 = uni_i_126372;
            
            // Load accum params
            {
                eta_p_126346 = local_acc_126349;
            }
            // Load next params
            {
                eta_p_126347 = local_acc_126350;
            }
            // SegRed body
            {
                double zp_res_126348 = eta_p_126346 + eta_p_126347;
                
                local_acc_126349 = zp_res_126348;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_126344.mem)[flat_tid_121370] = local_acc_126349;
    }
    
  cleanup:
    { }
    if (event_129046 != NULL) {
        event_129046->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129037", strdup("nothing further"), event_129046, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_129034(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129026 *futhark_mc_task_129026 = (struct futhark_mc_task_129026 *) args;
    struct futhark_context *ctx = futhark_mc_task_129026->ctx;
    struct mc_event *event_129048 = mc_event_new(ctx);
    
    if (event_129048 != NULL)
        event_129048->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129026->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_129026->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_129026->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112515 = {.desc ="mem_112515", .mem =futhark_mc_task_129026->free_mem_112515, .size =0, .references =NULL};
    int64_t flat_tid_121370 = futhark_mc_task_129026->free_flat_tid_121370;
    int64_t flat_tid_121387 = futhark_mc_task_129026->free_flat_tid_121387;
    double defunc_0_reduce_res_121369 = *futhark_mc_task_129026->retval_defunc_0_reduce_res_121369;
    int64_t reduce_stage_1_tid_res_arr_mem_126344_cached_sizze_129035 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126344 = NULL;
    int32_t nsubtasks_126343;
    
    nsubtasks_126343 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_126344_cached_sizze_129035 < (int64_t) 8 * nsubtasks_126343) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126344, &reduce_stage_1_tid_res_arr_mem_126344_cached_sizze_129035, (int64_t) 8 * nsubtasks_126343);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_129036 futhark_mc_segred_stage_1_parloop_struct_129036_;
    
    futhark_mc_segred_stage_1_parloop_struct_129036_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_129036_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_129036_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_129036_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_129036_.free_mem_112515 = mem_112515.mem;
    futhark_mc_segred_stage_1_parloop_struct_129036_.free_reduce_stage_1_tid_res_arr_mem_126344 = reduce_stage_1_tid_res_arr_mem_126344;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_129037_task;
    
    futhark_mc_segred_stage_1_parloop_129037_task.name = "futhark_mc_segred_stage_1_parloop_129037";
    futhark_mc_segred_stage_1_parloop_129037_task.fn = futhark_mc_segred_stage_1_parloop_129037;
    futhark_mc_segred_stage_1_parloop_129037_task.args = &futhark_mc_segred_stage_1_parloop_struct_129036_;
    futhark_mc_segred_stage_1_parloop_129037_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_129037_task.info = info;
    
    struct mc_event *event_129047 = mc_event_new(ctx);
    
    if (event_129047 != NULL)
        event_129047->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_129037_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_129037_task);
    
    if (futhark_mc_segred_stage_1_parloop_129037_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_129037_err;
        goto cleanup;
    }
    if (event_129047 != NULL) {
        event_129047->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129037_total", strdup("nothing further"), event_129047, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_121369 = 0.0;
    }
    
    double eta_p_126373;
    double eta_p_126374;
    
    for (int32_t i_126376 = 0; i_126376 < nsubtasks_126343; i_126376++) {
        flat_tid_121370 = i_126376;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_126373 = defunc_0_reduce_res_121369;
            }
            // load next params
            {
                eta_p_126374 = ((double *) reduce_stage_1_tid_res_arr_mem_126344)[flat_tid_121370];
            }
            // red body
            {
                double zp_res_126375 = eta_p_126373 + eta_p_126374;
                
                defunc_0_reduce_res_121369 = zp_res_126375;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_126344);
    }
    if (event_129048 != NULL) {
        event_129048->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_129034", strdup("nothing further"), event_129048, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_129026->retval_defunc_0_reduce_res_121369 = defunc_0_reduce_res_121369;
    }
    return err;
}
struct futhark_mc_task_129049 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_param_118928;
    unsigned char *free_mem_120363;
    unsigned char *free_ext_mem_121094;
};
struct futhark_mc_segmap_parloop_struct_129051 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_param_118928;
    unsigned char *free_mem_120363;
    unsigned char *free_ext_mem_121094;
};
static int futhark_mc_segmap_parloop_129052(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_129051 *futhark_mc_segmap_parloop_struct_129051 = (struct futhark_mc_segmap_parloop_struct_129051 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_129051->ctx;
    struct mc_event *event_129053 = mc_event_new(ctx);
    
    if (event_129053 != NULL)
        event_129053->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_129051->free_m_33388;
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_segmap_parloop_struct_129051->free_mem_param_118928, .size =0, .references =NULL};
    struct memblock mem_120363 = {.desc ="mem_120363", .mem =futhark_mc_segmap_parloop_struct_129051->free_mem_120363, .size =0, .references =NULL};
    struct memblock ext_mem_121094 = {.desc ="ext_mem_121094", .mem =futhark_mc_segmap_parloop_struct_129051->free_ext_mem_121094, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121434;
    
    flat_tid_121434 = subtask_id;
    {
        int64_t start_126384;
        int64_t end_126385;
        
        start_126384 = start;
        end_126385 = end;
        
        int64_t n_126386 = end_126385 - start_126384;
        
        for (int64_t SegMap_i_126387 = start_126384; SegMap_i_126387 < start_126384 + n_126386; SegMap_i_126387++) {
            int64_t slice_126388 = m_33388;
            int64_t gtid_121435 = SegMap_i_126387;
            int64_t remnant_126389 = SegMap_i_126387 - gtid_121435;
            
            for (int64_t i_126378 = 0; i_126378 < m_33388; i_126378++) {
                double eta_p_126380 = ((double *) mem_param_118928.mem)[gtid_121435 * m_33388 + i_126378];
                double eta_p_126381 = ((double *) ext_mem_121094.mem)[gtid_121435 * m_33388 + i_126378];
                double zp_res_126382 = eta_p_126380 + eta_p_126381;
                
                ((double *) mem_120363.mem)[gtid_121435 * m_33388 + i_126378] = zp_res_126382;
            }
        }
    }
    
  cleanup:
    { }
    if (event_129053 != NULL) {
        event_129053->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_129052", strdup("nothing further"), event_129053, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_task_129050(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129049 *futhark_mc_task_129049 = (struct futhark_mc_task_129049 *) args;
    struct futhark_context *ctx = futhark_mc_task_129049->ctx;
    struct mc_event *event_129055 = mc_event_new(ctx);
    
    if (event_129055 != NULL)
        event_129055->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129049->free_m_33388;
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_task_129049->free_mem_param_118928, .size =0, .references =NULL};
    struct memblock mem_120363 = {.desc ="mem_120363", .mem =futhark_mc_task_129049->free_mem_120363, .size =0, .references =NULL};
    struct memblock ext_mem_121094 = {.desc ="ext_mem_121094", .mem =futhark_mc_task_129049->free_ext_mem_121094, .size =0, .references =NULL};
    int32_t nsubtasks_126377;
    
    nsubtasks_126377 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_129051 futhark_mc_segmap_parloop_struct_129051_;
    
    futhark_mc_segmap_parloop_struct_129051_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_129051_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_129051_.free_mem_param_118928 = mem_param_118928.mem;
    futhark_mc_segmap_parloop_struct_129051_.free_mem_120363 = mem_120363.mem;
    futhark_mc_segmap_parloop_struct_129051_.free_ext_mem_121094 = ext_mem_121094.mem;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_129052_task;
    
    futhark_mc_segmap_parloop_129052_task.name = "futhark_mc_segmap_parloop_129052";
    futhark_mc_segmap_parloop_129052_task.fn = futhark_mc_segmap_parloop_129052;
    futhark_mc_segmap_parloop_129052_task.args = &futhark_mc_segmap_parloop_struct_129051_;
    futhark_mc_segmap_parloop_129052_task.iterations = iterations;
    futhark_mc_segmap_parloop_129052_task.info = info;
    
    struct mc_event *event_129054 = mc_event_new(ctx);
    
    if (event_129054 != NULL)
        event_129054->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_129052_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_129052_task);
    
    if (futhark_mc_segmap_parloop_129052_err != 0) {
        err = futhark_mc_segmap_parloop_129052_err;
        goto cleanup;
    }
    if (event_129054 != NULL) {
        event_129054->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_129052_total", strdup("nothing further"), event_129054, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_129055 != NULL) {
        event_129055->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_task_129050", strdup("nothing further"), event_129055, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_segmap_parloop_struct_129057 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_param_118928;
    unsigned char *free_mem_120363;
    unsigned char *free_ext_mem_121094;
};
struct futhark_mc_task_129059 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_param_118928;
    unsigned char *free_mem_120363;
    unsigned char *free_ext_mem_121094;
    int64_t free_gtid_121427;
};
struct futhark_mc_segmap_parloop_struct_129061 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_mem_param_118928;
    unsigned char *free_mem_120363;
    unsigned char *free_ext_mem_121094;
    int64_t free_gtid_121427;
};
static int futhark_mc_segmap_parloop_129062(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_129061 *futhark_mc_segmap_parloop_struct_129061 = (struct futhark_mc_segmap_parloop_struct_129061 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_129061->ctx;
    struct mc_event *event_129063 = mc_event_new(ctx);
    
    if (event_129063 != NULL)
        event_129063->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_129061->free_m_33388;
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_segmap_parloop_struct_129061->free_mem_param_118928, .size =0, .references =NULL};
    struct memblock mem_120363 = {.desc ="mem_120363", .mem =futhark_mc_segmap_parloop_struct_129061->free_mem_120363, .size =0, .references =NULL};
    struct memblock ext_mem_121094 = {.desc ="ext_mem_121094", .mem =futhark_mc_segmap_parloop_struct_129061->free_ext_mem_121094, .size =0, .references =NULL};
    int64_t gtid_121427 = futhark_mc_segmap_parloop_struct_129061->free_gtid_121427;
    int64_t iterations = end - start;
    int64_t flat_tid_126392;
    
    flat_tid_126392 = subtask_id;
    {
        int64_t start_126404;
        int64_t end_126405;
        
        start_126404 = start;
        end_126405 = end;
        
        int64_t n_126406 = end_126405 - start_126404;
        
        for (int64_t SegMap_i_126407 = start_126404; SegMap_i_126407 < start_126404 + n_126406; SegMap_i_126407++) {
            int64_t slice_126408 = m_33388;
            int64_t gtid_126393 = SegMap_i_126407;
            int64_t remnant_126409 = SegMap_i_126407 - gtid_126393;
            double eta_p_126394 = ((double *) mem_param_118928.mem)[gtid_121427 * m_33388 + gtid_126393];
            double eta_p_126395 = ((double *) ext_mem_121094.mem)[gtid_121427 * m_33388 + gtid_126393];
            double zp_res_126396 = eta_p_126394 + eta_p_126395;
            
            ((double *) mem_120363.mem)[gtid_121427 * m_33388 + gtid_126393] = zp_res_126396;
        }
    }
    
  cleanup:
    { }
    if (event_129063 != NULL) {
        event_129063->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_129062", strdup("nothing further"), event_129063, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_task_129060(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129059 *futhark_mc_task_129059 = (struct futhark_mc_task_129059 *) args;
    struct futhark_context *ctx = futhark_mc_task_129059->ctx;
    struct mc_event *event_129065 = mc_event_new(ctx);
    
    if (event_129065 != NULL)
        event_129065->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129059->free_m_33388;
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_task_129059->free_mem_param_118928, .size =0, .references =NULL};
    struct memblock mem_120363 = {.desc ="mem_120363", .mem =futhark_mc_task_129059->free_mem_120363, .size =0, .references =NULL};
    struct memblock ext_mem_121094 = {.desc ="ext_mem_121094", .mem =futhark_mc_task_129059->free_ext_mem_121094, .size =0, .references =NULL};
    int64_t gtid_121427 = futhark_mc_task_129059->free_gtid_121427;
    int32_t nsubtasks_126403;
    
    nsubtasks_126403 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_129061 futhark_mc_segmap_parloop_struct_129061_;
    
    futhark_mc_segmap_parloop_struct_129061_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_129061_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_129061_.free_mem_param_118928 = mem_param_118928.mem;
    futhark_mc_segmap_parloop_struct_129061_.free_mem_120363 = mem_120363.mem;
    futhark_mc_segmap_parloop_struct_129061_.free_ext_mem_121094 = ext_mem_121094.mem;
    futhark_mc_segmap_parloop_struct_129061_.free_gtid_121427 = gtid_121427;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_129062_task;
    
    futhark_mc_segmap_parloop_129062_task.name = "futhark_mc_segmap_parloop_129062";
    futhark_mc_segmap_parloop_129062_task.fn = futhark_mc_segmap_parloop_129062;
    futhark_mc_segmap_parloop_129062_task.args = &futhark_mc_segmap_parloop_struct_129061_;
    futhark_mc_segmap_parloop_129062_task.iterations = iterations;
    futhark_mc_segmap_parloop_129062_task.info = info;
    
    struct mc_event *event_129064 = mc_event_new(ctx);
    
    if (event_129064 != NULL)
        event_129064->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_129062_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_129062_task);
    
    if (futhark_mc_segmap_parloop_129062_err != 0) {
        err = futhark_mc_segmap_parloop_129062_err;
        goto cleanup;
    }
    if (event_129064 != NULL) {
        event_129064->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_129062_total", strdup("nothing further"), event_129064, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_129065 != NULL) {
        event_129065->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_task_129060", strdup("nothing further"), event_129065, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
static int futhark_mc_segmap_parloop_129058(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_129057 *futhark_mc_segmap_parloop_struct_129057 = (struct futhark_mc_segmap_parloop_struct_129057 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_129057->ctx;
    struct mc_event *event_129066 = mc_event_new(ctx);
    
    if (event_129066 != NULL)
        event_129066->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_129057->free_m_33388;
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_segmap_parloop_struct_129057->free_mem_param_118928, .size =0, .references =NULL};
    struct memblock mem_120363 = {.desc ="mem_120363", .mem =futhark_mc_segmap_parloop_struct_129057->free_mem_120363, .size =0, .references =NULL};
    struct memblock ext_mem_121094 = {.desc ="ext_mem_121094", .mem =futhark_mc_segmap_parloop_struct_129057->free_ext_mem_121094, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121426;
    
    flat_tid_121426 = subtask_id;
    {
        int64_t start_126397;
        int64_t end_126398;
        
        start_126397 = start;
        end_126398 = end;
        
        int64_t n_126399 = end_126398 - start_126397;
        
        for (int64_t SegMap_i_126400 = start_126397; SegMap_i_126400 < start_126397 + n_126399; SegMap_i_126400++) {
            int64_t slice_126401 = m_33388;
            int64_t gtid_121427 = SegMap_i_126400;
            int64_t remnant_126402 = SegMap_i_126400 - gtid_121427;
            int64_t flat_tid_126392 = (int64_t) 0;
            struct futhark_mc_task_129059 futhark_mc_task_129059_;
            
            futhark_mc_task_129059_.ctx = ctx;
            futhark_mc_task_129059_.free_m_33388 = m_33388;
            futhark_mc_task_129059_.free_mem_param_118928 = mem_param_118928.mem;
            futhark_mc_task_129059_.free_mem_120363 = mem_120363.mem;
            futhark_mc_task_129059_.free_ext_mem_121094 = ext_mem_121094.mem;
            futhark_mc_task_129059_.free_gtid_121427 = gtid_121427;
            
            struct scheduler_segop futhark_mc_task_129059_task;
            
            futhark_mc_task_129059_task.args = &futhark_mc_task_129059_;
            futhark_mc_task_129059_task.top_level_fn = futhark_mc_segmap_task_129060;
            futhark_mc_task_129059_task.name = "futhark_mc_segmap_task_129060";
            futhark_mc_task_129059_task.iterations = m_33388;
            futhark_mc_task_129059_task.task_time = &ctx->program->futhark_mc_segmap_task_129060_total_time;
            futhark_mc_task_129059_task.task_iter = &ctx->program->futhark_mc_segmap_task_129060_total_iter;
            futhark_mc_task_129059_task.sched = STATIC;
            futhark_mc_task_129059_task.nested_fn = NULL;
            
            int futhark_mc_segmap_task_129060_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_129059_task);
            
            if (futhark_mc_segmap_task_129060_err != 0) {
                err = futhark_mc_segmap_task_129060_err;
                goto cleanup;
            }
        }
    }
    
  cleanup:
    { }
    if (event_129066 != NULL) {
        event_129066->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_129058", strdup("nothing further"), event_129066, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_nested_task_129056(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129049 *futhark_mc_task_129049 = (struct futhark_mc_task_129049 *) args;
    struct futhark_context *ctx = futhark_mc_task_129049->ctx;
    struct mc_event *event_129068 = mc_event_new(ctx);
    
    if (event_129068 != NULL)
        event_129068->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129049->free_m_33388;
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_task_129049->free_mem_param_118928, .size =0, .references =NULL};
    struct memblock mem_120363 = {.desc ="mem_120363", .mem =futhark_mc_task_129049->free_mem_120363, .size =0, .references =NULL};
    struct memblock ext_mem_121094 = {.desc ="ext_mem_121094", .mem =futhark_mc_task_129049->free_ext_mem_121094, .size =0, .references =NULL};
    int32_t nsubtasks_126391;
    
    nsubtasks_126391 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_129057 futhark_mc_segmap_parloop_struct_129057_;
    
    futhark_mc_segmap_parloop_struct_129057_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_129057_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_129057_.free_mem_param_118928 = mem_param_118928.mem;
    futhark_mc_segmap_parloop_struct_129057_.free_mem_120363 = mem_120363.mem;
    futhark_mc_segmap_parloop_struct_129057_.free_ext_mem_121094 = ext_mem_121094.mem;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_129058_task;
    
    futhark_mc_segmap_parloop_129058_task.name = "futhark_mc_segmap_parloop_129058";
    futhark_mc_segmap_parloop_129058_task.fn = futhark_mc_segmap_parloop_129058;
    futhark_mc_segmap_parloop_129058_task.args = &futhark_mc_segmap_parloop_struct_129057_;
    futhark_mc_segmap_parloop_129058_task.iterations = iterations;
    futhark_mc_segmap_parloop_129058_task.info = info;
    
    struct mc_event *event_129067 = mc_event_new(ctx);
    
    if (event_129067 != NULL)
        event_129067->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_129058_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_129058_task);
    
    if (futhark_mc_segmap_parloop_129058_err != 0) {
        err = futhark_mc_segmap_parloop_129058_err;
        goto cleanup;
    }
    if (event_129067 != NULL) {
        event_129067->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_129058_total", strdup("nothing further"), event_129067, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_129068 != NULL) {
        event_129068->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_nested_task_129056", strdup("nothing further"), event_129068, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_129069 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_zp_res_43884;
    unsigned char *free_mem_param_118928;
    unsigned char *free_ext_mem_120366;
    int64_t free_flat_tid_121447;
    int64_t free_flat_tid_121466;
    bool *retval_defunc_0_reduce_comm_res_121446;
};
struct futhark_mc_segred_stage_1_parloop_struct_129072 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_zp_res_43884;
    unsigned char *free_mem_param_118928;
    unsigned char *free_ext_mem_120366;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126414;
};
static int futhark_mc_segred_stage_1_parloop_129073(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_129072 *futhark_mc_segred_stage_1_parloop_struct_129072 = (struct futhark_mc_segred_stage_1_parloop_struct_129072 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_129072->ctx;
    struct mc_event *event_129074 = mc_event_new(ctx);
    
    if (event_129074 != NULL)
        event_129074->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_129072->free_m_33388;
    double zp_res_43884 = futhark_mc_segred_stage_1_parloop_struct_129072->free_zp_res_43884;
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_segred_stage_1_parloop_struct_129072->free_mem_param_118928, .size =0, .references =NULL};
    struct memblock ext_mem_120366 = {.desc ="ext_mem_120366", .mem =futhark_mc_segred_stage_1_parloop_struct_129072->free_ext_mem_120366, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126414 = {.desc ="reduce_stage_1_tid_res_arr_mem_126414", .mem =futhark_mc_segred_stage_1_parloop_struct_129072->free_reduce_stage_1_tid_res_arr_mem_126414, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121466;
    
    flat_tid_121466 = subtask_id;
    {
        bool eta_p_126416;
        bool eta_p_126417;
        bool local_acc_126419 = 0;
        bool eta_p_121468;
        bool eta_p_121469;
        bool local_acc_126420 = 0;
        int64_t start_126421;
        int64_t end_126422;
        
        start_126421 = start;
        end_126422 = end;
        
        int64_t n_126423 = end_126422 - start_126421;
        
        for (int64_t SegRed_i_126424 = start_126421; SegRed_i_126424 < start_126421 + n_126423; SegRed_i_126424++) {
            int64_t gtid_121467 = SegRed_i_126424;
            bool defunc_0_reduce_comm_res_121471;
            bool redout_121473 = 0;
            
            for (int64_t i_121472 = 0; i_121472 < m_33388; i_121472++) {
                double eta_p_121474 = ((double *) mem_param_118928.mem)[gtid_121467 * m_33388 + i_121472];
                double eta_p_121475 = ((double *) ext_mem_120366.mem)[gtid_121467 * m_33388 + i_121472];
                double zt_res_121476 = zp_res_43884 * eta_p_121474;
                bool zgze_res_121477 = eta_p_121475 <= zt_res_121476;
                double zt_res_121478 = zp_res_43884 * eta_p_121475;
                bool zgze_res_121479 = eta_p_121474 <= zt_res_121478;
                bool x_121480 = zgze_res_121477 && zgze_res_121479;
                bool not_res_121481 = !x_121480;
                bool defunc_0_op_res_121482 = not_res_121481 || redout_121473;
                bool redout_tmp_126425 = defunc_0_op_res_121482;
                
                redout_121473 = redout_tmp_126425;
            }
            defunc_0_reduce_comm_res_121471 = redout_121473;
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_121468 = local_acc_126420;
            }
            // Load next params
            {
                eta_p_121469 = defunc_0_reduce_comm_res_121471;
            }
            // SegRed body
            {
                bool defunc_0_op_res_121470 = eta_p_121468 || eta_p_121469;
                
                local_acc_126420 = defunc_0_op_res_121470;
            }
        }
        
        int64_t uni_i_126426 = 0;
        
        {
            int64_t gtid_121467 = uni_i_126426;
            
            // Load accum params
            {
                eta_p_126416 = local_acc_126419;
            }
            // Load next params
            {
                eta_p_126417 = local_acc_126420;
            }
            // SegRed body
            {
                bool defunc_0_op_res_126418 = eta_p_126416 || eta_p_126417;
                
                local_acc_126419 = defunc_0_op_res_126418;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_126414.mem)[flat_tid_121466] = local_acc_126419;
    }
    
  cleanup:
    { }
    if (event_129074 != NULL) {
        event_129074->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129073", strdup("nothing further"), event_129074, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_129070(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129069 *futhark_mc_task_129069 = (struct futhark_mc_task_129069 *) args;
    struct futhark_context *ctx = futhark_mc_task_129069->ctx;
    struct mc_event *event_129076 = mc_event_new(ctx);
    
    if (event_129076 != NULL)
        event_129076->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129069->free_m_33388;
    double zp_res_43884 = futhark_mc_task_129069->free_zp_res_43884;
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_task_129069->free_mem_param_118928, .size =0, .references =NULL};
    struct memblock ext_mem_120366 = {.desc ="ext_mem_120366", .mem =futhark_mc_task_129069->free_ext_mem_120366, .size =0, .references =NULL};
    int64_t flat_tid_121447 = futhark_mc_task_129069->free_flat_tid_121447;
    int64_t flat_tid_121466 = futhark_mc_task_129069->free_flat_tid_121466;
    bool defunc_0_reduce_comm_res_121446 = *futhark_mc_task_129069->retval_defunc_0_reduce_comm_res_121446;
    int64_t reduce_stage_1_tid_res_arr_mem_126414_cached_sizze_129071 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126414 = NULL;
    int32_t nsubtasks_126413;
    
    nsubtasks_126413 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_126414_cached_sizze_129071 < nsubtasks_126413) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126414, &reduce_stage_1_tid_res_arr_mem_126414_cached_sizze_129071, nsubtasks_126413);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_129072 futhark_mc_segred_stage_1_parloop_struct_129072_;
    
    futhark_mc_segred_stage_1_parloop_struct_129072_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_129072_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_129072_.free_zp_res_43884 = zp_res_43884;
    futhark_mc_segred_stage_1_parloop_struct_129072_.free_mem_param_118928 = mem_param_118928.mem;
    futhark_mc_segred_stage_1_parloop_struct_129072_.free_ext_mem_120366 = ext_mem_120366.mem;
    futhark_mc_segred_stage_1_parloop_struct_129072_.free_reduce_stage_1_tid_res_arr_mem_126414 = reduce_stage_1_tid_res_arr_mem_126414;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_129073_task;
    
    futhark_mc_segred_stage_1_parloop_129073_task.name = "futhark_mc_segred_stage_1_parloop_129073";
    futhark_mc_segred_stage_1_parloop_129073_task.fn = futhark_mc_segred_stage_1_parloop_129073;
    futhark_mc_segred_stage_1_parloop_129073_task.args = &futhark_mc_segred_stage_1_parloop_struct_129072_;
    futhark_mc_segred_stage_1_parloop_129073_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_129073_task.info = info;
    
    struct mc_event *event_129075 = mc_event_new(ctx);
    
    if (event_129075 != NULL)
        event_129075->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_129073_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_129073_task);
    
    if (futhark_mc_segred_stage_1_parloop_129073_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_129073_err;
        goto cleanup;
    }
    if (event_129075 != NULL) {
        event_129075->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129073_total", strdup("nothing further"), event_129075, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_comm_res_121446 = 0;
    }
    
    bool eta_p_126427;
    bool eta_p_126428;
    
    for (int32_t i_126430 = 0; i_126430 < nsubtasks_126413; i_126430++) {
        flat_tid_121466 = i_126430;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_126427 = defunc_0_reduce_comm_res_121446;
            }
            // load next params
            {
                eta_p_126428 = ((bool *) reduce_stage_1_tid_res_arr_mem_126414)[flat_tid_121466];
            }
            // red body
            {
                bool defunc_0_op_res_126429 = eta_p_126427 || eta_p_126428;
                
                defunc_0_reduce_comm_res_121446 = defunc_0_op_res_126429;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_126414);
    }
    if (event_129076 != NULL) {
        event_129076->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_129070", strdup("nothing further"), event_129076, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_129069->retval_defunc_0_reduce_comm_res_121446 = defunc_0_reduce_comm_res_121446;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_129079 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_zp_res_43884;
    unsigned char *free_mem_param_118928;
    unsigned char *free_ext_mem_120366;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126432;
};
struct futhark_mc_task_129081 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_zp_res_43884;
    unsigned char *free_mem_param_118928;
    unsigned char *free_ext_mem_120366;
    int64_t free_gtid_121448;
    int64_t free_flat_tid_121453;
    bool *retval_defunc_0_reduce_comm_res_121452;
};
struct futhark_mc_segred_stage_1_parloop_struct_129084 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    double free_zp_res_43884;
    unsigned char *free_mem_param_118928;
    unsigned char *free_ext_mem_120366;
    int64_t free_gtid_121448;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126444;
};
static int futhark_mc_segred_stage_1_parloop_129085(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_129084 *futhark_mc_segred_stage_1_parloop_struct_129084 = (struct futhark_mc_segred_stage_1_parloop_struct_129084 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_129084->ctx;
    struct mc_event *event_129086 = mc_event_new(ctx);
    
    if (event_129086 != NULL)
        event_129086->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_129084->free_m_33388;
    double zp_res_43884 = futhark_mc_segred_stage_1_parloop_struct_129084->free_zp_res_43884;
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_segred_stage_1_parloop_struct_129084->free_mem_param_118928, .size =0, .references =NULL};
    struct memblock ext_mem_120366 = {.desc ="ext_mem_120366", .mem =futhark_mc_segred_stage_1_parloop_struct_129084->free_ext_mem_120366, .size =0, .references =NULL};
    int64_t gtid_121448 = futhark_mc_segred_stage_1_parloop_struct_129084->free_gtid_121448;
    struct memblock reduce_stage_1_tid_res_arr_mem_126444 = {.desc ="reduce_stage_1_tid_res_arr_mem_126444", .mem =futhark_mc_segred_stage_1_parloop_struct_129084->free_reduce_stage_1_tid_res_arr_mem_126444, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121453;
    
    flat_tid_121453 = subtask_id;
    {
        bool eta_p_126446;
        bool eta_p_126447;
        bool local_acc_126449 = 0;
        bool eta_p_121455;
        bool eta_p_121456;
        bool local_acc_126450 = 0;
        int64_t start_126451;
        int64_t end_126452;
        
        start_126451 = start;
        end_126452 = end;
        
        int64_t n_126453 = end_126452 - start_126451;
        
        for (int64_t SegRed_i_126454 = start_126451; SegRed_i_126454 < start_126451 + n_126453; SegRed_i_126454++) {
            int64_t gtid_121454 = SegRed_i_126454;
            double eta_p_121458 = ((double *) mem_param_118928.mem)[gtid_121448 * m_33388 + gtid_121454];
            double eta_p_121459 = ((double *) ext_mem_120366.mem)[gtid_121448 * m_33388 + gtid_121454];
            double zt_res_121460 = zp_res_43884 * eta_p_121458;
            bool zgze_res_121461 = eta_p_121459 <= zt_res_121460;
            double zt_res_121462 = zp_res_43884 * eta_p_121459;
            bool zgze_res_121463 = eta_p_121458 <= zt_res_121462;
            bool x_121464 = zgze_res_121461 && zgze_res_121463;
            bool not_res_121465 = !x_121464;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_121455 = local_acc_126450;
            }
            // Load next params
            {
                eta_p_121456 = not_res_121465;
            }
            // SegRed body
            {
                bool defunc_0_op_res_121457 = eta_p_121455 || eta_p_121456;
                
                local_acc_126450 = defunc_0_op_res_121457;
            }
        }
        
        int64_t uni_i_126455 = 0;
        
        {
            int64_t gtid_121454 = uni_i_126455;
            
            // Load accum params
            {
                eta_p_126446 = local_acc_126449;
            }
            // Load next params
            {
                eta_p_126447 = local_acc_126450;
            }
            // SegRed body
            {
                bool defunc_0_op_res_126448 = eta_p_126446 || eta_p_126447;
                
                local_acc_126449 = defunc_0_op_res_126448;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_126444.mem)[flat_tid_121453] = local_acc_126449;
    }
    
  cleanup:
    { }
    if (event_129086 != NULL) {
        event_129086->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129085", strdup("nothing further"), event_129086, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_129082(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129081 *futhark_mc_task_129081 = (struct futhark_mc_task_129081 *) args;
    struct futhark_context *ctx = futhark_mc_task_129081->ctx;
    struct mc_event *event_129088 = mc_event_new(ctx);
    
    if (event_129088 != NULL)
        event_129088->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129081->free_m_33388;
    double zp_res_43884 = futhark_mc_task_129081->free_zp_res_43884;
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_task_129081->free_mem_param_118928, .size =0, .references =NULL};
    struct memblock ext_mem_120366 = {.desc ="ext_mem_120366", .mem =futhark_mc_task_129081->free_ext_mem_120366, .size =0, .references =NULL};
    int64_t gtid_121448 = futhark_mc_task_129081->free_gtid_121448;
    int64_t flat_tid_121453 = futhark_mc_task_129081->free_flat_tid_121453;
    bool defunc_0_reduce_comm_res_121452 = *futhark_mc_task_129081->retval_defunc_0_reduce_comm_res_121452;
    int64_t reduce_stage_1_tid_res_arr_mem_126444_cached_sizze_129083 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126444 = NULL;
    int32_t nsubtasks_126443;
    
    nsubtasks_126443 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_126444_cached_sizze_129083 < nsubtasks_126443) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126444, &reduce_stage_1_tid_res_arr_mem_126444_cached_sizze_129083, nsubtasks_126443);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_129084 futhark_mc_segred_stage_1_parloop_struct_129084_;
    
    futhark_mc_segred_stage_1_parloop_struct_129084_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_129084_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_129084_.free_zp_res_43884 = zp_res_43884;
    futhark_mc_segred_stage_1_parloop_struct_129084_.free_mem_param_118928 = mem_param_118928.mem;
    futhark_mc_segred_stage_1_parloop_struct_129084_.free_ext_mem_120366 = ext_mem_120366.mem;
    futhark_mc_segred_stage_1_parloop_struct_129084_.free_gtid_121448 = gtid_121448;
    futhark_mc_segred_stage_1_parloop_struct_129084_.free_reduce_stage_1_tid_res_arr_mem_126444 = reduce_stage_1_tid_res_arr_mem_126444;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_129085_task;
    
    futhark_mc_segred_stage_1_parloop_129085_task.name = "futhark_mc_segred_stage_1_parloop_129085";
    futhark_mc_segred_stage_1_parloop_129085_task.fn = futhark_mc_segred_stage_1_parloop_129085;
    futhark_mc_segred_stage_1_parloop_129085_task.args = &futhark_mc_segred_stage_1_parloop_struct_129084_;
    futhark_mc_segred_stage_1_parloop_129085_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_129085_task.info = info;
    
    struct mc_event *event_129087 = mc_event_new(ctx);
    
    if (event_129087 != NULL)
        event_129087->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_129085_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_129085_task);
    
    if (futhark_mc_segred_stage_1_parloop_129085_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_129085_err;
        goto cleanup;
    }
    if (event_129087 != NULL) {
        event_129087->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129085_total", strdup("nothing further"), event_129087, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_comm_res_121452 = 0;
    }
    
    bool eta_p_126456;
    bool eta_p_126457;
    
    for (int32_t i_126459 = 0; i_126459 < nsubtasks_126443; i_126459++) {
        flat_tid_121453 = i_126459;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_126456 = defunc_0_reduce_comm_res_121452;
            }
            // load next params
            {
                eta_p_126457 = ((bool *) reduce_stage_1_tid_res_arr_mem_126444)[flat_tid_121453];
            }
            // red body
            {
                bool defunc_0_op_res_126458 = eta_p_126456 || eta_p_126457;
                
                defunc_0_reduce_comm_res_121452 = defunc_0_op_res_126458;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_126444);
    }
    if (event_129088 != NULL) {
        event_129088->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_129082", strdup("nothing further"), event_129088, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_129081->retval_defunc_0_reduce_comm_res_121452 = defunc_0_reduce_comm_res_121452;
    }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_129080(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_129079 *futhark_mc_segred_stage_1_parloop_struct_129079 = (struct futhark_mc_segred_stage_1_parloop_struct_129079 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_129079->ctx;
    struct mc_event *event_129089 = mc_event_new(ctx);
    
    if (event_129089 != NULL)
        event_129089->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_129079->free_m_33388;
    double zp_res_43884 = futhark_mc_segred_stage_1_parloop_struct_129079->free_zp_res_43884;
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_segred_stage_1_parloop_struct_129079->free_mem_param_118928, .size =0, .references =NULL};
    struct memblock ext_mem_120366 = {.desc ="ext_mem_120366", .mem =futhark_mc_segred_stage_1_parloop_struct_129079->free_ext_mem_120366, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126432 = {.desc ="reduce_stage_1_tid_res_arr_mem_126432", .mem =futhark_mc_segred_stage_1_parloop_struct_129079->free_reduce_stage_1_tid_res_arr_mem_126432, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121447;
    
    flat_tid_121447 = subtask_id;
    {
        bool eta_p_126434;
        bool eta_p_126435;
        bool local_acc_126437 = 0;
        bool eta_p_121449;
        bool eta_p_121450;
        bool local_acc_126438 = 0;
        int64_t start_126439;
        int64_t end_126440;
        
        start_126439 = start;
        end_126440 = end;
        
        int64_t n_126441 = end_126440 - start_126439;
        
        for (int64_t SegRed_i_126442 = start_126439; SegRed_i_126442 < start_126439 + n_126441; SegRed_i_126442++) {
            int64_t gtid_121448 = SegRed_i_126442;
            bool defunc_0_reduce_comm_res_121452;
            int64_t flat_tid_121453 = (int64_t) 0;
            
            defunc_0_reduce_comm_res_121452 = 0;
            
            struct futhark_mc_task_129081 futhark_mc_task_129081_;
            
            futhark_mc_task_129081_.ctx = ctx;
            futhark_mc_task_129081_.free_m_33388 = m_33388;
            futhark_mc_task_129081_.free_zp_res_43884 = zp_res_43884;
            futhark_mc_task_129081_.free_mem_param_118928 = mem_param_118928.mem;
            futhark_mc_task_129081_.free_ext_mem_120366 = ext_mem_120366.mem;
            futhark_mc_task_129081_.free_gtid_121448 = gtid_121448;
            futhark_mc_task_129081_.free_flat_tid_121453 = flat_tid_121453;
            futhark_mc_task_129081_.retval_defunc_0_reduce_comm_res_121452 = (bool *) &defunc_0_reduce_comm_res_121452;
            #if ISPC
            futhark_mc_task_129081_.retval_defunc_0_reduce_comm_res_121452 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_129081_task;
            
            futhark_mc_task_129081_task.args = &futhark_mc_task_129081_;
            futhark_mc_task_129081_task.top_level_fn = futhark_mc_segred_task_129082;
            futhark_mc_task_129081_task.name = "futhark_mc_segred_task_129082";
            futhark_mc_task_129081_task.iterations = m_33388;
            futhark_mc_task_129081_task.task_time = &ctx->program->futhark_mc_segred_task_129082_total_time;
            futhark_mc_task_129081_task.task_iter = &ctx->program->futhark_mc_segred_task_129082_total_iter;
            futhark_mc_task_129081_task.sched = STATIC;
            futhark_mc_task_129081_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_129082_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_129081_task);
            
            if (futhark_mc_segred_task_129082_err != 0) {
                err = futhark_mc_segred_task_129082_err;
                goto cleanup;
            }
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_121449 = local_acc_126438;
            }
            // Load next params
            {
                eta_p_121450 = defunc_0_reduce_comm_res_121452;
            }
            // SegRed body
            {
                bool defunc_0_op_res_121451 = eta_p_121449 || eta_p_121450;
                
                local_acc_126438 = defunc_0_op_res_121451;
            }
        }
        
        int64_t uni_i_126460 = 0;
        
        {
            int64_t gtid_121448 = uni_i_126460;
            
            // Load accum params
            {
                eta_p_126434 = local_acc_126437;
            }
            // Load next params
            {
                eta_p_126435 = local_acc_126438;
            }
            // SegRed body
            {
                bool defunc_0_op_res_126436 = eta_p_126434 || eta_p_126435;
                
                local_acc_126437 = defunc_0_op_res_126436;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_126432.mem)[flat_tid_121447] = local_acc_126437;
    }
    
  cleanup:
    { }
    if (event_129089 != NULL) {
        event_129089->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129080", strdup("nothing further"), event_129089, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_129077(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129069 *futhark_mc_task_129069 = (struct futhark_mc_task_129069 *) args;
    struct futhark_context *ctx = futhark_mc_task_129069->ctx;
    struct mc_event *event_129091 = mc_event_new(ctx);
    
    if (event_129091 != NULL)
        event_129091->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129069->free_m_33388;
    double zp_res_43884 = futhark_mc_task_129069->free_zp_res_43884;
    struct memblock mem_param_118928 = {.desc ="mem_param_118928", .mem =futhark_mc_task_129069->free_mem_param_118928, .size =0, .references =NULL};
    struct memblock ext_mem_120366 = {.desc ="ext_mem_120366", .mem =futhark_mc_task_129069->free_ext_mem_120366, .size =0, .references =NULL};
    int64_t flat_tid_121447 = futhark_mc_task_129069->free_flat_tid_121447;
    int64_t flat_tid_121466 = futhark_mc_task_129069->free_flat_tid_121466;
    bool defunc_0_reduce_comm_res_121446 = *futhark_mc_task_129069->retval_defunc_0_reduce_comm_res_121446;
    int64_t reduce_stage_1_tid_res_arr_mem_126432_cached_sizze_129078 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126432 = NULL;
    int32_t nsubtasks_126431;
    
    nsubtasks_126431 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_126432_cached_sizze_129078 < nsubtasks_126431) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126432, &reduce_stage_1_tid_res_arr_mem_126432_cached_sizze_129078, nsubtasks_126431);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_129079 futhark_mc_segred_stage_1_parloop_struct_129079_;
    
    futhark_mc_segred_stage_1_parloop_struct_129079_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_129079_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_129079_.free_zp_res_43884 = zp_res_43884;
    futhark_mc_segred_stage_1_parloop_struct_129079_.free_mem_param_118928 = mem_param_118928.mem;
    futhark_mc_segred_stage_1_parloop_struct_129079_.free_ext_mem_120366 = ext_mem_120366.mem;
    futhark_mc_segred_stage_1_parloop_struct_129079_.free_reduce_stage_1_tid_res_arr_mem_126432 = reduce_stage_1_tid_res_arr_mem_126432;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_129080_task;
    
    futhark_mc_segred_stage_1_parloop_129080_task.name = "futhark_mc_segred_stage_1_parloop_129080";
    futhark_mc_segred_stage_1_parloop_129080_task.fn = futhark_mc_segred_stage_1_parloop_129080;
    futhark_mc_segred_stage_1_parloop_129080_task.args = &futhark_mc_segred_stage_1_parloop_struct_129079_;
    futhark_mc_segred_stage_1_parloop_129080_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_129080_task.info = info;
    
    struct mc_event *event_129090 = mc_event_new(ctx);
    
    if (event_129090 != NULL)
        event_129090->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_129080_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_129080_task);
    
    if (futhark_mc_segred_stage_1_parloop_129080_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_129080_err;
        goto cleanup;
    }
    if (event_129090 != NULL) {
        event_129090->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129080_total", strdup("nothing further"), event_129090, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_comm_res_121446 = 0;
    }
    
    bool eta_p_126461;
    bool eta_p_126462;
    
    for (int32_t i_126464 = 0; i_126464 < nsubtasks_126431; i_126464++) {
        flat_tid_121447 = i_126464;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_126461 = defunc_0_reduce_comm_res_121446;
            }
            // load next params
            {
                eta_p_126462 = ((bool *) reduce_stage_1_tid_res_arr_mem_126432)[flat_tid_121447];
            }
            // red body
            {
                bool defunc_0_op_res_126463 = eta_p_126461 || eta_p_126462;
                
                defunc_0_reduce_comm_res_121446 = defunc_0_op_res_126463;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_126432);
    }
    if (event_129091 != NULL) {
        event_129091->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_129077", strdup("nothing further"), event_129091, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_129069->retval_defunc_0_reduce_comm_res_121446 = defunc_0_reduce_comm_res_121446;
    }
    return err;
}
struct futhark_mc_task_129092 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_ext_mem_120366;
    int64_t free_flat_tid_121484;
    int64_t free_flat_tid_121497;
    bool *retval_defunc_0_reduce_res_121483;
};
struct futhark_mc_segred_stage_1_parloop_struct_129095 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_ext_mem_120366;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126466;
};
static int futhark_mc_segred_stage_1_parloop_129096(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_129095 *futhark_mc_segred_stage_1_parloop_struct_129095 = (struct futhark_mc_segred_stage_1_parloop_struct_129095 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_129095->ctx;
    struct mc_event *event_129097 = mc_event_new(ctx);
    
    if (event_129097 != NULL)
        event_129097->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_129095->free_m_33388;
    struct memblock ext_mem_120366 = {.desc ="ext_mem_120366", .mem =futhark_mc_segred_stage_1_parloop_struct_129095->free_ext_mem_120366, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126466 = {.desc ="reduce_stage_1_tid_res_arr_mem_126466", .mem =futhark_mc_segred_stage_1_parloop_struct_129095->free_reduce_stage_1_tid_res_arr_mem_126466, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121497;
    
    flat_tid_121497 = subtask_id;
    {
        bool eta_p_126468;
        bool eta_p_126469;
        bool local_acc_126471 = 0;
        bool eta_p_121499;
        bool eta_p_121500;
        bool local_acc_126472 = 0;
        int64_t start_126473;
        int64_t end_126474;
        
        start_126473 = start;
        end_126474 = end;
        
        int64_t n_126475 = end_126474 - start_126473;
        
        for (int64_t SegRed_i_126476 = start_126473; SegRed_i_126476 < start_126473 + n_126475; SegRed_i_126476++) {
            int64_t gtid_121498 = SegRed_i_126476;
            bool defunc_0_reduce_res_121502;
            bool redout_121504 = 0;
            
            for (int64_t i_121503 = 0; i_121503 < m_33388; i_121503++) {
                double eta_p_121505 = ((double *) ext_mem_120366.mem)[gtid_121498 * m_33388 + i_121503];
                bool zg_res_121506 = 0.0 < eta_p_121505;
                bool defunc_0_op_res_121507 = zg_res_121506 || redout_121504;
                bool redout_tmp_126477 = defunc_0_op_res_121507;
                
                redout_121504 = redout_tmp_126477;
            }
            defunc_0_reduce_res_121502 = redout_121504;
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_121499 = local_acc_126472;
            }
            // Load next params
            {
                eta_p_121500 = defunc_0_reduce_res_121502;
            }
            // SegRed body
            {
                bool defunc_0_op_res_121501 = eta_p_121499 || eta_p_121500;
                
                local_acc_126472 = defunc_0_op_res_121501;
            }
        }
        
        int64_t uni_i_126478 = 0;
        
        {
            int64_t gtid_121498 = uni_i_126478;
            
            // Load accum params
            {
                eta_p_126468 = local_acc_126471;
            }
            // Load next params
            {
                eta_p_126469 = local_acc_126472;
            }
            // SegRed body
            {
                bool defunc_0_op_res_126470 = eta_p_126468 || eta_p_126469;
                
                local_acc_126471 = defunc_0_op_res_126470;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_126466.mem)[flat_tid_121497] = local_acc_126471;
    }
    
  cleanup:
    { }
    if (event_129097 != NULL) {
        event_129097->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129096", strdup("nothing further"), event_129097, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_129093(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129092 *futhark_mc_task_129092 = (struct futhark_mc_task_129092 *) args;
    struct futhark_context *ctx = futhark_mc_task_129092->ctx;
    struct mc_event *event_129099 = mc_event_new(ctx);
    
    if (event_129099 != NULL)
        event_129099->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129092->free_m_33388;
    struct memblock ext_mem_120366 = {.desc ="ext_mem_120366", .mem =futhark_mc_task_129092->free_ext_mem_120366, .size =0, .references =NULL};
    int64_t flat_tid_121484 = futhark_mc_task_129092->free_flat_tid_121484;
    int64_t flat_tid_121497 = futhark_mc_task_129092->free_flat_tid_121497;
    bool defunc_0_reduce_res_121483 = *futhark_mc_task_129092->retval_defunc_0_reduce_res_121483;
    int64_t reduce_stage_1_tid_res_arr_mem_126466_cached_sizze_129094 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126466 = NULL;
    int32_t nsubtasks_126465;
    
    nsubtasks_126465 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_126466_cached_sizze_129094 < nsubtasks_126465) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126466, &reduce_stage_1_tid_res_arr_mem_126466_cached_sizze_129094, nsubtasks_126465);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_129095 futhark_mc_segred_stage_1_parloop_struct_129095_;
    
    futhark_mc_segred_stage_1_parloop_struct_129095_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_129095_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_129095_.free_ext_mem_120366 = ext_mem_120366.mem;
    futhark_mc_segred_stage_1_parloop_struct_129095_.free_reduce_stage_1_tid_res_arr_mem_126466 = reduce_stage_1_tid_res_arr_mem_126466;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_129096_task;
    
    futhark_mc_segred_stage_1_parloop_129096_task.name = "futhark_mc_segred_stage_1_parloop_129096";
    futhark_mc_segred_stage_1_parloop_129096_task.fn = futhark_mc_segred_stage_1_parloop_129096;
    futhark_mc_segred_stage_1_parloop_129096_task.args = &futhark_mc_segred_stage_1_parloop_struct_129095_;
    futhark_mc_segred_stage_1_parloop_129096_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_129096_task.info = info;
    
    struct mc_event *event_129098 = mc_event_new(ctx);
    
    if (event_129098 != NULL)
        event_129098->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_129096_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_129096_task);
    
    if (futhark_mc_segred_stage_1_parloop_129096_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_129096_err;
        goto cleanup;
    }
    if (event_129098 != NULL) {
        event_129098->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129096_total", strdup("nothing further"), event_129098, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_121483 = 0;
    }
    
    bool eta_p_126479;
    bool eta_p_126480;
    
    for (int32_t i_126482 = 0; i_126482 < nsubtasks_126465; i_126482++) {
        flat_tid_121497 = i_126482;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_126479 = defunc_0_reduce_res_121483;
            }
            // load next params
            {
                eta_p_126480 = ((bool *) reduce_stage_1_tid_res_arr_mem_126466)[flat_tid_121497];
            }
            // red body
            {
                bool defunc_0_op_res_126481 = eta_p_126479 || eta_p_126480;
                
                defunc_0_reduce_res_121483 = defunc_0_op_res_126481;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_126466);
    }
    if (event_129099 != NULL) {
        event_129099->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_129093", strdup("nothing further"), event_129099, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_129092->retval_defunc_0_reduce_res_121483 = defunc_0_reduce_res_121483;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_129102 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_ext_mem_120366;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126484;
};
struct futhark_mc_task_129104 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_ext_mem_120366;
    int64_t free_gtid_121485;
    int64_t free_flat_tid_121490;
    bool *retval_defunc_0_reduce_res_121489;
};
struct futhark_mc_segred_stage_1_parloop_struct_129107 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_ext_mem_120366;
    int64_t free_gtid_121485;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126496;
};
static int futhark_mc_segred_stage_1_parloop_129108(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_129107 *futhark_mc_segred_stage_1_parloop_struct_129107 = (struct futhark_mc_segred_stage_1_parloop_struct_129107 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_129107->ctx;
    struct mc_event *event_129109 = mc_event_new(ctx);
    
    if (event_129109 != NULL)
        event_129109->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_129107->free_m_33388;
    struct memblock ext_mem_120366 = {.desc ="ext_mem_120366", .mem =futhark_mc_segred_stage_1_parloop_struct_129107->free_ext_mem_120366, .size =0, .references =NULL};
    int64_t gtid_121485 = futhark_mc_segred_stage_1_parloop_struct_129107->free_gtid_121485;
    struct memblock reduce_stage_1_tid_res_arr_mem_126496 = {.desc ="reduce_stage_1_tid_res_arr_mem_126496", .mem =futhark_mc_segred_stage_1_parloop_struct_129107->free_reduce_stage_1_tid_res_arr_mem_126496, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121490;
    
    flat_tid_121490 = subtask_id;
    {
        bool eta_p_126498;
        bool eta_p_126499;
        bool local_acc_126501 = 0;
        bool eta_p_121492;
        bool eta_p_121493;
        bool local_acc_126502 = 0;
        int64_t start_126503;
        int64_t end_126504;
        
        start_126503 = start;
        end_126504 = end;
        
        int64_t n_126505 = end_126504 - start_126503;
        
        for (int64_t SegRed_i_126506 = start_126503; SegRed_i_126506 < start_126503 + n_126505; SegRed_i_126506++) {
            int64_t gtid_121491 = SegRed_i_126506;
            double eta_p_121495 = ((double *) ext_mem_120366.mem)[gtid_121485 * m_33388 + gtid_121491];
            bool zg_res_121496 = 0.0 < eta_p_121495;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_121492 = local_acc_126502;
            }
            // Load next params
            {
                eta_p_121493 = zg_res_121496;
            }
            // SegRed body
            {
                bool defunc_0_op_res_121494 = eta_p_121492 || eta_p_121493;
                
                local_acc_126502 = defunc_0_op_res_121494;
            }
        }
        
        int64_t uni_i_126507 = 0;
        
        {
            int64_t gtid_121491 = uni_i_126507;
            
            // Load accum params
            {
                eta_p_126498 = local_acc_126501;
            }
            // Load next params
            {
                eta_p_126499 = local_acc_126502;
            }
            // SegRed body
            {
                bool defunc_0_op_res_126500 = eta_p_126498 || eta_p_126499;
                
                local_acc_126501 = defunc_0_op_res_126500;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_126496.mem)[flat_tid_121490] = local_acc_126501;
    }
    
  cleanup:
    { }
    if (event_129109 != NULL) {
        event_129109->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129108", strdup("nothing further"), event_129109, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_129105(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129104 *futhark_mc_task_129104 = (struct futhark_mc_task_129104 *) args;
    struct futhark_context *ctx = futhark_mc_task_129104->ctx;
    struct mc_event *event_129111 = mc_event_new(ctx);
    
    if (event_129111 != NULL)
        event_129111->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129104->free_m_33388;
    struct memblock ext_mem_120366 = {.desc ="ext_mem_120366", .mem =futhark_mc_task_129104->free_ext_mem_120366, .size =0, .references =NULL};
    int64_t gtid_121485 = futhark_mc_task_129104->free_gtid_121485;
    int64_t flat_tid_121490 = futhark_mc_task_129104->free_flat_tid_121490;
    bool defunc_0_reduce_res_121489 = *futhark_mc_task_129104->retval_defunc_0_reduce_res_121489;
    int64_t reduce_stage_1_tid_res_arr_mem_126496_cached_sizze_129106 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126496 = NULL;
    int32_t nsubtasks_126495;
    
    nsubtasks_126495 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_126496_cached_sizze_129106 < nsubtasks_126495) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126496, &reduce_stage_1_tid_res_arr_mem_126496_cached_sizze_129106, nsubtasks_126495);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_129107 futhark_mc_segred_stage_1_parloop_struct_129107_;
    
    futhark_mc_segred_stage_1_parloop_struct_129107_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_129107_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_129107_.free_ext_mem_120366 = ext_mem_120366.mem;
    futhark_mc_segred_stage_1_parloop_struct_129107_.free_gtid_121485 = gtid_121485;
    futhark_mc_segred_stage_1_parloop_struct_129107_.free_reduce_stage_1_tid_res_arr_mem_126496 = reduce_stage_1_tid_res_arr_mem_126496;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_129108_task;
    
    futhark_mc_segred_stage_1_parloop_129108_task.name = "futhark_mc_segred_stage_1_parloop_129108";
    futhark_mc_segred_stage_1_parloop_129108_task.fn = futhark_mc_segred_stage_1_parloop_129108;
    futhark_mc_segred_stage_1_parloop_129108_task.args = &futhark_mc_segred_stage_1_parloop_struct_129107_;
    futhark_mc_segred_stage_1_parloop_129108_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_129108_task.info = info;
    
    struct mc_event *event_129110 = mc_event_new(ctx);
    
    if (event_129110 != NULL)
        event_129110->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_129108_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_129108_task);
    
    if (futhark_mc_segred_stage_1_parloop_129108_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_129108_err;
        goto cleanup;
    }
    if (event_129110 != NULL) {
        event_129110->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129108_total", strdup("nothing further"), event_129110, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_121489 = 0;
    }
    
    bool eta_p_126508;
    bool eta_p_126509;
    
    for (int32_t i_126511 = 0; i_126511 < nsubtasks_126495; i_126511++) {
        flat_tid_121490 = i_126511;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_126508 = defunc_0_reduce_res_121489;
            }
            // load next params
            {
                eta_p_126509 = ((bool *) reduce_stage_1_tid_res_arr_mem_126496)[flat_tid_121490];
            }
            // red body
            {
                bool defunc_0_op_res_126510 = eta_p_126508 || eta_p_126509;
                
                defunc_0_reduce_res_121489 = defunc_0_op_res_126510;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_126496);
    }
    if (event_129111 != NULL) {
        event_129111->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_129105", strdup("nothing further"), event_129111, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_129104->retval_defunc_0_reduce_res_121489 = defunc_0_reduce_res_121489;
    }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_129103(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_129102 *futhark_mc_segred_stage_1_parloop_struct_129102 = (struct futhark_mc_segred_stage_1_parloop_struct_129102 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_129102->ctx;
    struct mc_event *event_129112 = mc_event_new(ctx);
    
    if (event_129112 != NULL)
        event_129112->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_129102->free_m_33388;
    struct memblock ext_mem_120366 = {.desc ="ext_mem_120366", .mem =futhark_mc_segred_stage_1_parloop_struct_129102->free_ext_mem_120366, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126484 = {.desc ="reduce_stage_1_tid_res_arr_mem_126484", .mem =futhark_mc_segred_stage_1_parloop_struct_129102->free_reduce_stage_1_tid_res_arr_mem_126484, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121484;
    
    flat_tid_121484 = subtask_id;
    {
        bool eta_p_126486;
        bool eta_p_126487;
        bool local_acc_126489 = 0;
        bool eta_p_121486;
        bool eta_p_121487;
        bool local_acc_126490 = 0;
        int64_t start_126491;
        int64_t end_126492;
        
        start_126491 = start;
        end_126492 = end;
        
        int64_t n_126493 = end_126492 - start_126491;
        
        for (int64_t SegRed_i_126494 = start_126491; SegRed_i_126494 < start_126491 + n_126493; SegRed_i_126494++) {
            int64_t gtid_121485 = SegRed_i_126494;
            bool defunc_0_reduce_res_121489;
            int64_t flat_tid_121490 = (int64_t) 0;
            
            defunc_0_reduce_res_121489 = 0;
            
            struct futhark_mc_task_129104 futhark_mc_task_129104_;
            
            futhark_mc_task_129104_.ctx = ctx;
            futhark_mc_task_129104_.free_m_33388 = m_33388;
            futhark_mc_task_129104_.free_ext_mem_120366 = ext_mem_120366.mem;
            futhark_mc_task_129104_.free_gtid_121485 = gtid_121485;
            futhark_mc_task_129104_.free_flat_tid_121490 = flat_tid_121490;
            futhark_mc_task_129104_.retval_defunc_0_reduce_res_121489 = (bool *) &defunc_0_reduce_res_121489;
            #if ISPC
            futhark_mc_task_129104_.retval_defunc_0_reduce_res_121489 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_129104_task;
            
            futhark_mc_task_129104_task.args = &futhark_mc_task_129104_;
            futhark_mc_task_129104_task.top_level_fn = futhark_mc_segred_task_129105;
            futhark_mc_task_129104_task.name = "futhark_mc_segred_task_129105";
            futhark_mc_task_129104_task.iterations = m_33388;
            futhark_mc_task_129104_task.task_time = &ctx->program->futhark_mc_segred_task_129105_total_time;
            futhark_mc_task_129104_task.task_iter = &ctx->program->futhark_mc_segred_task_129105_total_iter;
            futhark_mc_task_129104_task.sched = STATIC;
            futhark_mc_task_129104_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_129105_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_129104_task);
            
            if (futhark_mc_segred_task_129105_err != 0) {
                err = futhark_mc_segred_task_129105_err;
                goto cleanup;
            }
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_121486 = local_acc_126490;
            }
            // Load next params
            {
                eta_p_121487 = defunc_0_reduce_res_121489;
            }
            // SegRed body
            {
                bool defunc_0_op_res_121488 = eta_p_121486 || eta_p_121487;
                
                local_acc_126490 = defunc_0_op_res_121488;
            }
        }
        
        int64_t uni_i_126512 = 0;
        
        {
            int64_t gtid_121485 = uni_i_126512;
            
            // Load accum params
            {
                eta_p_126486 = local_acc_126489;
            }
            // Load next params
            {
                eta_p_126487 = local_acc_126490;
            }
            // SegRed body
            {
                bool defunc_0_op_res_126488 = eta_p_126486 || eta_p_126487;
                
                local_acc_126489 = defunc_0_op_res_126488;
            }
        }
        ((bool *) reduce_stage_1_tid_res_arr_mem_126484.mem)[flat_tid_121484] = local_acc_126489;
    }
    
  cleanup:
    { }
    if (event_129112 != NULL) {
        event_129112->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129103", strdup("nothing further"), event_129112, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_129100(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129092 *futhark_mc_task_129092 = (struct futhark_mc_task_129092 *) args;
    struct futhark_context *ctx = futhark_mc_task_129092->ctx;
    struct mc_event *event_129114 = mc_event_new(ctx);
    
    if (event_129114 != NULL)
        event_129114->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129092->free_m_33388;
    struct memblock ext_mem_120366 = {.desc ="ext_mem_120366", .mem =futhark_mc_task_129092->free_ext_mem_120366, .size =0, .references =NULL};
    int64_t flat_tid_121484 = futhark_mc_task_129092->free_flat_tid_121484;
    int64_t flat_tid_121497 = futhark_mc_task_129092->free_flat_tid_121497;
    bool defunc_0_reduce_res_121483 = *futhark_mc_task_129092->retval_defunc_0_reduce_res_121483;
    int64_t reduce_stage_1_tid_res_arr_mem_126484_cached_sizze_129101 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126484 = NULL;
    int32_t nsubtasks_126483;
    
    nsubtasks_126483 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_126484_cached_sizze_129101 < nsubtasks_126483) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126484, &reduce_stage_1_tid_res_arr_mem_126484_cached_sizze_129101, nsubtasks_126483);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_129102 futhark_mc_segred_stage_1_parloop_struct_129102_;
    
    futhark_mc_segred_stage_1_parloop_struct_129102_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_129102_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_129102_.free_ext_mem_120366 = ext_mem_120366.mem;
    futhark_mc_segred_stage_1_parloop_struct_129102_.free_reduce_stage_1_tid_res_arr_mem_126484 = reduce_stage_1_tid_res_arr_mem_126484;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_129103_task;
    
    futhark_mc_segred_stage_1_parloop_129103_task.name = "futhark_mc_segred_stage_1_parloop_129103";
    futhark_mc_segred_stage_1_parloop_129103_task.fn = futhark_mc_segred_stage_1_parloop_129103;
    futhark_mc_segred_stage_1_parloop_129103_task.args = &futhark_mc_segred_stage_1_parloop_struct_129102_;
    futhark_mc_segred_stage_1_parloop_129103_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_129103_task.info = info;
    
    struct mc_event *event_129113 = mc_event_new(ctx);
    
    if (event_129113 != NULL)
        event_129113->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_129103_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_129103_task);
    
    if (futhark_mc_segred_stage_1_parloop_129103_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_129103_err;
        goto cleanup;
    }
    if (event_129113 != NULL) {
        event_129113->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129103_total", strdup("nothing further"), event_129113, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_121483 = 0;
    }
    
    bool eta_p_126513;
    bool eta_p_126514;
    
    for (int32_t i_126516 = 0; i_126516 < nsubtasks_126483; i_126516++) {
        flat_tid_121484 = i_126516;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_126513 = defunc_0_reduce_res_121483;
            }
            // load next params
            {
                eta_p_126514 = ((bool *) reduce_stage_1_tid_res_arr_mem_126484)[flat_tid_121484];
            }
            // red body
            {
                bool defunc_0_op_res_126515 = eta_p_126513 || eta_p_126514;
                
                defunc_0_reduce_res_121483 = defunc_0_op_res_126515;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_126484);
    }
    if (event_129114 != NULL) {
        event_129114->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_129100", strdup("nothing further"), event_129114, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_129092->retval_defunc_0_reduce_res_121483 = defunc_0_reduce_res_121483;
    }
    return err;
}
struct futhark_mc_task_129115 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_distrs_mem_111708;
    int64_t free_bytes_111715;
    unsigned char *free_mem_111727;
    unsigned char *free_ext_mem_112553;
    int64_t free_flat_tid_121509;
    int64_t free_flat_tid_121651;
    double *retval_defunc_res_110023;
    double *retval_defunc_res_110024;
    double *retval_defunc_res_110025;
    double *retval_defunc_res_110026;
    double *retval_defunc_res_110027;
    unsigned char *retval_mem_112567;
    unsigned char *retval_mem_112569;
    unsigned char *retval_mem_112571;
};
struct futhark_mc_segred_stage_1_parloop_struct_129122 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_distrs_mem_111708;
    int64_t free_bytes_111715;
    unsigned char *free_mem_111727;
    unsigned char *free_ext_mem_112553;
    unsigned char *free_mem_112567;
    unsigned char *free_mem_112569;
    unsigned char *free_mem_112571;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126518;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126520;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126522;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126524;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126526;
};
static int futhark_mc_segred_stage_1_parloop_129123(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_129122 *futhark_mc_segred_stage_1_parloop_struct_129122 = (struct futhark_mc_segred_stage_1_parloop_struct_129122 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_129122->ctx;
    struct mc_event *event_129125 = mc_event_new(ctx);
    
    if (event_129125 != NULL)
        event_129125->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_129122->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_129122->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_129122->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_129122->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_129122->free_distrs_mem_111708, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_segred_stage_1_parloop_struct_129122->free_bytes_111715;
    struct memblock mem_111727 = {.desc ="mem_111727", .mem =futhark_mc_segred_stage_1_parloop_struct_129122->free_mem_111727, .size =0, .references =NULL};
    struct memblock ext_mem_112553 = {.desc ="ext_mem_112553", .mem =futhark_mc_segred_stage_1_parloop_struct_129122->free_ext_mem_112553, .size =0, .references =NULL};
    struct memblock mem_112567 = {.desc ="mem_112567", .mem =futhark_mc_segred_stage_1_parloop_struct_129122->free_mem_112567, .size =0, .references =NULL};
    struct memblock mem_112569 = {.desc ="mem_112569", .mem =futhark_mc_segred_stage_1_parloop_struct_129122->free_mem_112569, .size =0, .references =NULL};
    struct memblock mem_112571 = {.desc ="mem_112571", .mem =futhark_mc_segred_stage_1_parloop_struct_129122->free_mem_112571, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126518 = {.desc ="reduce_stage_1_tid_res_arr_mem_126518", .mem =futhark_mc_segred_stage_1_parloop_struct_129122->free_reduce_stage_1_tid_res_arr_mem_126518, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126520 = {.desc ="reduce_stage_1_tid_res_arr_mem_126520", .mem =futhark_mc_segred_stage_1_parloop_struct_129122->free_reduce_stage_1_tid_res_arr_mem_126520, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126522 = {.desc ="reduce_stage_1_tid_res_arr_mem_126522", .mem =futhark_mc_segred_stage_1_parloop_struct_129122->free_reduce_stage_1_tid_res_arr_mem_126522, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126524 = {.desc ="reduce_stage_1_tid_res_arr_mem_126524", .mem =futhark_mc_segred_stage_1_parloop_struct_129122->free_reduce_stage_1_tid_res_arr_mem_126524, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126526 = {.desc ="reduce_stage_1_tid_res_arr_mem_126526", .mem =futhark_mc_segred_stage_1_parloop_struct_129122->free_reduce_stage_1_tid_res_arr_mem_126526, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t mem_121669_cached_sizze_129124 = 0;
    unsigned char *mem_121669 = NULL;
    int64_t flat_tid_121651;
    
    flat_tid_121651 = subtask_id;
    {
        double eta_p_126528;
        double eta_p_126529;
        double eta_p_126531;
        double eta_p_126532;
        double eta_p_126534;
        double eta_p_126535;
        double eta_p_126537;
        double eta_p_126538;
        double eta_p_126540;
        double eta_p_126541;
        double local_acc_126543 = 0.0;
        double local_acc_126544 = 0.0;
        double local_acc_126545 = 0.0;
        double local_acc_126546 = 0.0;
        double local_acc_126547 = 0.0;
        double eta_p_121653;
        double eta_p_121654;
        double eta_p_121656;
        double eta_p_121657;
        double eta_p_121659;
        double eta_p_121660;
        double eta_p_121662;
        double eta_p_121663;
        double eta_p_121665;
        double eta_p_121666;
        double local_acc_126548 = 0.0;
        double local_acc_126549 = 0.0;
        double local_acc_126550 = 0.0;
        double local_acc_126551 = 0.0;
        double local_acc_126552 = 0.0;
        int64_t start_126553;
        int64_t end_126554;
        
        start_126553 = start;
        end_126554 = end;
        
        int64_t n_126555 = end_126554 - start_126553;
        
        if (mem_121669_cached_sizze_129124 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_121669, &mem_121669_cached_sizze_129124, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        for (int64_t SegRed_i_126556 = start_126553; SegRed_i_126556 < start_126553 + n_126555; SegRed_i_126556++) {
            int64_t gtid_121652 = SegRed_i_126556;
            double eta_p_121668 = ((double *) distrs_mem_111708.mem)[eta_p_106382 * m_33388 + gtid_121652];
            
            for (int64_t i_121672 = 0; i_121672 < m_33388; i_121672++) {
                double defunc_0_reduce_res_121674;
                double redout_121676 = 0.0;
                
                for (int64_t i_121675 = 0; i_121675 < m_33388; i_121675++) {
                    double eta_p_121677 = ((double *) A_mem_111707.mem)[eta_p_106382 * (m_33388 * m_33388) + gtid_121652 * m_33388 + i_121675];
                    double eta_p_121678 = ((double *) ext_mem_112553.mem)[i_121675 * m_33388 + i_121672];
                    double zt_res_121679 = eta_p_121677 * eta_p_121678;
                    double zp_res_121680 = zt_res_121679 + redout_121676;
                    double redout_tmp_126558 = zp_res_121680;
                    
                    redout_121676 = redout_tmp_126558;
                }
                defunc_0_reduce_res_121674 = redout_121676;
                ((double *) mem_121669)[i_121672] = defunc_0_reduce_res_121674;
            }
            
            double defunc_res_121682;
            double defunc_0_reduce_res_121683;
            double defunc_res_121684;
            double defunc_res_121685;
            double defunc_res_121686;
            double defunc_res_121687;
            double defunc_res_121688;
            double defunc_res_121689;
            double redout_121691;
            double redout_121692;
            double redout_121693;
            double redout_121694;
            double redout_121695;
            double redout_121696;
            double redout_121697;
            double redout_121698;
            
            redout_121691 = 0.0;
            redout_121692 = 0.0;
            redout_121693 = 0.0;
            redout_121694 = 0.0;
            redout_121695 = 0.0;
            redout_121696 = 0.0;
            redout_121697 = 0.0;
            redout_121698 = 0.0;
            for (int64_t i_121690 = 0; i_121690 < m_33388; i_121690++) {
                double x_121699 = ((double *) ext_mem_112553.mem)[gtid_121652 * m_33388 + i_121690];
                double eta_p_121700 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + i_121690];
                double defunc_0_reduce_res_121701;
                double redout_121703 = 0.0;
                
                for (int64_t i_121702 = 0; i_121702 < m_33388; i_121702++) {
                    double eta_p_121704 = ((double *) mem_121669)[i_121702];
                    double eta_p_121705 = ((double *) mem_111727.mem)[lifted_lambda_res_106391 * (m_33388 * m_33388) + i_121702 * m_33388 + i_121690];
                    double zt_res_121706 = eta_p_121704 * eta_p_121705;
                    double zp_res_121707 = zt_res_121706 + redout_121703;
                    double redout_tmp_126567 = zp_res_121707;
                    
                    redout_121703 = redout_tmp_126567;
                }
                defunc_0_reduce_res_121701 = redout_121703;
                
                double zt_res_121708 = x_121699 * defunc_0_reduce_res_121701;
                double zt_res_121709 = eta_p_121668 * eta_p_121700;
                bool zeze_res_121710 = x_121699 == 0.0;
                double klu_res_121711;
                
                if (zeze_res_121710) {
                    klu_res_121711 = 0.0;
                } else {
                    double zs_res_121712 = x_121699 / zt_res_121709;
                    double log_res_121713 = futrts_log64(zs_res_121712);
                    double zt_res_121714 = x_121699 * log_res_121713;
                    
                    klu_res_121711 = zt_res_121714;
                }
                
                double klu_res_121715;
                
                if (zeze_res_121710) {
                    klu_res_121715 = 0.0;
                } else {
                    double zs_res_121716 = x_121699 / zt_res_121709;
                    double log_res_121717 = futrts_log64(zs_res_121716);
                    double zt_res_121718 = x_121699 * log_res_121717;
                    
                    klu_res_121715 = zt_res_121718;
                }
                
                double zp_res_121719 = x_121699 + redout_121691;
                double zp_res_121720 = zt_res_121708 + redout_121692;
                double zp_res_121721 = x_121699 + redout_121693;
                double zp_res_121722 = x_121699 + redout_121694;
                double zp_res_121723 = x_121699 + redout_121695;
                double zp_res_121724 = klu_res_121711 + redout_121696;
                double zp_res_121725 = klu_res_121715 + redout_121697;
                double zp_res_121726 = x_121699 + redout_121698;
                double redout_tmp_126559 = zp_res_121719;
                double redout_tmp_126560 = zp_res_121720;
                double redout_tmp_126561 = zp_res_121721;
                double redout_tmp_126562 = zp_res_121722;
                double redout_tmp_126563 = zp_res_121723;
                double redout_tmp_126564 = zp_res_121724;
                double redout_tmp_126565 = zp_res_121725;
                double redout_tmp_126566 = zp_res_121726;
                
                redout_121691 = redout_tmp_126559;
                redout_121692 = redout_tmp_126560;
                redout_121693 = redout_tmp_126561;
                redout_121694 = redout_tmp_126562;
                redout_121695 = redout_tmp_126563;
                redout_121696 = redout_tmp_126564;
                redout_121697 = redout_tmp_126565;
                redout_121698 = redout_tmp_126566;
            }
            defunc_res_121682 = redout_121691;
            defunc_0_reduce_res_121683 = redout_121692;
            defunc_res_121684 = redout_121693;
            defunc_res_121685 = redout_121694;
            defunc_res_121686 = redout_121695;
            defunc_res_121687 = redout_121696;
            defunc_res_121688 = redout_121697;
            defunc_res_121689 = redout_121698;
            // save map-out results
            {
                ((double *) mem_112567.mem)[gtid_121652] = defunc_res_121689;
                ((double *) mem_112569.mem)[gtid_121652] = defunc_res_121684;
                ((double *) mem_112571.mem)[gtid_121652] = defunc_res_121682;
            }
            // Load accum params
            {
                eta_p_121653 = local_acc_126548;
            }
            // Load next params
            {
                eta_p_121654 = defunc_0_reduce_res_121683;
            }
            // SegRed body
            {
                double zp_res_121655 = eta_p_121653 + eta_p_121654;
                
                local_acc_126548 = zp_res_121655;
            }
            // Load accum params
            {
                eta_p_121656 = local_acc_126549;
            }
            // Load next params
            {
                eta_p_121657 = defunc_res_121685;
            }
            // SegRed body
            {
                double zp_res_121658 = eta_p_121656 + eta_p_121657;
                
                local_acc_126549 = zp_res_121658;
            }
            // Load accum params
            {
                eta_p_121659 = local_acc_126550;
            }
            // Load next params
            {
                eta_p_121660 = defunc_res_121686;
            }
            // SegRed body
            {
                double zp_res_121661 = eta_p_121659 + eta_p_121660;
                
                local_acc_126550 = zp_res_121661;
            }
            // Load accum params
            {
                eta_p_121662 = local_acc_126551;
            }
            // Load next params
            {
                eta_p_121663 = defunc_res_121687;
            }
            // SegRed body
            {
                double zp_res_121664 = eta_p_121662 + eta_p_121663;
                
                local_acc_126551 = zp_res_121664;
            }
            // Load accum params
            {
                eta_p_121665 = local_acc_126552;
            }
            // Load next params
            {
                eta_p_121666 = defunc_res_121688;
            }
            // SegRed body
            {
                double zp_res_121667 = eta_p_121665 + eta_p_121666;
                
                local_acc_126552 = zp_res_121667;
            }
        }
        
        int64_t uni_i_126568 = 0;
        
        {
            int64_t gtid_121652 = uni_i_126568;
            
            // Load accum params
            {
                eta_p_126528 = local_acc_126543;
            }
            // Load next params
            {
                eta_p_126529 = local_acc_126548;
            }
            // SegRed body
            {
                double zp_res_126530 = eta_p_126528 + eta_p_126529;
                
                local_acc_126543 = zp_res_126530;
            }
            // Load accum params
            {
                eta_p_126531 = local_acc_126544;
            }
            // Load next params
            {
                eta_p_126532 = local_acc_126549;
            }
            // SegRed body
            {
                double zp_res_126533 = eta_p_126531 + eta_p_126532;
                
                local_acc_126544 = zp_res_126533;
            }
            // Load accum params
            {
                eta_p_126534 = local_acc_126545;
            }
            // Load next params
            {
                eta_p_126535 = local_acc_126550;
            }
            // SegRed body
            {
                double zp_res_126536 = eta_p_126534 + eta_p_126535;
                
                local_acc_126545 = zp_res_126536;
            }
            // Load accum params
            {
                eta_p_126537 = local_acc_126546;
            }
            // Load next params
            {
                eta_p_126538 = local_acc_126551;
            }
            // SegRed body
            {
                double zp_res_126539 = eta_p_126537 + eta_p_126538;
                
                local_acc_126546 = zp_res_126539;
            }
            // Load accum params
            {
                eta_p_126540 = local_acc_126547;
            }
            // Load next params
            {
                eta_p_126541 = local_acc_126552;
            }
            // SegRed body
            {
                double zp_res_126542 = eta_p_126540 + eta_p_126541;
                
                local_acc_126547 = zp_res_126542;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_126518.mem)[flat_tid_121651] = local_acc_126543;
        ((double *) reduce_stage_1_tid_res_arr_mem_126520.mem)[flat_tid_121651] = local_acc_126544;
        ((double *) reduce_stage_1_tid_res_arr_mem_126522.mem)[flat_tid_121651] = local_acc_126545;
        ((double *) reduce_stage_1_tid_res_arr_mem_126524.mem)[flat_tid_121651] = local_acc_126546;
        ((double *) reduce_stage_1_tid_res_arr_mem_126526.mem)[flat_tid_121651] = local_acc_126547;
    }
    
  cleanup:
    {
        free(mem_121669);
    }
    if (event_129125 != NULL) {
        event_129125->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129123", strdup("nothing further"), event_129125, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_129116(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129115 *futhark_mc_task_129115 = (struct futhark_mc_task_129115 *) args;
    struct futhark_context *ctx = futhark_mc_task_129115->ctx;
    struct mc_event *event_129127 = mc_event_new(ctx);
    
    if (event_129127 != NULL)
        event_129127->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129115->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_129115->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_129115->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_129115->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_129115->free_distrs_mem_111708, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_task_129115->free_bytes_111715;
    struct memblock mem_111727 = {.desc ="mem_111727", .mem =futhark_mc_task_129115->free_mem_111727, .size =0, .references =NULL};
    struct memblock ext_mem_112553 = {.desc ="ext_mem_112553", .mem =futhark_mc_task_129115->free_ext_mem_112553, .size =0, .references =NULL};
    int64_t flat_tid_121509 = futhark_mc_task_129115->free_flat_tid_121509;
    int64_t flat_tid_121651 = futhark_mc_task_129115->free_flat_tid_121651;
    double defunc_res_110023 = *futhark_mc_task_129115->retval_defunc_res_110023;
    double defunc_res_110024 = *futhark_mc_task_129115->retval_defunc_res_110024;
    double defunc_res_110025 = *futhark_mc_task_129115->retval_defunc_res_110025;
    double defunc_res_110026 = *futhark_mc_task_129115->retval_defunc_res_110026;
    double defunc_res_110027 = *futhark_mc_task_129115->retval_defunc_res_110027;
    struct memblock mem_112567 = {.desc ="mem_112567", .mem =futhark_mc_task_129115->retval_mem_112567, .size =0, .references =NULL};
    struct memblock mem_112569 = {.desc ="mem_112569", .mem =futhark_mc_task_129115->retval_mem_112569, .size =0, .references =NULL};
    struct memblock mem_112571 = {.desc ="mem_112571", .mem =futhark_mc_task_129115->retval_mem_112571, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_126518_cached_sizze_129117 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126518 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_126520_cached_sizze_129118 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126520 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_126522_cached_sizze_129119 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126522 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_126524_cached_sizze_129120 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126524 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_126526_cached_sizze_129121 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126526 = NULL;
    int32_t nsubtasks_126517;
    
    nsubtasks_126517 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_126518_cached_sizze_129117 < (int64_t) 8 * nsubtasks_126517) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126518, &reduce_stage_1_tid_res_arr_mem_126518_cached_sizze_129117, (int64_t) 8 * nsubtasks_126517);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_126520_cached_sizze_129118 < (int64_t) 8 * nsubtasks_126517) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126520, &reduce_stage_1_tid_res_arr_mem_126520_cached_sizze_129118, (int64_t) 8 * nsubtasks_126517);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_126522_cached_sizze_129119 < (int64_t) 8 * nsubtasks_126517) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126522, &reduce_stage_1_tid_res_arr_mem_126522_cached_sizze_129119, (int64_t) 8 * nsubtasks_126517);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_126524_cached_sizze_129120 < (int64_t) 8 * nsubtasks_126517) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126524, &reduce_stage_1_tid_res_arr_mem_126524_cached_sizze_129120, (int64_t) 8 * nsubtasks_126517);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_126526_cached_sizze_129121 < (int64_t) 8 * nsubtasks_126517) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126526, &reduce_stage_1_tid_res_arr_mem_126526_cached_sizze_129121, (int64_t) 8 * nsubtasks_126517);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_129122 futhark_mc_segred_stage_1_parloop_struct_129122_;
    
    futhark_mc_segred_stage_1_parloop_struct_129122_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_129122_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_129122_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_129122_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_129122_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_129122_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_129122_.free_bytes_111715 = bytes_111715;
    futhark_mc_segred_stage_1_parloop_struct_129122_.free_mem_111727 = mem_111727.mem;
    futhark_mc_segred_stage_1_parloop_struct_129122_.free_ext_mem_112553 = ext_mem_112553.mem;
    futhark_mc_segred_stage_1_parloop_struct_129122_.free_mem_112567 = mem_112567.mem;
    futhark_mc_segred_stage_1_parloop_struct_129122_.free_mem_112569 = mem_112569.mem;
    futhark_mc_segred_stage_1_parloop_struct_129122_.free_mem_112571 = mem_112571.mem;
    futhark_mc_segred_stage_1_parloop_struct_129122_.free_reduce_stage_1_tid_res_arr_mem_126518 = reduce_stage_1_tid_res_arr_mem_126518;
    futhark_mc_segred_stage_1_parloop_struct_129122_.free_reduce_stage_1_tid_res_arr_mem_126520 = reduce_stage_1_tid_res_arr_mem_126520;
    futhark_mc_segred_stage_1_parloop_struct_129122_.free_reduce_stage_1_tid_res_arr_mem_126522 = reduce_stage_1_tid_res_arr_mem_126522;
    futhark_mc_segred_stage_1_parloop_struct_129122_.free_reduce_stage_1_tid_res_arr_mem_126524 = reduce_stage_1_tid_res_arr_mem_126524;
    futhark_mc_segred_stage_1_parloop_struct_129122_.free_reduce_stage_1_tid_res_arr_mem_126526 = reduce_stage_1_tid_res_arr_mem_126526;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_129123_task;
    
    futhark_mc_segred_stage_1_parloop_129123_task.name = "futhark_mc_segred_stage_1_parloop_129123";
    futhark_mc_segred_stage_1_parloop_129123_task.fn = futhark_mc_segred_stage_1_parloop_129123;
    futhark_mc_segred_stage_1_parloop_129123_task.args = &futhark_mc_segred_stage_1_parloop_struct_129122_;
    futhark_mc_segred_stage_1_parloop_129123_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_129123_task.info = info;
    
    struct mc_event *event_129126 = mc_event_new(ctx);
    
    if (event_129126 != NULL)
        event_129126->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_129123_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_129123_task);
    
    if (futhark_mc_segred_stage_1_parloop_129123_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_129123_err;
        goto cleanup;
    }
    if (event_129126 != NULL) {
        event_129126->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129123_total", strdup("nothing further"), event_129126, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_110023 = 0.0;
        defunc_res_110024 = 0.0;
        defunc_res_110025 = 0.0;
        defunc_res_110026 = 0.0;
        defunc_res_110027 = 0.0;
    }
    
    double eta_p_126569;
    double eta_p_126570;
    double eta_p_126572;
    double eta_p_126573;
    double eta_p_126575;
    double eta_p_126576;
    double eta_p_126578;
    double eta_p_126579;
    double eta_p_126581;
    double eta_p_126582;
    
    for (int32_t i_126584 = 0; i_126584 < nsubtasks_126517; i_126584++) {
        flat_tid_121651 = i_126584;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_126569 = defunc_res_110023;
            }
            // load next params
            {
                eta_p_126570 = ((double *) reduce_stage_1_tid_res_arr_mem_126518)[flat_tid_121651];
            }
            // red body
            {
                double zp_res_126571 = eta_p_126569 + eta_p_126570;
                
                defunc_res_110023 = zp_res_126571;
            }
            // load acc params
            {
                eta_p_126572 = defunc_res_110024;
            }
            // load next params
            {
                eta_p_126573 = ((double *) reduce_stage_1_tid_res_arr_mem_126520)[flat_tid_121651];
            }
            // red body
            {
                double zp_res_126574 = eta_p_126572 + eta_p_126573;
                
                defunc_res_110024 = zp_res_126574;
            }
            // load acc params
            {
                eta_p_126575 = defunc_res_110025;
            }
            // load next params
            {
                eta_p_126576 = ((double *) reduce_stage_1_tid_res_arr_mem_126522)[flat_tid_121651];
            }
            // red body
            {
                double zp_res_126577 = eta_p_126575 + eta_p_126576;
                
                defunc_res_110025 = zp_res_126577;
            }
            // load acc params
            {
                eta_p_126578 = defunc_res_110026;
            }
            // load next params
            {
                eta_p_126579 = ((double *) reduce_stage_1_tid_res_arr_mem_126524)[flat_tid_121651];
            }
            // red body
            {
                double zp_res_126580 = eta_p_126578 + eta_p_126579;
                
                defunc_res_110026 = zp_res_126580;
            }
            // load acc params
            {
                eta_p_126581 = defunc_res_110027;
            }
            // load next params
            {
                eta_p_126582 = ((double *) reduce_stage_1_tid_res_arr_mem_126526)[flat_tid_121651];
            }
            // red body
            {
                double zp_res_126583 = eta_p_126581 + eta_p_126582;
                
                defunc_res_110027 = zp_res_126583;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_126518);
        free(reduce_stage_1_tid_res_arr_mem_126520);
        free(reduce_stage_1_tid_res_arr_mem_126522);
        free(reduce_stage_1_tid_res_arr_mem_126524);
        free(reduce_stage_1_tid_res_arr_mem_126526);
    }
    if (event_129127 != NULL) {
        event_129127->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_129116", strdup("nothing further"), event_129127, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_129115->retval_defunc_res_110023 = defunc_res_110023;
        *futhark_mc_task_129115->retval_defunc_res_110024 = defunc_res_110024;
        *futhark_mc_task_129115->retval_defunc_res_110025 = defunc_res_110025;
        *futhark_mc_task_129115->retval_defunc_res_110026 = defunc_res_110026;
        *futhark_mc_task_129115->retval_defunc_res_110027 = defunc_res_110027;
        futhark_mc_task_129115->retval_mem_112567 = mem_112567.mem;
        futhark_mc_task_129115->retval_mem_112569 = mem_112569.mem;
        futhark_mc_task_129115->retval_mem_112571 = mem_112571.mem;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_129134 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_distrs_mem_111708;
    int64_t free_bytes_111715;
    unsigned char *free_mem_111727;
    unsigned char *free_ext_mem_112553;
    unsigned char *free_mem_112567;
    unsigned char *free_mem_112569;
    unsigned char *free_mem_112571;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126586;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126588;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126590;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126592;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126594;
};
struct futhark_mc_task_129137 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_ext_mem_112553;
    int64_t free_gtid_121510;
    unsigned char *free_mem_121527;
};
struct futhark_mc_segmap_parloop_struct_129139 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_ext_mem_112553;
    int64_t free_gtid_121510;
    unsigned char *free_mem_121527;
};
static int futhark_mc_segmap_parloop_129140(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_129139 *futhark_mc_segmap_parloop_struct_129139 = (struct futhark_mc_segmap_parloop_struct_129139 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_129139->ctx;
    struct mc_event *event_129141 = mc_event_new(ctx);
    
    if (event_129141 != NULL)
        event_129141->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_129139->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segmap_parloop_struct_129139->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segmap_parloop_struct_129139->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock ext_mem_112553 = {.desc ="ext_mem_112553", .mem =futhark_mc_segmap_parloop_struct_129139->free_ext_mem_112553, .size =0, .references =NULL};
    int64_t gtid_121510 = futhark_mc_segmap_parloop_struct_129139->free_gtid_121510;
    struct memblock mem_121527 = {.desc ="mem_121527", .mem =futhark_mc_segmap_parloop_struct_129139->free_mem_121527, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121540;
    
    flat_tid_121540 = subtask_id;
    {
        int64_t start_126632;
        int64_t end_126633;
        
        start_126632 = start;
        end_126633 = end;
        
        int64_t n_126634 = end_126633 - start_126632;
        
        for (int64_t SegMap_i_126635 = start_126632; SegMap_i_126635 < start_126632 + n_126634; SegMap_i_126635++) {
            int64_t slice_126636 = m_33388;
            int64_t gtid_121541 = SegMap_i_126635;
            int64_t remnant_126637 = SegMap_i_126635 - gtid_121541;
            double defunc_0_reduce_res_121542;
            double redout_126627 = 0.0;
            
            for (int64_t i_126626 = 0; i_126626 < m_33388; i_126626++) {
                double eta_p_126628 = ((double *) A_mem_111707.mem)[eta_p_106382 * (m_33388 * m_33388) + gtid_121510 * m_33388 + i_126626];
                double eta_p_126629 = ((double *) ext_mem_112553.mem)[i_126626 * m_33388 + gtid_121541];
                double zt_res_126630 = eta_p_126628 * eta_p_126629;
                double zp_res_126631 = zt_res_126630 + redout_126627;
                double redout_tmp_126638 = zp_res_126631;
                
                redout_126627 = redout_tmp_126638;
            }
            defunc_0_reduce_res_121542 = redout_126627;
            ((double *) mem_121527.mem)[gtid_121541] = defunc_0_reduce_res_121542;
        }
    }
    
  cleanup:
    { }
    if (event_129141 != NULL) {
        event_129141->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_129140", strdup("nothing further"), event_129141, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_task_129138(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129137 *futhark_mc_task_129137 = (struct futhark_mc_task_129137 *) args;
    struct futhark_context *ctx = futhark_mc_task_129137->ctx;
    struct mc_event *event_129143 = mc_event_new(ctx);
    
    if (event_129143 != NULL)
        event_129143->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129137->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_129137->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_129137->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock ext_mem_112553 = {.desc ="ext_mem_112553", .mem =futhark_mc_task_129137->free_ext_mem_112553, .size =0, .references =NULL};
    int64_t gtid_121510 = futhark_mc_task_129137->free_gtid_121510;
    struct memblock mem_121527 = {.desc ="mem_121527", .mem =futhark_mc_task_129137->free_mem_121527, .size =0, .references =NULL};
    int32_t nsubtasks_126625;
    
    nsubtasks_126625 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_129139 futhark_mc_segmap_parloop_struct_129139_;
    
    futhark_mc_segmap_parloop_struct_129139_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_129139_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_129139_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segmap_parloop_struct_129139_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segmap_parloop_struct_129139_.free_ext_mem_112553 = ext_mem_112553.mem;
    futhark_mc_segmap_parloop_struct_129139_.free_gtid_121510 = gtid_121510;
    futhark_mc_segmap_parloop_struct_129139_.free_mem_121527 = mem_121527.mem;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_129140_task;
    
    futhark_mc_segmap_parloop_129140_task.name = "futhark_mc_segmap_parloop_129140";
    futhark_mc_segmap_parloop_129140_task.fn = futhark_mc_segmap_parloop_129140;
    futhark_mc_segmap_parloop_129140_task.args = &futhark_mc_segmap_parloop_struct_129139_;
    futhark_mc_segmap_parloop_129140_task.iterations = iterations;
    futhark_mc_segmap_parloop_129140_task.info = info;
    
    struct mc_event *event_129142 = mc_event_new(ctx);
    
    if (event_129142 != NULL)
        event_129142->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_129140_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_129140_task);
    
    if (futhark_mc_segmap_parloop_129140_err != 0) {
        err = futhark_mc_segmap_parloop_129140_err;
        goto cleanup;
    }
    if (event_129142 != NULL) {
        event_129142->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_129140_total", strdup("nothing further"), event_129142, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_129143 != NULL) {
        event_129143->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_task_129138", strdup("nothing further"), event_129143, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_segmap_parloop_struct_129145 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_ext_mem_112553;
    int64_t free_gtid_121510;
    unsigned char *free_mem_121527;
};
struct futhark_mc_task_129147 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_ext_mem_112553;
    int64_t free_gtid_121510;
    int64_t free_gtid_121530;
    int64_t free_flat_tid_126640;
    double *retval_defunc_0_reduce_res_121531;
};
struct futhark_mc_segred_stage_1_parloop_struct_129150 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_ext_mem_112553;
    int64_t free_gtid_121510;
    int64_t free_gtid_121530;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126655;
};
static int futhark_mc_segred_stage_1_parloop_129151(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_129150 *futhark_mc_segred_stage_1_parloop_struct_129150 = (struct futhark_mc_segred_stage_1_parloop_struct_129150 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_129150->ctx;
    struct mc_event *event_129152 = mc_event_new(ctx);
    
    if (event_129152 != NULL)
        event_129152->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_129150->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_129150->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_129150->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock ext_mem_112553 = {.desc ="ext_mem_112553", .mem =futhark_mc_segred_stage_1_parloop_struct_129150->free_ext_mem_112553, .size =0, .references =NULL};
    int64_t gtid_121510 = futhark_mc_segred_stage_1_parloop_struct_129150->free_gtid_121510;
    int64_t gtid_121530 = futhark_mc_segred_stage_1_parloop_struct_129150->free_gtid_121530;
    struct memblock reduce_stage_1_tid_res_arr_mem_126655 = {.desc ="reduce_stage_1_tid_res_arr_mem_126655", .mem =futhark_mc_segred_stage_1_parloop_struct_129150->free_reduce_stage_1_tid_res_arr_mem_126655, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_126640;
    
    flat_tid_126640 = subtask_id;
    {
        double eta_p_126657;
        double eta_p_126658;
        double local_acc_126660 = 0.0;
        double eta_p_126642;
        double eta_p_126643;
        double local_acc_126661 = 0.0;
        int64_t start_126662;
        int64_t end_126663;
        
        start_126662 = start;
        end_126663 = end;
        
        int64_t n_126664 = end_126663 - start_126662;
        
        for (int64_t SegRed_i_126665 = start_126662; SegRed_i_126665 < start_126662 + n_126664; SegRed_i_126665++) {
            int64_t gtid_126641 = SegRed_i_126665;
            double eta_p_126645 = ((double *) A_mem_111707.mem)[eta_p_106382 * (m_33388 * m_33388) + gtid_121510 * m_33388 + gtid_126641];
            double eta_p_126646 = ((double *) ext_mem_112553.mem)[gtid_126641 * m_33388 + gtid_121530];
            double zt_res_126647 = eta_p_126645 * eta_p_126646;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_126642 = local_acc_126661;
            }
            // Load next params
            {
                eta_p_126643 = zt_res_126647;
            }
            // SegRed body
            {
                double zp_res_126644 = eta_p_126642 + eta_p_126643;
                
                local_acc_126661 = zp_res_126644;
            }
        }
        
        int64_t uni_i_126666 = 0;
        
        {
            int64_t gtid_126641 = uni_i_126666;
            
            // Load accum params
            {
                eta_p_126657 = local_acc_126660;
            }
            // Load next params
            {
                eta_p_126658 = local_acc_126661;
            }
            // SegRed body
            {
                double zp_res_126659 = eta_p_126657 + eta_p_126658;
                
                local_acc_126660 = zp_res_126659;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_126655.mem)[flat_tid_126640] = local_acc_126660;
    }
    
  cleanup:
    { }
    if (event_129152 != NULL) {
        event_129152->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129151", strdup("nothing further"), event_129152, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_129148(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129147 *futhark_mc_task_129147 = (struct futhark_mc_task_129147 *) args;
    struct futhark_context *ctx = futhark_mc_task_129147->ctx;
    struct mc_event *event_129154 = mc_event_new(ctx);
    
    if (event_129154 != NULL)
        event_129154->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129147->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_129147->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_129147->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock ext_mem_112553 = {.desc ="ext_mem_112553", .mem =futhark_mc_task_129147->free_ext_mem_112553, .size =0, .references =NULL};
    int64_t gtid_121510 = futhark_mc_task_129147->free_gtid_121510;
    int64_t gtid_121530 = futhark_mc_task_129147->free_gtid_121530;
    int64_t flat_tid_126640 = futhark_mc_task_129147->free_flat_tid_126640;
    double defunc_0_reduce_res_121531 = *futhark_mc_task_129147->retval_defunc_0_reduce_res_121531;
    int64_t reduce_stage_1_tid_res_arr_mem_126655_cached_sizze_129149 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126655 = NULL;
    int32_t nsubtasks_126654;
    
    nsubtasks_126654 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_126655_cached_sizze_129149 < (int64_t) 8 * nsubtasks_126654) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126655, &reduce_stage_1_tid_res_arr_mem_126655_cached_sizze_129149, (int64_t) 8 * nsubtasks_126654);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_129150 futhark_mc_segred_stage_1_parloop_struct_129150_;
    
    futhark_mc_segred_stage_1_parloop_struct_129150_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_129150_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_129150_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_129150_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_129150_.free_ext_mem_112553 = ext_mem_112553.mem;
    futhark_mc_segred_stage_1_parloop_struct_129150_.free_gtid_121510 = gtid_121510;
    futhark_mc_segred_stage_1_parloop_struct_129150_.free_gtid_121530 = gtid_121530;
    futhark_mc_segred_stage_1_parloop_struct_129150_.free_reduce_stage_1_tid_res_arr_mem_126655 = reduce_stage_1_tid_res_arr_mem_126655;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_129151_task;
    
    futhark_mc_segred_stage_1_parloop_129151_task.name = "futhark_mc_segred_stage_1_parloop_129151";
    futhark_mc_segred_stage_1_parloop_129151_task.fn = futhark_mc_segred_stage_1_parloop_129151;
    futhark_mc_segred_stage_1_parloop_129151_task.args = &futhark_mc_segred_stage_1_parloop_struct_129150_;
    futhark_mc_segred_stage_1_parloop_129151_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_129151_task.info = info;
    
    struct mc_event *event_129153 = mc_event_new(ctx);
    
    if (event_129153 != NULL)
        event_129153->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_129151_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_129151_task);
    
    if (futhark_mc_segred_stage_1_parloop_129151_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_129151_err;
        goto cleanup;
    }
    if (event_129153 != NULL) {
        event_129153->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129151_total", strdup("nothing further"), event_129153, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_121531 = 0.0;
    }
    
    double eta_p_126667;
    double eta_p_126668;
    
    for (int32_t i_126670 = 0; i_126670 < nsubtasks_126654; i_126670++) {
        flat_tid_126640 = i_126670;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_126667 = defunc_0_reduce_res_121531;
            }
            // load next params
            {
                eta_p_126668 = ((double *) reduce_stage_1_tid_res_arr_mem_126655)[flat_tid_126640];
            }
            // red body
            {
                double zp_res_126669 = eta_p_126667 + eta_p_126668;
                
                defunc_0_reduce_res_121531 = zp_res_126669;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_126655);
    }
    if (event_129154 != NULL) {
        event_129154->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_129148", strdup("nothing further"), event_129154, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_129147->retval_defunc_0_reduce_res_121531 = defunc_0_reduce_res_121531;
    }
    return err;
}
static int futhark_mc_segmap_parloop_129146(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_129145 *futhark_mc_segmap_parloop_struct_129145 = (struct futhark_mc_segmap_parloop_struct_129145 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_129145->ctx;
    struct mc_event *event_129155 = mc_event_new(ctx);
    
    if (event_129155 != NULL)
        event_129155->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_129145->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segmap_parloop_struct_129145->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segmap_parloop_struct_129145->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock ext_mem_112553 = {.desc ="ext_mem_112553", .mem =futhark_mc_segmap_parloop_struct_129145->free_ext_mem_112553, .size =0, .references =NULL};
    int64_t gtid_121510 = futhark_mc_segmap_parloop_struct_129145->free_gtid_121510;
    struct memblock mem_121527 = {.desc ="mem_121527", .mem =futhark_mc_segmap_parloop_struct_129145->free_mem_121527, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121529;
    
    flat_tid_121529 = subtask_id;
    {
        int64_t start_126648;
        int64_t end_126649;
        
        start_126648 = start;
        end_126649 = end;
        
        int64_t n_126650 = end_126649 - start_126648;
        
        for (int64_t SegMap_i_126651 = start_126648; SegMap_i_126651 < start_126648 + n_126650; SegMap_i_126651++) {
            int64_t slice_126652 = m_33388;
            int64_t gtid_121530 = SegMap_i_126651;
            int64_t remnant_126653 = SegMap_i_126651 - gtid_121530;
            double defunc_0_reduce_res_121531;
            int64_t flat_tid_126640 = (int64_t) 0;
            
            defunc_0_reduce_res_121531 = 0.0;
            
            struct futhark_mc_task_129147 futhark_mc_task_129147_;
            
            futhark_mc_task_129147_.ctx = ctx;
            futhark_mc_task_129147_.free_m_33388 = m_33388;
            futhark_mc_task_129147_.free_eta_p_106382 = eta_p_106382;
            futhark_mc_task_129147_.free_A_mem_111707 = A_mem_111707.mem;
            futhark_mc_task_129147_.free_ext_mem_112553 = ext_mem_112553.mem;
            futhark_mc_task_129147_.free_gtid_121510 = gtid_121510;
            futhark_mc_task_129147_.free_gtid_121530 = gtid_121530;
            futhark_mc_task_129147_.free_flat_tid_126640 = flat_tid_126640;
            futhark_mc_task_129147_.retval_defunc_0_reduce_res_121531 = (double *) &defunc_0_reduce_res_121531;
            #if ISPC
            futhark_mc_task_129147_.retval_defunc_0_reduce_res_121531 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_129147_task;
            
            futhark_mc_task_129147_task.args = &futhark_mc_task_129147_;
            futhark_mc_task_129147_task.top_level_fn = futhark_mc_segred_task_129148;
            futhark_mc_task_129147_task.name = "futhark_mc_segred_task_129148";
            futhark_mc_task_129147_task.iterations = m_33388;
            futhark_mc_task_129147_task.task_time = &ctx->program->futhark_mc_segred_task_129148_total_time;
            futhark_mc_task_129147_task.task_iter = &ctx->program->futhark_mc_segred_task_129148_total_iter;
            futhark_mc_task_129147_task.sched = STATIC;
            futhark_mc_task_129147_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_129148_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_129147_task);
            
            if (futhark_mc_segred_task_129148_err != 0) {
                err = futhark_mc_segred_task_129148_err;
                goto cleanup;
            }
            ((double *) mem_121527.mem)[gtid_121530] = defunc_0_reduce_res_121531;
        }
    }
    
  cleanup:
    { }
    if (event_129155 != NULL) {
        event_129155->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_129146", strdup("nothing further"), event_129155, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_nested_task_129144(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129137 *futhark_mc_task_129137 = (struct futhark_mc_task_129137 *) args;
    struct futhark_context *ctx = futhark_mc_task_129137->ctx;
    struct mc_event *event_129157 = mc_event_new(ctx);
    
    if (event_129157 != NULL)
        event_129157->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129137->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_129137->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_129137->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock ext_mem_112553 = {.desc ="ext_mem_112553", .mem =futhark_mc_task_129137->free_ext_mem_112553, .size =0, .references =NULL};
    int64_t gtid_121510 = futhark_mc_task_129137->free_gtid_121510;
    struct memblock mem_121527 = {.desc ="mem_121527", .mem =futhark_mc_task_129137->free_mem_121527, .size =0, .references =NULL};
    int32_t nsubtasks_126639;
    
    nsubtasks_126639 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_129145 futhark_mc_segmap_parloop_struct_129145_;
    
    futhark_mc_segmap_parloop_struct_129145_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_129145_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_129145_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segmap_parloop_struct_129145_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segmap_parloop_struct_129145_.free_ext_mem_112553 = ext_mem_112553.mem;
    futhark_mc_segmap_parloop_struct_129145_.free_gtid_121510 = gtid_121510;
    futhark_mc_segmap_parloop_struct_129145_.free_mem_121527 = mem_121527.mem;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_129146_task;
    
    futhark_mc_segmap_parloop_129146_task.name = "futhark_mc_segmap_parloop_129146";
    futhark_mc_segmap_parloop_129146_task.fn = futhark_mc_segmap_parloop_129146;
    futhark_mc_segmap_parloop_129146_task.args = &futhark_mc_segmap_parloop_struct_129145_;
    futhark_mc_segmap_parloop_129146_task.iterations = iterations;
    futhark_mc_segmap_parloop_129146_task.info = info;
    
    struct mc_event *event_129156 = mc_event_new(ctx);
    
    if (event_129156 != NULL)
        event_129156->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_129146_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_129146_task);
    
    if (futhark_mc_segmap_parloop_129146_err != 0) {
        err = futhark_mc_segmap_parloop_129146_err;
        goto cleanup;
    }
    if (event_129156 != NULL) {
        event_129156->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_129146_total", strdup("nothing further"), event_129156, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_129157 != NULL) {
        event_129157->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_nested_task_129144", strdup("nothing further"), event_129157, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_129158 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_111727;
    unsigned char *free_ext_mem_112553;
    int64_t free_gtid_121510;
    double free_eta_p_121526;
    unsigned char *free_mem_121527;
    int64_t free_flat_tid_121557;
    int64_t free_flat_tid_121605;
    double *retval_defunc_res_121549;
    double *retval_defunc_0_reduce_res_121550;
    double *retval_defunc_res_121551;
    double *retval_defunc_res_121552;
    double *retval_defunc_res_121553;
    double *retval_defunc_res_121554;
    double *retval_defunc_res_121555;
    double *retval_defunc_res_121556;
};
struct futhark_mc_segred_stage_1_parloop_struct_129168 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_111727;
    unsigned char *free_ext_mem_112553;
    int64_t free_gtid_121510;
    double free_eta_p_121526;
    unsigned char *free_mem_121527;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126672;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126674;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126676;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126678;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126680;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126682;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126684;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126686;
};
static int futhark_mc_segred_stage_1_parloop_129169(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_129168 *futhark_mc_segred_stage_1_parloop_struct_129168 = (struct futhark_mc_segred_stage_1_parloop_struct_129168 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_129168->ctx;
    struct mc_event *event_129170 = mc_event_new(ctx);
    
    if (event_129170 != NULL)
        event_129170->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_129168->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_129168->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_129168->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_111727 = {.desc ="mem_111727", .mem =futhark_mc_segred_stage_1_parloop_struct_129168->free_mem_111727, .size =0, .references =NULL};
    struct memblock ext_mem_112553 = {.desc ="ext_mem_112553", .mem =futhark_mc_segred_stage_1_parloop_struct_129168->free_ext_mem_112553, .size =0, .references =NULL};
    int64_t gtid_121510 = futhark_mc_segred_stage_1_parloop_struct_129168->free_gtid_121510;
    double eta_p_121526 = futhark_mc_segred_stage_1_parloop_struct_129168->free_eta_p_121526;
    struct memblock mem_121527 = {.desc ="mem_121527", .mem =futhark_mc_segred_stage_1_parloop_struct_129168->free_mem_121527, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126672 = {.desc ="reduce_stage_1_tid_res_arr_mem_126672", .mem =futhark_mc_segred_stage_1_parloop_struct_129168->free_reduce_stage_1_tid_res_arr_mem_126672, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126674 = {.desc ="reduce_stage_1_tid_res_arr_mem_126674", .mem =futhark_mc_segred_stage_1_parloop_struct_129168->free_reduce_stage_1_tid_res_arr_mem_126674, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126676 = {.desc ="reduce_stage_1_tid_res_arr_mem_126676", .mem =futhark_mc_segred_stage_1_parloop_struct_129168->free_reduce_stage_1_tid_res_arr_mem_126676, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126678 = {.desc ="reduce_stage_1_tid_res_arr_mem_126678", .mem =futhark_mc_segred_stage_1_parloop_struct_129168->free_reduce_stage_1_tid_res_arr_mem_126678, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126680 = {.desc ="reduce_stage_1_tid_res_arr_mem_126680", .mem =futhark_mc_segred_stage_1_parloop_struct_129168->free_reduce_stage_1_tid_res_arr_mem_126680, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126682 = {.desc ="reduce_stage_1_tid_res_arr_mem_126682", .mem =futhark_mc_segred_stage_1_parloop_struct_129168->free_reduce_stage_1_tid_res_arr_mem_126682, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126684 = {.desc ="reduce_stage_1_tid_res_arr_mem_126684", .mem =futhark_mc_segred_stage_1_parloop_struct_129168->free_reduce_stage_1_tid_res_arr_mem_126684, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126686 = {.desc ="reduce_stage_1_tid_res_arr_mem_126686", .mem =futhark_mc_segred_stage_1_parloop_struct_129168->free_reduce_stage_1_tid_res_arr_mem_126686, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121605;
    
    flat_tid_121605 = subtask_id;
    {
        double eta_p_126688;
        double eta_p_126689;
        double eta_p_126691;
        double eta_p_126692;
        double eta_p_126694;
        double eta_p_126695;
        double eta_p_126697;
        double eta_p_126698;
        double eta_p_126700;
        double eta_p_126701;
        double eta_p_126703;
        double eta_p_126704;
        double eta_p_126706;
        double eta_p_126707;
        double eta_p_126709;
        double eta_p_126710;
        double local_acc_126712 = 0.0;
        double local_acc_126713 = 0.0;
        double local_acc_126714 = 0.0;
        double local_acc_126715 = 0.0;
        double local_acc_126716 = 0.0;
        double local_acc_126717 = 0.0;
        double local_acc_126718 = 0.0;
        double local_acc_126719 = 0.0;
        double eta_p_121607;
        double eta_p_121608;
        double eta_p_121610;
        double eta_p_121611;
        double eta_p_121613;
        double eta_p_121614;
        double eta_p_121616;
        double eta_p_121617;
        double eta_p_121619;
        double eta_p_121620;
        double eta_p_121622;
        double eta_p_121623;
        double eta_p_121625;
        double eta_p_121626;
        double eta_p_121628;
        double eta_p_121629;
        double local_acc_126720 = 0.0;
        double local_acc_126721 = 0.0;
        double local_acc_126722 = 0.0;
        double local_acc_126723 = 0.0;
        double local_acc_126724 = 0.0;
        double local_acc_126725 = 0.0;
        double local_acc_126726 = 0.0;
        double local_acc_126727 = 0.0;
        int64_t start_126728;
        int64_t end_126729;
        
        start_126728 = start;
        end_126729 = end;
        
        int64_t n_126730 = end_126729 - start_126728;
        
        for (int64_t SegRed_i_126731 = start_126728; SegRed_i_126731 < start_126728 + n_126730; SegRed_i_126731++) {
            int64_t gtid_121606 = SegRed_i_126731;
            double x_121631 = ((double *) ext_mem_112553.mem)[gtid_121510 * m_33388 + gtid_121606];
            double eta_p_121632 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + gtid_121606];
            double defunc_0_reduce_res_121633;
            double redout_121635 = 0.0;
            
            for (int64_t i_121634 = 0; i_121634 < m_33388; i_121634++) {
                double eta_p_121636 = ((double *) mem_121527.mem)[i_121634];
                double eta_p_121637 = ((double *) mem_111727.mem)[lifted_lambda_res_106391 * (m_33388 * m_33388) + i_121634 * m_33388 + gtid_121606];
                double zt_res_121638 = eta_p_121636 * eta_p_121637;
                double zp_res_121639 = zt_res_121638 + redout_121635;
                double redout_tmp_126732 = zp_res_121639;
                
                redout_121635 = redout_tmp_126732;
            }
            defunc_0_reduce_res_121633 = redout_121635;
            
            double zt_res_121640 = x_121631 * defunc_0_reduce_res_121633;
            double zt_res_121641 = eta_p_121526 * eta_p_121632;
            bool zeze_res_121642 = x_121631 == 0.0;
            double klu_res_121643;
            
            if (zeze_res_121642) {
                klu_res_121643 = 0.0;
            } else {
                double zs_res_121644 = x_121631 / zt_res_121641;
                double log_res_121645 = futrts_log64(zs_res_121644);
                double zt_res_121646 = x_121631 * log_res_121645;
                
                klu_res_121643 = zt_res_121646;
            }
            
            double klu_res_121647;
            
            if (zeze_res_121642) {
                klu_res_121647 = 0.0;
            } else {
                double zs_res_121648 = x_121631 / zt_res_121641;
                double log_res_121649 = futrts_log64(zs_res_121648);
                double zt_res_121650 = x_121631 * log_res_121649;
                
                klu_res_121647 = zt_res_121650;
            }
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_121607 = local_acc_126720;
            }
            // Load next params
            {
                eta_p_121608 = x_121631;
            }
            // SegRed body
            {
                double zp_res_121609 = eta_p_121607 + eta_p_121608;
                
                local_acc_126720 = zp_res_121609;
            }
            // Load accum params
            {
                eta_p_121610 = local_acc_126721;
            }
            // Load next params
            {
                eta_p_121611 = zt_res_121640;
            }
            // SegRed body
            {
                double zp_res_121612 = eta_p_121610 + eta_p_121611;
                
                local_acc_126721 = zp_res_121612;
            }
            // Load accum params
            {
                eta_p_121613 = local_acc_126722;
            }
            // Load next params
            {
                eta_p_121614 = x_121631;
            }
            // SegRed body
            {
                double zp_res_121615 = eta_p_121613 + eta_p_121614;
                
                local_acc_126722 = zp_res_121615;
            }
            // Load accum params
            {
                eta_p_121616 = local_acc_126723;
            }
            // Load next params
            {
                eta_p_121617 = x_121631;
            }
            // SegRed body
            {
                double zp_res_121618 = eta_p_121616 + eta_p_121617;
                
                local_acc_126723 = zp_res_121618;
            }
            // Load accum params
            {
                eta_p_121619 = local_acc_126724;
            }
            // Load next params
            {
                eta_p_121620 = x_121631;
            }
            // SegRed body
            {
                double zp_res_121621 = eta_p_121619 + eta_p_121620;
                
                local_acc_126724 = zp_res_121621;
            }
            // Load accum params
            {
                eta_p_121622 = local_acc_126725;
            }
            // Load next params
            {
                eta_p_121623 = klu_res_121643;
            }
            // SegRed body
            {
                double zp_res_121624 = eta_p_121622 + eta_p_121623;
                
                local_acc_126725 = zp_res_121624;
            }
            // Load accum params
            {
                eta_p_121625 = local_acc_126726;
            }
            // Load next params
            {
                eta_p_121626 = klu_res_121647;
            }
            // SegRed body
            {
                double zp_res_121627 = eta_p_121625 + eta_p_121626;
                
                local_acc_126726 = zp_res_121627;
            }
            // Load accum params
            {
                eta_p_121628 = local_acc_126727;
            }
            // Load next params
            {
                eta_p_121629 = x_121631;
            }
            // SegRed body
            {
                double zp_res_121630 = eta_p_121628 + eta_p_121629;
                
                local_acc_126727 = zp_res_121630;
            }
        }
        
        int64_t uni_i_126733 = 0;
        
        {
            int64_t gtid_121606 = uni_i_126733;
            
            // Load accum params
            {
                eta_p_126688 = local_acc_126712;
            }
            // Load next params
            {
                eta_p_126689 = local_acc_126720;
            }
            // SegRed body
            {
                double zp_res_126690 = eta_p_126688 + eta_p_126689;
                
                local_acc_126712 = zp_res_126690;
            }
            // Load accum params
            {
                eta_p_126691 = local_acc_126713;
            }
            // Load next params
            {
                eta_p_126692 = local_acc_126721;
            }
            // SegRed body
            {
                double zp_res_126693 = eta_p_126691 + eta_p_126692;
                
                local_acc_126713 = zp_res_126693;
            }
            // Load accum params
            {
                eta_p_126694 = local_acc_126714;
            }
            // Load next params
            {
                eta_p_126695 = local_acc_126722;
            }
            // SegRed body
            {
                double zp_res_126696 = eta_p_126694 + eta_p_126695;
                
                local_acc_126714 = zp_res_126696;
            }
            // Load accum params
            {
                eta_p_126697 = local_acc_126715;
            }
            // Load next params
            {
                eta_p_126698 = local_acc_126723;
            }
            // SegRed body
            {
                double zp_res_126699 = eta_p_126697 + eta_p_126698;
                
                local_acc_126715 = zp_res_126699;
            }
            // Load accum params
            {
                eta_p_126700 = local_acc_126716;
            }
            // Load next params
            {
                eta_p_126701 = local_acc_126724;
            }
            // SegRed body
            {
                double zp_res_126702 = eta_p_126700 + eta_p_126701;
                
                local_acc_126716 = zp_res_126702;
            }
            // Load accum params
            {
                eta_p_126703 = local_acc_126717;
            }
            // Load next params
            {
                eta_p_126704 = local_acc_126725;
            }
            // SegRed body
            {
                double zp_res_126705 = eta_p_126703 + eta_p_126704;
                
                local_acc_126717 = zp_res_126705;
            }
            // Load accum params
            {
                eta_p_126706 = local_acc_126718;
            }
            // Load next params
            {
                eta_p_126707 = local_acc_126726;
            }
            // SegRed body
            {
                double zp_res_126708 = eta_p_126706 + eta_p_126707;
                
                local_acc_126718 = zp_res_126708;
            }
            // Load accum params
            {
                eta_p_126709 = local_acc_126719;
            }
            // Load next params
            {
                eta_p_126710 = local_acc_126727;
            }
            // SegRed body
            {
                double zp_res_126711 = eta_p_126709 + eta_p_126710;
                
                local_acc_126719 = zp_res_126711;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_126672.mem)[flat_tid_121605] = local_acc_126712;
        ((double *) reduce_stage_1_tid_res_arr_mem_126674.mem)[flat_tid_121605] = local_acc_126713;
        ((double *) reduce_stage_1_tid_res_arr_mem_126676.mem)[flat_tid_121605] = local_acc_126714;
        ((double *) reduce_stage_1_tid_res_arr_mem_126678.mem)[flat_tid_121605] = local_acc_126715;
        ((double *) reduce_stage_1_tid_res_arr_mem_126680.mem)[flat_tid_121605] = local_acc_126716;
        ((double *) reduce_stage_1_tid_res_arr_mem_126682.mem)[flat_tid_121605] = local_acc_126717;
        ((double *) reduce_stage_1_tid_res_arr_mem_126684.mem)[flat_tid_121605] = local_acc_126718;
        ((double *) reduce_stage_1_tid_res_arr_mem_126686.mem)[flat_tid_121605] = local_acc_126719;
    }
    
  cleanup:
    { }
    if (event_129170 != NULL) {
        event_129170->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129169", strdup("nothing further"), event_129170, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_129159(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129158 *futhark_mc_task_129158 = (struct futhark_mc_task_129158 *) args;
    struct futhark_context *ctx = futhark_mc_task_129158->ctx;
    struct mc_event *event_129172 = mc_event_new(ctx);
    
    if (event_129172 != NULL)
        event_129172->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129158->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_129158->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_129158->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_111727 = {.desc ="mem_111727", .mem =futhark_mc_task_129158->free_mem_111727, .size =0, .references =NULL};
    struct memblock ext_mem_112553 = {.desc ="ext_mem_112553", .mem =futhark_mc_task_129158->free_ext_mem_112553, .size =0, .references =NULL};
    int64_t gtid_121510 = futhark_mc_task_129158->free_gtid_121510;
    double eta_p_121526 = futhark_mc_task_129158->free_eta_p_121526;
    struct memblock mem_121527 = {.desc ="mem_121527", .mem =futhark_mc_task_129158->free_mem_121527, .size =0, .references =NULL};
    int64_t flat_tid_121557 = futhark_mc_task_129158->free_flat_tid_121557;
    int64_t flat_tid_121605 = futhark_mc_task_129158->free_flat_tid_121605;
    double defunc_res_121549 = *futhark_mc_task_129158->retval_defunc_res_121549;
    double defunc_0_reduce_res_121550 = *futhark_mc_task_129158->retval_defunc_0_reduce_res_121550;
    double defunc_res_121551 = *futhark_mc_task_129158->retval_defunc_res_121551;
    double defunc_res_121552 = *futhark_mc_task_129158->retval_defunc_res_121552;
    double defunc_res_121553 = *futhark_mc_task_129158->retval_defunc_res_121553;
    double defunc_res_121554 = *futhark_mc_task_129158->retval_defunc_res_121554;
    double defunc_res_121555 = *futhark_mc_task_129158->retval_defunc_res_121555;
    double defunc_res_121556 = *futhark_mc_task_129158->retval_defunc_res_121556;
    int64_t reduce_stage_1_tid_res_arr_mem_126672_cached_sizze_129160 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126672 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_126674_cached_sizze_129161 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126674 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_126676_cached_sizze_129162 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126676 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_126678_cached_sizze_129163 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126678 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_126680_cached_sizze_129164 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126680 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_126682_cached_sizze_129165 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126682 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_126684_cached_sizze_129166 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126684 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_126686_cached_sizze_129167 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126686 = NULL;
    int32_t nsubtasks_126671;
    
    nsubtasks_126671 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_126672_cached_sizze_129160 < (int64_t) 8 * nsubtasks_126671) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126672, &reduce_stage_1_tid_res_arr_mem_126672_cached_sizze_129160, (int64_t) 8 * nsubtasks_126671);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_126674_cached_sizze_129161 < (int64_t) 8 * nsubtasks_126671) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126674, &reduce_stage_1_tid_res_arr_mem_126674_cached_sizze_129161, (int64_t) 8 * nsubtasks_126671);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_126676_cached_sizze_129162 < (int64_t) 8 * nsubtasks_126671) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126676, &reduce_stage_1_tid_res_arr_mem_126676_cached_sizze_129162, (int64_t) 8 * nsubtasks_126671);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_126678_cached_sizze_129163 < (int64_t) 8 * nsubtasks_126671) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126678, &reduce_stage_1_tid_res_arr_mem_126678_cached_sizze_129163, (int64_t) 8 * nsubtasks_126671);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_126680_cached_sizze_129164 < (int64_t) 8 * nsubtasks_126671) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126680, &reduce_stage_1_tid_res_arr_mem_126680_cached_sizze_129164, (int64_t) 8 * nsubtasks_126671);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_126682_cached_sizze_129165 < (int64_t) 8 * nsubtasks_126671) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126682, &reduce_stage_1_tid_res_arr_mem_126682_cached_sizze_129165, (int64_t) 8 * nsubtasks_126671);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_126684_cached_sizze_129166 < (int64_t) 8 * nsubtasks_126671) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126684, &reduce_stage_1_tid_res_arr_mem_126684_cached_sizze_129166, (int64_t) 8 * nsubtasks_126671);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_126686_cached_sizze_129167 < (int64_t) 8 * nsubtasks_126671) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126686, &reduce_stage_1_tid_res_arr_mem_126686_cached_sizze_129167, (int64_t) 8 * nsubtasks_126671);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_129168 futhark_mc_segred_stage_1_parloop_struct_129168_;
    
    futhark_mc_segred_stage_1_parloop_struct_129168_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_129168_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_129168_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_129168_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_129168_.free_mem_111727 = mem_111727.mem;
    futhark_mc_segred_stage_1_parloop_struct_129168_.free_ext_mem_112553 = ext_mem_112553.mem;
    futhark_mc_segred_stage_1_parloop_struct_129168_.free_gtid_121510 = gtid_121510;
    futhark_mc_segred_stage_1_parloop_struct_129168_.free_eta_p_121526 = eta_p_121526;
    futhark_mc_segred_stage_1_parloop_struct_129168_.free_mem_121527 = mem_121527.mem;
    futhark_mc_segred_stage_1_parloop_struct_129168_.free_reduce_stage_1_tid_res_arr_mem_126672 = reduce_stage_1_tid_res_arr_mem_126672;
    futhark_mc_segred_stage_1_parloop_struct_129168_.free_reduce_stage_1_tid_res_arr_mem_126674 = reduce_stage_1_tid_res_arr_mem_126674;
    futhark_mc_segred_stage_1_parloop_struct_129168_.free_reduce_stage_1_tid_res_arr_mem_126676 = reduce_stage_1_tid_res_arr_mem_126676;
    futhark_mc_segred_stage_1_parloop_struct_129168_.free_reduce_stage_1_tid_res_arr_mem_126678 = reduce_stage_1_tid_res_arr_mem_126678;
    futhark_mc_segred_stage_1_parloop_struct_129168_.free_reduce_stage_1_tid_res_arr_mem_126680 = reduce_stage_1_tid_res_arr_mem_126680;
    futhark_mc_segred_stage_1_parloop_struct_129168_.free_reduce_stage_1_tid_res_arr_mem_126682 = reduce_stage_1_tid_res_arr_mem_126682;
    futhark_mc_segred_stage_1_parloop_struct_129168_.free_reduce_stage_1_tid_res_arr_mem_126684 = reduce_stage_1_tid_res_arr_mem_126684;
    futhark_mc_segred_stage_1_parloop_struct_129168_.free_reduce_stage_1_tid_res_arr_mem_126686 = reduce_stage_1_tid_res_arr_mem_126686;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_129169_task;
    
    futhark_mc_segred_stage_1_parloop_129169_task.name = "futhark_mc_segred_stage_1_parloop_129169";
    futhark_mc_segred_stage_1_parloop_129169_task.fn = futhark_mc_segred_stage_1_parloop_129169;
    futhark_mc_segred_stage_1_parloop_129169_task.args = &futhark_mc_segred_stage_1_parloop_struct_129168_;
    futhark_mc_segred_stage_1_parloop_129169_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_129169_task.info = info;
    
    struct mc_event *event_129171 = mc_event_new(ctx);
    
    if (event_129171 != NULL)
        event_129171->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_129169_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_129169_task);
    
    if (futhark_mc_segred_stage_1_parloop_129169_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_129169_err;
        goto cleanup;
    }
    if (event_129171 != NULL) {
        event_129171->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129169_total", strdup("nothing further"), event_129171, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_121549 = 0.0;
        defunc_0_reduce_res_121550 = 0.0;
        defunc_res_121551 = 0.0;
        defunc_res_121552 = 0.0;
        defunc_res_121553 = 0.0;
        defunc_res_121554 = 0.0;
        defunc_res_121555 = 0.0;
        defunc_res_121556 = 0.0;
    }
    
    double eta_p_126734;
    double eta_p_126735;
    double eta_p_126737;
    double eta_p_126738;
    double eta_p_126740;
    double eta_p_126741;
    double eta_p_126743;
    double eta_p_126744;
    double eta_p_126746;
    double eta_p_126747;
    double eta_p_126749;
    double eta_p_126750;
    double eta_p_126752;
    double eta_p_126753;
    double eta_p_126755;
    double eta_p_126756;
    
    for (int32_t i_126758 = 0; i_126758 < nsubtasks_126671; i_126758++) {
        flat_tid_121605 = i_126758;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_126734 = defunc_res_121549;
            }
            // load next params
            {
                eta_p_126735 = ((double *) reduce_stage_1_tid_res_arr_mem_126672)[flat_tid_121605];
            }
            // red body
            {
                double zp_res_126736 = eta_p_126734 + eta_p_126735;
                
                defunc_res_121549 = zp_res_126736;
            }
            // load acc params
            {
                eta_p_126737 = defunc_0_reduce_res_121550;
            }
            // load next params
            {
                eta_p_126738 = ((double *) reduce_stage_1_tid_res_arr_mem_126674)[flat_tid_121605];
            }
            // red body
            {
                double zp_res_126739 = eta_p_126737 + eta_p_126738;
                
                defunc_0_reduce_res_121550 = zp_res_126739;
            }
            // load acc params
            {
                eta_p_126740 = defunc_res_121551;
            }
            // load next params
            {
                eta_p_126741 = ((double *) reduce_stage_1_tid_res_arr_mem_126676)[flat_tid_121605];
            }
            // red body
            {
                double zp_res_126742 = eta_p_126740 + eta_p_126741;
                
                defunc_res_121551 = zp_res_126742;
            }
            // load acc params
            {
                eta_p_126743 = defunc_res_121552;
            }
            // load next params
            {
                eta_p_126744 = ((double *) reduce_stage_1_tid_res_arr_mem_126678)[flat_tid_121605];
            }
            // red body
            {
                double zp_res_126745 = eta_p_126743 + eta_p_126744;
                
                defunc_res_121552 = zp_res_126745;
            }
            // load acc params
            {
                eta_p_126746 = defunc_res_121553;
            }
            // load next params
            {
                eta_p_126747 = ((double *) reduce_stage_1_tid_res_arr_mem_126680)[flat_tid_121605];
            }
            // red body
            {
                double zp_res_126748 = eta_p_126746 + eta_p_126747;
                
                defunc_res_121553 = zp_res_126748;
            }
            // load acc params
            {
                eta_p_126749 = defunc_res_121554;
            }
            // load next params
            {
                eta_p_126750 = ((double *) reduce_stage_1_tid_res_arr_mem_126682)[flat_tid_121605];
            }
            // red body
            {
                double zp_res_126751 = eta_p_126749 + eta_p_126750;
                
                defunc_res_121554 = zp_res_126751;
            }
            // load acc params
            {
                eta_p_126752 = defunc_res_121555;
            }
            // load next params
            {
                eta_p_126753 = ((double *) reduce_stage_1_tid_res_arr_mem_126684)[flat_tid_121605];
            }
            // red body
            {
                double zp_res_126754 = eta_p_126752 + eta_p_126753;
                
                defunc_res_121555 = zp_res_126754;
            }
            // load acc params
            {
                eta_p_126755 = defunc_res_121556;
            }
            // load next params
            {
                eta_p_126756 = ((double *) reduce_stage_1_tid_res_arr_mem_126686)[flat_tid_121605];
            }
            // red body
            {
                double zp_res_126757 = eta_p_126755 + eta_p_126756;
                
                defunc_res_121556 = zp_res_126757;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_126672);
        free(reduce_stage_1_tid_res_arr_mem_126674);
        free(reduce_stage_1_tid_res_arr_mem_126676);
        free(reduce_stage_1_tid_res_arr_mem_126678);
        free(reduce_stage_1_tid_res_arr_mem_126680);
        free(reduce_stage_1_tid_res_arr_mem_126682);
        free(reduce_stage_1_tid_res_arr_mem_126684);
        free(reduce_stage_1_tid_res_arr_mem_126686);
    }
    if (event_129172 != NULL) {
        event_129172->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_129159", strdup("nothing further"), event_129172, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_129158->retval_defunc_res_121549 = defunc_res_121549;
        *futhark_mc_task_129158->retval_defunc_0_reduce_res_121550 = defunc_0_reduce_res_121550;
        *futhark_mc_task_129158->retval_defunc_res_121551 = defunc_res_121551;
        *futhark_mc_task_129158->retval_defunc_res_121552 = defunc_res_121552;
        *futhark_mc_task_129158->retval_defunc_res_121553 = defunc_res_121553;
        *futhark_mc_task_129158->retval_defunc_res_121554 = defunc_res_121554;
        *futhark_mc_task_129158->retval_defunc_res_121555 = defunc_res_121555;
        *futhark_mc_task_129158->retval_defunc_res_121556 = defunc_res_121556;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_129182 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_111727;
    unsigned char *free_ext_mem_112553;
    int64_t free_gtid_121510;
    double free_eta_p_121526;
    unsigned char *free_mem_121527;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126760;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126762;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126764;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126766;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126768;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126770;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126772;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126774;
};
struct futhark_mc_task_129184 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_mem_111727;
    unsigned char *free_mem_121527;
    int64_t free_gtid_121558;
    int64_t free_flat_tid_121586;
    double *retval_defunc_0_reduce_res_121585;
};
struct futhark_mc_segred_stage_1_parloop_struct_129187 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_mem_111727;
    unsigned char *free_mem_121527;
    int64_t free_gtid_121558;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126821;
};
static int futhark_mc_segred_stage_1_parloop_129188(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_129187 *futhark_mc_segred_stage_1_parloop_struct_129187 = (struct futhark_mc_segred_stage_1_parloop_struct_129187 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_129187->ctx;
    struct mc_event *event_129189 = mc_event_new(ctx);
    
    if (event_129189 != NULL)
        event_129189->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_129187->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_129187->free_lifted_lambda_res_106391;
    struct memblock mem_111727 = {.desc ="mem_111727", .mem =futhark_mc_segred_stage_1_parloop_struct_129187->free_mem_111727, .size =0, .references =NULL};
    struct memblock mem_121527 = {.desc ="mem_121527", .mem =futhark_mc_segred_stage_1_parloop_struct_129187->free_mem_121527, .size =0, .references =NULL};
    int64_t gtid_121558 = futhark_mc_segred_stage_1_parloop_struct_129187->free_gtid_121558;
    struct memblock reduce_stage_1_tid_res_arr_mem_126821 = {.desc ="reduce_stage_1_tid_res_arr_mem_126821", .mem =futhark_mc_segred_stage_1_parloop_struct_129187->free_reduce_stage_1_tid_res_arr_mem_126821, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121586;
    
    flat_tid_121586 = subtask_id;
    {
        double eta_p_126823;
        double eta_p_126824;
        double local_acc_126826 = 0.0;
        double eta_p_121588;
        double eta_p_121589;
        double local_acc_126827 = 0.0;
        int64_t start_126828;
        int64_t end_126829;
        
        start_126828 = start;
        end_126829 = end;
        
        int64_t n_126830 = end_126829 - start_126828;
        
        for (int64_t SegRed_i_126831 = start_126828; SegRed_i_126831 < start_126828 + n_126830; SegRed_i_126831++) {
            int64_t gtid_121587 = SegRed_i_126831;
            double eta_p_121591 = ((double *) mem_121527.mem)[gtid_121587];
            double eta_p_121592 = ((double *) mem_111727.mem)[lifted_lambda_res_106391 * (m_33388 * m_33388) + gtid_121587 * m_33388 + gtid_121558];
            double zt_res_121593 = eta_p_121591 * eta_p_121592;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_121588 = local_acc_126827;
            }
            // Load next params
            {
                eta_p_121589 = zt_res_121593;
            }
            // SegRed body
            {
                double zp_res_121590 = eta_p_121588 + eta_p_121589;
                
                local_acc_126827 = zp_res_121590;
            }
        }
        
        int64_t uni_i_126832 = 0;
        
        {
            int64_t gtid_121587 = uni_i_126832;
            
            // Load accum params
            {
                eta_p_126823 = local_acc_126826;
            }
            // Load next params
            {
                eta_p_126824 = local_acc_126827;
            }
            // SegRed body
            {
                double zp_res_126825 = eta_p_126823 + eta_p_126824;
                
                local_acc_126826 = zp_res_126825;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_126821.mem)[flat_tid_121586] = local_acc_126826;
    }
    
  cleanup:
    { }
    if (event_129189 != NULL) {
        event_129189->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129188", strdup("nothing further"), event_129189, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_129185(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129184 *futhark_mc_task_129184 = (struct futhark_mc_task_129184 *) args;
    struct futhark_context *ctx = futhark_mc_task_129184->ctx;
    struct mc_event *event_129191 = mc_event_new(ctx);
    
    if (event_129191 != NULL)
        event_129191->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129184->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_129184->free_lifted_lambda_res_106391;
    struct memblock mem_111727 = {.desc ="mem_111727", .mem =futhark_mc_task_129184->free_mem_111727, .size =0, .references =NULL};
    struct memblock mem_121527 = {.desc ="mem_121527", .mem =futhark_mc_task_129184->free_mem_121527, .size =0, .references =NULL};
    int64_t gtid_121558 = futhark_mc_task_129184->free_gtid_121558;
    int64_t flat_tid_121586 = futhark_mc_task_129184->free_flat_tid_121586;
    double defunc_0_reduce_res_121585 = *futhark_mc_task_129184->retval_defunc_0_reduce_res_121585;
    int64_t reduce_stage_1_tid_res_arr_mem_126821_cached_sizze_129186 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126821 = NULL;
    int32_t nsubtasks_126820;
    
    nsubtasks_126820 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_126821_cached_sizze_129186 < (int64_t) 8 * nsubtasks_126820) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126821, &reduce_stage_1_tid_res_arr_mem_126821_cached_sizze_129186, (int64_t) 8 * nsubtasks_126820);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_129187 futhark_mc_segred_stage_1_parloop_struct_129187_;
    
    futhark_mc_segred_stage_1_parloop_struct_129187_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_129187_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_129187_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_129187_.free_mem_111727 = mem_111727.mem;
    futhark_mc_segred_stage_1_parloop_struct_129187_.free_mem_121527 = mem_121527.mem;
    futhark_mc_segred_stage_1_parloop_struct_129187_.free_gtid_121558 = gtid_121558;
    futhark_mc_segred_stage_1_parloop_struct_129187_.free_reduce_stage_1_tid_res_arr_mem_126821 = reduce_stage_1_tid_res_arr_mem_126821;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_129188_task;
    
    futhark_mc_segred_stage_1_parloop_129188_task.name = "futhark_mc_segred_stage_1_parloop_129188";
    futhark_mc_segred_stage_1_parloop_129188_task.fn = futhark_mc_segred_stage_1_parloop_129188;
    futhark_mc_segred_stage_1_parloop_129188_task.args = &futhark_mc_segred_stage_1_parloop_struct_129187_;
    futhark_mc_segred_stage_1_parloop_129188_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_129188_task.info = info;
    
    struct mc_event *event_129190 = mc_event_new(ctx);
    
    if (event_129190 != NULL)
        event_129190->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_129188_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_129188_task);
    
    if (futhark_mc_segred_stage_1_parloop_129188_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_129188_err;
        goto cleanup;
    }
    if (event_129190 != NULL) {
        event_129190->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129188_total", strdup("nothing further"), event_129190, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_121585 = 0.0;
    }
    
    double eta_p_126833;
    double eta_p_126834;
    
    for (int32_t i_126836 = 0; i_126836 < nsubtasks_126820; i_126836++) {
        flat_tid_121586 = i_126836;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_126833 = defunc_0_reduce_res_121585;
            }
            // load next params
            {
                eta_p_126834 = ((double *) reduce_stage_1_tid_res_arr_mem_126821)[flat_tid_121586];
            }
            // red body
            {
                double zp_res_126835 = eta_p_126833 + eta_p_126834;
                
                defunc_0_reduce_res_121585 = zp_res_126835;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_126821);
    }
    if (event_129191 != NULL) {
        event_129191->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_129185", strdup("nothing further"), event_129191, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_129184->retval_defunc_0_reduce_res_121585 = defunc_0_reduce_res_121585;
    }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_129183(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_129182 *futhark_mc_segred_stage_1_parloop_struct_129182 = (struct futhark_mc_segred_stage_1_parloop_struct_129182 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_129182->ctx;
    struct mc_event *event_129192 = mc_event_new(ctx);
    
    if (event_129192 != NULL)
        event_129192->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_129182->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_129182->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_129182->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_111727 = {.desc ="mem_111727", .mem =futhark_mc_segred_stage_1_parloop_struct_129182->free_mem_111727, .size =0, .references =NULL};
    struct memblock ext_mem_112553 = {.desc ="ext_mem_112553", .mem =futhark_mc_segred_stage_1_parloop_struct_129182->free_ext_mem_112553, .size =0, .references =NULL};
    int64_t gtid_121510 = futhark_mc_segred_stage_1_parloop_struct_129182->free_gtid_121510;
    double eta_p_121526 = futhark_mc_segred_stage_1_parloop_struct_129182->free_eta_p_121526;
    struct memblock mem_121527 = {.desc ="mem_121527", .mem =futhark_mc_segred_stage_1_parloop_struct_129182->free_mem_121527, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126760 = {.desc ="reduce_stage_1_tid_res_arr_mem_126760", .mem =futhark_mc_segred_stage_1_parloop_struct_129182->free_reduce_stage_1_tid_res_arr_mem_126760, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126762 = {.desc ="reduce_stage_1_tid_res_arr_mem_126762", .mem =futhark_mc_segred_stage_1_parloop_struct_129182->free_reduce_stage_1_tid_res_arr_mem_126762, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126764 = {.desc ="reduce_stage_1_tid_res_arr_mem_126764", .mem =futhark_mc_segred_stage_1_parloop_struct_129182->free_reduce_stage_1_tid_res_arr_mem_126764, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126766 = {.desc ="reduce_stage_1_tid_res_arr_mem_126766", .mem =futhark_mc_segred_stage_1_parloop_struct_129182->free_reduce_stage_1_tid_res_arr_mem_126766, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126768 = {.desc ="reduce_stage_1_tid_res_arr_mem_126768", .mem =futhark_mc_segred_stage_1_parloop_struct_129182->free_reduce_stage_1_tid_res_arr_mem_126768, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126770 = {.desc ="reduce_stage_1_tid_res_arr_mem_126770", .mem =futhark_mc_segred_stage_1_parloop_struct_129182->free_reduce_stage_1_tid_res_arr_mem_126770, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126772 = {.desc ="reduce_stage_1_tid_res_arr_mem_126772", .mem =futhark_mc_segred_stage_1_parloop_struct_129182->free_reduce_stage_1_tid_res_arr_mem_126772, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126774 = {.desc ="reduce_stage_1_tid_res_arr_mem_126774", .mem =futhark_mc_segred_stage_1_parloop_struct_129182->free_reduce_stage_1_tid_res_arr_mem_126774, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121557;
    
    flat_tid_121557 = subtask_id;
    {
        double eta_p_126776;
        double eta_p_126777;
        double eta_p_126779;
        double eta_p_126780;
        double eta_p_126782;
        double eta_p_126783;
        double eta_p_126785;
        double eta_p_126786;
        double eta_p_126788;
        double eta_p_126789;
        double eta_p_126791;
        double eta_p_126792;
        double eta_p_126794;
        double eta_p_126795;
        double eta_p_126797;
        double eta_p_126798;
        double local_acc_126800 = 0.0;
        double local_acc_126801 = 0.0;
        double local_acc_126802 = 0.0;
        double local_acc_126803 = 0.0;
        double local_acc_126804 = 0.0;
        double local_acc_126805 = 0.0;
        double local_acc_126806 = 0.0;
        double local_acc_126807 = 0.0;
        double eta_p_121559;
        double eta_p_121560;
        double eta_p_121562;
        double eta_p_121563;
        double eta_p_121565;
        double eta_p_121566;
        double eta_p_121568;
        double eta_p_121569;
        double eta_p_121571;
        double eta_p_121572;
        double eta_p_121574;
        double eta_p_121575;
        double eta_p_121577;
        double eta_p_121578;
        double eta_p_121580;
        double eta_p_121581;
        double local_acc_126808 = 0.0;
        double local_acc_126809 = 0.0;
        double local_acc_126810 = 0.0;
        double local_acc_126811 = 0.0;
        double local_acc_126812 = 0.0;
        double local_acc_126813 = 0.0;
        double local_acc_126814 = 0.0;
        double local_acc_126815 = 0.0;
        int64_t start_126816;
        int64_t end_126817;
        
        start_126816 = start;
        end_126817 = end;
        
        int64_t n_126818 = end_126817 - start_126816;
        
        for (int64_t SegRed_i_126819 = start_126816; SegRed_i_126819 < start_126816 + n_126818; SegRed_i_126819++) {
            int64_t gtid_121558 = SegRed_i_126819;
            double x_121583 = ((double *) ext_mem_112553.mem)[gtid_121510 * m_33388 + gtid_121558];
            double eta_p_121584 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + gtid_121558];
            double defunc_0_reduce_res_121585;
            int64_t flat_tid_121586 = (int64_t) 0;
            
            defunc_0_reduce_res_121585 = 0.0;
            
            struct futhark_mc_task_129184 futhark_mc_task_129184_;
            
            futhark_mc_task_129184_.ctx = ctx;
            futhark_mc_task_129184_.free_m_33388 = m_33388;
            futhark_mc_task_129184_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
            futhark_mc_task_129184_.free_mem_111727 = mem_111727.mem;
            futhark_mc_task_129184_.free_mem_121527 = mem_121527.mem;
            futhark_mc_task_129184_.free_gtid_121558 = gtid_121558;
            futhark_mc_task_129184_.free_flat_tid_121586 = flat_tid_121586;
            futhark_mc_task_129184_.retval_defunc_0_reduce_res_121585 = (double *) &defunc_0_reduce_res_121585;
            #if ISPC
            futhark_mc_task_129184_.retval_defunc_0_reduce_res_121585 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_129184_task;
            
            futhark_mc_task_129184_task.args = &futhark_mc_task_129184_;
            futhark_mc_task_129184_task.top_level_fn = futhark_mc_segred_task_129185;
            futhark_mc_task_129184_task.name = "futhark_mc_segred_task_129185";
            futhark_mc_task_129184_task.iterations = m_33388;
            futhark_mc_task_129184_task.task_time = &ctx->program->futhark_mc_segred_task_129185_total_time;
            futhark_mc_task_129184_task.task_iter = &ctx->program->futhark_mc_segred_task_129185_total_iter;
            futhark_mc_task_129184_task.sched = STATIC;
            futhark_mc_task_129184_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_129185_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_129184_task);
            
            if (futhark_mc_segred_task_129185_err != 0) {
                err = futhark_mc_segred_task_129185_err;
                goto cleanup;
            }
            
            double zt_res_121594 = x_121583 * defunc_0_reduce_res_121585;
            double zt_res_121595 = eta_p_121526 * eta_p_121584;
            bool zeze_res_121596 = x_121583 == 0.0;
            double klu_res_121597;
            
            if (zeze_res_121596) {
                klu_res_121597 = 0.0;
            } else {
                double zs_res_121598 = x_121583 / zt_res_121595;
                double log_res_121599 = futrts_log64(zs_res_121598);
                double zt_res_121600 = x_121583 * log_res_121599;
                
                klu_res_121597 = zt_res_121600;
            }
            
            double klu_res_121601;
            
            if (zeze_res_121596) {
                klu_res_121601 = 0.0;
            } else {
                double zs_res_121602 = x_121583 / zt_res_121595;
                double log_res_121603 = futrts_log64(zs_res_121602);
                double zt_res_121604 = x_121583 * log_res_121603;
                
                klu_res_121601 = zt_res_121604;
            }
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_121559 = local_acc_126808;
            }
            // Load next params
            {
                eta_p_121560 = x_121583;
            }
            // SegRed body
            {
                double zp_res_121561 = eta_p_121559 + eta_p_121560;
                
                local_acc_126808 = zp_res_121561;
            }
            // Load accum params
            {
                eta_p_121562 = local_acc_126809;
            }
            // Load next params
            {
                eta_p_121563 = zt_res_121594;
            }
            // SegRed body
            {
                double zp_res_121564 = eta_p_121562 + eta_p_121563;
                
                local_acc_126809 = zp_res_121564;
            }
            // Load accum params
            {
                eta_p_121565 = local_acc_126810;
            }
            // Load next params
            {
                eta_p_121566 = x_121583;
            }
            // SegRed body
            {
                double zp_res_121567 = eta_p_121565 + eta_p_121566;
                
                local_acc_126810 = zp_res_121567;
            }
            // Load accum params
            {
                eta_p_121568 = local_acc_126811;
            }
            // Load next params
            {
                eta_p_121569 = x_121583;
            }
            // SegRed body
            {
                double zp_res_121570 = eta_p_121568 + eta_p_121569;
                
                local_acc_126811 = zp_res_121570;
            }
            // Load accum params
            {
                eta_p_121571 = local_acc_126812;
            }
            // Load next params
            {
                eta_p_121572 = x_121583;
            }
            // SegRed body
            {
                double zp_res_121573 = eta_p_121571 + eta_p_121572;
                
                local_acc_126812 = zp_res_121573;
            }
            // Load accum params
            {
                eta_p_121574 = local_acc_126813;
            }
            // Load next params
            {
                eta_p_121575 = klu_res_121597;
            }
            // SegRed body
            {
                double zp_res_121576 = eta_p_121574 + eta_p_121575;
                
                local_acc_126813 = zp_res_121576;
            }
            // Load accum params
            {
                eta_p_121577 = local_acc_126814;
            }
            // Load next params
            {
                eta_p_121578 = klu_res_121601;
            }
            // SegRed body
            {
                double zp_res_121579 = eta_p_121577 + eta_p_121578;
                
                local_acc_126814 = zp_res_121579;
            }
            // Load accum params
            {
                eta_p_121580 = local_acc_126815;
            }
            // Load next params
            {
                eta_p_121581 = x_121583;
            }
            // SegRed body
            {
                double zp_res_121582 = eta_p_121580 + eta_p_121581;
                
                local_acc_126815 = zp_res_121582;
            }
        }
        
        int64_t uni_i_126837 = 0;
        
        {
            int64_t gtid_121558 = uni_i_126837;
            
            // Load accum params
            {
                eta_p_126776 = local_acc_126800;
            }
            // Load next params
            {
                eta_p_126777 = local_acc_126808;
            }
            // SegRed body
            {
                double zp_res_126778 = eta_p_126776 + eta_p_126777;
                
                local_acc_126800 = zp_res_126778;
            }
            // Load accum params
            {
                eta_p_126779 = local_acc_126801;
            }
            // Load next params
            {
                eta_p_126780 = local_acc_126809;
            }
            // SegRed body
            {
                double zp_res_126781 = eta_p_126779 + eta_p_126780;
                
                local_acc_126801 = zp_res_126781;
            }
            // Load accum params
            {
                eta_p_126782 = local_acc_126802;
            }
            // Load next params
            {
                eta_p_126783 = local_acc_126810;
            }
            // SegRed body
            {
                double zp_res_126784 = eta_p_126782 + eta_p_126783;
                
                local_acc_126802 = zp_res_126784;
            }
            // Load accum params
            {
                eta_p_126785 = local_acc_126803;
            }
            // Load next params
            {
                eta_p_126786 = local_acc_126811;
            }
            // SegRed body
            {
                double zp_res_126787 = eta_p_126785 + eta_p_126786;
                
                local_acc_126803 = zp_res_126787;
            }
            // Load accum params
            {
                eta_p_126788 = local_acc_126804;
            }
            // Load next params
            {
                eta_p_126789 = local_acc_126812;
            }
            // SegRed body
            {
                double zp_res_126790 = eta_p_126788 + eta_p_126789;
                
                local_acc_126804 = zp_res_126790;
            }
            // Load accum params
            {
                eta_p_126791 = local_acc_126805;
            }
            // Load next params
            {
                eta_p_126792 = local_acc_126813;
            }
            // SegRed body
            {
                double zp_res_126793 = eta_p_126791 + eta_p_126792;
                
                local_acc_126805 = zp_res_126793;
            }
            // Load accum params
            {
                eta_p_126794 = local_acc_126806;
            }
            // Load next params
            {
                eta_p_126795 = local_acc_126814;
            }
            // SegRed body
            {
                double zp_res_126796 = eta_p_126794 + eta_p_126795;
                
                local_acc_126806 = zp_res_126796;
            }
            // Load accum params
            {
                eta_p_126797 = local_acc_126807;
            }
            // Load next params
            {
                eta_p_126798 = local_acc_126815;
            }
            // SegRed body
            {
                double zp_res_126799 = eta_p_126797 + eta_p_126798;
                
                local_acc_126807 = zp_res_126799;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_126760.mem)[flat_tid_121557] = local_acc_126800;
        ((double *) reduce_stage_1_tid_res_arr_mem_126762.mem)[flat_tid_121557] = local_acc_126801;
        ((double *) reduce_stage_1_tid_res_arr_mem_126764.mem)[flat_tid_121557] = local_acc_126802;
        ((double *) reduce_stage_1_tid_res_arr_mem_126766.mem)[flat_tid_121557] = local_acc_126803;
        ((double *) reduce_stage_1_tid_res_arr_mem_126768.mem)[flat_tid_121557] = local_acc_126804;
        ((double *) reduce_stage_1_tid_res_arr_mem_126770.mem)[flat_tid_121557] = local_acc_126805;
        ((double *) reduce_stage_1_tid_res_arr_mem_126772.mem)[flat_tid_121557] = local_acc_126806;
        ((double *) reduce_stage_1_tid_res_arr_mem_126774.mem)[flat_tid_121557] = local_acc_126807;
    }
    
  cleanup:
    { }
    if (event_129192 != NULL) {
        event_129192->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129183", strdup("nothing further"), event_129192, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_129173(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129158 *futhark_mc_task_129158 = (struct futhark_mc_task_129158 *) args;
    struct futhark_context *ctx = futhark_mc_task_129158->ctx;
    struct mc_event *event_129194 = mc_event_new(ctx);
    
    if (event_129194 != NULL)
        event_129194->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129158->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_129158->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_129158->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_111727 = {.desc ="mem_111727", .mem =futhark_mc_task_129158->free_mem_111727, .size =0, .references =NULL};
    struct memblock ext_mem_112553 = {.desc ="ext_mem_112553", .mem =futhark_mc_task_129158->free_ext_mem_112553, .size =0, .references =NULL};
    int64_t gtid_121510 = futhark_mc_task_129158->free_gtid_121510;
    double eta_p_121526 = futhark_mc_task_129158->free_eta_p_121526;
    struct memblock mem_121527 = {.desc ="mem_121527", .mem =futhark_mc_task_129158->free_mem_121527, .size =0, .references =NULL};
    int64_t flat_tid_121557 = futhark_mc_task_129158->free_flat_tid_121557;
    int64_t flat_tid_121605 = futhark_mc_task_129158->free_flat_tid_121605;
    double defunc_res_121549 = *futhark_mc_task_129158->retval_defunc_res_121549;
    double defunc_0_reduce_res_121550 = *futhark_mc_task_129158->retval_defunc_0_reduce_res_121550;
    double defunc_res_121551 = *futhark_mc_task_129158->retval_defunc_res_121551;
    double defunc_res_121552 = *futhark_mc_task_129158->retval_defunc_res_121552;
    double defunc_res_121553 = *futhark_mc_task_129158->retval_defunc_res_121553;
    double defunc_res_121554 = *futhark_mc_task_129158->retval_defunc_res_121554;
    double defunc_res_121555 = *futhark_mc_task_129158->retval_defunc_res_121555;
    double defunc_res_121556 = *futhark_mc_task_129158->retval_defunc_res_121556;
    int64_t reduce_stage_1_tid_res_arr_mem_126760_cached_sizze_129174 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126760 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_126762_cached_sizze_129175 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126762 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_126764_cached_sizze_129176 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126764 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_126766_cached_sizze_129177 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126766 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_126768_cached_sizze_129178 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126768 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_126770_cached_sizze_129179 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126770 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_126772_cached_sizze_129180 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126772 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_126774_cached_sizze_129181 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126774 = NULL;
    int32_t nsubtasks_126759;
    
    nsubtasks_126759 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_126760_cached_sizze_129174 < (int64_t) 8 * nsubtasks_126759) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126760, &reduce_stage_1_tid_res_arr_mem_126760_cached_sizze_129174, (int64_t) 8 * nsubtasks_126759);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_126762_cached_sizze_129175 < (int64_t) 8 * nsubtasks_126759) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126762, &reduce_stage_1_tid_res_arr_mem_126762_cached_sizze_129175, (int64_t) 8 * nsubtasks_126759);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_126764_cached_sizze_129176 < (int64_t) 8 * nsubtasks_126759) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126764, &reduce_stage_1_tid_res_arr_mem_126764_cached_sizze_129176, (int64_t) 8 * nsubtasks_126759);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_126766_cached_sizze_129177 < (int64_t) 8 * nsubtasks_126759) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126766, &reduce_stage_1_tid_res_arr_mem_126766_cached_sizze_129177, (int64_t) 8 * nsubtasks_126759);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_126768_cached_sizze_129178 < (int64_t) 8 * nsubtasks_126759) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126768, &reduce_stage_1_tid_res_arr_mem_126768_cached_sizze_129178, (int64_t) 8 * nsubtasks_126759);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_126770_cached_sizze_129179 < (int64_t) 8 * nsubtasks_126759) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126770, &reduce_stage_1_tid_res_arr_mem_126770_cached_sizze_129179, (int64_t) 8 * nsubtasks_126759);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_126772_cached_sizze_129180 < (int64_t) 8 * nsubtasks_126759) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126772, &reduce_stage_1_tid_res_arr_mem_126772_cached_sizze_129180, (int64_t) 8 * nsubtasks_126759);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_126774_cached_sizze_129181 < (int64_t) 8 * nsubtasks_126759) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126774, &reduce_stage_1_tid_res_arr_mem_126774_cached_sizze_129181, (int64_t) 8 * nsubtasks_126759);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_129182 futhark_mc_segred_stage_1_parloop_struct_129182_;
    
    futhark_mc_segred_stage_1_parloop_struct_129182_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_129182_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_129182_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_129182_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_129182_.free_mem_111727 = mem_111727.mem;
    futhark_mc_segred_stage_1_parloop_struct_129182_.free_ext_mem_112553 = ext_mem_112553.mem;
    futhark_mc_segred_stage_1_parloop_struct_129182_.free_gtid_121510 = gtid_121510;
    futhark_mc_segred_stage_1_parloop_struct_129182_.free_eta_p_121526 = eta_p_121526;
    futhark_mc_segred_stage_1_parloop_struct_129182_.free_mem_121527 = mem_121527.mem;
    futhark_mc_segred_stage_1_parloop_struct_129182_.free_reduce_stage_1_tid_res_arr_mem_126760 = reduce_stage_1_tid_res_arr_mem_126760;
    futhark_mc_segred_stage_1_parloop_struct_129182_.free_reduce_stage_1_tid_res_arr_mem_126762 = reduce_stage_1_tid_res_arr_mem_126762;
    futhark_mc_segred_stage_1_parloop_struct_129182_.free_reduce_stage_1_tid_res_arr_mem_126764 = reduce_stage_1_tid_res_arr_mem_126764;
    futhark_mc_segred_stage_1_parloop_struct_129182_.free_reduce_stage_1_tid_res_arr_mem_126766 = reduce_stage_1_tid_res_arr_mem_126766;
    futhark_mc_segred_stage_1_parloop_struct_129182_.free_reduce_stage_1_tid_res_arr_mem_126768 = reduce_stage_1_tid_res_arr_mem_126768;
    futhark_mc_segred_stage_1_parloop_struct_129182_.free_reduce_stage_1_tid_res_arr_mem_126770 = reduce_stage_1_tid_res_arr_mem_126770;
    futhark_mc_segred_stage_1_parloop_struct_129182_.free_reduce_stage_1_tid_res_arr_mem_126772 = reduce_stage_1_tid_res_arr_mem_126772;
    futhark_mc_segred_stage_1_parloop_struct_129182_.free_reduce_stage_1_tid_res_arr_mem_126774 = reduce_stage_1_tid_res_arr_mem_126774;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_129183_task;
    
    futhark_mc_segred_stage_1_parloop_129183_task.name = "futhark_mc_segred_stage_1_parloop_129183";
    futhark_mc_segred_stage_1_parloop_129183_task.fn = futhark_mc_segred_stage_1_parloop_129183;
    futhark_mc_segred_stage_1_parloop_129183_task.args = &futhark_mc_segred_stage_1_parloop_struct_129182_;
    futhark_mc_segred_stage_1_parloop_129183_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_129183_task.info = info;
    
    struct mc_event *event_129193 = mc_event_new(ctx);
    
    if (event_129193 != NULL)
        event_129193->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_129183_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_129183_task);
    
    if (futhark_mc_segred_stage_1_parloop_129183_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_129183_err;
        goto cleanup;
    }
    if (event_129193 != NULL) {
        event_129193->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129183_total", strdup("nothing further"), event_129193, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_121549 = 0.0;
        defunc_0_reduce_res_121550 = 0.0;
        defunc_res_121551 = 0.0;
        defunc_res_121552 = 0.0;
        defunc_res_121553 = 0.0;
        defunc_res_121554 = 0.0;
        defunc_res_121555 = 0.0;
        defunc_res_121556 = 0.0;
    }
    
    double eta_p_126838;
    double eta_p_126839;
    double eta_p_126841;
    double eta_p_126842;
    double eta_p_126844;
    double eta_p_126845;
    double eta_p_126847;
    double eta_p_126848;
    double eta_p_126850;
    double eta_p_126851;
    double eta_p_126853;
    double eta_p_126854;
    double eta_p_126856;
    double eta_p_126857;
    double eta_p_126859;
    double eta_p_126860;
    
    for (int32_t i_126862 = 0; i_126862 < nsubtasks_126759; i_126862++) {
        flat_tid_121557 = i_126862;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_126838 = defunc_res_121549;
            }
            // load next params
            {
                eta_p_126839 = ((double *) reduce_stage_1_tid_res_arr_mem_126760)[flat_tid_121557];
            }
            // red body
            {
                double zp_res_126840 = eta_p_126838 + eta_p_126839;
                
                defunc_res_121549 = zp_res_126840;
            }
            // load acc params
            {
                eta_p_126841 = defunc_0_reduce_res_121550;
            }
            // load next params
            {
                eta_p_126842 = ((double *) reduce_stage_1_tid_res_arr_mem_126762)[flat_tid_121557];
            }
            // red body
            {
                double zp_res_126843 = eta_p_126841 + eta_p_126842;
                
                defunc_0_reduce_res_121550 = zp_res_126843;
            }
            // load acc params
            {
                eta_p_126844 = defunc_res_121551;
            }
            // load next params
            {
                eta_p_126845 = ((double *) reduce_stage_1_tid_res_arr_mem_126764)[flat_tid_121557];
            }
            // red body
            {
                double zp_res_126846 = eta_p_126844 + eta_p_126845;
                
                defunc_res_121551 = zp_res_126846;
            }
            // load acc params
            {
                eta_p_126847 = defunc_res_121552;
            }
            // load next params
            {
                eta_p_126848 = ((double *) reduce_stage_1_tid_res_arr_mem_126766)[flat_tid_121557];
            }
            // red body
            {
                double zp_res_126849 = eta_p_126847 + eta_p_126848;
                
                defunc_res_121552 = zp_res_126849;
            }
            // load acc params
            {
                eta_p_126850 = defunc_res_121553;
            }
            // load next params
            {
                eta_p_126851 = ((double *) reduce_stage_1_tid_res_arr_mem_126768)[flat_tid_121557];
            }
            // red body
            {
                double zp_res_126852 = eta_p_126850 + eta_p_126851;
                
                defunc_res_121553 = zp_res_126852;
            }
            // load acc params
            {
                eta_p_126853 = defunc_res_121554;
            }
            // load next params
            {
                eta_p_126854 = ((double *) reduce_stage_1_tid_res_arr_mem_126770)[flat_tid_121557];
            }
            // red body
            {
                double zp_res_126855 = eta_p_126853 + eta_p_126854;
                
                defunc_res_121554 = zp_res_126855;
            }
            // load acc params
            {
                eta_p_126856 = defunc_res_121555;
            }
            // load next params
            {
                eta_p_126857 = ((double *) reduce_stage_1_tid_res_arr_mem_126772)[flat_tid_121557];
            }
            // red body
            {
                double zp_res_126858 = eta_p_126856 + eta_p_126857;
                
                defunc_res_121555 = zp_res_126858;
            }
            // load acc params
            {
                eta_p_126859 = defunc_res_121556;
            }
            // load next params
            {
                eta_p_126860 = ((double *) reduce_stage_1_tid_res_arr_mem_126774)[flat_tid_121557];
            }
            // red body
            {
                double zp_res_126861 = eta_p_126859 + eta_p_126860;
                
                defunc_res_121556 = zp_res_126861;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_126760);
        free(reduce_stage_1_tid_res_arr_mem_126762);
        free(reduce_stage_1_tid_res_arr_mem_126764);
        free(reduce_stage_1_tid_res_arr_mem_126766);
        free(reduce_stage_1_tid_res_arr_mem_126768);
        free(reduce_stage_1_tid_res_arr_mem_126770);
        free(reduce_stage_1_tid_res_arr_mem_126772);
        free(reduce_stage_1_tid_res_arr_mem_126774);
    }
    if (event_129194 != NULL) {
        event_129194->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_129173", strdup("nothing further"), event_129194, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_129158->retval_defunc_res_121549 = defunc_res_121549;
        *futhark_mc_task_129158->retval_defunc_0_reduce_res_121550 = defunc_0_reduce_res_121550;
        *futhark_mc_task_129158->retval_defunc_res_121551 = defunc_res_121551;
        *futhark_mc_task_129158->retval_defunc_res_121552 = defunc_res_121552;
        *futhark_mc_task_129158->retval_defunc_res_121553 = defunc_res_121553;
        *futhark_mc_task_129158->retval_defunc_res_121554 = defunc_res_121554;
        *futhark_mc_task_129158->retval_defunc_res_121555 = defunc_res_121555;
        *futhark_mc_task_129158->retval_defunc_res_121556 = defunc_res_121556;
    }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_129135(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_129134 *futhark_mc_segred_stage_1_parloop_struct_129134 = (struct futhark_mc_segred_stage_1_parloop_struct_129134 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_129134->ctx;
    struct mc_event *event_129195 = mc_event_new(ctx);
    
    if (event_129195 != NULL)
        event_129195->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_129134->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_129134->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_129134->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_129134->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_129134->free_distrs_mem_111708, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_segred_stage_1_parloop_struct_129134->free_bytes_111715;
    struct memblock mem_111727 = {.desc ="mem_111727", .mem =futhark_mc_segred_stage_1_parloop_struct_129134->free_mem_111727, .size =0, .references =NULL};
    struct memblock ext_mem_112553 = {.desc ="ext_mem_112553", .mem =futhark_mc_segred_stage_1_parloop_struct_129134->free_ext_mem_112553, .size =0, .references =NULL};
    struct memblock mem_112567 = {.desc ="mem_112567", .mem =futhark_mc_segred_stage_1_parloop_struct_129134->free_mem_112567, .size =0, .references =NULL};
    struct memblock mem_112569 = {.desc ="mem_112569", .mem =futhark_mc_segred_stage_1_parloop_struct_129134->free_mem_112569, .size =0, .references =NULL};
    struct memblock mem_112571 = {.desc ="mem_112571", .mem =futhark_mc_segred_stage_1_parloop_struct_129134->free_mem_112571, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126586 = {.desc ="reduce_stage_1_tid_res_arr_mem_126586", .mem =futhark_mc_segred_stage_1_parloop_struct_129134->free_reduce_stage_1_tid_res_arr_mem_126586, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126588 = {.desc ="reduce_stage_1_tid_res_arr_mem_126588", .mem =futhark_mc_segred_stage_1_parloop_struct_129134->free_reduce_stage_1_tid_res_arr_mem_126588, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126590 = {.desc ="reduce_stage_1_tid_res_arr_mem_126590", .mem =futhark_mc_segred_stage_1_parloop_struct_129134->free_reduce_stage_1_tid_res_arr_mem_126590, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126592 = {.desc ="reduce_stage_1_tid_res_arr_mem_126592", .mem =futhark_mc_segred_stage_1_parloop_struct_129134->free_reduce_stage_1_tid_res_arr_mem_126592, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126594 = {.desc ="reduce_stage_1_tid_res_arr_mem_126594", .mem =futhark_mc_segred_stage_1_parloop_struct_129134->free_reduce_stage_1_tid_res_arr_mem_126594, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t mem_121527_cached_sizze_129136 = 0;
    unsigned char *mem_121527 = NULL;
    int64_t flat_tid_121509;
    
    flat_tid_121509 = subtask_id;
    {
        double eta_p_126596;
        double eta_p_126597;
        double eta_p_126599;
        double eta_p_126600;
        double eta_p_126602;
        double eta_p_126603;
        double eta_p_126605;
        double eta_p_126606;
        double eta_p_126608;
        double eta_p_126609;
        double local_acc_126611 = 0.0;
        double local_acc_126612 = 0.0;
        double local_acc_126613 = 0.0;
        double local_acc_126614 = 0.0;
        double local_acc_126615 = 0.0;
        double eta_p_121511;
        double eta_p_121512;
        double eta_p_121514;
        double eta_p_121515;
        double eta_p_121517;
        double eta_p_121518;
        double eta_p_121520;
        double eta_p_121521;
        double eta_p_121523;
        double eta_p_121524;
        double local_acc_126616 = 0.0;
        double local_acc_126617 = 0.0;
        double local_acc_126618 = 0.0;
        double local_acc_126619 = 0.0;
        double local_acc_126620 = 0.0;
        int64_t start_126621;
        int64_t end_126622;
        
        start_126621 = start;
        end_126622 = end;
        
        int64_t n_126623 = end_126622 - start_126621;
        
        if (mem_121527_cached_sizze_129136 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_121527, &mem_121527_cached_sizze_129136, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        for (int64_t SegRed_i_126624 = start_126621; SegRed_i_126624 < start_126621 + n_126623; SegRed_i_126624++) {
            int64_t gtid_121510 = SegRed_i_126624;
            double eta_p_121526 = ((double *) distrs_mem_111708.mem)[eta_p_106382 * m_33388 + gtid_121510];
            int64_t flat_tid_121540 = (int64_t) 0;
            int64_t flat_tid_121529 = (int64_t) 0;
            struct futhark_mc_task_129137 futhark_mc_task_129137_;
            
            futhark_mc_task_129137_.ctx = ctx;
            futhark_mc_task_129137_.free_m_33388 = m_33388;
            futhark_mc_task_129137_.free_eta_p_106382 = eta_p_106382;
            futhark_mc_task_129137_.free_A_mem_111707 = A_mem_111707.mem;
            futhark_mc_task_129137_.free_ext_mem_112553 = ext_mem_112553.mem;
            futhark_mc_task_129137_.free_gtid_121510 = gtid_121510;
            futhark_mc_task_129137_.free_mem_121527 = mem_121527;
            
            struct scheduler_segop futhark_mc_task_129137_task;
            
            futhark_mc_task_129137_task.args = &futhark_mc_task_129137_;
            futhark_mc_task_129137_task.top_level_fn = futhark_mc_segmap_task_129138;
            futhark_mc_task_129137_task.name = "futhark_mc_segmap_task_129138";
            futhark_mc_task_129137_task.iterations = m_33388;
            futhark_mc_task_129137_task.task_time = &ctx->program->futhark_mc_segmap_task_129138_total_time;
            futhark_mc_task_129137_task.task_iter = &ctx->program->futhark_mc_segmap_task_129138_total_iter;
            futhark_mc_task_129137_task.sched = STATIC;
            futhark_mc_task_129137_task.nested_fn = futhark_mc_segmap_nested_task_129144;
            
            int futhark_mc_segmap_task_129138_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_129137_task);
            
            if (futhark_mc_segmap_task_129138_err != 0) {
                err = futhark_mc_segmap_task_129138_err;
                goto cleanup;
            }
            
            double defunc_res_121549;
            double defunc_0_reduce_res_121550;
            double defunc_res_121551;
            double defunc_res_121552;
            double defunc_res_121553;
            double defunc_res_121554;
            double defunc_res_121555;
            double defunc_res_121556;
            int64_t flat_tid_121605 = (int64_t) 0;
            
            defunc_res_121549 = 0.0;
            defunc_0_reduce_res_121550 = 0.0;
            defunc_res_121551 = 0.0;
            defunc_res_121552 = 0.0;
            defunc_res_121553 = 0.0;
            defunc_res_121554 = 0.0;
            defunc_res_121555 = 0.0;
            defunc_res_121556 = 0.0;
            
            int64_t flat_tid_121557 = (int64_t) 0;
            struct futhark_mc_task_129158 futhark_mc_task_129158_;
            
            futhark_mc_task_129158_.ctx = ctx;
            futhark_mc_task_129158_.free_m_33388 = m_33388;
            futhark_mc_task_129158_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
            futhark_mc_task_129158_.free_distrs_mem_111708 = distrs_mem_111708.mem;
            futhark_mc_task_129158_.free_mem_111727 = mem_111727.mem;
            futhark_mc_task_129158_.free_ext_mem_112553 = ext_mem_112553.mem;
            futhark_mc_task_129158_.free_gtid_121510 = gtid_121510;
            futhark_mc_task_129158_.free_eta_p_121526 = eta_p_121526;
            futhark_mc_task_129158_.free_mem_121527 = mem_121527;
            futhark_mc_task_129158_.free_flat_tid_121557 = flat_tid_121557;
            futhark_mc_task_129158_.free_flat_tid_121605 = flat_tid_121605;
            futhark_mc_task_129158_.retval_defunc_res_121549 = (double *) &defunc_res_121549;
            #if ISPC
            futhark_mc_task_129158_.retval_defunc_res_121549 += programIndex;
            #endif
            futhark_mc_task_129158_.retval_defunc_0_reduce_res_121550 = (double *) &defunc_0_reduce_res_121550;
            #if ISPC
            futhark_mc_task_129158_.retval_defunc_0_reduce_res_121550 += programIndex;
            #endif
            futhark_mc_task_129158_.retval_defunc_res_121551 = (double *) &defunc_res_121551;
            #if ISPC
            futhark_mc_task_129158_.retval_defunc_res_121551 += programIndex;
            #endif
            futhark_mc_task_129158_.retval_defunc_res_121552 = (double *) &defunc_res_121552;
            #if ISPC
            futhark_mc_task_129158_.retval_defunc_res_121552 += programIndex;
            #endif
            futhark_mc_task_129158_.retval_defunc_res_121553 = (double *) &defunc_res_121553;
            #if ISPC
            futhark_mc_task_129158_.retval_defunc_res_121553 += programIndex;
            #endif
            futhark_mc_task_129158_.retval_defunc_res_121554 = (double *) &defunc_res_121554;
            #if ISPC
            futhark_mc_task_129158_.retval_defunc_res_121554 += programIndex;
            #endif
            futhark_mc_task_129158_.retval_defunc_res_121555 = (double *) &defunc_res_121555;
            #if ISPC
            futhark_mc_task_129158_.retval_defunc_res_121555 += programIndex;
            #endif
            futhark_mc_task_129158_.retval_defunc_res_121556 = (double *) &defunc_res_121556;
            #if ISPC
            futhark_mc_task_129158_.retval_defunc_res_121556 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_129158_task;
            
            futhark_mc_task_129158_task.args = &futhark_mc_task_129158_;
            futhark_mc_task_129158_task.top_level_fn = futhark_mc_segred_task_129159;
            futhark_mc_task_129158_task.name = "futhark_mc_segred_task_129159";
            futhark_mc_task_129158_task.iterations = m_33388;
            futhark_mc_task_129158_task.task_time = &ctx->program->futhark_mc_segred_task_129159_total_time;
            futhark_mc_task_129158_task.task_iter = &ctx->program->futhark_mc_segred_task_129159_total_iter;
            futhark_mc_task_129158_task.sched = STATIC;
            futhark_mc_task_129158_task.nested_fn = futhark_mc_segred_nested_task_129173;
            
            int futhark_mc_segred_task_129159_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_129158_task);
            
            if (futhark_mc_segred_task_129159_err != 0) {
                err = futhark_mc_segred_task_129159_err;
                goto cleanup;
            }
            // save map-out results
            {
                ((double *) mem_112567.mem)[gtid_121510] = defunc_res_121556;
                ((double *) mem_112569.mem)[gtid_121510] = defunc_res_121551;
                ((double *) mem_112571.mem)[gtid_121510] = defunc_res_121549;
            }
            // Load accum params
            {
                eta_p_121511 = local_acc_126616;
            }
            // Load next params
            {
                eta_p_121512 = defunc_0_reduce_res_121550;
            }
            // SegRed body
            {
                double zp_res_121513 = eta_p_121511 + eta_p_121512;
                
                local_acc_126616 = zp_res_121513;
            }
            // Load accum params
            {
                eta_p_121514 = local_acc_126617;
            }
            // Load next params
            {
                eta_p_121515 = defunc_res_121552;
            }
            // SegRed body
            {
                double zp_res_121516 = eta_p_121514 + eta_p_121515;
                
                local_acc_126617 = zp_res_121516;
            }
            // Load accum params
            {
                eta_p_121517 = local_acc_126618;
            }
            // Load next params
            {
                eta_p_121518 = defunc_res_121553;
            }
            // SegRed body
            {
                double zp_res_121519 = eta_p_121517 + eta_p_121518;
                
                local_acc_126618 = zp_res_121519;
            }
            // Load accum params
            {
                eta_p_121520 = local_acc_126619;
            }
            // Load next params
            {
                eta_p_121521 = defunc_res_121554;
            }
            // SegRed body
            {
                double zp_res_121522 = eta_p_121520 + eta_p_121521;
                
                local_acc_126619 = zp_res_121522;
            }
            // Load accum params
            {
                eta_p_121523 = local_acc_126620;
            }
            // Load next params
            {
                eta_p_121524 = defunc_res_121555;
            }
            // SegRed body
            {
                double zp_res_121525 = eta_p_121523 + eta_p_121524;
                
                local_acc_126620 = zp_res_121525;
            }
        }
        
        int64_t uni_i_126863 = 0;
        
        {
            int64_t gtid_121510 = uni_i_126863;
            
            // Load accum params
            {
                eta_p_126596 = local_acc_126611;
            }
            // Load next params
            {
                eta_p_126597 = local_acc_126616;
            }
            // SegRed body
            {
                double zp_res_126598 = eta_p_126596 + eta_p_126597;
                
                local_acc_126611 = zp_res_126598;
            }
            // Load accum params
            {
                eta_p_126599 = local_acc_126612;
            }
            // Load next params
            {
                eta_p_126600 = local_acc_126617;
            }
            // SegRed body
            {
                double zp_res_126601 = eta_p_126599 + eta_p_126600;
                
                local_acc_126612 = zp_res_126601;
            }
            // Load accum params
            {
                eta_p_126602 = local_acc_126613;
            }
            // Load next params
            {
                eta_p_126603 = local_acc_126618;
            }
            // SegRed body
            {
                double zp_res_126604 = eta_p_126602 + eta_p_126603;
                
                local_acc_126613 = zp_res_126604;
            }
            // Load accum params
            {
                eta_p_126605 = local_acc_126614;
            }
            // Load next params
            {
                eta_p_126606 = local_acc_126619;
            }
            // SegRed body
            {
                double zp_res_126607 = eta_p_126605 + eta_p_126606;
                
                local_acc_126614 = zp_res_126607;
            }
            // Load accum params
            {
                eta_p_126608 = local_acc_126615;
            }
            // Load next params
            {
                eta_p_126609 = local_acc_126620;
            }
            // SegRed body
            {
                double zp_res_126610 = eta_p_126608 + eta_p_126609;
                
                local_acc_126615 = zp_res_126610;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_126586.mem)[flat_tid_121509] = local_acc_126611;
        ((double *) reduce_stage_1_tid_res_arr_mem_126588.mem)[flat_tid_121509] = local_acc_126612;
        ((double *) reduce_stage_1_tid_res_arr_mem_126590.mem)[flat_tid_121509] = local_acc_126613;
        ((double *) reduce_stage_1_tid_res_arr_mem_126592.mem)[flat_tid_121509] = local_acc_126614;
        ((double *) reduce_stage_1_tid_res_arr_mem_126594.mem)[flat_tid_121509] = local_acc_126615;
    }
    
  cleanup:
    {
        free(mem_121527);
    }
    if (event_129195 != NULL) {
        event_129195->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129135", strdup("nothing further"), event_129195, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_129128(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129115 *futhark_mc_task_129115 = (struct futhark_mc_task_129115 *) args;
    struct futhark_context *ctx = futhark_mc_task_129115->ctx;
    struct mc_event *event_129197 = mc_event_new(ctx);
    
    if (event_129197 != NULL)
        event_129197->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129115->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_129115->free_eta_p_106382;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_129115->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_129115->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_129115->free_distrs_mem_111708, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_task_129115->free_bytes_111715;
    struct memblock mem_111727 = {.desc ="mem_111727", .mem =futhark_mc_task_129115->free_mem_111727, .size =0, .references =NULL};
    struct memblock ext_mem_112553 = {.desc ="ext_mem_112553", .mem =futhark_mc_task_129115->free_ext_mem_112553, .size =0, .references =NULL};
    int64_t flat_tid_121509 = futhark_mc_task_129115->free_flat_tid_121509;
    int64_t flat_tid_121651 = futhark_mc_task_129115->free_flat_tid_121651;
    double defunc_res_110023 = *futhark_mc_task_129115->retval_defunc_res_110023;
    double defunc_res_110024 = *futhark_mc_task_129115->retval_defunc_res_110024;
    double defunc_res_110025 = *futhark_mc_task_129115->retval_defunc_res_110025;
    double defunc_res_110026 = *futhark_mc_task_129115->retval_defunc_res_110026;
    double defunc_res_110027 = *futhark_mc_task_129115->retval_defunc_res_110027;
    struct memblock mem_112567 = {.desc ="mem_112567", .mem =futhark_mc_task_129115->retval_mem_112567, .size =0, .references =NULL};
    struct memblock mem_112569 = {.desc ="mem_112569", .mem =futhark_mc_task_129115->retval_mem_112569, .size =0, .references =NULL};
    struct memblock mem_112571 = {.desc ="mem_112571", .mem =futhark_mc_task_129115->retval_mem_112571, .size =0, .references =NULL};
    int64_t reduce_stage_1_tid_res_arr_mem_126586_cached_sizze_129129 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126586 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_126588_cached_sizze_129130 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126588 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_126590_cached_sizze_129131 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126590 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_126592_cached_sizze_129132 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126592 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_126594_cached_sizze_129133 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126594 = NULL;
    int32_t nsubtasks_126585;
    
    nsubtasks_126585 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_126586_cached_sizze_129129 < (int64_t) 8 * nsubtasks_126585) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126586, &reduce_stage_1_tid_res_arr_mem_126586_cached_sizze_129129, (int64_t) 8 * nsubtasks_126585);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_126588_cached_sizze_129130 < (int64_t) 8 * nsubtasks_126585) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126588, &reduce_stage_1_tid_res_arr_mem_126588_cached_sizze_129130, (int64_t) 8 * nsubtasks_126585);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_126590_cached_sizze_129131 < (int64_t) 8 * nsubtasks_126585) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126590, &reduce_stage_1_tid_res_arr_mem_126590_cached_sizze_129131, (int64_t) 8 * nsubtasks_126585);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_126592_cached_sizze_129132 < (int64_t) 8 * nsubtasks_126585) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126592, &reduce_stage_1_tid_res_arr_mem_126592_cached_sizze_129132, (int64_t) 8 * nsubtasks_126585);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_126594_cached_sizze_129133 < (int64_t) 8 * nsubtasks_126585) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126594, &reduce_stage_1_tid_res_arr_mem_126594_cached_sizze_129133, (int64_t) 8 * nsubtasks_126585);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_129134 futhark_mc_segred_stage_1_parloop_struct_129134_;
    
    futhark_mc_segred_stage_1_parloop_struct_129134_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_129134_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_129134_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_129134_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_129134_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_129134_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_129134_.free_bytes_111715 = bytes_111715;
    futhark_mc_segred_stage_1_parloop_struct_129134_.free_mem_111727 = mem_111727.mem;
    futhark_mc_segred_stage_1_parloop_struct_129134_.free_ext_mem_112553 = ext_mem_112553.mem;
    futhark_mc_segred_stage_1_parloop_struct_129134_.free_mem_112567 = mem_112567.mem;
    futhark_mc_segred_stage_1_parloop_struct_129134_.free_mem_112569 = mem_112569.mem;
    futhark_mc_segred_stage_1_parloop_struct_129134_.free_mem_112571 = mem_112571.mem;
    futhark_mc_segred_stage_1_parloop_struct_129134_.free_reduce_stage_1_tid_res_arr_mem_126586 = reduce_stage_1_tid_res_arr_mem_126586;
    futhark_mc_segred_stage_1_parloop_struct_129134_.free_reduce_stage_1_tid_res_arr_mem_126588 = reduce_stage_1_tid_res_arr_mem_126588;
    futhark_mc_segred_stage_1_parloop_struct_129134_.free_reduce_stage_1_tid_res_arr_mem_126590 = reduce_stage_1_tid_res_arr_mem_126590;
    futhark_mc_segred_stage_1_parloop_struct_129134_.free_reduce_stage_1_tid_res_arr_mem_126592 = reduce_stage_1_tid_res_arr_mem_126592;
    futhark_mc_segred_stage_1_parloop_struct_129134_.free_reduce_stage_1_tid_res_arr_mem_126594 = reduce_stage_1_tid_res_arr_mem_126594;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_129135_task;
    
    futhark_mc_segred_stage_1_parloop_129135_task.name = "futhark_mc_segred_stage_1_parloop_129135";
    futhark_mc_segred_stage_1_parloop_129135_task.fn = futhark_mc_segred_stage_1_parloop_129135;
    futhark_mc_segred_stage_1_parloop_129135_task.args = &futhark_mc_segred_stage_1_parloop_struct_129134_;
    futhark_mc_segred_stage_1_parloop_129135_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_129135_task.info = info;
    
    struct mc_event *event_129196 = mc_event_new(ctx);
    
    if (event_129196 != NULL)
        event_129196->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_129135_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_129135_task);
    
    if (futhark_mc_segred_stage_1_parloop_129135_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_129135_err;
        goto cleanup;
    }
    if (event_129196 != NULL) {
        event_129196->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129135_total", strdup("nothing further"), event_129196, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_110023 = 0.0;
        defunc_res_110024 = 0.0;
        defunc_res_110025 = 0.0;
        defunc_res_110026 = 0.0;
        defunc_res_110027 = 0.0;
    }
    
    double eta_p_126864;
    double eta_p_126865;
    double eta_p_126867;
    double eta_p_126868;
    double eta_p_126870;
    double eta_p_126871;
    double eta_p_126873;
    double eta_p_126874;
    double eta_p_126876;
    double eta_p_126877;
    
    for (int32_t i_126879 = 0; i_126879 < nsubtasks_126585; i_126879++) {
        flat_tid_121509 = i_126879;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_126864 = defunc_res_110023;
            }
            // load next params
            {
                eta_p_126865 = ((double *) reduce_stage_1_tid_res_arr_mem_126586)[flat_tid_121509];
            }
            // red body
            {
                double zp_res_126866 = eta_p_126864 + eta_p_126865;
                
                defunc_res_110023 = zp_res_126866;
            }
            // load acc params
            {
                eta_p_126867 = defunc_res_110024;
            }
            // load next params
            {
                eta_p_126868 = ((double *) reduce_stage_1_tid_res_arr_mem_126588)[flat_tid_121509];
            }
            // red body
            {
                double zp_res_126869 = eta_p_126867 + eta_p_126868;
                
                defunc_res_110024 = zp_res_126869;
            }
            // load acc params
            {
                eta_p_126870 = defunc_res_110025;
            }
            // load next params
            {
                eta_p_126871 = ((double *) reduce_stage_1_tid_res_arr_mem_126590)[flat_tid_121509];
            }
            // red body
            {
                double zp_res_126872 = eta_p_126870 + eta_p_126871;
                
                defunc_res_110025 = zp_res_126872;
            }
            // load acc params
            {
                eta_p_126873 = defunc_res_110026;
            }
            // load next params
            {
                eta_p_126874 = ((double *) reduce_stage_1_tid_res_arr_mem_126592)[flat_tid_121509];
            }
            // red body
            {
                double zp_res_126875 = eta_p_126873 + eta_p_126874;
                
                defunc_res_110026 = zp_res_126875;
            }
            // load acc params
            {
                eta_p_126876 = defunc_res_110027;
            }
            // load next params
            {
                eta_p_126877 = ((double *) reduce_stage_1_tid_res_arr_mem_126594)[flat_tid_121509];
            }
            // red body
            {
                double zp_res_126878 = eta_p_126876 + eta_p_126877;
                
                defunc_res_110027 = zp_res_126878;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_126586);
        free(reduce_stage_1_tid_res_arr_mem_126588);
        free(reduce_stage_1_tid_res_arr_mem_126590);
        free(reduce_stage_1_tid_res_arr_mem_126592);
        free(reduce_stage_1_tid_res_arr_mem_126594);
    }
    if (event_129197 != NULL) {
        event_129197->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_129128", strdup("nothing further"), event_129197, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_129115->retval_defunc_res_110023 = defunc_res_110023;
        *futhark_mc_task_129115->retval_defunc_res_110024 = defunc_res_110024;
        *futhark_mc_task_129115->retval_defunc_res_110025 = defunc_res_110025;
        *futhark_mc_task_129115->retval_defunc_res_110026 = defunc_res_110026;
        *futhark_mc_task_129115->retval_defunc_res_110027 = defunc_res_110027;
        futhark_mc_task_129115->retval_mem_112567 = mem_112567.mem;
        futhark_mc_task_129115->retval_mem_112569 = mem_112569.mem;
        futhark_mc_task_129115->retval_mem_112571 = mem_112571.mem;
    }
    return err;
}
struct futhark_mc_task_129198 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_ext_mem_112553;
    unsigned char *free_mem_112573;
    unsigned char *free_mem_112575;
    unsigned char *free_mem_112577;
};
struct futhark_mc_segmap_parloop_struct_129200 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_ext_mem_112553;
    unsigned char *free_mem_112573;
    unsigned char *free_mem_112575;
    unsigned char *free_mem_112577;
};
static int futhark_mc_segmap_parloop_129201(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_129200 *futhark_mc_segmap_parloop_struct_129200 = (struct futhark_mc_segmap_parloop_struct_129200 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_129200->ctx;
    struct mc_event *event_129202 = mc_event_new(ctx);
    
    if (event_129202 != NULL)
        event_129202->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_129200->free_m_33388;
    struct memblock ext_mem_112553 = {.desc ="ext_mem_112553", .mem =futhark_mc_segmap_parloop_struct_129200->free_ext_mem_112553, .size =0, .references =NULL};
    struct memblock mem_112573 = {.desc ="mem_112573", .mem =futhark_mc_segmap_parloop_struct_129200->free_mem_112573, .size =0, .references =NULL};
    struct memblock mem_112575 = {.desc ="mem_112575", .mem =futhark_mc_segmap_parloop_struct_129200->free_mem_112575, .size =0, .references =NULL};
    struct memblock mem_112577 = {.desc ="mem_112577", .mem =futhark_mc_segmap_parloop_struct_129200->free_mem_112577, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121744;
    
    flat_tid_121744 = subtask_id;
    {
        int64_t start_126889;
        int64_t end_126890;
        
        start_126889 = start;
        end_126890 = end;
        
        int64_t n_126891 = end_126890 - start_126889;
        
        for (int64_t SegMap_i_126892 = start_126889; SegMap_i_126892 < start_126889 + n_126891; SegMap_i_126892++) {
            int64_t slice_126893 = m_33388;
            int64_t gtid_121745 = SegMap_i_126892;
            int64_t remnant_126894 = SegMap_i_126892 - gtid_121745;
            double defunc_res_121746;
            double defunc_res_121747;
            double defunc_res_121748;
            double redout_126882;
            double redout_126883;
            double redout_126884;
            
            redout_126882 = 0.0;
            redout_126883 = 0.0;
            redout_126884 = 0.0;
            for (int64_t i_126881 = 0; i_126881 < m_33388; i_126881++) {
                double x_126885 = ((double *) ext_mem_112553.mem)[i_126881 * m_33388 + gtid_121745];
                double zp_res_126886 = x_126885 + redout_126882;
                double zp_res_126887 = x_126885 + redout_126883;
                double zp_res_126888 = x_126885 + redout_126884;
                double redout_tmp_126895 = zp_res_126886;
                double redout_tmp_126896 = zp_res_126887;
                double redout_tmp_126897 = zp_res_126888;
                
                redout_126882 = redout_tmp_126895;
                redout_126883 = redout_tmp_126896;
                redout_126884 = redout_tmp_126897;
            }
            defunc_res_121746 = redout_126882;
            defunc_res_121747 = redout_126883;
            defunc_res_121748 = redout_126884;
            ((double *) mem_112573.mem)[gtid_121745] = defunc_res_121748;
            ((double *) mem_112575.mem)[gtid_121745] = defunc_res_121747;
            ((double *) mem_112577.mem)[gtid_121745] = defunc_res_121746;
        }
    }
    
  cleanup:
    { }
    if (event_129202 != NULL) {
        event_129202->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_129201", strdup("nothing further"), event_129202, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_task_129199(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129198 *futhark_mc_task_129198 = (struct futhark_mc_task_129198 *) args;
    struct futhark_context *ctx = futhark_mc_task_129198->ctx;
    struct mc_event *event_129204 = mc_event_new(ctx);
    
    if (event_129204 != NULL)
        event_129204->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129198->free_m_33388;
    struct memblock ext_mem_112553 = {.desc ="ext_mem_112553", .mem =futhark_mc_task_129198->free_ext_mem_112553, .size =0, .references =NULL};
    struct memblock mem_112573 = {.desc ="mem_112573", .mem =futhark_mc_task_129198->free_mem_112573, .size =0, .references =NULL};
    struct memblock mem_112575 = {.desc ="mem_112575", .mem =futhark_mc_task_129198->free_mem_112575, .size =0, .references =NULL};
    struct memblock mem_112577 = {.desc ="mem_112577", .mem =futhark_mc_task_129198->free_mem_112577, .size =0, .references =NULL};
    int32_t nsubtasks_126880;
    
    nsubtasks_126880 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_129200 futhark_mc_segmap_parloop_struct_129200_;
    
    futhark_mc_segmap_parloop_struct_129200_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_129200_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_129200_.free_ext_mem_112553 = ext_mem_112553.mem;
    futhark_mc_segmap_parloop_struct_129200_.free_mem_112573 = mem_112573.mem;
    futhark_mc_segmap_parloop_struct_129200_.free_mem_112575 = mem_112575.mem;
    futhark_mc_segmap_parloop_struct_129200_.free_mem_112577 = mem_112577.mem;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_129201_task;
    
    futhark_mc_segmap_parloop_129201_task.name = "futhark_mc_segmap_parloop_129201";
    futhark_mc_segmap_parloop_129201_task.fn = futhark_mc_segmap_parloop_129201;
    futhark_mc_segmap_parloop_129201_task.args = &futhark_mc_segmap_parloop_struct_129200_;
    futhark_mc_segmap_parloop_129201_task.iterations = iterations;
    futhark_mc_segmap_parloop_129201_task.info = info;
    
    struct mc_event *event_129203 = mc_event_new(ctx);
    
    if (event_129203 != NULL)
        event_129203->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_129201_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_129201_task);
    
    if (futhark_mc_segmap_parloop_129201_err != 0) {
        err = futhark_mc_segmap_parloop_129201_err;
        goto cleanup;
    }
    if (event_129203 != NULL) {
        event_129203->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_129201_total", strdup("nothing further"), event_129203, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_129204 != NULL) {
        event_129204->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_task_129199", strdup("nothing further"), event_129204, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_segmap_parloop_struct_129206 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_ext_mem_112553;
    unsigned char *free_mem_112573;
    unsigned char *free_mem_112575;
    unsigned char *free_mem_112577;
};
struct futhark_mc_task_129208 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_ext_mem_112553;
    int64_t free_gtid_121728;
    int64_t free_flat_tid_126899;
    double *retval_defunc_res_121729;
    double *retval_defunc_res_121730;
    double *retval_defunc_res_121731;
};
struct futhark_mc_segred_stage_1_parloop_struct_129213 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    unsigned char *free_ext_mem_112553;
    int64_t free_gtid_121728;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126918;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126920;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126922;
};
static int futhark_mc_segred_stage_1_parloop_129214(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_129213 *futhark_mc_segred_stage_1_parloop_struct_129213 = (struct futhark_mc_segred_stage_1_parloop_struct_129213 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_129213->ctx;
    struct mc_event *event_129215 = mc_event_new(ctx);
    
    if (event_129215 != NULL)
        event_129215->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_129213->free_m_33388;
    struct memblock ext_mem_112553 = {.desc ="ext_mem_112553", .mem =futhark_mc_segred_stage_1_parloop_struct_129213->free_ext_mem_112553, .size =0, .references =NULL};
    int64_t gtid_121728 = futhark_mc_segred_stage_1_parloop_struct_129213->free_gtid_121728;
    struct memblock reduce_stage_1_tid_res_arr_mem_126918 = {.desc ="reduce_stage_1_tid_res_arr_mem_126918", .mem =futhark_mc_segred_stage_1_parloop_struct_129213->free_reduce_stage_1_tid_res_arr_mem_126918, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126920 = {.desc ="reduce_stage_1_tid_res_arr_mem_126920", .mem =futhark_mc_segred_stage_1_parloop_struct_129213->free_reduce_stage_1_tid_res_arr_mem_126920, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126922 = {.desc ="reduce_stage_1_tid_res_arr_mem_126922", .mem =futhark_mc_segred_stage_1_parloop_struct_129213->free_reduce_stage_1_tid_res_arr_mem_126922, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_126899;
    
    flat_tid_126899 = subtask_id;
    {
        double eta_p_126924;
        double eta_p_126925;
        double eta_p_126927;
        double eta_p_126928;
        double eta_p_126930;
        double eta_p_126931;
        double local_acc_126933 = 0.0;
        double local_acc_126934 = 0.0;
        double local_acc_126935 = 0.0;
        double eta_p_126901;
        double eta_p_126902;
        double eta_p_126904;
        double eta_p_126905;
        double eta_p_126907;
        double eta_p_126908;
        double local_acc_126936 = 0.0;
        double local_acc_126937 = 0.0;
        double local_acc_126938 = 0.0;
        int64_t start_126939;
        int64_t end_126940;
        
        start_126939 = start;
        end_126940 = end;
        
        int64_t n_126941 = end_126940 - start_126939;
        
        for (int64_t SegRed_i_126942 = start_126939; SegRed_i_126942 < start_126939 + n_126941; SegRed_i_126942++) {
            int64_t gtid_126900 = SegRed_i_126942;
            double x_126910 = ((double *) ext_mem_112553.mem)[gtid_126900 * m_33388 + gtid_121728];
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_126901 = local_acc_126936;
            }
            // Load next params
            {
                eta_p_126902 = x_126910;
            }
            // SegRed body
            {
                double zp_res_126903 = eta_p_126901 + eta_p_126902;
                
                local_acc_126936 = zp_res_126903;
            }
            // Load accum params
            {
                eta_p_126904 = local_acc_126937;
            }
            // Load next params
            {
                eta_p_126905 = x_126910;
            }
            // SegRed body
            {
                double zp_res_126906 = eta_p_126904 + eta_p_126905;
                
                local_acc_126937 = zp_res_126906;
            }
            // Load accum params
            {
                eta_p_126907 = local_acc_126938;
            }
            // Load next params
            {
                eta_p_126908 = x_126910;
            }
            // SegRed body
            {
                double zp_res_126909 = eta_p_126907 + eta_p_126908;
                
                local_acc_126938 = zp_res_126909;
            }
        }
        
        int64_t uni_i_126943 = 0;
        
        {
            int64_t gtid_126900 = uni_i_126943;
            
            // Load accum params
            {
                eta_p_126924 = local_acc_126933;
            }
            // Load next params
            {
                eta_p_126925 = local_acc_126936;
            }
            // SegRed body
            {
                double zp_res_126926 = eta_p_126924 + eta_p_126925;
                
                local_acc_126933 = zp_res_126926;
            }
            // Load accum params
            {
                eta_p_126927 = local_acc_126934;
            }
            // Load next params
            {
                eta_p_126928 = local_acc_126937;
            }
            // SegRed body
            {
                double zp_res_126929 = eta_p_126927 + eta_p_126928;
                
                local_acc_126934 = zp_res_126929;
            }
            // Load accum params
            {
                eta_p_126930 = local_acc_126935;
            }
            // Load next params
            {
                eta_p_126931 = local_acc_126938;
            }
            // SegRed body
            {
                double zp_res_126932 = eta_p_126930 + eta_p_126931;
                
                local_acc_126935 = zp_res_126932;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_126918.mem)[flat_tid_126899] = local_acc_126933;
        ((double *) reduce_stage_1_tid_res_arr_mem_126920.mem)[flat_tid_126899] = local_acc_126934;
        ((double *) reduce_stage_1_tid_res_arr_mem_126922.mem)[flat_tid_126899] = local_acc_126935;
    }
    
  cleanup:
    { }
    if (event_129215 != NULL) {
        event_129215->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129214", strdup("nothing further"), event_129215, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_129209(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129208 *futhark_mc_task_129208 = (struct futhark_mc_task_129208 *) args;
    struct futhark_context *ctx = futhark_mc_task_129208->ctx;
    struct mc_event *event_129217 = mc_event_new(ctx);
    
    if (event_129217 != NULL)
        event_129217->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129208->free_m_33388;
    struct memblock ext_mem_112553 = {.desc ="ext_mem_112553", .mem =futhark_mc_task_129208->free_ext_mem_112553, .size =0, .references =NULL};
    int64_t gtid_121728 = futhark_mc_task_129208->free_gtid_121728;
    int64_t flat_tid_126899 = futhark_mc_task_129208->free_flat_tid_126899;
    double defunc_res_121729 = *futhark_mc_task_129208->retval_defunc_res_121729;
    double defunc_res_121730 = *futhark_mc_task_129208->retval_defunc_res_121730;
    double defunc_res_121731 = *futhark_mc_task_129208->retval_defunc_res_121731;
    int64_t reduce_stage_1_tid_res_arr_mem_126918_cached_sizze_129210 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126918 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_126920_cached_sizze_129211 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126920 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_126922_cached_sizze_129212 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126922 = NULL;
    int32_t nsubtasks_126917;
    
    nsubtasks_126917 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_126918_cached_sizze_129210 < (int64_t) 8 * nsubtasks_126917) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126918, &reduce_stage_1_tid_res_arr_mem_126918_cached_sizze_129210, (int64_t) 8 * nsubtasks_126917);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_126920_cached_sizze_129211 < (int64_t) 8 * nsubtasks_126917) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126920, &reduce_stage_1_tid_res_arr_mem_126920_cached_sizze_129211, (int64_t) 8 * nsubtasks_126917);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_126922_cached_sizze_129212 < (int64_t) 8 * nsubtasks_126917) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126922, &reduce_stage_1_tid_res_arr_mem_126922_cached_sizze_129212, (int64_t) 8 * nsubtasks_126917);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_129213 futhark_mc_segred_stage_1_parloop_struct_129213_;
    
    futhark_mc_segred_stage_1_parloop_struct_129213_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_129213_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_129213_.free_ext_mem_112553 = ext_mem_112553.mem;
    futhark_mc_segred_stage_1_parloop_struct_129213_.free_gtid_121728 = gtid_121728;
    futhark_mc_segred_stage_1_parloop_struct_129213_.free_reduce_stage_1_tid_res_arr_mem_126918 = reduce_stage_1_tid_res_arr_mem_126918;
    futhark_mc_segred_stage_1_parloop_struct_129213_.free_reduce_stage_1_tid_res_arr_mem_126920 = reduce_stage_1_tid_res_arr_mem_126920;
    futhark_mc_segred_stage_1_parloop_struct_129213_.free_reduce_stage_1_tid_res_arr_mem_126922 = reduce_stage_1_tid_res_arr_mem_126922;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_129214_task;
    
    futhark_mc_segred_stage_1_parloop_129214_task.name = "futhark_mc_segred_stage_1_parloop_129214";
    futhark_mc_segred_stage_1_parloop_129214_task.fn = futhark_mc_segred_stage_1_parloop_129214;
    futhark_mc_segred_stage_1_parloop_129214_task.args = &futhark_mc_segred_stage_1_parloop_struct_129213_;
    futhark_mc_segred_stage_1_parloop_129214_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_129214_task.info = info;
    
    struct mc_event *event_129216 = mc_event_new(ctx);
    
    if (event_129216 != NULL)
        event_129216->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_129214_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_129214_task);
    
    if (futhark_mc_segred_stage_1_parloop_129214_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_129214_err;
        goto cleanup;
    }
    if (event_129216 != NULL) {
        event_129216->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129214_total", strdup("nothing further"), event_129216, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_121729 = 0.0;
        defunc_res_121730 = 0.0;
        defunc_res_121731 = 0.0;
    }
    
    double eta_p_126944;
    double eta_p_126945;
    double eta_p_126947;
    double eta_p_126948;
    double eta_p_126950;
    double eta_p_126951;
    
    for (int32_t i_126953 = 0; i_126953 < nsubtasks_126917; i_126953++) {
        flat_tid_126899 = i_126953;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_126944 = defunc_res_121729;
            }
            // load next params
            {
                eta_p_126945 = ((double *) reduce_stage_1_tid_res_arr_mem_126918)[flat_tid_126899];
            }
            // red body
            {
                double zp_res_126946 = eta_p_126944 + eta_p_126945;
                
                defunc_res_121729 = zp_res_126946;
            }
            // load acc params
            {
                eta_p_126947 = defunc_res_121730;
            }
            // load next params
            {
                eta_p_126948 = ((double *) reduce_stage_1_tid_res_arr_mem_126920)[flat_tid_126899];
            }
            // red body
            {
                double zp_res_126949 = eta_p_126947 + eta_p_126948;
                
                defunc_res_121730 = zp_res_126949;
            }
            // load acc params
            {
                eta_p_126950 = defunc_res_121731;
            }
            // load next params
            {
                eta_p_126951 = ((double *) reduce_stage_1_tid_res_arr_mem_126922)[flat_tid_126899];
            }
            // red body
            {
                double zp_res_126952 = eta_p_126950 + eta_p_126951;
                
                defunc_res_121731 = zp_res_126952;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_126918);
        free(reduce_stage_1_tid_res_arr_mem_126920);
        free(reduce_stage_1_tid_res_arr_mem_126922);
    }
    if (event_129217 != NULL) {
        event_129217->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_129209", strdup("nothing further"), event_129217, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_129208->retval_defunc_res_121729 = defunc_res_121729;
        *futhark_mc_task_129208->retval_defunc_res_121730 = defunc_res_121730;
        *futhark_mc_task_129208->retval_defunc_res_121731 = defunc_res_121731;
    }
    return err;
}
static int futhark_mc_segmap_parloop_129207(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_129206 *futhark_mc_segmap_parloop_struct_129206 = (struct futhark_mc_segmap_parloop_struct_129206 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_129206->ctx;
    struct mc_event *event_129218 = mc_event_new(ctx);
    
    if (event_129218 != NULL)
        event_129218->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_129206->free_m_33388;
    struct memblock ext_mem_112553 = {.desc ="ext_mem_112553", .mem =futhark_mc_segmap_parloop_struct_129206->free_ext_mem_112553, .size =0, .references =NULL};
    struct memblock mem_112573 = {.desc ="mem_112573", .mem =futhark_mc_segmap_parloop_struct_129206->free_mem_112573, .size =0, .references =NULL};
    struct memblock mem_112575 = {.desc ="mem_112575", .mem =futhark_mc_segmap_parloop_struct_129206->free_mem_112575, .size =0, .references =NULL};
    struct memblock mem_112577 = {.desc ="mem_112577", .mem =futhark_mc_segmap_parloop_struct_129206->free_mem_112577, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121727;
    
    flat_tid_121727 = subtask_id;
    {
        int64_t start_126911;
        int64_t end_126912;
        
        start_126911 = start;
        end_126912 = end;
        
        int64_t n_126913 = end_126912 - start_126911;
        
        for (int64_t SegMap_i_126914 = start_126911; SegMap_i_126914 < start_126911 + n_126913; SegMap_i_126914++) {
            int64_t slice_126915 = m_33388;
            int64_t gtid_121728 = SegMap_i_126914;
            int64_t remnant_126916 = SegMap_i_126914 - gtid_121728;
            double defunc_res_121729;
            double defunc_res_121730;
            double defunc_res_121731;
            int64_t flat_tid_126899 = (int64_t) 0;
            
            defunc_res_121729 = 0.0;
            defunc_res_121730 = 0.0;
            defunc_res_121731 = 0.0;
            
            struct futhark_mc_task_129208 futhark_mc_task_129208_;
            
            futhark_mc_task_129208_.ctx = ctx;
            futhark_mc_task_129208_.free_m_33388 = m_33388;
            futhark_mc_task_129208_.free_ext_mem_112553 = ext_mem_112553.mem;
            futhark_mc_task_129208_.free_gtid_121728 = gtid_121728;
            futhark_mc_task_129208_.free_flat_tid_126899 = flat_tid_126899;
            futhark_mc_task_129208_.retval_defunc_res_121729 = (double *) &defunc_res_121729;
            #if ISPC
            futhark_mc_task_129208_.retval_defunc_res_121729 += programIndex;
            #endif
            futhark_mc_task_129208_.retval_defunc_res_121730 = (double *) &defunc_res_121730;
            #if ISPC
            futhark_mc_task_129208_.retval_defunc_res_121730 += programIndex;
            #endif
            futhark_mc_task_129208_.retval_defunc_res_121731 = (double *) &defunc_res_121731;
            #if ISPC
            futhark_mc_task_129208_.retval_defunc_res_121731 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_129208_task;
            
            futhark_mc_task_129208_task.args = &futhark_mc_task_129208_;
            futhark_mc_task_129208_task.top_level_fn = futhark_mc_segred_task_129209;
            futhark_mc_task_129208_task.name = "futhark_mc_segred_task_129209";
            futhark_mc_task_129208_task.iterations = m_33388;
            futhark_mc_task_129208_task.task_time = &ctx->program->futhark_mc_segred_task_129209_total_time;
            futhark_mc_task_129208_task.task_iter = &ctx->program->futhark_mc_segred_task_129209_total_iter;
            futhark_mc_task_129208_task.sched = STATIC;
            futhark_mc_task_129208_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_129209_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_129208_task);
            
            if (futhark_mc_segred_task_129209_err != 0) {
                err = futhark_mc_segred_task_129209_err;
                goto cleanup;
            }
            ((double *) mem_112573.mem)[gtid_121728] = defunc_res_121731;
            ((double *) mem_112575.mem)[gtid_121728] = defunc_res_121730;
            ((double *) mem_112577.mem)[gtid_121728] = defunc_res_121729;
        }
    }
    
  cleanup:
    { }
    if (event_129218 != NULL) {
        event_129218->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_129207", strdup("nothing further"), event_129218, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_nested_task_129205(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129198 *futhark_mc_task_129198 = (struct futhark_mc_task_129198 *) args;
    struct futhark_context *ctx = futhark_mc_task_129198->ctx;
    struct mc_event *event_129220 = mc_event_new(ctx);
    
    if (event_129220 != NULL)
        event_129220->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129198->free_m_33388;
    struct memblock ext_mem_112553 = {.desc ="ext_mem_112553", .mem =futhark_mc_task_129198->free_ext_mem_112553, .size =0, .references =NULL};
    struct memblock mem_112573 = {.desc ="mem_112573", .mem =futhark_mc_task_129198->free_mem_112573, .size =0, .references =NULL};
    struct memblock mem_112575 = {.desc ="mem_112575", .mem =futhark_mc_task_129198->free_mem_112575, .size =0, .references =NULL};
    struct memblock mem_112577 = {.desc ="mem_112577", .mem =futhark_mc_task_129198->free_mem_112577, .size =0, .references =NULL};
    int32_t nsubtasks_126898;
    
    nsubtasks_126898 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_129206 futhark_mc_segmap_parloop_struct_129206_;
    
    futhark_mc_segmap_parloop_struct_129206_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_129206_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_129206_.free_ext_mem_112553 = ext_mem_112553.mem;
    futhark_mc_segmap_parloop_struct_129206_.free_mem_112573 = mem_112573.mem;
    futhark_mc_segmap_parloop_struct_129206_.free_mem_112575 = mem_112575.mem;
    futhark_mc_segmap_parloop_struct_129206_.free_mem_112577 = mem_112577.mem;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_129207_task;
    
    futhark_mc_segmap_parloop_129207_task.name = "futhark_mc_segmap_parloop_129207";
    futhark_mc_segmap_parloop_129207_task.fn = futhark_mc_segmap_parloop_129207;
    futhark_mc_segmap_parloop_129207_task.args = &futhark_mc_segmap_parloop_struct_129206_;
    futhark_mc_segmap_parloop_129207_task.iterations = iterations;
    futhark_mc_segmap_parloop_129207_task.info = info;
    
    struct mc_event *event_129219 = mc_event_new(ctx);
    
    if (event_129219 != NULL)
        event_129219->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_129207_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_129207_task);
    
    if (futhark_mc_segmap_parloop_129207_err != 0) {
        err = futhark_mc_segmap_parloop_129207_err;
        goto cleanup;
    }
    if (event_129219 != NULL) {
        event_129219->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_129207_total", strdup("nothing further"), event_129219, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_129220 != NULL) {
        event_129220->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_nested_task_129205", strdup("nothing further"), event_129220, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_mc_task_129221 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112571;
    int64_t free_flat_tid_121757;
    int64_t free_flat_tid_121774;
    double *retval_defunc_0_reduce_res_110297;
};
struct futhark_mc_segred_stage_1_parloop_struct_129224 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112571;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126955;
};
static int futhark_mc_segred_stage_1_parloop_129225(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_129224 *futhark_mc_segred_stage_1_parloop_struct_129224 = (struct futhark_mc_segred_stage_1_parloop_struct_129224 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_129224->ctx;
    struct mc_event *event_129226 = mc_event_new(ctx);
    
    if (event_129226 != NULL)
        event_129226->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_129224->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_129224->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_129224->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112571 = {.desc ="mem_112571", .mem =futhark_mc_segred_stage_1_parloop_struct_129224->free_mem_112571, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126955 = {.desc ="reduce_stage_1_tid_res_arr_mem_126955", .mem =futhark_mc_segred_stage_1_parloop_struct_129224->free_reduce_stage_1_tid_res_arr_mem_126955, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121774;
    
    flat_tid_121774 = subtask_id;
    {
        double eta_p_126957;
        double eta_p_126958;
        double local_acc_126960 = 0.0;
        double eta_p_121776;
        double eta_p_121777;
        double local_acc_126961 = 0.0;
        int64_t start_126962;
        int64_t end_126963;
        
        start_126962 = start;
        end_126963 = end;
        
        int64_t n_126964 = end_126963 - start_126962;
        
        for (int64_t SegRed_i_126965 = start_126962; SegRed_i_126965 < start_126962 + n_126964; SegRed_i_126965++) {
            int64_t gtid_121775 = SegRed_i_126965;
            double eta_p_121779 = ((double *) mem_112571.mem)[gtid_121775];
            double defunc_0_reduce_res_121780;
            double redout_121782 = 0.0;
            
            for (int64_t i_121781 = 0; i_121781 < m_33388; i_121781++) {
                double eta_p_121783 = ((double *) A_mem_111707.mem)[eta_p_106382 * (m_33388 * m_33388) + gtid_121775 * m_33388 + i_121781];
                double eta_p_121784 = ((double *) mem_112571.mem)[i_121781];
                double zt_res_121785 = eta_p_121783 * eta_p_121783;
                double zt_res_121786 = eta_p_121784 * zt_res_121785;
                double zp_res_121787 = zt_res_121786 + redout_121782;
                double redout_tmp_126966 = zp_res_121787;
                
                redout_121782 = redout_tmp_126966;
            }
            defunc_0_reduce_res_121780 = redout_121782;
            
            double zt_res_121788 = eta_p_121779 * defunc_0_reduce_res_121780;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_121776 = local_acc_126961;
            }
            // Load next params
            {
                eta_p_121777 = zt_res_121788;
            }
            // SegRed body
            {
                double zp_res_121778 = eta_p_121776 + eta_p_121777;
                
                local_acc_126961 = zp_res_121778;
            }
        }
        
        int64_t uni_i_126967 = 0;
        
        {
            int64_t gtid_121775 = uni_i_126967;
            
            // Load accum params
            {
                eta_p_126957 = local_acc_126960;
            }
            // Load next params
            {
                eta_p_126958 = local_acc_126961;
            }
            // SegRed body
            {
                double zp_res_126959 = eta_p_126957 + eta_p_126958;
                
                local_acc_126960 = zp_res_126959;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_126955.mem)[flat_tid_121774] = local_acc_126960;
    }
    
  cleanup:
    { }
    if (event_129226 != NULL) {
        event_129226->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129225", strdup("nothing further"), event_129226, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_129222(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129221 *futhark_mc_task_129221 = (struct futhark_mc_task_129221 *) args;
    struct futhark_context *ctx = futhark_mc_task_129221->ctx;
    struct mc_event *event_129228 = mc_event_new(ctx);
    
    if (event_129228 != NULL)
        event_129228->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129221->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_129221->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_129221->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112571 = {.desc ="mem_112571", .mem =futhark_mc_task_129221->free_mem_112571, .size =0, .references =NULL};
    int64_t flat_tid_121757 = futhark_mc_task_129221->free_flat_tid_121757;
    int64_t flat_tid_121774 = futhark_mc_task_129221->free_flat_tid_121774;
    double defunc_0_reduce_res_110297 = *futhark_mc_task_129221->retval_defunc_0_reduce_res_110297;
    int64_t reduce_stage_1_tid_res_arr_mem_126955_cached_sizze_129223 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126955 = NULL;
    int32_t nsubtasks_126954;
    
    nsubtasks_126954 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_126955_cached_sizze_129223 < (int64_t) 8 * nsubtasks_126954) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126955, &reduce_stage_1_tid_res_arr_mem_126955_cached_sizze_129223, (int64_t) 8 * nsubtasks_126954);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_129224 futhark_mc_segred_stage_1_parloop_struct_129224_;
    
    futhark_mc_segred_stage_1_parloop_struct_129224_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_129224_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_129224_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_129224_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_129224_.free_mem_112571 = mem_112571.mem;
    futhark_mc_segred_stage_1_parloop_struct_129224_.free_reduce_stage_1_tid_res_arr_mem_126955 = reduce_stage_1_tid_res_arr_mem_126955;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_129225_task;
    
    futhark_mc_segred_stage_1_parloop_129225_task.name = "futhark_mc_segred_stage_1_parloop_129225";
    futhark_mc_segred_stage_1_parloop_129225_task.fn = futhark_mc_segred_stage_1_parloop_129225;
    futhark_mc_segred_stage_1_parloop_129225_task.args = &futhark_mc_segred_stage_1_parloop_struct_129224_;
    futhark_mc_segred_stage_1_parloop_129225_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_129225_task.info = info;
    
    struct mc_event *event_129227 = mc_event_new(ctx);
    
    if (event_129227 != NULL)
        event_129227->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_129225_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_129225_task);
    
    if (futhark_mc_segred_stage_1_parloop_129225_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_129225_err;
        goto cleanup;
    }
    if (event_129227 != NULL) {
        event_129227->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129225_total", strdup("nothing further"), event_129227, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_110297 = 0.0;
    }
    
    double eta_p_126968;
    double eta_p_126969;
    
    for (int32_t i_126971 = 0; i_126971 < nsubtasks_126954; i_126971++) {
        flat_tid_121774 = i_126971;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_126968 = defunc_0_reduce_res_110297;
            }
            // load next params
            {
                eta_p_126969 = ((double *) reduce_stage_1_tid_res_arr_mem_126955)[flat_tid_121774];
            }
            // red body
            {
                double zp_res_126970 = eta_p_126968 + eta_p_126969;
                
                defunc_0_reduce_res_110297 = zp_res_126970;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_126955);
    }
    if (event_129228 != NULL) {
        event_129228->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_129222", strdup("nothing further"), event_129228, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_129221->retval_defunc_0_reduce_res_110297 = defunc_0_reduce_res_110297;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_129231 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112571;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126973;
};
struct futhark_mc_task_129233 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112571;
    int64_t free_gtid_121758;
    int64_t free_flat_tid_121764;
    double *retval_defunc_0_reduce_res_121763;
};
struct futhark_mc_segred_stage_1_parloop_struct_129236 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112571;
    int64_t free_gtid_121758;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_126985;
};
static int futhark_mc_segred_stage_1_parloop_129237(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_129236 *futhark_mc_segred_stage_1_parloop_struct_129236 = (struct futhark_mc_segred_stage_1_parloop_struct_129236 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_129236->ctx;
    struct mc_event *event_129238 = mc_event_new(ctx);
    
    if (event_129238 != NULL)
        event_129238->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_129236->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_129236->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_129236->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112571 = {.desc ="mem_112571", .mem =futhark_mc_segred_stage_1_parloop_struct_129236->free_mem_112571, .size =0, .references =NULL};
    int64_t gtid_121758 = futhark_mc_segred_stage_1_parloop_struct_129236->free_gtid_121758;
    struct memblock reduce_stage_1_tid_res_arr_mem_126985 = {.desc ="reduce_stage_1_tid_res_arr_mem_126985", .mem =futhark_mc_segred_stage_1_parloop_struct_129236->free_reduce_stage_1_tid_res_arr_mem_126985, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121764;
    
    flat_tid_121764 = subtask_id;
    {
        double eta_p_126987;
        double eta_p_126988;
        double local_acc_126990 = 0.0;
        double eta_p_121766;
        double eta_p_121767;
        double local_acc_126991 = 0.0;
        int64_t start_126992;
        int64_t end_126993;
        
        start_126992 = start;
        end_126993 = end;
        
        int64_t n_126994 = end_126993 - start_126992;
        
        for (int64_t SegRed_i_126995 = start_126992; SegRed_i_126995 < start_126992 + n_126994; SegRed_i_126995++) {
            int64_t gtid_121765 = SegRed_i_126995;
            double eta_p_121769 = ((double *) A_mem_111707.mem)[eta_p_106382 * (m_33388 * m_33388) + gtid_121758 * m_33388 + gtid_121765];
            double eta_p_121770 = ((double *) mem_112571.mem)[gtid_121765];
            double zt_res_121771 = eta_p_121769 * eta_p_121769;
            double zt_res_121772 = eta_p_121770 * zt_res_121771;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_121766 = local_acc_126991;
            }
            // Load next params
            {
                eta_p_121767 = zt_res_121772;
            }
            // SegRed body
            {
                double zp_res_121768 = eta_p_121766 + eta_p_121767;
                
                local_acc_126991 = zp_res_121768;
            }
        }
        
        int64_t uni_i_126996 = 0;
        
        {
            int64_t gtid_121765 = uni_i_126996;
            
            // Load accum params
            {
                eta_p_126987 = local_acc_126990;
            }
            // Load next params
            {
                eta_p_126988 = local_acc_126991;
            }
            // SegRed body
            {
                double zp_res_126989 = eta_p_126987 + eta_p_126988;
                
                local_acc_126990 = zp_res_126989;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_126985.mem)[flat_tid_121764] = local_acc_126990;
    }
    
  cleanup:
    { }
    if (event_129238 != NULL) {
        event_129238->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129237", strdup("nothing further"), event_129238, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_129234(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129233 *futhark_mc_task_129233 = (struct futhark_mc_task_129233 *) args;
    struct futhark_context *ctx = futhark_mc_task_129233->ctx;
    struct mc_event *event_129240 = mc_event_new(ctx);
    
    if (event_129240 != NULL)
        event_129240->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129233->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_129233->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_129233->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112571 = {.desc ="mem_112571", .mem =futhark_mc_task_129233->free_mem_112571, .size =0, .references =NULL};
    int64_t gtid_121758 = futhark_mc_task_129233->free_gtid_121758;
    int64_t flat_tid_121764 = futhark_mc_task_129233->free_flat_tid_121764;
    double defunc_0_reduce_res_121763 = *futhark_mc_task_129233->retval_defunc_0_reduce_res_121763;
    int64_t reduce_stage_1_tid_res_arr_mem_126985_cached_sizze_129235 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126985 = NULL;
    int32_t nsubtasks_126984;
    
    nsubtasks_126984 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_126985_cached_sizze_129235 < (int64_t) 8 * nsubtasks_126984) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126985, &reduce_stage_1_tid_res_arr_mem_126985_cached_sizze_129235, (int64_t) 8 * nsubtasks_126984);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_129236 futhark_mc_segred_stage_1_parloop_struct_129236_;
    
    futhark_mc_segred_stage_1_parloop_struct_129236_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_129236_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_129236_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_129236_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_129236_.free_mem_112571 = mem_112571.mem;
    futhark_mc_segred_stage_1_parloop_struct_129236_.free_gtid_121758 = gtid_121758;
    futhark_mc_segred_stage_1_parloop_struct_129236_.free_reduce_stage_1_tid_res_arr_mem_126985 = reduce_stage_1_tid_res_arr_mem_126985;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_129237_task;
    
    futhark_mc_segred_stage_1_parloop_129237_task.name = "futhark_mc_segred_stage_1_parloop_129237";
    futhark_mc_segred_stage_1_parloop_129237_task.fn = futhark_mc_segred_stage_1_parloop_129237;
    futhark_mc_segred_stage_1_parloop_129237_task.args = &futhark_mc_segred_stage_1_parloop_struct_129236_;
    futhark_mc_segred_stage_1_parloop_129237_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_129237_task.info = info;
    
    struct mc_event *event_129239 = mc_event_new(ctx);
    
    if (event_129239 != NULL)
        event_129239->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_129237_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_129237_task);
    
    if (futhark_mc_segred_stage_1_parloop_129237_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_129237_err;
        goto cleanup;
    }
    if (event_129239 != NULL) {
        event_129239->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129237_total", strdup("nothing further"), event_129239, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_121763 = 0.0;
    }
    
    double eta_p_126997;
    double eta_p_126998;
    
    for (int32_t i_127000 = 0; i_127000 < nsubtasks_126984; i_127000++) {
        flat_tid_121764 = i_127000;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_126997 = defunc_0_reduce_res_121763;
            }
            // load next params
            {
                eta_p_126998 = ((double *) reduce_stage_1_tid_res_arr_mem_126985)[flat_tid_121764];
            }
            // red body
            {
                double zp_res_126999 = eta_p_126997 + eta_p_126998;
                
                defunc_0_reduce_res_121763 = zp_res_126999;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_126985);
    }
    if (event_129240 != NULL) {
        event_129240->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_129234", strdup("nothing further"), event_129240, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_129233->retval_defunc_0_reduce_res_121763 = defunc_0_reduce_res_121763;
    }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_129232(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_129231 *futhark_mc_segred_stage_1_parloop_struct_129231 = (struct futhark_mc_segred_stage_1_parloop_struct_129231 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_129231->ctx;
    struct mc_event *event_129241 = mc_event_new(ctx);
    
    if (event_129241 != NULL)
        event_129241->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_129231->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_129231->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_129231->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112571 = {.desc ="mem_112571", .mem =futhark_mc_segred_stage_1_parloop_struct_129231->free_mem_112571, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_126973 = {.desc ="reduce_stage_1_tid_res_arr_mem_126973", .mem =futhark_mc_segred_stage_1_parloop_struct_129231->free_reduce_stage_1_tid_res_arr_mem_126973, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121757;
    
    flat_tid_121757 = subtask_id;
    {
        double eta_p_126975;
        double eta_p_126976;
        double local_acc_126978 = 0.0;
        double eta_p_121759;
        double eta_p_121760;
        double local_acc_126979 = 0.0;
        int64_t start_126980;
        int64_t end_126981;
        
        start_126980 = start;
        end_126981 = end;
        
        int64_t n_126982 = end_126981 - start_126980;
        
        for (int64_t SegRed_i_126983 = start_126980; SegRed_i_126983 < start_126980 + n_126982; SegRed_i_126983++) {
            int64_t gtid_121758 = SegRed_i_126983;
            double eta_p_121762 = ((double *) mem_112571.mem)[gtid_121758];
            double defunc_0_reduce_res_121763;
            int64_t flat_tid_121764 = (int64_t) 0;
            
            defunc_0_reduce_res_121763 = 0.0;
            
            struct futhark_mc_task_129233 futhark_mc_task_129233_;
            
            futhark_mc_task_129233_.ctx = ctx;
            futhark_mc_task_129233_.free_m_33388 = m_33388;
            futhark_mc_task_129233_.free_eta_p_106382 = eta_p_106382;
            futhark_mc_task_129233_.free_A_mem_111707 = A_mem_111707.mem;
            futhark_mc_task_129233_.free_mem_112571 = mem_112571.mem;
            futhark_mc_task_129233_.free_gtid_121758 = gtid_121758;
            futhark_mc_task_129233_.free_flat_tid_121764 = flat_tid_121764;
            futhark_mc_task_129233_.retval_defunc_0_reduce_res_121763 = (double *) &defunc_0_reduce_res_121763;
            #if ISPC
            futhark_mc_task_129233_.retval_defunc_0_reduce_res_121763 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_129233_task;
            
            futhark_mc_task_129233_task.args = &futhark_mc_task_129233_;
            futhark_mc_task_129233_task.top_level_fn = futhark_mc_segred_task_129234;
            futhark_mc_task_129233_task.name = "futhark_mc_segred_task_129234";
            futhark_mc_task_129233_task.iterations = m_33388;
            futhark_mc_task_129233_task.task_time = &ctx->program->futhark_mc_segred_task_129234_total_time;
            futhark_mc_task_129233_task.task_iter = &ctx->program->futhark_mc_segred_task_129234_total_iter;
            futhark_mc_task_129233_task.sched = STATIC;
            futhark_mc_task_129233_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_129234_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_129233_task);
            
            if (futhark_mc_segred_task_129234_err != 0) {
                err = futhark_mc_segred_task_129234_err;
                goto cleanup;
            }
            
            double zt_res_121773 = eta_p_121762 * defunc_0_reduce_res_121763;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_121759 = local_acc_126979;
            }
            // Load next params
            {
                eta_p_121760 = zt_res_121773;
            }
            // SegRed body
            {
                double zp_res_121761 = eta_p_121759 + eta_p_121760;
                
                local_acc_126979 = zp_res_121761;
            }
        }
        
        int64_t uni_i_127001 = 0;
        
        {
            int64_t gtid_121758 = uni_i_127001;
            
            // Load accum params
            {
                eta_p_126975 = local_acc_126978;
            }
            // Load next params
            {
                eta_p_126976 = local_acc_126979;
            }
            // SegRed body
            {
                double zp_res_126977 = eta_p_126975 + eta_p_126976;
                
                local_acc_126978 = zp_res_126977;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_126973.mem)[flat_tid_121757] = local_acc_126978;
    }
    
  cleanup:
    { }
    if (event_129241 != NULL) {
        event_129241->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129232", strdup("nothing further"), event_129241, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_129229(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129221 *futhark_mc_task_129221 = (struct futhark_mc_task_129221 *) args;
    struct futhark_context *ctx = futhark_mc_task_129221->ctx;
    struct mc_event *event_129243 = mc_event_new(ctx);
    
    if (event_129243 != NULL)
        event_129243->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129221->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_129221->free_eta_p_106382;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_129221->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112571 = {.desc ="mem_112571", .mem =futhark_mc_task_129221->free_mem_112571, .size =0, .references =NULL};
    int64_t flat_tid_121757 = futhark_mc_task_129221->free_flat_tid_121757;
    int64_t flat_tid_121774 = futhark_mc_task_129221->free_flat_tid_121774;
    double defunc_0_reduce_res_110297 = *futhark_mc_task_129221->retval_defunc_0_reduce_res_110297;
    int64_t reduce_stage_1_tid_res_arr_mem_126973_cached_sizze_129230 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_126973 = NULL;
    int32_t nsubtasks_126972;
    
    nsubtasks_126972 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_126973_cached_sizze_129230 < (int64_t) 8 * nsubtasks_126972) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_126973, &reduce_stage_1_tid_res_arr_mem_126973_cached_sizze_129230, (int64_t) 8 * nsubtasks_126972);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_129231 futhark_mc_segred_stage_1_parloop_struct_129231_;
    
    futhark_mc_segred_stage_1_parloop_struct_129231_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_129231_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_129231_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_129231_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_129231_.free_mem_112571 = mem_112571.mem;
    futhark_mc_segred_stage_1_parloop_struct_129231_.free_reduce_stage_1_tid_res_arr_mem_126973 = reduce_stage_1_tid_res_arr_mem_126973;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_129232_task;
    
    futhark_mc_segred_stage_1_parloop_129232_task.name = "futhark_mc_segred_stage_1_parloop_129232";
    futhark_mc_segred_stage_1_parloop_129232_task.fn = futhark_mc_segred_stage_1_parloop_129232;
    futhark_mc_segred_stage_1_parloop_129232_task.args = &futhark_mc_segred_stage_1_parloop_struct_129231_;
    futhark_mc_segred_stage_1_parloop_129232_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_129232_task.info = info;
    
    struct mc_event *event_129242 = mc_event_new(ctx);
    
    if (event_129242 != NULL)
        event_129242->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_129232_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_129232_task);
    
    if (futhark_mc_segred_stage_1_parloop_129232_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_129232_err;
        goto cleanup;
    }
    if (event_129242 != NULL) {
        event_129242->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129232_total", strdup("nothing further"), event_129242, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_110297 = 0.0;
    }
    
    double eta_p_127002;
    double eta_p_127003;
    
    for (int32_t i_127005 = 0; i_127005 < nsubtasks_126972; i_127005++) {
        flat_tid_121757 = i_127005;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_127002 = defunc_0_reduce_res_110297;
            }
            // load next params
            {
                eta_p_127003 = ((double *) reduce_stage_1_tid_res_arr_mem_126973)[flat_tid_121757];
            }
            // red body
            {
                double zp_res_127004 = eta_p_127002 + eta_p_127003;
                
                defunc_0_reduce_res_110297 = zp_res_127004;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_126973);
    }
    if (event_129243 != NULL) {
        event_129243->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_129229", strdup("nothing further"), event_129243, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_129221->retval_defunc_0_reduce_res_110297 = defunc_0_reduce_res_110297;
    }
    return err;
}
struct futhark_mc_task_129244 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112577;
    int64_t free_flat_tid_121789;
    int64_t free_flat_tid_121806;
    double *retval_defunc_0_reduce_res_110332;
};
struct futhark_mc_segred_stage_1_parloop_struct_129247 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112577;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_127007;
};
static int futhark_mc_segred_stage_1_parloop_129248(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_129247 *futhark_mc_segred_stage_1_parloop_struct_129247 = (struct futhark_mc_segred_stage_1_parloop_struct_129247 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_129247->ctx;
    struct mc_event *event_129249 = mc_event_new(ctx);
    
    if (event_129249 != NULL)
        event_129249->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_129247->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_129247->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_129247->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112577 = {.desc ="mem_112577", .mem =futhark_mc_segred_stage_1_parloop_struct_129247->free_mem_112577, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_127007 = {.desc ="reduce_stage_1_tid_res_arr_mem_127007", .mem =futhark_mc_segred_stage_1_parloop_struct_129247->free_reduce_stage_1_tid_res_arr_mem_127007, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121806;
    
    flat_tid_121806 = subtask_id;
    {
        double eta_p_127009;
        double eta_p_127010;
        double local_acc_127012 = 0.0;
        double eta_p_121808;
        double eta_p_121809;
        double local_acc_127013 = 0.0;
        int64_t start_127014;
        int64_t end_127015;
        
        start_127014 = start;
        end_127015 = end;
        
        int64_t n_127016 = end_127015 - start_127014;
        
        for (int64_t SegRed_i_127017 = start_127014; SegRed_i_127017 < start_127014 + n_127016; SegRed_i_127017++) {
            int64_t gtid_121807 = SegRed_i_127017;
            double eta_p_121811 = ((double *) mem_112577.mem)[gtid_121807];
            double defunc_0_reduce_res_121812;
            double redout_121814 = 0.0;
            
            for (int64_t i_121813 = 0; i_121813 < m_33388; i_121813++) {
                double eta_p_121815 = ((double *) A_mem_111707.mem)[lifted_lambda_res_106391 * (m_33388 * m_33388) + gtid_121807 * m_33388 + i_121813];
                double eta_p_121816 = ((double *) mem_112577.mem)[i_121813];
                double zt_res_121817 = eta_p_121815 * eta_p_121815;
                double zt_res_121818 = eta_p_121816 * zt_res_121817;
                double zp_res_121819 = zt_res_121818 + redout_121814;
                double redout_tmp_127018 = zp_res_121819;
                
                redout_121814 = redout_tmp_127018;
            }
            defunc_0_reduce_res_121812 = redout_121814;
            
            double zt_res_121820 = eta_p_121811 * defunc_0_reduce_res_121812;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_121808 = local_acc_127013;
            }
            // Load next params
            {
                eta_p_121809 = zt_res_121820;
            }
            // SegRed body
            {
                double zp_res_121810 = eta_p_121808 + eta_p_121809;
                
                local_acc_127013 = zp_res_121810;
            }
        }
        
        int64_t uni_i_127019 = 0;
        
        {
            int64_t gtid_121807 = uni_i_127019;
            
            // Load accum params
            {
                eta_p_127009 = local_acc_127012;
            }
            // Load next params
            {
                eta_p_127010 = local_acc_127013;
            }
            // SegRed body
            {
                double zp_res_127011 = eta_p_127009 + eta_p_127010;
                
                local_acc_127012 = zp_res_127011;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_127007.mem)[flat_tid_121806] = local_acc_127012;
    }
    
  cleanup:
    { }
    if (event_129249 != NULL) {
        event_129249->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129248", strdup("nothing further"), event_129249, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_129245(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129244 *futhark_mc_task_129244 = (struct futhark_mc_task_129244 *) args;
    struct futhark_context *ctx = futhark_mc_task_129244->ctx;
    struct mc_event *event_129251 = mc_event_new(ctx);
    
    if (event_129251 != NULL)
        event_129251->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129244->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_129244->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_129244->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112577 = {.desc ="mem_112577", .mem =futhark_mc_task_129244->free_mem_112577, .size =0, .references =NULL};
    int64_t flat_tid_121789 = futhark_mc_task_129244->free_flat_tid_121789;
    int64_t flat_tid_121806 = futhark_mc_task_129244->free_flat_tid_121806;
    double defunc_0_reduce_res_110332 = *futhark_mc_task_129244->retval_defunc_0_reduce_res_110332;
    int64_t reduce_stage_1_tid_res_arr_mem_127007_cached_sizze_129246 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_127007 = NULL;
    int32_t nsubtasks_127006;
    
    nsubtasks_127006 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_127007_cached_sizze_129246 < (int64_t) 8 * nsubtasks_127006) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_127007, &reduce_stage_1_tid_res_arr_mem_127007_cached_sizze_129246, (int64_t) 8 * nsubtasks_127006);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_129247 futhark_mc_segred_stage_1_parloop_struct_129247_;
    
    futhark_mc_segred_stage_1_parloop_struct_129247_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_129247_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_129247_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_129247_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_129247_.free_mem_112577 = mem_112577.mem;
    futhark_mc_segred_stage_1_parloop_struct_129247_.free_reduce_stage_1_tid_res_arr_mem_127007 = reduce_stage_1_tid_res_arr_mem_127007;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_129248_task;
    
    futhark_mc_segred_stage_1_parloop_129248_task.name = "futhark_mc_segred_stage_1_parloop_129248";
    futhark_mc_segred_stage_1_parloop_129248_task.fn = futhark_mc_segred_stage_1_parloop_129248;
    futhark_mc_segred_stage_1_parloop_129248_task.args = &futhark_mc_segred_stage_1_parloop_struct_129247_;
    futhark_mc_segred_stage_1_parloop_129248_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_129248_task.info = info;
    
    struct mc_event *event_129250 = mc_event_new(ctx);
    
    if (event_129250 != NULL)
        event_129250->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_129248_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_129248_task);
    
    if (futhark_mc_segred_stage_1_parloop_129248_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_129248_err;
        goto cleanup;
    }
    if (event_129250 != NULL) {
        event_129250->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129248_total", strdup("nothing further"), event_129250, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_110332 = 0.0;
    }
    
    double eta_p_127020;
    double eta_p_127021;
    
    for (int32_t i_127023 = 0; i_127023 < nsubtasks_127006; i_127023++) {
        flat_tid_121806 = i_127023;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_127020 = defunc_0_reduce_res_110332;
            }
            // load next params
            {
                eta_p_127021 = ((double *) reduce_stage_1_tid_res_arr_mem_127007)[flat_tid_121806];
            }
            // red body
            {
                double zp_res_127022 = eta_p_127020 + eta_p_127021;
                
                defunc_0_reduce_res_110332 = zp_res_127022;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_127007);
    }
    if (event_129251 != NULL) {
        event_129251->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_129245", strdup("nothing further"), event_129251, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_129244->retval_defunc_0_reduce_res_110332 = defunc_0_reduce_res_110332;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_129254 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112577;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_127025;
};
struct futhark_mc_task_129256 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112577;
    int64_t free_gtid_121790;
    int64_t free_flat_tid_121796;
    double *retval_defunc_0_reduce_res_121795;
};
struct futhark_mc_segred_stage_1_parloop_struct_129259 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_A_mem_111707;
    unsigned char *free_mem_112577;
    int64_t free_gtid_121790;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_127037;
};
static int futhark_mc_segred_stage_1_parloop_129260(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_129259 *futhark_mc_segred_stage_1_parloop_struct_129259 = (struct futhark_mc_segred_stage_1_parloop_struct_129259 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_129259->ctx;
    struct mc_event *event_129261 = mc_event_new(ctx);
    
    if (event_129261 != NULL)
        event_129261->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_129259->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_129259->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_129259->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112577 = {.desc ="mem_112577", .mem =futhark_mc_segred_stage_1_parloop_struct_129259->free_mem_112577, .size =0, .references =NULL};
    int64_t gtid_121790 = futhark_mc_segred_stage_1_parloop_struct_129259->free_gtid_121790;
    struct memblock reduce_stage_1_tid_res_arr_mem_127037 = {.desc ="reduce_stage_1_tid_res_arr_mem_127037", .mem =futhark_mc_segred_stage_1_parloop_struct_129259->free_reduce_stage_1_tid_res_arr_mem_127037, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121796;
    
    flat_tid_121796 = subtask_id;
    {
        double eta_p_127039;
        double eta_p_127040;
        double local_acc_127042 = 0.0;
        double eta_p_121798;
        double eta_p_121799;
        double local_acc_127043 = 0.0;
        int64_t start_127044;
        int64_t end_127045;
        
        start_127044 = start;
        end_127045 = end;
        
        int64_t n_127046 = end_127045 - start_127044;
        
        for (int64_t SegRed_i_127047 = start_127044; SegRed_i_127047 < start_127044 + n_127046; SegRed_i_127047++) {
            int64_t gtid_121797 = SegRed_i_127047;
            double eta_p_121801 = ((double *) A_mem_111707.mem)[lifted_lambda_res_106391 * (m_33388 * m_33388) + gtid_121790 * m_33388 + gtid_121797];
            double eta_p_121802 = ((double *) mem_112577.mem)[gtid_121797];
            double zt_res_121803 = eta_p_121801 * eta_p_121801;
            double zt_res_121804 = eta_p_121802 * zt_res_121803;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_121798 = local_acc_127043;
            }
            // Load next params
            {
                eta_p_121799 = zt_res_121804;
            }
            // SegRed body
            {
                double zp_res_121800 = eta_p_121798 + eta_p_121799;
                
                local_acc_127043 = zp_res_121800;
            }
        }
        
        int64_t uni_i_127048 = 0;
        
        {
            int64_t gtid_121797 = uni_i_127048;
            
            // Load accum params
            {
                eta_p_127039 = local_acc_127042;
            }
            // Load next params
            {
                eta_p_127040 = local_acc_127043;
            }
            // SegRed body
            {
                double zp_res_127041 = eta_p_127039 + eta_p_127040;
                
                local_acc_127042 = zp_res_127041;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_127037.mem)[flat_tid_121796] = local_acc_127042;
    }
    
  cleanup:
    { }
    if (event_129261 != NULL) {
        event_129261->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129260", strdup("nothing further"), event_129261, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_129257(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129256 *futhark_mc_task_129256 = (struct futhark_mc_task_129256 *) args;
    struct futhark_context *ctx = futhark_mc_task_129256->ctx;
    struct mc_event *event_129263 = mc_event_new(ctx);
    
    if (event_129263 != NULL)
        event_129263->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129256->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_129256->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_129256->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112577 = {.desc ="mem_112577", .mem =futhark_mc_task_129256->free_mem_112577, .size =0, .references =NULL};
    int64_t gtid_121790 = futhark_mc_task_129256->free_gtid_121790;
    int64_t flat_tid_121796 = futhark_mc_task_129256->free_flat_tid_121796;
    double defunc_0_reduce_res_121795 = *futhark_mc_task_129256->retval_defunc_0_reduce_res_121795;
    int64_t reduce_stage_1_tid_res_arr_mem_127037_cached_sizze_129258 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_127037 = NULL;
    int32_t nsubtasks_127036;
    
    nsubtasks_127036 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_127037_cached_sizze_129258 < (int64_t) 8 * nsubtasks_127036) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_127037, &reduce_stage_1_tid_res_arr_mem_127037_cached_sizze_129258, (int64_t) 8 * nsubtasks_127036);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_129259 futhark_mc_segred_stage_1_parloop_struct_129259_;
    
    futhark_mc_segred_stage_1_parloop_struct_129259_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_129259_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_129259_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_129259_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_129259_.free_mem_112577 = mem_112577.mem;
    futhark_mc_segred_stage_1_parloop_struct_129259_.free_gtid_121790 = gtid_121790;
    futhark_mc_segred_stage_1_parloop_struct_129259_.free_reduce_stage_1_tid_res_arr_mem_127037 = reduce_stage_1_tid_res_arr_mem_127037;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_129260_task;
    
    futhark_mc_segred_stage_1_parloop_129260_task.name = "futhark_mc_segred_stage_1_parloop_129260";
    futhark_mc_segred_stage_1_parloop_129260_task.fn = futhark_mc_segred_stage_1_parloop_129260;
    futhark_mc_segred_stage_1_parloop_129260_task.args = &futhark_mc_segred_stage_1_parloop_struct_129259_;
    futhark_mc_segred_stage_1_parloop_129260_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_129260_task.info = info;
    
    struct mc_event *event_129262 = mc_event_new(ctx);
    
    if (event_129262 != NULL)
        event_129262->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_129260_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_129260_task);
    
    if (futhark_mc_segred_stage_1_parloop_129260_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_129260_err;
        goto cleanup;
    }
    if (event_129262 != NULL) {
        event_129262->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129260_total", strdup("nothing further"), event_129262, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_121795 = 0.0;
    }
    
    double eta_p_127049;
    double eta_p_127050;
    
    for (int32_t i_127052 = 0; i_127052 < nsubtasks_127036; i_127052++) {
        flat_tid_121796 = i_127052;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_127049 = defunc_0_reduce_res_121795;
            }
            // load next params
            {
                eta_p_127050 = ((double *) reduce_stage_1_tid_res_arr_mem_127037)[flat_tid_121796];
            }
            // red body
            {
                double zp_res_127051 = eta_p_127049 + eta_p_127050;
                
                defunc_0_reduce_res_121795 = zp_res_127051;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_127037);
    }
    if (event_129263 != NULL) {
        event_129263->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_129257", strdup("nothing further"), event_129263, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_129256->retval_defunc_0_reduce_res_121795 = defunc_0_reduce_res_121795;
    }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_129255(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_129254 *futhark_mc_segred_stage_1_parloop_struct_129254 = (struct futhark_mc_segred_stage_1_parloop_struct_129254 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_129254->ctx;
    struct mc_event *event_129264 = mc_event_new(ctx);
    
    if (event_129264 != NULL)
        event_129264->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_129254->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_129254->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segred_stage_1_parloop_struct_129254->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112577 = {.desc ="mem_112577", .mem =futhark_mc_segred_stage_1_parloop_struct_129254->free_mem_112577, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_127025 = {.desc ="reduce_stage_1_tid_res_arr_mem_127025", .mem =futhark_mc_segred_stage_1_parloop_struct_129254->free_reduce_stage_1_tid_res_arr_mem_127025, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121789;
    
    flat_tid_121789 = subtask_id;
    {
        double eta_p_127027;
        double eta_p_127028;
        double local_acc_127030 = 0.0;
        double eta_p_121791;
        double eta_p_121792;
        double local_acc_127031 = 0.0;
        int64_t start_127032;
        int64_t end_127033;
        
        start_127032 = start;
        end_127033 = end;
        
        int64_t n_127034 = end_127033 - start_127032;
        
        for (int64_t SegRed_i_127035 = start_127032; SegRed_i_127035 < start_127032 + n_127034; SegRed_i_127035++) {
            int64_t gtid_121790 = SegRed_i_127035;
            double eta_p_121794 = ((double *) mem_112577.mem)[gtid_121790];
            double defunc_0_reduce_res_121795;
            int64_t flat_tid_121796 = (int64_t) 0;
            
            defunc_0_reduce_res_121795 = 0.0;
            
            struct futhark_mc_task_129256 futhark_mc_task_129256_;
            
            futhark_mc_task_129256_.ctx = ctx;
            futhark_mc_task_129256_.free_m_33388 = m_33388;
            futhark_mc_task_129256_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
            futhark_mc_task_129256_.free_A_mem_111707 = A_mem_111707.mem;
            futhark_mc_task_129256_.free_mem_112577 = mem_112577.mem;
            futhark_mc_task_129256_.free_gtid_121790 = gtid_121790;
            futhark_mc_task_129256_.free_flat_tid_121796 = flat_tid_121796;
            futhark_mc_task_129256_.retval_defunc_0_reduce_res_121795 = (double *) &defunc_0_reduce_res_121795;
            #if ISPC
            futhark_mc_task_129256_.retval_defunc_0_reduce_res_121795 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_129256_task;
            
            futhark_mc_task_129256_task.args = &futhark_mc_task_129256_;
            futhark_mc_task_129256_task.top_level_fn = futhark_mc_segred_task_129257;
            futhark_mc_task_129256_task.name = "futhark_mc_segred_task_129257";
            futhark_mc_task_129256_task.iterations = m_33388;
            futhark_mc_task_129256_task.task_time = &ctx->program->futhark_mc_segred_task_129257_total_time;
            futhark_mc_task_129256_task.task_iter = &ctx->program->futhark_mc_segred_task_129257_total_iter;
            futhark_mc_task_129256_task.sched = STATIC;
            futhark_mc_task_129256_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_129257_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_129256_task);
            
            if (futhark_mc_segred_task_129257_err != 0) {
                err = futhark_mc_segred_task_129257_err;
                goto cleanup;
            }
            
            double zt_res_121805 = eta_p_121794 * defunc_0_reduce_res_121795;
            
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_121791 = local_acc_127031;
            }
            // Load next params
            {
                eta_p_121792 = zt_res_121805;
            }
            // SegRed body
            {
                double zp_res_121793 = eta_p_121791 + eta_p_121792;
                
                local_acc_127031 = zp_res_121793;
            }
        }
        
        int64_t uni_i_127053 = 0;
        
        {
            int64_t gtid_121790 = uni_i_127053;
            
            // Load accum params
            {
                eta_p_127027 = local_acc_127030;
            }
            // Load next params
            {
                eta_p_127028 = local_acc_127031;
            }
            // SegRed body
            {
                double zp_res_127029 = eta_p_127027 + eta_p_127028;
                
                local_acc_127030 = zp_res_127029;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_127025.mem)[flat_tid_121789] = local_acc_127030;
    }
    
  cleanup:
    { }
    if (event_129264 != NULL) {
        event_129264->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129255", strdup("nothing further"), event_129264, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_129252(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129244 *futhark_mc_task_129244 = (struct futhark_mc_task_129244 *) args;
    struct futhark_context *ctx = futhark_mc_task_129244->ctx;
    struct mc_event *event_129266 = mc_event_new(ctx);
    
    if (event_129266 != NULL)
        event_129266->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129244->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_129244->free_lifted_lambda_res_106391;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_129244->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock mem_112577 = {.desc ="mem_112577", .mem =futhark_mc_task_129244->free_mem_112577, .size =0, .references =NULL};
    int64_t flat_tid_121789 = futhark_mc_task_129244->free_flat_tid_121789;
    int64_t flat_tid_121806 = futhark_mc_task_129244->free_flat_tid_121806;
    double defunc_0_reduce_res_110332 = *futhark_mc_task_129244->retval_defunc_0_reduce_res_110332;
    int64_t reduce_stage_1_tid_res_arr_mem_127025_cached_sizze_129253 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_127025 = NULL;
    int32_t nsubtasks_127024;
    
    nsubtasks_127024 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_127025_cached_sizze_129253 < (int64_t) 8 * nsubtasks_127024) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_127025, &reduce_stage_1_tid_res_arr_mem_127025_cached_sizze_129253, (int64_t) 8 * nsubtasks_127024);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_129254 futhark_mc_segred_stage_1_parloop_struct_129254_;
    
    futhark_mc_segred_stage_1_parloop_struct_129254_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_129254_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_129254_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_129254_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segred_stage_1_parloop_struct_129254_.free_mem_112577 = mem_112577.mem;
    futhark_mc_segred_stage_1_parloop_struct_129254_.free_reduce_stage_1_tid_res_arr_mem_127025 = reduce_stage_1_tid_res_arr_mem_127025;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_129255_task;
    
    futhark_mc_segred_stage_1_parloop_129255_task.name = "futhark_mc_segred_stage_1_parloop_129255";
    futhark_mc_segred_stage_1_parloop_129255_task.fn = futhark_mc_segred_stage_1_parloop_129255;
    futhark_mc_segred_stage_1_parloop_129255_task.args = &futhark_mc_segred_stage_1_parloop_struct_129254_;
    futhark_mc_segred_stage_1_parloop_129255_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_129255_task.info = info;
    
    struct mc_event *event_129265 = mc_event_new(ctx);
    
    if (event_129265 != NULL)
        event_129265->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_129255_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_129255_task);
    
    if (futhark_mc_segred_stage_1_parloop_129255_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_129255_err;
        goto cleanup;
    }
    if (event_129265 != NULL) {
        event_129265->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129255_total", strdup("nothing further"), event_129265, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_0_reduce_res_110332 = 0.0;
    }
    
    double eta_p_127054;
    double eta_p_127055;
    
    for (int32_t i_127057 = 0; i_127057 < nsubtasks_127024; i_127057++) {
        flat_tid_121789 = i_127057;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_127054 = defunc_0_reduce_res_110332;
            }
            // load next params
            {
                eta_p_127055 = ((double *) reduce_stage_1_tid_res_arr_mem_127025)[flat_tid_121789];
            }
            // red body
            {
                double zp_res_127056 = eta_p_127054 + eta_p_127055;
                
                defunc_0_reduce_res_110332 = zp_res_127056;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_127025);
    }
    if (event_129266 != NULL) {
        event_129266->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_129252", strdup("nothing further"), event_129266, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_129244->retval_defunc_0_reduce_res_110332 = defunc_0_reduce_res_110332;
    }
    return err;
}
struct futhark_mc_task_129267 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_112567;
    unsigned char *free_mem_112569;
    int64_t free_flat_tid_121821;
    int64_t free_flat_tid_121862;
    double *retval_defunc_res_110370;
    double *retval_defunc_res_110371;
};
struct futhark_mc_segred_stage_1_parloop_struct_129271 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_112567;
    unsigned char *free_mem_112569;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_127059;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_127061;
};
static int futhark_mc_segred_stage_1_parloop_129272(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_129271 *futhark_mc_segred_stage_1_parloop_struct_129271 = (struct futhark_mc_segred_stage_1_parloop_struct_129271 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_129271->ctx;
    struct mc_event *event_129273 = mc_event_new(ctx);
    
    if (event_129273 != NULL)
        event_129273->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_129271->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_129271->free_eta_p_106382;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_129271->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112567 = {.desc ="mem_112567", .mem =futhark_mc_segred_stage_1_parloop_struct_129271->free_mem_112567, .size =0, .references =NULL};
    struct memblock mem_112569 = {.desc ="mem_112569", .mem =futhark_mc_segred_stage_1_parloop_struct_129271->free_mem_112569, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_127059 = {.desc ="reduce_stage_1_tid_res_arr_mem_127059", .mem =futhark_mc_segred_stage_1_parloop_struct_129271->free_reduce_stage_1_tid_res_arr_mem_127059, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_127061 = {.desc ="reduce_stage_1_tid_res_arr_mem_127061", .mem =futhark_mc_segred_stage_1_parloop_struct_129271->free_reduce_stage_1_tid_res_arr_mem_127061, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121862;
    
    flat_tid_121862 = subtask_id;
    {
        double eta_p_127063;
        double eta_p_127064;
        double eta_p_127066;
        double eta_p_127067;
        double local_acc_127069 = 0.0;
        double local_acc_127070 = 0.0;
        double eta_p_121864;
        double eta_p_121865;
        double eta_p_121867;
        double eta_p_121868;
        double local_acc_127071 = 0.0;
        double local_acc_127072 = 0.0;
        int64_t start_127073;
        int64_t end_127074;
        
        start_127073 = start;
        end_127074 = end;
        
        int64_t n_127075 = end_127074 - start_127073;
        
        for (int64_t SegRed_i_127076 = start_127073; SegRed_i_127076 < start_127073 + n_127075; SegRed_i_127076++) {
            int64_t gtid_121863 = SegRed_i_127076;
            double eta_p_121870 = ((double *) mem_112567.mem)[gtid_121863];
            double eta_p_121871 = ((double *) distrs_mem_111708.mem)[eta_p_106382 * m_33388 + gtid_121863];
            double eta_p_121872 = ((double *) mem_112569.mem)[gtid_121863];
            double defunc_res_121873;
            double defunc_res_121874;
            double redout_121876;
            double redout_121877;
            
            redout_121876 = 0.0;
            redout_121877 = 0.0;
            for (int64_t i_121875 = 0; i_121875 < m_33388; i_121875++) {
                double eta_p_121878 = ((double *) mem_112567.mem)[i_121875];
                double eta_p_121879 = ((double *) distrs_mem_111708.mem)[eta_p_106382 * m_33388 + i_121875];
                double eta_p_121880 = ((double *) mem_112569.mem)[i_121875];
                double zt_res_121881 = eta_p_121871 * eta_p_121879;
                double zt_res_121882 = eta_p_121872 * eta_p_121880;
                bool zeze_res_121883 = zt_res_121882 == 0.0;
                double kl_res_121884;
                
                if (zeze_res_121883) {
                    kl_res_121884 = zt_res_121881;
                } else {
                    double zs_res_121885 = zt_res_121882 / zt_res_121881;
                    double log_res_121886 = futrts_log64(zs_res_121885);
                    double zt_res_121887 = zt_res_121882 * log_res_121886;
                    double zm_res_121888 = zt_res_121887 - zt_res_121882;
                    double zp_res_121889 = zt_res_121881 + zm_res_121888;
                    
                    kl_res_121884 = zp_res_121889;
                }
                
                double zt_res_121890 = eta_p_121870 * eta_p_121878;
                bool zeze_res_121891 = zt_res_121890 == 0.0;
                double kl_res_121892;
                
                if (zeze_res_121891) {
                    kl_res_121892 = zt_res_121881;
                } else {
                    double zs_res_121893 = zt_res_121890 / zt_res_121881;
                    double log_res_121894 = futrts_log64(zs_res_121893);
                    double zt_res_121895 = zt_res_121890 * log_res_121894;
                    double zm_res_121896 = zt_res_121895 - zt_res_121890;
                    double zp_res_121897 = zt_res_121881 + zm_res_121896;
                    
                    kl_res_121892 = zp_res_121897;
                }
                
                double zp_res_121898 = kl_res_121884 + redout_121876;
                double zp_res_121899 = kl_res_121892 + redout_121877;
                double redout_tmp_127077 = zp_res_121898;
                double redout_tmp_127078 = zp_res_121899;
                
                redout_121876 = redout_tmp_127077;
                redout_121877 = redout_tmp_127078;
            }
            defunc_res_121873 = redout_121876;
            defunc_res_121874 = redout_121877;
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_121864 = local_acc_127071;
            }
            // Load next params
            {
                eta_p_121865 = defunc_res_121873;
            }
            // SegRed body
            {
                double zp_res_121866 = eta_p_121864 + eta_p_121865;
                
                local_acc_127071 = zp_res_121866;
            }
            // Load accum params
            {
                eta_p_121867 = local_acc_127072;
            }
            // Load next params
            {
                eta_p_121868 = defunc_res_121874;
            }
            // SegRed body
            {
                double zp_res_121869 = eta_p_121867 + eta_p_121868;
                
                local_acc_127072 = zp_res_121869;
            }
        }
        
        int64_t uni_i_127079 = 0;
        
        {
            int64_t gtid_121863 = uni_i_127079;
            
            // Load accum params
            {
                eta_p_127063 = local_acc_127069;
            }
            // Load next params
            {
                eta_p_127064 = local_acc_127071;
            }
            // SegRed body
            {
                double zp_res_127065 = eta_p_127063 + eta_p_127064;
                
                local_acc_127069 = zp_res_127065;
            }
            // Load accum params
            {
                eta_p_127066 = local_acc_127070;
            }
            // Load next params
            {
                eta_p_127067 = local_acc_127072;
            }
            // SegRed body
            {
                double zp_res_127068 = eta_p_127066 + eta_p_127067;
                
                local_acc_127070 = zp_res_127068;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_127059.mem)[flat_tid_121862] = local_acc_127069;
        ((double *) reduce_stage_1_tid_res_arr_mem_127061.mem)[flat_tid_121862] = local_acc_127070;
    }
    
  cleanup:
    { }
    if (event_129273 != NULL) {
        event_129273->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129272", strdup("nothing further"), event_129273, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_129268(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129267 *futhark_mc_task_129267 = (struct futhark_mc_task_129267 *) args;
    struct futhark_context *ctx = futhark_mc_task_129267->ctx;
    struct mc_event *event_129275 = mc_event_new(ctx);
    
    if (event_129275 != NULL)
        event_129275->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129267->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_129267->free_eta_p_106382;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_129267->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112567 = {.desc ="mem_112567", .mem =futhark_mc_task_129267->free_mem_112567, .size =0, .references =NULL};
    struct memblock mem_112569 = {.desc ="mem_112569", .mem =futhark_mc_task_129267->free_mem_112569, .size =0, .references =NULL};
    int64_t flat_tid_121821 = futhark_mc_task_129267->free_flat_tid_121821;
    int64_t flat_tid_121862 = futhark_mc_task_129267->free_flat_tid_121862;
    double defunc_res_110370 = *futhark_mc_task_129267->retval_defunc_res_110370;
    double defunc_res_110371 = *futhark_mc_task_129267->retval_defunc_res_110371;
    int64_t reduce_stage_1_tid_res_arr_mem_127059_cached_sizze_129269 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_127059 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_127061_cached_sizze_129270 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_127061 = NULL;
    int32_t nsubtasks_127058;
    
    nsubtasks_127058 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_127059_cached_sizze_129269 < (int64_t) 8 * nsubtasks_127058) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_127059, &reduce_stage_1_tid_res_arr_mem_127059_cached_sizze_129269, (int64_t) 8 * nsubtasks_127058);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_127061_cached_sizze_129270 < (int64_t) 8 * nsubtasks_127058) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_127061, &reduce_stage_1_tid_res_arr_mem_127061_cached_sizze_129270, (int64_t) 8 * nsubtasks_127058);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_129271 futhark_mc_segred_stage_1_parloop_struct_129271_;
    
    futhark_mc_segred_stage_1_parloop_struct_129271_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_129271_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_129271_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_129271_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_129271_.free_mem_112567 = mem_112567.mem;
    futhark_mc_segred_stage_1_parloop_struct_129271_.free_mem_112569 = mem_112569.mem;
    futhark_mc_segred_stage_1_parloop_struct_129271_.free_reduce_stage_1_tid_res_arr_mem_127059 = reduce_stage_1_tid_res_arr_mem_127059;
    futhark_mc_segred_stage_1_parloop_struct_129271_.free_reduce_stage_1_tid_res_arr_mem_127061 = reduce_stage_1_tid_res_arr_mem_127061;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_129272_task;
    
    futhark_mc_segred_stage_1_parloop_129272_task.name = "futhark_mc_segred_stage_1_parloop_129272";
    futhark_mc_segred_stage_1_parloop_129272_task.fn = futhark_mc_segred_stage_1_parloop_129272;
    futhark_mc_segred_stage_1_parloop_129272_task.args = &futhark_mc_segred_stage_1_parloop_struct_129271_;
    futhark_mc_segred_stage_1_parloop_129272_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_129272_task.info = info;
    
    struct mc_event *event_129274 = mc_event_new(ctx);
    
    if (event_129274 != NULL)
        event_129274->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_129272_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_129272_task);
    
    if (futhark_mc_segred_stage_1_parloop_129272_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_129272_err;
        goto cleanup;
    }
    if (event_129274 != NULL) {
        event_129274->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129272_total", strdup("nothing further"), event_129274, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_110370 = 0.0;
        defunc_res_110371 = 0.0;
    }
    
    double eta_p_127080;
    double eta_p_127081;
    double eta_p_127083;
    double eta_p_127084;
    
    for (int32_t i_127086 = 0; i_127086 < nsubtasks_127058; i_127086++) {
        flat_tid_121862 = i_127086;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_127080 = defunc_res_110370;
            }
            // load next params
            {
                eta_p_127081 = ((double *) reduce_stage_1_tid_res_arr_mem_127059)[flat_tid_121862];
            }
            // red body
            {
                double zp_res_127082 = eta_p_127080 + eta_p_127081;
                
                defunc_res_110370 = zp_res_127082;
            }
            // load acc params
            {
                eta_p_127083 = defunc_res_110371;
            }
            // load next params
            {
                eta_p_127084 = ((double *) reduce_stage_1_tid_res_arr_mem_127061)[flat_tid_121862];
            }
            // red body
            {
                double zp_res_127085 = eta_p_127083 + eta_p_127084;
                
                defunc_res_110371 = zp_res_127085;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_127059);
        free(reduce_stage_1_tid_res_arr_mem_127061);
    }
    if (event_129275 != NULL) {
        event_129275->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_129268", strdup("nothing further"), event_129275, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_129267->retval_defunc_res_110370 = defunc_res_110370;
        *futhark_mc_task_129267->retval_defunc_res_110371 = defunc_res_110371;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_129279 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_112567;
    unsigned char *free_mem_112569;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_127088;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_127090;
};
struct futhark_mc_task_129281 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_112567;
    unsigned char *free_mem_112569;
    double free_eta_p_121829;
    double free_eta_p_121830;
    double free_eta_p_121831;
    int64_t free_flat_tid_121834;
    double *retval_defunc_res_121832;
    double *retval_defunc_res_121833;
};
struct futhark_mc_segred_stage_1_parloop_struct_129285 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_eta_p_106382;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_112567;
    unsigned char *free_mem_112569;
    double free_eta_p_121829;
    double free_eta_p_121830;
    double free_eta_p_121831;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_127107;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_127109;
};
static int futhark_mc_segred_stage_1_parloop_129286(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_129285 *futhark_mc_segred_stage_1_parloop_struct_129285 = (struct futhark_mc_segred_stage_1_parloop_struct_129285 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_129285->ctx;
    struct mc_event *event_129287 = mc_event_new(ctx);
    
    if (event_129287 != NULL)
        event_129287->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_129285->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_129285->free_eta_p_106382;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_129285->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112567 = {.desc ="mem_112567", .mem =futhark_mc_segred_stage_1_parloop_struct_129285->free_mem_112567, .size =0, .references =NULL};
    struct memblock mem_112569 = {.desc ="mem_112569", .mem =futhark_mc_segred_stage_1_parloop_struct_129285->free_mem_112569, .size =0, .references =NULL};
    double eta_p_121829 = futhark_mc_segred_stage_1_parloop_struct_129285->free_eta_p_121829;
    double eta_p_121830 = futhark_mc_segred_stage_1_parloop_struct_129285->free_eta_p_121830;
    double eta_p_121831 = futhark_mc_segred_stage_1_parloop_struct_129285->free_eta_p_121831;
    struct memblock reduce_stage_1_tid_res_arr_mem_127107 = {.desc ="reduce_stage_1_tid_res_arr_mem_127107", .mem =futhark_mc_segred_stage_1_parloop_struct_129285->free_reduce_stage_1_tid_res_arr_mem_127107, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_127109 = {.desc ="reduce_stage_1_tid_res_arr_mem_127109", .mem =futhark_mc_segred_stage_1_parloop_struct_129285->free_reduce_stage_1_tid_res_arr_mem_127109, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121834;
    
    flat_tid_121834 = subtask_id;
    {
        double eta_p_127111;
        double eta_p_127112;
        double eta_p_127114;
        double eta_p_127115;
        double local_acc_127117 = 0.0;
        double local_acc_127118 = 0.0;
        double eta_p_121836;
        double eta_p_121837;
        double eta_p_121839;
        double eta_p_121840;
        double local_acc_127119 = 0.0;
        double local_acc_127120 = 0.0;
        int64_t start_127121;
        int64_t end_127122;
        
        start_127121 = start;
        end_127122 = end;
        
        int64_t n_127123 = end_127122 - start_127121;
        
        for (int64_t SegRed_i_127124 = start_127121; SegRed_i_127124 < start_127121 + n_127123; SegRed_i_127124++) {
            int64_t gtid_121835 = SegRed_i_127124;
            double eta_p_121842 = ((double *) mem_112567.mem)[gtid_121835];
            double eta_p_121843 = ((double *) distrs_mem_111708.mem)[eta_p_106382 * m_33388 + gtid_121835];
            double eta_p_121844 = ((double *) mem_112569.mem)[gtid_121835];
            double zt_res_121845 = eta_p_121830 * eta_p_121843;
            double zt_res_121846 = eta_p_121831 * eta_p_121844;
            bool zeze_res_121847 = zt_res_121846 == 0.0;
            double kl_res_121848;
            
            if (zeze_res_121847) {
                kl_res_121848 = zt_res_121845;
            } else {
                double zs_res_121849 = zt_res_121846 / zt_res_121845;
                double log_res_121850 = futrts_log64(zs_res_121849);
                double zt_res_121851 = zt_res_121846 * log_res_121850;
                double zm_res_121852 = zt_res_121851 - zt_res_121846;
                double zp_res_121853 = zt_res_121845 + zm_res_121852;
                
                kl_res_121848 = zp_res_121853;
            }
            
            double zt_res_121854 = eta_p_121829 * eta_p_121842;
            bool zeze_res_121855 = zt_res_121854 == 0.0;
            double kl_res_121856;
            
            if (zeze_res_121855) {
                kl_res_121856 = zt_res_121845;
            } else {
                double zs_res_121857 = zt_res_121854 / zt_res_121845;
                double log_res_121858 = futrts_log64(zs_res_121857);
                double zt_res_121859 = zt_res_121854 * log_res_121858;
                double zm_res_121860 = zt_res_121859 - zt_res_121854;
                double zp_res_121861 = zt_res_121845 + zm_res_121860;
                
                kl_res_121856 = zp_res_121861;
            }
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_121836 = local_acc_127119;
            }
            // Load next params
            {
                eta_p_121837 = kl_res_121848;
            }
            // SegRed body
            {
                double zp_res_121838 = eta_p_121836 + eta_p_121837;
                
                local_acc_127119 = zp_res_121838;
            }
            // Load accum params
            {
                eta_p_121839 = local_acc_127120;
            }
            // Load next params
            {
                eta_p_121840 = kl_res_121856;
            }
            // SegRed body
            {
                double zp_res_121841 = eta_p_121839 + eta_p_121840;
                
                local_acc_127120 = zp_res_121841;
            }
        }
        
        int64_t uni_i_127125 = 0;
        
        {
            int64_t gtid_121835 = uni_i_127125;
            
            // Load accum params
            {
                eta_p_127111 = local_acc_127117;
            }
            // Load next params
            {
                eta_p_127112 = local_acc_127119;
            }
            // SegRed body
            {
                double zp_res_127113 = eta_p_127111 + eta_p_127112;
                
                local_acc_127117 = zp_res_127113;
            }
            // Load accum params
            {
                eta_p_127114 = local_acc_127118;
            }
            // Load next params
            {
                eta_p_127115 = local_acc_127120;
            }
            // SegRed body
            {
                double zp_res_127116 = eta_p_127114 + eta_p_127115;
                
                local_acc_127118 = zp_res_127116;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_127107.mem)[flat_tid_121834] = local_acc_127117;
        ((double *) reduce_stage_1_tid_res_arr_mem_127109.mem)[flat_tid_121834] = local_acc_127118;
    }
    
  cleanup:
    { }
    if (event_129287 != NULL) {
        event_129287->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129286", strdup("nothing further"), event_129287, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_129282(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129281 *futhark_mc_task_129281 = (struct futhark_mc_task_129281 *) args;
    struct futhark_context *ctx = futhark_mc_task_129281->ctx;
    struct mc_event *event_129289 = mc_event_new(ctx);
    
    if (event_129289 != NULL)
        event_129289->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129281->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_129281->free_eta_p_106382;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_129281->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112567 = {.desc ="mem_112567", .mem =futhark_mc_task_129281->free_mem_112567, .size =0, .references =NULL};
    struct memblock mem_112569 = {.desc ="mem_112569", .mem =futhark_mc_task_129281->free_mem_112569, .size =0, .references =NULL};
    double eta_p_121829 = futhark_mc_task_129281->free_eta_p_121829;
    double eta_p_121830 = futhark_mc_task_129281->free_eta_p_121830;
    double eta_p_121831 = futhark_mc_task_129281->free_eta_p_121831;
    int64_t flat_tid_121834 = futhark_mc_task_129281->free_flat_tid_121834;
    double defunc_res_121832 = *futhark_mc_task_129281->retval_defunc_res_121832;
    double defunc_res_121833 = *futhark_mc_task_129281->retval_defunc_res_121833;
    int64_t reduce_stage_1_tid_res_arr_mem_127107_cached_sizze_129283 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_127107 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_127109_cached_sizze_129284 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_127109 = NULL;
    int32_t nsubtasks_127106;
    
    nsubtasks_127106 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_127107_cached_sizze_129283 < (int64_t) 8 * nsubtasks_127106) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_127107, &reduce_stage_1_tid_res_arr_mem_127107_cached_sizze_129283, (int64_t) 8 * nsubtasks_127106);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_127109_cached_sizze_129284 < (int64_t) 8 * nsubtasks_127106) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_127109, &reduce_stage_1_tid_res_arr_mem_127109_cached_sizze_129284, (int64_t) 8 * nsubtasks_127106);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_129285 futhark_mc_segred_stage_1_parloop_struct_129285_;
    
    futhark_mc_segred_stage_1_parloop_struct_129285_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_129285_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_129285_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_129285_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_129285_.free_mem_112567 = mem_112567.mem;
    futhark_mc_segred_stage_1_parloop_struct_129285_.free_mem_112569 = mem_112569.mem;
    futhark_mc_segred_stage_1_parloop_struct_129285_.free_eta_p_121829 = eta_p_121829;
    futhark_mc_segred_stage_1_parloop_struct_129285_.free_eta_p_121830 = eta_p_121830;
    futhark_mc_segred_stage_1_parloop_struct_129285_.free_eta_p_121831 = eta_p_121831;
    futhark_mc_segred_stage_1_parloop_struct_129285_.free_reduce_stage_1_tid_res_arr_mem_127107 = reduce_stage_1_tid_res_arr_mem_127107;
    futhark_mc_segred_stage_1_parloop_struct_129285_.free_reduce_stage_1_tid_res_arr_mem_127109 = reduce_stage_1_tid_res_arr_mem_127109;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_129286_task;
    
    futhark_mc_segred_stage_1_parloop_129286_task.name = "futhark_mc_segred_stage_1_parloop_129286";
    futhark_mc_segred_stage_1_parloop_129286_task.fn = futhark_mc_segred_stage_1_parloop_129286;
    futhark_mc_segred_stage_1_parloop_129286_task.args = &futhark_mc_segred_stage_1_parloop_struct_129285_;
    futhark_mc_segred_stage_1_parloop_129286_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_129286_task.info = info;
    
    struct mc_event *event_129288 = mc_event_new(ctx);
    
    if (event_129288 != NULL)
        event_129288->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_129286_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_129286_task);
    
    if (futhark_mc_segred_stage_1_parloop_129286_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_129286_err;
        goto cleanup;
    }
    if (event_129288 != NULL) {
        event_129288->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129286_total", strdup("nothing further"), event_129288, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_121832 = 0.0;
        defunc_res_121833 = 0.0;
    }
    
    double eta_p_127126;
    double eta_p_127127;
    double eta_p_127129;
    double eta_p_127130;
    
    for (int32_t i_127132 = 0; i_127132 < nsubtasks_127106; i_127132++) {
        flat_tid_121834 = i_127132;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_127126 = defunc_res_121832;
            }
            // load next params
            {
                eta_p_127127 = ((double *) reduce_stage_1_tid_res_arr_mem_127107)[flat_tid_121834];
            }
            // red body
            {
                double zp_res_127128 = eta_p_127126 + eta_p_127127;
                
                defunc_res_121832 = zp_res_127128;
            }
            // load acc params
            {
                eta_p_127129 = defunc_res_121833;
            }
            // load next params
            {
                eta_p_127130 = ((double *) reduce_stage_1_tid_res_arr_mem_127109)[flat_tid_121834];
            }
            // red body
            {
                double zp_res_127131 = eta_p_127129 + eta_p_127130;
                
                defunc_res_121833 = zp_res_127131;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_127107);
        free(reduce_stage_1_tid_res_arr_mem_127109);
    }
    if (event_129289 != NULL) {
        event_129289->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_129282", strdup("nothing further"), event_129289, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_129281->retval_defunc_res_121832 = defunc_res_121832;
        *futhark_mc_task_129281->retval_defunc_res_121833 = defunc_res_121833;
    }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_129280(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_129279 *futhark_mc_segred_stage_1_parloop_struct_129279 = (struct futhark_mc_segred_stage_1_parloop_struct_129279 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_129279->ctx;
    struct mc_event *event_129290 = mc_event_new(ctx);
    
    if (event_129290 != NULL)
        event_129290->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_129279->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_segred_stage_1_parloop_struct_129279->free_eta_p_106382;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_129279->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112567 = {.desc ="mem_112567", .mem =futhark_mc_segred_stage_1_parloop_struct_129279->free_mem_112567, .size =0, .references =NULL};
    struct memblock mem_112569 = {.desc ="mem_112569", .mem =futhark_mc_segred_stage_1_parloop_struct_129279->free_mem_112569, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_127088 = {.desc ="reduce_stage_1_tid_res_arr_mem_127088", .mem =futhark_mc_segred_stage_1_parloop_struct_129279->free_reduce_stage_1_tid_res_arr_mem_127088, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_127090 = {.desc ="reduce_stage_1_tid_res_arr_mem_127090", .mem =futhark_mc_segred_stage_1_parloop_struct_129279->free_reduce_stage_1_tid_res_arr_mem_127090, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121821;
    
    flat_tid_121821 = subtask_id;
    {
        double eta_p_127092;
        double eta_p_127093;
        double eta_p_127095;
        double eta_p_127096;
        double local_acc_127098 = 0.0;
        double local_acc_127099 = 0.0;
        double eta_p_121823;
        double eta_p_121824;
        double eta_p_121826;
        double eta_p_121827;
        double local_acc_127100 = 0.0;
        double local_acc_127101 = 0.0;
        int64_t start_127102;
        int64_t end_127103;
        
        start_127102 = start;
        end_127103 = end;
        
        int64_t n_127104 = end_127103 - start_127102;
        
        for (int64_t SegRed_i_127105 = start_127102; SegRed_i_127105 < start_127102 + n_127104; SegRed_i_127105++) {
            int64_t gtid_121822 = SegRed_i_127105;
            double eta_p_121829 = ((double *) mem_112567.mem)[gtid_121822];
            double eta_p_121830 = ((double *) distrs_mem_111708.mem)[eta_p_106382 * m_33388 + gtid_121822];
            double eta_p_121831 = ((double *) mem_112569.mem)[gtid_121822];
            double defunc_res_121832;
            double defunc_res_121833;
            int64_t flat_tid_121834 = (int64_t) 0;
            
            defunc_res_121832 = 0.0;
            defunc_res_121833 = 0.0;
            
            struct futhark_mc_task_129281 futhark_mc_task_129281_;
            
            futhark_mc_task_129281_.ctx = ctx;
            futhark_mc_task_129281_.free_m_33388 = m_33388;
            futhark_mc_task_129281_.free_eta_p_106382 = eta_p_106382;
            futhark_mc_task_129281_.free_distrs_mem_111708 = distrs_mem_111708.mem;
            futhark_mc_task_129281_.free_mem_112567 = mem_112567.mem;
            futhark_mc_task_129281_.free_mem_112569 = mem_112569.mem;
            futhark_mc_task_129281_.free_eta_p_121829 = eta_p_121829;
            futhark_mc_task_129281_.free_eta_p_121830 = eta_p_121830;
            futhark_mc_task_129281_.free_eta_p_121831 = eta_p_121831;
            futhark_mc_task_129281_.free_flat_tid_121834 = flat_tid_121834;
            futhark_mc_task_129281_.retval_defunc_res_121832 = (double *) &defunc_res_121832;
            #if ISPC
            futhark_mc_task_129281_.retval_defunc_res_121832 += programIndex;
            #endif
            futhark_mc_task_129281_.retval_defunc_res_121833 = (double *) &defunc_res_121833;
            #if ISPC
            futhark_mc_task_129281_.retval_defunc_res_121833 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_129281_task;
            
            futhark_mc_task_129281_task.args = &futhark_mc_task_129281_;
            futhark_mc_task_129281_task.top_level_fn = futhark_mc_segred_task_129282;
            futhark_mc_task_129281_task.name = "futhark_mc_segred_task_129282";
            futhark_mc_task_129281_task.iterations = m_33388;
            futhark_mc_task_129281_task.task_time = &ctx->program->futhark_mc_segred_task_129282_total_time;
            futhark_mc_task_129281_task.task_iter = &ctx->program->futhark_mc_segred_task_129282_total_iter;
            futhark_mc_task_129281_task.sched = STATIC;
            futhark_mc_task_129281_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_129282_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_129281_task);
            
            if (futhark_mc_segred_task_129282_err != 0) {
                err = futhark_mc_segred_task_129282_err;
                goto cleanup;
            }
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_121823 = local_acc_127100;
            }
            // Load next params
            {
                eta_p_121824 = defunc_res_121832;
            }
            // SegRed body
            {
                double zp_res_121825 = eta_p_121823 + eta_p_121824;
                
                local_acc_127100 = zp_res_121825;
            }
            // Load accum params
            {
                eta_p_121826 = local_acc_127101;
            }
            // Load next params
            {
                eta_p_121827 = defunc_res_121833;
            }
            // SegRed body
            {
                double zp_res_121828 = eta_p_121826 + eta_p_121827;
                
                local_acc_127101 = zp_res_121828;
            }
        }
        
        int64_t uni_i_127133 = 0;
        
        {
            int64_t gtid_121822 = uni_i_127133;
            
            // Load accum params
            {
                eta_p_127092 = local_acc_127098;
            }
            // Load next params
            {
                eta_p_127093 = local_acc_127100;
            }
            // SegRed body
            {
                double zp_res_127094 = eta_p_127092 + eta_p_127093;
                
                local_acc_127098 = zp_res_127094;
            }
            // Load accum params
            {
                eta_p_127095 = local_acc_127099;
            }
            // Load next params
            {
                eta_p_127096 = local_acc_127101;
            }
            // SegRed body
            {
                double zp_res_127097 = eta_p_127095 + eta_p_127096;
                
                local_acc_127099 = zp_res_127097;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_127088.mem)[flat_tid_121821] = local_acc_127098;
        ((double *) reduce_stage_1_tid_res_arr_mem_127090.mem)[flat_tid_121821] = local_acc_127099;
    }
    
  cleanup:
    { }
    if (event_129290 != NULL) {
        event_129290->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129280", strdup("nothing further"), event_129290, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_129276(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129267 *futhark_mc_task_129267 = (struct futhark_mc_task_129267 *) args;
    struct futhark_context *ctx = futhark_mc_task_129267->ctx;
    struct mc_event *event_129292 = mc_event_new(ctx);
    
    if (event_129292 != NULL)
        event_129292->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129267->free_m_33388;
    int64_t eta_p_106382 = futhark_mc_task_129267->free_eta_p_106382;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_129267->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112567 = {.desc ="mem_112567", .mem =futhark_mc_task_129267->free_mem_112567, .size =0, .references =NULL};
    struct memblock mem_112569 = {.desc ="mem_112569", .mem =futhark_mc_task_129267->free_mem_112569, .size =0, .references =NULL};
    int64_t flat_tid_121821 = futhark_mc_task_129267->free_flat_tid_121821;
    int64_t flat_tid_121862 = futhark_mc_task_129267->free_flat_tid_121862;
    double defunc_res_110370 = *futhark_mc_task_129267->retval_defunc_res_110370;
    double defunc_res_110371 = *futhark_mc_task_129267->retval_defunc_res_110371;
    int64_t reduce_stage_1_tid_res_arr_mem_127088_cached_sizze_129277 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_127088 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_127090_cached_sizze_129278 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_127090 = NULL;
    int32_t nsubtasks_127087;
    
    nsubtasks_127087 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_127088_cached_sizze_129277 < (int64_t) 8 * nsubtasks_127087) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_127088, &reduce_stage_1_tid_res_arr_mem_127088_cached_sizze_129277, (int64_t) 8 * nsubtasks_127087);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_127090_cached_sizze_129278 < (int64_t) 8 * nsubtasks_127087) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_127090, &reduce_stage_1_tid_res_arr_mem_127090_cached_sizze_129278, (int64_t) 8 * nsubtasks_127087);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_129279 futhark_mc_segred_stage_1_parloop_struct_129279_;
    
    futhark_mc_segred_stage_1_parloop_struct_129279_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_129279_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_129279_.free_eta_p_106382 = eta_p_106382;
    futhark_mc_segred_stage_1_parloop_struct_129279_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_129279_.free_mem_112567 = mem_112567.mem;
    futhark_mc_segred_stage_1_parloop_struct_129279_.free_mem_112569 = mem_112569.mem;
    futhark_mc_segred_stage_1_parloop_struct_129279_.free_reduce_stage_1_tid_res_arr_mem_127088 = reduce_stage_1_tid_res_arr_mem_127088;
    futhark_mc_segred_stage_1_parloop_struct_129279_.free_reduce_stage_1_tid_res_arr_mem_127090 = reduce_stage_1_tid_res_arr_mem_127090;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_129280_task;
    
    futhark_mc_segred_stage_1_parloop_129280_task.name = "futhark_mc_segred_stage_1_parloop_129280";
    futhark_mc_segred_stage_1_parloop_129280_task.fn = futhark_mc_segred_stage_1_parloop_129280;
    futhark_mc_segred_stage_1_parloop_129280_task.args = &futhark_mc_segred_stage_1_parloop_struct_129279_;
    futhark_mc_segred_stage_1_parloop_129280_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_129280_task.info = info;
    
    struct mc_event *event_129291 = mc_event_new(ctx);
    
    if (event_129291 != NULL)
        event_129291->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_129280_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_129280_task);
    
    if (futhark_mc_segred_stage_1_parloop_129280_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_129280_err;
        goto cleanup;
    }
    if (event_129291 != NULL) {
        event_129291->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129280_total", strdup("nothing further"), event_129291, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_110370 = 0.0;
        defunc_res_110371 = 0.0;
    }
    
    double eta_p_127134;
    double eta_p_127135;
    double eta_p_127137;
    double eta_p_127138;
    
    for (int32_t i_127140 = 0; i_127140 < nsubtasks_127087; i_127140++) {
        flat_tid_121821 = i_127140;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_127134 = defunc_res_110370;
            }
            // load next params
            {
                eta_p_127135 = ((double *) reduce_stage_1_tid_res_arr_mem_127088)[flat_tid_121821];
            }
            // red body
            {
                double zp_res_127136 = eta_p_127134 + eta_p_127135;
                
                defunc_res_110370 = zp_res_127136;
            }
            // load acc params
            {
                eta_p_127137 = defunc_res_110371;
            }
            // load next params
            {
                eta_p_127138 = ((double *) reduce_stage_1_tid_res_arr_mem_127090)[flat_tid_121821];
            }
            // red body
            {
                double zp_res_127139 = eta_p_127137 + eta_p_127138;
                
                defunc_res_110371 = zp_res_127139;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_127088);
        free(reduce_stage_1_tid_res_arr_mem_127090);
    }
    if (event_129292 != NULL) {
        event_129292->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_129276", strdup("nothing further"), event_129292, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_129267->retval_defunc_res_110370 = defunc_res_110370;
        *futhark_mc_task_129267->retval_defunc_res_110371 = defunc_res_110371;
    }
    return err;
}
struct futhark_mc_task_129293 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_112573;
    unsigned char *free_mem_112575;
    int64_t free_flat_tid_121900;
    int64_t free_flat_tid_121941;
    double *retval_defunc_res_110452;
    double *retval_defunc_res_110453;
};
struct futhark_mc_segred_stage_1_parloop_struct_129297 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_112573;
    unsigned char *free_mem_112575;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_127142;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_127144;
};
static int futhark_mc_segred_stage_1_parloop_129298(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_129297 *futhark_mc_segred_stage_1_parloop_struct_129297 = (struct futhark_mc_segred_stage_1_parloop_struct_129297 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_129297->ctx;
    struct mc_event *event_129299 = mc_event_new(ctx);
    
    if (event_129299 != NULL)
        event_129299->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_129297->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_129297->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_129297->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112573 = {.desc ="mem_112573", .mem =futhark_mc_segred_stage_1_parloop_struct_129297->free_mem_112573, .size =0, .references =NULL};
    struct memblock mem_112575 = {.desc ="mem_112575", .mem =futhark_mc_segred_stage_1_parloop_struct_129297->free_mem_112575, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_127142 = {.desc ="reduce_stage_1_tid_res_arr_mem_127142", .mem =futhark_mc_segred_stage_1_parloop_struct_129297->free_reduce_stage_1_tid_res_arr_mem_127142, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_127144 = {.desc ="reduce_stage_1_tid_res_arr_mem_127144", .mem =futhark_mc_segred_stage_1_parloop_struct_129297->free_reduce_stage_1_tid_res_arr_mem_127144, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121941;
    
    flat_tid_121941 = subtask_id;
    {
        double eta_p_127146;
        double eta_p_127147;
        double eta_p_127149;
        double eta_p_127150;
        double local_acc_127152 = 0.0;
        double local_acc_127153 = 0.0;
        double eta_p_121943;
        double eta_p_121944;
        double eta_p_121946;
        double eta_p_121947;
        double local_acc_127154 = 0.0;
        double local_acc_127155 = 0.0;
        int64_t start_127156;
        int64_t end_127157;
        
        start_127156 = start;
        end_127157 = end;
        
        int64_t n_127158 = end_127157 - start_127156;
        
        for (int64_t SegRed_i_127159 = start_127156; SegRed_i_127159 < start_127156 + n_127158; SegRed_i_127159++) {
            int64_t gtid_121942 = SegRed_i_127159;
            double eta_p_121949 = ((double *) mem_112573.mem)[gtid_121942];
            double eta_p_121950 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + gtid_121942];
            double eta_p_121951 = ((double *) mem_112575.mem)[gtid_121942];
            double defunc_res_121952;
            double defunc_res_121953;
            double redout_121955;
            double redout_121956;
            
            redout_121955 = 0.0;
            redout_121956 = 0.0;
            for (int64_t i_121954 = 0; i_121954 < m_33388; i_121954++) {
                double eta_p_121957 = ((double *) mem_112573.mem)[i_121954];
                double eta_p_121958 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + i_121954];
                double eta_p_121959 = ((double *) mem_112575.mem)[i_121954];
                double zt_res_121960 = eta_p_121950 * eta_p_121958;
                double zt_res_121961 = eta_p_121951 * eta_p_121959;
                bool zeze_res_121962 = zt_res_121961 == 0.0;
                double kl_res_121963;
                
                if (zeze_res_121962) {
                    kl_res_121963 = zt_res_121960;
                } else {
                    double zs_res_121964 = zt_res_121961 / zt_res_121960;
                    double log_res_121965 = futrts_log64(zs_res_121964);
                    double zt_res_121966 = zt_res_121961 * log_res_121965;
                    double zm_res_121967 = zt_res_121966 - zt_res_121961;
                    double zp_res_121968 = zt_res_121960 + zm_res_121967;
                    
                    kl_res_121963 = zp_res_121968;
                }
                
                double zt_res_121969 = eta_p_121949 * eta_p_121957;
                bool zeze_res_121970 = zt_res_121969 == 0.0;
                double kl_res_121971;
                
                if (zeze_res_121970) {
                    kl_res_121971 = zt_res_121960;
                } else {
                    double zs_res_121972 = zt_res_121969 / zt_res_121960;
                    double log_res_121973 = futrts_log64(zs_res_121972);
                    double zt_res_121974 = zt_res_121969 * log_res_121973;
                    double zm_res_121975 = zt_res_121974 - zt_res_121969;
                    double zp_res_121976 = zt_res_121960 + zm_res_121975;
                    
                    kl_res_121971 = zp_res_121976;
                }
                
                double zp_res_121977 = kl_res_121963 + redout_121955;
                double zp_res_121978 = kl_res_121971 + redout_121956;
                double redout_tmp_127160 = zp_res_121977;
                double redout_tmp_127161 = zp_res_121978;
                
                redout_121955 = redout_tmp_127160;
                redout_121956 = redout_tmp_127161;
            }
            defunc_res_121952 = redout_121955;
            defunc_res_121953 = redout_121956;
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_121943 = local_acc_127154;
            }
            // Load next params
            {
                eta_p_121944 = defunc_res_121952;
            }
            // SegRed body
            {
                double zp_res_121945 = eta_p_121943 + eta_p_121944;
                
                local_acc_127154 = zp_res_121945;
            }
            // Load accum params
            {
                eta_p_121946 = local_acc_127155;
            }
            // Load next params
            {
                eta_p_121947 = defunc_res_121953;
            }
            // SegRed body
            {
                double zp_res_121948 = eta_p_121946 + eta_p_121947;
                
                local_acc_127155 = zp_res_121948;
            }
        }
        
        int64_t uni_i_127162 = 0;
        
        {
            int64_t gtid_121942 = uni_i_127162;
            
            // Load accum params
            {
                eta_p_127146 = local_acc_127152;
            }
            // Load next params
            {
                eta_p_127147 = local_acc_127154;
            }
            // SegRed body
            {
                double zp_res_127148 = eta_p_127146 + eta_p_127147;
                
                local_acc_127152 = zp_res_127148;
            }
            // Load accum params
            {
                eta_p_127149 = local_acc_127153;
            }
            // Load next params
            {
                eta_p_127150 = local_acc_127155;
            }
            // SegRed body
            {
                double zp_res_127151 = eta_p_127149 + eta_p_127150;
                
                local_acc_127153 = zp_res_127151;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_127142.mem)[flat_tid_121941] = local_acc_127152;
        ((double *) reduce_stage_1_tid_res_arr_mem_127144.mem)[flat_tid_121941] = local_acc_127153;
    }
    
  cleanup:
    { }
    if (event_129299 != NULL) {
        event_129299->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129298", strdup("nothing further"), event_129299, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_129294(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129293 *futhark_mc_task_129293 = (struct futhark_mc_task_129293 *) args;
    struct futhark_context *ctx = futhark_mc_task_129293->ctx;
    struct mc_event *event_129301 = mc_event_new(ctx);
    
    if (event_129301 != NULL)
        event_129301->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129293->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_129293->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_129293->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112573 = {.desc ="mem_112573", .mem =futhark_mc_task_129293->free_mem_112573, .size =0, .references =NULL};
    struct memblock mem_112575 = {.desc ="mem_112575", .mem =futhark_mc_task_129293->free_mem_112575, .size =0, .references =NULL};
    int64_t flat_tid_121900 = futhark_mc_task_129293->free_flat_tid_121900;
    int64_t flat_tid_121941 = futhark_mc_task_129293->free_flat_tid_121941;
    double defunc_res_110452 = *futhark_mc_task_129293->retval_defunc_res_110452;
    double defunc_res_110453 = *futhark_mc_task_129293->retval_defunc_res_110453;
    int64_t reduce_stage_1_tid_res_arr_mem_127142_cached_sizze_129295 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_127142 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_127144_cached_sizze_129296 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_127144 = NULL;
    int32_t nsubtasks_127141;
    
    nsubtasks_127141 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_127142_cached_sizze_129295 < (int64_t) 8 * nsubtasks_127141) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_127142, &reduce_stage_1_tid_res_arr_mem_127142_cached_sizze_129295, (int64_t) 8 * nsubtasks_127141);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_127144_cached_sizze_129296 < (int64_t) 8 * nsubtasks_127141) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_127144, &reduce_stage_1_tid_res_arr_mem_127144_cached_sizze_129296, (int64_t) 8 * nsubtasks_127141);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_129297 futhark_mc_segred_stage_1_parloop_struct_129297_;
    
    futhark_mc_segred_stage_1_parloop_struct_129297_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_129297_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_129297_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_129297_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_129297_.free_mem_112573 = mem_112573.mem;
    futhark_mc_segred_stage_1_parloop_struct_129297_.free_mem_112575 = mem_112575.mem;
    futhark_mc_segred_stage_1_parloop_struct_129297_.free_reduce_stage_1_tid_res_arr_mem_127142 = reduce_stage_1_tid_res_arr_mem_127142;
    futhark_mc_segred_stage_1_parloop_struct_129297_.free_reduce_stage_1_tid_res_arr_mem_127144 = reduce_stage_1_tid_res_arr_mem_127144;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_129298_task;
    
    futhark_mc_segred_stage_1_parloop_129298_task.name = "futhark_mc_segred_stage_1_parloop_129298";
    futhark_mc_segred_stage_1_parloop_129298_task.fn = futhark_mc_segred_stage_1_parloop_129298;
    futhark_mc_segred_stage_1_parloop_129298_task.args = &futhark_mc_segred_stage_1_parloop_struct_129297_;
    futhark_mc_segred_stage_1_parloop_129298_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_129298_task.info = info;
    
    struct mc_event *event_129300 = mc_event_new(ctx);
    
    if (event_129300 != NULL)
        event_129300->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_129298_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_129298_task);
    
    if (futhark_mc_segred_stage_1_parloop_129298_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_129298_err;
        goto cleanup;
    }
    if (event_129300 != NULL) {
        event_129300->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129298_total", strdup("nothing further"), event_129300, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_110452 = 0.0;
        defunc_res_110453 = 0.0;
    }
    
    double eta_p_127163;
    double eta_p_127164;
    double eta_p_127166;
    double eta_p_127167;
    
    for (int32_t i_127169 = 0; i_127169 < nsubtasks_127141; i_127169++) {
        flat_tid_121941 = i_127169;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_127163 = defunc_res_110452;
            }
            // load next params
            {
                eta_p_127164 = ((double *) reduce_stage_1_tid_res_arr_mem_127142)[flat_tid_121941];
            }
            // red body
            {
                double zp_res_127165 = eta_p_127163 + eta_p_127164;
                
                defunc_res_110452 = zp_res_127165;
            }
            // load acc params
            {
                eta_p_127166 = defunc_res_110453;
            }
            // load next params
            {
                eta_p_127167 = ((double *) reduce_stage_1_tid_res_arr_mem_127144)[flat_tid_121941];
            }
            // red body
            {
                double zp_res_127168 = eta_p_127166 + eta_p_127167;
                
                defunc_res_110453 = zp_res_127168;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_127142);
        free(reduce_stage_1_tid_res_arr_mem_127144);
    }
    if (event_129301 != NULL) {
        event_129301->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_129294", strdup("nothing further"), event_129301, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_129293->retval_defunc_res_110452 = defunc_res_110452;
        *futhark_mc_task_129293->retval_defunc_res_110453 = defunc_res_110453;
    }
    return err;
}
struct futhark_mc_segred_stage_1_parloop_struct_129305 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_112573;
    unsigned char *free_mem_112575;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_127171;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_127173;
};
struct futhark_mc_task_129307 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_112573;
    unsigned char *free_mem_112575;
    double free_eta_p_121908;
    double free_eta_p_121909;
    double free_eta_p_121910;
    int64_t free_flat_tid_121913;
    double *retval_defunc_res_121911;
    double *retval_defunc_res_121912;
};
struct futhark_mc_segred_stage_1_parloop_struct_129311 {
    struct futhark_context *ctx;
    int64_t free_m_33388;
    int64_t free_lifted_lambda_res_106391;
    unsigned char *free_distrs_mem_111708;
    unsigned char *free_mem_112573;
    unsigned char *free_mem_112575;
    double free_eta_p_121908;
    double free_eta_p_121909;
    double free_eta_p_121910;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_127190;
    unsigned char *free_reduce_stage_1_tid_res_arr_mem_127192;
};
static int futhark_mc_segred_stage_1_parloop_129312(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_129311 *futhark_mc_segred_stage_1_parloop_struct_129311 = (struct futhark_mc_segred_stage_1_parloop_struct_129311 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_129311->ctx;
    struct mc_event *event_129313 = mc_event_new(ctx);
    
    if (event_129313 != NULL)
        event_129313->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_129311->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_129311->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_129311->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112573 = {.desc ="mem_112573", .mem =futhark_mc_segred_stage_1_parloop_struct_129311->free_mem_112573, .size =0, .references =NULL};
    struct memblock mem_112575 = {.desc ="mem_112575", .mem =futhark_mc_segred_stage_1_parloop_struct_129311->free_mem_112575, .size =0, .references =NULL};
    double eta_p_121908 = futhark_mc_segred_stage_1_parloop_struct_129311->free_eta_p_121908;
    double eta_p_121909 = futhark_mc_segred_stage_1_parloop_struct_129311->free_eta_p_121909;
    double eta_p_121910 = futhark_mc_segred_stage_1_parloop_struct_129311->free_eta_p_121910;
    struct memblock reduce_stage_1_tid_res_arr_mem_127190 = {.desc ="reduce_stage_1_tid_res_arr_mem_127190", .mem =futhark_mc_segred_stage_1_parloop_struct_129311->free_reduce_stage_1_tid_res_arr_mem_127190, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_127192 = {.desc ="reduce_stage_1_tid_res_arr_mem_127192", .mem =futhark_mc_segred_stage_1_parloop_struct_129311->free_reduce_stage_1_tid_res_arr_mem_127192, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121913;
    
    flat_tid_121913 = subtask_id;
    {
        double eta_p_127194;
        double eta_p_127195;
        double eta_p_127197;
        double eta_p_127198;
        double local_acc_127200 = 0.0;
        double local_acc_127201 = 0.0;
        double eta_p_121915;
        double eta_p_121916;
        double eta_p_121918;
        double eta_p_121919;
        double local_acc_127202 = 0.0;
        double local_acc_127203 = 0.0;
        int64_t start_127204;
        int64_t end_127205;
        
        start_127204 = start;
        end_127205 = end;
        
        int64_t n_127206 = end_127205 - start_127204;
        
        for (int64_t SegRed_i_127207 = start_127204; SegRed_i_127207 < start_127204 + n_127206; SegRed_i_127207++) {
            int64_t gtid_121914 = SegRed_i_127207;
            double eta_p_121921 = ((double *) mem_112573.mem)[gtid_121914];
            double eta_p_121922 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + gtid_121914];
            double eta_p_121923 = ((double *) mem_112575.mem)[gtid_121914];
            double zt_res_121924 = eta_p_121909 * eta_p_121922;
            double zt_res_121925 = eta_p_121910 * eta_p_121923;
            bool zeze_res_121926 = zt_res_121925 == 0.0;
            double kl_res_121927;
            
            if (zeze_res_121926) {
                kl_res_121927 = zt_res_121924;
            } else {
                double zs_res_121928 = zt_res_121925 / zt_res_121924;
                double log_res_121929 = futrts_log64(zs_res_121928);
                double zt_res_121930 = zt_res_121925 * log_res_121929;
                double zm_res_121931 = zt_res_121930 - zt_res_121925;
                double zp_res_121932 = zt_res_121924 + zm_res_121931;
                
                kl_res_121927 = zp_res_121932;
            }
            
            double zt_res_121933 = eta_p_121908 * eta_p_121921;
            bool zeze_res_121934 = zt_res_121933 == 0.0;
            double kl_res_121935;
            
            if (zeze_res_121934) {
                kl_res_121935 = zt_res_121924;
            } else {
                double zs_res_121936 = zt_res_121933 / zt_res_121924;
                double log_res_121937 = futrts_log64(zs_res_121936);
                double zt_res_121938 = zt_res_121933 * log_res_121937;
                double zm_res_121939 = zt_res_121938 - zt_res_121933;
                double zp_res_121940 = zt_res_121924 + zm_res_121939;
                
                kl_res_121935 = zp_res_121940;
            }
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_121915 = local_acc_127202;
            }
            // Load next params
            {
                eta_p_121916 = kl_res_121927;
            }
            // SegRed body
            {
                double zp_res_121917 = eta_p_121915 + eta_p_121916;
                
                local_acc_127202 = zp_res_121917;
            }
            // Load accum params
            {
                eta_p_121918 = local_acc_127203;
            }
            // Load next params
            {
                eta_p_121919 = kl_res_121935;
            }
            // SegRed body
            {
                double zp_res_121920 = eta_p_121918 + eta_p_121919;
                
                local_acc_127203 = zp_res_121920;
            }
        }
        
        int64_t uni_i_127208 = 0;
        
        {
            int64_t gtid_121914 = uni_i_127208;
            
            // Load accum params
            {
                eta_p_127194 = local_acc_127200;
            }
            // Load next params
            {
                eta_p_127195 = local_acc_127202;
            }
            // SegRed body
            {
                double zp_res_127196 = eta_p_127194 + eta_p_127195;
                
                local_acc_127200 = zp_res_127196;
            }
            // Load accum params
            {
                eta_p_127197 = local_acc_127201;
            }
            // Load next params
            {
                eta_p_127198 = local_acc_127203;
            }
            // SegRed body
            {
                double zp_res_127199 = eta_p_127197 + eta_p_127198;
                
                local_acc_127201 = zp_res_127199;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_127190.mem)[flat_tid_121913] = local_acc_127200;
        ((double *) reduce_stage_1_tid_res_arr_mem_127192.mem)[flat_tid_121913] = local_acc_127201;
    }
    
  cleanup:
    { }
    if (event_129313 != NULL) {
        event_129313->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129312", strdup("nothing further"), event_129313, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_task_129308(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129307 *futhark_mc_task_129307 = (struct futhark_mc_task_129307 *) args;
    struct futhark_context *ctx = futhark_mc_task_129307->ctx;
    struct mc_event *event_129315 = mc_event_new(ctx);
    
    if (event_129315 != NULL)
        event_129315->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129307->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_129307->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_129307->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112573 = {.desc ="mem_112573", .mem =futhark_mc_task_129307->free_mem_112573, .size =0, .references =NULL};
    struct memblock mem_112575 = {.desc ="mem_112575", .mem =futhark_mc_task_129307->free_mem_112575, .size =0, .references =NULL};
    double eta_p_121908 = futhark_mc_task_129307->free_eta_p_121908;
    double eta_p_121909 = futhark_mc_task_129307->free_eta_p_121909;
    double eta_p_121910 = futhark_mc_task_129307->free_eta_p_121910;
    int64_t flat_tid_121913 = futhark_mc_task_129307->free_flat_tid_121913;
    double defunc_res_121911 = *futhark_mc_task_129307->retval_defunc_res_121911;
    double defunc_res_121912 = *futhark_mc_task_129307->retval_defunc_res_121912;
    int64_t reduce_stage_1_tid_res_arr_mem_127190_cached_sizze_129309 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_127190 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_127192_cached_sizze_129310 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_127192 = NULL;
    int32_t nsubtasks_127189;
    
    nsubtasks_127189 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_127190_cached_sizze_129309 < (int64_t) 8 * nsubtasks_127189) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_127190, &reduce_stage_1_tid_res_arr_mem_127190_cached_sizze_129309, (int64_t) 8 * nsubtasks_127189);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_127192_cached_sizze_129310 < (int64_t) 8 * nsubtasks_127189) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_127192, &reduce_stage_1_tid_res_arr_mem_127192_cached_sizze_129310, (int64_t) 8 * nsubtasks_127189);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_129311 futhark_mc_segred_stage_1_parloop_struct_129311_;
    
    futhark_mc_segred_stage_1_parloop_struct_129311_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_129311_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_129311_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_129311_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_129311_.free_mem_112573 = mem_112573.mem;
    futhark_mc_segred_stage_1_parloop_struct_129311_.free_mem_112575 = mem_112575.mem;
    futhark_mc_segred_stage_1_parloop_struct_129311_.free_eta_p_121908 = eta_p_121908;
    futhark_mc_segred_stage_1_parloop_struct_129311_.free_eta_p_121909 = eta_p_121909;
    futhark_mc_segred_stage_1_parloop_struct_129311_.free_eta_p_121910 = eta_p_121910;
    futhark_mc_segred_stage_1_parloop_struct_129311_.free_reduce_stage_1_tid_res_arr_mem_127190 = reduce_stage_1_tid_res_arr_mem_127190;
    futhark_mc_segred_stage_1_parloop_struct_129311_.free_reduce_stage_1_tid_res_arr_mem_127192 = reduce_stage_1_tid_res_arr_mem_127192;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_129312_task;
    
    futhark_mc_segred_stage_1_parloop_129312_task.name = "futhark_mc_segred_stage_1_parloop_129312";
    futhark_mc_segred_stage_1_parloop_129312_task.fn = futhark_mc_segred_stage_1_parloop_129312;
    futhark_mc_segred_stage_1_parloop_129312_task.args = &futhark_mc_segred_stage_1_parloop_struct_129311_;
    futhark_mc_segred_stage_1_parloop_129312_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_129312_task.info = info;
    
    struct mc_event *event_129314 = mc_event_new(ctx);
    
    if (event_129314 != NULL)
        event_129314->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_129312_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_129312_task);
    
    if (futhark_mc_segred_stage_1_parloop_129312_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_129312_err;
        goto cleanup;
    }
    if (event_129314 != NULL) {
        event_129314->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129312_total", strdup("nothing further"), event_129314, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_121911 = 0.0;
        defunc_res_121912 = 0.0;
    }
    
    double eta_p_127209;
    double eta_p_127210;
    double eta_p_127212;
    double eta_p_127213;
    
    for (int32_t i_127215 = 0; i_127215 < nsubtasks_127189; i_127215++) {
        flat_tid_121913 = i_127215;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_127209 = defunc_res_121911;
            }
            // load next params
            {
                eta_p_127210 = ((double *) reduce_stage_1_tid_res_arr_mem_127190)[flat_tid_121913];
            }
            // red body
            {
                double zp_res_127211 = eta_p_127209 + eta_p_127210;
                
                defunc_res_121911 = zp_res_127211;
            }
            // load acc params
            {
                eta_p_127212 = defunc_res_121912;
            }
            // load next params
            {
                eta_p_127213 = ((double *) reduce_stage_1_tid_res_arr_mem_127192)[flat_tid_121913];
            }
            // red body
            {
                double zp_res_127214 = eta_p_127212 + eta_p_127213;
                
                defunc_res_121912 = zp_res_127214;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_127190);
        free(reduce_stage_1_tid_res_arr_mem_127192);
    }
    if (event_129315 != NULL) {
        event_129315->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_task_129308", strdup("nothing further"), event_129315, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_129307->retval_defunc_res_121911 = defunc_res_121911;
        *futhark_mc_task_129307->retval_defunc_res_121912 = defunc_res_121912;
    }
    return err;
}
static int futhark_mc_segred_stage_1_parloop_129306(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segred_stage_1_parloop_struct_129305 *futhark_mc_segred_stage_1_parloop_struct_129305 = (struct futhark_mc_segred_stage_1_parloop_struct_129305 *) args;
    struct futhark_context *ctx = futhark_mc_segred_stage_1_parloop_struct_129305->ctx;
    struct mc_event *event_129316 = mc_event_new(ctx);
    
    if (event_129316 != NULL)
        event_129316->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_segred_stage_1_parloop_struct_129305->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_segred_stage_1_parloop_struct_129305->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segred_stage_1_parloop_struct_129305->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112573 = {.desc ="mem_112573", .mem =futhark_mc_segred_stage_1_parloop_struct_129305->free_mem_112573, .size =0, .references =NULL};
    struct memblock mem_112575 = {.desc ="mem_112575", .mem =futhark_mc_segred_stage_1_parloop_struct_129305->free_mem_112575, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_127171 = {.desc ="reduce_stage_1_tid_res_arr_mem_127171", .mem =futhark_mc_segred_stage_1_parloop_struct_129305->free_reduce_stage_1_tid_res_arr_mem_127171, .size =0, .references =NULL};
    struct memblock reduce_stage_1_tid_res_arr_mem_127173 = {.desc ="reduce_stage_1_tid_res_arr_mem_127173", .mem =futhark_mc_segred_stage_1_parloop_struct_129305->free_reduce_stage_1_tid_res_arr_mem_127173, .size =0, .references =NULL};
    int64_t iterations = end - start;
    int64_t flat_tid_121900;
    
    flat_tid_121900 = subtask_id;
    {
        double eta_p_127175;
        double eta_p_127176;
        double eta_p_127178;
        double eta_p_127179;
        double local_acc_127181 = 0.0;
        double local_acc_127182 = 0.0;
        double eta_p_121902;
        double eta_p_121903;
        double eta_p_121905;
        double eta_p_121906;
        double local_acc_127183 = 0.0;
        double local_acc_127184 = 0.0;
        int64_t start_127185;
        int64_t end_127186;
        
        start_127185 = start;
        end_127186 = end;
        
        int64_t n_127187 = end_127186 - start_127185;
        
        for (int64_t SegRed_i_127188 = start_127185; SegRed_i_127188 < start_127185 + n_127187; SegRed_i_127188++) {
            int64_t gtid_121901 = SegRed_i_127188;
            double eta_p_121908 = ((double *) mem_112573.mem)[gtid_121901];
            double eta_p_121909 = ((double *) distrs_mem_111708.mem)[lifted_lambda_res_106391 * m_33388 + gtid_121901];
            double eta_p_121910 = ((double *) mem_112575.mem)[gtid_121901];
            double defunc_res_121911;
            double defunc_res_121912;
            int64_t flat_tid_121913 = (int64_t) 0;
            
            defunc_res_121911 = 0.0;
            defunc_res_121912 = 0.0;
            
            struct futhark_mc_task_129307 futhark_mc_task_129307_;
            
            futhark_mc_task_129307_.ctx = ctx;
            futhark_mc_task_129307_.free_m_33388 = m_33388;
            futhark_mc_task_129307_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
            futhark_mc_task_129307_.free_distrs_mem_111708 = distrs_mem_111708.mem;
            futhark_mc_task_129307_.free_mem_112573 = mem_112573.mem;
            futhark_mc_task_129307_.free_mem_112575 = mem_112575.mem;
            futhark_mc_task_129307_.free_eta_p_121908 = eta_p_121908;
            futhark_mc_task_129307_.free_eta_p_121909 = eta_p_121909;
            futhark_mc_task_129307_.free_eta_p_121910 = eta_p_121910;
            futhark_mc_task_129307_.free_flat_tid_121913 = flat_tid_121913;
            futhark_mc_task_129307_.retval_defunc_res_121911 = (double *) &defunc_res_121911;
            #if ISPC
            futhark_mc_task_129307_.retval_defunc_res_121911 += programIndex;
            #endif
            futhark_mc_task_129307_.retval_defunc_res_121912 = (double *) &defunc_res_121912;
            #if ISPC
            futhark_mc_task_129307_.retval_defunc_res_121912 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_129307_task;
            
            futhark_mc_task_129307_task.args = &futhark_mc_task_129307_;
            futhark_mc_task_129307_task.top_level_fn = futhark_mc_segred_task_129308;
            futhark_mc_task_129307_task.name = "futhark_mc_segred_task_129308";
            futhark_mc_task_129307_task.iterations = m_33388;
            futhark_mc_task_129307_task.task_time = &ctx->program->futhark_mc_segred_task_129308_total_time;
            futhark_mc_task_129307_task.task_iter = &ctx->program->futhark_mc_segred_task_129308_total_iter;
            futhark_mc_task_129307_task.sched = STATIC;
            futhark_mc_task_129307_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_129308_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_129307_task);
            
            if (futhark_mc_segred_task_129308_err != 0) {
                err = futhark_mc_segred_task_129308_err;
                goto cleanup;
            }
            // save map-out results
            { }
            // Load accum params
            {
                eta_p_121902 = local_acc_127183;
            }
            // Load next params
            {
                eta_p_121903 = defunc_res_121911;
            }
            // SegRed body
            {
                double zp_res_121904 = eta_p_121902 + eta_p_121903;
                
                local_acc_127183 = zp_res_121904;
            }
            // Load accum params
            {
                eta_p_121905 = local_acc_127184;
            }
            // Load next params
            {
                eta_p_121906 = defunc_res_121912;
            }
            // SegRed body
            {
                double zp_res_121907 = eta_p_121905 + eta_p_121906;
                
                local_acc_127184 = zp_res_121907;
            }
        }
        
        int64_t uni_i_127216 = 0;
        
        {
            int64_t gtid_121901 = uni_i_127216;
            
            // Load accum params
            {
                eta_p_127175 = local_acc_127181;
            }
            // Load next params
            {
                eta_p_127176 = local_acc_127183;
            }
            // SegRed body
            {
                double zp_res_127177 = eta_p_127175 + eta_p_127176;
                
                local_acc_127181 = zp_res_127177;
            }
            // Load accum params
            {
                eta_p_127178 = local_acc_127182;
            }
            // Load next params
            {
                eta_p_127179 = local_acc_127184;
            }
            // SegRed body
            {
                double zp_res_127180 = eta_p_127178 + eta_p_127179;
                
                local_acc_127182 = zp_res_127180;
            }
        }
        ((double *) reduce_stage_1_tid_res_arr_mem_127171.mem)[flat_tid_121900] = local_acc_127181;
        ((double *) reduce_stage_1_tid_res_arr_mem_127173.mem)[flat_tid_121900] = local_acc_127182;
    }
    
  cleanup:
    { }
    if (event_129316 != NULL) {
        event_129316->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129306", strdup("nothing further"), event_129316, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segred_nested_task_129302(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_129293 *futhark_mc_task_129293 = (struct futhark_mc_task_129293 *) args;
    struct futhark_context *ctx = futhark_mc_task_129293->ctx;
    struct mc_event *event_129318 = mc_event_new(ctx);
    
    if (event_129318 != NULL)
        event_129318->bef = get_wall_time();
    
    int64_t m_33388 = futhark_mc_task_129293->free_m_33388;
    int64_t lifted_lambda_res_106391 = futhark_mc_task_129293->free_lifted_lambda_res_106391;
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_129293->free_distrs_mem_111708, .size =0, .references =NULL};
    struct memblock mem_112573 = {.desc ="mem_112573", .mem =futhark_mc_task_129293->free_mem_112573, .size =0, .references =NULL};
    struct memblock mem_112575 = {.desc ="mem_112575", .mem =futhark_mc_task_129293->free_mem_112575, .size =0, .references =NULL};
    int64_t flat_tid_121900 = futhark_mc_task_129293->free_flat_tid_121900;
    int64_t flat_tid_121941 = futhark_mc_task_129293->free_flat_tid_121941;
    double defunc_res_110452 = *futhark_mc_task_129293->retval_defunc_res_110452;
    double defunc_res_110453 = *futhark_mc_task_129293->retval_defunc_res_110453;
    int64_t reduce_stage_1_tid_res_arr_mem_127171_cached_sizze_129303 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_127171 = NULL;
    int64_t reduce_stage_1_tid_res_arr_mem_127173_cached_sizze_129304 = 0;
    unsigned char *reduce_stage_1_tid_res_arr_mem_127173 = NULL;
    int32_t nsubtasks_127170;
    
    nsubtasks_127170 = info.nsubtasks;
    if (reduce_stage_1_tid_res_arr_mem_127171_cached_sizze_129303 < (int64_t) 8 * nsubtasks_127170) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_127171, &reduce_stage_1_tid_res_arr_mem_127171_cached_sizze_129303, (int64_t) 8 * nsubtasks_127170);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (reduce_stage_1_tid_res_arr_mem_127173_cached_sizze_129304 < (int64_t) 8 * nsubtasks_127170) {
        err = lexical_realloc(ctx, &reduce_stage_1_tid_res_arr_mem_127173, &reduce_stage_1_tid_res_arr_mem_127173_cached_sizze_129304, (int64_t) 8 * nsubtasks_127170);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    struct futhark_mc_segred_stage_1_parloop_struct_129305 futhark_mc_segred_stage_1_parloop_struct_129305_;
    
    futhark_mc_segred_stage_1_parloop_struct_129305_.ctx = ctx;
    futhark_mc_segred_stage_1_parloop_struct_129305_.free_m_33388 = m_33388;
    futhark_mc_segred_stage_1_parloop_struct_129305_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
    futhark_mc_segred_stage_1_parloop_struct_129305_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segred_stage_1_parloop_struct_129305_.free_mem_112573 = mem_112573.mem;
    futhark_mc_segred_stage_1_parloop_struct_129305_.free_mem_112575 = mem_112575.mem;
    futhark_mc_segred_stage_1_parloop_struct_129305_.free_reduce_stage_1_tid_res_arr_mem_127171 = reduce_stage_1_tid_res_arr_mem_127171;
    futhark_mc_segred_stage_1_parloop_struct_129305_.free_reduce_stage_1_tid_res_arr_mem_127173 = reduce_stage_1_tid_res_arr_mem_127173;
    
    struct scheduler_parloop futhark_mc_segred_stage_1_parloop_129306_task;
    
    futhark_mc_segred_stage_1_parloop_129306_task.name = "futhark_mc_segred_stage_1_parloop_129306";
    futhark_mc_segred_stage_1_parloop_129306_task.fn = futhark_mc_segred_stage_1_parloop_129306;
    futhark_mc_segred_stage_1_parloop_129306_task.args = &futhark_mc_segred_stage_1_parloop_struct_129305_;
    futhark_mc_segred_stage_1_parloop_129306_task.iterations = iterations;
    futhark_mc_segred_stage_1_parloop_129306_task.info = info;
    
    struct mc_event *event_129317 = mc_event_new(ctx);
    
    if (event_129317 != NULL)
        event_129317->bef = get_wall_time();
    
    int futhark_mc_segred_stage_1_parloop_129306_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segred_stage_1_parloop_129306_task);
    
    if (futhark_mc_segred_stage_1_parloop_129306_err != 0) {
        err = futhark_mc_segred_stage_1_parloop_129306_err;
        goto cleanup;
    }
    if (event_129317 != NULL) {
        event_129317->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_stage_1_parloop_129306_total", strdup("nothing further"), event_129317, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    // neutral-initialise the output
    {
        defunc_res_110452 = 0.0;
        defunc_res_110453 = 0.0;
    }
    
    double eta_p_127217;
    double eta_p_127218;
    double eta_p_127220;
    double eta_p_127221;
    
    for (int32_t i_127223 = 0; i_127223 < nsubtasks_127170; i_127223++) {
        flat_tid_121900 = i_127223;
        // Apply main thread reduction
        {
            // load acc params
            {
                eta_p_127217 = defunc_res_110452;
            }
            // load next params
            {
                eta_p_127218 = ((double *) reduce_stage_1_tid_res_arr_mem_127171)[flat_tid_121900];
            }
            // red body
            {
                double zp_res_127219 = eta_p_127217 + eta_p_127218;
                
                defunc_res_110452 = zp_res_127219;
            }
            // load acc params
            {
                eta_p_127220 = defunc_res_110453;
            }
            // load next params
            {
                eta_p_127221 = ((double *) reduce_stage_1_tid_res_arr_mem_127173)[flat_tid_121900];
            }
            // red body
            {
                double zp_res_127222 = eta_p_127220 + eta_p_127221;
                
                defunc_res_110453 = zp_res_127222;
            }
        }
    }
    
  cleanup:
    {
        free(reduce_stage_1_tid_res_arr_mem_127171);
        free(reduce_stage_1_tid_res_arr_mem_127173);
    }
    if (event_129318 != NULL) {
        event_129318->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segred_nested_task_129302", strdup("nothing further"), event_129318, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) {
        *futhark_mc_task_129293->retval_defunc_res_110452 = defunc_res_110452;
        *futhark_mc_task_129293->retval_defunc_res_110453 = defunc_res_110453;
    }
    return err;
}
static int futhark_mc_segmap_parloop_127433(void *args, int64_t start, int64_t end, int subtask_id, int tid)
{
    (void) subtask_id;
    (void) tid;
    
    int err = 0;
    struct futhark_mc_segmap_parloop_struct_127432 *futhark_mc_segmap_parloop_struct_127432 = (struct futhark_mc_segmap_parloop_struct_127432 *) args;
    struct futhark_context *ctx = futhark_mc_segmap_parloop_struct_127432->ctx;
    struct mc_event *event_129319 = mc_event_new(ctx);
    
    if (event_129319 != NULL)
        event_129319->bef = get_wall_time();
    
    int64_t k_33387 = futhark_mc_segmap_parloop_struct_127432->free_k_33387;
    int64_t m_33388 = futhark_mc_segmap_parloop_struct_127432->free_m_33388;
    double rho1_33389 = futhark_mc_segmap_parloop_struct_127432->free_rho1_33389;
    double rho2_33390 = futhark_mc_segmap_parloop_struct_127432->free_rho2_33390;
    double eps_33391 = futhark_mc_segmap_parloop_struct_127432->free_eps_33391;
    double exp_absorb_cutoff_33394 = futhark_mc_segmap_parloop_struct_127432->free_exp_absorb_cutoff_33394;
    double safe_for_exp_33395 = futhark_mc_segmap_parloop_struct_127432->free_safe_for_exp_33395;
    double tol_sinkhorn_33396 = futhark_mc_segmap_parloop_struct_127432->free_tol_sinkhorn_33396;
    double neg_res_43882 = futhark_mc_segmap_parloop_struct_127432->free_neg_res_43882;
    double zp_res_43884 = futhark_mc_segmap_parloop_struct_127432->free_zp_res_43884;
    double zs_res_44842 = futhark_mc_segmap_parloop_struct_127432->free_zs_res_44842;
    double zs_res_44844 = futhark_mc_segmap_parloop_struct_127432->free_zs_res_44844;
    double zs_res_44883 = futhark_mc_segmap_parloop_struct_127432->free_zs_res_44883;
    double zs_res_44885 = futhark_mc_segmap_parloop_struct_127432->free_zs_res_44885;
    double zp_res_46827 = futhark_mc_segmap_parloop_struct_127432->free_zp_res_46827;
    int64_t defunc_0_reduce_res_103765 = futhark_mc_segmap_parloop_struct_127432->free_defunc_0_reduce_res_103765;
    double zs_res_107134 = futhark_mc_segmap_parloop_struct_127432->free_zs_res_107134;
    double zp_res_108112 = futhark_mc_segmap_parloop_struct_127432->free_zp_res_108112;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_segmap_parloop_struct_127432->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_segmap_parloop_struct_127432->free_distrs_mem_111708, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_segmap_parloop_struct_127432->free_bytes_111715;
    struct memblock mem_111716 = {.desc ="mem_111716", .mem =futhark_mc_segmap_parloop_struct_127432->free_mem_111716, .size =0, .references =NULL};
    struct memblock mem_111719 = {.desc ="mem_111719", .mem =futhark_mc_segmap_parloop_struct_127432->free_mem_111719, .size =0, .references =NULL};
    struct memblock mem_111723 = {.desc ="mem_111723", .mem =futhark_mc_segmap_parloop_struct_127432->free_mem_111723, .size =0, .references =NULL};
    int64_t bytes_111726 = futhark_mc_segmap_parloop_struct_127432->free_bytes_111726;
    struct memblock mem_111727 = {.desc ="mem_111727", .mem =futhark_mc_segmap_parloop_struct_127432->free_mem_111727, .size =0, .references =NULL};
    int64_t bytes_111743 = futhark_mc_segmap_parloop_struct_127432->free_bytes_111743;
    struct memblock mem_114063 = {.desc ="mem_114063", .mem =futhark_mc_segmap_parloop_struct_127432->free_mem_114063, .size =0, .references =NULL};
    int64_t num_bytes_114668 = futhark_mc_segmap_parloop_struct_127432->free_num_bytes_114668;
    int64_t iterations = end - start;
    int64_t mem_111739_cached_sizze_127434 = 0;
    unsigned char *mem_111739 = NULL;
    int64_t mem_111741_cached_sizze_127435 = 0;
    unsigned char *mem_111741 = NULL;
    int64_t mem_111744_cached_sizze_127436 = 0;
    unsigned char *mem_111744 = NULL;
    int64_t mem_111746_cached_sizze_127437 = 0;
    unsigned char *mem_111746 = NULL;
    int64_t mem_111748_cached_sizze_127438 = 0;
    unsigned char *mem_111748 = NULL;
    int64_t mem_111750_cached_sizze_127439 = 0;
    unsigned char *mem_111750 = NULL;
    int64_t mem_111752_cached_sizze_127440 = 0;
    unsigned char *mem_111752 = NULL;
    int64_t mem_111795_cached_sizze_127441 = 0;
    unsigned char *mem_111795 = NULL;
    int64_t mem_111811_cached_sizze_127442 = 0;
    unsigned char *mem_111811 = NULL;
    int64_t mem_111968_cached_sizze_127443 = 0;
    unsigned char *mem_111968 = NULL;
    int64_t mem_111993_cached_sizze_127444 = 0;
    unsigned char *mem_111993 = NULL;
    int64_t mem_111995_cached_sizze_127445 = 0;
    unsigned char *mem_111995 = NULL;
    int64_t mem_111997_cached_sizze_127446 = 0;
    unsigned char *mem_111997 = NULL;
    int64_t mem_111999_cached_sizze_127447 = 0;
    unsigned char *mem_111999 = NULL;
    int64_t mem_112032_cached_sizze_127448 = 0;
    unsigned char *mem_112032 = NULL;
    int64_t mem_112034_cached_sizze_127449 = 0;
    unsigned char *mem_112034 = NULL;
    int64_t mem_112403_cached_sizze_127450 = 0;
    unsigned char *mem_112403 = NULL;
    int64_t mem_112412_cached_sizze_127451 = 0;
    unsigned char *mem_112412 = NULL;
    int64_t mem_112414_cached_sizze_127452 = 0;
    unsigned char *mem_112414 = NULL;
    int64_t mem_112416_cached_sizze_127453 = 0;
    unsigned char *mem_112416 = NULL;
    int64_t mem_112421_cached_sizze_127454 = 0;
    unsigned char *mem_112421 = NULL;
    int64_t mem_112423_cached_sizze_127455 = 0;
    unsigned char *mem_112423 = NULL;
    int64_t mem_112425_cached_sizze_127456 = 0;
    unsigned char *mem_112425 = NULL;
    int64_t mem_112427_cached_sizze_127457 = 0;
    unsigned char *mem_112427 = NULL;
    int64_t mem_112431_cached_sizze_127458 = 0;
    unsigned char *mem_112431 = NULL;
    int64_t mem_112463_cached_sizze_127459 = 0;
    unsigned char *mem_112463 = NULL;
    int64_t mem_112466_cached_sizze_127460 = 0;
    unsigned char *mem_112466 = NULL;
    int64_t mem_112471_cached_sizze_127461 = 0;
    unsigned char *mem_112471 = NULL;
    int64_t mem_112507_cached_sizze_127462 = 0;
    unsigned char *mem_112507 = NULL;
    int64_t mem_112510_cached_sizze_127463 = 0;
    unsigned char *mem_112510 = NULL;
    int64_t mem_112515_cached_sizze_127464 = 0;
    unsigned char *mem_112515 = NULL;
    int64_t mem_112567_cached_sizze_127465 = 0;
    unsigned char *mem_112567 = NULL;
    int64_t mem_112569_cached_sizze_127466 = 0;
    unsigned char *mem_112569 = NULL;
    int64_t mem_112571_cached_sizze_127467 = 0;
    unsigned char *mem_112571 = NULL;
    int64_t mem_112573_cached_sizze_127468 = 0;
    unsigned char *mem_112573 = NULL;
    int64_t mem_112575_cached_sizze_127469 = 0;
    unsigned char *mem_112575 = NULL;
    int64_t mem_112577_cached_sizze_127470 = 0;
    unsigned char *mem_112577 = NULL;
    struct memblock mem_param_tmp_123457;
    
    mem_param_tmp_123457.references = NULL;
    
    struct memblock mem_param_tmp_123456;
    
    mem_param_tmp_123456.references = NULL;
    
    struct memblock mem_param_tmp_123455;
    
    mem_param_tmp_123455.references = NULL;
    
    struct memblock mem_param_out_tmp_125947;
    
    mem_param_out_tmp_125947.references = NULL;
    
    struct memblock mem_param_tmp_125946;
    
    mem_param_tmp_125946.references = NULL;
    
    struct memblock mem_param_out_121101;
    
    mem_param_out_121101.references = NULL;
    
    struct memblock mem_param_121100;
    
    mem_param_121100.references = NULL;
    
    struct memblock ext_mem_unused_121095;
    
    ext_mem_unused_121095.references = NULL;
    
    struct memblock ext_mem_121094;
    
    ext_mem_121094.references = NULL;
    
    struct memblock ext_mem_120366;
    
    ext_mem_120366.references = NULL;
    
    struct memblock ext_mem_120365;
    
    ext_mem_120365.references = NULL;
    
    struct memblock ext_mem_120364;
    
    ext_mem_120364.references = NULL;
    
    struct memblock mem_120363;
    
    mem_120363.references = NULL;
    
    struct memblock mem_120362;
    
    mem_120362.references = NULL;
    
    struct memblock mem_120361;
    
    mem_120361.references = NULL;
    
    struct memblock mem_120302;
    
    mem_120302.references = NULL;
    
    struct memblock mem_120301;
    
    mem_120301.references = NULL;
    
    struct memblock mem_param_tmp_124713;
    
    mem_param_tmp_124713.references = NULL;
    
    struct memblock mem_param_tmp_124712;
    
    mem_param_tmp_124712.references = NULL;
    
    struct memblock mem_param_tmp_124711;
    
    mem_param_tmp_124711.references = NULL;
    
    struct memblock mem_param_tmp_124710;
    
    mem_param_tmp_124710.references = NULL;
    
    struct memblock mem_param_tmp_124709;
    
    mem_param_tmp_124709.references = NULL;
    
    struct memblock ext_mem_120238;
    
    ext_mem_120238.references = NULL;
    
    struct memblock ext_mem_120237;
    
    ext_mem_120237.references = NULL;
    
    struct memblock ext_mem_120236;
    
    ext_mem_120236.references = NULL;
    
    struct memblock mem_120235;
    
    mem_120235.references = NULL;
    
    struct memblock mem_120234;
    
    mem_120234.references = NULL;
    
    struct memblock mem_120233;
    
    mem_120233.references = NULL;
    
    struct memblock ext_mem_120180;
    
    ext_mem_120180.references = NULL;
    
    struct memblock ext_mem_120179;
    
    ext_mem_120179.references = NULL;
    
    struct memblock ext_mem_120178;
    
    ext_mem_120178.references = NULL;
    
    struct memblock mem_120177;
    
    mem_120177.references = NULL;
    
    struct memblock mem_120176;
    
    mem_120176.references = NULL;
    
    struct memblock mem_120175;
    
    mem_120175.references = NULL;
    
    struct memblock mem_120116;
    
    mem_120116.references = NULL;
    
    struct memblock mem_120071;
    
    mem_120071.references = NULL;
    
    struct memblock mem_param_120061;
    
    mem_param_120061.references = NULL;
    
    struct memblock mem_param_120060;
    
    mem_param_120060.references = NULL;
    
    struct memblock mem_param_120059;
    
    mem_param_120059.references = NULL;
    
    struct memblock mem_param_120058;
    
    mem_param_120058.references = NULL;
    
    struct memblock mem_param_120057;
    
    mem_param_120057.references = NULL;
    
    struct memblock ext_mem_120047;
    
    ext_mem_120047.references = NULL;
    
    struct memblock ext_mem_120046;
    
    ext_mem_120046.references = NULL;
    
    struct memblock ext_mem_120045;
    
    ext_mem_120045.references = NULL;
    
    struct memblock ext_mem_120044;
    
    ext_mem_120044.references = NULL;
    
    struct memblock ext_mem_120043;
    
    ext_mem_120043.references = NULL;
    
    struct memblock ext_mem_119981;
    
    ext_mem_119981.references = NULL;
    
    struct memblock ext_mem_119980;
    
    ext_mem_119980.references = NULL;
    
    struct memblock ext_mem_119979;
    
    ext_mem_119979.references = NULL;
    
    struct memblock ext_mem_119927;
    
    ext_mem_119927.references = NULL;
    
    struct memblock ext_mem_119926;
    
    ext_mem_119926.references = NULL;
    
    struct memblock ext_mem_119925;
    
    ext_mem_119925.references = NULL;
    
    struct memblock ext_mem_119817;
    
    ext_mem_119817.references = NULL;
    
    struct memblock ext_mem_119816;
    
    ext_mem_119816.references = NULL;
    
    struct memblock ext_mem_119815;
    
    ext_mem_119815.references = NULL;
    
    struct memblock ext_mem_119814;
    
    ext_mem_119814.references = NULL;
    
    struct memblock ext_mem_119810;
    
    ext_mem_119810.references = NULL;
    
    struct memblock mem_param_tmp_124255;
    
    mem_param_tmp_124255.references = NULL;
    
    struct memblock mem_param_tmp_124254;
    
    mem_param_tmp_124254.references = NULL;
    
    struct memblock mem_param_tmp_124253;
    
    mem_param_tmp_124253.references = NULL;
    
    struct memblock mem_param_tmp_124252;
    
    mem_param_tmp_124252.references = NULL;
    
    struct memblock mem_param_tmp_124251;
    
    mem_param_tmp_124251.references = NULL;
    
    struct memblock mem_param_tmp_124250;
    
    mem_param_tmp_124250.references = NULL;
    
    struct memblock mem_param_tmp_124249;
    
    mem_param_tmp_124249.references = NULL;
    
    struct memblock mem_param_tmp_124248;
    
    mem_param_tmp_124248.references = NULL;
    
    struct memblock mem_param_tmp_124247;
    
    mem_param_tmp_124247.references = NULL;
    
    struct memblock ext_mem_119737;
    
    ext_mem_119737.references = NULL;
    
    struct memblock ext_mem_119736;
    
    ext_mem_119736.references = NULL;
    
    struct memblock ext_mem_119735;
    
    ext_mem_119735.references = NULL;
    
    struct memblock mem_119734;
    
    mem_119734.references = NULL;
    
    struct memblock mem_119733;
    
    mem_119733.references = NULL;
    
    struct memblock mem_119732;
    
    mem_119732.references = NULL;
    
    struct memblock ext_mem_119678;
    
    ext_mem_119678.references = NULL;
    
    struct memblock ext_mem_119677;
    
    ext_mem_119677.references = NULL;
    
    struct memblock ext_mem_119676;
    
    ext_mem_119676.references = NULL;
    
    struct memblock mem_119675;
    
    mem_119675.references = NULL;
    
    struct memblock mem_119674;
    
    mem_119674.references = NULL;
    
    struct memblock mem_119673;
    
    mem_119673.references = NULL;
    
    struct memblock mem_119614;
    
    mem_119614.references = NULL;
    
    struct memblock mem_119569;
    
    mem_119569.references = NULL;
    
    struct memblock mem_param_119552;
    
    mem_param_119552.references = NULL;
    
    struct memblock mem_param_119551;
    
    mem_param_119551.references = NULL;
    
    struct memblock mem_param_119550;
    
    mem_param_119550.references = NULL;
    
    struct memblock mem_param_119549;
    
    mem_param_119549.references = NULL;
    
    struct memblock mem_param_119548;
    
    mem_param_119548.references = NULL;
    
    struct memblock mem_param_119547;
    
    mem_param_119547.references = NULL;
    
    struct memblock mem_param_119546;
    
    mem_param_119546.references = NULL;
    
    struct memblock mem_param_119545;
    
    mem_param_119545.references = NULL;
    
    struct memblock mem_param_119544;
    
    mem_param_119544.references = NULL;
    
    struct memblock ext_mem_119527;
    
    ext_mem_119527.references = NULL;
    
    struct memblock ext_mem_119526;
    
    ext_mem_119526.references = NULL;
    
    struct memblock ext_mem_119525;
    
    ext_mem_119525.references = NULL;
    
    struct memblock ext_mem_119524;
    
    ext_mem_119524.references = NULL;
    
    struct memblock ext_mem_119523;
    
    ext_mem_119523.references = NULL;
    
    struct memblock ext_mem_119522;
    
    ext_mem_119522.references = NULL;
    
    struct memblock ext_mem_119521;
    
    ext_mem_119521.references = NULL;
    
    struct memblock ext_mem_119520;
    
    ext_mem_119520.references = NULL;
    
    struct memblock ext_mem_119519;
    
    ext_mem_119519.references = NULL;
    
    struct memblock ext_mem_119460;
    
    ext_mem_119460.references = NULL;
    
    struct memblock ext_mem_119459;
    
    ext_mem_119459.references = NULL;
    
    struct memblock ext_mem_119458;
    
    ext_mem_119458.references = NULL;
    
    struct memblock ext_mem_119409;
    
    ext_mem_119409.references = NULL;
    
    struct memblock ext_mem_119408;
    
    ext_mem_119408.references = NULL;
    
    struct memblock ext_mem_119407;
    
    ext_mem_119407.references = NULL;
    
    struct memblock mem_param_tmp_123040;
    
    mem_param_tmp_123040.references = NULL;
    
    struct memblock mem_param_tmp_123039;
    
    mem_param_tmp_123039.references = NULL;
    
    struct memblock mem_param_tmp_123038;
    
    mem_param_tmp_123038.references = NULL;
    
    struct memblock mem_param_tmp_123037;
    
    mem_param_tmp_123037.references = NULL;
    
    struct memblock mem_param_tmp_123036;
    
    mem_param_tmp_123036.references = NULL;
    
    struct memblock ext_mem_118756;
    
    ext_mem_118756.references = NULL;
    
    struct memblock ext_mem_118755;
    
    ext_mem_118755.references = NULL;
    
    struct memblock ext_mem_118754;
    
    ext_mem_118754.references = NULL;
    
    struct memblock mem_118753;
    
    mem_118753.references = NULL;
    
    struct memblock mem_118752;
    
    mem_118752.references = NULL;
    
    struct memblock mem_118751;
    
    mem_118751.references = NULL;
    
    struct memblock ext_mem_118697;
    
    ext_mem_118697.references = NULL;
    
    struct memblock ext_mem_118696;
    
    ext_mem_118696.references = NULL;
    
    struct memblock ext_mem_118695;
    
    ext_mem_118695.references = NULL;
    
    struct memblock mem_118694;
    
    mem_118694.references = NULL;
    
    struct memblock mem_118693;
    
    mem_118693.references = NULL;
    
    struct memblock mem_118692;
    
    mem_118692.references = NULL;
    
    struct memblock mem_118633;
    
    mem_118633.references = NULL;
    
    struct memblock mem_118588;
    
    mem_118588.references = NULL;
    
    struct memblock mem_param_118928;
    
    mem_param_118928.references = NULL;
    
    struct memblock mem_param_118927;
    
    mem_param_118927.references = NULL;
    
    struct memblock mem_param_118926;
    
    mem_param_118926.references = NULL;
    
    struct memblock ext_mem_112553;
    
    ext_mem_112553.references = NULL;
    
    struct memblock ext_mem_112554;
    
    ext_mem_112554.references = NULL;
    
    struct memblock ext_mem_112555;
    
    ext_mem_112555.references = NULL;
    
    struct memblock mem_in_114669;
    
    mem_in_114669.references = NULL;
    
    struct memblock mem_112513;
    
    mem_112513.references = NULL;
    
    struct memblock mem_112272;
    
    mem_112272.references = NULL;
    
    struct memblock mem_112269;
    
    mem_112269.references = NULL;
    
    struct memblock mem_112267;
    
    mem_112267.references = NULL;
    
    struct memblock mem_112244;
    
    mem_112244.references = NULL;
    
    struct memblock mem_112241;
    
    mem_112241.references = NULL;
    
    struct memblock mem_112239;
    
    mem_112239.references = NULL;
    
    struct memblock mem_112224;
    
    mem_112224.references = NULL;
    
    struct memblock mem_112222;
    
    mem_112222.references = NULL;
    
    struct memblock mem_112097;
    
    mem_112097.references = NULL;
    
    struct memblock mem_112094;
    
    mem_112094.references = NULL;
    
    struct memblock mem_112092;
    
    mem_112092.references = NULL;
    
    struct memblock mem_112073;
    
    mem_112073.references = NULL;
    
    struct memblock mem_112070;
    
    mem_112070.references = NULL;
    
    struct memblock mem_112068;
    
    mem_112068.references = NULL;
    
    struct memblock mem_112055;
    
    mem_112055.references = NULL;
    
    struct memblock mem_112053;
    
    mem_112053.references = NULL;
    
    struct memblock mem_112051;
    
    mem_112051.references = NULL;
    
    struct memblock mem_112048;
    
    mem_112048.references = NULL;
    
    struct memblock mem_112046;
    
    mem_112046.references = NULL;
    
    struct memblock mem_111981;
    
    mem_111981.references = NULL;
    
    struct memblock mem_param_118578;
    
    mem_param_118578.references = NULL;
    
    struct memblock mem_param_118577;
    
    mem_param_118577.references = NULL;
    
    struct memblock mem_param_118576;
    
    mem_param_118576.references = NULL;
    
    struct memblock mem_param_118575;
    
    mem_param_118575.references = NULL;
    
    struct memblock mem_param_118574;
    
    mem_param_118574.references = NULL;
    
    struct memblock ext_mem_111951;
    
    ext_mem_111951.references = NULL;
    
    struct memblock ext_mem_111952;
    
    ext_mem_111952.references = NULL;
    
    struct memblock ext_mem_111953;
    
    ext_mem_111953.references = NULL;
    
    struct memblock ext_mem_111954;
    
    ext_mem_111954.references = NULL;
    
    struct memblock ext_mem_111955;
    
    ext_mem_111955.references = NULL;
    
    struct memblock ext_mem_111861;
    
    ext_mem_111861.references = NULL;
    
    struct memblock ext_mem_111862;
    
    ext_mem_111862.references = NULL;
    
    struct memblock ext_mem_111863;
    
    ext_mem_111863.references = NULL;
    
    struct memblock mem_111858;
    
    mem_111858.references = NULL;
    
    struct memblock mem_111855;
    
    mem_111855.references = NULL;
    
    struct memblock mem_111853;
    
    mem_111853.references = NULL;
    
    struct memblock ext_mem_111838;
    
    ext_mem_111838.references = NULL;
    
    struct memblock ext_mem_111839;
    
    ext_mem_111839.references = NULL;
    
    struct memblock ext_mem_111840;
    
    ext_mem_111840.references = NULL;
    
    struct memblock mem_111837;
    
    mem_111837.references = NULL;
    
    struct memblock mem_111834;
    
    mem_111834.references = NULL;
    
    struct memblock mem_111832;
    
    mem_111832.references = NULL;
    
    struct memblock mem_111818;
    
    mem_111818.references = NULL;
    
    struct memblock mem_111816;
    
    mem_111816.references = NULL;
    
    struct memblock mem_111814;
    
    mem_111814.references = NULL;
    
    struct memblock mem_111799;
    
    mem_111799.references = NULL;
    
    struct memblock mem_111797;
    
    mem_111797.references = NULL;
    
    int64_t flat_tid_106379;
    
    flat_tid_106379 = subtask_id;
    {
        int64_t start_121979;
        int64_t end_121980;
        
        start_121979 = start;
        end_121980 = end;
        
        int64_t n_121981 = end_121980 - start_121979;
        
        if (mem_111739_cached_sizze_127434 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_111739, &mem_111739_cached_sizze_127434, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_111741_cached_sizze_127435 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_111741, &mem_111741_cached_sizze_127435, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_111744_cached_sizze_127436 < bytes_111743) {
            err = lexical_realloc(ctx, &mem_111744, &mem_111744_cached_sizze_127436, bytes_111743);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_111746_cached_sizze_127437 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_111746, &mem_111746_cached_sizze_127437, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_111748_cached_sizze_127438 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_111748, &mem_111748_cached_sizze_127438, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_111750_cached_sizze_127439 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_111750, &mem_111750_cached_sizze_127439, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_111752_cached_sizze_127440 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_111752, &mem_111752_cached_sizze_127440, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_111795_cached_sizze_127441 < bytes_111743) {
            err = lexical_realloc(ctx, &mem_111795, &mem_111795_cached_sizze_127441, bytes_111743);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_111797, bytes_111715, "mem_111797")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_111799, bytes_111715, "mem_111799")) {
            err = 1;
            goto cleanup;
        }
        if (mem_111811_cached_sizze_127442 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_111811, &mem_111811_cached_sizze_127442, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_111814, bytes_111743, "mem_111814")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_111816, bytes_111715, "mem_111816")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_111818, bytes_111715, "mem_111818")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_111832, bytes_111715, "mem_111832")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_111834, bytes_111715, "mem_111834")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_111837, bytes_111743, "mem_111837")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_111853, bytes_111715, "mem_111853")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_111855, bytes_111715, "mem_111855")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_111858, bytes_111743, "mem_111858")) {
            err = 1;
            goto cleanup;
        }
        if (mem_111968_cached_sizze_127443 < bytes_111743) {
            err = lexical_realloc(ctx, &mem_111968, &mem_111968_cached_sizze_127443, bytes_111743);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_111981, bytes_111743, "mem_111981")) {
            err = 1;
            goto cleanup;
        }
        if (mem_111993_cached_sizze_127444 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_111993, &mem_111993_cached_sizze_127444, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_111995_cached_sizze_127445 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_111995, &mem_111995_cached_sizze_127445, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_111997_cached_sizze_127446 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_111997, &mem_111997_cached_sizze_127446, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_111999_cached_sizze_127447 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_111999, &mem_111999_cached_sizze_127447, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_112032_cached_sizze_127448 < bytes_111743) {
            err = lexical_realloc(ctx, &mem_112032, &mem_112032_cached_sizze_127448, bytes_111743);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_112034_cached_sizze_127449 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_112034, &mem_112034_cached_sizze_127449, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_112046, bytes_111715, "mem_112046")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_112048, bytes_111715, "mem_112048")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_112051, bytes_111743, "mem_112051")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_112053, bytes_111715, "mem_112053")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_112055, bytes_111715, "mem_112055")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_112068, bytes_111715, "mem_112068")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_112070, bytes_111715, "mem_112070")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_112073, bytes_111743, "mem_112073")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_112092, bytes_111715, "mem_112092")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_112094, bytes_111715, "mem_112094")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_112097, bytes_111743, "mem_112097")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_112222, bytes_111715, "mem_112222")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_112224, bytes_111715, "mem_112224")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_112239, bytes_111715, "mem_112239")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_112241, bytes_111715, "mem_112241")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_112244, bytes_111743, "mem_112244")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_112267, bytes_111715, "mem_112267")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_112269, bytes_111715, "mem_112269")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_112272, bytes_111743, "mem_112272")) {
            err = 1;
            goto cleanup;
        }
        if (mem_112403_cached_sizze_127450 < bytes_111743) {
            err = lexical_realloc(ctx, &mem_112403, &mem_112403_cached_sizze_127450, bytes_111743);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_112412_cached_sizze_127451 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_112412, &mem_112412_cached_sizze_127451, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_112414_cached_sizze_127452 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_112414, &mem_112414_cached_sizze_127452, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_112416_cached_sizze_127453 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_112416, &mem_112416_cached_sizze_127453, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_112421_cached_sizze_127454 < bytes_111743) {
            err = lexical_realloc(ctx, &mem_112421, &mem_112421_cached_sizze_127454, bytes_111743);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_112423_cached_sizze_127455 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_112423, &mem_112423_cached_sizze_127455, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_112425_cached_sizze_127456 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_112425, &mem_112425_cached_sizze_127456, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_112427_cached_sizze_127457 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_112427, &mem_112427_cached_sizze_127457, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_112431_cached_sizze_127458 < bytes_111726) {
            err = lexical_realloc(ctx, &mem_112431, &mem_112431_cached_sizze_127458, bytes_111726);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_112463_cached_sizze_127459 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_112463, &mem_112463_cached_sizze_127459, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_112466_cached_sizze_127460 < bytes_111743) {
            err = lexical_realloc(ctx, &mem_112466, &mem_112466_cached_sizze_127460, bytes_111743);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_112471_cached_sizze_127461 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_112471, &mem_112471_cached_sizze_127461, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_112507_cached_sizze_127462 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_112507, &mem_112507_cached_sizze_127462, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_112510_cached_sizze_127463 < bytes_111743) {
            err = lexical_realloc(ctx, &mem_112510, &mem_112510_cached_sizze_127463, bytes_111743);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_112513, bytes_111743, "mem_112513")) {
            err = 1;
            goto cleanup;
        }
        if (mem_112515_cached_sizze_127464 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_112515, &mem_112515_cached_sizze_127464, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (memblock_alloc(ctx, &mem_in_114669, num_bytes_114668, "mem_in_114669")) {
            err = 1;
            goto cleanup;
        }
        if (mem_112567_cached_sizze_127465 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_112567, &mem_112567_cached_sizze_127465, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_112569_cached_sizze_127466 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_112569, &mem_112569_cached_sizze_127466, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_112571_cached_sizze_127467 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_112571, &mem_112571_cached_sizze_127467, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_112573_cached_sizze_127468 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_112573, &mem_112573_cached_sizze_127468, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_112575_cached_sizze_127469 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_112575, &mem_112575_cached_sizze_127469, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (mem_112577_cached_sizze_127470 < bytes_111715) {
            err = lexical_realloc(ctx, &mem_112577, &mem_112577_cached_sizze_127470, bytes_111715);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        for (int64_t SegMap_i_121982 = start_121979; SegMap_i_121982 < start_121979 + n_121981; SegMap_i_121982++) {
            int64_t slice_121983 = defunc_0_reduce_res_103765;
            int64_t gtid_106380 = SegMap_i_121982;
            int64_t remnant_121984 = SegMap_i_121982 - gtid_106380;
            int64_t eta_p_106382 = ((int64_t *) mem_111723.mem)[gtid_106380];
            int64_t eta_p_106384 = ((int64_t *) mem_111719.mem)[gtid_106380];
            int64_t lifted_lambda_res_106389 = sub64(eta_p_106384, (int64_t) 1);
            int64_t zp_lhs_106390 = add64(eta_p_106382, lifted_lambda_res_106389);
            int64_t lifted_lambda_res_106391 = add64((int64_t) 1, zp_lhs_106390);
            bool x_106392 = sle64((int64_t) 0, lifted_lambda_res_106391);
            bool y_106393 = slt64(lifted_lambda_res_106391, k_33387);
            bool bounds_check_106394 = x_106392 && y_106393;
            bool index_certs_106395;
            
            if (!bounds_check_106394) {
                set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) lifted_lambda_res_106391, "] out of bounds for array of shape [", (long long) k_33387, "].", "-> #0  unbalanced_gw.fut:155:43-52\n   #1  /prelude/functional.fut:9:44-45\n   #2  unbalanced_gw.fut:152:6-156:84\n"));
                err = FUTHARK_PROGRAM_ERROR;
                goto cleanup;
            }
            
            bool x_106398 = sle64((int64_t) 0, eta_p_106382);
            bool y_106399 = slt64(eta_p_106382, k_33387);
            bool bounds_check_106400 = x_106398 && y_106399;
            bool index_certs_106401;
            
            if (!bounds_check_106400) {
                set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) eta_p_106382, "] out of bounds for array of shape [", (long long) k_33387, "].", "-> #0  unbalanced_gw.fut:155:28-37\n   #1  /prelude/functional.fut:9:44-45\n   #2  unbalanced_gw.fut:152:6-156:84\n"));
                err = FUTHARK_PROGRAM_ERROR;
                goto cleanup;
            }
            
            double defunc_res_106404;
            double defunc_res_106405;
            double defunc_res_106406;
            double defunc_res_106407;
            double defunc_res_106408;
            double defunc_res_106409;
            double defunc_res_106410;
            double defunc_res_106411;
            double defunc_res_106412;
            int64_t flat_tid_117903 = (int64_t) 0;
            
            defunc_res_106404 = 0.0;
            defunc_res_106405 = 0.0;
            defunc_res_106406 = 0.0;
            defunc_res_106407 = 0.0;
            defunc_res_106408 = 0.0;
            defunc_res_106409 = 0.0;
            defunc_res_106410 = 0.0;
            defunc_res_106411 = 0.0;
            defunc_res_106412 = 0.0;
            
            int64_t flat_tid_117816 = (int64_t) 0;
            struct futhark_mc_task_127471 futhark_mc_task_127471_;
            
            futhark_mc_task_127471_.ctx = ctx;
            futhark_mc_task_127471_.free_m_33388 = m_33388;
            futhark_mc_task_127471_.free_eta_p_106382 = eta_p_106382;
            futhark_mc_task_127471_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
            futhark_mc_task_127471_.free_distrs_mem_111708 = distrs_mem_111708.mem;
            futhark_mc_task_127471_.free_bytes_111715 = bytes_111715;
            futhark_mc_task_127471_.free_flat_tid_117816 = flat_tid_117816;
            futhark_mc_task_127471_.free_flat_tid_117903 = flat_tid_117903;
            futhark_mc_task_127471_.retval_defunc_res_106404 = (double *) &defunc_res_106404;
            #if ISPC
            futhark_mc_task_127471_.retval_defunc_res_106404 += programIndex;
            #endif
            futhark_mc_task_127471_.retval_defunc_res_106405 = (double *) &defunc_res_106405;
            #if ISPC
            futhark_mc_task_127471_.retval_defunc_res_106405 += programIndex;
            #endif
            futhark_mc_task_127471_.retval_defunc_res_106406 = (double *) &defunc_res_106406;
            #if ISPC
            futhark_mc_task_127471_.retval_defunc_res_106406 += programIndex;
            #endif
            futhark_mc_task_127471_.retval_defunc_res_106407 = (double *) &defunc_res_106407;
            #if ISPC
            futhark_mc_task_127471_.retval_defunc_res_106407 += programIndex;
            #endif
            futhark_mc_task_127471_.retval_defunc_res_106408 = (double *) &defunc_res_106408;
            #if ISPC
            futhark_mc_task_127471_.retval_defunc_res_106408 += programIndex;
            #endif
            futhark_mc_task_127471_.retval_defunc_res_106409 = (double *) &defunc_res_106409;
            #if ISPC
            futhark_mc_task_127471_.retval_defunc_res_106409 += programIndex;
            #endif
            futhark_mc_task_127471_.retval_defunc_res_106410 = (double *) &defunc_res_106410;
            #if ISPC
            futhark_mc_task_127471_.retval_defunc_res_106410 += programIndex;
            #endif
            futhark_mc_task_127471_.retval_defunc_res_106411 = (double *) &defunc_res_106411;
            #if ISPC
            futhark_mc_task_127471_.retval_defunc_res_106411 += programIndex;
            #endif
            futhark_mc_task_127471_.retval_defunc_res_106412 = (double *) &defunc_res_106412;
            #if ISPC
            futhark_mc_task_127471_.retval_defunc_res_106412 += programIndex;
            #endif
            futhark_mc_task_127471_.retval_mem_111739 = mem_111739;
            futhark_mc_task_127471_.retval_mem_111741 = mem_111741;
            futhark_mc_task_127471_.retval_mem_111744 = mem_111744;
            
            struct scheduler_segop futhark_mc_task_127471_task;
            
            futhark_mc_task_127471_task.args = &futhark_mc_task_127471_;
            futhark_mc_task_127471_task.top_level_fn = futhark_mc_segred_task_127472;
            futhark_mc_task_127471_task.name = "futhark_mc_segred_task_127472";
            futhark_mc_task_127471_task.iterations = m_33388;
            futhark_mc_task_127471_task.task_time = &ctx->program->futhark_mc_segred_task_127472_total_time;
            futhark_mc_task_127471_task.task_iter = &ctx->program->futhark_mc_segred_task_127472_total_iter;
            futhark_mc_task_127471_task.sched = STATIC;
            futhark_mc_task_127471_task.nested_fn = futhark_mc_segred_nested_task_127488;
            
            int futhark_mc_segred_task_127472_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127471_task);
            
            if (futhark_mc_segred_task_127472_err != 0) {
                err = futhark_mc_segred_task_127472_err;
                goto cleanup;
            }
            
            double zt_res_106587 = eps_33391 * defunc_res_106404;
            double defunc_res_106588;
            double defunc_res_106589;
            double defunc_res_106590;
            double defunc_res_106591;
            int64_t flat_tid_118030 = (int64_t) 0;
            
            defunc_res_106588 = 0.0;
            defunc_res_106589 = 0.0;
            defunc_res_106590 = 0.0;
            defunc_res_106591 = 0.0;
            
            int64_t flat_tid_117984 = (int64_t) 0;
            struct futhark_mc_task_127526 futhark_mc_task_127526_;
            
            futhark_mc_task_127526_.ctx = ctx;
            futhark_mc_task_127526_.free_m_33388 = m_33388;
            futhark_mc_task_127526_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
            futhark_mc_task_127526_.free_zt_res_106587 = zt_res_106587;
            futhark_mc_task_127526_.free_distrs_mem_111708 = distrs_mem_111708.mem;
            futhark_mc_task_127526_.free_mem_111744 = mem_111744;
            futhark_mc_task_127526_.free_flat_tid_117984 = flat_tid_117984;
            futhark_mc_task_127526_.free_flat_tid_118030 = flat_tid_118030;
            futhark_mc_task_127526_.retval_defunc_res_106588 = (double *) &defunc_res_106588;
            #if ISPC
            futhark_mc_task_127526_.retval_defunc_res_106588 += programIndex;
            #endif
            futhark_mc_task_127526_.retval_defunc_res_106589 = (double *) &defunc_res_106589;
            #if ISPC
            futhark_mc_task_127526_.retval_defunc_res_106589 += programIndex;
            #endif
            futhark_mc_task_127526_.retval_defunc_res_106590 = (double *) &defunc_res_106590;
            #if ISPC
            futhark_mc_task_127526_.retval_defunc_res_106590 += programIndex;
            #endif
            futhark_mc_task_127526_.retval_defunc_res_106591 = (double *) &defunc_res_106591;
            #if ISPC
            futhark_mc_task_127526_.retval_defunc_res_106591 += programIndex;
            #endif
            futhark_mc_task_127526_.retval_mem_111746 = mem_111746;
            futhark_mc_task_127526_.retval_mem_111748 = mem_111748;
            futhark_mc_task_127526_.retval_mem_111750 = mem_111750;
            
            struct scheduler_segop futhark_mc_task_127526_task;
            
            futhark_mc_task_127526_task.args = &futhark_mc_task_127526_;
            futhark_mc_task_127526_task.top_level_fn = futhark_mc_segred_task_127527;
            futhark_mc_task_127526_task.name = "futhark_mc_segred_task_127527";
            futhark_mc_task_127526_task.iterations = m_33388;
            futhark_mc_task_127526_task.task_time = &ctx->program->futhark_mc_segred_task_127527_total_time;
            futhark_mc_task_127526_task.task_iter = &ctx->program->futhark_mc_segred_task_127527_total_iter;
            futhark_mc_task_127526_task.sched = STATIC;
            futhark_mc_task_127526_task.nested_fn = futhark_mc_segred_nested_task_127537;
            
            int futhark_mc_segred_task_127527_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127526_task);
            
            if (futhark_mc_segred_task_127527_err != 0) {
                err = futhark_mc_segred_task_127527_err;
                goto cleanup;
            }
            
            double zt_res_106687 = rho2_33390 * defunc_res_106588;
            double zt_res_106688 = rho1_33389 * defunc_res_106405;
            double zp_res_106689 = zt_res_106687 + zt_res_106688;
            double zt_res_106690 = eps_33391 * defunc_res_106406;
            double zp_res_106691 = zp_res_106689 + zt_res_106690;
            double defunc_0_reduce_res_106693;
            int64_t flat_tid_118094 = (int64_t) 0;
            
            defunc_0_reduce_res_106693 = 0.0;
            
            int64_t flat_tid_118071 = (int64_t) 0;
            struct futhark_mc_task_127558 futhark_mc_task_127558_;
            
            futhark_mc_task_127558_.ctx = ctx;
            futhark_mc_task_127558_.free_m_33388 = m_33388;
            futhark_mc_task_127558_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
            futhark_mc_task_127558_.free_A_mem_111707 = A_mem_111707.mem;
            futhark_mc_task_127558_.free_mem_111746 = mem_111746;
            futhark_mc_task_127558_.free_mem_111748 = mem_111748;
            futhark_mc_task_127558_.free_flat_tid_118071 = flat_tid_118071;
            futhark_mc_task_127558_.free_flat_tid_118094 = flat_tid_118094;
            futhark_mc_task_127558_.retval_defunc_0_reduce_res_106693 = (double *) &defunc_0_reduce_res_106693;
            #if ISPC
            futhark_mc_task_127558_.retval_defunc_0_reduce_res_106693 += programIndex;
            #endif
            futhark_mc_task_127558_.retval_mem_111752 = mem_111752;
            
            struct scheduler_segop futhark_mc_task_127558_task;
            
            futhark_mc_task_127558_task.args = &futhark_mc_task_127558_;
            futhark_mc_task_127558_task.top_level_fn = futhark_mc_segred_task_127559;
            futhark_mc_task_127558_task.name = "futhark_mc_segred_task_127559";
            futhark_mc_task_127558_task.iterations = m_33388;
            futhark_mc_task_127558_task.task_time = &ctx->program->futhark_mc_segred_task_127559_total_time;
            futhark_mc_task_127558_task.task_iter = &ctx->program->futhark_mc_segred_task_127559_total_iter;
            futhark_mc_task_127558_task.sched = STATIC;
            futhark_mc_task_127558_task.nested_fn = futhark_mc_segred_nested_task_127566;
            
            int futhark_mc_segred_task_127559_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127558_task);
            
            if (futhark_mc_segred_task_127559_err != 0) {
                err = futhark_mc_segred_task_127559_err;
                goto cleanup;
            }
            
            double defunc_0_reduce_res_106743;
            double defunc_res_106744;
            int64_t flat_tid_118252 = (int64_t) 0;
            
            defunc_0_reduce_res_106743 = 0.0;
            defunc_res_106744 = 0.0;
            
            int64_t flat_tid_118114 = (int64_t) 0;
            struct futhark_mc_task_127582 futhark_mc_task_127582_;
            
            futhark_mc_task_127582_.ctx = ctx;
            futhark_mc_task_127582_.free_m_33388 = m_33388;
            futhark_mc_task_127582_.free_safe_for_exp_33395 = safe_for_exp_33395;
            futhark_mc_task_127582_.free_neg_res_43882 = neg_res_43882;
            futhark_mc_task_127582_.free_eta_p_106382 = eta_p_106382;
            futhark_mc_task_127582_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
            futhark_mc_task_127582_.free_defunc_res_106407 = defunc_res_106407;
            futhark_mc_task_127582_.free_zt_res_106587 = zt_res_106587;
            futhark_mc_task_127582_.free_zp_res_106691 = zp_res_106691;
            futhark_mc_task_127582_.free_A_mem_111707 = A_mem_111707.mem;
            futhark_mc_task_127582_.free_distrs_mem_111708 = distrs_mem_111708.mem;
            futhark_mc_task_127582_.free_bytes_111715 = bytes_111715;
            futhark_mc_task_127582_.free_mem_111727 = mem_111727.mem;
            futhark_mc_task_127582_.free_mem_111739 = mem_111739;
            futhark_mc_task_127582_.free_mem_111741 = mem_111741;
            futhark_mc_task_127582_.free_mem_111744 = mem_111744;
            futhark_mc_task_127582_.free_mem_111750 = mem_111750;
            futhark_mc_task_127582_.free_mem_111752 = mem_111752;
            futhark_mc_task_127582_.free_flat_tid_118114 = flat_tid_118114;
            futhark_mc_task_127582_.free_flat_tid_118252 = flat_tid_118252;
            futhark_mc_task_127582_.retval_defunc_0_reduce_res_106743 = (double *) &defunc_0_reduce_res_106743;
            #if ISPC
            futhark_mc_task_127582_.retval_defunc_0_reduce_res_106743 += programIndex;
            #endif
            futhark_mc_task_127582_.retval_defunc_res_106744 = (double *) &defunc_res_106744;
            #if ISPC
            futhark_mc_task_127582_.retval_defunc_res_106744 += programIndex;
            #endif
            futhark_mc_task_127582_.retval_mem_111795 = mem_111795;
            futhark_mc_task_127582_.retval_mem_111797 = mem_111797.mem;
            
            struct scheduler_segop futhark_mc_task_127582_task;
            
            futhark_mc_task_127582_task.args = &futhark_mc_task_127582_;
            futhark_mc_task_127582_task.top_level_fn = futhark_mc_segred_task_127583;
            futhark_mc_task_127582_task.name = "futhark_mc_segred_task_127583";
            futhark_mc_task_127582_task.iterations = m_33388;
            futhark_mc_task_127582_task.task_time = &ctx->program->futhark_mc_segred_task_127583_total_time;
            futhark_mc_task_127582_task.task_iter = &ctx->program->futhark_mc_segred_task_127583_total_iter;
            futhark_mc_task_127582_task.sched = STATIC;
            futhark_mc_task_127582_task.nested_fn = futhark_mc_segred_nested_task_127595;
            
            int futhark_mc_segred_task_127583_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127582_task);
            
            if (futhark_mc_segred_task_127583_err != 0) {
                err = futhark_mc_segred_task_127583_err;
                goto cleanup;
            }
            
            int64_t flat_tid_118354 = (int64_t) 0;
            int64_t flat_tid_118344 = (int64_t) 0;
            struct futhark_mc_task_127677 futhark_mc_task_127677_;
            
            futhark_mc_task_127677_.ctx = ctx;
            futhark_mc_task_127677_.free_m_33388 = m_33388;
            futhark_mc_task_127677_.free_safe_for_exp_33395 = safe_for_exp_33395;
            futhark_mc_task_127677_.free_mem_111795 = mem_111795;
            futhark_mc_task_127677_.free_mem_111799 = mem_111799.mem;
            
            struct scheduler_segop futhark_mc_task_127677_task;
            
            futhark_mc_task_127677_task.args = &futhark_mc_task_127677_;
            futhark_mc_task_127677_task.top_level_fn = futhark_mc_segmap_task_127678;
            futhark_mc_task_127677_task.name = "futhark_mc_segmap_task_127678";
            futhark_mc_task_127677_task.iterations = m_33388;
            futhark_mc_task_127677_task.task_time = &ctx->program->futhark_mc_segmap_task_127678_total_time;
            futhark_mc_task_127677_task.task_iter = &ctx->program->futhark_mc_segmap_task_127678_total_iter;
            futhark_mc_task_127677_task.sched = STATIC;
            futhark_mc_task_127677_task.nested_fn = futhark_mc_segmap_nested_task_127684;
            
            int futhark_mc_segmap_task_127678_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127677_task);
            
            if (futhark_mc_segmap_task_127678_err != 0) {
                err = futhark_mc_segmap_task_127678_err;
                goto cleanup;
            }
            
            int64_t flat_tid_118382 = (int64_t) 0;
            int64_t flat_tid_118362 = (int64_t) 0;
            struct futhark_mc_task_127698 futhark_mc_task_127698_;
            
            futhark_mc_task_127698_.ctx = ctx;
            futhark_mc_task_127698_.free_m_33388 = m_33388;
            futhark_mc_task_127698_.free_zs_res_44842 = zs_res_44842;
            futhark_mc_task_127698_.free_zs_res_44844 = zs_res_44844;
            futhark_mc_task_127698_.free_eta_p_106382 = eta_p_106382;
            futhark_mc_task_127698_.free_distrs_mem_111708 = distrs_mem_111708.mem;
            futhark_mc_task_127698_.free_mem_111795 = mem_111795;
            futhark_mc_task_127698_.free_mem_111797 = mem_111797.mem;
            futhark_mc_task_127698_.free_mem_111799 = mem_111799.mem;
            futhark_mc_task_127698_.free_mem_111811 = mem_111811;
            futhark_mc_task_127698_.free_mem_111814 = mem_111814.mem;
            
            struct scheduler_segop futhark_mc_task_127698_task;
            
            futhark_mc_task_127698_task.args = &futhark_mc_task_127698_;
            futhark_mc_task_127698_task.top_level_fn = futhark_mc_segmap_task_127699;
            futhark_mc_task_127698_task.name = "futhark_mc_segmap_task_127699";
            futhark_mc_task_127698_task.iterations = m_33388;
            futhark_mc_task_127698_task.task_time = &ctx->program->futhark_mc_segmap_task_127699_total_time;
            futhark_mc_task_127698_task.task_iter = &ctx->program->futhark_mc_segmap_task_127699_total_iter;
            futhark_mc_task_127698_task.sched = STATIC;
            futhark_mc_task_127698_task.nested_fn = futhark_mc_segmap_nested_task_127705;
            
            int futhark_mc_segmap_task_127699_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127698_task);
            
            if (futhark_mc_segmap_task_127699_err != 0) {
                err = futhark_mc_segmap_task_127699_err;
                goto cleanup;
            }
            
            bool defunc_0_reduce_res_107041;
            int64_t flat_tid_118425 = (int64_t) 0;
            
            defunc_0_reduce_res_107041 = 0;
            
            int64_t flat_tid_118403 = (int64_t) 0;
            struct futhark_mc_task_127719 futhark_mc_task_127719_;
            
            futhark_mc_task_127719_.ctx = ctx;
            futhark_mc_task_127719_.free_m_33388 = m_33388;
            futhark_mc_task_127719_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
            futhark_mc_task_127719_.free_zs_res_44883 = zs_res_44883;
            futhark_mc_task_127719_.free_zs_res_44885 = zs_res_44885;
            futhark_mc_task_127719_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
            futhark_mc_task_127719_.free_distrs_mem_111708 = distrs_mem_111708.mem;
            futhark_mc_task_127719_.free_mem_111799 = mem_111799.mem;
            futhark_mc_task_127719_.free_mem_111811 = mem_111811;
            futhark_mc_task_127719_.free_mem_111814 = mem_111814.mem;
            futhark_mc_task_127719_.free_flat_tid_118403 = flat_tid_118403;
            futhark_mc_task_127719_.free_flat_tid_118425 = flat_tid_118425;
            futhark_mc_task_127719_.retval_defunc_0_reduce_res_107041 = (bool *) &defunc_0_reduce_res_107041;
            #if ISPC
            futhark_mc_task_127719_.retval_defunc_0_reduce_res_107041 += programIndex;
            #endif
            futhark_mc_task_127719_.retval_mem_111816 = mem_111816.mem;
            
            struct scheduler_segop futhark_mc_task_127719_task;
            
            futhark_mc_task_127719_task.args = &futhark_mc_task_127719_;
            futhark_mc_task_127719_task.top_level_fn = futhark_mc_segred_task_127720;
            futhark_mc_task_127719_task.name = "futhark_mc_segred_task_127720";
            futhark_mc_task_127719_task.iterations = m_33388;
            futhark_mc_task_127719_task.task_time = &ctx->program->futhark_mc_segred_task_127720_total_time;
            futhark_mc_task_127719_task.task_iter = &ctx->program->futhark_mc_segred_task_127720_total_iter;
            futhark_mc_task_127719_task.sched = STATIC;
            futhark_mc_task_127719_task.nested_fn = futhark_mc_segred_nested_task_127727;
            
            int futhark_mc_segred_task_127720_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127719_task);
            
            if (futhark_mc_segred_task_127720_err != 0) {
                err = futhark_mc_segred_task_127720_err;
                goto cleanup;
            }
            
            bool defunc_0_reduce_res_107087;
            int64_t flat_tid_118467 = (int64_t) 0;
            
            defunc_0_reduce_res_107087 = 0;
            
            int64_t flat_tid_118445 = (int64_t) 0;
            struct futhark_mc_task_127742 futhark_mc_task_127742_;
            
            futhark_mc_task_127742_.ctx = ctx;
            futhark_mc_task_127742_.free_m_33388 = m_33388;
            futhark_mc_task_127742_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
            futhark_mc_task_127742_.free_zs_res_44842 = zs_res_44842;
            futhark_mc_task_127742_.free_zs_res_44844 = zs_res_44844;
            futhark_mc_task_127742_.free_eta_p_106382 = eta_p_106382;
            futhark_mc_task_127742_.free_distrs_mem_111708 = distrs_mem_111708.mem;
            futhark_mc_task_127742_.free_mem_111797 = mem_111797.mem;
            futhark_mc_task_127742_.free_mem_111814 = mem_111814.mem;
            futhark_mc_task_127742_.free_mem_111816 = mem_111816.mem;
            futhark_mc_task_127742_.free_flat_tid_118445 = flat_tid_118445;
            futhark_mc_task_127742_.free_flat_tid_118467 = flat_tid_118467;
            futhark_mc_task_127742_.retval_defunc_0_reduce_res_107087 = (bool *) &defunc_0_reduce_res_107087;
            #if ISPC
            futhark_mc_task_127742_.retval_defunc_0_reduce_res_107087 += programIndex;
            #endif
            futhark_mc_task_127742_.retval_mem_111818 = mem_111818.mem;
            
            struct scheduler_segop futhark_mc_task_127742_task;
            
            futhark_mc_task_127742_task.args = &futhark_mc_task_127742_;
            futhark_mc_task_127742_task.top_level_fn = futhark_mc_segred_task_127743;
            futhark_mc_task_127742_task.name = "futhark_mc_segred_task_127743";
            futhark_mc_task_127742_task.iterations = m_33388;
            futhark_mc_task_127742_task.task_time = &ctx->program->futhark_mc_segred_task_127743_total_time;
            futhark_mc_task_127742_task.task_iter = &ctx->program->futhark_mc_segred_task_127743_total_iter;
            futhark_mc_task_127742_task.sched = STATIC;
            futhark_mc_task_127742_task.nested_fn = futhark_mc_segred_nested_task_127750;
            
            int futhark_mc_segred_task_127743_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127742_task);
            
            if (futhark_mc_segred_task_127743_err != 0) {
                err = futhark_mc_segred_task_127743_err;
                goto cleanup;
            }
            
            bool defunc_0_reduce_res_107135;
            int64_t flat_tid_118487 = (int64_t) 0;
            
            defunc_0_reduce_res_107135 = 0;
            
            struct futhark_mc_task_127765 futhark_mc_task_127765_;
            
            futhark_mc_task_127765_.ctx = ctx;
            futhark_mc_task_127765_.free_zs_res_107134 = zs_res_107134;
            futhark_mc_task_127765_.free_mem_111818 = mem_111818.mem;
            futhark_mc_task_127765_.free_flat_tid_118487 = flat_tid_118487;
            futhark_mc_task_127765_.retval_defunc_0_reduce_res_107135 = (bool *) &defunc_0_reduce_res_107135;
            #if ISPC
            futhark_mc_task_127765_.retval_defunc_0_reduce_res_107135 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_127765_task;
            
            futhark_mc_task_127765_task.args = &futhark_mc_task_127765_;
            futhark_mc_task_127765_task.top_level_fn = futhark_mc_segred_task_127766;
            futhark_mc_task_127765_task.name = "futhark_mc_segred_task_127766";
            futhark_mc_task_127765_task.iterations = m_33388;
            futhark_mc_task_127765_task.task_time = &ctx->program->futhark_mc_segred_task_127766_total_time;
            futhark_mc_task_127765_task.task_iter = &ctx->program->futhark_mc_segred_task_127766_total_iter;
            futhark_mc_task_127765_task.sched = STATIC;
            futhark_mc_task_127765_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_127766_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127765_task);
            
            if (futhark_mc_segred_task_127766_err != 0) {
                err = futhark_mc_segred_task_127766_err;
                goto cleanup;
            }
            
            bool x_110549 = !defunc_0_reduce_res_107087;
            bool y_110550 = defunc_0_reduce_res_107135 && x_110549;
            bool cond_107133 = defunc_0_reduce_res_107087 || y_110550;
            
            if (cond_107133) {
                int64_t flat_tid_118497 = (int64_t) 0;
                struct futhark_mc_task_127773 futhark_mc_task_127773_;
                
                futhark_mc_task_127773_.ctx = ctx;
                futhark_mc_task_127773_.free_m_33388 = m_33388;
                futhark_mc_task_127773_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
                futhark_mc_task_127773_.free_zs_res_107134 = zs_res_107134;
                futhark_mc_task_127773_.free_bytes_111715 = bytes_111715;
                futhark_mc_task_127773_.free_mem_111797 = mem_111797.mem;
                futhark_mc_task_127773_.free_mem_111814 = mem_111814.mem;
                futhark_mc_task_127773_.free_mem_111818 = mem_111818.mem;
                futhark_mc_task_127773_.free_mem_111832 = mem_111832.mem;
                futhark_mc_task_127773_.free_mem_111834 = mem_111834.mem;
                futhark_mc_task_127773_.free_mem_111837 = mem_111837.mem;
                
                struct scheduler_segop futhark_mc_task_127773_task;
                
                futhark_mc_task_127773_task.args = &futhark_mc_task_127773_;
                futhark_mc_task_127773_task.top_level_fn = futhark_mc_segmap_task_127774;
                futhark_mc_task_127773_task.name = "futhark_mc_segmap_task_127774";
                futhark_mc_task_127773_task.iterations = m_33388;
                futhark_mc_task_127773_task.task_time = &ctx->program->futhark_mc_segmap_task_127774_total_time;
                futhark_mc_task_127773_task.task_iter = &ctx->program->futhark_mc_segmap_task_127774_total_iter;
                futhark_mc_task_127773_task.sched = STATIC;
                futhark_mc_task_127773_task.nested_fn = NULL;
                
                int futhark_mc_segmap_task_127774_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127773_task);
                
                if (futhark_mc_segmap_task_127774_err != 0) {
                    err = futhark_mc_segmap_task_127774_err;
                    goto cleanup;
                }
                if (memblock_set(ctx, &ext_mem_111840, &mem_111832, "mem_111832") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_111839, &mem_111834, "mem_111834") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_111838, &mem_111837, "mem_111837") != 0)
                    return 1;
            } else {
                if (memblock_set(ctx, &ext_mem_111840, &mem_111818, "mem_111818") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_111839, &mem_111797, "mem_111797") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_111838, &mem_111814, "mem_111814") != 0)
                    return 1;
            }
            
            bool defunc_0_reduce_res_107172;
            int64_t flat_tid_118525 = (int64_t) 0;
            
            defunc_0_reduce_res_107172 = 0;
            
            struct futhark_mc_task_127780 futhark_mc_task_127780_;
            
            futhark_mc_task_127780_.ctx = ctx;
            futhark_mc_task_127780_.free_zs_res_107134 = zs_res_107134;
            futhark_mc_task_127780_.free_mem_111816 = mem_111816.mem;
            futhark_mc_task_127780_.free_flat_tid_118525 = flat_tid_118525;
            futhark_mc_task_127780_.retval_defunc_0_reduce_res_107172 = (bool *) &defunc_0_reduce_res_107172;
            #if ISPC
            futhark_mc_task_127780_.retval_defunc_0_reduce_res_107172 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_127780_task;
            
            futhark_mc_task_127780_task.args = &futhark_mc_task_127780_;
            futhark_mc_task_127780_task.top_level_fn = futhark_mc_segred_task_127781;
            futhark_mc_task_127780_task.name = "futhark_mc_segred_task_127781";
            futhark_mc_task_127780_task.iterations = m_33388;
            futhark_mc_task_127780_task.task_time = &ctx->program->futhark_mc_segred_task_127781_total_time;
            futhark_mc_task_127780_task.task_iter = &ctx->program->futhark_mc_segred_task_127781_total_iter;
            futhark_mc_task_127780_task.sched = STATIC;
            futhark_mc_task_127780_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_127781_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127780_task);
            
            if (futhark_mc_segred_task_127781_err != 0) {
                err = futhark_mc_segred_task_127781_err;
                goto cleanup;
            }
            
            bool x_110552 = !defunc_0_reduce_res_107041;
            bool y_110553 = defunc_0_reduce_res_107172 && x_110552;
            bool cond_107170 = defunc_0_reduce_res_107041 || y_110553;
            int64_t ext_111860;
            
            if (cond_107170) {
                ext_111860 = (int64_t) 1;
            } else {
                ext_111860 = m_33388;
            }
            
            int64_t ext_111859;
            
            if (cond_107170) {
                ext_111859 = m_33388;
            } else {
                ext_111859 = (int64_t) 1;
            }
            if (cond_107170) {
                int64_t flat_tid_118535 = (int64_t) 0;
                struct futhark_mc_task_127788 futhark_mc_task_127788_;
                
                futhark_mc_task_127788_.ctx = ctx;
                futhark_mc_task_127788_.free_m_33388 = m_33388;
                futhark_mc_task_127788_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
                futhark_mc_task_127788_.free_zs_res_107134 = zs_res_107134;
                futhark_mc_task_127788_.free_bytes_111715 = bytes_111715;
                futhark_mc_task_127788_.free_mem_111799 = mem_111799.mem;
                futhark_mc_task_127788_.free_mem_111816 = mem_111816.mem;
                futhark_mc_task_127788_.free_ext_mem_111838 = ext_mem_111838.mem;
                futhark_mc_task_127788_.free_mem_111853 = mem_111853.mem;
                futhark_mc_task_127788_.free_mem_111855 = mem_111855.mem;
                futhark_mc_task_127788_.free_mem_111858 = mem_111858.mem;
                
                struct scheduler_segop futhark_mc_task_127788_task;
                
                futhark_mc_task_127788_task.args = &futhark_mc_task_127788_;
                futhark_mc_task_127788_task.top_level_fn = futhark_mc_segmap_task_127789;
                futhark_mc_task_127788_task.name = "futhark_mc_segmap_task_127789";
                futhark_mc_task_127788_task.iterations = m_33388;
                futhark_mc_task_127788_task.task_time = &ctx->program->futhark_mc_segmap_task_127789_total_time;
                futhark_mc_task_127788_task.task_iter = &ctx->program->futhark_mc_segmap_task_127789_total_iter;
                futhark_mc_task_127788_task.sched = STATIC;
                futhark_mc_task_127788_task.nested_fn = NULL;
                
                int futhark_mc_segmap_task_127789_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127788_task);
                
                if (futhark_mc_segmap_task_127789_err != 0) {
                    err = futhark_mc_segmap_task_127789_err;
                    goto cleanup;
                }
                if (memblock_set(ctx, &ext_mem_111863, &mem_111853, "mem_111853") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_111862, &mem_111855, "mem_111855") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_111861, &mem_111858, "mem_111858") != 0)
                    return 1;
            } else {
                if (memblock_set(ctx, &ext_mem_111863, &mem_111816, "mem_111816") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_111862, &mem_111799, "mem_111799") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_111861, &ext_mem_111838, "ext_mem_111838") != 0)
                    return 1;
            }
            
            double defunc_0_reduce_res_107209;
            int64_t flat_tid_118564 = (int64_t) 0;
            
            defunc_0_reduce_res_107209 = 0.0;
            
            struct futhark_mc_task_127795 futhark_mc_task_127795_;
            
            futhark_mc_task_127795_.ctx = ctx;
            futhark_mc_task_127795_.free_mem_111811 = mem_111811;
            futhark_mc_task_127795_.free_ext_mem_111840 = ext_mem_111840.mem;
            futhark_mc_task_127795_.free_flat_tid_118564 = flat_tid_118564;
            futhark_mc_task_127795_.retval_defunc_0_reduce_res_107209 = (double *) &defunc_0_reduce_res_107209;
            #if ISPC
            futhark_mc_task_127795_.retval_defunc_0_reduce_res_107209 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_127795_task;
            
            futhark_mc_task_127795_task.args = &futhark_mc_task_127795_;
            futhark_mc_task_127795_task.top_level_fn = futhark_mc_segred_task_127796;
            futhark_mc_task_127795_task.name = "futhark_mc_segred_task_127796";
            futhark_mc_task_127795_task.iterations = m_33388;
            futhark_mc_task_127795_task.task_time = &ctx->program->futhark_mc_segred_task_127796_total_time;
            futhark_mc_task_127795_task.task_iter = &ctx->program->futhark_mc_segred_task_127796_total_iter;
            futhark_mc_task_127795_task.sched = STATIC;
            futhark_mc_task_127795_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_127796_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127795_task);
            
            if (futhark_mc_segred_task_127796_err != 0) {
                err = futhark_mc_segred_task_127796_err;
                goto cleanup;
            }
            
            bool zgze_res_107220 = tol_sinkhorn_33396 <= defunc_0_reduce_res_107209;
            int64_t ext_111950;
            int64_t ext_111949;
            int64_t ext_111948;
            bool algo3_core_loop_res_107221;
            int64_t ctx_param_ext_118579;
            int64_t ctx_param_ext_118580;
            int64_t ctx_param_ext_118581;
            bool loop_while_118582;
            
            if (memblock_set(ctx, &mem_param_118574, &ext_mem_111861, "ext_mem_111861") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_118575, &ext_mem_111840, "ext_mem_111840") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_118576, &ext_mem_111863, "ext_mem_111863") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_118577, &ext_mem_111839, "ext_mem_111839") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_118578, &ext_mem_111862, "ext_mem_111862") != 0)
                return 1;
            ctx_param_ext_118579 = (int64_t) 0;
            ctx_param_ext_118580 = ext_111860;
            ctx_param_ext_118581 = ext_111859;
            loop_while_118582 = zgze_res_107220;
            while (loop_while_118582) {
                if (memblock_alloc(ctx, &mem_118588, bytes_111715, "mem_118588")) {
                    err = 1;
                    goto cleanup;
                }
                
                bool defunc_0_reduce_res_118589;
                int64_t flat_tid_118613 = (int64_t) 0;
                
                defunc_0_reduce_res_118589 = 0;
                
                int64_t flat_tid_118591 = (int64_t) 0;
                struct futhark_mc_task_127803 futhark_mc_task_127803_;
                
                futhark_mc_task_127803_.ctx = ctx;
                futhark_mc_task_127803_.free_m_33388 = m_33388;
                futhark_mc_task_127803_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
                futhark_mc_task_127803_.free_zs_res_44883 = zs_res_44883;
                futhark_mc_task_127803_.free_zs_res_44885 = zs_res_44885;
                futhark_mc_task_127803_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
                futhark_mc_task_127803_.free_distrs_mem_111708 = distrs_mem_111708.mem;
                futhark_mc_task_127803_.free_mem_param_118574 = mem_param_118574.mem;
                futhark_mc_task_127803_.free_mem_param_118575 = mem_param_118575.mem;
                futhark_mc_task_127803_.free_mem_param_118578 = mem_param_118578.mem;
                futhark_mc_task_127803_.free_ctx_param_ext_118579 = ctx_param_ext_118579;
                futhark_mc_task_127803_.free_ctx_param_ext_118580 = ctx_param_ext_118580;
                futhark_mc_task_127803_.free_ctx_param_ext_118581 = ctx_param_ext_118581;
                futhark_mc_task_127803_.free_flat_tid_118591 = flat_tid_118591;
                futhark_mc_task_127803_.free_flat_tid_118613 = flat_tid_118613;
                futhark_mc_task_127803_.retval_defunc_0_reduce_res_118589 = (bool *) &defunc_0_reduce_res_118589;
                #if ISPC
                futhark_mc_task_127803_.retval_defunc_0_reduce_res_118589 += programIndex;
                #endif
                futhark_mc_task_127803_.retval_mem_118588 = mem_118588.mem;
                
                struct scheduler_segop futhark_mc_task_127803_task;
                
                futhark_mc_task_127803_task.args = &futhark_mc_task_127803_;
                futhark_mc_task_127803_task.top_level_fn = futhark_mc_segred_task_127804;
                futhark_mc_task_127803_task.name = "futhark_mc_segred_task_127804";
                futhark_mc_task_127803_task.iterations = m_33388;
                futhark_mc_task_127803_task.task_time = &ctx->program->futhark_mc_segred_task_127804_total_time;
                futhark_mc_task_127803_task.task_iter = &ctx->program->futhark_mc_segred_task_127804_total_iter;
                futhark_mc_task_127803_task.sched = STATIC;
                futhark_mc_task_127803_task.nested_fn = futhark_mc_segred_nested_task_127811;
                
                int futhark_mc_segred_task_127804_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127803_task);
                
                if (futhark_mc_segred_task_127804_err != 0) {
                    err = futhark_mc_segred_task_127804_err;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_118633, bytes_111715, "mem_118633")) {
                    err = 1;
                    goto cleanup;
                }
                
                bool defunc_0_reduce_res_118634;
                int64_t flat_tid_118658 = (int64_t) 0;
                
                defunc_0_reduce_res_118634 = 0;
                
                int64_t flat_tid_118636 = (int64_t) 0;
                struct futhark_mc_task_127826 futhark_mc_task_127826_;
                
                futhark_mc_task_127826_.ctx = ctx;
                futhark_mc_task_127826_.free_m_33388 = m_33388;
                futhark_mc_task_127826_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
                futhark_mc_task_127826_.free_zs_res_44842 = zs_res_44842;
                futhark_mc_task_127826_.free_zs_res_44844 = zs_res_44844;
                futhark_mc_task_127826_.free_eta_p_106382 = eta_p_106382;
                futhark_mc_task_127826_.free_distrs_mem_111708 = distrs_mem_111708.mem;
                futhark_mc_task_127826_.free_mem_param_118574 = mem_param_118574.mem;
                futhark_mc_task_127826_.free_mem_param_118577 = mem_param_118577.mem;
                futhark_mc_task_127826_.free_ctx_param_ext_118579 = ctx_param_ext_118579;
                futhark_mc_task_127826_.free_ctx_param_ext_118580 = ctx_param_ext_118580;
                futhark_mc_task_127826_.free_ctx_param_ext_118581 = ctx_param_ext_118581;
                futhark_mc_task_127826_.free_mem_118588 = mem_118588.mem;
                futhark_mc_task_127826_.free_flat_tid_118636 = flat_tid_118636;
                futhark_mc_task_127826_.free_flat_tid_118658 = flat_tid_118658;
                futhark_mc_task_127826_.retval_defunc_0_reduce_res_118634 = (bool *) &defunc_0_reduce_res_118634;
                #if ISPC
                futhark_mc_task_127826_.retval_defunc_0_reduce_res_118634 += programIndex;
                #endif
                futhark_mc_task_127826_.retval_mem_118633 = mem_118633.mem;
                
                struct scheduler_segop futhark_mc_task_127826_task;
                
                futhark_mc_task_127826_task.args = &futhark_mc_task_127826_;
                futhark_mc_task_127826_task.top_level_fn = futhark_mc_segred_task_127827;
                futhark_mc_task_127826_task.name = "futhark_mc_segred_task_127827";
                futhark_mc_task_127826_task.iterations = m_33388;
                futhark_mc_task_127826_task.task_time = &ctx->program->futhark_mc_segred_task_127827_total_time;
                futhark_mc_task_127826_task.task_iter = &ctx->program->futhark_mc_segred_task_127827_total_iter;
                futhark_mc_task_127826_task.sched = STATIC;
                futhark_mc_task_127826_task.nested_fn = futhark_mc_segred_nested_task_127834;
                
                int futhark_mc_segred_task_127827_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127826_task);
                
                if (futhark_mc_segred_task_127827_err != 0) {
                    err = futhark_mc_segred_task_127827_err;
                    goto cleanup;
                }
                
                bool defunc_0_reduce_res_118678;
                int64_t flat_tid_118679 = (int64_t) 0;
                
                defunc_0_reduce_res_118678 = 0;
                
                struct futhark_mc_task_127849 futhark_mc_task_127849_;
                
                futhark_mc_task_127849_.ctx = ctx;
                futhark_mc_task_127849_.free_zs_res_107134 = zs_res_107134;
                futhark_mc_task_127849_.free_mem_118633 = mem_118633.mem;
                futhark_mc_task_127849_.free_flat_tid_118679 = flat_tid_118679;
                futhark_mc_task_127849_.retval_defunc_0_reduce_res_118678 = (bool *) &defunc_0_reduce_res_118678;
                #if ISPC
                futhark_mc_task_127849_.retval_defunc_0_reduce_res_118678 += programIndex;
                #endif
                
                struct scheduler_segop futhark_mc_task_127849_task;
                
                futhark_mc_task_127849_task.args = &futhark_mc_task_127849_;
                futhark_mc_task_127849_task.top_level_fn = futhark_mc_segred_task_127850;
                futhark_mc_task_127849_task.name = "futhark_mc_segred_task_127850";
                futhark_mc_task_127849_task.iterations = m_33388;
                futhark_mc_task_127849_task.task_time = &ctx->program->futhark_mc_segred_task_127850_total_time;
                futhark_mc_task_127849_task.task_iter = &ctx->program->futhark_mc_segred_task_127850_total_iter;
                futhark_mc_task_127849_task.sched = STATIC;
                futhark_mc_task_127849_task.nested_fn = NULL;
                
                int futhark_mc_segred_task_127850_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127849_task);
                
                if (futhark_mc_segred_task_127850_err != 0) {
                    err = futhark_mc_segred_task_127850_err;
                    goto cleanup;
                }
                
                bool x_118686 = !defunc_0_reduce_res_118634;
                bool y_118687 = defunc_0_reduce_res_118678 && x_118686;
                bool cond_118688 = defunc_0_reduce_res_118634 || y_118687;
                int64_t ext_118689;
                
                if (cond_118688) {
                    ext_118689 = (int64_t) 0;
                } else {
                    ext_118689 = ctx_param_ext_118579;
                }
                
                int64_t ext_118690;
                
                if (cond_118688) {
                    ext_118690 = m_33388;
                } else {
                    ext_118690 = ctx_param_ext_118580;
                }
                
                int64_t ext_118691;
                
                if (cond_118688) {
                    ext_118691 = (int64_t) 1;
                } else {
                    ext_118691 = ctx_param_ext_118581;
                }
                if (memblock_alloc(ctx, &mem_118692, bytes_111715, "mem_118692")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_118693, bytes_111715, "mem_118693")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_118694, bytes_111743, "mem_118694")) {
                    err = 1;
                    goto cleanup;
                }
                if (cond_118688) {
                    double zs_res_118701 = 1.0 / exp_absorb_cutoff_33394;
                    int64_t bytes_118702 = (int64_t) 8 * m_33388;
                    int64_t flat_tid_118706 = (int64_t) 0;
                    struct futhark_mc_task_127857 futhark_mc_task_127857_;
                    
                    futhark_mc_task_127857_.ctx = ctx;
                    futhark_mc_task_127857_.free_m_33388 = m_33388;
                    futhark_mc_task_127857_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
                    futhark_mc_task_127857_.free_mem_param_118574 = mem_param_118574.mem;
                    futhark_mc_task_127857_.free_mem_param_118577 = mem_param_118577.mem;
                    futhark_mc_task_127857_.free_ctx_param_ext_118579 = ctx_param_ext_118579;
                    futhark_mc_task_127857_.free_ctx_param_ext_118580 = ctx_param_ext_118580;
                    futhark_mc_task_127857_.free_ctx_param_ext_118581 = ctx_param_ext_118581;
                    futhark_mc_task_127857_.free_mem_118633 = mem_118633.mem;
                    futhark_mc_task_127857_.free_mem_118692 = mem_118692.mem;
                    futhark_mc_task_127857_.free_mem_118693 = mem_118693.mem;
                    futhark_mc_task_127857_.free_mem_118694 = mem_118694.mem;
                    futhark_mc_task_127857_.free_zs_res_118701 = zs_res_118701;
                    futhark_mc_task_127857_.free_bytes_118702 = bytes_118702;
                    
                    struct scheduler_segop futhark_mc_task_127857_task;
                    
                    futhark_mc_task_127857_task.args = &futhark_mc_task_127857_;
                    futhark_mc_task_127857_task.top_level_fn = futhark_mc_segmap_task_127858;
                    futhark_mc_task_127857_task.name = "futhark_mc_segmap_task_127858";
                    futhark_mc_task_127857_task.iterations = m_33388;
                    futhark_mc_task_127857_task.task_time = &ctx->program->futhark_mc_segmap_task_127858_total_time;
                    futhark_mc_task_127857_task.task_iter = &ctx->program->futhark_mc_segmap_task_127858_total_iter;
                    futhark_mc_task_127857_task.sched = STATIC;
                    futhark_mc_task_127857_task.nested_fn = NULL;
                    
                    int futhark_mc_segmap_task_127858_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127857_task);
                    
                    if (futhark_mc_segmap_task_127858_err != 0) {
                        err = futhark_mc_segmap_task_127858_err;
                        goto cleanup;
                    }
                    if (memblock_set(ctx, &ext_mem_118695, &mem_118692, "mem_118692") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_118696, &mem_118693, "mem_118693") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_118697, &mem_118694, "mem_118694") != 0)
                        return 1;
                } else {
                    if (memblock_set(ctx, &ext_mem_118695, &mem_118633, "mem_118633") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_118696, &mem_param_118577, "mem_param_118577") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_118697, &mem_param_118574, "mem_param_118574") != 0)
                        return 1;
                }
                if (memblock_unref(ctx, &mem_118633, "mem_118633") != 0)
                    return 1;
                if (memblock_unref(ctx, &mem_118692, "mem_118692") != 0)
                    return 1;
                if (memblock_unref(ctx, &mem_118693, "mem_118693") != 0)
                    return 1;
                if (memblock_unref(ctx, &mem_118694, "mem_118694") != 0)
                    return 1;
                
                bool defunc_0_reduce_res_118736;
                int64_t flat_tid_118737 = (int64_t) 0;
                
                defunc_0_reduce_res_118736 = 0;
                
                struct futhark_mc_task_127864 futhark_mc_task_127864_;
                
                futhark_mc_task_127864_.ctx = ctx;
                futhark_mc_task_127864_.free_zs_res_107134 = zs_res_107134;
                futhark_mc_task_127864_.free_mem_118588 = mem_118588.mem;
                futhark_mc_task_127864_.free_flat_tid_118737 = flat_tid_118737;
                futhark_mc_task_127864_.retval_defunc_0_reduce_res_118736 = (bool *) &defunc_0_reduce_res_118736;
                #if ISPC
                futhark_mc_task_127864_.retval_defunc_0_reduce_res_118736 += programIndex;
                #endif
                
                struct scheduler_segop futhark_mc_task_127864_task;
                
                futhark_mc_task_127864_task.args = &futhark_mc_task_127864_;
                futhark_mc_task_127864_task.top_level_fn = futhark_mc_segred_task_127865;
                futhark_mc_task_127864_task.name = "futhark_mc_segred_task_127865";
                futhark_mc_task_127864_task.iterations = m_33388;
                futhark_mc_task_127864_task.task_time = &ctx->program->futhark_mc_segred_task_127865_total_time;
                futhark_mc_task_127864_task.task_iter = &ctx->program->futhark_mc_segred_task_127865_total_iter;
                futhark_mc_task_127864_task.sched = STATIC;
                futhark_mc_task_127864_task.nested_fn = NULL;
                
                int futhark_mc_segred_task_127865_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127864_task);
                
                if (futhark_mc_segred_task_127865_err != 0) {
                    err = futhark_mc_segred_task_127865_err;
                    goto cleanup;
                }
                
                bool x_118744 = !defunc_0_reduce_res_118589;
                bool y_118745 = defunc_0_reduce_res_118736 && x_118744;
                bool cond_118746 = defunc_0_reduce_res_118589 || y_118745;
                int64_t ext_118748;
                
                if (cond_118746) {
                    ext_118748 = (int64_t) 0;
                } else {
                    ext_118748 = ext_118689;
                }
                
                int64_t ext_118749;
                
                if (cond_118746) {
                    ext_118749 = (int64_t) 1;
                } else {
                    ext_118749 = ext_118690;
                }
                
                int64_t ext_118750;
                
                if (cond_118746) {
                    ext_118750 = m_33388;
                } else {
                    ext_118750 = ext_118691;
                }
                if (memblock_alloc(ctx, &mem_118751, bytes_111715, "mem_118751")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_118752, bytes_111715, "mem_118752")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_118753, bytes_111743, "mem_118753")) {
                    err = 1;
                    goto cleanup;
                }
                if (cond_118746) {
                    double zs_res_118760 = 1.0 / exp_absorb_cutoff_33394;
                    int64_t bytes_118761 = (int64_t) 8 * m_33388;
                    int64_t flat_tid_118765 = (int64_t) 0;
                    struct futhark_mc_task_127872 futhark_mc_task_127872_;
                    
                    futhark_mc_task_127872_.ctx = ctx;
                    futhark_mc_task_127872_.free_m_33388 = m_33388;
                    futhark_mc_task_127872_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
                    futhark_mc_task_127872_.free_mem_param_118578 = mem_param_118578.mem;
                    futhark_mc_task_127872_.free_mem_118588 = mem_118588.mem;
                    futhark_mc_task_127872_.free_ext_118689 = ext_118689;
                    futhark_mc_task_127872_.free_ext_118690 = ext_118690;
                    futhark_mc_task_127872_.free_ext_118691 = ext_118691;
                    futhark_mc_task_127872_.free_ext_mem_118697 = ext_mem_118697.mem;
                    futhark_mc_task_127872_.free_mem_118751 = mem_118751.mem;
                    futhark_mc_task_127872_.free_mem_118752 = mem_118752.mem;
                    futhark_mc_task_127872_.free_mem_118753 = mem_118753.mem;
                    futhark_mc_task_127872_.free_zs_res_118760 = zs_res_118760;
                    futhark_mc_task_127872_.free_bytes_118761 = bytes_118761;
                    
                    struct scheduler_segop futhark_mc_task_127872_task;
                    
                    futhark_mc_task_127872_task.args = &futhark_mc_task_127872_;
                    futhark_mc_task_127872_task.top_level_fn = futhark_mc_segmap_task_127873;
                    futhark_mc_task_127872_task.name = "futhark_mc_segmap_task_127873";
                    futhark_mc_task_127872_task.iterations = m_33388;
                    futhark_mc_task_127872_task.task_time = &ctx->program->futhark_mc_segmap_task_127873_total_time;
                    futhark_mc_task_127872_task.task_iter = &ctx->program->futhark_mc_segmap_task_127873_total_iter;
                    futhark_mc_task_127872_task.sched = STATIC;
                    futhark_mc_task_127872_task.nested_fn = NULL;
                    
                    int futhark_mc_segmap_task_127873_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127872_task);
                    
                    if (futhark_mc_segmap_task_127873_err != 0) {
                        err = futhark_mc_segmap_task_127873_err;
                        goto cleanup;
                    }
                    if (memblock_set(ctx, &ext_mem_118754, &mem_118751, "mem_118751") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_118755, &mem_118752, "mem_118752") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_118756, &mem_118753, "mem_118753") != 0)
                        return 1;
                } else {
                    if (memblock_set(ctx, &ext_mem_118754, &mem_118588, "mem_118588") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_118755, &mem_param_118578, "mem_param_118578") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_118756, &ext_mem_118697, "ext_mem_118697") != 0)
                        return 1;
                }
                if (memblock_unref(ctx, &mem_118588, "mem_118588") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_118697, "ext_mem_118697") != 0)
                    return 1;
                if (memblock_unref(ctx, &mem_118751, "mem_118751") != 0)
                    return 1;
                if (memblock_unref(ctx, &mem_118752, "mem_118752") != 0)
                    return 1;
                if (memblock_unref(ctx, &mem_118753, "mem_118753") != 0)
                    return 1;
                
                double defunc_0_reduce_res_118796;
                int64_t flat_tid_118797 = (int64_t) 0;
                
                defunc_0_reduce_res_118796 = 0.0;
                
                struct futhark_mc_task_127879 futhark_mc_task_127879_;
                
                futhark_mc_task_127879_.ctx = ctx;
                futhark_mc_task_127879_.free_mem_param_118575 = mem_param_118575.mem;
                futhark_mc_task_127879_.free_ext_mem_118695 = ext_mem_118695.mem;
                futhark_mc_task_127879_.free_flat_tid_118797 = flat_tid_118797;
                futhark_mc_task_127879_.retval_defunc_0_reduce_res_118796 = (double *) &defunc_0_reduce_res_118796;
                #if ISPC
                futhark_mc_task_127879_.retval_defunc_0_reduce_res_118796 += programIndex;
                #endif
                
                struct scheduler_segop futhark_mc_task_127879_task;
                
                futhark_mc_task_127879_task.args = &futhark_mc_task_127879_;
                futhark_mc_task_127879_task.top_level_fn = futhark_mc_segred_task_127880;
                futhark_mc_task_127879_task.name = "futhark_mc_segred_task_127880";
                futhark_mc_task_127879_task.iterations = m_33388;
                futhark_mc_task_127879_task.task_time = &ctx->program->futhark_mc_segred_task_127880_total_time;
                futhark_mc_task_127879_task.task_iter = &ctx->program->futhark_mc_segred_task_127880_total_iter;
                futhark_mc_task_127879_task.sched = STATIC;
                futhark_mc_task_127879_task.nested_fn = NULL;
                
                int futhark_mc_segred_task_127880_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127879_task);
                
                if (futhark_mc_segred_task_127880_err != 0) {
                    err = futhark_mc_segred_task_127880_err;
                    goto cleanup;
                }
                
                bool zgze_res_118807 = tol_sinkhorn_33396 <= defunc_0_reduce_res_118796;
                
                if (memblock_set(ctx, &mem_param_tmp_123036, &ext_mem_118756, "ext_mem_118756") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_123037, &ext_mem_118695, "ext_mem_118695") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_123038, &ext_mem_118754, "ext_mem_118754") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_123039, &ext_mem_118696, "ext_mem_118696") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_123040, &ext_mem_118755, "ext_mem_118755") != 0)
                    return 1;
                
                int64_t ctx_param_ext_tmp_123041 = ext_118748;
                int64_t ctx_param_ext_tmp_123042 = ext_118749;
                int64_t ctx_param_ext_tmp_123043 = ext_118750;
                bool loop_while_tmp_123044 = zgze_res_118807;
                
                if (memblock_set(ctx, &mem_param_118574, &mem_param_tmp_123036, "mem_param_tmp_123036") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_118575, &mem_param_tmp_123037, "mem_param_tmp_123037") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_118576, &mem_param_tmp_123038, "mem_param_tmp_123038") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_118577, &mem_param_tmp_123039, "mem_param_tmp_123039") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_118578, &mem_param_tmp_123040, "mem_param_tmp_123040") != 0)
                    return 1;
                ctx_param_ext_118579 = ctx_param_ext_tmp_123041;
                ctx_param_ext_118580 = ctx_param_ext_tmp_123042;
                ctx_param_ext_118581 = ctx_param_ext_tmp_123043;
                loop_while_118582 = loop_while_tmp_123044;
            }
            if (memblock_set(ctx, &ext_mem_111955, &mem_param_118574, "mem_param_118574") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_111954, &mem_param_118575, "mem_param_118575") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_111953, &mem_param_118576, "mem_param_118576") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_111952, &mem_param_118577, "mem_param_118577") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_111951, &mem_param_118578, "mem_param_118578") != 0)
                return 1;
            ext_111950 = ctx_param_ext_118579;
            ext_111949 = ctx_param_ext_118580;
            ext_111948 = ctx_param_ext_118581;
            algo3_core_loop_res_107221 = loop_while_118582;
            
            double defunc_res_107414;
            int64_t flat_tid_118826 = (int64_t) 0;
            
            defunc_res_107414 = 0.0;
            
            int64_t flat_tid_118808 = (int64_t) 0;
            struct futhark_mc_task_127887 futhark_mc_task_127887_;
            
            futhark_mc_task_127887_.ctx = ctx;
            futhark_mc_task_127887_.free_m_33388 = m_33388;
            futhark_mc_task_127887_.free_bytes_111715 = bytes_111715;
            futhark_mc_task_127887_.free_ext_111948 = ext_111948;
            futhark_mc_task_127887_.free_ext_111949 = ext_111949;
            futhark_mc_task_127887_.free_ext_111950 = ext_111950;
            futhark_mc_task_127887_.free_ext_mem_111953 = ext_mem_111953.mem;
            futhark_mc_task_127887_.free_ext_mem_111954 = ext_mem_111954.mem;
            futhark_mc_task_127887_.free_ext_mem_111955 = ext_mem_111955.mem;
            futhark_mc_task_127887_.free_flat_tid_118808 = flat_tid_118808;
            futhark_mc_task_127887_.free_flat_tid_118826 = flat_tid_118826;
            futhark_mc_task_127887_.retval_defunc_res_107414 = (double *) &defunc_res_107414;
            #if ISPC
            futhark_mc_task_127887_.retval_defunc_res_107414 += programIndex;
            #endif
            futhark_mc_task_127887_.retval_mem_111968 = mem_111968;
            
            struct scheduler_segop futhark_mc_task_127887_task;
            
            futhark_mc_task_127887_task.args = &futhark_mc_task_127887_;
            futhark_mc_task_127887_task.top_level_fn = futhark_mc_segred_task_127888;
            futhark_mc_task_127887_task.name = "futhark_mc_segred_task_127888";
            futhark_mc_task_127887_task.iterations = m_33388;
            futhark_mc_task_127887_task.task_time = &ctx->program->futhark_mc_segred_task_127888_total_time;
            futhark_mc_task_127887_task.task_iter = &ctx->program->futhark_mc_segred_task_127888_total_iter;
            futhark_mc_task_127887_task.sched = STATIC;
            futhark_mc_task_127887_task.nested_fn = futhark_mc_segred_nested_task_127896;
            
            int futhark_mc_segred_task_127888_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127887_task);
            
            if (futhark_mc_segred_task_127888_err != 0) {
                err = futhark_mc_segred_task_127888_err;
                goto cleanup;
            }
            
            double zs_res_107450 = defunc_res_106407 / defunc_res_107414;
            double sqrt_res_107451 = futrts_sqrt64(zs_res_107450);
            bool defunc_0_reduce_comm_res_107452;
            int64_t flat_tid_118867 = (int64_t) 0;
            
            defunc_0_reduce_comm_res_107452 = 0;
            
            int64_t flat_tid_118845 = (int64_t) 0;
            struct futhark_mc_task_127919 futhark_mc_task_127919_;
            
            futhark_mc_task_127919_.ctx = ctx;
            futhark_mc_task_127919_.free_m_33388 = m_33388;
            futhark_mc_task_127919_.free_zp_res_43884 = zp_res_43884;
            futhark_mc_task_127919_.free_sqrt_res_107451 = sqrt_res_107451;
            futhark_mc_task_127919_.free_bytes_111715 = bytes_111715;
            futhark_mc_task_127919_.free_mem_111744 = mem_111744;
            futhark_mc_task_127919_.free_mem_111968 = mem_111968;
            futhark_mc_task_127919_.free_flat_tid_118845 = flat_tid_118845;
            futhark_mc_task_127919_.free_flat_tid_118867 = flat_tid_118867;
            futhark_mc_task_127919_.retval_defunc_0_reduce_comm_res_107452 = (bool *) &defunc_0_reduce_comm_res_107452;
            #if ISPC
            futhark_mc_task_127919_.retval_defunc_0_reduce_comm_res_107452 += programIndex;
            #endif
            futhark_mc_task_127919_.retval_mem_111981 = mem_111981.mem;
            
            struct scheduler_segop futhark_mc_task_127919_task;
            
            futhark_mc_task_127919_task.args = &futhark_mc_task_127919_;
            futhark_mc_task_127919_task.top_level_fn = futhark_mc_segred_task_127920;
            futhark_mc_task_127919_task.name = "futhark_mc_segred_task_127920";
            futhark_mc_task_127919_task.iterations = m_33388;
            futhark_mc_task_127919_task.task_time = &ctx->program->futhark_mc_segred_task_127920_total_time;
            futhark_mc_task_127919_task.task_iter = &ctx->program->futhark_mc_segred_task_127920_total_iter;
            futhark_mc_task_127919_task.sched = STATIC;
            futhark_mc_task_127919_task.nested_fn = futhark_mc_segred_nested_task_127928;
            
            int futhark_mc_segred_task_127920_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127919_task);
            
            if (futhark_mc_segred_task_127920_err != 0) {
                err = futhark_mc_segred_task_127920_err;
                goto cleanup;
            }
            
            double zt_res_107498 = -2.0 * defunc_res_106744;
            double zp_res_107499 = defunc_0_reduce_res_106743 + zt_res_107498;
            double zp_res_107500 = defunc_0_reduce_res_106693 + zp_res_107499;
            double zt_res_107501 = eps_33391 * defunc_res_106410;
            double zt_res_107502 = rho1_33389 * defunc_res_106408;
            double zt_res_107503 = rho2_33390 * defunc_res_106589;
            double zp_res_107504 = zt_res_107501 + zt_res_107502;
            double zp_res_107505 = zt_res_107503 + zp_res_107504;
            double zt_res_107506 = 2.0 * zp_res_107505;
            double zt_res_107507 = defunc_res_106409 * zt_res_107506;
            double zp_res_107508 = zp_res_107500 + zt_res_107507;
            double zt_res_107509 = defunc_res_106409 * defunc_res_106409;
            double zt_res_107510 = zp_res_46827 * zt_res_107509;
            double zm_res_107511 = zp_res_107508 - zt_res_107510;
            double zt_res_107512 = defunc_res_106411 * defunc_res_106590;
            double zt_res_107513 = rho1_33389 * defunc_res_106411;
            double zt_res_107514 = defunc_res_106411 * zt_res_107513;
            double zt_res_107515 = rho2_33390 * defunc_res_106590;
            double zt_res_107516 = defunc_res_106590 * zt_res_107515;
            double zp_res_107517 = zt_res_107514 + zt_res_107516;
            double zt_res_107518 = eps_33391 * zt_res_107512;
            double zt_res_107519 = zt_res_107512 * zt_res_107518;
            double zp_res_107520 = zp_res_107517 + zt_res_107519;
            double zp_res_107521 = zm_res_107511 + zp_res_107520;
            bool defunc_0_reduce_res_107523;
            int64_t flat_tid_118903 = (int64_t) 0;
            
            defunc_0_reduce_res_107523 = 0;
            
            int64_t flat_tid_118890 = (int64_t) 0;
            struct futhark_mc_task_127951 futhark_mc_task_127951_;
            
            futhark_mc_task_127951_.ctx = ctx;
            futhark_mc_task_127951_.free_m_33388 = m_33388;
            futhark_mc_task_127951_.free_mem_111981 = mem_111981.mem;
            futhark_mc_task_127951_.free_flat_tid_118890 = flat_tid_118890;
            futhark_mc_task_127951_.free_flat_tid_118903 = flat_tid_118903;
            futhark_mc_task_127951_.retval_defunc_0_reduce_res_107523 = (bool *) &defunc_0_reduce_res_107523;
            #if ISPC
            futhark_mc_task_127951_.retval_defunc_0_reduce_res_107523 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_127951_task;
            
            futhark_mc_task_127951_task.args = &futhark_mc_task_127951_;
            futhark_mc_task_127951_task.top_level_fn = futhark_mc_segred_task_127952;
            futhark_mc_task_127951_task.name = "futhark_mc_segred_task_127952";
            futhark_mc_task_127951_task.iterations = m_33388;
            futhark_mc_task_127951_task.task_time = &ctx->program->futhark_mc_segred_task_127952_total_time;
            futhark_mc_task_127951_task.task_iter = &ctx->program->futhark_mc_segred_task_127952_total_iter;
            futhark_mc_task_127951_task.sched = STATIC;
            futhark_mc_task_127951_task.nested_fn = futhark_mc_segred_nested_task_127959;
            
            int futhark_mc_segred_task_127952_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127951_task);
            
            if (futhark_mc_segred_task_127952_err != 0) {
                err = futhark_mc_segred_task_127952_err;
                goto cleanup;
            }
            
            bool x_110554 = defunc_0_reduce_comm_res_107452 && defunc_0_reduce_res_107523;
            double x_114081;
            int64_t flat_tid_118914 = (int64_t) 0;
            
            x_114081 = 0.0;
            
            struct futhark_mc_task_127974 futhark_mc_task_127974_;
            
            futhark_mc_task_127974_.ctx = ctx;
            futhark_mc_task_127974_.free_m_33388 = m_33388;
            futhark_mc_task_127974_.free_eta_p_106382 = eta_p_106382;
            futhark_mc_task_127974_.free_distrs_mem_111708 = distrs_mem_111708.mem;
            futhark_mc_task_127974_.free_flat_tid_118914 = flat_tid_118914;
            futhark_mc_task_127974_.retval_x_114081 = (double *) &x_114081;
            #if ISPC
            futhark_mc_task_127974_.retval_x_114081 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_127974_task;
            
            futhark_mc_task_127974_task.args = &futhark_mc_task_127974_;
            futhark_mc_task_127974_task.top_level_fn = futhark_mc_segred_task_127975;
            futhark_mc_task_127974_task.name = "futhark_mc_segred_task_127975";
            futhark_mc_task_127974_task.iterations = m_33388;
            futhark_mc_task_127974_task.task_time = &ctx->program->futhark_mc_segred_task_127975_total_time;
            futhark_mc_task_127974_task.task_iter = &ctx->program->futhark_mc_segred_task_127975_total_iter;
            futhark_mc_task_127974_task.sched = STATIC;
            futhark_mc_task_127974_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_127975_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127974_task);
            
            if (futhark_mc_segred_task_127975_err != 0) {
                err = futhark_mc_segred_task_127975_err;
                goto cleanup;
            }
            
            double x_114083;
            int64_t flat_tid_118920 = (int64_t) 0;
            
            x_114083 = 0.0;
            
            struct futhark_mc_task_127982 futhark_mc_task_127982_;
            
            futhark_mc_task_127982_.ctx = ctx;
            futhark_mc_task_127982_.free_m_33388 = m_33388;
            futhark_mc_task_127982_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
            futhark_mc_task_127982_.free_distrs_mem_111708 = distrs_mem_111708.mem;
            futhark_mc_task_127982_.free_flat_tid_118920 = flat_tid_118920;
            futhark_mc_task_127982_.retval_x_114083 = (double *) &x_114083;
            #if ISPC
            futhark_mc_task_127982_.retval_x_114083 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_127982_task;
            
            futhark_mc_task_127982_task.args = &futhark_mc_task_127982_;
            futhark_mc_task_127982_task.top_level_fn = futhark_mc_segred_task_127983;
            futhark_mc_task_127982_task.name = "futhark_mc_segred_task_127983";
            futhark_mc_task_127982_task.iterations = m_33388;
            futhark_mc_task_127982_task.task_time = &ctx->program->futhark_mc_segred_task_127983_total_time;
            futhark_mc_task_127982_task.task_iter = &ctx->program->futhark_mc_segred_task_127983_total_iter;
            futhark_mc_task_127982_task.sched = STATIC;
            futhark_mc_task_127982_task.nested_fn = NULL;
            
            int futhark_mc_segred_task_127983_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127982_task);
            
            if (futhark_mc_segred_task_127983_err != 0) {
                err = futhark_mc_segred_task_127983_err;
                goto cleanup;
            }
            
            double zt_res_109590 = x_114081 * x_114083;
            double zt_res_109591 = rho1_33389 * x_114081;
            double zt_res_109592 = zt_res_109591 * x_114081;
            double zt_res_109593 = rho2_33390 * x_114083;
            double zt_res_109594 = zt_res_109593 * x_114083;
            double zp_res_109595 = zt_res_109592 + zt_res_109594;
            double zt_res_109596 = eps_33391 * zt_res_109590;
            double zt_res_109597 = zt_res_109590 * zt_res_109596;
            double zp_res_109598 = zp_res_109595 + zt_res_109597;
            bool final_plan_107550;
            double final_plan_107554;
            bool loop_while_118929;
            double loss_118933;
            
            if (memblock_set(ctx, &mem_param_118926, &ext_mem_111952, "ext_mem_111952") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_118927, &ext_mem_111951, "ext_mem_111951") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_118928, &mem_111981, "mem_111981") != 0)
                return 1;
            loop_while_118929 = x_110554;
            loss_118933 = zp_res_107521;
            while (loop_while_118929) {
                double defunc_res_118934;
                double defunc_res_118935;
                double defunc_res_118936;
                double defunc_res_118937;
                int64_t flat_tid_118989 = (int64_t) 0;
                
                defunc_res_118934 = 0.0;
                defunc_res_118935 = 0.0;
                defunc_res_118936 = 0.0;
                defunc_res_118937 = 0.0;
                
                int64_t flat_tid_118939 = (int64_t) 0;
                struct futhark_mc_task_127990 futhark_mc_task_127990_;
                
                futhark_mc_task_127990_.ctx = ctx;
                futhark_mc_task_127990_.free_m_33388 = m_33388;
                futhark_mc_task_127990_.free_eta_p_106382 = eta_p_106382;
                futhark_mc_task_127990_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
                futhark_mc_task_127990_.free_distrs_mem_111708 = distrs_mem_111708.mem;
                futhark_mc_task_127990_.free_mem_param_118928 = mem_param_118928.mem;
                futhark_mc_task_127990_.free_flat_tid_118939 = flat_tid_118939;
                futhark_mc_task_127990_.free_flat_tid_118989 = flat_tid_118989;
                futhark_mc_task_127990_.retval_defunc_res_118934 = (double *) &defunc_res_118934;
                #if ISPC
                futhark_mc_task_127990_.retval_defunc_res_118934 += programIndex;
                #endif
                futhark_mc_task_127990_.retval_defunc_res_118935 = (double *) &defunc_res_118935;
                #if ISPC
                futhark_mc_task_127990_.retval_defunc_res_118935 += programIndex;
                #endif
                futhark_mc_task_127990_.retval_defunc_res_118936 = (double *) &defunc_res_118936;
                #if ISPC
                futhark_mc_task_127990_.retval_defunc_res_118936 += programIndex;
                #endif
                futhark_mc_task_127990_.retval_defunc_res_118937 = (double *) &defunc_res_118937;
                #if ISPC
                futhark_mc_task_127990_.retval_defunc_res_118937 += programIndex;
                #endif
                futhark_mc_task_127990_.retval_mem_111993 = mem_111993;
                
                struct scheduler_segop futhark_mc_task_127990_task;
                
                futhark_mc_task_127990_task.args = &futhark_mc_task_127990_;
                futhark_mc_task_127990_task.top_level_fn = futhark_mc_segred_task_127991;
                futhark_mc_task_127990_task.name = "futhark_mc_segred_task_127991";
                futhark_mc_task_127990_task.iterations = m_33388;
                futhark_mc_task_127990_task.task_time = &ctx->program->futhark_mc_segred_task_127991_total_time;
                futhark_mc_task_127990_task.task_iter = &ctx->program->futhark_mc_segred_task_127991_total_iter;
                futhark_mc_task_127990_task.sched = STATIC;
                futhark_mc_task_127990_task.nested_fn = futhark_mc_segred_nested_task_128001;
                
                int futhark_mc_segred_task_127991_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127990_task);
                
                if (futhark_mc_segred_task_127991_err != 0) {
                    err = futhark_mc_segred_task_127991_err;
                    goto cleanup;
                }
                
                double zt_res_119033 = eps_33391 * defunc_res_118934;
                double defunc_res_119034;
                int64_t flat_tid_119061 = (int64_t) 0;
                
                defunc_res_119034 = 0.0;
                
                int64_t flat_tid_119037 = (int64_t) 0;
                struct futhark_mc_task_128023 futhark_mc_task_128023_;
                
                futhark_mc_task_128023_.ctx = ctx;
                futhark_mc_task_128023_.free_m_33388 = m_33388;
                futhark_mc_task_128023_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
                futhark_mc_task_128023_.free_distrs_mem_111708 = distrs_mem_111708.mem;
                futhark_mc_task_128023_.free_mem_param_118928 = mem_param_118928.mem;
                futhark_mc_task_128023_.free_zt_res_119033 = zt_res_119033;
                futhark_mc_task_128023_.free_flat_tid_119037 = flat_tid_119037;
                futhark_mc_task_128023_.free_flat_tid_119061 = flat_tid_119061;
                futhark_mc_task_128023_.retval_defunc_res_119034 = (double *) &defunc_res_119034;
                #if ISPC
                futhark_mc_task_128023_.retval_defunc_res_119034 += programIndex;
                #endif
                futhark_mc_task_128023_.retval_mem_111995 = mem_111995;
                futhark_mc_task_128023_.retval_mem_111997 = mem_111997;
                
                struct scheduler_segop futhark_mc_task_128023_task;
                
                futhark_mc_task_128023_task.args = &futhark_mc_task_128023_;
                futhark_mc_task_128023_task.top_level_fn = futhark_mc_segred_task_128024;
                futhark_mc_task_128023_task.name = "futhark_mc_segred_task_128024";
                futhark_mc_task_128023_task.iterations = m_33388;
                futhark_mc_task_128023_task.task_time = &ctx->program->futhark_mc_segred_task_128024_total_time;
                futhark_mc_task_128023_task.task_iter = &ctx->program->futhark_mc_segred_task_128024_total_iter;
                futhark_mc_task_128023_task.sched = STATIC;
                futhark_mc_task_128023_task.nested_fn = futhark_mc_segred_nested_task_128031;
                
                int futhark_mc_segred_task_128024_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128023_task);
                
                if (futhark_mc_segred_task_128024_err != 0) {
                    err = futhark_mc_segred_task_128024_err;
                    goto cleanup;
                }
                
                double zt_res_119082 = rho2_33390 * defunc_res_119034;
                double zt_res_119083 = rho1_33389 * defunc_res_118935;
                double zp_res_119084 = zt_res_119082 + zt_res_119083;
                double zt_res_119085 = eps_33391 * defunc_res_118936;
                double zp_res_119086 = zp_res_119084 + zt_res_119085;
                int64_t flat_tid_119100 = (int64_t) 0;
                int64_t flat_tid_119088 = (int64_t) 0;
                struct futhark_mc_task_128047 futhark_mc_task_128047_;
                
                futhark_mc_task_128047_.ctx = ctx;
                futhark_mc_task_128047_.free_m_33388 = m_33388;
                futhark_mc_task_128047_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
                futhark_mc_task_128047_.free_A_mem_111707 = A_mem_111707.mem;
                futhark_mc_task_128047_.free_mem_111995 = mem_111995;
                futhark_mc_task_128047_.free_mem_111999 = mem_111999;
                
                struct scheduler_segop futhark_mc_task_128047_task;
                
                futhark_mc_task_128047_task.args = &futhark_mc_task_128047_;
                futhark_mc_task_128047_task.top_level_fn = futhark_mc_segmap_task_128048;
                futhark_mc_task_128047_task.name = "futhark_mc_segmap_task_128048";
                futhark_mc_task_128047_task.iterations = m_33388;
                futhark_mc_task_128047_task.task_time = &ctx->program->futhark_mc_segmap_task_128048_total_time;
                futhark_mc_task_128047_task.task_iter = &ctx->program->futhark_mc_segmap_task_128048_total_iter;
                futhark_mc_task_128047_task.sched = STATIC;
                futhark_mc_task_128047_task.nested_fn = futhark_mc_segmap_nested_task_128054;
                
                int futhark_mc_segmap_task_128048_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128047_task);
                
                if (futhark_mc_segmap_task_128048_err != 0) {
                    err = futhark_mc_segmap_task_128048_err;
                    goto cleanup;
                }
                
                int64_t flat_tid_119211 = (int64_t) 0;
                int64_t flat_tid_119112 = (int64_t) 0;
                struct futhark_mc_task_128068 futhark_mc_task_128068_;
                
                futhark_mc_task_128068_.ctx = ctx;
                futhark_mc_task_128068_.free_m_33388 = m_33388;
                futhark_mc_task_128068_.free_neg_res_43882 = neg_res_43882;
                futhark_mc_task_128068_.free_eta_p_106382 = eta_p_106382;
                futhark_mc_task_128068_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
                futhark_mc_task_128068_.free_A_mem_111707 = A_mem_111707.mem;
                futhark_mc_task_128068_.free_distrs_mem_111708 = distrs_mem_111708.mem;
                futhark_mc_task_128068_.free_bytes_111715 = bytes_111715;
                futhark_mc_task_128068_.free_mem_111727 = mem_111727.mem;
                futhark_mc_task_128068_.free_mem_111993 = mem_111993;
                futhark_mc_task_128068_.free_mem_111997 = mem_111997;
                futhark_mc_task_128068_.free_mem_111999 = mem_111999;
                futhark_mc_task_128068_.free_mem_112032 = mem_112032;
                futhark_mc_task_128068_.free_mem_112034 = mem_112034;
                futhark_mc_task_128068_.free_mem_param_118926 = mem_param_118926.mem;
                futhark_mc_task_128068_.free_mem_param_118927 = mem_param_118927.mem;
                futhark_mc_task_128068_.free_mem_param_118928 = mem_param_118928.mem;
                futhark_mc_task_128068_.free_defunc_res_118937 = defunc_res_118937;
                futhark_mc_task_128068_.free_zt_res_119033 = zt_res_119033;
                futhark_mc_task_128068_.free_zp_res_119086 = zp_res_119086;
                
                struct scheduler_segop futhark_mc_task_128068_task;
                
                futhark_mc_task_128068_task.args = &futhark_mc_task_128068_;
                futhark_mc_task_128068_task.top_level_fn = futhark_mc_segmap_task_128069;
                futhark_mc_task_128068_task.name = "futhark_mc_segmap_task_128069";
                futhark_mc_task_128068_task.iterations = m_33388;
                futhark_mc_task_128068_task.task_time = &ctx->program->futhark_mc_segmap_task_128069_total_time;
                futhark_mc_task_128068_task.task_iter = &ctx->program->futhark_mc_segmap_task_128069_total_iter;
                futhark_mc_task_128068_task.sched = STATIC;
                futhark_mc_task_128068_task.nested_fn = futhark_mc_segmap_nested_task_128077;
                
                int futhark_mc_segmap_task_128069_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128068_task);
                
                if (futhark_mc_segmap_task_128069_err != 0) {
                    err = futhark_mc_segmap_task_128069_err;
                    goto cleanup;
                }
                
                bool defunc_0_reduce_res_119275;
                int64_t flat_tid_119312 = (int64_t) 0;
                
                defunc_0_reduce_res_119275 = 0;
                
                int64_t flat_tid_119279 = (int64_t) 0;
                struct futhark_mc_task_128143 futhark_mc_task_128143_;
                
                futhark_mc_task_128143_.ctx = ctx;
                futhark_mc_task_128143_.free_m_33388 = m_33388;
                futhark_mc_task_128143_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
                futhark_mc_task_128143_.free_zs_res_44883 = zs_res_44883;
                futhark_mc_task_128143_.free_zs_res_44885 = zs_res_44885;
                futhark_mc_task_128143_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
                futhark_mc_task_128143_.free_distrs_mem_111708 = distrs_mem_111708.mem;
                futhark_mc_task_128143_.free_bytes_111715 = bytes_111715;
                futhark_mc_task_128143_.free_mem_112032 = mem_112032;
                futhark_mc_task_128143_.free_mem_param_118927 = mem_param_118927.mem;
                futhark_mc_task_128143_.free_flat_tid_119279 = flat_tid_119279;
                futhark_mc_task_128143_.free_flat_tid_119312 = flat_tid_119312;
                futhark_mc_task_128143_.retval_defunc_0_reduce_res_119275 = (bool *) &defunc_0_reduce_res_119275;
                #if ISPC
                futhark_mc_task_128143_.retval_defunc_0_reduce_res_119275 += programIndex;
                #endif
                futhark_mc_task_128143_.retval_mem_112046 = mem_112046.mem;
                futhark_mc_task_128143_.retval_mem_112048 = mem_112048.mem;
                futhark_mc_task_128143_.retval_mem_112051 = mem_112051.mem;
                
                struct scheduler_segop futhark_mc_task_128143_task;
                
                futhark_mc_task_128143_task.args = &futhark_mc_task_128143_;
                futhark_mc_task_128143_task.top_level_fn = futhark_mc_segred_task_128144;
                futhark_mc_task_128143_task.name = "futhark_mc_segred_task_128144";
                futhark_mc_task_128143_task.iterations = m_33388;
                futhark_mc_task_128143_task.task_time = &ctx->program->futhark_mc_segred_task_128144_total_time;
                futhark_mc_task_128143_task.task_iter = &ctx->program->futhark_mc_segred_task_128144_total_iter;
                futhark_mc_task_128143_task.sched = STATIC;
                futhark_mc_task_128143_task.nested_fn = futhark_mc_segred_nested_task_128152;
                
                int futhark_mc_segred_task_128144_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128143_task);
                
                if (futhark_mc_segred_task_128144_err != 0) {
                    err = futhark_mc_segred_task_128144_err;
                    goto cleanup;
                }
                
                bool defunc_0_reduce_res_119345;
                int64_t flat_tid_119372 = (int64_t) 0;
                
                defunc_0_reduce_res_119345 = 0;
                
                int64_t flat_tid_119348 = (int64_t) 0;
                struct futhark_mc_task_128183 futhark_mc_task_128183_;
                
                futhark_mc_task_128183_.ctx = ctx;
                futhark_mc_task_128183_.free_m_33388 = m_33388;
                futhark_mc_task_128183_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
                futhark_mc_task_128183_.free_zs_res_44842 = zs_res_44842;
                futhark_mc_task_128183_.free_zs_res_44844 = zs_res_44844;
                futhark_mc_task_128183_.free_eta_p_106382 = eta_p_106382;
                futhark_mc_task_128183_.free_distrs_mem_111708 = distrs_mem_111708.mem;
                futhark_mc_task_128183_.free_mem_112034 = mem_112034;
                futhark_mc_task_128183_.free_mem_112046 = mem_112046.mem;
                futhark_mc_task_128183_.free_mem_112051 = mem_112051.mem;
                futhark_mc_task_128183_.free_mem_param_118926 = mem_param_118926.mem;
                futhark_mc_task_128183_.free_flat_tid_119348 = flat_tid_119348;
                futhark_mc_task_128183_.free_flat_tid_119372 = flat_tid_119372;
                futhark_mc_task_128183_.retval_defunc_0_reduce_res_119345 = (bool *) &defunc_0_reduce_res_119345;
                #if ISPC
                futhark_mc_task_128183_.retval_defunc_0_reduce_res_119345 += programIndex;
                #endif
                futhark_mc_task_128183_.retval_mem_112053 = mem_112053.mem;
                futhark_mc_task_128183_.retval_mem_112055 = mem_112055.mem;
                
                struct scheduler_segop futhark_mc_task_128183_task;
                
                futhark_mc_task_128183_task.args = &futhark_mc_task_128183_;
                futhark_mc_task_128183_task.top_level_fn = futhark_mc_segred_task_128184;
                futhark_mc_task_128183_task.name = "futhark_mc_segred_task_128184";
                futhark_mc_task_128183_task.iterations = m_33388;
                futhark_mc_task_128183_task.task_time = &ctx->program->futhark_mc_segred_task_128184_total_time;
                futhark_mc_task_128183_task.task_iter = &ctx->program->futhark_mc_segred_task_128184_total_iter;
                futhark_mc_task_128183_task.sched = STATIC;
                futhark_mc_task_128183_task.nested_fn = futhark_mc_segred_nested_task_128191;
                
                int futhark_mc_segred_task_128184_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128183_task);
                
                if (futhark_mc_segred_task_128184_err != 0) {
                    err = futhark_mc_segred_task_128184_err;
                    goto cleanup;
                }
                
                bool defunc_0_reduce_res_119394;
                int64_t flat_tid_119395 = (int64_t) 0;
                
                defunc_0_reduce_res_119394 = 0;
                
                struct futhark_mc_task_128206 futhark_mc_task_128206_;
                
                futhark_mc_task_128206_.ctx = ctx;
                futhark_mc_task_128206_.free_zs_res_107134 = zs_res_107134;
                futhark_mc_task_128206_.free_mem_112053 = mem_112053.mem;
                futhark_mc_task_128206_.free_flat_tid_119395 = flat_tid_119395;
                futhark_mc_task_128206_.retval_defunc_0_reduce_res_119394 = (bool *) &defunc_0_reduce_res_119394;
                #if ISPC
                futhark_mc_task_128206_.retval_defunc_0_reduce_res_119394 += programIndex;
                #endif
                
                struct scheduler_segop futhark_mc_task_128206_task;
                
                futhark_mc_task_128206_task.args = &futhark_mc_task_128206_;
                futhark_mc_task_128206_task.top_level_fn = futhark_mc_segred_task_128207;
                futhark_mc_task_128206_task.name = "futhark_mc_segred_task_128207";
                futhark_mc_task_128206_task.iterations = m_33388;
                futhark_mc_task_128206_task.task_time = &ctx->program->futhark_mc_segred_task_128207_total_time;
                futhark_mc_task_128206_task.task_iter = &ctx->program->futhark_mc_segred_task_128207_total_iter;
                futhark_mc_task_128206_task.sched = STATIC;
                futhark_mc_task_128206_task.nested_fn = NULL;
                
                int futhark_mc_segred_task_128207_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128206_task);
                
                if (futhark_mc_segred_task_128207_err != 0) {
                    err = futhark_mc_segred_task_128207_err;
                    goto cleanup;
                }
                
                bool x_119402 = !defunc_0_reduce_res_119345;
                bool y_119403 = defunc_0_reduce_res_119394 && x_119402;
                bool cond_119404 = defunc_0_reduce_res_119345 || y_119403;
                int64_t ext_119405;
                
                if (cond_119404) {
                    ext_119405 = m_33388;
                } else {
                    ext_119405 = (int64_t) 1;
                }
                
                int64_t ext_119406;
                
                if (cond_119404) {
                    ext_119406 = (int64_t) 1;
                } else {
                    ext_119406 = m_33388;
                }
                if (cond_119404) {
                    int64_t flat_tid_119416 = (int64_t) 0;
                    struct futhark_mc_task_128214 futhark_mc_task_128214_;
                    
                    futhark_mc_task_128214_.ctx = ctx;
                    futhark_mc_task_128214_.free_m_33388 = m_33388;
                    futhark_mc_task_128214_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
                    futhark_mc_task_128214_.free_zs_res_107134 = zs_res_107134;
                    futhark_mc_task_128214_.free_bytes_111715 = bytes_111715;
                    futhark_mc_task_128214_.free_mem_112051 = mem_112051.mem;
                    futhark_mc_task_128214_.free_mem_112053 = mem_112053.mem;
                    futhark_mc_task_128214_.free_mem_112055 = mem_112055.mem;
                    futhark_mc_task_128214_.free_mem_112068 = mem_112068.mem;
                    futhark_mc_task_128214_.free_mem_112070 = mem_112070.mem;
                    futhark_mc_task_128214_.free_mem_112073 = mem_112073.mem;
                    
                    struct scheduler_segop futhark_mc_task_128214_task;
                    
                    futhark_mc_task_128214_task.args = &futhark_mc_task_128214_;
                    futhark_mc_task_128214_task.top_level_fn = futhark_mc_segmap_task_128215;
                    futhark_mc_task_128214_task.name = "futhark_mc_segmap_task_128215";
                    futhark_mc_task_128214_task.iterations = m_33388;
                    futhark_mc_task_128214_task.task_time = &ctx->program->futhark_mc_segmap_task_128215_total_time;
                    futhark_mc_task_128214_task.task_iter = &ctx->program->futhark_mc_segmap_task_128215_total_iter;
                    futhark_mc_task_128214_task.sched = STATIC;
                    futhark_mc_task_128214_task.nested_fn = NULL;
                    
                    int futhark_mc_segmap_task_128215_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128214_task);
                    
                    if (futhark_mc_segmap_task_128215_err != 0) {
                        err = futhark_mc_segmap_task_128215_err;
                        goto cleanup;
                    }
                    if (memblock_set(ctx, &ext_mem_119407, &mem_112068, "mem_112068") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_119408, &mem_112070, "mem_112070") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_119409, &mem_112073, "mem_112073") != 0)
                        return 1;
                } else {
                    if (memblock_set(ctx, &ext_mem_119407, &mem_112053, "mem_112053") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_119408, &mem_112055, "mem_112055") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_119409, &mem_112051, "mem_112051") != 0)
                        return 1;
                }
                
                bool defunc_0_reduce_res_119444;
                int64_t flat_tid_119445 = (int64_t) 0;
                
                defunc_0_reduce_res_119444 = 0;
                
                struct futhark_mc_task_128221 futhark_mc_task_128221_;
                
                futhark_mc_task_128221_.ctx = ctx;
                futhark_mc_task_128221_.free_zs_res_107134 = zs_res_107134;
                futhark_mc_task_128221_.free_mem_112046 = mem_112046.mem;
                futhark_mc_task_128221_.free_flat_tid_119445 = flat_tid_119445;
                futhark_mc_task_128221_.retval_defunc_0_reduce_res_119444 = (bool *) &defunc_0_reduce_res_119444;
                #if ISPC
                futhark_mc_task_128221_.retval_defunc_0_reduce_res_119444 += programIndex;
                #endif
                
                struct scheduler_segop futhark_mc_task_128221_task;
                
                futhark_mc_task_128221_task.args = &futhark_mc_task_128221_;
                futhark_mc_task_128221_task.top_level_fn = futhark_mc_segred_task_128222;
                futhark_mc_task_128221_task.name = "futhark_mc_segred_task_128222";
                futhark_mc_task_128221_task.iterations = m_33388;
                futhark_mc_task_128221_task.task_time = &ctx->program->futhark_mc_segred_task_128222_total_time;
                futhark_mc_task_128221_task.task_iter = &ctx->program->futhark_mc_segred_task_128222_total_iter;
                futhark_mc_task_128221_task.sched = STATIC;
                futhark_mc_task_128221_task.nested_fn = NULL;
                
                int futhark_mc_segred_task_128222_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128221_task);
                
                if (futhark_mc_segred_task_128222_err != 0) {
                    err = futhark_mc_segred_task_128222_err;
                    goto cleanup;
                }
                
                bool x_119452 = !defunc_0_reduce_res_119275;
                bool y_119453 = defunc_0_reduce_res_119444 && x_119452;
                bool cond_119454 = defunc_0_reduce_res_119275 || y_119453;
                int64_t ext_119456;
                
                if (cond_119454) {
                    ext_119456 = (int64_t) 1;
                } else {
                    ext_119456 = ext_119405;
                }
                
                int64_t ext_119457;
                
                if (cond_119454) {
                    ext_119457 = m_33388;
                } else {
                    ext_119457 = ext_119406;
                }
                if (cond_119454) {
                    int64_t flat_tid_119467 = (int64_t) 0;
                    struct futhark_mc_task_128229 futhark_mc_task_128229_;
                    
                    futhark_mc_task_128229_.ctx = ctx;
                    futhark_mc_task_128229_.free_m_33388 = m_33388;
                    futhark_mc_task_128229_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
                    futhark_mc_task_128229_.free_zs_res_107134 = zs_res_107134;
                    futhark_mc_task_128229_.free_bytes_111715 = bytes_111715;
                    futhark_mc_task_128229_.free_mem_112046 = mem_112046.mem;
                    futhark_mc_task_128229_.free_mem_112048 = mem_112048.mem;
                    futhark_mc_task_128229_.free_mem_112092 = mem_112092.mem;
                    futhark_mc_task_128229_.free_mem_112094 = mem_112094.mem;
                    futhark_mc_task_128229_.free_mem_112097 = mem_112097.mem;
                    futhark_mc_task_128229_.free_ext_119405 = ext_119405;
                    futhark_mc_task_128229_.free_ext_119406 = ext_119406;
                    futhark_mc_task_128229_.free_ext_mem_119409 = ext_mem_119409.mem;
                    
                    struct scheduler_segop futhark_mc_task_128229_task;
                    
                    futhark_mc_task_128229_task.args = &futhark_mc_task_128229_;
                    futhark_mc_task_128229_task.top_level_fn = futhark_mc_segmap_task_128230;
                    futhark_mc_task_128229_task.name = "futhark_mc_segmap_task_128230";
                    futhark_mc_task_128229_task.iterations = m_33388;
                    futhark_mc_task_128229_task.task_time = &ctx->program->futhark_mc_segmap_task_128230_total_time;
                    futhark_mc_task_128229_task.task_iter = &ctx->program->futhark_mc_segmap_task_128230_total_iter;
                    futhark_mc_task_128229_task.sched = STATIC;
                    futhark_mc_task_128229_task.nested_fn = NULL;
                    
                    int futhark_mc_segmap_task_128230_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128229_task);
                    
                    if (futhark_mc_segmap_task_128230_err != 0) {
                        err = futhark_mc_segmap_task_128230_err;
                        goto cleanup;
                    }
                    if (memblock_set(ctx, &ext_mem_119458, &mem_112092, "mem_112092") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_119459, &mem_112094, "mem_112094") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_119460, &mem_112097, "mem_112097") != 0)
                        return 1;
                } else {
                    if (memblock_set(ctx, &ext_mem_119458, &mem_112046, "mem_112046") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_119459, &mem_112048, "mem_112048") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_119460, &ext_mem_119409, "ext_mem_119409") != 0)
                        return 1;
                }
                if (memblock_unref(ctx, &ext_mem_119409, "ext_mem_119409") != 0)
                    return 1;
                
                bool defunc_0_reduce_res_119497;
                int64_t flat_tid_119498 = (int64_t) 0;
                
                defunc_0_reduce_res_119497 = 0;
                
                struct futhark_mc_task_128236 futhark_mc_task_128236_;
                
                futhark_mc_task_128236_.ctx = ctx;
                futhark_mc_task_128236_.free_ext_mem_119407 = ext_mem_119407.mem;
                futhark_mc_task_128236_.free_flat_tid_119498 = flat_tid_119498;
                futhark_mc_task_128236_.retval_defunc_0_reduce_res_119497 = (bool *) &defunc_0_reduce_res_119497;
                #if ISPC
                futhark_mc_task_128236_.retval_defunc_0_reduce_res_119497 += programIndex;
                #endif
                
                struct scheduler_segop futhark_mc_task_128236_task;
                
                futhark_mc_task_128236_task.args = &futhark_mc_task_128236_;
                futhark_mc_task_128236_task.top_level_fn = futhark_mc_segred_task_128237;
                futhark_mc_task_128236_task.name = "futhark_mc_segred_task_128237";
                futhark_mc_task_128236_task.iterations = m_33388;
                futhark_mc_task_128236_task.task_time = &ctx->program->futhark_mc_segred_task_128237_total_time;
                futhark_mc_task_128236_task.task_iter = &ctx->program->futhark_mc_segred_task_128237_total_iter;
                futhark_mc_task_128236_task.sched = STATIC;
                futhark_mc_task_128236_task.nested_fn = NULL;
                
                int futhark_mc_segred_task_128237_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128236_task);
                
                if (futhark_mc_segred_task_128237_err != 0) {
                    err = futhark_mc_segred_task_128237_err;
                    goto cleanup;
                }
                
                bool defunc_0_reduce_comm_res_119506;
                int64_t flat_tid_119507 = (int64_t) 0;
                
                defunc_0_reduce_comm_res_119506 = 0;
                
                struct futhark_mc_task_128244 futhark_mc_task_128244_;
                
                futhark_mc_task_128244_.ctx = ctx;
                futhark_mc_task_128244_.free_zp_res_108112 = zp_res_108112;
                futhark_mc_task_128244_.free_ext_mem_119407 = ext_mem_119407.mem;
                futhark_mc_task_128244_.free_flat_tid_119507 = flat_tid_119507;
                futhark_mc_task_128244_.retval_defunc_0_reduce_comm_res_119506 = (bool *) &defunc_0_reduce_comm_res_119506;
                #if ISPC
                futhark_mc_task_128244_.retval_defunc_0_reduce_comm_res_119506 += programIndex;
                #endif
                
                struct scheduler_segop futhark_mc_task_128244_task;
                
                futhark_mc_task_128244_task.args = &futhark_mc_task_128244_;
                futhark_mc_task_128244_task.top_level_fn = futhark_mc_segred_task_128245;
                futhark_mc_task_128244_task.name = "futhark_mc_segred_task_128245";
                futhark_mc_task_128244_task.iterations = m_33388;
                futhark_mc_task_128244_task.task_time = &ctx->program->futhark_mc_segred_task_128245_total_time;
                futhark_mc_task_128244_task.task_iter = &ctx->program->futhark_mc_segred_task_128245_total_iter;
                futhark_mc_task_128244_task.sched = STATIC;
                futhark_mc_task_128244_task.nested_fn = NULL;
                
                int futhark_mc_segred_task_128245_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128244_task);
                
                if (futhark_mc_segred_task_128245_err != 0) {
                    err = futhark_mc_segred_task_128245_err;
                    goto cleanup;
                }
                
                bool x_119518 = defunc_0_reduce_res_119497 && defunc_0_reduce_comm_res_119506;
                int64_t ext_119528;
                int64_t ext_119529;
                int64_t ext_119530;
                int64_t ext_119531;
                int64_t ext_119532;
                int64_t ext_119533;
                bool algo5_core_loop_res_119534;
                int64_t ctx_param_ext_119553;
                int64_t ctx_param_ext_119554;
                int64_t ctx_param_ext_119555;
                int64_t ctx_param_ext_119556;
                int64_t ctx_param_ext_119557;
                int64_t ctx_param_ext_119558;
                bool loop_while_119559;
                
                if (memblock_set(ctx, &mem_param_119544, &mem_112051, "mem_112051") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_119545, &mem_111716, "mem_111716") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_119546, &mem_112055, "mem_112055") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_119547, &mem_112048, "mem_112048") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_119548, &ext_mem_119460, "ext_mem_119460") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_119549, &ext_mem_119407, "ext_mem_119407") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_119550, &ext_mem_119458, "ext_mem_119458") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_119551, &ext_mem_119408, "ext_mem_119408") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_119552, &ext_mem_119459, "ext_mem_119459") != 0)
                    return 1;
                ctx_param_ext_119553 = (int64_t) 0;
                ctx_param_ext_119554 = (int64_t) 1;
                ctx_param_ext_119555 = m_33388;
                ctx_param_ext_119556 = (int64_t) 0;
                ctx_param_ext_119557 = ext_119456;
                ctx_param_ext_119558 = ext_119457;
                loop_while_119559 = x_119518;
                while (loop_while_119559) {
                    if (memblock_alloc(ctx, &mem_119569, bytes_111715, "mem_119569")) {
                        err = 1;
                        goto cleanup;
                    }
                    
                    bool defunc_0_reduce_res_119570;
                    int64_t flat_tid_119594 = (int64_t) 0;
                    
                    defunc_0_reduce_res_119570 = 0;
                    
                    int64_t flat_tid_119572 = (int64_t) 0;
                    struct futhark_mc_task_128252 futhark_mc_task_128252_;
                    
                    futhark_mc_task_128252_.ctx = ctx;
                    futhark_mc_task_128252_.free_m_33388 = m_33388;
                    futhark_mc_task_128252_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
                    futhark_mc_task_128252_.free_zs_res_44883 = zs_res_44883;
                    futhark_mc_task_128252_.free_zs_res_44885 = zs_res_44885;
                    futhark_mc_task_128252_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
                    futhark_mc_task_128252_.free_distrs_mem_111708 = distrs_mem_111708.mem;
                    futhark_mc_task_128252_.free_mem_param_119548 = mem_param_119548.mem;
                    futhark_mc_task_128252_.free_mem_param_119549 = mem_param_119549.mem;
                    futhark_mc_task_128252_.free_mem_param_119552 = mem_param_119552.mem;
                    futhark_mc_task_128252_.free_ctx_param_ext_119556 = ctx_param_ext_119556;
                    futhark_mc_task_128252_.free_ctx_param_ext_119557 = ctx_param_ext_119557;
                    futhark_mc_task_128252_.free_ctx_param_ext_119558 = ctx_param_ext_119558;
                    futhark_mc_task_128252_.free_flat_tid_119572 = flat_tid_119572;
                    futhark_mc_task_128252_.free_flat_tid_119594 = flat_tid_119594;
                    futhark_mc_task_128252_.retval_defunc_0_reduce_res_119570 = (bool *) &defunc_0_reduce_res_119570;
                    #if ISPC
                    futhark_mc_task_128252_.retval_defunc_0_reduce_res_119570 += programIndex;
                    #endif
                    futhark_mc_task_128252_.retval_mem_119569 = mem_119569.mem;
                    
                    struct scheduler_segop futhark_mc_task_128252_task;
                    
                    futhark_mc_task_128252_task.args = &futhark_mc_task_128252_;
                    futhark_mc_task_128252_task.top_level_fn = futhark_mc_segred_task_128253;
                    futhark_mc_task_128252_task.name = "futhark_mc_segred_task_128253";
                    futhark_mc_task_128252_task.iterations = m_33388;
                    futhark_mc_task_128252_task.task_time = &ctx->program->futhark_mc_segred_task_128253_total_time;
                    futhark_mc_task_128252_task.task_iter = &ctx->program->futhark_mc_segred_task_128253_total_iter;
                    futhark_mc_task_128252_task.sched = STATIC;
                    futhark_mc_task_128252_task.nested_fn = futhark_mc_segred_nested_task_128260;
                    
                    int futhark_mc_segred_task_128253_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128252_task);
                    
                    if (futhark_mc_segred_task_128253_err != 0) {
                        err = futhark_mc_segred_task_128253_err;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_119614, bytes_111715, "mem_119614")) {
                        err = 1;
                        goto cleanup;
                    }
                    
                    bool defunc_0_reduce_res_119615;
                    int64_t flat_tid_119639 = (int64_t) 0;
                    
                    defunc_0_reduce_res_119615 = 0;
                    
                    int64_t flat_tid_119617 = (int64_t) 0;
                    struct futhark_mc_task_128275 futhark_mc_task_128275_;
                    
                    futhark_mc_task_128275_.ctx = ctx;
                    futhark_mc_task_128275_.free_m_33388 = m_33388;
                    futhark_mc_task_128275_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
                    futhark_mc_task_128275_.free_zs_res_44842 = zs_res_44842;
                    futhark_mc_task_128275_.free_zs_res_44844 = zs_res_44844;
                    futhark_mc_task_128275_.free_eta_p_106382 = eta_p_106382;
                    futhark_mc_task_128275_.free_distrs_mem_111708 = distrs_mem_111708.mem;
                    futhark_mc_task_128275_.free_mem_param_119548 = mem_param_119548.mem;
                    futhark_mc_task_128275_.free_mem_param_119551 = mem_param_119551.mem;
                    futhark_mc_task_128275_.free_ctx_param_ext_119556 = ctx_param_ext_119556;
                    futhark_mc_task_128275_.free_ctx_param_ext_119557 = ctx_param_ext_119557;
                    futhark_mc_task_128275_.free_ctx_param_ext_119558 = ctx_param_ext_119558;
                    futhark_mc_task_128275_.free_mem_119569 = mem_119569.mem;
                    futhark_mc_task_128275_.free_flat_tid_119617 = flat_tid_119617;
                    futhark_mc_task_128275_.free_flat_tid_119639 = flat_tid_119639;
                    futhark_mc_task_128275_.retval_defunc_0_reduce_res_119615 = (bool *) &defunc_0_reduce_res_119615;
                    #if ISPC
                    futhark_mc_task_128275_.retval_defunc_0_reduce_res_119615 += programIndex;
                    #endif
                    futhark_mc_task_128275_.retval_mem_119614 = mem_119614.mem;
                    
                    struct scheduler_segop futhark_mc_task_128275_task;
                    
                    futhark_mc_task_128275_task.args = &futhark_mc_task_128275_;
                    futhark_mc_task_128275_task.top_level_fn = futhark_mc_segred_task_128276;
                    futhark_mc_task_128275_task.name = "futhark_mc_segred_task_128276";
                    futhark_mc_task_128275_task.iterations = m_33388;
                    futhark_mc_task_128275_task.task_time = &ctx->program->futhark_mc_segred_task_128276_total_time;
                    futhark_mc_task_128275_task.task_iter = &ctx->program->futhark_mc_segred_task_128276_total_iter;
                    futhark_mc_task_128275_task.sched = STATIC;
                    futhark_mc_task_128275_task.nested_fn = futhark_mc_segred_nested_task_128283;
                    
                    int futhark_mc_segred_task_128276_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128275_task);
                    
                    if (futhark_mc_segred_task_128276_err != 0) {
                        err = futhark_mc_segred_task_128276_err;
                        goto cleanup;
                    }
                    
                    bool defunc_0_reduce_res_119659;
                    int64_t flat_tid_119660 = (int64_t) 0;
                    
                    defunc_0_reduce_res_119659 = 0;
                    
                    struct futhark_mc_task_128298 futhark_mc_task_128298_;
                    
                    futhark_mc_task_128298_.ctx = ctx;
                    futhark_mc_task_128298_.free_zs_res_107134 = zs_res_107134;
                    futhark_mc_task_128298_.free_mem_119614 = mem_119614.mem;
                    futhark_mc_task_128298_.free_flat_tid_119660 = flat_tid_119660;
                    futhark_mc_task_128298_.retval_defunc_0_reduce_res_119659 = (bool *) &defunc_0_reduce_res_119659;
                    #if ISPC
                    futhark_mc_task_128298_.retval_defunc_0_reduce_res_119659 += programIndex;
                    #endif
                    
                    struct scheduler_segop futhark_mc_task_128298_task;
                    
                    futhark_mc_task_128298_task.args = &futhark_mc_task_128298_;
                    futhark_mc_task_128298_task.top_level_fn = futhark_mc_segred_task_128299;
                    futhark_mc_task_128298_task.name = "futhark_mc_segred_task_128299";
                    futhark_mc_task_128298_task.iterations = m_33388;
                    futhark_mc_task_128298_task.task_time = &ctx->program->futhark_mc_segred_task_128299_total_time;
                    futhark_mc_task_128298_task.task_iter = &ctx->program->futhark_mc_segred_task_128299_total_iter;
                    futhark_mc_task_128298_task.sched = STATIC;
                    futhark_mc_task_128298_task.nested_fn = NULL;
                    
                    int futhark_mc_segred_task_128299_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128298_task);
                    
                    if (futhark_mc_segred_task_128299_err != 0) {
                        err = futhark_mc_segred_task_128299_err;
                        goto cleanup;
                    }
                    
                    bool x_119667 = !defunc_0_reduce_res_119615;
                    bool y_119668 = defunc_0_reduce_res_119659 && x_119667;
                    bool cond_119669 = defunc_0_reduce_res_119615 || y_119668;
                    int64_t ext_119670;
                    
                    if (cond_119669) {
                        ext_119670 = (int64_t) 0;
                    } else {
                        ext_119670 = ctx_param_ext_119556;
                    }
                    
                    int64_t ext_119671;
                    
                    if (cond_119669) {
                        ext_119671 = m_33388;
                    } else {
                        ext_119671 = ctx_param_ext_119557;
                    }
                    
                    int64_t ext_119672;
                    
                    if (cond_119669) {
                        ext_119672 = (int64_t) 1;
                    } else {
                        ext_119672 = ctx_param_ext_119558;
                    }
                    if (memblock_alloc(ctx, &mem_119673, bytes_111715, "mem_119673")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_119674, bytes_111715, "mem_119674")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_119675, bytes_111743, "mem_119675")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (cond_119669) {
                        double zs_res_119682 = 1.0 / exp_absorb_cutoff_33394;
                        int64_t bytes_119683 = (int64_t) 8 * m_33388;
                        int64_t flat_tid_119687 = (int64_t) 0;
                        struct futhark_mc_task_128306 futhark_mc_task_128306_;
                        
                        futhark_mc_task_128306_.ctx = ctx;
                        futhark_mc_task_128306_.free_m_33388 = m_33388;
                        futhark_mc_task_128306_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
                        futhark_mc_task_128306_.free_mem_param_119548 = mem_param_119548.mem;
                        futhark_mc_task_128306_.free_mem_param_119551 = mem_param_119551.mem;
                        futhark_mc_task_128306_.free_ctx_param_ext_119556 = ctx_param_ext_119556;
                        futhark_mc_task_128306_.free_ctx_param_ext_119557 = ctx_param_ext_119557;
                        futhark_mc_task_128306_.free_ctx_param_ext_119558 = ctx_param_ext_119558;
                        futhark_mc_task_128306_.free_mem_119614 = mem_119614.mem;
                        futhark_mc_task_128306_.free_mem_119673 = mem_119673.mem;
                        futhark_mc_task_128306_.free_mem_119674 = mem_119674.mem;
                        futhark_mc_task_128306_.free_mem_119675 = mem_119675.mem;
                        futhark_mc_task_128306_.free_zs_res_119682 = zs_res_119682;
                        futhark_mc_task_128306_.free_bytes_119683 = bytes_119683;
                        
                        struct scheduler_segop futhark_mc_task_128306_task;
                        
                        futhark_mc_task_128306_task.args = &futhark_mc_task_128306_;
                        futhark_mc_task_128306_task.top_level_fn = futhark_mc_segmap_task_128307;
                        futhark_mc_task_128306_task.name = "futhark_mc_segmap_task_128307";
                        futhark_mc_task_128306_task.iterations = m_33388;
                        futhark_mc_task_128306_task.task_time = &ctx->program->futhark_mc_segmap_task_128307_total_time;
                        futhark_mc_task_128306_task.task_iter = &ctx->program->futhark_mc_segmap_task_128307_total_iter;
                        futhark_mc_task_128306_task.sched = STATIC;
                        futhark_mc_task_128306_task.nested_fn = NULL;
                        
                        int futhark_mc_segmap_task_128307_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128306_task);
                        
                        if (futhark_mc_segmap_task_128307_err != 0) {
                            err = futhark_mc_segmap_task_128307_err;
                            goto cleanup;
                        }
                        if (memblock_set(ctx, &ext_mem_119676, &mem_119673, "mem_119673") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_119677, &mem_119674, "mem_119674") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_119678, &mem_119675, "mem_119675") != 0)
                            return 1;
                    } else {
                        if (memblock_set(ctx, &ext_mem_119676, &mem_119614, "mem_119614") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_119677, &mem_param_119551, "mem_param_119551") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_119678, &mem_param_119548, "mem_param_119548") != 0)
                            return 1;
                    }
                    if (memblock_unref(ctx, &mem_119614, "mem_119614") != 0)
                        return 1;
                    if (memblock_unref(ctx, &mem_119673, "mem_119673") != 0)
                        return 1;
                    if (memblock_unref(ctx, &mem_119674, "mem_119674") != 0)
                        return 1;
                    if (memblock_unref(ctx, &mem_119675, "mem_119675") != 0)
                        return 1;
                    
                    bool defunc_0_reduce_res_119717;
                    int64_t flat_tid_119718 = (int64_t) 0;
                    
                    defunc_0_reduce_res_119717 = 0;
                    
                    struct futhark_mc_task_128313 futhark_mc_task_128313_;
                    
                    futhark_mc_task_128313_.ctx = ctx;
                    futhark_mc_task_128313_.free_zs_res_107134 = zs_res_107134;
                    futhark_mc_task_128313_.free_mem_119569 = mem_119569.mem;
                    futhark_mc_task_128313_.free_flat_tid_119718 = flat_tid_119718;
                    futhark_mc_task_128313_.retval_defunc_0_reduce_res_119717 = (bool *) &defunc_0_reduce_res_119717;
                    #if ISPC
                    futhark_mc_task_128313_.retval_defunc_0_reduce_res_119717 += programIndex;
                    #endif
                    
                    struct scheduler_segop futhark_mc_task_128313_task;
                    
                    futhark_mc_task_128313_task.args = &futhark_mc_task_128313_;
                    futhark_mc_task_128313_task.top_level_fn = futhark_mc_segred_task_128314;
                    futhark_mc_task_128313_task.name = "futhark_mc_segred_task_128314";
                    futhark_mc_task_128313_task.iterations = m_33388;
                    futhark_mc_task_128313_task.task_time = &ctx->program->futhark_mc_segred_task_128314_total_time;
                    futhark_mc_task_128313_task.task_iter = &ctx->program->futhark_mc_segred_task_128314_total_iter;
                    futhark_mc_task_128313_task.sched = STATIC;
                    futhark_mc_task_128313_task.nested_fn = NULL;
                    
                    int futhark_mc_segred_task_128314_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128313_task);
                    
                    if (futhark_mc_segred_task_128314_err != 0) {
                        err = futhark_mc_segred_task_128314_err;
                        goto cleanup;
                    }
                    
                    bool x_119725 = !defunc_0_reduce_res_119570;
                    bool y_119726 = defunc_0_reduce_res_119717 && x_119725;
                    bool cond_119727 = defunc_0_reduce_res_119570 || y_119726;
                    int64_t ext_119729;
                    
                    if (cond_119727) {
                        ext_119729 = (int64_t) 0;
                    } else {
                        ext_119729 = ext_119670;
                    }
                    
                    int64_t ext_119730;
                    
                    if (cond_119727) {
                        ext_119730 = (int64_t) 1;
                    } else {
                        ext_119730 = ext_119671;
                    }
                    
                    int64_t ext_119731;
                    
                    if (cond_119727) {
                        ext_119731 = m_33388;
                    } else {
                        ext_119731 = ext_119672;
                    }
                    if (memblock_alloc(ctx, &mem_119732, bytes_111715, "mem_119732")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_119733, bytes_111715, "mem_119733")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_119734, bytes_111743, "mem_119734")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (cond_119727) {
                        double zs_res_119741 = 1.0 / exp_absorb_cutoff_33394;
                        int64_t bytes_119742 = (int64_t) 8 * m_33388;
                        int64_t flat_tid_119746 = (int64_t) 0;
                        struct futhark_mc_task_128321 futhark_mc_task_128321_;
                        
                        futhark_mc_task_128321_.ctx = ctx;
                        futhark_mc_task_128321_.free_m_33388 = m_33388;
                        futhark_mc_task_128321_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
                        futhark_mc_task_128321_.free_mem_param_119552 = mem_param_119552.mem;
                        futhark_mc_task_128321_.free_mem_119569 = mem_119569.mem;
                        futhark_mc_task_128321_.free_ext_119670 = ext_119670;
                        futhark_mc_task_128321_.free_ext_119671 = ext_119671;
                        futhark_mc_task_128321_.free_ext_119672 = ext_119672;
                        futhark_mc_task_128321_.free_ext_mem_119678 = ext_mem_119678.mem;
                        futhark_mc_task_128321_.free_mem_119732 = mem_119732.mem;
                        futhark_mc_task_128321_.free_mem_119733 = mem_119733.mem;
                        futhark_mc_task_128321_.free_mem_119734 = mem_119734.mem;
                        futhark_mc_task_128321_.free_zs_res_119741 = zs_res_119741;
                        futhark_mc_task_128321_.free_bytes_119742 = bytes_119742;
                        
                        struct scheduler_segop futhark_mc_task_128321_task;
                        
                        futhark_mc_task_128321_task.args = &futhark_mc_task_128321_;
                        futhark_mc_task_128321_task.top_level_fn = futhark_mc_segmap_task_128322;
                        futhark_mc_task_128321_task.name = "futhark_mc_segmap_task_128322";
                        futhark_mc_task_128321_task.iterations = m_33388;
                        futhark_mc_task_128321_task.task_time = &ctx->program->futhark_mc_segmap_task_128322_total_time;
                        futhark_mc_task_128321_task.task_iter = &ctx->program->futhark_mc_segmap_task_128322_total_iter;
                        futhark_mc_task_128321_task.sched = STATIC;
                        futhark_mc_task_128321_task.nested_fn = NULL;
                        
                        int futhark_mc_segmap_task_128322_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128321_task);
                        
                        if (futhark_mc_segmap_task_128322_err != 0) {
                            err = futhark_mc_segmap_task_128322_err;
                            goto cleanup;
                        }
                        if (memblock_set(ctx, &ext_mem_119735, &mem_119732, "mem_119732") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_119736, &mem_119733, "mem_119733") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_119737, &mem_119734, "mem_119734") != 0)
                            return 1;
                    } else {
                        if (memblock_set(ctx, &ext_mem_119735, &mem_119569, "mem_119569") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_119736, &mem_param_119552, "mem_param_119552") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_119737, &ext_mem_119678, "ext_mem_119678") != 0)
                            return 1;
                    }
                    if (memblock_unref(ctx, &mem_119569, "mem_119569") != 0)
                        return 1;
                    if (memblock_unref(ctx, &ext_mem_119678, "ext_mem_119678") != 0)
                        return 1;
                    if (memblock_unref(ctx, &mem_119732, "mem_119732") != 0)
                        return 1;
                    if (memblock_unref(ctx, &mem_119733, "mem_119733") != 0)
                        return 1;
                    if (memblock_unref(ctx, &mem_119734, "mem_119734") != 0)
                        return 1;
                    
                    bool defunc_0_reduce_res_119777;
                    int64_t flat_tid_119778 = (int64_t) 0;
                    
                    defunc_0_reduce_res_119777 = 0;
                    
                    struct futhark_mc_task_128328 futhark_mc_task_128328_;
                    
                    futhark_mc_task_128328_.ctx = ctx;
                    futhark_mc_task_128328_.free_ext_mem_119676 = ext_mem_119676.mem;
                    futhark_mc_task_128328_.free_flat_tid_119778 = flat_tid_119778;
                    futhark_mc_task_128328_.retval_defunc_0_reduce_res_119777 = (bool *) &defunc_0_reduce_res_119777;
                    #if ISPC
                    futhark_mc_task_128328_.retval_defunc_0_reduce_res_119777 += programIndex;
                    #endif
                    
                    struct scheduler_segop futhark_mc_task_128328_task;
                    
                    futhark_mc_task_128328_task.args = &futhark_mc_task_128328_;
                    futhark_mc_task_128328_task.top_level_fn = futhark_mc_segred_task_128329;
                    futhark_mc_task_128328_task.name = "futhark_mc_segred_task_128329";
                    futhark_mc_task_128328_task.iterations = m_33388;
                    futhark_mc_task_128328_task.task_time = &ctx->program->futhark_mc_segred_task_128329_total_time;
                    futhark_mc_task_128328_task.task_iter = &ctx->program->futhark_mc_segred_task_128329_total_iter;
                    futhark_mc_task_128328_task.sched = STATIC;
                    futhark_mc_task_128328_task.nested_fn = NULL;
                    
                    int futhark_mc_segred_task_128329_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128328_task);
                    
                    if (futhark_mc_segred_task_128329_err != 0) {
                        err = futhark_mc_segred_task_128329_err;
                        goto cleanup;
                    }
                    
                    bool defunc_0_reduce_comm_res_119786;
                    int64_t flat_tid_119787 = (int64_t) 0;
                    
                    defunc_0_reduce_comm_res_119786 = 0;
                    
                    struct futhark_mc_task_128336 futhark_mc_task_128336_;
                    
                    futhark_mc_task_128336_.ctx = ctx;
                    futhark_mc_task_128336_.free_zp_res_108112 = zp_res_108112;
                    futhark_mc_task_128336_.free_mem_param_119549 = mem_param_119549.mem;
                    futhark_mc_task_128336_.free_ext_mem_119676 = ext_mem_119676.mem;
                    futhark_mc_task_128336_.free_flat_tid_119787 = flat_tid_119787;
                    futhark_mc_task_128336_.retval_defunc_0_reduce_comm_res_119786 = (bool *) &defunc_0_reduce_comm_res_119786;
                    #if ISPC
                    futhark_mc_task_128336_.retval_defunc_0_reduce_comm_res_119786 += programIndex;
                    #endif
                    
                    struct scheduler_segop futhark_mc_task_128336_task;
                    
                    futhark_mc_task_128336_task.args = &futhark_mc_task_128336_;
                    futhark_mc_task_128336_task.top_level_fn = futhark_mc_segred_task_128337;
                    futhark_mc_task_128336_task.name = "futhark_mc_segred_task_128337";
                    futhark_mc_task_128336_task.iterations = m_33388;
                    futhark_mc_task_128336_task.task_time = &ctx->program->futhark_mc_segred_task_128337_total_time;
                    futhark_mc_task_128336_task.task_iter = &ctx->program->futhark_mc_segred_task_128337_total_iter;
                    futhark_mc_task_128336_task.sched = STATIC;
                    futhark_mc_task_128336_task.nested_fn = NULL;
                    
                    int futhark_mc_segred_task_128337_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128336_task);
                    
                    if (futhark_mc_segred_task_128337_err != 0) {
                        err = futhark_mc_segred_task_128337_err;
                        goto cleanup;
                    }
                    
                    bool x_119800 = defunc_0_reduce_res_119777 && defunc_0_reduce_comm_res_119786;
                    
                    if (memblock_set(ctx, &mem_param_tmp_124247, &mem_param_119548, "mem_param_119548") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_124248, &mem_param_119549, "mem_param_119549") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_124249, &mem_param_119551, "mem_param_119551") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_124250, &mem_param_119552, "mem_param_119552") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_124251, &ext_mem_119737, "ext_mem_119737") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_124252, &ext_mem_119676, "ext_mem_119676") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_124253, &ext_mem_119735, "ext_mem_119735") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_124254, &ext_mem_119677, "ext_mem_119677") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_124255, &ext_mem_119736, "ext_mem_119736") != 0)
                        return 1;
                    
                    int64_t ctx_param_ext_tmp_124256 = ctx_param_ext_119556;
                    int64_t ctx_param_ext_tmp_124257 = ctx_param_ext_119557;
                    int64_t ctx_param_ext_tmp_124258 = ctx_param_ext_119558;
                    int64_t ctx_param_ext_tmp_124259 = ext_119729;
                    int64_t ctx_param_ext_tmp_124260 = ext_119730;
                    int64_t ctx_param_ext_tmp_124261 = ext_119731;
                    bool loop_while_tmp_124262 = x_119800;
                    
                    if (memblock_set(ctx, &mem_param_119544, &mem_param_tmp_124247, "mem_param_tmp_124247") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_119545, &mem_param_tmp_124248, "mem_param_tmp_124248") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_119546, &mem_param_tmp_124249, "mem_param_tmp_124249") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_119547, &mem_param_tmp_124250, "mem_param_tmp_124250") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_119548, &mem_param_tmp_124251, "mem_param_tmp_124251") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_119549, &mem_param_tmp_124252, "mem_param_tmp_124252") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_119550, &mem_param_tmp_124253, "mem_param_tmp_124253") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_119551, &mem_param_tmp_124254, "mem_param_tmp_124254") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_119552, &mem_param_tmp_124255, "mem_param_tmp_124255") != 0)
                        return 1;
                    ctx_param_ext_119553 = ctx_param_ext_tmp_124256;
                    ctx_param_ext_119554 = ctx_param_ext_tmp_124257;
                    ctx_param_ext_119555 = ctx_param_ext_tmp_124258;
                    ctx_param_ext_119556 = ctx_param_ext_tmp_124259;
                    ctx_param_ext_119557 = ctx_param_ext_tmp_124260;
                    ctx_param_ext_119558 = ctx_param_ext_tmp_124261;
                    loop_while_119559 = loop_while_tmp_124262;
                }
                if (memblock_set(ctx, &ext_mem_119519, &mem_param_119544, "mem_param_119544") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_119520, &mem_param_119545, "mem_param_119545") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_119521, &mem_param_119546, "mem_param_119546") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_119522, &mem_param_119547, "mem_param_119547") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_119523, &mem_param_119548, "mem_param_119548") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_119524, &mem_param_119549, "mem_param_119549") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_119525, &mem_param_119550, "mem_param_119550") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_119526, &mem_param_119551, "mem_param_119551") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_119527, &mem_param_119552, "mem_param_119552") != 0)
                    return 1;
                ext_119528 = ctx_param_ext_119553;
                ext_119529 = ctx_param_ext_119554;
                ext_119530 = ctx_param_ext_119555;
                ext_119531 = ctx_param_ext_119556;
                ext_119532 = ctx_param_ext_119557;
                ext_119533 = ctx_param_ext_119558;
                algo5_core_loop_res_119534 = loop_while_119559;
                if (memblock_unref(ctx, &ext_mem_119407, "ext_mem_119407") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_119408, "ext_mem_119408") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_119458, "ext_mem_119458") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_119459, "ext_mem_119459") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_119460, "ext_mem_119460") != 0)
                    return 1;
                
                bool defunc_0_reduce_res_119801;
                int64_t flat_tid_119802 = (int64_t) 0;
                
                defunc_0_reduce_res_119801 = 0;
                
                struct futhark_mc_task_128344 futhark_mc_task_128344_;
                
                futhark_mc_task_128344_.ctx = ctx;
                futhark_mc_task_128344_.free_ext_mem_119524 = ext_mem_119524.mem;
                futhark_mc_task_128344_.free_flat_tid_119802 = flat_tid_119802;
                futhark_mc_task_128344_.retval_defunc_0_reduce_res_119801 = (bool *) &defunc_0_reduce_res_119801;
                #if ISPC
                futhark_mc_task_128344_.retval_defunc_0_reduce_res_119801 += programIndex;
                #endif
                
                struct scheduler_segop futhark_mc_task_128344_task;
                
                futhark_mc_task_128344_task.args = &futhark_mc_task_128344_;
                futhark_mc_task_128344_task.top_level_fn = futhark_mc_segred_task_128345;
                futhark_mc_task_128344_task.name = "futhark_mc_segred_task_128345";
                futhark_mc_task_128344_task.iterations = m_33388;
                futhark_mc_task_128344_task.task_time = &ctx->program->futhark_mc_segred_task_128345_total_time;
                futhark_mc_task_128344_task.task_iter = &ctx->program->futhark_mc_segred_task_128345_total_iter;
                futhark_mc_task_128344_task.sched = STATIC;
                futhark_mc_task_128344_task.nested_fn = NULL;
                
                int futhark_mc_segred_task_128345_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128344_task);
                
                if (futhark_mc_segred_task_128345_err != 0) {
                    err = futhark_mc_segred_task_128345_err;
                    goto cleanup;
                }
                
                int64_t ext_119811;
                int64_t ext_119812;
                int64_t ext_119813;
                
                if (defunc_0_reduce_res_119801) {
                    if (memblock_set(ctx, &ext_mem_119810, &ext_mem_119523, "ext_mem_119523") != 0)
                        return 1;
                    ext_119811 = ext_119531;
                    ext_119812 = ext_119532;
                    ext_119813 = ext_119533;
                    if (memblock_set(ctx, &ext_mem_119814, &ext_mem_119524, "ext_mem_119524") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_119815, &ext_mem_119525, "ext_mem_119525") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_119816, &ext_mem_119526, "ext_mem_119526") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_119817, &ext_mem_119527, "ext_mem_119527") != 0)
                        return 1;
                } else {
                    bool defunc_0_reduce_res_119823;
                    int64_t flat_tid_119847 = (int64_t) 0;
                    
                    defunc_0_reduce_res_119823 = 0;
                    
                    int64_t flat_tid_119825 = (int64_t) 0;
                    struct futhark_mc_task_128352 futhark_mc_task_128352_;
                    
                    futhark_mc_task_128352_.ctx = ctx;
                    futhark_mc_task_128352_.free_m_33388 = m_33388;
                    futhark_mc_task_128352_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
                    futhark_mc_task_128352_.free_zs_res_44883 = zs_res_44883;
                    futhark_mc_task_128352_.free_zs_res_44885 = zs_res_44885;
                    futhark_mc_task_128352_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
                    futhark_mc_task_128352_.free_distrs_mem_111708 = distrs_mem_111708.mem;
                    futhark_mc_task_128352_.free_ext_mem_119519 = ext_mem_119519.mem;
                    futhark_mc_task_128352_.free_ext_mem_119520 = ext_mem_119520.mem;
                    futhark_mc_task_128352_.free_ext_mem_119522 = ext_mem_119522.mem;
                    futhark_mc_task_128352_.free_ext_119528 = ext_119528;
                    futhark_mc_task_128352_.free_ext_119529 = ext_119529;
                    futhark_mc_task_128352_.free_ext_119530 = ext_119530;
                    futhark_mc_task_128352_.free_flat_tid_119825 = flat_tid_119825;
                    futhark_mc_task_128352_.free_flat_tid_119847 = flat_tid_119847;
                    futhark_mc_task_128352_.retval_defunc_0_reduce_res_119823 = (bool *) &defunc_0_reduce_res_119823;
                    #if ISPC
                    futhark_mc_task_128352_.retval_defunc_0_reduce_res_119823 += programIndex;
                    #endif
                    futhark_mc_task_128352_.retval_mem_112222 = mem_112222.mem;
                    
                    struct scheduler_segop futhark_mc_task_128352_task;
                    
                    futhark_mc_task_128352_task.args = &futhark_mc_task_128352_;
                    futhark_mc_task_128352_task.top_level_fn = futhark_mc_segred_task_128353;
                    futhark_mc_task_128352_task.name = "futhark_mc_segred_task_128353";
                    futhark_mc_task_128352_task.iterations = m_33388;
                    futhark_mc_task_128352_task.task_time = &ctx->program->futhark_mc_segred_task_128353_total_time;
                    futhark_mc_task_128352_task.task_iter = &ctx->program->futhark_mc_segred_task_128353_total_iter;
                    futhark_mc_task_128352_task.sched = STATIC;
                    futhark_mc_task_128352_task.nested_fn = futhark_mc_segred_nested_task_128360;
                    
                    int futhark_mc_segred_task_128353_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128352_task);
                    
                    if (futhark_mc_segred_task_128353_err != 0) {
                        err = futhark_mc_segred_task_128353_err;
                        goto cleanup;
                    }
                    
                    bool defunc_0_reduce_res_119867;
                    int64_t flat_tid_119891 = (int64_t) 0;
                    
                    defunc_0_reduce_res_119867 = 0;
                    
                    int64_t flat_tid_119869 = (int64_t) 0;
                    struct futhark_mc_task_128375 futhark_mc_task_128375_;
                    
                    futhark_mc_task_128375_.ctx = ctx;
                    futhark_mc_task_128375_.free_m_33388 = m_33388;
                    futhark_mc_task_128375_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
                    futhark_mc_task_128375_.free_zs_res_44842 = zs_res_44842;
                    futhark_mc_task_128375_.free_zs_res_44844 = zs_res_44844;
                    futhark_mc_task_128375_.free_eta_p_106382 = eta_p_106382;
                    futhark_mc_task_128375_.free_distrs_mem_111708 = distrs_mem_111708.mem;
                    futhark_mc_task_128375_.free_mem_112222 = mem_112222.mem;
                    futhark_mc_task_128375_.free_ext_mem_119519 = ext_mem_119519.mem;
                    futhark_mc_task_128375_.free_ext_mem_119521 = ext_mem_119521.mem;
                    futhark_mc_task_128375_.free_ext_119528 = ext_119528;
                    futhark_mc_task_128375_.free_ext_119529 = ext_119529;
                    futhark_mc_task_128375_.free_ext_119530 = ext_119530;
                    futhark_mc_task_128375_.free_flat_tid_119869 = flat_tid_119869;
                    futhark_mc_task_128375_.free_flat_tid_119891 = flat_tid_119891;
                    futhark_mc_task_128375_.retval_defunc_0_reduce_res_119867 = (bool *) &defunc_0_reduce_res_119867;
                    #if ISPC
                    futhark_mc_task_128375_.retval_defunc_0_reduce_res_119867 += programIndex;
                    #endif
                    futhark_mc_task_128375_.retval_mem_112224 = mem_112224.mem;
                    
                    struct scheduler_segop futhark_mc_task_128375_task;
                    
                    futhark_mc_task_128375_task.args = &futhark_mc_task_128375_;
                    futhark_mc_task_128375_task.top_level_fn = futhark_mc_segred_task_128376;
                    futhark_mc_task_128375_task.name = "futhark_mc_segred_task_128376";
                    futhark_mc_task_128375_task.iterations = m_33388;
                    futhark_mc_task_128375_task.task_time = &ctx->program->futhark_mc_segred_task_128376_total_time;
                    futhark_mc_task_128375_task.task_iter = &ctx->program->futhark_mc_segred_task_128376_total_iter;
                    futhark_mc_task_128375_task.sched = STATIC;
                    futhark_mc_task_128375_task.nested_fn = futhark_mc_segred_nested_task_128383;
                    
                    int futhark_mc_segred_task_128376_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128375_task);
                    
                    if (futhark_mc_segred_task_128376_err != 0) {
                        err = futhark_mc_segred_task_128376_err;
                        goto cleanup;
                    }
                    
                    bool defunc_0_reduce_res_119911;
                    int64_t flat_tid_119912 = (int64_t) 0;
                    
                    defunc_0_reduce_res_119911 = 0;
                    
                    struct futhark_mc_task_128398 futhark_mc_task_128398_;
                    
                    futhark_mc_task_128398_.ctx = ctx;
                    futhark_mc_task_128398_.free_zs_res_107134 = zs_res_107134;
                    futhark_mc_task_128398_.free_mem_112224 = mem_112224.mem;
                    futhark_mc_task_128398_.free_flat_tid_119912 = flat_tid_119912;
                    futhark_mc_task_128398_.retval_defunc_0_reduce_res_119911 = (bool *) &defunc_0_reduce_res_119911;
                    #if ISPC
                    futhark_mc_task_128398_.retval_defunc_0_reduce_res_119911 += programIndex;
                    #endif
                    
                    struct scheduler_segop futhark_mc_task_128398_task;
                    
                    futhark_mc_task_128398_task.args = &futhark_mc_task_128398_;
                    futhark_mc_task_128398_task.top_level_fn = futhark_mc_segred_task_128399;
                    futhark_mc_task_128398_task.name = "futhark_mc_segred_task_128399";
                    futhark_mc_task_128398_task.iterations = m_33388;
                    futhark_mc_task_128398_task.task_time = &ctx->program->futhark_mc_segred_task_128399_total_time;
                    futhark_mc_task_128398_task.task_iter = &ctx->program->futhark_mc_segred_task_128399_total_iter;
                    futhark_mc_task_128398_task.sched = STATIC;
                    futhark_mc_task_128398_task.nested_fn = NULL;
                    
                    int futhark_mc_segred_task_128399_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128398_task);
                    
                    if (futhark_mc_segred_task_128399_err != 0) {
                        err = futhark_mc_segred_task_128399_err;
                        goto cleanup;
                    }
                    
                    bool x_119919 = !defunc_0_reduce_res_119867;
                    bool y_119920 = defunc_0_reduce_res_119911 && x_119919;
                    bool cond_119921 = defunc_0_reduce_res_119867 || y_119920;
                    int64_t ext_119922;
                    
                    if (cond_119921) {
                        ext_119922 = (int64_t) 0;
                    } else {
                        ext_119922 = ext_119528;
                    }
                    
                    int64_t ext_119923;
                    
                    if (cond_119921) {
                        ext_119923 = m_33388;
                    } else {
                        ext_119923 = ext_119529;
                    }
                    
                    int64_t ext_119924;
                    
                    if (cond_119921) {
                        ext_119924 = (int64_t) 1;
                    } else {
                        ext_119924 = ext_119530;
                    }
                    if (cond_119921) {
                        int64_t flat_tid_119934 = (int64_t) 0;
                        struct futhark_mc_task_128406 futhark_mc_task_128406_;
                        
                        futhark_mc_task_128406_.ctx = ctx;
                        futhark_mc_task_128406_.free_m_33388 = m_33388;
                        futhark_mc_task_128406_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
                        futhark_mc_task_128406_.free_zs_res_107134 = zs_res_107134;
                        futhark_mc_task_128406_.free_bytes_111715 = bytes_111715;
                        futhark_mc_task_128406_.free_mem_112224 = mem_112224.mem;
                        futhark_mc_task_128406_.free_mem_112239 = mem_112239.mem;
                        futhark_mc_task_128406_.free_mem_112241 = mem_112241.mem;
                        futhark_mc_task_128406_.free_mem_112244 = mem_112244.mem;
                        futhark_mc_task_128406_.free_ext_mem_119519 = ext_mem_119519.mem;
                        futhark_mc_task_128406_.free_ext_mem_119521 = ext_mem_119521.mem;
                        futhark_mc_task_128406_.free_ext_119528 = ext_119528;
                        futhark_mc_task_128406_.free_ext_119529 = ext_119529;
                        futhark_mc_task_128406_.free_ext_119530 = ext_119530;
                        
                        struct scheduler_segop futhark_mc_task_128406_task;
                        
                        futhark_mc_task_128406_task.args = &futhark_mc_task_128406_;
                        futhark_mc_task_128406_task.top_level_fn = futhark_mc_segmap_task_128407;
                        futhark_mc_task_128406_task.name = "futhark_mc_segmap_task_128407";
                        futhark_mc_task_128406_task.iterations = m_33388;
                        futhark_mc_task_128406_task.task_time = &ctx->program->futhark_mc_segmap_task_128407_total_time;
                        futhark_mc_task_128406_task.task_iter = &ctx->program->futhark_mc_segmap_task_128407_total_iter;
                        futhark_mc_task_128406_task.sched = STATIC;
                        futhark_mc_task_128406_task.nested_fn = NULL;
                        
                        int futhark_mc_segmap_task_128407_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128406_task);
                        
                        if (futhark_mc_segmap_task_128407_err != 0) {
                            err = futhark_mc_segmap_task_128407_err;
                            goto cleanup;
                        }
                        if (memblock_set(ctx, &ext_mem_119925, &mem_112239, "mem_112239") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_119926, &mem_112241, "mem_112241") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_119927, &mem_112244, "mem_112244") != 0)
                            return 1;
                    } else {
                        if (memblock_set(ctx, &ext_mem_119925, &mem_112224, "mem_112224") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_119926, &ext_mem_119521, "ext_mem_119521") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_119927, &ext_mem_119519, "ext_mem_119519") != 0)
                            return 1;
                    }
                    
                    bool defunc_0_reduce_res_119964;
                    int64_t flat_tid_119965 = (int64_t) 0;
                    
                    defunc_0_reduce_res_119964 = 0;
                    
                    struct futhark_mc_task_128413 futhark_mc_task_128413_;
                    
                    futhark_mc_task_128413_.ctx = ctx;
                    futhark_mc_task_128413_.free_zs_res_107134 = zs_res_107134;
                    futhark_mc_task_128413_.free_mem_112222 = mem_112222.mem;
                    futhark_mc_task_128413_.free_flat_tid_119965 = flat_tid_119965;
                    futhark_mc_task_128413_.retval_defunc_0_reduce_res_119964 = (bool *) &defunc_0_reduce_res_119964;
                    #if ISPC
                    futhark_mc_task_128413_.retval_defunc_0_reduce_res_119964 += programIndex;
                    #endif
                    
                    struct scheduler_segop futhark_mc_task_128413_task;
                    
                    futhark_mc_task_128413_task.args = &futhark_mc_task_128413_;
                    futhark_mc_task_128413_task.top_level_fn = futhark_mc_segred_task_128414;
                    futhark_mc_task_128413_task.name = "futhark_mc_segred_task_128414";
                    futhark_mc_task_128413_task.iterations = m_33388;
                    futhark_mc_task_128413_task.task_time = &ctx->program->futhark_mc_segred_task_128414_total_time;
                    futhark_mc_task_128413_task.task_iter = &ctx->program->futhark_mc_segred_task_128414_total_iter;
                    futhark_mc_task_128413_task.sched = STATIC;
                    futhark_mc_task_128413_task.nested_fn = NULL;
                    
                    int futhark_mc_segred_task_128414_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128413_task);
                    
                    if (futhark_mc_segred_task_128414_err != 0) {
                        err = futhark_mc_segred_task_128414_err;
                        goto cleanup;
                    }
                    
                    bool x_119972 = !defunc_0_reduce_res_119823;
                    bool y_119973 = defunc_0_reduce_res_119964 && x_119972;
                    bool cond_119974 = defunc_0_reduce_res_119823 || y_119973;
                    int64_t ext_119976;
                    
                    if (cond_119974) {
                        ext_119976 = (int64_t) 0;
                    } else {
                        ext_119976 = ext_119922;
                    }
                    
                    int64_t ext_119977;
                    
                    if (cond_119974) {
                        ext_119977 = (int64_t) 1;
                    } else {
                        ext_119977 = ext_119923;
                    }
                    
                    int64_t ext_119978;
                    
                    if (cond_119974) {
                        ext_119978 = m_33388;
                    } else {
                        ext_119978 = ext_119924;
                    }
                    if (cond_119974) {
                        int64_t flat_tid_119988 = (int64_t) 0;
                        struct futhark_mc_task_128421 futhark_mc_task_128421_;
                        
                        futhark_mc_task_128421_.ctx = ctx;
                        futhark_mc_task_128421_.free_m_33388 = m_33388;
                        futhark_mc_task_128421_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
                        futhark_mc_task_128421_.free_zs_res_107134 = zs_res_107134;
                        futhark_mc_task_128421_.free_bytes_111715 = bytes_111715;
                        futhark_mc_task_128421_.free_mem_112222 = mem_112222.mem;
                        futhark_mc_task_128421_.free_mem_112267 = mem_112267.mem;
                        futhark_mc_task_128421_.free_mem_112269 = mem_112269.mem;
                        futhark_mc_task_128421_.free_mem_112272 = mem_112272.mem;
                        futhark_mc_task_128421_.free_ext_mem_119522 = ext_mem_119522.mem;
                        futhark_mc_task_128421_.free_ext_119922 = ext_119922;
                        futhark_mc_task_128421_.free_ext_119923 = ext_119923;
                        futhark_mc_task_128421_.free_ext_119924 = ext_119924;
                        futhark_mc_task_128421_.free_ext_mem_119927 = ext_mem_119927.mem;
                        
                        struct scheduler_segop futhark_mc_task_128421_task;
                        
                        futhark_mc_task_128421_task.args = &futhark_mc_task_128421_;
                        futhark_mc_task_128421_task.top_level_fn = futhark_mc_segmap_task_128422;
                        futhark_mc_task_128421_task.name = "futhark_mc_segmap_task_128422";
                        futhark_mc_task_128421_task.iterations = m_33388;
                        futhark_mc_task_128421_task.task_time = &ctx->program->futhark_mc_segmap_task_128422_total_time;
                        futhark_mc_task_128421_task.task_iter = &ctx->program->futhark_mc_segmap_task_128422_total_iter;
                        futhark_mc_task_128421_task.sched = STATIC;
                        futhark_mc_task_128421_task.nested_fn = NULL;
                        
                        int futhark_mc_segmap_task_128422_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128421_task);
                        
                        if (futhark_mc_segmap_task_128422_err != 0) {
                            err = futhark_mc_segmap_task_128422_err;
                            goto cleanup;
                        }
                        if (memblock_set(ctx, &ext_mem_119979, &mem_112267, "mem_112267") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_119980, &mem_112269, "mem_112269") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_119981, &mem_112272, "mem_112272") != 0)
                            return 1;
                    } else {
                        if (memblock_set(ctx, &ext_mem_119979, &mem_112222, "mem_112222") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_119980, &ext_mem_119522, "ext_mem_119522") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_119981, &ext_mem_119927, "ext_mem_119927") != 0)
                            return 1;
                    }
                    if (memblock_unref(ctx, &ext_mem_119927, "ext_mem_119927") != 0)
                        return 1;
                    
                    bool defunc_0_reduce_res_120019;
                    int64_t flat_tid_120020 = (int64_t) 0;
                    
                    defunc_0_reduce_res_120019 = 0;
                    
                    struct futhark_mc_task_128428 futhark_mc_task_128428_;
                    
                    futhark_mc_task_128428_.ctx = ctx;
                    futhark_mc_task_128428_.free_ext_mem_119925 = ext_mem_119925.mem;
                    futhark_mc_task_128428_.free_flat_tid_120020 = flat_tid_120020;
                    futhark_mc_task_128428_.retval_defunc_0_reduce_res_120019 = (bool *) &defunc_0_reduce_res_120019;
                    #if ISPC
                    futhark_mc_task_128428_.retval_defunc_0_reduce_res_120019 += programIndex;
                    #endif
                    
                    struct scheduler_segop futhark_mc_task_128428_task;
                    
                    futhark_mc_task_128428_task.args = &futhark_mc_task_128428_;
                    futhark_mc_task_128428_task.top_level_fn = futhark_mc_segred_task_128429;
                    futhark_mc_task_128428_task.name = "futhark_mc_segred_task_128429";
                    futhark_mc_task_128428_task.iterations = m_33388;
                    futhark_mc_task_128428_task.task_time = &ctx->program->futhark_mc_segred_task_128429_total_time;
                    futhark_mc_task_128428_task.task_iter = &ctx->program->futhark_mc_segred_task_128429_total_iter;
                    futhark_mc_task_128428_task.sched = STATIC;
                    futhark_mc_task_128428_task.nested_fn = NULL;
                    
                    int futhark_mc_segred_task_128429_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128428_task);
                    
                    if (futhark_mc_segred_task_128429_err != 0) {
                        err = futhark_mc_segred_task_128429_err;
                        goto cleanup;
                    }
                    
                    bool defunc_0_reduce_comm_res_120028;
                    int64_t flat_tid_120029 = (int64_t) 0;
                    
                    defunc_0_reduce_comm_res_120028 = 0;
                    
                    struct futhark_mc_task_128436 futhark_mc_task_128436_;
                    
                    futhark_mc_task_128436_.ctx = ctx;
                    futhark_mc_task_128436_.free_zp_res_108112 = zp_res_108112;
                    futhark_mc_task_128436_.free_ext_mem_119520 = ext_mem_119520.mem;
                    futhark_mc_task_128436_.free_ext_mem_119925 = ext_mem_119925.mem;
                    futhark_mc_task_128436_.free_flat_tid_120029 = flat_tid_120029;
                    futhark_mc_task_128436_.retval_defunc_0_reduce_comm_res_120028 = (bool *) &defunc_0_reduce_comm_res_120028;
                    #if ISPC
                    futhark_mc_task_128436_.retval_defunc_0_reduce_comm_res_120028 += programIndex;
                    #endif
                    
                    struct scheduler_segop futhark_mc_task_128436_task;
                    
                    futhark_mc_task_128436_task.args = &futhark_mc_task_128436_;
                    futhark_mc_task_128436_task.top_level_fn = futhark_mc_segred_task_128437;
                    futhark_mc_task_128436_task.name = "futhark_mc_segred_task_128437";
                    futhark_mc_task_128436_task.iterations = m_33388;
                    futhark_mc_task_128436_task.task_time = &ctx->program->futhark_mc_segred_task_128437_total_time;
                    futhark_mc_task_128436_task.task_iter = &ctx->program->futhark_mc_segred_task_128437_total_iter;
                    futhark_mc_task_128436_task.sched = STATIC;
                    futhark_mc_task_128436_task.nested_fn = NULL;
                    
                    int futhark_mc_segred_task_128437_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128436_task);
                    
                    if (futhark_mc_segred_task_128437_err != 0) {
                        err = futhark_mc_segred_task_128437_err;
                        goto cleanup;
                    }
                    
                    bool x_120042 = defunc_0_reduce_res_120019 && defunc_0_reduce_comm_res_120028;
                    int64_t ext_120048;
                    int64_t ext_120049;
                    int64_t ext_120050;
                    bool algo5_core_loop_res_f_res_120051;
                    int64_t ctx_param_ext_120062;
                    int64_t ctx_param_ext_120063;
                    int64_t ctx_param_ext_120064;
                    bool loop_while_120065;
                    
                    if (memblock_set(ctx, &mem_param_120057, &ext_mem_119981, "ext_mem_119981") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_120058, &ext_mem_119925, "ext_mem_119925") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_120059, &ext_mem_119979, "ext_mem_119979") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_120060, &ext_mem_119926, "ext_mem_119926") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_120061, &ext_mem_119980, "ext_mem_119980") != 0)
                        return 1;
                    ctx_param_ext_120062 = ext_119976;
                    ctx_param_ext_120063 = ext_119977;
                    ctx_param_ext_120064 = ext_119978;
                    loop_while_120065 = x_120042;
                    while (loop_while_120065) {
                        if (memblock_alloc(ctx, &mem_120071, bytes_111715, "mem_120071")) {
                            err = 1;
                            goto cleanup;
                        }
                        
                        bool defunc_0_reduce_res_120072;
                        int64_t flat_tid_120096 = (int64_t) 0;
                        
                        defunc_0_reduce_res_120072 = 0;
                        
                        int64_t flat_tid_120074 = (int64_t) 0;
                        struct futhark_mc_task_128444 futhark_mc_task_128444_;
                        
                        futhark_mc_task_128444_.ctx = ctx;
                        futhark_mc_task_128444_.free_m_33388 = m_33388;
                        futhark_mc_task_128444_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
                        futhark_mc_task_128444_.free_zs_res_44883 = zs_res_44883;
                        futhark_mc_task_128444_.free_zs_res_44885 = zs_res_44885;
                        futhark_mc_task_128444_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
                        futhark_mc_task_128444_.free_distrs_mem_111708 = distrs_mem_111708.mem;
                        futhark_mc_task_128444_.free_mem_param_120057 = mem_param_120057.mem;
                        futhark_mc_task_128444_.free_mem_param_120058 = mem_param_120058.mem;
                        futhark_mc_task_128444_.free_mem_param_120061 = mem_param_120061.mem;
                        futhark_mc_task_128444_.free_ctx_param_ext_120062 = ctx_param_ext_120062;
                        futhark_mc_task_128444_.free_ctx_param_ext_120063 = ctx_param_ext_120063;
                        futhark_mc_task_128444_.free_ctx_param_ext_120064 = ctx_param_ext_120064;
                        futhark_mc_task_128444_.free_flat_tid_120074 = flat_tid_120074;
                        futhark_mc_task_128444_.free_flat_tid_120096 = flat_tid_120096;
                        futhark_mc_task_128444_.retval_defunc_0_reduce_res_120072 = (bool *) &defunc_0_reduce_res_120072;
                        #if ISPC
                        futhark_mc_task_128444_.retval_defunc_0_reduce_res_120072 += programIndex;
                        #endif
                        futhark_mc_task_128444_.retval_mem_120071 = mem_120071.mem;
                        
                        struct scheduler_segop futhark_mc_task_128444_task;
                        
                        futhark_mc_task_128444_task.args = &futhark_mc_task_128444_;
                        futhark_mc_task_128444_task.top_level_fn = futhark_mc_segred_task_128445;
                        futhark_mc_task_128444_task.name = "futhark_mc_segred_task_128445";
                        futhark_mc_task_128444_task.iterations = m_33388;
                        futhark_mc_task_128444_task.task_time = &ctx->program->futhark_mc_segred_task_128445_total_time;
                        futhark_mc_task_128444_task.task_iter = &ctx->program->futhark_mc_segred_task_128445_total_iter;
                        futhark_mc_task_128444_task.sched = STATIC;
                        futhark_mc_task_128444_task.nested_fn = futhark_mc_segred_nested_task_128452;
                        
                        int futhark_mc_segred_task_128445_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128444_task);
                        
                        if (futhark_mc_segred_task_128445_err != 0) {
                            err = futhark_mc_segred_task_128445_err;
                            goto cleanup;
                        }
                        if (memblock_alloc(ctx, &mem_120116, bytes_111715, "mem_120116")) {
                            err = 1;
                            goto cleanup;
                        }
                        
                        bool defunc_0_reduce_res_120117;
                        int64_t flat_tid_120141 = (int64_t) 0;
                        
                        defunc_0_reduce_res_120117 = 0;
                        
                        int64_t flat_tid_120119 = (int64_t) 0;
                        struct futhark_mc_task_128467 futhark_mc_task_128467_;
                        
                        futhark_mc_task_128467_.ctx = ctx;
                        futhark_mc_task_128467_.free_m_33388 = m_33388;
                        futhark_mc_task_128467_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
                        futhark_mc_task_128467_.free_zs_res_44842 = zs_res_44842;
                        futhark_mc_task_128467_.free_zs_res_44844 = zs_res_44844;
                        futhark_mc_task_128467_.free_eta_p_106382 = eta_p_106382;
                        futhark_mc_task_128467_.free_distrs_mem_111708 = distrs_mem_111708.mem;
                        futhark_mc_task_128467_.free_mem_param_120057 = mem_param_120057.mem;
                        futhark_mc_task_128467_.free_mem_param_120060 = mem_param_120060.mem;
                        futhark_mc_task_128467_.free_ctx_param_ext_120062 = ctx_param_ext_120062;
                        futhark_mc_task_128467_.free_ctx_param_ext_120063 = ctx_param_ext_120063;
                        futhark_mc_task_128467_.free_ctx_param_ext_120064 = ctx_param_ext_120064;
                        futhark_mc_task_128467_.free_mem_120071 = mem_120071.mem;
                        futhark_mc_task_128467_.free_flat_tid_120119 = flat_tid_120119;
                        futhark_mc_task_128467_.free_flat_tid_120141 = flat_tid_120141;
                        futhark_mc_task_128467_.retval_defunc_0_reduce_res_120117 = (bool *) &defunc_0_reduce_res_120117;
                        #if ISPC
                        futhark_mc_task_128467_.retval_defunc_0_reduce_res_120117 += programIndex;
                        #endif
                        futhark_mc_task_128467_.retval_mem_120116 = mem_120116.mem;
                        
                        struct scheduler_segop futhark_mc_task_128467_task;
                        
                        futhark_mc_task_128467_task.args = &futhark_mc_task_128467_;
                        futhark_mc_task_128467_task.top_level_fn = futhark_mc_segred_task_128468;
                        futhark_mc_task_128467_task.name = "futhark_mc_segred_task_128468";
                        futhark_mc_task_128467_task.iterations = m_33388;
                        futhark_mc_task_128467_task.task_time = &ctx->program->futhark_mc_segred_task_128468_total_time;
                        futhark_mc_task_128467_task.task_iter = &ctx->program->futhark_mc_segred_task_128468_total_iter;
                        futhark_mc_task_128467_task.sched = STATIC;
                        futhark_mc_task_128467_task.nested_fn = futhark_mc_segred_nested_task_128475;
                        
                        int futhark_mc_segred_task_128468_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128467_task);
                        
                        if (futhark_mc_segred_task_128468_err != 0) {
                            err = futhark_mc_segred_task_128468_err;
                            goto cleanup;
                        }
                        
                        bool defunc_0_reduce_res_120161;
                        int64_t flat_tid_120162 = (int64_t) 0;
                        
                        defunc_0_reduce_res_120161 = 0;
                        
                        struct futhark_mc_task_128490 futhark_mc_task_128490_;
                        
                        futhark_mc_task_128490_.ctx = ctx;
                        futhark_mc_task_128490_.free_zs_res_107134 = zs_res_107134;
                        futhark_mc_task_128490_.free_mem_120116 = mem_120116.mem;
                        futhark_mc_task_128490_.free_flat_tid_120162 = flat_tid_120162;
                        futhark_mc_task_128490_.retval_defunc_0_reduce_res_120161 = (bool *) &defunc_0_reduce_res_120161;
                        #if ISPC
                        futhark_mc_task_128490_.retval_defunc_0_reduce_res_120161 += programIndex;
                        #endif
                        
                        struct scheduler_segop futhark_mc_task_128490_task;
                        
                        futhark_mc_task_128490_task.args = &futhark_mc_task_128490_;
                        futhark_mc_task_128490_task.top_level_fn = futhark_mc_segred_task_128491;
                        futhark_mc_task_128490_task.name = "futhark_mc_segred_task_128491";
                        futhark_mc_task_128490_task.iterations = m_33388;
                        futhark_mc_task_128490_task.task_time = &ctx->program->futhark_mc_segred_task_128491_total_time;
                        futhark_mc_task_128490_task.task_iter = &ctx->program->futhark_mc_segred_task_128491_total_iter;
                        futhark_mc_task_128490_task.sched = STATIC;
                        futhark_mc_task_128490_task.nested_fn = NULL;
                        
                        int futhark_mc_segred_task_128491_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128490_task);
                        
                        if (futhark_mc_segred_task_128491_err != 0) {
                            err = futhark_mc_segred_task_128491_err;
                            goto cleanup;
                        }
                        
                        bool x_120169 = !defunc_0_reduce_res_120117;
                        bool y_120170 = defunc_0_reduce_res_120161 && x_120169;
                        bool cond_120171 = defunc_0_reduce_res_120117 || y_120170;
                        int64_t ext_120172;
                        
                        if (cond_120171) {
                            ext_120172 = (int64_t) 0;
                        } else {
                            ext_120172 = ctx_param_ext_120062;
                        }
                        
                        int64_t ext_120173;
                        
                        if (cond_120171) {
                            ext_120173 = m_33388;
                        } else {
                            ext_120173 = ctx_param_ext_120063;
                        }
                        
                        int64_t ext_120174;
                        
                        if (cond_120171) {
                            ext_120174 = (int64_t) 1;
                        } else {
                            ext_120174 = ctx_param_ext_120064;
                        }
                        if (memblock_alloc(ctx, &mem_120175, bytes_111715, "mem_120175")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (memblock_alloc(ctx, &mem_120176, bytes_111715, "mem_120176")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (memblock_alloc(ctx, &mem_120177, bytes_111743, "mem_120177")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (cond_120171) {
                            int64_t bytes_120184 = (int64_t) 8 * m_33388;
                            int64_t flat_tid_120188 = (int64_t) 0;
                            struct futhark_mc_task_128498 futhark_mc_task_128498_;
                            
                            futhark_mc_task_128498_.ctx = ctx;
                            futhark_mc_task_128498_.free_m_33388 = m_33388;
                            futhark_mc_task_128498_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
                            futhark_mc_task_128498_.free_zs_res_107134 = zs_res_107134;
                            futhark_mc_task_128498_.free_mem_param_120057 = mem_param_120057.mem;
                            futhark_mc_task_128498_.free_mem_param_120060 = mem_param_120060.mem;
                            futhark_mc_task_128498_.free_ctx_param_ext_120062 = ctx_param_ext_120062;
                            futhark_mc_task_128498_.free_ctx_param_ext_120063 = ctx_param_ext_120063;
                            futhark_mc_task_128498_.free_ctx_param_ext_120064 = ctx_param_ext_120064;
                            futhark_mc_task_128498_.free_mem_120116 = mem_120116.mem;
                            futhark_mc_task_128498_.free_mem_120175 = mem_120175.mem;
                            futhark_mc_task_128498_.free_mem_120176 = mem_120176.mem;
                            futhark_mc_task_128498_.free_mem_120177 = mem_120177.mem;
                            futhark_mc_task_128498_.free_bytes_120184 = bytes_120184;
                            
                            struct scheduler_segop futhark_mc_task_128498_task;
                            
                            futhark_mc_task_128498_task.args = &futhark_mc_task_128498_;
                            futhark_mc_task_128498_task.top_level_fn = futhark_mc_segmap_task_128499;
                            futhark_mc_task_128498_task.name = "futhark_mc_segmap_task_128499";
                            futhark_mc_task_128498_task.iterations = m_33388;
                            futhark_mc_task_128498_task.task_time = &ctx->program->futhark_mc_segmap_task_128499_total_time;
                            futhark_mc_task_128498_task.task_iter = &ctx->program->futhark_mc_segmap_task_128499_total_iter;
                            futhark_mc_task_128498_task.sched = STATIC;
                            futhark_mc_task_128498_task.nested_fn = NULL;
                            
                            int futhark_mc_segmap_task_128499_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128498_task);
                            
                            if (futhark_mc_segmap_task_128499_err != 0) {
                                err = futhark_mc_segmap_task_128499_err;
                                goto cleanup;
                            }
                            if (memblock_set(ctx, &ext_mem_120178, &mem_120175, "mem_120175") != 0)
                                return 1;
                            if (memblock_set(ctx, &ext_mem_120179, &mem_120176, "mem_120176") != 0)
                                return 1;
                            if (memblock_set(ctx, &ext_mem_120180, &mem_120177, "mem_120177") != 0)
                                return 1;
                        } else {
                            if (memblock_set(ctx, &ext_mem_120178, &mem_120116, "mem_120116") != 0)
                                return 1;
                            if (memblock_set(ctx, &ext_mem_120179, &mem_param_120060, "mem_param_120060") != 0)
                                return 1;
                            if (memblock_set(ctx, &ext_mem_120180, &mem_param_120057, "mem_param_120057") != 0)
                                return 1;
                        }
                        if (memblock_unref(ctx, &mem_120116, "mem_120116") != 0)
                            return 1;
                        if (memblock_unref(ctx, &mem_120175, "mem_120175") != 0)
                            return 1;
                        if (memblock_unref(ctx, &mem_120176, "mem_120176") != 0)
                            return 1;
                        if (memblock_unref(ctx, &mem_120177, "mem_120177") != 0)
                            return 1;
                        
                        bool defunc_0_reduce_res_120218;
                        int64_t flat_tid_120219 = (int64_t) 0;
                        
                        defunc_0_reduce_res_120218 = 0;
                        
                        struct futhark_mc_task_128505 futhark_mc_task_128505_;
                        
                        futhark_mc_task_128505_.ctx = ctx;
                        futhark_mc_task_128505_.free_zs_res_107134 = zs_res_107134;
                        futhark_mc_task_128505_.free_mem_120071 = mem_120071.mem;
                        futhark_mc_task_128505_.free_flat_tid_120219 = flat_tid_120219;
                        futhark_mc_task_128505_.retval_defunc_0_reduce_res_120218 = (bool *) &defunc_0_reduce_res_120218;
                        #if ISPC
                        futhark_mc_task_128505_.retval_defunc_0_reduce_res_120218 += programIndex;
                        #endif
                        
                        struct scheduler_segop futhark_mc_task_128505_task;
                        
                        futhark_mc_task_128505_task.args = &futhark_mc_task_128505_;
                        futhark_mc_task_128505_task.top_level_fn = futhark_mc_segred_task_128506;
                        futhark_mc_task_128505_task.name = "futhark_mc_segred_task_128506";
                        futhark_mc_task_128505_task.iterations = m_33388;
                        futhark_mc_task_128505_task.task_time = &ctx->program->futhark_mc_segred_task_128506_total_time;
                        futhark_mc_task_128505_task.task_iter = &ctx->program->futhark_mc_segred_task_128506_total_iter;
                        futhark_mc_task_128505_task.sched = STATIC;
                        futhark_mc_task_128505_task.nested_fn = NULL;
                        
                        int futhark_mc_segred_task_128506_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128505_task);
                        
                        if (futhark_mc_segred_task_128506_err != 0) {
                            err = futhark_mc_segred_task_128506_err;
                            goto cleanup;
                        }
                        
                        bool x_120226 = !defunc_0_reduce_res_120072;
                        bool y_120227 = defunc_0_reduce_res_120218 && x_120226;
                        bool cond_120228 = defunc_0_reduce_res_120072 || y_120227;
                        int64_t ext_120230;
                        
                        if (cond_120228) {
                            ext_120230 = (int64_t) 0;
                        } else {
                            ext_120230 = ext_120172;
                        }
                        
                        int64_t ext_120231;
                        
                        if (cond_120228) {
                            ext_120231 = (int64_t) 1;
                        } else {
                            ext_120231 = ext_120173;
                        }
                        
                        int64_t ext_120232;
                        
                        if (cond_120228) {
                            ext_120232 = m_33388;
                        } else {
                            ext_120232 = ext_120174;
                        }
                        if (memblock_alloc(ctx, &mem_120233, bytes_111715, "mem_120233")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (memblock_alloc(ctx, &mem_120234, bytes_111715, "mem_120234")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (memblock_alloc(ctx, &mem_120235, bytes_111743, "mem_120235")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (cond_120228) {
                            int64_t bytes_120242 = (int64_t) 8 * m_33388;
                            int64_t flat_tid_120246 = (int64_t) 0;
                            struct futhark_mc_task_128513 futhark_mc_task_128513_;
                            
                            futhark_mc_task_128513_.ctx = ctx;
                            futhark_mc_task_128513_.free_m_33388 = m_33388;
                            futhark_mc_task_128513_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
                            futhark_mc_task_128513_.free_zs_res_107134 = zs_res_107134;
                            futhark_mc_task_128513_.free_mem_param_120061 = mem_param_120061.mem;
                            futhark_mc_task_128513_.free_mem_120071 = mem_120071.mem;
                            futhark_mc_task_128513_.free_ext_120172 = ext_120172;
                            futhark_mc_task_128513_.free_ext_120173 = ext_120173;
                            futhark_mc_task_128513_.free_ext_120174 = ext_120174;
                            futhark_mc_task_128513_.free_ext_mem_120180 = ext_mem_120180.mem;
                            futhark_mc_task_128513_.free_mem_120233 = mem_120233.mem;
                            futhark_mc_task_128513_.free_mem_120234 = mem_120234.mem;
                            futhark_mc_task_128513_.free_mem_120235 = mem_120235.mem;
                            futhark_mc_task_128513_.free_bytes_120242 = bytes_120242;
                            
                            struct scheduler_segop futhark_mc_task_128513_task;
                            
                            futhark_mc_task_128513_task.args = &futhark_mc_task_128513_;
                            futhark_mc_task_128513_task.top_level_fn = futhark_mc_segmap_task_128514;
                            futhark_mc_task_128513_task.name = "futhark_mc_segmap_task_128514";
                            futhark_mc_task_128513_task.iterations = m_33388;
                            futhark_mc_task_128513_task.task_time = &ctx->program->futhark_mc_segmap_task_128514_total_time;
                            futhark_mc_task_128513_task.task_iter = &ctx->program->futhark_mc_segmap_task_128514_total_iter;
                            futhark_mc_task_128513_task.sched = STATIC;
                            futhark_mc_task_128513_task.nested_fn = NULL;
                            
                            int futhark_mc_segmap_task_128514_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128513_task);
                            
                            if (futhark_mc_segmap_task_128514_err != 0) {
                                err = futhark_mc_segmap_task_128514_err;
                                goto cleanup;
                            }
                            if (memblock_set(ctx, &ext_mem_120236, &mem_120233, "mem_120233") != 0)
                                return 1;
                            if (memblock_set(ctx, &ext_mem_120237, &mem_120234, "mem_120234") != 0)
                                return 1;
                            if (memblock_set(ctx, &ext_mem_120238, &mem_120235, "mem_120235") != 0)
                                return 1;
                        } else {
                            if (memblock_set(ctx, &ext_mem_120236, &mem_120071, "mem_120071") != 0)
                                return 1;
                            if (memblock_set(ctx, &ext_mem_120237, &mem_param_120061, "mem_param_120061") != 0)
                                return 1;
                            if (memblock_set(ctx, &ext_mem_120238, &ext_mem_120180, "ext_mem_120180") != 0)
                                return 1;
                        }
                        if (memblock_unref(ctx, &mem_120071, "mem_120071") != 0)
                            return 1;
                        if (memblock_unref(ctx, &ext_mem_120180, "ext_mem_120180") != 0)
                            return 1;
                        if (memblock_unref(ctx, &mem_120233, "mem_120233") != 0)
                            return 1;
                        if (memblock_unref(ctx, &mem_120234, "mem_120234") != 0)
                            return 1;
                        if (memblock_unref(ctx, &mem_120235, "mem_120235") != 0)
                            return 1;
                        
                        bool defunc_0_reduce_res_120277;
                        int64_t flat_tid_120278 = (int64_t) 0;
                        
                        defunc_0_reduce_res_120277 = 0;
                        
                        struct futhark_mc_task_128520 futhark_mc_task_128520_;
                        
                        futhark_mc_task_128520_.ctx = ctx;
                        futhark_mc_task_128520_.free_ext_mem_120178 = ext_mem_120178.mem;
                        futhark_mc_task_128520_.free_flat_tid_120278 = flat_tid_120278;
                        futhark_mc_task_128520_.retval_defunc_0_reduce_res_120277 = (bool *) &defunc_0_reduce_res_120277;
                        #if ISPC
                        futhark_mc_task_128520_.retval_defunc_0_reduce_res_120277 += programIndex;
                        #endif
                        
                        struct scheduler_segop futhark_mc_task_128520_task;
                        
                        futhark_mc_task_128520_task.args = &futhark_mc_task_128520_;
                        futhark_mc_task_128520_task.top_level_fn = futhark_mc_segred_task_128521;
                        futhark_mc_task_128520_task.name = "futhark_mc_segred_task_128521";
                        futhark_mc_task_128520_task.iterations = m_33388;
                        futhark_mc_task_128520_task.task_time = &ctx->program->futhark_mc_segred_task_128521_total_time;
                        futhark_mc_task_128520_task.task_iter = &ctx->program->futhark_mc_segred_task_128521_total_iter;
                        futhark_mc_task_128520_task.sched = STATIC;
                        futhark_mc_task_128520_task.nested_fn = NULL;
                        
                        int futhark_mc_segred_task_128521_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128520_task);
                        
                        if (futhark_mc_segred_task_128521_err != 0) {
                            err = futhark_mc_segred_task_128521_err;
                            goto cleanup;
                        }
                        
                        bool defunc_0_reduce_comm_res_120286;
                        int64_t flat_tid_120287 = (int64_t) 0;
                        
                        defunc_0_reduce_comm_res_120286 = 0;
                        
                        struct futhark_mc_task_128528 futhark_mc_task_128528_;
                        
                        futhark_mc_task_128528_.ctx = ctx;
                        futhark_mc_task_128528_.free_zp_res_108112 = zp_res_108112;
                        futhark_mc_task_128528_.free_mem_param_120058 = mem_param_120058.mem;
                        futhark_mc_task_128528_.free_ext_mem_120178 = ext_mem_120178.mem;
                        futhark_mc_task_128528_.free_flat_tid_120287 = flat_tid_120287;
                        futhark_mc_task_128528_.retval_defunc_0_reduce_comm_res_120286 = (bool *) &defunc_0_reduce_comm_res_120286;
                        #if ISPC
                        futhark_mc_task_128528_.retval_defunc_0_reduce_comm_res_120286 += programIndex;
                        #endif
                        
                        struct scheduler_segop futhark_mc_task_128528_task;
                        
                        futhark_mc_task_128528_task.args = &futhark_mc_task_128528_;
                        futhark_mc_task_128528_task.top_level_fn = futhark_mc_segred_task_128529;
                        futhark_mc_task_128528_task.name = "futhark_mc_segred_task_128529";
                        futhark_mc_task_128528_task.iterations = m_33388;
                        futhark_mc_task_128528_task.task_time = &ctx->program->futhark_mc_segred_task_128529_total_time;
                        futhark_mc_task_128528_task.task_iter = &ctx->program->futhark_mc_segred_task_128529_total_iter;
                        futhark_mc_task_128528_task.sched = STATIC;
                        futhark_mc_task_128528_task.nested_fn = NULL;
                        
                        int futhark_mc_segred_task_128529_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128528_task);
                        
                        if (futhark_mc_segred_task_128529_err != 0) {
                            err = futhark_mc_segred_task_128529_err;
                            goto cleanup;
                        }
                        
                        bool x_120300 = defunc_0_reduce_res_120277 && defunc_0_reduce_comm_res_120286;
                        
                        if (memblock_set(ctx, &mem_param_tmp_124709, &ext_mem_120238, "ext_mem_120238") != 0)
                            return 1;
                        if (memblock_set(ctx, &mem_param_tmp_124710, &ext_mem_120178, "ext_mem_120178") != 0)
                            return 1;
                        if (memblock_set(ctx, &mem_param_tmp_124711, &ext_mem_120236, "ext_mem_120236") != 0)
                            return 1;
                        if (memblock_set(ctx, &mem_param_tmp_124712, &ext_mem_120179, "ext_mem_120179") != 0)
                            return 1;
                        if (memblock_set(ctx, &mem_param_tmp_124713, &ext_mem_120237, "ext_mem_120237") != 0)
                            return 1;
                        
                        int64_t ctx_param_ext_tmp_124714 = ext_120230;
                        int64_t ctx_param_ext_tmp_124715 = ext_120231;
                        int64_t ctx_param_ext_tmp_124716 = ext_120232;
                        bool loop_while_tmp_124717 = x_120300;
                        
                        if (memblock_set(ctx, &mem_param_120057, &mem_param_tmp_124709, "mem_param_tmp_124709") != 0)
                            return 1;
                        if (memblock_set(ctx, &mem_param_120058, &mem_param_tmp_124710, "mem_param_tmp_124710") != 0)
                            return 1;
                        if (memblock_set(ctx, &mem_param_120059, &mem_param_tmp_124711, "mem_param_tmp_124711") != 0)
                            return 1;
                        if (memblock_set(ctx, &mem_param_120060, &mem_param_tmp_124712, "mem_param_tmp_124712") != 0)
                            return 1;
                        if (memblock_set(ctx, &mem_param_120061, &mem_param_tmp_124713, "mem_param_tmp_124713") != 0)
                            return 1;
                        ctx_param_ext_120062 = ctx_param_ext_tmp_124714;
                        ctx_param_ext_120063 = ctx_param_ext_tmp_124715;
                        ctx_param_ext_120064 = ctx_param_ext_tmp_124716;
                        loop_while_120065 = loop_while_tmp_124717;
                    }
                    if (memblock_set(ctx, &ext_mem_120043, &mem_param_120057, "mem_param_120057") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_120044, &mem_param_120058, "mem_param_120058") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_120045, &mem_param_120059, "mem_param_120059") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_120046, &mem_param_120060, "mem_param_120060") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_120047, &mem_param_120061, "mem_param_120061") != 0)
                        return 1;
                    ext_120048 = ctx_param_ext_120062;
                    ext_120049 = ctx_param_ext_120063;
                    ext_120050 = ctx_param_ext_120064;
                    algo5_core_loop_res_f_res_120051 = loop_while_120065;
                    if (memblock_unref(ctx, &ext_mem_119925, "ext_mem_119925") != 0)
                        return 1;
                    if (memblock_unref(ctx, &ext_mem_119926, "ext_mem_119926") != 0)
                        return 1;
                    if (memblock_unref(ctx, &ext_mem_119979, "ext_mem_119979") != 0)
                        return 1;
                    if (memblock_unref(ctx, &ext_mem_119980, "ext_mem_119980") != 0)
                        return 1;
                    if (memblock_unref(ctx, &ext_mem_119981, "ext_mem_119981") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_119810, &ext_mem_120043, "ext_mem_120043") != 0)
                        return 1;
                    ext_119811 = ext_120048;
                    ext_119812 = ext_120049;
                    ext_119813 = ext_120050;
                    if (memblock_set(ctx, &ext_mem_119814, &ext_mem_120044, "ext_mem_120044") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_119815, &ext_mem_120045, "ext_mem_120045") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_119816, &ext_mem_120046, "ext_mem_120046") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_119817, &ext_mem_120047, "ext_mem_120047") != 0)
                        return 1;
                }
                if (memblock_unref(ctx, &ext_mem_119519, "ext_mem_119519") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_119520, "ext_mem_119520") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_119521, "ext_mem_119521") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_119522, "ext_mem_119522") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_119523, "ext_mem_119523") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_119524, "ext_mem_119524") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_119525, "ext_mem_119525") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_119526, "ext_mem_119526") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_119527, "ext_mem_119527") != 0)
                    return 1;
                if (memblock_alloc(ctx, &mem_120301, bytes_111715, "mem_120301")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_120302, bytes_111715, "mem_120302")) {
                    err = 1;
                    goto cleanup;
                }
                
                double defunc_res_120303;
                int64_t flat_tid_120332 = (int64_t) 0;
                
                defunc_res_120303 = 0.0;
                
                int64_t flat_tid_120307 = (int64_t) 0;
                struct futhark_mc_task_128536 futhark_mc_task_128536_;
                
                futhark_mc_task_128536_.ctx = ctx;
                futhark_mc_task_128536_.free_m_33388 = m_33388;
                futhark_mc_task_128536_.free_bytes_111715 = bytes_111715;
                futhark_mc_task_128536_.free_ext_mem_119810 = ext_mem_119810.mem;
                futhark_mc_task_128536_.free_ext_119811 = ext_119811;
                futhark_mc_task_128536_.free_ext_119812 = ext_119812;
                futhark_mc_task_128536_.free_ext_119813 = ext_119813;
                futhark_mc_task_128536_.free_ext_mem_119814 = ext_mem_119814.mem;
                futhark_mc_task_128536_.free_ext_mem_119815 = ext_mem_119815.mem;
                futhark_mc_task_128536_.free_ext_mem_119816 = ext_mem_119816.mem;
                futhark_mc_task_128536_.free_ext_mem_119817 = ext_mem_119817.mem;
                futhark_mc_task_128536_.free_flat_tid_120307 = flat_tid_120307;
                futhark_mc_task_128536_.free_flat_tid_120332 = flat_tid_120332;
                futhark_mc_task_128536_.retval_defunc_res_120303 = (double *) &defunc_res_120303;
                #if ISPC
                futhark_mc_task_128536_.retval_defunc_res_120303 += programIndex;
                #endif
                futhark_mc_task_128536_.retval_mem_120301 = mem_120301.mem;
                futhark_mc_task_128536_.retval_mem_112403 = mem_112403;
                futhark_mc_task_128536_.retval_mem_120302 = mem_120302.mem;
                
                struct scheduler_segop futhark_mc_task_128536_task;
                
                futhark_mc_task_128536_task.args = &futhark_mc_task_128536_;
                futhark_mc_task_128536_task.top_level_fn = futhark_mc_segred_task_128537;
                futhark_mc_task_128536_task.name = "futhark_mc_segred_task_128537";
                futhark_mc_task_128536_task.iterations = m_33388;
                futhark_mc_task_128536_task.task_time = &ctx->program->futhark_mc_segred_task_128537_total_time;
                futhark_mc_task_128536_task.task_iter = &ctx->program->futhark_mc_segred_task_128537_total_iter;
                futhark_mc_task_128536_task.sched = STATIC;
                futhark_mc_task_128536_task.nested_fn = futhark_mc_segred_nested_task_128545;
                
                int futhark_mc_segred_task_128537_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128536_task);
                
                if (futhark_mc_segred_task_128537_err != 0) {
                    err = futhark_mc_segred_task_128537_err;
                    goto cleanup;
                }
                if (memblock_unref(ctx, &ext_mem_119810, "ext_mem_119810") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_119814, "ext_mem_119814") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_119815, "ext_mem_119815") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_119816, "ext_mem_119816") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_119817, "ext_mem_119817") != 0)
                    return 1;
                
                bool zg_res_120358 = 0.0 < defunc_res_120303;
                double zs_res_120359 = defunc_res_118937 / defunc_res_120303;
                double sqrt_res_120360 = futrts_sqrt64(zs_res_120359);
                
                if (memblock_alloc(ctx, &mem_120361, bytes_111715, "mem_120361")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_120362, bytes_111743, "mem_120362")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_120363, bytes_111743, "mem_120363")) {
                    err = 1;
                    goto cleanup;
                }
                
                double descent_res_120370;
                
                if (zg_res_120358) {
                    double defunc_res_120371;
                    double defunc_res_120372;
                    double defunc_res_120373;
                    int64_t flat_tid_120410 = (int64_t) 0;
                    
                    defunc_res_120371 = 0.0;
                    defunc_res_120372 = 0.0;
                    defunc_res_120373 = 0.0;
                    
                    int64_t flat_tid_120377 = (int64_t) 0;
                    struct futhark_mc_task_128568 futhark_mc_task_128568_;
                    
                    futhark_mc_task_128568_.ctx = ctx;
                    futhark_mc_task_128568_.free_m_33388 = m_33388;
                    futhark_mc_task_128568_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
                    futhark_mc_task_128568_.free_distrs_mem_111708 = distrs_mem_111708.mem;
                    futhark_mc_task_128568_.free_mem_param_118928 = mem_param_118928.mem;
                    futhark_mc_task_128568_.free_flat_tid_120377 = flat_tid_120377;
                    futhark_mc_task_128568_.free_flat_tid_120410 = flat_tid_120410;
                    futhark_mc_task_128568_.retval_defunc_res_120371 = (double *) &defunc_res_120371;
                    #if ISPC
                    futhark_mc_task_128568_.retval_defunc_res_120371 += programIndex;
                    #endif
                    futhark_mc_task_128568_.retval_defunc_res_120372 = (double *) &defunc_res_120372;
                    #if ISPC
                    futhark_mc_task_128568_.retval_defunc_res_120372 += programIndex;
                    #endif
                    futhark_mc_task_128568_.retval_defunc_res_120373 = (double *) &defunc_res_120373;
                    #if ISPC
                    futhark_mc_task_128568_.retval_defunc_res_120373 += programIndex;
                    #endif
                    futhark_mc_task_128568_.retval_mem_112412 = mem_112412;
                    futhark_mc_task_128568_.retval_mem_112414 = mem_112414;
                    futhark_mc_task_128568_.retval_mem_112416 = mem_112416;
                    
                    struct scheduler_segop futhark_mc_task_128568_task;
                    
                    futhark_mc_task_128568_task.args = &futhark_mc_task_128568_;
                    futhark_mc_task_128568_task.top_level_fn = futhark_mc_segred_task_128569;
                    futhark_mc_task_128568_task.name = "futhark_mc_segred_task_128569";
                    futhark_mc_task_128568_task.iterations = m_33388;
                    futhark_mc_task_128568_task.task_time = &ctx->program->futhark_mc_segred_task_128569_total_time;
                    futhark_mc_task_128568_task.task_iter = &ctx->program->futhark_mc_segred_task_128569_total_iter;
                    futhark_mc_task_128568_task.sched = STATIC;
                    futhark_mc_task_128568_task.nested_fn = futhark_mc_segred_nested_task_128578;
                    
                    int futhark_mc_segred_task_128569_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128568_task);
                    
                    if (futhark_mc_segred_task_128569_err != 0) {
                        err = futhark_mc_segred_task_128569_err;
                        goto cleanup;
                    }
                    
                    double zm_res_120439 = defunc_res_120371 - defunc_res_120373;
                    double zt_res_120440 = 2.0 * zm_res_120439;
                    double zt_res_120441 = 2.0 * defunc_res_120373;
                    int64_t flat_tid_120443 = (int64_t) 0;
                    struct futhark_mc_task_128597 futhark_mc_task_128597_;
                    
                    futhark_mc_task_128597_.ctx = ctx;
                    futhark_mc_task_128597_.free_m_33388 = m_33388;
                    futhark_mc_task_128597_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
                    futhark_mc_task_128597_.free_distrs_mem_111708 = distrs_mem_111708.mem;
                    futhark_mc_task_128597_.free_mem_112414 = mem_112414;
                    futhark_mc_task_128597_.free_mem_112421 = mem_112421;
                    futhark_mc_task_128597_.free_zt_res_120440 = zt_res_120440;
                    futhark_mc_task_128597_.free_zt_res_120441 = zt_res_120441;
                    
                    struct scheduler_segop futhark_mc_task_128597_task;
                    
                    futhark_mc_task_128597_task.args = &futhark_mc_task_128597_;
                    futhark_mc_task_128597_task.top_level_fn = futhark_mc_segmap_task_128598;
                    futhark_mc_task_128597_task.name = "futhark_mc_segmap_task_128598";
                    futhark_mc_task_128597_task.iterations = m_33388;
                    futhark_mc_task_128597_task.task_time = &ctx->program->futhark_mc_segmap_task_128598_total_time;
                    futhark_mc_task_128597_task.task_iter = &ctx->program->futhark_mc_segmap_task_128598_total_iter;
                    futhark_mc_task_128597_task.sched = STATIC;
                    futhark_mc_task_128597_task.nested_fn = NULL;
                    
                    int futhark_mc_segmap_task_128598_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128597_task);
                    
                    if (futhark_mc_segmap_task_128598_err != 0) {
                        err = futhark_mc_segmap_task_128598_err;
                        goto cleanup;
                    }
                    
                    double defunc_res_120453;
                    double defunc_res_120454;
                    double defunc_res_120455;
                    double defunc_res_120456;
                    int64_t flat_tid_120509 = (int64_t) 0;
                    
                    defunc_res_120453 = 0.0;
                    defunc_res_120454 = 0.0;
                    defunc_res_120455 = 0.0;
                    defunc_res_120456 = 0.0;
                    
                    int64_t flat_tid_120459 = (int64_t) 0;
                    struct futhark_mc_task_128604 futhark_mc_task_128604_;
                    
                    futhark_mc_task_128604_.ctx = ctx;
                    futhark_mc_task_128604_.free_m_33388 = m_33388;
                    futhark_mc_task_128604_.free_eta_p_106382 = eta_p_106382;
                    futhark_mc_task_128604_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
                    futhark_mc_task_128604_.free_distrs_mem_111708 = distrs_mem_111708.mem;
                    futhark_mc_task_128604_.free_mem_param_118928 = mem_param_118928.mem;
                    futhark_mc_task_128604_.free_flat_tid_120459 = flat_tid_120459;
                    futhark_mc_task_128604_.free_flat_tid_120509 = flat_tid_120509;
                    futhark_mc_task_128604_.retval_defunc_res_120453 = (double *) &defunc_res_120453;
                    #if ISPC
                    futhark_mc_task_128604_.retval_defunc_res_120453 += programIndex;
                    #endif
                    futhark_mc_task_128604_.retval_defunc_res_120454 = (double *) &defunc_res_120454;
                    #if ISPC
                    futhark_mc_task_128604_.retval_defunc_res_120454 += programIndex;
                    #endif
                    futhark_mc_task_128604_.retval_defunc_res_120455 = (double *) &defunc_res_120455;
                    #if ISPC
                    futhark_mc_task_128604_.retval_defunc_res_120455 += programIndex;
                    #endif
                    futhark_mc_task_128604_.retval_defunc_res_120456 = (double *) &defunc_res_120456;
                    #if ISPC
                    futhark_mc_task_128604_.retval_defunc_res_120456 += programIndex;
                    #endif
                    futhark_mc_task_128604_.retval_mem_112423 = mem_112423;
                    futhark_mc_task_128604_.retval_mem_112425 = mem_112425;
                    
                    struct scheduler_segop futhark_mc_task_128604_task;
                    
                    futhark_mc_task_128604_task.args = &futhark_mc_task_128604_;
                    futhark_mc_task_128604_task.top_level_fn = futhark_mc_segred_task_128605;
                    futhark_mc_task_128604_task.name = "futhark_mc_segred_task_128605";
                    futhark_mc_task_128604_task.iterations = m_33388;
                    futhark_mc_task_128604_task.task_time = &ctx->program->futhark_mc_segred_task_128605_total_time;
                    futhark_mc_task_128604_task.task_iter = &ctx->program->futhark_mc_segred_task_128605_total_iter;
                    futhark_mc_task_128604_task.sched = STATIC;
                    futhark_mc_task_128604_task.nested_fn = futhark_mc_segred_nested_task_128615;
                    
                    int futhark_mc_segred_task_128605_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128604_task);
                    
                    if (futhark_mc_segred_task_128605_err != 0) {
                        err = futhark_mc_segred_task_128605_err;
                        goto cleanup;
                    }
                    
                    double zm_res_120553 = defunc_res_120456 - defunc_res_120455;
                    double zt_res_120554 = 2.0 * zm_res_120553;
                    double zt_res_120555 = 2.0 * defunc_res_120455;
                    int64_t flat_tid_120569 = (int64_t) 0;
                    int64_t flat_tid_120557 = (int64_t) 0;
                    struct futhark_mc_task_128637 futhark_mc_task_128637_;
                    
                    futhark_mc_task_128637_.ctx = ctx;
                    futhark_mc_task_128637_.free_m_33388 = m_33388;
                    futhark_mc_task_128637_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
                    futhark_mc_task_128637_.free_A_mem_111707 = A_mem_111707.mem;
                    futhark_mc_task_128637_.free_mem_112412 = mem_112412;
                    futhark_mc_task_128637_.free_mem_112427 = mem_112427;
                    
                    struct scheduler_segop futhark_mc_task_128637_task;
                    
                    futhark_mc_task_128637_task.args = &futhark_mc_task_128637_;
                    futhark_mc_task_128637_task.top_level_fn = futhark_mc_segmap_task_128638;
                    futhark_mc_task_128637_task.name = "futhark_mc_segmap_task_128638";
                    futhark_mc_task_128637_task.iterations = m_33388;
                    futhark_mc_task_128637_task.task_time = &ctx->program->futhark_mc_segmap_task_128638_total_time;
                    futhark_mc_task_128637_task.task_iter = &ctx->program->futhark_mc_segmap_task_128638_total_iter;
                    futhark_mc_task_128637_task.sched = STATIC;
                    futhark_mc_task_128637_task.nested_fn = futhark_mc_segmap_nested_task_128644;
                    
                    int futhark_mc_segmap_task_128638_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128637_task);
                    
                    if (futhark_mc_segmap_task_128638_err != 0) {
                        err = futhark_mc_segmap_task_128638_err;
                        goto cleanup;
                    }
                    
                    double zt_res_120579 = 2.0 * defunc_res_120453;
                    double zt_res_120580 = 2.0 * defunc_res_120454;
                    int64_t iterations_125337 = k_33387 * m_33388 * m_33388;
                    struct futhark_mc_task_128658 futhark_mc_task_128658_;
                    
                    futhark_mc_task_128658_.ctx = ctx;
                    futhark_mc_task_128658_.free_k_33387 = k_33387;
                    futhark_mc_task_128658_.free_m_33388 = m_33388;
                    futhark_mc_task_128658_.free_A_mem_111707 = A_mem_111707.mem;
                    futhark_mc_task_128658_.free_mem_112431 = mem_112431;
                    
                    struct scheduler_segop futhark_mc_task_128658_task;
                    
                    futhark_mc_task_128658_task.args = &futhark_mc_task_128658_;
                    futhark_mc_task_128658_task.top_level_fn = futhark_mc_copy_125336_task_128659;
                    futhark_mc_task_128658_task.name = "futhark_mc_copy_125336_task_128659";
                    futhark_mc_task_128658_task.iterations = iterations_125337;
                    futhark_mc_task_128658_task.task_time = &ctx->program->futhark_mc_copy_125336_task_128659_total_time;
                    futhark_mc_task_128658_task.task_iter = &ctx->program->futhark_mc_copy_125336_task_128659_total_iter;
                    futhark_mc_task_128658_task.sched = STATIC;
                    futhark_mc_task_128658_task.nested_fn = NULL;
                    
                    int futhark_mc_copy_125336_task_128659_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128658_task);
                    
                    if (futhark_mc_copy_125336_task_128659_err != 0) {
                        err = futhark_mc_copy_125336_task_128659_err;
                        goto cleanup;
                    }
                    
                    double defunc_res_120582;
                    double defunc_res_120583;
                    double defunc_res_120584;
                    double defunc_res_120585;
                    double defunc_res_120586;
                    int64_t flat_tid_120759 = (int64_t) 0;
                    
                    defunc_res_120582 = 0.0;
                    defunc_res_120583 = 0.0;
                    defunc_res_120584 = 0.0;
                    defunc_res_120585 = 0.0;
                    defunc_res_120586 = 0.0;
                    
                    int64_t flat_tid_120590 = (int64_t) 0;
                    struct futhark_mc_task_128665 futhark_mc_task_128665_;
                    
                    futhark_mc_task_128665_.ctx = ctx;
                    futhark_mc_task_128665_.free_m_33388 = m_33388;
                    futhark_mc_task_128665_.free_rho1_33389 = rho1_33389;
                    futhark_mc_task_128665_.free_rho2_33390 = rho2_33390;
                    futhark_mc_task_128665_.free_eps_33391 = eps_33391;
                    futhark_mc_task_128665_.free_eta_p_106382 = eta_p_106382;
                    futhark_mc_task_128665_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
                    futhark_mc_task_128665_.free_A_mem_111707 = A_mem_111707.mem;
                    futhark_mc_task_128665_.free_distrs_mem_111708 = distrs_mem_111708.mem;
                    futhark_mc_task_128665_.free_bytes_111715 = bytes_111715;
                    futhark_mc_task_128665_.free_mem_112403 = mem_112403;
                    futhark_mc_task_128665_.free_mem_112416 = mem_112416;
                    futhark_mc_task_128665_.free_mem_112421 = mem_112421;
                    futhark_mc_task_128665_.free_mem_112423 = mem_112423;
                    futhark_mc_task_128665_.free_mem_112425 = mem_112425;
                    futhark_mc_task_128665_.free_mem_112427 = mem_112427;
                    futhark_mc_task_128665_.free_mem_112431 = mem_112431;
                    futhark_mc_task_128665_.free_mem_param_118928 = mem_param_118928.mem;
                    futhark_mc_task_128665_.free_sqrt_res_120360 = sqrt_res_120360;
                    futhark_mc_task_128665_.free_zt_res_120554 = zt_res_120554;
                    futhark_mc_task_128665_.free_zt_res_120555 = zt_res_120555;
                    futhark_mc_task_128665_.free_zt_res_120579 = zt_res_120579;
                    futhark_mc_task_128665_.free_zt_res_120580 = zt_res_120580;
                    futhark_mc_task_128665_.free_flat_tid_120590 = flat_tid_120590;
                    futhark_mc_task_128665_.free_flat_tid_120759 = flat_tid_120759;
                    futhark_mc_task_128665_.retval_defunc_res_120582 = (double *) &defunc_res_120582;
                    #if ISPC
                    futhark_mc_task_128665_.retval_defunc_res_120582 += programIndex;
                    #endif
                    futhark_mc_task_128665_.retval_defunc_res_120583 = (double *) &defunc_res_120583;
                    #if ISPC
                    futhark_mc_task_128665_.retval_defunc_res_120583 += programIndex;
                    #endif
                    futhark_mc_task_128665_.retval_defunc_res_120584 = (double *) &defunc_res_120584;
                    #if ISPC
                    futhark_mc_task_128665_.retval_defunc_res_120584 += programIndex;
                    #endif
                    futhark_mc_task_128665_.retval_defunc_res_120585 = (double *) &defunc_res_120585;
                    #if ISPC
                    futhark_mc_task_128665_.retval_defunc_res_120585 += programIndex;
                    #endif
                    futhark_mc_task_128665_.retval_defunc_res_120586 = (double *) &defunc_res_120586;
                    #if ISPC
                    futhark_mc_task_128665_.retval_defunc_res_120586 += programIndex;
                    #endif
                    futhark_mc_task_128665_.retval_mem_112463 = mem_112463;
                    futhark_mc_task_128665_.retval_mem_112466 = mem_112466;
                    futhark_mc_task_128665_.retval_mem_in_114669 = mem_in_114669.mem;
                    
                    struct scheduler_segop futhark_mc_task_128665_task;
                    
                    futhark_mc_task_128665_task.args = &futhark_mc_task_128665_;
                    futhark_mc_task_128665_task.top_level_fn = futhark_mc_segred_task_128666;
                    futhark_mc_task_128665_task.name = "futhark_mc_segred_task_128666";
                    futhark_mc_task_128665_task.iterations = m_33388;
                    futhark_mc_task_128665_task.task_time = &ctx->program->futhark_mc_segred_task_128666_total_time;
                    futhark_mc_task_128665_task.task_iter = &ctx->program->futhark_mc_segred_task_128666_total_iter;
                    futhark_mc_task_128665_task.sched = STATIC;
                    futhark_mc_task_128665_task.nested_fn = futhark_mc_segred_nested_task_128680;
                    
                    int futhark_mc_segred_task_128666_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128665_task);
                    
                    if (futhark_mc_segred_task_128666_err != 0) {
                        err = futhark_mc_segred_task_128666_err;
                        goto cleanup;
                    }
                    
                    bool zl_res_120867 = defunc_res_120582 < 0.0;
                    bool assert_c_120868;
                    
                    if (!zl_res_120867) {
                        set_error(ctx, msgprintf("Error: %s\n\nBacktrace:\n%s", "Assertion is false: M.((gradient) M.< zero)", "-> #0  common.fut:220:7-221:22\n   #1  unbalanced_gw_core.fut:393:15-78\n   #2  unbalanced_gw_core.fut:402:7-11\n   #3  unbalanced_gw.fut:154:9-156:83\n   #4  /prelude/functional.fut:9:44-45\n   #5  unbalanced_gw.fut:152:6-156:84\n"));
                        err = FUTHARK_PROGRAM_ERROR;
                        goto cleanup;
                    }
                    
                    double defunc_res_120869;
                    int64_t flat_tid_120893 = (int64_t) 0;
                    
                    defunc_res_120869 = 0.0;
                    
                    int64_t flat_tid_120871 = (int64_t) 0;
                    struct futhark_mc_task_128766 futhark_mc_task_128766_;
                    
                    futhark_mc_task_128766_.ctx = ctx;
                    futhark_mc_task_128766_.free_m_33388 = m_33388;
                    futhark_mc_task_128766_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
                    futhark_mc_task_128766_.free_distrs_mem_111708 = distrs_mem_111708.mem;
                    futhark_mc_task_128766_.free_mem_112466 = mem_112466;
                    futhark_mc_task_128766_.free_flat_tid_120871 = flat_tid_120871;
                    futhark_mc_task_128766_.free_flat_tid_120893 = flat_tid_120893;
                    futhark_mc_task_128766_.retval_defunc_res_120869 = (double *) &defunc_res_120869;
                    #if ISPC
                    futhark_mc_task_128766_.retval_defunc_res_120869 += programIndex;
                    #endif
                    futhark_mc_task_128766_.retval_mem_112471 = mem_112471;
                    
                    struct scheduler_segop futhark_mc_task_128766_task;
                    
                    futhark_mc_task_128766_task.args = &futhark_mc_task_128766_;
                    futhark_mc_task_128766_task.top_level_fn = futhark_mc_segred_task_128767;
                    futhark_mc_task_128766_task.name = "futhark_mc_segred_task_128767";
                    futhark_mc_task_128766_task.iterations = m_33388;
                    futhark_mc_task_128766_task.task_time = &ctx->program->futhark_mc_segred_task_128767_total_time;
                    futhark_mc_task_128766_task.task_iter = &ctx->program->futhark_mc_segred_task_128767_total_iter;
                    futhark_mc_task_128766_task.sched = STATIC;
                    futhark_mc_task_128766_task.nested_fn = futhark_mc_segred_nested_task_128774;
                    
                    int futhark_mc_segred_task_128767_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128766_task);
                    
                    if (futhark_mc_segred_task_128767_err != 0) {
                        err = futhark_mc_segred_task_128767_err;
                        goto cleanup;
                    }
                    
                    double defunc_0_reduce_res_120912;
                    double defunc_res_120913;
                    int64_t flat_tid_120987 = (int64_t) 0;
                    
                    defunc_0_reduce_res_120912 = 0.0;
                    defunc_res_120913 = 0.0;
                    
                    int64_t flat_tid_120914 = (int64_t) 0;
                    struct futhark_mc_task_128790 futhark_mc_task_128790_;
                    
                    futhark_mc_task_128790_.ctx = ctx;
                    futhark_mc_task_128790_.free_m_33388 = m_33388;
                    futhark_mc_task_128790_.free_eta_p_106382 = eta_p_106382;
                    futhark_mc_task_128790_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
                    futhark_mc_task_128790_.free_A_mem_111707 = A_mem_111707.mem;
                    futhark_mc_task_128790_.free_bytes_111715 = bytes_111715;
                    futhark_mc_task_128790_.free_mem_112431 = mem_112431;
                    futhark_mc_task_128790_.free_mem_112463 = mem_112463;
                    futhark_mc_task_128790_.free_mem_112466 = mem_112466;
                    futhark_mc_task_128790_.free_flat_tid_120914 = flat_tid_120914;
                    futhark_mc_task_128790_.free_flat_tid_120987 = flat_tid_120987;
                    futhark_mc_task_128790_.retval_defunc_0_reduce_res_120912 = (double *) &defunc_0_reduce_res_120912;
                    #if ISPC
                    futhark_mc_task_128790_.retval_defunc_0_reduce_res_120912 += programIndex;
                    #endif
                    futhark_mc_task_128790_.retval_defunc_res_120913 = (double *) &defunc_res_120913;
                    #if ISPC
                    futhark_mc_task_128790_.retval_defunc_res_120913 += programIndex;
                    #endif
                    
                    struct scheduler_segop futhark_mc_task_128790_task;
                    
                    futhark_mc_task_128790_task.args = &futhark_mc_task_128790_;
                    futhark_mc_task_128790_task.top_level_fn = futhark_mc_segred_task_128791;
                    futhark_mc_task_128790_task.name = "futhark_mc_segred_task_128791";
                    futhark_mc_task_128790_task.iterations = m_33388;
                    futhark_mc_task_128790_task.task_time = &ctx->program->futhark_mc_segred_task_128791_total_time;
                    futhark_mc_task_128790_task.task_iter = &ctx->program->futhark_mc_segred_task_128791_total_iter;
                    futhark_mc_task_128790_task.sched = STATIC;
                    futhark_mc_task_128790_task.nested_fn = futhark_mc_segred_nested_task_128800;
                    
                    int futhark_mc_segred_task_128791_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128790_task);
                    
                    if (futhark_mc_segred_task_128791_err != 0) {
                        err = futhark_mc_segred_task_128791_err;
                        goto cleanup;
                    }
                    
                    double defunc_0_reduce_res_121031;
                    int64_t flat_tid_121049 = (int64_t) 0;
                    
                    defunc_0_reduce_res_121031 = 0.0;
                    
                    int64_t flat_tid_121032 = (int64_t) 0;
                    struct futhark_mc_task_128861 futhark_mc_task_128861_;
                    
                    futhark_mc_task_128861_.ctx = ctx;
                    futhark_mc_task_128861_.free_m_33388 = m_33388;
                    futhark_mc_task_128861_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
                    futhark_mc_task_128861_.free_A_mem_111707 = A_mem_111707.mem;
                    futhark_mc_task_128861_.free_mem_112471 = mem_112471;
                    futhark_mc_task_128861_.free_flat_tid_121032 = flat_tid_121032;
                    futhark_mc_task_128861_.free_flat_tid_121049 = flat_tid_121049;
                    futhark_mc_task_128861_.retval_defunc_0_reduce_res_121031 = (double *) &defunc_0_reduce_res_121031;
                    #if ISPC
                    futhark_mc_task_128861_.retval_defunc_0_reduce_res_121031 += programIndex;
                    #endif
                    
                    struct scheduler_segop futhark_mc_task_128861_task;
                    
                    futhark_mc_task_128861_task.args = &futhark_mc_task_128861_;
                    futhark_mc_task_128861_task.top_level_fn = futhark_mc_segred_task_128862;
                    futhark_mc_task_128861_task.name = "futhark_mc_segred_task_128862";
                    futhark_mc_task_128861_task.iterations = m_33388;
                    futhark_mc_task_128861_task.task_time = &ctx->program->futhark_mc_segred_task_128862_total_time;
                    futhark_mc_task_128861_task.task_iter = &ctx->program->futhark_mc_segred_task_128862_total_iter;
                    futhark_mc_task_128861_task.sched = STATIC;
                    futhark_mc_task_128861_task.nested_fn = futhark_mc_segred_nested_task_128869;
                    
                    int futhark_mc_segred_task_128862_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128861_task);
                    
                    if (futhark_mc_segred_task_128862_err != 0) {
                        err = futhark_mc_segred_task_128862_err;
                        goto cleanup;
                    }
                    
                    double zt_res_121064 = -2.0 * defunc_res_120913;
                    double zp_res_121065 = defunc_0_reduce_res_120912 + zt_res_121064;
                    double zp_res_121066 = defunc_0_reduce_res_121031 + zp_res_121065;
                    double zt_res_121067 = eps_33391 * defunc_res_120585;
                    double zt_res_121068 = rho1_33389 * defunc_res_120583;
                    double zt_res_121069 = rho2_33390 * defunc_res_120869;
                    double zp_res_121070 = zt_res_121067 + zt_res_121068;
                    double zp_res_121071 = zt_res_121069 + zp_res_121070;
                    double zt_res_121072 = 2.0 * zp_res_121071;
                    double zt_res_121073 = defunc_res_120584 * zt_res_121072;
                    double zp_res_121074 = zp_res_121066 + zt_res_121073;
                    double zt_res_121075 = defunc_res_120584 * defunc_res_120584;
                    double zt_res_121076 = zp_res_46827 * zt_res_121075;
                    double zm_res_121077 = zp_res_121074 - zt_res_121076;
                    double zt_res_121078 = defunc_res_120372 * defunc_res_120586;
                    double zt_res_121079 = rho1_33389 * defunc_res_120586;
                    double zt_res_121080 = defunc_res_120586 * zt_res_121079;
                    double zt_res_121081 = rho2_33390 * defunc_res_120372;
                    double zt_res_121082 = defunc_res_120372 * zt_res_121081;
                    double zp_res_121083 = zt_res_121080 + zt_res_121082;
                    double zt_res_121084 = eps_33391 * zt_res_121078;
                    double zt_res_121085 = zt_res_121078 * zt_res_121084;
                    double zp_res_121086 = zp_res_121083 + zt_res_121085;
                    double zp_res_121087 = zm_res_121077 + zp_res_121086;
                    double zm_res_121088 = zp_res_121087 - loss_118933;
                    bool zgze_res_121089 = -1.0 <= zm_res_121088;
                    double zs_res_121090 = zm_res_121088 / defunc_res_120582;
                    bool zlze_res_121091 = zs_res_121090 <= 0.5;
                    bool x_121092 = zgze_res_121089 && zlze_res_121091;
                    bool defunc_0_armijo_line_search_res_121096;
                    double defunc_0_armijo_line_search_res_121098;
                    double defunc_0_armijo_line_search_res_121099;
                    bool loop_while_121102;
                    double current_loss_121104;
                    double alpha_121105;
                    
                    if (memblock_set(ctx, &mem_param_121100, &mem_in_114669, "mem_in_114669") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_out_121101, &mem_112513, "mem_112513") != 0)
                        return 1;
                    loop_while_121102 = x_121092;
                    current_loss_121104 = zp_res_121087;
                    alpha_121105 = 1.0;
                    while (loop_while_121102) {
                        double zt_res_121106 = 0.5 * alpha_121105;
                        double defunc_res_121107;
                        double defunc_res_121108;
                        double defunc_res_121109;
                        int64_t flat_tid_121159 = (int64_t) 0;
                        
                        defunc_res_121107 = 0.0;
                        defunc_res_121108 = 0.0;
                        defunc_res_121109 = 0.0;
                        
                        int64_t flat_tid_121113 = (int64_t) 0;
                        struct futhark_mc_task_128884 futhark_mc_task_128884_;
                        
                        futhark_mc_task_128884_.ctx = ctx;
                        futhark_mc_task_128884_.free_m_33388 = m_33388;
                        futhark_mc_task_128884_.free_eta_p_106382 = eta_p_106382;
                        futhark_mc_task_128884_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
                        futhark_mc_task_128884_.free_distrs_mem_111708 = distrs_mem_111708.mem;
                        futhark_mc_task_128884_.free_bytes_111715 = bytes_111715;
                        futhark_mc_task_128884_.free_mem_param_118928 = mem_param_118928.mem;
                        futhark_mc_task_128884_.free_mem_param_121100 = mem_param_121100.mem;
                        futhark_mc_task_128884_.free_flat_tid_121113 = flat_tid_121113;
                        futhark_mc_task_128884_.free_flat_tid_121159 = flat_tid_121159;
                        futhark_mc_task_128884_.retval_defunc_res_121107 = (double *) &defunc_res_121107;
                        #if ISPC
                        futhark_mc_task_128884_.retval_defunc_res_121107 += programIndex;
                        #endif
                        futhark_mc_task_128884_.retval_defunc_res_121108 = (double *) &defunc_res_121108;
                        #if ISPC
                        futhark_mc_task_128884_.retval_defunc_res_121108 += programIndex;
                        #endif
                        futhark_mc_task_128884_.retval_defunc_res_121109 = (double *) &defunc_res_121109;
                        #if ISPC
                        futhark_mc_task_128884_.retval_defunc_res_121109 += programIndex;
                        #endif
                        futhark_mc_task_128884_.retval_mem_112507 = mem_112507;
                        futhark_mc_task_128884_.retval_mem_112510 = mem_112510;
                        futhark_mc_task_128884_.retval_mem_param_out_121101 = mem_param_out_121101.mem;
                        
                        struct scheduler_segop futhark_mc_task_128884_task;
                        
                        futhark_mc_task_128884_task.args = &futhark_mc_task_128884_;
                        futhark_mc_task_128884_task.top_level_fn = futhark_mc_segred_task_128885;
                        futhark_mc_task_128884_task.name = "futhark_mc_segred_task_128885";
                        futhark_mc_task_128884_task.iterations = m_33388;
                        futhark_mc_task_128884_task.task_time = &ctx->program->futhark_mc_segred_task_128885_total_time;
                        futhark_mc_task_128884_task.task_iter = &ctx->program->futhark_mc_segred_task_128885_total_iter;
                        futhark_mc_task_128884_task.sched = STATIC;
                        futhark_mc_task_128884_task.nested_fn = futhark_mc_segred_nested_task_128896;
                        
                        int futhark_mc_segred_task_128885_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128884_task);
                        
                        if (futhark_mc_segred_task_128885_err != 0) {
                            err = futhark_mc_segred_task_128885_err;
                            goto cleanup;
                        }
                        
                        double defunc_res_121207;
                        int64_t flat_tid_121231 = (int64_t) 0;
                        
                        defunc_res_121207 = 0.0;
                        
                        int64_t flat_tid_121209 = (int64_t) 0;
                        struct futhark_mc_task_128931 futhark_mc_task_128931_;
                        
                        futhark_mc_task_128931_.ctx = ctx;
                        futhark_mc_task_128931_.free_m_33388 = m_33388;
                        futhark_mc_task_128931_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
                        futhark_mc_task_128931_.free_distrs_mem_111708 = distrs_mem_111708.mem;
                        futhark_mc_task_128931_.free_mem_112510 = mem_112510;
                        futhark_mc_task_128931_.free_flat_tid_121209 = flat_tid_121209;
                        futhark_mc_task_128931_.free_flat_tid_121231 = flat_tid_121231;
                        futhark_mc_task_128931_.retval_defunc_res_121207 = (double *) &defunc_res_121207;
                        #if ISPC
                        futhark_mc_task_128931_.retval_defunc_res_121207 += programIndex;
                        #endif
                        futhark_mc_task_128931_.retval_mem_112515 = mem_112515;
                        
                        struct scheduler_segop futhark_mc_task_128931_task;
                        
                        futhark_mc_task_128931_task.args = &futhark_mc_task_128931_;
                        futhark_mc_task_128931_task.top_level_fn = futhark_mc_segred_task_128932;
                        futhark_mc_task_128931_task.name = "futhark_mc_segred_task_128932";
                        futhark_mc_task_128931_task.iterations = m_33388;
                        futhark_mc_task_128931_task.task_time = &ctx->program->futhark_mc_segred_task_128932_total_time;
                        futhark_mc_task_128931_task.task_iter = &ctx->program->futhark_mc_segred_task_128932_total_iter;
                        futhark_mc_task_128931_task.sched = STATIC;
                        futhark_mc_task_128931_task.nested_fn = futhark_mc_segred_nested_task_128939;
                        
                        int futhark_mc_segred_task_128932_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128931_task);
                        
                        if (futhark_mc_segred_task_128932_err != 0) {
                            err = futhark_mc_segred_task_128932_err;
                            goto cleanup;
                        }
                        
                        double defunc_0_reduce_res_121250;
                        double defunc_res_121251;
                        int64_t flat_tid_121325 = (int64_t) 0;
                        
                        defunc_0_reduce_res_121250 = 0.0;
                        defunc_res_121251 = 0.0;
                        
                        int64_t flat_tid_121252 = (int64_t) 0;
                        struct futhark_mc_task_128955 futhark_mc_task_128955_;
                        
                        futhark_mc_task_128955_.ctx = ctx;
                        futhark_mc_task_128955_.free_m_33388 = m_33388;
                        futhark_mc_task_128955_.free_eta_p_106382 = eta_p_106382;
                        futhark_mc_task_128955_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
                        futhark_mc_task_128955_.free_A_mem_111707 = A_mem_111707.mem;
                        futhark_mc_task_128955_.free_bytes_111715 = bytes_111715;
                        futhark_mc_task_128955_.free_mem_112431 = mem_112431;
                        futhark_mc_task_128955_.free_mem_112507 = mem_112507;
                        futhark_mc_task_128955_.free_mem_112510 = mem_112510;
                        futhark_mc_task_128955_.free_flat_tid_121252 = flat_tid_121252;
                        futhark_mc_task_128955_.free_flat_tid_121325 = flat_tid_121325;
                        futhark_mc_task_128955_.retval_defunc_0_reduce_res_121250 = (double *) &defunc_0_reduce_res_121250;
                        #if ISPC
                        futhark_mc_task_128955_.retval_defunc_0_reduce_res_121250 += programIndex;
                        #endif
                        futhark_mc_task_128955_.retval_defunc_res_121251 = (double *) &defunc_res_121251;
                        #if ISPC
                        futhark_mc_task_128955_.retval_defunc_res_121251 += programIndex;
                        #endif
                        
                        struct scheduler_segop futhark_mc_task_128955_task;
                        
                        futhark_mc_task_128955_task.args = &futhark_mc_task_128955_;
                        futhark_mc_task_128955_task.top_level_fn = futhark_mc_segred_task_128956;
                        futhark_mc_task_128955_task.name = "futhark_mc_segred_task_128956";
                        futhark_mc_task_128955_task.iterations = m_33388;
                        futhark_mc_task_128955_task.task_time = &ctx->program->futhark_mc_segred_task_128956_total_time;
                        futhark_mc_task_128955_task.task_iter = &ctx->program->futhark_mc_segred_task_128956_total_iter;
                        futhark_mc_task_128955_task.sched = STATIC;
                        futhark_mc_task_128955_task.nested_fn = futhark_mc_segred_nested_task_128965;
                        
                        int futhark_mc_segred_task_128956_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_128955_task);
                        
                        if (futhark_mc_segred_task_128956_err != 0) {
                            err = futhark_mc_segred_task_128956_err;
                            goto cleanup;
                        }
                        
                        double defunc_0_reduce_res_121369;
                        int64_t flat_tid_121387 = (int64_t) 0;
                        
                        defunc_0_reduce_res_121369 = 0.0;
                        
                        int64_t flat_tid_121370 = (int64_t) 0;
                        struct futhark_mc_task_129026 futhark_mc_task_129026_;
                        
                        futhark_mc_task_129026_.ctx = ctx;
                        futhark_mc_task_129026_.free_m_33388 = m_33388;
                        futhark_mc_task_129026_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
                        futhark_mc_task_129026_.free_A_mem_111707 = A_mem_111707.mem;
                        futhark_mc_task_129026_.free_mem_112515 = mem_112515;
                        futhark_mc_task_129026_.free_flat_tid_121370 = flat_tid_121370;
                        futhark_mc_task_129026_.free_flat_tid_121387 = flat_tid_121387;
                        futhark_mc_task_129026_.retval_defunc_0_reduce_res_121369 = (double *) &defunc_0_reduce_res_121369;
                        #if ISPC
                        futhark_mc_task_129026_.retval_defunc_0_reduce_res_121369 += programIndex;
                        #endif
                        
                        struct scheduler_segop futhark_mc_task_129026_task;
                        
                        futhark_mc_task_129026_task.args = &futhark_mc_task_129026_;
                        futhark_mc_task_129026_task.top_level_fn = futhark_mc_segred_task_129027;
                        futhark_mc_task_129026_task.name = "futhark_mc_segred_task_129027";
                        futhark_mc_task_129026_task.iterations = m_33388;
                        futhark_mc_task_129026_task.task_time = &ctx->program->futhark_mc_segred_task_129027_total_time;
                        futhark_mc_task_129026_task.task_iter = &ctx->program->futhark_mc_segred_task_129027_total_iter;
                        futhark_mc_task_129026_task.sched = STATIC;
                        futhark_mc_task_129026_task.nested_fn = futhark_mc_segred_nested_task_129034;
                        
                        int futhark_mc_segred_task_129027_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_129026_task);
                        
                        if (futhark_mc_segred_task_129027_err != 0) {
                            err = futhark_mc_segred_task_129027_err;
                            goto cleanup;
                        }
                        
                        double zt_res_121402 = -2.0 * defunc_res_121251;
                        double zp_res_121403 = defunc_0_reduce_res_121250 + zt_res_121402;
                        double zp_res_121404 = defunc_0_reduce_res_121369 + zp_res_121403;
                        double zt_res_121405 = eps_33391 * defunc_res_121109;
                        double zt_res_121406 = rho1_33389 * defunc_res_121107;
                        double zt_res_121407 = rho2_33390 * defunc_res_121207;
                        double zp_res_121408 = zt_res_121405 + zt_res_121406;
                        double zp_res_121409 = zt_res_121407 + zp_res_121408;
                        double zt_res_121410 = 2.0 * zp_res_121409;
                        double zt_res_121411 = defunc_res_121108 * zt_res_121410;
                        double zp_res_121412 = zp_res_121404 + zt_res_121411;
                        double zt_res_121413 = defunc_res_121108 * defunc_res_121108;
                        double zt_res_121414 = zp_res_46827 * zt_res_121413;
                        double zm_res_121415 = zp_res_121412 - zt_res_121414;
                        double zp_res_121416 = zp_res_109598 + zm_res_121415;
                        double zm_res_121417 = zp_res_121416 - loss_118933;
                        bool zgze_res_121418 = -1.0 <= zm_res_121417;
                        double zt_res_121419 = defunc_res_120582 * zt_res_121106;
                        double zs_res_121420 = zm_res_121417 / zt_res_121419;
                        bool zlze_res_121421 = zs_res_121420 <= 0.5;
                        bool zg_res_121422 = 1.0e-50 < zt_res_121106;
                        bool x_121423 = zlze_res_121421 && zg_res_121422;
                        bool x_121424 = zgze_res_121418 && x_121423;
                        
                        if (memblock_set(ctx, &mem_param_tmp_125946, &mem_param_out_121101, "mem_param_out_121101") != 0)
                            return 1;
                        if (memblock_set(ctx, &mem_param_out_tmp_125947, &mem_param_121100, "mem_param_121100") != 0)
                            return 1;
                        
                        bool loop_while_tmp_125948 = x_121424;
                        double current_loss_tmp_125950 = zp_res_121416;
                        double alpha_tmp_125951 = zt_res_121106;
                        
                        if (memblock_set(ctx, &mem_param_121100, &mem_param_tmp_125946, "mem_param_tmp_125946") != 0)
                            return 1;
                        if (memblock_set(ctx, &mem_param_out_121101, &mem_param_out_tmp_125947, "mem_param_out_tmp_125947") != 0)
                            return 1;
                        loop_while_121102 = loop_while_tmp_125948;
                        current_loss_121104 = current_loss_tmp_125950;
                        alpha_121105 = alpha_tmp_125951;
                    }
                    if (memblock_set(ctx, &ext_mem_121094, &mem_param_121100, "mem_param_121100") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_unused_121095, &mem_param_out_121101, "mem_param_out_121101") != 0)
                        return 1;
                    defunc_0_armijo_line_search_res_121096 = loop_while_121102;
                    defunc_0_armijo_line_search_res_121098 = current_loss_121104;
                    defunc_0_armijo_line_search_res_121099 = alpha_121105;
                    
                    int64_t flat_tid_121434 = (int64_t) 0;
                    int64_t flat_tid_121426 = (int64_t) 0;
                    struct futhark_mc_task_129049 futhark_mc_task_129049_;
                    
                    futhark_mc_task_129049_.ctx = ctx;
                    futhark_mc_task_129049_.free_m_33388 = m_33388;
                    futhark_mc_task_129049_.free_mem_param_118928 = mem_param_118928.mem;
                    futhark_mc_task_129049_.free_mem_120363 = mem_120363.mem;
                    futhark_mc_task_129049_.free_ext_mem_121094 = ext_mem_121094.mem;
                    
                    struct scheduler_segop futhark_mc_task_129049_task;
                    
                    futhark_mc_task_129049_task.args = &futhark_mc_task_129049_;
                    futhark_mc_task_129049_task.top_level_fn = futhark_mc_segmap_task_129050;
                    futhark_mc_task_129049_task.name = "futhark_mc_segmap_task_129050";
                    futhark_mc_task_129049_task.iterations = m_33388;
                    futhark_mc_task_129049_task.task_time = &ctx->program->futhark_mc_segmap_task_129050_total_time;
                    futhark_mc_task_129049_task.task_iter = &ctx->program->futhark_mc_segmap_task_129050_total_iter;
                    futhark_mc_task_129049_task.sched = STATIC;
                    futhark_mc_task_129049_task.nested_fn = futhark_mc_segmap_nested_task_129056;
                    
                    int futhark_mc_segmap_task_129050_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_129049_task);
                    
                    if (futhark_mc_segmap_task_129050_err != 0) {
                        err = futhark_mc_segmap_task_129050_err;
                        goto cleanup;
                    }
                    if (memblock_unref(ctx, &ext_mem_121094, "ext_mem_121094") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_120364, &mem_120302, "mem_120302") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_120365, &mem_120301, "mem_120301") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_120366, &mem_120363, "mem_120363") != 0)
                        return 1;
                    descent_res_120370 = defunc_0_armijo_line_search_res_121098;
                } else {
                    for (int64_t nest_i_126410 = 0; nest_i_126410 < m_33388; nest_i_126410++) {
                        ((double *) mem_120361.mem)[nest_i_126410] = 0.0;
                    }
                    for (int64_t nest_i_126411 = 0; nest_i_126411 < m_33388; nest_i_126411++) {
                        for (int64_t nest_i_126412 = 0; nest_i_126412 < m_33388; nest_i_126412++) {
                            ((double *) mem_120362.mem)[nest_i_126411 * m_33388 + nest_i_126412] = 0.0;
                        }
                    }
                    if (memblock_set(ctx, &ext_mem_120364, &mem_120361, "mem_120361") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_120365, &mem_120361, "mem_120361") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_120366, &mem_120362, "mem_120362") != 0)
                        return 1;
                    descent_res_120370 = 0.0;
                }
                if (memblock_unref(ctx, &mem_120301, "mem_120301") != 0)
                    return 1;
                if (memblock_unref(ctx, &mem_120302, "mem_120302") != 0)
                    return 1;
                if (memblock_unref(ctx, &mem_120361, "mem_120361") != 0)
                    return 1;
                if (memblock_unref(ctx, &mem_120362, "mem_120362") != 0)
                    return 1;
                if (memblock_unref(ctx, &mem_120363, "mem_120363") != 0)
                    return 1;
                
                bool defunc_0_reduce_comm_res_121446;
                int64_t flat_tid_121466 = (int64_t) 0;
                
                defunc_0_reduce_comm_res_121446 = 0;
                
                int64_t flat_tid_121447 = (int64_t) 0;
                struct futhark_mc_task_129069 futhark_mc_task_129069_;
                
                futhark_mc_task_129069_.ctx = ctx;
                futhark_mc_task_129069_.free_m_33388 = m_33388;
                futhark_mc_task_129069_.free_zp_res_43884 = zp_res_43884;
                futhark_mc_task_129069_.free_mem_param_118928 = mem_param_118928.mem;
                futhark_mc_task_129069_.free_ext_mem_120366 = ext_mem_120366.mem;
                futhark_mc_task_129069_.free_flat_tid_121447 = flat_tid_121447;
                futhark_mc_task_129069_.free_flat_tid_121466 = flat_tid_121466;
                futhark_mc_task_129069_.retval_defunc_0_reduce_comm_res_121446 = (bool *) &defunc_0_reduce_comm_res_121446;
                #if ISPC
                futhark_mc_task_129069_.retval_defunc_0_reduce_comm_res_121446 += programIndex;
                #endif
                
                struct scheduler_segop futhark_mc_task_129069_task;
                
                futhark_mc_task_129069_task.args = &futhark_mc_task_129069_;
                futhark_mc_task_129069_task.top_level_fn = futhark_mc_segred_task_129070;
                futhark_mc_task_129069_task.name = "futhark_mc_segred_task_129070";
                futhark_mc_task_129069_task.iterations = m_33388;
                futhark_mc_task_129069_task.task_time = &ctx->program->futhark_mc_segred_task_129070_total_time;
                futhark_mc_task_129069_task.task_iter = &ctx->program->futhark_mc_segred_task_129070_total_iter;
                futhark_mc_task_129069_task.sched = STATIC;
                futhark_mc_task_129069_task.nested_fn = futhark_mc_segred_nested_task_129077;
                
                int futhark_mc_segred_task_129070_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_129069_task);
                
                if (futhark_mc_segred_task_129070_err != 0) {
                    err = futhark_mc_segred_task_129070_err;
                    goto cleanup;
                }
                
                bool defunc_0_reduce_res_121483;
                int64_t flat_tid_121497 = (int64_t) 0;
                
                defunc_0_reduce_res_121483 = 0;
                
                int64_t flat_tid_121484 = (int64_t) 0;
                struct futhark_mc_task_129092 futhark_mc_task_129092_;
                
                futhark_mc_task_129092_.ctx = ctx;
                futhark_mc_task_129092_.free_m_33388 = m_33388;
                futhark_mc_task_129092_.free_ext_mem_120366 = ext_mem_120366.mem;
                futhark_mc_task_129092_.free_flat_tid_121484 = flat_tid_121484;
                futhark_mc_task_129092_.free_flat_tid_121497 = flat_tid_121497;
                futhark_mc_task_129092_.retval_defunc_0_reduce_res_121483 = (bool *) &defunc_0_reduce_res_121483;
                #if ISPC
                futhark_mc_task_129092_.retval_defunc_0_reduce_res_121483 += programIndex;
                #endif
                
                struct scheduler_segop futhark_mc_task_129092_task;
                
                futhark_mc_task_129092_task.args = &futhark_mc_task_129092_;
                futhark_mc_task_129092_task.top_level_fn = futhark_mc_segred_task_129093;
                futhark_mc_task_129092_task.name = "futhark_mc_segred_task_129093";
                futhark_mc_task_129092_task.iterations = m_33388;
                futhark_mc_task_129092_task.task_time = &ctx->program->futhark_mc_segred_task_129093_total_time;
                futhark_mc_task_129092_task.task_iter = &ctx->program->futhark_mc_segred_task_129093_total_iter;
                futhark_mc_task_129092_task.sched = STATIC;
                futhark_mc_task_129092_task.nested_fn = futhark_mc_segred_nested_task_129100;
                
                int futhark_mc_segred_task_129093_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_129092_task);
                
                if (futhark_mc_segred_task_129093_err != 0) {
                    err = futhark_mc_segred_task_129093_err;
                    goto cleanup;
                }
                
                bool x_121508 = defunc_0_reduce_comm_res_121446 && defunc_0_reduce_res_121483;
                
                if (memblock_set(ctx, &mem_param_tmp_123455, &ext_mem_120364, "ext_mem_120364") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_123456, &ext_mem_120365, "ext_mem_120365") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_123457, &ext_mem_120366, "ext_mem_120366") != 0)
                    return 1;
                
                bool loop_while_tmp_123458 = x_121508;
                double loss_tmp_123462 = descent_res_120370;
                
                if (memblock_set(ctx, &mem_param_118926, &mem_param_tmp_123455, "mem_param_tmp_123455") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_118927, &mem_param_tmp_123456, "mem_param_tmp_123456") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_118928, &mem_param_tmp_123457, "mem_param_tmp_123457") != 0)
                    return 1;
                loop_while_118929 = loop_while_tmp_123458;
                loss_118933 = loss_tmp_123462;
            }
            if (memblock_set(ctx, &ext_mem_112555, &mem_param_118926, "mem_param_118926") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_112554, &mem_param_118927, "mem_param_118927") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_112553, &mem_param_118928, "mem_param_118928") != 0)
                return 1;
            final_plan_107550 = loop_while_118929;
            final_plan_107554 = loss_118933;
            
            double defunc_res_110023;
            double defunc_res_110024;
            double defunc_res_110025;
            double defunc_res_110026;
            double defunc_res_110027;
            int64_t flat_tid_121651 = (int64_t) 0;
            
            defunc_res_110023 = 0.0;
            defunc_res_110024 = 0.0;
            defunc_res_110025 = 0.0;
            defunc_res_110026 = 0.0;
            defunc_res_110027 = 0.0;
            
            int64_t flat_tid_121509 = (int64_t) 0;
            struct futhark_mc_task_129115 futhark_mc_task_129115_;
            
            futhark_mc_task_129115_.ctx = ctx;
            futhark_mc_task_129115_.free_m_33388 = m_33388;
            futhark_mc_task_129115_.free_eta_p_106382 = eta_p_106382;
            futhark_mc_task_129115_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
            futhark_mc_task_129115_.free_A_mem_111707 = A_mem_111707.mem;
            futhark_mc_task_129115_.free_distrs_mem_111708 = distrs_mem_111708.mem;
            futhark_mc_task_129115_.free_bytes_111715 = bytes_111715;
            futhark_mc_task_129115_.free_mem_111727 = mem_111727.mem;
            futhark_mc_task_129115_.free_ext_mem_112553 = ext_mem_112553.mem;
            futhark_mc_task_129115_.free_flat_tid_121509 = flat_tid_121509;
            futhark_mc_task_129115_.free_flat_tid_121651 = flat_tid_121651;
            futhark_mc_task_129115_.retval_defunc_res_110023 = (double *) &defunc_res_110023;
            #if ISPC
            futhark_mc_task_129115_.retval_defunc_res_110023 += programIndex;
            #endif
            futhark_mc_task_129115_.retval_defunc_res_110024 = (double *) &defunc_res_110024;
            #if ISPC
            futhark_mc_task_129115_.retval_defunc_res_110024 += programIndex;
            #endif
            futhark_mc_task_129115_.retval_defunc_res_110025 = (double *) &defunc_res_110025;
            #if ISPC
            futhark_mc_task_129115_.retval_defunc_res_110025 += programIndex;
            #endif
            futhark_mc_task_129115_.retval_defunc_res_110026 = (double *) &defunc_res_110026;
            #if ISPC
            futhark_mc_task_129115_.retval_defunc_res_110026 += programIndex;
            #endif
            futhark_mc_task_129115_.retval_defunc_res_110027 = (double *) &defunc_res_110027;
            #if ISPC
            futhark_mc_task_129115_.retval_defunc_res_110027 += programIndex;
            #endif
            futhark_mc_task_129115_.retval_mem_112567 = mem_112567;
            futhark_mc_task_129115_.retval_mem_112569 = mem_112569;
            futhark_mc_task_129115_.retval_mem_112571 = mem_112571;
            
            struct scheduler_segop futhark_mc_task_129115_task;
            
            futhark_mc_task_129115_task.args = &futhark_mc_task_129115_;
            futhark_mc_task_129115_task.top_level_fn = futhark_mc_segred_task_129116;
            futhark_mc_task_129115_task.name = "futhark_mc_segred_task_129116";
            futhark_mc_task_129115_task.iterations = m_33388;
            futhark_mc_task_129115_task.task_time = &ctx->program->futhark_mc_segred_task_129116_total_time;
            futhark_mc_task_129115_task.task_iter = &ctx->program->futhark_mc_segred_task_129116_total_iter;
            futhark_mc_task_129115_task.sched = STATIC;
            futhark_mc_task_129115_task.nested_fn = futhark_mc_segred_nested_task_129128;
            
            int futhark_mc_segred_task_129116_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_129115_task);
            
            if (futhark_mc_segred_task_129116_err != 0) {
                err = futhark_mc_segred_task_129116_err;
                goto cleanup;
            }
            
            int64_t flat_tid_121744 = (int64_t) 0;
            int64_t flat_tid_121727 = (int64_t) 0;
            struct futhark_mc_task_129198 futhark_mc_task_129198_;
            
            futhark_mc_task_129198_.ctx = ctx;
            futhark_mc_task_129198_.free_m_33388 = m_33388;
            futhark_mc_task_129198_.free_ext_mem_112553 = ext_mem_112553.mem;
            futhark_mc_task_129198_.free_mem_112573 = mem_112573;
            futhark_mc_task_129198_.free_mem_112575 = mem_112575;
            futhark_mc_task_129198_.free_mem_112577 = mem_112577;
            
            struct scheduler_segop futhark_mc_task_129198_task;
            
            futhark_mc_task_129198_task.args = &futhark_mc_task_129198_;
            futhark_mc_task_129198_task.top_level_fn = futhark_mc_segmap_task_129199;
            futhark_mc_task_129198_task.name = "futhark_mc_segmap_task_129199";
            futhark_mc_task_129198_task.iterations = m_33388;
            futhark_mc_task_129198_task.task_time = &ctx->program->futhark_mc_segmap_task_129199_total_time;
            futhark_mc_task_129198_task.task_iter = &ctx->program->futhark_mc_segmap_task_129199_total_iter;
            futhark_mc_task_129198_task.sched = STATIC;
            futhark_mc_task_129198_task.nested_fn = futhark_mc_segmap_nested_task_129205;
            
            int futhark_mc_segmap_task_129199_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_129198_task);
            
            if (futhark_mc_segmap_task_129199_err != 0) {
                err = futhark_mc_segmap_task_129199_err;
                goto cleanup;
            }
            
            double defunc_0_reduce_res_110297;
            int64_t flat_tid_121774 = (int64_t) 0;
            
            defunc_0_reduce_res_110297 = 0.0;
            
            int64_t flat_tid_121757 = (int64_t) 0;
            struct futhark_mc_task_129221 futhark_mc_task_129221_;
            
            futhark_mc_task_129221_.ctx = ctx;
            futhark_mc_task_129221_.free_m_33388 = m_33388;
            futhark_mc_task_129221_.free_eta_p_106382 = eta_p_106382;
            futhark_mc_task_129221_.free_A_mem_111707 = A_mem_111707.mem;
            futhark_mc_task_129221_.free_mem_112571 = mem_112571;
            futhark_mc_task_129221_.free_flat_tid_121757 = flat_tid_121757;
            futhark_mc_task_129221_.free_flat_tid_121774 = flat_tid_121774;
            futhark_mc_task_129221_.retval_defunc_0_reduce_res_110297 = (double *) &defunc_0_reduce_res_110297;
            #if ISPC
            futhark_mc_task_129221_.retval_defunc_0_reduce_res_110297 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_129221_task;
            
            futhark_mc_task_129221_task.args = &futhark_mc_task_129221_;
            futhark_mc_task_129221_task.top_level_fn = futhark_mc_segred_task_129222;
            futhark_mc_task_129221_task.name = "futhark_mc_segred_task_129222";
            futhark_mc_task_129221_task.iterations = m_33388;
            futhark_mc_task_129221_task.task_time = &ctx->program->futhark_mc_segred_task_129222_total_time;
            futhark_mc_task_129221_task.task_iter = &ctx->program->futhark_mc_segred_task_129222_total_iter;
            futhark_mc_task_129221_task.sched = STATIC;
            futhark_mc_task_129221_task.nested_fn = futhark_mc_segred_nested_task_129229;
            
            int futhark_mc_segred_task_129222_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_129221_task);
            
            if (futhark_mc_segred_task_129222_err != 0) {
                err = futhark_mc_segred_task_129222_err;
                goto cleanup;
            }
            
            double defunc_0_reduce_res_110332;
            int64_t flat_tid_121806 = (int64_t) 0;
            
            defunc_0_reduce_res_110332 = 0.0;
            
            int64_t flat_tid_121789 = (int64_t) 0;
            struct futhark_mc_task_129244 futhark_mc_task_129244_;
            
            futhark_mc_task_129244_.ctx = ctx;
            futhark_mc_task_129244_.free_m_33388 = m_33388;
            futhark_mc_task_129244_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
            futhark_mc_task_129244_.free_A_mem_111707 = A_mem_111707.mem;
            futhark_mc_task_129244_.free_mem_112577 = mem_112577;
            futhark_mc_task_129244_.free_flat_tid_121789 = flat_tid_121789;
            futhark_mc_task_129244_.free_flat_tid_121806 = flat_tid_121806;
            futhark_mc_task_129244_.retval_defunc_0_reduce_res_110332 = (double *) &defunc_0_reduce_res_110332;
            #if ISPC
            futhark_mc_task_129244_.retval_defunc_0_reduce_res_110332 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_129244_task;
            
            futhark_mc_task_129244_task.args = &futhark_mc_task_129244_;
            futhark_mc_task_129244_task.top_level_fn = futhark_mc_segred_task_129245;
            futhark_mc_task_129244_task.name = "futhark_mc_segred_task_129245";
            futhark_mc_task_129244_task.iterations = m_33388;
            futhark_mc_task_129244_task.task_time = &ctx->program->futhark_mc_segred_task_129245_total_time;
            futhark_mc_task_129244_task.task_iter = &ctx->program->futhark_mc_segred_task_129245_total_iter;
            futhark_mc_task_129244_task.sched = STATIC;
            futhark_mc_task_129244_task.nested_fn = futhark_mc_segred_nested_task_129252;
            
            int futhark_mc_segred_task_129245_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_129244_task);
            
            if (futhark_mc_segred_task_129245_err != 0) {
                err = futhark_mc_segred_task_129245_err;
                goto cleanup;
            }
            
            double zt_res_110367 = -2.0 * defunc_res_110023;
            double zp_res_110368 = defunc_0_reduce_res_110297 + zt_res_110367;
            double zp_res_110369 = defunc_0_reduce_res_110332 + zp_res_110368;
            double defunc_res_110370;
            double defunc_res_110371;
            int64_t flat_tid_121862 = (int64_t) 0;
            
            defunc_res_110370 = 0.0;
            defunc_res_110371 = 0.0;
            
            int64_t flat_tid_121821 = (int64_t) 0;
            struct futhark_mc_task_129267 futhark_mc_task_129267_;
            
            futhark_mc_task_129267_.ctx = ctx;
            futhark_mc_task_129267_.free_m_33388 = m_33388;
            futhark_mc_task_129267_.free_eta_p_106382 = eta_p_106382;
            futhark_mc_task_129267_.free_distrs_mem_111708 = distrs_mem_111708.mem;
            futhark_mc_task_129267_.free_mem_112567 = mem_112567;
            futhark_mc_task_129267_.free_mem_112569 = mem_112569;
            futhark_mc_task_129267_.free_flat_tid_121821 = flat_tid_121821;
            futhark_mc_task_129267_.free_flat_tid_121862 = flat_tid_121862;
            futhark_mc_task_129267_.retval_defunc_res_110370 = (double *) &defunc_res_110370;
            #if ISPC
            futhark_mc_task_129267_.retval_defunc_res_110370 += programIndex;
            #endif
            futhark_mc_task_129267_.retval_defunc_res_110371 = (double *) &defunc_res_110371;
            #if ISPC
            futhark_mc_task_129267_.retval_defunc_res_110371 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_129267_task;
            
            futhark_mc_task_129267_task.args = &futhark_mc_task_129267_;
            futhark_mc_task_129267_task.top_level_fn = futhark_mc_segred_task_129268;
            futhark_mc_task_129267_task.name = "futhark_mc_segred_task_129268";
            futhark_mc_task_129267_task.iterations = m_33388;
            futhark_mc_task_129267_task.task_time = &ctx->program->futhark_mc_segred_task_129268_total_time;
            futhark_mc_task_129267_task.task_iter = &ctx->program->futhark_mc_segred_task_129268_total_iter;
            futhark_mc_task_129267_task.sched = STATIC;
            futhark_mc_task_129267_task.nested_fn = futhark_mc_segred_nested_task_129276;
            
            int futhark_mc_segred_task_129268_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_129267_task);
            
            if (futhark_mc_segred_task_129268_err != 0) {
                err = futhark_mc_segred_task_129268_err;
                goto cleanup;
            }
            
            double defunc_res_110452;
            double defunc_res_110453;
            int64_t flat_tid_121941 = (int64_t) 0;
            
            defunc_res_110452 = 0.0;
            defunc_res_110453 = 0.0;
            
            int64_t flat_tid_121900 = (int64_t) 0;
            struct futhark_mc_task_129293 futhark_mc_task_129293_;
            
            futhark_mc_task_129293_.ctx = ctx;
            futhark_mc_task_129293_.free_m_33388 = m_33388;
            futhark_mc_task_129293_.free_lifted_lambda_res_106391 = lifted_lambda_res_106391;
            futhark_mc_task_129293_.free_distrs_mem_111708 = distrs_mem_111708.mem;
            futhark_mc_task_129293_.free_mem_112573 = mem_112573;
            futhark_mc_task_129293_.free_mem_112575 = mem_112575;
            futhark_mc_task_129293_.free_flat_tid_121900 = flat_tid_121900;
            futhark_mc_task_129293_.free_flat_tid_121941 = flat_tid_121941;
            futhark_mc_task_129293_.retval_defunc_res_110452 = (double *) &defunc_res_110452;
            #if ISPC
            futhark_mc_task_129293_.retval_defunc_res_110452 += programIndex;
            #endif
            futhark_mc_task_129293_.retval_defunc_res_110453 = (double *) &defunc_res_110453;
            #if ISPC
            futhark_mc_task_129293_.retval_defunc_res_110453 += programIndex;
            #endif
            
            struct scheduler_segop futhark_mc_task_129293_task;
            
            futhark_mc_task_129293_task.args = &futhark_mc_task_129293_;
            futhark_mc_task_129293_task.top_level_fn = futhark_mc_segred_task_129294;
            futhark_mc_task_129293_task.name = "futhark_mc_segred_task_129294";
            futhark_mc_task_129293_task.iterations = m_33388;
            futhark_mc_task_129293_task.task_time = &ctx->program->futhark_mc_segred_task_129294_total_time;
            futhark_mc_task_129293_task.task_iter = &ctx->program->futhark_mc_segred_task_129294_total_iter;
            futhark_mc_task_129293_task.sched = STATIC;
            futhark_mc_task_129293_task.nested_fn = futhark_mc_segred_nested_task_129302;
            
            int futhark_mc_segred_task_129294_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_129293_task);
            
            if (futhark_mc_segred_task_129294_err != 0) {
                err = futhark_mc_segred_task_129294_err;
                goto cleanup;
            }
            
            double zt_res_110534 = defunc_res_106412 * defunc_res_106591;
            double zt_res_110535 = zt_res_110534 * zt_res_110534;
            double zt_res_110536 = defunc_res_110025 * defunc_res_110026;
            double zt_res_110537 = defunc_res_110024 * defunc_res_110027;
            double zp_res_110538 = zt_res_110536 + zt_res_110537;
            double zp_res_110539 = zt_res_110535 + zp_res_110538;
            double zt_res_110540 = defunc_res_110024 * defunc_res_110025;
            double zm_res_110541 = zp_res_110539 - zt_res_110540;
            double zt_res_110542 = rho1_33389 * defunc_res_110371;
            double zp_res_110543 = zp_res_110369 + zt_res_110542;
            double zt_res_110544 = rho2_33390 * defunc_res_110453;
            double zp_res_110545 = zp_res_110543 + zt_res_110544;
            double fma_res_110546 = futrts_fma64(zm_res_110541, eps_33391, zp_res_110545);
            
            ((double *) mem_114063.mem)[gtid_106380 * (int64_t) 5] = zp_res_110369;
            ((double *) mem_114063.mem)[gtid_106380 * (int64_t) 5 + (int64_t) 1] = defunc_res_110370;
            ((double *) mem_114063.mem)[gtid_106380 * (int64_t) 5 + (int64_t) 2] = defunc_res_110452;
            ((double *) mem_114063.mem)[gtid_106380 * (int64_t) 5 + (int64_t) 3] = zm_res_110541;
            ((double *) mem_114063.mem)[gtid_106380 * (int64_t) 5 + (int64_t) 4] = fma_res_110546;
        }
    }
    
  cleanup:
    {
        free(mem_111739);
        free(mem_111741);
        free(mem_111744);
        free(mem_111746);
        free(mem_111748);
        free(mem_111750);
        free(mem_111752);
        free(mem_111795);
        free(mem_111811);
        free(mem_111968);
        free(mem_111993);
        free(mem_111995);
        free(mem_111997);
        free(mem_111999);
        free(mem_112032);
        free(mem_112034);
        free(mem_112403);
        free(mem_112412);
        free(mem_112414);
        free(mem_112416);
        free(mem_112421);
        free(mem_112423);
        free(mem_112425);
        free(mem_112427);
        free(mem_112431);
        free(mem_112463);
        free(mem_112466);
        free(mem_112471);
        free(mem_112507);
        free(mem_112510);
        free(mem_112515);
        free(mem_112567);
        free(mem_112569);
        free(mem_112571);
        free(mem_112573);
        free(mem_112575);
        free(mem_112577);
        if (memblock_unref(ctx, &mem_param_tmp_123457, "mem_param_tmp_123457") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_123456, "mem_param_tmp_123456") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_123455, "mem_param_tmp_123455") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_out_tmp_125947, "mem_param_out_tmp_125947") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_125946, "mem_param_tmp_125946") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_out_121101, "mem_param_out_121101") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_121100, "mem_param_121100") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_unused_121095, "ext_mem_unused_121095") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_121094, "ext_mem_121094") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_120366, "ext_mem_120366") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_120365, "ext_mem_120365") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_120364, "ext_mem_120364") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_120363, "mem_120363") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_120362, "mem_120362") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_120361, "mem_120361") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_120302, "mem_120302") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_120301, "mem_120301") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_124713, "mem_param_tmp_124713") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_124712, "mem_param_tmp_124712") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_124711, "mem_param_tmp_124711") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_124710, "mem_param_tmp_124710") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_124709, "mem_param_tmp_124709") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_120238, "ext_mem_120238") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_120237, "ext_mem_120237") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_120236, "ext_mem_120236") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_120235, "mem_120235") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_120234, "mem_120234") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_120233, "mem_120233") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_120180, "ext_mem_120180") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_120179, "ext_mem_120179") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_120178, "ext_mem_120178") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_120177, "mem_120177") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_120176, "mem_120176") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_120175, "mem_120175") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_120116, "mem_120116") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_120071, "mem_120071") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_120061, "mem_param_120061") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_120060, "mem_param_120060") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_120059, "mem_param_120059") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_120058, "mem_param_120058") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_120057, "mem_param_120057") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_120047, "ext_mem_120047") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_120046, "ext_mem_120046") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_120045, "ext_mem_120045") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_120044, "ext_mem_120044") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_120043, "ext_mem_120043") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_119981, "ext_mem_119981") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_119980, "ext_mem_119980") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_119979, "ext_mem_119979") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_119927, "ext_mem_119927") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_119926, "ext_mem_119926") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_119925, "ext_mem_119925") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_119817, "ext_mem_119817") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_119816, "ext_mem_119816") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_119815, "ext_mem_119815") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_119814, "ext_mem_119814") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_119810, "ext_mem_119810") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_124255, "mem_param_tmp_124255") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_124254, "mem_param_tmp_124254") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_124253, "mem_param_tmp_124253") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_124252, "mem_param_tmp_124252") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_124251, "mem_param_tmp_124251") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_124250, "mem_param_tmp_124250") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_124249, "mem_param_tmp_124249") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_124248, "mem_param_tmp_124248") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_124247, "mem_param_tmp_124247") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_119737, "ext_mem_119737") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_119736, "ext_mem_119736") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_119735, "ext_mem_119735") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_119734, "mem_119734") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_119733, "mem_119733") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_119732, "mem_119732") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_119678, "ext_mem_119678") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_119677, "ext_mem_119677") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_119676, "ext_mem_119676") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_119675, "mem_119675") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_119674, "mem_119674") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_119673, "mem_119673") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_119614, "mem_119614") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_119569, "mem_119569") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_119552, "mem_param_119552") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_119551, "mem_param_119551") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_119550, "mem_param_119550") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_119549, "mem_param_119549") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_119548, "mem_param_119548") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_119547, "mem_param_119547") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_119546, "mem_param_119546") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_119545, "mem_param_119545") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_119544, "mem_param_119544") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_119527, "ext_mem_119527") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_119526, "ext_mem_119526") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_119525, "ext_mem_119525") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_119524, "ext_mem_119524") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_119523, "ext_mem_119523") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_119522, "ext_mem_119522") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_119521, "ext_mem_119521") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_119520, "ext_mem_119520") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_119519, "ext_mem_119519") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_119460, "ext_mem_119460") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_119459, "ext_mem_119459") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_119458, "ext_mem_119458") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_119409, "ext_mem_119409") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_119408, "ext_mem_119408") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_119407, "ext_mem_119407") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_123040, "mem_param_tmp_123040") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_123039, "mem_param_tmp_123039") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_123038, "mem_param_tmp_123038") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_123037, "mem_param_tmp_123037") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_123036, "mem_param_tmp_123036") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_118756, "ext_mem_118756") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_118755, "ext_mem_118755") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_118754, "ext_mem_118754") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_118753, "mem_118753") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_118752, "mem_118752") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_118751, "mem_118751") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_118697, "ext_mem_118697") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_118696, "ext_mem_118696") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_118695, "ext_mem_118695") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_118694, "mem_118694") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_118693, "mem_118693") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_118692, "mem_118692") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_118633, "mem_118633") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_118588, "mem_118588") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_118928, "mem_param_118928") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_118927, "mem_param_118927") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_118926, "mem_param_118926") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_112553, "ext_mem_112553") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_112554, "ext_mem_112554") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_112555, "ext_mem_112555") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_in_114669, "mem_in_114669") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_112513, "mem_112513") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_112272, "mem_112272") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_112269, "mem_112269") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_112267, "mem_112267") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_112244, "mem_112244") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_112241, "mem_112241") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_112239, "mem_112239") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_112224, "mem_112224") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_112222, "mem_112222") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_112097, "mem_112097") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_112094, "mem_112094") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_112092, "mem_112092") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_112073, "mem_112073") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_112070, "mem_112070") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_112068, "mem_112068") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_112055, "mem_112055") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_112053, "mem_112053") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_112051, "mem_112051") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_112048, "mem_112048") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_112046, "mem_112046") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_111981, "mem_111981") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_118578, "mem_param_118578") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_118577, "mem_param_118577") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_118576, "mem_param_118576") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_118575, "mem_param_118575") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_118574, "mem_param_118574") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_111951, "ext_mem_111951") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_111952, "ext_mem_111952") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_111953, "ext_mem_111953") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_111954, "ext_mem_111954") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_111955, "ext_mem_111955") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_111861, "ext_mem_111861") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_111862, "ext_mem_111862") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_111863, "ext_mem_111863") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_111858, "mem_111858") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_111855, "mem_111855") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_111853, "mem_111853") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_111838, "ext_mem_111838") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_111839, "ext_mem_111839") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_111840, "ext_mem_111840") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_111837, "mem_111837") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_111834, "mem_111834") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_111832, "mem_111832") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_111818, "mem_111818") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_111816, "mem_111816") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_111814, "mem_111814") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_111799, "mem_111799") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_111797, "mem_111797") != 0)
            return 1;
    }
    if (event_129319 != NULL) {
        event_129319->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127433", strdup("nothing further"), event_129319, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    return err;
}
int futhark_mc_segmap_nested_task_127431(void *args, int64_t iterations, int tid, struct scheduler_info info)
{
    int err = 0;
    int subtask_id = tid;
    struct futhark_mc_task_127379 *futhark_mc_task_127379 = (struct futhark_mc_task_127379 *) args;
    struct futhark_context *ctx = futhark_mc_task_127379->ctx;
    struct mc_event *event_129321 = mc_event_new(ctx);
    
    if (event_129321 != NULL)
        event_129321->bef = get_wall_time();
    
    int64_t k_33387 = futhark_mc_task_127379->free_k_33387;
    int64_t m_33388 = futhark_mc_task_127379->free_m_33388;
    double rho1_33389 = futhark_mc_task_127379->free_rho1_33389;
    double rho2_33390 = futhark_mc_task_127379->free_rho2_33390;
    double eps_33391 = futhark_mc_task_127379->free_eps_33391;
    double exp_absorb_cutoff_33394 = futhark_mc_task_127379->free_exp_absorb_cutoff_33394;
    double safe_for_exp_33395 = futhark_mc_task_127379->free_safe_for_exp_33395;
    double tol_sinkhorn_33396 = futhark_mc_task_127379->free_tol_sinkhorn_33396;
    double neg_res_43882 = futhark_mc_task_127379->free_neg_res_43882;
    double zp_res_43884 = futhark_mc_task_127379->free_zp_res_43884;
    double zs_res_44842 = futhark_mc_task_127379->free_zs_res_44842;
    double zs_res_44844 = futhark_mc_task_127379->free_zs_res_44844;
    double zs_res_44883 = futhark_mc_task_127379->free_zs_res_44883;
    double zs_res_44885 = futhark_mc_task_127379->free_zs_res_44885;
    double zp_res_46827 = futhark_mc_task_127379->free_zp_res_46827;
    int64_t defunc_0_reduce_res_103765 = futhark_mc_task_127379->free_defunc_0_reduce_res_103765;
    double zs_res_107134 = futhark_mc_task_127379->free_zs_res_107134;
    double zp_res_108112 = futhark_mc_task_127379->free_zp_res_108112;
    struct memblock A_mem_111707 = {.desc ="A_mem_111707", .mem =futhark_mc_task_127379->free_A_mem_111707, .size =0, .references =NULL};
    struct memblock distrs_mem_111708 = {.desc ="distrs_mem_111708", .mem =futhark_mc_task_127379->free_distrs_mem_111708, .size =0, .references =NULL};
    int64_t bytes_111715 = futhark_mc_task_127379->free_bytes_111715;
    struct memblock mem_111716 = {.desc ="mem_111716", .mem =futhark_mc_task_127379->free_mem_111716, .size =0, .references =NULL};
    struct memblock mem_111719 = {.desc ="mem_111719", .mem =futhark_mc_task_127379->free_mem_111719, .size =0, .references =NULL};
    struct memblock mem_111723 = {.desc ="mem_111723", .mem =futhark_mc_task_127379->free_mem_111723, .size =0, .references =NULL};
    int64_t bytes_111726 = futhark_mc_task_127379->free_bytes_111726;
    struct memblock mem_111727 = {.desc ="mem_111727", .mem =futhark_mc_task_127379->free_mem_111727, .size =0, .references =NULL};
    int64_t bytes_111743 = futhark_mc_task_127379->free_bytes_111743;
    struct memblock mem_114063 = {.desc ="mem_114063", .mem =futhark_mc_task_127379->free_mem_114063, .size =0, .references =NULL};
    int64_t num_bytes_114668 = futhark_mc_task_127379->free_num_bytes_114668;
    int32_t nsubtasks_117815;
    
    nsubtasks_117815 = info.nsubtasks;
    
    struct futhark_mc_segmap_parloop_struct_127432 futhark_mc_segmap_parloop_struct_127432_;
    
    futhark_mc_segmap_parloop_struct_127432_.ctx = ctx;
    futhark_mc_segmap_parloop_struct_127432_.free_k_33387 = k_33387;
    futhark_mc_segmap_parloop_struct_127432_.free_m_33388 = m_33388;
    futhark_mc_segmap_parloop_struct_127432_.free_rho1_33389 = rho1_33389;
    futhark_mc_segmap_parloop_struct_127432_.free_rho2_33390 = rho2_33390;
    futhark_mc_segmap_parloop_struct_127432_.free_eps_33391 = eps_33391;
    futhark_mc_segmap_parloop_struct_127432_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_segmap_parloop_struct_127432_.free_safe_for_exp_33395 = safe_for_exp_33395;
    futhark_mc_segmap_parloop_struct_127432_.free_tol_sinkhorn_33396 = tol_sinkhorn_33396;
    futhark_mc_segmap_parloop_struct_127432_.free_neg_res_43882 = neg_res_43882;
    futhark_mc_segmap_parloop_struct_127432_.free_zp_res_43884 = zp_res_43884;
    futhark_mc_segmap_parloop_struct_127432_.free_zs_res_44842 = zs_res_44842;
    futhark_mc_segmap_parloop_struct_127432_.free_zs_res_44844 = zs_res_44844;
    futhark_mc_segmap_parloop_struct_127432_.free_zs_res_44883 = zs_res_44883;
    futhark_mc_segmap_parloop_struct_127432_.free_zs_res_44885 = zs_res_44885;
    futhark_mc_segmap_parloop_struct_127432_.free_zp_res_46827 = zp_res_46827;
    futhark_mc_segmap_parloop_struct_127432_.free_defunc_0_reduce_res_103765 = defunc_0_reduce_res_103765;
    futhark_mc_segmap_parloop_struct_127432_.free_zs_res_107134 = zs_res_107134;
    futhark_mc_segmap_parloop_struct_127432_.free_zp_res_108112 = zp_res_108112;
    futhark_mc_segmap_parloop_struct_127432_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_segmap_parloop_struct_127432_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_segmap_parloop_struct_127432_.free_bytes_111715 = bytes_111715;
    futhark_mc_segmap_parloop_struct_127432_.free_mem_111716 = mem_111716.mem;
    futhark_mc_segmap_parloop_struct_127432_.free_mem_111719 = mem_111719.mem;
    futhark_mc_segmap_parloop_struct_127432_.free_mem_111723 = mem_111723.mem;
    futhark_mc_segmap_parloop_struct_127432_.free_bytes_111726 = bytes_111726;
    futhark_mc_segmap_parloop_struct_127432_.free_mem_111727 = mem_111727.mem;
    futhark_mc_segmap_parloop_struct_127432_.free_bytes_111743 = bytes_111743;
    futhark_mc_segmap_parloop_struct_127432_.free_mem_114063 = mem_114063.mem;
    futhark_mc_segmap_parloop_struct_127432_.free_num_bytes_114668 = num_bytes_114668;
    
    struct scheduler_parloop futhark_mc_segmap_parloop_127433_task;
    
    futhark_mc_segmap_parloop_127433_task.name = "futhark_mc_segmap_parloop_127433";
    futhark_mc_segmap_parloop_127433_task.fn = futhark_mc_segmap_parloop_127433;
    futhark_mc_segmap_parloop_127433_task.args = &futhark_mc_segmap_parloop_struct_127432_;
    futhark_mc_segmap_parloop_127433_task.iterations = iterations;
    futhark_mc_segmap_parloop_127433_task.info = info;
    
    struct mc_event *event_129320 = mc_event_new(ctx);
    
    if (event_129320 != NULL)
        event_129320->bef = get_wall_time();
    
    int futhark_mc_segmap_parloop_127433_err = scheduler_execute_task(&ctx->scheduler, &futhark_mc_segmap_parloop_127433_task);
    
    if (futhark_mc_segmap_parloop_127433_err != 0) {
        err = futhark_mc_segmap_parloop_127433_err;
        goto cleanup;
    }
    if (event_129320 != NULL) {
        event_129320->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_parloop_127433_total", strdup("nothing further"), event_129320, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    
  cleanup:
    { }
    if (event_129321 != NULL) {
        event_129321->aft = get_wall_time();
        lock_lock(&ctx->event_list_lock);
        add_event(ctx, "futhark_mc_segmap_nested_task_127431", strdup("nothing further"), event_129321, (event_report_fn) mc_event_report);
        lock_unlock(&ctx->event_list_lock);
    }
    if (err == 0) { }
    return err;
}
struct futhark_f64_1d {
    struct memblock mem;
    int64_t shape[1];
};
struct futhark_f64_1d *futhark_new_f64_1d(struct futhark_context *ctx, const double *data, int64_t dim0)
{
    int err = 0;
    struct futhark_f64_1d *bad = NULL;
    struct futhark_f64_1d *arr = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    worker_local = &ctx->scheduler.workers[0];
    arr->mem.references = NULL;
    if (memblock_alloc(ctx, &arr->mem, dim0 * 8, "arr->mem"))
        err = 1;
    arr->shape[0] = dim0;
    if ((size_t) dim0 * 8 > 0)
        memmove(arr->mem.mem + 0, (const unsigned char *) data + 0, (size_t) dim0 * 8);
    lock_unlock(&ctx->lock);
    if (err != 0) {
        free(arr);
        return bad;
    }
    return arr;
}
struct futhark_f64_1d *futhark_new_raw_f64_1d(struct futhark_context *ctx, unsigned char *data, int64_t dim0)
{
    int err = 0;
    struct futhark_f64_1d *bad = NULL;
    struct futhark_f64_1d *arr = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    worker_local = &ctx->scheduler.workers[0];
    arr->mem.references = NULL;
    arr->mem.mem = data;
    arr->shape[0] = dim0;
    lock_unlock(&ctx->lock);
    return arr;
}
int futhark_free_f64_1d(struct futhark_context *ctx, struct futhark_f64_1d *arr)
{
    lock_lock(&ctx->lock);
    worker_local = &ctx->scheduler.workers[0];
    if (memblock_unref(ctx, &arr->mem, "arr->mem") != 0)
        return 1;
    lock_unlock(&ctx->lock);
    free(arr);
    return 0;
}
int futhark_values_f64_1d(struct futhark_context *ctx, struct futhark_f64_1d *arr, double *data)
{
    int err = 0;
    
    lock_lock(&ctx->lock);
    worker_local = &ctx->scheduler.workers[0];
    if ((size_t) arr->shape[0] * 8 > 0)
        memmove((unsigned char *) data + 0, arr->mem.mem + 0, (size_t) arr->shape[0] * 8);
    lock_unlock(&ctx->lock);
    return err;
}
int futhark_index_f64_1d(struct futhark_context *ctx, double *out, struct futhark_f64_1d *arr, int64_t i0)
{
    int err = 0;
    
    if (i0 >= 0 && i0 < arr->shape[0]) {
        lock_lock(&ctx->lock);
        worker_local = &ctx->scheduler.workers[0];
        if (8 > 0)
            memmove((unsigned char *) out + 0, arr->mem.mem + 8 * (i0 * 1), 8);
        lock_unlock(&ctx->lock);
    } else {
        err = 1;
        set_error(ctx, strdup("Index out of bounds."));
    }
    return err;
}
unsigned char *futhark_values_raw_f64_1d(struct futhark_context *ctx, struct futhark_f64_1d *arr)
{
    (void) ctx;
    return arr->mem.mem;
}
const int64_t *futhark_shape_f64_1d(struct futhark_context *ctx, struct futhark_f64_1d *arr)
{
    (void) ctx;
    return arr->shape;
}
struct futhark_f64_2d {
    struct memblock mem;
    int64_t shape[2];
};
struct futhark_f64_2d *futhark_new_f64_2d(struct futhark_context *ctx, const double *data, int64_t dim0, int64_t dim1)
{
    int err = 0;
    struct futhark_f64_2d *bad = NULL;
    struct futhark_f64_2d *arr = (struct futhark_f64_2d *) malloc(sizeof(struct futhark_f64_2d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    worker_local = &ctx->scheduler.workers[0];
    arr->mem.references = NULL;
    if (memblock_alloc(ctx, &arr->mem, dim0 * dim1 * 8, "arr->mem"))
        err = 1;
    arr->shape[0] = dim0;
    arr->shape[1] = dim1;
    if ((size_t) (dim0 * dim1) * 8 > 0)
        memmove(arr->mem.mem + 0, (const unsigned char *) data + 0, (size_t) (dim0 * dim1) * 8);
    lock_unlock(&ctx->lock);
    if (err != 0) {
        free(arr);
        return bad;
    }
    return arr;
}
struct futhark_f64_2d *futhark_new_raw_f64_2d(struct futhark_context *ctx, unsigned char *data, int64_t dim0, int64_t dim1)
{
    int err = 0;
    struct futhark_f64_2d *bad = NULL;
    struct futhark_f64_2d *arr = (struct futhark_f64_2d *) malloc(sizeof(struct futhark_f64_2d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    worker_local = &ctx->scheduler.workers[0];
    arr->mem.references = NULL;
    arr->mem.mem = data;
    arr->shape[0] = dim0;
    arr->shape[1] = dim1;
    lock_unlock(&ctx->lock);
    return arr;
}
int futhark_free_f64_2d(struct futhark_context *ctx, struct futhark_f64_2d *arr)
{
    lock_lock(&ctx->lock);
    worker_local = &ctx->scheduler.workers[0];
    if (memblock_unref(ctx, &arr->mem, "arr->mem") != 0)
        return 1;
    lock_unlock(&ctx->lock);
    free(arr);
    return 0;
}
int futhark_values_f64_2d(struct futhark_context *ctx, struct futhark_f64_2d *arr, double *data)
{
    int err = 0;
    
    lock_lock(&ctx->lock);
    worker_local = &ctx->scheduler.workers[0];
    if ((size_t) (arr->shape[0] * arr->shape[1]) * 8 > 0)
        memmove((unsigned char *) data + 0, arr->mem.mem + 0, (size_t) (arr->shape[0] * arr->shape[1]) * 8);
    lock_unlock(&ctx->lock);
    return err;
}
int futhark_index_f64_2d(struct futhark_context *ctx, double *out, struct futhark_f64_2d *arr, int64_t i0, int64_t i1)
{
    int err = 0;
    
    if ((i0 >= 0 && i0 < arr->shape[0]) && (i1 >= 0 && i1 < arr->shape[1])) {
        lock_lock(&ctx->lock);
        worker_local = &ctx->scheduler.workers[0];
        if (8 > 0)
            memmove((unsigned char *) out + 0, arr->mem.mem + 8 * (i0 * arr->shape[1] + i1 * 1), 8);
        lock_unlock(&ctx->lock);
    } else {
        err = 1;
        set_error(ctx, strdup("Index out of bounds."));
    }
    return err;
}
unsigned char *futhark_values_raw_f64_2d(struct futhark_context *ctx, struct futhark_f64_2d *arr)
{
    (void) ctx;
    return arr->mem.mem;
}
const int64_t *futhark_shape_f64_2d(struct futhark_context *ctx, struct futhark_f64_2d *arr)
{
    (void) ctx;
    return arr->shape;
}
struct futhark_f64_3d {
    struct memblock mem;
    int64_t shape[3];
};
struct futhark_f64_3d *futhark_new_f64_3d(struct futhark_context *ctx, const double *data, int64_t dim0, int64_t dim1, int64_t dim2)
{
    int err = 0;
    struct futhark_f64_3d *bad = NULL;
    struct futhark_f64_3d *arr = (struct futhark_f64_3d *) malloc(sizeof(struct futhark_f64_3d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    worker_local = &ctx->scheduler.workers[0];
    arr->mem.references = NULL;
    if (memblock_alloc(ctx, &arr->mem, dim0 * dim1 * dim2 * 8, "arr->mem"))
        err = 1;
    arr->shape[0] = dim0;
    arr->shape[1] = dim1;
    arr->shape[2] = dim2;
    if ((size_t) (dim0 * dim1 * dim2) * 8 > 0)
        memmove(arr->mem.mem + 0, (const unsigned char *) data + 0, (size_t) (dim0 * dim1 * dim2) * 8);
    lock_unlock(&ctx->lock);
    if (err != 0) {
        free(arr);
        return bad;
    }
    return arr;
}
struct futhark_f64_3d *futhark_new_raw_f64_3d(struct futhark_context *ctx, unsigned char *data, int64_t dim0, int64_t dim1, int64_t dim2)
{
    int err = 0;
    struct futhark_f64_3d *bad = NULL;
    struct futhark_f64_3d *arr = (struct futhark_f64_3d *) malloc(sizeof(struct futhark_f64_3d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    worker_local = &ctx->scheduler.workers[0];
    arr->mem.references = NULL;
    arr->mem.mem = data;
    arr->shape[0] = dim0;
    arr->shape[1] = dim1;
    arr->shape[2] = dim2;
    lock_unlock(&ctx->lock);
    return arr;
}
int futhark_free_f64_3d(struct futhark_context *ctx, struct futhark_f64_3d *arr)
{
    lock_lock(&ctx->lock);
    worker_local = &ctx->scheduler.workers[0];
    if (memblock_unref(ctx, &arr->mem, "arr->mem") != 0)
        return 1;
    lock_unlock(&ctx->lock);
    free(arr);
    return 0;
}
int futhark_values_f64_3d(struct futhark_context *ctx, struct futhark_f64_3d *arr, double *data)
{
    int err = 0;
    
    lock_lock(&ctx->lock);
    worker_local = &ctx->scheduler.workers[0];
    if ((size_t) (arr->shape[0] * arr->shape[1] * arr->shape[2]) * 8 > 0)
        memmove((unsigned char *) data + 0, arr->mem.mem + 0, (size_t) (arr->shape[0] * arr->shape[1] * arr->shape[2]) * 8);
    lock_unlock(&ctx->lock);
    return err;
}
int futhark_index_f64_3d(struct futhark_context *ctx, double *out, struct futhark_f64_3d *arr, int64_t i0, int64_t i1, int64_t i2)
{
    int err = 0;
    
    if ((i0 >= 0 && i0 < arr->shape[0]) && ((i1 >= 0 && i1 < arr->shape[1]) && (i2 >= 0 && i2 < arr->shape[2]))) {
        lock_lock(&ctx->lock);
        worker_local = &ctx->scheduler.workers[0];
        if (8 > 0)
            memmove((unsigned char *) out + 0, arr->mem.mem + 8 * (i0 * (arr->shape[1] * arr->shape[2]) + i1 * arr->shape[2] + i2 * 1), 8);
        lock_unlock(&ctx->lock);
    } else {
        err = 1;
        set_error(ctx, strdup("Index out of bounds."));
    }
    return err;
}
unsigned char *futhark_values_raw_f64_3d(struct futhark_context *ctx, struct futhark_f64_3d *arr)
{
    (void) ctx;
    return arr->mem.mem;
}
const int64_t *futhark_shape_f64_3d(struct futhark_context *ctx, struct futhark_f64_3d *arr)
{
    (void) ctx;
    return arr->shape;
}

FUTHARK_FUN_ATTR int futrts_entry_ugw_armijo(struct futhark_context *ctx, struct memblock *mem_out_p_127224, struct memblock A_mem_111707, struct memblock mu_mem_111708, struct memblock B_mem_111709, struct memblock nu_mem_111710, int64_t mz2081Uz2084U_33563, double rho1_33564, double rho2_33565, double eps_33566, double exp_absorb_cutoff_33571, double safe_for_exp_33572, double tol_sinkhorn_33573, double tol_outerloop_33574)
{
    (void) ctx;
    
    int err = 0;
    struct memblock ext_mem_111716;
    
    ext_mem_111716.references = NULL;
    
    struct memblock mem_111715;
    
    mem_111715.references = NULL;
    
    struct memblock mem_111712;
    
    mem_111712.references = NULL;
    
    struct memblock mem_out_114751;
    
    mem_out_114751.references = NULL;
    
    int64_t bytes_111711 = (int64_t) 16 * mz2081Uz2084U_33563;
    
    if (memblock_alloc(ctx, &mem_111712, bytes_111711, "mem_111712")) {
        err = 1;
        goto cleanup;
    }
    
    int64_t iterations_114761 = mz2081Uz2084U_33563;
    struct futhark_mc_task_127225 futhark_mc_task_127225_;
    
    futhark_mc_task_127225_.ctx = ctx;
    futhark_mc_task_127225_.free_mz2081Uz2084U_33563 = mz2081Uz2084U_33563;
    futhark_mc_task_127225_.free_mu_mem_111708 = mu_mem_111708.mem;
    futhark_mc_task_127225_.free_mem_111712 = mem_111712.mem;
    
    struct scheduler_segop futhark_mc_task_127225_task;
    
    futhark_mc_task_127225_task.args = &futhark_mc_task_127225_;
    futhark_mc_task_127225_task.top_level_fn = futhark_mc_copy_114760_task_127226;
    futhark_mc_task_127225_task.name = "futhark_mc_copy_114760_task_127226";
    futhark_mc_task_127225_task.iterations = iterations_114761;
    futhark_mc_task_127225_task.task_time = &ctx->program->futhark_mc_copy_114760_task_127226_total_time;
    futhark_mc_task_127225_task.task_iter = &ctx->program->futhark_mc_copy_114760_task_127226_total_iter;
    futhark_mc_task_127225_task.sched = STATIC;
    futhark_mc_task_127225_task.nested_fn = NULL;
    
    int futhark_mc_copy_114760_task_127226_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127225_task);
    
    if (futhark_mc_copy_114760_task_127226_err != 0) {
        err = futhark_mc_copy_114760_task_127226_err;
        goto cleanup;
    }
    
    int64_t iterations_114771 = mz2081Uz2084U_33563;
    struct futhark_mc_task_127232 futhark_mc_task_127232_;
    
    futhark_mc_task_127232_.ctx = ctx;
    futhark_mc_task_127232_.free_mz2081Uz2084U_33563 = mz2081Uz2084U_33563;
    futhark_mc_task_127232_.free_nu_mem_111710 = nu_mem_111710.mem;
    futhark_mc_task_127232_.free_mem_111712 = mem_111712.mem;
    
    struct scheduler_segop futhark_mc_task_127232_task;
    
    futhark_mc_task_127232_task.args = &futhark_mc_task_127232_;
    futhark_mc_task_127232_task.top_level_fn = futhark_mc_copy_114770_task_127233;
    futhark_mc_task_127232_task.name = "futhark_mc_copy_114770_task_127233";
    futhark_mc_task_127232_task.iterations = iterations_114771;
    futhark_mc_task_127232_task.task_time = &ctx->program->futhark_mc_copy_114770_task_127233_total_time;
    futhark_mc_task_127232_task.task_iter = &ctx->program->futhark_mc_copy_114770_task_127233_total_iter;
    futhark_mc_task_127232_task.sched = STATIC;
    futhark_mc_task_127232_task.nested_fn = NULL;
    
    int futhark_mc_copy_114770_task_127233_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127232_task);
    
    if (futhark_mc_copy_114770_task_127233_err != 0) {
        err = futhark_mc_copy_114770_task_127233_err;
        goto cleanup;
    }
    
    int64_t bytes_111714 = mz2081Uz2084U_33563 * bytes_111711;
    
    if (memblock_alloc(ctx, &mem_111715, bytes_111714, "mem_111715")) {
        err = 1;
        goto cleanup;
    }
    
    int64_t iterations_114784 = mz2081Uz2084U_33563 * mz2081Uz2084U_33563;
    struct futhark_mc_task_127239 futhark_mc_task_127239_;
    
    futhark_mc_task_127239_.ctx = ctx;
    futhark_mc_task_127239_.free_mz2081Uz2084U_33563 = mz2081Uz2084U_33563;
    futhark_mc_task_127239_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_task_127239_.free_mem_111715 = mem_111715.mem;
    
    struct scheduler_segop futhark_mc_task_127239_task;
    
    futhark_mc_task_127239_task.args = &futhark_mc_task_127239_;
    futhark_mc_task_127239_task.top_level_fn = futhark_mc_copy_114783_task_127240;
    futhark_mc_task_127239_task.name = "futhark_mc_copy_114783_task_127240";
    futhark_mc_task_127239_task.iterations = iterations_114784;
    futhark_mc_task_127239_task.task_time = &ctx->program->futhark_mc_copy_114783_task_127240_total_time;
    futhark_mc_task_127239_task.task_iter = &ctx->program->futhark_mc_copy_114783_task_127240_total_iter;
    futhark_mc_task_127239_task.sched = STATIC;
    futhark_mc_task_127239_task.nested_fn = NULL;
    
    int futhark_mc_copy_114783_task_127240_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127239_task);
    
    if (futhark_mc_copy_114783_task_127240_err != 0) {
        err = futhark_mc_copy_114783_task_127240_err;
        goto cleanup;
    }
    
    int64_t iterations_114797 = mz2081Uz2084U_33563 * mz2081Uz2084U_33563;
    struct futhark_mc_task_127246 futhark_mc_task_127246_;
    
    futhark_mc_task_127246_.ctx = ctx;
    futhark_mc_task_127246_.free_mz2081Uz2084U_33563 = mz2081Uz2084U_33563;
    futhark_mc_task_127246_.free_B_mem_111709 = B_mem_111709.mem;
    futhark_mc_task_127246_.free_mem_111715 = mem_111715.mem;
    
    struct scheduler_segop futhark_mc_task_127246_task;
    
    futhark_mc_task_127246_task.args = &futhark_mc_task_127246_;
    futhark_mc_task_127246_task.top_level_fn = futhark_mc_copy_114796_task_127247;
    futhark_mc_task_127246_task.name = "futhark_mc_copy_114796_task_127247";
    futhark_mc_task_127246_task.iterations = iterations_114797;
    futhark_mc_task_127246_task.task_time = &ctx->program->futhark_mc_copy_114796_task_127247_total_time;
    futhark_mc_task_127246_task.task_iter = &ctx->program->futhark_mc_copy_114796_task_127247_total_iter;
    futhark_mc_task_127246_task.sched = STATIC;
    futhark_mc_task_127246_task.nested_fn = NULL;
    
    int futhark_mc_copy_114796_task_127247_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127246_task);
    
    if (futhark_mc_copy_114796_task_127247_err != 0) {
        err = futhark_mc_copy_114796_task_127247_err;
        goto cleanup;
    }
    
    int64_t zbzg_lhs_34527;
    
    if (futrts_ugw_armijo_pairwise_13790(ctx, &ext_mem_111716, &zbzg_lhs_34527, mem_111715, mem_111712, (int64_t) 2, mz2081Uz2084U_33563, rho1_33564, rho2_33565, eps_33566, exp_absorb_cutoff_33571, safe_for_exp_33572, tol_sinkhorn_33573, tol_outerloop_33574) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_unref(ctx, &mem_111712, "mem_111712") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_111715, "mem_111715") != 0)
        return 1;
    
    bool y_34529 = slt64((int64_t) 0, zbzg_lhs_34527);
    bool index_certs_34530;
    
    if (!y_34529) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) (int64_t) 0, "] out of bounds for array of shape [", (long long) zbzg_lhs_34527, "].", "-> #0  unbalanced_gw.fut:165:33-37\n   #1  /prelude/functional.fut:9:44-45\n   #2  unbalanced_gw.fut:165:27-37\n   #3  unbalanced_gw.fut:162:1-165:38\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    if (memblock_set(ctx, &mem_out_114751, &ext_mem_111716, "ext_mem_111716") != 0)
        return 1;
    if (memblock_set(ctx, &*mem_out_p_127224, &mem_out_114751, "mem_out_114751") != 0)
        return 1;
    
  cleanup:
    {
        if (memblock_unref(ctx, &ext_mem_111716, "ext_mem_111716") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_111715, "mem_111715") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_111712, "mem_111712") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_out_114751, "mem_out_114751") != 0)
            return 1;
    }
    return err;
}
FUTHARK_FUN_ATTR int futrts_entry_ugw_armijo_euclidean(struct futhark_context *ctx, struct memblock *mem_out_p_127253, int64_t *out_prim_out_127254, struct memblock pt_clouds_mem_111707, int64_t k_34109, int64_t m_34110, int64_t d_34111, double rho1_34112, double rho2_34113, double eps_34114, double exp_absorb_cutoff_34116, double safe_for_exp_34117, double tol_sinkhorn_34118, double tol_outerloop_34119)
{
    (void) ctx;
    
    int err = 0;
    struct memblock ext_mem_111747;
    
    ext_mem_111747.references = NULL;
    
    struct memblock mem_111746;
    
    mem_111746.references = NULL;
    
    struct memblock mem_111743;
    
    mem_111743.references = NULL;
    
    struct memblock mem_out_114751;
    
    mem_out_114751.references = NULL;
    
    int64_t prim_out_114752;
    int64_t binop_x_111740 = (int64_t) 8 * k_34109;
    int64_t binop_x_111741 = m_34110 * binop_x_111740;
    int64_t bytes_111742 = m_34110 * binop_x_111741;
    int64_t binop_x_111718 = (int64_t) 8 * m_34110;
    int64_t bytes_111719 = m_34110 * binop_x_111718;
    
    if (memblock_alloc(ctx, &mem_111743, bytes_111742, "mem_111743")) {
        err = 1;
        goto cleanup;
    }
    
    int64_t flat_tid_103772 = (int64_t) 0;
    int64_t flat_tid_103830 = (int64_t) 0;
    struct futhark_mc_task_127255 futhark_mc_task_127255_;
    
    futhark_mc_task_127255_.ctx = ctx;
    futhark_mc_task_127255_.free_k_34109 = k_34109;
    futhark_mc_task_127255_.free_m_34110 = m_34110;
    futhark_mc_task_127255_.free_d_34111 = d_34111;
    futhark_mc_task_127255_.free_pt_clouds_mem_111707 = pt_clouds_mem_111707.mem;
    futhark_mc_task_127255_.free_bytes_111719 = bytes_111719;
    futhark_mc_task_127255_.free_mem_111743 = mem_111743.mem;
    
    struct scheduler_segop futhark_mc_task_127255_task;
    
    futhark_mc_task_127255_task.args = &futhark_mc_task_127255_;
    futhark_mc_task_127255_task.top_level_fn = futhark_mc_segmap_task_127256;
    futhark_mc_task_127255_task.name = "futhark_mc_segmap_task_127256";
    futhark_mc_task_127255_task.iterations = k_34109;
    futhark_mc_task_127255_task.task_time = &ctx->program->futhark_mc_segmap_task_127256_total_time;
    futhark_mc_task_127255_task.task_iter = &ctx->program->futhark_mc_segmap_task_127256_total_iter;
    futhark_mc_task_127255_task.sched = STATIC;
    futhark_mc_task_127255_task.nested_fn = futhark_mc_segmap_nested_task_127262;
    
    int futhark_mc_segmap_task_127256_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127255_task);
    
    if (futhark_mc_segmap_task_127256_err != 0) {
        err = futhark_mc_segmap_task_127256_err;
        goto cleanup;
    }
    
    double i64_res_44789 = sitofp_i64_f64(m_34110);
    double replicate_arg1_44790 = 1.0 / i64_res_44789;
    
    if (memblock_alloc(ctx, &mem_111746, binop_x_111741, "mem_111746")) {
        err = 1;
        goto cleanup;
    }
    for (int64_t nest_i_114930 = 0; nest_i_114930 < k_34109; nest_i_114930++) {
        for (int64_t nest_i_114931 = 0; nest_i_114931 < m_34110; nest_i_114931++) {
            ((double *) mem_111746.mem)[nest_i_114930 * m_34110 + nest_i_114931] = replicate_arg1_44790;
        }
    }
    
    int64_t defunc_res_44792;
    
    if (futrts_ugw_armijo_pairwise_13790(ctx, &ext_mem_111747, &defunc_res_44792, mem_111743, mem_111746, k_34109, m_34110, rho1_34112, rho2_34113, eps_34114, exp_absorb_cutoff_34116, safe_for_exp_34117, tol_sinkhorn_34118, tol_outerloop_34119) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_unref(ctx, &mem_111743, "mem_111743") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_111746, "mem_111746") != 0)
        return 1;
    if (memblock_set(ctx, &mem_out_114751, &ext_mem_111747, "ext_mem_111747") != 0)
        return 1;
    prim_out_114752 = defunc_res_44792;
    if (memblock_set(ctx, &*mem_out_p_127253, &mem_out_114751, "mem_out_114751") != 0)
        return 1;
    *out_prim_out_127254 = prim_out_114752;
    
  cleanup:
    {
        if (memblock_unref(ctx, &ext_mem_111747, "ext_mem_111747") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_111746, "mem_111746") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_111743, "mem_111743") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_out_114751, "mem_out_114751") != 0)
            return 1;
    }
    return err;
}
FUTHARK_FUN_ATTR int futrts_entry_ugw_armijo_pairwise(struct futhark_context *ctx, struct memblock *mem_out_p_127303, int64_t *out_prim_out_127304, struct memblock A_mem_111707, struct memblock distrs_mem_111708, int64_t k_33497, int64_t m_33498, double rho1_33499, double rho2_33500, double eps_33501, double exp_absorb_cutoff_33504, double safe_for_exp_33505, double tol_sinkhorn_33506, double tol_outerloop_33507)
{
    (void) ctx;
    
    int err = 0;
    struct memblock ext_mem_111709;
    
    ext_mem_111709.references = NULL;
    
    struct memblock mem_out_114751;
    
    mem_out_114751.references = NULL;
    
    int64_t prim_out_114752;
    int64_t entry_result_33508;
    
    if (futrts_ugw_armijo_pairwise_13790(ctx, &ext_mem_111709, &entry_result_33508, A_mem_111707, distrs_mem_111708, k_33497, m_33498, rho1_33499, rho2_33500, eps_33501, exp_absorb_cutoff_33504, safe_for_exp_33505, tol_sinkhorn_33506, tol_outerloop_33507) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_set(ctx, &mem_out_114751, &ext_mem_111709, "ext_mem_111709") != 0)
        return 1;
    prim_out_114752 = entry_result_33508;
    if (memblock_set(ctx, &*mem_out_p_127303, &mem_out_114751, "mem_out_114751") != 0)
        return 1;
    *out_prim_out_127304 = prim_out_114752;
    
  cleanup:
    {
        if (memblock_unref(ctx, &ext_mem_111709, "ext_mem_111709") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_out_114751, "mem_out_114751") != 0)
            return 1;
    }
    return err;
}
FUTHARK_FUN_ATTR int futrts_entry_ugw_armijo_pairwise_unif(struct futhark_context *ctx, struct memblock *mem_out_p_127305, int64_t *out_prim_out_127306, struct memblock A_mem_111707, int64_t k_33767, int64_t m_33768, double rho1_33769, double rho2_33770, double eps_33771, double exp_absorb_cutoff_33773, double safe_for_exp_33774, double tol_sinkhorn_33775, double tol_outerloop_33776)
{
    (void) ctx;
    
    int err = 0;
    struct memblock ext_mem_111711;
    
    ext_mem_111711.references = NULL;
    
    struct memblock mem_111710;
    
    mem_111710.references = NULL;
    
    struct memblock mem_out_114751;
    
    mem_out_114751.references = NULL;
    
    int64_t prim_out_114752;
    int64_t binop_x_111708 = (int64_t) 8 * k_33767;
    int64_t bytes_111709 = m_33768 * binop_x_111708;
    double i64_res_44789 = sitofp_i64_f64(m_33768);
    double replicate_arg1_44790 = 1.0 / i64_res_44789;
    
    if (memblock_alloc(ctx, &mem_111710, bytes_111709, "mem_111710")) {
        err = 1;
        goto cleanup;
    }
    for (int64_t nest_i_114753 = 0; nest_i_114753 < k_33767; nest_i_114753++) {
        for (int64_t nest_i_114754 = 0; nest_i_114754 < m_33768; nest_i_114754++) {
            ((double *) mem_111710.mem)[nest_i_114753 * m_33768 + nest_i_114754] = replicate_arg1_44790;
        }
    }
    
    int64_t defunc_res_44792;
    
    if (futrts_ugw_armijo_pairwise_13790(ctx, &ext_mem_111711, &defunc_res_44792, A_mem_111707, mem_111710, k_33767, m_33768, rho1_33769, rho2_33770, eps_33771, exp_absorb_cutoff_33773, safe_for_exp_33774, tol_sinkhorn_33775, tol_outerloop_33776) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_unref(ctx, &mem_111710, "mem_111710") != 0)
        return 1;
    if (memblock_set(ctx, &mem_out_114751, &ext_mem_111711, "ext_mem_111711") != 0)
        return 1;
    prim_out_114752 = defunc_res_44792;
    if (memblock_set(ctx, &*mem_out_p_127305, &mem_out_114751, "mem_out_114751") != 0)
        return 1;
    *out_prim_out_127306 = prim_out_114752;
    
  cleanup:
    {
        if (memblock_unref(ctx, &ext_mem_111711, "ext_mem_111711") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_111710, "mem_111710") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_out_114751, "mem_out_114751") != 0)
            return 1;
    }
    return err;
}
FUTHARK_FUN_ATTR int futrts_ugw_armijo_pairwise_13790(struct futhark_context *ctx, struct memblock *mem_out_p_127307, int64_t *out_prim_out_127308, struct memblock A_mem_111707, struct memblock distrs_mem_111708, int64_t k_33387, int64_t m_33388, double rho1_33389, double rho2_33390, double eps_33391, double exp_absorb_cutoff_33394, double safe_for_exp_33395, double tol_sinkhorn_33396, double tol_outerloop_33397)
{
    (void) ctx;
    
    int err = 0;
    int64_t mem_111710_cached_sizze_127309 = 0;
    unsigned char *mem_111710 = NULL;
    int64_t mem_111712_cached_sizze_127310 = 0;
    unsigned char *mem_111712 = NULL;
    int64_t mem_111714_cached_sizze_127311 = 0;
    unsigned char *mem_111714 = NULL;
    int64_t mem_111716_cached_sizze_127312 = 0;
    unsigned char *mem_111716 = NULL;
    int64_t mem_111717_cached_sizze_127313 = 0;
    unsigned char *mem_111717 = NULL;
    int64_t mem_111719_cached_sizze_127314 = 0;
    unsigned char *mem_111719 = NULL;
    int64_t mem_111720_cached_sizze_127315 = 0;
    unsigned char *mem_111720 = NULL;
    int64_t mem_111721_cached_sizze_127316 = 0;
    unsigned char *mem_111721 = NULL;
    int64_t mem_111723_cached_sizze_127317 = 0;
    unsigned char *mem_111723 = NULL;
    int64_t mem_111727_cached_sizze_127318 = 0;
    unsigned char *mem_111727 = NULL;
    struct memblock mem_114063;
    
    mem_114063.references = NULL;
    
    struct memblock mem_out_114751;
    
    mem_out_114751.references = NULL;
    
    int64_t prim_out_114752;
    int64_t zm_lhs_34592 = sub64(k_33387, (int64_t) 1);
    int64_t bytes_111709 = (int64_t) 8 * k_33387;
    
    if (mem_111710_cached_sizze_127309 < bytes_111709) {
        err = lexical_realloc(ctx, &mem_111710, &mem_111710_cached_sizze_127309, bytes_111709);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_111712_cached_sizze_127310 < bytes_111709) {
        err = lexical_realloc(ctx, &mem_111712, &mem_111712_cached_sizze_127310, bytes_111709);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    int64_t flat_tid_103880 = (int64_t) 0;
    struct futhark_mc_task_127319 futhark_mc_task_127319_;
    
    futhark_mc_task_127319_.ctx = ctx;
    futhark_mc_task_127319_.free_k_33387 = k_33387;
    futhark_mc_task_127319_.free_zm_lhs_34592 = zm_lhs_34592;
    futhark_mc_task_127319_.free_mem_111710 = mem_111710;
    futhark_mc_task_127319_.free_mem_111712 = mem_111712;
    
    struct scheduler_segop futhark_mc_task_127319_task;
    
    futhark_mc_task_127319_task.args = &futhark_mc_task_127319_;
    futhark_mc_task_127319_task.top_level_fn = futhark_mc_segscan_task_127320;
    futhark_mc_task_127319_task.name = "futhark_mc_segscan_task_127320";
    futhark_mc_task_127319_task.iterations = k_33387;
    futhark_mc_task_127319_task.task_time = &ctx->program->futhark_mc_segscan_task_127320_total_time;
    futhark_mc_task_127319_task.task_iter = &ctx->program->futhark_mc_segscan_task_127320_total_iter;
    futhark_mc_task_127319_task.sched = STATIC;
    futhark_mc_task_127319_task.nested_fn = NULL;
    
    int futhark_mc_segscan_task_127320_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127319_task);
    
    if (futhark_mc_segscan_task_127320_err != 0) {
        err = futhark_mc_segscan_task_127320_err;
        goto cleanup;
    }
    
    int64_t defunc_0_reduce_res_103765;
    int64_t flat_tid_103882 = (int64_t) 0;
    
    defunc_0_reduce_res_103765 = (int64_t) 0;
    
    struct futhark_mc_task_127331 futhark_mc_task_127331_;
    
    futhark_mc_task_127331_.ctx = ctx;
    futhark_mc_task_127331_.free_flat_tid_103882 = flat_tid_103882;
    futhark_mc_task_127331_.free_mem_111712 = mem_111712;
    futhark_mc_task_127331_.retval_defunc_0_reduce_res_103765 = (int64_t *) &defunc_0_reduce_res_103765;
    #if ISPC
    futhark_mc_task_127331_.retval_defunc_0_reduce_res_103765 += programIndex;
    #endif
    
    struct scheduler_segop futhark_mc_task_127331_task;
    
    futhark_mc_task_127331_task.args = &futhark_mc_task_127331_;
    futhark_mc_task_127331_task.top_level_fn = futhark_mc_segred_task_127332;
    futhark_mc_task_127331_task.name = "futhark_mc_segred_task_127332";
    futhark_mc_task_127331_task.iterations = k_33387;
    futhark_mc_task_127331_task.task_time = &ctx->program->futhark_mc_segred_task_127332_total_time;
    futhark_mc_task_127331_task.task_iter = &ctx->program->futhark_mc_segred_task_127332_total_iter;
    futhark_mc_task_127331_task.sched = STATIC;
    futhark_mc_task_127331_task.nested_fn = NULL;
    
    int futhark_mc_segred_task_127332_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127331_task);
    
    if (futhark_mc_segred_task_127332_err != 0) {
        err = futhark_mc_segred_task_127332_err;
        goto cleanup;
    }
    
    int64_t bytes_111713 = (int64_t) 8 * defunc_0_reduce_res_103765;
    int64_t bytes_111715 = (int64_t) 8 * m_33388;
    int64_t binop_x_111725 = m_33388 * bytes_111709;
    int64_t bytes_111726 = m_33388 * binop_x_111725;
    int64_t bytes_114062 = (int64_t) 40 * defunc_0_reduce_res_103765;
    
    if (mem_111714_cached_sizze_127311 < bytes_111713) {
        err = lexical_realloc(ctx, &mem_111714, &mem_111714_cached_sizze_127311, bytes_111713);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    for (int64_t nest_i_114791 = 0; nest_i_114791 < defunc_0_reduce_res_103765; nest_i_114791++) {
        ((int64_t *) mem_111714)[nest_i_114791] = (int64_t) 0;
    }
    
    int64_t flat_tid_103884 = (int64_t) 0;
    struct futhark_mc_task_127339 futhark_mc_task_127339_;
    
    futhark_mc_task_127339_.ctx = ctx;
    futhark_mc_task_127339_.free_k_33387 = k_33387;
    futhark_mc_task_127339_.free_defunc_0_reduce_res_103765 = defunc_0_reduce_res_103765;
    futhark_mc_task_127339_.free_mem_111710 = mem_111710;
    futhark_mc_task_127339_.free_mem_111714 = mem_111714;
    
    struct scheduler_segop futhark_mc_task_127339_task;
    
    futhark_mc_task_127339_task.args = &futhark_mc_task_127339_;
    futhark_mc_task_127339_task.top_level_fn = futhark_mc_segmap_task_127340;
    futhark_mc_task_127339_task.name = "futhark_mc_segmap_task_127340";
    futhark_mc_task_127339_task.iterations = k_33387;
    futhark_mc_task_127339_task.task_time = &ctx->program->futhark_mc_segmap_task_127340_total_time;
    futhark_mc_task_127339_task.task_iter = &ctx->program->futhark_mc_segmap_task_127340_total_iter;
    futhark_mc_task_127339_task.sched = STATIC;
    futhark_mc_task_127339_task.nested_fn = NULL;
    
    int futhark_mc_segmap_task_127340_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127339_task);
    
    if (futhark_mc_segmap_task_127340_err != 0) {
        err = futhark_mc_segmap_task_127340_err;
        goto cleanup;
    }
    if (mem_111716_cached_sizze_127312 < bytes_111715) {
        err = lexical_realloc(ctx, &mem_111716, &mem_111716_cached_sizze_127312, bytes_111715);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    for (int64_t nest_i_114805 = 0; nest_i_114805 < m_33388; nest_i_114805++) {
        ((double *) mem_111716)[nest_i_114805] = 1.0;
    }
    
    double zp_res_44841 = rho1_33389 + eps_33391;
    double zp_res_46827 = rho2_33390 + zp_res_44841;
    double zp_res_44882 = rho2_33390 + eps_33391;
    double neg_res_43882 = -eps_33391;
    double zs_res_44885 = neg_res_43882 / zp_res_44882;
    double neg_res_44881 = -rho2_33390;
    double zs_res_44883 = neg_res_44881 / zp_res_44882;
    double zs_res_44844 = neg_res_43882 / zp_res_44841;
    double neg_res_44840 = -rho1_33389;
    double zs_res_44842 = neg_res_44840 / zp_res_44841;
    double zp_res_43884 = 1.0 + tol_outerloop_33397;
    
    if (mem_111717_cached_sizze_127313 < defunc_0_reduce_res_103765) {
        err = lexical_realloc(ctx, &mem_111717, &mem_111717_cached_sizze_127313, defunc_0_reduce_res_103765);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_111719_cached_sizze_127314 < bytes_111713) {
        err = lexical_realloc(ctx, &mem_111719, &mem_111719_cached_sizze_127314, bytes_111713);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_111720_cached_sizze_127315 < defunc_0_reduce_res_103765) {
        err = lexical_realloc(ctx, &mem_111720, &mem_111720_cached_sizze_127315, defunc_0_reduce_res_103765);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    int64_t flat_tid_103886 = (int64_t) 0;
    struct futhark_mc_task_127346 futhark_mc_task_127346_;
    
    futhark_mc_task_127346_.ctx = ctx;
    futhark_mc_task_127346_.free_defunc_0_reduce_res_103765 = defunc_0_reduce_res_103765;
    futhark_mc_task_127346_.free_mem_111714 = mem_111714;
    futhark_mc_task_127346_.free_mem_111717 = mem_111717;
    futhark_mc_task_127346_.free_mem_111719 = mem_111719;
    futhark_mc_task_127346_.free_mem_111720 = mem_111720;
    
    struct scheduler_segop futhark_mc_task_127346_task;
    
    futhark_mc_task_127346_task.args = &futhark_mc_task_127346_;
    futhark_mc_task_127346_task.top_level_fn = futhark_mc_segscan_task_127347;
    futhark_mc_task_127346_task.name = "futhark_mc_segscan_task_127347";
    futhark_mc_task_127346_task.iterations = defunc_0_reduce_res_103765;
    futhark_mc_task_127346_task.task_time = &ctx->program->futhark_mc_segscan_task_127347_total_time;
    futhark_mc_task_127346_task.task_iter = &ctx->program->futhark_mc_segscan_task_127347_total_iter;
    futhark_mc_task_127346_task.sched = STATIC;
    futhark_mc_task_127346_task.nested_fn = NULL;
    
    int futhark_mc_segscan_task_127347_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127346_task);
    
    if (futhark_mc_segscan_task_127347_err != 0) {
        err = futhark_mc_segscan_task_127347_err;
        goto cleanup;
    }
    if (mem_111721_cached_sizze_127316 < defunc_0_reduce_res_103765) {
        err = lexical_realloc(ctx, &mem_111721, &mem_111721_cached_sizze_127316, defunc_0_reduce_res_103765);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_111723_cached_sizze_127317 < bytes_111713) {
        err = lexical_realloc(ctx, &mem_111723, &mem_111723_cached_sizze_127317, bytes_111713);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    int64_t flat_tid_103888 = (int64_t) 0;
    struct futhark_mc_task_127359 futhark_mc_task_127359_;
    
    futhark_mc_task_127359_.ctx = ctx;
    futhark_mc_task_127359_.free_defunc_0_reduce_res_103765 = defunc_0_reduce_res_103765;
    futhark_mc_task_127359_.free_mem_111714 = mem_111714;
    futhark_mc_task_127359_.free_mem_111720 = mem_111720;
    futhark_mc_task_127359_.free_mem_111721 = mem_111721;
    futhark_mc_task_127359_.free_mem_111723 = mem_111723;
    
    struct scheduler_segop futhark_mc_task_127359_task;
    
    futhark_mc_task_127359_task.args = &futhark_mc_task_127359_;
    futhark_mc_task_127359_task.top_level_fn = futhark_mc_segscan_task_127360;
    futhark_mc_task_127359_task.name = "futhark_mc_segscan_task_127360";
    futhark_mc_task_127359_task.iterations = defunc_0_reduce_res_103765;
    futhark_mc_task_127359_task.task_time = &ctx->program->futhark_mc_segscan_task_127360_total_time;
    futhark_mc_task_127359_task.task_iter = &ctx->program->futhark_mc_segscan_task_127360_total_iter;
    futhark_mc_task_127359_task.sched = STATIC;
    futhark_mc_task_127359_task.nested_fn = NULL;
    
    int futhark_mc_segscan_task_127360_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127359_task);
    
    if (futhark_mc_segscan_task_127360_err != 0) {
        err = futhark_mc_segscan_task_127360_err;
        goto cleanup;
    }
    
    double zs_res_107134 = 1.0 / exp_absorb_cutoff_33394;
    double zp_res_108112 = 1.0 + tol_sinkhorn_33396;
    
    if (mem_111727_cached_sizze_127318 < bytes_111726) {
        err = lexical_realloc(ctx, &mem_111727, &mem_111727_cached_sizze_127318, bytes_111726);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    int64_t iterations_114883 = k_33387 * m_33388 * m_33388;
    struct futhark_mc_task_127372 futhark_mc_task_127372_;
    
    futhark_mc_task_127372_.ctx = ctx;
    futhark_mc_task_127372_.free_k_33387 = k_33387;
    futhark_mc_task_127372_.free_m_33388 = m_33388;
    futhark_mc_task_127372_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_task_127372_.free_mem_111727 = mem_111727;
    
    struct scheduler_segop futhark_mc_task_127372_task;
    
    futhark_mc_task_127372_task.args = &futhark_mc_task_127372_;
    futhark_mc_task_127372_task.top_level_fn = futhark_mc_copy_114882_task_127373;
    futhark_mc_task_127372_task.name = "futhark_mc_copy_114882_task_127373";
    futhark_mc_task_127372_task.iterations = iterations_114883;
    futhark_mc_task_127372_task.task_time = &ctx->program->futhark_mc_copy_114882_task_127373_total_time;
    futhark_mc_task_127372_task.task_iter = &ctx->program->futhark_mc_copy_114882_task_127373_total_iter;
    futhark_mc_task_127372_task.sched = STATIC;
    futhark_mc_task_127372_task.nested_fn = NULL;
    
    int futhark_mc_copy_114882_task_127373_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127372_task);
    
    if (futhark_mc_copy_114882_task_127373_err != 0) {
        err = futhark_mc_copy_114882_task_127373_err;
        goto cleanup;
    }
    
    int64_t bytes_111743 = m_33388 * bytes_111715;
    int64_t binop_y_114659 = m_33388 - (int64_t) 1;
    int64_t binop_x_114660 = smax64((int64_t) 0, binop_y_114659);
    int64_t binop_y_114661 = m_33388 * binop_x_114660;
    int64_t binop_x_114662 = smax64((int64_t) 0, binop_y_114661);
    int64_t binop_y_114666 = binop_x_114660 + binop_x_114662;
    int64_t binop_y_114667 = (int64_t) 1 + binop_y_114666;
    int64_t num_bytes_114668 = (int64_t) 8 * binop_y_114667;
    
    if (memblock_alloc(ctx, &mem_114063, bytes_114062, "mem_114063")) {
        err = 1;
        goto cleanup;
    }
    
    int64_t flat_tid_103890 = (int64_t) 0;
    int64_t flat_tid_106379 = (int64_t) 0;
    struct futhark_mc_task_127379 futhark_mc_task_127379_;
    
    futhark_mc_task_127379_.ctx = ctx;
    futhark_mc_task_127379_.free_k_33387 = k_33387;
    futhark_mc_task_127379_.free_m_33388 = m_33388;
    futhark_mc_task_127379_.free_rho1_33389 = rho1_33389;
    futhark_mc_task_127379_.free_rho2_33390 = rho2_33390;
    futhark_mc_task_127379_.free_eps_33391 = eps_33391;
    futhark_mc_task_127379_.free_exp_absorb_cutoff_33394 = exp_absorb_cutoff_33394;
    futhark_mc_task_127379_.free_safe_for_exp_33395 = safe_for_exp_33395;
    futhark_mc_task_127379_.free_tol_sinkhorn_33396 = tol_sinkhorn_33396;
    futhark_mc_task_127379_.free_neg_res_43882 = neg_res_43882;
    futhark_mc_task_127379_.free_zp_res_43884 = zp_res_43884;
    futhark_mc_task_127379_.free_zs_res_44842 = zs_res_44842;
    futhark_mc_task_127379_.free_zs_res_44844 = zs_res_44844;
    futhark_mc_task_127379_.free_zs_res_44883 = zs_res_44883;
    futhark_mc_task_127379_.free_zs_res_44885 = zs_res_44885;
    futhark_mc_task_127379_.free_zp_res_46827 = zp_res_46827;
    futhark_mc_task_127379_.free_defunc_0_reduce_res_103765 = defunc_0_reduce_res_103765;
    futhark_mc_task_127379_.free_zs_res_107134 = zs_res_107134;
    futhark_mc_task_127379_.free_zp_res_108112 = zp_res_108112;
    futhark_mc_task_127379_.free_A_mem_111707 = A_mem_111707.mem;
    futhark_mc_task_127379_.free_distrs_mem_111708 = distrs_mem_111708.mem;
    futhark_mc_task_127379_.free_bytes_111715 = bytes_111715;
    futhark_mc_task_127379_.free_mem_111716 = mem_111716;
    futhark_mc_task_127379_.free_mem_111719 = mem_111719;
    futhark_mc_task_127379_.free_mem_111723 = mem_111723;
    futhark_mc_task_127379_.free_bytes_111726 = bytes_111726;
    futhark_mc_task_127379_.free_mem_111727 = mem_111727;
    futhark_mc_task_127379_.free_bytes_111743 = bytes_111743;
    futhark_mc_task_127379_.free_mem_114063 = mem_114063.mem;
    futhark_mc_task_127379_.free_num_bytes_114668 = num_bytes_114668;
    
    struct scheduler_segop futhark_mc_task_127379_task;
    
    futhark_mc_task_127379_task.args = &futhark_mc_task_127379_;
    futhark_mc_task_127379_task.top_level_fn = futhark_mc_segmap_task_127380;
    futhark_mc_task_127379_task.name = "futhark_mc_segmap_task_127380";
    futhark_mc_task_127379_task.iterations = defunc_0_reduce_res_103765;
    futhark_mc_task_127379_task.task_time = &ctx->program->futhark_mc_segmap_task_127380_total_time;
    futhark_mc_task_127379_task.task_iter = &ctx->program->futhark_mc_segmap_task_127380_total_iter;
    futhark_mc_task_127379_task.sched = DYNAMIC;
    futhark_mc_task_127379_task.nested_fn = futhark_mc_segmap_nested_task_127431;
    
    int futhark_mc_segmap_task_127380_err = scheduler_prepare_task(&ctx->scheduler, &futhark_mc_task_127379_task);
    
    if (futhark_mc_segmap_task_127380_err != 0) {
        err = futhark_mc_segmap_task_127380_err;
        goto cleanup;
    }
    if (memblock_set(ctx, &mem_out_114751, &mem_114063, "mem_114063") != 0)
        return 1;
    prim_out_114752 = defunc_0_reduce_res_103765;
    if (memblock_set(ctx, &*mem_out_p_127307, &mem_out_114751, "mem_out_114751") != 0)
        return 1;
    *out_prim_out_127308 = prim_out_114752;
    
  cleanup:
    {
        free(mem_111710);
        free(mem_111712);
        free(mem_111714);
        free(mem_111716);
        free(mem_111717);
        free(mem_111719);
        free(mem_111720);
        free(mem_111721);
        free(mem_111723);
        free(mem_111727);
        if (memblock_unref(ctx, &mem_114063, "mem_114063") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_out_114751, "mem_out_114751") != 0)
            return 1;
    }
    return err;
}

int futhark_entry_ugw_armijo(struct futhark_context *ctx, struct futhark_f64_1d **out0, const double in0, const double in1, const double in2, const struct futhark_f64_2d *in3, const struct futhark_f64_1d *in4, const struct futhark_f64_2d *in5, const struct futhark_f64_1d *in6, const double in7, const double in8, const double in9, const double in10)
{
    int64_t mz2081Uz2084U_33563 = (int64_t) 0;
    double rho1_33564 = 0.0;
    double rho2_33565 = 0.0;
    double eps_33566 = 0.0;
    double exp_absorb_cutoff_33571 = 0.0;
    double safe_for_exp_33572 = 0.0;
    double tol_sinkhorn_33573 = 0.0;
    double tol_outerloop_33574 = 0.0;
    int ret = 0;
    
    lock_lock(&ctx->lock);
    worker_local = &ctx->scheduler.workers[0];
    
    struct memblock mem_out_114751;
    
    mem_out_114751.references = NULL;
    
    struct memblock nu_mem_111710;
    
    nu_mem_111710.references = NULL;
    
    struct memblock B_mem_111709;
    
    B_mem_111709.references = NULL;
    
    struct memblock mu_mem_111708;
    
    mu_mem_111708.references = NULL;
    
    struct memblock A_mem_111707;
    
    A_mem_111707.references = NULL;
    rho1_33564 = in0;
    rho2_33565 = in1;
    eps_33566 = in2;
    A_mem_111707 = in3->mem;
    mz2081Uz2084U_33563 = in3->shape[0];
    mz2081Uz2084U_33563 = in3->shape[1];
    mu_mem_111708 = in4->mem;
    mz2081Uz2084U_33563 = in4->shape[0];
    B_mem_111709 = in5->mem;
    mz2081Uz2084U_33563 = in5->shape[0];
    mz2081Uz2084U_33563 = in5->shape[1];
    nu_mem_111710 = in6->mem;
    mz2081Uz2084U_33563 = in6->shape[0];
    exp_absorb_cutoff_33571 = in7;
    safe_for_exp_33572 = in8;
    tol_sinkhorn_33573 = in9;
    tol_outerloop_33574 = in10;
    if (!((mz2081Uz2084U_33563 == in3->shape[0] && mz2081Uz2084U_33563 == in3->shape[1]) && (mz2081Uz2084U_33563 == in4->shape[0] && ((mz2081Uz2084U_33563 == in5->shape[0] && mz2081Uz2084U_33563 == in5->shape[1]) && mz2081Uz2084U_33563 == in6->shape[0])))) {
        ret = 1;
        set_error(ctx, msgprintf("Error: entry point arguments have invalid sizes.\n"));
    }
    if (ret == 0) {
        ret = futrts_entry_ugw_armijo(ctx, &mem_out_114751, A_mem_111707, mu_mem_111708, B_mem_111709, nu_mem_111710, mz2081Uz2084U_33563, rho1_33564, rho2_33565, eps_33566, exp_absorb_cutoff_33571, safe_for_exp_33572, tol_sinkhorn_33573, tol_outerloop_33574);
        if (ret == 0) {
            assert((*out0 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->mem = mem_out_114751;
            (*out0)->shape[0] = (int64_t) 5;
        }
    }
    lock_unlock(&ctx->lock);
    return ret;
}
int futhark_entry_ugw_armijo_euclidean(struct futhark_context *ctx, struct futhark_f64_2d **out0, const double in0, const double in1, const double in2, const struct futhark_f64_3d *in3, const double in4, const double in5, const double in6, const double in7)
{
    int64_t k_34109 = (int64_t) 0;
    int64_t m_34110 = (int64_t) 0;
    int64_t d_34111 = (int64_t) 0;
    double rho1_34112 = 0.0;
    double rho2_34113 = 0.0;
    double eps_34114 = 0.0;
    double exp_absorb_cutoff_34116 = 0.0;
    double safe_for_exp_34117 = 0.0;
    double tol_sinkhorn_34118 = 0.0;
    double tol_outerloop_34119 = 0.0;
    int64_t prim_out_114752 = (int64_t) 0;
    int ret = 0;
    
    lock_lock(&ctx->lock);
    worker_local = &ctx->scheduler.workers[0];
    
    struct memblock mem_out_114751;
    
    mem_out_114751.references = NULL;
    
    struct memblock pt_clouds_mem_111707;
    
    pt_clouds_mem_111707.references = NULL;
    rho1_34112 = in0;
    rho2_34113 = in1;
    eps_34114 = in2;
    pt_clouds_mem_111707 = in3->mem;
    k_34109 = in3->shape[0];
    m_34110 = in3->shape[1];
    d_34111 = in3->shape[2];
    exp_absorb_cutoff_34116 = in4;
    safe_for_exp_34117 = in5;
    tol_sinkhorn_34118 = in6;
    tol_outerloop_34119 = in7;
    if (!(k_34109 == in3->shape[0] && (m_34110 == in3->shape[1] && d_34111 == in3->shape[2]))) {
        ret = 1;
        set_error(ctx, msgprintf("Error: entry point arguments have invalid sizes.\n"));
    }
    if (ret == 0) {
        ret = futrts_entry_ugw_armijo_euclidean(ctx, &mem_out_114751, &prim_out_114752, pt_clouds_mem_111707, k_34109, m_34110, d_34111, rho1_34112, rho2_34113, eps_34114, exp_absorb_cutoff_34116, safe_for_exp_34117, tol_sinkhorn_34118, tol_outerloop_34119);
        if (ret == 0) {
            assert((*out0 = (struct futhark_f64_2d *) malloc(sizeof(struct futhark_f64_2d))) != NULL);
            (*out0)->mem = mem_out_114751;
            (*out0)->shape[0] = prim_out_114752;
            (*out0)->shape[1] = (int64_t) 5;
        }
    }
    lock_unlock(&ctx->lock);
    return ret;
}
int futhark_entry_ugw_armijo_pairwise(struct futhark_context *ctx, struct futhark_f64_2d **out0, const double in0, const double in1, const double in2, const struct futhark_f64_3d *in3, const struct futhark_f64_2d *in4, const double in5, const double in6, const double in7, const double in8)
{
    int64_t k_33497 = (int64_t) 0;
    int64_t m_33498 = (int64_t) 0;
    double rho1_33499 = 0.0;
    double rho2_33500 = 0.0;
    double eps_33501 = 0.0;
    double exp_absorb_cutoff_33504 = 0.0;
    double safe_for_exp_33505 = 0.0;
    double tol_sinkhorn_33506 = 0.0;
    double tol_outerloop_33507 = 0.0;
    int64_t prim_out_114752 = (int64_t) 0;
    int ret = 0;
    
    lock_lock(&ctx->lock);
    worker_local = &ctx->scheduler.workers[0];
    
    struct memblock mem_out_114751;
    
    mem_out_114751.references = NULL;
    
    struct memblock distrs_mem_111708;
    
    distrs_mem_111708.references = NULL;
    
    struct memblock A_mem_111707;
    
    A_mem_111707.references = NULL;
    rho1_33499 = in0;
    rho2_33500 = in1;
    eps_33501 = in2;
    A_mem_111707 = in3->mem;
    k_33497 = in3->shape[0];
    m_33498 = in3->shape[1];
    m_33498 = in3->shape[2];
    distrs_mem_111708 = in4->mem;
    k_33497 = in4->shape[0];
    m_33498 = in4->shape[1];
    exp_absorb_cutoff_33504 = in5;
    safe_for_exp_33505 = in6;
    tol_sinkhorn_33506 = in7;
    tol_outerloop_33507 = in8;
    if (!((k_33497 == in3->shape[0] && (m_33498 == in3->shape[1] && m_33498 == in3->shape[2])) && (k_33497 == in4->shape[0] && m_33498 == in4->shape[1]))) {
        ret = 1;
        set_error(ctx, msgprintf("Error: entry point arguments have invalid sizes.\n"));
    }
    if (ret == 0) {
        ret = futrts_entry_ugw_armijo_pairwise(ctx, &mem_out_114751, &prim_out_114752, A_mem_111707, distrs_mem_111708, k_33497, m_33498, rho1_33499, rho2_33500, eps_33501, exp_absorb_cutoff_33504, safe_for_exp_33505, tol_sinkhorn_33506, tol_outerloop_33507);
        if (ret == 0) {
            assert((*out0 = (struct futhark_f64_2d *) malloc(sizeof(struct futhark_f64_2d))) != NULL);
            (*out0)->mem = mem_out_114751;
            (*out0)->shape[0] = prim_out_114752;
            (*out0)->shape[1] = (int64_t) 5;
        }
    }
    lock_unlock(&ctx->lock);
    return ret;
}
int futhark_entry_ugw_armijo_pairwise_unif(struct futhark_context *ctx, struct futhark_f64_2d **out0, const double in0, const double in1, const double in2, const struct futhark_f64_3d *in3, const double in4, const double in5, const double in6, const double in7)
{
    int64_t k_33767 = (int64_t) 0;
    int64_t m_33768 = (int64_t) 0;
    double rho1_33769 = 0.0;
    double rho2_33770 = 0.0;
    double eps_33771 = 0.0;
    double exp_absorb_cutoff_33773 = 0.0;
    double safe_for_exp_33774 = 0.0;
    double tol_sinkhorn_33775 = 0.0;
    double tol_outerloop_33776 = 0.0;
    int64_t prim_out_114752 = (int64_t) 0;
    int ret = 0;
    
    lock_lock(&ctx->lock);
    worker_local = &ctx->scheduler.workers[0];
    
    struct memblock mem_out_114751;
    
    mem_out_114751.references = NULL;
    
    struct memblock A_mem_111707;
    
    A_mem_111707.references = NULL;
    rho1_33769 = in0;
    rho2_33770 = in1;
    eps_33771 = in2;
    A_mem_111707 = in3->mem;
    k_33767 = in3->shape[0];
    m_33768 = in3->shape[1];
    m_33768 = in3->shape[2];
    exp_absorb_cutoff_33773 = in4;
    safe_for_exp_33774 = in5;
    tol_sinkhorn_33775 = in6;
    tol_outerloop_33776 = in7;
    if (!(k_33767 == in3->shape[0] && (m_33768 == in3->shape[1] && m_33768 == in3->shape[2]))) {
        ret = 1;
        set_error(ctx, msgprintf("Error: entry point arguments have invalid sizes.\n"));
    }
    if (ret == 0) {
        ret = futrts_entry_ugw_armijo_pairwise_unif(ctx, &mem_out_114751, &prim_out_114752, A_mem_111707, k_33767, m_33768, rho1_33769, rho2_33770, eps_33771, exp_absorb_cutoff_33773, safe_for_exp_33774, tol_sinkhorn_33775, tol_outerloop_33776);
        if (ret == 0) {
            assert((*out0 = (struct futhark_f64_2d *) malloc(sizeof(struct futhark_f64_2d))) != NULL);
            (*out0)->mem = mem_out_114751;
            (*out0)->shape[0] = prim_out_114752;
            (*out0)->shape[1] = (int64_t) 5;
        }
    }
    lock_unlock(&ctx->lock);
    return ret;
}
  
