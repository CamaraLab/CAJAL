// Generated by Futhark 0.26.0 (prerelease - include info below when reporting bugs).
// Compiled with GHC 9.4.8.

// We need to define _GNU_SOURCE before
// _any_ headers files are imported to get
// the usage statistics of a thread (i.e. have RUSAGE_THREAD) on GNU/Linux
// https://manpages.courier-mta.org/htmlman2/getrusage.2.html
#ifndef _GNU_SOURCE // Avoid possible double-definition warning.
#define _GNU_SOURCE
#endif

#ifdef __clang__
#pragma clang diagnostic ignored "-Wunused-function"
#pragma clang diagnostic ignored "-Wunused-variable"
#pragma clang diagnostic ignored "-Wunused-const-variable"
#pragma clang diagnostic ignored "-Wparentheses"
#pragma clang diagnostic ignored "-Wunused-label"
#pragma clang diagnostic ignored "-Wunused-but-set-variable"
#elif __GNUC__
#pragma GCC diagnostic ignored "-Wunused-function"
#pragma GCC diagnostic ignored "-Wunused-variable"
#pragma GCC diagnostic ignored "-Wunused-const-variable"
#pragma GCC diagnostic ignored "-Wparentheses"
#pragma GCC diagnostic ignored "-Wunused-label"
#pragma GCC diagnostic ignored "-Wunused-but-set-variable"
#endif

// Headers
#include <stdint.h>
#include <stddef.h>
#include <stdbool.h>
#include <stdio.h>
#include <float.h>

#ifdef __cplusplus
extern "C" {
#endif

// Initialisation
struct futhark_context_config;
struct futhark_context_config *futhark_context_config_new(void);
void futhark_context_config_free(struct futhark_context_config *cfg);
int futhark_context_config_set_tuning_param(struct futhark_context_config *cfg, const char *param_name, size_t new_value);
struct futhark_context;
struct futhark_context *futhark_context_new(struct futhark_context_config *cfg);
void futhark_context_free(struct futhark_context *cfg);
void futhark_context_config_set_debugging(struct futhark_context_config *cfg, int flag);
void futhark_context_config_set_profiling(struct futhark_context_config *cfg, int flag);
void futhark_context_config_set_logging(struct futhark_context_config *cfg, int flag);
int futhark_get_tuning_param_count(void);
const char *futhark_get_tuning_param_name(int);
const char *futhark_get_tuning_param_class(int);

// Arrays
struct futhark_f64_1d;
struct futhark_f64_1d *futhark_new_f64_1d(struct futhark_context *ctx, const double *data, int64_t dim0);
struct futhark_f64_1d *futhark_new_raw_f64_1d(struct futhark_context *ctx, unsigned char *data, int64_t dim0);
int futhark_free_f64_1d(struct futhark_context *ctx, struct futhark_f64_1d *arr);
int futhark_values_f64_1d(struct futhark_context *ctx, struct futhark_f64_1d *arr, double *data);
int futhark_index_f64_1d(struct futhark_context *ctx, double *out, struct futhark_f64_1d *arr, int64_t i0);
unsigned char *futhark_values_raw_f64_1d(struct futhark_context *ctx, struct futhark_f64_1d *arr);
const int64_t *futhark_shape_f64_1d(struct futhark_context *ctx, struct futhark_f64_1d *arr);
struct futhark_f64_2d;
struct futhark_f64_2d *futhark_new_f64_2d(struct futhark_context *ctx, const double *data, int64_t dim0, int64_t dim1);
struct futhark_f64_2d *futhark_new_raw_f64_2d(struct futhark_context *ctx, unsigned char *data, int64_t dim0, int64_t dim1);
int futhark_free_f64_2d(struct futhark_context *ctx, struct futhark_f64_2d *arr);
int futhark_values_f64_2d(struct futhark_context *ctx, struct futhark_f64_2d *arr, double *data);
int futhark_index_f64_2d(struct futhark_context *ctx, double *out, struct futhark_f64_2d *arr, int64_t i0, int64_t i1);
unsigned char *futhark_values_raw_f64_2d(struct futhark_context *ctx, struct futhark_f64_2d *arr);
const int64_t *futhark_shape_f64_2d(struct futhark_context *ctx, struct futhark_f64_2d *arr);
struct futhark_f64_3d;
struct futhark_f64_3d *futhark_new_f64_3d(struct futhark_context *ctx, const double *data, int64_t dim0, int64_t dim1, int64_t dim2);
struct futhark_f64_3d *futhark_new_raw_f64_3d(struct futhark_context *ctx, unsigned char *data, int64_t dim0, int64_t dim1, int64_t dim2);
int futhark_free_f64_3d(struct futhark_context *ctx, struct futhark_f64_3d *arr);
int futhark_values_f64_3d(struct futhark_context *ctx, struct futhark_f64_3d *arr, double *data);
int futhark_index_f64_3d(struct futhark_context *ctx, double *out, struct futhark_f64_3d *arr, int64_t i0, int64_t i1, int64_t i2);
unsigned char *futhark_values_raw_f64_3d(struct futhark_context *ctx, struct futhark_f64_3d *arr);
const int64_t *futhark_shape_f64_3d(struct futhark_context *ctx, struct futhark_f64_3d *arr);

// Opaque values



// Entry points
int futhark_entry_ugw_armijo(struct futhark_context *ctx, struct futhark_f64_1d **out0, const double in0, const double in1, const double in2, const struct futhark_f64_2d *in3, const struct futhark_f64_1d *in4, const struct futhark_f64_2d *in5, const struct futhark_f64_1d *in6, const double in7, const double in8, const double in9, const double in10);
int futhark_entry_ugw_armijo_euclidean(struct futhark_context *ctx, struct futhark_f64_2d **out0, const double in0, const double in1, const double in2, const struct futhark_f64_3d *in3, const double in4, const double in5, const double in6, const double in7);
int futhark_entry_ugw_armijo_pairwise(struct futhark_context *ctx, struct futhark_f64_2d **out0, const double in0, const double in1, const double in2, const struct futhark_f64_3d *in3, const struct futhark_f64_2d *in4, const double in5, const double in6, const double in7, const double in8);
int futhark_entry_ugw_armijo_pairwise_increasing(struct futhark_context *ctx, struct futhark_f64_2d **out0, const struct futhark_f64_2d *in0, const double in1, const double in2, const double in3, const double in4, const struct futhark_f64_3d *in5, const struct futhark_f64_2d *in6, const double in7, const double in8, const double in9, const double in10);
int futhark_entry_ugw_armijo_pairwise_unif(struct futhark_context *ctx, struct futhark_f64_2d **out0, const double in0, const double in1, const double in2, const struct futhark_f64_3d *in3, const double in4, const double in5, const double in6, const double in7);

// Miscellaneous
int futhark_context_sync(struct futhark_context *ctx);
void futhark_context_config_set_cache_file(struct futhark_context_config *cfg, const char *f);
char *futhark_context_get_error(struct futhark_context *ctx);
void futhark_context_set_logging_file(struct futhark_context *ctx, FILE *f);
void futhark_context_pause_profiling(struct futhark_context *ctx);
void futhark_context_unpause_profiling(struct futhark_context *ctx);
char *futhark_context_report(struct futhark_context *ctx);
int futhark_context_clear_caches(struct futhark_context *ctx);
#define FUTHARK_BACKEND_c
#define FUTHARK_SUCCESS 0
#define FUTHARK_PROGRAM_ERROR 2
#define FUTHARK_OUT_OF_MEMORY 3

#ifdef __cplusplus
}
#endif

#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>
#include <math.h>
#include <stdint.h>
// If NDEBUG is set, the assert() macro will do nothing. Since Futhark
// (unfortunately) makes use of assert() for error detection (and even some
// side effects), we want to avoid that.
#undef NDEBUG
#include <assert.h>
#include <stdarg.h>
#define SCALAR_FUN_ATTR static inline
// Start of util.h.
//
// Various helper functions that are useful in all generated C code.

#include <errno.h>
#include <string.h>

static const char *fut_progname = "(embedded Futhark)";

static void futhark_panic(int eval, const char *fmt, ...) __attribute__((noreturn));
static char* msgprintf(const char *s, ...);
static void* slurp_file(const char *filename, size_t *size);
static int dump_file(const char *file, const void *buf, size_t n);
struct str_builder;
static void str_builder_init(struct str_builder *b);
static void str_builder(struct str_builder *b, const char *s, ...);
static char *strclone(const char *str);

static void futhark_panic(int eval, const char *fmt, ...) {
  va_list ap;
  va_start(ap, fmt);
  fprintf(stderr, "%s: ", fut_progname);
  vfprintf(stderr, fmt, ap);
  va_end(ap);
  exit(eval);
}

// For generating arbitrary-sized error messages.  It is the callers
// responsibility to free the buffer at some point.
static char* msgprintf(const char *s, ...) {
  va_list vl;
  va_start(vl, s);
  size_t needed = 1 + (size_t)vsnprintf(NULL, 0, s, vl);
  char *buffer = (char*) malloc(needed);
  va_start(vl, s); // Must re-init.
  vsnprintf(buffer, needed, s, vl);
  return buffer;
}

static inline void check_err(int errval, int sets_errno, const char *fun, int line,
                             const char *msg, ...) {
  if (errval) {
    char errnum[10];

    va_list vl;
    va_start(vl, msg);

    fprintf(stderr, "ERROR: ");
    vfprintf(stderr, msg, vl);
    fprintf(stderr, " in %s() at line %d with error code %s\n",
            fun, line,
            sets_errno ? strerror(errno) : errnum);
    exit(errval);
  }
}

#define CHECK_ERR(err, ...) check_err(err, 0, __func__, __LINE__, __VA_ARGS__)
#define CHECK_ERRNO(err, ...) check_err(err, 1, __func__, __LINE__, __VA_ARGS__)

// Read the rest of an open file into a NUL-terminated string; returns
// NULL on error.
static void* fslurp_file(FILE *f, size_t *size) {
  long start = ftell(f);
  fseek(f, 0, SEEK_END);
  long src_size = ftell(f)-start;
  fseek(f, start, SEEK_SET);
  unsigned char *s = (unsigned char*) malloc((size_t)src_size + 1);
  if (fread(s, 1, (size_t)src_size, f) != (size_t)src_size) {
    free(s);
    s = NULL;
  } else {
    s[src_size] = '\0';
  }

  if (size) {
    *size = (size_t)src_size;
  }

  return s;
}

// Read a file into a NUL-terminated string; returns NULL on error.
static void* slurp_file(const char *filename, size_t *size) {
  FILE *f = fopen(filename, "rb"); // To avoid Windows messing with linebreaks.
  if (f == NULL) return NULL;
  unsigned char *s = fslurp_file(f, size);
  fclose(f);
  return s;
}

// Dump 'n' bytes from 'buf' into the file at the designated location.
// Returns 0 on success.
static int dump_file(const char *file, const void *buf, size_t n) {
  FILE *f = fopen(file, "w");

  if (f == NULL) {
    return 1;
  }

  if (fwrite(buf, sizeof(char), n, f) != n) {
    return 1;
  }

  if (fclose(f) != 0) {
    return 1;
  }

  return 0;
}

struct str_builder {
  char *str;
  size_t capacity; // Size of buffer.
  size_t used; // Bytes used, *not* including final zero.
};

static void str_builder_init(struct str_builder *b) {
  b->capacity = 10;
  b->used = 0;
  b->str = malloc(b->capacity);
  b->str[0] = 0;
}

static void str_builder(struct str_builder *b, const char *s, ...) {
  va_list vl;
  va_start(vl, s);
  size_t needed = (size_t)vsnprintf(NULL, 0, s, vl);

  while (b->capacity < b->used + needed + 1) {
    b->capacity *= 2;
    b->str = realloc(b->str, b->capacity);
  }

  va_start(vl, s); // Must re-init.
  vsnprintf(b->str+b->used, b->capacity-b->used, s, vl);
  b->used += needed;
}

static void str_builder_str(struct str_builder *b, const char *s) {
  size_t needed = strlen(s);
  if (b->capacity < b->used + needed + 1) {
    b->capacity *= 2;
    b->str = realloc(b->str, b->capacity);
  }
  strcpy(b->str+b->used, s);
  b->used += needed;
}

static void str_builder_char(struct str_builder *b, char c) {
  size_t needed = 1;
  if (b->capacity < b->used + needed + 1) {
    b->capacity *= 2;
    b->str = realloc(b->str, b->capacity);
  }
  b->str[b->used] = c;
  b->str[b->used+1] = 0;
  b->used += needed;
}

static void str_builder_json_str(struct str_builder* sb, const char* s) {
  str_builder_char(sb, '"');
  for (int j = 0; s[j]; j++) {
    char c = s[j];
    switch (c) {
    case '\n':
      str_builder_str(sb, "\\n");
      break;
    case '"':
      str_builder_str(sb, "\\\"");
      break;
    default:
      str_builder_char(sb, c);
    }
  }
  str_builder_char(sb, '"');
}

static char *strclone(const char *str) {
  size_t size = strlen(str) + 1;
  char *copy = (char*) malloc(size);
  if (copy == NULL) {
    return NULL;
  }

  memcpy(copy, str, size);
  return copy;
}

// Assumes NULL-terminated.
static char *strconcat(const char *src_fragments[]) {
  size_t src_len = 0;
  const char **p;

  for (p = src_fragments; *p; p++) {
    src_len += strlen(*p);
  }

  char *src = (char*) malloc(src_len + 1);
  size_t n = 0;
  for (p = src_fragments; *p; p++) {
    strcpy(src + n, *p);
    n += strlen(*p);
  }

  return src;
}

// End of util.h.
// Start of cache.h

#define CACHE_HASH_SIZE 8 // In 32-bit words.

struct cache_hash {
  uint32_t hash[CACHE_HASH_SIZE];
};

// Initialise a blank cache.
static void cache_hash_init(struct cache_hash *c);

// Hash some bytes and add them to the accumulated hash.
static void cache_hash(struct cache_hash *out, const char *in, size_t n);

// Try to restore cache contents from a file with the given name.
// Assumes the cache is invalid if it contains the given hash.
// Allocates memory and reads the cache conents, which is returned in
// *buf with size *buflen.  If the cache is successfully loaded, this
// function returns 0.  Otherwise it returns nonzero.  Errno is set if
// the failure to load the cache is due to anything except invalid
// cache conents.  Note that failing to restore the cache is not
// necessarily a problem: it might just be invalid or not created yet.
static int cache_restore(const char *fname, const struct cache_hash *hash,
                         unsigned char **buf, size_t *buflen);

// Store cache contents in the given file, with the given hash.
static int cache_store(const char *fname, const struct cache_hash *hash,
                       const unsigned char *buf, size_t buflen);

// Now for the implementation.

static void cache_hash_init(struct cache_hash *c) {
  memset(c->hash, 0, CACHE_HASH_SIZE * sizeof(uint32_t));
}

static void cache_hash(struct cache_hash *out, const char *in, size_t n) {
  // Adaptation of djb2 for larger output size by storing intermediate
  // states.
  uint32_t hash = 5381;
  for (size_t i = 0; i < n; i++) {
    hash = ((hash << 5) + hash) + in[i];
    out->hash[i % CACHE_HASH_SIZE] ^= hash;
  }
}

#define CACHE_HEADER_SIZE 8
static const char cache_header[CACHE_HEADER_SIZE] = "FUTHARK\0";

static int cache_restore(const char *fname, const struct cache_hash *hash,
                         unsigned char **buf, size_t *buflen) {
  FILE *f = fopen(fname, "rb");

  if (f == NULL) {
    return 1;
  }

  char f_header[CACHE_HEADER_SIZE];

  if (fread(f_header, sizeof(char), CACHE_HEADER_SIZE, f) != CACHE_HEADER_SIZE) {
    goto error;
  }

  if (memcmp(f_header, cache_header, CACHE_HEADER_SIZE) != 0) {
    goto error;
  }

  if (fseek(f, 0, SEEK_END) != 0) {
    goto error;
  }
  int64_t f_size = (int64_t)ftell(f);
  if (fseek(f, CACHE_HEADER_SIZE, SEEK_SET) != 0) {
    goto error;
  }

  int64_t expected_size;

  if (fread(&expected_size, sizeof(int64_t), 1, f) != 1) {
    goto error;
  }

  if (f_size != expected_size) {
    errno = 0;
    goto error;
  }

  int32_t f_hash[CACHE_HASH_SIZE];

  if (fread(f_hash, sizeof(int32_t), CACHE_HASH_SIZE, f) != CACHE_HASH_SIZE) {
    goto error;
  }

  if (memcmp(f_hash, hash->hash, CACHE_HASH_SIZE) != 0) {
    errno = 0;
    goto error;
  }

  *buflen = f_size - CACHE_HEADER_SIZE - sizeof(int64_t) - CACHE_HASH_SIZE*sizeof(int32_t);
  *buf = malloc(*buflen);
  if (fread(*buf, sizeof(char), *buflen, f) != *buflen) {
    free(*buf);
    goto error;
  }

  fclose(f);

  return 0;

 error:
  fclose(f);
  return 1;
}

static int cache_store(const char *fname, const struct cache_hash *hash,
                       const unsigned char *buf, size_t buflen) {
  FILE *f = fopen(fname, "wb");

  if (f == NULL) {
    return 1;
  }

  if (fwrite(cache_header, CACHE_HEADER_SIZE, 1, f) != 1) {
    goto error;
  }

  int64_t size = CACHE_HEADER_SIZE + sizeof(int64_t) + CACHE_HASH_SIZE*sizeof(int32_t) + buflen;

  if (fwrite(&size, sizeof(size), 1, f) != 1) {
    goto error;
  }

  if (fwrite(hash->hash, sizeof(int32_t), CACHE_HASH_SIZE, f) != CACHE_HASH_SIZE) {
    goto error;
  }

  if (fwrite(buf, sizeof(unsigned char), buflen, f) != buflen) {
    goto error;
  }

  fclose(f);

  return 0;

 error:
  fclose(f);
  return 1;
}

// End of cache.h
// Start of half.h.

// Conversion functions are from http://half.sourceforge.net/, but
// translated to C.
//
// Copyright (c) 2012-2021 Christian Rau
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.

#ifndef __OPENCL_VERSION__
#define __constant
#endif

__constant static const uint16_t base_table[512] = {
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0001, 0x0002, 0x0004, 0x0008, 0x0010, 0x0020, 0x0040, 0x0080, 0x0100,
  0x0200, 0x0400, 0x0800, 0x0C00, 0x1000, 0x1400, 0x1800, 0x1C00, 0x2000, 0x2400, 0x2800, 0x2C00, 0x3000, 0x3400, 0x3800, 0x3C00,
  0x4000, 0x4400, 0x4800, 0x4C00, 0x5000, 0x5400, 0x5800, 0x5C00, 0x6000, 0x6400, 0x6800, 0x6C00, 0x7000, 0x7400, 0x7800, 0x7C00,
  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,
  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,
  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,
  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,
  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,
  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,
  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,
  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,
  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,
  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,
  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,
  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,
  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,
  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8001, 0x8002, 0x8004, 0x8008, 0x8010, 0x8020, 0x8040, 0x8080, 0x8100,
  0x8200, 0x8400, 0x8800, 0x8C00, 0x9000, 0x9400, 0x9800, 0x9C00, 0xA000, 0xA400, 0xA800, 0xAC00, 0xB000, 0xB400, 0xB800, 0xBC00,
  0xC000, 0xC400, 0xC800, 0xCC00, 0xD000, 0xD400, 0xD800, 0xDC00, 0xE000, 0xE400, 0xE800, 0xEC00, 0xF000, 0xF400, 0xF800, 0xFC00,
  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,
  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,
  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,
  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,
  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,
  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,
  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00 };

__constant static const unsigned char shift_table[512] = {
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 23, 22, 21, 20, 19, 18, 17, 16, 15, 14, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13,
  13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 13,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 23, 22, 21, 20, 19, 18, 17, 16, 15, 14, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13,
  13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 13 };

__constant static const uint32_t mantissa_table[2048] = {
  0x00000000, 0x33800000, 0x34000000, 0x34400000, 0x34800000, 0x34A00000, 0x34C00000, 0x34E00000, 0x35000000, 0x35100000, 0x35200000, 0x35300000, 0x35400000, 0x35500000, 0x35600000, 0x35700000,
  0x35800000, 0x35880000, 0x35900000, 0x35980000, 0x35A00000, 0x35A80000, 0x35B00000, 0x35B80000, 0x35C00000, 0x35C80000, 0x35D00000, 0x35D80000, 0x35E00000, 0x35E80000, 0x35F00000, 0x35F80000,
  0x36000000, 0x36040000, 0x36080000, 0x360C0000, 0x36100000, 0x36140000, 0x36180000, 0x361C0000, 0x36200000, 0x36240000, 0x36280000, 0x362C0000, 0x36300000, 0x36340000, 0x36380000, 0x363C0000,
  0x36400000, 0x36440000, 0x36480000, 0x364C0000, 0x36500000, 0x36540000, 0x36580000, 0x365C0000, 0x36600000, 0x36640000, 0x36680000, 0x366C0000, 0x36700000, 0x36740000, 0x36780000, 0x367C0000,
  0x36800000, 0x36820000, 0x36840000, 0x36860000, 0x36880000, 0x368A0000, 0x368C0000, 0x368E0000, 0x36900000, 0x36920000, 0x36940000, 0x36960000, 0x36980000, 0x369A0000, 0x369C0000, 0x369E0000,
  0x36A00000, 0x36A20000, 0x36A40000, 0x36A60000, 0x36A80000, 0x36AA0000, 0x36AC0000, 0x36AE0000, 0x36B00000, 0x36B20000, 0x36B40000, 0x36B60000, 0x36B80000, 0x36BA0000, 0x36BC0000, 0x36BE0000,
  0x36C00000, 0x36C20000, 0x36C40000, 0x36C60000, 0x36C80000, 0x36CA0000, 0x36CC0000, 0x36CE0000, 0x36D00000, 0x36D20000, 0x36D40000, 0x36D60000, 0x36D80000, 0x36DA0000, 0x36DC0000, 0x36DE0000,
  0x36E00000, 0x36E20000, 0x36E40000, 0x36E60000, 0x36E80000, 0x36EA0000, 0x36EC0000, 0x36EE0000, 0x36F00000, 0x36F20000, 0x36F40000, 0x36F60000, 0x36F80000, 0x36FA0000, 0x36FC0000, 0x36FE0000,
  0x37000000, 0x37010000, 0x37020000, 0x37030000, 0x37040000, 0x37050000, 0x37060000, 0x37070000, 0x37080000, 0x37090000, 0x370A0000, 0x370B0000, 0x370C0000, 0x370D0000, 0x370E0000, 0x370F0000,
  0x37100000, 0x37110000, 0x37120000, 0x37130000, 0x37140000, 0x37150000, 0x37160000, 0x37170000, 0x37180000, 0x37190000, 0x371A0000, 0x371B0000, 0x371C0000, 0x371D0000, 0x371E0000, 0x371F0000,
  0x37200000, 0x37210000, 0x37220000, 0x37230000, 0x37240000, 0x37250000, 0x37260000, 0x37270000, 0x37280000, 0x37290000, 0x372A0000, 0x372B0000, 0x372C0000, 0x372D0000, 0x372E0000, 0x372F0000,
  0x37300000, 0x37310000, 0x37320000, 0x37330000, 0x37340000, 0x37350000, 0x37360000, 0x37370000, 0x37380000, 0x37390000, 0x373A0000, 0x373B0000, 0x373C0000, 0x373D0000, 0x373E0000, 0x373F0000,
  0x37400000, 0x37410000, 0x37420000, 0x37430000, 0x37440000, 0x37450000, 0x37460000, 0x37470000, 0x37480000, 0x37490000, 0x374A0000, 0x374B0000, 0x374C0000, 0x374D0000, 0x374E0000, 0x374F0000,
  0x37500000, 0x37510000, 0x37520000, 0x37530000, 0x37540000, 0x37550000, 0x37560000, 0x37570000, 0x37580000, 0x37590000, 0x375A0000, 0x375B0000, 0x375C0000, 0x375D0000, 0x375E0000, 0x375F0000,
  0x37600000, 0x37610000, 0x37620000, 0x37630000, 0x37640000, 0x37650000, 0x37660000, 0x37670000, 0x37680000, 0x37690000, 0x376A0000, 0x376B0000, 0x376C0000, 0x376D0000, 0x376E0000, 0x376F0000,
  0x37700000, 0x37710000, 0x37720000, 0x37730000, 0x37740000, 0x37750000, 0x37760000, 0x37770000, 0x37780000, 0x37790000, 0x377A0000, 0x377B0000, 0x377C0000, 0x377D0000, 0x377E0000, 0x377F0000,
  0x37800000, 0x37808000, 0x37810000, 0x37818000, 0x37820000, 0x37828000, 0x37830000, 0x37838000, 0x37840000, 0x37848000, 0x37850000, 0x37858000, 0x37860000, 0x37868000, 0x37870000, 0x37878000,
  0x37880000, 0x37888000, 0x37890000, 0x37898000, 0x378A0000, 0x378A8000, 0x378B0000, 0x378B8000, 0x378C0000, 0x378C8000, 0x378D0000, 0x378D8000, 0x378E0000, 0x378E8000, 0x378F0000, 0x378F8000,
  0x37900000, 0x37908000, 0x37910000, 0x37918000, 0x37920000, 0x37928000, 0x37930000, 0x37938000, 0x37940000, 0x37948000, 0x37950000, 0x37958000, 0x37960000, 0x37968000, 0x37970000, 0x37978000,
  0x37980000, 0x37988000, 0x37990000, 0x37998000, 0x379A0000, 0x379A8000, 0x379B0000, 0x379B8000, 0x379C0000, 0x379C8000, 0x379D0000, 0x379D8000, 0x379E0000, 0x379E8000, 0x379F0000, 0x379F8000,
  0x37A00000, 0x37A08000, 0x37A10000, 0x37A18000, 0x37A20000, 0x37A28000, 0x37A30000, 0x37A38000, 0x37A40000, 0x37A48000, 0x37A50000, 0x37A58000, 0x37A60000, 0x37A68000, 0x37A70000, 0x37A78000,
  0x37A80000, 0x37A88000, 0x37A90000, 0x37A98000, 0x37AA0000, 0x37AA8000, 0x37AB0000, 0x37AB8000, 0x37AC0000, 0x37AC8000, 0x37AD0000, 0x37AD8000, 0x37AE0000, 0x37AE8000, 0x37AF0000, 0x37AF8000,
  0x37B00000, 0x37B08000, 0x37B10000, 0x37B18000, 0x37B20000, 0x37B28000, 0x37B30000, 0x37B38000, 0x37B40000, 0x37B48000, 0x37B50000, 0x37B58000, 0x37B60000, 0x37B68000, 0x37B70000, 0x37B78000,
  0x37B80000, 0x37B88000, 0x37B90000, 0x37B98000, 0x37BA0000, 0x37BA8000, 0x37BB0000, 0x37BB8000, 0x37BC0000, 0x37BC8000, 0x37BD0000, 0x37BD8000, 0x37BE0000, 0x37BE8000, 0x37BF0000, 0x37BF8000,
  0x37C00000, 0x37C08000, 0x37C10000, 0x37C18000, 0x37C20000, 0x37C28000, 0x37C30000, 0x37C38000, 0x37C40000, 0x37C48000, 0x37C50000, 0x37C58000, 0x37C60000, 0x37C68000, 0x37C70000, 0x37C78000,
  0x37C80000, 0x37C88000, 0x37C90000, 0x37C98000, 0x37CA0000, 0x37CA8000, 0x37CB0000, 0x37CB8000, 0x37CC0000, 0x37CC8000, 0x37CD0000, 0x37CD8000, 0x37CE0000, 0x37CE8000, 0x37CF0000, 0x37CF8000,
  0x37D00000, 0x37D08000, 0x37D10000, 0x37D18000, 0x37D20000, 0x37D28000, 0x37D30000, 0x37D38000, 0x37D40000, 0x37D48000, 0x37D50000, 0x37D58000, 0x37D60000, 0x37D68000, 0x37D70000, 0x37D78000,
  0x37D80000, 0x37D88000, 0x37D90000, 0x37D98000, 0x37DA0000, 0x37DA8000, 0x37DB0000, 0x37DB8000, 0x37DC0000, 0x37DC8000, 0x37DD0000, 0x37DD8000, 0x37DE0000, 0x37DE8000, 0x37DF0000, 0x37DF8000,
  0x37E00000, 0x37E08000, 0x37E10000, 0x37E18000, 0x37E20000, 0x37E28000, 0x37E30000, 0x37E38000, 0x37E40000, 0x37E48000, 0x37E50000, 0x37E58000, 0x37E60000, 0x37E68000, 0x37E70000, 0x37E78000,
  0x37E80000, 0x37E88000, 0x37E90000, 0x37E98000, 0x37EA0000, 0x37EA8000, 0x37EB0000, 0x37EB8000, 0x37EC0000, 0x37EC8000, 0x37ED0000, 0x37ED8000, 0x37EE0000, 0x37EE8000, 0x37EF0000, 0x37EF8000,
  0x37F00000, 0x37F08000, 0x37F10000, 0x37F18000, 0x37F20000, 0x37F28000, 0x37F30000, 0x37F38000, 0x37F40000, 0x37F48000, 0x37F50000, 0x37F58000, 0x37F60000, 0x37F68000, 0x37F70000, 0x37F78000,
  0x37F80000, 0x37F88000, 0x37F90000, 0x37F98000, 0x37FA0000, 0x37FA8000, 0x37FB0000, 0x37FB8000, 0x37FC0000, 0x37FC8000, 0x37FD0000, 0x37FD8000, 0x37FE0000, 0x37FE8000, 0x37FF0000, 0x37FF8000,
  0x38000000, 0x38004000, 0x38008000, 0x3800C000, 0x38010000, 0x38014000, 0x38018000, 0x3801C000, 0x38020000, 0x38024000, 0x38028000, 0x3802C000, 0x38030000, 0x38034000, 0x38038000, 0x3803C000,
  0x38040000, 0x38044000, 0x38048000, 0x3804C000, 0x38050000, 0x38054000, 0x38058000, 0x3805C000, 0x38060000, 0x38064000, 0x38068000, 0x3806C000, 0x38070000, 0x38074000, 0x38078000, 0x3807C000,
  0x38080000, 0x38084000, 0x38088000, 0x3808C000, 0x38090000, 0x38094000, 0x38098000, 0x3809C000, 0x380A0000, 0x380A4000, 0x380A8000, 0x380AC000, 0x380B0000, 0x380B4000, 0x380B8000, 0x380BC000,
  0x380C0000, 0x380C4000, 0x380C8000, 0x380CC000, 0x380D0000, 0x380D4000, 0x380D8000, 0x380DC000, 0x380E0000, 0x380E4000, 0x380E8000, 0x380EC000, 0x380F0000, 0x380F4000, 0x380F8000, 0x380FC000,
  0x38100000, 0x38104000, 0x38108000, 0x3810C000, 0x38110000, 0x38114000, 0x38118000, 0x3811C000, 0x38120000, 0x38124000, 0x38128000, 0x3812C000, 0x38130000, 0x38134000, 0x38138000, 0x3813C000,
  0x38140000, 0x38144000, 0x38148000, 0x3814C000, 0x38150000, 0x38154000, 0x38158000, 0x3815C000, 0x38160000, 0x38164000, 0x38168000, 0x3816C000, 0x38170000, 0x38174000, 0x38178000, 0x3817C000,
  0x38180000, 0x38184000, 0x38188000, 0x3818C000, 0x38190000, 0x38194000, 0x38198000, 0x3819C000, 0x381A0000, 0x381A4000, 0x381A8000, 0x381AC000, 0x381B0000, 0x381B4000, 0x381B8000, 0x381BC000,
  0x381C0000, 0x381C4000, 0x381C8000, 0x381CC000, 0x381D0000, 0x381D4000, 0x381D8000, 0x381DC000, 0x381E0000, 0x381E4000, 0x381E8000, 0x381EC000, 0x381F0000, 0x381F4000, 0x381F8000, 0x381FC000,
  0x38200000, 0x38204000, 0x38208000, 0x3820C000, 0x38210000, 0x38214000, 0x38218000, 0x3821C000, 0x38220000, 0x38224000, 0x38228000, 0x3822C000, 0x38230000, 0x38234000, 0x38238000, 0x3823C000,
  0x38240000, 0x38244000, 0x38248000, 0x3824C000, 0x38250000, 0x38254000, 0x38258000, 0x3825C000, 0x38260000, 0x38264000, 0x38268000, 0x3826C000, 0x38270000, 0x38274000, 0x38278000, 0x3827C000,
  0x38280000, 0x38284000, 0x38288000, 0x3828C000, 0x38290000, 0x38294000, 0x38298000, 0x3829C000, 0x382A0000, 0x382A4000, 0x382A8000, 0x382AC000, 0x382B0000, 0x382B4000, 0x382B8000, 0x382BC000,
  0x382C0000, 0x382C4000, 0x382C8000, 0x382CC000, 0x382D0000, 0x382D4000, 0x382D8000, 0x382DC000, 0x382E0000, 0x382E4000, 0x382E8000, 0x382EC000, 0x382F0000, 0x382F4000, 0x382F8000, 0x382FC000,
  0x38300000, 0x38304000, 0x38308000, 0x3830C000, 0x38310000, 0x38314000, 0x38318000, 0x3831C000, 0x38320000, 0x38324000, 0x38328000, 0x3832C000, 0x38330000, 0x38334000, 0x38338000, 0x3833C000,
  0x38340000, 0x38344000, 0x38348000, 0x3834C000, 0x38350000, 0x38354000, 0x38358000, 0x3835C000, 0x38360000, 0x38364000, 0x38368000, 0x3836C000, 0x38370000, 0x38374000, 0x38378000, 0x3837C000,
  0x38380000, 0x38384000, 0x38388000, 0x3838C000, 0x38390000, 0x38394000, 0x38398000, 0x3839C000, 0x383A0000, 0x383A4000, 0x383A8000, 0x383AC000, 0x383B0000, 0x383B4000, 0x383B8000, 0x383BC000,
  0x383C0000, 0x383C4000, 0x383C8000, 0x383CC000, 0x383D0000, 0x383D4000, 0x383D8000, 0x383DC000, 0x383E0000, 0x383E4000, 0x383E8000, 0x383EC000, 0x383F0000, 0x383F4000, 0x383F8000, 0x383FC000,
  0x38400000, 0x38404000, 0x38408000, 0x3840C000, 0x38410000, 0x38414000, 0x38418000, 0x3841C000, 0x38420000, 0x38424000, 0x38428000, 0x3842C000, 0x38430000, 0x38434000, 0x38438000, 0x3843C000,
  0x38440000, 0x38444000, 0x38448000, 0x3844C000, 0x38450000, 0x38454000, 0x38458000, 0x3845C000, 0x38460000, 0x38464000, 0x38468000, 0x3846C000, 0x38470000, 0x38474000, 0x38478000, 0x3847C000,
  0x38480000, 0x38484000, 0x38488000, 0x3848C000, 0x38490000, 0x38494000, 0x38498000, 0x3849C000, 0x384A0000, 0x384A4000, 0x384A8000, 0x384AC000, 0x384B0000, 0x384B4000, 0x384B8000, 0x384BC000,
  0x384C0000, 0x384C4000, 0x384C8000, 0x384CC000, 0x384D0000, 0x384D4000, 0x384D8000, 0x384DC000, 0x384E0000, 0x384E4000, 0x384E8000, 0x384EC000, 0x384F0000, 0x384F4000, 0x384F8000, 0x384FC000,
  0x38500000, 0x38504000, 0x38508000, 0x3850C000, 0x38510000, 0x38514000, 0x38518000, 0x3851C000, 0x38520000, 0x38524000, 0x38528000, 0x3852C000, 0x38530000, 0x38534000, 0x38538000, 0x3853C000,
  0x38540000, 0x38544000, 0x38548000, 0x3854C000, 0x38550000, 0x38554000, 0x38558000, 0x3855C000, 0x38560000, 0x38564000, 0x38568000, 0x3856C000, 0x38570000, 0x38574000, 0x38578000, 0x3857C000,
  0x38580000, 0x38584000, 0x38588000, 0x3858C000, 0x38590000, 0x38594000, 0x38598000, 0x3859C000, 0x385A0000, 0x385A4000, 0x385A8000, 0x385AC000, 0x385B0000, 0x385B4000, 0x385B8000, 0x385BC000,
  0x385C0000, 0x385C4000, 0x385C8000, 0x385CC000, 0x385D0000, 0x385D4000, 0x385D8000, 0x385DC000, 0x385E0000, 0x385E4000, 0x385E8000, 0x385EC000, 0x385F0000, 0x385F4000, 0x385F8000, 0x385FC000,
  0x38600000, 0x38604000, 0x38608000, 0x3860C000, 0x38610000, 0x38614000, 0x38618000, 0x3861C000, 0x38620000, 0x38624000, 0x38628000, 0x3862C000, 0x38630000, 0x38634000, 0x38638000, 0x3863C000,
  0x38640000, 0x38644000, 0x38648000, 0x3864C000, 0x38650000, 0x38654000, 0x38658000, 0x3865C000, 0x38660000, 0x38664000, 0x38668000, 0x3866C000, 0x38670000, 0x38674000, 0x38678000, 0x3867C000,
  0x38680000, 0x38684000, 0x38688000, 0x3868C000, 0x38690000, 0x38694000, 0x38698000, 0x3869C000, 0x386A0000, 0x386A4000, 0x386A8000, 0x386AC000, 0x386B0000, 0x386B4000, 0x386B8000, 0x386BC000,
  0x386C0000, 0x386C4000, 0x386C8000, 0x386CC000, 0x386D0000, 0x386D4000, 0x386D8000, 0x386DC000, 0x386E0000, 0x386E4000, 0x386E8000, 0x386EC000, 0x386F0000, 0x386F4000, 0x386F8000, 0x386FC000,
  0x38700000, 0x38704000, 0x38708000, 0x3870C000, 0x38710000, 0x38714000, 0x38718000, 0x3871C000, 0x38720000, 0x38724000, 0x38728000, 0x3872C000, 0x38730000, 0x38734000, 0x38738000, 0x3873C000,
  0x38740000, 0x38744000, 0x38748000, 0x3874C000, 0x38750000, 0x38754000, 0x38758000, 0x3875C000, 0x38760000, 0x38764000, 0x38768000, 0x3876C000, 0x38770000, 0x38774000, 0x38778000, 0x3877C000,
  0x38780000, 0x38784000, 0x38788000, 0x3878C000, 0x38790000, 0x38794000, 0x38798000, 0x3879C000, 0x387A0000, 0x387A4000, 0x387A8000, 0x387AC000, 0x387B0000, 0x387B4000, 0x387B8000, 0x387BC000,
  0x387C0000, 0x387C4000, 0x387C8000, 0x387CC000, 0x387D0000, 0x387D4000, 0x387D8000, 0x387DC000, 0x387E0000, 0x387E4000, 0x387E8000, 0x387EC000, 0x387F0000, 0x387F4000, 0x387F8000, 0x387FC000,
  0x38000000, 0x38002000, 0x38004000, 0x38006000, 0x38008000, 0x3800A000, 0x3800C000, 0x3800E000, 0x38010000, 0x38012000, 0x38014000, 0x38016000, 0x38018000, 0x3801A000, 0x3801C000, 0x3801E000,
  0x38020000, 0x38022000, 0x38024000, 0x38026000, 0x38028000, 0x3802A000, 0x3802C000, 0x3802E000, 0x38030000, 0x38032000, 0x38034000, 0x38036000, 0x38038000, 0x3803A000, 0x3803C000, 0x3803E000,
  0x38040000, 0x38042000, 0x38044000, 0x38046000, 0x38048000, 0x3804A000, 0x3804C000, 0x3804E000, 0x38050000, 0x38052000, 0x38054000, 0x38056000, 0x38058000, 0x3805A000, 0x3805C000, 0x3805E000,
  0x38060000, 0x38062000, 0x38064000, 0x38066000, 0x38068000, 0x3806A000, 0x3806C000, 0x3806E000, 0x38070000, 0x38072000, 0x38074000, 0x38076000, 0x38078000, 0x3807A000, 0x3807C000, 0x3807E000,
  0x38080000, 0x38082000, 0x38084000, 0x38086000, 0x38088000, 0x3808A000, 0x3808C000, 0x3808E000, 0x38090000, 0x38092000, 0x38094000, 0x38096000, 0x38098000, 0x3809A000, 0x3809C000, 0x3809E000,
  0x380A0000, 0x380A2000, 0x380A4000, 0x380A6000, 0x380A8000, 0x380AA000, 0x380AC000, 0x380AE000, 0x380B0000, 0x380B2000, 0x380B4000, 0x380B6000, 0x380B8000, 0x380BA000, 0x380BC000, 0x380BE000,
  0x380C0000, 0x380C2000, 0x380C4000, 0x380C6000, 0x380C8000, 0x380CA000, 0x380CC000, 0x380CE000, 0x380D0000, 0x380D2000, 0x380D4000, 0x380D6000, 0x380D8000, 0x380DA000, 0x380DC000, 0x380DE000,
  0x380E0000, 0x380E2000, 0x380E4000, 0x380E6000, 0x380E8000, 0x380EA000, 0x380EC000, 0x380EE000, 0x380F0000, 0x380F2000, 0x380F4000, 0x380F6000, 0x380F8000, 0x380FA000, 0x380FC000, 0x380FE000,
  0x38100000, 0x38102000, 0x38104000, 0x38106000, 0x38108000, 0x3810A000, 0x3810C000, 0x3810E000, 0x38110000, 0x38112000, 0x38114000, 0x38116000, 0x38118000, 0x3811A000, 0x3811C000, 0x3811E000,
  0x38120000, 0x38122000, 0x38124000, 0x38126000, 0x38128000, 0x3812A000, 0x3812C000, 0x3812E000, 0x38130000, 0x38132000, 0x38134000, 0x38136000, 0x38138000, 0x3813A000, 0x3813C000, 0x3813E000,
  0x38140000, 0x38142000, 0x38144000, 0x38146000, 0x38148000, 0x3814A000, 0x3814C000, 0x3814E000, 0x38150000, 0x38152000, 0x38154000, 0x38156000, 0x38158000, 0x3815A000, 0x3815C000, 0x3815E000,
  0x38160000, 0x38162000, 0x38164000, 0x38166000, 0x38168000, 0x3816A000, 0x3816C000, 0x3816E000, 0x38170000, 0x38172000, 0x38174000, 0x38176000, 0x38178000, 0x3817A000, 0x3817C000, 0x3817E000,
  0x38180000, 0x38182000, 0x38184000, 0x38186000, 0x38188000, 0x3818A000, 0x3818C000, 0x3818E000, 0x38190000, 0x38192000, 0x38194000, 0x38196000, 0x38198000, 0x3819A000, 0x3819C000, 0x3819E000,
  0x381A0000, 0x381A2000, 0x381A4000, 0x381A6000, 0x381A8000, 0x381AA000, 0x381AC000, 0x381AE000, 0x381B0000, 0x381B2000, 0x381B4000, 0x381B6000, 0x381B8000, 0x381BA000, 0x381BC000, 0x381BE000,
  0x381C0000, 0x381C2000, 0x381C4000, 0x381C6000, 0x381C8000, 0x381CA000, 0x381CC000, 0x381CE000, 0x381D0000, 0x381D2000, 0x381D4000, 0x381D6000, 0x381D8000, 0x381DA000, 0x381DC000, 0x381DE000,
  0x381E0000, 0x381E2000, 0x381E4000, 0x381E6000, 0x381E8000, 0x381EA000, 0x381EC000, 0x381EE000, 0x381F0000, 0x381F2000, 0x381F4000, 0x381F6000, 0x381F8000, 0x381FA000, 0x381FC000, 0x381FE000,
  0x38200000, 0x38202000, 0x38204000, 0x38206000, 0x38208000, 0x3820A000, 0x3820C000, 0x3820E000, 0x38210000, 0x38212000, 0x38214000, 0x38216000, 0x38218000, 0x3821A000, 0x3821C000, 0x3821E000,
  0x38220000, 0x38222000, 0x38224000, 0x38226000, 0x38228000, 0x3822A000, 0x3822C000, 0x3822E000, 0x38230000, 0x38232000, 0x38234000, 0x38236000, 0x38238000, 0x3823A000, 0x3823C000, 0x3823E000,
  0x38240000, 0x38242000, 0x38244000, 0x38246000, 0x38248000, 0x3824A000, 0x3824C000, 0x3824E000, 0x38250000, 0x38252000, 0x38254000, 0x38256000, 0x38258000, 0x3825A000, 0x3825C000, 0x3825E000,
  0x38260000, 0x38262000, 0x38264000, 0x38266000, 0x38268000, 0x3826A000, 0x3826C000, 0x3826E000, 0x38270000, 0x38272000, 0x38274000, 0x38276000, 0x38278000, 0x3827A000, 0x3827C000, 0x3827E000,
  0x38280000, 0x38282000, 0x38284000, 0x38286000, 0x38288000, 0x3828A000, 0x3828C000, 0x3828E000, 0x38290000, 0x38292000, 0x38294000, 0x38296000, 0x38298000, 0x3829A000, 0x3829C000, 0x3829E000,
  0x382A0000, 0x382A2000, 0x382A4000, 0x382A6000, 0x382A8000, 0x382AA000, 0x382AC000, 0x382AE000, 0x382B0000, 0x382B2000, 0x382B4000, 0x382B6000, 0x382B8000, 0x382BA000, 0x382BC000, 0x382BE000,
  0x382C0000, 0x382C2000, 0x382C4000, 0x382C6000, 0x382C8000, 0x382CA000, 0x382CC000, 0x382CE000, 0x382D0000, 0x382D2000, 0x382D4000, 0x382D6000, 0x382D8000, 0x382DA000, 0x382DC000, 0x382DE000,
  0x382E0000, 0x382E2000, 0x382E4000, 0x382E6000, 0x382E8000, 0x382EA000, 0x382EC000, 0x382EE000, 0x382F0000, 0x382F2000, 0x382F4000, 0x382F6000, 0x382F8000, 0x382FA000, 0x382FC000, 0x382FE000,
  0x38300000, 0x38302000, 0x38304000, 0x38306000, 0x38308000, 0x3830A000, 0x3830C000, 0x3830E000, 0x38310000, 0x38312000, 0x38314000, 0x38316000, 0x38318000, 0x3831A000, 0x3831C000, 0x3831E000,
  0x38320000, 0x38322000, 0x38324000, 0x38326000, 0x38328000, 0x3832A000, 0x3832C000, 0x3832E000, 0x38330000, 0x38332000, 0x38334000, 0x38336000, 0x38338000, 0x3833A000, 0x3833C000, 0x3833E000,
  0x38340000, 0x38342000, 0x38344000, 0x38346000, 0x38348000, 0x3834A000, 0x3834C000, 0x3834E000, 0x38350000, 0x38352000, 0x38354000, 0x38356000, 0x38358000, 0x3835A000, 0x3835C000, 0x3835E000,
  0x38360000, 0x38362000, 0x38364000, 0x38366000, 0x38368000, 0x3836A000, 0x3836C000, 0x3836E000, 0x38370000, 0x38372000, 0x38374000, 0x38376000, 0x38378000, 0x3837A000, 0x3837C000, 0x3837E000,
  0x38380000, 0x38382000, 0x38384000, 0x38386000, 0x38388000, 0x3838A000, 0x3838C000, 0x3838E000, 0x38390000, 0x38392000, 0x38394000, 0x38396000, 0x38398000, 0x3839A000, 0x3839C000, 0x3839E000,
  0x383A0000, 0x383A2000, 0x383A4000, 0x383A6000, 0x383A8000, 0x383AA000, 0x383AC000, 0x383AE000, 0x383B0000, 0x383B2000, 0x383B4000, 0x383B6000, 0x383B8000, 0x383BA000, 0x383BC000, 0x383BE000,
  0x383C0000, 0x383C2000, 0x383C4000, 0x383C6000, 0x383C8000, 0x383CA000, 0x383CC000, 0x383CE000, 0x383D0000, 0x383D2000, 0x383D4000, 0x383D6000, 0x383D8000, 0x383DA000, 0x383DC000, 0x383DE000,
  0x383E0000, 0x383E2000, 0x383E4000, 0x383E6000, 0x383E8000, 0x383EA000, 0x383EC000, 0x383EE000, 0x383F0000, 0x383F2000, 0x383F4000, 0x383F6000, 0x383F8000, 0x383FA000, 0x383FC000, 0x383FE000,
  0x38400000, 0x38402000, 0x38404000, 0x38406000, 0x38408000, 0x3840A000, 0x3840C000, 0x3840E000, 0x38410000, 0x38412000, 0x38414000, 0x38416000, 0x38418000, 0x3841A000, 0x3841C000, 0x3841E000,
  0x38420000, 0x38422000, 0x38424000, 0x38426000, 0x38428000, 0x3842A000, 0x3842C000, 0x3842E000, 0x38430000, 0x38432000, 0x38434000, 0x38436000, 0x38438000, 0x3843A000, 0x3843C000, 0x3843E000,
  0x38440000, 0x38442000, 0x38444000, 0x38446000, 0x38448000, 0x3844A000, 0x3844C000, 0x3844E000, 0x38450000, 0x38452000, 0x38454000, 0x38456000, 0x38458000, 0x3845A000, 0x3845C000, 0x3845E000,
  0x38460000, 0x38462000, 0x38464000, 0x38466000, 0x38468000, 0x3846A000, 0x3846C000, 0x3846E000, 0x38470000, 0x38472000, 0x38474000, 0x38476000, 0x38478000, 0x3847A000, 0x3847C000, 0x3847E000,
  0x38480000, 0x38482000, 0x38484000, 0x38486000, 0x38488000, 0x3848A000, 0x3848C000, 0x3848E000, 0x38490000, 0x38492000, 0x38494000, 0x38496000, 0x38498000, 0x3849A000, 0x3849C000, 0x3849E000,
  0x384A0000, 0x384A2000, 0x384A4000, 0x384A6000, 0x384A8000, 0x384AA000, 0x384AC000, 0x384AE000, 0x384B0000, 0x384B2000, 0x384B4000, 0x384B6000, 0x384B8000, 0x384BA000, 0x384BC000, 0x384BE000,
  0x384C0000, 0x384C2000, 0x384C4000, 0x384C6000, 0x384C8000, 0x384CA000, 0x384CC000, 0x384CE000, 0x384D0000, 0x384D2000, 0x384D4000, 0x384D6000, 0x384D8000, 0x384DA000, 0x384DC000, 0x384DE000,
  0x384E0000, 0x384E2000, 0x384E4000, 0x384E6000, 0x384E8000, 0x384EA000, 0x384EC000, 0x384EE000, 0x384F0000, 0x384F2000, 0x384F4000, 0x384F6000, 0x384F8000, 0x384FA000, 0x384FC000, 0x384FE000,
  0x38500000, 0x38502000, 0x38504000, 0x38506000, 0x38508000, 0x3850A000, 0x3850C000, 0x3850E000, 0x38510000, 0x38512000, 0x38514000, 0x38516000, 0x38518000, 0x3851A000, 0x3851C000, 0x3851E000,
  0x38520000, 0x38522000, 0x38524000, 0x38526000, 0x38528000, 0x3852A000, 0x3852C000, 0x3852E000, 0x38530000, 0x38532000, 0x38534000, 0x38536000, 0x38538000, 0x3853A000, 0x3853C000, 0x3853E000,
  0x38540000, 0x38542000, 0x38544000, 0x38546000, 0x38548000, 0x3854A000, 0x3854C000, 0x3854E000, 0x38550000, 0x38552000, 0x38554000, 0x38556000, 0x38558000, 0x3855A000, 0x3855C000, 0x3855E000,
  0x38560000, 0x38562000, 0x38564000, 0x38566000, 0x38568000, 0x3856A000, 0x3856C000, 0x3856E000, 0x38570000, 0x38572000, 0x38574000, 0x38576000, 0x38578000, 0x3857A000, 0x3857C000, 0x3857E000,
  0x38580000, 0x38582000, 0x38584000, 0x38586000, 0x38588000, 0x3858A000, 0x3858C000, 0x3858E000, 0x38590000, 0x38592000, 0x38594000, 0x38596000, 0x38598000, 0x3859A000, 0x3859C000, 0x3859E000,
  0x385A0000, 0x385A2000, 0x385A4000, 0x385A6000, 0x385A8000, 0x385AA000, 0x385AC000, 0x385AE000, 0x385B0000, 0x385B2000, 0x385B4000, 0x385B6000, 0x385B8000, 0x385BA000, 0x385BC000, 0x385BE000,
  0x385C0000, 0x385C2000, 0x385C4000, 0x385C6000, 0x385C8000, 0x385CA000, 0x385CC000, 0x385CE000, 0x385D0000, 0x385D2000, 0x385D4000, 0x385D6000, 0x385D8000, 0x385DA000, 0x385DC000, 0x385DE000,
  0x385E0000, 0x385E2000, 0x385E4000, 0x385E6000, 0x385E8000, 0x385EA000, 0x385EC000, 0x385EE000, 0x385F0000, 0x385F2000, 0x385F4000, 0x385F6000, 0x385F8000, 0x385FA000, 0x385FC000, 0x385FE000,
  0x38600000, 0x38602000, 0x38604000, 0x38606000, 0x38608000, 0x3860A000, 0x3860C000, 0x3860E000, 0x38610000, 0x38612000, 0x38614000, 0x38616000, 0x38618000, 0x3861A000, 0x3861C000, 0x3861E000,
  0x38620000, 0x38622000, 0x38624000, 0x38626000, 0x38628000, 0x3862A000, 0x3862C000, 0x3862E000, 0x38630000, 0x38632000, 0x38634000, 0x38636000, 0x38638000, 0x3863A000, 0x3863C000, 0x3863E000,
  0x38640000, 0x38642000, 0x38644000, 0x38646000, 0x38648000, 0x3864A000, 0x3864C000, 0x3864E000, 0x38650000, 0x38652000, 0x38654000, 0x38656000, 0x38658000, 0x3865A000, 0x3865C000, 0x3865E000,
  0x38660000, 0x38662000, 0x38664000, 0x38666000, 0x38668000, 0x3866A000, 0x3866C000, 0x3866E000, 0x38670000, 0x38672000, 0x38674000, 0x38676000, 0x38678000, 0x3867A000, 0x3867C000, 0x3867E000,
  0x38680000, 0x38682000, 0x38684000, 0x38686000, 0x38688000, 0x3868A000, 0x3868C000, 0x3868E000, 0x38690000, 0x38692000, 0x38694000, 0x38696000, 0x38698000, 0x3869A000, 0x3869C000, 0x3869E000,
  0x386A0000, 0x386A2000, 0x386A4000, 0x386A6000, 0x386A8000, 0x386AA000, 0x386AC000, 0x386AE000, 0x386B0000, 0x386B2000, 0x386B4000, 0x386B6000, 0x386B8000, 0x386BA000, 0x386BC000, 0x386BE000,
  0x386C0000, 0x386C2000, 0x386C4000, 0x386C6000, 0x386C8000, 0x386CA000, 0x386CC000, 0x386CE000, 0x386D0000, 0x386D2000, 0x386D4000, 0x386D6000, 0x386D8000, 0x386DA000, 0x386DC000, 0x386DE000,
  0x386E0000, 0x386E2000, 0x386E4000, 0x386E6000, 0x386E8000, 0x386EA000, 0x386EC000, 0x386EE000, 0x386F0000, 0x386F2000, 0x386F4000, 0x386F6000, 0x386F8000, 0x386FA000, 0x386FC000, 0x386FE000,
  0x38700000, 0x38702000, 0x38704000, 0x38706000, 0x38708000, 0x3870A000, 0x3870C000, 0x3870E000, 0x38710000, 0x38712000, 0x38714000, 0x38716000, 0x38718000, 0x3871A000, 0x3871C000, 0x3871E000,
  0x38720000, 0x38722000, 0x38724000, 0x38726000, 0x38728000, 0x3872A000, 0x3872C000, 0x3872E000, 0x38730000, 0x38732000, 0x38734000, 0x38736000, 0x38738000, 0x3873A000, 0x3873C000, 0x3873E000,
  0x38740000, 0x38742000, 0x38744000, 0x38746000, 0x38748000, 0x3874A000, 0x3874C000, 0x3874E000, 0x38750000, 0x38752000, 0x38754000, 0x38756000, 0x38758000, 0x3875A000, 0x3875C000, 0x3875E000,
  0x38760000, 0x38762000, 0x38764000, 0x38766000, 0x38768000, 0x3876A000, 0x3876C000, 0x3876E000, 0x38770000, 0x38772000, 0x38774000, 0x38776000, 0x38778000, 0x3877A000, 0x3877C000, 0x3877E000,
  0x38780000, 0x38782000, 0x38784000, 0x38786000, 0x38788000, 0x3878A000, 0x3878C000, 0x3878E000, 0x38790000, 0x38792000, 0x38794000, 0x38796000, 0x38798000, 0x3879A000, 0x3879C000, 0x3879E000,
  0x387A0000, 0x387A2000, 0x387A4000, 0x387A6000, 0x387A8000, 0x387AA000, 0x387AC000, 0x387AE000, 0x387B0000, 0x387B2000, 0x387B4000, 0x387B6000, 0x387B8000, 0x387BA000, 0x387BC000, 0x387BE000,
  0x387C0000, 0x387C2000, 0x387C4000, 0x387C6000, 0x387C8000, 0x387CA000, 0x387CC000, 0x387CE000, 0x387D0000, 0x387D2000, 0x387D4000, 0x387D6000, 0x387D8000, 0x387DA000, 0x387DC000, 0x387DE000,
  0x387E0000, 0x387E2000, 0x387E4000, 0x387E6000, 0x387E8000, 0x387EA000, 0x387EC000, 0x387EE000, 0x387F0000, 0x387F2000, 0x387F4000, 0x387F6000, 0x387F8000, 0x387FA000, 0x387FC000, 0x387FE000 };
__constant static const uint32_t exponent_table[64] = {
  0x00000000, 0x00800000, 0x01000000, 0x01800000, 0x02000000, 0x02800000, 0x03000000, 0x03800000, 0x04000000, 0x04800000, 0x05000000, 0x05800000, 0x06000000, 0x06800000, 0x07000000, 0x07800000,
  0x08000000, 0x08800000, 0x09000000, 0x09800000, 0x0A000000, 0x0A800000, 0x0B000000, 0x0B800000, 0x0C000000, 0x0C800000, 0x0D000000, 0x0D800000, 0x0E000000, 0x0E800000, 0x0F000000, 0x47800000,
  0x80000000, 0x80800000, 0x81000000, 0x81800000, 0x82000000, 0x82800000, 0x83000000, 0x83800000, 0x84000000, 0x84800000, 0x85000000, 0x85800000, 0x86000000, 0x86800000, 0x87000000, 0x87800000,
  0x88000000, 0x88800000, 0x89000000, 0x89800000, 0x8A000000, 0x8A800000, 0x8B000000, 0x8B800000, 0x8C000000, 0x8C800000, 0x8D000000, 0x8D800000, 0x8E000000, 0x8E800000, 0x8F000000, 0xC7800000 };
__constant static const unsigned short offset_table[64] = {
  0, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024,
  0, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024 };

SCALAR_FUN_ATTR uint16_t float2halfbits(float value) {
  union { float x; uint32_t y; } u;
  u.x = value;
  uint32_t bits = u.y;

  uint16_t hbits = base_table[bits>>23] + (uint16_t)((bits&0x7FFFFF)>>shift_table[bits>>23]);;

  return hbits;
}

SCALAR_FUN_ATTR float halfbits2float(uint16_t value) {
  uint32_t bits = mantissa_table[offset_table[value>>10]+(value&0x3FF)] + exponent_table[value>>10];

  union { uint32_t x; float y; } u;
  u.x = bits;
  return u.y;
}

SCALAR_FUN_ATTR uint16_t halfbitsnextafter(uint16_t from, uint16_t to) {
  int fabs = from & 0x7FFF, tabs = to & 0x7FFF;
  if(fabs > 0x7C00 || tabs > 0x7C00) {
    return ((from&0x7FFF)>0x7C00) ? (from|0x200) : (to|0x200);
  }
  if(from == to || !(fabs|tabs)) {
    return to;
  }
  if(!fabs) {
    return (to&0x8000)+1;
  }
  unsigned int out =
    from +
    (((from>>15)^(unsigned int)((from^(0x8000|(0x8000-(from>>15))))<(to^(0x8000|(0x8000-(to>>15))))))<<1)
    - 1;
  return out;
}

// End of half.h.
// Start of timing.h.

// The function get_wall_time() returns the wall time in microseconds
// (with an unspecified offset).

#ifdef _WIN32

#include <windows.h>

static int64_t get_wall_time(void) {
  LARGE_INTEGER time,freq;
  assert(QueryPerformanceFrequency(&freq));
  assert(QueryPerformanceCounter(&time));
  return ((double)time.QuadPart / freq.QuadPart) * 1000000;
}

static int64_t get_wall_time_ns(void) {
  return get_wall_time() * 1000;
}

#else
// Assuming POSIX

#include <time.h>
#include <sys/time.h>

static int64_t get_wall_time(void) {
  struct timeval time;
  assert(gettimeofday(&time,NULL) == 0);
  return time.tv_sec * 1000000 + time.tv_usec;
}

static int64_t get_wall_time_ns(void) {
  struct timespec time;
  assert(clock_gettime(CLOCK_REALTIME, &time) == 0);
  return time.tv_sec * 1000000000 + time.tv_nsec;
}

#endif

// End of timing.h.
// Start of lock.h.

// A very simple cross-platform implementation of locks.  Uses
// pthreads on Unix and some Windows thing there.  Futhark's
// host-level code is not multithreaded, but user code may be, so we
// need some mechanism for ensuring atomic access to API functions.
// This is that mechanism.  It is not exposed to user code at all, so
// we do not have to worry about name collisions.

#ifdef _WIN32

typedef HANDLE lock_t;

static void create_lock(lock_t *lock) {
  *lock = CreateMutex(NULL,  // Default security attributes.
                      FALSE, // Initially unlocked.
                      NULL); // Unnamed.
}

static void lock_lock(lock_t *lock) {
  assert(WaitForSingleObject(*lock, INFINITE) == WAIT_OBJECT_0);
}

static void lock_unlock(lock_t *lock) {
  assert(ReleaseMutex(*lock));
}

static void free_lock(lock_t *lock) {
  CloseHandle(*lock);
}

#else
// Assuming POSIX

#include <pthread.h>

typedef pthread_mutex_t lock_t;

static void create_lock(lock_t *lock) {
  int r = pthread_mutex_init(lock, NULL);
  assert(r == 0);
}

static void lock_lock(lock_t *lock) {
  int r = pthread_mutex_lock(lock);
  assert(r == 0);
}

static void lock_unlock(lock_t *lock) {
  int r = pthread_mutex_unlock(lock);
  assert(r == 0);
}

static void free_lock(lock_t *lock) {
  // Nothing to do for pthreads.
  (void)lock;
}

#endif

// End of lock.h.
// Start of free_list.h.

typedef uintptr_t fl_mem;

// An entry in the free list.  May be invalid, to avoid having to
// deallocate entries as soon as they are removed.  There is also a
// tag, to help with memory reuse.
struct free_list_entry {
  size_t size;
  fl_mem mem;
  const char *tag;
  unsigned char valid;
};

struct free_list {
  struct free_list_entry *entries; // Pointer to entries.
  int capacity;                    // Number of entries.
  int used;                        // Number of valid entries.
  lock_t lock;                     // Thread safety.
};

static void free_list_init(struct free_list *l) {
  l->capacity = 30; // Picked arbitrarily.
  l->used = 0;
  l->entries = (struct free_list_entry*) malloc(sizeof(struct free_list_entry) * l->capacity);
  for (int i = 0; i < l->capacity; i++) {
    l->entries[i].valid = 0;
  }
  create_lock(&l->lock);
}

// Remove invalid entries from the free list.
static void free_list_pack(struct free_list *l) {
  lock_lock(&l->lock);
  int p = 0;
  for (int i = 0; i < l->capacity; i++) {
    if (l->entries[i].valid) {
      l->entries[p] = l->entries[i];
      if (i > p) {
        l->entries[i].valid = 0;
      }
      p++;
    }
  }

  // Now p is the number of used elements.  We don't want it to go
  // less than the default capacity (although in practice it's OK as
  // long as it doesn't become 1).
  if (p < 30) {
    p = 30;
  }
  l->entries = realloc(l->entries, p * sizeof(struct free_list_entry));
  l->capacity = p;
  lock_unlock(&l->lock);
}

static void free_list_destroy(struct free_list *l) {
  assert(l->used == 0);
  free(l->entries);
  free_lock(&l->lock);
}

// Not part of the interface, so no locking.
static int free_list_find_invalid(struct free_list *l) {
  int i;
  for (i = 0; i < l->capacity; i++) {
    if (!l->entries[i].valid) {
      break;
    }
  }
  return i;
}

static void free_list_insert(struct free_list *l, size_t size, fl_mem mem, const char *tag) {
  lock_lock(&l->lock);
  int i = free_list_find_invalid(l);

  if (i == l->capacity) {
    // List is full; so we have to grow it.
    int new_capacity = l->capacity * 2 * sizeof(struct free_list_entry);
    l->entries = realloc(l->entries, new_capacity);
    for (int j = 0; j < l->capacity; j++) {
      l->entries[j+l->capacity].valid = 0;
    }
    l->capacity *= 2;
  }

  // Now 'i' points to the first invalid entry.
  l->entries[i].valid = 1;
  l->entries[i].size = size;
  l->entries[i].mem = mem;
  l->entries[i].tag = tag;

  l->used++;
  lock_unlock(&l->lock);
}

// Determine whether this entry in the free list is acceptable for
// satisfying the request.  Not public, so no locking.
static bool free_list_acceptable(size_t size, const char* tag, struct free_list_entry *entry) {
  // We check not just the hard requirement (is the entry acceptable
  // and big enough?) but also put a cap on how much wasted space
  // (internal fragmentation) we allow.  This is necessarily a
  // heuristic, and a crude one.

  if (!entry->valid) {
    return false;
  }

  if (size > entry->size) {
    return false;
  }

  // We know the block fits.  Now the question is whether it is too
  // big.  Our policy is as follows:
  //
  // 1) We don't care about wasted space below 4096 bytes (to avoid
  // churn in tiny allocations).
  //
  // 2) If the tag matches, we allow _any_ amount of wasted space.
  //
  // 3) Otherwise we allow up to 50% wasted space.

  if (entry->size < 4096) {
    return true;
  }

  if (entry->tag == tag) {
    return true;
  }

  if (entry->size < size * 2) {
    return true;
  }

  return false;
}

// Find and remove a memory block of the indicated tag, or if that
// does not exist, another memory block with exactly the desired size.
// Returns 0 on success.
static int free_list_find(struct free_list *l, size_t size, const char *tag,
                          size_t *size_out, fl_mem *mem_out) {
  lock_lock(&l->lock);
  int size_match = -1;
  int i;
  int ret = 1;
  for (i = 0; i < l->capacity; i++) {
    if (free_list_acceptable(size, tag, &l->entries[i]) &&
        (size_match < 0 || l->entries[i].size < l->entries[size_match].size)) {
      // If this entry is valid, has sufficient size, and is smaller than the
      // best entry found so far, use this entry.
      size_match = i;
    }
  }

  if (size_match >= 0) {
    l->entries[size_match].valid = 0;
    *size_out = l->entries[size_match].size;
    *mem_out = l->entries[size_match].mem;
    l->used--;
    ret = 0;
  }
  lock_unlock(&l->lock);
  return ret;
}

// Remove the first block in the free list.  Returns 0 if a block was
// removed, and nonzero if the free list was already empty.
static int free_list_first(struct free_list *l, fl_mem *mem_out) {
  lock_lock(&l->lock);
  int ret = 1;
  for (int i = 0; i < l->capacity; i++) {
    if (l->entries[i].valid) {
      l->entries[i].valid = 0;
      *mem_out = l->entries[i].mem;
      l->used--;
      ret = 0;
      break;
    }
  }
  lock_unlock(&l->lock);
  return ret;
}

// End of free_list.h.
// Start of event_list.h

typedef int (*event_report_fn)(struct str_builder*, void*);

struct event {
  void* data;
  event_report_fn f;
  const char* name;
  char *description;
};

struct event_list {
  struct event *events;
  int num_events;
  int capacity;
};

static void event_list_init(struct event_list *l) {
  l->capacity = 100;
  l->num_events = 0;
  l->events = calloc(l->capacity, sizeof(struct event));
}

static void event_list_free(struct event_list *l) {
  free(l->events);
}

static void add_event_to_list(struct event_list *l,
                              const char* name,
                              char* description,
                              void* data,
                              event_report_fn f) {
  if (l->num_events == l->capacity) {
    l->capacity *= 2;
    l->events = realloc(l->events, l->capacity * sizeof(struct event));
  }
  l->events[l->num_events].name = name;
  l->events[l->num_events].description = description;
  l->events[l->num_events].data = data;
  l->events[l->num_events].f = f;
  l->num_events++;
}

static int report_events_in_list(struct event_list *l,
                                 struct str_builder* sb) {
  int ret = 0;
  for (int i = 0; i < l->num_events; i++) {
    if (i != 0) {
      str_builder_str(sb, ",");
    }
    str_builder_str(sb, "{\"name\":");
    str_builder_json_str(sb, l->events[i].name);
    str_builder_str(sb, ",\"description\":");
    str_builder_json_str(sb, l->events[i].description);
    free(l->events[i].description);
    if (l->events[i].f(sb, l->events[i].data) != 0) {
      ret = 1;
      break;
    }
    str_builder(sb, "}");
  }
  event_list_free(l);
  event_list_init(l);
  return ret;
}

// End of event_list.h

#ifdef _MSC_VER
#define inline __inline
#endif
#include <string.h>
#include <string.h>
#include <errno.h>
#include <assert.h>
#include <ctype.h>



#define FUTHARK_F64_ENABLED

// Start of scalar.h.

// Implementation of the primitive scalar operations.  Very
// repetitive.  This code is inserted directly into both CUDA and
// OpenCL programs, as well as the CPU code, so it has some #ifdefs to
// work everywhere.  Some operations are defined as macros because
// this allows us to use them as constant expressions in things like
// array sizes and static initialisers.

// Some of the #ifdefs are because OpenCL uses type-generic functions
// for some operations (e.g. sqrt), while C and CUDA sensibly use
// distinct functions for different precisions (e.g. sqrtf() and
// sqrt()).  This is quite annoying.  Due to C's unfortunate casting
// rules, it is also really easy to accidentally implement
// floating-point functions in the wrong precision, so be careful.

// Double-precision definitions are only included if the preprocessor
// macro FUTHARK_F64_ENABLED is set.

SCALAR_FUN_ATTR int32_t futrts_to_bits32(float x);
SCALAR_FUN_ATTR float futrts_from_bits32(int32_t x);

SCALAR_FUN_ATTR uint8_t add8(uint8_t x, uint8_t y) {
  return x + y;
}

SCALAR_FUN_ATTR uint16_t add16(uint16_t x, uint16_t y) {
  return x + y;
}

SCALAR_FUN_ATTR uint32_t add32(uint32_t x, uint32_t y) {
  return x + y;
}

SCALAR_FUN_ATTR uint64_t add64(uint64_t x, uint64_t y) {
  return x + y;
}

SCALAR_FUN_ATTR uint8_t sub8(uint8_t x, uint8_t y) {
  return x - y;
}

SCALAR_FUN_ATTR uint16_t sub16(uint16_t x, uint16_t y) {
  return x - y;
}

SCALAR_FUN_ATTR uint32_t sub32(uint32_t x, uint32_t y) {
  return x - y;
}

SCALAR_FUN_ATTR uint64_t sub64(uint64_t x, uint64_t y) {
  return x - y;
}

SCALAR_FUN_ATTR uint8_t mul8(uint8_t x, uint8_t y) {
  return x * y;
}

SCALAR_FUN_ATTR uint16_t mul16(uint16_t x, uint16_t y) {
  return x * y;
}

SCALAR_FUN_ATTR uint32_t mul32(uint32_t x, uint32_t y) {
  return x * y;
}

SCALAR_FUN_ATTR uint64_t mul64(uint64_t x, uint64_t y) {
  return x * y;
}

#if ISPC

SCALAR_FUN_ATTR uint8_t udiv8(uint8_t x, uint8_t y) {
  // This strange pattern is used to prevent the ISPC compiler from
  // causing SIGFPEs and bogus results on divisions where inactive lanes
  // have 0-valued divisors. It ensures that any inactive lane instead
  // has a divisor of 1. https://github.com/ispc/ispc/issues/2292
  uint8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x / ys;
}

SCALAR_FUN_ATTR uint16_t udiv16(uint16_t x, uint16_t y) {
  uint16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x / ys;
}

SCALAR_FUN_ATTR uint32_t udiv32(uint32_t x, uint32_t y) {
  uint32_t ys = 1;
  foreach_active(i){
    ys = y;
  }


  return x / ys;
}

SCALAR_FUN_ATTR uint64_t udiv64(uint64_t x, uint64_t y) {
  uint64_t ys = 1;
  foreach_active(i){
    ys = y;
  }


  return x / ys;
}

SCALAR_FUN_ATTR uint8_t udiv_up8(uint8_t x, uint8_t y) {
  uint8_t ys = 1;
  foreach_active(i){
    ys = y;
  }


  return (x + y - 1) / ys;
}

SCALAR_FUN_ATTR uint16_t udiv_up16(uint16_t x, uint16_t y) {
  uint16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return (x + y - 1) / ys;
}

SCALAR_FUN_ATTR uint32_t udiv_up32(uint32_t x, uint32_t y) {
  uint32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return (x + y - 1) / ys;
}

SCALAR_FUN_ATTR uint64_t udiv_up64(uint64_t x, uint64_t y) {
  uint64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return (x + y - 1) / ys;
}

SCALAR_FUN_ATTR uint8_t umod8(uint8_t x, uint8_t y) {
  uint8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x % ys;
}

SCALAR_FUN_ATTR uint16_t umod16(uint16_t x, uint16_t y) {
  uint16_t ys = 1;
  foreach_active(i){
    ys = y;
  }


  return x % ys;
}

SCALAR_FUN_ATTR uint32_t umod32(uint32_t x, uint32_t y) {
  uint32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x % ys;
}

SCALAR_FUN_ATTR uint64_t umod64(uint64_t x, uint64_t y) {
  uint64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x % ys;
}

SCALAR_FUN_ATTR uint8_t udiv_safe8(uint8_t x, uint8_t y) {
  uint8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x / ys;
}

SCALAR_FUN_ATTR uint16_t udiv_safe16(uint16_t x, uint16_t y) {
  uint16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x / ys;
}

SCALAR_FUN_ATTR uint32_t udiv_safe32(uint32_t x, uint32_t y) {
  uint32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x / ys;
}

SCALAR_FUN_ATTR uint64_t udiv_safe64(uint64_t x, uint64_t y) {
  uint64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x / ys;
}

SCALAR_FUN_ATTR uint8_t udiv_up_safe8(uint8_t x, uint8_t y) {
  uint8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : (x + y - 1) / ys;
}

SCALAR_FUN_ATTR uint16_t udiv_up_safe16(uint16_t x, uint16_t y) {
  uint16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : (x + y - 1) / ys;
}

SCALAR_FUN_ATTR uint32_t udiv_up_safe32(uint32_t x, uint32_t y) {
  uint32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : (x + y - 1) / ys;
}

SCALAR_FUN_ATTR uint64_t udiv_up_safe64(uint64_t x, uint64_t y) {
  uint64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : (x + y - 1) / ys;
}

SCALAR_FUN_ATTR uint8_t umod_safe8(uint8_t x, uint8_t y) {
  uint8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x % ys;
}

SCALAR_FUN_ATTR uint16_t umod_safe16(uint16_t x, uint16_t y) {
  uint16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x % ys;
}

SCALAR_FUN_ATTR uint32_t umod_safe32(uint32_t x, uint32_t y) {
  uint32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x % ys;
}

SCALAR_FUN_ATTR uint64_t umod_safe64(uint64_t x, uint64_t y) {
  uint64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x % ys;
}

SCALAR_FUN_ATTR int8_t sdiv8(int8_t x, int8_t y) {
  int8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  int8_t q = x / ys;
  int8_t r = x % ys;

  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}

SCALAR_FUN_ATTR int16_t sdiv16(int16_t x, int16_t y) {
  int16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  int16_t q = x / ys;
  int16_t r = x % ys;

  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}

SCALAR_FUN_ATTR int32_t sdiv32(int32_t x, int32_t y) {
  int32_t ys = 1;
  foreach_active(i){
    ys = y;
  }
  int32_t q = x / ys;
  int32_t r = x % ys;

  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}

SCALAR_FUN_ATTR int64_t sdiv64(int64_t x, int64_t y) {
  int64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  int64_t q = x / ys;
  int64_t r = x % ys;

  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}

SCALAR_FUN_ATTR int8_t sdiv_up8(int8_t x, int8_t y) {
  return sdiv8(x + y - 1, y);
}

SCALAR_FUN_ATTR int16_t sdiv_up16(int16_t x, int16_t y) {
  return sdiv16(x + y - 1, y);
}

SCALAR_FUN_ATTR int32_t sdiv_up32(int32_t x, int32_t y) {
  return sdiv32(x + y - 1, y);
}

SCALAR_FUN_ATTR int64_t sdiv_up64(int64_t x, int64_t y) {
  return sdiv64(x + y - 1, y);
}

SCALAR_FUN_ATTR int8_t smod8(int8_t x, int8_t y) {
  int8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  int8_t r = x % ys;

  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}

SCALAR_FUN_ATTR int16_t smod16(int16_t x, int16_t y) {
  int16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  int16_t r = x % ys;

  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}

SCALAR_FUN_ATTR int32_t smod32(int32_t x, int32_t y) {
  int32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  int32_t r = x % ys;

  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}

SCALAR_FUN_ATTR int64_t smod64(int64_t x, int64_t y) {
  int64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  int64_t r = x % ys;

  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}

SCALAR_FUN_ATTR int8_t sdiv_safe8(int8_t x, int8_t y) {
  return y == 0 ? 0 : sdiv8(x, y);
}

SCALAR_FUN_ATTR int16_t sdiv_safe16(int16_t x, int16_t y) {
  return y == 0 ? 0 : sdiv16(x, y);
}

SCALAR_FUN_ATTR int32_t sdiv_safe32(int32_t x, int32_t y) {
  return y == 0 ? 0 : sdiv32(x, y);
}

SCALAR_FUN_ATTR int64_t sdiv_safe64(int64_t x, int64_t y) {
  return y == 0 ? 0 : sdiv64(x, y);
}

SCALAR_FUN_ATTR int8_t sdiv_up_safe8(int8_t x, int8_t y) {
  return sdiv_safe8(x + y - 1, y);
}

SCALAR_FUN_ATTR int16_t sdiv_up_safe16(int16_t x, int16_t y) {
  return sdiv_safe16(x + y - 1, y);
}

SCALAR_FUN_ATTR int32_t sdiv_up_safe32(int32_t x, int32_t y) {
  return sdiv_safe32(x + y - 1, y);
}

SCALAR_FUN_ATTR int64_t sdiv_up_safe64(int64_t x, int64_t y) {
  return sdiv_safe64(x + y - 1, y);
}

SCALAR_FUN_ATTR int8_t smod_safe8(int8_t x, int8_t y) {
  return y == 0 ? 0 : smod8(x, y);
}

SCALAR_FUN_ATTR int16_t smod_safe16(int16_t x, int16_t y) {
  return y == 0 ? 0 : smod16(x, y);
}

SCALAR_FUN_ATTR int32_t smod_safe32(int32_t x, int32_t y) {
  return y == 0 ? 0 : smod32(x, y);
}

SCALAR_FUN_ATTR int64_t smod_safe64(int64_t x, int64_t y) {
  return y == 0 ? 0 : smod64(x, y);
}

SCALAR_FUN_ATTR int8_t squot8(int8_t x, int8_t y) {
  int8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x / ys;
}

SCALAR_FUN_ATTR int16_t squot16(int16_t x, int16_t y) {
  int16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x / ys;
}

SCALAR_FUN_ATTR int32_t squot32(int32_t x, int32_t y) {
  int32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x / ys;
}

SCALAR_FUN_ATTR int64_t squot64(int64_t x, int64_t y) {
  int64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x / ys;
}

SCALAR_FUN_ATTR int8_t srem8(int8_t x, int8_t y) {
  int8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x % ys;
}

SCALAR_FUN_ATTR int16_t srem16(int16_t x, int16_t y) {
  int16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x % ys;
}

SCALAR_FUN_ATTR int32_t srem32(int32_t x, int32_t y) {
  int32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x % ys;
}

SCALAR_FUN_ATTR int64_t srem64(int64_t x, int64_t y) {
  int8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x % ys;
}

SCALAR_FUN_ATTR int8_t squot_safe8(int8_t x, int8_t y) {
  int8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x / ys;
}

SCALAR_FUN_ATTR int16_t squot_safe16(int16_t x, int16_t y) {
  int16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x / ys;
}

SCALAR_FUN_ATTR int32_t squot_safe32(int32_t x, int32_t y) {
  int32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x / ys;
}

SCALAR_FUN_ATTR int64_t squot_safe64(int64_t x, int64_t y) {
  int64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x / ys;
}

SCALAR_FUN_ATTR int8_t srem_safe8(int8_t x, int8_t y) {
  int8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x % ys;
}

SCALAR_FUN_ATTR int16_t srem_safe16(int16_t x, int16_t y) {
  int16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x % ys;
}

SCALAR_FUN_ATTR int32_t srem_safe32(int32_t x, int32_t y) {
  int32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x % ys;
}

SCALAR_FUN_ATTR int64_t srem_safe64(int64_t x, int64_t y) {
  int64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x % ys;
}

#else

SCALAR_FUN_ATTR uint8_t udiv8(uint8_t x, uint8_t y) {
  return x / y;
}

SCALAR_FUN_ATTR uint16_t udiv16(uint16_t x, uint16_t y) {
  return x / y;
}

SCALAR_FUN_ATTR uint32_t udiv32(uint32_t x, uint32_t y) {
  return x / y;
}

SCALAR_FUN_ATTR uint64_t udiv64(uint64_t x, uint64_t y) {
  return x / y;
}

SCALAR_FUN_ATTR uint8_t udiv_up8(uint8_t x, uint8_t y) {
  return (x + y - 1) / y;
}

SCALAR_FUN_ATTR uint16_t udiv_up16(uint16_t x, uint16_t y) {
  return (x + y - 1) / y;
}

SCALAR_FUN_ATTR uint32_t udiv_up32(uint32_t x, uint32_t y) {
  return (x + y - 1) / y;
}

SCALAR_FUN_ATTR uint64_t udiv_up64(uint64_t x, uint64_t y) {
  return (x + y - 1) / y;
}

SCALAR_FUN_ATTR uint8_t umod8(uint8_t x, uint8_t y) {
  return x % y;
}

SCALAR_FUN_ATTR uint16_t umod16(uint16_t x, uint16_t y) {
  return x % y;
}

SCALAR_FUN_ATTR uint32_t umod32(uint32_t x, uint32_t y) {
  return x % y;
}

SCALAR_FUN_ATTR uint64_t umod64(uint64_t x, uint64_t y) {
  return x % y;
}

SCALAR_FUN_ATTR uint8_t udiv_safe8(uint8_t x, uint8_t y) {
  return y == 0 ? 0 : x / y;
}

SCALAR_FUN_ATTR uint16_t udiv_safe16(uint16_t x, uint16_t y) {
  return y == 0 ? 0 : x / y;
}

SCALAR_FUN_ATTR uint32_t udiv_safe32(uint32_t x, uint32_t y) {
  return y == 0 ? 0 : x / y;
}

SCALAR_FUN_ATTR uint64_t udiv_safe64(uint64_t x, uint64_t y) {
  return y == 0 ? 0 : x / y;
}

SCALAR_FUN_ATTR uint8_t udiv_up_safe8(uint8_t x, uint8_t y) {
  return y == 0 ? 0 : (x + y - 1) / y;
}

SCALAR_FUN_ATTR uint16_t udiv_up_safe16(uint16_t x, uint16_t y) {
  return y == 0 ? 0 : (x + y - 1) / y;
}

SCALAR_FUN_ATTR uint32_t udiv_up_safe32(uint32_t x, uint32_t y) {
  return y == 0 ? 0 : (x + y - 1) / y;
}

SCALAR_FUN_ATTR uint64_t udiv_up_safe64(uint64_t x, uint64_t y) {
  return y == 0 ? 0 : (x + y - 1) / y;
}

SCALAR_FUN_ATTR uint8_t umod_safe8(uint8_t x, uint8_t y) {
  return y == 0 ? 0 : x % y;
}

SCALAR_FUN_ATTR uint16_t umod_safe16(uint16_t x, uint16_t y) {
  return y == 0 ? 0 : x % y;
}

SCALAR_FUN_ATTR uint32_t umod_safe32(uint32_t x, uint32_t y) {
  return y == 0 ? 0 : x % y;
}

SCALAR_FUN_ATTR uint64_t umod_safe64(uint64_t x, uint64_t y) {
  return y == 0 ? 0 : x % y;
}

SCALAR_FUN_ATTR int8_t sdiv8(int8_t x, int8_t y) {
  int8_t q = x / y;
  int8_t r = x % y;

  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}

SCALAR_FUN_ATTR int16_t sdiv16(int16_t x, int16_t y) {
  int16_t q = x / y;
  int16_t r = x % y;

  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}

SCALAR_FUN_ATTR int32_t sdiv32(int32_t x, int32_t y) {
  int32_t q = x / y;
  int32_t r = x % y;

  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}

SCALAR_FUN_ATTR int64_t sdiv64(int64_t x, int64_t y) {
  int64_t q = x / y;
  int64_t r = x % y;

  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}

SCALAR_FUN_ATTR int8_t sdiv_up8(int8_t x, int8_t y) {
  return sdiv8(x + y - 1, y);
}

SCALAR_FUN_ATTR int16_t sdiv_up16(int16_t x, int16_t y) {
  return sdiv16(x + y - 1, y);
}

SCALAR_FUN_ATTR int32_t sdiv_up32(int32_t x, int32_t y) {
  return sdiv32(x + y - 1, y);
}

SCALAR_FUN_ATTR int64_t sdiv_up64(int64_t x, int64_t y) {
  return sdiv64(x + y - 1, y);
}

SCALAR_FUN_ATTR int8_t smod8(int8_t x, int8_t y) {
  int8_t r = x % y;

  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}

SCALAR_FUN_ATTR int16_t smod16(int16_t x, int16_t y) {
  int16_t r = x % y;

  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}

SCALAR_FUN_ATTR int32_t smod32(int32_t x, int32_t y) {
  int32_t r = x % y;

  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}

SCALAR_FUN_ATTR int64_t smod64(int64_t x, int64_t y) {
  int64_t r = x % y;

  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}

SCALAR_FUN_ATTR int8_t sdiv_safe8(int8_t x, int8_t y) {
  return y == 0 ? 0 : sdiv8(x, y);
}

SCALAR_FUN_ATTR int16_t sdiv_safe16(int16_t x, int16_t y) {
  return y == 0 ? 0 : sdiv16(x, y);
}

SCALAR_FUN_ATTR int32_t sdiv_safe32(int32_t x, int32_t y) {
  return y == 0 ? 0 : sdiv32(x, y);
}

SCALAR_FUN_ATTR int64_t sdiv_safe64(int64_t x, int64_t y) {
  return y == 0 ? 0 : sdiv64(x, y);
}

SCALAR_FUN_ATTR int8_t sdiv_up_safe8(int8_t x, int8_t y) {
  return sdiv_safe8(x + y - 1, y);
}

SCALAR_FUN_ATTR int16_t sdiv_up_safe16(int16_t x, int16_t y) {
  return sdiv_safe16(x + y - 1, y);
}

SCALAR_FUN_ATTR int32_t sdiv_up_safe32(int32_t x, int32_t y) {
  return sdiv_safe32(x + y - 1, y);
}

SCALAR_FUN_ATTR int64_t sdiv_up_safe64(int64_t x, int64_t y) {
  return sdiv_safe64(x + y - 1, y);
}

SCALAR_FUN_ATTR int8_t smod_safe8(int8_t x, int8_t y) {
  return y == 0 ? 0 : smod8(x, y);
}

SCALAR_FUN_ATTR int16_t smod_safe16(int16_t x, int16_t y) {
  return y == 0 ? 0 : smod16(x, y);
}

SCALAR_FUN_ATTR int32_t smod_safe32(int32_t x, int32_t y) {
  return y == 0 ? 0 : smod32(x, y);
}

SCALAR_FUN_ATTR int64_t smod_safe64(int64_t x, int64_t y) {
  return y == 0 ? 0 : smod64(x, y);
}

SCALAR_FUN_ATTR int8_t squot8(int8_t x, int8_t y) {
  return x / y;
}

SCALAR_FUN_ATTR int16_t squot16(int16_t x, int16_t y) {
  return x / y;
}

SCALAR_FUN_ATTR int32_t squot32(int32_t x, int32_t y) {
  return x / y;
}

SCALAR_FUN_ATTR int64_t squot64(int64_t x, int64_t y) {
  return x / y;
}

SCALAR_FUN_ATTR int8_t srem8(int8_t x, int8_t y) {
  return x % y;
}

SCALAR_FUN_ATTR int16_t srem16(int16_t x, int16_t y) {
  return x % y;
}

SCALAR_FUN_ATTR int32_t srem32(int32_t x, int32_t y) {
  return x % y;
}

SCALAR_FUN_ATTR int64_t srem64(int64_t x, int64_t y) {
  return x % y;
}

SCALAR_FUN_ATTR int8_t squot_safe8(int8_t x, int8_t y) {
  return y == 0 ? 0 : x / y;
}

SCALAR_FUN_ATTR int16_t squot_safe16(int16_t x, int16_t y) {
  return y == 0 ? 0 : x / y;
}

SCALAR_FUN_ATTR int32_t squot_safe32(int32_t x, int32_t y) {
  return y == 0 ? 0 : x / y;
}

SCALAR_FUN_ATTR int64_t squot_safe64(int64_t x, int64_t y) {
  return y == 0 ? 0 : x / y;
}

SCALAR_FUN_ATTR int8_t srem_safe8(int8_t x, int8_t y) {
  return y == 0 ? 0 : x % y;
}

SCALAR_FUN_ATTR int16_t srem_safe16(int16_t x, int16_t y) {
  return y == 0 ? 0 : x % y;
}

SCALAR_FUN_ATTR int32_t srem_safe32(int32_t x, int32_t y) {
  return y == 0 ? 0 : x % y;
}

SCALAR_FUN_ATTR int64_t srem_safe64(int64_t x, int64_t y) {
  return y == 0 ? 0 : x % y;
}

#endif

SCALAR_FUN_ATTR int8_t smin8(int8_t x, int8_t y) {
  return x < y ? x : y;
}

SCALAR_FUN_ATTR int16_t smin16(int16_t x, int16_t y) {
  return x < y ? x : y;
}

SCALAR_FUN_ATTR int32_t smin32(int32_t x, int32_t y) {
  return x < y ? x : y;
}

SCALAR_FUN_ATTR int64_t smin64(int64_t x, int64_t y) {
  return x < y ? x : y;
}

SCALAR_FUN_ATTR uint8_t umin8(uint8_t x, uint8_t y) {
  return x < y ? x : y;
}

SCALAR_FUN_ATTR uint16_t umin16(uint16_t x, uint16_t y) {
  return x < y ? x : y;
}

SCALAR_FUN_ATTR uint32_t umin32(uint32_t x, uint32_t y) {
  return x < y ? x : y;
}

SCALAR_FUN_ATTR uint64_t umin64(uint64_t x, uint64_t y) {
  return x < y ? x : y;
}

SCALAR_FUN_ATTR int8_t smax8(int8_t x, int8_t y) {
  return x < y ? y : x;
}

SCALAR_FUN_ATTR int16_t smax16(int16_t x, int16_t y) {
  return x < y ? y : x;
}

SCALAR_FUN_ATTR int32_t smax32(int32_t x, int32_t y) {
  return x < y ? y : x;
}

SCALAR_FUN_ATTR int64_t smax64(int64_t x, int64_t y) {
  return x < y ? y : x;
}

SCALAR_FUN_ATTR uint8_t umax8(uint8_t x, uint8_t y) {
  return x < y ? y : x;
}

SCALAR_FUN_ATTR uint16_t umax16(uint16_t x, uint16_t y) {
  return x < y ? y : x;
}

SCALAR_FUN_ATTR uint32_t umax32(uint32_t x, uint32_t y) {
  return x < y ? y : x;
}

SCALAR_FUN_ATTR uint64_t umax64(uint64_t x, uint64_t y) {
  return x < y ? y : x;
}

SCALAR_FUN_ATTR uint8_t shl8(uint8_t x, uint8_t y) {
  return (uint8_t)(x << y);
}

SCALAR_FUN_ATTR uint16_t shl16(uint16_t x, uint16_t y) {
  return (uint16_t)(x << y);
}

SCALAR_FUN_ATTR uint32_t shl32(uint32_t x, uint32_t y) {
  return x << y;
}

SCALAR_FUN_ATTR uint64_t shl64(uint64_t x, uint64_t y) {
  return x << y;
}

SCALAR_FUN_ATTR uint8_t lshr8(uint8_t x, uint8_t y) {
  return x >> y;
}

SCALAR_FUN_ATTR uint16_t lshr16(uint16_t x, uint16_t y) {
  return x >> y;
}

SCALAR_FUN_ATTR uint32_t lshr32(uint32_t x, uint32_t y) {
  return x >> y;
}

SCALAR_FUN_ATTR uint64_t lshr64(uint64_t x, uint64_t y) {
  return x >> y;
}

SCALAR_FUN_ATTR int8_t ashr8(int8_t x, int8_t y) {
  return x >> y;
}

SCALAR_FUN_ATTR int16_t ashr16(int16_t x, int16_t y) {
  return x >> y;
}

SCALAR_FUN_ATTR int32_t ashr32(int32_t x, int32_t y) {
  return x >> y;
}

SCALAR_FUN_ATTR int64_t ashr64(int64_t x, int64_t y) {
  return x >> y;
}

SCALAR_FUN_ATTR uint8_t and8(uint8_t x, uint8_t y) {
  return x & y;
}

SCALAR_FUN_ATTR uint16_t and16(uint16_t x, uint16_t y) {
  return x & y;
}

SCALAR_FUN_ATTR uint32_t and32(uint32_t x, uint32_t y) {
  return x & y;
}

SCALAR_FUN_ATTR uint64_t and64(uint64_t x, uint64_t y) {
  return x & y;
}

SCALAR_FUN_ATTR uint8_t or8(uint8_t x, uint8_t y) {
  return x | y;
}

SCALAR_FUN_ATTR uint16_t or16(uint16_t x, uint16_t y) {
  return x | y;
}

SCALAR_FUN_ATTR uint32_t or32(uint32_t x, uint32_t y) {
  return x | y;
}

SCALAR_FUN_ATTR uint64_t or64(uint64_t x, uint64_t y) {
  return x | y;
}

SCALAR_FUN_ATTR uint8_t xor8(uint8_t x, uint8_t y) {
  return x ^ y;
}

SCALAR_FUN_ATTR uint16_t xor16(uint16_t x, uint16_t y) {
  return x ^ y;
}

SCALAR_FUN_ATTR uint32_t xor32(uint32_t x, uint32_t y) {
  return x ^ y;
}

SCALAR_FUN_ATTR uint64_t xor64(uint64_t x, uint64_t y) {
  return x ^ y;
}

SCALAR_FUN_ATTR bool ult8(uint8_t x, uint8_t y) {
  return x < y;
}

SCALAR_FUN_ATTR bool ult16(uint16_t x, uint16_t y) {
  return x < y;
}

SCALAR_FUN_ATTR bool ult32(uint32_t x, uint32_t y) {
  return x < y;
}

SCALAR_FUN_ATTR bool ult64(uint64_t x, uint64_t y) {
  return x < y;
}

SCALAR_FUN_ATTR bool ule8(uint8_t x, uint8_t y) {
  return x <= y;
}

SCALAR_FUN_ATTR bool ule16(uint16_t x, uint16_t y) {
  return x <= y;
}

SCALAR_FUN_ATTR bool ule32(uint32_t x, uint32_t y) {
  return x <= y;
}

SCALAR_FUN_ATTR bool ule64(uint64_t x, uint64_t y) {
  return x <= y;
}

SCALAR_FUN_ATTR bool slt8(int8_t x, int8_t y) {
  return x < y;
}

SCALAR_FUN_ATTR bool slt16(int16_t x, int16_t y) {
  return x < y;
}

SCALAR_FUN_ATTR bool slt32(int32_t x, int32_t y) {
  return x < y;
}

SCALAR_FUN_ATTR bool slt64(int64_t x, int64_t y) {
  return x < y;
}

SCALAR_FUN_ATTR bool sle8(int8_t x, int8_t y) {
  return x <= y;
}

SCALAR_FUN_ATTR bool sle16(int16_t x, int16_t y) {
  return x <= y;
}

SCALAR_FUN_ATTR bool sle32(int32_t x, int32_t y) {
  return x <= y;
}

SCALAR_FUN_ATTR bool sle64(int64_t x, int64_t y) {
  return x <= y;
}

SCALAR_FUN_ATTR uint8_t pow8(uint8_t x, uint8_t y) {
  uint8_t res = 1, rem = y;

  while (rem != 0) {
    if (rem & 1)
      res *= x;
    rem >>= 1;
    x *= x;
  }
  return res;
}

SCALAR_FUN_ATTR uint16_t pow16(uint16_t x, uint16_t y) {
  uint16_t res = 1, rem = y;

  while (rem != 0) {
    if (rem & 1)
      res *= x;
    rem >>= 1;
    x *= x;
  }
  return res;
}

SCALAR_FUN_ATTR uint32_t pow32(uint32_t x, uint32_t y) {
  uint32_t res = 1, rem = y;

  while (rem != 0) {
    if (rem & 1)
      res *= x;
    rem >>= 1;
    x *= x;
  }
  return res;
}

SCALAR_FUN_ATTR uint64_t pow64(uint64_t x, uint64_t y) {
  uint64_t res = 1, rem = y;

  while (rem != 0) {
    if (rem & 1)
      res *= x;
    rem >>= 1;
    x *= x;
  }
  return res;
}

SCALAR_FUN_ATTR bool itob_i8_bool(int8_t x) {
  return x != 0;
}

SCALAR_FUN_ATTR bool itob_i16_bool(int16_t x) {
  return x != 0;
}

SCALAR_FUN_ATTR bool itob_i32_bool(int32_t x) {
  return x != 0;
}

SCALAR_FUN_ATTR bool itob_i64_bool(int64_t x) {
  return x != 0;
}

SCALAR_FUN_ATTR int8_t btoi_bool_i8(bool x) {
  return x;
}

SCALAR_FUN_ATTR int16_t btoi_bool_i16(bool x) {
  return x;
}

SCALAR_FUN_ATTR int32_t btoi_bool_i32(bool x) {
  return x;
}

SCALAR_FUN_ATTR int64_t btoi_bool_i64(bool x) {
  return x;
}

#define sext_i8_i8(x) ((int8_t) (int8_t) (x))
#define sext_i8_i16(x) ((int16_t) (int8_t) (x))
#define sext_i8_i32(x) ((int32_t) (int8_t) (x))
#define sext_i8_i64(x) ((int64_t) (int8_t) (x))
#define sext_i16_i8(x) ((int8_t) (int16_t) (x))
#define sext_i16_i16(x) ((int16_t) (int16_t) (x))
#define sext_i16_i32(x) ((int32_t) (int16_t) (x))
#define sext_i16_i64(x) ((int64_t) (int16_t) (x))
#define sext_i32_i8(x) ((int8_t) (int32_t) (x))
#define sext_i32_i16(x) ((int16_t) (int32_t) (x))
#define sext_i32_i32(x) ((int32_t) (int32_t) (x))
#define sext_i32_i64(x) ((int64_t) (int32_t) (x))
#define sext_i64_i8(x) ((int8_t) (int64_t) (x))
#define sext_i64_i16(x) ((int16_t) (int64_t) (x))
#define sext_i64_i32(x) ((int32_t) (int64_t) (x))
#define sext_i64_i64(x) ((int64_t) (int64_t) (x))
#define zext_i8_i8(x) ((int8_t) (uint8_t) (x))
#define zext_i8_i16(x) ((int16_t) (uint8_t) (x))
#define zext_i8_i32(x) ((int32_t) (uint8_t) (x))
#define zext_i8_i64(x) ((int64_t) (uint8_t) (x))
#define zext_i16_i8(x) ((int8_t) (uint16_t) (x))
#define zext_i16_i16(x) ((int16_t) (uint16_t) (x))
#define zext_i16_i32(x) ((int32_t) (uint16_t) (x))
#define zext_i16_i64(x) ((int64_t) (uint16_t) (x))
#define zext_i32_i8(x) ((int8_t) (uint32_t) (x))
#define zext_i32_i16(x) ((int16_t) (uint32_t) (x))
#define zext_i32_i32(x) ((int32_t) (uint32_t) (x))
#define zext_i32_i64(x) ((int64_t) (uint32_t) (x))
#define zext_i64_i8(x) ((int8_t) (uint64_t) (x))
#define zext_i64_i16(x) ((int16_t) (uint64_t) (x))
#define zext_i64_i32(x) ((int32_t) (uint64_t) (x))
#define zext_i64_i64(x) ((int64_t) (uint64_t) (x))

SCALAR_FUN_ATTR int8_t abs8(int8_t x) {
  return (int8_t)abs(x);
}

SCALAR_FUN_ATTR int16_t abs16(int16_t x) {
  return (int16_t)abs(x);
}

SCALAR_FUN_ATTR int32_t abs32(int32_t x) {
  return abs(x);
}

SCALAR_FUN_ATTR int64_t abs64(int64_t x) {
#if defined(__OPENCL_VERSION__) || defined(ISPC)
  return abs(x);
#else
  return llabs(x);
#endif
}

#if defined(__OPENCL_VERSION__)
SCALAR_FUN_ATTR int32_t futrts_popc8(int8_t x) {
  return popcount(x);
}

SCALAR_FUN_ATTR int32_t futrts_popc16(int16_t x) {
  return popcount(x);
}

SCALAR_FUN_ATTR int32_t futrts_popc32(int32_t x) {
  return popcount(x);
}

SCALAR_FUN_ATTR int32_t futrts_popc64(int64_t x) {
  return popcount(x);
}
#elif defined(__CUDA_ARCH__)

SCALAR_FUN_ATTR int32_t futrts_popc8(int8_t x) {
  return __popc(zext_i8_i32(x));
}

SCALAR_FUN_ATTR int32_t futrts_popc16(int16_t x) {
  return __popc(zext_i16_i32(x));
}

SCALAR_FUN_ATTR int32_t futrts_popc32(int32_t x) {
  return __popc(x);
}

SCALAR_FUN_ATTR int32_t futrts_popc64(int64_t x) {
  return __popcll(x);
}

#else // Not OpenCL or CUDA, but plain C.

SCALAR_FUN_ATTR int32_t futrts_popc8(uint8_t x) {
  int c = 0;
  for (; x; ++c) { x &= x - 1; }
  return c;
}

SCALAR_FUN_ATTR int32_t futrts_popc16(uint16_t x) {
  int c = 0;
  for (; x; ++c) { x &= x - 1; }
  return c;
}

SCALAR_FUN_ATTR int32_t futrts_popc32(uint32_t x) {
  int c = 0;
  for (; x; ++c) { x &= x - 1; }
  return c;
}

SCALAR_FUN_ATTR int32_t futrts_popc64(uint64_t x) {
  int c = 0;
  for (; x; ++c) { x &= x - 1; }
  return c;
}
#endif

#if defined(__OPENCL_VERSION__)
SCALAR_FUN_ATTR uint8_t  futrts_umul_hi8 ( uint8_t a,  uint8_t b) { return mul_hi(a, b); }
SCALAR_FUN_ATTR uint16_t futrts_umul_hi16(uint16_t a, uint16_t b) { return mul_hi(a, b); }
SCALAR_FUN_ATTR uint32_t futrts_umul_hi32(uint32_t a, uint32_t b) { return mul_hi(a, b); }
SCALAR_FUN_ATTR uint64_t futrts_umul_hi64(uint64_t a, uint64_t b) { return mul_hi(a, b); }
SCALAR_FUN_ATTR uint8_t  futrts_smul_hi8 ( int8_t a,  int8_t b) { return mul_hi(a, b); }
SCALAR_FUN_ATTR uint16_t futrts_smul_hi16(int16_t a, int16_t b) { return mul_hi(a, b); }
SCALAR_FUN_ATTR uint32_t futrts_smul_hi32(int32_t a, int32_t b) { return mul_hi(a, b); }
SCALAR_FUN_ATTR uint64_t futrts_smul_hi64(int64_t a, int64_t b) { return mul_hi(a, b); }
#elif defined(__CUDA_ARCH__)
SCALAR_FUN_ATTR  uint8_t futrts_umul_hi8(uint8_t a, uint8_t b) { return ((uint16_t)a) * ((uint16_t)b) >> 8; }
SCALAR_FUN_ATTR uint16_t futrts_umul_hi16(uint16_t a, uint16_t b) { return ((uint32_t)a) * ((uint32_t)b) >> 16; }
SCALAR_FUN_ATTR uint32_t futrts_umul_hi32(uint32_t a, uint32_t b) { return __umulhi(a, b); }
SCALAR_FUN_ATTR uint64_t futrts_umul_hi64(uint64_t a, uint64_t b) { return __umul64hi(a, b); }
SCALAR_FUN_ATTR  uint8_t futrts_smul_hi8 ( int8_t a, int8_t b) { return ((int16_t)a) * ((int16_t)b) >> 8; }
SCALAR_FUN_ATTR uint16_t futrts_smul_hi16(int16_t a, int16_t b) { return ((int32_t)a) * ((int32_t)b) >> 16; }
SCALAR_FUN_ATTR uint32_t futrts_smul_hi32(int32_t a, int32_t b) { return __mulhi(a, b); }
SCALAR_FUN_ATTR uint64_t futrts_smul_hi64(int64_t a, int64_t b) { return __mul64hi(a, b); }
#elif ISPC
SCALAR_FUN_ATTR uint8_t futrts_umul_hi8(uint8_t a, uint8_t b) { return ((uint16_t)a) * ((uint16_t)b) >> 8; }
SCALAR_FUN_ATTR uint16_t futrts_umul_hi16(uint16_t a, uint16_t b) { return ((uint32_t)a) * ((uint32_t)b) >> 16; }
SCALAR_FUN_ATTR uint32_t futrts_umul_hi32(uint32_t a, uint32_t b) { return ((uint64_t)a) * ((uint64_t)b) >> 32; }
SCALAR_FUN_ATTR uint64_t futrts_umul_hi64(uint64_t a, uint64_t b) {
  uint64_t ah = a >> 32;
  uint64_t al = a & 0xffffffff;
  uint64_t bh = b >> 32;
  uint64_t bl = b & 0xffffffff;

  uint64_t p1 = al * bl;
  uint64_t p2 = al * bh;
  uint64_t p3 = ah * bl;
  uint64_t p4 = ah * bh;

  uint64_t p1h = p1 >> 32;
  uint64_t p2h = p2 >> 32;
  uint64_t p3h = p3 >> 32;
  uint64_t p2l = p2 & 0xffffffff;
  uint64_t p3l = p3 & 0xffffffff;

  uint64_t l = p1h + p2l + p3l;
  uint64_t m = (p2 >> 32) + (p3 >> 32);
  uint64_t h = (l >> 32) + m + p4;

  return h;
}
SCALAR_FUN_ATTR  int8_t futrts_smul_hi8 ( int8_t a,  int8_t b) { return ((uint16_t)a) * ((uint16_t)b) >> 8; }
SCALAR_FUN_ATTR int16_t futrts_smul_hi16(int16_t a, int16_t b) { return ((uint32_t)a) * ((uint32_t)b) >> 16; }
SCALAR_FUN_ATTR int32_t futrts_smul_hi32(int32_t a, int32_t b) { return ((uint64_t)a) * ((uint64_t)b) >> 32; }
SCALAR_FUN_ATTR int64_t futrts_smul_hi64(int64_t a, int64_t b) {
  uint64_t ah = a >> 32;
  uint64_t al = a & 0xffffffff;
  uint64_t bh = b >> 32;
  uint64_t bl = b & 0xffffffff;

  uint64_t p1 =  al * bl;
  int64_t  p2 = al * bh;
  int64_t  p3 = ah * bl;
  uint64_t p4 =  ah * bh;

  uint64_t p1h = p1 >> 32;
  uint64_t p2h = p2 >> 32;
  uint64_t p3h = p3 >> 32;
  uint64_t p2l = p2 & 0xffffffff;
  uint64_t p3l = p3 & 0xffffffff;

  uint64_t l = p1h + p2l + p3l;
  uint64_t m = (p2 >> 32) + (p3 >> 32);
  uint64_t h = (l >> 32) + m + p4;

  return h;
}

#else // Not OpenCL, ISPC, or CUDA, but plain C.
SCALAR_FUN_ATTR uint8_t futrts_umul_hi8(uint8_t a, uint8_t b) { return ((uint16_t)a) * ((uint16_t)b) >> 8; }
SCALAR_FUN_ATTR uint16_t futrts_umul_hi16(uint16_t a, uint16_t b) { return ((uint32_t)a) * ((uint32_t)b) >> 16; }
SCALAR_FUN_ATTR uint32_t futrts_umul_hi32(uint32_t a, uint32_t b) { return ((uint64_t)a) * ((uint64_t)b) >> 32; }
SCALAR_FUN_ATTR uint64_t futrts_umul_hi64(uint64_t a, uint64_t b) { return ((__uint128_t)a) * ((__uint128_t)b) >> 64; }
SCALAR_FUN_ATTR int8_t futrts_smul_hi8(int8_t a, int8_t b) { return ((int16_t)a) * ((int16_t)b) >> 8; }
SCALAR_FUN_ATTR int16_t futrts_smul_hi16(int16_t a, int16_t b) { return ((int32_t)a) * ((int32_t)b) >> 16; }
SCALAR_FUN_ATTR int32_t futrts_smul_hi32(int32_t a, int32_t b) { return ((int64_t)a) * ((int64_t)b) >> 32; }
SCALAR_FUN_ATTR int64_t futrts_smul_hi64(int64_t a, int64_t b) { return ((__int128_t)a) * ((__int128_t)b) >> 64; }
#endif

#if defined(__OPENCL_VERSION__)
SCALAR_FUN_ATTR  uint8_t futrts_umad_hi8 ( uint8_t a,  uint8_t b,  uint8_t c) { return mad_hi(a, b, c); }
SCALAR_FUN_ATTR uint16_t futrts_umad_hi16(uint16_t a, uint16_t b, uint16_t c) { return mad_hi(a, b, c); }
SCALAR_FUN_ATTR uint32_t futrts_umad_hi32(uint32_t a, uint32_t b, uint32_t c) { return mad_hi(a, b, c); }
SCALAR_FUN_ATTR uint64_t futrts_umad_hi64(uint64_t a, uint64_t b, uint64_t c) { return mad_hi(a, b, c); }
SCALAR_FUN_ATTR  uint8_t futrts_smad_hi8( int8_t a,  int8_t b,   int8_t c) { return mad_hi(a, b, c); }
SCALAR_FUN_ATTR uint16_t futrts_smad_hi16(int16_t a, int16_t b, int16_t c) { return mad_hi(a, b, c); }
SCALAR_FUN_ATTR uint32_t futrts_smad_hi32(int32_t a, int32_t b, int32_t c) { return mad_hi(a, b, c); }
SCALAR_FUN_ATTR uint64_t futrts_smad_hi64(int64_t a, int64_t b, int64_t c) { return mad_hi(a, b, c); }
#else // Not OpenCL

SCALAR_FUN_ATTR  uint8_t futrts_umad_hi8( uint8_t a,  uint8_t b,  uint8_t c) { return futrts_umul_hi8(a, b) + c; }
SCALAR_FUN_ATTR uint16_t futrts_umad_hi16(uint16_t a, uint16_t b, uint16_t c) { return futrts_umul_hi16(a, b) + c; }
SCALAR_FUN_ATTR uint32_t futrts_umad_hi32(uint32_t a, uint32_t b, uint32_t c) { return futrts_umul_hi32(a, b) + c; }
SCALAR_FUN_ATTR uint64_t futrts_umad_hi64(uint64_t a, uint64_t b, uint64_t c) { return futrts_umul_hi64(a, b) + c; }
SCALAR_FUN_ATTR  uint8_t futrts_smad_hi8 ( int8_t a,  int8_t b,  int8_t c) { return futrts_smul_hi8(a, b) + c; }
SCALAR_FUN_ATTR uint16_t futrts_smad_hi16(int16_t a, int16_t b, int16_t c) { return futrts_smul_hi16(a, b) + c; }
SCALAR_FUN_ATTR uint32_t futrts_smad_hi32(int32_t a, int32_t b, int32_t c) { return futrts_smul_hi32(a, b) + c; }
SCALAR_FUN_ATTR uint64_t futrts_smad_hi64(int64_t a, int64_t b, int64_t c) { return futrts_smul_hi64(a, b) + c; }
#endif

#if defined(__OPENCL_VERSION__)
SCALAR_FUN_ATTR int32_t futrts_clzz8(int8_t x) {
  return clz(x);
}

SCALAR_FUN_ATTR int32_t futrts_clzz16(int16_t x) {
  return clz(x);
}

SCALAR_FUN_ATTR int32_t futrts_clzz32(int32_t x) {
  return clz(x);
}

SCALAR_FUN_ATTR int32_t futrts_clzz64(int64_t x) {
  return clz(x);
}

#elif defined(__CUDA_ARCH__)

SCALAR_FUN_ATTR int32_t futrts_clzz8(int8_t x) {
  return __clz(zext_i8_i32(x)) - 24;
}

SCALAR_FUN_ATTR int32_t futrts_clzz16(int16_t x) {
  return __clz(zext_i16_i32(x)) - 16;
}

SCALAR_FUN_ATTR int32_t futrts_clzz32(int32_t x) {
  return __clz(x);
}

SCALAR_FUN_ATTR int32_t futrts_clzz64(int64_t x) {
  return __clzll(x);
}

#elif ISPC

SCALAR_FUN_ATTR int32_t futrts_clzz8(int8_t x) {
  return count_leading_zeros((int32_t)(uint8_t)x)-24;
}

SCALAR_FUN_ATTR int32_t futrts_clzz16(int16_t x) {
  return count_leading_zeros((int32_t)(uint16_t)x)-16;
}

SCALAR_FUN_ATTR int32_t futrts_clzz32(int32_t x) {
  return count_leading_zeros(x);
}

SCALAR_FUN_ATTR int32_t futrts_clzz64(int64_t x) {
  return count_leading_zeros(x);
}

#else // Not OpenCL, ISPC or CUDA, but plain C.

SCALAR_FUN_ATTR int32_t futrts_clzz8(int8_t x) {
  return x == 0 ? 8 : __builtin_clz((uint32_t)zext_i8_i32(x)) - 24;
}

SCALAR_FUN_ATTR int32_t futrts_clzz16(int16_t x) {
  return x == 0 ? 16 : __builtin_clz((uint32_t)zext_i16_i32(x)) - 16;
}

SCALAR_FUN_ATTR int32_t futrts_clzz32(int32_t x) {
  return x == 0 ? 32 : __builtin_clz((uint32_t)x);
}

SCALAR_FUN_ATTR int32_t futrts_clzz64(int64_t x) {
  return x == 0 ? 64 : __builtin_clzll((uint64_t)x);
}
#endif

#if defined(__OPENCL_VERSION__)
SCALAR_FUN_ATTR int32_t futrts_ctzz8(int8_t x) {
  int i = 0;
  for (; i < 8 && (x & 1) == 0; i++, x >>= 1)
    ;
  return i;
}

SCALAR_FUN_ATTR int32_t futrts_ctzz16(int16_t x) {
  int i = 0;
  for (; i < 16 && (x & 1) == 0; i++, x >>= 1)
    ;
  return i;
}

SCALAR_FUN_ATTR int32_t futrts_ctzz32(int32_t x) {
  int i = 0;
  for (; i < 32 && (x & 1) == 0; i++, x >>= 1)
    ;
  return i;
}

SCALAR_FUN_ATTR int32_t futrts_ctzz64(int64_t x) {
  int i = 0;
  for (; i < 64 && (x & 1) == 0; i++, x >>= 1)
    ;
  return i;
}

#elif defined(__CUDA_ARCH__)

SCALAR_FUN_ATTR int32_t futrts_ctzz8(int8_t x) {
  int y = __ffs(x);
  return y == 0 ? 8 : y - 1;
}

SCALAR_FUN_ATTR int32_t futrts_ctzz16(int16_t x) {
  int y = __ffs(x);
  return y == 0 ? 16 : y - 1;
}

SCALAR_FUN_ATTR int32_t futrts_ctzz32(int32_t x) {
  int y = __ffs(x);
  return y == 0 ? 32 : y - 1;
}

SCALAR_FUN_ATTR int32_t futrts_ctzz64(int64_t x) {
  int y = __ffsll(x);
  return y == 0 ? 64 : y - 1;
}

#elif ISPC

SCALAR_FUN_ATTR int32_t futrts_ctzz8(int8_t x) {
  return x == 0 ? 8 : count_trailing_zeros((int32_t)x);
}

SCALAR_FUN_ATTR int32_t futrts_ctzz16(int16_t x) {
  return x == 0 ? 16 : count_trailing_zeros((int32_t)x);
}

SCALAR_FUN_ATTR int32_t futrts_ctzz32(int32_t x) {
  return count_trailing_zeros(x);
}

SCALAR_FUN_ATTR int32_t futrts_ctzz64(int64_t x) {
  return count_trailing_zeros(x);
}

#else // Not OpenCL or CUDA, but plain C.

SCALAR_FUN_ATTR int32_t futrts_ctzz8(int8_t x) {
  return x == 0 ? 8 : __builtin_ctz((uint32_t)x);
}

SCALAR_FUN_ATTR int32_t futrts_ctzz16(int16_t x) {
  return x == 0 ? 16 : __builtin_ctz((uint32_t)x);
}

SCALAR_FUN_ATTR int32_t futrts_ctzz32(int32_t x) {
  return x == 0 ? 32 : __builtin_ctz((uint32_t)x);
}

SCALAR_FUN_ATTR int32_t futrts_ctzz64(int64_t x) {
  return x == 0 ? 64 : __builtin_ctzll((uint64_t)x);
}
#endif

SCALAR_FUN_ATTR float fdiv32(float x, float y) {
  return x / y;
}

SCALAR_FUN_ATTR float fadd32(float x, float y) {
  return x + y;
}

SCALAR_FUN_ATTR float fsub32(float x, float y) {
  return x - y;
}

SCALAR_FUN_ATTR float fmul32(float x, float y) {
  return x * y;
}

SCALAR_FUN_ATTR bool cmplt32(float x, float y) {
  return x < y;
}

SCALAR_FUN_ATTR bool cmple32(float x, float y) {
  return x <= y;
}

SCALAR_FUN_ATTR float sitofp_i8_f32(int8_t x) {
  return (float) x;
}

SCALAR_FUN_ATTR float sitofp_i16_f32(int16_t x) {
  return (float) x;
}

SCALAR_FUN_ATTR float sitofp_i32_f32(int32_t x) {
  return (float) x;
}

SCALAR_FUN_ATTR float sitofp_i64_f32(int64_t x) {
  return (float) x;
}

SCALAR_FUN_ATTR float uitofp_i8_f32(uint8_t x) {
  return (float) x;
}

SCALAR_FUN_ATTR float uitofp_i16_f32(uint16_t x) {
  return (float) x;
}

SCALAR_FUN_ATTR float uitofp_i32_f32(uint32_t x) {
  return (float) x;
}

SCALAR_FUN_ATTR float uitofp_i64_f32(uint64_t x) {
  return (float) x;
}

#ifdef __OPENCL_VERSION__
SCALAR_FUN_ATTR float fabs32(float x) {
  return fabs(x);
}

SCALAR_FUN_ATTR float fmax32(float x, float y) {
  return fmax(x, y);
}

SCALAR_FUN_ATTR float fmin32(float x, float y) {
  return fmin(x, y);
}

SCALAR_FUN_ATTR float fpow32(float x, float y) {
  return pow(x, y);
}

#elif ISPC

SCALAR_FUN_ATTR float fabs32(float x) {
  return abs(x);
}

SCALAR_FUN_ATTR float fmax32(float x, float y) {
  return isnan(x) ? y : isnan(y) ? x : max(x, y);
}

SCALAR_FUN_ATTR float fmin32(float x, float y) {
  return isnan(x) ? y : isnan(y) ? x : min(x, y);
}

SCALAR_FUN_ATTR float fpow32(float a, float b) {
  float ret;
  foreach_active (i) {
      uniform float r = __stdlib_powf(extract(a, i), extract(b, i));
      ret = insert(ret, i, r);
  }
  return ret;
}

#else // Not OpenCL, but CUDA or plain C.

SCALAR_FUN_ATTR float fabs32(float x) {
  return fabsf(x);
}

SCALAR_FUN_ATTR float fmax32(float x, float y) {
  return fmaxf(x, y);
}

SCALAR_FUN_ATTR float fmin32(float x, float y) {
  return fminf(x, y);
}

SCALAR_FUN_ATTR float fpow32(float x, float y) {
  return powf(x, y);
}
#endif

SCALAR_FUN_ATTR bool futrts_isnan32(float x) {
  return isnan(x);
}

#if ISPC

SCALAR_FUN_ATTR bool futrts_isinf32(float x) {
  return !isnan(x) && isnan(x - x);
}

SCALAR_FUN_ATTR bool futrts_isfinite32(float x) {
  return !isnan(x) && !futrts_isinf32(x);
}

#else

SCALAR_FUN_ATTR bool futrts_isinf32(float x) {
  return isinf(x);
}

#endif

SCALAR_FUN_ATTR int8_t fptosi_f32_i8(float x) {
  if (futrts_isnan32(x) || futrts_isinf32(x)) {
    return 0;
  } else {
    return (int8_t) x;
  }
}

SCALAR_FUN_ATTR int16_t fptosi_f32_i16(float x) {
  if (futrts_isnan32(x) || futrts_isinf32(x)) {
    return 0;
  } else {
    return (int16_t) x;
  }
}

SCALAR_FUN_ATTR int32_t fptosi_f32_i32(float x) {
  if (futrts_isnan32(x) || futrts_isinf32(x)) {
    return 0;
  } else {
    return (int32_t) x;
  }
}

SCALAR_FUN_ATTR int64_t fptosi_f32_i64(float x) {
  if (futrts_isnan32(x) || futrts_isinf32(x)) {
    return 0;
  } else {
    return (int64_t) x;
  };
}

SCALAR_FUN_ATTR uint8_t fptoui_f32_i8(float x) {
  if (futrts_isnan32(x) || futrts_isinf32(x)) {
    return 0;
  } else {
    return (uint8_t) (int8_t) x;
  }
}

SCALAR_FUN_ATTR uint16_t fptoui_f32_i16(float x) {
  if (futrts_isnan32(x) || futrts_isinf32(x)) {
    return 0;
  } else {
    return (uint16_t) (int16_t) x;
  }
}

SCALAR_FUN_ATTR uint32_t fptoui_f32_i32(float x) {
  if (futrts_isnan32(x) || futrts_isinf32(x)) {
    return 0;
  } else {
    return (uint32_t) (int32_t) x;
  }
}

SCALAR_FUN_ATTR uint64_t fptoui_f32_i64(float x) {
  if (futrts_isnan32(x) || futrts_isinf32(x)) {
    return 0;
  } else {
    return (uint64_t) (int64_t) x;
  }
}

SCALAR_FUN_ATTR bool ftob_f32_bool(float x) {
  return x != 0;
}

SCALAR_FUN_ATTR float btof_bool_f32(bool x) {
  return x ? 1 : 0;
}

#ifdef __OPENCL_VERSION__
SCALAR_FUN_ATTR float futrts_log32(float x) {
  return log(x);
}

SCALAR_FUN_ATTR float futrts_log2_32(float x) {
  return log2(x);
}

SCALAR_FUN_ATTR float futrts_log10_32(float x) {
  return log10(x);
}

SCALAR_FUN_ATTR float futrts_log1p_32(float x) {
  return log1p(x);
}

SCALAR_FUN_ATTR float futrts_sqrt32(float x) {
  return sqrt(x);
}

SCALAR_FUN_ATTR float futrts_cbrt32(float x) {
  return cbrt(x);
}

SCALAR_FUN_ATTR float futrts_exp32(float x) {
  return exp(x);
}

SCALAR_FUN_ATTR float futrts_cos32(float x) {
  return cos(x);
}

SCALAR_FUN_ATTR float futrts_sin32(float x) {
  return sin(x);
}

SCALAR_FUN_ATTR float futrts_tan32(float x) {
  return tan(x);
}

SCALAR_FUN_ATTR float futrts_acos32(float x) {
  return acos(x);
}

SCALAR_FUN_ATTR float futrts_asin32(float x) {
  return asin(x);
}

SCALAR_FUN_ATTR float futrts_atan32(float x) {
  return atan(x);
}

SCALAR_FUN_ATTR float futrts_cosh32(float x) {
  return cosh(x);
}

SCALAR_FUN_ATTR float futrts_sinh32(float x) {
  return sinh(x);
}

SCALAR_FUN_ATTR float futrts_tanh32(float x) {
  return tanh(x);
}

SCALAR_FUN_ATTR float futrts_acosh32(float x) {
  return acosh(x);
}

SCALAR_FUN_ATTR float futrts_asinh32(float x) {
  return asinh(x);
}

SCALAR_FUN_ATTR float futrts_atanh32(float x) {
  return atanh(x);
}

SCALAR_FUN_ATTR float futrts_atan2_32(float x, float y) {
  return atan2(x, y);
}

SCALAR_FUN_ATTR float futrts_hypot32(float x, float y) {
  return hypot(x, y);
}

SCALAR_FUN_ATTR float futrts_gamma32(float x) {
  return tgamma(x);
}

SCALAR_FUN_ATTR float futrts_lgamma32(float x) {
  return lgamma(x);
}

SCALAR_FUN_ATTR float futrts_erf32(float x) {
  return erf(x);
}

SCALAR_FUN_ATTR float futrts_erfc32(float x) {
  return erfc(x);
}

SCALAR_FUN_ATTR float fmod32(float x, float y) {
  return fmod(x, y);
}

SCALAR_FUN_ATTR float futrts_round32(float x) {
  return rint(x);
}

SCALAR_FUN_ATTR float futrts_floor32(float x) {
  return floor(x);
}

SCALAR_FUN_ATTR float futrts_ceil32(float x) {
  return ceil(x);
}

SCALAR_FUN_ATTR float futrts_nextafter32(float x, float y) {
  return nextafter(x, y);
}

SCALAR_FUN_ATTR float futrts_lerp32(float v0, float v1, float t) {
  return mix(v0, v1, t);
}

SCALAR_FUN_ATTR float futrts_ldexp32(float x, int32_t y) {
  return ldexp(x, y);
}

SCALAR_FUN_ATTR float futrts_copysign32(float x, float y) {
  return copysign(x, y);
}

SCALAR_FUN_ATTR float futrts_mad32(float a, float b, float c) {
  return mad(a, b, c);
}

SCALAR_FUN_ATTR float futrts_fma32(float a, float b, float c) {
  return fma(a, b, c);
}

#elif ISPC

SCALAR_FUN_ATTR float futrts_log32(float x) {
  return futrts_isfinite32(x) || (futrts_isinf32(x) && x < 0)? log(x) : x;
}

SCALAR_FUN_ATTR float futrts_log2_32(float x) {
  return futrts_log32(x) / log(2.0f);
}

SCALAR_FUN_ATTR float futrts_log10_32(float x) {
  return futrts_log32(x) / log(10.0f);
}

SCALAR_FUN_ATTR float futrts_log1p_32(float x) {
  if(x == -1.0f || (futrts_isinf32(x) && x > 0.0f)) return x / 0.0f;
  float y = 1.0f + x;
  float z = y - 1.0f;
  return log(y) - (z-x)/y;
}

SCALAR_FUN_ATTR float futrts_sqrt32(float x) {
  return sqrt(x);
}

extern "C" unmasked uniform float cbrtf(uniform float);
SCALAR_FUN_ATTR float futrts_cbrt32(float x) {
  float res;
  foreach_active (i) {
    uniform float r = cbrtf(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

SCALAR_FUN_ATTR float futrts_exp32(float x) {
  return exp(x);
}

SCALAR_FUN_ATTR float futrts_cos32(float x) {
  return cos(x);
}

SCALAR_FUN_ATTR float futrts_sin32(float x) {
  return sin(x);
}

SCALAR_FUN_ATTR float futrts_tan32(float x) {
  return tan(x);
}

SCALAR_FUN_ATTR float futrts_acos32(float x) {
  return acos(x);
}

SCALAR_FUN_ATTR float futrts_asin32(float x) {
  return asin(x);
}

SCALAR_FUN_ATTR float futrts_atan32(float x) {
  return atan(x);
}

SCALAR_FUN_ATTR float futrts_cosh32(float x) {
  return (exp(x)+exp(-x)) / 2.0f;
}

SCALAR_FUN_ATTR float futrts_sinh32(float x) {
  return (exp(x)-exp(-x)) / 2.0f;
}

SCALAR_FUN_ATTR float futrts_tanh32(float x) {
  return futrts_sinh32(x)/futrts_cosh32(x);
}

SCALAR_FUN_ATTR float futrts_acosh32(float x) {
  float f = x+sqrt(x*x-1);
  if(futrts_isfinite32(f)) return log(f);
  return f;
}

SCALAR_FUN_ATTR float futrts_asinh32(float x) {
  float f = x+sqrt(x*x+1);
  if(futrts_isfinite32(f)) return log(f);
  return f;

}

SCALAR_FUN_ATTR float futrts_atanh32(float x) {
  float f = (1+x)/(1-x);
  if(futrts_isfinite32(f)) return log(f)/2.0f;
  return f;

}

SCALAR_FUN_ATTR float futrts_atan2_32(float x, float y) {
  return (x == 0.0f && y == 0.0f) ? 0.0f : atan2(x, y);
}

SCALAR_FUN_ATTR float futrts_hypot32(float x, float y) {
  if (futrts_isfinite32(x) && futrts_isfinite32(y)) {
    x = abs(x);
    y = abs(y);
    float a;
    float b;
    if (x >= y){
        a = x;
        b = y;
    } else {
        a = y;
        b = x;
    }
    if(b == 0){
      return a;
    }

    int e;
    float an;
    float bn;
    an = frexp (a, &e);
    bn = ldexp (b, - e);
    float cn;
    cn = sqrt (an * an + bn * bn);
    return ldexp (cn, e);
  } else {
    if (futrts_isinf32(x) || futrts_isinf32(y)) return INFINITY;
    else return x + y;
  }

}

extern "C" unmasked uniform float tgammaf(uniform float x);
SCALAR_FUN_ATTR float futrts_gamma32(float x) {
  float res;
  foreach_active (i) {
    uniform float r = tgammaf(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

extern "C" unmasked uniform float lgammaf(uniform float x);
SCALAR_FUN_ATTR float futrts_lgamma32(float x) {
  float res;
  foreach_active (i) {
    uniform float r = lgammaf(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

extern "C" unmasked uniform float erff(uniform float x);
SCALAR_FUN_ATTR float futrts_erf32(float x) {
  float res;
  foreach_active (i) {
    uniform float r = erff(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

extern "C" unmasked uniform float erfcf(uniform float x);
SCALAR_FUN_ATTR float futrts_erfc32(float x) {
  float res;
  foreach_active (i) {
    uniform float r = erfcf(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

SCALAR_FUN_ATTR float fmod32(float x, float y) {
  return x - y * trunc(x/y);
}

SCALAR_FUN_ATTR float futrts_round32(float x) {
  return round(x);
}

SCALAR_FUN_ATTR float futrts_floor32(float x) {
  return floor(x);
}

SCALAR_FUN_ATTR float futrts_ceil32(float x) {
  return ceil(x);
}

extern "C" unmasked uniform float nextafterf(uniform float x, uniform float y);
SCALAR_FUN_ATTR float futrts_nextafter32(float x, float y) {
  float res;
  foreach_active (i) {
    uniform float r = nextafterf(extract(x, i), extract(y, i));
    res = insert(res, i, r);
  }
  return res;
}

SCALAR_FUN_ATTR float futrts_lerp32(float v0, float v1, float t) {
  return v0 + (v1 - v0) * t;
}

SCALAR_FUN_ATTR float futrts_ldexp32(float x, int32_t y) {
  return x * pow((double)2.0, (double)y);
}

SCALAR_FUN_ATTR float futrts_copysign32(float x, float y) {
  int32_t xb = futrts_to_bits32(x);
  int32_t yb = futrts_to_bits32(y);
  return futrts_from_bits32((xb & ~(1<<31)) | (yb & (1<<31)));
}

SCALAR_FUN_ATTR float futrts_mad32(float a, float b, float c) {
  return a * b + c;
}

SCALAR_FUN_ATTR float futrts_fma32(float a, float b, float c) {
  return a * b + c;
}

#else // Not OpenCL or ISPC, but CUDA or plain C.

SCALAR_FUN_ATTR float futrts_log32(float x) {
  return logf(x);
}

SCALAR_FUN_ATTR float futrts_log2_32(float x) {
  return log2f(x);
}

SCALAR_FUN_ATTR float futrts_log10_32(float x) {
  return log10f(x);
}

SCALAR_FUN_ATTR float futrts_log1p_32(float x) {
  return log1pf(x);
}

SCALAR_FUN_ATTR float futrts_sqrt32(float x) {
  return sqrtf(x);
}

SCALAR_FUN_ATTR float futrts_cbrt32(float x) {
  return cbrtf(x);
}

SCALAR_FUN_ATTR float futrts_exp32(float x) {
  return expf(x);
}

SCALAR_FUN_ATTR float futrts_cos32(float x) {
  return cosf(x);
}

SCALAR_FUN_ATTR float futrts_sin32(float x) {
  return sinf(x);
}

SCALAR_FUN_ATTR float futrts_tan32(float x) {
  return tanf(x);
}

SCALAR_FUN_ATTR float futrts_acos32(float x) {
  return acosf(x);
}

SCALAR_FUN_ATTR float futrts_asin32(float x) {
  return asinf(x);
}

SCALAR_FUN_ATTR float futrts_atan32(float x) {
  return atanf(x);
}

SCALAR_FUN_ATTR float futrts_cosh32(float x) {
  return coshf(x);
}

SCALAR_FUN_ATTR float futrts_sinh32(float x) {
  return sinhf(x);
}

SCALAR_FUN_ATTR float futrts_tanh32(float x) {
  return tanhf(x);
}

SCALAR_FUN_ATTR float futrts_acosh32(float x) {
  return acoshf(x);
}

SCALAR_FUN_ATTR float futrts_asinh32(float x) {
  return asinhf(x);
}

SCALAR_FUN_ATTR float futrts_atanh32(float x) {
  return atanhf(x);
}

SCALAR_FUN_ATTR float futrts_atan2_32(float x, float y) {
  return atan2f(x, y);
}

SCALAR_FUN_ATTR float futrts_hypot32(float x, float y) {
  return hypotf(x, y);
}

SCALAR_FUN_ATTR float futrts_gamma32(float x) {
  return tgammaf(x);
}

SCALAR_FUN_ATTR float futrts_lgamma32(float x) {
  return lgammaf(x);
}

SCALAR_FUN_ATTR float futrts_erf32(float x) {
  return erff(x);
}

SCALAR_FUN_ATTR float futrts_erfc32(float x) {
  return erfcf(x);
}

SCALAR_FUN_ATTR float fmod32(float x, float y) {
  return fmodf(x, y);
}

SCALAR_FUN_ATTR float futrts_round32(float x) {
  return rintf(x);
}

SCALAR_FUN_ATTR float futrts_floor32(float x) {
  return floorf(x);
}

SCALAR_FUN_ATTR float futrts_ceil32(float x) {
  return ceilf(x);
}

SCALAR_FUN_ATTR float futrts_nextafter32(float x, float y) {
  return nextafterf(x, y);
}

SCALAR_FUN_ATTR float futrts_lerp32(float v0, float v1, float t) {
  return v0 + (v1 - v0) * t;
}

SCALAR_FUN_ATTR float futrts_ldexp32(float x, int32_t y) {
  return ldexpf(x, y);
}

SCALAR_FUN_ATTR float futrts_copysign32(float x, float y) {
  return copysignf(x, y);
}

SCALAR_FUN_ATTR float futrts_mad32(float a, float b, float c) {
  return a * b + c;
}

SCALAR_FUN_ATTR float futrts_fma32(float a, float b, float c) {
  return fmaf(a, b, c);
}
#endif

#if ISPC
SCALAR_FUN_ATTR int32_t futrts_to_bits32(float x) {
  return intbits(x);
}

SCALAR_FUN_ATTR float futrts_from_bits32(int32_t x) {
  return floatbits(x);
}
#else
SCALAR_FUN_ATTR int32_t futrts_to_bits32(float x) {
  union {
    float f;
    int32_t t;
  } p;

  p.f = x;
  return p.t;
}

SCALAR_FUN_ATTR float futrts_from_bits32(int32_t x) {
  union {
    int32_t f;
    float t;
  } p;

  p.f = x;
  return p.t;
}
#endif

SCALAR_FUN_ATTR float fsignum32(float x) {
  return futrts_isnan32(x) ? x : (x > 0 ? 1 : 0) - (x < 0 ? 1 : 0);
}

#ifdef FUTHARK_F64_ENABLED

SCALAR_FUN_ATTR double futrts_from_bits64(int64_t x);
SCALAR_FUN_ATTR int64_t futrts_to_bits64(double x);

#if ISPC
SCALAR_FUN_ATTR bool futrts_isinf64(float x) {
  return !isnan(x) && isnan(x - x);
}

SCALAR_FUN_ATTR bool futrts_isfinite64(float x) {
  return !isnan(x) && !futrts_isinf64(x);
}

SCALAR_FUN_ATTR double fdiv64(double x, double y) {
  return x / y;
}

SCALAR_FUN_ATTR double fadd64(double x, double y) {
  return x + y;
}

SCALAR_FUN_ATTR double fsub64(double x, double y) {
  return x - y;
}

SCALAR_FUN_ATTR double fmul64(double x, double y) {
  return x * y;
}

SCALAR_FUN_ATTR bool cmplt64(double x, double y) {
  return x < y;
}

SCALAR_FUN_ATTR bool cmple64(double x, double y) {
  return x <= y;
}

SCALAR_FUN_ATTR double sitofp_i8_f64(int8_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double sitofp_i16_f64(int16_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double sitofp_i32_f64(int32_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double sitofp_i64_f64(int64_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double uitofp_i8_f64(uint8_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double uitofp_i16_f64(uint16_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double uitofp_i32_f64(uint32_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double uitofp_i64_f64(uint64_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double fabs64(double x) {
  return abs(x);
}

SCALAR_FUN_ATTR double fmax64(double x, double y) {
  return isnan(x) ? y : isnan(y) ? x : max(x, y);
}

SCALAR_FUN_ATTR double fmin64(double x, double y) {
  return isnan(x) ? y : isnan(y) ? x : min(x, y);
}

SCALAR_FUN_ATTR double fpow64(double a, double b) {
  float ret;
  foreach_active (i) {
      uniform float r = __stdlib_powf(extract(a, i), extract(b, i));
      ret = insert(ret, i, r);
  }
  return ret;
}

SCALAR_FUN_ATTR double futrts_log64(double x) {
  return futrts_isfinite64(x) || (futrts_isinf64(x) && x < 0)? log(x) : x;
}

SCALAR_FUN_ATTR double futrts_log2_64(double x) {
  return futrts_log64(x)/log(2.0d);
}

SCALAR_FUN_ATTR double futrts_log10_64(double x) {
  return futrts_log64(x)/log(10.0d);
}

SCALAR_FUN_ATTR double futrts_log1p_64(double x) {
  if(x == -1.0d || (futrts_isinf64(x) && x > 0.0d)) return x / 0.0d;
  double y = 1.0d + x;
  double z = y - 1.0d;
  return log(y) - (z-x)/y;
}

SCALAR_FUN_ATTR double futrts_sqrt64(double x) {
  return sqrt(x);
}

extern "C" unmasked uniform double cbrt(uniform double);
SCALAR_FUN_ATTR double futrts_cbrt64(double x) {
  double res;
  foreach_active (i) {
    uniform double r = cbrtf(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

SCALAR_FUN_ATTR double futrts_exp64(double x) {
  return exp(x);
}

SCALAR_FUN_ATTR double futrts_cos64(double x) {
  return cos(x);
}

SCALAR_FUN_ATTR double futrts_sin64(double x) {
  return sin(x);
}

SCALAR_FUN_ATTR double futrts_tan64(double x) {
  return tan(x);
}

SCALAR_FUN_ATTR double futrts_acos64(double x) {
  return acos(x);
}

SCALAR_FUN_ATTR double futrts_asin64(double x) {
  return asin(x);
}

SCALAR_FUN_ATTR double futrts_atan64(double x) {
  return atan(x);
}

SCALAR_FUN_ATTR double futrts_cosh64(double x) {
  return (exp(x)+exp(-x)) / 2.0d;
}

SCALAR_FUN_ATTR double futrts_sinh64(double x) {
  return (exp(x)-exp(-x)) / 2.0d;
}

SCALAR_FUN_ATTR double futrts_tanh64(double x) {
  return futrts_sinh64(x)/futrts_cosh64(x);
}

SCALAR_FUN_ATTR double futrts_acosh64(double x) {
  double f = x+sqrt(x*x-1.0d);
  if(futrts_isfinite64(f)) return log(f);
  return f;
}

SCALAR_FUN_ATTR double futrts_asinh64(double x) {
  double f = x+sqrt(x*x+1.0d);
  if(futrts_isfinite64(f)) return log(f);
  return f;
}

SCALAR_FUN_ATTR double futrts_atanh64(double x) {
  double f = (1.0d+x)/(1.0d-x);
  if(futrts_isfinite64(f)) return log(f)/2.0d;
  return f;

}

SCALAR_FUN_ATTR double futrts_atan2_64(double x, double y) {
  return atan2(x, y);
}

extern "C" unmasked uniform double hypot(uniform double x, uniform double y);
SCALAR_FUN_ATTR double futrts_hypot64(double x, double y) {
  double res;
  foreach_active (i) {
    uniform double r = hypot(extract(x, i), extract(y, i));
    res = insert(res, i, r);
  }
  return res;
}

extern "C" unmasked uniform double tgamma(uniform double x);
SCALAR_FUN_ATTR double futrts_gamma64(double x) {
  double res;
  foreach_active (i) {
    uniform double r = tgamma(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

extern "C" unmasked uniform double lgamma(uniform double x);
SCALAR_FUN_ATTR double futrts_lgamma64(double x) {
  double res;
  foreach_active (i) {
    uniform double r = lgamma(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

extern "C" unmasked uniform double erf(uniform double x);
SCALAR_FUN_ATTR double futrts_erf64(double x) {
  double res;
  foreach_active (i) {
    uniform double r = erf(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

extern "C" unmasked uniform double erfc(uniform double x);
SCALAR_FUN_ATTR double futrts_erfc64(double x) {
  double res;
  foreach_active (i) {
    uniform double r = erfc(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

SCALAR_FUN_ATTR double futrts_fma64(double a, double b, double c) {
  return a * b + c;
}

SCALAR_FUN_ATTR double futrts_round64(double x) {
  return round(x);
}

SCALAR_FUN_ATTR double futrts_ceil64(double x) {
  return ceil(x);
}

extern "C" unmasked uniform double nextafter(uniform float x, uniform double y);
SCALAR_FUN_ATTR float futrts_nextafter64(double x, double y) {
  double res;
  foreach_active (i) {
    uniform double r = nextafter(extract(x, i), extract(y, i));
    res = insert(res, i, r);
  }
  return res;
}

SCALAR_FUN_ATTR double futrts_floor64(double x) {
  return floor(x);
}

SCALAR_FUN_ATTR bool futrts_isnan64(double x) {
  return isnan(x);
}

SCALAR_FUN_ATTR int8_t fptosi_f64_i8(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (int8_t) x;
  }
}

SCALAR_FUN_ATTR int16_t fptosi_f64_i16(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (int16_t) x;
  }
}

SCALAR_FUN_ATTR int32_t fptosi_f64_i32(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (int32_t) x;
  }
}

SCALAR_FUN_ATTR int64_t fptosi_f64_i64(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (int64_t) x;
  }
}

SCALAR_FUN_ATTR uint8_t fptoui_f64_i8(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (uint8_t) (int8_t) x;
  }
}

SCALAR_FUN_ATTR uint16_t fptoui_f64_i16(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (uint16_t) (int16_t) x;
  }
}

SCALAR_FUN_ATTR uint32_t fptoui_f64_i32(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (uint32_t) (int32_t) x;
  }
}

SCALAR_FUN_ATTR uint64_t fptoui_f64_i64(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (uint64_t) (int64_t) x;
  }
}

SCALAR_FUN_ATTR bool ftob_f64_bool(double x) {
  return x != 0.0;
}

SCALAR_FUN_ATTR double btof_bool_f64(bool x) {
  return x ? 1.0 : 0.0;
}

SCALAR_FUN_ATTR int64_t futrts_to_bits64(double x) {
  int64_t res;
  foreach_active (i) {
    uniform double tmp = extract(x, i);
    uniform int64_t r = *((uniform int64_t* uniform)&tmp);
    res = insert(res, i, r);
  }
  return res;
}

SCALAR_FUN_ATTR double futrts_from_bits64(int64_t x) {
  double res;
  foreach_active (i) {
    uniform int64_t tmp = extract(x, i);
    uniform double r = *((uniform double* uniform)&tmp);
    res = insert(res, i, r);
  }
  return res;
}

SCALAR_FUN_ATTR double fmod64(double x, double y) {
  return x - y * trunc(x/y);
}

SCALAR_FUN_ATTR double fsignum64(double x) {
  return futrts_isnan64(x) ? x : (x > 0 ? 1.0d : 0.0d) - (x < 0 ? 1.0d : 0.0d);
}

SCALAR_FUN_ATTR double futrts_lerp64(double v0, double v1, double t) {
  return v0 + (v1 - v0) * t;
}

SCALAR_FUN_ATTR double futrts_ldexp64(double x, int32_t y) {
  return x * pow((double)2.0, (double)y);
}

SCALAR_FUN_ATTR double futrts_copysign64(double x, double y) {
  int64_t xb = futrts_to_bits64(x);
  int64_t yb = futrts_to_bits64(y);
  return futrts_from_bits64((xb & ~(((int64_t)1)<<63)) | (yb & (((int64_t)1)<<63)));
}

SCALAR_FUN_ATTR double futrts_mad64(double a, double b, double c) {
  return a * b + c;
}

SCALAR_FUN_ATTR float fpconv_f32_f32(float x) {
  return (float) x;
}

SCALAR_FUN_ATTR double fpconv_f32_f64(float x) {
  return (double) x;
}

SCALAR_FUN_ATTR float fpconv_f64_f32(double x) {
  return (float) x;
}

SCALAR_FUN_ATTR double fpconv_f64_f64(double x) {
  return (double) x;
}

#else

SCALAR_FUN_ATTR double fdiv64(double x, double y) {
  return x / y;
}

SCALAR_FUN_ATTR double fadd64(double x, double y) {
  return x + y;
}

SCALAR_FUN_ATTR double fsub64(double x, double y) {
  return x - y;
}

SCALAR_FUN_ATTR double fmul64(double x, double y) {
  return x * y;
}

SCALAR_FUN_ATTR bool cmplt64(double x, double y) {
  return x < y;
}

SCALAR_FUN_ATTR bool cmple64(double x, double y) {
  return x <= y;
}

SCALAR_FUN_ATTR double sitofp_i8_f64(int8_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double sitofp_i16_f64(int16_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double sitofp_i32_f64(int32_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double sitofp_i64_f64(int64_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double uitofp_i8_f64(uint8_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double uitofp_i16_f64(uint16_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double uitofp_i32_f64(uint32_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double uitofp_i64_f64(uint64_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double fabs64(double x) {
  return fabs(x);
}

SCALAR_FUN_ATTR double fmax64(double x, double y) {
  return fmax(x, y);
}

SCALAR_FUN_ATTR double fmin64(double x, double y) {
  return fmin(x, y);
}

SCALAR_FUN_ATTR double fpow64(double x, double y) {
  return pow(x, y);
}

SCALAR_FUN_ATTR double futrts_log64(double x) {
  return log(x);
}

SCALAR_FUN_ATTR double futrts_log2_64(double x) {
  return log2(x);
}

SCALAR_FUN_ATTR double futrts_log10_64(double x) {
  return log10(x);
}

SCALAR_FUN_ATTR double futrts_log1p_64(double x) {
  return log1p(x);
}

SCALAR_FUN_ATTR double futrts_sqrt64(double x) {
  return sqrt(x);
}

SCALAR_FUN_ATTR double futrts_cbrt64(double x) {
  return cbrt(x);
}

SCALAR_FUN_ATTR double futrts_exp64(double x) {
  return exp(x);
}

SCALAR_FUN_ATTR double futrts_cos64(double x) {
  return cos(x);
}

SCALAR_FUN_ATTR double futrts_sin64(double x) {
  return sin(x);
}

SCALAR_FUN_ATTR double futrts_tan64(double x) {
  return tan(x);
}

SCALAR_FUN_ATTR double futrts_acos64(double x) {
  return acos(x);
}

SCALAR_FUN_ATTR double futrts_asin64(double x) {
  return asin(x);
}

SCALAR_FUN_ATTR double futrts_atan64(double x) {
  return atan(x);
}

SCALAR_FUN_ATTR double futrts_cosh64(double x) {
  return cosh(x);
}

SCALAR_FUN_ATTR double futrts_sinh64(double x) {
  return sinh(x);
}

SCALAR_FUN_ATTR double futrts_tanh64(double x) {
  return tanh(x);
}

SCALAR_FUN_ATTR double futrts_acosh64(double x) {
  return acosh(x);
}

SCALAR_FUN_ATTR double futrts_asinh64(double x) {
  return asinh(x);
}

SCALAR_FUN_ATTR double futrts_atanh64(double x) {
  return atanh(x);
}

SCALAR_FUN_ATTR double futrts_atan2_64(double x, double y) {
  return atan2(x, y);
}

SCALAR_FUN_ATTR double futrts_hypot64(double x, double y) {
  return hypot(x, y);
}

SCALAR_FUN_ATTR double futrts_gamma64(double x) {
  return tgamma(x);
}

SCALAR_FUN_ATTR double futrts_lgamma64(double x) {
  return lgamma(x);
}

SCALAR_FUN_ATTR double futrts_erf64(double x) {
  return erf(x);
}

SCALAR_FUN_ATTR double futrts_erfc64(double x) {
  return erfc(x);
}

SCALAR_FUN_ATTR double futrts_fma64(double a, double b, double c) {
  return fma(a, b, c);
}

SCALAR_FUN_ATTR double futrts_round64(double x) {
  return rint(x);
}

SCALAR_FUN_ATTR double futrts_ceil64(double x) {
  return ceil(x);
}

SCALAR_FUN_ATTR float futrts_nextafter64(float x, float y) {
  return nextafter(x, y);
}

SCALAR_FUN_ATTR double futrts_floor64(double x) {
  return floor(x);
}

SCALAR_FUN_ATTR bool futrts_isnan64(double x) {
  return isnan(x);
}

SCALAR_FUN_ATTR bool futrts_isinf64(double x) {
  return isinf(x);
}

SCALAR_FUN_ATTR int8_t fptosi_f64_i8(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (int8_t) x;
  }
}

SCALAR_FUN_ATTR int16_t fptosi_f64_i16(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (int16_t) x;
  }
}

SCALAR_FUN_ATTR int32_t fptosi_f64_i32(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (int32_t) x;
  }
}

SCALAR_FUN_ATTR int64_t fptosi_f64_i64(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (int64_t) x;
  }
}

SCALAR_FUN_ATTR uint8_t fptoui_f64_i8(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (uint8_t) (int8_t) x;
  }
}

SCALAR_FUN_ATTR uint16_t fptoui_f64_i16(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (uint16_t) (int16_t) x;
  }
}

SCALAR_FUN_ATTR uint32_t fptoui_f64_i32(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (uint32_t) (int32_t) x;
  }
}

SCALAR_FUN_ATTR uint64_t fptoui_f64_i64(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (uint64_t) (int64_t) x;
  }
}

SCALAR_FUN_ATTR bool ftob_f64_bool(double x) {
  return x != 0;
}

SCALAR_FUN_ATTR double btof_bool_f64(bool x) {
  return x ? 1 : 0;
}

SCALAR_FUN_ATTR int64_t futrts_to_bits64(double x) {
  union {
    double f;
    int64_t t;
  } p;

  p.f = x;
  return p.t;
}

SCALAR_FUN_ATTR double futrts_from_bits64(int64_t x) {
  union {
    int64_t f;
    double t;
  } p;

  p.f = x;
  return p.t;
}

SCALAR_FUN_ATTR double fmod64(double x, double y) {
  return fmod(x, y);
}

SCALAR_FUN_ATTR double fsignum64(double x) {
  return futrts_isnan64(x) ? x : (x > 0) - (x < 0);
}

SCALAR_FUN_ATTR double futrts_lerp64(double v0, double v1, double t) {
#ifdef __OPENCL_VERSION__
  return mix(v0, v1, t);
#else
  return v0 + (v1 - v0) * t;
#endif
}

SCALAR_FUN_ATTR double futrts_ldexp64(double x, int32_t y) {
  return ldexp(x, y);
}

SCALAR_FUN_ATTR float futrts_copysign64(double x, double y) {
  return copysign(x, y);
}

SCALAR_FUN_ATTR double futrts_mad64(double a, double b, double c) {
#ifdef __OPENCL_VERSION__
  return mad(a, b, c);
#else
  return a * b + c;
#endif
}

SCALAR_FUN_ATTR float fpconv_f32_f32(float x) {
  return (float) x;
}

SCALAR_FUN_ATTR double fpconv_f32_f64(float x) {
  return (double) x;
}

SCALAR_FUN_ATTR float fpconv_f64_f32(double x) {
  return (float) x;
}

SCALAR_FUN_ATTR double fpconv_f64_f64(double x) {
  return (double) x;
}

#endif

#endif

// End of scalar.h.
// Start of scalar_f16.h.

// Half-precision is emulated if needed (e.g. in straight C) with the
// native type used if possible.  The emulation works by typedef'ing
// 'float' to 'f16', and then implementing all operations on single
// precision.  To cut down on duplication, we use the same code for
// those Futhark functions that require just operators or casts.  The
// in-memory representation for arrays will still be 16 bits even
// under emulation, so the compiler will have to be careful when
// generating reads or writes.

#if !defined(cl_khr_fp16) && !(defined(__CUDA_ARCH__) && __CUDA_ARCH__ >= 600) && !(defined(ISPC))
#define EMULATE_F16
#endif

#if !defined(EMULATE_F16) && defined(__OPENCL_VERSION__)
#pragma OPENCL EXTENSION cl_khr_fp16 : enable
#endif

#ifdef EMULATE_F16

// Note that the half-precision storage format is still 16 bits - the
// compiler will have to be real careful!
typedef float f16;

#elif ISPC
typedef float16 f16;

#else

#ifdef __CUDA_ARCH__
#include <cuda_fp16.h>
#endif

typedef half f16;

#endif

// Some of these functions convert to single precision because half
// precision versions are not available.

SCALAR_FUN_ATTR f16 fadd16(f16 x, f16 y) {
  return x + y;
}

SCALAR_FUN_ATTR f16 fsub16(f16 x, f16 y) {
  return x - y;
}

SCALAR_FUN_ATTR f16 fmul16(f16 x, f16 y) {
  return x * y;
}

SCALAR_FUN_ATTR bool cmplt16(f16 x, f16 y) {
  return x < y;
}

SCALAR_FUN_ATTR bool cmple16(f16 x, f16 y) {
  return x <= y;
}

SCALAR_FUN_ATTR f16 sitofp_i8_f16(int8_t x) {
  return (f16) x;
}

SCALAR_FUN_ATTR f16 sitofp_i16_f16(int16_t x) {
  return (f16) x;
}

SCALAR_FUN_ATTR f16 sitofp_i32_f16(int32_t x) {
  return (f16) x;
}

SCALAR_FUN_ATTR f16 sitofp_i64_f16(int64_t x) {
  return (f16) x;
}

SCALAR_FUN_ATTR f16 uitofp_i8_f16(uint8_t x) {
  return (f16) x;
}

SCALAR_FUN_ATTR f16 uitofp_i16_f16(uint16_t x) {
  return (f16) x;
}

SCALAR_FUN_ATTR f16 uitofp_i32_f16(uint32_t x) {
  return (f16) x;
}

SCALAR_FUN_ATTR f16 uitofp_i64_f16(uint64_t x) {
  return (f16) x;
}

SCALAR_FUN_ATTR int8_t fptosi_f16_i8(f16 x) {
  return (int8_t) (float) x;
}

SCALAR_FUN_ATTR int16_t fptosi_f16_i16(f16 x) {
  return (int16_t) x;
}

SCALAR_FUN_ATTR int32_t fptosi_f16_i32(f16 x) {
  return (int32_t) x;
}

SCALAR_FUN_ATTR int64_t fptosi_f16_i64(f16 x) {
  return (int64_t) x;
}

SCALAR_FUN_ATTR uint8_t fptoui_f16_i8(f16 x) {
  return (uint8_t) (float) x;
}

SCALAR_FUN_ATTR uint16_t fptoui_f16_i16(f16 x) {
  return (uint16_t) x;
}

SCALAR_FUN_ATTR uint32_t fptoui_f16_i32(f16 x) {
  return (uint32_t) x;
}

SCALAR_FUN_ATTR uint64_t fptoui_f16_i64(f16 x) {
  return (uint64_t) x;
}

SCALAR_FUN_ATTR bool ftob_f16_bool(f16 x) {
  return x != (f16)0;
}

SCALAR_FUN_ATTR f16 btof_bool_f16(bool x) {
  return x ? 1 : 0;
}

#ifndef EMULATE_F16
SCALAR_FUN_ATTR bool futrts_isnan16(f16 x) {
  return isnan((float)x);
}

#ifdef __OPENCL_VERSION__

SCALAR_FUN_ATTR f16 fabs16(f16 x) {
  return fabs(x);
}

SCALAR_FUN_ATTR f16 fmax16(f16 x, f16 y) {
  return fmax(x, y);
}

SCALAR_FUN_ATTR f16 fmin16(f16 x, f16 y) {
  return fmin(x, y);
}

SCALAR_FUN_ATTR f16 fpow16(f16 x, f16 y) {
  return pow(x, y);
}

#elif ISPC
SCALAR_FUN_ATTR f16 fabs16(f16 x) {
  return abs(x);
}

SCALAR_FUN_ATTR f16 fmax16(f16 x, f16 y) {
  return futrts_isnan16(x) ? y : futrts_isnan16(y) ? x : max(x, y);
}

SCALAR_FUN_ATTR f16 fmin16(f16 x, f16 y) {
  return futrts_isnan16(x) ? y : futrts_isnan16(y) ? x : min(x, y);
}

SCALAR_FUN_ATTR f16 fpow16(f16 x, f16 y) {
  return pow(x, y);
}

#else // Assuming CUDA.

SCALAR_FUN_ATTR f16 fabs16(f16 x) {
  return fabsf(x);
}

SCALAR_FUN_ATTR f16 fmax16(f16 x, f16 y) {
  return fmaxf(x, y);
}

SCALAR_FUN_ATTR f16 fmin16(f16 x, f16 y) {
  return fminf(x, y);
}

SCALAR_FUN_ATTR f16 fpow16(f16 x, f16 y) {
  return powf(x, y);
}
#endif

#if ISPC
SCALAR_FUN_ATTR bool futrts_isinf16(float x) {
  return !futrts_isnan16(x) && futrts_isnan16(x - x);
}
SCALAR_FUN_ATTR bool futrts_isfinite16(float x) {
  return !futrts_isnan16(x) && !futrts_isinf16(x);
}

#else

SCALAR_FUN_ATTR bool futrts_isinf16(f16 x) {
  return isinf((float)x);
}
#endif

#ifdef __OPENCL_VERSION__
SCALAR_FUN_ATTR f16 futrts_log16(f16 x) {
  return log(x);
}

SCALAR_FUN_ATTR f16 futrts_log2_16(f16 x) {
  return log2(x);
}

SCALAR_FUN_ATTR f16 futrts_log10_16(f16 x) {
  return log10(x);
}

SCALAR_FUN_ATTR f16 futrts_log1p_16(f16 x) {
  return log1p(x);
}

SCALAR_FUN_ATTR f16 futrts_sqrt16(f16 x) {
  return sqrt(x);
}

SCALAR_FUN_ATTR f16 futrts_cbrt16(f16 x) {
  return cbrt(x);
}

SCALAR_FUN_ATTR f16 futrts_exp16(f16 x) {
  return exp(x);
}

SCALAR_FUN_ATTR f16 futrts_cos16(f16 x) {
  return cos(x);
}

SCALAR_FUN_ATTR f16 futrts_sin16(f16 x) {
  return sin(x);
}

SCALAR_FUN_ATTR f16 futrts_tan16(f16 x) {
  return tan(x);
}

SCALAR_FUN_ATTR f16 futrts_acos16(f16 x) {
  return acos(x);
}

SCALAR_FUN_ATTR f16 futrts_asin16(f16 x) {
  return asin(x);
}

SCALAR_FUN_ATTR f16 futrts_atan16(f16 x) {
  return atan(x);
}

SCALAR_FUN_ATTR f16 futrts_cosh16(f16 x) {
  return cosh(x);
}

SCALAR_FUN_ATTR f16 futrts_sinh16(f16 x) {
  return sinh(x);
}

SCALAR_FUN_ATTR f16 futrts_tanh16(f16 x) {
  return tanh(x);
}

SCALAR_FUN_ATTR f16 futrts_acosh16(f16 x) {
  return acosh(x);
}

SCALAR_FUN_ATTR f16 futrts_asinh16(f16 x) {
  return asinh(x);
}

SCALAR_FUN_ATTR f16 futrts_atanh16(f16 x) {
  return atanh(x);
}

SCALAR_FUN_ATTR f16 futrts_atan2_16(f16 x, f16 y) {
  return atan2(x, y);
}

SCALAR_FUN_ATTR f16 futrts_hypot16(f16 x, f16 y) {
  return hypot(x, y);
}

SCALAR_FUN_ATTR f16 futrts_gamma16(f16 x) {
  return tgamma(x);
}

SCALAR_FUN_ATTR f16 futrts_lgamma16(f16 x) {
  return lgamma(x);
}

SCALAR_FUN_ATTR f16 futrts_erf16(f16 x) {
  return erf(x);
}

SCALAR_FUN_ATTR f16 futrts_erfc16(f16 x) {
  return erfc(x);
}

SCALAR_FUN_ATTR f16 fmod16(f16 x, f16 y) {
  return fmod(x, y);
}

SCALAR_FUN_ATTR f16 futrts_round16(f16 x) {
  return rint(x);
}

SCALAR_FUN_ATTR f16 futrts_floor16(f16 x) {
  return floor(x);
}

SCALAR_FUN_ATTR f16 futrts_ceil16(f16 x) {
  return ceil(x);
}

SCALAR_FUN_ATTR f16 futrts_nextafter16(f16 x, f16 y) {
  return nextafter(x, y);
}

SCALAR_FUN_ATTR f16 futrts_lerp16(f16 v0, f16 v1, f16 t) {
  return mix(v0, v1, t);
}

SCALAR_FUN_ATTR f16 futrts_ldexp16(f16 x, int32_t y) {
  return ldexp(x, y);
}

SCALAR_FUN_ATTR f16 futrts_copysign16(f16 x, f16 y) {
  return copysign(x, y);
}

SCALAR_FUN_ATTR f16 futrts_mad16(f16 a, f16 b, f16 c) {
  return mad(a, b, c);
}

SCALAR_FUN_ATTR f16 futrts_fma16(f16 a, f16 b, f16 c) {
  return fma(a, b, c);
}
#elif ISPC

SCALAR_FUN_ATTR f16 futrts_log16(f16 x) {
  return futrts_isfinite16(x) || (futrts_isinf16(x) && x < 0) ? log(x) : x;
}

SCALAR_FUN_ATTR f16 futrts_log2_16(f16 x) {
  return futrts_log16(x) / log(2.0f16);
}

SCALAR_FUN_ATTR f16 futrts_log10_16(f16 x) {
  return futrts_log16(x) / log(10.0f16);
}

SCALAR_FUN_ATTR f16 futrts_log1p_16(f16 x) {
  if(x == -1.0f16 || (futrts_isinf16(x) && x > 0.0f16)) return x / 0.0f16;
  f16 y = 1.0f16 + x;
  f16 z = y - 1.0f16;
  return log(y) - (z-x)/y;
}

SCALAR_FUN_ATTR f16 futrts_sqrt16(f16 x) {
  return (float16)sqrt((float)x);
}

SCALAR_FUN_ATTR f16 futrts_exp16(f16 x) {
  return exp(x);
}

SCALAR_FUN_ATTR f16 futrts_cos16(f16 x) {
  return (float16)cos((float)x);
}

SCALAR_FUN_ATTR f16 futrts_sin16(f16 x) {
  return (float16)sin((float)x);
}

SCALAR_FUN_ATTR f16 futrts_tan16(f16 x) {
  return (float16)tan((float)x);
}

SCALAR_FUN_ATTR f16 futrts_acos16(f16 x) {
  return (float16)acos((float)x);
}

SCALAR_FUN_ATTR f16 futrts_asin16(f16 x) {
  return (float16)asin((float)x);
}

SCALAR_FUN_ATTR f16 futrts_atan16(f16 x) {
  return (float16)atan((float)x);
}

SCALAR_FUN_ATTR f16 futrts_cosh16(f16 x) {
  return (exp(x)+exp(-x)) / 2.0f16;
}

SCALAR_FUN_ATTR f16 futrts_sinh16(f16 x) {
  return (exp(x)-exp(-x)) / 2.0f16;
}

SCALAR_FUN_ATTR f16 futrts_tanh16(f16 x) {
  return futrts_sinh16(x)/futrts_cosh16(x);
}

SCALAR_FUN_ATTR f16 futrts_acosh16(f16 x) {
  float16 f = x+(float16)sqrt((float)(x*x-1));
  if(futrts_isfinite16(f)) return log(f);
  return f;
}

SCALAR_FUN_ATTR f16 futrts_asinh16(f16 x) {
  float16 f = x+(float16)sqrt((float)(x*x+1));
  if(futrts_isfinite16(f)) return log(f);
  return f;
}

SCALAR_FUN_ATTR f16 futrts_atanh16(f16 x) {
  float16 f = (1+x)/(1-x);
  if(futrts_isfinite16(f)) return log(f)/2.0f16;
  return f;
}

SCALAR_FUN_ATTR f16 futrts_atan2_16(f16 x, f16 y) {
  return (float16)atan2((float)x, (float)y);
}

SCALAR_FUN_ATTR f16 futrts_hypot16(f16 x, f16 y) {
  return (float16)futrts_hypot32((float)x, (float)y);
}

extern "C" unmasked uniform float tgammaf(uniform float x);
SCALAR_FUN_ATTR f16 futrts_gamma16(f16 x) {
  f16 res;
  foreach_active (i) {
    uniform f16 r = (f16)tgammaf(extract((float)x, i));
    res = insert(res, i, r);
  }
  return res;
}

extern "C" unmasked uniform float lgammaf(uniform float x);
SCALAR_FUN_ATTR f16 futrts_lgamma16(f16 x) {
  f16 res;
  foreach_active (i) {
    uniform f16 r = (f16)lgammaf(extract((float)x, i));
    res = insert(res, i, r);
  }
  return res;
}

SCALAR_FUN_ATTR f16 futrts_cbrt16(f16 x) {
  f16 res = (f16)futrts_cbrt32((float)x);
  return res;
}

SCALAR_FUN_ATTR f16 futrts_erf16(f16 x) {
  f16 res = (f16)futrts_erf32((float)x);
  return res;
}

SCALAR_FUN_ATTR f16 futrts_erfc16(f16 x) {
  f16 res = (f16)futrts_erfc32((float)x);
  return res;
}

SCALAR_FUN_ATTR f16 fmod16(f16 x, f16 y) {
  return x - y * (float16)trunc((float) (x/y));
}

SCALAR_FUN_ATTR f16 futrts_round16(f16 x) {
  return (float16)round((float)x);
}

SCALAR_FUN_ATTR f16 futrts_floor16(f16 x) {
  return (float16)floor((float)x);
}

SCALAR_FUN_ATTR f16 futrts_ceil16(f16 x) {
  return (float16)ceil((float)x);
}

SCALAR_FUN_ATTR f16 futrts_nextafter16(f16 x, f16 y) {
  return (float16)futrts_nextafter32((float)x, (float) y);
}

SCALAR_FUN_ATTR f16 futrts_lerp16(f16 v0, f16 v1, f16 t) {
  return v0 + (v1 - v0) * t;
}

SCALAR_FUN_ATTR f16 futrts_ldexp16(f16 x, int32_t y) {
  return futrts_ldexp32((float)x, y);
}

SCALAR_FUN_ATTR f16 futrts_copysign16(f16 x, f16 y) {
  return futrts_copysign32((float)x, y);
}

SCALAR_FUN_ATTR f16 futrts_mad16(f16 a, f16 b, f16 c) {
  return a * b + c;
}

SCALAR_FUN_ATTR f16 futrts_fma16(f16 a, f16 b, f16 c) {
  return a * b + c;
}

#else // Assume CUDA.

SCALAR_FUN_ATTR f16 futrts_log16(f16 x) {
  return hlog(x);
}

SCALAR_FUN_ATTR f16 futrts_log2_16(f16 x) {
  return hlog2(x);
}

SCALAR_FUN_ATTR f16 futrts_log10_16(f16 x) {
  return hlog10(x);
}

SCALAR_FUN_ATTR f16 futrts_log1p_16(f16 x) {
  return (f16)log1pf((float)x);
}

SCALAR_FUN_ATTR f16 futrts_sqrt16(f16 x) {
  return hsqrt(x);
}

SCALAR_FUN_ATTR f16 futrts_cbrt16(f16 x) {
  return cbrtf(x);
}

SCALAR_FUN_ATTR f16 futrts_exp16(f16 x) {
  return hexp(x);
}

SCALAR_FUN_ATTR f16 futrts_cos16(f16 x) {
  return hcos(x);
}

SCALAR_FUN_ATTR f16 futrts_sin16(f16 x) {
  return hsin(x);
}

SCALAR_FUN_ATTR f16 futrts_tan16(f16 x) {
  return tanf(x);
}

SCALAR_FUN_ATTR f16 futrts_acos16(f16 x) {
  return acosf(x);
}

SCALAR_FUN_ATTR f16 futrts_asin16(f16 x) {
  return asinf(x);
}

SCALAR_FUN_ATTR f16 futrts_atan16(f16 x) {
  return atanf(x);
}

SCALAR_FUN_ATTR f16 futrts_cosh16(f16 x) {
  return coshf(x);
}

SCALAR_FUN_ATTR f16 futrts_sinh16(f16 x) {
  return sinhf(x);
}

SCALAR_FUN_ATTR f16 futrts_tanh16(f16 x) {
  return tanhf(x);
}

SCALAR_FUN_ATTR f16 futrts_acosh16(f16 x) {
  return acoshf(x);
}

SCALAR_FUN_ATTR f16 futrts_asinh16(f16 x) {
  return asinhf(x);
}

SCALAR_FUN_ATTR f16 futrts_atanh16(f16 x) {
  return atanhf(x);
}

SCALAR_FUN_ATTR f16 futrts_atan2_16(f16 x, f16 y) {
  return atan2f(x, y);
}

SCALAR_FUN_ATTR f16 futrts_hypot16(f16 x, f16 y) {
  return hypotf(x, y);
}

SCALAR_FUN_ATTR f16 futrts_gamma16(f16 x) {
  return tgammaf(x);
}

SCALAR_FUN_ATTR f16 futrts_lgamma16(f16 x) {
  return lgammaf(x);
}

SCALAR_FUN_ATTR f16 futrts_erf16(f16 x) {
  return erff(x);
}

SCALAR_FUN_ATTR f16 futrts_erfc16(f16 x) {
  return erfcf(x);
}

SCALAR_FUN_ATTR f16 fmod16(f16 x, f16 y) {
  return fmodf(x, y);
}

SCALAR_FUN_ATTR f16 futrts_round16(f16 x) {
  return rintf(x);
}

SCALAR_FUN_ATTR f16 futrts_floor16(f16 x) {
  return hfloor(x);
}

SCALAR_FUN_ATTR f16 futrts_ceil16(f16 x) {
  return hceil(x);
}

SCALAR_FUN_ATTR f16 futrts_nextafter16(f16 x, f16 y) {
  return __ushort_as_half(halfbitsnextafter(__half_as_ushort(x), __half_as_ushort(y)));
}

SCALAR_FUN_ATTR f16 futrts_lerp16(f16 v0, f16 v1, f16 t) {
  return v0 + (v1 - v0) * t;
}

SCALAR_FUN_ATTR f16 futrts_ldexp16(f16 x, int32_t y) {
  return futrts_ldexp32((float)x, y);
}

SCALAR_FUN_ATTR f16 futrts_copysign16(f16 x, f16 y) {
  return futrts_copysign32((float)x, y);
}

SCALAR_FUN_ATTR f16 futrts_mad16(f16 a, f16 b, f16 c) {
  return a * b + c;
}

SCALAR_FUN_ATTR f16 futrts_fma16(f16 a, f16 b, f16 c) {
  return fmaf(a, b, c);
}

#endif

// The CUDA __half type cannot be put in unions for some reason, so we
// use bespoke conversion functions instead.
#ifdef __CUDA_ARCH__
SCALAR_FUN_ATTR int16_t futrts_to_bits16(f16 x) {
  return __half_as_ushort(x);
}
SCALAR_FUN_ATTR f16 futrts_from_bits16(int16_t x) {
  return __ushort_as_half(x);
}
#elif ISPC

SCALAR_FUN_ATTR int16_t futrts_to_bits16(f16 x) {
  varying int16_t y = *((varying int16_t * uniform)&x);
  return y;
}

SCALAR_FUN_ATTR f16 futrts_from_bits16(int16_t x) {
  varying f16 y = *((varying f16 * uniform)&x);
  return y;
}
#else
SCALAR_FUN_ATTR int16_t futrts_to_bits16(f16 x) {
  union {
    f16 f;
    int16_t t;
  } p;

  p.f = x;
  return p.t;
}

SCALAR_FUN_ATTR f16 futrts_from_bits16(int16_t x) {
  union {
    int16_t f;
    f16 t;
  } p;

  p.f = x;
  return p.t;
}
#endif

#else // No native f16 - emulate.

SCALAR_FUN_ATTR f16 fabs16(f16 x) {
  return fabs32(x);
}

SCALAR_FUN_ATTR f16 fmax16(f16 x, f16 y) {
  return fmax32(x, y);
}

SCALAR_FUN_ATTR f16 fmin16(f16 x, f16 y) {
  return fmin32(x, y);
}

SCALAR_FUN_ATTR f16 fpow16(f16 x, f16 y) {
  return fpow32(x, y);
}

SCALAR_FUN_ATTR bool futrts_isnan16(f16 x) {
  return futrts_isnan32(x);
}

SCALAR_FUN_ATTR bool futrts_isinf16(f16 x) {
  return futrts_isinf32(x);
}

SCALAR_FUN_ATTR f16 futrts_log16(f16 x) {
  return futrts_log32(x);
}

SCALAR_FUN_ATTR f16 futrts_log2_16(f16 x) {
  return futrts_log2_32(x);
}

SCALAR_FUN_ATTR f16 futrts_log10_16(f16 x) {
  return futrts_log10_32(x);
}

SCALAR_FUN_ATTR f16 futrts_log1p_16(f16 x) {
  return futrts_log1p_32(x);
}

SCALAR_FUN_ATTR f16 futrts_sqrt16(f16 x) {
  return futrts_sqrt32(x);
}

SCALAR_FUN_ATTR f16 futrts_cbrt16(f16 x) {
  return futrts_cbrt32(x);
}

SCALAR_FUN_ATTR f16 futrts_exp16(f16 x) {
  return futrts_exp32(x);
}

SCALAR_FUN_ATTR f16 futrts_cos16(f16 x) {
  return futrts_cos32(x);
}

SCALAR_FUN_ATTR f16 futrts_sin16(f16 x) {
  return futrts_sin32(x);
}

SCALAR_FUN_ATTR f16 futrts_tan16(f16 x) {
  return futrts_tan32(x);
}

SCALAR_FUN_ATTR f16 futrts_acos16(f16 x) {
  return futrts_acos32(x);
}

SCALAR_FUN_ATTR f16 futrts_asin16(f16 x) {
  return futrts_asin32(x);
}

SCALAR_FUN_ATTR f16 futrts_atan16(f16 x) {
  return futrts_atan32(x);
}

SCALAR_FUN_ATTR f16 futrts_cosh16(f16 x) {
  return futrts_cosh32(x);
}

SCALAR_FUN_ATTR f16 futrts_sinh16(f16 x) {
  return futrts_sinh32(x);
}

SCALAR_FUN_ATTR f16 futrts_tanh16(f16 x) {
  return futrts_tanh32(x);
}

SCALAR_FUN_ATTR f16 futrts_acosh16(f16 x) {
  return futrts_acosh32(x);
}

SCALAR_FUN_ATTR f16 futrts_asinh16(f16 x) {
  return futrts_asinh32(x);
}

SCALAR_FUN_ATTR f16 futrts_atanh16(f16 x) {
  return futrts_atanh32(x);
}

SCALAR_FUN_ATTR f16 futrts_atan2_16(f16 x, f16 y) {
  return futrts_atan2_32(x, y);
}

SCALAR_FUN_ATTR f16 futrts_hypot16(f16 x, f16 y) {
  return futrts_hypot32(x, y);
}

SCALAR_FUN_ATTR f16 futrts_gamma16(f16 x) {
  return futrts_gamma32(x);
}

SCALAR_FUN_ATTR f16 futrts_lgamma16(f16 x) {
  return futrts_lgamma32(x);
}

SCALAR_FUN_ATTR f16 futrts_erf16(f16 x) {
  return futrts_erf32(x);
}

SCALAR_FUN_ATTR f16 futrts_erfc16(f16 x) {
  return futrts_erfc32(x);
}

SCALAR_FUN_ATTR f16 fmod16(f16 x, f16 y) {
  return fmod32(x, y);
}

SCALAR_FUN_ATTR f16 futrts_round16(f16 x) {
  return futrts_round32(x);
}

SCALAR_FUN_ATTR f16 futrts_floor16(f16 x) {
  return futrts_floor32(x);
}

SCALAR_FUN_ATTR f16 futrts_ceil16(f16 x) {
  return futrts_ceil32(x);
}

SCALAR_FUN_ATTR f16 futrts_nextafter16(f16 x, f16 y) {
  return halfbits2float(halfbitsnextafter(float2halfbits(x), float2halfbits(y)));
}

SCALAR_FUN_ATTR f16 futrts_lerp16(f16 v0, f16 v1, f16 t) {
  return futrts_lerp32(v0, v1, t);
}

SCALAR_FUN_ATTR f16 futrts_ldexp16(f16 x, int32_t y) {
  return futrts_ldexp32(x, y);
}

SCALAR_FUN_ATTR f16 futrts_copysign16(f16 x, f16 y) {
  return futrts_copysign32((float)x, y);
}

SCALAR_FUN_ATTR f16 futrts_mad16(f16 a, f16 b, f16 c) {
  return futrts_mad32(a, b, c);
}

SCALAR_FUN_ATTR f16 futrts_fma16(f16 a, f16 b, f16 c) {
  return futrts_fma32(a, b, c);
}

// Even when we are using an OpenCL that does not support cl_khr_fp16,
// it must still support vload_half for actually creating a
// half-precision number, which can then be efficiently converted to a
// float.  Similarly for vstore_half.
#ifdef __OPENCL_VERSION__

SCALAR_FUN_ATTR int16_t futrts_to_bits16(f16 x) {
  int16_t y;
  // Violating strict aliasing here.
  vstore_half((float)x, 0, (half*)&y);
  return y;
}

SCALAR_FUN_ATTR f16 futrts_from_bits16(int16_t x) {
  return (f16)vload_half(0, (half*)&x);
}

#else

SCALAR_FUN_ATTR int16_t futrts_to_bits16(f16 x) {
  return (int16_t)float2halfbits(x);
}

SCALAR_FUN_ATTR f16 futrts_from_bits16(int16_t x) {
  return halfbits2float((uint16_t)x);
}

SCALAR_FUN_ATTR f16 fsignum16(f16 x) {
  return futrts_isnan16(x) ? x : (x > 0 ? 1 : 0) - (x < 0 ? 1 : 0);
}

#endif

#endif

SCALAR_FUN_ATTR float fpconv_f16_f16(f16 x) {
  return x;
}

SCALAR_FUN_ATTR float fpconv_f16_f32(f16 x) {
  return x;
}

SCALAR_FUN_ATTR f16 fpconv_f32_f16(float x) {
  return (f16) x;
}

#ifdef FUTHARK_F64_ENABLED

SCALAR_FUN_ATTR double fpconv_f16_f64(f16 x) {
  return (double) x;
}

#if ISPC
SCALAR_FUN_ATTR f16 fpconv_f64_f16(double x) {
  return (f16) ((float)x);
}
#else
SCALAR_FUN_ATTR f16 fpconv_f64_f16(double x) {
  return (f16) x;
}
#endif
#endif


// End of scalar_f16.h.

// Start of context_prototypes.h
//
// Prototypes for the functions in context.h, or that will be called
// from those functions, that need to be available very early.

struct futhark_context_config;
struct futhark_context;

static void set_error(struct futhark_context* ctx, char *error);

// These are called in context/config new/free functions and contain
// shared setup.  They are generated by the compiler itself.
static int init_constants(struct futhark_context*);
static int free_constants(struct futhark_context*);
static void setup_program(struct futhark_context* ctx);
static void teardown_program(struct futhark_context *ctx);

// Allocate host memory.  Must be freed with host_free().
static void host_alloc(struct futhark_context* ctx, size_t size, const char* tag, size_t* size_out, void** mem_out);
// Allocate memory allocated with host_alloc().
static void host_free(struct futhark_context* ctx, size_t size, const char* tag, void* mem);

// Log that a copy has occurred.
static void log_copy(struct futhark_context* ctx,
                     const char *kind, int r,
                     int64_t dst_offset, int64_t dst_strides[r],
                     int64_t src_offset, int64_t src_strides[r],
                     int64_t shape[r]);

static void log_transpose(struct futhark_context* ctx,
                          int64_t k, int64_t m, int64_t n);

static bool lmad_map_tr(int64_t *num_arrays_out, int64_t *n_out, int64_t *m_out,
                        int r,
                        const int64_t dst_strides[r],
                        const int64_t src_strides[r],
                        const int64_t shape[r]);

static bool lmad_contiguous(int r, int64_t strides[r], int64_t shape[r]);

static bool lmad_memcpyable(int r,
                            int64_t dst_strides[r], int64_t src_strides[r], int64_t shape[r]);

static void add_event(struct futhark_context* ctx,
                      const char* name,
                      char* description,
                      void* data,
                      event_report_fn f);

// Functions that must be defined by the backend.
static void backend_context_config_setup(struct futhark_context_config* cfg);
static void backend_context_config_teardown(struct futhark_context_config* cfg);
static int backend_context_setup(struct futhark_context *ctx);
static void backend_context_teardown(struct futhark_context *ctx);

// End of of context_prototypes.h

struct memblock {
    int *references;
    unsigned char *mem;
    int64_t size;
    const char *desc;
};
struct constants {
    int dummy;
};
struct tuning_params {
    int dummy;
};
static const int num_tuning_params = 0;
static const char *tuning_param_names[] = {NULL};
static const char *tuning_param_vars[] = {NULL};
static const char *tuning_param_classes[] = {NULL};
static int64_t tuning_param_defaults[] = {0};
// Start of backends/c.h

struct futhark_context_config {
  int in_use;
  int debugging;
  int profiling;
  int logging;
  char *cache_fname;
  int num_tuning_params;
  int64_t *tuning_params;
  const char** tuning_param_names;
  const char** tuning_param_vars;
  const char** tuning_param_classes;
};

static void backend_context_config_setup(struct futhark_context_config* cfg) {
  (void)cfg;
}

static void backend_context_config_teardown(struct futhark_context_config* cfg) {
  (void)cfg;
}

int futhark_context_config_set_tuning_param(struct futhark_context_config* cfg, const char *param_name, size_t param_value) {
  (void)cfg; (void)param_name; (void)param_value;
  return 1;
}

struct futhark_context {
  struct futhark_context_config* cfg;
  int detail_memory;
  int debugging;
  int profiling;
  int profiling_paused;
  int logging;
  lock_t lock;
  char *error;
  lock_t error_lock;
  FILE *log;
  struct constants *constants;
  struct free_list free_list;
  struct event_list event_list;
  int64_t peak_mem_usage_default;
  int64_t cur_mem_usage_default;
  struct program* program;
  bool program_initialised;
};

int backend_context_setup(struct futhark_context* ctx) {
  (void)ctx;
  return 0;
}

void backend_context_teardown(struct futhark_context* ctx) {
  (void)ctx;
}

int futhark_context_sync(struct futhark_context* ctx) {
  (void)ctx;
  return 0;
}

// End of backends/c.h

struct program {
    int dummy;
};
static void setup_program(struct futhark_context *ctx)
{
    (void) ctx;
    
    int error = 0;
    
    (void) error;
    ctx->program = malloc(sizeof(struct program));
}
static void teardown_program(struct futhark_context *ctx)
{
    (void) ctx;
    
    int error = 0;
    
    (void) error;
    free(ctx->program);
}
static void set_tuning_params(struct futhark_context *ctx)
{
    (void) ctx;
}
int memblock_unref(struct futhark_context *ctx, struct memblock *block, const char *desc)
{
    if (block->references != NULL) {
        *block->references -= 1;
        if (ctx->detail_memory)
            fprintf(ctx->log, "Unreferencing block %s (allocated as %s) in %s: %d references remaining.\n", desc, block->desc, "default space", *block->references);
        if (*block->references == 0) {
            ctx->cur_mem_usage_default -= block->size;
            host_free(ctx, (size_t) block->size, desc, (void *) block->mem);
            free(block->references);
            if (ctx->detail_memory)
                fprintf(ctx->log, "%lld bytes freed (now allocated: %lld bytes)\n", (long long) block->size, (long long) ctx->cur_mem_usage_default);
        }
        block->references = NULL;
    }
    return 0;
}
int memblock_alloc(struct futhark_context *ctx, struct memblock *block, int64_t size, const char *desc)
{
    if (size < 0)
        futhark_panic(1, "Negative allocation of %lld bytes attempted for %s in %s.\n", (long long) size, desc, "default space", ctx->cur_mem_usage_default);
    
    int ret = memblock_unref(ctx, block, desc);
    
    if (ret != FUTHARK_SUCCESS)
        return ret;
    if (ctx->detail_memory)
        fprintf(ctx->log, "Allocating %lld bytes for %s in %s (currently allocated: %lld bytes).\n", (long long) size, desc, "default space", (long long) ctx->cur_mem_usage_default);
    host_alloc(ctx, (size_t) size, desc, (size_t *) &size, (void *) &block->mem);
    if (ctx->error == NULL) {
        block->references = (int *) malloc(sizeof(int));
        *block->references = 1;
        block->size = size;
        block->desc = desc;
        
        long long new_usage = ctx->cur_mem_usage_default + size;
        
        if (ctx->detail_memory)
            fprintf(ctx->log, "Received block of %lld bytes; now allocated: %lld bytes", (long long) block->size, new_usage);
        ctx->cur_mem_usage_default = new_usage;
        if (new_usage > ctx->peak_mem_usage_default) {
            ctx->peak_mem_usage_default = new_usage;
            if (ctx->detail_memory)
                fprintf(ctx->log, " (new peak).\n");
        } else if (ctx->detail_memory)
            fprintf(ctx->log, ".\n");
        return FUTHARK_SUCCESS;
    } else {
        // We are naively assuming that any memory allocation error is due to OOM.
        lock_lock(&ctx->error_lock);
        
        char *old_error = ctx->error;
        
        ctx->error = msgprintf("Failed to allocate memory in %s.\nAttempted allocation: %12lld bytes\nCurrently allocated:  %12lld bytes\n%s", "default space", (long long) size, (long long) ctx->cur_mem_usage_default, old_error);
        free(old_error);
        lock_unlock(&ctx->error_lock);
        return FUTHARK_OUT_OF_MEMORY;
    }
}
int memblock_set(struct futhark_context *ctx, struct memblock *lhs, struct memblock *rhs, const char *lhs_desc)
{
    int ret = memblock_unref(ctx, lhs, lhs_desc);
    
    if (rhs->references != NULL)
        (*rhs->references)++;
    *lhs = *rhs;
    return ret;
}
char *futhark_context_report(struct futhark_context *ctx)
{
    if (futhark_context_sync(ctx) != 0)
        return NULL;
    
    struct str_builder builder;
    
    str_builder_init(&builder);
    str_builder_char(&builder, '{');
    str_builder_str(&builder, "\"memory\":{");
    str_builder(&builder, "\"default space\": %lld", (long long) ctx->peak_mem_usage_default);
    str_builder_str(&builder, "},\"events\":[");
    if (report_events_in_list(&ctx->event_list, &builder) != 0) {
        free(builder.str);
        return NULL;
    } else {
        str_builder_str(&builder, "]}");
        return builder.str;
    }
}
int futhark_context_clear_caches(struct futhark_context *ctx)
{
    lock_lock(&ctx->lock);
    ctx->peak_mem_usage_default = 0;
    lock_unlock(&ctx->lock);
    return ctx->error != NULL;
}

// Start of context.h

// Internal functions.

static void set_error(struct futhark_context* ctx, char *error) {
  lock_lock(&ctx->error_lock);
  if (ctx->error == NULL) {
    ctx->error = error;
  } else {
    free(error);
  }
  lock_unlock(&ctx->error_lock);
}

// XXX: should be static, but used in ispc_util.h
void lexical_realloc_error(struct futhark_context* ctx, size_t new_size) {
  set_error(ctx,
            msgprintf("Failed to allocate memory.\nAttempted allocation: %12lld bytes\n",
                      (long long) new_size));
}

static int lexical_realloc(struct futhark_context *ctx,
                           unsigned char **ptr,
                           int64_t *old_size,
                           int64_t new_size) {
  unsigned char *new = realloc(*ptr, (size_t)new_size);
  if (new == NULL) {
    lexical_realloc_error(ctx, new_size);
    return FUTHARK_OUT_OF_MEMORY;
  } else {
    *ptr = new;
    *old_size = new_size;
    return FUTHARK_SUCCESS;
  }
}

static void free_all_in_free_list(struct futhark_context* ctx) {
  fl_mem mem;
  free_list_pack(&ctx->free_list);
  while (free_list_first(&ctx->free_list, (fl_mem*)&mem) == 0) {
    free((void*)mem);
  }
}

static int is_small_alloc(size_t size) {
  return size < 1024*1024;
}

static void host_alloc(struct futhark_context* ctx,
                       size_t size, const char* tag, size_t* size_out, void** mem_out) {
  if (is_small_alloc(size) || free_list_find(&ctx->free_list, size, tag, size_out, (fl_mem*)mem_out) != 0) {
    *size_out = size;
    *mem_out = malloc(size);
  }
}

static void host_free(struct futhark_context* ctx,
                      size_t size, const char* tag, void* mem) {
  // Small allocations are handled by malloc()s own free list.  The
  // threshold here is kind of arbitrary, but seems to work OK.
  // Larger allocations are mmap()ed/munmapped() every time, which is
  // very slow, and Futhark programs tend to use a few very large
  // allocations.
  if (is_small_alloc(size)) {
    free(mem);
  } else {
    free_list_insert(&ctx->free_list, size, (fl_mem)mem, tag);
  }
}

static void add_event(struct futhark_context* ctx,
                      const char* name,
                      char* description,
                      void* data,
                      event_report_fn f) {
  if (ctx->logging) {
    fprintf(ctx->log, "Event: %s\n%s\n", name, description);
  }
  add_event_to_list(&ctx->event_list, name, description, data, f);
}

char *futhark_context_get_error(struct futhark_context *ctx) {
  char *error = ctx->error;
  ctx->error = NULL;
  return error;
}

void futhark_context_config_set_debugging(struct futhark_context_config *cfg, int flag) {
    cfg->profiling = cfg->logging = cfg->debugging = flag;
}

void futhark_context_config_set_profiling(struct futhark_context_config *cfg, int flag) {
    cfg->profiling = flag;
}

void futhark_context_config_set_logging(struct futhark_context_config *cfg, int flag) {
    cfg->logging = flag;
}

void futhark_context_config_set_cache_file(struct futhark_context_config *cfg, const char *f) {
  cfg->cache_fname = strdup(f);
}

int futhark_get_tuning_param_count(void) {
  return num_tuning_params;
}

const char *futhark_get_tuning_param_name(int i) {
  return tuning_param_names[i];
}

const char *futhark_get_tuning_param_class(int i) {
    return tuning_param_classes[i];
}

void futhark_context_set_logging_file(struct futhark_context *ctx, FILE *f){
  ctx->log = f;
}

void futhark_context_pause_profiling(struct futhark_context *ctx) {
  ctx->profiling_paused = 1;
}

void futhark_context_unpause_profiling(struct futhark_context *ctx) {
  ctx->profiling_paused = 0;
}

struct futhark_context_config* futhark_context_config_new(void) {
  struct futhark_context_config* cfg = malloc(sizeof(struct futhark_context_config));
  if (cfg == NULL) {
    return NULL;
  }
  cfg->in_use = 0;
  cfg->debugging = 0;
  cfg->profiling = 0;
  cfg->logging = 0;
  cfg->cache_fname = NULL;
  cfg->num_tuning_params = num_tuning_params;
  cfg->tuning_params = malloc(cfg->num_tuning_params * sizeof(int64_t));
  memcpy(cfg->tuning_params, tuning_param_defaults,
         cfg->num_tuning_params * sizeof(int64_t));
  cfg->tuning_param_names = tuning_param_names;
  cfg->tuning_param_vars = tuning_param_vars;
  cfg->tuning_param_classes = tuning_param_classes;
  backend_context_config_setup(cfg);
  return cfg;
}

void futhark_context_config_free(struct futhark_context_config* cfg) {
  assert(!cfg->in_use);
  backend_context_config_teardown(cfg);
  free(cfg->cache_fname);
  free(cfg->tuning_params);
  free(cfg);
}

struct futhark_context* futhark_context_new(struct futhark_context_config* cfg) {
  struct futhark_context* ctx = malloc(sizeof(struct futhark_context));
  if (ctx == NULL) {
    return NULL;
  }
  assert(!cfg->in_use);
  ctx->cfg = cfg;
  ctx->cfg->in_use = 1;
  ctx->program_initialised = false;
  create_lock(&ctx->error_lock);
  create_lock(&ctx->lock);
  free_list_init(&ctx->free_list);
  event_list_init(&ctx->event_list);
  ctx->peak_mem_usage_default = 0;
  ctx->cur_mem_usage_default = 0;
  ctx->constants = malloc(sizeof(struct constants));
  ctx->debugging = cfg->debugging;
  ctx->logging = cfg->logging;
  ctx->detail_memory = cfg->logging;
  ctx->profiling = cfg->profiling;
  ctx->profiling_paused = 0;
  ctx->error = NULL;
  ctx->log = stderr;
  set_tuning_params(ctx);
  if (backend_context_setup(ctx) == 0) {
    setup_program(ctx);
    init_constants(ctx);
    ctx->program_initialised = true;
    (void)futhark_context_clear_caches(ctx);
    (void)futhark_context_sync(ctx);
  }
  return ctx;
}

void futhark_context_free(struct futhark_context* ctx) {
  if (ctx->program_initialised) {
    free_constants(ctx);
    teardown_program(ctx);
  }
  backend_context_teardown(ctx);
  free_all_in_free_list(ctx);
  free_list_destroy(&ctx->free_list);
  event_list_free(&ctx->event_list);
  free(ctx->constants);
  free(ctx->error);
  free_lock(&ctx->lock);
  free_lock(&ctx->error_lock);
  ctx->cfg->in_use = 0;
  free(ctx);
}

// End of context.h

// Start of copy.h

// Cache-oblivious map-transpose function.
#define GEN_MAP_TRANSPOSE(NAME, ELEM_TYPE)                              \
  static void map_transpose_##NAME                                      \
  (ELEM_TYPE* dst, ELEM_TYPE* src,                                      \
   int64_t k, int64_t m, int64_t n,                                     \
   int64_t cb, int64_t ce, int64_t rb, int64_t re)                      \
  {                                                                     \
  int32_t r = re - rb;                                                  \
  int32_t c = ce - cb;                                                  \
  if (k == 1) {                                                         \
    if (r <= 64 && c <= 64) {                                           \
      for (int64_t j = 0; j < c; j++) {                                 \
        for (int64_t i = 0; i < r; i++) {                               \
          dst[(j + cb) * n + (i + rb)] = src[(i + rb) * m + (j + cb)];  \
        }                                                               \
      }                                                                 \
    } else if (c <= r) {                                                \
      map_transpose_##NAME(dst, src, k, m, n, cb, ce, rb, rb + r/2);    \
      map_transpose_##NAME(dst, src, k, m, n, cb, ce, rb + r/2, re);    \
    } else {                                                            \
      map_transpose_##NAME(dst, src, k, m, n, cb, cb + c/2, rb, re);    \
      map_transpose_##NAME(dst, src, k, m, n, cb + c/2, ce, rb, re);    \
    }                                                                   \
  } else {                                                              \
  for (int64_t i = 0; i < k; i++) {                                     \
    map_transpose_##NAME(dst + i * m * n, src + i * m * n, 1, m, n, cb, ce, rb, re); \
  }\
} \
}

// Straightforward LMAD copy function.
#define GEN_LMAD_COPY_ELEMENTS(NAME, ELEM_TYPE)                         \
  static void lmad_copy_elements_##NAME(int r,                          \
                                        ELEM_TYPE* dst, int64_t dst_strides[r], \
                                        ELEM_TYPE *src, int64_t src_strides[r], \
                                        int64_t shape[r]) {             \
    if (r == 1) {                                                       \
      for (int i = 0; i < shape[0]; i++) {                              \
        dst[i*dst_strides[0]] = src[i*src_strides[0]];                  \
      }                                                                 \
    } else if (r > 1) {                                                 \
      for (int i = 0; i < shape[0]; i++) {                              \
        lmad_copy_elements_##NAME(r-1,                                  \
                                  dst+i*dst_strides[0], dst_strides+1,  \
                                  src+i*src_strides[0], src_strides+1,  \
                                  shape+1);                             \
      }                                                                 \
    }                                                                   \
  }                                                                     \

// Check whether this LMAD can be seen as a transposed 2D array.  This
// is done by checking every possible splitting point.
static bool lmad_is_tr(int64_t *n_out, int64_t *m_out,
                       int r,
                       const int64_t strides[r],
                       const int64_t shape[r]) {
  for (int i = 1; i < r; i++) {
    int n = 1, m = 1;
    bool ok = true;
    int64_t expected = 1;
    // Check strides before 'i'.
    for (int j = i-1; j >= 0; j--) {
      ok = ok && strides[j] == expected;
      expected *= shape[j];
      n *= shape[j];
    }
    // Check strides after 'i'.
    for (int j = r-1; j >= i; j--) {
      ok = ok && strides[j] == expected;
      expected *= shape[j];
      m *= shape[j];
    }
    if (ok) {
      *n_out = n;
      *m_out = m;
      return true;
    }
  }
  return false;
}

// This function determines whether the a 'dst' LMAD is row-major and
// 'src' LMAD is column-major.  Both LMADs are for arrays of the same
// shape.  Both LMADs are allowed to have additional dimensions "on
// top".  Essentially, this function determines whether a copy from
// 'src' to 'dst' is a "map(transpose)" that we know how to implement
// efficiently.  The LMADs can have arbitrary rank, and the main
// challenge here is checking whether the src LMAD actually
// corresponds to a 2D column-major layout by morally collapsing
// dimensions.  There is a lot of looping here, but the actual trip
// count is going to be very low in practice.
//
// Returns true if this is indeed a map(transpose), and writes the
// number of arrays, and moral array size to appropriate output
// parameters.
static bool lmad_map_tr(int64_t *num_arrays_out, int64_t *n_out, int64_t *m_out,
                        int r,
                        const int64_t dst_strides[r],
                        const int64_t src_strides[r],
                        const int64_t shape[r]) {
  int64_t rowmajor_strides[r];
  rowmajor_strides[r-1] = 1;

  for (int i = r-2; i >= 0; i--) {
    rowmajor_strides[i] = rowmajor_strides[i+1] * shape[i+1];
  }

  // map_r will be the number of mapped dimensions on top.
  int map_r = 0;
  int64_t num_arrays = 1;
  for (int i = 0; i < r; i++) {
    if (dst_strides[i] != rowmajor_strides[i] ||
        src_strides[i] != rowmajor_strides[i]) {
      break;
    } else {
      num_arrays *= shape[i];
      map_r++;
    }
  }

  *num_arrays_out = num_arrays;

  if (r==map_r) {
    return false;
  }

  if (memcmp(&rowmajor_strides[map_r],
             &dst_strides[map_r],
             sizeof(int64_t)*(r-map_r)) == 0) {
    return lmad_is_tr(n_out, m_out, r-map_r, src_strides+map_r, shape+map_r);
  } else if (memcmp(&rowmajor_strides[map_r],
                    &src_strides[map_r],
                    sizeof(int64_t)*(r-map_r)) == 0) {
    return lmad_is_tr(m_out, n_out, r-map_r, dst_strides+map_r, shape+map_r);
  }
  return false;
}

// Check if the strides correspond to row-major strides of *any*
// permutation of the shape.  This is done by recursive search with
// backtracking.  This is worst-case exponential, but hopefully the
// arrays we encounter do not have that many dimensions.
static bool lmad_contiguous_search(int checked, int64_t expected,
                                   int r,
                                   int64_t strides[r], int64_t shape[r], bool used[r]) {
  for (int i = 0; i < r; i++) {
    for (int j = 0; j < r; j++) {
      if (!used[j] && strides[j] == expected && strides[j] >= 0) {
        used[j] = true;
        if (checked+1 == r ||
            lmad_contiguous_search(checked+1, expected * shape[j], r, strides, shape, used)) {
          return true;
        }
        used[j] = false;
      }
    }
  }
  return false;
}

// Does this LMAD correspond to an array with positive strides and no
// holes?
static bool lmad_contiguous(int r, int64_t strides[r], int64_t shape[r]) {
  bool used[r];
  for (int i = 0; i < r; i++) {
    used[i] = false;
  }
  return lmad_contiguous_search(0, 1, r, strides, shape, used);
}

// Does this copy correspond to something that could be done with a
// memcpy()-like operation?  I.e. do the LMADs actually represent the
// same in-memory layout and are they contiguous?
static bool lmad_memcpyable(int r,
                            int64_t dst_strides[r], int64_t src_strides[r], int64_t shape[r]) {
  if (!lmad_contiguous(r, dst_strides, shape)) {
    return false;
  }
  for (int i = 0; i < r; i++) {
    if (dst_strides[i] != src_strides[i] && shape[i] != 1) {
      return false;
    }
  }
  return true;
}


static void log_copy(struct futhark_context* ctx,
                     const char *kind, int r,
                     int64_t dst_offset, int64_t dst_strides[r],
                     int64_t src_offset, int64_t src_strides[r],
                     int64_t shape[r]) {
  if (ctx->logging) {
    fprintf(ctx->log, "\n# Copy %s\n", kind);
    fprintf(ctx->log, "Shape: ");
    for (int i = 0; i < r; i++) { fprintf(ctx->log, "[%ld]", (long int)shape[i]); }
    fprintf(ctx->log, "\n");
    fprintf(ctx->log, "Dst offset: %ld\n", (long int)dst_offset);
    fprintf(ctx->log, "Dst strides:");
    for (int i = 0; i < r; i++) { fprintf(ctx->log, " %ld", (long int)dst_strides[i]); }
    fprintf(ctx->log, "\n");
    fprintf(ctx->log, "Src offset: %ld\n", (long int)src_offset);
    fprintf(ctx->log, "Src strides:");
    for (int i = 0; i < r; i++) { fprintf(ctx->log, " %ld", (long int)src_strides[i]); }
    fprintf(ctx->log, "\n");
  }
}

static void log_transpose(struct futhark_context* ctx,
                          int64_t k, int64_t n, int64_t m) {
  if (ctx->logging) {
    fprintf(ctx->log, "## Transpose\n");
    fprintf(ctx->log, "Arrays     : %ld\n", (long int)k);
    fprintf(ctx->log, "X elements : %ld\n", (long int)m);
    fprintf(ctx->log, "Y elements : %ld\n", (long int)n);
    fprintf(ctx->log, "\n");
  }
}

#define GEN_LMAD_COPY(NAME, ELEM_TYPE)                                  \
  static void lmad_copy_##NAME                                          \
  (struct futhark_context *ctx, int r,                                  \
   ELEM_TYPE* dst, int64_t dst_offset, int64_t dst_strides[r],          \
   ELEM_TYPE *src, int64_t src_offset, int64_t src_strides[r],          \
   int64_t shape[r]) {                                                  \
    log_copy(ctx, "CPU to CPU", r, dst_offset, dst_strides,             \
             src_offset, src_strides, shape);                           \
    int64_t size = 1;                                                   \
    for (int i = 0; i < r; i++) { size *= shape[i]; }                   \
    if (size == 0) { return; }                                          \
    int64_t k, n, m;                                                    \
    if (lmad_map_tr(&k, &n, &m,                                         \
                    r, dst_strides, src_strides, shape)) {              \
      log_transpose(ctx, k, n, m);                                      \
      map_transpose_##NAME                                              \
        (dst+dst_offset, src+src_offset, k, n, m, 0, n, 0, m);          \
    } else if (lmad_memcpyable(r, dst_strides, src_strides, shape)) {   \
      if (ctx->logging) {fprintf(ctx->log, "## Flat copy\n\n");}          \
      memcpy(dst+dst_offset, src+src_offset, size*sizeof(*dst));        \
    } else {                                                            \
      if (ctx->logging) {fprintf(ctx->log, "## General copy\n\n");}       \
      lmad_copy_elements_##NAME                                         \
        (r,                                                             \
         dst+dst_offset, dst_strides,                                   \
         src+src_offset, src_strides, shape);                           \
    }                                                                   \
  }

GEN_MAP_TRANSPOSE(1b, uint8_t)
GEN_MAP_TRANSPOSE(2b, uint16_t)
GEN_MAP_TRANSPOSE(4b, uint32_t)
GEN_MAP_TRANSPOSE(8b, uint64_t)

GEN_LMAD_COPY_ELEMENTS(1b, uint8_t)
GEN_LMAD_COPY_ELEMENTS(2b, uint16_t)
GEN_LMAD_COPY_ELEMENTS(4b, uint32_t)
GEN_LMAD_COPY_ELEMENTS(8b, uint64_t)

GEN_LMAD_COPY(1b, uint8_t)
GEN_LMAD_COPY(2b, uint16_t)
GEN_LMAD_COPY(4b, uint32_t)
GEN_LMAD_COPY(8b, uint64_t)

// End of copy.h

#define FUTHARK_FUN_ATTR static

FUTHARK_FUN_ATTR int futrts_entry_ugw_armijo(struct futhark_context *ctx, struct memblock *mem_out_p_91663, struct memblock A_mem_89411, struct memblock mu_mem_89412, struct memblock B_mem_89413, struct memblock nu_mem_89414, int64_t mz2081Uz2084U_34268, double rho1_34269, double rho2_34270, double eps_34271, double exp_absorb_cutoff_34276, double safe_for_exp_34277, double tol_sinkhorn_34278, double tol_outerloop_34279);
FUTHARK_FUN_ATTR int futrts_entry_ugw_armijo_euclidean(struct futhark_context *ctx, struct memblock *mem_out_p_91711, int64_t *out_prim_out_91712, struct memblock pt_clouds_mem_89411, int64_t k_34814, int64_t m_34815, int64_t d_34816, double rho1_34817, double rho2_34818, double eps_34819, double exp_absorb_cutoff_34821, double safe_for_exp_34822, double tol_sinkhorn_34823, double tol_outerloop_34824);
FUTHARK_FUN_ATTR int futrts_entry_ugw_armijo_pairwise(struct futhark_context *ctx, struct memblock *mem_out_p_91753, int64_t *out_prim_out_91754, struct memblock A_mem_89411, struct memblock distrs_mem_89412, int64_t k_33637, int64_t m_33638, double rho1_33639, double rho2_33640, double eps_33641, double exp_absorb_cutoff_33644, double safe_for_exp_33645, double tol_sinkhorn_33646, double tol_outerloop_33647);
FUTHARK_FUN_ATTR int futrts_entry_ugw_armijo_pairwise_increasing(struct futhark_context *ctx, struct memblock *mem_out_p_91800, int64_t *out_prim_out_91801, struct memblock ugw_dmat_mem_89411, struct memblock A_mem_89412, struct memblock distrs_mem_89413, int64_t dz2080U_34199, int64_t k_34200, int64_t m_34201, double ratio_34203, double rho1_34204, double rho2_34205, double eps_34206, double exp_absorb_cutoff_34209, double safe_for_exp_34210, double tol_sinkhorn_34211, double tol_outerloop_34212);
FUTHARK_FUN_ATTR int futrts_entry_ugw_armijo_pairwise_unif(struct futhark_context *ctx, struct memblock *mem_out_p_91847, int64_t *out_prim_out_91848, struct memblock A_mem_89411, int64_t k_34472, int64_t m_34473, double rho1_34474, double rho2_34475, double eps_34476, double exp_absorb_cutoff_34478, double safe_for_exp_34479, double tol_sinkhorn_34480, double tol_outerloop_34481);
FUTHARK_FUN_ATTR int futrts_pairs_11446(struct futhark_context *ctx, struct memblock *mem_out_p_91889, struct memblock *mem_out_p_91890, int64_t *out_prim_out_91891, int64_t n_23839);

static int init_constants(struct futhark_context *ctx)
{
    (void) ctx;
    
    int err = 0;
    
    
  cleanup:
    return err;
}
static int free_constants(struct futhark_context *ctx)
{
    (void) ctx;
    return 0;
}
struct futhark_f64_1d {
    struct memblock mem;
    int64_t shape[1];
};
struct futhark_f64_1d *futhark_new_f64_1d(struct futhark_context *ctx, const double *data, int64_t dim0)
{
    int err = 0;
    struct futhark_f64_1d *bad = NULL;
    struct futhark_f64_1d *arr = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    arr->mem.references = NULL;
    if (memblock_alloc(ctx, &arr->mem, dim0 * 8, "arr->mem"))
        err = 1;
    arr->shape[0] = dim0;
    if ((size_t) dim0 * 8 > 0)
        memmove(arr->mem.mem + 0, (const unsigned char *) data + 0, (size_t) dim0 * 8);
    lock_unlock(&ctx->lock);
    if (err != 0) {
        free(arr);
        return bad;
    }
    return arr;
}
struct futhark_f64_1d *futhark_new_raw_f64_1d(struct futhark_context *ctx, unsigned char *data, int64_t dim0)
{
    int err = 0;
    struct futhark_f64_1d *bad = NULL;
    struct futhark_f64_1d *arr = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    arr->mem.references = NULL;
    arr->mem.mem = data;
    arr->shape[0] = dim0;
    lock_unlock(&ctx->lock);
    return arr;
}
int futhark_free_f64_1d(struct futhark_context *ctx, struct futhark_f64_1d *arr)
{
    lock_lock(&ctx->lock);
    if (memblock_unref(ctx, &arr->mem, "arr->mem") != 0)
        return 1;
    lock_unlock(&ctx->lock);
    free(arr);
    return 0;
}
int futhark_values_f64_1d(struct futhark_context *ctx, struct futhark_f64_1d *arr, double *data)
{
    int err = 0;
    
    lock_lock(&ctx->lock);
    if ((size_t) arr->shape[0] * 8 > 0)
        memmove((unsigned char *) data + 0, arr->mem.mem + 0, (size_t) arr->shape[0] * 8);
    lock_unlock(&ctx->lock);
    return err;
}
int futhark_index_f64_1d(struct futhark_context *ctx, double *out, struct futhark_f64_1d *arr, int64_t i0)
{
    int err = 0;
    
    if (i0 >= 0 && i0 < arr->shape[0]) {
        lock_lock(&ctx->lock);
        if (8 > 0)
            memmove((unsigned char *) out + 0, arr->mem.mem + 8 * (i0 * 1), 8);
        lock_unlock(&ctx->lock);
    } else {
        err = 1;
        set_error(ctx, strdup("Index out of bounds."));
    }
    return err;
}
unsigned char *futhark_values_raw_f64_1d(struct futhark_context *ctx, struct futhark_f64_1d *arr)
{
    (void) ctx;
    return arr->mem.mem;
}
const int64_t *futhark_shape_f64_1d(struct futhark_context *ctx, struct futhark_f64_1d *arr)
{
    (void) ctx;
    return arr->shape;
}
struct futhark_f64_2d {
    struct memblock mem;
    int64_t shape[2];
};
struct futhark_f64_2d *futhark_new_f64_2d(struct futhark_context *ctx, const double *data, int64_t dim0, int64_t dim1)
{
    int err = 0;
    struct futhark_f64_2d *bad = NULL;
    struct futhark_f64_2d *arr = (struct futhark_f64_2d *) malloc(sizeof(struct futhark_f64_2d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    arr->mem.references = NULL;
    if (memblock_alloc(ctx, &arr->mem, dim0 * dim1 * 8, "arr->mem"))
        err = 1;
    arr->shape[0] = dim0;
    arr->shape[1] = dim1;
    if ((size_t) (dim0 * dim1) * 8 > 0)
        memmove(arr->mem.mem + 0, (const unsigned char *) data + 0, (size_t) (dim0 * dim1) * 8);
    lock_unlock(&ctx->lock);
    if (err != 0) {
        free(arr);
        return bad;
    }
    return arr;
}
struct futhark_f64_2d *futhark_new_raw_f64_2d(struct futhark_context *ctx, unsigned char *data, int64_t dim0, int64_t dim1)
{
    int err = 0;
    struct futhark_f64_2d *bad = NULL;
    struct futhark_f64_2d *arr = (struct futhark_f64_2d *) malloc(sizeof(struct futhark_f64_2d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    arr->mem.references = NULL;
    arr->mem.mem = data;
    arr->shape[0] = dim0;
    arr->shape[1] = dim1;
    lock_unlock(&ctx->lock);
    return arr;
}
int futhark_free_f64_2d(struct futhark_context *ctx, struct futhark_f64_2d *arr)
{
    lock_lock(&ctx->lock);
    if (memblock_unref(ctx, &arr->mem, "arr->mem") != 0)
        return 1;
    lock_unlock(&ctx->lock);
    free(arr);
    return 0;
}
int futhark_values_f64_2d(struct futhark_context *ctx, struct futhark_f64_2d *arr, double *data)
{
    int err = 0;
    
    lock_lock(&ctx->lock);
    if ((size_t) (arr->shape[0] * arr->shape[1]) * 8 > 0)
        memmove((unsigned char *) data + 0, arr->mem.mem + 0, (size_t) (arr->shape[0] * arr->shape[1]) * 8);
    lock_unlock(&ctx->lock);
    return err;
}
int futhark_index_f64_2d(struct futhark_context *ctx, double *out, struct futhark_f64_2d *arr, int64_t i0, int64_t i1)
{
    int err = 0;
    
    if ((i0 >= 0 && i0 < arr->shape[0]) && (i1 >= 0 && i1 < arr->shape[1])) {
        lock_lock(&ctx->lock);
        if (8 > 0)
            memmove((unsigned char *) out + 0, arr->mem.mem + 8 * (i0 * arr->shape[1] + i1 * 1), 8);
        lock_unlock(&ctx->lock);
    } else {
        err = 1;
        set_error(ctx, strdup("Index out of bounds."));
    }
    return err;
}
unsigned char *futhark_values_raw_f64_2d(struct futhark_context *ctx, struct futhark_f64_2d *arr)
{
    (void) ctx;
    return arr->mem.mem;
}
const int64_t *futhark_shape_f64_2d(struct futhark_context *ctx, struct futhark_f64_2d *arr)
{
    (void) ctx;
    return arr->shape;
}
struct futhark_f64_3d {
    struct memblock mem;
    int64_t shape[3];
};
struct futhark_f64_3d *futhark_new_f64_3d(struct futhark_context *ctx, const double *data, int64_t dim0, int64_t dim1, int64_t dim2)
{
    int err = 0;
    struct futhark_f64_3d *bad = NULL;
    struct futhark_f64_3d *arr = (struct futhark_f64_3d *) malloc(sizeof(struct futhark_f64_3d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    arr->mem.references = NULL;
    if (memblock_alloc(ctx, &arr->mem, dim0 * dim1 * dim2 * 8, "arr->mem"))
        err = 1;
    arr->shape[0] = dim0;
    arr->shape[1] = dim1;
    arr->shape[2] = dim2;
    if ((size_t) (dim0 * dim1 * dim2) * 8 > 0)
        memmove(arr->mem.mem + 0, (const unsigned char *) data + 0, (size_t) (dim0 * dim1 * dim2) * 8);
    lock_unlock(&ctx->lock);
    if (err != 0) {
        free(arr);
        return bad;
    }
    return arr;
}
struct futhark_f64_3d *futhark_new_raw_f64_3d(struct futhark_context *ctx, unsigned char *data, int64_t dim0, int64_t dim1, int64_t dim2)
{
    int err = 0;
    struct futhark_f64_3d *bad = NULL;
    struct futhark_f64_3d *arr = (struct futhark_f64_3d *) malloc(sizeof(struct futhark_f64_3d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    arr->mem.references = NULL;
    arr->mem.mem = data;
    arr->shape[0] = dim0;
    arr->shape[1] = dim1;
    arr->shape[2] = dim2;
    lock_unlock(&ctx->lock);
    return arr;
}
int futhark_free_f64_3d(struct futhark_context *ctx, struct futhark_f64_3d *arr)
{
    lock_lock(&ctx->lock);
    if (memblock_unref(ctx, &arr->mem, "arr->mem") != 0)
        return 1;
    lock_unlock(&ctx->lock);
    free(arr);
    return 0;
}
int futhark_values_f64_3d(struct futhark_context *ctx, struct futhark_f64_3d *arr, double *data)
{
    int err = 0;
    
    lock_lock(&ctx->lock);
    if ((size_t) (arr->shape[0] * arr->shape[1] * arr->shape[2]) * 8 > 0)
        memmove((unsigned char *) data + 0, arr->mem.mem + 0, (size_t) (arr->shape[0] * arr->shape[1] * arr->shape[2]) * 8);
    lock_unlock(&ctx->lock);
    return err;
}
int futhark_index_f64_3d(struct futhark_context *ctx, double *out, struct futhark_f64_3d *arr, int64_t i0, int64_t i1, int64_t i2)
{
    int err = 0;
    
    if ((i0 >= 0 && i0 < arr->shape[0]) && ((i1 >= 0 && i1 < arr->shape[1]) && (i2 >= 0 && i2 < arr->shape[2]))) {
        lock_lock(&ctx->lock);
        if (8 > 0)
            memmove((unsigned char *) out + 0, arr->mem.mem + 8 * (i0 * (arr->shape[1] * arr->shape[2]) + i1 * arr->shape[2] + i2 * 1), 8);
        lock_unlock(&ctx->lock);
    } else {
        err = 1;
        set_error(ctx, strdup("Index out of bounds."));
    }
    return err;
}
unsigned char *futhark_values_raw_f64_3d(struct futhark_context *ctx, struct futhark_f64_3d *arr)
{
    (void) ctx;
    return arr->mem.mem;
}
const int64_t *futhark_shape_f64_3d(struct futhark_context *ctx, struct futhark_f64_3d *arr)
{
    (void) ctx;
    return arr->shape;
}

FUTHARK_FUN_ATTR int futrts_entry_ugw_armijo(struct futhark_context *ctx, struct memblock *mem_out_p_91663, struct memblock A_mem_89411, struct memblock mu_mem_89412, struct memblock B_mem_89413, struct memblock nu_mem_89414, int64_t mz2081Uz2084U_34268, double rho1_34269, double rho2_34270, double eps_34271, double exp_absorb_cutoff_34276, double safe_for_exp_34277, double tol_sinkhorn_34278, double tol_outerloop_34279)
{
    (void) ctx;
    
    int err = 0;
    int64_t mem_89416_cached_sizze_91664 = 0;
    unsigned char *mem_89416 = NULL;
    int64_t mem_89419_cached_sizze_91665 = 0;
    unsigned char *mem_89419 = NULL;
    int64_t mem_89432_cached_sizze_91666 = 0;
    unsigned char *mem_89432 = NULL;
    int64_t mem_89434_cached_sizze_91667 = 0;
    unsigned char *mem_89434 = NULL;
    int64_t mem_89437_cached_sizze_91668 = 0;
    unsigned char *mem_89437 = NULL;
    int64_t mem_89467_cached_sizze_91669 = 0;
    unsigned char *mem_89467 = NULL;
    int64_t mem_89469_cached_sizze_91670 = 0;
    unsigned char *mem_89469 = NULL;
    int64_t mem_89471_cached_sizze_91671 = 0;
    unsigned char *mem_89471 = NULL;
    int64_t mem_89491_cached_sizze_91672 = 0;
    unsigned char *mem_89491 = NULL;
    int64_t mem_89500_cached_sizze_91673 = 0;
    unsigned char *mem_89500 = NULL;
    int64_t mem_89511_cached_sizze_91674 = 0;
    unsigned char *mem_89511 = NULL;
    int64_t mem_89513_cached_sizze_91675 = 0;
    unsigned char *mem_89513 = NULL;
    int64_t mem_89527_cached_sizze_91676 = 0;
    unsigned char *mem_89527 = NULL;
    int64_t mem_89558_cached_sizze_91677 = 0;
    unsigned char *mem_89558 = NULL;
    int64_t mem_89850_cached_sizze_91678 = 0;
    unsigned char *mem_89850 = NULL;
    int64_t mem_89897_cached_sizze_91679 = 0;
    unsigned char *mem_89897 = NULL;
    int64_t mem_89905_cached_sizze_91680 = 0;
    unsigned char *mem_89905 = NULL;
    int64_t mem_89907_cached_sizze_91681 = 0;
    unsigned char *mem_89907 = NULL;
    int64_t mem_89921_cached_sizze_91682 = 0;
    unsigned char *mem_89921 = NULL;
    int64_t mem_89930_cached_sizze_91683 = 0;
    unsigned char *mem_89930 = NULL;
    int64_t mem_89932_cached_sizze_91684 = 0;
    unsigned char *mem_89932 = NULL;
    int64_t mem_89941_cached_sizze_91685 = 0;
    unsigned char *mem_89941 = NULL;
    int64_t mem_89949_cached_sizze_91686 = 0;
    unsigned char *mem_89949 = NULL;
    int64_t mem_90580_cached_sizze_91687 = 0;
    unsigned char *mem_90580 = NULL;
    int64_t mem_90617_cached_sizze_91688 = 0;
    unsigned char *mem_90617 = NULL;
    int64_t mem_90619_cached_sizze_91689 = 0;
    unsigned char *mem_90619 = NULL;
    int64_t mem_90621_cached_sizze_91690 = 0;
    unsigned char *mem_90621 = NULL;
    int64_t mem_90642_cached_sizze_91691 = 0;
    unsigned char *mem_90642 = NULL;
    int64_t mem_90654_cached_sizze_91692 = 0;
    unsigned char *mem_90654 = NULL;
    int64_t mem_90656_cached_sizze_91693 = 0;
    unsigned char *mem_90656 = NULL;
    int64_t mem_90670_cached_sizze_91694 = 0;
    unsigned char *mem_90670 = NULL;
    int64_t mem_90678_cached_sizze_91695 = 0;
    unsigned char *mem_90678 = NULL;
    int64_t mem_90681_cached_sizze_91696 = 0;
    unsigned char *mem_90681 = NULL;
    int64_t mem_90697_cached_sizze_91697 = 0;
    unsigned char *mem_90697 = NULL;
    int64_t mem_90732_cached_sizze_91698 = 0;
    unsigned char *mem_90732 = NULL;
    int64_t mem_90740_cached_sizze_91699 = 0;
    unsigned char *mem_90740 = NULL;
    int64_t mem_90752_cached_sizze_91700 = 0;
    unsigned char *mem_90752 = NULL;
    int64_t mem_90755_cached_sizze_91701 = 0;
    unsigned char *mem_90755 = NULL;
    int64_t mem_90798_cached_sizze_91702 = 0;
    unsigned char *mem_90798 = NULL;
    int64_t mem_90806_cached_sizze_91703 = 0;
    unsigned char *mem_90806 = NULL;
    int64_t mem_90857_cached_sizze_91704 = 0;
    unsigned char *mem_90857 = NULL;
    int64_t mem_90859_cached_sizze_91705 = 0;
    unsigned char *mem_90859 = NULL;
    int64_t mem_90861_cached_sizze_91706 = 0;
    unsigned char *mem_90861 = NULL;
    int64_t mem_90872_cached_sizze_91707 = 0;
    unsigned char *mem_90872 = NULL;
    int64_t mem_90889_cached_sizze_91708 = 0;
    unsigned char *mem_90889 = NULL;
    int64_t mem_90891_cached_sizze_91709 = 0;
    unsigned char *mem_90891 = NULL;
    int64_t mem_90893_cached_sizze_91710 = 0;
    unsigned char *mem_90893 = NULL;
    struct memblock mem_param_tmp_91370;
    
    mem_param_tmp_91370.references = NULL;
    
    struct memblock mem_param_tmp_91369;
    
    mem_param_tmp_91369.references = NULL;
    
    struct memblock mem_param_tmp_91368;
    
    mem_param_tmp_91368.references = NULL;
    
    struct memblock mem_90615;
    
    mem_90615.references = NULL;
    
    struct memblock mem_90612;
    
    mem_90612.references = NULL;
    
    struct memblock mem_90819;
    
    mem_90819.references = NULL;
    
    struct memblock mem_param_tmp_91582;
    
    mem_param_tmp_91582.references = NULL;
    
    struct memblock mem_90758;
    
    mem_90758.references = NULL;
    
    struct memblock mem_param_90750;
    
    mem_param_90750.references = NULL;
    
    struct memblock ext_mem_90816;
    
    ext_mem_90816.references = NULL;
    
    struct memblock mem_90684;
    
    mem_90684.references = NULL;
    
    struct memblock ext_mem_90839;
    
    ext_mem_90839.references = NULL;
    
    struct memblock ext_mem_90842;
    
    ext_mem_90842.references = NULL;
    
    struct memblock ext_mem_90845;
    
    ext_mem_90845.references = NULL;
    
    struct memblock mem_90582;
    
    mem_90582.references = NULL;
    
    struct memblock mem_90577;
    
    mem_90577.references = NULL;
    
    struct memblock mem_param_tmp_91491;
    
    mem_param_tmp_91491.references = NULL;
    
    struct memblock mem_param_tmp_91490;
    
    mem_param_tmp_91490.references = NULL;
    
    struct memblock mem_param_tmp_91489;
    
    mem_param_tmp_91489.references = NULL;
    
    struct memblock mem_param_tmp_91488;
    
    mem_param_tmp_91488.references = NULL;
    
    struct memblock mem_param_tmp_91487;
    
    mem_param_tmp_91487.references = NULL;
    
    struct memblock mem_90512;
    
    mem_90512.references = NULL;
    
    struct memblock ext_mem_90523;
    
    ext_mem_90523.references = NULL;
    
    struct memblock mem_90500;
    
    mem_90500.references = NULL;
    
    struct memblock mem_90497;
    
    mem_90497.references = NULL;
    
    struct memblock mem_90495;
    
    mem_90495.references = NULL;
    
    struct memblock ext_mem_90537;
    
    ext_mem_90537.references = NULL;
    
    struct memblock ext_mem_90540;
    
    ext_mem_90540.references = NULL;
    
    struct memblock ext_mem_90543;
    
    ext_mem_90543.references = NULL;
    
    struct memblock mem_90462;
    
    mem_90462.references = NULL;
    
    struct memblock ext_mem_90473;
    
    ext_mem_90473.references = NULL;
    
    struct memblock mem_90450;
    
    mem_90450.references = NULL;
    
    struct memblock mem_90447;
    
    mem_90447.references = NULL;
    
    struct memblock mem_90445;
    
    mem_90445.references = NULL;
    
    struct memblock ext_mem_90487;
    
    ext_mem_90487.references = NULL;
    
    struct memblock ext_mem_90490;
    
    ext_mem_90490.references = NULL;
    
    struct memblock ext_mem_90493;
    
    ext_mem_90493.references = NULL;
    
    struct memblock mem_90437;
    
    mem_90437.references = NULL;
    
    struct memblock mem_90429;
    
    mem_90429.references = NULL;
    
    struct memblock mem_param_90427;
    
    mem_param_90427.references = NULL;
    
    struct memblock mem_param_90424;
    
    mem_param_90424.references = NULL;
    
    struct memblock mem_param_90421;
    
    mem_param_90421.references = NULL;
    
    struct memblock mem_param_90418;
    
    mem_param_90418.references = NULL;
    
    struct memblock mem_param_90415;
    
    mem_param_90415.references = NULL;
    
    struct memblock ext_mem_90555;
    
    ext_mem_90555.references = NULL;
    
    struct memblock ext_mem_90556;
    
    ext_mem_90556.references = NULL;
    
    struct memblock ext_mem_90557;
    
    ext_mem_90557.references = NULL;
    
    struct memblock ext_mem_90558;
    
    ext_mem_90558.references = NULL;
    
    struct memblock ext_mem_90559;
    
    ext_mem_90559.references = NULL;
    
    struct memblock mem_90380;
    
    mem_90380.references = NULL;
    
    struct memblock ext_mem_90391;
    
    ext_mem_90391.references = NULL;
    
    struct memblock mem_90368;
    
    mem_90368.references = NULL;
    
    struct memblock mem_90365;
    
    mem_90365.references = NULL;
    
    struct memblock mem_90363;
    
    mem_90363.references = NULL;
    
    struct memblock ext_mem_90405;
    
    ext_mem_90405.references = NULL;
    
    struct memblock ext_mem_90408;
    
    ext_mem_90408.references = NULL;
    
    struct memblock ext_mem_90411;
    
    ext_mem_90411.references = NULL;
    
    struct memblock mem_90330;
    
    mem_90330.references = NULL;
    
    struct memblock ext_mem_90341;
    
    ext_mem_90341.references = NULL;
    
    struct memblock mem_90318;
    
    mem_90318.references = NULL;
    
    struct memblock mem_90315;
    
    mem_90315.references = NULL;
    
    struct memblock mem_90313;
    
    mem_90313.references = NULL;
    
    struct memblock ext_mem_90355;
    
    ext_mem_90355.references = NULL;
    
    struct memblock ext_mem_90358;
    
    ext_mem_90358.references = NULL;
    
    struct memblock ext_mem_90361;
    
    ext_mem_90361.references = NULL;
    
    struct memblock mem_90305;
    
    mem_90305.references = NULL;
    
    struct memblock mem_90297;
    
    mem_90297.references = NULL;
    
    struct memblock ext_mem_90562;
    
    ext_mem_90562.references = NULL;
    
    struct memblock ext_mem_90565;
    
    ext_mem_90565.references = NULL;
    
    struct memblock ext_mem_90568;
    
    ext_mem_90568.references = NULL;
    
    struct memblock ext_mem_90571;
    
    ext_mem_90571.references = NULL;
    
    struct memblock ext_mem_90575;
    
    ext_mem_90575.references = NULL;
    
    struct memblock mem_param_tmp_91433;
    
    mem_param_tmp_91433.references = NULL;
    
    struct memblock mem_param_tmp_91432;
    
    mem_param_tmp_91432.references = NULL;
    
    struct memblock mem_param_tmp_91431;
    
    mem_param_tmp_91431.references = NULL;
    
    struct memblock mem_param_tmp_91430;
    
    mem_param_tmp_91430.references = NULL;
    
    struct memblock mem_param_tmp_91429;
    
    mem_param_tmp_91429.references = NULL;
    
    struct memblock mem_param_tmp_91428;
    
    mem_param_tmp_91428.references = NULL;
    
    struct memblock mem_param_tmp_91427;
    
    mem_param_tmp_91427.references = NULL;
    
    struct memblock mem_param_tmp_91426;
    
    mem_param_tmp_91426.references = NULL;
    
    struct memblock mem_param_tmp_91425;
    
    mem_param_tmp_91425.references = NULL;
    
    struct memblock mem_90235;
    
    mem_90235.references = NULL;
    
    struct memblock ext_mem_90246;
    
    ext_mem_90246.references = NULL;
    
    struct memblock mem_90223;
    
    mem_90223.references = NULL;
    
    struct memblock mem_90220;
    
    mem_90220.references = NULL;
    
    struct memblock mem_90218;
    
    mem_90218.references = NULL;
    
    struct memblock ext_mem_90260;
    
    ext_mem_90260.references = NULL;
    
    struct memblock ext_mem_90263;
    
    ext_mem_90263.references = NULL;
    
    struct memblock ext_mem_90266;
    
    ext_mem_90266.references = NULL;
    
    struct memblock mem_90185;
    
    mem_90185.references = NULL;
    
    struct memblock ext_mem_90196;
    
    ext_mem_90196.references = NULL;
    
    struct memblock mem_90173;
    
    mem_90173.references = NULL;
    
    struct memblock mem_90170;
    
    mem_90170.references = NULL;
    
    struct memblock mem_90168;
    
    mem_90168.references = NULL;
    
    struct memblock ext_mem_90210;
    
    ext_mem_90210.references = NULL;
    
    struct memblock ext_mem_90213;
    
    ext_mem_90213.references = NULL;
    
    struct memblock ext_mem_90216;
    
    ext_mem_90216.references = NULL;
    
    struct memblock mem_90160;
    
    mem_90160.references = NULL;
    
    struct memblock mem_90152;
    
    mem_90152.references = NULL;
    
    struct memblock mem_param_90150;
    
    mem_param_90150.references = NULL;
    
    struct memblock mem_param_90147;
    
    mem_param_90147.references = NULL;
    
    struct memblock mem_param_90144;
    
    mem_param_90144.references = NULL;
    
    struct memblock mem_param_90141;
    
    mem_param_90141.references = NULL;
    
    struct memblock mem_param_90138;
    
    mem_param_90138.references = NULL;
    
    struct memblock mem_param_90134;
    
    mem_param_90134.references = NULL;
    
    struct memblock mem_param_90131;
    
    mem_param_90131.references = NULL;
    
    struct memblock mem_param_90128;
    
    mem_param_90128.references = NULL;
    
    struct memblock mem_param_90125;
    
    mem_param_90125.references = NULL;
    
    struct memblock ext_mem_90287;
    
    ext_mem_90287.references = NULL;
    
    struct memblock ext_mem_90288;
    
    ext_mem_90288.references = NULL;
    
    struct memblock ext_mem_90289;
    
    ext_mem_90289.references = NULL;
    
    struct memblock ext_mem_90290;
    
    ext_mem_90290.references = NULL;
    
    struct memblock ext_mem_90291;
    
    ext_mem_90291.references = NULL;
    
    struct memblock ext_mem_90292;
    
    ext_mem_90292.references = NULL;
    
    struct memblock ext_mem_90293;
    
    ext_mem_90293.references = NULL;
    
    struct memblock ext_mem_90294;
    
    ext_mem_90294.references = NULL;
    
    struct memblock ext_mem_90295;
    
    ext_mem_90295.references = NULL;
    
    struct memblock mem_90090;
    
    mem_90090.references = NULL;
    
    struct memblock ext_mem_90101;
    
    ext_mem_90101.references = NULL;
    
    struct memblock mem_90078;
    
    mem_90078.references = NULL;
    
    struct memblock mem_90075;
    
    mem_90075.references = NULL;
    
    struct memblock mem_90073;
    
    mem_90073.references = NULL;
    
    struct memblock ext_mem_90115;
    
    ext_mem_90115.references = NULL;
    
    struct memblock ext_mem_90118;
    
    ext_mem_90118.references = NULL;
    
    struct memblock ext_mem_90121;
    
    ext_mem_90121.references = NULL;
    
    struct memblock mem_90040;
    
    mem_90040.references = NULL;
    
    struct memblock ext_mem_90051;
    
    ext_mem_90051.references = NULL;
    
    struct memblock mem_90028;
    
    mem_90028.references = NULL;
    
    struct memblock mem_90025;
    
    mem_90025.references = NULL;
    
    struct memblock mem_90023;
    
    mem_90023.references = NULL;
    
    struct memblock ext_mem_90065;
    
    ext_mem_90065.references = NULL;
    
    struct memblock ext_mem_90068;
    
    ext_mem_90068.references = NULL;
    
    struct memblock ext_mem_90071;
    
    ext_mem_90071.references = NULL;
    
    struct memblock mem_param_89895;
    
    mem_param_89895.references = NULL;
    
    struct memblock mem_param_89891;
    
    mem_param_89891.references = NULL;
    
    struct memblock mem_param_89888;
    
    mem_param_89888.references = NULL;
    
    struct memblock ext_mem_90853;
    
    ext_mem_90853.references = NULL;
    
    struct memblock ext_mem_90854;
    
    ext_mem_90854.references = NULL;
    
    struct memblock ext_mem_90855;
    
    ext_mem_90855.references = NULL;
    
    struct memblock mem_param_tmp_91331;
    
    mem_param_tmp_91331.references = NULL;
    
    struct memblock mem_param_tmp_91330;
    
    mem_param_tmp_91330.references = NULL;
    
    struct memblock mem_param_tmp_91329;
    
    mem_param_tmp_91329.references = NULL;
    
    struct memblock mem_param_tmp_91328;
    
    mem_param_tmp_91328.references = NULL;
    
    struct memblock mem_param_tmp_91327;
    
    mem_param_tmp_91327.references = NULL;
    
    struct memblock mem_89800;
    
    mem_89800.references = NULL;
    
    struct memblock ext_mem_89811;
    
    ext_mem_89811.references = NULL;
    
    struct memblock mem_89788;
    
    mem_89788.references = NULL;
    
    struct memblock mem_89785;
    
    mem_89785.references = NULL;
    
    struct memblock mem_89783;
    
    mem_89783.references = NULL;
    
    struct memblock ext_mem_89825;
    
    ext_mem_89825.references = NULL;
    
    struct memblock ext_mem_89828;
    
    ext_mem_89828.references = NULL;
    
    struct memblock ext_mem_89831;
    
    ext_mem_89831.references = NULL;
    
    struct memblock mem_89750;
    
    mem_89750.references = NULL;
    
    struct memblock ext_mem_89761;
    
    ext_mem_89761.references = NULL;
    
    struct memblock mem_89738;
    
    mem_89738.references = NULL;
    
    struct memblock mem_89735;
    
    mem_89735.references = NULL;
    
    struct memblock mem_89733;
    
    mem_89733.references = NULL;
    
    struct memblock ext_mem_89775;
    
    ext_mem_89775.references = NULL;
    
    struct memblock ext_mem_89778;
    
    ext_mem_89778.references = NULL;
    
    struct memblock ext_mem_89781;
    
    ext_mem_89781.references = NULL;
    
    struct memblock mem_89725;
    
    mem_89725.references = NULL;
    
    struct memblock mem_89717;
    
    mem_89717.references = NULL;
    
    struct memblock mem_param_89715;
    
    mem_param_89715.references = NULL;
    
    struct memblock mem_param_89712;
    
    mem_param_89712.references = NULL;
    
    struct memblock mem_param_89709;
    
    mem_param_89709.references = NULL;
    
    struct memblock mem_param_89706;
    
    mem_param_89706.references = NULL;
    
    struct memblock mem_param_89703;
    
    mem_param_89703.references = NULL;
    
    struct memblock ext_mem_89843;
    
    ext_mem_89843.references = NULL;
    
    struct memblock ext_mem_89844;
    
    ext_mem_89844.references = NULL;
    
    struct memblock ext_mem_89845;
    
    ext_mem_89845.references = NULL;
    
    struct memblock ext_mem_89846;
    
    ext_mem_89846.references = NULL;
    
    struct memblock ext_mem_89847;
    
    ext_mem_89847.references = NULL;
    
    struct memblock mem_89668;
    
    mem_89668.references = NULL;
    
    struct memblock ext_mem_89679;
    
    ext_mem_89679.references = NULL;
    
    struct memblock mem_89656;
    
    mem_89656.references = NULL;
    
    struct memblock mem_89653;
    
    mem_89653.references = NULL;
    
    struct memblock mem_89651;
    
    mem_89651.references = NULL;
    
    struct memblock ext_mem_89693;
    
    ext_mem_89693.references = NULL;
    
    struct memblock ext_mem_89696;
    
    ext_mem_89696.references = NULL;
    
    struct memblock ext_mem_89699;
    
    ext_mem_89699.references = NULL;
    
    struct memblock mem_89618;
    
    mem_89618.references = NULL;
    
    struct memblock ext_mem_89629;
    
    ext_mem_89629.references = NULL;
    
    struct memblock mem_89606;
    
    mem_89606.references = NULL;
    
    struct memblock mem_89603;
    
    mem_89603.references = NULL;
    
    struct memblock mem_89601;
    
    mem_89601.references = NULL;
    
    struct memblock ext_mem_89643;
    
    ext_mem_89643.references = NULL;
    
    struct memblock ext_mem_89646;
    
    ext_mem_89646.references = NULL;
    
    struct memblock ext_mem_89649;
    
    ext_mem_89649.references = NULL;
    
    struct memblock mem_90009;
    
    mem_90009.references = NULL;
    
    struct memblock mem_90007;
    
    mem_90007.references = NULL;
    
    struct memblock mem_89977;
    
    mem_89977.references = NULL;
    
    struct memblock mem_89974;
    
    mem_89974.references = NULL;
    
    struct memblock mem_89972;
    
    mem_89972.references = NULL;
    
    struct memblock mem_89869;
    
    mem_89869.references = NULL;
    
    struct memblock mem_89593;
    
    mem_89593.references = NULL;
    
    struct memblock mem_89585;
    
    mem_89585.references = NULL;
    
    struct memblock mem_89561;
    
    mem_89561.references = NULL;
    
    struct memblock mem_89550;
    
    mem_89550.references = NULL;
    
    struct memblock mem_89502;
    
    mem_89502.references = NULL;
    
    struct memblock mem_89426;
    
    mem_89426.references = NULL;
    
    struct memblock mem_89423;
    
    mem_89423.references = NULL;
    
    struct memblock ext_mem_89420;
    
    ext_mem_89420.references = NULL;
    
    struct memblock ext_mem_89421;
    
    ext_mem_89421.references = NULL;
    
    struct memblock mem_out_91249;
    
    mem_out_91249.references = NULL;
    
    int64_t bytes_89415 = (int64_t) 16 * mz2081Uz2084U_34268;
    int64_t bytes_89418 = mz2081Uz2084U_34268 * bytes_89415;
    int64_t zbzg_lhs_49425;
    
    if (futrts_pairs_11446(ctx, &ext_mem_89421, &ext_mem_89420, &zbzg_lhs_49425, (int64_t) 2) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int64_t bytes_89422 = (int64_t) 8 * mz2081Uz2084U_34268;
    int64_t bytes_89425 = (int64_t) 40 * zbzg_lhs_49425;
    int64_t bytes_89436 = mz2081Uz2084U_34268 * bytes_89422;
    bool y_35258 = slt64((int64_t) 0, zbzg_lhs_49425);
    bool index_certs_35259;
    
    if (!y_35258) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) (int64_t) 0, "] out of bounds for array of shape [", (long long) zbzg_lhs_49425, "].", "-> #0  unbalanced_gw.fut:192:33-37\n   #1  /prelude/functional.fut:9:44-45\n   #2  unbalanced_gw.fut:192:27-37\n   #3  unbalanced_gw.fut:189:1-192:38\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    if (mem_89416_cached_sizze_91664 < bytes_89415) {
        err = lexical_realloc(ctx, &mem_89416, &mem_89416_cached_sizze_91664, bytes_89415);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    lmad_copy_8b(ctx, 1, (uint64_t *) mem_89416, (int64_t) 0, (int64_t []) {(int64_t) 1}, (uint64_t *) mu_mem_89412.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {mz2081Uz2084U_34268});
    lmad_copy_8b(ctx, 1, (uint64_t *) mem_89416, mz2081Uz2084U_34268, (int64_t []) {(int64_t) 1}, (uint64_t *) nu_mem_89414.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {mz2081Uz2084U_34268});
    if (mem_89419_cached_sizze_91665 < bytes_89418) {
        err = lexical_realloc(ctx, &mem_89419, &mem_89419_cached_sizze_91665, bytes_89418);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    lmad_copy_8b(ctx, 2, (uint64_t *) mem_89419, (int64_t) 0, (int64_t []) {mz2081Uz2084U_34268, (int64_t) 1}, (uint64_t *) A_mem_89411.mem, (int64_t) 0, (int64_t []) {mz2081Uz2084U_34268, (int64_t) 1}, (int64_t []) {mz2081Uz2084U_34268, mz2081Uz2084U_34268});
    lmad_copy_8b(ctx, 2, (uint64_t *) mem_89419, mz2081Uz2084U_34268 * mz2081Uz2084U_34268, (int64_t []) {mz2081Uz2084U_34268, (int64_t) 1}, (uint64_t *) B_mem_89413.mem, (int64_t) 0, (int64_t []) {mz2081Uz2084U_34268, (int64_t) 1}, (int64_t []) {mz2081Uz2084U_34268, mz2081Uz2084U_34268});
    
    double neg_res_49428 = -eps_34271;
    double zp_res_49429 = 1.0 + tol_outerloop_34279;
    double neg_res_49430 = -rho1_34269;
    double zp_res_49431 = rho1_34269 + eps_34271;
    double zs_res_49432 = neg_res_49430 / zp_res_49431;
    double zs_res_49433 = neg_res_49428 / zp_res_49431;
    double neg_res_49434 = -rho2_34270;
    double zp_res_49435 = rho2_34270 + eps_34271;
    double zs_res_49436 = neg_res_49434 / zp_res_49435;
    double zs_res_49437 = neg_res_49428 / zp_res_49435;
    double zp_res_49438 = rho2_34270 + zp_res_49431;
    
    if (memblock_alloc(ctx, &mem_89423, bytes_89422, "mem_89423")) {
        err = 1;
        goto cleanup;
    }
    for (int64_t nest_i_91250 = 0; nest_i_91250 < mz2081Uz2084U_34268; nest_i_91250++) {
        ((double *) mem_89423.mem)[nest_i_91250] = 1.0;
    }
    if (memblock_alloc(ctx, &mem_89426, bytes_89425, "mem_89426")) {
        err = 1;
        goto cleanup;
    }
    
    double zs_res_49813 = 1.0 / exp_absorb_cutoff_34276;
    double zp_res_83654 = 1.0 + tol_sinkhorn_34278;
    
    if (mem_89432_cached_sizze_91666 < bytes_89422) {
        err = lexical_realloc(ctx, &mem_89432, &mem_89432_cached_sizze_91666, bytes_89422);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89434_cached_sizze_91667 < bytes_89422) {
        err = lexical_realloc(ctx, &mem_89434, &mem_89434_cached_sizze_91667, bytes_89422);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89437_cached_sizze_91668 < bytes_89436) {
        err = lexical_realloc(ctx, &mem_89437, &mem_89437_cached_sizze_91668, bytes_89436);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89467_cached_sizze_91669 < bytes_89422) {
        err = lexical_realloc(ctx, &mem_89467, &mem_89467_cached_sizze_91669, bytes_89422);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89469_cached_sizze_91670 < bytes_89422) {
        err = lexical_realloc(ctx, &mem_89469, &mem_89469_cached_sizze_91670, bytes_89422);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89471_cached_sizze_91671 < bytes_89422) {
        err = lexical_realloc(ctx, &mem_89471, &mem_89471_cached_sizze_91671, bytes_89422);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89491_cached_sizze_91672 < bytes_89422) {
        err = lexical_realloc(ctx, &mem_89491, &mem_89491_cached_sizze_91672, bytes_89422);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89500_cached_sizze_91673 < bytes_89436) {
        err = lexical_realloc(ctx, &mem_89500, &mem_89500_cached_sizze_91673, bytes_89436);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89502, bytes_89422, "mem_89502")) {
        err = 1;
        goto cleanup;
    }
    if (mem_89511_cached_sizze_91674 < bytes_89422) {
        err = lexical_realloc(ctx, &mem_89511, &mem_89511_cached_sizze_91674, bytes_89422);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89513_cached_sizze_91675 < bytes_89422) {
        err = lexical_realloc(ctx, &mem_89513, &mem_89513_cached_sizze_91675, bytes_89422);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89527_cached_sizze_91676 < bytes_89422) {
        err = lexical_realloc(ctx, &mem_89527, &mem_89527_cached_sizze_91676, bytes_89422);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89550, bytes_89422, "mem_89550")) {
        err = 1;
        goto cleanup;
    }
    if (mem_89558_cached_sizze_91677 < bytes_89422) {
        err = lexical_realloc(ctx, &mem_89558, &mem_89558_cached_sizze_91677, bytes_89422);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89561, bytes_89436, "mem_89561")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89585, bytes_89422, "mem_89585")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89593, bytes_89422, "mem_89593")) {
        err = 1;
        goto cleanup;
    }
    if (mem_89850_cached_sizze_91678 < bytes_89436) {
        err = lexical_realloc(ctx, &mem_89850, &mem_89850_cached_sizze_91678, bytes_89436);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89869, bytes_89436, "mem_89869")) {
        err = 1;
        goto cleanup;
    }
    if (mem_89897_cached_sizze_91679 < bytes_89422) {
        err = lexical_realloc(ctx, &mem_89897, &mem_89897_cached_sizze_91679, bytes_89422);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89905_cached_sizze_91680 < bytes_89422) {
        err = lexical_realloc(ctx, &mem_89905, &mem_89905_cached_sizze_91680, bytes_89422);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89907_cached_sizze_91681 < bytes_89422) {
        err = lexical_realloc(ctx, &mem_89907, &mem_89907_cached_sizze_91681, bytes_89422);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89921_cached_sizze_91682 < bytes_89422) {
        err = lexical_realloc(ctx, &mem_89921, &mem_89921_cached_sizze_91682, bytes_89422);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89930_cached_sizze_91683 < bytes_89436) {
        err = lexical_realloc(ctx, &mem_89930, &mem_89930_cached_sizze_91683, bytes_89436);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89932_cached_sizze_91684 < bytes_89422) {
        err = lexical_realloc(ctx, &mem_89932, &mem_89932_cached_sizze_91684, bytes_89422);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89941_cached_sizze_91685 < bytes_89422) {
        err = lexical_realloc(ctx, &mem_89941, &mem_89941_cached_sizze_91685, bytes_89422);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89949_cached_sizze_91686 < bytes_89422) {
        err = lexical_realloc(ctx, &mem_89949, &mem_89949_cached_sizze_91686, bytes_89422);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89972, bytes_89422, "mem_89972")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89974, bytes_89422, "mem_89974")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89977, bytes_89436, "mem_89977")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_90007, bytes_89422, "mem_90007")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_90009, bytes_89422, "mem_90009")) {
        err = 1;
        goto cleanup;
    }
    if (mem_90580_cached_sizze_91687 < bytes_89436) {
        err = lexical_realloc(ctx, &mem_90580, &mem_90580_cached_sizze_91687, bytes_89436);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_90857_cached_sizze_91704 < bytes_89422) {
        err = lexical_realloc(ctx, &mem_90857, &mem_90857_cached_sizze_91704, bytes_89422);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_90859_cached_sizze_91705 < bytes_89422) {
        err = lexical_realloc(ctx, &mem_90859, &mem_90859_cached_sizze_91705, bytes_89422);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_90861_cached_sizze_91706 < bytes_89422) {
        err = lexical_realloc(ctx, &mem_90861, &mem_90861_cached_sizze_91706, bytes_89422);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_90872_cached_sizze_91707 < bytes_89422) {
        err = lexical_realloc(ctx, &mem_90872, &mem_90872_cached_sizze_91707, bytes_89422);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_90889_cached_sizze_91708 < bytes_89422) {
        err = lexical_realloc(ctx, &mem_90889, &mem_90889_cached_sizze_91708, bytes_89422);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_90891_cached_sizze_91709 < bytes_89422) {
        err = lexical_realloc(ctx, &mem_90891, &mem_90891_cached_sizze_91709, bytes_89422);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_90893_cached_sizze_91710 < bytes_89422) {
        err = lexical_realloc(ctx, &mem_90893, &mem_90893_cached_sizze_91710, bytes_89422);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    for (int64_t i_89371 = 0; i_89371 < zbzg_lhs_49425; i_89371++) {
        int64_t eta_p_49441 = ((int64_t *) ext_mem_89421.mem)[i_89371];
        int64_t eta_p_49442 = ((int64_t *) ext_mem_89420.mem)[i_89371];
        bool x_49443 = sle64((int64_t) 0, eta_p_49442);
        bool y_49444 = slt64(eta_p_49442, (int64_t) 2);
        bool bounds_check_49445 = x_49443 && y_49444;
        bool index_certs_49446;
        
        if (!bounds_check_49445) {
            set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) eta_p_49442, "] out of bounds for array of shape [", (long long) (int64_t) 2, "].", "-> #0  unbalanced_gw.fut:164:43-52\n   #1  /prelude/functional.fut:9:44-45\n   #2  unbalanced_gw.fut:162:6-165:84\n"));
            err = FUTHARK_PROGRAM_ERROR;
            goto cleanup;
        }
        
        bool x_49449 = sle64((int64_t) 0, eta_p_49441);
        bool y_49450 = slt64(eta_p_49441, (int64_t) 2);
        bool bounds_check_49451 = x_49449 && y_49450;
        bool index_certs_49452;
        
        if (!bounds_check_49451) {
            set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) eta_p_49441, "] out of bounds for array of shape [", (long long) (int64_t) 2, "].", "-> #0  unbalanced_gw.fut:164:28-37\n   #1  /prelude/functional.fut:9:44-45\n   #2  unbalanced_gw.fut:162:6-165:84\n"));
            err = FUTHARK_PROGRAM_ERROR;
            goto cleanup;
        }
        
        double defunc_res_84755;
        double defunc_res_84756;
        double defunc_res_84757;
        double defunc_res_84758;
        double defunc_res_84759;
        double defunc_res_84760;
        double defunc_res_84761;
        double defunc_res_84762;
        double defunc_res_84763;
        double redout_88621;
        double redout_88622;
        double redout_88623;
        double redout_88624;
        double redout_88625;
        double redout_88626;
        double redout_88627;
        double redout_88628;
        double redout_88629;
        
        redout_88621 = 0.0;
        redout_88622 = 0.0;
        redout_88623 = 0.0;
        redout_88624 = 0.0;
        redout_88625 = 0.0;
        redout_88626 = 0.0;
        redout_88627 = 0.0;
        redout_88628 = 0.0;
        redout_88629 = 0.0;
        for (int64_t i_88633 = 0; i_88633 < mz2081Uz2084U_34268; i_88633++) {
            double x_58285 = ((double *) mem_89416)[eta_p_49441 * mz2081Uz2084U_34268 + i_88633];
            double defunc_res_83332;
            double defunc_res_83333;
            double defunc_res_83334;
            double defunc_res_83335;
            double defunc_res_83336;
            double defunc_res_83337;
            double defunc_res_83338;
            double defunc_res_83339;
            double redout_88607;
            double redout_88608;
            double redout_88609;
            double redout_88610;
            double redout_88611;
            double redout_88612;
            double redout_88613;
            double redout_88614;
            
            redout_88607 = 0.0;
            redout_88608 = 0.0;
            redout_88609 = 0.0;
            redout_88610 = 0.0;
            redout_88611 = 0.0;
            redout_88612 = 0.0;
            redout_88613 = 0.0;
            redout_88614 = 0.0;
            for (int64_t i_88616 = 0; i_88616 < mz2081Uz2084U_34268; i_88616++) {
                double eta_p_59637 = ((double *) mem_89416)[eta_p_49442 * mz2081Uz2084U_34268 + i_88616];
                double zt_res_59640 = x_58285 * eta_p_59637;
                bool zeze_res_59643 = zt_res_59640 == 0.0;
                double klu_res_59644;
                
                if (zeze_res_59643) {
                    klu_res_59644 = 0.0;
                } else {
                    double zs_res_59645 = zt_res_59640 / zt_res_59640;
                    double log_res_59646 = futrts_log64(zs_res_59645);
                    double zt_res_59647 = zt_res_59640 * log_res_59646;
                    
                    klu_res_59644 = zt_res_59647;
                }
                
                double klu_res_59652;
                
                if (zeze_res_59643) {
                    klu_res_59652 = 0.0;
                } else {
                    double zs_res_59653 = zt_res_59640 / zt_res_59640;
                    double log_res_59654 = futrts_log64(zs_res_59653);
                    double zt_res_59655 = zt_res_59640 * log_res_59654;
                    
                    klu_res_59652 = zt_res_59655;
                }
                
                double zp_res_58329 = klu_res_59644 + redout_88607;
                double zp_res_58366 = klu_res_59652 + redout_88608;
                double zp_res_58380 = zt_res_59640 + redout_88609;
                double zp_res_58373 = zt_res_59640 + redout_88610;
                double zp_res_58343 = zt_res_59640 + redout_88611;
                double zp_res_58336 = zt_res_59640 + redout_88612;
                double zp_res_58307 = zt_res_59640 + redout_88613;
                double zp_res_58300 = zt_res_59640 + redout_88614;
                
                ((double *) mem_89437)[i_88633 * mz2081Uz2084U_34268 + i_88616] = zt_res_59640;
                
                double redout_tmp_91264 = zp_res_58329;
                double redout_tmp_91265 = zp_res_58366;
                double redout_tmp_91266 = zp_res_58380;
                double redout_tmp_91267 = zp_res_58373;
                double redout_tmp_91268 = zp_res_58343;
                double redout_tmp_91269 = zp_res_58336;
                double redout_tmp_91270 = zp_res_58307;
                double redout_tmp_91271 = zp_res_58300;
                
                redout_88607 = redout_tmp_91264;
                redout_88608 = redout_tmp_91265;
                redout_88609 = redout_tmp_91266;
                redout_88610 = redout_tmp_91267;
                redout_88611 = redout_tmp_91268;
                redout_88612 = redout_tmp_91269;
                redout_88613 = redout_tmp_91270;
                redout_88614 = redout_tmp_91271;
            }
            defunc_res_83332 = redout_88607;
            defunc_res_83333 = redout_88608;
            defunc_res_83334 = redout_88609;
            defunc_res_83335 = redout_88610;
            defunc_res_83336 = redout_88611;
            defunc_res_83337 = redout_88612;
            defunc_res_83338 = redout_88613;
            defunc_res_83339 = redout_88614;
            
            bool zeze_res_58309 = defunc_res_83338 == 0.0;
            double klu_res_58310;
            
            if (zeze_res_58309) {
                klu_res_58310 = 0.0;
            } else {
                double zs_res_58311 = defunc_res_83338 / x_58285;
                double log_res_58312 = futrts_log64(zs_res_58311);
                double zt_res_58313 = log_res_58312 * defunc_res_83338;
                
                klu_res_58310 = zt_res_58313;
            }
            
            bool zeze_res_58345 = defunc_res_83336 == 0.0;
            double klu_res_58346;
            
            if (zeze_res_58345) {
                klu_res_58346 = 0.0;
            } else {
                double zs_res_58347 = defunc_res_83336 / x_58285;
                double log_res_58348 = futrts_log64(zs_res_58347);
                double zt_res_58349 = log_res_58348 * defunc_res_83336;
                
                klu_res_58346 = zt_res_58349;
            }
            
            double zp_res_49471 = defunc_res_83339 + redout_88621;
            double zp_res_49595 = klu_res_58310 + redout_88622;
            double zp_res_49639 = defunc_res_83332 + redout_88623;
            double zp_res_49673 = defunc_res_83337 + redout_88624;
            double zp_res_50276 = klu_res_58346 + redout_88625;
            double zp_res_50233 = defunc_res_83336 + redout_88626;
            double zp_res_50262 = defunc_res_83333 + redout_88627;
            double zp_res_50304 = x_58285 + redout_88628;
            double zp_res_52465 = x_58285 + redout_88629;
            
            ((double *) mem_89432)[i_88633] = defunc_res_83334;
            ((double *) mem_89434)[i_88633] = defunc_res_83335;
            
            double redout_tmp_91252 = zp_res_49471;
            double redout_tmp_91253 = zp_res_49595;
            double redout_tmp_91254 = zp_res_49639;
            double redout_tmp_91255 = zp_res_49673;
            double redout_tmp_91256 = zp_res_50276;
            double redout_tmp_91257 = zp_res_50233;
            double redout_tmp_91258 = zp_res_50262;
            double redout_tmp_91259 = zp_res_50304;
            double redout_tmp_91260 = zp_res_52465;
            
            redout_88621 = redout_tmp_91252;
            redout_88622 = redout_tmp_91253;
            redout_88623 = redout_tmp_91254;
            redout_88624 = redout_tmp_91255;
            redout_88625 = redout_tmp_91256;
            redout_88626 = redout_tmp_91257;
            redout_88627 = redout_tmp_91258;
            redout_88628 = redout_tmp_91259;
            redout_88629 = redout_tmp_91260;
        }
        defunc_res_84755 = redout_88621;
        defunc_res_84756 = redout_88622;
        defunc_res_84757 = redout_88623;
        defunc_res_84758 = redout_88624;
        defunc_res_84759 = redout_88625;
        defunc_res_84760 = redout_88626;
        defunc_res_84761 = redout_88627;
        defunc_res_84762 = redout_88628;
        defunc_res_84763 = redout_88629;
        
        double zt_res_49475 = eps_34271 * defunc_res_84755;
        double defunc_res_84767;
        double defunc_res_84768;
        double defunc_res_84769;
        double defunc_res_84770;
        double redout_88645;
        double redout_88646;
        double redout_88647;
        double redout_88648;
        
        redout_88645 = 0.0;
        redout_88646 = 0.0;
        redout_88647 = 0.0;
        redout_88648 = 0.0;
        for (int64_t i_88652 = 0; i_88652 < mz2081Uz2084U_34268; i_88652++) {
            double x_72053 = ((double *) mem_89416)[eta_p_49442 * mz2081Uz2084U_34268 + i_88652];
            double log_res_72056 = futrts_log64(x_72053);
            double zt_res_72057 = zt_res_49475 * log_res_72056;
            double defunc_res_83341;
            double defunc_res_83342;
            double defunc_res_83343;
            double defunc_res_83344;
            double redout_88637;
            double redout_88638;
            double redout_88639;
            double redout_88640;
            
            redout_88637 = 0.0;
            redout_88638 = 0.0;
            redout_88639 = 0.0;
            redout_88640 = 0.0;
            for (int64_t i_88641 = 0; i_88641 < mz2081Uz2084U_34268; i_88641++) {
                double x_72110 = ((double *) mem_89437)[i_88641 * mz2081Uz2084U_34268 + i_88652];
                double zp_res_72063 = x_72110 + redout_88637;
                double zp_res_72066 = x_72110 + redout_88638;
                double zp_res_72083 = x_72110 + redout_88639;
                double zp_res_72086 = x_72110 + redout_88640;
                double redout_tmp_91280 = zp_res_72063;
                double redout_tmp_91281 = zp_res_72066;
                double redout_tmp_91282 = zp_res_72083;
                double redout_tmp_91283 = zp_res_72086;
                
                redout_88637 = redout_tmp_91280;
                redout_88638 = redout_tmp_91281;
                redout_88639 = redout_tmp_91282;
                redout_88640 = redout_tmp_91283;
            }
            defunc_res_83341 = redout_88637;
            defunc_res_83342 = redout_88638;
            defunc_res_83343 = redout_88639;
            defunc_res_83344 = redout_88640;
            
            bool zeze_res_72067 = defunc_res_83341 == 0.0;
            double klu_res_72068;
            
            if (zeze_res_72067) {
                klu_res_72068 = 0.0;
            } else {
                double zs_res_72069 = defunc_res_83341 / x_72053;
                double log_res_72070 = futrts_log64(zs_res_72069);
                double zt_res_72071 = log_res_72070 * defunc_res_83341;
                
                klu_res_72068 = zt_res_72071;
            }
            
            bool zeze_res_72072 = defunc_res_83342 == 0.0;
            double klu_res_72073;
            
            if (zeze_res_72072) {
                klu_res_72073 = 0.0;
            } else {
                double zs_res_72074 = defunc_res_83342 / x_72053;
                double log_res_72075 = futrts_log64(zs_res_72074);
                double zt_res_72076 = log_res_72075 * defunc_res_83342;
                
                klu_res_72073 = zt_res_72076;
            }
            
            double zp_res_49616 = klu_res_72068 + redout_88645;
            double zp_res_50290 = klu_res_72073 + redout_88646;
            double zp_res_50309 = x_72053 + redout_88647;
            double zp_res_52470 = x_72053 + redout_88648;
            
            ((double *) mem_89467)[i_88652] = defunc_res_83344;
            ((double *) mem_89469)[i_88652] = defunc_res_83343;
            ((double *) mem_89471)[i_88652] = zt_res_72057;
            
            double redout_tmp_91273 = zp_res_49616;
            double redout_tmp_91274 = zp_res_50290;
            double redout_tmp_91275 = zp_res_50309;
            double redout_tmp_91276 = zp_res_52470;
            
            redout_88645 = redout_tmp_91273;
            redout_88646 = redout_tmp_91274;
            redout_88647 = redout_tmp_91275;
            redout_88648 = redout_tmp_91276;
        }
        defunc_res_84767 = redout_88645;
        defunc_res_84768 = redout_88646;
        defunc_res_84769 = redout_88647;
        defunc_res_84770 = redout_88648;
        
        double zt_res_49617 = rho2_34270 * defunc_res_84767;
        double zt_res_49596 = rho1_34269 * defunc_res_84756;
        double zp_res_49641 = zt_res_49596 + zt_res_49617;
        double zt_res_49640 = eps_34271 * defunc_res_84757;
        double zp_res_49642 = zt_res_49640 + zp_res_49641;
        double defunc_0_reduce_res_84774;
        double redout_88660 = 0.0;
        
        for (int64_t i_88662 = 0; i_88662 < mz2081Uz2084U_34268; i_88662++) {
            double eta_p_58811 = ((double *) mem_89467)[i_88662];
            double defunc_0_reduce_res_83345;
            double defunc_0_reduce_res_83346;
            double redout_88656;
            double redout_88657;
            
            redout_88656 = 0.0;
            redout_88657 = 0.0;
            for (int64_t i_88658 = 0; i_88658 < mz2081Uz2084U_34268; i_88658++) {
                double eta_p_60043 = ((double *) mem_89419)[eta_p_49442 * (mz2081Uz2084U_34268 * mz2081Uz2084U_34268) + i_88662 * mz2081Uz2084U_34268 + i_88658];
                double eta_p_60044 = ((double *) mem_89467)[i_88658];
                double eta_p_60045 = ((double *) mem_89469)[i_88658];
                double zt_res_60048 = eta_p_60043 * eta_p_60043;
                double zt_res_60050 = eta_p_60045 * zt_res_60048;
                double zt_res_60055 = eta_p_60044 * zt_res_60048;
                double zp_res_58825 = zt_res_60050 + redout_88656;
                double zp_res_58839 = zt_res_60055 + redout_88657;
                double redout_tmp_91286 = zp_res_58825;
                double redout_tmp_91287 = zp_res_58839;
                
                redout_88656 = redout_tmp_91286;
                redout_88657 = redout_tmp_91287;
            }
            defunc_0_reduce_res_83345 = redout_88656;
            defunc_0_reduce_res_83346 = redout_88657;
            
            double zt_res_58841 = eta_p_58811 * defunc_0_reduce_res_83346;
            double zp_res_50175 = zt_res_58841 + redout_88660;
            
            ((double *) mem_89491)[i_88662] = defunc_0_reduce_res_83345;
            
            double redout_tmp_91284 = zp_res_50175;
            
            redout_88660 = redout_tmp_91284;
        }
        defunc_0_reduce_res_84774 = redout_88660;
        
        double defunc_0_reduce_res_84776;
        double defunc_res_84777;
        double redout_88692;
        double redout_88693;
        
        redout_88692 = 0.0;
        redout_88693 = 0.0;
        for (int64_t i_88696 = 0; i_88696 < mz2081Uz2084U_34268; i_88696++) {
            double eta_p_58508 = ((double *) mem_89434)[i_88696];
            double eta_p_58509 = ((double *) mem_89416)[eta_p_49441 * mz2081Uz2084U_34268 + i_88696];
            double log_res_58514 = futrts_log64(eta_p_58509);
            double zt_res_58516 = zt_res_49475 * log_res_58514;
            double defunc_0_reduce_res_83351;
            double defunc_0_reduce_res_83352;
            double redout_88664;
            double redout_88665;
            
            redout_88664 = 0.0;
            redout_88665 = 0.0;
            for (int64_t i_88666 = 0; i_88666 < mz2081Uz2084U_34268; i_88666++) {
                double eta_p_59868 = ((double *) mem_89419)[eta_p_49441 * (mz2081Uz2084U_34268 * mz2081Uz2084U_34268) + i_88696 * mz2081Uz2084U_34268 + i_88666];
                double eta_p_59869 = ((double *) mem_89434)[i_88666];
                double eta_p_59870 = ((double *) mem_89432)[i_88666];
                double zt_res_59873 = eta_p_59868 * eta_p_59868;
                double zt_res_59875 = eta_p_59870 * zt_res_59873;
                double zt_res_59880 = eta_p_59869 * zt_res_59873;
                double zp_res_58531 = zt_res_59875 + redout_88664;
                double zp_res_58618 = zt_res_59880 + redout_88665;
                double redout_tmp_91292 = zp_res_58531;
                double redout_tmp_91293 = zp_res_58618;
                
                redout_88664 = redout_tmp_91292;
                redout_88665 = redout_tmp_91293;
            }
            defunc_0_reduce_res_83351 = redout_88664;
            defunc_0_reduce_res_83352 = redout_88665;
            for (int64_t i_88674 = 0; i_88674 < mz2081Uz2084U_34268; i_88674++) {
                double defunc_0_reduce_res_83347;
                double defunc_0_reduce_res_83348;
                double redout_88667;
                double redout_88668;
                
                redout_88667 = 0.0;
                redout_88668 = 0.0;
                for (int64_t i_88669 = 0; i_88669 < mz2081Uz2084U_34268; i_88669++) {
                    double eta_p_59963 = ((double *) mem_89419)[eta_p_49441 * (mz2081Uz2084U_34268 * mz2081Uz2084U_34268) + i_88696 * mz2081Uz2084U_34268 + i_88669];
                    double eta_p_59964 = ((double *) mem_89437)[i_88669 * mz2081Uz2084U_34268 + i_88674];
                    double zt_res_59967 = eta_p_59963 * eta_p_59964;
                    double zp_res_59893 = zt_res_59967 + redout_88667;
                    double zp_res_59903 = zt_res_59967 + redout_88668;
                    double redout_tmp_91296 = zp_res_59893;
                    double redout_tmp_91297 = zp_res_59903;
                    
                    redout_88667 = redout_tmp_91296;
                    redout_88668 = redout_tmp_91297;
                }
                defunc_0_reduce_res_83347 = redout_88667;
                defunc_0_reduce_res_83348 = redout_88668;
                ((double *) mem_89511)[i_88674] = defunc_0_reduce_res_83348;
                ((double *) mem_89513)[i_88674] = defunc_0_reduce_res_83347;
            }
            
            double defunc_0_reduce_res_83355;
            double defunc_0_reduce_res_83356;
            double redout_88681;
            double redout_88682;
            
            redout_88681 = INFINITY;
            redout_88682 = 0.0;
            for (int64_t i_88684 = 0; i_88684 < mz2081Uz2084U_34268; i_88684++) {
                double eta_p_59907 = ((double *) mem_89437)[i_88696 * mz2081Uz2084U_34268 + i_88684];
                double eta_p_wasfree_59908 = ((double *) mem_89491)[i_88684];
                double eta_p_wasfree_59909 = ((double *) mem_89471)[i_88684];
                double defunc_0_reduce_res_83349;
                double defunc_0_reduce_res_83350;
                double redout_88677;
                double redout_88678;
                
                redout_88677 = 0.0;
                redout_88678 = 0.0;
                for (int64_t i_88679 = 0; i_88679 < mz2081Uz2084U_34268; i_88679++) {
                    double eta_p_59984 = ((double *) mem_89511)[i_88679];
                    double eta_p_59985 = ((double *) mem_89419)[eta_p_49442 * (mz2081Uz2084U_34268 * mz2081Uz2084U_34268) + i_88679 * mz2081Uz2084U_34268 + i_88684];
                    double eta_p_59986 = ((double *) mem_89513)[i_88679];
                    double zt_res_59988 = eta_p_59985 * eta_p_59986;
                    double zt_res_59990 = eta_p_59984 * eta_p_59985;
                    double zp_res_59919 = zt_res_59988 + redout_88677;
                    double zp_res_59948 = zt_res_59990 + redout_88678;
                    double redout_tmp_91301 = zp_res_59919;
                    double redout_tmp_91302 = zp_res_59948;
                    
                    redout_88677 = redout_tmp_91301;
                    redout_88678 = redout_tmp_91302;
                }
                defunc_0_reduce_res_83349 = redout_88677;
                defunc_0_reduce_res_83350 = redout_88678;
                
                double zt_res_59921 = -2.0 * defunc_0_reduce_res_83349;
                double zp_res_59923 = zt_res_59921 + defunc_0_reduce_res_83351;
                double zp_res_59925 = eta_p_wasfree_59908 + zp_res_59923;
                double zp_res_59927 = zp_res_49642 + zp_res_59925;
                double zm_res_59929 = zp_res_59927 - zt_res_58516;
                double zm_res_59931 = zm_res_59929 - eta_p_wasfree_59909;
                double zs_res_59933 = zm_res_59931 / defunc_res_84758;
                double zs_res_59935 = zs_res_59933 / neg_res_49428;
                double zm_res_59937 = safe_for_exp_34277 - zs_res_59935;
                double zt_res_59950 = eta_p_59907 * defunc_0_reduce_res_83350;
                double min_res_58599 = fmin64(zm_res_59937, redout_88681);
                double zp_res_58656 = zt_res_59950 + redout_88682;
                
                ((double *) mem_89527)[i_88684] = zs_res_59935;
                
                double redout_tmp_91298 = min_res_58599;
                double redout_tmp_91299 = zp_res_58656;
                
                redout_88681 = redout_tmp_91298;
                redout_88682 = redout_tmp_91299;
            }
            defunc_0_reduce_res_83355 = redout_88681;
            defunc_0_reduce_res_83356 = redout_88682;
            for (int64_t i_88688 = 0; i_88688 < mz2081Uz2084U_34268; i_88688++) {
                double eta_p_58602 = ((double *) mem_89527)[i_88688];
                double zp_res_58603 = eta_p_58602 + defunc_0_reduce_res_83355;
                
                ((double *) mem_89500)[i_88696 * mz2081Uz2084U_34268 + i_88688] = zp_res_58603;
            }
            
            double zt_res_58620 = eta_p_58508 * defunc_0_reduce_res_83352;
            double zp_res_50151 = zt_res_58620 + redout_88692;
            double zp_res_50218 = defunc_0_reduce_res_83356 + redout_88693;
            
            ((double *) mem_89502.mem)[i_88696] = defunc_0_reduce_res_83355;
            
            double redout_tmp_91288 = zp_res_50151;
            double redout_tmp_91289 = zp_res_50218;
            
            redout_88692 = redout_tmp_91288;
            redout_88693 = redout_tmp_91289;
        }
        defunc_0_reduce_res_84776 = redout_88692;
        defunc_res_84777 = redout_88693;
        for (int64_t i_88703 = 0; i_88703 < mz2081Uz2084U_34268; i_88703++) {
            double defunc_0_reduce_res_83359;
            double redout_88699 = INFINITY;
            
            for (int64_t i_88700 = 0; i_88700 < mz2081Uz2084U_34268; i_88700++) {
                double eta_p_60060 = ((double *) mem_89500)[i_88700 * mz2081Uz2084U_34268 + i_88703];
                double zm_res_60061 = safe_for_exp_34277 - eta_p_60060;
                double min_res_49710 = fmin64(zm_res_60061, redout_88699);
                double redout_tmp_91305 = min_res_49710;
                
                redout_88699 = redout_tmp_91305;
            }
            defunc_0_reduce_res_83359 = redout_88699;
            ((double *) mem_89550.mem)[i_88703] = defunc_0_reduce_res_83359;
        }
        for (int64_t i_88714 = 0; i_88714 < mz2081Uz2084U_34268; i_88714++) {
            double eta_p_56828 = ((double *) mem_89416)[eta_p_49441 * mz2081Uz2084U_34268 + i_88714];
            double eta_p_56829 = ((double *) mem_89502.mem)[i_88714];
            double defunc_0_reduce_res_83360;
            double redout_88706 = 0.0;
            
            for (int64_t i_88708 = 0; i_88708 < mz2081Uz2084U_34268; i_88708++) {
                double eta_p_60069 = ((double *) mem_89500)[i_88714 * mz2081Uz2084U_34268 + i_88708];
                double eta_p_wasfree_60070 = ((double *) mem_89550.mem)[i_88708];
                double zp_res_60071 = eta_p_60069 + eta_p_wasfree_60070;
                double exp_res_60073 = futrts_exp64(zp_res_60071);
                double zp_res_56845 = exp_res_60073 + redout_88706;
                
                ((double *) mem_89561.mem)[i_88714 * mz2081Uz2084U_34268 + i_88708] = exp_res_60073;
                
                double redout_tmp_91308 = zp_res_56845;
                
                redout_88706 = redout_tmp_91308;
            }
            defunc_0_reduce_res_83360 = redout_88706;
            
            double zs_res_56847 = defunc_0_reduce_res_83360 / eta_p_56828;
            double ztzt_res_56849 = fpow64(zs_res_56847, zs_res_49432);
            double zt_res_56851 = zs_res_49433 * eta_p_56829;
            double exp_res_56853 = futrts_exp64(zt_res_56851);
            double zt_res_56855 = ztzt_res_56849 * exp_res_56853;
            
            ((double *) mem_89558)[i_88714] = zt_res_56855;
        }
        
        bool defunc_0_reduce_res_84786;
        bool redout_88720 = 0;
        
        for (int64_t i_88722 = 0; i_88722 < mz2081Uz2084U_34268; i_88722++) {
            double eta_p_56721 = ((double *) mem_89416)[eta_p_49442 * mz2081Uz2084U_34268 + i_88722];
            double eta_p_56722 = ((double *) mem_89550.mem)[i_88722];
            double defunc_0_reduce_res_83362;
            double redout_88717 = 0.0;
            
            for (int64_t i_88718 = 0; i_88718 < mz2081Uz2084U_34268; i_88718++) {
                double eta_p_60078 = ((double *) mem_89558)[i_88718];
                double eta_p_60079 = ((double *) mem_89561.mem)[i_88718 * mz2081Uz2084U_34268 + i_88722];
                double zt_res_60080 = eta_p_60078 * eta_p_60079;
                double zp_res_56731 = zt_res_60080 + redout_88717;
                double redout_tmp_91312 = zp_res_56731;
                
                redout_88717 = redout_tmp_91312;
            }
            defunc_0_reduce_res_83362 = redout_88717;
            
            double zs_res_56733 = defunc_0_reduce_res_83362 / eta_p_56721;
            double ztzt_res_56735 = fpow64(zs_res_56733, zs_res_49436);
            double zt_res_56737 = zs_res_49437 * eta_p_56722;
            double exp_res_56739 = futrts_exp64(zt_res_56737);
            double zt_res_56741 = ztzt_res_56735 * exp_res_56739;
            bool zgze_res_56743 = exp_absorb_cutoff_34276 <= zt_res_56741;
            bool defunc_0_op_res_49854 = zgze_res_56743 || redout_88720;
            
            ((double *) mem_89585.mem)[i_88722] = zt_res_56741;
            
            bool redout_tmp_91310 = defunc_0_op_res_49854;
            
            redout_88720 = redout_tmp_91310;
        }
        defunc_0_reduce_res_84786 = redout_88720;
        
        bool defunc_0_reduce_res_84789;
        bool redout_88727 = 0;
        
        for (int64_t i_88729 = 0; i_88729 < mz2081Uz2084U_34268; i_88729++) {
            double eta_p_56639 = ((double *) mem_89416)[eta_p_49441 * mz2081Uz2084U_34268 + i_88729];
            double eta_p_56640 = ((double *) mem_89502.mem)[i_88729];
            double defunc_0_reduce_res_83363;
            double redout_88724 = 0.0;
            
            for (int64_t i_88725 = 0; i_88725 < mz2081Uz2084U_34268; i_88725++) {
                double eta_p_60084 = ((double *) mem_89585.mem)[i_88725];
                double eta_p_60085 = ((double *) mem_89561.mem)[i_88729 * mz2081Uz2084U_34268 + i_88725];
                double zt_res_60086 = eta_p_60084 * eta_p_60085;
                double zp_res_56649 = zt_res_60086 + redout_88724;
                double redout_tmp_91315 = zp_res_56649;
                
                redout_88724 = redout_tmp_91315;
            }
            defunc_0_reduce_res_83363 = redout_88724;
            
            double zs_res_56651 = defunc_0_reduce_res_83363 / eta_p_56639;
            double ztzt_res_56653 = fpow64(zs_res_56651, zs_res_49432);
            double zt_res_56655 = zs_res_49433 * eta_p_56640;
            double exp_res_56657 = futrts_exp64(zt_res_56655);
            double zt_res_56659 = ztzt_res_56653 * exp_res_56657;
            bool zgze_res_56661 = exp_absorb_cutoff_34276 <= zt_res_56659;
            bool defunc_0_op_res_49811 = zgze_res_56661 || redout_88727;
            
            ((double *) mem_89593.mem)[i_88729] = zt_res_56659;
            
            bool redout_tmp_91313 = defunc_0_op_res_49811;
            
            redout_88727 = redout_tmp_91313;
        }
        defunc_0_reduce_res_84789 = redout_88727;
        
        bool x_91032 = !defunc_0_reduce_res_84789;
        bool defunc_0_reduce_res_83364;
        
        if (x_91032) {
            bool x_91034;
            bool redout_88731 = 0;
            
            for (int64_t i_88732 = 0; i_88732 < mz2081Uz2084U_34268; i_88732++) {
                double eta_p_60090 = ((double *) mem_89593.mem)[i_88732];
                bool zlze_res_60091 = eta_p_60090 <= zs_res_49813;
                bool defunc_0_op_res_49821 = zlze_res_60091 || redout_88731;
                bool redout_tmp_91316 = defunc_0_op_res_49821;
                
                redout_88731 = redout_tmp_91316;
            }
            x_91034 = redout_88731;
            defunc_0_reduce_res_83364 = x_91034;
        } else {
            defunc_0_reduce_res_83364 = 0;
        }
        
        bool cond_49812 = defunc_0_reduce_res_83364 || defunc_0_reduce_res_84789;
        
        if (cond_49812) {
            if (memblock_alloc(ctx, &mem_89601, bytes_89422, "mem_89601")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc(ctx, &mem_89603, bytes_89422, "mem_89603")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc(ctx, &mem_89606, bytes_89436, "mem_89606")) {
                err = 1;
                goto cleanup;
            }
            for (int64_t i_88743 = 0; i_88743 < mz2081Uz2084U_34268; i_88743++) {
                double eta_p_83381 = ((double *) mem_89593.mem)[i_88743];
                double eta_p_83382 = ((double *) mem_89502.mem)[i_88743];
                bool zgze_res_83384 = exp_absorb_cutoff_34276 <= eta_p_83381;
                bool zl_res_83385 = eta_p_83381 < zs_res_49813;
                bool x_83386 = !zgze_res_83384;
                bool y_83387 = zl_res_83385 && x_83386;
                bool cond_83388 = zgze_res_83384 || y_83387;
                int64_t binop_y_89625 = mz2081Uz2084U_34268 * i_88743;
                int64_t ext_89628;
                
                if (cond_83388) {
                    ext_89628 = (int64_t) 0;
                } else {
                    ext_89628 = binop_y_89625;
                }
                
                double rescale_res_83389;
                double rescale_res_83390;
                
                if (cond_83388) {
                    double log_res_83392 = futrts_log64(eta_p_83381);
                    double sqrt_res_83393 = futrts_sqrt64(eta_p_83381);
                    double zs_res_83394 = log_res_83392 / 2.0;
                    double zp_res_83395 = eta_p_83382 + zs_res_83394;
                    
                    if (memblock_alloc(ctx, &mem_89618, bytes_89422, "mem_89618")) {
                        err = 1;
                        goto cleanup;
                    }
                    for (int64_t i_88735 = 0; i_88735 < mz2081Uz2084U_34268; i_88735++) {
                        double eta_p_83397 = ((double *) mem_89561.mem)[i_88743 * mz2081Uz2084U_34268 + i_88735];
                        double zt_res_83398 = sqrt_res_83393 * eta_p_83397;
                        
                        ((double *) mem_89618.mem)[i_88735] = zt_res_83398;
                    }
                    if (memblock_set(ctx, &ext_mem_89629, &mem_89618, "mem_89618") != 0)
                        return 1;
                    rescale_res_83389 = sqrt_res_83393;
                    rescale_res_83390 = zp_res_83395;
                } else {
                    if (memblock_set(ctx, &ext_mem_89629, &mem_89561, "mem_89561") != 0)
                        return 1;
                    rescale_res_83389 = eta_p_83381;
                    rescale_res_83390 = eta_p_83382;
                }
                ((double *) mem_89601.mem)[i_88743] = rescale_res_83389;
                ((double *) mem_89603.mem)[i_88743] = rescale_res_83390;
                lmad_copy_8b(ctx, 1, (uint64_t *) mem_89606.mem, i_88743 * mz2081Uz2084U_34268, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_89629.mem, ext_89628, (int64_t []) {(int64_t) 1}, (int64_t []) {mz2081Uz2084U_34268});
                if (memblock_unref(ctx, &ext_mem_89629, "ext_mem_89629") != 0)
                    return 1;
            }
            if (memblock_set(ctx, &ext_mem_89649, &mem_89601, "mem_89601") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_89646, &mem_89603, "mem_89603") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_89643, &mem_89606, "mem_89606") != 0)
                return 1;
        } else {
            if (memblock_set(ctx, &ext_mem_89649, &mem_89593, "mem_89593") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_89646, &mem_89502, "mem_89502") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_89643, &mem_89561, "mem_89561") != 0)
                return 1;
        }
        
        bool x_91028 = !defunc_0_reduce_res_84786;
        bool defunc_0_reduce_res_83403;
        
        if (x_91028) {
            bool x_91030;
            bool redout_88747 = 0;
            
            for (int64_t i_88748 = 0; i_88748 < mz2081Uz2084U_34268; i_88748++) {
                double eta_p_60133 = ((double *) mem_89585.mem)[i_88748];
                bool zlze_res_60134 = eta_p_60133 <= zs_res_49813;
                bool defunc_0_op_res_49864 = zlze_res_60134 || redout_88747;
                bool redout_tmp_91321 = defunc_0_op_res_49864;
                
                redout_88747 = redout_tmp_91321;
            }
            x_91030 = redout_88747;
            defunc_0_reduce_res_83403 = x_91030;
        } else {
            defunc_0_reduce_res_83403 = 0;
        }
        
        bool cond_49855 = defunc_0_reduce_res_83403 || defunc_0_reduce_res_84786;
        int64_t ext_89691;
        
        if (cond_49855) {
            ext_89691 = (int64_t) 1;
        } else {
            ext_89691 = mz2081Uz2084U_34268;
        }
        
        int64_t ext_89690;
        
        if (cond_49855) {
            ext_89690 = mz2081Uz2084U_34268;
        } else {
            ext_89690 = (int64_t) 1;
        }
        if (cond_49855) {
            if (memblock_alloc(ctx, &mem_89651, bytes_89422, "mem_89651")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc(ctx, &mem_89653, bytes_89422, "mem_89653")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc(ctx, &mem_89656, bytes_89436, "mem_89656")) {
                err = 1;
                goto cleanup;
            }
            for (int64_t i_88759 = 0; i_88759 < mz2081Uz2084U_34268; i_88759++) {
                double eta_p_83422 = ((double *) mem_89585.mem)[i_88759];
                double eta_p_83423 = ((double *) mem_89550.mem)[i_88759];
                bool zgze_res_83425 = exp_absorb_cutoff_34276 <= eta_p_83422;
                bool zl_res_83426 = eta_p_83422 < zs_res_49813;
                bool x_83427 = !zgze_res_83425;
                bool y_83428 = zl_res_83426 && x_83427;
                bool cond_83429 = zgze_res_83425 || y_83428;
                int64_t ext_89678;
                
                if (cond_83429) {
                    ext_89678 = (int64_t) 0;
                } else {
                    ext_89678 = i_88759;
                }
                
                int64_t ext_89677;
                
                if (cond_83429) {
                    ext_89677 = (int64_t) 1;
                } else {
                    ext_89677 = mz2081Uz2084U_34268;
                }
                
                double rescale_res_83430;
                double rescale_res_83431;
                
                if (cond_83429) {
                    double log_res_83433 = futrts_log64(eta_p_83422);
                    double sqrt_res_83434 = futrts_sqrt64(eta_p_83422);
                    double zs_res_83435 = log_res_83433 / 2.0;
                    double zp_res_83436 = eta_p_83423 + zs_res_83435;
                    
                    if (memblock_alloc(ctx, &mem_89668, bytes_89422, "mem_89668")) {
                        err = 1;
                        goto cleanup;
                    }
                    for (int64_t i_88751 = 0; i_88751 < mz2081Uz2084U_34268; i_88751++) {
                        double eta_p_83438 = ((double *) ext_mem_89643.mem)[i_88751 * mz2081Uz2084U_34268 + i_88759];
                        double zt_res_83439 = sqrt_res_83434 * eta_p_83438;
                        
                        ((double *) mem_89668.mem)[i_88751] = zt_res_83439;
                    }
                    if (memblock_set(ctx, &ext_mem_89679, &mem_89668, "mem_89668") != 0)
                        return 1;
                    rescale_res_83430 = sqrt_res_83434;
                    rescale_res_83431 = zp_res_83436;
                } else {
                    if (memblock_set(ctx, &ext_mem_89679, &ext_mem_89643, "ext_mem_89643") != 0)
                        return 1;
                    rescale_res_83430 = eta_p_83422;
                    rescale_res_83431 = eta_p_83423;
                }
                ((double *) mem_89651.mem)[i_88759] = rescale_res_83430;
                ((double *) mem_89653.mem)[i_88759] = rescale_res_83431;
                lmad_copy_8b(ctx, 1, (uint64_t *) mem_89656.mem, i_88759 * mz2081Uz2084U_34268, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_89679.mem, ext_89678, (int64_t []) {ext_89677}, (int64_t []) {mz2081Uz2084U_34268});
                if (memblock_unref(ctx, &ext_mem_89679, "ext_mem_89679") != 0)
                    return 1;
            }
            if (memblock_set(ctx, &ext_mem_89699, &mem_89651, "mem_89651") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_89696, &mem_89653, "mem_89653") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_89693, &mem_89656, "mem_89656") != 0)
                return 1;
        } else {
            if (memblock_set(ctx, &ext_mem_89699, &mem_89585, "mem_89585") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_89696, &mem_89550, "mem_89550") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_89693, &ext_mem_89643, "ext_mem_89643") != 0)
                return 1;
        }
        if (memblock_unref(ctx, &ext_mem_89643, "ext_mem_89643") != 0)
            return 1;
        
        double defunc_0_reduce_res_84791;
        double redout_88763 = 0.0;
        
        for (int64_t i_88764 = 0; i_88764 < mz2081Uz2084U_34268; i_88764++) {
            double eta_p_56565 = ((double *) mem_89558)[i_88764];
            double eta_p_56566 = ((double *) ext_mem_89649.mem)[i_88764];
            double zs_res_56567 = eta_p_56565 / eta_p_56566;
            double zm_res_56569 = zs_res_56567 - 1.0;
            double abs_res_56571 = fabs64(zm_res_56569);
            double max_res_49906 = fmax64(abs_res_56571, redout_88763);
            double redout_tmp_91326 = max_res_49906;
            
            redout_88763 = redout_tmp_91326;
        }
        defunc_0_reduce_res_84791 = redout_88763;
        
        bool zgze_res_49907 = tol_sinkhorn_34278 <= defunc_0_reduce_res_84791;
        int64_t ext_89842;
        int64_t ext_89841;
        int64_t ext_89840;
        bool algo3_core_loop_res_49908;
        bool loop_while_49914;
        int64_t ctx_param_ext_89700;
        int64_t ctx_param_ext_89701;
        int64_t ctx_param_ext_89702;
        
        if (memblock_set(ctx, &mem_param_89703, &ext_mem_89693, "ext_mem_89693") != 0)
            return 1;
        if (memblock_set(ctx, &mem_param_89706, &ext_mem_89649, "ext_mem_89649") != 0)
            return 1;
        if (memblock_set(ctx, &mem_param_89709, &ext_mem_89699, "ext_mem_89699") != 0)
            return 1;
        if (memblock_set(ctx, &mem_param_89712, &ext_mem_89646, "ext_mem_89646") != 0)
            return 1;
        if (memblock_set(ctx, &mem_param_89715, &ext_mem_89696, "ext_mem_89696") != 0)
            return 1;
        ctx_param_ext_89700 = (int64_t) 0;
        ctx_param_ext_89701 = ext_89691;
        ctx_param_ext_89702 = ext_89690;
        loop_while_49914 = zgze_res_49907;
        while (loop_while_49914) {
            if (memblock_alloc(ctx, &mem_89717, bytes_89422, "mem_89717")) {
                err = 1;
                goto cleanup;
            }
            
            bool defunc_0_reduce_res_83528;
            bool redout_88768 = 0;
            
            for (int64_t i_88770 = 0; i_88770 < mz2081Uz2084U_34268; i_88770++) {
                double eta_p_60345 = ((double *) mem_89416)[eta_p_49442 * mz2081Uz2084U_34268 + i_88770];
                double eta_p_60346 = ((double *) mem_param_89715.mem)[i_88770];
                double defunc_0_reduce_res_83445;
                double redout_88765 = 0.0;
                
                for (int64_t i_88766 = 0; i_88766 < mz2081Uz2084U_34268; i_88766++) {
                    double eta_p_60370 = ((double *) mem_param_89706.mem)[i_88766];
                    double eta_p_60371 = ((double *) mem_param_89703.mem)[ctx_param_ext_89700 + (i_88766 * ctx_param_ext_89701 + i_88770 * ctx_param_ext_89702)];
                    double zt_res_60372 = eta_p_60370 * eta_p_60371;
                    double zp_res_60355 = zt_res_60372 + redout_88765;
                    double redout_tmp_91343 = zp_res_60355;
                    
                    redout_88765 = redout_tmp_91343;
                }
                defunc_0_reduce_res_83445 = redout_88765;
                
                double zs_res_60357 = defunc_0_reduce_res_83445 / eta_p_60345;
                double ztzt_res_60359 = fpow64(zs_res_60357, zs_res_49436);
                double zt_res_60361 = zs_res_49437 * eta_p_60346;
                double exp_res_60363 = futrts_exp64(zt_res_60361);
                double zt_res_60365 = ztzt_res_60359 * exp_res_60363;
                bool zgze_res_60367 = exp_absorb_cutoff_34276 <= zt_res_60365;
                bool defunc_0_op_res_50027 = zgze_res_60367 || redout_88768;
                
                ((double *) mem_89717.mem)[i_88770] = zt_res_60365;
                
                bool redout_tmp_91341 = defunc_0_op_res_50027;
                
                redout_88768 = redout_tmp_91341;
            }
            defunc_0_reduce_res_83528 = redout_88768;
            if (memblock_alloc(ctx, &mem_89725, bytes_89422, "mem_89725")) {
                err = 1;
                goto cleanup;
            }
            
            bool defunc_0_reduce_res_83531;
            bool redout_88775 = 0;
            
            for (int64_t i_88777 = 0; i_88777 < mz2081Uz2084U_34268; i_88777++) {
                double eta_p_60263 = ((double *) mem_89416)[eta_p_49441 * mz2081Uz2084U_34268 + i_88777];
                double eta_p_60264 = ((double *) mem_param_89712.mem)[i_88777];
                double defunc_0_reduce_res_83446;
                double redout_88772 = 0.0;
                
                for (int64_t i_88773 = 0; i_88773 < mz2081Uz2084U_34268; i_88773++) {
                    double eta_p_60376 = ((double *) mem_89717.mem)[i_88773];
                    double eta_p_60377 = ((double *) mem_param_89703.mem)[ctx_param_ext_89700 + (i_88777 * ctx_param_ext_89701 + i_88773 * ctx_param_ext_89702)];
                    double zt_res_60378 = eta_p_60376 * eta_p_60377;
                    double zp_res_60273 = zt_res_60378 + redout_88772;
                    double redout_tmp_91346 = zp_res_60273;
                    
                    redout_88772 = redout_tmp_91346;
                }
                defunc_0_reduce_res_83446 = redout_88772;
                
                double zs_res_60275 = defunc_0_reduce_res_83446 / eta_p_60263;
                double ztzt_res_60277 = fpow64(zs_res_60275, zs_res_49432);
                double zt_res_60279 = zs_res_49433 * eta_p_60264;
                double exp_res_60281 = futrts_exp64(zt_res_60279);
                double zt_res_60283 = ztzt_res_60277 * exp_res_60281;
                bool zgze_res_60285 = exp_absorb_cutoff_34276 <= zt_res_60283;
                bool defunc_0_op_res_49984 = zgze_res_60285 || redout_88775;
                
                ((double *) mem_89725.mem)[i_88777] = zt_res_60283;
                
                bool redout_tmp_91344 = defunc_0_op_res_49984;
                
                redout_88775 = redout_tmp_91344;
            }
            defunc_0_reduce_res_83531 = redout_88775;
            
            bool x_91024 = !defunc_0_reduce_res_83531;
            bool defunc_0_reduce_res_83447;
            
            if (x_91024) {
                bool x_91026;
                bool redout_88779 = 0;
                
                for (int64_t i_88780 = 0; i_88780 < mz2081Uz2084U_34268; i_88780++) {
                    double eta_p_60382 = ((double *) mem_89725.mem)[i_88780];
                    bool zlze_res_60383 = eta_p_60382 <= zs_res_49813;
                    bool defunc_0_op_res_49994 = zlze_res_60383 || redout_88779;
                    bool redout_tmp_91347 = defunc_0_op_res_49994;
                    
                    redout_88779 = redout_tmp_91347;
                }
                x_91026 = redout_88779;
                defunc_0_reduce_res_83447 = x_91026;
            } else {
                defunc_0_reduce_res_83447 = 0;
            }
            
            bool cond_49985 = defunc_0_reduce_res_83447 || defunc_0_reduce_res_83531;
            int64_t ext_89774;
            
            if (cond_49985) {
                ext_89774 = (int64_t) 0;
            } else {
                ext_89774 = ctx_param_ext_89700;
            }
            
            int64_t ext_89773;
            
            if (cond_49985) {
                ext_89773 = mz2081Uz2084U_34268;
            } else {
                ext_89773 = ctx_param_ext_89701;
            }
            
            int64_t ext_89772;
            
            if (cond_49985) {
                ext_89772 = (int64_t) 1;
            } else {
                ext_89772 = ctx_param_ext_89702;
            }
            if (cond_49985) {
                if (memblock_alloc(ctx, &mem_89733, bytes_89422, "mem_89733")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_89735, bytes_89422, "mem_89735")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_89738, bytes_89436, "mem_89738")) {
                    err = 1;
                    goto cleanup;
                }
                for (int64_t i_88791 = 0; i_88791 < mz2081Uz2084U_34268; i_88791++) {
                    double eta_p_83464 = ((double *) mem_89725.mem)[i_88791];
                    double eta_p_83465 = ((double *) mem_param_89712.mem)[i_88791];
                    bool zgze_res_83467 = exp_absorb_cutoff_34276 <= eta_p_83464;
                    bool zl_res_83468 = eta_p_83464 < zs_res_49813;
                    bool x_83469 = !zgze_res_83467;
                    bool y_83470 = zl_res_83468 && x_83469;
                    bool cond_83471 = zgze_res_83467 || y_83470;
                    int64_t binop_y_89757 = i_88791 * ctx_param_ext_89701;
                    int64_t lmad_ext_89758 = ctx_param_ext_89700 + binop_y_89757;
                    int64_t ext_89760;
                    
                    if (cond_83471) {
                        ext_89760 = (int64_t) 0;
                    } else {
                        ext_89760 = lmad_ext_89758;
                    }
                    
                    int64_t ext_89759;
                    
                    if (cond_83471) {
                        ext_89759 = (int64_t) 1;
                    } else {
                        ext_89759 = ctx_param_ext_89702;
                    }
                    
                    double rescale_res_83472;
                    double rescale_res_83473;
                    
                    if (cond_83471) {
                        double log_res_83475 = futrts_log64(eta_p_83464);
                        double sqrt_res_83476 = futrts_sqrt64(eta_p_83464);
                        double zs_res_83477 = log_res_83475 / 2.0;
                        double zp_res_83478 = eta_p_83465 + zs_res_83477;
                        
                        if (memblock_alloc(ctx, &mem_89750, bytes_89422, "mem_89750")) {
                            err = 1;
                            goto cleanup;
                        }
                        for (int64_t i_88783 = 0; i_88783 < mz2081Uz2084U_34268; i_88783++) {
                            double eta_p_83480 = ((double *) mem_param_89703.mem)[ctx_param_ext_89700 + (i_88791 * ctx_param_ext_89701 + i_88783 * ctx_param_ext_89702)];
                            double zt_res_83481 = sqrt_res_83476 * eta_p_83480;
                            
                            ((double *) mem_89750.mem)[i_88783] = zt_res_83481;
                        }
                        if (memblock_set(ctx, &ext_mem_89761, &mem_89750, "mem_89750") != 0)
                            return 1;
                        rescale_res_83472 = sqrt_res_83476;
                        rescale_res_83473 = zp_res_83478;
                    } else {
                        if (memblock_set(ctx, &ext_mem_89761, &mem_param_89703, "mem_param_89703") != 0)
                            return 1;
                        rescale_res_83472 = eta_p_83464;
                        rescale_res_83473 = eta_p_83465;
                    }
                    ((double *) mem_89733.mem)[i_88791] = rescale_res_83472;
                    ((double *) mem_89735.mem)[i_88791] = rescale_res_83473;
                    lmad_copy_8b(ctx, 1, (uint64_t *) mem_89738.mem, i_88791 * mz2081Uz2084U_34268, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_89761.mem, ext_89760, (int64_t []) {ext_89759}, (int64_t []) {mz2081Uz2084U_34268});
                    if (memblock_unref(ctx, &ext_mem_89761, "ext_mem_89761") != 0)
                        return 1;
                }
                if (memblock_set(ctx, &ext_mem_89781, &mem_89733, "mem_89733") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89778, &mem_89735, "mem_89735") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89775, &mem_89738, "mem_89738") != 0)
                    return 1;
            } else {
                if (memblock_set(ctx, &ext_mem_89781, &mem_89725, "mem_89725") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89778, &mem_param_89712, "mem_param_89712") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89775, &mem_param_89703, "mem_param_89703") != 0)
                    return 1;
            }
            if (memblock_unref(ctx, &mem_89725, "mem_89725") != 0)
                return 1;
            
            bool x_91104 = !defunc_0_reduce_res_83528;
            bool defunc_0_reduce_res_83486;
            
            if (x_91104) {
                bool x_91106;
                bool redout_88795 = 0;
                
                for (int64_t i_88796 = 0; i_88796 < mz2081Uz2084U_34268; i_88796++) {
                    double eta_p_60425 = ((double *) mem_89717.mem)[i_88796];
                    bool zlze_res_60426 = eta_p_60425 <= zs_res_49813;
                    bool defunc_0_op_res_50037 = zlze_res_60426 || redout_88795;
                    bool redout_tmp_91352 = defunc_0_op_res_50037;
                    
                    redout_88795 = redout_tmp_91352;
                }
                x_91106 = redout_88795;
                defunc_0_reduce_res_83486 = x_91106;
            } else {
                defunc_0_reduce_res_83486 = 0;
            }
            
            bool cond_50028 = defunc_0_reduce_res_83486 || defunc_0_reduce_res_83528;
            int64_t ext_89824;
            
            if (cond_50028) {
                ext_89824 = (int64_t) 0;
            } else {
                ext_89824 = ext_89774;
            }
            
            int64_t ext_89823;
            
            if (cond_50028) {
                ext_89823 = (int64_t) 1;
            } else {
                ext_89823 = ext_89773;
            }
            
            int64_t ext_89822;
            
            if (cond_50028) {
                ext_89822 = mz2081Uz2084U_34268;
            } else {
                ext_89822 = ext_89772;
            }
            if (cond_50028) {
                if (memblock_alloc(ctx, &mem_89783, bytes_89422, "mem_89783")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_89785, bytes_89422, "mem_89785")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_89788, bytes_89436, "mem_89788")) {
                    err = 1;
                    goto cleanup;
                }
                for (int64_t i_88807 = 0; i_88807 < mz2081Uz2084U_34268; i_88807++) {
                    double eta_p_83505 = ((double *) mem_89717.mem)[i_88807];
                    double eta_p_83506 = ((double *) mem_param_89715.mem)[i_88807];
                    bool zgze_res_83508 = exp_absorb_cutoff_34276 <= eta_p_83505;
                    bool zl_res_83509 = eta_p_83505 < zs_res_49813;
                    bool x_83510 = !zgze_res_83508;
                    bool y_83511 = zl_res_83509 && x_83510;
                    bool cond_83512 = zgze_res_83508 || y_83511;
                    int64_t binop_y_89807 = i_88807 * ext_89772;
                    int64_t lmad_ext_89808 = ext_89774 + binop_y_89807;
                    int64_t ext_89810;
                    
                    if (cond_83512) {
                        ext_89810 = (int64_t) 0;
                    } else {
                        ext_89810 = lmad_ext_89808;
                    }
                    
                    int64_t ext_89809;
                    
                    if (cond_83512) {
                        ext_89809 = (int64_t) 1;
                    } else {
                        ext_89809 = ext_89773;
                    }
                    
                    double rescale_res_83513;
                    double rescale_res_83514;
                    
                    if (cond_83512) {
                        double log_res_83516 = futrts_log64(eta_p_83505);
                        double sqrt_res_83517 = futrts_sqrt64(eta_p_83505);
                        double zs_res_83518 = log_res_83516 / 2.0;
                        double zp_res_83519 = eta_p_83506 + zs_res_83518;
                        
                        if (memblock_alloc(ctx, &mem_89800, bytes_89422, "mem_89800")) {
                            err = 1;
                            goto cleanup;
                        }
                        for (int64_t i_88799 = 0; i_88799 < mz2081Uz2084U_34268; i_88799++) {
                            double eta_p_83521 = ((double *) ext_mem_89775.mem)[ext_89774 + (i_88799 * ext_89773 + i_88807 * ext_89772)];
                            double zt_res_83522 = sqrt_res_83517 * eta_p_83521;
                            
                            ((double *) mem_89800.mem)[i_88799] = zt_res_83522;
                        }
                        if (memblock_set(ctx, &ext_mem_89811, &mem_89800, "mem_89800") != 0)
                            return 1;
                        rescale_res_83513 = sqrt_res_83517;
                        rescale_res_83514 = zp_res_83519;
                    } else {
                        if (memblock_set(ctx, &ext_mem_89811, &ext_mem_89775, "ext_mem_89775") != 0)
                            return 1;
                        rescale_res_83513 = eta_p_83505;
                        rescale_res_83514 = eta_p_83506;
                    }
                    ((double *) mem_89783.mem)[i_88807] = rescale_res_83513;
                    ((double *) mem_89785.mem)[i_88807] = rescale_res_83514;
                    lmad_copy_8b(ctx, 1, (uint64_t *) mem_89788.mem, i_88807 * mz2081Uz2084U_34268, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_89811.mem, ext_89810, (int64_t []) {ext_89809}, (int64_t []) {mz2081Uz2084U_34268});
                    if (memblock_unref(ctx, &ext_mem_89811, "ext_mem_89811") != 0)
                        return 1;
                }
                if (memblock_set(ctx, &ext_mem_89831, &mem_89783, "mem_89783") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89828, &mem_89785, "mem_89785") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89825, &mem_89788, "mem_89788") != 0)
                    return 1;
            } else {
                if (memblock_set(ctx, &ext_mem_89831, &mem_89717, "mem_89717") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89828, &mem_param_89715, "mem_param_89715") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89825, &ext_mem_89775, "ext_mem_89775") != 0)
                    return 1;
            }
            if (memblock_unref(ctx, &mem_89717, "mem_89717") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_89775, "ext_mem_89775") != 0)
                return 1;
            
            double defunc_0_reduce_res_83533;
            double redout_88811 = 0.0;
            
            for (int64_t i_88812 = 0; i_88812 < mz2081Uz2084U_34268; i_88812++) {
                double eta_p_60189 = ((double *) mem_param_89706.mem)[i_88812];
                double eta_p_60190 = ((double *) ext_mem_89781.mem)[i_88812];
                double zs_res_60191 = eta_p_60189 / eta_p_60190;
                double zm_res_60193 = zs_res_60191 - 1.0;
                double abs_res_60195 = fabs64(zm_res_60193);
                double max_res_50079 = fmax64(abs_res_60195, redout_88811);
                double redout_tmp_91357 = max_res_50079;
                
                redout_88811 = redout_tmp_91357;
            }
            defunc_0_reduce_res_83533 = redout_88811;
            
            bool zgze_res_50080 = tol_sinkhorn_34278 <= defunc_0_reduce_res_83533;
            
            if (memblock_set(ctx, &mem_param_tmp_91327, &ext_mem_89825, "ext_mem_89825") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_tmp_91328, &ext_mem_89781, "ext_mem_89781") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_tmp_91329, &ext_mem_89831, "ext_mem_89831") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_tmp_91330, &ext_mem_89778, "ext_mem_89778") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_tmp_91331, &ext_mem_89828, "ext_mem_89828") != 0)
                return 1;
            
            int64_t ctx_param_ext_tmp_91332 = ext_89824;
            int64_t ctx_param_ext_tmp_91333 = ext_89823;
            int64_t ctx_param_ext_tmp_91334 = ext_89822;
            bool loop_while_tmp_91335 = zgze_res_50080;
            
            if (memblock_set(ctx, &mem_param_89703, &mem_param_tmp_91327, "mem_param_tmp_91327") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_89706, &mem_param_tmp_91328, "mem_param_tmp_91328") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_89709, &mem_param_tmp_91329, "mem_param_tmp_91329") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_89712, &mem_param_tmp_91330, "mem_param_tmp_91330") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_89715, &mem_param_tmp_91331, "mem_param_tmp_91331") != 0)
                return 1;
            ctx_param_ext_89700 = ctx_param_ext_tmp_91332;
            ctx_param_ext_89701 = ctx_param_ext_tmp_91333;
            ctx_param_ext_89702 = ctx_param_ext_tmp_91334;
            loop_while_49914 = loop_while_tmp_91335;
        }
        if (memblock_set(ctx, &ext_mem_89847, &mem_param_89703, "mem_param_89703") != 0)
            return 1;
        if (memblock_set(ctx, &ext_mem_89846, &mem_param_89706, "mem_param_89706") != 0)
            return 1;
        if (memblock_set(ctx, &ext_mem_89845, &mem_param_89709, "mem_param_89709") != 0)
            return 1;
        if (memblock_set(ctx, &ext_mem_89844, &mem_param_89712, "mem_param_89712") != 0)
            return 1;
        if (memblock_set(ctx, &ext_mem_89843, &mem_param_89715, "mem_param_89715") != 0)
            return 1;
        ext_89842 = ctx_param_ext_89700;
        ext_89841 = ctx_param_ext_89701;
        ext_89840 = ctx_param_ext_89702;
        algo3_core_loop_res_49908 = loop_while_49914;
        if (memblock_unref(ctx, &ext_mem_89646, "ext_mem_89646") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89649, "ext_mem_89649") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89693, "ext_mem_89693") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89696, "ext_mem_89696") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89699, "ext_mem_89699") != 0)
            return 1;
        
        double defunc_res_84792;
        double redout_88819 = 0.0;
        
        for (int64_t i_88821 = 0; i_88821 < mz2081Uz2084U_34268; i_88821++) {
            double eta_p_78936 = ((double *) ext_mem_89846.mem)[i_88821];
            double defunc_res_83534;
            double redout_88814 = 0.0;
            
            for (int64_t i_88816 = 0; i_88816 < mz2081Uz2084U_34268; i_88816++) {
                double eta_p_79151 = ((double *) ext_mem_89847.mem)[ext_89842 + (i_88821 * ext_89841 + i_88816 * ext_89840)];
                double eta_p_wasfree_79152 = ((double *) ext_mem_89845.mem)[i_88816];
                double zt_res_79153 = eta_p_78936 * eta_p_79151;
                double zt_res_79154 = eta_p_wasfree_79152 * zt_res_79153;
                double zp_res_78947 = zt_res_79154 + redout_88814;
                
                ((double *) mem_89850)[i_88821 * mz2081Uz2084U_34268 + i_88816] = zt_res_79154;
                
                double redout_tmp_91360 = zp_res_78947;
                
                redout_88814 = redout_tmp_91360;
            }
            defunc_res_83534 = redout_88814;
            
            double zp_res_50106 = defunc_res_83534 + redout_88819;
            double redout_tmp_91358 = zp_res_50106;
            
            redout_88819 = redout_tmp_91358;
        }
        defunc_res_84792 = redout_88819;
        if (memblock_unref(ctx, &ext_mem_89845, "ext_mem_89845") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89846, "ext_mem_89846") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89847, "ext_mem_89847") != 0)
            return 1;
        
        double zs_res_50107 = defunc_res_84758 / defunc_res_84792;
        double sqrt_res_50108 = futrts_sqrt64(zs_res_50107);
        bool defunc_0_reduce_comm_res_84794;
        bool redout_88829 = 0;
        
        for (int64_t i_88831 = 0; i_88831 < mz2081Uz2084U_34268; i_88831++) {
            bool defunc_0_reduce_comm_res_83536;
            bool redout_88824 = 0;
            
            for (int64_t i_88826 = 0; i_88826 < mz2081Uz2084U_34268; i_88826++) {
                double eta_p_60584 = ((double *) mem_89850)[i_88831 * mz2081Uz2084U_34268 + i_88826];
                double eta_p_60585 = ((double *) mem_89437)[i_88831 * mz2081Uz2084U_34268 + i_88826];
                double zt_res_60586 = sqrt_res_50108 * eta_p_60584;
                double zt_res_60588 = zp_res_49429 * eta_p_60585;
                bool zgze_res_60589 = zt_res_60586 <= zt_res_60588;
                double zt_res_60590 = zp_res_49429 * zt_res_60586;
                bool zgze_res_60591 = eta_p_60585 <= zt_res_60590;
                bool x_60592 = zgze_res_60589 && zgze_res_60591;
                bool not_res_60593 = !x_60592;
                bool defunc_0_op_res_56529 = not_res_60593 || redout_88824;
                
                ((double *) mem_89869.mem)[i_88831 * mz2081Uz2084U_34268 + i_88826] = zt_res_60586;
                
                bool redout_tmp_91364 = defunc_0_op_res_56529;
                
                redout_88824 = redout_tmp_91364;
            }
            defunc_0_reduce_comm_res_83536 = redout_88824;
            
            bool defunc_0_op_res_50341 = defunc_0_reduce_comm_res_83536 || redout_88829;
            bool redout_tmp_91362 = defunc_0_op_res_50341;
            
            redout_88829 = redout_tmp_91362;
        }
        defunc_0_reduce_comm_res_84794 = redout_88829;
        
        double zt_res_50219 = -2.0 * defunc_res_84777;
        double zp_res_50220 = zt_res_50219 + defunc_0_reduce_res_84776;
        double zp_res_50221 = zp_res_50220 + defunc_0_reduce_res_84774;
        double zt_res_50263 = eps_34271 * defunc_res_84761;
        double zt_res_50277 = rho1_34269 * defunc_res_84759;
        double zt_res_50291 = rho2_34270 * defunc_res_84768;
        double zp_res_50292 = zt_res_50263 + zt_res_50277;
        double zp_res_50293 = zt_res_50291 + zp_res_50292;
        double zt_res_50294 = 2.0 * zp_res_50293;
        double zt_res_50295 = zt_res_50294 * defunc_res_84760;
        double zp_res_50296 = zp_res_50221 + zt_res_50295;
        double zt_res_50297 = defunc_res_84760 * defunc_res_84760;
        double zt_res_50298 = zp_res_49438 * zt_res_50297;
        double zm_res_50299 = zp_res_50296 - zt_res_50298;
        double zt_res_50310 = defunc_res_84762 * defunc_res_84769;
        double zt_res_50311 = rho1_34269 * defunc_res_84762;
        double zt_res_50312 = zt_res_50311 * defunc_res_84762;
        double zt_res_50313 = rho2_34270 * defunc_res_84769;
        double zt_res_50314 = zt_res_50313 * defunc_res_84769;
        double zp_res_50315 = zt_res_50312 + zt_res_50314;
        double zt_res_50316 = eps_34271 * zt_res_50310;
        double zt_res_50317 = zt_res_50310 * zt_res_50316;
        double zp_res_50318 = zp_res_50315 + zt_res_50317;
        double zp_res_50319 = zm_res_50299 + zp_res_50318;
        bool defunc_0_reduce_res_83540;
        
        if (defunc_0_reduce_comm_res_84794) {
            bool x_91018;
            bool redout_88835 = 0;
            
            for (int64_t i_88836 = 0; i_88836 < mz2081Uz2084U_34268; i_88836++) {
                bool defunc_0_reduce_res_83542;
                bool redout_88833 = 0;
                
                for (int64_t i_88834 = 0; i_88834 < mz2081Uz2084U_34268; i_88834++) {
                    double eta_p_83543 = ((double *) mem_89869.mem)[i_88836 * mz2081Uz2084U_34268 + i_88834];
                    bool zg_res_83544 = 0.0 < eta_p_83543;
                    bool defunc_0_op_res_83547 = zg_res_83544 || redout_88833;
                    bool redout_tmp_91367 = defunc_0_op_res_83547;
                    
                    redout_88833 = redout_tmp_91367;
                }
                defunc_0_reduce_res_83542 = redout_88833;
                
                bool defunc_0_op_res_83551 = defunc_0_reduce_res_83542 || redout_88835;
                bool redout_tmp_91366 = defunc_0_op_res_83551;
                
                redout_88835 = redout_tmp_91366;
            }
            x_91018 = redout_88835;
            defunc_0_reduce_res_83540 = x_91018;
        } else {
            defunc_0_reduce_res_83540 = 0;
        }
        
        bool x_91087 = defunc_0_reduce_res_83540 && defunc_0_reduce_comm_res_84794;
        bool final_plan_50358;
        double final_plan_50362;
        bool loop_while_50363;
        double loss_50367;
        
        if (memblock_set(ctx, &mem_param_89888, &ext_mem_89844, "ext_mem_89844") != 0)
            return 1;
        if (memblock_set(ctx, &mem_param_89891, &ext_mem_89843, "ext_mem_89843") != 0)
            return 1;
        if (memblock_set(ctx, &mem_param_89895, &mem_89869, "mem_89869") != 0)
            return 1;
        loop_while_50363 = x_91087;
        loss_50367 = zp_res_50319;
        while (loop_while_50363) {
            double defunc_res_84709;
            double defunc_res_84710;
            double defunc_res_84711;
            double defunc_res_84712;
            double redout_88844;
            double redout_88845;
            double redout_88846;
            double redout_88847;
            
            redout_88844 = 0.0;
            redout_88845 = 0.0;
            redout_88846 = 0.0;
            redout_88847 = 0.0;
            for (int64_t i_88849 = 0; i_88849 < mz2081Uz2084U_34268; i_88849++) {
                double eta_p_62033 = ((double *) mem_89416)[eta_p_49441 * mz2081Uz2084U_34268 + i_88849];
                double defunc_res_83553;
                double defunc_res_83554;
                double defunc_res_83555;
                double defunc_res_83556;
                double defunc_res_83557;
                double redout_88837;
                double redout_88838;
                double redout_88839;
                double redout_88840;
                double redout_88841;
                
                redout_88837 = 0.0;
                redout_88838 = 0.0;
                redout_88839 = 0.0;
                redout_88840 = 0.0;
                redout_88841 = 0.0;
                for (int64_t i_88842 = 0; i_88842 < mz2081Uz2084U_34268; i_88842++) {
                    double x_62143 = ((double *) mem_param_89895.mem)[i_88849 * mz2081Uz2084U_34268 + i_88842];
                    double eta_p_62144 = ((double *) mem_89416)[eta_p_49442 * mz2081Uz2084U_34268 + i_88842];
                    double zt_res_62149 = eta_p_62033 * eta_p_62144;
                    bool zeze_res_62150 = x_62143 == 0.0;
                    double klu_res_62151;
                    
                    if (zeze_res_62150) {
                        klu_res_62151 = 0.0;
                    } else {
                        double zs_res_62152 = x_62143 / zt_res_62149;
                        double log_res_62153 = futrts_log64(zs_res_62152);
                        double zt_res_62154 = x_62143 * log_res_62153;
                        
                        klu_res_62151 = zt_res_62154;
                    }
                    
                    double zp_res_62043 = x_62143 + redout_88837;
                    double zp_res_62049 = x_62143 + redout_88838;
                    double zp_res_62055 = x_62143 + redout_88839;
                    double zp_res_62077 = klu_res_62151 + redout_88840;
                    double zp_res_62084 = x_62143 + redout_88841;
                    double redout_tmp_91381 = zp_res_62043;
                    double redout_tmp_91382 = zp_res_62049;
                    double redout_tmp_91383 = zp_res_62055;
                    double redout_tmp_91384 = zp_res_62077;
                    double redout_tmp_91385 = zp_res_62084;
                    
                    redout_88837 = redout_tmp_91381;
                    redout_88838 = redout_tmp_91382;
                    redout_88839 = redout_tmp_91383;
                    redout_88840 = redout_tmp_91384;
                    redout_88841 = redout_tmp_91385;
                }
                defunc_res_83553 = redout_88837;
                defunc_res_83554 = redout_88838;
                defunc_res_83555 = redout_88839;
                defunc_res_83556 = redout_88840;
                defunc_res_83557 = redout_88841;
                
                bool zeze_res_62057 = defunc_res_83555 == 0.0;
                double klu_res_62058;
                
                if (zeze_res_62057) {
                    klu_res_62058 = 0.0;
                } else {
                    double zs_res_62059 = defunc_res_83555 / eta_p_62033;
                    double log_res_62060 = futrts_log64(zs_res_62059);
                    double zt_res_62061 = log_res_62060 * defunc_res_83555;
                    
                    klu_res_62058 = zt_res_62061;
                }
                
                double zp_res_50379 = defunc_res_83553 + redout_88844;
                double zp_res_50502 = klu_res_62058 + redout_88845;
                double zp_res_50546 = defunc_res_83556 + redout_88846;
                double zp_res_50580 = defunc_res_83557 + redout_88847;
                
                ((double *) mem_89897)[i_88849] = defunc_res_83554;
                
                double redout_tmp_91376 = zp_res_50379;
                double redout_tmp_91377 = zp_res_50502;
                double redout_tmp_91378 = zp_res_50546;
                double redout_tmp_91379 = zp_res_50580;
                
                redout_88844 = redout_tmp_91376;
                redout_88845 = redout_tmp_91377;
                redout_88846 = redout_tmp_91378;
                redout_88847 = redout_tmp_91379;
            }
            defunc_res_84709 = redout_88844;
            defunc_res_84710 = redout_88845;
            defunc_res_84711 = redout_88846;
            defunc_res_84712 = redout_88847;
            
            double zt_res_50383 = eps_34271 * defunc_res_84709;
            double defunc_res_84714;
            double redout_88856 = 0.0;
            
            for (int64_t i_88859 = 0; i_88859 < mz2081Uz2084U_34268; i_88859++) {
                double eta_p_68864 = ((double *) mem_89416)[eta_p_49442 * mz2081Uz2084U_34268 + i_88859];
                double log_res_68866 = futrts_log64(eta_p_68864);
                double zt_res_68867 = zt_res_50383 * log_res_68866;
                double defunc_res_83558;
                double defunc_res_83559;
                double redout_88851;
                double redout_88852;
                
                redout_88851 = 0.0;
                redout_88852 = 0.0;
                for (int64_t i_88853 = 0; i_88853 < mz2081Uz2084U_34268; i_88853++) {
                    double x_68899 = ((double *) mem_param_89895.mem)[i_88853 * mz2081Uz2084U_34268 + i_88859];
                    double zp_res_68872 = x_68899 + redout_88851;
                    double zp_res_68884 = x_68899 + redout_88852;
                    double redout_tmp_91389 = zp_res_68872;
                    double redout_tmp_91390 = zp_res_68884;
                    
                    redout_88851 = redout_tmp_91389;
                    redout_88852 = redout_tmp_91390;
                }
                defunc_res_83558 = redout_88851;
                defunc_res_83559 = redout_88852;
                
                bool zeze_res_68874 = defunc_res_83558 == 0.0;
                double klu_res_68875;
                
                if (zeze_res_68874) {
                    klu_res_68875 = 0.0;
                } else {
                    double zs_res_68876 = defunc_res_83558 / eta_p_68864;
                    double log_res_68877 = futrts_log64(zs_res_68876);
                    double zt_res_68878 = log_res_68877 * defunc_res_83558;
                    
                    klu_res_68875 = zt_res_68878;
                }
                
                double zp_res_50523 = klu_res_68875 + redout_88856;
                
                ((double *) mem_89905)[i_88859] = defunc_res_83559;
                ((double *) mem_89907)[i_88859] = zt_res_68867;
                
                double redout_tmp_91386 = zp_res_50523;
                
                redout_88856 = redout_tmp_91386;
            }
            defunc_res_84714 = redout_88856;
            
            double zt_res_50524 = rho2_34270 * defunc_res_84714;
            double zt_res_50503 = rho1_34269 * defunc_res_84710;
            double zp_res_50548 = zt_res_50503 + zt_res_50524;
            double zt_res_50547 = eps_34271 * defunc_res_84711;
            double zp_res_50549 = zt_res_50547 + zp_res_50548;
            
            for (int64_t i_88866 = 0; i_88866 < mz2081Uz2084U_34268; i_88866++) {
                double defunc_0_reduce_res_83560;
                double redout_88862 = 0.0;
                
                for (int64_t i_88863 = 0; i_88863 < mz2081Uz2084U_34268; i_88863++) {
                    double eta_p_62411 = ((double *) mem_89419)[eta_p_49442 * (mz2081Uz2084U_34268 * mz2081Uz2084U_34268) + i_88866 * mz2081Uz2084U_34268 + i_88863];
                    double eta_p_62412 = ((double *) mem_89905)[i_88863];
                    double zt_res_62414 = eta_p_62411 * eta_p_62411;
                    double zt_res_62416 = eta_p_62412 * zt_res_62414;
                    double zp_res_50437 = zt_res_62416 + redout_88862;
                    double redout_tmp_91392 = zp_res_50437;
                    
                    redout_88862 = redout_tmp_91392;
                }
                defunc_0_reduce_res_83560 = redout_88862;
                ((double *) mem_89921)[i_88866] = defunc_0_reduce_res_83560;
            }
            for (int64_t i_88891 = 0; i_88891 < mz2081Uz2084U_34268; i_88891++) {
                double eta_p_61822 = ((double *) mem_89416)[eta_p_49441 * mz2081Uz2084U_34268 + i_88891];
                double eta_p_61824 = ((double *) mem_param_89888.mem)[i_88891];
                double log_res_61828 = futrts_log64(eta_p_61822);
                double zt_res_61830 = zt_res_50383 * log_res_61828;
                double defunc_0_reduce_res_83563;
                double redout_88868 = 0.0;
                
                for (int64_t i_88869 = 0; i_88869 < mz2081Uz2084U_34268; i_88869++) {
                    double eta_p_62377 = ((double *) mem_89419)[eta_p_49441 * (mz2081Uz2084U_34268 * mz2081Uz2084U_34268) + i_88891 * mz2081Uz2084U_34268 + i_88869];
                    double eta_p_62378 = ((double *) mem_89897)[i_88869];
                    double zt_res_62380 = eta_p_62377 * eta_p_62377;
                    double zt_res_62382 = eta_p_62378 * zt_res_62380;
                    double zp_res_61845 = zt_res_62382 + redout_88868;
                    double redout_tmp_91395 = zp_res_61845;
                    
                    redout_88868 = redout_tmp_91395;
                }
                defunc_0_reduce_res_83563 = redout_88868;
                for (int64_t i_88874 = 0; i_88874 < mz2081Uz2084U_34268; i_88874++) {
                    double defunc_0_reduce_res_83561;
                    double redout_88870 = 0.0;
                    
                    for (int64_t i_88871 = 0; i_88871 < mz2081Uz2084U_34268; i_88871++) {
                        double eta_p_62385 = ((double *) mem_89419)[eta_p_49441 * (mz2081Uz2084U_34268 * mz2081Uz2084U_34268) + i_88891 * mz2081Uz2084U_34268 + i_88871];
                        double eta_p_62386 = ((double *) mem_param_89895.mem)[i_88871 * mz2081Uz2084U_34268 + i_88874];
                        double zt_res_62387 = eta_p_62385 * eta_p_62386;
                        double zp_res_61857 = zt_res_62387 + redout_88870;
                        double redout_tmp_91397 = zp_res_61857;
                        
                        redout_88870 = redout_tmp_91397;
                    }
                    defunc_0_reduce_res_83561 = redout_88870;
                    ((double *) mem_89941)[i_88874] = defunc_0_reduce_res_83561;
                }
                
                double defunc_0_reduce_res_83565;
                double redout_88879 = INFINITY;
                
                for (int64_t i_88881 = 0; i_88881 < mz2081Uz2084U_34268; i_88881++) {
                    double eta_p_wasfree_62336 = ((double *) mem_89921)[i_88881];
                    double eta_p_wasfree_62337 = ((double *) mem_89907)[i_88881];
                    double eta_p_wasfree_62338 = ((double *) mem_param_89891.mem)[i_88881];
                    double defunc_0_reduce_res_83562;
                    double redout_88876 = 0.0;
                    
                    for (int64_t i_88877 = 0; i_88877 < mz2081Uz2084U_34268; i_88877++) {
                        double eta_p_62391 = ((double *) mem_89941)[i_88877];
                        double eta_p_62392 = ((double *) mem_89419)[eta_p_49442 * (mz2081Uz2084U_34268 * mz2081Uz2084U_34268) + i_88877 * mz2081Uz2084U_34268 + i_88881];
                        double zt_res_62393 = eta_p_62391 * eta_p_62392;
                        double zp_res_62347 = zt_res_62393 + redout_88876;
                        double redout_tmp_91400 = zp_res_62347;
                        
                        redout_88876 = redout_tmp_91400;
                    }
                    defunc_0_reduce_res_83562 = redout_88876;
                    
                    double zt_res_62349 = -2.0 * defunc_0_reduce_res_83562;
                    double zp_res_62351 = zt_res_62349 + defunc_0_reduce_res_83563;
                    double zp_res_62353 = eta_p_wasfree_62336 + zp_res_62351;
                    double zp_res_62355 = zp_res_50549 + zp_res_62353;
                    double zm_res_62357 = zp_res_62355 - zt_res_61830;
                    double zm_res_62359 = zm_res_62357 - eta_p_wasfree_62337;
                    double zs_res_62361 = zm_res_62359 / defunc_res_84712;
                    double zs_res_62363 = zs_res_62361 / neg_res_49428;
                    double zp_res_62365 = eta_p_61824 + zs_res_62363;
                    double zp_res_62367 = eta_p_wasfree_62338 + zp_res_62365;
                    double zm_res_62369 = 30.0 - zp_res_62367;
                    double min_res_61922 = fmin64(zm_res_62369, redout_88879);
                    
                    ((double *) mem_89949)[i_88881] = zp_res_62367;
                    
                    double redout_tmp_91398 = min_res_61922;
                    
                    redout_88879 = redout_tmp_91398;
                }
                defunc_0_reduce_res_83565 = redout_88879;
                for (int64_t i_88885 = 0; i_88885 < mz2081Uz2084U_34268; i_88885++) {
                    double eta_p_61925 = ((double *) mem_89949)[i_88885];
                    double zp_res_61926 = eta_p_61925 + defunc_0_reduce_res_83565;
                    
                    ((double *) mem_89930)[i_88891 * mz2081Uz2084U_34268 + i_88885] = zp_res_61926;
                }
                ((double *) mem_89932)[i_88891] = defunc_0_reduce_res_83565;
            }
            
            bool defunc_0_reduce_res_84720;
            bool redout_88904 = 0;
            
            for (int64_t i_88908 = 0; i_88908 < mz2081Uz2084U_34268; i_88908++) {
                double eta_p_79225 = ((double *) mem_param_89891.mem)[i_88908];
                double eta_p_79226 = ((double *) mem_89416)[eta_p_49442 * mz2081Uz2084U_34268 + i_88908];
                double defunc_0_reduce_res_83568;
                double redout_88894 = INFINITY;
                
                for (int64_t i_88895 = 0; i_88895 < mz2081Uz2084U_34268; i_88895++) {
                    double eta_p_79229 = ((double *) mem_89930)[i_88895 * mz2081Uz2084U_34268 + i_88908];
                    double zm_res_79230 = 30.0 - eta_p_79229;
                    double min_res_79233 = fmin64(zm_res_79230, redout_88894);
                    double redout_tmp_91406 = min_res_79233;
                    
                    redout_88894 = redout_tmp_91406;
                }
                defunc_0_reduce_res_83568 = redout_88894;
                
                double defunc_0_reduce_res_83569;
                double redout_88897 = 0.0;
                
                for (int64_t i_88899 = 0; i_88899 < mz2081Uz2084U_34268; i_88899++) {
                    double eta_p_79269 = ((double *) mem_89930)[i_88899 * mz2081Uz2084U_34268 + i_88908];
                    double zp_res_79270 = eta_p_79269 + defunc_0_reduce_res_83568;
                    double exp_res_79271 = futrts_exp64(zp_res_79270);
                    double zp_res_79246 = exp_res_79271 + redout_88897;
                    
                    ((double *) mem_89977.mem)[i_88908 * mz2081Uz2084U_34268 + i_88899] = exp_res_79271;
                    
                    double redout_tmp_91407 = zp_res_79246;
                    
                    redout_88897 = redout_tmp_91407;
                }
                defunc_0_reduce_res_83569 = redout_88897;
                
                double zp_res_79241 = eta_p_79225 + defunc_0_reduce_res_83568;
                double zs_res_79247 = defunc_0_reduce_res_83569 / eta_p_79226;
                double ztzt_res_79248 = fpow64(zs_res_79247, zs_res_49436);
                double zt_res_79249 = zs_res_49437 * zp_res_79241;
                double exp_res_79250 = futrts_exp64(zt_res_79249);
                double zt_res_79251 = ztzt_res_79248 * exp_res_79250;
                bool zgze_res_79252 = exp_absorb_cutoff_34276 <= zt_res_79251;
                bool defunc_0_op_res_50755 = zgze_res_79252 || redout_88904;
                
                ((double *) mem_89972.mem)[i_88908] = zt_res_79251;
                ((double *) mem_89974.mem)[i_88908] = zp_res_79241;
                
                bool redout_tmp_91402 = defunc_0_op_res_50755;
                
                redout_88904 = redout_tmp_91402;
            }
            defunc_0_reduce_res_84720 = redout_88904;
            
            bool defunc_0_reduce_res_84725;
            bool redout_88916 = 0;
            
            for (int64_t i_88919 = 0; i_88919 < mz2081Uz2084U_34268; i_88919++) {
                double eta_p_60885 = ((double *) mem_param_89888.mem)[i_88919];
                double eta_p_60886 = ((double *) mem_89932)[i_88919];
                double eta_p_60888 = ((double *) mem_89416)[eta_p_49441 * mz2081Uz2084U_34268 + i_88919];
                double zp_res_60889 = eta_p_60885 + eta_p_60886;
                double defunc_0_reduce_res_83571;
                double redout_88912 = 0.0;
                
                for (int64_t i_88913 = 0; i_88913 < mz2081Uz2084U_34268; i_88913++) {
                    double eta_p_62431 = ((double *) mem_89972.mem)[i_88913];
                    double eta_p_62432 = ((double *) mem_89977.mem)[i_88913 * mz2081Uz2084U_34268 + i_88919];
                    double zt_res_62433 = eta_p_62431 * eta_p_62432;
                    double zp_res_60899 = zt_res_62433 + redout_88912;
                    double redout_tmp_91412 = zp_res_60899;
                    
                    redout_88912 = redout_tmp_91412;
                }
                defunc_0_reduce_res_83571 = redout_88912;
                
                double zs_res_60901 = defunc_0_reduce_res_83571 / eta_p_60888;
                double ztzt_res_60903 = fpow64(zs_res_60901, zs_res_49432);
                double zt_res_60905 = zs_res_49433 * zp_res_60889;
                double exp_res_60907 = futrts_exp64(zt_res_60905);
                double zt_res_60909 = ztzt_res_60903 * exp_res_60907;
                bool zgze_res_60911 = exp_absorb_cutoff_34276 <= zt_res_60909;
                bool defunc_0_op_res_50712 = zgze_res_60911 || redout_88916;
                
                ((double *) mem_90007.mem)[i_88919] = zt_res_60909;
                ((double *) mem_90009.mem)[i_88919] = zp_res_60889;
                
                bool redout_tmp_91409 = defunc_0_op_res_50712;
                
                redout_88916 = redout_tmp_91409;
            }
            defunc_0_reduce_res_84725 = redout_88916;
            
            bool x_90978 = !defunc_0_reduce_res_84725;
            bool defunc_0_reduce_res_83572;
            
            if (x_90978) {
                bool x_90980;
                bool redout_88922 = 0;
                
                for (int64_t i_88923 = 0; i_88923 < mz2081Uz2084U_34268; i_88923++) {
                    double eta_p_62438 = ((double *) mem_90007.mem)[i_88923];
                    bool zlze_res_62439 = eta_p_62438 <= zs_res_49813;
                    bool defunc_0_op_res_50722 = zlze_res_62439 || redout_88922;
                    bool redout_tmp_91413 = defunc_0_op_res_50722;
                    
                    redout_88922 = redout_tmp_91413;
                }
                x_90980 = redout_88922;
                defunc_0_reduce_res_83572 = x_90980;
            } else {
                defunc_0_reduce_res_83572 = 0;
            }
            
            bool cond_50713 = defunc_0_reduce_res_83572 || defunc_0_reduce_res_84725;
            int64_t ext_90063;
            
            if (cond_50713) {
                ext_90063 = mz2081Uz2084U_34268;
            } else {
                ext_90063 = (int64_t) 1;
            }
            
            int64_t ext_90062;
            
            if (cond_50713) {
                ext_90062 = (int64_t) 1;
            } else {
                ext_90062 = mz2081Uz2084U_34268;
            }
            if (cond_50713) {
                if (memblock_alloc(ctx, &mem_90023, bytes_89422, "mem_90023")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_90025, bytes_89422, "mem_90025")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_90028, bytes_89436, "mem_90028")) {
                    err = 1;
                    goto cleanup;
                }
                for (int64_t i_88934 = 0; i_88934 < mz2081Uz2084U_34268; i_88934++) {
                    double eta_p_83589 = ((double *) mem_90007.mem)[i_88934];
                    double eta_p_83590 = ((double *) mem_90009.mem)[i_88934];
                    bool zgze_res_83592 = exp_absorb_cutoff_34276 <= eta_p_83589;
                    bool zl_res_83593 = eta_p_83589 < zs_res_49813;
                    bool x_83594 = !zgze_res_83592;
                    bool y_83595 = zl_res_83593 && x_83594;
                    bool cond_83596 = zgze_res_83592 || y_83595;
                    int64_t ext_90050;
                    
                    if (cond_83596) {
                        ext_90050 = (int64_t) 0;
                    } else {
                        ext_90050 = i_88934;
                    }
                    
                    int64_t ext_90049;
                    
                    if (cond_83596) {
                        ext_90049 = (int64_t) 1;
                    } else {
                        ext_90049 = mz2081Uz2084U_34268;
                    }
                    
                    double rescale_res_83597;
                    double rescale_res_83598;
                    
                    if (cond_83596) {
                        double log_res_83600 = futrts_log64(eta_p_83589);
                        double sqrt_res_83601 = futrts_sqrt64(eta_p_83589);
                        double zs_res_83602 = log_res_83600 / 2.0;
                        double zp_res_83603 = eta_p_83590 + zs_res_83602;
                        
                        if (memblock_alloc(ctx, &mem_90040, bytes_89422, "mem_90040")) {
                            err = 1;
                            goto cleanup;
                        }
                        for (int64_t i_88926 = 0; i_88926 < mz2081Uz2084U_34268; i_88926++) {
                            double eta_p_83605 = ((double *) mem_89977.mem)[i_88926 * mz2081Uz2084U_34268 + i_88934];
                            double zt_res_83606 = sqrt_res_83601 * eta_p_83605;
                            
                            ((double *) mem_90040.mem)[i_88926] = zt_res_83606;
                        }
                        if (memblock_set(ctx, &ext_mem_90051, &mem_90040, "mem_90040") != 0)
                            return 1;
                        rescale_res_83597 = sqrt_res_83601;
                        rescale_res_83598 = zp_res_83603;
                    } else {
                        if (memblock_set(ctx, &ext_mem_90051, &mem_89977, "mem_89977") != 0)
                            return 1;
                        rescale_res_83597 = eta_p_83589;
                        rescale_res_83598 = eta_p_83590;
                    }
                    ((double *) mem_90023.mem)[i_88934] = rescale_res_83597;
                    ((double *) mem_90025.mem)[i_88934] = rescale_res_83598;
                    lmad_copy_8b(ctx, 1, (uint64_t *) mem_90028.mem, i_88934 * mz2081Uz2084U_34268, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90051.mem, ext_90050, (int64_t []) {ext_90049}, (int64_t []) {mz2081Uz2084U_34268});
                    if (memblock_unref(ctx, &ext_mem_90051, "ext_mem_90051") != 0)
                        return 1;
                }
                if (memblock_set(ctx, &ext_mem_90071, &mem_90023, "mem_90023") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90068, &mem_90025, "mem_90025") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90065, &mem_90028, "mem_90028") != 0)
                    return 1;
            } else {
                if (memblock_set(ctx, &ext_mem_90071, &mem_90007, "mem_90007") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90068, &mem_90009, "mem_90009") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90065, &mem_89977, "mem_89977") != 0)
                    return 1;
            }
            
            bool x_90974 = !defunc_0_reduce_res_84720;
            bool defunc_0_reduce_res_83611;
            
            if (x_90974) {
                bool x_90976;
                bool redout_88938 = 0;
                
                for (int64_t i_88939 = 0; i_88939 < mz2081Uz2084U_34268; i_88939++) {
                    double eta_p_62481 = ((double *) mem_89972.mem)[i_88939];
                    bool zlze_res_62482 = eta_p_62481 <= zs_res_49813;
                    bool defunc_0_op_res_50765 = zlze_res_62482 || redout_88938;
                    bool redout_tmp_91418 = defunc_0_op_res_50765;
                    
                    redout_88938 = redout_tmp_91418;
                }
                x_90976 = redout_88938;
                defunc_0_reduce_res_83611 = x_90976;
            } else {
                defunc_0_reduce_res_83611 = 0;
            }
            
            bool cond_50756 = defunc_0_reduce_res_83611 || defunc_0_reduce_res_84720;
            int64_t ext_90113;
            
            if (cond_50756) {
                ext_90113 = (int64_t) 1;
            } else {
                ext_90113 = ext_90063;
            }
            
            int64_t ext_90112;
            
            if (cond_50756) {
                ext_90112 = mz2081Uz2084U_34268;
            } else {
                ext_90112 = ext_90062;
            }
            if (cond_50756) {
                if (memblock_alloc(ctx, &mem_90073, bytes_89422, "mem_90073")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_90075, bytes_89422, "mem_90075")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_90078, bytes_89436, "mem_90078")) {
                    err = 1;
                    goto cleanup;
                }
                for (int64_t i_88950 = 0; i_88950 < mz2081Uz2084U_34268; i_88950++) {
                    double eta_p_83630 = ((double *) mem_89972.mem)[i_88950];
                    double eta_p_83631 = ((double *) mem_89974.mem)[i_88950];
                    bool zgze_res_83633 = exp_absorb_cutoff_34276 <= eta_p_83630;
                    bool zl_res_83634 = eta_p_83630 < zs_res_49813;
                    bool x_83635 = !zgze_res_83633;
                    bool y_83636 = zl_res_83634 && x_83635;
                    bool cond_83637 = zgze_res_83633 || y_83636;
                    int64_t binop_y_90097 = i_88950 * ext_90062;
                    int64_t ext_90100;
                    
                    if (cond_83637) {
                        ext_90100 = (int64_t) 0;
                    } else {
                        ext_90100 = binop_y_90097;
                    }
                    
                    int64_t ext_90099;
                    
                    if (cond_83637) {
                        ext_90099 = (int64_t) 1;
                    } else {
                        ext_90099 = ext_90063;
                    }
                    
                    double rescale_res_83638;
                    double rescale_res_83639;
                    
                    if (cond_83637) {
                        double log_res_83641 = futrts_log64(eta_p_83630);
                        double sqrt_res_83642 = futrts_sqrt64(eta_p_83630);
                        double zs_res_83643 = log_res_83641 / 2.0;
                        double zp_res_83644 = eta_p_83631 + zs_res_83643;
                        
                        if (memblock_alloc(ctx, &mem_90090, bytes_89422, "mem_90090")) {
                            err = 1;
                            goto cleanup;
                        }
                        for (int64_t i_88942 = 0; i_88942 < mz2081Uz2084U_34268; i_88942++) {
                            double eta_p_83646 = ((double *) ext_mem_90065.mem)[i_88942 * ext_90063 + i_88950 * ext_90062];
                            double zt_res_83647 = sqrt_res_83642 * eta_p_83646;
                            
                            ((double *) mem_90090.mem)[i_88942] = zt_res_83647;
                        }
                        if (memblock_set(ctx, &ext_mem_90101, &mem_90090, "mem_90090") != 0)
                            return 1;
                        rescale_res_83638 = sqrt_res_83642;
                        rescale_res_83639 = zp_res_83644;
                    } else {
                        if (memblock_set(ctx, &ext_mem_90101, &ext_mem_90065, "ext_mem_90065") != 0)
                            return 1;
                        rescale_res_83638 = eta_p_83630;
                        rescale_res_83639 = eta_p_83631;
                    }
                    ((double *) mem_90073.mem)[i_88950] = rescale_res_83638;
                    ((double *) mem_90075.mem)[i_88950] = rescale_res_83639;
                    lmad_copy_8b(ctx, 1, (uint64_t *) mem_90078.mem, i_88950 * mz2081Uz2084U_34268, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90101.mem, ext_90100, (int64_t []) {ext_90099}, (int64_t []) {mz2081Uz2084U_34268});
                    if (memblock_unref(ctx, &ext_mem_90101, "ext_mem_90101") != 0)
                        return 1;
                }
                if (memblock_set(ctx, &ext_mem_90121, &mem_90073, "mem_90073") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90118, &mem_90075, "mem_90075") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90115, &mem_90078, "mem_90078") != 0)
                    return 1;
            } else {
                if (memblock_set(ctx, &ext_mem_90121, &mem_89972, "mem_89972") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90118, &mem_89974, "mem_89974") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90115, &ext_mem_90065, "ext_mem_90065") != 0)
                    return 1;
            }
            if (memblock_unref(ctx, &ext_mem_90065, "ext_mem_90065") != 0)
                return 1;
            
            bool defunc_0_reduce_res_84728;
            bool redout_88954 = 1;
            
            for (int64_t i_88955 = 0; i_88955 < mz2081Uz2084U_34268; i_88955++) {
                double eta_p_60687 = ((double *) ext_mem_90071.mem)[i_88955];
                bool isnan_res_60688 = futrts_isnan64(eta_p_60687);
                bool not_res_60689 = !isnan_res_60688;
                bool x_50801 = not_res_60689 && redout_88954;
                bool redout_tmp_91423 = x_50801;
                
                redout_88954 = redout_tmp_91423;
            }
            defunc_0_reduce_res_84728 = redout_88954;
            
            bool defunc_0_reduce_comm_res_83655;
            
            if (defunc_0_reduce_res_84728) {
                bool x_90972;
                bool redout_88956 = 0;
                
                for (int64_t i_88957 = 0; i_88957 < mz2081Uz2084U_34268; i_88957++) {
                    double eta_p_83656 = ((double *) ext_mem_90071.mem)[i_88957];
                    double zt_res_83657 = zp_res_83654 * eta_p_83656;
                    bool zgze_res_83658 = 1.0 <= zt_res_83657;
                    bool zgze_res_83659 = eta_p_83656 <= zp_res_83654;
                    bool x_83660 = zgze_res_83658 && zgze_res_83659;
                    bool not_res_83661 = !x_83660;
                    bool defunc_0_op_res_83664 = not_res_83661 || redout_88956;
                    bool redout_tmp_91424 = defunc_0_op_res_83664;
                    
                    redout_88956 = redout_tmp_91424;
                }
                x_90972 = redout_88956;
                defunc_0_reduce_comm_res_83655 = x_90972;
            } else {
                defunc_0_reduce_comm_res_83655 = 0;
            }
            
            bool x_91090 = defunc_0_reduce_comm_res_83655 && defunc_0_reduce_res_84728;
            int64_t ext_90286;
            int64_t ext_90285;
            int64_t ext_90284;
            int64_t ext_90277;
            int64_t ext_90276;
            int64_t ext_90275;
            bool algo5_core_loop_res_50816;
            bool loop_while_50826;
            int64_t ctx_param_ext_90122;
            int64_t ctx_param_ext_90123;
            int64_t ctx_param_ext_90124;
            int64_t ctx_param_ext_90135;
            int64_t ctx_param_ext_90136;
            int64_t ctx_param_ext_90137;
            
            if (memblock_set(ctx, &mem_param_90125, &mem_89977, "mem_89977") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_90128, &mem_89423, "mem_89423") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_90131, &mem_90009, "mem_90009") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_90134, &mem_89974, "mem_89974") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_90138, &ext_mem_90115, "ext_mem_90115") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_90141, &ext_mem_90071, "ext_mem_90071") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_90144, &ext_mem_90121, "ext_mem_90121") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_90147, &ext_mem_90068, "ext_mem_90068") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_90150, &ext_mem_90118, "ext_mem_90118") != 0)
                return 1;
            ctx_param_ext_90122 = (int64_t) 0;
            ctx_param_ext_90123 = (int64_t) 1;
            ctx_param_ext_90124 = mz2081Uz2084U_34268;
            ctx_param_ext_90135 = (int64_t) 0;
            ctx_param_ext_90136 = ext_90113;
            ctx_param_ext_90137 = ext_90112;
            loop_while_50826 = x_91090;
            while (loop_while_50826) {
                if (memblock_alloc(ctx, &mem_90152, bytes_89422, "mem_90152")) {
                    err = 1;
                    goto cleanup;
                }
                
                bool defunc_0_reduce_res_83764;
                bool redout_88961 = 0;
                
                for (int64_t i_88963 = 0; i_88963 < mz2081Uz2084U_34268; i_88963++) {
                    double eta_p_62700 = ((double *) mem_89416)[eta_p_49442 * mz2081Uz2084U_34268 + i_88963];
                    double eta_p_62701 = ((double *) mem_param_90150.mem)[i_88963];
                    double defunc_0_reduce_res_83666;
                    double redout_88958 = 0.0;
                    
                    for (int64_t i_88959 = 0; i_88959 < mz2081Uz2084U_34268; i_88959++) {
                        double eta_p_62725 = ((double *) mem_param_90141.mem)[i_88959];
                        double eta_p_62726 = ((double *) mem_param_90138.mem)[ctx_param_ext_90135 + (i_88959 * ctx_param_ext_90136 + i_88963 * ctx_param_ext_90137)];
                        double zt_res_62727 = eta_p_62725 * eta_p_62726;
                        double zp_res_62710 = zt_res_62727 + redout_88958;
                        double redout_tmp_91452 = zp_res_62710;
                        
                        redout_88958 = redout_tmp_91452;
                    }
                    defunc_0_reduce_res_83666 = redout_88958;
                    
                    double zs_res_62712 = defunc_0_reduce_res_83666 / eta_p_62700;
                    double ztzt_res_62714 = fpow64(zs_res_62712, zs_res_49436);
                    double zt_res_62716 = zs_res_49437 * eta_p_62701;
                    double exp_res_62718 = futrts_exp64(zt_res_62716);
                    double zt_res_62720 = ztzt_res_62714 * exp_res_62718;
                    bool zgze_res_62722 = exp_absorb_cutoff_34276 <= zt_res_62720;
                    bool defunc_0_op_res_50943 = zgze_res_62722 || redout_88961;
                    
                    ((double *) mem_90152.mem)[i_88963] = zt_res_62720;
                    
                    bool redout_tmp_91450 = defunc_0_op_res_50943;
                    
                    redout_88961 = redout_tmp_91450;
                }
                defunc_0_reduce_res_83764 = redout_88961;
                if (memblock_alloc(ctx, &mem_90160, bytes_89422, "mem_90160")) {
                    err = 1;
                    goto cleanup;
                }
                
                bool defunc_0_reduce_res_83767;
                bool redout_88968 = 0;
                
                for (int64_t i_88970 = 0; i_88970 < mz2081Uz2084U_34268; i_88970++) {
                    double eta_p_62618 = ((double *) mem_89416)[eta_p_49441 * mz2081Uz2084U_34268 + i_88970];
                    double eta_p_62619 = ((double *) mem_param_90147.mem)[i_88970];
                    double defunc_0_reduce_res_83667;
                    double redout_88965 = 0.0;
                    
                    for (int64_t i_88966 = 0; i_88966 < mz2081Uz2084U_34268; i_88966++) {
                        double eta_p_62731 = ((double *) mem_90152.mem)[i_88966];
                        double eta_p_62732 = ((double *) mem_param_90138.mem)[ctx_param_ext_90135 + (i_88970 * ctx_param_ext_90136 + i_88966 * ctx_param_ext_90137)];
                        double zt_res_62733 = eta_p_62731 * eta_p_62732;
                        double zp_res_62628 = zt_res_62733 + redout_88965;
                        double redout_tmp_91455 = zp_res_62628;
                        
                        redout_88965 = redout_tmp_91455;
                    }
                    defunc_0_reduce_res_83667 = redout_88965;
                    
                    double zs_res_62630 = defunc_0_reduce_res_83667 / eta_p_62618;
                    double ztzt_res_62632 = fpow64(zs_res_62630, zs_res_49432);
                    double zt_res_62634 = zs_res_49433 * eta_p_62619;
                    double exp_res_62636 = futrts_exp64(zt_res_62634);
                    double zt_res_62638 = ztzt_res_62632 * exp_res_62636;
                    bool zgze_res_62640 = exp_absorb_cutoff_34276 <= zt_res_62638;
                    bool defunc_0_op_res_50900 = zgze_res_62640 || redout_88968;
                    
                    ((double *) mem_90160.mem)[i_88970] = zt_res_62638;
                    
                    bool redout_tmp_91453 = defunc_0_op_res_50900;
                    
                    redout_88968 = redout_tmp_91453;
                }
                defunc_0_reduce_res_83767 = redout_88968;
                
                bool x_90966 = !defunc_0_reduce_res_83767;
                bool defunc_0_reduce_res_83668;
                
                if (x_90966) {
                    bool x_90968;
                    bool redout_88972 = 0;
                    
                    for (int64_t i_88973 = 0; i_88973 < mz2081Uz2084U_34268; i_88973++) {
                        double eta_p_62737 = ((double *) mem_90160.mem)[i_88973];
                        bool zlze_res_62738 = eta_p_62737 <= zs_res_49813;
                        bool defunc_0_op_res_50910 = zlze_res_62738 || redout_88972;
                        bool redout_tmp_91456 = defunc_0_op_res_50910;
                        
                        redout_88972 = redout_tmp_91456;
                    }
                    x_90968 = redout_88972;
                    defunc_0_reduce_res_83668 = x_90968;
                } else {
                    defunc_0_reduce_res_83668 = 0;
                }
                
                bool cond_50901 = defunc_0_reduce_res_83668 || defunc_0_reduce_res_83767;
                int64_t ext_90209;
                
                if (cond_50901) {
                    ext_90209 = (int64_t) 0;
                } else {
                    ext_90209 = ctx_param_ext_90135;
                }
                
                int64_t ext_90208;
                
                if (cond_50901) {
                    ext_90208 = mz2081Uz2084U_34268;
                } else {
                    ext_90208 = ctx_param_ext_90136;
                }
                
                int64_t ext_90207;
                
                if (cond_50901) {
                    ext_90207 = (int64_t) 1;
                } else {
                    ext_90207 = ctx_param_ext_90137;
                }
                if (cond_50901) {
                    if (memblock_alloc(ctx, &mem_90168, bytes_89422, "mem_90168")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_90170, bytes_89422, "mem_90170")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_90173, bytes_89436, "mem_90173")) {
                        err = 1;
                        goto cleanup;
                    }
                    for (int64_t i_88984 = 0; i_88984 < mz2081Uz2084U_34268; i_88984++) {
                        double eta_p_83685 = ((double *) mem_90160.mem)[i_88984];
                        double eta_p_83686 = ((double *) mem_param_90147.mem)[i_88984];
                        bool zgze_res_83688 = exp_absorb_cutoff_34276 <= eta_p_83685;
                        bool zl_res_83689 = eta_p_83685 < zs_res_49813;
                        bool x_83690 = !zgze_res_83688;
                        bool y_83691 = zl_res_83689 && x_83690;
                        bool cond_83692 = zgze_res_83688 || y_83691;
                        int64_t binop_y_90192 = i_88984 * ctx_param_ext_90136;
                        int64_t lmad_ext_90193 = ctx_param_ext_90135 + binop_y_90192;
                        int64_t ext_90195;
                        
                        if (cond_83692) {
                            ext_90195 = (int64_t) 0;
                        } else {
                            ext_90195 = lmad_ext_90193;
                        }
                        
                        int64_t ext_90194;
                        
                        if (cond_83692) {
                            ext_90194 = (int64_t) 1;
                        } else {
                            ext_90194 = ctx_param_ext_90137;
                        }
                        
                        double rescale_res_83693;
                        double rescale_res_83694;
                        
                        if (cond_83692) {
                            double log_res_83696 = futrts_log64(eta_p_83685);
                            double sqrt_res_83697 = futrts_sqrt64(eta_p_83685);
                            double zs_res_83698 = log_res_83696 / 2.0;
                            double zp_res_83699 = eta_p_83686 + zs_res_83698;
                            
                            if (memblock_alloc(ctx, &mem_90185, bytes_89422, "mem_90185")) {
                                err = 1;
                                goto cleanup;
                            }
                            for (int64_t i_88976 = 0; i_88976 < mz2081Uz2084U_34268; i_88976++) {
                                double eta_p_83701 = ((double *) mem_param_90138.mem)[ctx_param_ext_90135 + (i_88984 * ctx_param_ext_90136 + i_88976 * ctx_param_ext_90137)];
                                double zt_res_83702 = sqrt_res_83697 * eta_p_83701;
                                
                                ((double *) mem_90185.mem)[i_88976] = zt_res_83702;
                            }
                            if (memblock_set(ctx, &ext_mem_90196, &mem_90185, "mem_90185") != 0)
                                return 1;
                            rescale_res_83693 = sqrt_res_83697;
                            rescale_res_83694 = zp_res_83699;
                        } else {
                            if (memblock_set(ctx, &ext_mem_90196, &mem_param_90138, "mem_param_90138") != 0)
                                return 1;
                            rescale_res_83693 = eta_p_83685;
                            rescale_res_83694 = eta_p_83686;
                        }
                        ((double *) mem_90168.mem)[i_88984] = rescale_res_83693;
                        ((double *) mem_90170.mem)[i_88984] = rescale_res_83694;
                        lmad_copy_8b(ctx, 1, (uint64_t *) mem_90173.mem, i_88984 * mz2081Uz2084U_34268, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90196.mem, ext_90195, (int64_t []) {ext_90194}, (int64_t []) {mz2081Uz2084U_34268});
                        if (memblock_unref(ctx, &ext_mem_90196, "ext_mem_90196") != 0)
                            return 1;
                    }
                    if (memblock_set(ctx, &ext_mem_90216, &mem_90168, "mem_90168") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90213, &mem_90170, "mem_90170") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90210, &mem_90173, "mem_90173") != 0)
                        return 1;
                } else {
                    if (memblock_set(ctx, &ext_mem_90216, &mem_90160, "mem_90160") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90213, &mem_param_90147, "mem_param_90147") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90210, &mem_param_90138, "mem_param_90138") != 0)
                        return 1;
                }
                if (memblock_unref(ctx, &mem_90160, "mem_90160") != 0)
                    return 1;
                
                bool x_91100 = !defunc_0_reduce_res_83764;
                bool defunc_0_reduce_res_83707;
                
                if (x_91100) {
                    bool x_91102;
                    bool redout_88988 = 0;
                    
                    for (int64_t i_88989 = 0; i_88989 < mz2081Uz2084U_34268; i_88989++) {
                        double eta_p_62780 = ((double *) mem_90152.mem)[i_88989];
                        bool zlze_res_62781 = eta_p_62780 <= zs_res_49813;
                        bool defunc_0_op_res_50953 = zlze_res_62781 || redout_88988;
                        bool redout_tmp_91461 = defunc_0_op_res_50953;
                        
                        redout_88988 = redout_tmp_91461;
                    }
                    x_91102 = redout_88988;
                    defunc_0_reduce_res_83707 = x_91102;
                } else {
                    defunc_0_reduce_res_83707 = 0;
                }
                
                bool cond_50944 = defunc_0_reduce_res_83707 || defunc_0_reduce_res_83764;
                int64_t ext_90259;
                
                if (cond_50944) {
                    ext_90259 = (int64_t) 0;
                } else {
                    ext_90259 = ext_90209;
                }
                
                int64_t ext_90258;
                
                if (cond_50944) {
                    ext_90258 = (int64_t) 1;
                } else {
                    ext_90258 = ext_90208;
                }
                
                int64_t ext_90257;
                
                if (cond_50944) {
                    ext_90257 = mz2081Uz2084U_34268;
                } else {
                    ext_90257 = ext_90207;
                }
                if (cond_50944) {
                    if (memblock_alloc(ctx, &mem_90218, bytes_89422, "mem_90218")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_90220, bytes_89422, "mem_90220")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_90223, bytes_89436, "mem_90223")) {
                        err = 1;
                        goto cleanup;
                    }
                    for (int64_t i_89000 = 0; i_89000 < mz2081Uz2084U_34268; i_89000++) {
                        double eta_p_83726 = ((double *) mem_90152.mem)[i_89000];
                        double eta_p_83727 = ((double *) mem_param_90150.mem)[i_89000];
                        bool zgze_res_83729 = exp_absorb_cutoff_34276 <= eta_p_83726;
                        bool zl_res_83730 = eta_p_83726 < zs_res_49813;
                        bool x_83731 = !zgze_res_83729;
                        bool y_83732 = zl_res_83730 && x_83731;
                        bool cond_83733 = zgze_res_83729 || y_83732;
                        int64_t binop_y_90242 = i_89000 * ext_90207;
                        int64_t lmad_ext_90243 = ext_90209 + binop_y_90242;
                        int64_t ext_90245;
                        
                        if (cond_83733) {
                            ext_90245 = (int64_t) 0;
                        } else {
                            ext_90245 = lmad_ext_90243;
                        }
                        
                        int64_t ext_90244;
                        
                        if (cond_83733) {
                            ext_90244 = (int64_t) 1;
                        } else {
                            ext_90244 = ext_90208;
                        }
                        
                        double rescale_res_83734;
                        double rescale_res_83735;
                        
                        if (cond_83733) {
                            double log_res_83737 = futrts_log64(eta_p_83726);
                            double sqrt_res_83738 = futrts_sqrt64(eta_p_83726);
                            double zs_res_83739 = log_res_83737 / 2.0;
                            double zp_res_83740 = eta_p_83727 + zs_res_83739;
                            
                            if (memblock_alloc(ctx, &mem_90235, bytes_89422, "mem_90235")) {
                                err = 1;
                                goto cleanup;
                            }
                            for (int64_t i_88992 = 0; i_88992 < mz2081Uz2084U_34268; i_88992++) {
                                double eta_p_83742 = ((double *) ext_mem_90210.mem)[ext_90209 + (i_88992 * ext_90208 + i_89000 * ext_90207)];
                                double zt_res_83743 = sqrt_res_83738 * eta_p_83742;
                                
                                ((double *) mem_90235.mem)[i_88992] = zt_res_83743;
                            }
                            if (memblock_set(ctx, &ext_mem_90246, &mem_90235, "mem_90235") != 0)
                                return 1;
                            rescale_res_83734 = sqrt_res_83738;
                            rescale_res_83735 = zp_res_83740;
                        } else {
                            if (memblock_set(ctx, &ext_mem_90246, &ext_mem_90210, "ext_mem_90210") != 0)
                                return 1;
                            rescale_res_83734 = eta_p_83726;
                            rescale_res_83735 = eta_p_83727;
                        }
                        ((double *) mem_90218.mem)[i_89000] = rescale_res_83734;
                        ((double *) mem_90220.mem)[i_89000] = rescale_res_83735;
                        lmad_copy_8b(ctx, 1, (uint64_t *) mem_90223.mem, i_89000 * mz2081Uz2084U_34268, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90246.mem, ext_90245, (int64_t []) {ext_90244}, (int64_t []) {mz2081Uz2084U_34268});
                        if (memblock_unref(ctx, &ext_mem_90246, "ext_mem_90246") != 0)
                            return 1;
                    }
                    if (memblock_set(ctx, &ext_mem_90266, &mem_90218, "mem_90218") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90263, &mem_90220, "mem_90220") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90260, &mem_90223, "mem_90223") != 0)
                        return 1;
                } else {
                    if (memblock_set(ctx, &ext_mem_90266, &mem_90152, "mem_90152") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90263, &mem_param_90150, "mem_param_90150") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90260, &ext_mem_90210, "ext_mem_90210") != 0)
                        return 1;
                }
                if (memblock_unref(ctx, &mem_90152, "mem_90152") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90210, "ext_mem_90210") != 0)
                    return 1;
                
                bool defunc_0_reduce_res_83769;
                bool redout_89004 = 1;
                
                for (int64_t i_89005 = 0; i_89005 < mz2081Uz2084U_34268; i_89005++) {
                    double eta_p_62548 = ((double *) ext_mem_90216.mem)[i_89005];
                    bool isnan_res_62549 = futrts_isnan64(eta_p_62548);
                    bool not_res_62550 = !isnan_res_62549;
                    bool x_50989 = not_res_62550 && redout_89004;
                    bool redout_tmp_91466 = x_50989;
                    
                    redout_89004 = redout_tmp_91466;
                }
                defunc_0_reduce_res_83769 = redout_89004;
                
                bool loop_cond_50990;
                
                if (defunc_0_reduce_res_83769) {
                    bool defunc_0_reduce_comm_res_83751;
                    bool redout_89006 = 0;
                    
                    for (int64_t i_89007 = 0; i_89007 < mz2081Uz2084U_34268; i_89007++) {
                        double eta_p_83752 = ((double *) ext_mem_90216.mem)[i_89007];
                        double eta_p_83753 = ((double *) mem_param_90141.mem)[i_89007];
                        double zt_res_83754 = zp_res_83654 * eta_p_83752;
                        bool zgze_res_83755 = eta_p_83753 <= zt_res_83754;
                        double zt_res_83756 = zp_res_83654 * eta_p_83753;
                        bool zgze_res_83757 = eta_p_83752 <= zt_res_83756;
                        bool x_83758 = zgze_res_83755 && zgze_res_83757;
                        bool not_res_83759 = !x_83758;
                        bool defunc_0_op_res_83762 = not_res_83759 || redout_89006;
                        bool redout_tmp_91467 = defunc_0_op_res_83762;
                        
                        redout_89006 = redout_tmp_91467;
                    }
                    defunc_0_reduce_comm_res_83751 = redout_89006;
                    loop_cond_50990 = defunc_0_reduce_comm_res_83751;
                } else {
                    loop_cond_50990 = 0;
                }
                if (memblock_set(ctx, &mem_param_tmp_91425, &mem_param_90138, "mem_param_90138") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91426, &mem_param_90141, "mem_param_90141") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91427, &mem_param_90147, "mem_param_90147") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91428, &mem_param_90150, "mem_param_90150") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91429, &ext_mem_90260, "ext_mem_90260") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91430, &ext_mem_90216, "ext_mem_90216") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91431, &ext_mem_90266, "ext_mem_90266") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91432, &ext_mem_90213, "ext_mem_90213") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91433, &ext_mem_90263, "ext_mem_90263") != 0)
                    return 1;
                
                int64_t ctx_param_ext_tmp_91434 = ctx_param_ext_90135;
                int64_t ctx_param_ext_tmp_91435 = ctx_param_ext_90136;
                int64_t ctx_param_ext_tmp_91436 = ctx_param_ext_90137;
                int64_t ctx_param_ext_tmp_91437 = ext_90259;
                int64_t ctx_param_ext_tmp_91438 = ext_90258;
                int64_t ctx_param_ext_tmp_91439 = ext_90257;
                bool loop_while_tmp_91440 = loop_cond_50990;
                
                if (memblock_set(ctx, &mem_param_90125, &mem_param_tmp_91425, "mem_param_tmp_91425") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90128, &mem_param_tmp_91426, "mem_param_tmp_91426") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90131, &mem_param_tmp_91427, "mem_param_tmp_91427") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90134, &mem_param_tmp_91428, "mem_param_tmp_91428") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90138, &mem_param_tmp_91429, "mem_param_tmp_91429") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90141, &mem_param_tmp_91430, "mem_param_tmp_91430") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90144, &mem_param_tmp_91431, "mem_param_tmp_91431") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90147, &mem_param_tmp_91432, "mem_param_tmp_91432") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90150, &mem_param_tmp_91433, "mem_param_tmp_91433") != 0)
                    return 1;
                ctx_param_ext_90122 = ctx_param_ext_tmp_91434;
                ctx_param_ext_90123 = ctx_param_ext_tmp_91435;
                ctx_param_ext_90124 = ctx_param_ext_tmp_91436;
                ctx_param_ext_90135 = ctx_param_ext_tmp_91437;
                ctx_param_ext_90136 = ctx_param_ext_tmp_91438;
                ctx_param_ext_90137 = ctx_param_ext_tmp_91439;
                loop_while_50826 = loop_while_tmp_91440;
            }
            if (memblock_set(ctx, &ext_mem_90295, &mem_param_90125, "mem_param_90125") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_90294, &mem_param_90128, "mem_param_90128") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_90293, &mem_param_90131, "mem_param_90131") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_90292, &mem_param_90134, "mem_param_90134") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_90291, &mem_param_90138, "mem_param_90138") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_90290, &mem_param_90141, "mem_param_90141") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_90289, &mem_param_90144, "mem_param_90144") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_90288, &mem_param_90147, "mem_param_90147") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_90287, &mem_param_90150, "mem_param_90150") != 0)
                return 1;
            ext_90286 = ctx_param_ext_90122;
            ext_90285 = ctx_param_ext_90123;
            ext_90284 = ctx_param_ext_90124;
            ext_90277 = ctx_param_ext_90135;
            ext_90276 = ctx_param_ext_90136;
            ext_90275 = ctx_param_ext_90137;
            algo5_core_loop_res_50816 = loop_while_50826;
            if (memblock_unref(ctx, &ext_mem_90068, "ext_mem_90068") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90071, "ext_mem_90071") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90115, "ext_mem_90115") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90118, "ext_mem_90118") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90121, "ext_mem_90121") != 0)
                return 1;
            
            bool defunc_0_reduce_res_84729;
            bool redout_89008 = 1;
            
            for (int64_t i_89009 = 0; i_89009 < mz2081Uz2084U_34268; i_89009++) {
                double eta_p_60682 = ((double *) ext_mem_90290.mem)[i_89009];
                bool isnan_res_60683 = futrts_isnan64(eta_p_60682);
                bool not_res_60684 = !isnan_res_60683;
                bool x_51014 = not_res_60684 && redout_89008;
                bool redout_tmp_91468 = x_51014;
                
                redout_89008 = redout_tmp_91468;
            }
            defunc_0_reduce_res_84729 = redout_89008;
            
            int64_t ext_90574;
            int64_t ext_90573;
            int64_t ext_90572;
            
            if (defunc_0_reduce_res_84729) {
                if (memblock_set(ctx, &ext_mem_90575, &ext_mem_90291, "ext_mem_90291") != 0)
                    return 1;
                ext_90574 = ext_90277;
                ext_90573 = ext_90276;
                ext_90572 = ext_90275;
                if (memblock_set(ctx, &ext_mem_90571, &ext_mem_90290, "ext_mem_90290") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90568, &ext_mem_90289, "ext_mem_90289") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90565, &ext_mem_90288, "ext_mem_90288") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90562, &ext_mem_90287, "ext_mem_90287") != 0)
                    return 1;
            } else {
                if (memblock_alloc(ctx, &mem_90297, bytes_89422, "mem_90297")) {
                    err = 1;
                    goto cleanup;
                }
                
                bool defunc_0_reduce_res_83973;
                bool redout_89013 = 0;
                
                for (int64_t i_89015 = 0; i_89015 < mz2081Uz2084U_34268; i_89015++) {
                    double eta_p_63115 = ((double *) mem_89416)[eta_p_49442 * mz2081Uz2084U_34268 + i_89015];
                    double eta_p_63116 = ((double *) ext_mem_90292.mem)[i_89015];
                    double defunc_0_reduce_res_83771;
                    double redout_89010 = 0.0;
                    
                    for (int64_t i_89011 = 0; i_89011 < mz2081Uz2084U_34268; i_89011++) {
                        double eta_p_63140 = ((double *) ext_mem_90294.mem)[i_89011];
                        double eta_p_63141 = ((double *) ext_mem_90295.mem)[ext_90286 + (i_89011 * ext_90285 + i_89015 * ext_90284)];
                        double zt_res_63142 = eta_p_63140 * eta_p_63141;
                        double zp_res_63125 = zt_res_63142 + redout_89010;
                        double redout_tmp_91471 = zp_res_63125;
                        
                        redout_89010 = redout_tmp_91471;
                    }
                    defunc_0_reduce_res_83771 = redout_89010;
                    
                    double zs_res_63127 = defunc_0_reduce_res_83771 / eta_p_63115;
                    double ztzt_res_63129 = fpow64(zs_res_63127, zs_res_49436);
                    double zt_res_63131 = zs_res_49437 * eta_p_63116;
                    double exp_res_63133 = futrts_exp64(zt_res_63131);
                    double zt_res_63135 = ztzt_res_63129 * exp_res_63133;
                    bool zgze_res_63137 = exp_absorb_cutoff_34276 <= zt_res_63135;
                    bool defunc_0_op_res_51136 = zgze_res_63137 || redout_89013;
                    
                    ((double *) mem_90297.mem)[i_89015] = zt_res_63135;
                    
                    bool redout_tmp_91469 = defunc_0_op_res_51136;
                    
                    redout_89013 = redout_tmp_91469;
                }
                defunc_0_reduce_res_83973 = redout_89013;
                if (memblock_alloc(ctx, &mem_90305, bytes_89422, "mem_90305")) {
                    err = 1;
                    goto cleanup;
                }
                
                bool defunc_0_reduce_res_83976;
                bool redout_89020 = 0;
                
                for (int64_t i_89022 = 0; i_89022 < mz2081Uz2084U_34268; i_89022++) {
                    double eta_p_63033 = ((double *) mem_89416)[eta_p_49441 * mz2081Uz2084U_34268 + i_89022];
                    double eta_p_63034 = ((double *) ext_mem_90293.mem)[i_89022];
                    double defunc_0_reduce_res_83772;
                    double redout_89017 = 0.0;
                    
                    for (int64_t i_89018 = 0; i_89018 < mz2081Uz2084U_34268; i_89018++) {
                        double eta_p_63146 = ((double *) mem_90297.mem)[i_89018];
                        double eta_p_63147 = ((double *) ext_mem_90295.mem)[ext_90286 + (i_89022 * ext_90285 + i_89018 * ext_90284)];
                        double zt_res_63148 = eta_p_63146 * eta_p_63147;
                        double zp_res_63043 = zt_res_63148 + redout_89017;
                        double redout_tmp_91474 = zp_res_63043;
                        
                        redout_89017 = redout_tmp_91474;
                    }
                    defunc_0_reduce_res_83772 = redout_89017;
                    
                    double zs_res_63045 = defunc_0_reduce_res_83772 / eta_p_63033;
                    double ztzt_res_63047 = fpow64(zs_res_63045, zs_res_49432);
                    double zt_res_63049 = zs_res_49433 * eta_p_63034;
                    double exp_res_63051 = futrts_exp64(zt_res_63049);
                    double zt_res_63053 = ztzt_res_63047 * exp_res_63051;
                    bool zgze_res_63055 = exp_absorb_cutoff_34276 <= zt_res_63053;
                    bool defunc_0_op_res_51093 = zgze_res_63055 || redout_89020;
                    
                    ((double *) mem_90305.mem)[i_89022] = zt_res_63053;
                    
                    bool redout_tmp_91472 = defunc_0_op_res_51093;
                    
                    redout_89020 = redout_tmp_91472;
                }
                defunc_0_reduce_res_83976 = redout_89020;
                
                bool x_90962 = !defunc_0_reduce_res_83976;
                bool defunc_0_reduce_res_83773;
                
                if (x_90962) {
                    bool x_90964;
                    bool redout_89024 = 0;
                    
                    for (int64_t i_89025 = 0; i_89025 < mz2081Uz2084U_34268; i_89025++) {
                        double eta_p_63152 = ((double *) mem_90305.mem)[i_89025];
                        bool zlze_res_63153 = eta_p_63152 <= zs_res_49813;
                        bool defunc_0_op_res_51103 = zlze_res_63153 || redout_89024;
                        bool redout_tmp_91475 = defunc_0_op_res_51103;
                        
                        redout_89024 = redout_tmp_91475;
                    }
                    x_90964 = redout_89024;
                    defunc_0_reduce_res_83773 = x_90964;
                } else {
                    defunc_0_reduce_res_83773 = 0;
                }
                
                bool cond_51094 = defunc_0_reduce_res_83773 || defunc_0_reduce_res_83976;
                int64_t ext_90354;
                
                if (cond_51094) {
                    ext_90354 = (int64_t) 0;
                } else {
                    ext_90354 = ext_90286;
                }
                
                int64_t ext_90353;
                
                if (cond_51094) {
                    ext_90353 = mz2081Uz2084U_34268;
                } else {
                    ext_90353 = ext_90285;
                }
                
                int64_t ext_90352;
                
                if (cond_51094) {
                    ext_90352 = (int64_t) 1;
                } else {
                    ext_90352 = ext_90284;
                }
                if (cond_51094) {
                    if (memblock_alloc(ctx, &mem_90313, bytes_89422, "mem_90313")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_90315, bytes_89422, "mem_90315")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_90318, bytes_89436, "mem_90318")) {
                        err = 1;
                        goto cleanup;
                    }
                    for (int64_t i_89036 = 0; i_89036 < mz2081Uz2084U_34268; i_89036++) {
                        double eta_p_83790 = ((double *) mem_90305.mem)[i_89036];
                        double eta_p_83791 = ((double *) ext_mem_90293.mem)[i_89036];
                        bool zgze_res_83793 = exp_absorb_cutoff_34276 <= eta_p_83790;
                        bool zl_res_83794 = eta_p_83790 < zs_res_49813;
                        bool x_83795 = !zgze_res_83793;
                        bool y_83796 = zl_res_83794 && x_83795;
                        bool cond_83797 = zgze_res_83793 || y_83796;
                        int64_t binop_y_90337 = i_89036 * ext_90285;
                        int64_t lmad_ext_90338 = ext_90286 + binop_y_90337;
                        int64_t ext_90340;
                        
                        if (cond_83797) {
                            ext_90340 = (int64_t) 0;
                        } else {
                            ext_90340 = lmad_ext_90338;
                        }
                        
                        int64_t ext_90339;
                        
                        if (cond_83797) {
                            ext_90339 = (int64_t) 1;
                        } else {
                            ext_90339 = ext_90284;
                        }
                        
                        double rescale_res_83798;
                        double rescale_res_83799;
                        
                        if (cond_83797) {
                            double log_res_83801 = futrts_log64(eta_p_83790);
                            double sqrt_res_83802 = futrts_sqrt64(eta_p_83790);
                            double zs_res_83803 = log_res_83801 / 2.0;
                            double zp_res_83804 = eta_p_83791 + zs_res_83803;
                            
                            if (memblock_alloc(ctx, &mem_90330, bytes_89422, "mem_90330")) {
                                err = 1;
                                goto cleanup;
                            }
                            for (int64_t i_89028 = 0; i_89028 < mz2081Uz2084U_34268; i_89028++) {
                                double eta_p_83806 = ((double *) ext_mem_90295.mem)[ext_90286 + (i_89036 * ext_90285 + i_89028 * ext_90284)];
                                double zt_res_83807 = sqrt_res_83802 * eta_p_83806;
                                
                                ((double *) mem_90330.mem)[i_89028] = zt_res_83807;
                            }
                            if (memblock_set(ctx, &ext_mem_90341, &mem_90330, "mem_90330") != 0)
                                return 1;
                            rescale_res_83798 = sqrt_res_83802;
                            rescale_res_83799 = zp_res_83804;
                        } else {
                            if (memblock_set(ctx, &ext_mem_90341, &ext_mem_90295, "ext_mem_90295") != 0)
                                return 1;
                            rescale_res_83798 = eta_p_83790;
                            rescale_res_83799 = eta_p_83791;
                        }
                        ((double *) mem_90313.mem)[i_89036] = rescale_res_83798;
                        ((double *) mem_90315.mem)[i_89036] = rescale_res_83799;
                        lmad_copy_8b(ctx, 1, (uint64_t *) mem_90318.mem, i_89036 * mz2081Uz2084U_34268, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90341.mem, ext_90340, (int64_t []) {ext_90339}, (int64_t []) {mz2081Uz2084U_34268});
                        if (memblock_unref(ctx, &ext_mem_90341, "ext_mem_90341") != 0)
                            return 1;
                    }
                    if (memblock_set(ctx, &ext_mem_90361, &mem_90313, "mem_90313") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90358, &mem_90315, "mem_90315") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90355, &mem_90318, "mem_90318") != 0)
                        return 1;
                } else {
                    if (memblock_set(ctx, &ext_mem_90361, &mem_90305, "mem_90305") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90358, &ext_mem_90293, "ext_mem_90293") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90355, &ext_mem_90295, "ext_mem_90295") != 0)
                        return 1;
                }
                if (memblock_unref(ctx, &mem_90305, "mem_90305") != 0)
                    return 1;
                
                bool x_90958 = !defunc_0_reduce_res_83973;
                bool defunc_0_reduce_res_83812;
                
                if (x_90958) {
                    bool x_90960;
                    bool redout_89040 = 0;
                    
                    for (int64_t i_89041 = 0; i_89041 < mz2081Uz2084U_34268; i_89041++) {
                        double eta_p_63195 = ((double *) mem_90297.mem)[i_89041];
                        bool zlze_res_63196 = eta_p_63195 <= zs_res_49813;
                        bool defunc_0_op_res_51146 = zlze_res_63196 || redout_89040;
                        bool redout_tmp_91480 = defunc_0_op_res_51146;
                        
                        redout_89040 = redout_tmp_91480;
                    }
                    x_90960 = redout_89040;
                    defunc_0_reduce_res_83812 = x_90960;
                } else {
                    defunc_0_reduce_res_83812 = 0;
                }
                
                bool cond_51137 = defunc_0_reduce_res_83812 || defunc_0_reduce_res_83973;
                int64_t ext_90404;
                
                if (cond_51137) {
                    ext_90404 = (int64_t) 0;
                } else {
                    ext_90404 = ext_90354;
                }
                
                int64_t ext_90403;
                
                if (cond_51137) {
                    ext_90403 = (int64_t) 1;
                } else {
                    ext_90403 = ext_90353;
                }
                
                int64_t ext_90402;
                
                if (cond_51137) {
                    ext_90402 = mz2081Uz2084U_34268;
                } else {
                    ext_90402 = ext_90352;
                }
                if (cond_51137) {
                    if (memblock_alloc(ctx, &mem_90363, bytes_89422, "mem_90363")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_90365, bytes_89422, "mem_90365")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_90368, bytes_89436, "mem_90368")) {
                        err = 1;
                        goto cleanup;
                    }
                    for (int64_t i_89052 = 0; i_89052 < mz2081Uz2084U_34268; i_89052++) {
                        double eta_p_83831 = ((double *) mem_90297.mem)[i_89052];
                        double eta_p_83832 = ((double *) ext_mem_90292.mem)[i_89052];
                        bool zgze_res_83834 = exp_absorb_cutoff_34276 <= eta_p_83831;
                        bool zl_res_83835 = eta_p_83831 < zs_res_49813;
                        bool x_83836 = !zgze_res_83834;
                        bool y_83837 = zl_res_83835 && x_83836;
                        bool cond_83838 = zgze_res_83834 || y_83837;
                        int64_t binop_y_90387 = i_89052 * ext_90352;
                        int64_t lmad_ext_90388 = ext_90354 + binop_y_90387;
                        int64_t ext_90390;
                        
                        if (cond_83838) {
                            ext_90390 = (int64_t) 0;
                        } else {
                            ext_90390 = lmad_ext_90388;
                        }
                        
                        int64_t ext_90389;
                        
                        if (cond_83838) {
                            ext_90389 = (int64_t) 1;
                        } else {
                            ext_90389 = ext_90353;
                        }
                        
                        double rescale_res_83839;
                        double rescale_res_83840;
                        
                        if (cond_83838) {
                            double log_res_83842 = futrts_log64(eta_p_83831);
                            double sqrt_res_83843 = futrts_sqrt64(eta_p_83831);
                            double zs_res_83844 = log_res_83842 / 2.0;
                            double zp_res_83845 = eta_p_83832 + zs_res_83844;
                            
                            if (memblock_alloc(ctx, &mem_90380, bytes_89422, "mem_90380")) {
                                err = 1;
                                goto cleanup;
                            }
                            for (int64_t i_89044 = 0; i_89044 < mz2081Uz2084U_34268; i_89044++) {
                                double eta_p_83847 = ((double *) ext_mem_90355.mem)[ext_90354 + (i_89044 * ext_90353 + i_89052 * ext_90352)];
                                double zt_res_83848 = sqrt_res_83843 * eta_p_83847;
                                
                                ((double *) mem_90380.mem)[i_89044] = zt_res_83848;
                            }
                            if (memblock_set(ctx, &ext_mem_90391, &mem_90380, "mem_90380") != 0)
                                return 1;
                            rescale_res_83839 = sqrt_res_83843;
                            rescale_res_83840 = zp_res_83845;
                        } else {
                            if (memblock_set(ctx, &ext_mem_90391, &ext_mem_90355, "ext_mem_90355") != 0)
                                return 1;
                            rescale_res_83839 = eta_p_83831;
                            rescale_res_83840 = eta_p_83832;
                        }
                        ((double *) mem_90363.mem)[i_89052] = rescale_res_83839;
                        ((double *) mem_90365.mem)[i_89052] = rescale_res_83840;
                        lmad_copy_8b(ctx, 1, (uint64_t *) mem_90368.mem, i_89052 * mz2081Uz2084U_34268, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90391.mem, ext_90390, (int64_t []) {ext_90389}, (int64_t []) {mz2081Uz2084U_34268});
                        if (memblock_unref(ctx, &ext_mem_90391, "ext_mem_90391") != 0)
                            return 1;
                    }
                    if (memblock_set(ctx, &ext_mem_90411, &mem_90363, "mem_90363") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90408, &mem_90365, "mem_90365") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90405, &mem_90368, "mem_90368") != 0)
                        return 1;
                } else {
                    if (memblock_set(ctx, &ext_mem_90411, &mem_90297, "mem_90297") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90408, &ext_mem_90292, "ext_mem_90292") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90405, &ext_mem_90355, "ext_mem_90355") != 0)
                        return 1;
                }
                if (memblock_unref(ctx, &mem_90297, "mem_90297") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90355, "ext_mem_90355") != 0)
                    return 1;
                
                bool defunc_0_reduce_res_83978;
                bool redout_89056 = 1;
                
                for (int64_t i_89057 = 0; i_89057 < mz2081Uz2084U_34268; i_89057++) {
                    double eta_p_62963 = ((double *) ext_mem_90361.mem)[i_89057];
                    bool isnan_res_62964 = futrts_isnan64(eta_p_62963);
                    bool not_res_62965 = !isnan_res_62964;
                    bool x_51182 = not_res_62965 && redout_89056;
                    bool redout_tmp_91485 = x_51182;
                    
                    redout_89056 = redout_tmp_91485;
                }
                defunc_0_reduce_res_83978 = redout_89056;
                
                bool defunc_0_reduce_comm_res_83856;
                
                if (defunc_0_reduce_res_83978) {
                    bool x_90956;
                    bool redout_89058 = 0;
                    
                    for (int64_t i_89059 = 0; i_89059 < mz2081Uz2084U_34268; i_89059++) {
                        double eta_p_83857 = ((double *) ext_mem_90361.mem)[i_89059];
                        double eta_p_83858 = ((double *) ext_mem_90294.mem)[i_89059];
                        double zt_res_83859 = zp_res_83654 * eta_p_83857;
                        bool zgze_res_83860 = eta_p_83858 <= zt_res_83859;
                        double zt_res_83861 = zp_res_83654 * eta_p_83858;
                        bool zgze_res_83862 = eta_p_83857 <= zt_res_83861;
                        bool x_83863 = zgze_res_83860 && zgze_res_83862;
                        bool not_res_83864 = !x_83863;
                        bool defunc_0_op_res_83867 = not_res_83864 || redout_89058;
                        bool redout_tmp_91486 = defunc_0_op_res_83867;
                        
                        redout_89058 = redout_tmp_91486;
                    }
                    x_90956 = redout_89058;
                    defunc_0_reduce_comm_res_83856 = x_90956;
                } else {
                    defunc_0_reduce_comm_res_83856 = 0;
                }
                
                bool x_91093 = defunc_0_reduce_comm_res_83856 && defunc_0_reduce_res_83978;
                int64_t ext_90554;
                int64_t ext_90553;
                int64_t ext_90552;
                bool algo5_core_loop_res_f_res_51199;
                bool loop_while_51205;
                int64_t ctx_param_ext_90412;
                int64_t ctx_param_ext_90413;
                int64_t ctx_param_ext_90414;
                
                if (memblock_set(ctx, &mem_param_90415, &ext_mem_90405, "ext_mem_90405") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90418, &ext_mem_90361, "ext_mem_90361") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90421, &ext_mem_90411, "ext_mem_90411") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90424, &ext_mem_90358, "ext_mem_90358") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90427, &ext_mem_90408, "ext_mem_90408") != 0)
                    return 1;
                ctx_param_ext_90412 = ext_90404;
                ctx_param_ext_90413 = ext_90403;
                ctx_param_ext_90414 = ext_90402;
                loop_while_51205 = x_91093;
                while (loop_while_51205) {
                    if (memblock_alloc(ctx, &mem_90429, bytes_89422, "mem_90429")) {
                        err = 1;
                        goto cleanup;
                    }
                    
                    bool defunc_0_reduce_res_83967;
                    bool redout_89063 = 0;
                    
                    for (int64_t i_89065 = 0; i_89065 < mz2081Uz2084U_34268; i_89065++) {
                        double eta_p_63418 = ((double *) mem_89416)[eta_p_49442 * mz2081Uz2084U_34268 + i_89065];
                        double eta_p_63419 = ((double *) mem_param_90427.mem)[i_89065];
                        double defunc_0_reduce_res_83869;
                        double redout_89060 = 0.0;
                        
                        for (int64_t i_89061 = 0; i_89061 < mz2081Uz2084U_34268; i_89061++) {
                            double eta_p_63443 = ((double *) mem_param_90418.mem)[i_89061];
                            double eta_p_63444 = ((double *) mem_param_90415.mem)[ctx_param_ext_90412 + (i_89061 * ctx_param_ext_90413 + i_89065 * ctx_param_ext_90414)];
                            double zt_res_63445 = eta_p_63443 * eta_p_63444;
                            double zp_res_63428 = zt_res_63445 + redout_89060;
                            double redout_tmp_91503 = zp_res_63428;
                            
                            redout_89060 = redout_tmp_91503;
                        }
                        defunc_0_reduce_res_83869 = redout_89060;
                        
                        double zs_res_63430 = defunc_0_reduce_res_83869 / eta_p_63418;
                        double ztzt_res_63432 = fpow64(zs_res_63430, zs_res_49436);
                        double zt_res_63434 = zs_res_49437 * eta_p_63419;
                        double exp_res_63436 = futrts_exp64(zt_res_63434);
                        double zt_res_63438 = ztzt_res_63432 * exp_res_63436;
                        bool zgze_res_63440 = exp_absorb_cutoff_34276 <= zt_res_63438;
                        bool defunc_0_op_res_51318 = zgze_res_63440 || redout_89063;
                        
                        ((double *) mem_90429.mem)[i_89065] = zt_res_63438;
                        
                        bool redout_tmp_91501 = defunc_0_op_res_51318;
                        
                        redout_89063 = redout_tmp_91501;
                    }
                    defunc_0_reduce_res_83967 = redout_89063;
                    if (memblock_alloc(ctx, &mem_90437, bytes_89422, "mem_90437")) {
                        err = 1;
                        goto cleanup;
                    }
                    
                    bool defunc_0_reduce_res_83970;
                    bool redout_89070 = 0;
                    
                    for (int64_t i_89072 = 0; i_89072 < mz2081Uz2084U_34268; i_89072++) {
                        double eta_p_63336 = ((double *) mem_89416)[eta_p_49441 * mz2081Uz2084U_34268 + i_89072];
                        double eta_p_63337 = ((double *) mem_param_90424.mem)[i_89072];
                        double defunc_0_reduce_res_83870;
                        double redout_89067 = 0.0;
                        
                        for (int64_t i_89068 = 0; i_89068 < mz2081Uz2084U_34268; i_89068++) {
                            double eta_p_63449 = ((double *) mem_90429.mem)[i_89068];
                            double eta_p_63450 = ((double *) mem_param_90415.mem)[ctx_param_ext_90412 + (i_89072 * ctx_param_ext_90413 + i_89068 * ctx_param_ext_90414)];
                            double zt_res_63451 = eta_p_63449 * eta_p_63450;
                            double zp_res_63346 = zt_res_63451 + redout_89067;
                            double redout_tmp_91506 = zp_res_63346;
                            
                            redout_89067 = redout_tmp_91506;
                        }
                        defunc_0_reduce_res_83870 = redout_89067;
                        
                        double zs_res_63348 = defunc_0_reduce_res_83870 / eta_p_63336;
                        double ztzt_res_63350 = fpow64(zs_res_63348, zs_res_49432);
                        double zt_res_63352 = zs_res_49433 * eta_p_63337;
                        double exp_res_63354 = futrts_exp64(zt_res_63352);
                        double zt_res_63356 = ztzt_res_63350 * exp_res_63354;
                        bool zgze_res_63358 = exp_absorb_cutoff_34276 <= zt_res_63356;
                        bool defunc_0_op_res_51275 = zgze_res_63358 || redout_89070;
                        
                        ((double *) mem_90437.mem)[i_89072] = zt_res_63356;
                        
                        bool redout_tmp_91504 = defunc_0_op_res_51275;
                        
                        redout_89070 = redout_tmp_91504;
                    }
                    defunc_0_reduce_res_83970 = redout_89070;
                    
                    bool x_90950 = !defunc_0_reduce_res_83970;
                    bool defunc_0_reduce_res_83871;
                    
                    if (x_90950) {
                        bool x_90952;
                        bool redout_89074 = 0;
                        
                        for (int64_t i_89075 = 0; i_89075 < mz2081Uz2084U_34268; i_89075++) {
                            double eta_p_63455 = ((double *) mem_90437.mem)[i_89075];
                            bool zlze_res_63456 = eta_p_63455 <= zs_res_49813;
                            bool defunc_0_op_res_51285 = zlze_res_63456 || redout_89074;
                            bool redout_tmp_91507 = defunc_0_op_res_51285;
                            
                            redout_89074 = redout_tmp_91507;
                        }
                        x_90952 = redout_89074;
                        defunc_0_reduce_res_83871 = x_90952;
                    } else {
                        defunc_0_reduce_res_83871 = 0;
                    }
                    
                    bool cond_51276 = defunc_0_reduce_res_83871 || defunc_0_reduce_res_83970;
                    int64_t ext_90486;
                    
                    if (cond_51276) {
                        ext_90486 = (int64_t) 0;
                    } else {
                        ext_90486 = ctx_param_ext_90412;
                    }
                    
                    int64_t ext_90485;
                    
                    if (cond_51276) {
                        ext_90485 = mz2081Uz2084U_34268;
                    } else {
                        ext_90485 = ctx_param_ext_90413;
                    }
                    
                    int64_t ext_90484;
                    
                    if (cond_51276) {
                        ext_90484 = (int64_t) 1;
                    } else {
                        ext_90484 = ctx_param_ext_90414;
                    }
                    if (cond_51276) {
                        if (memblock_alloc(ctx, &mem_90445, bytes_89422, "mem_90445")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (memblock_alloc(ctx, &mem_90447, bytes_89422, "mem_90447")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (memblock_alloc(ctx, &mem_90450, bytes_89436, "mem_90450")) {
                            err = 1;
                            goto cleanup;
                        }
                        for (int64_t i_89086 = 0; i_89086 < mz2081Uz2084U_34268; i_89086++) {
                            double eta_p_83888 = ((double *) mem_90437.mem)[i_89086];
                            double eta_p_83889 = ((double *) mem_param_90424.mem)[i_89086];
                            bool zgze_res_83891 = exp_absorb_cutoff_34276 <= eta_p_83888;
                            bool zl_res_83892 = eta_p_83888 < zs_res_49813;
                            bool x_83893 = !zgze_res_83891;
                            bool y_83894 = zl_res_83892 && x_83893;
                            bool cond_83895 = zgze_res_83891 || y_83894;
                            int64_t binop_y_90469 = i_89086 * ctx_param_ext_90413;
                            int64_t lmad_ext_90470 = ctx_param_ext_90412 + binop_y_90469;
                            int64_t ext_90472;
                            
                            if (cond_83895) {
                                ext_90472 = (int64_t) 0;
                            } else {
                                ext_90472 = lmad_ext_90470;
                            }
                            
                            int64_t ext_90471;
                            
                            if (cond_83895) {
                                ext_90471 = (int64_t) 1;
                            } else {
                                ext_90471 = ctx_param_ext_90414;
                            }
                            
                            double rescale_res_83896;
                            double rescale_res_83897;
                            
                            if (cond_83895) {
                                double log_res_83899 = futrts_log64(eta_p_83888);
                                double sqrt_res_83900 = futrts_sqrt64(eta_p_83888);
                                double zs_res_83901 = log_res_83899 / 2.0;
                                double zp_res_83902 = eta_p_83889 + zs_res_83901;
                                
                                if (memblock_alloc(ctx, &mem_90462, bytes_89422, "mem_90462")) {
                                    err = 1;
                                    goto cleanup;
                                }
                                for (int64_t i_89078 = 0; i_89078 < mz2081Uz2084U_34268; i_89078++) {
                                    double eta_p_83904 = ((double *) mem_param_90415.mem)[ctx_param_ext_90412 + (i_89086 * ctx_param_ext_90413 + i_89078 * ctx_param_ext_90414)];
                                    double zt_res_83905 = sqrt_res_83900 * eta_p_83904;
                                    
                                    ((double *) mem_90462.mem)[i_89078] = zt_res_83905;
                                }
                                if (memblock_set(ctx, &ext_mem_90473, &mem_90462, "mem_90462") != 0)
                                    return 1;
                                rescale_res_83896 = sqrt_res_83900;
                                rescale_res_83897 = zp_res_83902;
                            } else {
                                if (memblock_set(ctx, &ext_mem_90473, &mem_param_90415, "mem_param_90415") != 0)
                                    return 1;
                                rescale_res_83896 = eta_p_83888;
                                rescale_res_83897 = eta_p_83889;
                            }
                            ((double *) mem_90445.mem)[i_89086] = rescale_res_83896;
                            ((double *) mem_90447.mem)[i_89086] = rescale_res_83897;
                            lmad_copy_8b(ctx, 1, (uint64_t *) mem_90450.mem, i_89086 * mz2081Uz2084U_34268, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90473.mem, ext_90472, (int64_t []) {ext_90471}, (int64_t []) {mz2081Uz2084U_34268});
                            if (memblock_unref(ctx, &ext_mem_90473, "ext_mem_90473") != 0)
                                return 1;
                        }
                        if (memblock_set(ctx, &ext_mem_90493, &mem_90445, "mem_90445") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90490, &mem_90447, "mem_90447") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90487, &mem_90450, "mem_90450") != 0)
                            return 1;
                    } else {
                        if (memblock_set(ctx, &ext_mem_90493, &mem_90437, "mem_90437") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90490, &mem_param_90424, "mem_param_90424") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90487, &mem_param_90415, "mem_param_90415") != 0)
                            return 1;
                    }
                    if (memblock_unref(ctx, &mem_90437, "mem_90437") != 0)
                        return 1;
                    
                    bool x_91096 = !defunc_0_reduce_res_83967;
                    bool defunc_0_reduce_res_83910;
                    
                    if (x_91096) {
                        bool x_91098;
                        bool redout_89090 = 0;
                        
                        for (int64_t i_89091 = 0; i_89091 < mz2081Uz2084U_34268; i_89091++) {
                            double eta_p_63498 = ((double *) mem_90429.mem)[i_89091];
                            bool zlze_res_63499 = eta_p_63498 <= zs_res_49813;
                            bool defunc_0_op_res_51328 = zlze_res_63499 || redout_89090;
                            bool redout_tmp_91512 = defunc_0_op_res_51328;
                            
                            redout_89090 = redout_tmp_91512;
                        }
                        x_91098 = redout_89090;
                        defunc_0_reduce_res_83910 = x_91098;
                    } else {
                        defunc_0_reduce_res_83910 = 0;
                    }
                    
                    bool cond_51319 = defunc_0_reduce_res_83910 || defunc_0_reduce_res_83967;
                    int64_t ext_90536;
                    
                    if (cond_51319) {
                        ext_90536 = (int64_t) 0;
                    } else {
                        ext_90536 = ext_90486;
                    }
                    
                    int64_t ext_90535;
                    
                    if (cond_51319) {
                        ext_90535 = (int64_t) 1;
                    } else {
                        ext_90535 = ext_90485;
                    }
                    
                    int64_t ext_90534;
                    
                    if (cond_51319) {
                        ext_90534 = mz2081Uz2084U_34268;
                    } else {
                        ext_90534 = ext_90484;
                    }
                    if (cond_51319) {
                        if (memblock_alloc(ctx, &mem_90495, bytes_89422, "mem_90495")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (memblock_alloc(ctx, &mem_90497, bytes_89422, "mem_90497")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (memblock_alloc(ctx, &mem_90500, bytes_89436, "mem_90500")) {
                            err = 1;
                            goto cleanup;
                        }
                        for (int64_t i_89102 = 0; i_89102 < mz2081Uz2084U_34268; i_89102++) {
                            double eta_p_83929 = ((double *) mem_90429.mem)[i_89102];
                            double eta_p_83930 = ((double *) mem_param_90427.mem)[i_89102];
                            bool zgze_res_83932 = exp_absorb_cutoff_34276 <= eta_p_83929;
                            bool zl_res_83933 = eta_p_83929 < zs_res_49813;
                            bool x_83934 = !zgze_res_83932;
                            bool y_83935 = zl_res_83933 && x_83934;
                            bool cond_83936 = zgze_res_83932 || y_83935;
                            int64_t binop_y_90519 = i_89102 * ext_90484;
                            int64_t lmad_ext_90520 = ext_90486 + binop_y_90519;
                            int64_t ext_90522;
                            
                            if (cond_83936) {
                                ext_90522 = (int64_t) 0;
                            } else {
                                ext_90522 = lmad_ext_90520;
                            }
                            
                            int64_t ext_90521;
                            
                            if (cond_83936) {
                                ext_90521 = (int64_t) 1;
                            } else {
                                ext_90521 = ext_90485;
                            }
                            
                            double rescale_res_83937;
                            double rescale_res_83938;
                            
                            if (cond_83936) {
                                double log_res_83940 = futrts_log64(eta_p_83929);
                                double sqrt_res_83941 = futrts_sqrt64(eta_p_83929);
                                double zs_res_83942 = log_res_83940 / 2.0;
                                double zp_res_83943 = eta_p_83930 + zs_res_83942;
                                
                                if (memblock_alloc(ctx, &mem_90512, bytes_89422, "mem_90512")) {
                                    err = 1;
                                    goto cleanup;
                                }
                                for (int64_t i_89094 = 0; i_89094 < mz2081Uz2084U_34268; i_89094++) {
                                    double eta_p_83945 = ((double *) ext_mem_90487.mem)[ext_90486 + (i_89094 * ext_90485 + i_89102 * ext_90484)];
                                    double zt_res_83946 = sqrt_res_83941 * eta_p_83945;
                                    
                                    ((double *) mem_90512.mem)[i_89094] = zt_res_83946;
                                }
                                if (memblock_set(ctx, &ext_mem_90523, &mem_90512, "mem_90512") != 0)
                                    return 1;
                                rescale_res_83937 = sqrt_res_83941;
                                rescale_res_83938 = zp_res_83943;
                            } else {
                                if (memblock_set(ctx, &ext_mem_90523, &ext_mem_90487, "ext_mem_90487") != 0)
                                    return 1;
                                rescale_res_83937 = eta_p_83929;
                                rescale_res_83938 = eta_p_83930;
                            }
                            ((double *) mem_90495.mem)[i_89102] = rescale_res_83937;
                            ((double *) mem_90497.mem)[i_89102] = rescale_res_83938;
                            lmad_copy_8b(ctx, 1, (uint64_t *) mem_90500.mem, i_89102 * mz2081Uz2084U_34268, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90523.mem, ext_90522, (int64_t []) {ext_90521}, (int64_t []) {mz2081Uz2084U_34268});
                            if (memblock_unref(ctx, &ext_mem_90523, "ext_mem_90523") != 0)
                                return 1;
                        }
                        if (memblock_set(ctx, &ext_mem_90543, &mem_90495, "mem_90495") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90540, &mem_90497, "mem_90497") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90537, &mem_90500, "mem_90500") != 0)
                            return 1;
                    } else {
                        if (memblock_set(ctx, &ext_mem_90543, &mem_90429, "mem_90429") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90540, &mem_param_90427, "mem_param_90427") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90537, &ext_mem_90487, "ext_mem_90487") != 0)
                            return 1;
                    }
                    if (memblock_unref(ctx, &mem_90429, "mem_90429") != 0)
                        return 1;
                    if (memblock_unref(ctx, &ext_mem_90487, "ext_mem_90487") != 0)
                        return 1;
                    
                    bool defunc_0_reduce_res_83972;
                    bool redout_89106 = 1;
                    
                    for (int64_t i_89107 = 0; i_89107 < mz2081Uz2084U_34268; i_89107++) {
                        double eta_p_63266 = ((double *) ext_mem_90493.mem)[i_89107];
                        bool isnan_res_63267 = futrts_isnan64(eta_p_63266);
                        bool not_res_63268 = !isnan_res_63267;
                        bool x_51364 = not_res_63268 && redout_89106;
                        bool redout_tmp_91517 = x_51364;
                        
                        redout_89106 = redout_tmp_91517;
                    }
                    defunc_0_reduce_res_83972 = redout_89106;
                    
                    bool loop_cond_51365;
                    
                    if (defunc_0_reduce_res_83972) {
                        bool defunc_0_reduce_comm_res_83954;
                        bool redout_89108 = 0;
                        
                        for (int64_t i_89109 = 0; i_89109 < mz2081Uz2084U_34268; i_89109++) {
                            double eta_p_83955 = ((double *) ext_mem_90493.mem)[i_89109];
                            double eta_p_83956 = ((double *) mem_param_90418.mem)[i_89109];
                            double zt_res_83957 = zp_res_83654 * eta_p_83955;
                            bool zgze_res_83958 = eta_p_83956 <= zt_res_83957;
                            double zt_res_83959 = zp_res_83654 * eta_p_83956;
                            bool zgze_res_83960 = eta_p_83955 <= zt_res_83959;
                            bool x_83961 = zgze_res_83958 && zgze_res_83960;
                            bool not_res_83962 = !x_83961;
                            bool defunc_0_op_res_83965 = not_res_83962 || redout_89108;
                            bool redout_tmp_91518 = defunc_0_op_res_83965;
                            
                            redout_89108 = redout_tmp_91518;
                        }
                        defunc_0_reduce_comm_res_83954 = redout_89108;
                        loop_cond_51365 = defunc_0_reduce_comm_res_83954;
                    } else {
                        loop_cond_51365 = 0;
                    }
                    if (memblock_set(ctx, &mem_param_tmp_91487, &ext_mem_90537, "ext_mem_90537") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_91488, &ext_mem_90493, "ext_mem_90493") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_91489, &ext_mem_90543, "ext_mem_90543") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_91490, &ext_mem_90490, "ext_mem_90490") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_91491, &ext_mem_90540, "ext_mem_90540") != 0)
                        return 1;
                    
                    int64_t ctx_param_ext_tmp_91492 = ext_90536;
                    int64_t ctx_param_ext_tmp_91493 = ext_90535;
                    int64_t ctx_param_ext_tmp_91494 = ext_90534;
                    bool loop_while_tmp_91495 = loop_cond_51365;
                    
                    if (memblock_set(ctx, &mem_param_90415, &mem_param_tmp_91487, "mem_param_tmp_91487") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_90418, &mem_param_tmp_91488, "mem_param_tmp_91488") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_90421, &mem_param_tmp_91489, "mem_param_tmp_91489") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_90424, &mem_param_tmp_91490, "mem_param_tmp_91490") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_90427, &mem_param_tmp_91491, "mem_param_tmp_91491") != 0)
                        return 1;
                    ctx_param_ext_90412 = ctx_param_ext_tmp_91492;
                    ctx_param_ext_90413 = ctx_param_ext_tmp_91493;
                    ctx_param_ext_90414 = ctx_param_ext_tmp_91494;
                    loop_while_51205 = loop_while_tmp_91495;
                }
                if (memblock_set(ctx, &ext_mem_90559, &mem_param_90415, "mem_param_90415") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90558, &mem_param_90418, "mem_param_90418") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90557, &mem_param_90421, "mem_param_90421") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90556, &mem_param_90424, "mem_param_90424") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90555, &mem_param_90427, "mem_param_90427") != 0)
                    return 1;
                ext_90554 = ctx_param_ext_90412;
                ext_90553 = ctx_param_ext_90413;
                ext_90552 = ctx_param_ext_90414;
                algo5_core_loop_res_f_res_51199 = loop_while_51205;
                if (memblock_unref(ctx, &ext_mem_90358, "ext_mem_90358") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90361, "ext_mem_90361") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90405, "ext_mem_90405") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90408, "ext_mem_90408") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90411, "ext_mem_90411") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90575, &ext_mem_90559, "ext_mem_90559") != 0)
                    return 1;
                ext_90574 = ext_90554;
                ext_90573 = ext_90553;
                ext_90572 = ext_90552;
                if (memblock_set(ctx, &ext_mem_90571, &ext_mem_90558, "ext_mem_90558") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90568, &ext_mem_90557, "ext_mem_90557") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90565, &ext_mem_90556, "ext_mem_90556") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90562, &ext_mem_90555, "ext_mem_90555") != 0)
                    return 1;
            }
            if (memblock_unref(ctx, &ext_mem_90287, "ext_mem_90287") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90288, "ext_mem_90288") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90289, "ext_mem_90289") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90290, "ext_mem_90290") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90291, "ext_mem_90291") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90292, "ext_mem_90292") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90293, "ext_mem_90293") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90294, "ext_mem_90294") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90295, "ext_mem_90295") != 0)
                return 1;
            if (memblock_alloc(ctx, &mem_90577, bytes_89422, "mem_90577")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc(ctx, &mem_90582, bytes_89422, "mem_90582")) {
                err = 1;
                goto cleanup;
            }
            
            double defunc_res_84730;
            double redout_89118 = 0.0;
            
            for (int64_t i_89122 = 0; i_89122 < mz2081Uz2084U_34268; i_89122++) {
                double eta_p_79178 = ((double *) ext_mem_90568.mem)[i_89122];
                double eta_p_79179 = ((double *) ext_mem_90562.mem)[i_89122];
                double eta_p_79181 = ((double *) ext_mem_90571.mem)[i_89122];
                double eta_p_79182 = ((double *) ext_mem_90565.mem)[i_89122];
                double log_res_79183 = futrts_log64(eta_p_79181);
                double zp_res_79184 = eta_p_79182 + log_res_79183;
                double defunc_res_83979;
                double redout_89111 = 0.0;
                
                for (int64_t i_89113 = 0; i_89113 < mz2081Uz2084U_34268; i_89113++) {
                    double eta_p_79685 = ((double *) ext_mem_90575.mem)[ext_90574 + (i_89122 * ext_90573 + i_89113 * ext_90572)];
                    double eta_p_wasfree_79686 = ((double *) ext_mem_90568.mem)[i_89113];
                    double zt_res_79687 = eta_p_79181 * eta_p_79685;
                    double zt_res_79688 = eta_p_wasfree_79686 * zt_res_79687;
                    double zp_res_79199 = zt_res_79688 + redout_89111;
                    
                    ((double *) mem_90580)[i_89122 * mz2081Uz2084U_34268 + i_89113] = zt_res_79688;
                    
                    double redout_tmp_91523 = zp_res_79199;
                    
                    redout_89111 = redout_tmp_91523;
                }
                defunc_res_83979 = redout_89111;
                
                double log_res_79190 = futrts_log64(eta_p_79178);
                double zp_res_79191 = eta_p_79179 + log_res_79190;
                double zp_res_51420 = defunc_res_83979 + redout_89118;
                
                ((double *) mem_90577.mem)[i_89122] = zp_res_79191;
                ((double *) mem_90582.mem)[i_89122] = zp_res_79184;
                
                double redout_tmp_91519 = zp_res_51420;
                
                redout_89118 = redout_tmp_91519;
            }
            defunc_res_84730 = redout_89118;
            if (memblock_unref(ctx, &ext_mem_90562, "ext_mem_90562") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90565, "ext_mem_90565") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90568, "ext_mem_90568") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90571, "ext_mem_90571") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90575, "ext_mem_90575") != 0)
                return 1;
            
            bool zg_res_51421 = 0.0 < defunc_res_84730;
            double zs_res_51422 = defunc_res_84712 / defunc_res_84730;
            double sqrt_res_51423 = futrts_sqrt64(zs_res_51422);
            double descent_res_51427;
            
            if (zg_res_51421) {
                if (mem_90617_cached_sizze_91688 < bytes_89422) {
                    err = lexical_realloc(ctx, &mem_90617, &mem_90617_cached_sizze_91688, bytes_89422);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (mem_90619_cached_sizze_91689 < bytes_89422) {
                    err = lexical_realloc(ctx, &mem_90619, &mem_90619_cached_sizze_91689, bytes_89422);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (mem_90621_cached_sizze_91690 < bytes_89422) {
                    err = lexical_realloc(ctx, &mem_90621, &mem_90621_cached_sizze_91690, bytes_89422);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                
                double defunc_res_84078;
                double defunc_res_84079;
                double defunc_res_84080;
                double redout_89133;
                double redout_89134;
                double redout_89135;
                
                redout_89133 = 0.0;
                redout_89134 = 0.0;
                redout_89135 = 0.0;
                for (int64_t i_89139 = 0; i_89139 < mz2081Uz2084U_34268; i_89139++) {
                    double x_84084 = ((double *) mem_89416)[eta_p_49442 * mz2081Uz2084U_34268 + i_89139];
                    double log_res_84086 = futrts_log64(x_84084);
                    double defunc_res_84087;
                    double defunc_res_84088;
                    double defunc_res_84089;
                    double redout_89126;
                    double redout_89127;
                    double redout_89128;
                    
                    redout_89126 = 0.0;
                    redout_89127 = 0.0;
                    redout_89128 = 0.0;
                    for (int64_t i_89129 = 0; i_89129 < mz2081Uz2084U_34268; i_89129++) {
                        double x_84090 = ((double *) mem_param_89895.mem)[i_89129 * mz2081Uz2084U_34268 + i_89139];
                        double zp_res_84093 = x_84090 + redout_89126;
                        double zp_res_84096 = x_84090 + redout_89127;
                        double zp_res_84099 = x_84090 + redout_89128;
                        double redout_tmp_91531 = zp_res_84093;
                        double redout_tmp_91532 = zp_res_84096;
                        double redout_tmp_91533 = zp_res_84099;
                        
                        redout_89126 = redout_tmp_91531;
                        redout_89127 = redout_tmp_91532;
                        redout_89128 = redout_tmp_91533;
                    }
                    defunc_res_84087 = redout_89126;
                    defunc_res_84088 = redout_89127;
                    defunc_res_84089 = redout_89128;
                    
                    bool zeze_res_84103 = defunc_res_84087 == 0.0;
                    double klu_res_84104;
                    
                    if (zeze_res_84103) {
                        klu_res_84104 = 0.0;
                    } else {
                        double zs_res_84105 = defunc_res_84087 / x_84084;
                        double log_res_84106 = futrts_log64(zs_res_84105);
                        double zt_res_84107 = defunc_res_84087 * log_res_84106;
                        
                        klu_res_84104 = zt_res_84107;
                    }
                    
                    double zp_res_84110 = klu_res_84104 + redout_89133;
                    double zp_res_84113 = x_84084 + redout_89134;
                    double zp_res_84116 = defunc_res_84089 + redout_89135;
                    
                    ((double *) mem_90617)[i_89139] = defunc_res_84088;
                    ((double *) mem_90619)[i_89139] = defunc_res_84087;
                    ((double *) mem_90621)[i_89139] = log_res_84086;
                    
                    double redout_tmp_91525 = zp_res_84110;
                    double redout_tmp_91526 = zp_res_84113;
                    double redout_tmp_91527 = zp_res_84116;
                    
                    redout_89133 = redout_tmp_91525;
                    redout_89134 = redout_tmp_91526;
                    redout_89135 = redout_tmp_91527;
                }
                defunc_res_84078 = redout_89133;
                defunc_res_84079 = redout_89134;
                defunc_res_84080 = redout_89135;
                
                double zm_res_84123 = defunc_res_84078 - defunc_res_84080;
                double zt_res_84124 = 2.0 * zm_res_84123;
                double zt_res_84125 = 2.0 * defunc_res_84080;
                
                if (mem_90642_cached_sizze_91691 < bytes_89436) {
                    err = lexical_realloc(ctx, &mem_90642, &mem_90642_cached_sizze_91691, bytes_89436);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                for (int64_t i_89145 = 0; i_89145 < mz2081Uz2084U_34268; i_89145++) {
                    double eta_p_84127 = ((double *) mem_90619)[i_89145];
                    double eta_p_84128 = ((double *) mem_89416)[eta_p_49442 * mz2081Uz2084U_34268 + i_89145];
                    double log_res_84129 = futrts_log64(eta_p_84127);
                    double log_res_84130 = futrts_log64(eta_p_84128);
                    double zm_res_84131 = log_res_84129 - log_res_84130;
                    double zp_res_84132 = 1.0 + zm_res_84131;
                    double fma_res_84133 = futrts_fma64(zt_res_84125, zp_res_84132, zt_res_84124);
                    
                    for (int64_t nest_i_91535 = 0; nest_i_91535 < mz2081Uz2084U_34268; nest_i_91535++) {
                        ((double *) mem_90642)[i_89145 * mz2081Uz2084U_34268 + nest_i_91535] = fma_res_84133;
                    }
                }
                if (mem_90654_cached_sizze_91692 < bytes_89422) {
                    err = lexical_realloc(ctx, &mem_90654, &mem_90654_cached_sizze_91692, bytes_89422);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (mem_90656_cached_sizze_91693 < bytes_89422) {
                    err = lexical_realloc(ctx, &mem_90656, &mem_90656_cached_sizze_91693, bytes_89422);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                
                double defunc_res_84136;
                double defunc_res_84137;
                double defunc_res_84138;
                double defunc_res_84139;
                double redout_89155;
                double redout_89156;
                double redout_89157;
                double redout_89158;
                
                redout_89155 = 0.0;
                redout_89156 = 0.0;
                redout_89157 = 0.0;
                redout_89158 = 0.0;
                for (int64_t i_89161 = 0; i_89161 < mz2081Uz2084U_34268; i_89161++) {
                    double eta_p_84143 = ((double *) mem_89416)[eta_p_49441 * mz2081Uz2084U_34268 + i_89161];
                    double defunc_res_84144;
                    double defunc_res_84145;
                    double defunc_res_84146;
                    double defunc_res_84147;
                    double defunc_res_84148;
                    double redout_89147;
                    double redout_89148;
                    double redout_89149;
                    double redout_89150;
                    double redout_89151;
                    
                    redout_89147 = 0.0;
                    redout_89148 = 0.0;
                    redout_89149 = 0.0;
                    redout_89150 = 0.0;
                    redout_89151 = 0.0;
                    for (int64_t i_89152 = 0; i_89152 < mz2081Uz2084U_34268; i_89152++) {
                        double x_84149 = ((double *) mem_param_89895.mem)[i_89161 * mz2081Uz2084U_34268 + i_89152];
                        double eta_p_84150 = ((double *) mem_89416)[eta_p_49442 * mz2081Uz2084U_34268 + i_89152];
                        double zt_res_84151 = eta_p_84143 * eta_p_84150;
                        bool zeze_res_84152 = x_84149 == 0.0;
                        double klu_res_84153;
                        
                        if (zeze_res_84152) {
                            klu_res_84153 = 0.0;
                        } else {
                            double zs_res_84154 = x_84149 / zt_res_84151;
                            double log_res_84155 = futrts_log64(zs_res_84154);
                            double zt_res_84156 = x_84149 * log_res_84155;
                            
                            klu_res_84153 = zt_res_84156;
                        }
                        
                        double zp_res_84159 = x_84149 + redout_89147;
                        double zp_res_84162 = klu_res_84153 + redout_89148;
                        double zp_res_84165 = x_84149 + redout_89149;
                        double zp_res_84168 = x_84149 + redout_89150;
                        double zp_res_84171 = x_84149 + redout_89151;
                        double redout_tmp_91542 = zp_res_84159;
                        double redout_tmp_91543 = zp_res_84162;
                        double redout_tmp_91544 = zp_res_84165;
                        double redout_tmp_91545 = zp_res_84168;
                        double redout_tmp_91546 = zp_res_84171;
                        
                        redout_89147 = redout_tmp_91542;
                        redout_89148 = redout_tmp_91543;
                        redout_89149 = redout_tmp_91544;
                        redout_89150 = redout_tmp_91545;
                        redout_89151 = redout_tmp_91546;
                    }
                    defunc_res_84144 = redout_89147;
                    defunc_res_84145 = redout_89148;
                    defunc_res_84146 = redout_89149;
                    defunc_res_84147 = redout_89150;
                    defunc_res_84148 = redout_89151;
                    
                    bool zeze_res_84177 = defunc_res_84148 == 0.0;
                    double klu_res_84178;
                    
                    if (zeze_res_84177) {
                        klu_res_84178 = 0.0;
                    } else {
                        double zs_res_84179 = defunc_res_84148 / eta_p_84143;
                        double log_res_84180 = futrts_log64(zs_res_84179);
                        double zt_res_84181 = defunc_res_84148 * log_res_84180;
                        
                        klu_res_84178 = zt_res_84181;
                    }
                    
                    double zp_res_84184 = defunc_res_84144 + redout_89155;
                    double zp_res_84187 = defunc_res_84145 + redout_89156;
                    double zp_res_84190 = defunc_res_84147 + redout_89157;
                    double zp_res_84193 = klu_res_84178 + redout_89158;
                    
                    ((double *) mem_90654)[i_89161] = defunc_res_84148;
                    ((double *) mem_90656)[i_89161] = defunc_res_84146;
                    
                    double redout_tmp_91536 = zp_res_84184;
                    double redout_tmp_91537 = zp_res_84187;
                    double redout_tmp_91538 = zp_res_84190;
                    double redout_tmp_91539 = zp_res_84193;
                    
                    redout_89155 = redout_tmp_91536;
                    redout_89156 = redout_tmp_91537;
                    redout_89157 = redout_tmp_91538;
                    redout_89158 = redout_tmp_91539;
                }
                defunc_res_84136 = redout_89155;
                defunc_res_84137 = redout_89156;
                defunc_res_84138 = redout_89157;
                defunc_res_84139 = redout_89158;
                
                double zm_res_84200 = defunc_res_84139 - defunc_res_84138;
                double zt_res_84201 = 2.0 * zm_res_84200;
                double zt_res_84202 = 2.0 * defunc_res_84138;
                
                if (mem_90670_cached_sizze_91694 < bytes_89422) {
                    err = lexical_realloc(ctx, &mem_90670, &mem_90670_cached_sizze_91694, bytes_89422);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                for (int64_t i_89168 = 0; i_89168 < mz2081Uz2084U_34268; i_89168++) {
                    double defunc_0_reduce_res_84205;
                    double redout_89164 = 0.0;
                    
                    for (int64_t i_89165 = 0; i_89165 < mz2081Uz2084U_34268; i_89165++) {
                        double eta_p_84206 = ((double *) mem_89419)[eta_p_49442 * (mz2081Uz2084U_34268 * mz2081Uz2084U_34268) + i_89168 * mz2081Uz2084U_34268 + i_89165];
                        double eta_p_84207 = ((double *) mem_90617)[i_89165];
                        double zt_res_84208 = eta_p_84206 * eta_p_84206;
                        double zt_res_84209 = eta_p_84207 * zt_res_84208;
                        double zp_res_84212 = zt_res_84209 + redout_89164;
                        double redout_tmp_91548 = zp_res_84212;
                        
                        redout_89164 = redout_tmp_91548;
                    }
                    defunc_0_reduce_res_84205 = redout_89164;
                    ((double *) mem_90670)[i_89168] = defunc_0_reduce_res_84205;
                }
                
                double zt_res_84215 = 2.0 * defunc_res_84136;
                double zt_res_84216 = 2.0 * defunc_res_84137;
                
                if (mem_90678_cached_sizze_91695 < bytes_89422) {
                    err = lexical_realloc(ctx, &mem_90678, &mem_90678_cached_sizze_91695, bytes_89422);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (mem_90681_cached_sizze_91696 < bytes_89436) {
                    err = lexical_realloc(ctx, &mem_90681, &mem_90681_cached_sizze_91696, bytes_89436);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_90684, bytes_89436, "mem_90684")) {
                    err = 1;
                    goto cleanup;
                }
                if (mem_90697_cached_sizze_91697 < bytes_89422) {
                    err = lexical_realloc(ctx, &mem_90697, &mem_90697_cached_sizze_91697, bytes_89422);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                
                double defunc_res_84220;
                double defunc_res_84221;
                double defunc_res_84222;
                double defunc_res_84223;
                double defunc_res_84224;
                double redout_89194;
                double redout_89195;
                double redout_89196;
                double redout_89197;
                double redout_89198;
                
                redout_89194 = 0.0;
                redout_89195 = 0.0;
                redout_89196 = 0.0;
                redout_89197 = 0.0;
                redout_89198 = 0.0;
                for (int64_t i_89202 = 0; i_89202 < mz2081Uz2084U_34268; i_89202++) {
                    double x_84228 = ((double *) mem_89416)[eta_p_49441 * mz2081Uz2084U_34268 + i_89202];
                    double eta_p_84232 = ((double *) mem_90654)[i_89202];
                    double log_res_84236 = futrts_log64(x_84228);
                    double log_res_84237 = futrts_log64(eta_p_84232);
                    double zm_res_84238 = log_res_84237 - log_res_84236;
                    double zp_res_84239 = 1.0 + zm_res_84238;
                    double fma_res_84240 = futrts_fma64(zt_res_84202, zp_res_84239, zt_res_84201);
                    
                    for (int64_t i_89174 = 0; i_89174 < mz2081Uz2084U_34268; i_89174++) {
                        double defunc_0_reduce_res_84243;
                        double redout_89170 = 0.0;
                        
                        for (int64_t i_89171 = 0; i_89171 < mz2081Uz2084U_34268; i_89171++) {
                            double eta_p_84244 = ((double *) mem_89419)[eta_p_49441 * (mz2081Uz2084U_34268 * mz2081Uz2084U_34268) + i_89202 * mz2081Uz2084U_34268 + i_89171];
                            double eta_p_84245 = ((double *) mem_param_89895.mem)[i_89171 * mz2081Uz2084U_34268 + i_89174];
                            double zt_res_84246 = eta_p_84244 * eta_p_84245;
                            double zp_res_84249 = zt_res_84246 + redout_89170;
                            double redout_tmp_91558 = zp_res_84249;
                            
                            redout_89170 = redout_tmp_91558;
                        }
                        defunc_0_reduce_res_84243 = redout_89170;
                        ((double *) mem_90697)[i_89174] = defunc_0_reduce_res_84243;
                    }
                    
                    double defunc_0_reduce_res_84252;
                    double redout_89176 = 0.0;
                    
                    for (int64_t i_89177 = 0; i_89177 < mz2081Uz2084U_34268; i_89177++) {
                        double eta_p_84253 = ((double *) mem_89419)[eta_p_49441 * (mz2081Uz2084U_34268 * mz2081Uz2084U_34268) + i_89202 * mz2081Uz2084U_34268 + i_89177];
                        double eta_p_84254 = ((double *) mem_90656)[i_89177];
                        double zt_res_84255 = eta_p_84253 * eta_p_84253;
                        double zt_res_84256 = eta_p_84254 * zt_res_84255;
                        double zp_res_84259 = zt_res_84256 + redout_89176;
                        double redout_tmp_91559 = zp_res_84259;
                        
                        redout_89176 = redout_tmp_91559;
                    }
                    defunc_0_reduce_res_84252 = redout_89176;
                    
                    double defunc_0_reduce_res_84262;
                    double defunc_res_84263;
                    double defunc_res_84264;
                    double defunc_res_84265;
                    double redout_89182;
                    double redout_89183;
                    double redout_89184;
                    double redout_89185;
                    
                    redout_89182 = 0.0;
                    redout_89183 = 0.0;
                    redout_89184 = 0.0;
                    redout_89185 = 0.0;
                    for (int64_t i_89188 = 0; i_89188 < mz2081Uz2084U_34268; i_89188++) {
                        double eta_p_84268 = ((double *) mem_90580)[i_89202 * mz2081Uz2084U_34268 + i_89188];
                        double eta_p_84269 = ((double *) mem_param_89895.mem)[i_89202 * mz2081Uz2084U_34268 + i_89188];
                        double eta_p_84270 = ((double *) mem_89416)[eta_p_49442 * mz2081Uz2084U_34268 + i_89188];
                        double eta_p_wasfree_84271 = ((double *) mem_90621)[i_89188];
                        double eta_p_wasfree_84273 = ((double *) mem_90670)[i_89188];
                        double eta_p_84274 = ((double *) mem_90642)[i_89188 * mz2081Uz2084U_34268 + i_89202];
                        double zt_res_84275 = sqrt_res_51423 * eta_p_84268;
                        double zm_res_84276 = zt_res_84275 - eta_p_84269;
                        double log_res_84277 = futrts_log64(eta_p_84269);
                        double zm_res_84278 = log_res_84277 - eta_p_wasfree_84271;
                        double zm_res_84279 = zm_res_84278 - log_res_84236;
                        double fma_res_84280 = futrts_fma64(zt_res_84215, zm_res_84279, zt_res_84216);
                        double defunc_0_reduce_res_84281;
                        double redout_89178 = 0.0;
                        
                        for (int64_t i_89179 = 0; i_89179 < mz2081Uz2084U_34268; i_89179++) {
                            double eta_p_84282 = ((double *) mem_90697)[i_89179];
                            double eta_p_84283 = ((double *) mem_89419)[eta_p_49442 * (mz2081Uz2084U_34268 * mz2081Uz2084U_34268) + i_89179 * mz2081Uz2084U_34268 + i_89188];
                            double zt_res_84284 = eta_p_84282 * eta_p_84283;
                            double zp_res_84287 = zt_res_84284 + redout_89178;
                            double redout_tmp_91566 = zp_res_84287;
                            
                            redout_89178 = redout_tmp_91566;
                        }
                        defunc_0_reduce_res_84281 = redout_89178;
                        
                        double zt_res_84289 = -2.0 * defunc_0_reduce_res_84281;
                        double zp_res_84290 = defunc_0_reduce_res_84252 + zt_res_84289;
                        double zp_res_84291 = eta_p_wasfree_84273 + zp_res_84290;
                        double zt_res_84292 = 2.0 * zp_res_84291;
                        double fma_res_84293 = futrts_fma64(fma_res_84240, rho1_34269, zt_res_84292);
                        double fma_res_84294 = futrts_fma64(eta_p_84274, rho2_34270, fma_res_84293);
                        double fma_res_84295 = futrts_fma64(fma_res_84280, eps_34271, fma_res_84294);
                        double max_res_84296 = fmax64(-1.0e100, fma_res_84295);
                        double zt_res_84297 = zm_res_84276 * max_res_84296;
                        double zp_res_84298 = eta_p_84269 + zm_res_84276;
                        double zt_res_84299 = x_84228 * eta_p_84270;
                        bool zeze_res_84300 = zp_res_84298 == 0.0;
                        double klu_res_84301;
                        
                        if (zeze_res_84300) {
                            klu_res_84301 = 0.0;
                        } else {
                            double zs_res_84302 = zp_res_84298 / zt_res_84299;
                            double log_res_84303 = futrts_log64(zs_res_84302);
                            double zt_res_84304 = zp_res_84298 * log_res_84303;
                            
                            klu_res_84301 = zt_res_84304;
                        }
                        
                        double zp_res_84307 = zt_res_84297 + redout_89182;
                        double zp_res_84310 = klu_res_84301 + redout_89183;
                        double zp_res_84313 = zp_res_84298 + redout_89184;
                        double zp_res_84316 = zp_res_84298 + redout_89185;
                        
                        ((double *) mem_90681)[i_89202 * mz2081Uz2084U_34268 + i_89188] = zp_res_84298;
                        ((double *) mem_90684.mem)[i_89202 * mz2081Uz2084U_34268 + i_89188] = zm_res_84276;
                        
                        double redout_tmp_91560 = zp_res_84307;
                        double redout_tmp_91561 = zp_res_84310;
                        double redout_tmp_91562 = zp_res_84313;
                        double redout_tmp_91563 = zp_res_84316;
                        
                        redout_89182 = redout_tmp_91560;
                        redout_89183 = redout_tmp_91561;
                        redout_89184 = redout_tmp_91562;
                        redout_89185 = redout_tmp_91563;
                    }
                    defunc_0_reduce_res_84262 = redout_89182;
                    defunc_res_84263 = redout_89183;
                    defunc_res_84264 = redout_89184;
                    defunc_res_84265 = redout_89185;
                    
                    bool zeze_res_84323 = defunc_res_84265 == 0.0;
                    double klu_res_84324;
                    
                    if (zeze_res_84323) {
                        klu_res_84324 = 0.0;
                    } else {
                        double zs_res_84325 = defunc_res_84265 / x_84228;
                        double log_res_84326 = futrts_log64(zs_res_84325);
                        double zt_res_84327 = defunc_res_84265 * log_res_84326;
                        
                        klu_res_84324 = zt_res_84327;
                    }
                    
                    double zp_res_84330 = defunc_0_reduce_res_84262 + redout_89194;
                    double zp_res_84333 = klu_res_84324 + redout_89195;
                    double zp_res_84336 = defunc_res_84265 + redout_89196;
                    double zp_res_84339 = defunc_res_84263 + redout_89197;
                    double zp_res_84342 = x_84228 + redout_89198;
                    
                    ((double *) mem_90678)[i_89202] = defunc_res_84264;
                    
                    double redout_tmp_91549 = zp_res_84330;
                    double redout_tmp_91550 = zp_res_84333;
                    double redout_tmp_91551 = zp_res_84336;
                    double redout_tmp_91552 = zp_res_84339;
                    double redout_tmp_91553 = zp_res_84342;
                    
                    redout_89194 = redout_tmp_91549;
                    redout_89195 = redout_tmp_91550;
                    redout_89196 = redout_tmp_91551;
                    redout_89197 = redout_tmp_91552;
                    redout_89198 = redout_tmp_91553;
                }
                defunc_res_84220 = redout_89194;
                defunc_res_84221 = redout_89195;
                defunc_res_84222 = redout_89196;
                defunc_res_84223 = redout_89197;
                defunc_res_84224 = redout_89198;
                
                bool zl_res_84351 = defunc_res_84220 < 0.0;
                bool assert_c_84352;
                
                if (!zl_res_84351) {
                    set_error(ctx, msgprintf("Error: %s\n\nBacktrace:\n%s", "Assertion is false: M.((gradient) M.< zero)", "-> #0  common.fut:220:7-221:22\n   #1  unbalanced_gw_core.fut:388:48-393:78\n   #2  unbalanced_gw_core.fut:402:7-11\n   #3  unbalanced_gw.fut:163:9-165:83\n   #4  /prelude/functional.fut:9:44-45\n   #5  unbalanced_gw.fut:162:6-165:84\n"));
                    err = FUTHARK_PROGRAM_ERROR;
                    goto cleanup;
                }
                if (mem_90732_cached_sizze_91698 < bytes_89422) {
                    err = lexical_realloc(ctx, &mem_90732, &mem_90732_cached_sizze_91698, bytes_89422);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                
                double defunc_res_84354;
                double redout_89210 = 0.0;
                
                for (int64_t i_89212 = 0; i_89212 < mz2081Uz2084U_34268; i_89212++) {
                    double eta_p_84357 = ((double *) mem_89416)[eta_p_49442 * mz2081Uz2084U_34268 + i_89212];
                    double defunc_res_84358;
                    double defunc_res_84359;
                    double redout_89206;
                    double redout_89207;
                    
                    redout_89206 = 0.0;
                    redout_89207 = 0.0;
                    for (int64_t i_89208 = 0; i_89208 < mz2081Uz2084U_34268; i_89208++) {
                        double x_84360 = ((double *) mem_90681)[i_89208 * mz2081Uz2084U_34268 + i_89212];
                        double zp_res_84363 = x_84360 + redout_89206;
                        double zp_res_84366 = x_84360 + redout_89207;
                        double redout_tmp_91569 = zp_res_84363;
                        double redout_tmp_91570 = zp_res_84366;
                        
                        redout_89206 = redout_tmp_91569;
                        redout_89207 = redout_tmp_91570;
                    }
                    defunc_res_84358 = redout_89206;
                    defunc_res_84359 = redout_89207;
                    
                    bool zeze_res_84369 = defunc_res_84359 == 0.0;
                    double klu_res_84370;
                    
                    if (zeze_res_84369) {
                        klu_res_84370 = 0.0;
                    } else {
                        double zs_res_84371 = defunc_res_84359 / eta_p_84357;
                        double log_res_84372 = futrts_log64(zs_res_84371);
                        double zt_res_84373 = defunc_res_84359 * log_res_84372;
                        
                        klu_res_84370 = zt_res_84373;
                    }
                    
                    double zp_res_84376 = klu_res_84370 + redout_89210;
                    
                    ((double *) mem_90732)[i_89212] = defunc_res_84358;
                    
                    double redout_tmp_91567 = zp_res_84376;
                    
                    redout_89210 = redout_tmp_91567;
                }
                defunc_res_84354 = redout_89210;
                if (mem_90740_cached_sizze_91699 < bytes_89422) {
                    err = lexical_realloc(ctx, &mem_90740, &mem_90740_cached_sizze_91699, bytes_89422);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                
                double defunc_0_reduce_res_84379;
                double defunc_res_84380;
                double redout_89226;
                double redout_89227;
                
                redout_89226 = 0.0;
                redout_89227 = 0.0;
                for (int64_t i_89228 = 0; i_89228 < mz2081Uz2084U_34268; i_89228++) {
                    double eta_p_84383 = ((double *) mem_90678)[i_89228];
                    double defunc_0_reduce_res_84384;
                    double redout_89214 = 0.0;
                    
                    for (int64_t i_89215 = 0; i_89215 < mz2081Uz2084U_34268; i_89215++) {
                        double eta_p_84385 = ((double *) mem_89419)[eta_p_49441 * (mz2081Uz2084U_34268 * mz2081Uz2084U_34268) + i_89228 * mz2081Uz2084U_34268 + i_89215];
                        double eta_p_84386 = ((double *) mem_90678)[i_89215];
                        double zt_res_84387 = eta_p_84385 * eta_p_84385;
                        double zt_res_84388 = eta_p_84386 * zt_res_84387;
                        double zp_res_84391 = zt_res_84388 + redout_89214;
                        double redout_tmp_91573 = zp_res_84391;
                        
                        redout_89214 = redout_tmp_91573;
                    }
                    defunc_0_reduce_res_84384 = redout_89214;
                    
                    double zt_res_84393 = eta_p_84383 * defunc_0_reduce_res_84384;
                    
                    for (int64_t i_89220 = 0; i_89220 < mz2081Uz2084U_34268; i_89220++) {
                        double defunc_0_reduce_res_84396;
                        double redout_89216 = 0.0;
                        
                        for (int64_t i_89217 = 0; i_89217 < mz2081Uz2084U_34268; i_89217++) {
                            double eta_p_84397 = ((double *) mem_89419)[eta_p_49441 * (mz2081Uz2084U_34268 * mz2081Uz2084U_34268) + i_89228 * mz2081Uz2084U_34268 + i_89217];
                            double eta_p_84398 = ((double *) mem_90681)[i_89217 * mz2081Uz2084U_34268 + i_89220];
                            double zt_res_84399 = eta_p_84397 * eta_p_84398;
                            double zp_res_84402 = zt_res_84399 + redout_89216;
                            double redout_tmp_91575 = zp_res_84402;
                            
                            redout_89216 = redout_tmp_91575;
                        }
                        defunc_0_reduce_res_84396 = redout_89216;
                        ((double *) mem_90740)[i_89220] = defunc_0_reduce_res_84396;
                    }
                    
                    double defunc_0_reduce_res_84405;
                    double redout_89224 = 0.0;
                    
                    for (int64_t i_89225 = 0; i_89225 < mz2081Uz2084U_34268; i_89225++) {
                        double eta_p_84407 = ((double *) mem_90681)[i_89228 * mz2081Uz2084U_34268 + i_89225];
                        double defunc_0_reduce_res_84408;
                        double redout_89222 = 0.0;
                        
                        for (int64_t i_89223 = 0; i_89223 < mz2081Uz2084U_34268; i_89223++) {
                            double eta_p_84409 = ((double *) mem_90740)[i_89223];
                            double eta_p_84410 = ((double *) mem_89419)[eta_p_49442 * (mz2081Uz2084U_34268 * mz2081Uz2084U_34268) + i_89223 * mz2081Uz2084U_34268 + i_89225];
                            double zt_res_84411 = eta_p_84409 * eta_p_84410;
                            double zp_res_84414 = zt_res_84411 + redout_89222;
                            double redout_tmp_91577 = zp_res_84414;
                            
                            redout_89222 = redout_tmp_91577;
                        }
                        defunc_0_reduce_res_84408 = redout_89222;
                        
                        double zt_res_84416 = eta_p_84407 * defunc_0_reduce_res_84408;
                        double zp_res_84419 = zt_res_84416 + redout_89224;
                        double redout_tmp_91576 = zp_res_84419;
                        
                        redout_89224 = redout_tmp_91576;
                    }
                    defunc_0_reduce_res_84405 = redout_89224;
                    
                    double zp_res_84423 = zt_res_84393 + redout_89226;
                    double zp_res_84426 = defunc_0_reduce_res_84405 + redout_89227;
                    double redout_tmp_91571 = zp_res_84423;
                    double redout_tmp_91572 = zp_res_84426;
                    
                    redout_89226 = redout_tmp_91571;
                    redout_89227 = redout_tmp_91572;
                }
                defunc_0_reduce_res_84379 = redout_89226;
                defunc_res_84380 = redout_89227;
                
                double defunc_0_reduce_res_84429;
                double redout_89231 = 0.0;
                
                for (int64_t i_89232 = 0; i_89232 < mz2081Uz2084U_34268; i_89232++) {
                    double eta_p_84431 = ((double *) mem_90732)[i_89232];
                    double defunc_0_reduce_res_84432;
                    double redout_89229 = 0.0;
                    
                    for (int64_t i_89230 = 0; i_89230 < mz2081Uz2084U_34268; i_89230++) {
                        double eta_p_84433 = ((double *) mem_89419)[eta_p_49442 * (mz2081Uz2084U_34268 * mz2081Uz2084U_34268) + i_89232 * mz2081Uz2084U_34268 + i_89230];
                        double eta_p_84434 = ((double *) mem_90732)[i_89230];
                        double zt_res_84435 = eta_p_84433 * eta_p_84433;
                        double zt_res_84436 = eta_p_84434 * zt_res_84435;
                        double zp_res_84439 = zt_res_84436 + redout_89229;
                        double redout_tmp_91579 = zp_res_84439;
                        
                        redout_89229 = redout_tmp_91579;
                    }
                    defunc_0_reduce_res_84432 = redout_89229;
                    
                    double zt_res_84441 = eta_p_84431 * defunc_0_reduce_res_84432;
                    double zp_res_84444 = zt_res_84441 + redout_89231;
                    double redout_tmp_91578 = zp_res_84444;
                    
                    redout_89231 = redout_tmp_91578;
                }
                defunc_0_reduce_res_84429 = redout_89231;
                
                double zt_res_84446 = -2.0 * defunc_res_84380;
                double zp_res_84447 = defunc_0_reduce_res_84379 + zt_res_84446;
                double zp_res_84448 = defunc_0_reduce_res_84429 + zp_res_84447;
                double zt_res_84449 = eps_34271 * defunc_res_84223;
                double zt_res_84450 = rho1_34269 * defunc_res_84221;
                double zt_res_84451 = rho2_34270 * defunc_res_84354;
                double zp_res_84452 = zt_res_84449 + zt_res_84450;
                double zp_res_84453 = zt_res_84451 + zp_res_84452;
                double zt_res_84454 = 2.0 * zp_res_84453;
                double zt_res_84455 = defunc_res_84222 * zt_res_84454;
                double zp_res_84456 = zp_res_84448 + zt_res_84455;
                double zt_res_84457 = defunc_res_84222 * defunc_res_84222;
                double zt_res_84460 = zp_res_49438 * zt_res_84457;
                double zm_res_84461 = zp_res_84456 - zt_res_84460;
                double zt_res_84462 = defunc_res_84079 * defunc_res_84224;
                double zt_res_84463 = rho1_34269 * defunc_res_84224;
                double zt_res_84464 = defunc_res_84224 * zt_res_84463;
                double zt_res_84465 = rho2_34270 * defunc_res_84079;
                double zt_res_84466 = defunc_res_84079 * zt_res_84465;
                double zp_res_84467 = zt_res_84464 + zt_res_84466;
                double zt_res_84468 = eps_34271 * zt_res_84462;
                double zt_res_84469 = zt_res_84462 * zt_res_84468;
                double zp_res_84470 = zp_res_84467 + zt_res_84469;
                double zp_res_84471 = zm_res_84461 + zp_res_84470;
                double zm_res_84472 = zp_res_84471 - loss_50367;
                bool zgze_res_84473 = -1.0 <= zm_res_84472;
                double zs_res_84474 = zm_res_84472 / defunc_res_84220;
                bool zlze_res_84475 = zs_res_84474 <= 0.5;
                bool x_84476 = zgze_res_84473 && zlze_res_84475;
                double defunc_res_84477;
                
                if (x_84476) {
                    double x_84478;
                    double redout_89233 = 0.0;
                    
                    for (int64_t i_89234 = 0; i_89234 < mz2081Uz2084U_34268; i_89234++) {
                        double x_84479 = ((double *) mem_89416)[eta_p_49441 * mz2081Uz2084U_34268 + i_89234];
                        double zp_res_84482 = x_84479 + redout_89233;
                        double redout_tmp_91580 = zp_res_84482;
                        
                        redout_89233 = redout_tmp_91580;
                    }
                    x_84478 = redout_89233;
                    defunc_res_84477 = x_84478;
                } else {
                    defunc_res_84477 = 0.0;
                }
                
                double defunc_res_84484;
                
                if (x_84476) {
                    double x_84485;
                    double redout_89235 = 0.0;
                    
                    for (int64_t i_89236 = 0; i_89236 < mz2081Uz2084U_34268; i_89236++) {
                        double x_84486 = ((double *) mem_89416)[eta_p_49442 * mz2081Uz2084U_34268 + i_89236];
                        double zp_res_84489 = x_84486 + redout_89235;
                        double redout_tmp_91581 = zp_res_84489;
                        
                        redout_89235 = redout_tmp_91581;
                    }
                    x_84485 = redout_89235;
                    defunc_res_84484 = x_84485;
                } else {
                    defunc_res_84484 = 0.0;
                }
                
                double zt_res_84491 = defunc_res_84477 * defunc_res_84484;
                double zt_res_84492 = rho1_34269 * defunc_res_84477;
                double zt_res_84493 = defunc_res_84477 * zt_res_84492;
                double zt_res_84494 = rho2_34270 * defunc_res_84484;
                double zt_res_84495 = defunc_res_84484 * zt_res_84494;
                double zp_res_84496 = zt_res_84493 + zt_res_84495;
                double zt_res_84497 = eps_34271 * zt_res_84491;
                double zt_res_84498 = zt_res_84491 * zt_res_84497;
                double zp_res_84499 = zp_res_84496 + zt_res_84498;
                
                if (mem_90752_cached_sizze_91700 < bytes_89422) {
                    err = lexical_realloc(ctx, &mem_90752, &mem_90752_cached_sizze_91700, bytes_89422);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (mem_90755_cached_sizze_91701 < bytes_89436) {
                    err = lexical_realloc(ctx, &mem_90755, &mem_90755_cached_sizze_91701, bytes_89436);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (mem_90798_cached_sizze_91702 < bytes_89422) {
                    err = lexical_realloc(ctx, &mem_90798, &mem_90798_cached_sizze_91702, bytes_89422);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (mem_90806_cached_sizze_91703 < bytes_89422) {
                    err = lexical_realloc(ctx, &mem_90806, &mem_90806_cached_sizze_91703, bytes_89422);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                
                bool defunc_0_armijo_line_search_res_84500;
                double defunc_0_armijo_line_search_res_84502;
                double defunc_0_armijo_line_search_res_84503;
                bool loop_while_84504;
                double current_loss_84506;
                double alpha_84507;
                
                if (memblock_set(ctx, &mem_param_90750, &mem_90684, "mem_90684") != 0)
                    return 1;
                loop_while_84504 = x_84476;
                current_loss_84506 = zp_res_84471;
                alpha_84507 = 1.0;
                while (loop_while_84504) {
                    double zt_res_84508 = 0.5 * alpha_84507;
                    
                    if (memblock_alloc(ctx, &mem_90758, bytes_89436, "mem_90758")) {
                        err = 1;
                        goto cleanup;
                    }
                    
                    double defunc_res_84509;
                    double defunc_res_84510;
                    double defunc_res_84511;
                    double redout_89250;
                    double redout_89251;
                    double redout_89252;
                    
                    redout_89250 = 0.0;
                    redout_89251 = 0.0;
                    redout_89252 = 0.0;
                    for (int64_t i_89256 = 0; i_89256 < mz2081Uz2084U_34268; i_89256++) {
                        double eta_p_84516 = ((double *) mem_89416)[eta_p_49441 * mz2081Uz2084U_34268 + i_89256];
                        double defunc_res_84518;
                        double defunc_res_84519;
                        double defunc_res_84520;
                        double redout_89239;
                        double redout_89240;
                        double redout_89241;
                        
                        redout_89239 = 0.0;
                        redout_89240 = 0.0;
                        redout_89241 = 0.0;
                        for (int64_t i_89244 = 0; i_89244 < mz2081Uz2084U_34268; i_89244++) {
                            double eta_p_84523 = ((double *) mem_param_90750.mem)[i_89256 * mz2081Uz2084U_34268 + i_89244];
                            double eta_p_84524 = ((double *) mem_param_89895.mem)[i_89256 * mz2081Uz2084U_34268 + i_89244];
                            double eta_p_84525 = ((double *) mem_89416)[eta_p_49442 * mz2081Uz2084U_34268 + i_89244];
                            double zt_res_84526 = 0.5 * eta_p_84523;
                            double zp_res_84527 = eta_p_84524 + zt_res_84526;
                            double zt_res_84528 = eta_p_84516 * eta_p_84525;
                            bool zeze_res_84529 = zp_res_84527 == 0.0;
                            double klu_res_84530;
                            
                            if (zeze_res_84529) {
                                klu_res_84530 = 0.0;
                            } else {
                                double zs_res_84531 = zp_res_84527 / zt_res_84528;
                                double log_res_84532 = futrts_log64(zs_res_84531);
                                double zt_res_84533 = zp_res_84527 * log_res_84532;
                                
                                klu_res_84530 = zt_res_84533;
                            }
                            
                            double zp_res_84536 = klu_res_84530 + redout_89239;
                            double zp_res_84539 = zp_res_84527 + redout_89240;
                            double zp_res_84542 = zp_res_84527 + redout_89241;
                            
                            ((double *) mem_90755)[i_89256 * mz2081Uz2084U_34268 + i_89244] = zp_res_84527;
                            ((double *) mem_90758.mem)[i_89256 * mz2081Uz2084U_34268 + i_89244] = zt_res_84526;
                            
                            double redout_tmp_91593 = zp_res_84536;
                            double redout_tmp_91594 = zp_res_84539;
                            double redout_tmp_91595 = zp_res_84542;
                            
                            redout_89239 = redout_tmp_91593;
                            redout_89240 = redout_tmp_91594;
                            redout_89241 = redout_tmp_91595;
                        }
                        defunc_res_84518 = redout_89239;
                        defunc_res_84519 = redout_89240;
                        defunc_res_84520 = redout_89241;
                        
                        bool zeze_res_84548 = defunc_res_84520 == 0.0;
                        double klu_res_84549;
                        
                        if (zeze_res_84548) {
                            klu_res_84549 = 0.0;
                        } else {
                            double zs_res_84550 = defunc_res_84520 / eta_p_84516;
                            double log_res_84551 = futrts_log64(zs_res_84550);
                            double zt_res_84552 = defunc_res_84520 * log_res_84551;
                            
                            klu_res_84549 = zt_res_84552;
                        }
                        
                        double zp_res_84555 = klu_res_84549 + redout_89250;
                        double zp_res_84558 = defunc_res_84520 + redout_89251;
                        double zp_res_84561 = defunc_res_84518 + redout_89252;
                        
                        ((double *) mem_90752)[i_89256] = defunc_res_84519;
                        
                        double redout_tmp_91587 = zp_res_84555;
                        double redout_tmp_91588 = zp_res_84558;
                        double redout_tmp_91589 = zp_res_84561;
                        
                        redout_89250 = redout_tmp_91587;
                        redout_89251 = redout_tmp_91588;
                        redout_89252 = redout_tmp_91589;
                    }
                    defunc_res_84509 = redout_89250;
                    defunc_res_84510 = redout_89251;
                    defunc_res_84511 = redout_89252;
                    
                    double defunc_res_84569;
                    double redout_89264 = 0.0;
                    
                    for (int64_t i_89266 = 0; i_89266 < mz2081Uz2084U_34268; i_89266++) {
                        double eta_p_84572 = ((double *) mem_89416)[eta_p_49442 * mz2081Uz2084U_34268 + i_89266];
                        double defunc_res_84573;
                        double defunc_res_84574;
                        double redout_89260;
                        double redout_89261;
                        
                        redout_89260 = 0.0;
                        redout_89261 = 0.0;
                        for (int64_t i_89262 = 0; i_89262 < mz2081Uz2084U_34268; i_89262++) {
                            double x_84575 = ((double *) mem_90755)[i_89262 * mz2081Uz2084U_34268 + i_89266];
                            double zp_res_84578 = x_84575 + redout_89260;
                            double zp_res_84581 = x_84575 + redout_89261;
                            double redout_tmp_91600 = zp_res_84578;
                            double redout_tmp_91601 = zp_res_84581;
                            
                            redout_89260 = redout_tmp_91600;
                            redout_89261 = redout_tmp_91601;
                        }
                        defunc_res_84573 = redout_89260;
                        defunc_res_84574 = redout_89261;
                        
                        bool zeze_res_84584 = defunc_res_84574 == 0.0;
                        double klu_res_84585;
                        
                        if (zeze_res_84584) {
                            klu_res_84585 = 0.0;
                        } else {
                            double zs_res_84586 = defunc_res_84574 / eta_p_84572;
                            double log_res_84587 = futrts_log64(zs_res_84586);
                            double zt_res_84588 = defunc_res_84574 * log_res_84587;
                            
                            klu_res_84585 = zt_res_84588;
                        }
                        
                        double zp_res_84591 = klu_res_84585 + redout_89264;
                        
                        ((double *) mem_90798)[i_89266] = defunc_res_84573;
                        
                        double redout_tmp_91598 = zp_res_84591;
                        
                        redout_89264 = redout_tmp_91598;
                    }
                    defunc_res_84569 = redout_89264;
                    
                    double defunc_0_reduce_res_84594;
                    double defunc_res_84595;
                    double redout_89280;
                    double redout_89281;
                    
                    redout_89280 = 0.0;
                    redout_89281 = 0.0;
                    for (int64_t i_89282 = 0; i_89282 < mz2081Uz2084U_34268; i_89282++) {
                        double eta_p_84598 = ((double *) mem_90752)[i_89282];
                        double defunc_0_reduce_res_84599;
                        double redout_89268 = 0.0;
                        
                        for (int64_t i_89269 = 0; i_89269 < mz2081Uz2084U_34268; i_89269++) {
                            double eta_p_84600 = ((double *) mem_89419)[eta_p_49441 * (mz2081Uz2084U_34268 * mz2081Uz2084U_34268) + i_89282 * mz2081Uz2084U_34268 + i_89269];
                            double eta_p_84601 = ((double *) mem_90752)[i_89269];
                            double zt_res_84602 = eta_p_84600 * eta_p_84600;
                            double zt_res_84603 = eta_p_84601 * zt_res_84602;
                            double zp_res_84606 = zt_res_84603 + redout_89268;
                            double redout_tmp_91604 = zp_res_84606;
                            
                            redout_89268 = redout_tmp_91604;
                        }
                        defunc_0_reduce_res_84599 = redout_89268;
                        
                        double zt_res_84608 = eta_p_84598 * defunc_0_reduce_res_84599;
                        
                        for (int64_t i_89274 = 0; i_89274 < mz2081Uz2084U_34268; i_89274++) {
                            double defunc_0_reduce_res_84611;
                            double redout_89270 = 0.0;
                            
                            for (int64_t i_89271 = 0; i_89271 < mz2081Uz2084U_34268; i_89271++) {
                                double eta_p_84612 = ((double *) mem_89419)[eta_p_49441 * (mz2081Uz2084U_34268 * mz2081Uz2084U_34268) + i_89282 * mz2081Uz2084U_34268 + i_89271];
                                double eta_p_84613 = ((double *) mem_90755)[i_89271 * mz2081Uz2084U_34268 + i_89274];
                                double zt_res_84614 = eta_p_84612 * eta_p_84613;
                                double zp_res_84617 = zt_res_84614 + redout_89270;
                                double redout_tmp_91606 = zp_res_84617;
                                
                                redout_89270 = redout_tmp_91606;
                            }
                            defunc_0_reduce_res_84611 = redout_89270;
                            ((double *) mem_90806)[i_89274] = defunc_0_reduce_res_84611;
                        }
                        
                        double defunc_0_reduce_res_84620;
                        double redout_89278 = 0.0;
                        
                        for (int64_t i_89279 = 0; i_89279 < mz2081Uz2084U_34268; i_89279++) {
                            double eta_p_84622 = ((double *) mem_90755)[i_89282 * mz2081Uz2084U_34268 + i_89279];
                            double defunc_0_reduce_res_84623;
                            double redout_89276 = 0.0;
                            
                            for (int64_t i_89277 = 0; i_89277 < mz2081Uz2084U_34268; i_89277++) {
                                double eta_p_84624 = ((double *) mem_90806)[i_89277];
                                double eta_p_84625 = ((double *) mem_89419)[eta_p_49442 * (mz2081Uz2084U_34268 * mz2081Uz2084U_34268) + i_89277 * mz2081Uz2084U_34268 + i_89279];
                                double zt_res_84626 = eta_p_84624 * eta_p_84625;
                                double zp_res_84629 = zt_res_84626 + redout_89276;
                                double redout_tmp_91608 = zp_res_84629;
                                
                                redout_89276 = redout_tmp_91608;
                            }
                            defunc_0_reduce_res_84623 = redout_89276;
                            
                            double zt_res_84631 = eta_p_84622 * defunc_0_reduce_res_84623;
                            double zp_res_84634 = zt_res_84631 + redout_89278;
                            double redout_tmp_91607 = zp_res_84634;
                            
                            redout_89278 = redout_tmp_91607;
                        }
                        defunc_0_reduce_res_84620 = redout_89278;
                        
                        double zp_res_84638 = zt_res_84608 + redout_89280;
                        double zp_res_84641 = defunc_0_reduce_res_84620 + redout_89281;
                        double redout_tmp_91602 = zp_res_84638;
                        double redout_tmp_91603 = zp_res_84641;
                        
                        redout_89280 = redout_tmp_91602;
                        redout_89281 = redout_tmp_91603;
                    }
                    defunc_0_reduce_res_84594 = redout_89280;
                    defunc_res_84595 = redout_89281;
                    
                    double defunc_0_reduce_res_84644;
                    double redout_89285 = 0.0;
                    
                    for (int64_t i_89286 = 0; i_89286 < mz2081Uz2084U_34268; i_89286++) {
                        double eta_p_84646 = ((double *) mem_90798)[i_89286];
                        double defunc_0_reduce_res_84647;
                        double redout_89283 = 0.0;
                        
                        for (int64_t i_89284 = 0; i_89284 < mz2081Uz2084U_34268; i_89284++) {
                            double eta_p_84648 = ((double *) mem_89419)[eta_p_49442 * (mz2081Uz2084U_34268 * mz2081Uz2084U_34268) + i_89286 * mz2081Uz2084U_34268 + i_89284];
                            double eta_p_84649 = ((double *) mem_90798)[i_89284];
                            double zt_res_84650 = eta_p_84648 * eta_p_84648;
                            double zt_res_84651 = eta_p_84649 * zt_res_84650;
                            double zp_res_84654 = zt_res_84651 + redout_89283;
                            double redout_tmp_91610 = zp_res_84654;
                            
                            redout_89283 = redout_tmp_91610;
                        }
                        defunc_0_reduce_res_84647 = redout_89283;
                        
                        double zt_res_84656 = eta_p_84646 * defunc_0_reduce_res_84647;
                        double zp_res_84659 = zt_res_84656 + redout_89285;
                        double redout_tmp_91609 = zp_res_84659;
                        
                        redout_89285 = redout_tmp_91609;
                    }
                    defunc_0_reduce_res_84644 = redout_89285;
                    
                    double zt_res_84661 = -2.0 * defunc_res_84595;
                    double zp_res_84662 = defunc_0_reduce_res_84594 + zt_res_84661;
                    double zp_res_84663 = defunc_0_reduce_res_84644 + zp_res_84662;
                    double zt_res_84664 = eps_34271 * defunc_res_84511;
                    double zt_res_84665 = rho1_34269 * defunc_res_84509;
                    double zt_res_84666 = rho2_34270 * defunc_res_84569;
                    double zp_res_84667 = zt_res_84664 + zt_res_84665;
                    double zp_res_84668 = zt_res_84666 + zp_res_84667;
                    double zt_res_84669 = 2.0 * zp_res_84668;
                    double zt_res_84670 = defunc_res_84510 * zt_res_84669;
                    double zp_res_84671 = zp_res_84663 + zt_res_84670;
                    double zt_res_84672 = defunc_res_84510 * defunc_res_84510;
                    double zt_res_84673 = zp_res_49438 * zt_res_84672;
                    double zm_res_84674 = zp_res_84671 - zt_res_84673;
                    double zp_res_84675 = zp_res_84499 + zm_res_84674;
                    double zm_res_84676 = zp_res_84675 - loss_50367;
                    bool zgze_res_84677 = -1.0 <= zm_res_84676;
                    double zt_res_84678 = defunc_res_84220 * zt_res_84508;
                    double zs_res_84679 = zm_res_84676 / zt_res_84678;
                    bool zlze_res_84680 = zs_res_84679 <= 0.5;
                    bool zg_res_84681 = 1.0e-50 < zt_res_84508;
                    bool x_84682 = zlze_res_84680 && zg_res_84681;
                    bool x_84683 = zgze_res_84677 && x_84682;
                    
                    if (memblock_set(ctx, &mem_param_tmp_91582, &mem_90758, "mem_90758") != 0)
                        return 1;
                    
                    bool loop_while_tmp_91583 = x_84683;
                    double current_loss_tmp_91585 = zp_res_84675;
                    double alpha_tmp_91586 = zt_res_84508;
                    
                    if (memblock_set(ctx, &mem_param_90750, &mem_param_tmp_91582, "mem_param_tmp_91582") != 0)
                        return 1;
                    loop_while_84504 = loop_while_tmp_91583;
                    current_loss_84506 = current_loss_tmp_91585;
                    alpha_84507 = alpha_tmp_91586;
                }
                if (memblock_set(ctx, &ext_mem_90816, &mem_param_90750, "mem_param_90750") != 0)
                    return 1;
                defunc_0_armijo_line_search_res_84500 = loop_while_84504;
                defunc_0_armijo_line_search_res_84502 = current_loss_84506;
                defunc_0_armijo_line_search_res_84503 = alpha_84507;
                if (memblock_unref(ctx, &mem_90684, "mem_90684") != 0)
                    return 1;
                if (memblock_alloc(ctx, &mem_90819, bytes_89436, "mem_90819")) {
                    err = 1;
                    goto cleanup;
                }
                for (int64_t i_89293 = 0; i_89293 < mz2081Uz2084U_34268; i_89293++) {
                    for (int64_t i_89289 = 0; i_89289 < mz2081Uz2084U_34268; i_89289++) {
                        double eta_p_84688 = ((double *) mem_param_89895.mem)[i_89293 * mz2081Uz2084U_34268 + i_89289];
                        double eta_p_84689 = ((double *) ext_mem_90816.mem)[i_89293 * mz2081Uz2084U_34268 + i_89289];
                        double zp_res_84690 = eta_p_84688 + eta_p_84689;
                        
                        ((double *) mem_90819.mem)[i_89293 * mz2081Uz2084U_34268 + i_89289] = zp_res_84690;
                    }
                }
                if (memblock_unref(ctx, &ext_mem_90816, "ext_mem_90816") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90845, &mem_90582, "mem_90582") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90842, &mem_90577, "mem_90577") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90839, &mem_90819, "mem_90819") != 0)
                    return 1;
                descent_res_51427 = defunc_0_armijo_line_search_res_84502;
            } else {
                if (memblock_alloc(ctx, &mem_90612, bytes_89422, "mem_90612")) {
                    err = 1;
                    goto cleanup;
                }
                for (int64_t nest_i_91613 = 0; nest_i_91613 < mz2081Uz2084U_34268; nest_i_91613++) {
                    ((double *) mem_90612.mem)[nest_i_91613] = 0.0;
                }
                if (memblock_alloc(ctx, &mem_90615, bytes_89436, "mem_90615")) {
                    err = 1;
                    goto cleanup;
                }
                for (int64_t nest_i_91614 = 0; nest_i_91614 < mz2081Uz2084U_34268; nest_i_91614++) {
                    for (int64_t nest_i_91615 = 0; nest_i_91615 < mz2081Uz2084U_34268; nest_i_91615++) {
                        ((double *) mem_90615.mem)[nest_i_91614 * mz2081Uz2084U_34268 + nest_i_91615] = 0.0;
                    }
                }
                if (memblock_set(ctx, &ext_mem_90845, &mem_90612, "mem_90612") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90842, &mem_90612, "mem_90612") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90839, &mem_90615, "mem_90615") != 0)
                    return 1;
                descent_res_51427 = 0.0;
            }
            if (memblock_unref(ctx, &mem_90577, "mem_90577") != 0)
                return 1;
            if (memblock_unref(ctx, &mem_90582, "mem_90582") != 0)
                return 1;
            
            bool defunc_0_reduce_comm_res_84734;
            bool redout_89297 = 0;
            
            for (int64_t i_89298 = 0; i_89298 < mz2081Uz2084U_34268; i_89298++) {
                bool defunc_0_reduce_comm_res_84693;
                bool redout_89295 = 0;
                
                for (int64_t i_89296 = 0; i_89296 < mz2081Uz2084U_34268; i_89296++) {
                    double eta_p_68820 = ((double *) mem_param_89895.mem)[i_89298 * mz2081Uz2084U_34268 + i_89296];
                    double eta_p_68821 = ((double *) ext_mem_90839.mem)[i_89298 * mz2081Uz2084U_34268 + i_89296];
                    double zt_res_68822 = zp_res_49429 * eta_p_68820;
                    bool zgze_res_68823 = eta_p_68821 <= zt_res_68822;
                    double zt_res_68824 = zp_res_49429 * eta_p_68821;
                    bool zgze_res_68825 = eta_p_68820 <= zt_res_68824;
                    bool x_68826 = zgze_res_68823 && zgze_res_68825;
                    bool not_res_68827 = !x_68826;
                    bool defunc_0_op_res_60644 = not_res_68827 || redout_89295;
                    bool redout_tmp_91617 = defunc_0_op_res_60644;
                    
                    redout_89295 = redout_tmp_91617;
                }
                defunc_0_reduce_comm_res_84693 = redout_89295;
                
                bool defunc_0_op_res_52231 = defunc_0_reduce_comm_res_84693 || redout_89297;
                bool redout_tmp_91616 = defunc_0_op_res_52231;
                
                redout_89297 = redout_tmp_91616;
            }
            defunc_0_reduce_comm_res_84734 = redout_89297;
            
            bool loop_cond_52232;
            
            if (defunc_0_reduce_comm_res_84734) {
                bool defunc_0_reduce_res_84696;
                bool redout_89301 = 0;
                
                for (int64_t i_89302 = 0; i_89302 < mz2081Uz2084U_34268; i_89302++) {
                    bool defunc_0_reduce_res_84698;
                    bool redout_89299 = 0;
                    
                    for (int64_t i_89300 = 0; i_89300 < mz2081Uz2084U_34268; i_89300++) {
                        double eta_p_84699 = ((double *) ext_mem_90839.mem)[i_89302 * mz2081Uz2084U_34268 + i_89300];
                        bool zg_res_84700 = 0.0 < eta_p_84699;
                        bool defunc_0_op_res_84703 = zg_res_84700 || redout_89299;
                        bool redout_tmp_91619 = defunc_0_op_res_84703;
                        
                        redout_89299 = redout_tmp_91619;
                    }
                    defunc_0_reduce_res_84698 = redout_89299;
                    
                    bool defunc_0_op_res_84707 = defunc_0_reduce_res_84698 || redout_89301;
                    bool redout_tmp_91618 = defunc_0_op_res_84707;
                    
                    redout_89301 = redout_tmp_91618;
                }
                defunc_0_reduce_res_84696 = redout_89301;
                loop_cond_52232 = defunc_0_reduce_res_84696;
            } else {
                loop_cond_52232 = 0;
            }
            if (memblock_set(ctx, &mem_param_tmp_91368, &ext_mem_90845, "ext_mem_90845") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_tmp_91369, &ext_mem_90842, "ext_mem_90842") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_tmp_91370, &ext_mem_90839, "ext_mem_90839") != 0)
                return 1;
            
            bool loop_while_tmp_91371 = loop_cond_52232;
            double loss_tmp_91375 = descent_res_51427;
            
            if (memblock_set(ctx, &mem_param_89888, &mem_param_tmp_91368, "mem_param_tmp_91368") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_89891, &mem_param_tmp_91369, "mem_param_tmp_91369") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_89895, &mem_param_tmp_91370, "mem_param_tmp_91370") != 0)
                return 1;
            loop_while_50363 = loop_while_tmp_91371;
            loss_50367 = loss_tmp_91375;
        }
        if (memblock_set(ctx, &ext_mem_90855, &mem_param_89888, "mem_param_89888") != 0)
            return 1;
        if (memblock_set(ctx, &ext_mem_90854, &mem_param_89891, "mem_param_89891") != 0)
            return 1;
        if (memblock_set(ctx, &ext_mem_90853, &mem_param_89895, "mem_param_89895") != 0)
            return 1;
        final_plan_50358 = loop_while_50363;
        final_plan_50362 = loss_50367;
        if (memblock_unref(ctx, &ext_mem_89843, "ext_mem_89843") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89844, "ext_mem_89844") != 0)
            return 1;
        
        double defunc_res_84796;
        double defunc_res_84797;
        double defunc_res_84798;
        double defunc_res_84799;
        double defunc_res_84800;
        double redout_89323;
        double redout_89324;
        double redout_89325;
        double redout_89326;
        double redout_89327;
        
        redout_89323 = 0.0;
        redout_89324 = 0.0;
        redout_89325 = 0.0;
        redout_89326 = 0.0;
        redout_89327 = 0.0;
        for (int64_t i_89331 = 0; i_89331 < mz2081Uz2084U_34268; i_89331++) {
            double eta_p_59285 = ((double *) mem_89416)[eta_p_49441 * mz2081Uz2084U_34268 + i_89331];
            
            for (int64_t i_89307 = 0; i_89307 < mz2081Uz2084U_34268; i_89307++) {
                double defunc_0_reduce_res_84735;
                double redout_89303 = 0.0;
                
                for (int64_t i_89304 = 0; i_89304 < mz2081Uz2084U_34268; i_89304++) {
                    double eta_p_71807 = ((double *) mem_89419)[eta_p_49441 * (mz2081Uz2084U_34268 * mz2081Uz2084U_34268) + i_89331 * mz2081Uz2084U_34268 + i_89304];
                    double eta_p_71808 = ((double *) ext_mem_90853.mem)[i_89304 * mz2081Uz2084U_34268 + i_89307];
                    double zt_res_71809 = eta_p_71807 * eta_p_71808;
                    double zp_res_59311 = zt_res_71809 + redout_89303;
                    double redout_tmp_91629 = zp_res_59311;
                    
                    redout_89303 = redout_tmp_91629;
                }
                defunc_0_reduce_res_84735 = redout_89303;
                ((double *) mem_90872)[i_89307] = defunc_0_reduce_res_84735;
            }
            
            double defunc_res_84738;
            double defunc_0_reduce_res_84739;
            double defunc_res_84740;
            double defunc_res_84741;
            double defunc_res_84742;
            double defunc_res_84743;
            double defunc_res_84744;
            double defunc_res_84745;
            double redout_89311;
            double redout_89312;
            double redout_89313;
            double redout_89314;
            double redout_89315;
            double redout_89316;
            double redout_89317;
            double redout_89318;
            
            redout_89311 = 0.0;
            redout_89312 = 0.0;
            redout_89313 = 0.0;
            redout_89314 = 0.0;
            redout_89315 = 0.0;
            redout_89316 = 0.0;
            redout_89317 = 0.0;
            redout_89318 = 0.0;
            for (int64_t i_89319 = 0; i_89319 < mz2081Uz2084U_34268; i_89319++) {
                double x_71763 = ((double *) ext_mem_90853.mem)[i_89331 * mz2081Uz2084U_34268 + i_89319];
                double eta_p_71764 = ((double *) mem_89416)[eta_p_49442 * mz2081Uz2084U_34268 + i_89319];
                double defunc_0_reduce_res_84736;
                double redout_89309 = 0.0;
                
                for (int64_t i_89310 = 0; i_89310 < mz2081Uz2084U_34268; i_89310++) {
                    double eta_p_71801 = ((double *) mem_90872)[i_89310];
                    double eta_p_71802 = ((double *) mem_89419)[eta_p_49442 * (mz2081Uz2084U_34268 * mz2081Uz2084U_34268) + i_89310 * mz2081Uz2084U_34268 + i_89319];
                    double zt_res_71803 = eta_p_71801 * eta_p_71802;
                    double zp_res_71782 = zt_res_71803 + redout_89309;
                    double redout_tmp_91638 = zp_res_71782;
                    
                    redout_89309 = redout_tmp_91638;
                }
                defunc_0_reduce_res_84736 = redout_89309;
                
                double zt_res_71784 = x_71763 * defunc_0_reduce_res_84736;
                double zt_res_71786 = eta_p_59285 * eta_p_71764;
                bool zeze_res_71787 = x_71763 == 0.0;
                double klu_res_71788;
                
                if (zeze_res_71787) {
                    klu_res_71788 = 0.0;
                } else {
                    double zs_res_71789 = x_71763 / zt_res_71786;
                    double log_res_71790 = futrts_log64(zs_res_71789);
                    double zt_res_71791 = x_71763 * log_res_71790;
                    
                    klu_res_71788 = zt_res_71791;
                }
                
                double klu_res_71795;
                
                if (zeze_res_71787) {
                    klu_res_71795 = 0.0;
                } else {
                    double zs_res_71796 = x_71763 / zt_res_71786;
                    double log_res_71797 = futrts_log64(zs_res_71796);
                    double zt_res_71798 = x_71763 * log_res_71797;
                    
                    klu_res_71795 = zt_res_71798;
                }
                
                double zp_res_59299 = x_71763 + redout_89311;
                double zp_res_59333 = zt_res_71784 + redout_89312;
                double zp_res_59340 = x_71763 + redout_89313;
                double zp_res_59347 = x_71763 + redout_89314;
                double zp_res_59355 = x_71763 + redout_89315;
                double zp_res_59372 = klu_res_71788 + redout_89316;
                double zp_res_59389 = klu_res_71795 + redout_89317;
                double zp_res_59397 = x_71763 + redout_89318;
                double redout_tmp_91630 = zp_res_59299;
                double redout_tmp_91631 = zp_res_59333;
                double redout_tmp_91632 = zp_res_59340;
                double redout_tmp_91633 = zp_res_59347;
                double redout_tmp_91634 = zp_res_59355;
                double redout_tmp_91635 = zp_res_59372;
                double redout_tmp_91636 = zp_res_59389;
                double redout_tmp_91637 = zp_res_59397;
                
                redout_89311 = redout_tmp_91630;
                redout_89312 = redout_tmp_91631;
                redout_89313 = redout_tmp_91632;
                redout_89314 = redout_tmp_91633;
                redout_89315 = redout_tmp_91634;
                redout_89316 = redout_tmp_91635;
                redout_89317 = redout_tmp_91636;
                redout_89318 = redout_tmp_91637;
            }
            defunc_res_84738 = redout_89311;
            defunc_0_reduce_res_84739 = redout_89312;
            defunc_res_84740 = redout_89313;
            defunc_res_84741 = redout_89314;
            defunc_res_84742 = redout_89315;
            defunc_res_84743 = redout_89316;
            defunc_res_84744 = redout_89317;
            defunc_res_84745 = redout_89318;
            
            double zp_res_52353 = defunc_0_reduce_res_84739 + redout_89323;
            double zp_res_52448 = defunc_res_84741 + redout_89324;
            double zp_res_52460 = defunc_res_84742 + redout_89325;
            double zp_res_52494 = defunc_res_84743 + redout_89326;
            double zp_res_52517 = defunc_res_84744 + redout_89327;
            
            ((double *) mem_90857)[i_89331] = defunc_res_84745;
            ((double *) mem_90859)[i_89331] = defunc_res_84740;
            ((double *) mem_90861)[i_89331] = defunc_res_84738;
            
            double redout_tmp_91620 = zp_res_52353;
            double redout_tmp_91621 = zp_res_52448;
            double redout_tmp_91622 = zp_res_52460;
            double redout_tmp_91623 = zp_res_52494;
            double redout_tmp_91624 = zp_res_52517;
            
            redout_89323 = redout_tmp_91620;
            redout_89324 = redout_tmp_91621;
            redout_89325 = redout_tmp_91622;
            redout_89326 = redout_tmp_91623;
            redout_89327 = redout_tmp_91624;
        }
        defunc_res_84796 = redout_89323;
        defunc_res_84797 = redout_89324;
        defunc_res_84798 = redout_89325;
        defunc_res_84799 = redout_89326;
        defunc_res_84800 = redout_89327;
        for (int64_t i_89345 = 0; i_89345 < mz2081Uz2084U_34268; i_89345++) {
            double defunc_res_84746;
            double defunc_res_84747;
            double defunc_res_84748;
            double redout_89335;
            double redout_89336;
            double redout_89337;
            
            redout_89335 = 0.0;
            redout_89336 = 0.0;
            redout_89337 = 0.0;
            for (int64_t i_89338 = 0; i_89338 < mz2081Uz2084U_34268; i_89338++) {
                double x_71828 = ((double *) ext_mem_90853.mem)[i_89338 * mz2081Uz2084U_34268 + i_89345];
                double zp_res_59421 = x_71828 + redout_89335;
                double zp_res_59427 = x_71828 + redout_89336;
                double zp_res_59434 = x_71828 + redout_89337;
                double redout_tmp_91642 = zp_res_59421;
                double redout_tmp_91643 = zp_res_59427;
                double redout_tmp_91644 = zp_res_59434;
                
                redout_89335 = redout_tmp_91642;
                redout_89336 = redout_tmp_91643;
                redout_89337 = redout_tmp_91644;
            }
            defunc_res_84746 = redout_89335;
            defunc_res_84747 = redout_89336;
            defunc_res_84748 = redout_89337;
            ((double *) mem_90889)[i_89345] = defunc_res_84748;
            ((double *) mem_90891)[i_89345] = defunc_res_84747;
            ((double *) mem_90893)[i_89345] = defunc_res_84746;
        }
        if (memblock_unref(ctx, &ext_mem_90853, "ext_mem_90853") != 0)
            return 1;
        
        double defunc_0_reduce_res_84807;
        double redout_89351 = 0.0;
        
        for (int64_t i_89352 = 0; i_89352 < mz2081Uz2084U_34268; i_89352++) {
            double eta_p_56268 = ((double *) mem_90861)[i_89352];
            double defunc_0_reduce_res_84749;
            double redout_89349 = 0.0;
            
            for (int64_t i_89350 = 0; i_89350 < mz2081Uz2084U_34268; i_89350++) {
                double eta_p_71840 = ((double *) mem_89419)[eta_p_49441 * (mz2081Uz2084U_34268 * mz2081Uz2084U_34268) + i_89352 * mz2081Uz2084U_34268 + i_89350];
                double eta_p_71841 = ((double *) mem_90861)[i_89350];
                double zt_res_71843 = eta_p_71840 * eta_p_71840;
                double zt_res_71845 = eta_p_71841 * zt_res_71843;
                double zp_res_56281 = zt_res_71845 + redout_89349;
                double redout_tmp_91646 = zp_res_56281;
                
                redout_89349 = redout_tmp_91646;
            }
            defunc_0_reduce_res_84749 = redout_89349;
            
            double zt_res_56283 = eta_p_56268 * defunc_0_reduce_res_84749;
            double zp_res_52286 = zt_res_56283 + redout_89351;
            double redout_tmp_91645 = zp_res_52286;
            
            redout_89351 = redout_tmp_91645;
        }
        defunc_0_reduce_res_84807 = redout_89351;
        
        double defunc_0_reduce_res_84808;
        double redout_89355 = 0.0;
        
        for (int64_t i_89356 = 0; i_89356 < mz2081Uz2084U_34268; i_89356++) {
            double eta_p_56244 = ((double *) mem_90893)[i_89356];
            double defunc_0_reduce_res_84750;
            double redout_89353 = 0.0;
            
            for (int64_t i_89354 = 0; i_89354 < mz2081Uz2084U_34268; i_89354++) {
                double eta_p_71854 = ((double *) mem_89419)[eta_p_49442 * (mz2081Uz2084U_34268 * mz2081Uz2084U_34268) + i_89356 * mz2081Uz2084U_34268 + i_89354];
                double eta_p_71855 = ((double *) mem_90893)[i_89354];
                double zt_res_71857 = eta_p_71854 * eta_p_71854;
                double zt_res_71859 = eta_p_71855 * zt_res_71857;
                double zp_res_56257 = zt_res_71859 + redout_89353;
                double redout_tmp_91648 = zp_res_56257;
                
                redout_89353 = redout_tmp_91648;
            }
            defunc_0_reduce_res_84750 = redout_89353;
            
            double zt_res_56259 = eta_p_56244 * defunc_0_reduce_res_84750;
            double zp_res_52310 = zt_res_56259 + redout_89355;
            double redout_tmp_91647 = zp_res_52310;
            
            redout_89355 = redout_tmp_91647;
        }
        defunc_0_reduce_res_84808 = redout_89355;
        
        double zt_res_52354 = -2.0 * defunc_res_84796;
        double zp_res_52355 = zt_res_52354 + defunc_0_reduce_res_84807;
        double zp_res_52356 = zp_res_52355 + defunc_0_reduce_res_84808;
        double defunc_res_84809;
        double defunc_res_84810;
        double redout_89360;
        double redout_89361;
        
        redout_89360 = 0.0;
        redout_89361 = 0.0;
        for (int64_t i_89362 = 0; i_89362 < mz2081Uz2084U_34268; i_89362++) {
            double eta_p_56114 = ((double *) mem_90857)[i_89362];
            double eta_p_56115 = ((double *) mem_89416)[eta_p_49441 * mz2081Uz2084U_34268 + i_89362];
            double eta_p_56116 = ((double *) mem_90859)[i_89362];
            double defunc_res_84751;
            double defunc_res_84752;
            double redout_89357;
            double redout_89358;
            
            redout_89357 = 0.0;
            redout_89358 = 0.0;
            for (int64_t i_89359 = 0; i_89359 < mz2081Uz2084U_34268; i_89359++) {
                double eta_p_71927 = ((double *) mem_90857)[i_89359];
                double eta_p_71928 = ((double *) mem_89416)[eta_p_49441 * mz2081Uz2084U_34268 + i_89359];
                double eta_p_71929 = ((double *) mem_90859)[i_89359];
                double zt_res_71930 = eta_p_56115 * eta_p_71928;
                double zt_res_71932 = eta_p_56116 * eta_p_71929;
                bool zeze_res_71934 = zt_res_71932 == 0.0;
                double kl_res_71935;
                
                if (zeze_res_71934) {
                    kl_res_71935 = zt_res_71930;
                } else {
                    double zs_res_71936 = zt_res_71932 / zt_res_71930;
                    double log_res_71937 = futrts_log64(zs_res_71936);
                    double zt_res_71938 = zt_res_71932 * log_res_71937;
                    double zm_res_71939 = zt_res_71938 - zt_res_71932;
                    double zp_res_71940 = zt_res_71930 + zm_res_71939;
                    
                    kl_res_71935 = zp_res_71940;
                }
                
                double zt_res_71943 = eta_p_56114 * eta_p_71927;
                bool zeze_res_71945 = zt_res_71943 == 0.0;
                double kl_res_71946;
                
                if (zeze_res_71945) {
                    kl_res_71946 = zt_res_71930;
                } else {
                    double zs_res_71947 = zt_res_71943 / zt_res_71930;
                    double log_res_71948 = futrts_log64(zs_res_71947);
                    double zt_res_71949 = zt_res_71943 * log_res_71948;
                    double zm_res_71950 = zt_res_71949 - zt_res_71943;
                    double zp_res_71951 = zt_res_71930 + zm_res_71950;
                    
                    kl_res_71946 = zp_res_71951;
                }
                
                double zp_res_56139 = kl_res_71935 + redout_89357;
                double zp_res_56160 = kl_res_71946 + redout_89358;
                double redout_tmp_91651 = zp_res_56139;
                double redout_tmp_91652 = zp_res_56160;
                
                redout_89357 = redout_tmp_91651;
                redout_89358 = redout_tmp_91652;
            }
            defunc_res_84751 = redout_89357;
            defunc_res_84752 = redout_89358;
            
            double zp_res_52396 = defunc_res_84751 + redout_89360;
            double zp_res_52557 = defunc_res_84752 + redout_89361;
            double redout_tmp_91649 = zp_res_52396;
            double redout_tmp_91650 = zp_res_52557;
            
            redout_89360 = redout_tmp_91649;
            redout_89361 = redout_tmp_91650;
        }
        defunc_res_84809 = redout_89360;
        defunc_res_84810 = redout_89361;
        
        double defunc_res_84811;
        double defunc_res_84812;
        double redout_89366;
        double redout_89367;
        
        redout_89366 = 0.0;
        redout_89367 = 0.0;
        for (int64_t i_89368 = 0; i_89368 < mz2081Uz2084U_34268; i_89368++) {
            double eta_p_55995 = ((double *) mem_90889)[i_89368];
            double eta_p_55996 = ((double *) mem_89416)[eta_p_49442 * mz2081Uz2084U_34268 + i_89368];
            double eta_p_55997 = ((double *) mem_90891)[i_89368];
            double defunc_res_84753;
            double defunc_res_84754;
            double redout_89363;
            double redout_89364;
            
            redout_89363 = 0.0;
            redout_89364 = 0.0;
            for (int64_t i_89365 = 0; i_89365 < mz2081Uz2084U_34268; i_89365++) {
                double eta_p_72020 = ((double *) mem_90889)[i_89365];
                double eta_p_72021 = ((double *) mem_89416)[eta_p_49442 * mz2081Uz2084U_34268 + i_89365];
                double eta_p_72022 = ((double *) mem_90891)[i_89365];
                double zt_res_72023 = eta_p_55996 * eta_p_72021;
                double zt_res_72025 = eta_p_55997 * eta_p_72022;
                bool zeze_res_72027 = zt_res_72025 == 0.0;
                double kl_res_72028;
                
                if (zeze_res_72027) {
                    kl_res_72028 = zt_res_72023;
                } else {
                    double zs_res_72029 = zt_res_72025 / zt_res_72023;
                    double log_res_72030 = futrts_log64(zs_res_72029);
                    double zt_res_72031 = zt_res_72025 * log_res_72030;
                    double zm_res_72032 = zt_res_72031 - zt_res_72025;
                    double zp_res_72033 = zt_res_72023 + zm_res_72032;
                    
                    kl_res_72028 = zp_res_72033;
                }
                
                double zt_res_72036 = eta_p_55995 * eta_p_72020;
                bool zeze_res_72038 = zt_res_72036 == 0.0;
                double kl_res_72039;
                
                if (zeze_res_72038) {
                    kl_res_72039 = zt_res_72023;
                } else {
                    double zs_res_72040 = zt_res_72036 / zt_res_72023;
                    double log_res_72041 = futrts_log64(zs_res_72040);
                    double zt_res_72042 = zt_res_72036 * log_res_72041;
                    double zm_res_72043 = zt_res_72042 - zt_res_72036;
                    double zp_res_72044 = zt_res_72023 + zm_res_72043;
                    
                    kl_res_72039 = zp_res_72044;
                }
                
                double zp_res_56020 = kl_res_72028 + redout_89363;
                double zp_res_56041 = kl_res_72039 + redout_89364;
                double redout_tmp_91655 = zp_res_56020;
                double redout_tmp_91656 = zp_res_56041;
                
                redout_89363 = redout_tmp_91655;
                redout_89364 = redout_tmp_91656;
            }
            defunc_res_84753 = redout_89363;
            defunc_res_84754 = redout_89364;
            
            double zp_res_52436 = defunc_res_84753 + redout_89366;
            double zp_res_52594 = defunc_res_84754 + redout_89367;
            double redout_tmp_91653 = zp_res_52436;
            double redout_tmp_91654 = zp_res_52594;
            
            redout_89366 = redout_tmp_91653;
            redout_89367 = redout_tmp_91654;
        }
        defunc_res_84811 = redout_89366;
        defunc_res_84812 = redout_89367;
        
        double zt_res_52471 = defunc_res_84763 * defunc_res_84770;
        double zt_res_52472 = zt_res_52471 * zt_res_52471;
        double zt_res_52495 = defunc_res_84798 * defunc_res_84799;
        double zt_res_52518 = defunc_res_84797 * defunc_res_84800;
        double zp_res_52519 = zt_res_52495 + zt_res_52518;
        double zp_res_52520 = zt_res_52472 + zp_res_52519;
        double zt_res_52521 = defunc_res_84797 * defunc_res_84798;
        double zm_res_52522 = zp_res_52520 - zt_res_52521;
        double zt_res_52558 = rho1_34269 * defunc_res_84810;
        double zp_res_52559 = zp_res_52356 + zt_res_52558;
        double zt_res_52595 = rho2_34270 * defunc_res_84812;
        double zp_res_52596 = zp_res_52559 + zt_res_52595;
        double fma_res_52597 = futrts_fma64(zm_res_52522, eps_34271, zp_res_52596);
        
        ((double *) mem_89426.mem)[i_89371 * (int64_t) 5] = zp_res_52356;
        ((double *) mem_89426.mem)[i_89371 * (int64_t) 5 + (int64_t) 1] = defunc_res_84809;
        ((double *) mem_89426.mem)[i_89371 * (int64_t) 5 + (int64_t) 2] = defunc_res_84811;
        ((double *) mem_89426.mem)[i_89371 * (int64_t) 5 + (int64_t) 3] = zm_res_52522;
        ((double *) mem_89426.mem)[i_89371 * (int64_t) 5 + (int64_t) 4] = fma_res_52597;
    }
    if (memblock_unref(ctx, &ext_mem_89420, "ext_mem_89420") != 0)
        return 1;
    if (memblock_unref(ctx, &ext_mem_89421, "ext_mem_89421") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89423, "mem_89423") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89502, "mem_89502") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89550, "mem_89550") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89561, "mem_89561") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89585, "mem_89585") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89593, "mem_89593") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89869, "mem_89869") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89972, "mem_89972") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89974, "mem_89974") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89977, "mem_89977") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_90007, "mem_90007") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_90009, "mem_90009") != 0)
        return 1;
    if (memblock_set(ctx, &mem_out_91249, &mem_89426, "mem_89426") != 0)
        return 1;
    if (memblock_set(ctx, &*mem_out_p_91663, &mem_out_91249, "mem_out_91249") != 0)
        return 1;
    
  cleanup:
    {
        free(mem_89416);
        free(mem_89419);
        free(mem_89432);
        free(mem_89434);
        free(mem_89437);
        free(mem_89467);
        free(mem_89469);
        free(mem_89471);
        free(mem_89491);
        free(mem_89500);
        free(mem_89511);
        free(mem_89513);
        free(mem_89527);
        free(mem_89558);
        free(mem_89850);
        free(mem_89897);
        free(mem_89905);
        free(mem_89907);
        free(mem_89921);
        free(mem_89930);
        free(mem_89932);
        free(mem_89941);
        free(mem_89949);
        free(mem_90580);
        free(mem_90617);
        free(mem_90619);
        free(mem_90621);
        free(mem_90642);
        free(mem_90654);
        free(mem_90656);
        free(mem_90670);
        free(mem_90678);
        free(mem_90681);
        free(mem_90697);
        free(mem_90732);
        free(mem_90740);
        free(mem_90752);
        free(mem_90755);
        free(mem_90798);
        free(mem_90806);
        free(mem_90857);
        free(mem_90859);
        free(mem_90861);
        free(mem_90872);
        free(mem_90889);
        free(mem_90891);
        free(mem_90893);
        if (memblock_unref(ctx, &mem_param_tmp_91370, "mem_param_tmp_91370") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91369, "mem_param_tmp_91369") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91368, "mem_param_tmp_91368") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90615, "mem_90615") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90612, "mem_90612") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90819, "mem_90819") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91582, "mem_param_tmp_91582") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90758, "mem_90758") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90750, "mem_param_90750") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90816, "ext_mem_90816") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90684, "mem_90684") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90839, "ext_mem_90839") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90842, "ext_mem_90842") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90845, "ext_mem_90845") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90582, "mem_90582") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90577, "mem_90577") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91491, "mem_param_tmp_91491") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91490, "mem_param_tmp_91490") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91489, "mem_param_tmp_91489") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91488, "mem_param_tmp_91488") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91487, "mem_param_tmp_91487") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90512, "mem_90512") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90523, "ext_mem_90523") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90500, "mem_90500") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90497, "mem_90497") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90495, "mem_90495") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90537, "ext_mem_90537") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90540, "ext_mem_90540") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90543, "ext_mem_90543") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90462, "mem_90462") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90473, "ext_mem_90473") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90450, "mem_90450") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90447, "mem_90447") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90445, "mem_90445") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90487, "ext_mem_90487") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90490, "ext_mem_90490") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90493, "ext_mem_90493") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90437, "mem_90437") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90429, "mem_90429") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90427, "mem_param_90427") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90424, "mem_param_90424") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90421, "mem_param_90421") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90418, "mem_param_90418") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90415, "mem_param_90415") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90555, "ext_mem_90555") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90556, "ext_mem_90556") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90557, "ext_mem_90557") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90558, "ext_mem_90558") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90559, "ext_mem_90559") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90380, "mem_90380") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90391, "ext_mem_90391") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90368, "mem_90368") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90365, "mem_90365") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90363, "mem_90363") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90405, "ext_mem_90405") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90408, "ext_mem_90408") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90411, "ext_mem_90411") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90330, "mem_90330") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90341, "ext_mem_90341") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90318, "mem_90318") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90315, "mem_90315") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90313, "mem_90313") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90355, "ext_mem_90355") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90358, "ext_mem_90358") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90361, "ext_mem_90361") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90305, "mem_90305") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90297, "mem_90297") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90562, "ext_mem_90562") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90565, "ext_mem_90565") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90568, "ext_mem_90568") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90571, "ext_mem_90571") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90575, "ext_mem_90575") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91433, "mem_param_tmp_91433") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91432, "mem_param_tmp_91432") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91431, "mem_param_tmp_91431") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91430, "mem_param_tmp_91430") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91429, "mem_param_tmp_91429") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91428, "mem_param_tmp_91428") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91427, "mem_param_tmp_91427") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91426, "mem_param_tmp_91426") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91425, "mem_param_tmp_91425") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90235, "mem_90235") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90246, "ext_mem_90246") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90223, "mem_90223") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90220, "mem_90220") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90218, "mem_90218") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90260, "ext_mem_90260") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90263, "ext_mem_90263") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90266, "ext_mem_90266") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90185, "mem_90185") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90196, "ext_mem_90196") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90173, "mem_90173") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90170, "mem_90170") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90168, "mem_90168") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90210, "ext_mem_90210") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90213, "ext_mem_90213") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90216, "ext_mem_90216") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90160, "mem_90160") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90152, "mem_90152") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90150, "mem_param_90150") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90147, "mem_param_90147") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90144, "mem_param_90144") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90141, "mem_param_90141") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90138, "mem_param_90138") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90134, "mem_param_90134") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90131, "mem_param_90131") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90128, "mem_param_90128") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90125, "mem_param_90125") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90287, "ext_mem_90287") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90288, "ext_mem_90288") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90289, "ext_mem_90289") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90290, "ext_mem_90290") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90291, "ext_mem_90291") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90292, "ext_mem_90292") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90293, "ext_mem_90293") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90294, "ext_mem_90294") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90295, "ext_mem_90295") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90090, "mem_90090") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90101, "ext_mem_90101") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90078, "mem_90078") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90075, "mem_90075") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90073, "mem_90073") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90115, "ext_mem_90115") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90118, "ext_mem_90118") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90121, "ext_mem_90121") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90040, "mem_90040") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90051, "ext_mem_90051") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90028, "mem_90028") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90025, "mem_90025") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90023, "mem_90023") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90065, "ext_mem_90065") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90068, "ext_mem_90068") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90071, "ext_mem_90071") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89895, "mem_param_89895") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89891, "mem_param_89891") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89888, "mem_param_89888") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90853, "ext_mem_90853") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90854, "ext_mem_90854") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90855, "ext_mem_90855") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91331, "mem_param_tmp_91331") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91330, "mem_param_tmp_91330") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91329, "mem_param_tmp_91329") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91328, "mem_param_tmp_91328") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91327, "mem_param_tmp_91327") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89800, "mem_89800") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89811, "ext_mem_89811") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89788, "mem_89788") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89785, "mem_89785") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89783, "mem_89783") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89825, "ext_mem_89825") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89828, "ext_mem_89828") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89831, "ext_mem_89831") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89750, "mem_89750") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89761, "ext_mem_89761") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89738, "mem_89738") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89735, "mem_89735") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89733, "mem_89733") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89775, "ext_mem_89775") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89778, "ext_mem_89778") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89781, "ext_mem_89781") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89725, "mem_89725") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89717, "mem_89717") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89715, "mem_param_89715") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89712, "mem_param_89712") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89709, "mem_param_89709") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89706, "mem_param_89706") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89703, "mem_param_89703") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89843, "ext_mem_89843") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89844, "ext_mem_89844") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89845, "ext_mem_89845") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89846, "ext_mem_89846") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89847, "ext_mem_89847") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89668, "mem_89668") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89679, "ext_mem_89679") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89656, "mem_89656") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89653, "mem_89653") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89651, "mem_89651") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89693, "ext_mem_89693") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89696, "ext_mem_89696") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89699, "ext_mem_89699") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89618, "mem_89618") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89629, "ext_mem_89629") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89606, "mem_89606") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89603, "mem_89603") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89601, "mem_89601") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89643, "ext_mem_89643") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89646, "ext_mem_89646") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89649, "ext_mem_89649") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90009, "mem_90009") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90007, "mem_90007") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89977, "mem_89977") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89974, "mem_89974") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89972, "mem_89972") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89869, "mem_89869") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89593, "mem_89593") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89585, "mem_89585") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89561, "mem_89561") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89550, "mem_89550") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89502, "mem_89502") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89426, "mem_89426") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89423, "mem_89423") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89420, "ext_mem_89420") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89421, "ext_mem_89421") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_out_91249, "mem_out_91249") != 0)
            return 1;
    }
    return err;
}
FUTHARK_FUN_ATTR int futrts_entry_ugw_armijo_euclidean(struct futhark_context *ctx, struct memblock *mem_out_p_91711, int64_t *out_prim_out_91712, struct memblock pt_clouds_mem_89411, int64_t k_34814, int64_t m_34815, int64_t d_34816, double rho1_34817, double rho2_34818, double eps_34819, double exp_absorb_cutoff_34821, double safe_for_exp_34822, double tol_sinkhorn_34823, double tol_outerloop_34824)
{
    (void) ctx;
    
    int err = 0;
    int64_t mem_89415_cached_sizze_91713 = 0;
    unsigned char *mem_89415 = NULL;
    int64_t mem_89458_cached_sizze_91714 = 0;
    unsigned char *mem_89458 = NULL;
    int64_t mem_89460_cached_sizze_91715 = 0;
    unsigned char *mem_89460 = NULL;
    int64_t mem_89474_cached_sizze_91716 = 0;
    unsigned char *mem_89474 = NULL;
    int64_t mem_89483_cached_sizze_91717 = 0;
    unsigned char *mem_89483 = NULL;
    int64_t mem_89494_cached_sizze_91718 = 0;
    unsigned char *mem_89494 = NULL;
    int64_t mem_89496_cached_sizze_91719 = 0;
    unsigned char *mem_89496 = NULL;
    int64_t mem_89510_cached_sizze_91720 = 0;
    unsigned char *mem_89510 = NULL;
    int64_t mem_89541_cached_sizze_91721 = 0;
    unsigned char *mem_89541 = NULL;
    int64_t mem_89833_cached_sizze_91722 = 0;
    unsigned char *mem_89833 = NULL;
    int64_t mem_89880_cached_sizze_91723 = 0;
    unsigned char *mem_89880 = NULL;
    int64_t mem_89888_cached_sizze_91724 = 0;
    unsigned char *mem_89888 = NULL;
    int64_t mem_89896_cached_sizze_91725 = 0;
    unsigned char *mem_89896 = NULL;
    int64_t mem_89905_cached_sizze_91726 = 0;
    unsigned char *mem_89905 = NULL;
    int64_t mem_89907_cached_sizze_91727 = 0;
    unsigned char *mem_89907 = NULL;
    int64_t mem_89916_cached_sizze_91728 = 0;
    unsigned char *mem_89916 = NULL;
    int64_t mem_89924_cached_sizze_91729 = 0;
    unsigned char *mem_89924 = NULL;
    int64_t mem_90555_cached_sizze_91730 = 0;
    unsigned char *mem_90555 = NULL;
    int64_t mem_90592_cached_sizze_91731 = 0;
    unsigned char *mem_90592 = NULL;
    int64_t mem_90594_cached_sizze_91732 = 0;
    unsigned char *mem_90594 = NULL;
    int64_t mem_90609_cached_sizze_91733 = 0;
    unsigned char *mem_90609 = NULL;
    int64_t mem_90621_cached_sizze_91734 = 0;
    unsigned char *mem_90621 = NULL;
    int64_t mem_90623_cached_sizze_91735 = 0;
    unsigned char *mem_90623 = NULL;
    int64_t mem_90637_cached_sizze_91736 = 0;
    unsigned char *mem_90637 = NULL;
    int64_t mem_90645_cached_sizze_91737 = 0;
    unsigned char *mem_90645 = NULL;
    int64_t mem_90648_cached_sizze_91738 = 0;
    unsigned char *mem_90648 = NULL;
    int64_t mem_90664_cached_sizze_91739 = 0;
    unsigned char *mem_90664 = NULL;
    int64_t mem_90699_cached_sizze_91740 = 0;
    unsigned char *mem_90699 = NULL;
    int64_t mem_90707_cached_sizze_91741 = 0;
    unsigned char *mem_90707 = NULL;
    int64_t mem_90719_cached_sizze_91742 = 0;
    unsigned char *mem_90719 = NULL;
    int64_t mem_90722_cached_sizze_91743 = 0;
    unsigned char *mem_90722 = NULL;
    int64_t mem_90765_cached_sizze_91744 = 0;
    unsigned char *mem_90765 = NULL;
    int64_t mem_90773_cached_sizze_91745 = 0;
    unsigned char *mem_90773 = NULL;
    int64_t mem_90824_cached_sizze_91746 = 0;
    unsigned char *mem_90824 = NULL;
    int64_t mem_90826_cached_sizze_91747 = 0;
    unsigned char *mem_90826 = NULL;
    int64_t mem_90828_cached_sizze_91748 = 0;
    unsigned char *mem_90828 = NULL;
    int64_t mem_90839_cached_sizze_91749 = 0;
    unsigned char *mem_90839 = NULL;
    int64_t mem_90856_cached_sizze_91750 = 0;
    unsigned char *mem_90856 = NULL;
    int64_t mem_90858_cached_sizze_91751 = 0;
    unsigned char *mem_90858 = NULL;
    int64_t mem_90860_cached_sizze_91752 = 0;
    unsigned char *mem_90860 = NULL;
    struct memblock mem_param_tmp_91374;
    
    mem_param_tmp_91374.references = NULL;
    
    struct memblock mem_param_tmp_91373;
    
    mem_param_tmp_91373.references = NULL;
    
    struct memblock mem_param_tmp_91372;
    
    mem_param_tmp_91372.references = NULL;
    
    struct memblock mem_90590;
    
    mem_90590.references = NULL;
    
    struct memblock mem_90587;
    
    mem_90587.references = NULL;
    
    struct memblock mem_90786;
    
    mem_90786.references = NULL;
    
    struct memblock mem_param_tmp_91580;
    
    mem_param_tmp_91580.references = NULL;
    
    struct memblock mem_90725;
    
    mem_90725.references = NULL;
    
    struct memblock mem_param_90717;
    
    mem_param_90717.references = NULL;
    
    struct memblock ext_mem_90783;
    
    ext_mem_90783.references = NULL;
    
    struct memblock mem_90651;
    
    mem_90651.references = NULL;
    
    struct memblock ext_mem_90806;
    
    ext_mem_90806.references = NULL;
    
    struct memblock ext_mem_90809;
    
    ext_mem_90809.references = NULL;
    
    struct memblock ext_mem_90812;
    
    ext_mem_90812.references = NULL;
    
    struct memblock mem_90557;
    
    mem_90557.references = NULL;
    
    struct memblock mem_90552;
    
    mem_90552.references = NULL;
    
    struct memblock mem_param_tmp_91494;
    
    mem_param_tmp_91494.references = NULL;
    
    struct memblock mem_param_tmp_91493;
    
    mem_param_tmp_91493.references = NULL;
    
    struct memblock mem_param_tmp_91492;
    
    mem_param_tmp_91492.references = NULL;
    
    struct memblock mem_param_tmp_91491;
    
    mem_param_tmp_91491.references = NULL;
    
    struct memblock mem_param_tmp_91490;
    
    mem_param_tmp_91490.references = NULL;
    
    struct memblock mem_90487;
    
    mem_90487.references = NULL;
    
    struct memblock ext_mem_90498;
    
    ext_mem_90498.references = NULL;
    
    struct memblock mem_90475;
    
    mem_90475.references = NULL;
    
    struct memblock mem_90472;
    
    mem_90472.references = NULL;
    
    struct memblock mem_90470;
    
    mem_90470.references = NULL;
    
    struct memblock ext_mem_90512;
    
    ext_mem_90512.references = NULL;
    
    struct memblock ext_mem_90515;
    
    ext_mem_90515.references = NULL;
    
    struct memblock ext_mem_90518;
    
    ext_mem_90518.references = NULL;
    
    struct memblock mem_90437;
    
    mem_90437.references = NULL;
    
    struct memblock ext_mem_90448;
    
    ext_mem_90448.references = NULL;
    
    struct memblock mem_90425;
    
    mem_90425.references = NULL;
    
    struct memblock mem_90422;
    
    mem_90422.references = NULL;
    
    struct memblock mem_90420;
    
    mem_90420.references = NULL;
    
    struct memblock ext_mem_90462;
    
    ext_mem_90462.references = NULL;
    
    struct memblock ext_mem_90465;
    
    ext_mem_90465.references = NULL;
    
    struct memblock ext_mem_90468;
    
    ext_mem_90468.references = NULL;
    
    struct memblock mem_90412;
    
    mem_90412.references = NULL;
    
    struct memblock mem_90404;
    
    mem_90404.references = NULL;
    
    struct memblock mem_param_90402;
    
    mem_param_90402.references = NULL;
    
    struct memblock mem_param_90399;
    
    mem_param_90399.references = NULL;
    
    struct memblock mem_param_90396;
    
    mem_param_90396.references = NULL;
    
    struct memblock mem_param_90393;
    
    mem_param_90393.references = NULL;
    
    struct memblock mem_param_90390;
    
    mem_param_90390.references = NULL;
    
    struct memblock ext_mem_90530;
    
    ext_mem_90530.references = NULL;
    
    struct memblock ext_mem_90531;
    
    ext_mem_90531.references = NULL;
    
    struct memblock ext_mem_90532;
    
    ext_mem_90532.references = NULL;
    
    struct memblock ext_mem_90533;
    
    ext_mem_90533.references = NULL;
    
    struct memblock ext_mem_90534;
    
    ext_mem_90534.references = NULL;
    
    struct memblock mem_90355;
    
    mem_90355.references = NULL;
    
    struct memblock ext_mem_90366;
    
    ext_mem_90366.references = NULL;
    
    struct memblock mem_90343;
    
    mem_90343.references = NULL;
    
    struct memblock mem_90340;
    
    mem_90340.references = NULL;
    
    struct memblock mem_90338;
    
    mem_90338.references = NULL;
    
    struct memblock ext_mem_90380;
    
    ext_mem_90380.references = NULL;
    
    struct memblock ext_mem_90383;
    
    ext_mem_90383.references = NULL;
    
    struct memblock ext_mem_90386;
    
    ext_mem_90386.references = NULL;
    
    struct memblock mem_90305;
    
    mem_90305.references = NULL;
    
    struct memblock ext_mem_90316;
    
    ext_mem_90316.references = NULL;
    
    struct memblock mem_90293;
    
    mem_90293.references = NULL;
    
    struct memblock mem_90290;
    
    mem_90290.references = NULL;
    
    struct memblock mem_90288;
    
    mem_90288.references = NULL;
    
    struct memblock ext_mem_90330;
    
    ext_mem_90330.references = NULL;
    
    struct memblock ext_mem_90333;
    
    ext_mem_90333.references = NULL;
    
    struct memblock ext_mem_90336;
    
    ext_mem_90336.references = NULL;
    
    struct memblock mem_90280;
    
    mem_90280.references = NULL;
    
    struct memblock mem_90272;
    
    mem_90272.references = NULL;
    
    struct memblock ext_mem_90537;
    
    ext_mem_90537.references = NULL;
    
    struct memblock ext_mem_90540;
    
    ext_mem_90540.references = NULL;
    
    struct memblock ext_mem_90543;
    
    ext_mem_90543.references = NULL;
    
    struct memblock ext_mem_90546;
    
    ext_mem_90546.references = NULL;
    
    struct memblock ext_mem_90550;
    
    ext_mem_90550.references = NULL;
    
    struct memblock mem_param_tmp_91436;
    
    mem_param_tmp_91436.references = NULL;
    
    struct memblock mem_param_tmp_91435;
    
    mem_param_tmp_91435.references = NULL;
    
    struct memblock mem_param_tmp_91434;
    
    mem_param_tmp_91434.references = NULL;
    
    struct memblock mem_param_tmp_91433;
    
    mem_param_tmp_91433.references = NULL;
    
    struct memblock mem_param_tmp_91432;
    
    mem_param_tmp_91432.references = NULL;
    
    struct memblock mem_param_tmp_91431;
    
    mem_param_tmp_91431.references = NULL;
    
    struct memblock mem_param_tmp_91430;
    
    mem_param_tmp_91430.references = NULL;
    
    struct memblock mem_param_tmp_91429;
    
    mem_param_tmp_91429.references = NULL;
    
    struct memblock mem_param_tmp_91428;
    
    mem_param_tmp_91428.references = NULL;
    
    struct memblock mem_90210;
    
    mem_90210.references = NULL;
    
    struct memblock ext_mem_90221;
    
    ext_mem_90221.references = NULL;
    
    struct memblock mem_90198;
    
    mem_90198.references = NULL;
    
    struct memblock mem_90195;
    
    mem_90195.references = NULL;
    
    struct memblock mem_90193;
    
    mem_90193.references = NULL;
    
    struct memblock ext_mem_90235;
    
    ext_mem_90235.references = NULL;
    
    struct memblock ext_mem_90238;
    
    ext_mem_90238.references = NULL;
    
    struct memblock ext_mem_90241;
    
    ext_mem_90241.references = NULL;
    
    struct memblock mem_90160;
    
    mem_90160.references = NULL;
    
    struct memblock ext_mem_90171;
    
    ext_mem_90171.references = NULL;
    
    struct memblock mem_90148;
    
    mem_90148.references = NULL;
    
    struct memblock mem_90145;
    
    mem_90145.references = NULL;
    
    struct memblock mem_90143;
    
    mem_90143.references = NULL;
    
    struct memblock ext_mem_90185;
    
    ext_mem_90185.references = NULL;
    
    struct memblock ext_mem_90188;
    
    ext_mem_90188.references = NULL;
    
    struct memblock ext_mem_90191;
    
    ext_mem_90191.references = NULL;
    
    struct memblock mem_90135;
    
    mem_90135.references = NULL;
    
    struct memblock mem_90127;
    
    mem_90127.references = NULL;
    
    struct memblock mem_param_90125;
    
    mem_param_90125.references = NULL;
    
    struct memblock mem_param_90122;
    
    mem_param_90122.references = NULL;
    
    struct memblock mem_param_90119;
    
    mem_param_90119.references = NULL;
    
    struct memblock mem_param_90116;
    
    mem_param_90116.references = NULL;
    
    struct memblock mem_param_90113;
    
    mem_param_90113.references = NULL;
    
    struct memblock mem_param_90109;
    
    mem_param_90109.references = NULL;
    
    struct memblock mem_param_90106;
    
    mem_param_90106.references = NULL;
    
    struct memblock mem_param_90103;
    
    mem_param_90103.references = NULL;
    
    struct memblock mem_param_90100;
    
    mem_param_90100.references = NULL;
    
    struct memblock ext_mem_90262;
    
    ext_mem_90262.references = NULL;
    
    struct memblock ext_mem_90263;
    
    ext_mem_90263.references = NULL;
    
    struct memblock ext_mem_90264;
    
    ext_mem_90264.references = NULL;
    
    struct memblock ext_mem_90265;
    
    ext_mem_90265.references = NULL;
    
    struct memblock ext_mem_90266;
    
    ext_mem_90266.references = NULL;
    
    struct memblock ext_mem_90267;
    
    ext_mem_90267.references = NULL;
    
    struct memblock ext_mem_90268;
    
    ext_mem_90268.references = NULL;
    
    struct memblock ext_mem_90269;
    
    ext_mem_90269.references = NULL;
    
    struct memblock ext_mem_90270;
    
    ext_mem_90270.references = NULL;
    
    struct memblock mem_90065;
    
    mem_90065.references = NULL;
    
    struct memblock ext_mem_90076;
    
    ext_mem_90076.references = NULL;
    
    struct memblock mem_90053;
    
    mem_90053.references = NULL;
    
    struct memblock mem_90050;
    
    mem_90050.references = NULL;
    
    struct memblock mem_90048;
    
    mem_90048.references = NULL;
    
    struct memblock ext_mem_90090;
    
    ext_mem_90090.references = NULL;
    
    struct memblock ext_mem_90093;
    
    ext_mem_90093.references = NULL;
    
    struct memblock ext_mem_90096;
    
    ext_mem_90096.references = NULL;
    
    struct memblock mem_90015;
    
    mem_90015.references = NULL;
    
    struct memblock ext_mem_90026;
    
    ext_mem_90026.references = NULL;
    
    struct memblock mem_90003;
    
    mem_90003.references = NULL;
    
    struct memblock mem_90000;
    
    mem_90000.references = NULL;
    
    struct memblock mem_89998;
    
    mem_89998.references = NULL;
    
    struct memblock ext_mem_90040;
    
    ext_mem_90040.references = NULL;
    
    struct memblock ext_mem_90043;
    
    ext_mem_90043.references = NULL;
    
    struct memblock ext_mem_90046;
    
    ext_mem_90046.references = NULL;
    
    struct memblock mem_param_89878;
    
    mem_param_89878.references = NULL;
    
    struct memblock mem_param_89874;
    
    mem_param_89874.references = NULL;
    
    struct memblock mem_param_89871;
    
    mem_param_89871.references = NULL;
    
    struct memblock ext_mem_90820;
    
    ext_mem_90820.references = NULL;
    
    struct memblock ext_mem_90821;
    
    ext_mem_90821.references = NULL;
    
    struct memblock ext_mem_90822;
    
    ext_mem_90822.references = NULL;
    
    struct memblock mem_param_tmp_91323;
    
    mem_param_tmp_91323.references = NULL;
    
    struct memblock mem_param_tmp_91322;
    
    mem_param_tmp_91322.references = NULL;
    
    struct memblock mem_param_tmp_91321;
    
    mem_param_tmp_91321.references = NULL;
    
    struct memblock mem_param_tmp_91320;
    
    mem_param_tmp_91320.references = NULL;
    
    struct memblock mem_param_tmp_91319;
    
    mem_param_tmp_91319.references = NULL;
    
    struct memblock mem_89783;
    
    mem_89783.references = NULL;
    
    struct memblock ext_mem_89794;
    
    ext_mem_89794.references = NULL;
    
    struct memblock mem_89771;
    
    mem_89771.references = NULL;
    
    struct memblock mem_89768;
    
    mem_89768.references = NULL;
    
    struct memblock mem_89766;
    
    mem_89766.references = NULL;
    
    struct memblock ext_mem_89808;
    
    ext_mem_89808.references = NULL;
    
    struct memblock ext_mem_89811;
    
    ext_mem_89811.references = NULL;
    
    struct memblock ext_mem_89814;
    
    ext_mem_89814.references = NULL;
    
    struct memblock mem_89733;
    
    mem_89733.references = NULL;
    
    struct memblock ext_mem_89744;
    
    ext_mem_89744.references = NULL;
    
    struct memblock mem_89721;
    
    mem_89721.references = NULL;
    
    struct memblock mem_89718;
    
    mem_89718.references = NULL;
    
    struct memblock mem_89716;
    
    mem_89716.references = NULL;
    
    struct memblock ext_mem_89758;
    
    ext_mem_89758.references = NULL;
    
    struct memblock ext_mem_89761;
    
    ext_mem_89761.references = NULL;
    
    struct memblock ext_mem_89764;
    
    ext_mem_89764.references = NULL;
    
    struct memblock mem_89708;
    
    mem_89708.references = NULL;
    
    struct memblock mem_89700;
    
    mem_89700.references = NULL;
    
    struct memblock mem_param_89698;
    
    mem_param_89698.references = NULL;
    
    struct memblock mem_param_89695;
    
    mem_param_89695.references = NULL;
    
    struct memblock mem_param_89692;
    
    mem_param_89692.references = NULL;
    
    struct memblock mem_param_89689;
    
    mem_param_89689.references = NULL;
    
    struct memblock mem_param_89686;
    
    mem_param_89686.references = NULL;
    
    struct memblock ext_mem_89826;
    
    ext_mem_89826.references = NULL;
    
    struct memblock ext_mem_89827;
    
    ext_mem_89827.references = NULL;
    
    struct memblock ext_mem_89828;
    
    ext_mem_89828.references = NULL;
    
    struct memblock ext_mem_89829;
    
    ext_mem_89829.references = NULL;
    
    struct memblock ext_mem_89830;
    
    ext_mem_89830.references = NULL;
    
    struct memblock mem_89651;
    
    mem_89651.references = NULL;
    
    struct memblock ext_mem_89662;
    
    ext_mem_89662.references = NULL;
    
    struct memblock mem_89639;
    
    mem_89639.references = NULL;
    
    struct memblock mem_89636;
    
    mem_89636.references = NULL;
    
    struct memblock mem_89634;
    
    mem_89634.references = NULL;
    
    struct memblock ext_mem_89676;
    
    ext_mem_89676.references = NULL;
    
    struct memblock ext_mem_89679;
    
    ext_mem_89679.references = NULL;
    
    struct memblock ext_mem_89682;
    
    ext_mem_89682.references = NULL;
    
    struct memblock mem_89601;
    
    mem_89601.references = NULL;
    
    struct memblock ext_mem_89612;
    
    ext_mem_89612.references = NULL;
    
    struct memblock mem_89589;
    
    mem_89589.references = NULL;
    
    struct memblock mem_89586;
    
    mem_89586.references = NULL;
    
    struct memblock mem_89584;
    
    mem_89584.references = NULL;
    
    struct memblock ext_mem_89626;
    
    ext_mem_89626.references = NULL;
    
    struct memblock ext_mem_89629;
    
    ext_mem_89629.references = NULL;
    
    struct memblock ext_mem_89632;
    
    ext_mem_89632.references = NULL;
    
    struct memblock mem_89984;
    
    mem_89984.references = NULL;
    
    struct memblock mem_89982;
    
    mem_89982.references = NULL;
    
    struct memblock mem_89952;
    
    mem_89952.references = NULL;
    
    struct memblock mem_89949;
    
    mem_89949.references = NULL;
    
    struct memblock mem_89947;
    
    mem_89947.references = NULL;
    
    struct memblock mem_89852;
    
    mem_89852.references = NULL;
    
    struct memblock mem_89576;
    
    mem_89576.references = NULL;
    
    struct memblock mem_89568;
    
    mem_89568.references = NULL;
    
    struct memblock mem_89544;
    
    mem_89544.references = NULL;
    
    struct memblock mem_89533;
    
    mem_89533.references = NULL;
    
    struct memblock mem_89485;
    
    mem_89485.references = NULL;
    
    struct memblock mem_89452;
    
    mem_89452.references = NULL;
    
    struct memblock mem_89449;
    
    mem_89449.references = NULL;
    
    struct memblock ext_mem_89446;
    
    ext_mem_89446.references = NULL;
    
    struct memblock ext_mem_89447;
    
    ext_mem_89447.references = NULL;
    
    struct memblock mem_out_91249;
    
    mem_out_91249.references = NULL;
    
    int64_t prim_out_91250;
    int64_t binop_x_89412 = (int64_t) 8 * k_34814;
    int64_t binop_x_89413 = m_34815 * binop_x_89412;
    int64_t bytes_89414 = m_34815 * binop_x_89413;
    int64_t zbzg_lhs_52612;
    
    if (futrts_pairs_11446(ctx, &ext_mem_89447, &ext_mem_89446, &zbzg_lhs_52612, k_34814) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int64_t bytes_89448 = (int64_t) 8 * m_34815;
    int64_t bytes_89451 = (int64_t) 40 * zbzg_lhs_52612;
    int64_t bytes_89482 = m_34815 * bytes_89448;
    
    if (mem_89415_cached_sizze_91713 < bytes_89414) {
        err = lexical_realloc(ctx, &mem_89415, &mem_89415_cached_sizze_91713, bytes_89414);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    int64_t lmad_arg_89421 = m_34815 * m_34815;
    
    for (int64_t i_88618 = 0; i_88618 < k_34814; i_88618++) {
        for (int64_t i_88614 = 0; i_88614 < m_34815; i_88614++) {
            for (int64_t i_88610 = 0; i_88610 < m_34815; i_88610++) {
                double defunc_0_reduce_res_78826;
                double redout_88606 = 0.0;
                
                for (int64_t i_88607 = 0; i_88607 < d_34816; i_88607++) {
                    double eta_p_55832 = ((double *) pt_clouds_mem_89411.mem)[i_88618 * (d_34816 * m_34815) + i_88614 * d_34816 + i_88607];
                    double eta_p_55833 = ((double *) pt_clouds_mem_89411.mem)[i_88618 * (d_34816 * m_34815) + i_88610 * d_34816 + i_88607];
                    double zm_res_55834 = eta_p_55832 - eta_p_55833;
                    double zt_res_55837 = zm_res_55834 * zm_res_55834;
                    double zp_res_55823 = zt_res_55837 + redout_88606;
                    double redout_tmp_91254 = zp_res_55823;
                    
                    redout_88606 = redout_tmp_91254;
                }
                defunc_0_reduce_res_78826 = redout_88606;
                
                double sqrt_res_55825 = futrts_sqrt64(defunc_0_reduce_res_78826);
                
                ((double *) mem_89415)[i_88618 * lmad_arg_89421 + i_88614 * m_34815 + i_88610] = sqrt_res_55825;
            }
        }
    }
    
    double i64_res_52609 = sitofp_i64_f64(m_34815);
    double replicate_arg1_52610 = 1.0 / i64_res_52609;
    double neg_res_52615 = -eps_34819;
    double zp_res_52616 = 1.0 + tol_outerloop_34824;
    double neg_res_52617 = -rho1_34817;
    double zp_res_52618 = rho1_34817 + eps_34819;
    double zs_res_52619 = neg_res_52617 / zp_res_52618;
    double zs_res_52620 = neg_res_52615 / zp_res_52618;
    double neg_res_52621 = -rho2_34818;
    double zp_res_52622 = rho2_34818 + eps_34819;
    double zs_res_52623 = neg_res_52621 / zp_res_52622;
    double zs_res_52624 = neg_res_52615 / zp_res_52622;
    double zp_res_52625 = rho2_34818 + zp_res_52618;
    
    if (memblock_alloc(ctx, &mem_89449, bytes_89448, "mem_89449")) {
        err = 1;
        goto cleanup;
    }
    for (int64_t nest_i_91255 = 0; nest_i_91255 < m_34815; nest_i_91255++) {
        ((double *) mem_89449.mem)[nest_i_91255] = 1.0;
    }
    if (memblock_alloc(ctx, &mem_89452, bytes_89451, "mem_89452")) {
        err = 1;
        goto cleanup;
    }
    
    bool loop_nonempty_89380 = slt64((int64_t) 0, m_34815);
    double zs_res_53000 = 1.0 / exp_absorb_cutoff_34821;
    double zp_res_79142 = 1.0 + tol_sinkhorn_34823;
    
    if (mem_89458_cached_sizze_91714 < bytes_89448) {
        err = lexical_realloc(ctx, &mem_89458, &mem_89458_cached_sizze_91714, bytes_89448);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89460_cached_sizze_91715 < bytes_89448) {
        err = lexical_realloc(ctx, &mem_89460, &mem_89460_cached_sizze_91715, bytes_89448);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89474_cached_sizze_91716 < bytes_89448) {
        err = lexical_realloc(ctx, &mem_89474, &mem_89474_cached_sizze_91716, bytes_89448);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89483_cached_sizze_91717 < bytes_89482) {
        err = lexical_realloc(ctx, &mem_89483, &mem_89483_cached_sizze_91717, bytes_89482);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89485, bytes_89448, "mem_89485")) {
        err = 1;
        goto cleanup;
    }
    if (mem_89494_cached_sizze_91718 < bytes_89448) {
        err = lexical_realloc(ctx, &mem_89494, &mem_89494_cached_sizze_91718, bytes_89448);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89496_cached_sizze_91719 < bytes_89448) {
        err = lexical_realloc(ctx, &mem_89496, &mem_89496_cached_sizze_91719, bytes_89448);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89510_cached_sizze_91720 < bytes_89448) {
        err = lexical_realloc(ctx, &mem_89510, &mem_89510_cached_sizze_91720, bytes_89448);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89533, bytes_89448, "mem_89533")) {
        err = 1;
        goto cleanup;
    }
    if (mem_89541_cached_sizze_91721 < bytes_89448) {
        err = lexical_realloc(ctx, &mem_89541, &mem_89541_cached_sizze_91721, bytes_89448);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89544, bytes_89482, "mem_89544")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89568, bytes_89448, "mem_89568")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89576, bytes_89448, "mem_89576")) {
        err = 1;
        goto cleanup;
    }
    if (mem_89833_cached_sizze_91722 < bytes_89482) {
        err = lexical_realloc(ctx, &mem_89833, &mem_89833_cached_sizze_91722, bytes_89482);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89852, bytes_89482, "mem_89852")) {
        err = 1;
        goto cleanup;
    }
    if (mem_89880_cached_sizze_91723 < bytes_89448) {
        err = lexical_realloc(ctx, &mem_89880, &mem_89880_cached_sizze_91723, bytes_89448);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89888_cached_sizze_91724 < bytes_89448) {
        err = lexical_realloc(ctx, &mem_89888, &mem_89888_cached_sizze_91724, bytes_89448);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89896_cached_sizze_91725 < bytes_89448) {
        err = lexical_realloc(ctx, &mem_89896, &mem_89896_cached_sizze_91725, bytes_89448);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89905_cached_sizze_91726 < bytes_89482) {
        err = lexical_realloc(ctx, &mem_89905, &mem_89905_cached_sizze_91726, bytes_89482);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89907_cached_sizze_91727 < bytes_89448) {
        err = lexical_realloc(ctx, &mem_89907, &mem_89907_cached_sizze_91727, bytes_89448);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89916_cached_sizze_91728 < bytes_89448) {
        err = lexical_realloc(ctx, &mem_89916, &mem_89916_cached_sizze_91728, bytes_89448);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89924_cached_sizze_91729 < bytes_89448) {
        err = lexical_realloc(ctx, &mem_89924, &mem_89924_cached_sizze_91729, bytes_89448);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89947, bytes_89448, "mem_89947")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89949, bytes_89448, "mem_89949")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89952, bytes_89482, "mem_89952")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89982, bytes_89448, "mem_89982")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89984, bytes_89448, "mem_89984")) {
        err = 1;
        goto cleanup;
    }
    if (mem_90555_cached_sizze_91730 < bytes_89482) {
        err = lexical_realloc(ctx, &mem_90555, &mem_90555_cached_sizze_91730, bytes_89482);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_90824_cached_sizze_91746 < bytes_89448) {
        err = lexical_realloc(ctx, &mem_90824, &mem_90824_cached_sizze_91746, bytes_89448);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_90826_cached_sizze_91747 < bytes_89448) {
        err = lexical_realloc(ctx, &mem_90826, &mem_90826_cached_sizze_91747, bytes_89448);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_90828_cached_sizze_91748 < bytes_89448) {
        err = lexical_realloc(ctx, &mem_90828, &mem_90828_cached_sizze_91748, bytes_89448);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_90839_cached_sizze_91749 < bytes_89448) {
        err = lexical_realloc(ctx, &mem_90839, &mem_90839_cached_sizze_91749, bytes_89448);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_90856_cached_sizze_91750 < bytes_89448) {
        err = lexical_realloc(ctx, &mem_90856, &mem_90856_cached_sizze_91750, bytes_89448);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_90858_cached_sizze_91751 < bytes_89448) {
        err = lexical_realloc(ctx, &mem_90858, &mem_90858_cached_sizze_91751, bytes_89448);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_90860_cached_sizze_91752 < bytes_89448) {
        err = lexical_realloc(ctx, &mem_90860, &mem_90860_cached_sizze_91752, bytes_89448);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    for (int64_t i_89378 = 0; i_89378 < zbzg_lhs_52612; i_89378++) {
        int64_t eta_p_52628 = ((int64_t *) ext_mem_89447.mem)[i_89378];
        int64_t eta_p_52629 = ((int64_t *) ext_mem_89446.mem)[i_89378];
        bool x_52630 = sle64((int64_t) 0, eta_p_52629);
        bool y_52631 = slt64(eta_p_52629, k_34814);
        bool bounds_check_52632 = x_52630 && y_52631;
        bool index_certs_52633;
        
        if (!bounds_check_52632) {
            set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) eta_p_52629, "] out of bounds for array of shape [", (long long) k_34814, "].", "-> #0  unbalanced_gw.fut:164:43-52\n   #1  /prelude/functional.fut:9:44-45\n   #2  unbalanced_gw.fut:162:6-165:84\n   #3  unbalanced_gw.fut:201:3-27\n   #4  unbalanced_gw.fut:199:1-201:47\n"));
            err = FUTHARK_PROGRAM_ERROR;
            goto cleanup;
        }
        
        bool x_52636 = sle64((int64_t) 0, eta_p_52628);
        bool y_52637 = slt64(eta_p_52628, k_34814);
        bool bounds_check_52638 = x_52636 && y_52637;
        bool index_certs_52639;
        
        if (!bounds_check_52638) {
            set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) eta_p_52628, "] out of bounds for array of shape [", (long long) k_34814, "].", "-> #0  unbalanced_gw.fut:164:28-37\n   #1  /prelude/functional.fut:9:44-45\n   #2  unbalanced_gw.fut:162:6-165:84\n   #3  unbalanced_gw.fut:201:3-27\n   #4  unbalanced_gw.fut:199:1-201:47\n"));
            err = FUTHARK_PROGRAM_ERROR;
            goto cleanup;
        }
        
        double zt_res_52646 = replicate_arg1_52610 * replicate_arg1_52610;
        double defunc_res_80219;
        double defunc_res_80220;
        double defunc_res_80221;
        double defunc_res_80222;
        double defunc_res_80223;
        double defunc_res_80224;
        double redout_88620;
        double redout_88621;
        double redout_88622;
        double redout_88623;
        double redout_88624;
        double redout_88625;
        
        redout_88620 = 0.0;
        redout_88621 = 0.0;
        redout_88622 = 0.0;
        redout_88623 = 0.0;
        redout_88624 = 0.0;
        redout_88625 = 0.0;
        for (int64_t i_88626 = 0; i_88626 < m_34815; i_88626++) {
            double zp_res_52653 = zt_res_52646 + redout_88620;
            double zp_res_52678 = zt_res_52646 + redout_88621;
            double zp_res_52769 = zt_res_52646 + redout_88622;
            double zp_res_52855 = zt_res_52646 + redout_88623;
            double zp_res_53307 = zt_res_52646 + redout_88624;
            double zp_res_53415 = zt_res_52646 + redout_88625;
            double redout_tmp_91257 = zp_res_52653;
            double redout_tmp_91258 = zp_res_52678;
            double redout_tmp_91259 = zp_res_52769;
            double redout_tmp_91260 = zp_res_52855;
            double redout_tmp_91261 = zp_res_53307;
            double redout_tmp_91262 = zp_res_53415;
            
            redout_88620 = redout_tmp_91257;
            redout_88621 = redout_tmp_91258;
            redout_88622 = redout_tmp_91259;
            redout_88623 = redout_tmp_91260;
            redout_88624 = redout_tmp_91261;
            redout_88625 = redout_tmp_91262;
        }
        defunc_res_80219 = redout_88620;
        defunc_res_80220 = redout_88621;
        defunc_res_80221 = redout_88622;
        defunc_res_80222 = redout_88623;
        defunc_res_80223 = redout_88624;
        defunc_res_80224 = redout_88625;
        
        double defunc_res_80226;
        double redout_88627 = 0.0;
        
        for (int64_t i_88628 = 0; i_88628 < m_34815; i_88628++) {
            double zp_res_52658 = defunc_res_80219 + redout_88627;
            double redout_tmp_91263 = zp_res_52658;
            
            redout_88627 = redout_tmp_91263;
        }
        defunc_res_80226 = redout_88627;
        
        double log_res_52661 = futrts_log64(replicate_arg1_52610);
        double zt_res_52662 = eps_34819 * defunc_res_80226;
        double zt_res_52665 = log_res_52661 * zt_res_52662;
        double defunc_res_78829;
        double defunc_res_78830;
        double defunc_res_78831;
        double defunc_res_78832;
        double redout_88629;
        double redout_88630;
        double redout_88631;
        double redout_88632;
        
        redout_88629 = 0.0;
        redout_88630 = 0.0;
        redout_88631 = 0.0;
        redout_88632 = 0.0;
        for (int64_t i_88633 = 0; i_88633 < m_34815; i_88633++) {
            double zp_res_57285 = zt_res_52646 + redout_88629;
            double zp_res_57291 = zt_res_52646 + redout_88630;
            double zp_res_57304 = zt_res_52646 + redout_88631;
            double zp_res_57311 = zt_res_52646 + redout_88632;
            double redout_tmp_91264 = zp_res_57285;
            double redout_tmp_91265 = zp_res_57291;
            double redout_tmp_91266 = zp_res_57304;
            double redout_tmp_91267 = zp_res_57311;
            
            redout_88629 = redout_tmp_91264;
            redout_88630 = redout_tmp_91265;
            redout_88631 = redout_tmp_91266;
            redout_88632 = redout_tmp_91267;
        }
        defunc_res_78829 = redout_88629;
        defunc_res_78830 = redout_88630;
        defunc_res_78831 = redout_88631;
        defunc_res_78832 = redout_88632;
        
        bool zeze_res_57293 = defunc_res_78830 == 0.0;
        double zs_res_57295 = defunc_res_78830 / replicate_arg1_52610;
        double log_res_57296 = futrts_log64(zs_res_57295);
        double zt_res_57297 = log_res_57296 * defunc_res_78830;
        double klu_res_57294;
        
        if (zeze_res_57293) {
            klu_res_57294 = 0.0;
        } else {
            klu_res_57294 = zt_res_57297;
        }
        
        bool zeze_res_57313 = defunc_res_78832 == 0.0;
        double zs_res_57315 = defunc_res_78832 / replicate_arg1_52610;
        double log_res_57316 = futrts_log64(zs_res_57315);
        double zt_res_57317 = log_res_57316 * defunc_res_78832;
        double klu_res_57314;
        
        if (zeze_res_57313) {
            klu_res_57314 = 0.0;
        } else {
            klu_res_57314 = zt_res_57317;
        }
        
        double defunc_res_80228;
        double defunc_res_80229;
        double redout_88636;
        double redout_88637;
        
        redout_88636 = 0.0;
        redout_88637 = 0.0;
        for (int64_t i_88640 = 0; i_88640 < m_34815; i_88640++) {
            double zp_res_52803 = klu_res_57294 + redout_88636;
            double zp_res_53477 = klu_res_57314 + redout_88637;
            
            ((double *) mem_89458)[i_88640] = defunc_res_78831;
            ((double *) mem_89460)[i_88640] = defunc_res_78829;
            
            double redout_tmp_91268 = zp_res_52803;
            double redout_tmp_91269 = zp_res_53477;
            
            redout_88636 = redout_tmp_91268;
            redout_88637 = redout_tmp_91269;
        }
        defunc_res_80228 = redout_88636;
        defunc_res_80229 = redout_88637;
        
        double defunc_res_80232;
        double redout_88643 = 0.0;
        
        for (int64_t i_88644 = 0; i_88644 < m_34815; i_88644++) {
            double zp_res_52860 = defunc_res_80222 + redout_88643;
            double redout_tmp_91272 = zp_res_52860;
            
            redout_88643 = redout_tmp_91272;
        }
        defunc_res_80232 = redout_88643;
        
        double zt_res_52804 = rho2_34818 * defunc_res_80228;
        bool zeze_res_52773 = defunc_res_80221 == 0.0;
        double zs_res_52775 = defunc_res_80221 / replicate_arg1_52610;
        double log_res_52776 = futrts_log64(zs_res_52775);
        double zt_res_52777 = log_res_52776 * defunc_res_80221;
        double klu_res_52774;
        
        if (zeze_res_52773) {
            klu_res_52774 = 0.0;
        } else {
            klu_res_52774 = zt_res_52777;
        }
        
        double defunc_res_80234;
        double redout_88645 = 0.0;
        
        for (int64_t i_88646 = 0; i_88646 < m_34815; i_88646++) {
            double zp_res_52782 = klu_res_52774 + redout_88645;
            double redout_tmp_91273 = zp_res_52782;
            
            redout_88645 = redout_tmp_91273;
        }
        defunc_res_80234 = redout_88645;
        
        double zt_res_52783 = rho1_34817 * defunc_res_80234;
        double zp_res_52828 = zt_res_52783 + zt_res_52804;
        bool zeze_res_52812 = zt_res_52646 == 0.0;
        double zs_res_52814 = zt_res_52646 / zt_res_52646;
        double log_res_52815 = futrts_log64(zs_res_52814);
        double zt_res_52816 = zt_res_52646 * log_res_52815;
        double klu_res_52813;
        
        if (zeze_res_52812) {
            klu_res_52813 = 0.0;
        } else {
            klu_res_52813 = zt_res_52816;
        }
        
        double defunc_res_80236;
        double redout_88647 = 0.0;
        
        for (int64_t i_88648 = 0; i_88648 < m_34815; i_88648++) {
            double zp_res_52821 = klu_res_52813 + redout_88647;
            double redout_tmp_91274 = zp_res_52821;
            
            redout_88647 = redout_tmp_91274;
        }
        defunc_res_80236 = redout_88647;
        
        double defunc_res_80238;
        double redout_88649 = 0.0;
        
        for (int64_t i_88650 = 0; i_88650 < m_34815; i_88650++) {
            double zp_res_52826 = defunc_res_80236 + redout_88649;
            double redout_tmp_91275 = zp_res_52826;
            
            redout_88649 = redout_tmp_91275;
        }
        defunc_res_80238 = redout_88649;
        
        double zt_res_52827 = eps_34819 * defunc_res_80238;
        double zp_res_52829 = zt_res_52827 + zp_res_52828;
        double defunc_0_reduce_res_80240;
        double redout_88655 = 0.0;
        
        for (int64_t i_88657 = 0; i_88657 < m_34815; i_88657++) {
            double eta_p_57570 = ((double *) mem_89458)[i_88657];
            double defunc_0_reduce_res_78833;
            double defunc_0_reduce_res_78834;
            double redout_88651;
            double redout_88652;
            
            redout_88651 = 0.0;
            redout_88652 = 0.0;
            for (int64_t i_88653 = 0; i_88653 < m_34815; i_88653++) {
                double eta_p_58557 = ((double *) mem_89415)[eta_p_52629 * lmad_arg_89421 + i_88657 * m_34815 + i_88653];
                double eta_p_58558 = ((double *) mem_89458)[i_88653];
                double eta_p_58559 = ((double *) mem_89460)[i_88653];
                double zt_res_58562 = eta_p_58557 * eta_p_58557;
                double zt_res_58564 = eta_p_58559 * zt_res_58562;
                double zt_res_58569 = eta_p_58558 * zt_res_58562;
                double zp_res_57584 = zt_res_58564 + redout_88651;
                double zp_res_57598 = zt_res_58569 + redout_88652;
                double redout_tmp_91278 = zp_res_57584;
                double redout_tmp_91279 = zp_res_57598;
                
                redout_88651 = redout_tmp_91278;
                redout_88652 = redout_tmp_91279;
            }
            defunc_0_reduce_res_78833 = redout_88651;
            defunc_0_reduce_res_78834 = redout_88652;
            
            double zt_res_57600 = eta_p_57570 * defunc_0_reduce_res_78834;
            double zp_res_53362 = zt_res_57600 + redout_88655;
            
            ((double *) mem_89474)[i_88657] = defunc_0_reduce_res_78833;
            
            double redout_tmp_91276 = zp_res_53362;
            
            redout_88655 = redout_tmp_91276;
        }
        defunc_0_reduce_res_80240 = redout_88655;
        
        double defunc_0_reduce_res_80242;
        double defunc_res_80243;
        double redout_88687;
        double redout_88688;
        
        redout_88687 = 0.0;
        redout_88688 = 0.0;
        for (int64_t i_88691 = 0; i_88691 < m_34815; i_88691++) {
            double defunc_0_reduce_res_78839;
            double defunc_0_reduce_res_78840;
            double redout_88659;
            double redout_88660;
            
            redout_88659 = 0.0;
            redout_88660 = 0.0;
            for (int64_t i_88661 = 0; i_88661 < m_34815; i_88661++) {
                double eta_p_58396 = ((double *) mem_89415)[eta_p_52628 * lmad_arg_89421 + i_88691 * m_34815 + i_88661];
                double zt_res_58399 = eta_p_58396 * eta_p_58396;
                double zt_res_58401 = zt_res_58399 * defunc_res_80220;
                double zt_res_58406 = zt_res_58399 * defunc_res_80223;
                double zp_res_57444 = zt_res_58401 + redout_88659;
                double zp_res_57529 = zt_res_58406 + redout_88660;
                double redout_tmp_91284 = zp_res_57444;
                double redout_tmp_91285 = zp_res_57529;
                
                redout_88659 = redout_tmp_91284;
                redout_88660 = redout_tmp_91285;
            }
            defunc_0_reduce_res_78839 = redout_88659;
            defunc_0_reduce_res_78840 = redout_88660;
            
            double defunc_0_reduce_res_78835;
            double defunc_0_reduce_res_78836;
            
            if (loop_nonempty_89380) {
                double x_89381;
                double x_89382;
                double redout_88662;
                double redout_88663;
                
                redout_88662 = 0.0;
                redout_88663 = 0.0;
                for (int64_t i_88664 = 0; i_88664 < m_34815; i_88664++) {
                    double eta_p_58487 = ((double *) mem_89415)[eta_p_52628 * lmad_arg_89421 + i_88691 * m_34815 + i_88664];
                    double zt_res_58491 = zt_res_52646 * eta_p_58487;
                    double zp_res_58419 = zt_res_58491 + redout_88662;
                    double zp_res_58429 = zt_res_58491 + redout_88663;
                    double redout_tmp_91286 = zp_res_58419;
                    double redout_tmp_91287 = zp_res_58429;
                    
                    redout_88662 = redout_tmp_91286;
                    redout_88663 = redout_tmp_91287;
                }
                x_89381 = redout_88662;
                x_89382 = redout_88663;
                defunc_0_reduce_res_78835 = x_89381;
                defunc_0_reduce_res_78836 = x_89382;
            } else {
                defunc_0_reduce_res_78835 = 0.0;
                defunc_0_reduce_res_78836 = 0.0;
            }
            for (int64_t i_88669 = 0; i_88669 < m_34815; i_88669++) {
                ((double *) mem_89494)[i_88669] = defunc_0_reduce_res_78836;
                ((double *) mem_89496)[i_88669] = defunc_0_reduce_res_78835;
            }
            
            double defunc_0_reduce_res_78843;
            double defunc_0_reduce_res_78844;
            double redout_88676;
            double redout_88677;
            
            redout_88676 = INFINITY;
            redout_88677 = 0.0;
            for (int64_t i_88679 = 0; i_88679 < m_34815; i_88679++) {
                double eta_p_wasfree_58433 = ((double *) mem_89474)[i_88679];
                double defunc_0_reduce_res_78837;
                double defunc_0_reduce_res_78838;
                double redout_88672;
                double redout_88673;
                
                redout_88672 = 0.0;
                redout_88673 = 0.0;
                for (int64_t i_88674 = 0; i_88674 < m_34815; i_88674++) {
                    double eta_p_58508 = ((double *) mem_89494)[i_88674];
                    double eta_p_58509 = ((double *) mem_89415)[eta_p_52629 * lmad_arg_89421 + i_88674 * m_34815 + i_88679];
                    double eta_p_58510 = ((double *) mem_89496)[i_88674];
                    double zt_res_58512 = eta_p_58509 * eta_p_58510;
                    double zt_res_58514 = eta_p_58508 * eta_p_58509;
                    double zp_res_58443 = zt_res_58512 + redout_88672;
                    double zp_res_58472 = zt_res_58514 + redout_88673;
                    double redout_tmp_91293 = zp_res_58443;
                    double redout_tmp_91294 = zp_res_58472;
                    
                    redout_88672 = redout_tmp_91293;
                    redout_88673 = redout_tmp_91294;
                }
                defunc_0_reduce_res_78837 = redout_88672;
                defunc_0_reduce_res_78838 = redout_88673;
                
                double zt_res_58445 = -2.0 * defunc_0_reduce_res_78837;
                double zp_res_58447 = zt_res_58445 + defunc_0_reduce_res_78839;
                double zp_res_58449 = eta_p_wasfree_58433 + zp_res_58447;
                double zp_res_58451 = zp_res_52829 + zp_res_58449;
                double zm_res_58453 = zp_res_58451 - zt_res_52665;
                double zm_res_58455 = zm_res_58453 - zt_res_52665;
                double zs_res_58457 = zm_res_58455 / defunc_res_80232;
                double zs_res_58459 = zs_res_58457 / neg_res_52615;
                double zm_res_58461 = safe_for_exp_34822 - zs_res_58459;
                double zt_res_58474 = zt_res_52646 * defunc_0_reduce_res_78838;
                double min_res_57511 = fmin64(zm_res_58461, redout_88676);
                double zp_res_57566 = zt_res_58474 + redout_88677;
                
                ((double *) mem_89510)[i_88679] = zs_res_58459;
                
                double redout_tmp_91290 = min_res_57511;
                double redout_tmp_91291 = zp_res_57566;
                
                redout_88676 = redout_tmp_91290;
                redout_88677 = redout_tmp_91291;
            }
            defunc_0_reduce_res_78843 = redout_88676;
            defunc_0_reduce_res_78844 = redout_88677;
            for (int64_t i_88683 = 0; i_88683 < m_34815; i_88683++) {
                double eta_p_57514 = ((double *) mem_89510)[i_88683];
                double zp_res_57515 = eta_p_57514 + defunc_0_reduce_res_78843;
                
                ((double *) mem_89483)[i_88691 * m_34815 + i_88683] = zp_res_57515;
            }
            
            double zt_res_57531 = defunc_0_reduce_res_78840 * defunc_res_80223;
            double zp_res_53338 = zt_res_57531 + redout_88687;
            double zp_res_53405 = defunc_0_reduce_res_78844 + redout_88688;
            
            ((double *) mem_89485.mem)[i_88691] = defunc_0_reduce_res_78843;
            
            double redout_tmp_91280 = zp_res_53338;
            double redout_tmp_91281 = zp_res_53405;
            
            redout_88687 = redout_tmp_91280;
            redout_88688 = redout_tmp_91281;
        }
        defunc_0_reduce_res_80242 = redout_88687;
        defunc_res_80243 = redout_88688;
        for (int64_t i_88698 = 0; i_88698 < m_34815; i_88698++) {
            double defunc_0_reduce_res_78847;
            double redout_88694 = INFINITY;
            
            for (int64_t i_88695 = 0; i_88695 < m_34815; i_88695++) {
                double eta_p_58574 = ((double *) mem_89483)[i_88695 * m_34815 + i_88698];
                double zm_res_58575 = safe_for_exp_34822 - eta_p_58574;
                double min_res_52897 = fmin64(zm_res_58575, redout_88694);
                double redout_tmp_91297 = min_res_52897;
                
                redout_88694 = redout_tmp_91297;
            }
            defunc_0_reduce_res_78847 = redout_88694;
            ((double *) mem_89533.mem)[i_88698] = defunc_0_reduce_res_78847;
        }
        for (int64_t i_88709 = 0; i_88709 < m_34815; i_88709++) {
            double eta_p_56626 = ((double *) mem_89485.mem)[i_88709];
            double defunc_0_reduce_res_78848;
            double redout_88701 = 0.0;
            
            for (int64_t i_88703 = 0; i_88703 < m_34815; i_88703++) {
                double eta_p_58583 = ((double *) mem_89483)[i_88709 * m_34815 + i_88703];
                double eta_p_wasfree_58584 = ((double *) mem_89533.mem)[i_88703];
                double zp_res_58585 = eta_p_58583 + eta_p_wasfree_58584;
                double exp_res_58587 = futrts_exp64(zp_res_58585);
                double zp_res_56642 = exp_res_58587 + redout_88701;
                
                ((double *) mem_89544.mem)[i_88709 * m_34815 + i_88703] = exp_res_58587;
                
                double redout_tmp_91300 = zp_res_56642;
                
                redout_88701 = redout_tmp_91300;
            }
            defunc_0_reduce_res_78848 = redout_88701;
            
            double zs_res_56644 = defunc_0_reduce_res_78848 / replicate_arg1_52610;
            double ztzt_res_56646 = fpow64(zs_res_56644, zs_res_52619);
            double zt_res_56648 = zs_res_52620 * eta_p_56626;
            double exp_res_56650 = futrts_exp64(zt_res_56648);
            double zt_res_56652 = ztzt_res_56646 * exp_res_56650;
            
            ((double *) mem_89541)[i_88709] = zt_res_56652;
        }
        
        bool defunc_0_reduce_res_80251;
        bool redout_88715 = 0;
        
        for (int64_t i_88717 = 0; i_88717 < m_34815; i_88717++) {
            double eta_p_56523 = ((double *) mem_89533.mem)[i_88717];
            double defunc_0_reduce_res_78850;
            double redout_88712 = 0.0;
            
            for (int64_t i_88713 = 0; i_88713 < m_34815; i_88713++) {
                double eta_p_58592 = ((double *) mem_89541)[i_88713];
                double eta_p_58593 = ((double *) mem_89544.mem)[i_88713 * m_34815 + i_88717];
                double zt_res_58594 = eta_p_58592 * eta_p_58593;
                double zp_res_56532 = zt_res_58594 + redout_88712;
                double redout_tmp_91304 = zp_res_56532;
                
                redout_88712 = redout_tmp_91304;
            }
            defunc_0_reduce_res_78850 = redout_88712;
            
            double zs_res_56534 = defunc_0_reduce_res_78850 / replicate_arg1_52610;
            double ztzt_res_56536 = fpow64(zs_res_56534, zs_res_52623);
            double zt_res_56538 = zs_res_52624 * eta_p_56523;
            double exp_res_56540 = futrts_exp64(zt_res_56538);
            double zt_res_56542 = ztzt_res_56536 * exp_res_56540;
            bool zgze_res_56544 = exp_absorb_cutoff_34821 <= zt_res_56542;
            bool defunc_0_op_res_53041 = zgze_res_56544 || redout_88715;
            
            ((double *) mem_89568.mem)[i_88717] = zt_res_56542;
            
            bool redout_tmp_91302 = defunc_0_op_res_53041;
            
            redout_88715 = redout_tmp_91302;
        }
        defunc_0_reduce_res_80251 = redout_88715;
        
        bool defunc_0_reduce_res_80254;
        bool redout_88722 = 0;
        
        for (int64_t i_88724 = 0; i_88724 < m_34815; i_88724++) {
            double eta_p_56443 = ((double *) mem_89485.mem)[i_88724];
            double defunc_0_reduce_res_78851;
            double redout_88719 = 0.0;
            
            for (int64_t i_88720 = 0; i_88720 < m_34815; i_88720++) {
                double eta_p_58598 = ((double *) mem_89568.mem)[i_88720];
                double eta_p_58599 = ((double *) mem_89544.mem)[i_88724 * m_34815 + i_88720];
                double zt_res_58600 = eta_p_58598 * eta_p_58599;
                double zp_res_56452 = zt_res_58600 + redout_88719;
                double redout_tmp_91307 = zp_res_56452;
                
                redout_88719 = redout_tmp_91307;
            }
            defunc_0_reduce_res_78851 = redout_88719;
            
            double zs_res_56454 = defunc_0_reduce_res_78851 / replicate_arg1_52610;
            double ztzt_res_56456 = fpow64(zs_res_56454, zs_res_52619);
            double zt_res_56458 = zs_res_52620 * eta_p_56443;
            double exp_res_56460 = futrts_exp64(zt_res_56458);
            double zt_res_56462 = ztzt_res_56456 * exp_res_56460;
            bool zgze_res_56464 = exp_absorb_cutoff_34821 <= zt_res_56462;
            bool defunc_0_op_res_52998 = zgze_res_56464 || redout_88722;
            
            ((double *) mem_89576.mem)[i_88724] = zt_res_56462;
            
            bool redout_tmp_91305 = defunc_0_op_res_52998;
            
            redout_88722 = redout_tmp_91305;
        }
        defunc_0_reduce_res_80254 = redout_88722;
        
        bool x_91031 = !defunc_0_reduce_res_80254;
        bool defunc_0_reduce_res_78852;
        
        if (x_91031) {
            bool x_91033;
            bool redout_88726 = 0;
            
            for (int64_t i_88727 = 0; i_88727 < m_34815; i_88727++) {
                double eta_p_58604 = ((double *) mem_89576.mem)[i_88727];
                bool zlze_res_58605 = eta_p_58604 <= zs_res_53000;
                bool defunc_0_op_res_53008 = zlze_res_58605 || redout_88726;
                bool redout_tmp_91308 = defunc_0_op_res_53008;
                
                redout_88726 = redout_tmp_91308;
            }
            x_91033 = redout_88726;
            defunc_0_reduce_res_78852 = x_91033;
        } else {
            defunc_0_reduce_res_78852 = 0;
        }
        
        bool cond_52999 = defunc_0_reduce_res_78852 || defunc_0_reduce_res_80254;
        
        if (cond_52999) {
            if (memblock_alloc(ctx, &mem_89584, bytes_89448, "mem_89584")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc(ctx, &mem_89586, bytes_89448, "mem_89586")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc(ctx, &mem_89589, bytes_89482, "mem_89589")) {
                err = 1;
                goto cleanup;
            }
            for (int64_t i_88738 = 0; i_88738 < m_34815; i_88738++) {
                double eta_p_78869 = ((double *) mem_89576.mem)[i_88738];
                double eta_p_78870 = ((double *) mem_89485.mem)[i_88738];
                bool zgze_res_78872 = exp_absorb_cutoff_34821 <= eta_p_78869;
                bool zl_res_78873 = eta_p_78869 < zs_res_53000;
                bool x_78874 = !zgze_res_78872;
                bool y_78875 = zl_res_78873 && x_78874;
                bool cond_78876 = zgze_res_78872 || y_78875;
                int64_t binop_y_89608 = m_34815 * i_88738;
                int64_t ext_89611;
                
                if (cond_78876) {
                    ext_89611 = (int64_t) 0;
                } else {
                    ext_89611 = binop_y_89608;
                }
                
                double rescale_res_78877;
                double rescale_res_78878;
                
                if (cond_78876) {
                    double log_res_78880 = futrts_log64(eta_p_78869);
                    double sqrt_res_78881 = futrts_sqrt64(eta_p_78869);
                    double zs_res_78882 = log_res_78880 / 2.0;
                    double zp_res_78883 = eta_p_78870 + zs_res_78882;
                    
                    if (memblock_alloc(ctx, &mem_89601, bytes_89448, "mem_89601")) {
                        err = 1;
                        goto cleanup;
                    }
                    for (int64_t i_88730 = 0; i_88730 < m_34815; i_88730++) {
                        double eta_p_78885 = ((double *) mem_89544.mem)[i_88738 * m_34815 + i_88730];
                        double zt_res_78886 = sqrt_res_78881 * eta_p_78885;
                        
                        ((double *) mem_89601.mem)[i_88730] = zt_res_78886;
                    }
                    if (memblock_set(ctx, &ext_mem_89612, &mem_89601, "mem_89601") != 0)
                        return 1;
                    rescale_res_78877 = sqrt_res_78881;
                    rescale_res_78878 = zp_res_78883;
                } else {
                    if (memblock_set(ctx, &ext_mem_89612, &mem_89544, "mem_89544") != 0)
                        return 1;
                    rescale_res_78877 = eta_p_78869;
                    rescale_res_78878 = eta_p_78870;
                }
                ((double *) mem_89584.mem)[i_88738] = rescale_res_78877;
                ((double *) mem_89586.mem)[i_88738] = rescale_res_78878;
                lmad_copy_8b(ctx, 1, (uint64_t *) mem_89589.mem, i_88738 * m_34815, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_89612.mem, ext_89611, (int64_t []) {(int64_t) 1}, (int64_t []) {m_34815});
                if (memblock_unref(ctx, &ext_mem_89612, "ext_mem_89612") != 0)
                    return 1;
            }
            if (memblock_set(ctx, &ext_mem_89632, &mem_89584, "mem_89584") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_89629, &mem_89586, "mem_89586") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_89626, &mem_89589, "mem_89589") != 0)
                return 1;
        } else {
            if (memblock_set(ctx, &ext_mem_89632, &mem_89576, "mem_89576") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_89629, &mem_89485, "mem_89485") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_89626, &mem_89544, "mem_89544") != 0)
                return 1;
        }
        
        bool x_91027 = !defunc_0_reduce_res_80251;
        bool defunc_0_reduce_res_78891;
        
        if (x_91027) {
            bool x_91029;
            bool redout_88742 = 0;
            
            for (int64_t i_88743 = 0; i_88743 < m_34815; i_88743++) {
                double eta_p_58647 = ((double *) mem_89568.mem)[i_88743];
                bool zlze_res_58648 = eta_p_58647 <= zs_res_53000;
                bool defunc_0_op_res_53051 = zlze_res_58648 || redout_88742;
                bool redout_tmp_91313 = defunc_0_op_res_53051;
                
                redout_88742 = redout_tmp_91313;
            }
            x_91029 = redout_88742;
            defunc_0_reduce_res_78891 = x_91029;
        } else {
            defunc_0_reduce_res_78891 = 0;
        }
        
        bool cond_53042 = defunc_0_reduce_res_78891 || defunc_0_reduce_res_80251;
        int64_t ext_89674;
        
        if (cond_53042) {
            ext_89674 = (int64_t) 1;
        } else {
            ext_89674 = m_34815;
        }
        
        int64_t ext_89673;
        
        if (cond_53042) {
            ext_89673 = m_34815;
        } else {
            ext_89673 = (int64_t) 1;
        }
        if (cond_53042) {
            if (memblock_alloc(ctx, &mem_89634, bytes_89448, "mem_89634")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc(ctx, &mem_89636, bytes_89448, "mem_89636")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc(ctx, &mem_89639, bytes_89482, "mem_89639")) {
                err = 1;
                goto cleanup;
            }
            for (int64_t i_88754 = 0; i_88754 < m_34815; i_88754++) {
                double eta_p_78910 = ((double *) mem_89568.mem)[i_88754];
                double eta_p_78911 = ((double *) mem_89533.mem)[i_88754];
                bool zgze_res_78913 = exp_absorb_cutoff_34821 <= eta_p_78910;
                bool zl_res_78914 = eta_p_78910 < zs_res_53000;
                bool x_78915 = !zgze_res_78913;
                bool y_78916 = zl_res_78914 && x_78915;
                bool cond_78917 = zgze_res_78913 || y_78916;
                int64_t ext_89661;
                
                if (cond_78917) {
                    ext_89661 = (int64_t) 0;
                } else {
                    ext_89661 = i_88754;
                }
                
                int64_t ext_89660;
                
                if (cond_78917) {
                    ext_89660 = (int64_t) 1;
                } else {
                    ext_89660 = m_34815;
                }
                
                double rescale_res_78918;
                double rescale_res_78919;
                
                if (cond_78917) {
                    double log_res_78921 = futrts_log64(eta_p_78910);
                    double sqrt_res_78922 = futrts_sqrt64(eta_p_78910);
                    double zs_res_78923 = log_res_78921 / 2.0;
                    double zp_res_78924 = eta_p_78911 + zs_res_78923;
                    
                    if (memblock_alloc(ctx, &mem_89651, bytes_89448, "mem_89651")) {
                        err = 1;
                        goto cleanup;
                    }
                    for (int64_t i_88746 = 0; i_88746 < m_34815; i_88746++) {
                        double eta_p_78926 = ((double *) ext_mem_89626.mem)[i_88746 * m_34815 + i_88754];
                        double zt_res_78927 = sqrt_res_78922 * eta_p_78926;
                        
                        ((double *) mem_89651.mem)[i_88746] = zt_res_78927;
                    }
                    if (memblock_set(ctx, &ext_mem_89662, &mem_89651, "mem_89651") != 0)
                        return 1;
                    rescale_res_78918 = sqrt_res_78922;
                    rescale_res_78919 = zp_res_78924;
                } else {
                    if (memblock_set(ctx, &ext_mem_89662, &ext_mem_89626, "ext_mem_89626") != 0)
                        return 1;
                    rescale_res_78918 = eta_p_78910;
                    rescale_res_78919 = eta_p_78911;
                }
                ((double *) mem_89634.mem)[i_88754] = rescale_res_78918;
                ((double *) mem_89636.mem)[i_88754] = rescale_res_78919;
                lmad_copy_8b(ctx, 1, (uint64_t *) mem_89639.mem, i_88754 * m_34815, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_89662.mem, ext_89661, (int64_t []) {ext_89660}, (int64_t []) {m_34815});
                if (memblock_unref(ctx, &ext_mem_89662, "ext_mem_89662") != 0)
                    return 1;
            }
            if (memblock_set(ctx, &ext_mem_89682, &mem_89634, "mem_89634") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_89679, &mem_89636, "mem_89636") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_89676, &mem_89639, "mem_89639") != 0)
                return 1;
        } else {
            if (memblock_set(ctx, &ext_mem_89682, &mem_89568, "mem_89568") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_89679, &mem_89533, "mem_89533") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_89676, &ext_mem_89626, "ext_mem_89626") != 0)
                return 1;
        }
        if (memblock_unref(ctx, &ext_mem_89626, "ext_mem_89626") != 0)
            return 1;
        
        double defunc_0_reduce_res_80256;
        double redout_88758 = 0.0;
        
        for (int64_t i_88759 = 0; i_88759 < m_34815; i_88759++) {
            double eta_p_56370 = ((double *) mem_89541)[i_88759];
            double eta_p_56371 = ((double *) ext_mem_89632.mem)[i_88759];
            double zs_res_56372 = eta_p_56370 / eta_p_56371;
            double zm_res_56374 = zs_res_56372 - 1.0;
            double abs_res_56376 = fabs64(zm_res_56374);
            double max_res_53093 = fmax64(abs_res_56376, redout_88758);
            double redout_tmp_91318 = max_res_53093;
            
            redout_88758 = redout_tmp_91318;
        }
        defunc_0_reduce_res_80256 = redout_88758;
        
        bool zgze_res_53094 = tol_sinkhorn_34823 <= defunc_0_reduce_res_80256;
        int64_t ext_89825;
        int64_t ext_89824;
        int64_t ext_89823;
        bool algo3_core_loop_res_53095;
        bool loop_while_53101;
        int64_t ctx_param_ext_89683;
        int64_t ctx_param_ext_89684;
        int64_t ctx_param_ext_89685;
        
        if (memblock_set(ctx, &mem_param_89686, &ext_mem_89676, "ext_mem_89676") != 0)
            return 1;
        if (memblock_set(ctx, &mem_param_89689, &ext_mem_89632, "ext_mem_89632") != 0)
            return 1;
        if (memblock_set(ctx, &mem_param_89692, &ext_mem_89682, "ext_mem_89682") != 0)
            return 1;
        if (memblock_set(ctx, &mem_param_89695, &ext_mem_89629, "ext_mem_89629") != 0)
            return 1;
        if (memblock_set(ctx, &mem_param_89698, &ext_mem_89679, "ext_mem_89679") != 0)
            return 1;
        ctx_param_ext_89683 = (int64_t) 0;
        ctx_param_ext_89684 = ext_89674;
        ctx_param_ext_89685 = ext_89673;
        loop_while_53101 = zgze_res_53094;
        while (loop_while_53101) {
            if (memblock_alloc(ctx, &mem_89700, bytes_89448, "mem_89700")) {
                err = 1;
                goto cleanup;
            }
            
            bool defunc_0_reduce_res_79016;
            bool redout_88763 = 0;
            
            for (int64_t i_88765 = 0; i_88765 < m_34815; i_88765++) {
                double eta_p_58856 = ((double *) mem_param_89698.mem)[i_88765];
                double defunc_0_reduce_res_78933;
                double redout_88760 = 0.0;
                
                for (int64_t i_88761 = 0; i_88761 < m_34815; i_88761++) {
                    double eta_p_58880 = ((double *) mem_param_89689.mem)[i_88761];
                    double eta_p_58881 = ((double *) mem_param_89686.mem)[ctx_param_ext_89683 + (i_88761 * ctx_param_ext_89684 + i_88765 * ctx_param_ext_89685)];
                    double zt_res_58882 = eta_p_58880 * eta_p_58881;
                    double zp_res_58865 = zt_res_58882 + redout_88760;
                    double redout_tmp_91335 = zp_res_58865;
                    
                    redout_88760 = redout_tmp_91335;
                }
                defunc_0_reduce_res_78933 = redout_88760;
                
                double zs_res_58867 = defunc_0_reduce_res_78933 / replicate_arg1_52610;
                double ztzt_res_58869 = fpow64(zs_res_58867, zs_res_52623);
                double zt_res_58871 = zs_res_52624 * eta_p_58856;
                double exp_res_58873 = futrts_exp64(zt_res_58871);
                double zt_res_58875 = ztzt_res_58869 * exp_res_58873;
                bool zgze_res_58877 = exp_absorb_cutoff_34821 <= zt_res_58875;
                bool defunc_0_op_res_53214 = zgze_res_58877 || redout_88763;
                
                ((double *) mem_89700.mem)[i_88765] = zt_res_58875;
                
                bool redout_tmp_91333 = defunc_0_op_res_53214;
                
                redout_88763 = redout_tmp_91333;
            }
            defunc_0_reduce_res_79016 = redout_88763;
            if (memblock_alloc(ctx, &mem_89708, bytes_89448, "mem_89708")) {
                err = 1;
                goto cleanup;
            }
            
            bool defunc_0_reduce_res_79019;
            bool redout_88770 = 0;
            
            for (int64_t i_88772 = 0; i_88772 < m_34815; i_88772++) {
                double eta_p_58776 = ((double *) mem_param_89695.mem)[i_88772];
                double defunc_0_reduce_res_78934;
                double redout_88767 = 0.0;
                
                for (int64_t i_88768 = 0; i_88768 < m_34815; i_88768++) {
                    double eta_p_58886 = ((double *) mem_89700.mem)[i_88768];
                    double eta_p_58887 = ((double *) mem_param_89686.mem)[ctx_param_ext_89683 + (i_88772 * ctx_param_ext_89684 + i_88768 * ctx_param_ext_89685)];
                    double zt_res_58888 = eta_p_58886 * eta_p_58887;
                    double zp_res_58785 = zt_res_58888 + redout_88767;
                    double redout_tmp_91338 = zp_res_58785;
                    
                    redout_88767 = redout_tmp_91338;
                }
                defunc_0_reduce_res_78934 = redout_88767;
                
                double zs_res_58787 = defunc_0_reduce_res_78934 / replicate_arg1_52610;
                double ztzt_res_58789 = fpow64(zs_res_58787, zs_res_52619);
                double zt_res_58791 = zs_res_52620 * eta_p_58776;
                double exp_res_58793 = futrts_exp64(zt_res_58791);
                double zt_res_58795 = ztzt_res_58789 * exp_res_58793;
                bool zgze_res_58797 = exp_absorb_cutoff_34821 <= zt_res_58795;
                bool defunc_0_op_res_53171 = zgze_res_58797 || redout_88770;
                
                ((double *) mem_89708.mem)[i_88772] = zt_res_58795;
                
                bool redout_tmp_91336 = defunc_0_op_res_53171;
                
                redout_88770 = redout_tmp_91336;
            }
            defunc_0_reduce_res_79019 = redout_88770;
            
            bool x_91023 = !defunc_0_reduce_res_79019;
            bool defunc_0_reduce_res_78935;
            
            if (x_91023) {
                bool x_91025;
                bool redout_88774 = 0;
                
                for (int64_t i_88775 = 0; i_88775 < m_34815; i_88775++) {
                    double eta_p_58892 = ((double *) mem_89708.mem)[i_88775];
                    bool zlze_res_58893 = eta_p_58892 <= zs_res_53000;
                    bool defunc_0_op_res_53181 = zlze_res_58893 || redout_88774;
                    bool redout_tmp_91339 = defunc_0_op_res_53181;
                    
                    redout_88774 = redout_tmp_91339;
                }
                x_91025 = redout_88774;
                defunc_0_reduce_res_78935 = x_91025;
            } else {
                defunc_0_reduce_res_78935 = 0;
            }
            
            bool cond_53172 = defunc_0_reduce_res_78935 || defunc_0_reduce_res_79019;
            int64_t ext_89757;
            
            if (cond_53172) {
                ext_89757 = (int64_t) 0;
            } else {
                ext_89757 = ctx_param_ext_89683;
            }
            
            int64_t ext_89756;
            
            if (cond_53172) {
                ext_89756 = m_34815;
            } else {
                ext_89756 = ctx_param_ext_89684;
            }
            
            int64_t ext_89755;
            
            if (cond_53172) {
                ext_89755 = (int64_t) 1;
            } else {
                ext_89755 = ctx_param_ext_89685;
            }
            if (cond_53172) {
                if (memblock_alloc(ctx, &mem_89716, bytes_89448, "mem_89716")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_89718, bytes_89448, "mem_89718")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_89721, bytes_89482, "mem_89721")) {
                    err = 1;
                    goto cleanup;
                }
                for (int64_t i_88786 = 0; i_88786 < m_34815; i_88786++) {
                    double eta_p_78952 = ((double *) mem_89708.mem)[i_88786];
                    double eta_p_78953 = ((double *) mem_param_89695.mem)[i_88786];
                    bool zgze_res_78955 = exp_absorb_cutoff_34821 <= eta_p_78952;
                    bool zl_res_78956 = eta_p_78952 < zs_res_53000;
                    bool x_78957 = !zgze_res_78955;
                    bool y_78958 = zl_res_78956 && x_78957;
                    bool cond_78959 = zgze_res_78955 || y_78958;
                    int64_t binop_y_89740 = i_88786 * ctx_param_ext_89684;
                    int64_t lmad_ext_89741 = ctx_param_ext_89683 + binop_y_89740;
                    int64_t ext_89743;
                    
                    if (cond_78959) {
                        ext_89743 = (int64_t) 0;
                    } else {
                        ext_89743 = lmad_ext_89741;
                    }
                    
                    int64_t ext_89742;
                    
                    if (cond_78959) {
                        ext_89742 = (int64_t) 1;
                    } else {
                        ext_89742 = ctx_param_ext_89685;
                    }
                    
                    double rescale_res_78960;
                    double rescale_res_78961;
                    
                    if (cond_78959) {
                        double log_res_78963 = futrts_log64(eta_p_78952);
                        double sqrt_res_78964 = futrts_sqrt64(eta_p_78952);
                        double zs_res_78965 = log_res_78963 / 2.0;
                        double zp_res_78966 = eta_p_78953 + zs_res_78965;
                        
                        if (memblock_alloc(ctx, &mem_89733, bytes_89448, "mem_89733")) {
                            err = 1;
                            goto cleanup;
                        }
                        for (int64_t i_88778 = 0; i_88778 < m_34815; i_88778++) {
                            double eta_p_78968 = ((double *) mem_param_89686.mem)[ctx_param_ext_89683 + (i_88786 * ctx_param_ext_89684 + i_88778 * ctx_param_ext_89685)];
                            double zt_res_78969 = sqrt_res_78964 * eta_p_78968;
                            
                            ((double *) mem_89733.mem)[i_88778] = zt_res_78969;
                        }
                        if (memblock_set(ctx, &ext_mem_89744, &mem_89733, "mem_89733") != 0)
                            return 1;
                        rescale_res_78960 = sqrt_res_78964;
                        rescale_res_78961 = zp_res_78966;
                    } else {
                        if (memblock_set(ctx, &ext_mem_89744, &mem_param_89686, "mem_param_89686") != 0)
                            return 1;
                        rescale_res_78960 = eta_p_78952;
                        rescale_res_78961 = eta_p_78953;
                    }
                    ((double *) mem_89716.mem)[i_88786] = rescale_res_78960;
                    ((double *) mem_89718.mem)[i_88786] = rescale_res_78961;
                    lmad_copy_8b(ctx, 1, (uint64_t *) mem_89721.mem, i_88786 * m_34815, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_89744.mem, ext_89743, (int64_t []) {ext_89742}, (int64_t []) {m_34815});
                    if (memblock_unref(ctx, &ext_mem_89744, "ext_mem_89744") != 0)
                        return 1;
                }
                if (memblock_set(ctx, &ext_mem_89764, &mem_89716, "mem_89716") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89761, &mem_89718, "mem_89718") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89758, &mem_89721, "mem_89721") != 0)
                    return 1;
            } else {
                if (memblock_set(ctx, &ext_mem_89764, &mem_89708, "mem_89708") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89761, &mem_param_89695, "mem_param_89695") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89758, &mem_param_89686, "mem_param_89686") != 0)
                    return 1;
            }
            if (memblock_unref(ctx, &mem_89708, "mem_89708") != 0)
                return 1;
            
            bool x_91101 = !defunc_0_reduce_res_79016;
            bool defunc_0_reduce_res_78974;
            
            if (x_91101) {
                bool x_91103;
                bool redout_88790 = 0;
                
                for (int64_t i_88791 = 0; i_88791 < m_34815; i_88791++) {
                    double eta_p_58935 = ((double *) mem_89700.mem)[i_88791];
                    bool zlze_res_58936 = eta_p_58935 <= zs_res_53000;
                    bool defunc_0_op_res_53224 = zlze_res_58936 || redout_88790;
                    bool redout_tmp_91344 = defunc_0_op_res_53224;
                    
                    redout_88790 = redout_tmp_91344;
                }
                x_91103 = redout_88790;
                defunc_0_reduce_res_78974 = x_91103;
            } else {
                defunc_0_reduce_res_78974 = 0;
            }
            
            bool cond_53215 = defunc_0_reduce_res_78974 || defunc_0_reduce_res_79016;
            int64_t ext_89807;
            
            if (cond_53215) {
                ext_89807 = (int64_t) 0;
            } else {
                ext_89807 = ext_89757;
            }
            
            int64_t ext_89806;
            
            if (cond_53215) {
                ext_89806 = (int64_t) 1;
            } else {
                ext_89806 = ext_89756;
            }
            
            int64_t ext_89805;
            
            if (cond_53215) {
                ext_89805 = m_34815;
            } else {
                ext_89805 = ext_89755;
            }
            if (cond_53215) {
                if (memblock_alloc(ctx, &mem_89766, bytes_89448, "mem_89766")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_89768, bytes_89448, "mem_89768")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_89771, bytes_89482, "mem_89771")) {
                    err = 1;
                    goto cleanup;
                }
                for (int64_t i_88802 = 0; i_88802 < m_34815; i_88802++) {
                    double eta_p_78993 = ((double *) mem_89700.mem)[i_88802];
                    double eta_p_78994 = ((double *) mem_param_89698.mem)[i_88802];
                    bool zgze_res_78996 = exp_absorb_cutoff_34821 <= eta_p_78993;
                    bool zl_res_78997 = eta_p_78993 < zs_res_53000;
                    bool x_78998 = !zgze_res_78996;
                    bool y_78999 = zl_res_78997 && x_78998;
                    bool cond_79000 = zgze_res_78996 || y_78999;
                    int64_t binop_y_89790 = i_88802 * ext_89755;
                    int64_t lmad_ext_89791 = ext_89757 + binop_y_89790;
                    int64_t ext_89793;
                    
                    if (cond_79000) {
                        ext_89793 = (int64_t) 0;
                    } else {
                        ext_89793 = lmad_ext_89791;
                    }
                    
                    int64_t ext_89792;
                    
                    if (cond_79000) {
                        ext_89792 = (int64_t) 1;
                    } else {
                        ext_89792 = ext_89756;
                    }
                    
                    double rescale_res_79001;
                    double rescale_res_79002;
                    
                    if (cond_79000) {
                        double log_res_79004 = futrts_log64(eta_p_78993);
                        double sqrt_res_79005 = futrts_sqrt64(eta_p_78993);
                        double zs_res_79006 = log_res_79004 / 2.0;
                        double zp_res_79007 = eta_p_78994 + zs_res_79006;
                        
                        if (memblock_alloc(ctx, &mem_89783, bytes_89448, "mem_89783")) {
                            err = 1;
                            goto cleanup;
                        }
                        for (int64_t i_88794 = 0; i_88794 < m_34815; i_88794++) {
                            double eta_p_79009 = ((double *) ext_mem_89758.mem)[ext_89757 + (i_88794 * ext_89756 + i_88802 * ext_89755)];
                            double zt_res_79010 = sqrt_res_79005 * eta_p_79009;
                            
                            ((double *) mem_89783.mem)[i_88794] = zt_res_79010;
                        }
                        if (memblock_set(ctx, &ext_mem_89794, &mem_89783, "mem_89783") != 0)
                            return 1;
                        rescale_res_79001 = sqrt_res_79005;
                        rescale_res_79002 = zp_res_79007;
                    } else {
                        if (memblock_set(ctx, &ext_mem_89794, &ext_mem_89758, "ext_mem_89758") != 0)
                            return 1;
                        rescale_res_79001 = eta_p_78993;
                        rescale_res_79002 = eta_p_78994;
                    }
                    ((double *) mem_89766.mem)[i_88802] = rescale_res_79001;
                    ((double *) mem_89768.mem)[i_88802] = rescale_res_79002;
                    lmad_copy_8b(ctx, 1, (uint64_t *) mem_89771.mem, i_88802 * m_34815, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_89794.mem, ext_89793, (int64_t []) {ext_89792}, (int64_t []) {m_34815});
                    if (memblock_unref(ctx, &ext_mem_89794, "ext_mem_89794") != 0)
                        return 1;
                }
                if (memblock_set(ctx, &ext_mem_89814, &mem_89766, "mem_89766") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89811, &mem_89768, "mem_89768") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89808, &mem_89771, "mem_89771") != 0)
                    return 1;
            } else {
                if (memblock_set(ctx, &ext_mem_89814, &mem_89700, "mem_89700") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89811, &mem_param_89698, "mem_param_89698") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89808, &ext_mem_89758, "ext_mem_89758") != 0)
                    return 1;
            }
            if (memblock_unref(ctx, &mem_89700, "mem_89700") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_89758, "ext_mem_89758") != 0)
                return 1;
            
            double defunc_0_reduce_res_79021;
            double redout_88806 = 0.0;
            
            for (int64_t i_88807 = 0; i_88807 < m_34815; i_88807++) {
                double eta_p_58703 = ((double *) mem_param_89689.mem)[i_88807];
                double eta_p_58704 = ((double *) ext_mem_89764.mem)[i_88807];
                double zs_res_58705 = eta_p_58703 / eta_p_58704;
                double zm_res_58707 = zs_res_58705 - 1.0;
                double abs_res_58709 = fabs64(zm_res_58707);
                double max_res_53266 = fmax64(abs_res_58709, redout_88806);
                double redout_tmp_91349 = max_res_53266;
                
                redout_88806 = redout_tmp_91349;
            }
            defunc_0_reduce_res_79021 = redout_88806;
            
            bool zgze_res_53267 = tol_sinkhorn_34823 <= defunc_0_reduce_res_79021;
            
            if (memblock_set(ctx, &mem_param_tmp_91319, &ext_mem_89808, "ext_mem_89808") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_tmp_91320, &ext_mem_89764, "ext_mem_89764") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_tmp_91321, &ext_mem_89814, "ext_mem_89814") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_tmp_91322, &ext_mem_89761, "ext_mem_89761") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_tmp_91323, &ext_mem_89811, "ext_mem_89811") != 0)
                return 1;
            
            int64_t ctx_param_ext_tmp_91324 = ext_89807;
            int64_t ctx_param_ext_tmp_91325 = ext_89806;
            int64_t ctx_param_ext_tmp_91326 = ext_89805;
            bool loop_while_tmp_91327 = zgze_res_53267;
            
            if (memblock_set(ctx, &mem_param_89686, &mem_param_tmp_91319, "mem_param_tmp_91319") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_89689, &mem_param_tmp_91320, "mem_param_tmp_91320") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_89692, &mem_param_tmp_91321, "mem_param_tmp_91321") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_89695, &mem_param_tmp_91322, "mem_param_tmp_91322") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_89698, &mem_param_tmp_91323, "mem_param_tmp_91323") != 0)
                return 1;
            ctx_param_ext_89683 = ctx_param_ext_tmp_91324;
            ctx_param_ext_89684 = ctx_param_ext_tmp_91325;
            ctx_param_ext_89685 = ctx_param_ext_tmp_91326;
            loop_while_53101 = loop_while_tmp_91327;
        }
        if (memblock_set(ctx, &ext_mem_89830, &mem_param_89686, "mem_param_89686") != 0)
            return 1;
        if (memblock_set(ctx, &ext_mem_89829, &mem_param_89689, "mem_param_89689") != 0)
            return 1;
        if (memblock_set(ctx, &ext_mem_89828, &mem_param_89692, "mem_param_89692") != 0)
            return 1;
        if (memblock_set(ctx, &ext_mem_89827, &mem_param_89695, "mem_param_89695") != 0)
            return 1;
        if (memblock_set(ctx, &ext_mem_89826, &mem_param_89698, "mem_param_89698") != 0)
            return 1;
        ext_89825 = ctx_param_ext_89683;
        ext_89824 = ctx_param_ext_89684;
        ext_89823 = ctx_param_ext_89685;
        algo3_core_loop_res_53095 = loop_while_53101;
        if (memblock_unref(ctx, &ext_mem_89629, "ext_mem_89629") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89632, "ext_mem_89632") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89676, "ext_mem_89676") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89679, "ext_mem_89679") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89682, "ext_mem_89682") != 0)
            return 1;
        
        double defunc_res_80257;
        double redout_88814 = 0.0;
        
        for (int64_t i_88816 = 0; i_88816 < m_34815; i_88816++) {
            double eta_p_74511 = ((double *) ext_mem_89829.mem)[i_88816];
            double defunc_res_79022;
            double redout_88809 = 0.0;
            
            for (int64_t i_88811 = 0; i_88811 < m_34815; i_88811++) {
                double eta_p_74717 = ((double *) ext_mem_89830.mem)[ext_89825 + (i_88816 * ext_89824 + i_88811 * ext_89823)];
                double eta_p_wasfree_74718 = ((double *) ext_mem_89828.mem)[i_88811];
                double zt_res_74719 = eta_p_74511 * eta_p_74717;
                double zt_res_74720 = eta_p_wasfree_74718 * zt_res_74719;
                double zp_res_74522 = zt_res_74720 + redout_88809;
                
                ((double *) mem_89833)[i_88816 * m_34815 + i_88811] = zt_res_74720;
                
                double redout_tmp_91352 = zp_res_74522;
                
                redout_88809 = redout_tmp_91352;
            }
            defunc_res_79022 = redout_88809;
            
            double zp_res_53293 = defunc_res_79022 + redout_88814;
            double redout_tmp_91350 = zp_res_53293;
            
            redout_88814 = redout_tmp_91350;
        }
        defunc_res_80257 = redout_88814;
        if (memblock_unref(ctx, &ext_mem_89828, "ext_mem_89828") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89829, "ext_mem_89829") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89830, "ext_mem_89830") != 0)
            return 1;
        
        double zs_res_53294 = defunc_res_80232 / defunc_res_80257;
        double sqrt_res_53295 = futrts_sqrt64(zs_res_53294);
        double zt_res_53513 = zp_res_52616 * zt_res_52646;
        bool defunc_0_reduce_comm_res_80259;
        bool redout_88824 = 0;
        
        for (int64_t i_88826 = 0; i_88826 < m_34815; i_88826++) {
            bool defunc_0_reduce_comm_res_79024;
            bool redout_88819 = 0;
            
            for (int64_t i_88821 = 0; i_88821 < m_34815; i_88821++) {
                double eta_p_59092 = ((double *) mem_89833)[i_88826 * m_34815 + i_88821];
                double zt_res_59093 = sqrt_res_53295 * eta_p_59092;
                bool zgze_res_59095 = zt_res_59093 <= zt_res_53513;
                double zt_res_59096 = zp_res_52616 * zt_res_59093;
                bool zgze_res_59097 = zt_res_52646 <= zt_res_59096;
                bool x_59098 = zgze_res_59095 && zgze_res_59097;
                bool not_res_59099 = !x_59098;
                bool defunc_0_op_res_56334 = not_res_59099 || redout_88819;
                
                ((double *) mem_89852.mem)[i_88826 * m_34815 + i_88821] = zt_res_59093;
                
                bool redout_tmp_91356 = defunc_0_op_res_56334;
                
                redout_88819 = redout_tmp_91356;
            }
            defunc_0_reduce_comm_res_79024 = redout_88819;
            
            bool defunc_0_op_res_53528 = defunc_0_reduce_comm_res_79024 || redout_88824;
            bool redout_tmp_91354 = defunc_0_op_res_53528;
            
            redout_88824 = redout_tmp_91354;
        }
        defunc_0_reduce_comm_res_80259 = redout_88824;
        
        double zt_res_53406 = -2.0 * defunc_res_80243;
        double zp_res_53407 = zt_res_53406 + defunc_0_reduce_res_80242;
        double zp_res_53408 = zp_res_53407 + defunc_0_reduce_res_80240;
        double defunc_res_80261;
        double redout_88828 = 0.0;
        
        for (int64_t i_88829 = 0; i_88829 < m_34815; i_88829++) {
            double zp_res_53420 = defunc_res_80224 + redout_88828;
            double redout_tmp_91358 = zp_res_53420;
            
            redout_88828 = redout_tmp_91358;
        }
        defunc_res_80261 = redout_88828;
        
        double klu_res_53436;
        
        if (zeze_res_52812) {
            klu_res_53436 = 0.0;
        } else {
            klu_res_53436 = zt_res_52816;
        }
        
        double defunc_res_80263;
        double redout_88830 = 0.0;
        
        for (int64_t i_88831 = 0; i_88831 < m_34815; i_88831++) {
            double zp_res_53444 = klu_res_53436 + redout_88830;
            double redout_tmp_91359 = zp_res_53444;
            
            redout_88830 = redout_tmp_91359;
        }
        defunc_res_80263 = redout_88830;
        
        double defunc_res_80265;
        double redout_88832 = 0.0;
        
        for (int64_t i_88833 = 0; i_88833 < m_34815; i_88833++) {
            double zp_res_53449 = defunc_res_80263 + redout_88832;
            double redout_tmp_91360 = zp_res_53449;
            
            redout_88832 = redout_tmp_91360;
        }
        defunc_res_80265 = redout_88832;
        
        double zt_res_53450 = eps_34819 * defunc_res_80265;
        bool zeze_res_53454 = defunc_res_80224 == 0.0;
        double klu_res_53455;
        
        if (zeze_res_53454) {
            klu_res_53455 = 0.0;
        } else {
            double zs_res_53456 = defunc_res_80224 / replicate_arg1_52610;
            double log_res_53457 = futrts_log64(zs_res_53456);
            double zt_res_53458 = log_res_53457 * defunc_res_80224;
            
            klu_res_53455 = zt_res_53458;
        }
        
        double defunc_res_80267;
        double redout_88834 = 0.0;
        
        for (int64_t i_88835 = 0; i_88835 < m_34815; i_88835++) {
            double zp_res_53463 = klu_res_53455 + redout_88834;
            double redout_tmp_91361 = zp_res_53463;
            
            redout_88834 = redout_tmp_91361;
        }
        defunc_res_80267 = redout_88834;
        
        double zt_res_53464 = rho1_34817 * defunc_res_80267;
        double zt_res_53478 = rho2_34818 * defunc_res_80229;
        double zp_res_53479 = zt_res_53450 + zt_res_53464;
        double zp_res_53480 = zt_res_53478 + zp_res_53479;
        double zt_res_53481 = 2.0 * zp_res_53480;
        double zt_res_53482 = zt_res_53481 * defunc_res_80261;
        double zp_res_53483 = zp_res_53408 + zt_res_53482;
        double zt_res_53484 = defunc_res_80261 * defunc_res_80261;
        double zt_res_53485 = zp_res_52625 * zt_res_53484;
        double zm_res_53486 = zp_res_53483 - zt_res_53485;
        double defunc_res_80269;
        double defunc_res_80270;
        double defunc_res_80271;
        double defunc_res_80272;
        double redout_88836;
        double redout_88837;
        double redout_88838;
        double redout_88839;
        
        redout_88836 = 0.0;
        redout_88837 = 0.0;
        redout_88838 = 0.0;
        redout_88839 = 0.0;
        for (int64_t i_88840 = 0; i_88840 < m_34815; i_88840++) {
            double zp_res_53491 = replicate_arg1_52610 + redout_88836;
            double zp_res_53496 = replicate_arg1_52610 + redout_88837;
            double zp_res_55652 = replicate_arg1_52610 + redout_88838;
            double zp_res_55657 = replicate_arg1_52610 + redout_88839;
            double redout_tmp_91362 = zp_res_53491;
            double redout_tmp_91363 = zp_res_53496;
            double redout_tmp_91364 = zp_res_55652;
            double redout_tmp_91365 = zp_res_55657;
            
            redout_88836 = redout_tmp_91362;
            redout_88837 = redout_tmp_91363;
            redout_88838 = redout_tmp_91364;
            redout_88839 = redout_tmp_91365;
        }
        defunc_res_80269 = redout_88836;
        defunc_res_80270 = redout_88837;
        defunc_res_80271 = redout_88838;
        defunc_res_80272 = redout_88839;
        
        double zt_res_53497 = defunc_res_80269 * defunc_res_80270;
        double zt_res_53498 = rho1_34817 * defunc_res_80269;
        double zt_res_53499 = zt_res_53498 * defunc_res_80269;
        double zt_res_53500 = rho2_34818 * defunc_res_80270;
        double zt_res_53501 = zt_res_53500 * defunc_res_80270;
        double zp_res_53502 = zt_res_53499 + zt_res_53501;
        double zt_res_53503 = eps_34819 * zt_res_53497;
        double zt_res_53504 = zt_res_53497 * zt_res_53503;
        double zp_res_53505 = zp_res_53502 + zt_res_53504;
        double zp_res_53506 = zm_res_53486 + zp_res_53505;
        bool defunc_0_reduce_res_79028;
        
        if (defunc_0_reduce_comm_res_80259) {
            bool x_91017;
            bool redout_88843 = 0;
            
            for (int64_t i_88844 = 0; i_88844 < m_34815; i_88844++) {
                bool defunc_0_reduce_res_79030;
                bool redout_88841 = 0;
                
                for (int64_t i_88842 = 0; i_88842 < m_34815; i_88842++) {
                    double eta_p_79031 = ((double *) mem_89852.mem)[i_88844 * m_34815 + i_88842];
                    bool zg_res_79032 = 0.0 < eta_p_79031;
                    bool defunc_0_op_res_79035 = zg_res_79032 || redout_88841;
                    bool redout_tmp_91367 = defunc_0_op_res_79035;
                    
                    redout_88841 = redout_tmp_91367;
                }
                defunc_0_reduce_res_79030 = redout_88841;
                
                bool defunc_0_op_res_79039 = defunc_0_reduce_res_79030 || redout_88843;
                bool redout_tmp_91366 = defunc_0_op_res_79039;
                
                redout_88843 = redout_tmp_91366;
            }
            x_91017 = redout_88843;
            defunc_0_reduce_res_79028 = x_91017;
        } else {
            defunc_0_reduce_res_79028 = 0;
        }
        
        bool x_91084 = defunc_0_reduce_res_79028 && defunc_0_reduce_comm_res_80259;
        double defunc_res_79920;
        double defunc_res_79921;
        double redout_89233;
        double redout_89234;
        
        redout_89233 = 0.0;
        redout_89234 = 0.0;
        for (int64_t i_89235 = 0; i_89235 < m_34815; i_89235++) {
            double zp_res_79925 = replicate_arg1_52610 + redout_89233;
            double zp_res_79928 = replicate_arg1_52610 + redout_89234;
            double redout_tmp_91368 = zp_res_79925;
            double redout_tmp_91369 = zp_res_79928;
            
            redout_89233 = redout_tmp_91368;
            redout_89234 = redout_tmp_91369;
        }
        defunc_res_79920 = redout_89233;
        defunc_res_79921 = redout_89234;
        
        double zt_res_79931 = defunc_res_79920 * defunc_res_79921;
        double zt_res_79932 = rho1_34817 * defunc_res_79920;
        double zt_res_79933 = defunc_res_79920 * zt_res_79932;
        double zt_res_79934 = rho2_34818 * defunc_res_79921;
        double zt_res_79935 = defunc_res_79921 * zt_res_79934;
        double zp_res_79936 = zt_res_79933 + zt_res_79935;
        double zt_res_79937 = eps_34819 * zt_res_79931;
        double zt_res_79938 = zt_res_79931 * zt_res_79937;
        double zp_res_79939 = zp_res_79936 + zt_res_79938;
        double x_79947;
        double redout_89236 = 0.0;
        
        for (int64_t i_89237 = 0; i_89237 < m_34815; i_89237++) {
            double zp_res_79951 = replicate_arg1_52610 + redout_89236;
            double redout_tmp_91370 = zp_res_79951;
            
            redout_89236 = redout_tmp_91370;
        }
        x_79947 = redout_89236;
        
        double x_79954;
        double redout_89238 = 0.0;
        
        for (int64_t i_89239 = 0; i_89239 < m_34815; i_89239++) {
            double zp_res_79958 = replicate_arg1_52610 + redout_89238;
            double redout_tmp_91371 = zp_res_79958;
            
            redout_89238 = redout_tmp_91371;
        }
        x_79954 = redout_89238;
        
        double zt_res_79960 = x_79947 * x_79954;
        double zt_res_79961 = rho1_34817 * x_79947;
        double zt_res_79962 = x_79947 * zt_res_79961;
        double zt_res_79963 = rho2_34818 * x_79954;
        double zt_res_79964 = x_79954 * zt_res_79963;
        double zp_res_79965 = zt_res_79962 + zt_res_79964;
        double zt_res_79966 = eps_34819 * zt_res_79960;
        double zt_res_79967 = zt_res_79960 * zt_res_79966;
        double zp_res_79968 = zp_res_79965 + zt_res_79967;
        bool final_plan_53545;
        double final_plan_53549;
        bool loop_while_53550;
        double loss_53554;
        
        if (memblock_set(ctx, &mem_param_89871, &ext_mem_89827, "ext_mem_89827") != 0)
            return 1;
        if (memblock_set(ctx, &mem_param_89874, &ext_mem_89826, "ext_mem_89826") != 0)
            return 1;
        if (memblock_set(ctx, &mem_param_89878, &mem_89852, "mem_89852") != 0)
            return 1;
        loop_while_53550 = x_91084;
        loss_53554 = zp_res_53506;
        while (loop_while_53550) {
            double defunc_res_80174;
            double defunc_res_80175;
            double defunc_res_80176;
            double defunc_res_80177;
            double redout_88852;
            double redout_88853;
            double redout_88854;
            double redout_88855;
            
            redout_88852 = 0.0;
            redout_88853 = 0.0;
            redout_88854 = 0.0;
            redout_88855 = 0.0;
            for (int64_t i_88857 = 0; i_88857 < m_34815; i_88857++) {
                double defunc_res_79041;
                double defunc_res_79042;
                double defunc_res_79043;
                double defunc_res_79044;
                double defunc_res_79045;
                double redout_88845;
                double redout_88846;
                double redout_88847;
                double redout_88848;
                double redout_88849;
                
                redout_88845 = 0.0;
                redout_88846 = 0.0;
                redout_88847 = 0.0;
                redout_88848 = 0.0;
                redout_88849 = 0.0;
                for (int64_t i_88850 = 0; i_88850 < m_34815; i_88850++) {
                    double x_60381 = ((double *) mem_param_89878.mem)[i_88857 * m_34815 + i_88850];
                    bool zeze_res_60386 = x_60381 == 0.0;
                    double klu_res_60387;
                    
                    if (zeze_res_60386) {
                        klu_res_60387 = 0.0;
                    } else {
                        double zs_res_60388 = x_60381 / zt_res_52646;
                        double log_res_60389 = futrts_log64(zs_res_60388);
                        double zt_res_60390 = x_60381 * log_res_60389;
                        
                        klu_res_60387 = zt_res_60390;
                    }
                    
                    double zp_res_60286 = x_60381 + redout_88845;
                    double zp_res_60292 = x_60381 + redout_88846;
                    double zp_res_60298 = x_60381 + redout_88847;
                    double zp_res_60318 = klu_res_60387 + redout_88848;
                    double zp_res_60325 = x_60381 + redout_88849;
                    double redout_tmp_91385 = zp_res_60286;
                    double redout_tmp_91386 = zp_res_60292;
                    double redout_tmp_91387 = zp_res_60298;
                    double redout_tmp_91388 = zp_res_60318;
                    double redout_tmp_91389 = zp_res_60325;
                    
                    redout_88845 = redout_tmp_91385;
                    redout_88846 = redout_tmp_91386;
                    redout_88847 = redout_tmp_91387;
                    redout_88848 = redout_tmp_91388;
                    redout_88849 = redout_tmp_91389;
                }
                defunc_res_79041 = redout_88845;
                defunc_res_79042 = redout_88846;
                defunc_res_79043 = redout_88847;
                defunc_res_79044 = redout_88848;
                defunc_res_79045 = redout_88849;
                
                bool zeze_res_60300 = defunc_res_79043 == 0.0;
                double klu_res_60301;
                
                if (zeze_res_60300) {
                    klu_res_60301 = 0.0;
                } else {
                    double zs_res_60302 = defunc_res_79043 / replicate_arg1_52610;
                    double log_res_60303 = futrts_log64(zs_res_60302);
                    double zt_res_60304 = log_res_60303 * defunc_res_79043;
                    
                    klu_res_60301 = zt_res_60304;
                }
                
                double zp_res_53566 = defunc_res_79041 + redout_88852;
                double zp_res_53689 = klu_res_60301 + redout_88853;
                double zp_res_53733 = defunc_res_79044 + redout_88854;
                double zp_res_53767 = defunc_res_79045 + redout_88855;
                
                ((double *) mem_89880)[i_88857] = defunc_res_79042;
                
                double redout_tmp_91380 = zp_res_53566;
                double redout_tmp_91381 = zp_res_53689;
                double redout_tmp_91382 = zp_res_53733;
                double redout_tmp_91383 = zp_res_53767;
                
                redout_88852 = redout_tmp_91380;
                redout_88853 = redout_tmp_91381;
                redout_88854 = redout_tmp_91382;
                redout_88855 = redout_tmp_91383;
            }
            defunc_res_80174 = redout_88852;
            defunc_res_80175 = redout_88853;
            defunc_res_80176 = redout_88854;
            defunc_res_80177 = redout_88855;
            
            double zt_res_53570 = eps_34819 * defunc_res_80174;
            double zt_res_53573 = log_res_52661 * zt_res_53570;
            double defunc_res_80179;
            double redout_88863 = 0.0;
            
            for (int64_t i_88865 = 0; i_88865 < m_34815; i_88865++) {
                double defunc_res_79046;
                double defunc_res_79047;
                double redout_88859;
                double redout_88860;
                
                redout_88859 = 0.0;
                redout_88860 = 0.0;
                for (int64_t i_88861 = 0; i_88861 < m_34815; i_88861++) {
                    double x_60398 = ((double *) mem_param_89878.mem)[i_88861 * m_34815 + i_88865];
                    double zp_res_60334 = x_60398 + redout_88859;
                    double zp_res_60340 = x_60398 + redout_88860;
                    double redout_tmp_91392 = zp_res_60334;
                    double redout_tmp_91393 = zp_res_60340;
                    
                    redout_88859 = redout_tmp_91392;
                    redout_88860 = redout_tmp_91393;
                }
                defunc_res_79046 = redout_88859;
                defunc_res_79047 = redout_88860;
                
                bool zeze_res_60342 = defunc_res_79047 == 0.0;
                double klu_res_60343;
                
                if (zeze_res_60342) {
                    klu_res_60343 = 0.0;
                } else {
                    double zs_res_60344 = defunc_res_79047 / replicate_arg1_52610;
                    double log_res_60345 = futrts_log64(zs_res_60344);
                    double zt_res_60346 = log_res_60345 * defunc_res_79047;
                    
                    klu_res_60343 = zt_res_60346;
                }
                
                double zp_res_53710 = klu_res_60343 + redout_88863;
                
                ((double *) mem_89888)[i_88865] = defunc_res_79046;
                
                double redout_tmp_91390 = zp_res_53710;
                
                redout_88863 = redout_tmp_91390;
            }
            defunc_res_80179 = redout_88863;
            
            double zt_res_53711 = rho2_34818 * defunc_res_80179;
            double zt_res_53690 = rho1_34817 * defunc_res_80175;
            double zp_res_53735 = zt_res_53690 + zt_res_53711;
            double zt_res_53734 = eps_34819 * defunc_res_80176;
            double zp_res_53736 = zt_res_53734 + zp_res_53735;
            
            for (int64_t i_88871 = 0; i_88871 < m_34815; i_88871++) {
                double defunc_0_reduce_res_79048;
                double redout_88867 = 0.0;
                
                for (int64_t i_88868 = 0; i_88868 < m_34815; i_88868++) {
                    double eta_p_60643 = ((double *) mem_89415)[eta_p_52629 * lmad_arg_89421 + i_88871 * m_34815 + i_88868];
                    double eta_p_60644 = ((double *) mem_89888)[i_88868];
                    double zt_res_60646 = eta_p_60643 * eta_p_60643;
                    double zt_res_60648 = eta_p_60644 * zt_res_60646;
                    double zp_res_53624 = zt_res_60648 + redout_88867;
                    double redout_tmp_91395 = zp_res_53624;
                    
                    redout_88867 = redout_tmp_91395;
                }
                defunc_0_reduce_res_79048 = redout_88867;
                ((double *) mem_89896)[i_88871] = defunc_0_reduce_res_79048;
            }
            for (int64_t i_88896 = 0; i_88896 < m_34815; i_88896++) {
                double eta_p_60080 = ((double *) mem_param_89871.mem)[i_88896];
                double defunc_0_reduce_res_79051;
                double redout_88873 = 0.0;
                
                for (int64_t i_88874 = 0; i_88874 < m_34815; i_88874++) {
                    double eta_p_60611 = ((double *) mem_89415)[eta_p_52628 * lmad_arg_89421 + i_88896 * m_34815 + i_88874];
                    double eta_p_60612 = ((double *) mem_89880)[i_88874];
                    double zt_res_60614 = eta_p_60611 * eta_p_60611;
                    double zt_res_60616 = eta_p_60612 * zt_res_60614;
                    double zp_res_60096 = zt_res_60616 + redout_88873;
                    double redout_tmp_91398 = zp_res_60096;
                    
                    redout_88873 = redout_tmp_91398;
                }
                defunc_0_reduce_res_79051 = redout_88873;
                for (int64_t i_88879 = 0; i_88879 < m_34815; i_88879++) {
                    double defunc_0_reduce_res_79049;
                    double redout_88875 = 0.0;
                    
                    for (int64_t i_88876 = 0; i_88876 < m_34815; i_88876++) {
                        double eta_p_60619 = ((double *) mem_89415)[eta_p_52628 * lmad_arg_89421 + i_88896 * m_34815 + i_88876];
                        double eta_p_60620 = ((double *) mem_param_89878.mem)[i_88876 * m_34815 + i_88879];
                        double zt_res_60621 = eta_p_60619 * eta_p_60620;
                        double zp_res_60108 = zt_res_60621 + redout_88875;
                        double redout_tmp_91400 = zp_res_60108;
                        
                        redout_88875 = redout_tmp_91400;
                    }
                    defunc_0_reduce_res_79049 = redout_88875;
                    ((double *) mem_89916)[i_88879] = defunc_0_reduce_res_79049;
                }
                
                double defunc_0_reduce_res_79053;
                double redout_88884 = INFINITY;
                
                for (int64_t i_88886 = 0; i_88886 < m_34815; i_88886++) {
                    double eta_p_wasfree_60571 = ((double *) mem_89896)[i_88886];
                    double eta_p_wasfree_60572 = ((double *) mem_param_89874.mem)[i_88886];
                    double defunc_0_reduce_res_79050;
                    double redout_88881 = 0.0;
                    
                    for (int64_t i_88882 = 0; i_88882 < m_34815; i_88882++) {
                        double eta_p_60625 = ((double *) mem_89916)[i_88882];
                        double eta_p_60626 = ((double *) mem_89415)[eta_p_52629 * lmad_arg_89421 + i_88882 * m_34815 + i_88886];
                        double zt_res_60627 = eta_p_60625 * eta_p_60626;
                        double zp_res_60581 = zt_res_60627 + redout_88881;
                        double redout_tmp_91403 = zp_res_60581;
                        
                        redout_88881 = redout_tmp_91403;
                    }
                    defunc_0_reduce_res_79050 = redout_88881;
                    
                    double zt_res_60583 = -2.0 * defunc_0_reduce_res_79050;
                    double zp_res_60585 = zt_res_60583 + defunc_0_reduce_res_79051;
                    double zp_res_60587 = eta_p_wasfree_60571 + zp_res_60585;
                    double zp_res_60589 = zp_res_53736 + zp_res_60587;
                    double zm_res_60591 = zp_res_60589 - zt_res_53573;
                    double zm_res_60593 = zm_res_60591 - zt_res_53573;
                    double zs_res_60595 = zm_res_60593 / defunc_res_80177;
                    double zs_res_60597 = zs_res_60595 / neg_res_52615;
                    double zp_res_60599 = eta_p_60080 + zs_res_60597;
                    double zp_res_60601 = eta_p_wasfree_60572 + zp_res_60599;
                    double zm_res_60603 = 30.0 - zp_res_60601;
                    double min_res_60172 = fmin64(zm_res_60603, redout_88884);
                    
                    ((double *) mem_89924)[i_88886] = zp_res_60601;
                    
                    double redout_tmp_91401 = min_res_60172;
                    
                    redout_88884 = redout_tmp_91401;
                }
                defunc_0_reduce_res_79053 = redout_88884;
                for (int64_t i_88890 = 0; i_88890 < m_34815; i_88890++) {
                    double eta_p_60175 = ((double *) mem_89924)[i_88890];
                    double zp_res_60176 = eta_p_60175 + defunc_0_reduce_res_79053;
                    
                    ((double *) mem_89905)[i_88896 * m_34815 + i_88890] = zp_res_60176;
                }
                ((double *) mem_89907)[i_88896] = defunc_0_reduce_res_79053;
            }
            
            bool defunc_0_reduce_res_80184;
            bool redout_88909 = 0;
            
            for (int64_t i_88913 = 0; i_88913 < m_34815; i_88913++) {
                double eta_p_74790 = ((double *) mem_param_89874.mem)[i_88913];
                double defunc_0_reduce_res_79056;
                double redout_88899 = INFINITY;
                
                for (int64_t i_88900 = 0; i_88900 < m_34815; i_88900++) {
                    double eta_p_74793 = ((double *) mem_89905)[i_88900 * m_34815 + i_88913];
                    double zm_res_74794 = 30.0 - eta_p_74793;
                    double min_res_74797 = fmin64(zm_res_74794, redout_88899);
                    double redout_tmp_91409 = min_res_74797;
                    
                    redout_88899 = redout_tmp_91409;
                }
                defunc_0_reduce_res_79056 = redout_88899;
                
                double defunc_0_reduce_res_79057;
                double redout_88902 = 0.0;
                
                for (int64_t i_88904 = 0; i_88904 < m_34815; i_88904++) {
                    double eta_p_74833 = ((double *) mem_89905)[i_88904 * m_34815 + i_88913];
                    double zp_res_74834 = eta_p_74833 + defunc_0_reduce_res_79056;
                    double exp_res_74835 = futrts_exp64(zp_res_74834);
                    double zp_res_74810 = exp_res_74835 + redout_88902;
                    
                    ((double *) mem_89952.mem)[i_88913 * m_34815 + i_88904] = exp_res_74835;
                    
                    double redout_tmp_91410 = zp_res_74810;
                    
                    redout_88902 = redout_tmp_91410;
                }
                defunc_0_reduce_res_79057 = redout_88902;
                
                double zp_res_74805 = eta_p_74790 + defunc_0_reduce_res_79056;
                double zs_res_74811 = defunc_0_reduce_res_79057 / replicate_arg1_52610;
                double ztzt_res_74812 = fpow64(zs_res_74811, zs_res_52623);
                double zt_res_74813 = zs_res_52624 * zp_res_74805;
                double exp_res_74814 = futrts_exp64(zt_res_74813);
                double zt_res_74815 = ztzt_res_74812 * exp_res_74814;
                bool zgze_res_74816 = exp_absorb_cutoff_34821 <= zt_res_74815;
                bool defunc_0_op_res_53942 = zgze_res_74816 || redout_88909;
                
                ((double *) mem_89947.mem)[i_88913] = zt_res_74815;
                ((double *) mem_89949.mem)[i_88913] = zp_res_74805;
                
                bool redout_tmp_91405 = defunc_0_op_res_53942;
                
                redout_88909 = redout_tmp_91405;
            }
            defunc_0_reduce_res_80184 = redout_88909;
            
            bool defunc_0_reduce_res_80189;
            bool redout_88921 = 0;
            
            for (int64_t i_88924 = 0; i_88924 < m_34815; i_88924++) {
                double eta_p_59386 = ((double *) mem_param_89871.mem)[i_88924];
                double eta_p_59387 = ((double *) mem_89907)[i_88924];
                double zp_res_59389 = eta_p_59386 + eta_p_59387;
                double defunc_0_reduce_res_79059;
                double redout_88917 = 0.0;
                
                for (int64_t i_88918 = 0; i_88918 < m_34815; i_88918++) {
                    double eta_p_60663 = ((double *) mem_89947.mem)[i_88918];
                    double eta_p_60664 = ((double *) mem_89952.mem)[i_88918 * m_34815 + i_88924];
                    double zt_res_60665 = eta_p_60663 * eta_p_60664;
                    double zp_res_59399 = zt_res_60665 + redout_88917;
                    double redout_tmp_91415 = zp_res_59399;
                    
                    redout_88917 = redout_tmp_91415;
                }
                defunc_0_reduce_res_79059 = redout_88917;
                
                double zs_res_59401 = defunc_0_reduce_res_79059 / replicate_arg1_52610;
                double ztzt_res_59403 = fpow64(zs_res_59401, zs_res_52619);
                double zt_res_59405 = zs_res_52620 * zp_res_59389;
                double exp_res_59407 = futrts_exp64(zt_res_59405);
                double zt_res_59409 = ztzt_res_59403 * exp_res_59407;
                bool zgze_res_59411 = exp_absorb_cutoff_34821 <= zt_res_59409;
                bool defunc_0_op_res_53899 = zgze_res_59411 || redout_88921;
                
                ((double *) mem_89982.mem)[i_88924] = zt_res_59409;
                ((double *) mem_89984.mem)[i_88924] = zp_res_59389;
                
                bool redout_tmp_91412 = defunc_0_op_res_53899;
                
                redout_88921 = redout_tmp_91412;
            }
            defunc_0_reduce_res_80189 = redout_88921;
            
            bool x_90978 = !defunc_0_reduce_res_80189;
            bool defunc_0_reduce_res_79060;
            
            if (x_90978) {
                bool x_90980;
                bool redout_88927 = 0;
                
                for (int64_t i_88928 = 0; i_88928 < m_34815; i_88928++) {
                    double eta_p_60670 = ((double *) mem_89982.mem)[i_88928];
                    bool zlze_res_60671 = eta_p_60670 <= zs_res_53000;
                    bool defunc_0_op_res_53909 = zlze_res_60671 || redout_88927;
                    bool redout_tmp_91416 = defunc_0_op_res_53909;
                    
                    redout_88927 = redout_tmp_91416;
                }
                x_90980 = redout_88927;
                defunc_0_reduce_res_79060 = x_90980;
            } else {
                defunc_0_reduce_res_79060 = 0;
            }
            
            bool cond_53900 = defunc_0_reduce_res_79060 || defunc_0_reduce_res_80189;
            int64_t ext_90038;
            
            if (cond_53900) {
                ext_90038 = m_34815;
            } else {
                ext_90038 = (int64_t) 1;
            }
            
            int64_t ext_90037;
            
            if (cond_53900) {
                ext_90037 = (int64_t) 1;
            } else {
                ext_90037 = m_34815;
            }
            if (cond_53900) {
                if (memblock_alloc(ctx, &mem_89998, bytes_89448, "mem_89998")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_90000, bytes_89448, "mem_90000")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_90003, bytes_89482, "mem_90003")) {
                    err = 1;
                    goto cleanup;
                }
                for (int64_t i_88939 = 0; i_88939 < m_34815; i_88939++) {
                    double eta_p_79077 = ((double *) mem_89982.mem)[i_88939];
                    double eta_p_79078 = ((double *) mem_89984.mem)[i_88939];
                    bool zgze_res_79080 = exp_absorb_cutoff_34821 <= eta_p_79077;
                    bool zl_res_79081 = eta_p_79077 < zs_res_53000;
                    bool x_79082 = !zgze_res_79080;
                    bool y_79083 = zl_res_79081 && x_79082;
                    bool cond_79084 = zgze_res_79080 || y_79083;
                    int64_t ext_90025;
                    
                    if (cond_79084) {
                        ext_90025 = (int64_t) 0;
                    } else {
                        ext_90025 = i_88939;
                    }
                    
                    int64_t ext_90024;
                    
                    if (cond_79084) {
                        ext_90024 = (int64_t) 1;
                    } else {
                        ext_90024 = m_34815;
                    }
                    
                    double rescale_res_79085;
                    double rescale_res_79086;
                    
                    if (cond_79084) {
                        double log_res_79088 = futrts_log64(eta_p_79077);
                        double sqrt_res_79089 = futrts_sqrt64(eta_p_79077);
                        double zs_res_79090 = log_res_79088 / 2.0;
                        double zp_res_79091 = eta_p_79078 + zs_res_79090;
                        
                        if (memblock_alloc(ctx, &mem_90015, bytes_89448, "mem_90015")) {
                            err = 1;
                            goto cleanup;
                        }
                        for (int64_t i_88931 = 0; i_88931 < m_34815; i_88931++) {
                            double eta_p_79093 = ((double *) mem_89952.mem)[i_88931 * m_34815 + i_88939];
                            double zt_res_79094 = sqrt_res_79089 * eta_p_79093;
                            
                            ((double *) mem_90015.mem)[i_88931] = zt_res_79094;
                        }
                        if (memblock_set(ctx, &ext_mem_90026, &mem_90015, "mem_90015") != 0)
                            return 1;
                        rescale_res_79085 = sqrt_res_79089;
                        rescale_res_79086 = zp_res_79091;
                    } else {
                        if (memblock_set(ctx, &ext_mem_90026, &mem_89952, "mem_89952") != 0)
                            return 1;
                        rescale_res_79085 = eta_p_79077;
                        rescale_res_79086 = eta_p_79078;
                    }
                    ((double *) mem_89998.mem)[i_88939] = rescale_res_79085;
                    ((double *) mem_90000.mem)[i_88939] = rescale_res_79086;
                    lmad_copy_8b(ctx, 1, (uint64_t *) mem_90003.mem, i_88939 * m_34815, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90026.mem, ext_90025, (int64_t []) {ext_90024}, (int64_t []) {m_34815});
                    if (memblock_unref(ctx, &ext_mem_90026, "ext_mem_90026") != 0)
                        return 1;
                }
                if (memblock_set(ctx, &ext_mem_90046, &mem_89998, "mem_89998") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90043, &mem_90000, "mem_90000") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90040, &mem_90003, "mem_90003") != 0)
                    return 1;
            } else {
                if (memblock_set(ctx, &ext_mem_90046, &mem_89982, "mem_89982") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90043, &mem_89984, "mem_89984") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90040, &mem_89952, "mem_89952") != 0)
                    return 1;
            }
            
            bool x_90974 = !defunc_0_reduce_res_80184;
            bool defunc_0_reduce_res_79099;
            
            if (x_90974) {
                bool x_90976;
                bool redout_88943 = 0;
                
                for (int64_t i_88944 = 0; i_88944 < m_34815; i_88944++) {
                    double eta_p_60713 = ((double *) mem_89947.mem)[i_88944];
                    bool zlze_res_60714 = eta_p_60713 <= zs_res_53000;
                    bool defunc_0_op_res_53952 = zlze_res_60714 || redout_88943;
                    bool redout_tmp_91421 = defunc_0_op_res_53952;
                    
                    redout_88943 = redout_tmp_91421;
                }
                x_90976 = redout_88943;
                defunc_0_reduce_res_79099 = x_90976;
            } else {
                defunc_0_reduce_res_79099 = 0;
            }
            
            bool cond_53943 = defunc_0_reduce_res_79099 || defunc_0_reduce_res_80184;
            int64_t ext_90088;
            
            if (cond_53943) {
                ext_90088 = (int64_t) 1;
            } else {
                ext_90088 = ext_90038;
            }
            
            int64_t ext_90087;
            
            if (cond_53943) {
                ext_90087 = m_34815;
            } else {
                ext_90087 = ext_90037;
            }
            if (cond_53943) {
                if (memblock_alloc(ctx, &mem_90048, bytes_89448, "mem_90048")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_90050, bytes_89448, "mem_90050")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_90053, bytes_89482, "mem_90053")) {
                    err = 1;
                    goto cleanup;
                }
                for (int64_t i_88955 = 0; i_88955 < m_34815; i_88955++) {
                    double eta_p_79118 = ((double *) mem_89947.mem)[i_88955];
                    double eta_p_79119 = ((double *) mem_89949.mem)[i_88955];
                    bool zgze_res_79121 = exp_absorb_cutoff_34821 <= eta_p_79118;
                    bool zl_res_79122 = eta_p_79118 < zs_res_53000;
                    bool x_79123 = !zgze_res_79121;
                    bool y_79124 = zl_res_79122 && x_79123;
                    bool cond_79125 = zgze_res_79121 || y_79124;
                    int64_t binop_y_90072 = i_88955 * ext_90037;
                    int64_t ext_90075;
                    
                    if (cond_79125) {
                        ext_90075 = (int64_t) 0;
                    } else {
                        ext_90075 = binop_y_90072;
                    }
                    
                    int64_t ext_90074;
                    
                    if (cond_79125) {
                        ext_90074 = (int64_t) 1;
                    } else {
                        ext_90074 = ext_90038;
                    }
                    
                    double rescale_res_79126;
                    double rescale_res_79127;
                    
                    if (cond_79125) {
                        double log_res_79129 = futrts_log64(eta_p_79118);
                        double sqrt_res_79130 = futrts_sqrt64(eta_p_79118);
                        double zs_res_79131 = log_res_79129 / 2.0;
                        double zp_res_79132 = eta_p_79119 + zs_res_79131;
                        
                        if (memblock_alloc(ctx, &mem_90065, bytes_89448, "mem_90065")) {
                            err = 1;
                            goto cleanup;
                        }
                        for (int64_t i_88947 = 0; i_88947 < m_34815; i_88947++) {
                            double eta_p_79134 = ((double *) ext_mem_90040.mem)[i_88947 * ext_90038 + i_88955 * ext_90037];
                            double zt_res_79135 = sqrt_res_79130 * eta_p_79134;
                            
                            ((double *) mem_90065.mem)[i_88947] = zt_res_79135;
                        }
                        if (memblock_set(ctx, &ext_mem_90076, &mem_90065, "mem_90065") != 0)
                            return 1;
                        rescale_res_79126 = sqrt_res_79130;
                        rescale_res_79127 = zp_res_79132;
                    } else {
                        if (memblock_set(ctx, &ext_mem_90076, &ext_mem_90040, "ext_mem_90040") != 0)
                            return 1;
                        rescale_res_79126 = eta_p_79118;
                        rescale_res_79127 = eta_p_79119;
                    }
                    ((double *) mem_90048.mem)[i_88955] = rescale_res_79126;
                    ((double *) mem_90050.mem)[i_88955] = rescale_res_79127;
                    lmad_copy_8b(ctx, 1, (uint64_t *) mem_90053.mem, i_88955 * m_34815, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90076.mem, ext_90075, (int64_t []) {ext_90074}, (int64_t []) {m_34815});
                    if (memblock_unref(ctx, &ext_mem_90076, "ext_mem_90076") != 0)
                        return 1;
                }
                if (memblock_set(ctx, &ext_mem_90096, &mem_90048, "mem_90048") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90093, &mem_90050, "mem_90050") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90090, &mem_90053, "mem_90053") != 0)
                    return 1;
            } else {
                if (memblock_set(ctx, &ext_mem_90096, &mem_89947, "mem_89947") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90093, &mem_89949, "mem_89949") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90090, &ext_mem_90040, "ext_mem_90040") != 0)
                    return 1;
            }
            if (memblock_unref(ctx, &ext_mem_90040, "ext_mem_90040") != 0)
                return 1;
            
            bool defunc_0_reduce_res_80192;
            bool redout_88959 = 1;
            
            for (int64_t i_88960 = 0; i_88960 < m_34815; i_88960++) {
                double eta_p_59193 = ((double *) ext_mem_90046.mem)[i_88960];
                bool isnan_res_59194 = futrts_isnan64(eta_p_59193);
                bool not_res_59195 = !isnan_res_59194;
                bool x_53988 = not_res_59195 && redout_88959;
                bool redout_tmp_91426 = x_53988;
                
                redout_88959 = redout_tmp_91426;
            }
            defunc_0_reduce_res_80192 = redout_88959;
            
            bool defunc_0_reduce_comm_res_79143;
            
            if (defunc_0_reduce_res_80192) {
                bool x_90972;
                bool redout_88961 = 0;
                
                for (int64_t i_88962 = 0; i_88962 < m_34815; i_88962++) {
                    double eta_p_79144 = ((double *) ext_mem_90046.mem)[i_88962];
                    double zt_res_79145 = zp_res_79142 * eta_p_79144;
                    bool zgze_res_79146 = 1.0 <= zt_res_79145;
                    bool zgze_res_79147 = eta_p_79144 <= zp_res_79142;
                    bool x_79148 = zgze_res_79146 && zgze_res_79147;
                    bool not_res_79149 = !x_79148;
                    bool defunc_0_op_res_79152 = not_res_79149 || redout_88961;
                    bool redout_tmp_91427 = defunc_0_op_res_79152;
                    
                    redout_88961 = redout_tmp_91427;
                }
                x_90972 = redout_88961;
                defunc_0_reduce_comm_res_79143 = x_90972;
            } else {
                defunc_0_reduce_comm_res_79143 = 0;
            }
            
            bool x_91087 = defunc_0_reduce_comm_res_79143 && defunc_0_reduce_res_80192;
            int64_t ext_90261;
            int64_t ext_90260;
            int64_t ext_90259;
            int64_t ext_90252;
            int64_t ext_90251;
            int64_t ext_90250;
            bool algo5_core_loop_res_54003;
            bool loop_while_54013;
            int64_t ctx_param_ext_90097;
            int64_t ctx_param_ext_90098;
            int64_t ctx_param_ext_90099;
            int64_t ctx_param_ext_90110;
            int64_t ctx_param_ext_90111;
            int64_t ctx_param_ext_90112;
            
            if (memblock_set(ctx, &mem_param_90100, &mem_89952, "mem_89952") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_90103, &mem_89449, "mem_89449") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_90106, &mem_89984, "mem_89984") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_90109, &mem_89949, "mem_89949") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_90113, &ext_mem_90090, "ext_mem_90090") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_90116, &ext_mem_90046, "ext_mem_90046") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_90119, &ext_mem_90096, "ext_mem_90096") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_90122, &ext_mem_90043, "ext_mem_90043") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_90125, &ext_mem_90093, "ext_mem_90093") != 0)
                return 1;
            ctx_param_ext_90097 = (int64_t) 0;
            ctx_param_ext_90098 = (int64_t) 1;
            ctx_param_ext_90099 = m_34815;
            ctx_param_ext_90110 = (int64_t) 0;
            ctx_param_ext_90111 = ext_90088;
            ctx_param_ext_90112 = ext_90087;
            loop_while_54013 = x_91087;
            while (loop_while_54013) {
                if (memblock_alloc(ctx, &mem_90127, bytes_89448, "mem_90127")) {
                    err = 1;
                    goto cleanup;
                }
                
                bool defunc_0_reduce_res_79252;
                bool redout_88966 = 0;
                
                for (int64_t i_88968 = 0; i_88968 < m_34815; i_88968++) {
                    double eta_p_60929 = ((double *) mem_param_90125.mem)[i_88968];
                    double defunc_0_reduce_res_79154;
                    double redout_88963 = 0.0;
                    
                    for (int64_t i_88964 = 0; i_88964 < m_34815; i_88964++) {
                        double eta_p_60953 = ((double *) mem_param_90116.mem)[i_88964];
                        double eta_p_60954 = ((double *) mem_param_90113.mem)[ctx_param_ext_90110 + (i_88964 * ctx_param_ext_90111 + i_88968 * ctx_param_ext_90112)];
                        double zt_res_60955 = eta_p_60953 * eta_p_60954;
                        double zp_res_60938 = zt_res_60955 + redout_88963;
                        double redout_tmp_91455 = zp_res_60938;
                        
                        redout_88963 = redout_tmp_91455;
                    }
                    defunc_0_reduce_res_79154 = redout_88963;
                    
                    double zs_res_60940 = defunc_0_reduce_res_79154 / replicate_arg1_52610;
                    double ztzt_res_60942 = fpow64(zs_res_60940, zs_res_52623);
                    double zt_res_60944 = zs_res_52624 * eta_p_60929;
                    double exp_res_60946 = futrts_exp64(zt_res_60944);
                    double zt_res_60948 = ztzt_res_60942 * exp_res_60946;
                    bool zgze_res_60950 = exp_absorb_cutoff_34821 <= zt_res_60948;
                    bool defunc_0_op_res_54130 = zgze_res_60950 || redout_88966;
                    
                    ((double *) mem_90127.mem)[i_88968] = zt_res_60948;
                    
                    bool redout_tmp_91453 = defunc_0_op_res_54130;
                    
                    redout_88966 = redout_tmp_91453;
                }
                defunc_0_reduce_res_79252 = redout_88966;
                if (memblock_alloc(ctx, &mem_90135, bytes_89448, "mem_90135")) {
                    err = 1;
                    goto cleanup;
                }
                
                bool defunc_0_reduce_res_79255;
                bool redout_88973 = 0;
                
                for (int64_t i_88975 = 0; i_88975 < m_34815; i_88975++) {
                    double eta_p_60849 = ((double *) mem_param_90122.mem)[i_88975];
                    double defunc_0_reduce_res_79155;
                    double redout_88970 = 0.0;
                    
                    for (int64_t i_88971 = 0; i_88971 < m_34815; i_88971++) {
                        double eta_p_60959 = ((double *) mem_90127.mem)[i_88971];
                        double eta_p_60960 = ((double *) mem_param_90113.mem)[ctx_param_ext_90110 + (i_88975 * ctx_param_ext_90111 + i_88971 * ctx_param_ext_90112)];
                        double zt_res_60961 = eta_p_60959 * eta_p_60960;
                        double zp_res_60858 = zt_res_60961 + redout_88970;
                        double redout_tmp_91458 = zp_res_60858;
                        
                        redout_88970 = redout_tmp_91458;
                    }
                    defunc_0_reduce_res_79155 = redout_88970;
                    
                    double zs_res_60860 = defunc_0_reduce_res_79155 / replicate_arg1_52610;
                    double ztzt_res_60862 = fpow64(zs_res_60860, zs_res_52619);
                    double zt_res_60864 = zs_res_52620 * eta_p_60849;
                    double exp_res_60866 = futrts_exp64(zt_res_60864);
                    double zt_res_60868 = ztzt_res_60862 * exp_res_60866;
                    bool zgze_res_60870 = exp_absorb_cutoff_34821 <= zt_res_60868;
                    bool defunc_0_op_res_54087 = zgze_res_60870 || redout_88973;
                    
                    ((double *) mem_90135.mem)[i_88975] = zt_res_60868;
                    
                    bool redout_tmp_91456 = defunc_0_op_res_54087;
                    
                    redout_88973 = redout_tmp_91456;
                }
                defunc_0_reduce_res_79255 = redout_88973;
                
                bool x_90966 = !defunc_0_reduce_res_79255;
                bool defunc_0_reduce_res_79156;
                
                if (x_90966) {
                    bool x_90968;
                    bool redout_88977 = 0;
                    
                    for (int64_t i_88978 = 0; i_88978 < m_34815; i_88978++) {
                        double eta_p_60965 = ((double *) mem_90135.mem)[i_88978];
                        bool zlze_res_60966 = eta_p_60965 <= zs_res_53000;
                        bool defunc_0_op_res_54097 = zlze_res_60966 || redout_88977;
                        bool redout_tmp_91459 = defunc_0_op_res_54097;
                        
                        redout_88977 = redout_tmp_91459;
                    }
                    x_90968 = redout_88977;
                    defunc_0_reduce_res_79156 = x_90968;
                } else {
                    defunc_0_reduce_res_79156 = 0;
                }
                
                bool cond_54088 = defunc_0_reduce_res_79156 || defunc_0_reduce_res_79255;
                int64_t ext_90184;
                
                if (cond_54088) {
                    ext_90184 = (int64_t) 0;
                } else {
                    ext_90184 = ctx_param_ext_90110;
                }
                
                int64_t ext_90183;
                
                if (cond_54088) {
                    ext_90183 = m_34815;
                } else {
                    ext_90183 = ctx_param_ext_90111;
                }
                
                int64_t ext_90182;
                
                if (cond_54088) {
                    ext_90182 = (int64_t) 1;
                } else {
                    ext_90182 = ctx_param_ext_90112;
                }
                if (cond_54088) {
                    if (memblock_alloc(ctx, &mem_90143, bytes_89448, "mem_90143")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_90145, bytes_89448, "mem_90145")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_90148, bytes_89482, "mem_90148")) {
                        err = 1;
                        goto cleanup;
                    }
                    for (int64_t i_88989 = 0; i_88989 < m_34815; i_88989++) {
                        double eta_p_79173 = ((double *) mem_90135.mem)[i_88989];
                        double eta_p_79174 = ((double *) mem_param_90122.mem)[i_88989];
                        bool zgze_res_79176 = exp_absorb_cutoff_34821 <= eta_p_79173;
                        bool zl_res_79177 = eta_p_79173 < zs_res_53000;
                        bool x_79178 = !zgze_res_79176;
                        bool y_79179 = zl_res_79177 && x_79178;
                        bool cond_79180 = zgze_res_79176 || y_79179;
                        int64_t binop_y_90167 = i_88989 * ctx_param_ext_90111;
                        int64_t lmad_ext_90168 = ctx_param_ext_90110 + binop_y_90167;
                        int64_t ext_90170;
                        
                        if (cond_79180) {
                            ext_90170 = (int64_t) 0;
                        } else {
                            ext_90170 = lmad_ext_90168;
                        }
                        
                        int64_t ext_90169;
                        
                        if (cond_79180) {
                            ext_90169 = (int64_t) 1;
                        } else {
                            ext_90169 = ctx_param_ext_90112;
                        }
                        
                        double rescale_res_79181;
                        double rescale_res_79182;
                        
                        if (cond_79180) {
                            double log_res_79184 = futrts_log64(eta_p_79173);
                            double sqrt_res_79185 = futrts_sqrt64(eta_p_79173);
                            double zs_res_79186 = log_res_79184 / 2.0;
                            double zp_res_79187 = eta_p_79174 + zs_res_79186;
                            
                            if (memblock_alloc(ctx, &mem_90160, bytes_89448, "mem_90160")) {
                                err = 1;
                                goto cleanup;
                            }
                            for (int64_t i_88981 = 0; i_88981 < m_34815; i_88981++) {
                                double eta_p_79189 = ((double *) mem_param_90113.mem)[ctx_param_ext_90110 + (i_88989 * ctx_param_ext_90111 + i_88981 * ctx_param_ext_90112)];
                                double zt_res_79190 = sqrt_res_79185 * eta_p_79189;
                                
                                ((double *) mem_90160.mem)[i_88981] = zt_res_79190;
                            }
                            if (memblock_set(ctx, &ext_mem_90171, &mem_90160, "mem_90160") != 0)
                                return 1;
                            rescale_res_79181 = sqrt_res_79185;
                            rescale_res_79182 = zp_res_79187;
                        } else {
                            if (memblock_set(ctx, &ext_mem_90171, &mem_param_90113, "mem_param_90113") != 0)
                                return 1;
                            rescale_res_79181 = eta_p_79173;
                            rescale_res_79182 = eta_p_79174;
                        }
                        ((double *) mem_90143.mem)[i_88989] = rescale_res_79181;
                        ((double *) mem_90145.mem)[i_88989] = rescale_res_79182;
                        lmad_copy_8b(ctx, 1, (uint64_t *) mem_90148.mem, i_88989 * m_34815, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90171.mem, ext_90170, (int64_t []) {ext_90169}, (int64_t []) {m_34815});
                        if (memblock_unref(ctx, &ext_mem_90171, "ext_mem_90171") != 0)
                            return 1;
                    }
                    if (memblock_set(ctx, &ext_mem_90191, &mem_90143, "mem_90143") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90188, &mem_90145, "mem_90145") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90185, &mem_90148, "mem_90148") != 0)
                        return 1;
                } else {
                    if (memblock_set(ctx, &ext_mem_90191, &mem_90135, "mem_90135") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90188, &mem_param_90122, "mem_param_90122") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90185, &mem_param_90113, "mem_param_90113") != 0)
                        return 1;
                }
                if (memblock_unref(ctx, &mem_90135, "mem_90135") != 0)
                    return 1;
                
                bool x_91097 = !defunc_0_reduce_res_79252;
                bool defunc_0_reduce_res_79195;
                
                if (x_91097) {
                    bool x_91099;
                    bool redout_88993 = 0;
                    
                    for (int64_t i_88994 = 0; i_88994 < m_34815; i_88994++) {
                        double eta_p_61008 = ((double *) mem_90127.mem)[i_88994];
                        bool zlze_res_61009 = eta_p_61008 <= zs_res_53000;
                        bool defunc_0_op_res_54140 = zlze_res_61009 || redout_88993;
                        bool redout_tmp_91464 = defunc_0_op_res_54140;
                        
                        redout_88993 = redout_tmp_91464;
                    }
                    x_91099 = redout_88993;
                    defunc_0_reduce_res_79195 = x_91099;
                } else {
                    defunc_0_reduce_res_79195 = 0;
                }
                
                bool cond_54131 = defunc_0_reduce_res_79195 || defunc_0_reduce_res_79252;
                int64_t ext_90234;
                
                if (cond_54131) {
                    ext_90234 = (int64_t) 0;
                } else {
                    ext_90234 = ext_90184;
                }
                
                int64_t ext_90233;
                
                if (cond_54131) {
                    ext_90233 = (int64_t) 1;
                } else {
                    ext_90233 = ext_90183;
                }
                
                int64_t ext_90232;
                
                if (cond_54131) {
                    ext_90232 = m_34815;
                } else {
                    ext_90232 = ext_90182;
                }
                if (cond_54131) {
                    if (memblock_alloc(ctx, &mem_90193, bytes_89448, "mem_90193")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_90195, bytes_89448, "mem_90195")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_90198, bytes_89482, "mem_90198")) {
                        err = 1;
                        goto cleanup;
                    }
                    for (int64_t i_89005 = 0; i_89005 < m_34815; i_89005++) {
                        double eta_p_79214 = ((double *) mem_90127.mem)[i_89005];
                        double eta_p_79215 = ((double *) mem_param_90125.mem)[i_89005];
                        bool zgze_res_79217 = exp_absorb_cutoff_34821 <= eta_p_79214;
                        bool zl_res_79218 = eta_p_79214 < zs_res_53000;
                        bool x_79219 = !zgze_res_79217;
                        bool y_79220 = zl_res_79218 && x_79219;
                        bool cond_79221 = zgze_res_79217 || y_79220;
                        int64_t binop_y_90217 = i_89005 * ext_90182;
                        int64_t lmad_ext_90218 = ext_90184 + binop_y_90217;
                        int64_t ext_90220;
                        
                        if (cond_79221) {
                            ext_90220 = (int64_t) 0;
                        } else {
                            ext_90220 = lmad_ext_90218;
                        }
                        
                        int64_t ext_90219;
                        
                        if (cond_79221) {
                            ext_90219 = (int64_t) 1;
                        } else {
                            ext_90219 = ext_90183;
                        }
                        
                        double rescale_res_79222;
                        double rescale_res_79223;
                        
                        if (cond_79221) {
                            double log_res_79225 = futrts_log64(eta_p_79214);
                            double sqrt_res_79226 = futrts_sqrt64(eta_p_79214);
                            double zs_res_79227 = log_res_79225 / 2.0;
                            double zp_res_79228 = eta_p_79215 + zs_res_79227;
                            
                            if (memblock_alloc(ctx, &mem_90210, bytes_89448, "mem_90210")) {
                                err = 1;
                                goto cleanup;
                            }
                            for (int64_t i_88997 = 0; i_88997 < m_34815; i_88997++) {
                                double eta_p_79230 = ((double *) ext_mem_90185.mem)[ext_90184 + (i_88997 * ext_90183 + i_89005 * ext_90182)];
                                double zt_res_79231 = sqrt_res_79226 * eta_p_79230;
                                
                                ((double *) mem_90210.mem)[i_88997] = zt_res_79231;
                            }
                            if (memblock_set(ctx, &ext_mem_90221, &mem_90210, "mem_90210") != 0)
                                return 1;
                            rescale_res_79222 = sqrt_res_79226;
                            rescale_res_79223 = zp_res_79228;
                        } else {
                            if (memblock_set(ctx, &ext_mem_90221, &ext_mem_90185, "ext_mem_90185") != 0)
                                return 1;
                            rescale_res_79222 = eta_p_79214;
                            rescale_res_79223 = eta_p_79215;
                        }
                        ((double *) mem_90193.mem)[i_89005] = rescale_res_79222;
                        ((double *) mem_90195.mem)[i_89005] = rescale_res_79223;
                        lmad_copy_8b(ctx, 1, (uint64_t *) mem_90198.mem, i_89005 * m_34815, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90221.mem, ext_90220, (int64_t []) {ext_90219}, (int64_t []) {m_34815});
                        if (memblock_unref(ctx, &ext_mem_90221, "ext_mem_90221") != 0)
                            return 1;
                    }
                    if (memblock_set(ctx, &ext_mem_90241, &mem_90193, "mem_90193") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90238, &mem_90195, "mem_90195") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90235, &mem_90198, "mem_90198") != 0)
                        return 1;
                } else {
                    if (memblock_set(ctx, &ext_mem_90241, &mem_90127, "mem_90127") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90238, &mem_param_90125, "mem_param_90125") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90235, &ext_mem_90185, "ext_mem_90185") != 0)
                        return 1;
                }
                if (memblock_unref(ctx, &mem_90127, "mem_90127") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90185, "ext_mem_90185") != 0)
                    return 1;
                
                bool defunc_0_reduce_res_79257;
                bool redout_89009 = 1;
                
                for (int64_t i_89010 = 0; i_89010 < m_34815; i_89010++) {
                    double eta_p_60780 = ((double *) ext_mem_90191.mem)[i_89010];
                    bool isnan_res_60781 = futrts_isnan64(eta_p_60780);
                    bool not_res_60782 = !isnan_res_60781;
                    bool x_54176 = not_res_60782 && redout_89009;
                    bool redout_tmp_91469 = x_54176;
                    
                    redout_89009 = redout_tmp_91469;
                }
                defunc_0_reduce_res_79257 = redout_89009;
                
                bool loop_cond_54177;
                
                if (defunc_0_reduce_res_79257) {
                    bool defunc_0_reduce_comm_res_79239;
                    bool redout_89011 = 0;
                    
                    for (int64_t i_89012 = 0; i_89012 < m_34815; i_89012++) {
                        double eta_p_79240 = ((double *) ext_mem_90191.mem)[i_89012];
                        double eta_p_79241 = ((double *) mem_param_90116.mem)[i_89012];
                        double zt_res_79242 = zp_res_79142 * eta_p_79240;
                        bool zgze_res_79243 = eta_p_79241 <= zt_res_79242;
                        double zt_res_79244 = zp_res_79142 * eta_p_79241;
                        bool zgze_res_79245 = eta_p_79240 <= zt_res_79244;
                        bool x_79246 = zgze_res_79243 && zgze_res_79245;
                        bool not_res_79247 = !x_79246;
                        bool defunc_0_op_res_79250 = not_res_79247 || redout_89011;
                        bool redout_tmp_91470 = defunc_0_op_res_79250;
                        
                        redout_89011 = redout_tmp_91470;
                    }
                    defunc_0_reduce_comm_res_79239 = redout_89011;
                    loop_cond_54177 = defunc_0_reduce_comm_res_79239;
                } else {
                    loop_cond_54177 = 0;
                }
                if (memblock_set(ctx, &mem_param_tmp_91428, &mem_param_90113, "mem_param_90113") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91429, &mem_param_90116, "mem_param_90116") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91430, &mem_param_90122, "mem_param_90122") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91431, &mem_param_90125, "mem_param_90125") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91432, &ext_mem_90235, "ext_mem_90235") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91433, &ext_mem_90191, "ext_mem_90191") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91434, &ext_mem_90241, "ext_mem_90241") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91435, &ext_mem_90188, "ext_mem_90188") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91436, &ext_mem_90238, "ext_mem_90238") != 0)
                    return 1;
                
                int64_t ctx_param_ext_tmp_91437 = ctx_param_ext_90110;
                int64_t ctx_param_ext_tmp_91438 = ctx_param_ext_90111;
                int64_t ctx_param_ext_tmp_91439 = ctx_param_ext_90112;
                int64_t ctx_param_ext_tmp_91440 = ext_90234;
                int64_t ctx_param_ext_tmp_91441 = ext_90233;
                int64_t ctx_param_ext_tmp_91442 = ext_90232;
                bool loop_while_tmp_91443 = loop_cond_54177;
                
                if (memblock_set(ctx, &mem_param_90100, &mem_param_tmp_91428, "mem_param_tmp_91428") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90103, &mem_param_tmp_91429, "mem_param_tmp_91429") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90106, &mem_param_tmp_91430, "mem_param_tmp_91430") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90109, &mem_param_tmp_91431, "mem_param_tmp_91431") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90113, &mem_param_tmp_91432, "mem_param_tmp_91432") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90116, &mem_param_tmp_91433, "mem_param_tmp_91433") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90119, &mem_param_tmp_91434, "mem_param_tmp_91434") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90122, &mem_param_tmp_91435, "mem_param_tmp_91435") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90125, &mem_param_tmp_91436, "mem_param_tmp_91436") != 0)
                    return 1;
                ctx_param_ext_90097 = ctx_param_ext_tmp_91437;
                ctx_param_ext_90098 = ctx_param_ext_tmp_91438;
                ctx_param_ext_90099 = ctx_param_ext_tmp_91439;
                ctx_param_ext_90110 = ctx_param_ext_tmp_91440;
                ctx_param_ext_90111 = ctx_param_ext_tmp_91441;
                ctx_param_ext_90112 = ctx_param_ext_tmp_91442;
                loop_while_54013 = loop_while_tmp_91443;
            }
            if (memblock_set(ctx, &ext_mem_90270, &mem_param_90100, "mem_param_90100") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_90269, &mem_param_90103, "mem_param_90103") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_90268, &mem_param_90106, "mem_param_90106") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_90267, &mem_param_90109, "mem_param_90109") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_90266, &mem_param_90113, "mem_param_90113") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_90265, &mem_param_90116, "mem_param_90116") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_90264, &mem_param_90119, "mem_param_90119") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_90263, &mem_param_90122, "mem_param_90122") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_90262, &mem_param_90125, "mem_param_90125") != 0)
                return 1;
            ext_90261 = ctx_param_ext_90097;
            ext_90260 = ctx_param_ext_90098;
            ext_90259 = ctx_param_ext_90099;
            ext_90252 = ctx_param_ext_90110;
            ext_90251 = ctx_param_ext_90111;
            ext_90250 = ctx_param_ext_90112;
            algo5_core_loop_res_54003 = loop_while_54013;
            if (memblock_unref(ctx, &ext_mem_90043, "ext_mem_90043") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90046, "ext_mem_90046") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90090, "ext_mem_90090") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90093, "ext_mem_90093") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90096, "ext_mem_90096") != 0)
                return 1;
            
            bool defunc_0_reduce_res_80193;
            bool redout_89013 = 1;
            
            for (int64_t i_89014 = 0; i_89014 < m_34815; i_89014++) {
                double eta_p_59188 = ((double *) ext_mem_90265.mem)[i_89014];
                bool isnan_res_59189 = futrts_isnan64(eta_p_59188);
                bool not_res_59190 = !isnan_res_59189;
                bool x_54201 = not_res_59190 && redout_89013;
                bool redout_tmp_91471 = x_54201;
                
                redout_89013 = redout_tmp_91471;
            }
            defunc_0_reduce_res_80193 = redout_89013;
            
            int64_t ext_90549;
            int64_t ext_90548;
            int64_t ext_90547;
            
            if (defunc_0_reduce_res_80193) {
                if (memblock_set(ctx, &ext_mem_90550, &ext_mem_90266, "ext_mem_90266") != 0)
                    return 1;
                ext_90549 = ext_90252;
                ext_90548 = ext_90251;
                ext_90547 = ext_90250;
                if (memblock_set(ctx, &ext_mem_90546, &ext_mem_90265, "ext_mem_90265") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90543, &ext_mem_90264, "ext_mem_90264") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90540, &ext_mem_90263, "ext_mem_90263") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90537, &ext_mem_90262, "ext_mem_90262") != 0)
                    return 1;
            } else {
                if (memblock_alloc(ctx, &mem_90272, bytes_89448, "mem_90272")) {
                    err = 1;
                    goto cleanup;
                }
                
                bool defunc_0_reduce_res_79461;
                bool redout_89018 = 0;
                
                for (int64_t i_89020 = 0; i_89020 < m_34815; i_89020++) {
                    double eta_p_61340 = ((double *) ext_mem_90267.mem)[i_89020];
                    double defunc_0_reduce_res_79259;
                    double redout_89015 = 0.0;
                    
                    for (int64_t i_89016 = 0; i_89016 < m_34815; i_89016++) {
                        double eta_p_61364 = ((double *) ext_mem_90269.mem)[i_89016];
                        double eta_p_61365 = ((double *) ext_mem_90270.mem)[ext_90261 + (i_89016 * ext_90260 + i_89020 * ext_90259)];
                        double zt_res_61366 = eta_p_61364 * eta_p_61365;
                        double zp_res_61349 = zt_res_61366 + redout_89015;
                        double redout_tmp_91474 = zp_res_61349;
                        
                        redout_89015 = redout_tmp_91474;
                    }
                    defunc_0_reduce_res_79259 = redout_89015;
                    
                    double zs_res_61351 = defunc_0_reduce_res_79259 / replicate_arg1_52610;
                    double ztzt_res_61353 = fpow64(zs_res_61351, zs_res_52623);
                    double zt_res_61355 = zs_res_52624 * eta_p_61340;
                    double exp_res_61357 = futrts_exp64(zt_res_61355);
                    double zt_res_61359 = ztzt_res_61353 * exp_res_61357;
                    bool zgze_res_61361 = exp_absorb_cutoff_34821 <= zt_res_61359;
                    bool defunc_0_op_res_54323 = zgze_res_61361 || redout_89018;
                    
                    ((double *) mem_90272.mem)[i_89020] = zt_res_61359;
                    
                    bool redout_tmp_91472 = defunc_0_op_res_54323;
                    
                    redout_89018 = redout_tmp_91472;
                }
                defunc_0_reduce_res_79461 = redout_89018;
                if (memblock_alloc(ctx, &mem_90280, bytes_89448, "mem_90280")) {
                    err = 1;
                    goto cleanup;
                }
                
                bool defunc_0_reduce_res_79464;
                bool redout_89025 = 0;
                
                for (int64_t i_89027 = 0; i_89027 < m_34815; i_89027++) {
                    double eta_p_61260 = ((double *) ext_mem_90268.mem)[i_89027];
                    double defunc_0_reduce_res_79260;
                    double redout_89022 = 0.0;
                    
                    for (int64_t i_89023 = 0; i_89023 < m_34815; i_89023++) {
                        double eta_p_61370 = ((double *) mem_90272.mem)[i_89023];
                        double eta_p_61371 = ((double *) ext_mem_90270.mem)[ext_90261 + (i_89027 * ext_90260 + i_89023 * ext_90259)];
                        double zt_res_61372 = eta_p_61370 * eta_p_61371;
                        double zp_res_61269 = zt_res_61372 + redout_89022;
                        double redout_tmp_91477 = zp_res_61269;
                        
                        redout_89022 = redout_tmp_91477;
                    }
                    defunc_0_reduce_res_79260 = redout_89022;
                    
                    double zs_res_61271 = defunc_0_reduce_res_79260 / replicate_arg1_52610;
                    double ztzt_res_61273 = fpow64(zs_res_61271, zs_res_52619);
                    double zt_res_61275 = zs_res_52620 * eta_p_61260;
                    double exp_res_61277 = futrts_exp64(zt_res_61275);
                    double zt_res_61279 = ztzt_res_61273 * exp_res_61277;
                    bool zgze_res_61281 = exp_absorb_cutoff_34821 <= zt_res_61279;
                    bool defunc_0_op_res_54280 = zgze_res_61281 || redout_89025;
                    
                    ((double *) mem_90280.mem)[i_89027] = zt_res_61279;
                    
                    bool redout_tmp_91475 = defunc_0_op_res_54280;
                    
                    redout_89025 = redout_tmp_91475;
                }
                defunc_0_reduce_res_79464 = redout_89025;
                
                bool x_90962 = !defunc_0_reduce_res_79464;
                bool defunc_0_reduce_res_79261;
                
                if (x_90962) {
                    bool x_90964;
                    bool redout_89029 = 0;
                    
                    for (int64_t i_89030 = 0; i_89030 < m_34815; i_89030++) {
                        double eta_p_61376 = ((double *) mem_90280.mem)[i_89030];
                        bool zlze_res_61377 = eta_p_61376 <= zs_res_53000;
                        bool defunc_0_op_res_54290 = zlze_res_61377 || redout_89029;
                        bool redout_tmp_91478 = defunc_0_op_res_54290;
                        
                        redout_89029 = redout_tmp_91478;
                    }
                    x_90964 = redout_89029;
                    defunc_0_reduce_res_79261 = x_90964;
                } else {
                    defunc_0_reduce_res_79261 = 0;
                }
                
                bool cond_54281 = defunc_0_reduce_res_79261 || defunc_0_reduce_res_79464;
                int64_t ext_90329;
                
                if (cond_54281) {
                    ext_90329 = (int64_t) 0;
                } else {
                    ext_90329 = ext_90261;
                }
                
                int64_t ext_90328;
                
                if (cond_54281) {
                    ext_90328 = m_34815;
                } else {
                    ext_90328 = ext_90260;
                }
                
                int64_t ext_90327;
                
                if (cond_54281) {
                    ext_90327 = (int64_t) 1;
                } else {
                    ext_90327 = ext_90259;
                }
                if (cond_54281) {
                    if (memblock_alloc(ctx, &mem_90288, bytes_89448, "mem_90288")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_90290, bytes_89448, "mem_90290")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_90293, bytes_89482, "mem_90293")) {
                        err = 1;
                        goto cleanup;
                    }
                    for (int64_t i_89041 = 0; i_89041 < m_34815; i_89041++) {
                        double eta_p_79278 = ((double *) mem_90280.mem)[i_89041];
                        double eta_p_79279 = ((double *) ext_mem_90268.mem)[i_89041];
                        bool zgze_res_79281 = exp_absorb_cutoff_34821 <= eta_p_79278;
                        bool zl_res_79282 = eta_p_79278 < zs_res_53000;
                        bool x_79283 = !zgze_res_79281;
                        bool y_79284 = zl_res_79282 && x_79283;
                        bool cond_79285 = zgze_res_79281 || y_79284;
                        int64_t binop_y_90312 = i_89041 * ext_90260;
                        int64_t lmad_ext_90313 = ext_90261 + binop_y_90312;
                        int64_t ext_90315;
                        
                        if (cond_79285) {
                            ext_90315 = (int64_t) 0;
                        } else {
                            ext_90315 = lmad_ext_90313;
                        }
                        
                        int64_t ext_90314;
                        
                        if (cond_79285) {
                            ext_90314 = (int64_t) 1;
                        } else {
                            ext_90314 = ext_90259;
                        }
                        
                        double rescale_res_79286;
                        double rescale_res_79287;
                        
                        if (cond_79285) {
                            double log_res_79289 = futrts_log64(eta_p_79278);
                            double sqrt_res_79290 = futrts_sqrt64(eta_p_79278);
                            double zs_res_79291 = log_res_79289 / 2.0;
                            double zp_res_79292 = eta_p_79279 + zs_res_79291;
                            
                            if (memblock_alloc(ctx, &mem_90305, bytes_89448, "mem_90305")) {
                                err = 1;
                                goto cleanup;
                            }
                            for (int64_t i_89033 = 0; i_89033 < m_34815; i_89033++) {
                                double eta_p_79294 = ((double *) ext_mem_90270.mem)[ext_90261 + (i_89041 * ext_90260 + i_89033 * ext_90259)];
                                double zt_res_79295 = sqrt_res_79290 * eta_p_79294;
                                
                                ((double *) mem_90305.mem)[i_89033] = zt_res_79295;
                            }
                            if (memblock_set(ctx, &ext_mem_90316, &mem_90305, "mem_90305") != 0)
                                return 1;
                            rescale_res_79286 = sqrt_res_79290;
                            rescale_res_79287 = zp_res_79292;
                        } else {
                            if (memblock_set(ctx, &ext_mem_90316, &ext_mem_90270, "ext_mem_90270") != 0)
                                return 1;
                            rescale_res_79286 = eta_p_79278;
                            rescale_res_79287 = eta_p_79279;
                        }
                        ((double *) mem_90288.mem)[i_89041] = rescale_res_79286;
                        ((double *) mem_90290.mem)[i_89041] = rescale_res_79287;
                        lmad_copy_8b(ctx, 1, (uint64_t *) mem_90293.mem, i_89041 * m_34815, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90316.mem, ext_90315, (int64_t []) {ext_90314}, (int64_t []) {m_34815});
                        if (memblock_unref(ctx, &ext_mem_90316, "ext_mem_90316") != 0)
                            return 1;
                    }
                    if (memblock_set(ctx, &ext_mem_90336, &mem_90288, "mem_90288") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90333, &mem_90290, "mem_90290") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90330, &mem_90293, "mem_90293") != 0)
                        return 1;
                } else {
                    if (memblock_set(ctx, &ext_mem_90336, &mem_90280, "mem_90280") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90333, &ext_mem_90268, "ext_mem_90268") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90330, &ext_mem_90270, "ext_mem_90270") != 0)
                        return 1;
                }
                if (memblock_unref(ctx, &mem_90280, "mem_90280") != 0)
                    return 1;
                
                bool x_90958 = !defunc_0_reduce_res_79461;
                bool defunc_0_reduce_res_79300;
                
                if (x_90958) {
                    bool x_90960;
                    bool redout_89045 = 0;
                    
                    for (int64_t i_89046 = 0; i_89046 < m_34815; i_89046++) {
                        double eta_p_61419 = ((double *) mem_90272.mem)[i_89046];
                        bool zlze_res_61420 = eta_p_61419 <= zs_res_53000;
                        bool defunc_0_op_res_54333 = zlze_res_61420 || redout_89045;
                        bool redout_tmp_91483 = defunc_0_op_res_54333;
                        
                        redout_89045 = redout_tmp_91483;
                    }
                    x_90960 = redout_89045;
                    defunc_0_reduce_res_79300 = x_90960;
                } else {
                    defunc_0_reduce_res_79300 = 0;
                }
                
                bool cond_54324 = defunc_0_reduce_res_79300 || defunc_0_reduce_res_79461;
                int64_t ext_90379;
                
                if (cond_54324) {
                    ext_90379 = (int64_t) 0;
                } else {
                    ext_90379 = ext_90329;
                }
                
                int64_t ext_90378;
                
                if (cond_54324) {
                    ext_90378 = (int64_t) 1;
                } else {
                    ext_90378 = ext_90328;
                }
                
                int64_t ext_90377;
                
                if (cond_54324) {
                    ext_90377 = m_34815;
                } else {
                    ext_90377 = ext_90327;
                }
                if (cond_54324) {
                    if (memblock_alloc(ctx, &mem_90338, bytes_89448, "mem_90338")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_90340, bytes_89448, "mem_90340")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_90343, bytes_89482, "mem_90343")) {
                        err = 1;
                        goto cleanup;
                    }
                    for (int64_t i_89057 = 0; i_89057 < m_34815; i_89057++) {
                        double eta_p_79319 = ((double *) mem_90272.mem)[i_89057];
                        double eta_p_79320 = ((double *) ext_mem_90267.mem)[i_89057];
                        bool zgze_res_79322 = exp_absorb_cutoff_34821 <= eta_p_79319;
                        bool zl_res_79323 = eta_p_79319 < zs_res_53000;
                        bool x_79324 = !zgze_res_79322;
                        bool y_79325 = zl_res_79323 && x_79324;
                        bool cond_79326 = zgze_res_79322 || y_79325;
                        int64_t binop_y_90362 = i_89057 * ext_90327;
                        int64_t lmad_ext_90363 = ext_90329 + binop_y_90362;
                        int64_t ext_90365;
                        
                        if (cond_79326) {
                            ext_90365 = (int64_t) 0;
                        } else {
                            ext_90365 = lmad_ext_90363;
                        }
                        
                        int64_t ext_90364;
                        
                        if (cond_79326) {
                            ext_90364 = (int64_t) 1;
                        } else {
                            ext_90364 = ext_90328;
                        }
                        
                        double rescale_res_79327;
                        double rescale_res_79328;
                        
                        if (cond_79326) {
                            double log_res_79330 = futrts_log64(eta_p_79319);
                            double sqrt_res_79331 = futrts_sqrt64(eta_p_79319);
                            double zs_res_79332 = log_res_79330 / 2.0;
                            double zp_res_79333 = eta_p_79320 + zs_res_79332;
                            
                            if (memblock_alloc(ctx, &mem_90355, bytes_89448, "mem_90355")) {
                                err = 1;
                                goto cleanup;
                            }
                            for (int64_t i_89049 = 0; i_89049 < m_34815; i_89049++) {
                                double eta_p_79335 = ((double *) ext_mem_90330.mem)[ext_90329 + (i_89049 * ext_90328 + i_89057 * ext_90327)];
                                double zt_res_79336 = sqrt_res_79331 * eta_p_79335;
                                
                                ((double *) mem_90355.mem)[i_89049] = zt_res_79336;
                            }
                            if (memblock_set(ctx, &ext_mem_90366, &mem_90355, "mem_90355") != 0)
                                return 1;
                            rescale_res_79327 = sqrt_res_79331;
                            rescale_res_79328 = zp_res_79333;
                        } else {
                            if (memblock_set(ctx, &ext_mem_90366, &ext_mem_90330, "ext_mem_90330") != 0)
                                return 1;
                            rescale_res_79327 = eta_p_79319;
                            rescale_res_79328 = eta_p_79320;
                        }
                        ((double *) mem_90338.mem)[i_89057] = rescale_res_79327;
                        ((double *) mem_90340.mem)[i_89057] = rescale_res_79328;
                        lmad_copy_8b(ctx, 1, (uint64_t *) mem_90343.mem, i_89057 * m_34815, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90366.mem, ext_90365, (int64_t []) {ext_90364}, (int64_t []) {m_34815});
                        if (memblock_unref(ctx, &ext_mem_90366, "ext_mem_90366") != 0)
                            return 1;
                    }
                    if (memblock_set(ctx, &ext_mem_90386, &mem_90338, "mem_90338") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90383, &mem_90340, "mem_90340") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90380, &mem_90343, "mem_90343") != 0)
                        return 1;
                } else {
                    if (memblock_set(ctx, &ext_mem_90386, &mem_90272, "mem_90272") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90383, &ext_mem_90267, "ext_mem_90267") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90380, &ext_mem_90330, "ext_mem_90330") != 0)
                        return 1;
                }
                if (memblock_unref(ctx, &mem_90272, "mem_90272") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90330, "ext_mem_90330") != 0)
                    return 1;
                
                bool defunc_0_reduce_res_79466;
                bool redout_89061 = 1;
                
                for (int64_t i_89062 = 0; i_89062 < m_34815; i_89062++) {
                    double eta_p_61191 = ((double *) ext_mem_90336.mem)[i_89062];
                    bool isnan_res_61192 = futrts_isnan64(eta_p_61191);
                    bool not_res_61193 = !isnan_res_61192;
                    bool x_54369 = not_res_61193 && redout_89061;
                    bool redout_tmp_91488 = x_54369;
                    
                    redout_89061 = redout_tmp_91488;
                }
                defunc_0_reduce_res_79466 = redout_89061;
                
                bool defunc_0_reduce_comm_res_79344;
                
                if (defunc_0_reduce_res_79466) {
                    bool x_90956;
                    bool redout_89063 = 0;
                    
                    for (int64_t i_89064 = 0; i_89064 < m_34815; i_89064++) {
                        double eta_p_79345 = ((double *) ext_mem_90336.mem)[i_89064];
                        double eta_p_79346 = ((double *) ext_mem_90269.mem)[i_89064];
                        double zt_res_79347 = zp_res_79142 * eta_p_79345;
                        bool zgze_res_79348 = eta_p_79346 <= zt_res_79347;
                        double zt_res_79349 = zp_res_79142 * eta_p_79346;
                        bool zgze_res_79350 = eta_p_79345 <= zt_res_79349;
                        bool x_79351 = zgze_res_79348 && zgze_res_79350;
                        bool not_res_79352 = !x_79351;
                        bool defunc_0_op_res_79355 = not_res_79352 || redout_89063;
                        bool redout_tmp_91489 = defunc_0_op_res_79355;
                        
                        redout_89063 = redout_tmp_91489;
                    }
                    x_90956 = redout_89063;
                    defunc_0_reduce_comm_res_79344 = x_90956;
                } else {
                    defunc_0_reduce_comm_res_79344 = 0;
                }
                
                bool x_91090 = defunc_0_reduce_comm_res_79344 && defunc_0_reduce_res_79466;
                int64_t ext_90529;
                int64_t ext_90528;
                int64_t ext_90527;
                bool algo5_core_loop_res_f_res_54386;
                bool loop_while_54392;
                int64_t ctx_param_ext_90387;
                int64_t ctx_param_ext_90388;
                int64_t ctx_param_ext_90389;
                
                if (memblock_set(ctx, &mem_param_90390, &ext_mem_90380, "ext_mem_90380") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90393, &ext_mem_90336, "ext_mem_90336") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90396, &ext_mem_90386, "ext_mem_90386") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90399, &ext_mem_90333, "ext_mem_90333") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90402, &ext_mem_90383, "ext_mem_90383") != 0)
                    return 1;
                ctx_param_ext_90387 = ext_90379;
                ctx_param_ext_90388 = ext_90378;
                ctx_param_ext_90389 = ext_90377;
                loop_while_54392 = x_91090;
                while (loop_while_54392) {
                    if (memblock_alloc(ctx, &mem_90404, bytes_89448, "mem_90404")) {
                        err = 1;
                        goto cleanup;
                    }
                    
                    bool defunc_0_reduce_res_79455;
                    bool redout_89068 = 0;
                    
                    for (int64_t i_89070 = 0; i_89070 < m_34815; i_89070++) {
                        double eta_p_61639 = ((double *) mem_param_90402.mem)[i_89070];
                        double defunc_0_reduce_res_79357;
                        double redout_89065 = 0.0;
                        
                        for (int64_t i_89066 = 0; i_89066 < m_34815; i_89066++) {
                            double eta_p_61663 = ((double *) mem_param_90393.mem)[i_89066];
                            double eta_p_61664 = ((double *) mem_param_90390.mem)[ctx_param_ext_90387 + (i_89066 * ctx_param_ext_90388 + i_89070 * ctx_param_ext_90389)];
                            double zt_res_61665 = eta_p_61663 * eta_p_61664;
                            double zp_res_61648 = zt_res_61665 + redout_89065;
                            double redout_tmp_91506 = zp_res_61648;
                            
                            redout_89065 = redout_tmp_91506;
                        }
                        defunc_0_reduce_res_79357 = redout_89065;
                        
                        double zs_res_61650 = defunc_0_reduce_res_79357 / replicate_arg1_52610;
                        double ztzt_res_61652 = fpow64(zs_res_61650, zs_res_52623);
                        double zt_res_61654 = zs_res_52624 * eta_p_61639;
                        double exp_res_61656 = futrts_exp64(zt_res_61654);
                        double zt_res_61658 = ztzt_res_61652 * exp_res_61656;
                        bool zgze_res_61660 = exp_absorb_cutoff_34821 <= zt_res_61658;
                        bool defunc_0_op_res_54505 = zgze_res_61660 || redout_89068;
                        
                        ((double *) mem_90404.mem)[i_89070] = zt_res_61658;
                        
                        bool redout_tmp_91504 = defunc_0_op_res_54505;
                        
                        redout_89068 = redout_tmp_91504;
                    }
                    defunc_0_reduce_res_79455 = redout_89068;
                    if (memblock_alloc(ctx, &mem_90412, bytes_89448, "mem_90412")) {
                        err = 1;
                        goto cleanup;
                    }
                    
                    bool defunc_0_reduce_res_79458;
                    bool redout_89075 = 0;
                    
                    for (int64_t i_89077 = 0; i_89077 < m_34815; i_89077++) {
                        double eta_p_61559 = ((double *) mem_param_90399.mem)[i_89077];
                        double defunc_0_reduce_res_79358;
                        double redout_89072 = 0.0;
                        
                        for (int64_t i_89073 = 0; i_89073 < m_34815; i_89073++) {
                            double eta_p_61669 = ((double *) mem_90404.mem)[i_89073];
                            double eta_p_61670 = ((double *) mem_param_90390.mem)[ctx_param_ext_90387 + (i_89077 * ctx_param_ext_90388 + i_89073 * ctx_param_ext_90389)];
                            double zt_res_61671 = eta_p_61669 * eta_p_61670;
                            double zp_res_61568 = zt_res_61671 + redout_89072;
                            double redout_tmp_91509 = zp_res_61568;
                            
                            redout_89072 = redout_tmp_91509;
                        }
                        defunc_0_reduce_res_79358 = redout_89072;
                        
                        double zs_res_61570 = defunc_0_reduce_res_79358 / replicate_arg1_52610;
                        double ztzt_res_61572 = fpow64(zs_res_61570, zs_res_52619);
                        double zt_res_61574 = zs_res_52620 * eta_p_61559;
                        double exp_res_61576 = futrts_exp64(zt_res_61574);
                        double zt_res_61578 = ztzt_res_61572 * exp_res_61576;
                        bool zgze_res_61580 = exp_absorb_cutoff_34821 <= zt_res_61578;
                        bool defunc_0_op_res_54462 = zgze_res_61580 || redout_89075;
                        
                        ((double *) mem_90412.mem)[i_89077] = zt_res_61578;
                        
                        bool redout_tmp_91507 = defunc_0_op_res_54462;
                        
                        redout_89075 = redout_tmp_91507;
                    }
                    defunc_0_reduce_res_79458 = redout_89075;
                    
                    bool x_90950 = !defunc_0_reduce_res_79458;
                    bool defunc_0_reduce_res_79359;
                    
                    if (x_90950) {
                        bool x_90952;
                        bool redout_89079 = 0;
                        
                        for (int64_t i_89080 = 0; i_89080 < m_34815; i_89080++) {
                            double eta_p_61675 = ((double *) mem_90412.mem)[i_89080];
                            bool zlze_res_61676 = eta_p_61675 <= zs_res_53000;
                            bool defunc_0_op_res_54472 = zlze_res_61676 || redout_89079;
                            bool redout_tmp_91510 = defunc_0_op_res_54472;
                            
                            redout_89079 = redout_tmp_91510;
                        }
                        x_90952 = redout_89079;
                        defunc_0_reduce_res_79359 = x_90952;
                    } else {
                        defunc_0_reduce_res_79359 = 0;
                    }
                    
                    bool cond_54463 = defunc_0_reduce_res_79359 || defunc_0_reduce_res_79458;
                    int64_t ext_90461;
                    
                    if (cond_54463) {
                        ext_90461 = (int64_t) 0;
                    } else {
                        ext_90461 = ctx_param_ext_90387;
                    }
                    
                    int64_t ext_90460;
                    
                    if (cond_54463) {
                        ext_90460 = m_34815;
                    } else {
                        ext_90460 = ctx_param_ext_90388;
                    }
                    
                    int64_t ext_90459;
                    
                    if (cond_54463) {
                        ext_90459 = (int64_t) 1;
                    } else {
                        ext_90459 = ctx_param_ext_90389;
                    }
                    if (cond_54463) {
                        if (memblock_alloc(ctx, &mem_90420, bytes_89448, "mem_90420")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (memblock_alloc(ctx, &mem_90422, bytes_89448, "mem_90422")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (memblock_alloc(ctx, &mem_90425, bytes_89482, "mem_90425")) {
                            err = 1;
                            goto cleanup;
                        }
                        for (int64_t i_89091 = 0; i_89091 < m_34815; i_89091++) {
                            double eta_p_79376 = ((double *) mem_90412.mem)[i_89091];
                            double eta_p_79377 = ((double *) mem_param_90399.mem)[i_89091];
                            bool zgze_res_79379 = exp_absorb_cutoff_34821 <= eta_p_79376;
                            bool zl_res_79380 = eta_p_79376 < zs_res_53000;
                            bool x_79381 = !zgze_res_79379;
                            bool y_79382 = zl_res_79380 && x_79381;
                            bool cond_79383 = zgze_res_79379 || y_79382;
                            int64_t binop_y_90444 = i_89091 * ctx_param_ext_90388;
                            int64_t lmad_ext_90445 = ctx_param_ext_90387 + binop_y_90444;
                            int64_t ext_90447;
                            
                            if (cond_79383) {
                                ext_90447 = (int64_t) 0;
                            } else {
                                ext_90447 = lmad_ext_90445;
                            }
                            
                            int64_t ext_90446;
                            
                            if (cond_79383) {
                                ext_90446 = (int64_t) 1;
                            } else {
                                ext_90446 = ctx_param_ext_90389;
                            }
                            
                            double rescale_res_79384;
                            double rescale_res_79385;
                            
                            if (cond_79383) {
                                double log_res_79387 = futrts_log64(eta_p_79376);
                                double sqrt_res_79388 = futrts_sqrt64(eta_p_79376);
                                double zs_res_79389 = log_res_79387 / 2.0;
                                double zp_res_79390 = eta_p_79377 + zs_res_79389;
                                
                                if (memblock_alloc(ctx, &mem_90437, bytes_89448, "mem_90437")) {
                                    err = 1;
                                    goto cleanup;
                                }
                                for (int64_t i_89083 = 0; i_89083 < m_34815; i_89083++) {
                                    double eta_p_79392 = ((double *) mem_param_90390.mem)[ctx_param_ext_90387 + (i_89091 * ctx_param_ext_90388 + i_89083 * ctx_param_ext_90389)];
                                    double zt_res_79393 = sqrt_res_79388 * eta_p_79392;
                                    
                                    ((double *) mem_90437.mem)[i_89083] = zt_res_79393;
                                }
                                if (memblock_set(ctx, &ext_mem_90448, &mem_90437, "mem_90437") != 0)
                                    return 1;
                                rescale_res_79384 = sqrt_res_79388;
                                rescale_res_79385 = zp_res_79390;
                            } else {
                                if (memblock_set(ctx, &ext_mem_90448, &mem_param_90390, "mem_param_90390") != 0)
                                    return 1;
                                rescale_res_79384 = eta_p_79376;
                                rescale_res_79385 = eta_p_79377;
                            }
                            ((double *) mem_90420.mem)[i_89091] = rescale_res_79384;
                            ((double *) mem_90422.mem)[i_89091] = rescale_res_79385;
                            lmad_copy_8b(ctx, 1, (uint64_t *) mem_90425.mem, i_89091 * m_34815, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90448.mem, ext_90447, (int64_t []) {ext_90446}, (int64_t []) {m_34815});
                            if (memblock_unref(ctx, &ext_mem_90448, "ext_mem_90448") != 0)
                                return 1;
                        }
                        if (memblock_set(ctx, &ext_mem_90468, &mem_90420, "mem_90420") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90465, &mem_90422, "mem_90422") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90462, &mem_90425, "mem_90425") != 0)
                            return 1;
                    } else {
                        if (memblock_set(ctx, &ext_mem_90468, &mem_90412, "mem_90412") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90465, &mem_param_90399, "mem_param_90399") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90462, &mem_param_90390, "mem_param_90390") != 0)
                            return 1;
                    }
                    if (memblock_unref(ctx, &mem_90412, "mem_90412") != 0)
                        return 1;
                    
                    bool x_91093 = !defunc_0_reduce_res_79455;
                    bool defunc_0_reduce_res_79398;
                    
                    if (x_91093) {
                        bool x_91095;
                        bool redout_89095 = 0;
                        
                        for (int64_t i_89096 = 0; i_89096 < m_34815; i_89096++) {
                            double eta_p_61718 = ((double *) mem_90404.mem)[i_89096];
                            bool zlze_res_61719 = eta_p_61718 <= zs_res_53000;
                            bool defunc_0_op_res_54515 = zlze_res_61719 || redout_89095;
                            bool redout_tmp_91515 = defunc_0_op_res_54515;
                            
                            redout_89095 = redout_tmp_91515;
                        }
                        x_91095 = redout_89095;
                        defunc_0_reduce_res_79398 = x_91095;
                    } else {
                        defunc_0_reduce_res_79398 = 0;
                    }
                    
                    bool cond_54506 = defunc_0_reduce_res_79398 || defunc_0_reduce_res_79455;
                    int64_t ext_90511;
                    
                    if (cond_54506) {
                        ext_90511 = (int64_t) 0;
                    } else {
                        ext_90511 = ext_90461;
                    }
                    
                    int64_t ext_90510;
                    
                    if (cond_54506) {
                        ext_90510 = (int64_t) 1;
                    } else {
                        ext_90510 = ext_90460;
                    }
                    
                    int64_t ext_90509;
                    
                    if (cond_54506) {
                        ext_90509 = m_34815;
                    } else {
                        ext_90509 = ext_90459;
                    }
                    if (cond_54506) {
                        if (memblock_alloc(ctx, &mem_90470, bytes_89448, "mem_90470")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (memblock_alloc(ctx, &mem_90472, bytes_89448, "mem_90472")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (memblock_alloc(ctx, &mem_90475, bytes_89482, "mem_90475")) {
                            err = 1;
                            goto cleanup;
                        }
                        for (int64_t i_89107 = 0; i_89107 < m_34815; i_89107++) {
                            double eta_p_79417 = ((double *) mem_90404.mem)[i_89107];
                            double eta_p_79418 = ((double *) mem_param_90402.mem)[i_89107];
                            bool zgze_res_79420 = exp_absorb_cutoff_34821 <= eta_p_79417;
                            bool zl_res_79421 = eta_p_79417 < zs_res_53000;
                            bool x_79422 = !zgze_res_79420;
                            bool y_79423 = zl_res_79421 && x_79422;
                            bool cond_79424 = zgze_res_79420 || y_79423;
                            int64_t binop_y_90494 = i_89107 * ext_90459;
                            int64_t lmad_ext_90495 = ext_90461 + binop_y_90494;
                            int64_t ext_90497;
                            
                            if (cond_79424) {
                                ext_90497 = (int64_t) 0;
                            } else {
                                ext_90497 = lmad_ext_90495;
                            }
                            
                            int64_t ext_90496;
                            
                            if (cond_79424) {
                                ext_90496 = (int64_t) 1;
                            } else {
                                ext_90496 = ext_90460;
                            }
                            
                            double rescale_res_79425;
                            double rescale_res_79426;
                            
                            if (cond_79424) {
                                double log_res_79428 = futrts_log64(eta_p_79417);
                                double sqrt_res_79429 = futrts_sqrt64(eta_p_79417);
                                double zs_res_79430 = log_res_79428 / 2.0;
                                double zp_res_79431 = eta_p_79418 + zs_res_79430;
                                
                                if (memblock_alloc(ctx, &mem_90487, bytes_89448, "mem_90487")) {
                                    err = 1;
                                    goto cleanup;
                                }
                                for (int64_t i_89099 = 0; i_89099 < m_34815; i_89099++) {
                                    double eta_p_79433 = ((double *) ext_mem_90462.mem)[ext_90461 + (i_89099 * ext_90460 + i_89107 * ext_90459)];
                                    double zt_res_79434 = sqrt_res_79429 * eta_p_79433;
                                    
                                    ((double *) mem_90487.mem)[i_89099] = zt_res_79434;
                                }
                                if (memblock_set(ctx, &ext_mem_90498, &mem_90487, "mem_90487") != 0)
                                    return 1;
                                rescale_res_79425 = sqrt_res_79429;
                                rescale_res_79426 = zp_res_79431;
                            } else {
                                if (memblock_set(ctx, &ext_mem_90498, &ext_mem_90462, "ext_mem_90462") != 0)
                                    return 1;
                                rescale_res_79425 = eta_p_79417;
                                rescale_res_79426 = eta_p_79418;
                            }
                            ((double *) mem_90470.mem)[i_89107] = rescale_res_79425;
                            ((double *) mem_90472.mem)[i_89107] = rescale_res_79426;
                            lmad_copy_8b(ctx, 1, (uint64_t *) mem_90475.mem, i_89107 * m_34815, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90498.mem, ext_90497, (int64_t []) {ext_90496}, (int64_t []) {m_34815});
                            if (memblock_unref(ctx, &ext_mem_90498, "ext_mem_90498") != 0)
                                return 1;
                        }
                        if (memblock_set(ctx, &ext_mem_90518, &mem_90470, "mem_90470") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90515, &mem_90472, "mem_90472") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90512, &mem_90475, "mem_90475") != 0)
                            return 1;
                    } else {
                        if (memblock_set(ctx, &ext_mem_90518, &mem_90404, "mem_90404") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90515, &mem_param_90402, "mem_param_90402") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90512, &ext_mem_90462, "ext_mem_90462") != 0)
                            return 1;
                    }
                    if (memblock_unref(ctx, &mem_90404, "mem_90404") != 0)
                        return 1;
                    if (memblock_unref(ctx, &ext_mem_90462, "ext_mem_90462") != 0)
                        return 1;
                    
                    bool defunc_0_reduce_res_79460;
                    bool redout_89111 = 1;
                    
                    for (int64_t i_89112 = 0; i_89112 < m_34815; i_89112++) {
                        double eta_p_61490 = ((double *) ext_mem_90468.mem)[i_89112];
                        bool isnan_res_61491 = futrts_isnan64(eta_p_61490);
                        bool not_res_61492 = !isnan_res_61491;
                        bool x_54551 = not_res_61492 && redout_89111;
                        bool redout_tmp_91520 = x_54551;
                        
                        redout_89111 = redout_tmp_91520;
                    }
                    defunc_0_reduce_res_79460 = redout_89111;
                    
                    bool loop_cond_54552;
                    
                    if (defunc_0_reduce_res_79460) {
                        bool defunc_0_reduce_comm_res_79442;
                        bool redout_89113 = 0;
                        
                        for (int64_t i_89114 = 0; i_89114 < m_34815; i_89114++) {
                            double eta_p_79443 = ((double *) ext_mem_90468.mem)[i_89114];
                            double eta_p_79444 = ((double *) mem_param_90393.mem)[i_89114];
                            double zt_res_79445 = zp_res_79142 * eta_p_79443;
                            bool zgze_res_79446 = eta_p_79444 <= zt_res_79445;
                            double zt_res_79447 = zp_res_79142 * eta_p_79444;
                            bool zgze_res_79448 = eta_p_79443 <= zt_res_79447;
                            bool x_79449 = zgze_res_79446 && zgze_res_79448;
                            bool not_res_79450 = !x_79449;
                            bool defunc_0_op_res_79453 = not_res_79450 || redout_89113;
                            bool redout_tmp_91521 = defunc_0_op_res_79453;
                            
                            redout_89113 = redout_tmp_91521;
                        }
                        defunc_0_reduce_comm_res_79442 = redout_89113;
                        loop_cond_54552 = defunc_0_reduce_comm_res_79442;
                    } else {
                        loop_cond_54552 = 0;
                    }
                    if (memblock_set(ctx, &mem_param_tmp_91490, &ext_mem_90512, "ext_mem_90512") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_91491, &ext_mem_90468, "ext_mem_90468") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_91492, &ext_mem_90518, "ext_mem_90518") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_91493, &ext_mem_90465, "ext_mem_90465") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_91494, &ext_mem_90515, "ext_mem_90515") != 0)
                        return 1;
                    
                    int64_t ctx_param_ext_tmp_91495 = ext_90511;
                    int64_t ctx_param_ext_tmp_91496 = ext_90510;
                    int64_t ctx_param_ext_tmp_91497 = ext_90509;
                    bool loop_while_tmp_91498 = loop_cond_54552;
                    
                    if (memblock_set(ctx, &mem_param_90390, &mem_param_tmp_91490, "mem_param_tmp_91490") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_90393, &mem_param_tmp_91491, "mem_param_tmp_91491") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_90396, &mem_param_tmp_91492, "mem_param_tmp_91492") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_90399, &mem_param_tmp_91493, "mem_param_tmp_91493") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_90402, &mem_param_tmp_91494, "mem_param_tmp_91494") != 0)
                        return 1;
                    ctx_param_ext_90387 = ctx_param_ext_tmp_91495;
                    ctx_param_ext_90388 = ctx_param_ext_tmp_91496;
                    ctx_param_ext_90389 = ctx_param_ext_tmp_91497;
                    loop_while_54392 = loop_while_tmp_91498;
                }
                if (memblock_set(ctx, &ext_mem_90534, &mem_param_90390, "mem_param_90390") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90533, &mem_param_90393, "mem_param_90393") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90532, &mem_param_90396, "mem_param_90396") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90531, &mem_param_90399, "mem_param_90399") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90530, &mem_param_90402, "mem_param_90402") != 0)
                    return 1;
                ext_90529 = ctx_param_ext_90387;
                ext_90528 = ctx_param_ext_90388;
                ext_90527 = ctx_param_ext_90389;
                algo5_core_loop_res_f_res_54386 = loop_while_54392;
                if (memblock_unref(ctx, &ext_mem_90333, "ext_mem_90333") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90336, "ext_mem_90336") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90380, "ext_mem_90380") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90383, "ext_mem_90383") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90386, "ext_mem_90386") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90550, &ext_mem_90534, "ext_mem_90534") != 0)
                    return 1;
                ext_90549 = ext_90529;
                ext_90548 = ext_90528;
                ext_90547 = ext_90527;
                if (memblock_set(ctx, &ext_mem_90546, &ext_mem_90533, "ext_mem_90533") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90543, &ext_mem_90532, "ext_mem_90532") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90540, &ext_mem_90531, "ext_mem_90531") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90537, &ext_mem_90530, "ext_mem_90530") != 0)
                    return 1;
            }
            if (memblock_unref(ctx, &ext_mem_90262, "ext_mem_90262") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90263, "ext_mem_90263") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90264, "ext_mem_90264") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90265, "ext_mem_90265") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90266, "ext_mem_90266") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90267, "ext_mem_90267") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90268, "ext_mem_90268") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90269, "ext_mem_90269") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90270, "ext_mem_90270") != 0)
                return 1;
            if (memblock_alloc(ctx, &mem_90552, bytes_89448, "mem_90552")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc(ctx, &mem_90557, bytes_89448, "mem_90557")) {
                err = 1;
                goto cleanup;
            }
            
            double defunc_res_80194;
            double redout_89123 = 0.0;
            
            for (int64_t i_89127 = 0; i_89127 < m_34815; i_89127++) {
                double eta_p_74744 = ((double *) ext_mem_90543.mem)[i_89127];
                double eta_p_74745 = ((double *) ext_mem_90537.mem)[i_89127];
                double eta_p_74747 = ((double *) ext_mem_90546.mem)[i_89127];
                double eta_p_74748 = ((double *) ext_mem_90540.mem)[i_89127];
                double log_res_74749 = futrts_log64(eta_p_74747);
                double zp_res_74750 = eta_p_74748 + log_res_74749;
                double defunc_res_79467;
                double redout_89116 = 0.0;
                
                for (int64_t i_89118 = 0; i_89118 < m_34815; i_89118++) {
                    double eta_p_75249 = ((double *) ext_mem_90550.mem)[ext_90549 + (i_89127 * ext_90548 + i_89118 * ext_90547)];
                    double eta_p_wasfree_75250 = ((double *) ext_mem_90543.mem)[i_89118];
                    double zt_res_75251 = eta_p_74747 * eta_p_75249;
                    double zt_res_75252 = eta_p_wasfree_75250 * zt_res_75251;
                    double zp_res_74765 = zt_res_75252 + redout_89116;
                    
                    ((double *) mem_90555)[i_89127 * m_34815 + i_89118] = zt_res_75252;
                    
                    double redout_tmp_91526 = zp_res_74765;
                    
                    redout_89116 = redout_tmp_91526;
                }
                defunc_res_79467 = redout_89116;
                
                double log_res_74756 = futrts_log64(eta_p_74744);
                double zp_res_74757 = eta_p_74745 + log_res_74756;
                double zp_res_54607 = defunc_res_79467 + redout_89123;
                
                ((double *) mem_90552.mem)[i_89127] = zp_res_74757;
                ((double *) mem_90557.mem)[i_89127] = zp_res_74750;
                
                double redout_tmp_91522 = zp_res_54607;
                
                redout_89123 = redout_tmp_91522;
            }
            defunc_res_80194 = redout_89123;
            if (memblock_unref(ctx, &ext_mem_90537, "ext_mem_90537") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90540, "ext_mem_90540") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90543, "ext_mem_90543") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90546, "ext_mem_90546") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90550, "ext_mem_90550") != 0)
                return 1;
            
            bool zg_res_54608 = 0.0 < defunc_res_80194;
            double zs_res_54609 = defunc_res_80177 / defunc_res_80194;
            double sqrt_res_54610 = futrts_sqrt64(zs_res_54609);
            double descent_res_54614;
            
            if (zg_res_54608) {
                if (mem_90592_cached_sizze_91731 < bytes_89448) {
                    err = lexical_realloc(ctx, &mem_90592, &mem_90592_cached_sizze_91731, bytes_89448);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (mem_90594_cached_sizze_91732 < bytes_89448) {
                    err = lexical_realloc(ctx, &mem_90594, &mem_90594_cached_sizze_91732, bytes_89448);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                
                double defunc_res_79564;
                double defunc_res_79565;
                double redout_89137;
                double redout_89138;
                
                redout_89137 = 0.0;
                redout_89138 = 0.0;
                for (int64_t i_89141 = 0; i_89141 < m_34815; i_89141++) {
                    double defunc_res_79569;
                    double defunc_res_79570;
                    double defunc_res_79571;
                    double redout_89131;
                    double redout_89132;
                    double redout_89133;
                    
                    redout_89131 = 0.0;
                    redout_89132 = 0.0;
                    redout_89133 = 0.0;
                    for (int64_t i_89134 = 0; i_89134 < m_34815; i_89134++) {
                        double x_79572 = ((double *) mem_param_89878.mem)[i_89134 * m_34815 + i_89141];
                        double zp_res_79575 = x_79572 + redout_89131;
                        double zp_res_79578 = x_79572 + redout_89132;
                        double zp_res_79581 = x_79572 + redout_89133;
                        double redout_tmp_91532 = zp_res_79575;
                        double redout_tmp_91533 = zp_res_79578;
                        double redout_tmp_91534 = zp_res_79581;
                        
                        redout_89131 = redout_tmp_91532;
                        redout_89132 = redout_tmp_91533;
                        redout_89133 = redout_tmp_91534;
                    }
                    defunc_res_79569 = redout_89131;
                    defunc_res_79570 = redout_89132;
                    defunc_res_79571 = redout_89133;
                    
                    bool zeze_res_79585 = defunc_res_79571 == 0.0;
                    double klu_res_79586;
                    
                    if (zeze_res_79585) {
                        klu_res_79586 = 0.0;
                    } else {
                        double zs_res_79587 = defunc_res_79571 / replicate_arg1_52610;
                        double log_res_79588 = futrts_log64(zs_res_79587);
                        double zt_res_79589 = defunc_res_79571 * log_res_79588;
                        
                        klu_res_79586 = zt_res_79589;
                    }
                    
                    double zp_res_79592 = defunc_res_79570 + redout_89137;
                    double zp_res_79595 = klu_res_79586 + redout_89138;
                    
                    ((double *) mem_90592)[i_89141] = defunc_res_79571;
                    ((double *) mem_90594)[i_89141] = defunc_res_79569;
                    
                    double redout_tmp_91528 = zp_res_79592;
                    double redout_tmp_91529 = zp_res_79595;
                    
                    redout_89137 = redout_tmp_91528;
                    redout_89138 = redout_tmp_91529;
                }
                defunc_res_79564 = redout_89137;
                defunc_res_79565 = redout_89138;
                
                double zm_res_79600 = defunc_res_79565 - defunc_res_79564;
                double zt_res_79601 = 2.0 * zm_res_79600;
                double zt_res_79602 = 2.0 * defunc_res_79564;
                
                if (mem_90609_cached_sizze_91733 < bytes_89482) {
                    err = lexical_realloc(ctx, &mem_90609, &mem_90609_cached_sizze_91733, bytes_89482);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                for (int64_t i_89146 = 0; i_89146 < m_34815; i_89146++) {
                    double eta_p_79604 = ((double *) mem_90592)[i_89146];
                    double log_res_79605 = futrts_log64(eta_p_79604);
                    double zm_res_79606 = log_res_79605 - log_res_52661;
                    double zp_res_79607 = 1.0 + zm_res_79606;
                    double fma_res_79608 = futrts_fma64(zt_res_79602, zp_res_79607, zt_res_79601);
                    
                    for (int64_t nest_i_91536 = 0; nest_i_91536 < m_34815; nest_i_91536++) {
                        ((double *) mem_90609)[i_89146 * m_34815 + nest_i_91536] = fma_res_79608;
                    }
                }
                if (mem_90621_cached_sizze_91734 < bytes_89448) {
                    err = lexical_realloc(ctx, &mem_90621, &mem_90621_cached_sizze_91734, bytes_89448);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (mem_90623_cached_sizze_91735 < bytes_89448) {
                    err = lexical_realloc(ctx, &mem_90623, &mem_90623_cached_sizze_91735, bytes_89448);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                
                double defunc_res_79611;
                double defunc_res_79612;
                double defunc_res_79613;
                double defunc_res_79614;
                double redout_89156;
                double redout_89157;
                double redout_89158;
                double redout_89159;
                
                redout_89156 = 0.0;
                redout_89157 = 0.0;
                redout_89158 = 0.0;
                redout_89159 = 0.0;
                for (int64_t i_89162 = 0; i_89162 < m_34815; i_89162++) {
                    double defunc_res_79618;
                    double defunc_res_79619;
                    double defunc_res_79620;
                    double defunc_res_79621;
                    double defunc_res_79622;
                    double redout_89148;
                    double redout_89149;
                    double redout_89150;
                    double redout_89151;
                    double redout_89152;
                    
                    redout_89148 = 0.0;
                    redout_89149 = 0.0;
                    redout_89150 = 0.0;
                    redout_89151 = 0.0;
                    redout_89152 = 0.0;
                    for (int64_t i_89153 = 0; i_89153 < m_34815; i_89153++) {
                        double x_79623 = ((double *) mem_param_89878.mem)[i_89162 * m_34815 + i_89153];
                        bool zeze_res_79624 = x_79623 == 0.0;
                        double klu_res_79625;
                        
                        if (zeze_res_79624) {
                            klu_res_79625 = 0.0;
                        } else {
                            double zs_res_79626 = x_79623 / zt_res_52646;
                            double log_res_79627 = futrts_log64(zs_res_79626);
                            double zt_res_79628 = x_79623 * log_res_79627;
                            
                            klu_res_79625 = zt_res_79628;
                        }
                        
                        double zp_res_79631 = x_79623 + redout_89148;
                        double zp_res_79634 = klu_res_79625 + redout_89149;
                        double zp_res_79637 = x_79623 + redout_89150;
                        double zp_res_79640 = x_79623 + redout_89151;
                        double zp_res_79643 = x_79623 + redout_89152;
                        double redout_tmp_91543 = zp_res_79631;
                        double redout_tmp_91544 = zp_res_79634;
                        double redout_tmp_91545 = zp_res_79637;
                        double redout_tmp_91546 = zp_res_79640;
                        double redout_tmp_91547 = zp_res_79643;
                        
                        redout_89148 = redout_tmp_91543;
                        redout_89149 = redout_tmp_91544;
                        redout_89150 = redout_tmp_91545;
                        redout_89151 = redout_tmp_91546;
                        redout_89152 = redout_tmp_91547;
                    }
                    defunc_res_79618 = redout_89148;
                    defunc_res_79619 = redout_89149;
                    defunc_res_79620 = redout_89150;
                    defunc_res_79621 = redout_89151;
                    defunc_res_79622 = redout_89152;
                    
                    bool zeze_res_79649 = defunc_res_79622 == 0.0;
                    double klu_res_79650;
                    
                    if (zeze_res_79649) {
                        klu_res_79650 = 0.0;
                    } else {
                        double zs_res_79651 = defunc_res_79622 / replicate_arg1_52610;
                        double log_res_79652 = futrts_log64(zs_res_79651);
                        double zt_res_79653 = defunc_res_79622 * log_res_79652;
                        
                        klu_res_79650 = zt_res_79653;
                    }
                    
                    double zp_res_79656 = defunc_res_79618 + redout_89156;
                    double zp_res_79659 = defunc_res_79619 + redout_89157;
                    double zp_res_79662 = defunc_res_79621 + redout_89158;
                    double zp_res_79665 = klu_res_79650 + redout_89159;
                    
                    ((double *) mem_90621)[i_89162] = defunc_res_79622;
                    ((double *) mem_90623)[i_89162] = defunc_res_79620;
                    
                    double redout_tmp_91537 = zp_res_79656;
                    double redout_tmp_91538 = zp_res_79659;
                    double redout_tmp_91539 = zp_res_79662;
                    double redout_tmp_91540 = zp_res_79665;
                    
                    redout_89156 = redout_tmp_91537;
                    redout_89157 = redout_tmp_91538;
                    redout_89158 = redout_tmp_91539;
                    redout_89159 = redout_tmp_91540;
                }
                defunc_res_79611 = redout_89156;
                defunc_res_79612 = redout_89157;
                defunc_res_79613 = redout_89158;
                defunc_res_79614 = redout_89159;
                
                double zm_res_79672 = defunc_res_79614 - defunc_res_79613;
                double zt_res_79673 = 2.0 * zm_res_79672;
                double zt_res_79674 = 2.0 * defunc_res_79613;
                
                if (mem_90637_cached_sizze_91736 < bytes_89448) {
                    err = lexical_realloc(ctx, &mem_90637, &mem_90637_cached_sizze_91736, bytes_89448);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                for (int64_t i_89169 = 0; i_89169 < m_34815; i_89169++) {
                    double defunc_0_reduce_res_79677;
                    double redout_89165 = 0.0;
                    
                    for (int64_t i_89166 = 0; i_89166 < m_34815; i_89166++) {
                        double eta_p_79678 = ((double *) mem_89415)[eta_p_52629 * lmad_arg_89421 + i_89169 * m_34815 + i_89166];
                        double eta_p_79679 = ((double *) mem_90594)[i_89166];
                        double zt_res_79680 = eta_p_79678 * eta_p_79678;
                        double zt_res_79681 = eta_p_79679 * zt_res_79680;
                        double zp_res_79684 = zt_res_79681 + redout_89165;
                        double redout_tmp_91549 = zp_res_79684;
                        
                        redout_89165 = redout_tmp_91549;
                    }
                    defunc_0_reduce_res_79677 = redout_89165;
                    ((double *) mem_90637)[i_89169] = defunc_0_reduce_res_79677;
                }
                
                double zt_res_79687 = 2.0 * defunc_res_79611;
                double zt_res_79688 = 2.0 * defunc_res_79612;
                
                if (mem_90645_cached_sizze_91737 < bytes_89448) {
                    err = lexical_realloc(ctx, &mem_90645, &mem_90645_cached_sizze_91737, bytes_89448);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (mem_90648_cached_sizze_91738 < bytes_89482) {
                    err = lexical_realloc(ctx, &mem_90648, &mem_90648_cached_sizze_91738, bytes_89482);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_90651, bytes_89482, "mem_90651")) {
                    err = 1;
                    goto cleanup;
                }
                if (mem_90664_cached_sizze_91739 < bytes_89448) {
                    err = lexical_realloc(ctx, &mem_90664, &mem_90664_cached_sizze_91739, bytes_89448);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                
                double defunc_res_79691;
                double defunc_res_79692;
                double defunc_res_79693;
                double defunc_res_79694;
                double redout_89195;
                double redout_89196;
                double redout_89197;
                double redout_89198;
                
                redout_89195 = 0.0;
                redout_89196 = 0.0;
                redout_89197 = 0.0;
                redout_89198 = 0.0;
                for (int64_t i_89202 = 0; i_89202 < m_34815; i_89202++) {
                    double eta_p_79701 = ((double *) mem_90621)[i_89202];
                    double log_res_79704 = futrts_log64(eta_p_79701);
                    double zm_res_79705 = log_res_79704 - log_res_52661;
                    double zp_res_79706 = 1.0 + zm_res_79705;
                    double fma_res_79707 = futrts_fma64(zt_res_79674, zp_res_79706, zt_res_79673);
                    
                    for (int64_t i_89175 = 0; i_89175 < m_34815; i_89175++) {
                        double defunc_0_reduce_res_79710;
                        double redout_89171 = 0.0;
                        
                        for (int64_t i_89172 = 0; i_89172 < m_34815; i_89172++) {
                            double eta_p_79711 = ((double *) mem_89415)[eta_p_52628 * lmad_arg_89421 + i_89202 * m_34815 + i_89172];
                            double eta_p_79712 = ((double *) mem_param_89878.mem)[i_89172 * m_34815 + i_89175];
                            double zt_res_79713 = eta_p_79711 * eta_p_79712;
                            double zp_res_79716 = zt_res_79713 + redout_89171;
                            double redout_tmp_91558 = zp_res_79716;
                            
                            redout_89171 = redout_tmp_91558;
                        }
                        defunc_0_reduce_res_79710 = redout_89171;
                        ((double *) mem_90664)[i_89175] = defunc_0_reduce_res_79710;
                    }
                    
                    double defunc_0_reduce_res_79719;
                    double redout_89177 = 0.0;
                    
                    for (int64_t i_89178 = 0; i_89178 < m_34815; i_89178++) {
                        double eta_p_79720 = ((double *) mem_89415)[eta_p_52628 * lmad_arg_89421 + i_89202 * m_34815 + i_89178];
                        double eta_p_79721 = ((double *) mem_90623)[i_89178];
                        double zt_res_79722 = eta_p_79720 * eta_p_79720;
                        double zt_res_79723 = eta_p_79721 * zt_res_79722;
                        double zp_res_79726 = zt_res_79723 + redout_89177;
                        double redout_tmp_91559 = zp_res_79726;
                        
                        redout_89177 = redout_tmp_91559;
                    }
                    defunc_0_reduce_res_79719 = redout_89177;
                    
                    double defunc_0_reduce_res_79728;
                    double defunc_res_79729;
                    double defunc_res_79730;
                    double defunc_res_79731;
                    double redout_89183;
                    double redout_89184;
                    double redout_89185;
                    double redout_89186;
                    
                    redout_89183 = 0.0;
                    redout_89184 = 0.0;
                    redout_89185 = 0.0;
                    redout_89186 = 0.0;
                    for (int64_t i_89189 = 0; i_89189 < m_34815; i_89189++) {
                        double eta_p_79734 = ((double *) mem_90555)[i_89202 * m_34815 + i_89189];
                        double eta_p_79735 = ((double *) mem_param_89878.mem)[i_89202 * m_34815 + i_89189];
                        double eta_p_wasfree_79737 = ((double *) mem_90637)[i_89189];
                        double eta_p_79738 = ((double *) mem_90609)[i_89189 * m_34815 + i_89202];
                        double zt_res_79739 = sqrt_res_54610 * eta_p_79734;
                        double zm_res_79740 = zt_res_79739 - eta_p_79735;
                        double log_res_79741 = futrts_log64(eta_p_79735);
                        double zm_res_79742 = log_res_79741 - log_res_52661;
                        double zm_res_79743 = zm_res_79742 - log_res_52661;
                        double fma_res_79744 = futrts_fma64(zt_res_79687, zm_res_79743, zt_res_79688);
                        double defunc_0_reduce_res_79745;
                        double redout_89179 = 0.0;
                        
                        for (int64_t i_89180 = 0; i_89180 < m_34815; i_89180++) {
                            double eta_p_79746 = ((double *) mem_90664)[i_89180];
                            double eta_p_79747 = ((double *) mem_89415)[eta_p_52629 * lmad_arg_89421 + i_89180 * m_34815 + i_89189];
                            double zt_res_79748 = eta_p_79746 * eta_p_79747;
                            double zp_res_79751 = zt_res_79748 + redout_89179;
                            double redout_tmp_91566 = zp_res_79751;
                            
                            redout_89179 = redout_tmp_91566;
                        }
                        defunc_0_reduce_res_79745 = redout_89179;
                        
                        double zt_res_79753 = -2.0 * defunc_0_reduce_res_79745;
                        double zp_res_79754 = defunc_0_reduce_res_79719 + zt_res_79753;
                        double zp_res_79755 = eta_p_wasfree_79737 + zp_res_79754;
                        double zt_res_79756 = 2.0 * zp_res_79755;
                        double fma_res_79757 = futrts_fma64(fma_res_79707, rho1_34817, zt_res_79756);
                        double fma_res_79758 = futrts_fma64(eta_p_79738, rho2_34818, fma_res_79757);
                        double fma_res_79759 = futrts_fma64(fma_res_79744, eps_34819, fma_res_79758);
                        double max_res_79760 = fmax64(-1.0e100, fma_res_79759);
                        double zt_res_79761 = zm_res_79740 * max_res_79760;
                        double zp_res_79762 = eta_p_79735 + zm_res_79740;
                        bool zeze_res_79763 = zp_res_79762 == 0.0;
                        double klu_res_79764;
                        
                        if (zeze_res_79763) {
                            klu_res_79764 = 0.0;
                        } else {
                            double zs_res_79765 = zp_res_79762 / zt_res_52646;
                            double log_res_79766 = futrts_log64(zs_res_79765);
                            double zt_res_79767 = zp_res_79762 * log_res_79766;
                            
                            klu_res_79764 = zt_res_79767;
                        }
                        
                        double zp_res_79770 = zt_res_79761 + redout_89183;
                        double zp_res_79773 = klu_res_79764 + redout_89184;
                        double zp_res_79776 = zp_res_79762 + redout_89185;
                        double zp_res_79779 = zp_res_79762 + redout_89186;
                        
                        ((double *) mem_90648)[i_89202 * m_34815 + i_89189] = zp_res_79762;
                        ((double *) mem_90651.mem)[i_89202 * m_34815 + i_89189] = zm_res_79740;
                        
                        double redout_tmp_91560 = zp_res_79770;
                        double redout_tmp_91561 = zp_res_79773;
                        double redout_tmp_91562 = zp_res_79776;
                        double redout_tmp_91563 = zp_res_79779;
                        
                        redout_89183 = redout_tmp_91560;
                        redout_89184 = redout_tmp_91561;
                        redout_89185 = redout_tmp_91562;
                        redout_89186 = redout_tmp_91563;
                    }
                    defunc_0_reduce_res_79728 = redout_89183;
                    defunc_res_79729 = redout_89184;
                    defunc_res_79730 = redout_89185;
                    defunc_res_79731 = redout_89186;
                    
                    bool zeze_res_79786 = defunc_res_79731 == 0.0;
                    double klu_res_79787;
                    
                    if (zeze_res_79786) {
                        klu_res_79787 = 0.0;
                    } else {
                        double zs_res_79788 = defunc_res_79731 / replicate_arg1_52610;
                        double log_res_79789 = futrts_log64(zs_res_79788);
                        double zt_res_79790 = defunc_res_79731 * log_res_79789;
                        
                        klu_res_79787 = zt_res_79790;
                    }
                    
                    double zp_res_79793 = defunc_0_reduce_res_79728 + redout_89195;
                    double zp_res_79796 = klu_res_79787 + redout_89196;
                    double zp_res_79799 = defunc_res_79731 + redout_89197;
                    double zp_res_79802 = defunc_res_79729 + redout_89198;
                    
                    ((double *) mem_90645)[i_89202] = defunc_res_79730;
                    
                    double redout_tmp_91550 = zp_res_79793;
                    double redout_tmp_91551 = zp_res_79796;
                    double redout_tmp_91552 = zp_res_79799;
                    double redout_tmp_91553 = zp_res_79802;
                    
                    redout_89195 = redout_tmp_91550;
                    redout_89196 = redout_tmp_91551;
                    redout_89197 = redout_tmp_91552;
                    redout_89198 = redout_tmp_91553;
                }
                defunc_res_79691 = redout_89195;
                defunc_res_79692 = redout_89196;
                defunc_res_79693 = redout_89197;
                defunc_res_79694 = redout_89198;
                
                bool zl_res_79810 = defunc_res_79691 < 0.0;
                bool assert_c_79811;
                
                if (!zl_res_79810) {
                    set_error(ctx, msgprintf("Error: %s\n\nBacktrace:\n%s", "Assertion is false: M.((gradient) M.< zero)", "-> #0  common.fut:220:7-221:22\n   #1  unbalanced_gw_core.fut:388:48-393:78\n   #2  unbalanced_gw_core.fut:402:7-11\n   #3  unbalanced_gw.fut:163:9-165:83\n   #4  /prelude/functional.fut:9:44-45\n   #5  unbalanced_gw.fut:162:6-165:84\n   #6  unbalanced_gw.fut:201:3-27\n   #7  unbalanced_gw.fut:199:1-201:47\n"));
                    err = FUTHARK_PROGRAM_ERROR;
                    goto cleanup;
                }
                if (mem_90699_cached_sizze_91740 < bytes_89448) {
                    err = lexical_realloc(ctx, &mem_90699, &mem_90699_cached_sizze_91740, bytes_89448);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                
                double defunc_res_79813;
                double redout_89210 = 0.0;
                
                for (int64_t i_89212 = 0; i_89212 < m_34815; i_89212++) {
                    double defunc_res_79816;
                    double defunc_res_79817;
                    double redout_89206;
                    double redout_89207;
                    
                    redout_89206 = 0.0;
                    redout_89207 = 0.0;
                    for (int64_t i_89208 = 0; i_89208 < m_34815; i_89208++) {
                        double x_79818 = ((double *) mem_90648)[i_89208 * m_34815 + i_89212];
                        double zp_res_79821 = x_79818 + redout_89206;
                        double zp_res_79824 = x_79818 + redout_89207;
                        double redout_tmp_91569 = zp_res_79821;
                        double redout_tmp_91570 = zp_res_79824;
                        
                        redout_89206 = redout_tmp_91569;
                        redout_89207 = redout_tmp_91570;
                    }
                    defunc_res_79816 = redout_89206;
                    defunc_res_79817 = redout_89207;
                    
                    bool zeze_res_79827 = defunc_res_79817 == 0.0;
                    double klu_res_79828;
                    
                    if (zeze_res_79827) {
                        klu_res_79828 = 0.0;
                    } else {
                        double zs_res_79829 = defunc_res_79817 / replicate_arg1_52610;
                        double log_res_79830 = futrts_log64(zs_res_79829);
                        double zt_res_79831 = defunc_res_79817 * log_res_79830;
                        
                        klu_res_79828 = zt_res_79831;
                    }
                    
                    double zp_res_79834 = klu_res_79828 + redout_89210;
                    
                    ((double *) mem_90699)[i_89212] = defunc_res_79816;
                    
                    double redout_tmp_91567 = zp_res_79834;
                    
                    redout_89210 = redout_tmp_91567;
                }
                defunc_res_79813 = redout_89210;
                if (mem_90707_cached_sizze_91741 < bytes_89448) {
                    err = lexical_realloc(ctx, &mem_90707, &mem_90707_cached_sizze_91741, bytes_89448);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                
                double defunc_0_reduce_res_79837;
                double defunc_res_79838;
                double redout_89226;
                double redout_89227;
                
                redout_89226 = 0.0;
                redout_89227 = 0.0;
                for (int64_t i_89228 = 0; i_89228 < m_34815; i_89228++) {
                    double eta_p_79841 = ((double *) mem_90645)[i_89228];
                    double defunc_0_reduce_res_79842;
                    double redout_89214 = 0.0;
                    
                    for (int64_t i_89215 = 0; i_89215 < m_34815; i_89215++) {
                        double eta_p_79843 = ((double *) mem_89415)[eta_p_52628 * lmad_arg_89421 + i_89228 * m_34815 + i_89215];
                        double eta_p_79844 = ((double *) mem_90645)[i_89215];
                        double zt_res_79845 = eta_p_79843 * eta_p_79843;
                        double zt_res_79846 = eta_p_79844 * zt_res_79845;
                        double zp_res_79849 = zt_res_79846 + redout_89214;
                        double redout_tmp_91573 = zp_res_79849;
                        
                        redout_89214 = redout_tmp_91573;
                    }
                    defunc_0_reduce_res_79842 = redout_89214;
                    
                    double zt_res_79851 = eta_p_79841 * defunc_0_reduce_res_79842;
                    
                    for (int64_t i_89220 = 0; i_89220 < m_34815; i_89220++) {
                        double defunc_0_reduce_res_79854;
                        double redout_89216 = 0.0;
                        
                        for (int64_t i_89217 = 0; i_89217 < m_34815; i_89217++) {
                            double eta_p_79855 = ((double *) mem_89415)[eta_p_52628 * lmad_arg_89421 + i_89228 * m_34815 + i_89217];
                            double eta_p_79856 = ((double *) mem_90648)[i_89217 * m_34815 + i_89220];
                            double zt_res_79857 = eta_p_79855 * eta_p_79856;
                            double zp_res_79860 = zt_res_79857 + redout_89216;
                            double redout_tmp_91575 = zp_res_79860;
                            
                            redout_89216 = redout_tmp_91575;
                        }
                        defunc_0_reduce_res_79854 = redout_89216;
                        ((double *) mem_90707)[i_89220] = defunc_0_reduce_res_79854;
                    }
                    
                    double defunc_0_reduce_res_79863;
                    double redout_89224 = 0.0;
                    
                    for (int64_t i_89225 = 0; i_89225 < m_34815; i_89225++) {
                        double eta_p_79865 = ((double *) mem_90648)[i_89228 * m_34815 + i_89225];
                        double defunc_0_reduce_res_79866;
                        double redout_89222 = 0.0;
                        
                        for (int64_t i_89223 = 0; i_89223 < m_34815; i_89223++) {
                            double eta_p_79867 = ((double *) mem_90707)[i_89223];
                            double eta_p_79868 = ((double *) mem_89415)[eta_p_52629 * lmad_arg_89421 + i_89223 * m_34815 + i_89225];
                            double zt_res_79869 = eta_p_79867 * eta_p_79868;
                            double zp_res_79872 = zt_res_79869 + redout_89222;
                            double redout_tmp_91577 = zp_res_79872;
                            
                            redout_89222 = redout_tmp_91577;
                        }
                        defunc_0_reduce_res_79866 = redout_89222;
                        
                        double zt_res_79874 = eta_p_79865 * defunc_0_reduce_res_79866;
                        double zp_res_79877 = zt_res_79874 + redout_89224;
                        double redout_tmp_91576 = zp_res_79877;
                        
                        redout_89224 = redout_tmp_91576;
                    }
                    defunc_0_reduce_res_79863 = redout_89224;
                    
                    double zp_res_79881 = zt_res_79851 + redout_89226;
                    double zp_res_79884 = defunc_0_reduce_res_79863 + redout_89227;
                    double redout_tmp_91571 = zp_res_79881;
                    double redout_tmp_91572 = zp_res_79884;
                    
                    redout_89226 = redout_tmp_91571;
                    redout_89227 = redout_tmp_91572;
                }
                defunc_0_reduce_res_79837 = redout_89226;
                defunc_res_79838 = redout_89227;
                
                double defunc_0_reduce_res_79887;
                double redout_89231 = 0.0;
                
                for (int64_t i_89232 = 0; i_89232 < m_34815; i_89232++) {
                    double eta_p_79889 = ((double *) mem_90699)[i_89232];
                    double defunc_0_reduce_res_79890;
                    double redout_89229 = 0.0;
                    
                    for (int64_t i_89230 = 0; i_89230 < m_34815; i_89230++) {
                        double eta_p_79891 = ((double *) mem_89415)[eta_p_52629 * lmad_arg_89421 + i_89232 * m_34815 + i_89230];
                        double eta_p_79892 = ((double *) mem_90699)[i_89230];
                        double zt_res_79893 = eta_p_79891 * eta_p_79891;
                        double zt_res_79894 = eta_p_79892 * zt_res_79893;
                        double zp_res_79897 = zt_res_79894 + redout_89229;
                        double redout_tmp_91579 = zp_res_79897;
                        
                        redout_89229 = redout_tmp_91579;
                    }
                    defunc_0_reduce_res_79890 = redout_89229;
                    
                    double zt_res_79899 = eta_p_79889 * defunc_0_reduce_res_79890;
                    double zp_res_79902 = zt_res_79899 + redout_89231;
                    double redout_tmp_91578 = zp_res_79902;
                    
                    redout_89231 = redout_tmp_91578;
                }
                defunc_0_reduce_res_79887 = redout_89231;
                
                double zt_res_79904 = -2.0 * defunc_res_79838;
                double zp_res_79905 = defunc_0_reduce_res_79837 + zt_res_79904;
                double zp_res_79906 = defunc_0_reduce_res_79887 + zp_res_79905;
                double zt_res_79907 = eps_34819 * defunc_res_79694;
                double zt_res_79908 = rho1_34817 * defunc_res_79692;
                double zt_res_79909 = rho2_34818 * defunc_res_79813;
                double zp_res_79910 = zt_res_79907 + zt_res_79908;
                double zp_res_79911 = zt_res_79909 + zp_res_79910;
                double zt_res_79912 = 2.0 * zp_res_79911;
                double zt_res_79913 = defunc_res_79693 * zt_res_79912;
                double zp_res_79914 = zp_res_79906 + zt_res_79913;
                double zt_res_79915 = defunc_res_79693 * defunc_res_79693;
                double zt_res_79918 = zp_res_52625 * zt_res_79915;
                double zm_res_79919 = zp_res_79914 - zt_res_79918;
                double zp_res_79940 = zm_res_79919 + zp_res_79939;
                double zm_res_79941 = zp_res_79940 - loss_53554;
                bool zgze_res_79942 = -1.0 <= zm_res_79941;
                double zs_res_79943 = zm_res_79941 / defunc_res_79691;
                bool zlze_res_79944 = zs_res_79943 <= 0.5;
                bool x_79945 = zgze_res_79942 && zlze_res_79944;
                
                if (mem_90719_cached_sizze_91742 < bytes_89448) {
                    err = lexical_realloc(ctx, &mem_90719, &mem_90719_cached_sizze_91742, bytes_89448);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (mem_90722_cached_sizze_91743 < bytes_89482) {
                    err = lexical_realloc(ctx, &mem_90722, &mem_90722_cached_sizze_91743, bytes_89482);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (mem_90765_cached_sizze_91744 < bytes_89448) {
                    err = lexical_realloc(ctx, &mem_90765, &mem_90765_cached_sizze_91744, bytes_89448);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (mem_90773_cached_sizze_91745 < bytes_89448) {
                    err = lexical_realloc(ctx, &mem_90773, &mem_90773_cached_sizze_91745, bytes_89448);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                
                bool defunc_0_armijo_line_search_res_79969;
                double defunc_0_armijo_line_search_res_79971;
                double defunc_0_armijo_line_search_res_79972;
                bool loop_while_79973;
                double current_loss_79975;
                double alpha_79976;
                
                if (memblock_set(ctx, &mem_param_90717, &mem_90651, "mem_90651") != 0)
                    return 1;
                loop_while_79973 = x_79945;
                current_loss_79975 = zp_res_79940;
                alpha_79976 = 1.0;
                while (loop_while_79973) {
                    double zt_res_79977 = 0.5 * alpha_79976;
                    
                    if (memblock_alloc(ctx, &mem_90725, bytes_89482, "mem_90725")) {
                        err = 1;
                        goto cleanup;
                    }
                    
                    double defunc_res_79978;
                    double defunc_res_79979;
                    double defunc_res_79980;
                    double redout_89253;
                    double redout_89254;
                    double redout_89255;
                    
                    redout_89253 = 0.0;
                    redout_89254 = 0.0;
                    redout_89255 = 0.0;
                    for (int64_t i_89259 = 0; i_89259 < m_34815; i_89259++) {
                        double defunc_res_79986;
                        double defunc_res_79987;
                        double defunc_res_79988;
                        double redout_89242;
                        double redout_89243;
                        double redout_89244;
                        
                        redout_89242 = 0.0;
                        redout_89243 = 0.0;
                        redout_89244 = 0.0;
                        for (int64_t i_89247 = 0; i_89247 < m_34815; i_89247++) {
                            double eta_p_79991 = ((double *) mem_param_90717.mem)[i_89259 * m_34815 + i_89247];
                            double eta_p_79992 = ((double *) mem_param_89878.mem)[i_89259 * m_34815 + i_89247];
                            double zt_res_79993 = 0.5 * eta_p_79991;
                            double zp_res_79994 = eta_p_79992 + zt_res_79993;
                            bool zeze_res_79995 = zp_res_79994 == 0.0;
                            double klu_res_79996;
                            
                            if (zeze_res_79995) {
                                klu_res_79996 = 0.0;
                            } else {
                                double zs_res_79997 = zp_res_79994 / zt_res_52646;
                                double log_res_79998 = futrts_log64(zs_res_79997);
                                double zt_res_79999 = zp_res_79994 * log_res_79998;
                                
                                klu_res_79996 = zt_res_79999;
                            }
                            
                            double zp_res_80002 = klu_res_79996 + redout_89242;
                            double zp_res_80005 = zp_res_79994 + redout_89243;
                            double zp_res_80008 = zp_res_79994 + redout_89244;
                            
                            ((double *) mem_90722)[i_89259 * m_34815 + i_89247] = zp_res_79994;
                            ((double *) mem_90725.mem)[i_89259 * m_34815 + i_89247] = zt_res_79993;
                            
                            double redout_tmp_91591 = zp_res_80002;
                            double redout_tmp_91592 = zp_res_80005;
                            double redout_tmp_91593 = zp_res_80008;
                            
                            redout_89242 = redout_tmp_91591;
                            redout_89243 = redout_tmp_91592;
                            redout_89244 = redout_tmp_91593;
                        }
                        defunc_res_79986 = redout_89242;
                        defunc_res_79987 = redout_89243;
                        defunc_res_79988 = redout_89244;
                        
                        bool zeze_res_80014 = defunc_res_79988 == 0.0;
                        double klu_res_80015;
                        
                        if (zeze_res_80014) {
                            klu_res_80015 = 0.0;
                        } else {
                            double zs_res_80016 = defunc_res_79988 / replicate_arg1_52610;
                            double log_res_80017 = futrts_log64(zs_res_80016);
                            double zt_res_80018 = defunc_res_79988 * log_res_80017;
                            
                            klu_res_80015 = zt_res_80018;
                        }
                        
                        double zp_res_80021 = klu_res_80015 + redout_89253;
                        double zp_res_80024 = defunc_res_79988 + redout_89254;
                        double zp_res_80027 = defunc_res_79986 + redout_89255;
                        
                        ((double *) mem_90719)[i_89259] = defunc_res_79987;
                        
                        double redout_tmp_91585 = zp_res_80021;
                        double redout_tmp_91586 = zp_res_80024;
                        double redout_tmp_91587 = zp_res_80027;
                        
                        redout_89253 = redout_tmp_91585;
                        redout_89254 = redout_tmp_91586;
                        redout_89255 = redout_tmp_91587;
                    }
                    defunc_res_79978 = redout_89253;
                    defunc_res_79979 = redout_89254;
                    defunc_res_79980 = redout_89255;
                    
                    double defunc_res_80035;
                    double redout_89267 = 0.0;
                    
                    for (int64_t i_89269 = 0; i_89269 < m_34815; i_89269++) {
                        double defunc_res_80038;
                        double defunc_res_80039;
                        double redout_89263;
                        double redout_89264;
                        
                        redout_89263 = 0.0;
                        redout_89264 = 0.0;
                        for (int64_t i_89265 = 0; i_89265 < m_34815; i_89265++) {
                            double x_80040 = ((double *) mem_90722)[i_89265 * m_34815 + i_89269];
                            double zp_res_80043 = x_80040 + redout_89263;
                            double zp_res_80046 = x_80040 + redout_89264;
                            double redout_tmp_91598 = zp_res_80043;
                            double redout_tmp_91599 = zp_res_80046;
                            
                            redout_89263 = redout_tmp_91598;
                            redout_89264 = redout_tmp_91599;
                        }
                        defunc_res_80038 = redout_89263;
                        defunc_res_80039 = redout_89264;
                        
                        bool zeze_res_80049 = defunc_res_80039 == 0.0;
                        double klu_res_80050;
                        
                        if (zeze_res_80049) {
                            klu_res_80050 = 0.0;
                        } else {
                            double zs_res_80051 = defunc_res_80039 / replicate_arg1_52610;
                            double log_res_80052 = futrts_log64(zs_res_80051);
                            double zt_res_80053 = defunc_res_80039 * log_res_80052;
                            
                            klu_res_80050 = zt_res_80053;
                        }
                        
                        double zp_res_80056 = klu_res_80050 + redout_89267;
                        
                        ((double *) mem_90765)[i_89269] = defunc_res_80038;
                        
                        double redout_tmp_91596 = zp_res_80056;
                        
                        redout_89267 = redout_tmp_91596;
                    }
                    defunc_res_80035 = redout_89267;
                    
                    double defunc_0_reduce_res_80059;
                    double defunc_res_80060;
                    double redout_89283;
                    double redout_89284;
                    
                    redout_89283 = 0.0;
                    redout_89284 = 0.0;
                    for (int64_t i_89285 = 0; i_89285 < m_34815; i_89285++) {
                        double eta_p_80063 = ((double *) mem_90719)[i_89285];
                        double defunc_0_reduce_res_80064;
                        double redout_89271 = 0.0;
                        
                        for (int64_t i_89272 = 0; i_89272 < m_34815; i_89272++) {
                            double eta_p_80065 = ((double *) mem_89415)[eta_p_52628 * lmad_arg_89421 + i_89285 * m_34815 + i_89272];
                            double eta_p_80066 = ((double *) mem_90719)[i_89272];
                            double zt_res_80067 = eta_p_80065 * eta_p_80065;
                            double zt_res_80068 = eta_p_80066 * zt_res_80067;
                            double zp_res_80071 = zt_res_80068 + redout_89271;
                            double redout_tmp_91602 = zp_res_80071;
                            
                            redout_89271 = redout_tmp_91602;
                        }
                        defunc_0_reduce_res_80064 = redout_89271;
                        
                        double zt_res_80073 = eta_p_80063 * defunc_0_reduce_res_80064;
                        
                        for (int64_t i_89277 = 0; i_89277 < m_34815; i_89277++) {
                            double defunc_0_reduce_res_80076;
                            double redout_89273 = 0.0;
                            
                            for (int64_t i_89274 = 0; i_89274 < m_34815; i_89274++) {
                                double eta_p_80077 = ((double *) mem_89415)[eta_p_52628 * lmad_arg_89421 + i_89285 * m_34815 + i_89274];
                                double eta_p_80078 = ((double *) mem_90722)[i_89274 * m_34815 + i_89277];
                                double zt_res_80079 = eta_p_80077 * eta_p_80078;
                                double zp_res_80082 = zt_res_80079 + redout_89273;
                                double redout_tmp_91604 = zp_res_80082;
                                
                                redout_89273 = redout_tmp_91604;
                            }
                            defunc_0_reduce_res_80076 = redout_89273;
                            ((double *) mem_90773)[i_89277] = defunc_0_reduce_res_80076;
                        }
                        
                        double defunc_0_reduce_res_80085;
                        double redout_89281 = 0.0;
                        
                        for (int64_t i_89282 = 0; i_89282 < m_34815; i_89282++) {
                            double eta_p_80087 = ((double *) mem_90722)[i_89285 * m_34815 + i_89282];
                            double defunc_0_reduce_res_80088;
                            double redout_89279 = 0.0;
                            
                            for (int64_t i_89280 = 0; i_89280 < m_34815; i_89280++) {
                                double eta_p_80089 = ((double *) mem_90773)[i_89280];
                                double eta_p_80090 = ((double *) mem_89415)[eta_p_52629 * lmad_arg_89421 + i_89280 * m_34815 + i_89282];
                                double zt_res_80091 = eta_p_80089 * eta_p_80090;
                                double zp_res_80094 = zt_res_80091 + redout_89279;
                                double redout_tmp_91606 = zp_res_80094;
                                
                                redout_89279 = redout_tmp_91606;
                            }
                            defunc_0_reduce_res_80088 = redout_89279;
                            
                            double zt_res_80096 = eta_p_80087 * defunc_0_reduce_res_80088;
                            double zp_res_80099 = zt_res_80096 + redout_89281;
                            double redout_tmp_91605 = zp_res_80099;
                            
                            redout_89281 = redout_tmp_91605;
                        }
                        defunc_0_reduce_res_80085 = redout_89281;
                        
                        double zp_res_80103 = zt_res_80073 + redout_89283;
                        double zp_res_80106 = defunc_0_reduce_res_80085 + redout_89284;
                        double redout_tmp_91600 = zp_res_80103;
                        double redout_tmp_91601 = zp_res_80106;
                        
                        redout_89283 = redout_tmp_91600;
                        redout_89284 = redout_tmp_91601;
                    }
                    defunc_0_reduce_res_80059 = redout_89283;
                    defunc_res_80060 = redout_89284;
                    
                    double defunc_0_reduce_res_80109;
                    double redout_89288 = 0.0;
                    
                    for (int64_t i_89289 = 0; i_89289 < m_34815; i_89289++) {
                        double eta_p_80111 = ((double *) mem_90765)[i_89289];
                        double defunc_0_reduce_res_80112;
                        double redout_89286 = 0.0;
                        
                        for (int64_t i_89287 = 0; i_89287 < m_34815; i_89287++) {
                            double eta_p_80113 = ((double *) mem_89415)[eta_p_52629 * lmad_arg_89421 + i_89289 * m_34815 + i_89287];
                            double eta_p_80114 = ((double *) mem_90765)[i_89287];
                            double zt_res_80115 = eta_p_80113 * eta_p_80113;
                            double zt_res_80116 = eta_p_80114 * zt_res_80115;
                            double zp_res_80119 = zt_res_80116 + redout_89286;
                            double redout_tmp_91608 = zp_res_80119;
                            
                            redout_89286 = redout_tmp_91608;
                        }
                        defunc_0_reduce_res_80112 = redout_89286;
                        
                        double zt_res_80121 = eta_p_80111 * defunc_0_reduce_res_80112;
                        double zp_res_80124 = zt_res_80121 + redout_89288;
                        double redout_tmp_91607 = zp_res_80124;
                        
                        redout_89288 = redout_tmp_91607;
                    }
                    defunc_0_reduce_res_80109 = redout_89288;
                    
                    double zt_res_80126 = -2.0 * defunc_res_80060;
                    double zp_res_80127 = defunc_0_reduce_res_80059 + zt_res_80126;
                    double zp_res_80128 = defunc_0_reduce_res_80109 + zp_res_80127;
                    double zt_res_80129 = eps_34819 * defunc_res_79980;
                    double zt_res_80130 = rho1_34817 * defunc_res_79978;
                    double zt_res_80131 = rho2_34818 * defunc_res_80035;
                    double zp_res_80132 = zt_res_80129 + zt_res_80130;
                    double zp_res_80133 = zt_res_80131 + zp_res_80132;
                    double zt_res_80134 = 2.0 * zp_res_80133;
                    double zt_res_80135 = defunc_res_79979 * zt_res_80134;
                    double zp_res_80136 = zp_res_80128 + zt_res_80135;
                    double zt_res_80137 = defunc_res_79979 * defunc_res_79979;
                    double zt_res_80138 = zp_res_52625 * zt_res_80137;
                    double zm_res_80139 = zp_res_80136 - zt_res_80138;
                    double zp_res_80140 = zp_res_79968 + zm_res_80139;
                    double zm_res_80141 = zp_res_80140 - loss_53554;
                    bool zgze_res_80142 = -1.0 <= zm_res_80141;
                    double zt_res_80143 = defunc_res_79691 * zt_res_79977;
                    double zs_res_80144 = zm_res_80141 / zt_res_80143;
                    bool zlze_res_80145 = zs_res_80144 <= 0.5;
                    bool zg_res_80146 = 1.0e-50 < zt_res_79977;
                    bool x_80147 = zlze_res_80145 && zg_res_80146;
                    bool x_80148 = zgze_res_80142 && x_80147;
                    
                    if (memblock_set(ctx, &mem_param_tmp_91580, &mem_90725, "mem_90725") != 0)
                        return 1;
                    
                    bool loop_while_tmp_91581 = x_80148;
                    double current_loss_tmp_91583 = zp_res_80140;
                    double alpha_tmp_91584 = zt_res_79977;
                    
                    if (memblock_set(ctx, &mem_param_90717, &mem_param_tmp_91580, "mem_param_tmp_91580") != 0)
                        return 1;
                    loop_while_79973 = loop_while_tmp_91581;
                    current_loss_79975 = current_loss_tmp_91583;
                    alpha_79976 = alpha_tmp_91584;
                }
                if (memblock_set(ctx, &ext_mem_90783, &mem_param_90717, "mem_param_90717") != 0)
                    return 1;
                defunc_0_armijo_line_search_res_79969 = loop_while_79973;
                defunc_0_armijo_line_search_res_79971 = current_loss_79975;
                defunc_0_armijo_line_search_res_79972 = alpha_79976;
                if (memblock_unref(ctx, &mem_90651, "mem_90651") != 0)
                    return 1;
                if (memblock_alloc(ctx, &mem_90786, bytes_89482, "mem_90786")) {
                    err = 1;
                    goto cleanup;
                }
                for (int64_t i_89296 = 0; i_89296 < m_34815; i_89296++) {
                    for (int64_t i_89292 = 0; i_89292 < m_34815; i_89292++) {
                        double eta_p_80153 = ((double *) mem_param_89878.mem)[i_89296 * m_34815 + i_89292];
                        double eta_p_80154 = ((double *) ext_mem_90783.mem)[i_89296 * m_34815 + i_89292];
                        double zp_res_80155 = eta_p_80153 + eta_p_80154;
                        
                        ((double *) mem_90786.mem)[i_89296 * m_34815 + i_89292] = zp_res_80155;
                    }
                }
                if (memblock_unref(ctx, &ext_mem_90783, "ext_mem_90783") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90812, &mem_90557, "mem_90557") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90809, &mem_90552, "mem_90552") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90806, &mem_90786, "mem_90786") != 0)
                    return 1;
                descent_res_54614 = defunc_0_armijo_line_search_res_79971;
            } else {
                if (memblock_alloc(ctx, &mem_90587, bytes_89448, "mem_90587")) {
                    err = 1;
                    goto cleanup;
                }
                for (int64_t nest_i_91611 = 0; nest_i_91611 < m_34815; nest_i_91611++) {
                    ((double *) mem_90587.mem)[nest_i_91611] = 0.0;
                }
                if (memblock_alloc(ctx, &mem_90590, bytes_89482, "mem_90590")) {
                    err = 1;
                    goto cleanup;
                }
                for (int64_t nest_i_91612 = 0; nest_i_91612 < m_34815; nest_i_91612++) {
                    for (int64_t nest_i_91613 = 0; nest_i_91613 < m_34815; nest_i_91613++) {
                        ((double *) mem_90590.mem)[nest_i_91612 * m_34815 + nest_i_91613] = 0.0;
                    }
                }
                if (memblock_set(ctx, &ext_mem_90812, &mem_90587, "mem_90587") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90809, &mem_90587, "mem_90587") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90806, &mem_90590, "mem_90590") != 0)
                    return 1;
                descent_res_54614 = 0.0;
            }
            if (memblock_unref(ctx, &mem_90552, "mem_90552") != 0)
                return 1;
            if (memblock_unref(ctx, &mem_90557, "mem_90557") != 0)
                return 1;
            
            bool defunc_0_reduce_comm_res_80198;
            bool redout_89300 = 0;
            
            for (int64_t i_89301 = 0; i_89301 < m_34815; i_89301++) {
                bool defunc_0_reduce_comm_res_80158;
                bool redout_89298 = 0;
                
                for (int64_t i_89299 = 0; i_89299 < m_34815; i_89299++) {
                    double eta_p_66433 = ((double *) mem_param_89878.mem)[i_89301 * m_34815 + i_89299];
                    double eta_p_66434 = ((double *) ext_mem_90806.mem)[i_89301 * m_34815 + i_89299];
                    double zt_res_66435 = zp_res_52616 * eta_p_66433;
                    bool zgze_res_66436 = eta_p_66434 <= zt_res_66435;
                    double zt_res_66437 = zp_res_52616 * eta_p_66434;
                    bool zgze_res_66438 = eta_p_66433 <= zt_res_66437;
                    bool x_66439 = zgze_res_66436 && zgze_res_66438;
                    bool not_res_66440 = !x_66439;
                    bool defunc_0_op_res_59150 = not_res_66440 || redout_89298;
                    bool redout_tmp_91615 = defunc_0_op_res_59150;
                    
                    redout_89298 = redout_tmp_91615;
                }
                defunc_0_reduce_comm_res_80158 = redout_89298;
                
                bool defunc_0_op_res_55418 = defunc_0_reduce_comm_res_80158 || redout_89300;
                bool redout_tmp_91614 = defunc_0_op_res_55418;
                
                redout_89300 = redout_tmp_91614;
            }
            defunc_0_reduce_comm_res_80198 = redout_89300;
            
            bool loop_cond_55419;
            
            if (defunc_0_reduce_comm_res_80198) {
                bool defunc_0_reduce_res_80161;
                bool redout_89304 = 0;
                
                for (int64_t i_89305 = 0; i_89305 < m_34815; i_89305++) {
                    bool defunc_0_reduce_res_80163;
                    bool redout_89302 = 0;
                    
                    for (int64_t i_89303 = 0; i_89303 < m_34815; i_89303++) {
                        double eta_p_80164 = ((double *) ext_mem_90806.mem)[i_89305 * m_34815 + i_89303];
                        bool zg_res_80165 = 0.0 < eta_p_80164;
                        bool defunc_0_op_res_80168 = zg_res_80165 || redout_89302;
                        bool redout_tmp_91617 = defunc_0_op_res_80168;
                        
                        redout_89302 = redout_tmp_91617;
                    }
                    defunc_0_reduce_res_80163 = redout_89302;
                    
                    bool defunc_0_op_res_80172 = defunc_0_reduce_res_80163 || redout_89304;
                    bool redout_tmp_91616 = defunc_0_op_res_80172;
                    
                    redout_89304 = redout_tmp_91616;
                }
                defunc_0_reduce_res_80161 = redout_89304;
                loop_cond_55419 = defunc_0_reduce_res_80161;
            } else {
                loop_cond_55419 = 0;
            }
            if (memblock_set(ctx, &mem_param_tmp_91372, &ext_mem_90812, "ext_mem_90812") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_tmp_91373, &ext_mem_90809, "ext_mem_90809") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_tmp_91374, &ext_mem_90806, "ext_mem_90806") != 0)
                return 1;
            
            bool loop_while_tmp_91375 = loop_cond_55419;
            double loss_tmp_91379 = descent_res_54614;
            
            if (memblock_set(ctx, &mem_param_89871, &mem_param_tmp_91372, "mem_param_tmp_91372") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_89874, &mem_param_tmp_91373, "mem_param_tmp_91373") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_89878, &mem_param_tmp_91374, "mem_param_tmp_91374") != 0)
                return 1;
            loop_while_53550 = loop_while_tmp_91375;
            loss_53554 = loss_tmp_91379;
        }
        if (memblock_set(ctx, &ext_mem_90822, &mem_param_89871, "mem_param_89871") != 0)
            return 1;
        if (memblock_set(ctx, &ext_mem_90821, &mem_param_89874, "mem_param_89874") != 0)
            return 1;
        if (memblock_set(ctx, &ext_mem_90820, &mem_param_89878, "mem_param_89878") != 0)
            return 1;
        final_plan_53545 = loop_while_53550;
        final_plan_53549 = loss_53554;
        if (memblock_unref(ctx, &ext_mem_89826, "ext_mem_89826") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89827, "ext_mem_89827") != 0)
            return 1;
        
        double defunc_res_80273;
        double defunc_res_80274;
        double defunc_res_80275;
        double defunc_res_80276;
        double defunc_res_80277;
        double redout_89326;
        double redout_89327;
        double redout_89328;
        double redout_89329;
        double redout_89330;
        
        redout_89326 = 0.0;
        redout_89327 = 0.0;
        redout_89328 = 0.0;
        redout_89329 = 0.0;
        redout_89330 = 0.0;
        for (int64_t i_89334 = 0; i_89334 < m_34815; i_89334++) {
            for (int64_t i_89310 = 0; i_89310 < m_34815; i_89310++) {
                double defunc_0_reduce_res_80199;
                double redout_89306 = 0.0;
                
                for (int64_t i_89307 = 0; i_89307 < m_34815; i_89307++) {
                    double eta_p_67979 = ((double *) mem_89415)[eta_p_52628 * lmad_arg_89421 + i_89334 * m_34815 + i_89307];
                    double eta_p_67980 = ((double *) ext_mem_90820.mem)[i_89307 * m_34815 + i_89310];
                    double zt_res_67981 = eta_p_67979 * eta_p_67980;
                    double zp_res_58074 = zt_res_67981 + redout_89306;
                    double redout_tmp_91627 = zp_res_58074;
                    
                    redout_89306 = redout_tmp_91627;
                }
                defunc_0_reduce_res_80199 = redout_89306;
                ((double *) mem_90839)[i_89310] = defunc_0_reduce_res_80199;
            }
            
            double defunc_res_80202;
            double defunc_0_reduce_res_80203;
            double defunc_res_80204;
            double defunc_res_80205;
            double defunc_res_80206;
            double defunc_res_80207;
            double defunc_res_80208;
            double defunc_res_80209;
            double redout_89314;
            double redout_89315;
            double redout_89316;
            double redout_89317;
            double redout_89318;
            double redout_89319;
            double redout_89320;
            double redout_89321;
            
            redout_89314 = 0.0;
            redout_89315 = 0.0;
            redout_89316 = 0.0;
            redout_89317 = 0.0;
            redout_89318 = 0.0;
            redout_89319 = 0.0;
            redout_89320 = 0.0;
            redout_89321 = 0.0;
            for (int64_t i_89322 = 0; i_89322 < m_34815; i_89322++) {
                double x_67939 = ((double *) ext_mem_90820.mem)[i_89334 * m_34815 + i_89322];
                double defunc_0_reduce_res_80200;
                double redout_89312 = 0.0;
                
                for (int64_t i_89313 = 0; i_89313 < m_34815; i_89313++) {
                    double eta_p_67973 = ((double *) mem_90839)[i_89313];
                    double eta_p_67974 = ((double *) mem_89415)[eta_p_52629 * lmad_arg_89421 + i_89313 * m_34815 + i_89322];
                    double zt_res_67975 = eta_p_67973 * eta_p_67974;
                    double zp_res_67956 = zt_res_67975 + redout_89312;
                    double redout_tmp_91636 = zp_res_67956;
                    
                    redout_89312 = redout_tmp_91636;
                }
                defunc_0_reduce_res_80200 = redout_89312;
                
                double zt_res_67958 = x_67939 * defunc_0_reduce_res_80200;
                bool zeze_res_67960 = x_67939 == 0.0;
                double klu_res_67961;
                
                if (zeze_res_67960) {
                    klu_res_67961 = 0.0;
                } else {
                    double zs_res_67962 = x_67939 / zt_res_52646;
                    double log_res_67963 = futrts_log64(zs_res_67962);
                    double zt_res_67964 = x_67939 * log_res_67963;
                    
                    klu_res_67961 = zt_res_67964;
                }
                
                double klu_res_67967;
                
                if (zeze_res_67960) {
                    klu_res_67967 = 0.0;
                } else {
                    double zs_res_67968 = x_67939 / zt_res_52646;
                    double log_res_67969 = futrts_log64(zs_res_67968);
                    double zt_res_67970 = x_67939 * log_res_67969;
                    
                    klu_res_67967 = zt_res_67970;
                }
                
                double zp_res_58062 = x_67939 + redout_89314;
                double zp_res_58096 = zt_res_67958 + redout_89315;
                double zp_res_58103 = x_67939 + redout_89316;
                double zp_res_58110 = x_67939 + redout_89317;
                double zp_res_58118 = x_67939 + redout_89318;
                double zp_res_58133 = klu_res_67961 + redout_89319;
                double zp_res_58148 = klu_res_67967 + redout_89320;
                double zp_res_58156 = x_67939 + redout_89321;
                double redout_tmp_91628 = zp_res_58062;
                double redout_tmp_91629 = zp_res_58096;
                double redout_tmp_91630 = zp_res_58103;
                double redout_tmp_91631 = zp_res_58110;
                double redout_tmp_91632 = zp_res_58118;
                double redout_tmp_91633 = zp_res_58133;
                double redout_tmp_91634 = zp_res_58148;
                double redout_tmp_91635 = zp_res_58156;
                
                redout_89314 = redout_tmp_91628;
                redout_89315 = redout_tmp_91629;
                redout_89316 = redout_tmp_91630;
                redout_89317 = redout_tmp_91631;
                redout_89318 = redout_tmp_91632;
                redout_89319 = redout_tmp_91633;
                redout_89320 = redout_tmp_91634;
                redout_89321 = redout_tmp_91635;
            }
            defunc_res_80202 = redout_89314;
            defunc_0_reduce_res_80203 = redout_89315;
            defunc_res_80204 = redout_89316;
            defunc_res_80205 = redout_89317;
            defunc_res_80206 = redout_89318;
            defunc_res_80207 = redout_89319;
            defunc_res_80208 = redout_89320;
            defunc_res_80209 = redout_89321;
            
            double zp_res_55540 = defunc_0_reduce_res_80203 + redout_89326;
            double zp_res_55635 = defunc_res_80205 + redout_89327;
            double zp_res_55647 = defunc_res_80206 + redout_89328;
            double zp_res_55681 = defunc_res_80207 + redout_89329;
            double zp_res_55704 = defunc_res_80208 + redout_89330;
            
            ((double *) mem_90824)[i_89334] = defunc_res_80209;
            ((double *) mem_90826)[i_89334] = defunc_res_80204;
            ((double *) mem_90828)[i_89334] = defunc_res_80202;
            
            double redout_tmp_91618 = zp_res_55540;
            double redout_tmp_91619 = zp_res_55635;
            double redout_tmp_91620 = zp_res_55647;
            double redout_tmp_91621 = zp_res_55681;
            double redout_tmp_91622 = zp_res_55704;
            
            redout_89326 = redout_tmp_91618;
            redout_89327 = redout_tmp_91619;
            redout_89328 = redout_tmp_91620;
            redout_89329 = redout_tmp_91621;
            redout_89330 = redout_tmp_91622;
        }
        defunc_res_80273 = redout_89326;
        defunc_res_80274 = redout_89327;
        defunc_res_80275 = redout_89328;
        defunc_res_80276 = redout_89329;
        defunc_res_80277 = redout_89330;
        for (int64_t i_89348 = 0; i_89348 < m_34815; i_89348++) {
            double defunc_res_80210;
            double defunc_res_80211;
            double defunc_res_80212;
            double redout_89338;
            double redout_89339;
            double redout_89340;
            
            redout_89338 = 0.0;
            redout_89339 = 0.0;
            redout_89340 = 0.0;
            for (int64_t i_89341 = 0; i_89341 < m_34815; i_89341++) {
                double x_68000 = ((double *) ext_mem_90820.mem)[i_89341 * m_34815 + i_89348];
                double zp_res_58180 = x_68000 + redout_89338;
                double zp_res_58186 = x_68000 + redout_89339;
                double zp_res_58193 = x_68000 + redout_89340;
                double redout_tmp_91640 = zp_res_58180;
                double redout_tmp_91641 = zp_res_58186;
                double redout_tmp_91642 = zp_res_58193;
                
                redout_89338 = redout_tmp_91640;
                redout_89339 = redout_tmp_91641;
                redout_89340 = redout_tmp_91642;
            }
            defunc_res_80210 = redout_89338;
            defunc_res_80211 = redout_89339;
            defunc_res_80212 = redout_89340;
            ((double *) mem_90856)[i_89348] = defunc_res_80212;
            ((double *) mem_90858)[i_89348] = defunc_res_80211;
            ((double *) mem_90860)[i_89348] = defunc_res_80210;
        }
        if (memblock_unref(ctx, &ext_mem_90820, "ext_mem_90820") != 0)
            return 1;
        
        double defunc_0_reduce_res_80284;
        double redout_89354 = 0.0;
        
        for (int64_t i_89355 = 0; i_89355 < m_34815; i_89355++) {
            double eta_p_56149 = ((double *) mem_90828)[i_89355];
            double defunc_0_reduce_res_80213;
            double redout_89352 = 0.0;
            
            for (int64_t i_89353 = 0; i_89353 < m_34815; i_89353++) {
                double eta_p_68012 = ((double *) mem_89415)[eta_p_52628 * lmad_arg_89421 + i_89355 * m_34815 + i_89353];
                double eta_p_68013 = ((double *) mem_90828)[i_89353];
                double zt_res_68015 = eta_p_68012 * eta_p_68012;
                double zt_res_68017 = eta_p_68013 * zt_res_68015;
                double zp_res_56162 = zt_res_68017 + redout_89352;
                double redout_tmp_91644 = zp_res_56162;
                
                redout_89352 = redout_tmp_91644;
            }
            defunc_0_reduce_res_80213 = redout_89352;
            
            double zt_res_56164 = eta_p_56149 * defunc_0_reduce_res_80213;
            double zp_res_55473 = zt_res_56164 + redout_89354;
            double redout_tmp_91643 = zp_res_55473;
            
            redout_89354 = redout_tmp_91643;
        }
        defunc_0_reduce_res_80284 = redout_89354;
        
        double defunc_0_reduce_res_80285;
        double redout_89358 = 0.0;
        
        for (int64_t i_89359 = 0; i_89359 < m_34815; i_89359++) {
            double eta_p_56125 = ((double *) mem_90860)[i_89359];
            double defunc_0_reduce_res_80214;
            double redout_89356 = 0.0;
            
            for (int64_t i_89357 = 0; i_89357 < m_34815; i_89357++) {
                double eta_p_68026 = ((double *) mem_89415)[eta_p_52629 * lmad_arg_89421 + i_89359 * m_34815 + i_89357];
                double eta_p_68027 = ((double *) mem_90860)[i_89357];
                double zt_res_68029 = eta_p_68026 * eta_p_68026;
                double zt_res_68031 = eta_p_68027 * zt_res_68029;
                double zp_res_56138 = zt_res_68031 + redout_89356;
                double redout_tmp_91646 = zp_res_56138;
                
                redout_89356 = redout_tmp_91646;
            }
            defunc_0_reduce_res_80214 = redout_89356;
            
            double zt_res_56140 = eta_p_56125 * defunc_0_reduce_res_80214;
            double zp_res_55497 = zt_res_56140 + redout_89358;
            double redout_tmp_91645 = zp_res_55497;
            
            redout_89358 = redout_tmp_91645;
        }
        defunc_0_reduce_res_80285 = redout_89358;
        
        double zt_res_55541 = -2.0 * defunc_res_80273;
        double zp_res_55542 = zt_res_55541 + defunc_0_reduce_res_80284;
        double zp_res_55543 = zp_res_55542 + defunc_0_reduce_res_80285;
        double defunc_res_80286;
        double redout_89362 = 0.0;
        
        for (int64_t i_89363 = 0; i_89363 < m_34815; i_89363++) {
            double eta_p_56023 = ((double *) mem_90826)[i_89363];
            double defunc_res_80215;
            double redout_89360 = 0.0;
            
            for (int64_t i_89361 = 0; i_89361 < m_34815; i_89361++) {
                double eta_p_68045 = ((double *) mem_90826)[i_89361];
                double zt_res_68046 = eta_p_56023 * eta_p_68045;
                bool zeze_res_68048 = zt_res_68046 == 0.0;
                double kl_res_68049;
                
                if (zeze_res_68048) {
                    kl_res_68049 = zt_res_52646;
                } else {
                    double zs_res_68050 = zt_res_68046 / zt_res_52646;
                    double log_res_68051 = futrts_log64(zs_res_68050);
                    double zt_res_68052 = zt_res_68046 * log_res_68051;
                    double zm_res_68053 = zt_res_68052 - zt_res_68046;
                    double zp_res_68054 = zt_res_52646 + zm_res_68053;
                    
                    kl_res_68049 = zp_res_68054;
                }
                
                double zp_res_56041 = kl_res_68049 + redout_89360;
                double redout_tmp_91648 = zp_res_56041;
                
                redout_89360 = redout_tmp_91648;
            }
            defunc_res_80215 = redout_89360;
            
            double zp_res_55583 = defunc_res_80215 + redout_89362;
            double redout_tmp_91647 = zp_res_55583;
            
            redout_89362 = redout_tmp_91647;
        }
        defunc_res_80286 = redout_89362;
        
        double defunc_res_80287;
        double redout_89366 = 0.0;
        
        for (int64_t i_89367 = 0; i_89367 < m_34815; i_89367++) {
            double eta_p_55985 = ((double *) mem_90858)[i_89367];
            double defunc_res_80216;
            double redout_89364 = 0.0;
            
            for (int64_t i_89365 = 0; i_89365 < m_34815; i_89365++) {
                double eta_p_68068 = ((double *) mem_90858)[i_89365];
                double zt_res_68069 = eta_p_55985 * eta_p_68068;
                bool zeze_res_68071 = zt_res_68069 == 0.0;
                double kl_res_68072;
                
                if (zeze_res_68071) {
                    kl_res_68072 = zt_res_52646;
                } else {
                    double zs_res_68073 = zt_res_68069 / zt_res_52646;
                    double log_res_68074 = futrts_log64(zs_res_68073);
                    double zt_res_68075 = zt_res_68069 * log_res_68074;
                    double zm_res_68076 = zt_res_68075 - zt_res_68069;
                    double zp_res_68077 = zt_res_52646 + zm_res_68076;
                    
                    kl_res_68072 = zp_res_68077;
                }
                
                double zp_res_56003 = kl_res_68072 + redout_89364;
                double redout_tmp_91650 = zp_res_56003;
                
                redout_89364 = redout_tmp_91650;
            }
            defunc_res_80216 = redout_89364;
            
            double zp_res_55623 = defunc_res_80216 + redout_89366;
            double redout_tmp_91649 = zp_res_55623;
            
            redout_89366 = redout_tmp_91649;
        }
        defunc_res_80287 = redout_89366;
        
        double zt_res_55658 = defunc_res_80271 * defunc_res_80272;
        double zt_res_55659 = zt_res_55658 * zt_res_55658;
        double zt_res_55682 = defunc_res_80275 * defunc_res_80276;
        double zt_res_55705 = defunc_res_80274 * defunc_res_80277;
        double zp_res_55706 = zt_res_55682 + zt_res_55705;
        double zp_res_55707 = zt_res_55659 + zp_res_55706;
        double zt_res_55708 = defunc_res_80274 * defunc_res_80275;
        double zm_res_55709 = zp_res_55707 - zt_res_55708;
        double defunc_res_80288;
        double redout_89370 = 0.0;
        
        for (int64_t i_89371 = 0; i_89371 < m_34815; i_89371++) {
            double eta_p_55901 = ((double *) mem_90824)[i_89371];
            double defunc_res_80217;
            double redout_89368 = 0.0;
            
            for (int64_t i_89369 = 0; i_89369 < m_34815; i_89369++) {
                double eta_p_68091 = ((double *) mem_90824)[i_89369];
                double zt_res_68092 = eta_p_55901 * eta_p_68091;
                bool zeze_res_68094 = zt_res_68092 == 0.0;
                double kl_res_68095;
                
                if (zeze_res_68094) {
                    kl_res_68095 = zt_res_52646;
                } else {
                    double zs_res_68096 = zt_res_68092 / zt_res_52646;
                    double log_res_68097 = futrts_log64(zs_res_68096);
                    double zt_res_68098 = zt_res_68092 * log_res_68097;
                    double zm_res_68099 = zt_res_68098 - zt_res_68092;
                    double zp_res_68100 = zt_res_52646 + zm_res_68099;
                    
                    kl_res_68095 = zp_res_68100;
                }
                
                double zp_res_55919 = kl_res_68095 + redout_89368;
                double redout_tmp_91652 = zp_res_55919;
                
                redout_89368 = redout_tmp_91652;
            }
            defunc_res_80217 = redout_89368;
            
            double zp_res_55744 = defunc_res_80217 + redout_89370;
            double redout_tmp_91651 = zp_res_55744;
            
            redout_89370 = redout_tmp_91651;
        }
        defunc_res_80288 = redout_89370;
        
        double zt_res_55745 = rho1_34817 * defunc_res_80288;
        double zp_res_55746 = zp_res_55543 + zt_res_55745;
        double defunc_res_80289;
        double redout_89374 = 0.0;
        
        for (int64_t i_89375 = 0; i_89375 < m_34815; i_89375++) {
            double eta_p_55863 = ((double *) mem_90856)[i_89375];
            double defunc_res_80218;
            double redout_89372 = 0.0;
            
            for (int64_t i_89373 = 0; i_89373 < m_34815; i_89373++) {
                double eta_p_68114 = ((double *) mem_90856)[i_89373];
                double zt_res_68115 = eta_p_55863 * eta_p_68114;
                bool zeze_res_68117 = zt_res_68115 == 0.0;
                double kl_res_68118;
                
                if (zeze_res_68117) {
                    kl_res_68118 = zt_res_52646;
                } else {
                    double zs_res_68119 = zt_res_68115 / zt_res_52646;
                    double log_res_68120 = futrts_log64(zs_res_68119);
                    double zt_res_68121 = zt_res_68115 * log_res_68120;
                    double zm_res_68122 = zt_res_68121 - zt_res_68115;
                    double zp_res_68123 = zt_res_52646 + zm_res_68122;
                    
                    kl_res_68118 = zp_res_68123;
                }
                
                double zp_res_55881 = kl_res_68118 + redout_89372;
                double redout_tmp_91654 = zp_res_55881;
                
                redout_89372 = redout_tmp_91654;
            }
            defunc_res_80218 = redout_89372;
            
            double zp_res_55781 = defunc_res_80218 + redout_89374;
            double redout_tmp_91653 = zp_res_55781;
            
            redout_89374 = redout_tmp_91653;
        }
        defunc_res_80289 = redout_89374;
        
        double zt_res_55782 = rho2_34818 * defunc_res_80289;
        double zp_res_55783 = zp_res_55746 + zt_res_55782;
        double fma_res_55784 = futrts_fma64(zm_res_55709, eps_34819, zp_res_55783);
        
        ((double *) mem_89452.mem)[i_89378 * (int64_t) 5] = zp_res_55543;
        ((double *) mem_89452.mem)[i_89378 * (int64_t) 5 + (int64_t) 1] = defunc_res_80286;
        ((double *) mem_89452.mem)[i_89378 * (int64_t) 5 + (int64_t) 2] = defunc_res_80287;
        ((double *) mem_89452.mem)[i_89378 * (int64_t) 5 + (int64_t) 3] = zm_res_55709;
        ((double *) mem_89452.mem)[i_89378 * (int64_t) 5 + (int64_t) 4] = fma_res_55784;
    }
    if (memblock_unref(ctx, &ext_mem_89446, "ext_mem_89446") != 0)
        return 1;
    if (memblock_unref(ctx, &ext_mem_89447, "ext_mem_89447") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89449, "mem_89449") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89485, "mem_89485") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89533, "mem_89533") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89544, "mem_89544") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89568, "mem_89568") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89576, "mem_89576") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89852, "mem_89852") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89947, "mem_89947") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89949, "mem_89949") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89952, "mem_89952") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89982, "mem_89982") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89984, "mem_89984") != 0)
        return 1;
    if (memblock_set(ctx, &mem_out_91249, &mem_89452, "mem_89452") != 0)
        return 1;
    prim_out_91250 = zbzg_lhs_52612;
    if (memblock_set(ctx, &*mem_out_p_91711, &mem_out_91249, "mem_out_91249") != 0)
        return 1;
    *out_prim_out_91712 = prim_out_91250;
    
  cleanup:
    {
        free(mem_89415);
        free(mem_89458);
        free(mem_89460);
        free(mem_89474);
        free(mem_89483);
        free(mem_89494);
        free(mem_89496);
        free(mem_89510);
        free(mem_89541);
        free(mem_89833);
        free(mem_89880);
        free(mem_89888);
        free(mem_89896);
        free(mem_89905);
        free(mem_89907);
        free(mem_89916);
        free(mem_89924);
        free(mem_90555);
        free(mem_90592);
        free(mem_90594);
        free(mem_90609);
        free(mem_90621);
        free(mem_90623);
        free(mem_90637);
        free(mem_90645);
        free(mem_90648);
        free(mem_90664);
        free(mem_90699);
        free(mem_90707);
        free(mem_90719);
        free(mem_90722);
        free(mem_90765);
        free(mem_90773);
        free(mem_90824);
        free(mem_90826);
        free(mem_90828);
        free(mem_90839);
        free(mem_90856);
        free(mem_90858);
        free(mem_90860);
        if (memblock_unref(ctx, &mem_param_tmp_91374, "mem_param_tmp_91374") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91373, "mem_param_tmp_91373") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91372, "mem_param_tmp_91372") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90590, "mem_90590") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90587, "mem_90587") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90786, "mem_90786") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91580, "mem_param_tmp_91580") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90725, "mem_90725") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90717, "mem_param_90717") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90783, "ext_mem_90783") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90651, "mem_90651") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90806, "ext_mem_90806") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90809, "ext_mem_90809") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90812, "ext_mem_90812") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90557, "mem_90557") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90552, "mem_90552") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91494, "mem_param_tmp_91494") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91493, "mem_param_tmp_91493") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91492, "mem_param_tmp_91492") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91491, "mem_param_tmp_91491") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91490, "mem_param_tmp_91490") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90487, "mem_90487") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90498, "ext_mem_90498") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90475, "mem_90475") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90472, "mem_90472") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90470, "mem_90470") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90512, "ext_mem_90512") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90515, "ext_mem_90515") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90518, "ext_mem_90518") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90437, "mem_90437") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90448, "ext_mem_90448") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90425, "mem_90425") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90422, "mem_90422") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90420, "mem_90420") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90462, "ext_mem_90462") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90465, "ext_mem_90465") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90468, "ext_mem_90468") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90412, "mem_90412") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90404, "mem_90404") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90402, "mem_param_90402") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90399, "mem_param_90399") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90396, "mem_param_90396") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90393, "mem_param_90393") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90390, "mem_param_90390") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90530, "ext_mem_90530") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90531, "ext_mem_90531") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90532, "ext_mem_90532") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90533, "ext_mem_90533") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90534, "ext_mem_90534") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90355, "mem_90355") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90366, "ext_mem_90366") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90343, "mem_90343") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90340, "mem_90340") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90338, "mem_90338") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90380, "ext_mem_90380") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90383, "ext_mem_90383") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90386, "ext_mem_90386") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90305, "mem_90305") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90316, "ext_mem_90316") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90293, "mem_90293") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90290, "mem_90290") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90288, "mem_90288") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90330, "ext_mem_90330") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90333, "ext_mem_90333") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90336, "ext_mem_90336") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90280, "mem_90280") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90272, "mem_90272") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90537, "ext_mem_90537") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90540, "ext_mem_90540") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90543, "ext_mem_90543") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90546, "ext_mem_90546") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90550, "ext_mem_90550") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91436, "mem_param_tmp_91436") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91435, "mem_param_tmp_91435") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91434, "mem_param_tmp_91434") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91433, "mem_param_tmp_91433") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91432, "mem_param_tmp_91432") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91431, "mem_param_tmp_91431") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91430, "mem_param_tmp_91430") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91429, "mem_param_tmp_91429") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91428, "mem_param_tmp_91428") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90210, "mem_90210") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90221, "ext_mem_90221") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90198, "mem_90198") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90195, "mem_90195") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90193, "mem_90193") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90235, "ext_mem_90235") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90238, "ext_mem_90238") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90241, "ext_mem_90241") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90160, "mem_90160") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90171, "ext_mem_90171") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90148, "mem_90148") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90145, "mem_90145") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90143, "mem_90143") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90185, "ext_mem_90185") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90188, "ext_mem_90188") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90191, "ext_mem_90191") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90135, "mem_90135") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90127, "mem_90127") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90125, "mem_param_90125") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90122, "mem_param_90122") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90119, "mem_param_90119") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90116, "mem_param_90116") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90113, "mem_param_90113") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90109, "mem_param_90109") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90106, "mem_param_90106") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90103, "mem_param_90103") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90100, "mem_param_90100") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90262, "ext_mem_90262") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90263, "ext_mem_90263") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90264, "ext_mem_90264") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90265, "ext_mem_90265") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90266, "ext_mem_90266") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90267, "ext_mem_90267") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90268, "ext_mem_90268") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90269, "ext_mem_90269") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90270, "ext_mem_90270") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90065, "mem_90065") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90076, "ext_mem_90076") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90053, "mem_90053") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90050, "mem_90050") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90048, "mem_90048") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90090, "ext_mem_90090") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90093, "ext_mem_90093") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90096, "ext_mem_90096") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90015, "mem_90015") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90026, "ext_mem_90026") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90003, "mem_90003") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90000, "mem_90000") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89998, "mem_89998") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90040, "ext_mem_90040") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90043, "ext_mem_90043") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90046, "ext_mem_90046") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89878, "mem_param_89878") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89874, "mem_param_89874") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89871, "mem_param_89871") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90820, "ext_mem_90820") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90821, "ext_mem_90821") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90822, "ext_mem_90822") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91323, "mem_param_tmp_91323") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91322, "mem_param_tmp_91322") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91321, "mem_param_tmp_91321") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91320, "mem_param_tmp_91320") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91319, "mem_param_tmp_91319") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89783, "mem_89783") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89794, "ext_mem_89794") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89771, "mem_89771") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89768, "mem_89768") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89766, "mem_89766") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89808, "ext_mem_89808") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89811, "ext_mem_89811") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89814, "ext_mem_89814") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89733, "mem_89733") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89744, "ext_mem_89744") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89721, "mem_89721") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89718, "mem_89718") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89716, "mem_89716") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89758, "ext_mem_89758") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89761, "ext_mem_89761") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89764, "ext_mem_89764") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89708, "mem_89708") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89700, "mem_89700") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89698, "mem_param_89698") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89695, "mem_param_89695") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89692, "mem_param_89692") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89689, "mem_param_89689") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89686, "mem_param_89686") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89826, "ext_mem_89826") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89827, "ext_mem_89827") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89828, "ext_mem_89828") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89829, "ext_mem_89829") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89830, "ext_mem_89830") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89651, "mem_89651") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89662, "ext_mem_89662") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89639, "mem_89639") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89636, "mem_89636") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89634, "mem_89634") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89676, "ext_mem_89676") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89679, "ext_mem_89679") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89682, "ext_mem_89682") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89601, "mem_89601") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89612, "ext_mem_89612") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89589, "mem_89589") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89586, "mem_89586") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89584, "mem_89584") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89626, "ext_mem_89626") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89629, "ext_mem_89629") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89632, "ext_mem_89632") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89984, "mem_89984") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89982, "mem_89982") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89952, "mem_89952") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89949, "mem_89949") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89947, "mem_89947") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89852, "mem_89852") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89576, "mem_89576") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89568, "mem_89568") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89544, "mem_89544") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89533, "mem_89533") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89485, "mem_89485") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89452, "mem_89452") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89449, "mem_89449") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89446, "ext_mem_89446") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89447, "ext_mem_89447") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_out_91249, "mem_out_91249") != 0)
            return 1;
    }
    return err;
}
FUTHARK_FUN_ATTR int futrts_entry_ugw_armijo_pairwise(struct futhark_context *ctx, struct memblock *mem_out_p_91753, int64_t *out_prim_out_91754, struct memblock A_mem_89411, struct memblock distrs_mem_89412, int64_t k_33637, int64_t m_33638, double rho1_33639, double rho2_33640, double eps_33641, double exp_absorb_cutoff_33644, double safe_for_exp_33645, double tol_sinkhorn_33646, double tol_outerloop_33647)
{
    (void) ctx;
    
    int err = 0;
    int64_t mem_89425_cached_sizze_91755 = 0;
    unsigned char *mem_89425 = NULL;
    int64_t mem_89427_cached_sizze_91756 = 0;
    unsigned char *mem_89427 = NULL;
    int64_t mem_89430_cached_sizze_91757 = 0;
    unsigned char *mem_89430 = NULL;
    int64_t mem_89460_cached_sizze_91758 = 0;
    unsigned char *mem_89460 = NULL;
    int64_t mem_89462_cached_sizze_91759 = 0;
    unsigned char *mem_89462 = NULL;
    int64_t mem_89464_cached_sizze_91760 = 0;
    unsigned char *mem_89464 = NULL;
    int64_t mem_89484_cached_sizze_91761 = 0;
    unsigned char *mem_89484 = NULL;
    int64_t mem_89493_cached_sizze_91762 = 0;
    unsigned char *mem_89493 = NULL;
    int64_t mem_89504_cached_sizze_91763 = 0;
    unsigned char *mem_89504 = NULL;
    int64_t mem_89506_cached_sizze_91764 = 0;
    unsigned char *mem_89506 = NULL;
    int64_t mem_89520_cached_sizze_91765 = 0;
    unsigned char *mem_89520 = NULL;
    int64_t mem_89551_cached_sizze_91766 = 0;
    unsigned char *mem_89551 = NULL;
    int64_t mem_89843_cached_sizze_91767 = 0;
    unsigned char *mem_89843 = NULL;
    int64_t mem_89890_cached_sizze_91768 = 0;
    unsigned char *mem_89890 = NULL;
    int64_t mem_89898_cached_sizze_91769 = 0;
    unsigned char *mem_89898 = NULL;
    int64_t mem_89900_cached_sizze_91770 = 0;
    unsigned char *mem_89900 = NULL;
    int64_t mem_89914_cached_sizze_91771 = 0;
    unsigned char *mem_89914 = NULL;
    int64_t mem_89923_cached_sizze_91772 = 0;
    unsigned char *mem_89923 = NULL;
    int64_t mem_89925_cached_sizze_91773 = 0;
    unsigned char *mem_89925 = NULL;
    int64_t mem_89934_cached_sizze_91774 = 0;
    unsigned char *mem_89934 = NULL;
    int64_t mem_89942_cached_sizze_91775 = 0;
    unsigned char *mem_89942 = NULL;
    int64_t mem_90573_cached_sizze_91776 = 0;
    unsigned char *mem_90573 = NULL;
    int64_t mem_90610_cached_sizze_91777 = 0;
    unsigned char *mem_90610 = NULL;
    int64_t mem_90612_cached_sizze_91778 = 0;
    unsigned char *mem_90612 = NULL;
    int64_t mem_90614_cached_sizze_91779 = 0;
    unsigned char *mem_90614 = NULL;
    int64_t mem_90635_cached_sizze_91780 = 0;
    unsigned char *mem_90635 = NULL;
    int64_t mem_90647_cached_sizze_91781 = 0;
    unsigned char *mem_90647 = NULL;
    int64_t mem_90649_cached_sizze_91782 = 0;
    unsigned char *mem_90649 = NULL;
    int64_t mem_90663_cached_sizze_91783 = 0;
    unsigned char *mem_90663 = NULL;
    int64_t mem_90671_cached_sizze_91784 = 0;
    unsigned char *mem_90671 = NULL;
    int64_t mem_90674_cached_sizze_91785 = 0;
    unsigned char *mem_90674 = NULL;
    int64_t mem_90690_cached_sizze_91786 = 0;
    unsigned char *mem_90690 = NULL;
    int64_t mem_90725_cached_sizze_91787 = 0;
    unsigned char *mem_90725 = NULL;
    int64_t mem_90733_cached_sizze_91788 = 0;
    unsigned char *mem_90733 = NULL;
    int64_t mem_90745_cached_sizze_91789 = 0;
    unsigned char *mem_90745 = NULL;
    int64_t mem_90748_cached_sizze_91790 = 0;
    unsigned char *mem_90748 = NULL;
    int64_t mem_90791_cached_sizze_91791 = 0;
    unsigned char *mem_90791 = NULL;
    int64_t mem_90799_cached_sizze_91792 = 0;
    unsigned char *mem_90799 = NULL;
    int64_t mem_90850_cached_sizze_91793 = 0;
    unsigned char *mem_90850 = NULL;
    int64_t mem_90852_cached_sizze_91794 = 0;
    unsigned char *mem_90852 = NULL;
    int64_t mem_90854_cached_sizze_91795 = 0;
    unsigned char *mem_90854 = NULL;
    int64_t mem_90865_cached_sizze_91796 = 0;
    unsigned char *mem_90865 = NULL;
    int64_t mem_90882_cached_sizze_91797 = 0;
    unsigned char *mem_90882 = NULL;
    int64_t mem_90884_cached_sizze_91798 = 0;
    unsigned char *mem_90884 = NULL;
    int64_t mem_90886_cached_sizze_91799 = 0;
    unsigned char *mem_90886 = NULL;
    struct memblock mem_param_tmp_91371;
    
    mem_param_tmp_91371.references = NULL;
    
    struct memblock mem_param_tmp_91370;
    
    mem_param_tmp_91370.references = NULL;
    
    struct memblock mem_param_tmp_91369;
    
    mem_param_tmp_91369.references = NULL;
    
    struct memblock mem_90608;
    
    mem_90608.references = NULL;
    
    struct memblock mem_90605;
    
    mem_90605.references = NULL;
    
    struct memblock mem_90812;
    
    mem_90812.references = NULL;
    
    struct memblock mem_param_tmp_91583;
    
    mem_param_tmp_91583.references = NULL;
    
    struct memblock mem_90751;
    
    mem_90751.references = NULL;
    
    struct memblock mem_param_90743;
    
    mem_param_90743.references = NULL;
    
    struct memblock ext_mem_90809;
    
    ext_mem_90809.references = NULL;
    
    struct memblock mem_90677;
    
    mem_90677.references = NULL;
    
    struct memblock ext_mem_90832;
    
    ext_mem_90832.references = NULL;
    
    struct memblock ext_mem_90835;
    
    ext_mem_90835.references = NULL;
    
    struct memblock ext_mem_90838;
    
    ext_mem_90838.references = NULL;
    
    struct memblock mem_90575;
    
    mem_90575.references = NULL;
    
    struct memblock mem_90570;
    
    mem_90570.references = NULL;
    
    struct memblock mem_param_tmp_91492;
    
    mem_param_tmp_91492.references = NULL;
    
    struct memblock mem_param_tmp_91491;
    
    mem_param_tmp_91491.references = NULL;
    
    struct memblock mem_param_tmp_91490;
    
    mem_param_tmp_91490.references = NULL;
    
    struct memblock mem_param_tmp_91489;
    
    mem_param_tmp_91489.references = NULL;
    
    struct memblock mem_param_tmp_91488;
    
    mem_param_tmp_91488.references = NULL;
    
    struct memblock mem_90505;
    
    mem_90505.references = NULL;
    
    struct memblock ext_mem_90516;
    
    ext_mem_90516.references = NULL;
    
    struct memblock mem_90493;
    
    mem_90493.references = NULL;
    
    struct memblock mem_90490;
    
    mem_90490.references = NULL;
    
    struct memblock mem_90488;
    
    mem_90488.references = NULL;
    
    struct memblock ext_mem_90530;
    
    ext_mem_90530.references = NULL;
    
    struct memblock ext_mem_90533;
    
    ext_mem_90533.references = NULL;
    
    struct memblock ext_mem_90536;
    
    ext_mem_90536.references = NULL;
    
    struct memblock mem_90455;
    
    mem_90455.references = NULL;
    
    struct memblock ext_mem_90466;
    
    ext_mem_90466.references = NULL;
    
    struct memblock mem_90443;
    
    mem_90443.references = NULL;
    
    struct memblock mem_90440;
    
    mem_90440.references = NULL;
    
    struct memblock mem_90438;
    
    mem_90438.references = NULL;
    
    struct memblock ext_mem_90480;
    
    ext_mem_90480.references = NULL;
    
    struct memblock ext_mem_90483;
    
    ext_mem_90483.references = NULL;
    
    struct memblock ext_mem_90486;
    
    ext_mem_90486.references = NULL;
    
    struct memblock mem_90430;
    
    mem_90430.references = NULL;
    
    struct memblock mem_90422;
    
    mem_90422.references = NULL;
    
    struct memblock mem_param_90420;
    
    mem_param_90420.references = NULL;
    
    struct memblock mem_param_90417;
    
    mem_param_90417.references = NULL;
    
    struct memblock mem_param_90414;
    
    mem_param_90414.references = NULL;
    
    struct memblock mem_param_90411;
    
    mem_param_90411.references = NULL;
    
    struct memblock mem_param_90408;
    
    mem_param_90408.references = NULL;
    
    struct memblock ext_mem_90548;
    
    ext_mem_90548.references = NULL;
    
    struct memblock ext_mem_90549;
    
    ext_mem_90549.references = NULL;
    
    struct memblock ext_mem_90550;
    
    ext_mem_90550.references = NULL;
    
    struct memblock ext_mem_90551;
    
    ext_mem_90551.references = NULL;
    
    struct memblock ext_mem_90552;
    
    ext_mem_90552.references = NULL;
    
    struct memblock mem_90373;
    
    mem_90373.references = NULL;
    
    struct memblock ext_mem_90384;
    
    ext_mem_90384.references = NULL;
    
    struct memblock mem_90361;
    
    mem_90361.references = NULL;
    
    struct memblock mem_90358;
    
    mem_90358.references = NULL;
    
    struct memblock mem_90356;
    
    mem_90356.references = NULL;
    
    struct memblock ext_mem_90398;
    
    ext_mem_90398.references = NULL;
    
    struct memblock ext_mem_90401;
    
    ext_mem_90401.references = NULL;
    
    struct memblock ext_mem_90404;
    
    ext_mem_90404.references = NULL;
    
    struct memblock mem_90323;
    
    mem_90323.references = NULL;
    
    struct memblock ext_mem_90334;
    
    ext_mem_90334.references = NULL;
    
    struct memblock mem_90311;
    
    mem_90311.references = NULL;
    
    struct memblock mem_90308;
    
    mem_90308.references = NULL;
    
    struct memblock mem_90306;
    
    mem_90306.references = NULL;
    
    struct memblock ext_mem_90348;
    
    ext_mem_90348.references = NULL;
    
    struct memblock ext_mem_90351;
    
    ext_mem_90351.references = NULL;
    
    struct memblock ext_mem_90354;
    
    ext_mem_90354.references = NULL;
    
    struct memblock mem_90298;
    
    mem_90298.references = NULL;
    
    struct memblock mem_90290;
    
    mem_90290.references = NULL;
    
    struct memblock ext_mem_90555;
    
    ext_mem_90555.references = NULL;
    
    struct memblock ext_mem_90558;
    
    ext_mem_90558.references = NULL;
    
    struct memblock ext_mem_90561;
    
    ext_mem_90561.references = NULL;
    
    struct memblock ext_mem_90564;
    
    ext_mem_90564.references = NULL;
    
    struct memblock ext_mem_90568;
    
    ext_mem_90568.references = NULL;
    
    struct memblock mem_param_tmp_91434;
    
    mem_param_tmp_91434.references = NULL;
    
    struct memblock mem_param_tmp_91433;
    
    mem_param_tmp_91433.references = NULL;
    
    struct memblock mem_param_tmp_91432;
    
    mem_param_tmp_91432.references = NULL;
    
    struct memblock mem_param_tmp_91431;
    
    mem_param_tmp_91431.references = NULL;
    
    struct memblock mem_param_tmp_91430;
    
    mem_param_tmp_91430.references = NULL;
    
    struct memblock mem_param_tmp_91429;
    
    mem_param_tmp_91429.references = NULL;
    
    struct memblock mem_param_tmp_91428;
    
    mem_param_tmp_91428.references = NULL;
    
    struct memblock mem_param_tmp_91427;
    
    mem_param_tmp_91427.references = NULL;
    
    struct memblock mem_param_tmp_91426;
    
    mem_param_tmp_91426.references = NULL;
    
    struct memblock mem_90228;
    
    mem_90228.references = NULL;
    
    struct memblock ext_mem_90239;
    
    ext_mem_90239.references = NULL;
    
    struct memblock mem_90216;
    
    mem_90216.references = NULL;
    
    struct memblock mem_90213;
    
    mem_90213.references = NULL;
    
    struct memblock mem_90211;
    
    mem_90211.references = NULL;
    
    struct memblock ext_mem_90253;
    
    ext_mem_90253.references = NULL;
    
    struct memblock ext_mem_90256;
    
    ext_mem_90256.references = NULL;
    
    struct memblock ext_mem_90259;
    
    ext_mem_90259.references = NULL;
    
    struct memblock mem_90178;
    
    mem_90178.references = NULL;
    
    struct memblock ext_mem_90189;
    
    ext_mem_90189.references = NULL;
    
    struct memblock mem_90166;
    
    mem_90166.references = NULL;
    
    struct memblock mem_90163;
    
    mem_90163.references = NULL;
    
    struct memblock mem_90161;
    
    mem_90161.references = NULL;
    
    struct memblock ext_mem_90203;
    
    ext_mem_90203.references = NULL;
    
    struct memblock ext_mem_90206;
    
    ext_mem_90206.references = NULL;
    
    struct memblock ext_mem_90209;
    
    ext_mem_90209.references = NULL;
    
    struct memblock mem_90153;
    
    mem_90153.references = NULL;
    
    struct memblock mem_90145;
    
    mem_90145.references = NULL;
    
    struct memblock mem_param_90143;
    
    mem_param_90143.references = NULL;
    
    struct memblock mem_param_90140;
    
    mem_param_90140.references = NULL;
    
    struct memblock mem_param_90137;
    
    mem_param_90137.references = NULL;
    
    struct memblock mem_param_90134;
    
    mem_param_90134.references = NULL;
    
    struct memblock mem_param_90131;
    
    mem_param_90131.references = NULL;
    
    struct memblock mem_param_90127;
    
    mem_param_90127.references = NULL;
    
    struct memblock mem_param_90124;
    
    mem_param_90124.references = NULL;
    
    struct memblock mem_param_90121;
    
    mem_param_90121.references = NULL;
    
    struct memblock mem_param_90118;
    
    mem_param_90118.references = NULL;
    
    struct memblock ext_mem_90280;
    
    ext_mem_90280.references = NULL;
    
    struct memblock ext_mem_90281;
    
    ext_mem_90281.references = NULL;
    
    struct memblock ext_mem_90282;
    
    ext_mem_90282.references = NULL;
    
    struct memblock ext_mem_90283;
    
    ext_mem_90283.references = NULL;
    
    struct memblock ext_mem_90284;
    
    ext_mem_90284.references = NULL;
    
    struct memblock ext_mem_90285;
    
    ext_mem_90285.references = NULL;
    
    struct memblock ext_mem_90286;
    
    ext_mem_90286.references = NULL;
    
    struct memblock ext_mem_90287;
    
    ext_mem_90287.references = NULL;
    
    struct memblock ext_mem_90288;
    
    ext_mem_90288.references = NULL;
    
    struct memblock mem_90083;
    
    mem_90083.references = NULL;
    
    struct memblock ext_mem_90094;
    
    ext_mem_90094.references = NULL;
    
    struct memblock mem_90071;
    
    mem_90071.references = NULL;
    
    struct memblock mem_90068;
    
    mem_90068.references = NULL;
    
    struct memblock mem_90066;
    
    mem_90066.references = NULL;
    
    struct memblock ext_mem_90108;
    
    ext_mem_90108.references = NULL;
    
    struct memblock ext_mem_90111;
    
    ext_mem_90111.references = NULL;
    
    struct memblock ext_mem_90114;
    
    ext_mem_90114.references = NULL;
    
    struct memblock mem_90033;
    
    mem_90033.references = NULL;
    
    struct memblock ext_mem_90044;
    
    ext_mem_90044.references = NULL;
    
    struct memblock mem_90021;
    
    mem_90021.references = NULL;
    
    struct memblock mem_90018;
    
    mem_90018.references = NULL;
    
    struct memblock mem_90016;
    
    mem_90016.references = NULL;
    
    struct memblock ext_mem_90058;
    
    ext_mem_90058.references = NULL;
    
    struct memblock ext_mem_90061;
    
    ext_mem_90061.references = NULL;
    
    struct memblock ext_mem_90064;
    
    ext_mem_90064.references = NULL;
    
    struct memblock mem_param_89888;
    
    mem_param_89888.references = NULL;
    
    struct memblock mem_param_89884;
    
    mem_param_89884.references = NULL;
    
    struct memblock mem_param_89881;
    
    mem_param_89881.references = NULL;
    
    struct memblock ext_mem_90846;
    
    ext_mem_90846.references = NULL;
    
    struct memblock ext_mem_90847;
    
    ext_mem_90847.references = NULL;
    
    struct memblock ext_mem_90848;
    
    ext_mem_90848.references = NULL;
    
    struct memblock mem_param_tmp_91332;
    
    mem_param_tmp_91332.references = NULL;
    
    struct memblock mem_param_tmp_91331;
    
    mem_param_tmp_91331.references = NULL;
    
    struct memblock mem_param_tmp_91330;
    
    mem_param_tmp_91330.references = NULL;
    
    struct memblock mem_param_tmp_91329;
    
    mem_param_tmp_91329.references = NULL;
    
    struct memblock mem_param_tmp_91328;
    
    mem_param_tmp_91328.references = NULL;
    
    struct memblock mem_89793;
    
    mem_89793.references = NULL;
    
    struct memblock ext_mem_89804;
    
    ext_mem_89804.references = NULL;
    
    struct memblock mem_89781;
    
    mem_89781.references = NULL;
    
    struct memblock mem_89778;
    
    mem_89778.references = NULL;
    
    struct memblock mem_89776;
    
    mem_89776.references = NULL;
    
    struct memblock ext_mem_89818;
    
    ext_mem_89818.references = NULL;
    
    struct memblock ext_mem_89821;
    
    ext_mem_89821.references = NULL;
    
    struct memblock ext_mem_89824;
    
    ext_mem_89824.references = NULL;
    
    struct memblock mem_89743;
    
    mem_89743.references = NULL;
    
    struct memblock ext_mem_89754;
    
    ext_mem_89754.references = NULL;
    
    struct memblock mem_89731;
    
    mem_89731.references = NULL;
    
    struct memblock mem_89728;
    
    mem_89728.references = NULL;
    
    struct memblock mem_89726;
    
    mem_89726.references = NULL;
    
    struct memblock ext_mem_89768;
    
    ext_mem_89768.references = NULL;
    
    struct memblock ext_mem_89771;
    
    ext_mem_89771.references = NULL;
    
    struct memblock ext_mem_89774;
    
    ext_mem_89774.references = NULL;
    
    struct memblock mem_89718;
    
    mem_89718.references = NULL;
    
    struct memblock mem_89710;
    
    mem_89710.references = NULL;
    
    struct memblock mem_param_89708;
    
    mem_param_89708.references = NULL;
    
    struct memblock mem_param_89705;
    
    mem_param_89705.references = NULL;
    
    struct memblock mem_param_89702;
    
    mem_param_89702.references = NULL;
    
    struct memblock mem_param_89699;
    
    mem_param_89699.references = NULL;
    
    struct memblock mem_param_89696;
    
    mem_param_89696.references = NULL;
    
    struct memblock ext_mem_89836;
    
    ext_mem_89836.references = NULL;
    
    struct memblock ext_mem_89837;
    
    ext_mem_89837.references = NULL;
    
    struct memblock ext_mem_89838;
    
    ext_mem_89838.references = NULL;
    
    struct memblock ext_mem_89839;
    
    ext_mem_89839.references = NULL;
    
    struct memblock ext_mem_89840;
    
    ext_mem_89840.references = NULL;
    
    struct memblock mem_89661;
    
    mem_89661.references = NULL;
    
    struct memblock ext_mem_89672;
    
    ext_mem_89672.references = NULL;
    
    struct memblock mem_89649;
    
    mem_89649.references = NULL;
    
    struct memblock mem_89646;
    
    mem_89646.references = NULL;
    
    struct memblock mem_89644;
    
    mem_89644.references = NULL;
    
    struct memblock ext_mem_89686;
    
    ext_mem_89686.references = NULL;
    
    struct memblock ext_mem_89689;
    
    ext_mem_89689.references = NULL;
    
    struct memblock ext_mem_89692;
    
    ext_mem_89692.references = NULL;
    
    struct memblock mem_89611;
    
    mem_89611.references = NULL;
    
    struct memblock ext_mem_89622;
    
    ext_mem_89622.references = NULL;
    
    struct memblock mem_89599;
    
    mem_89599.references = NULL;
    
    struct memblock mem_89596;
    
    mem_89596.references = NULL;
    
    struct memblock mem_89594;
    
    mem_89594.references = NULL;
    
    struct memblock ext_mem_89636;
    
    ext_mem_89636.references = NULL;
    
    struct memblock ext_mem_89639;
    
    ext_mem_89639.references = NULL;
    
    struct memblock ext_mem_89642;
    
    ext_mem_89642.references = NULL;
    
    struct memblock mem_90002;
    
    mem_90002.references = NULL;
    
    struct memblock mem_90000;
    
    mem_90000.references = NULL;
    
    struct memblock mem_89970;
    
    mem_89970.references = NULL;
    
    struct memblock mem_89967;
    
    mem_89967.references = NULL;
    
    struct memblock mem_89965;
    
    mem_89965.references = NULL;
    
    struct memblock mem_89862;
    
    mem_89862.references = NULL;
    
    struct memblock mem_89586;
    
    mem_89586.references = NULL;
    
    struct memblock mem_89578;
    
    mem_89578.references = NULL;
    
    struct memblock mem_89554;
    
    mem_89554.references = NULL;
    
    struct memblock mem_89543;
    
    mem_89543.references = NULL;
    
    struct memblock mem_89495;
    
    mem_89495.references = NULL;
    
    struct memblock mem_89419;
    
    mem_89419.references = NULL;
    
    struct memblock mem_89416;
    
    mem_89416.references = NULL;
    
    struct memblock ext_mem_89413;
    
    ext_mem_89413.references = NULL;
    
    struct memblock ext_mem_89414;
    
    ext_mem_89414.references = NULL;
    
    struct memblock mem_out_91249;
    
    mem_out_91249.references = NULL;
    
    int64_t prim_out_91250;
    int64_t zbzg_lhs_49425;
    
    if (futrts_pairs_11446(ctx, &ext_mem_89414, &ext_mem_89413, &zbzg_lhs_49425, k_33637) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int64_t bytes_89415 = (int64_t) 8 * m_33638;
    int64_t bytes_89418 = (int64_t) 40 * zbzg_lhs_49425;
    int64_t bytes_89429 = m_33638 * bytes_89415;
    double neg_res_49428 = -eps_33641;
    double zp_res_49429 = 1.0 + tol_outerloop_33647;
    double neg_res_49430 = -rho1_33639;
    double zp_res_49431 = rho1_33639 + eps_33641;
    double zs_res_49432 = neg_res_49430 / zp_res_49431;
    double zs_res_49433 = neg_res_49428 / zp_res_49431;
    double neg_res_49434 = -rho2_33640;
    double zp_res_49435 = rho2_33640 + eps_33641;
    double zs_res_49436 = neg_res_49434 / zp_res_49435;
    double zs_res_49437 = neg_res_49428 / zp_res_49435;
    double zp_res_49438 = rho2_33640 + zp_res_49431;
    
    if (memblock_alloc(ctx, &mem_89416, bytes_89415, "mem_89416")) {
        err = 1;
        goto cleanup;
    }
    for (int64_t nest_i_91251 = 0; nest_i_91251 < m_33638; nest_i_91251++) {
        ((double *) mem_89416.mem)[nest_i_91251] = 1.0;
    }
    if (memblock_alloc(ctx, &mem_89419, bytes_89418, "mem_89419")) {
        err = 1;
        goto cleanup;
    }
    
    double zs_res_49813 = 1.0 / exp_absorb_cutoff_33644;
    double zp_res_83654 = 1.0 + tol_sinkhorn_33646;
    
    if (mem_89425_cached_sizze_91755 < bytes_89415) {
        err = lexical_realloc(ctx, &mem_89425, &mem_89425_cached_sizze_91755, bytes_89415);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89427_cached_sizze_91756 < bytes_89415) {
        err = lexical_realloc(ctx, &mem_89427, &mem_89427_cached_sizze_91756, bytes_89415);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89430_cached_sizze_91757 < bytes_89429) {
        err = lexical_realloc(ctx, &mem_89430, &mem_89430_cached_sizze_91757, bytes_89429);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89460_cached_sizze_91758 < bytes_89415) {
        err = lexical_realloc(ctx, &mem_89460, &mem_89460_cached_sizze_91758, bytes_89415);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89462_cached_sizze_91759 < bytes_89415) {
        err = lexical_realloc(ctx, &mem_89462, &mem_89462_cached_sizze_91759, bytes_89415);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89464_cached_sizze_91760 < bytes_89415) {
        err = lexical_realloc(ctx, &mem_89464, &mem_89464_cached_sizze_91760, bytes_89415);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89484_cached_sizze_91761 < bytes_89415) {
        err = lexical_realloc(ctx, &mem_89484, &mem_89484_cached_sizze_91761, bytes_89415);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89493_cached_sizze_91762 < bytes_89429) {
        err = lexical_realloc(ctx, &mem_89493, &mem_89493_cached_sizze_91762, bytes_89429);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89495, bytes_89415, "mem_89495")) {
        err = 1;
        goto cleanup;
    }
    if (mem_89504_cached_sizze_91763 < bytes_89415) {
        err = lexical_realloc(ctx, &mem_89504, &mem_89504_cached_sizze_91763, bytes_89415);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89506_cached_sizze_91764 < bytes_89415) {
        err = lexical_realloc(ctx, &mem_89506, &mem_89506_cached_sizze_91764, bytes_89415);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89520_cached_sizze_91765 < bytes_89415) {
        err = lexical_realloc(ctx, &mem_89520, &mem_89520_cached_sizze_91765, bytes_89415);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89543, bytes_89415, "mem_89543")) {
        err = 1;
        goto cleanup;
    }
    if (mem_89551_cached_sizze_91766 < bytes_89415) {
        err = lexical_realloc(ctx, &mem_89551, &mem_89551_cached_sizze_91766, bytes_89415);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89554, bytes_89429, "mem_89554")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89578, bytes_89415, "mem_89578")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89586, bytes_89415, "mem_89586")) {
        err = 1;
        goto cleanup;
    }
    if (mem_89843_cached_sizze_91767 < bytes_89429) {
        err = lexical_realloc(ctx, &mem_89843, &mem_89843_cached_sizze_91767, bytes_89429);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89862, bytes_89429, "mem_89862")) {
        err = 1;
        goto cleanup;
    }
    if (mem_89890_cached_sizze_91768 < bytes_89415) {
        err = lexical_realloc(ctx, &mem_89890, &mem_89890_cached_sizze_91768, bytes_89415);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89898_cached_sizze_91769 < bytes_89415) {
        err = lexical_realloc(ctx, &mem_89898, &mem_89898_cached_sizze_91769, bytes_89415);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89900_cached_sizze_91770 < bytes_89415) {
        err = lexical_realloc(ctx, &mem_89900, &mem_89900_cached_sizze_91770, bytes_89415);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89914_cached_sizze_91771 < bytes_89415) {
        err = lexical_realloc(ctx, &mem_89914, &mem_89914_cached_sizze_91771, bytes_89415);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89923_cached_sizze_91772 < bytes_89429) {
        err = lexical_realloc(ctx, &mem_89923, &mem_89923_cached_sizze_91772, bytes_89429);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89925_cached_sizze_91773 < bytes_89415) {
        err = lexical_realloc(ctx, &mem_89925, &mem_89925_cached_sizze_91773, bytes_89415);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89934_cached_sizze_91774 < bytes_89415) {
        err = lexical_realloc(ctx, &mem_89934, &mem_89934_cached_sizze_91774, bytes_89415);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89942_cached_sizze_91775 < bytes_89415) {
        err = lexical_realloc(ctx, &mem_89942, &mem_89942_cached_sizze_91775, bytes_89415);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89965, bytes_89415, "mem_89965")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89967, bytes_89415, "mem_89967")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89970, bytes_89429, "mem_89970")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_90000, bytes_89415, "mem_90000")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_90002, bytes_89415, "mem_90002")) {
        err = 1;
        goto cleanup;
    }
    if (mem_90573_cached_sizze_91776 < bytes_89429) {
        err = lexical_realloc(ctx, &mem_90573, &mem_90573_cached_sizze_91776, bytes_89429);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_90850_cached_sizze_91793 < bytes_89415) {
        err = lexical_realloc(ctx, &mem_90850, &mem_90850_cached_sizze_91793, bytes_89415);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_90852_cached_sizze_91794 < bytes_89415) {
        err = lexical_realloc(ctx, &mem_90852, &mem_90852_cached_sizze_91794, bytes_89415);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_90854_cached_sizze_91795 < bytes_89415) {
        err = lexical_realloc(ctx, &mem_90854, &mem_90854_cached_sizze_91795, bytes_89415);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_90865_cached_sizze_91796 < bytes_89415) {
        err = lexical_realloc(ctx, &mem_90865, &mem_90865_cached_sizze_91796, bytes_89415);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_90882_cached_sizze_91797 < bytes_89415) {
        err = lexical_realloc(ctx, &mem_90882, &mem_90882_cached_sizze_91797, bytes_89415);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_90884_cached_sizze_91798 < bytes_89415) {
        err = lexical_realloc(ctx, &mem_90884, &mem_90884_cached_sizze_91798, bytes_89415);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_90886_cached_sizze_91799 < bytes_89415) {
        err = lexical_realloc(ctx, &mem_90886, &mem_90886_cached_sizze_91799, bytes_89415);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    for (int64_t i_89371 = 0; i_89371 < zbzg_lhs_49425; i_89371++) {
        int64_t eta_p_49441 = ((int64_t *) ext_mem_89414.mem)[i_89371];
        int64_t eta_p_49442 = ((int64_t *) ext_mem_89413.mem)[i_89371];
        bool x_49443 = sle64((int64_t) 0, eta_p_49442);
        bool y_49444 = slt64(eta_p_49442, k_33637);
        bool bounds_check_49445 = x_49443 && y_49444;
        bool index_certs_49446;
        
        if (!bounds_check_49445) {
            set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) eta_p_49442, "] out of bounds for array of shape [", (long long) k_33637, "].", "-> #0  unbalanced_gw.fut:164:43-52\n   #1  /prelude/functional.fut:9:44-45\n   #2  unbalanced_gw.fut:162:6-165:84\n   #3  unbalanced_gw.fut:160:1-165:84\n"));
            err = FUTHARK_PROGRAM_ERROR;
            goto cleanup;
        }
        
        bool x_49449 = sle64((int64_t) 0, eta_p_49441);
        bool y_49450 = slt64(eta_p_49441, k_33637);
        bool bounds_check_49451 = x_49449 && y_49450;
        bool index_certs_49452;
        
        if (!bounds_check_49451) {
            set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) eta_p_49441, "] out of bounds for array of shape [", (long long) k_33637, "].", "-> #0  unbalanced_gw.fut:164:28-37\n   #1  /prelude/functional.fut:9:44-45\n   #2  unbalanced_gw.fut:162:6-165:84\n   #3  unbalanced_gw.fut:160:1-165:84\n"));
            err = FUTHARK_PROGRAM_ERROR;
            goto cleanup;
        }
        
        double defunc_res_84755;
        double defunc_res_84756;
        double defunc_res_84757;
        double defunc_res_84758;
        double defunc_res_84759;
        double defunc_res_84760;
        double defunc_res_84761;
        double defunc_res_84762;
        double defunc_res_84763;
        double redout_88621;
        double redout_88622;
        double redout_88623;
        double redout_88624;
        double redout_88625;
        double redout_88626;
        double redout_88627;
        double redout_88628;
        double redout_88629;
        
        redout_88621 = 0.0;
        redout_88622 = 0.0;
        redout_88623 = 0.0;
        redout_88624 = 0.0;
        redout_88625 = 0.0;
        redout_88626 = 0.0;
        redout_88627 = 0.0;
        redout_88628 = 0.0;
        redout_88629 = 0.0;
        for (int64_t i_88633 = 0; i_88633 < m_33638; i_88633++) {
            double x_58285 = ((double *) distrs_mem_89412.mem)[eta_p_49441 * m_33638 + i_88633];
            double defunc_res_83332;
            double defunc_res_83333;
            double defunc_res_83334;
            double defunc_res_83335;
            double defunc_res_83336;
            double defunc_res_83337;
            double defunc_res_83338;
            double defunc_res_83339;
            double redout_88607;
            double redout_88608;
            double redout_88609;
            double redout_88610;
            double redout_88611;
            double redout_88612;
            double redout_88613;
            double redout_88614;
            
            redout_88607 = 0.0;
            redout_88608 = 0.0;
            redout_88609 = 0.0;
            redout_88610 = 0.0;
            redout_88611 = 0.0;
            redout_88612 = 0.0;
            redout_88613 = 0.0;
            redout_88614 = 0.0;
            for (int64_t i_88616 = 0; i_88616 < m_33638; i_88616++) {
                double eta_p_59637 = ((double *) distrs_mem_89412.mem)[eta_p_49442 * m_33638 + i_88616];
                double zt_res_59640 = x_58285 * eta_p_59637;
                bool zeze_res_59643 = zt_res_59640 == 0.0;
                double klu_res_59644;
                
                if (zeze_res_59643) {
                    klu_res_59644 = 0.0;
                } else {
                    double zs_res_59645 = zt_res_59640 / zt_res_59640;
                    double log_res_59646 = futrts_log64(zs_res_59645);
                    double zt_res_59647 = zt_res_59640 * log_res_59646;
                    
                    klu_res_59644 = zt_res_59647;
                }
                
                double klu_res_59652;
                
                if (zeze_res_59643) {
                    klu_res_59652 = 0.0;
                } else {
                    double zs_res_59653 = zt_res_59640 / zt_res_59640;
                    double log_res_59654 = futrts_log64(zs_res_59653);
                    double zt_res_59655 = zt_res_59640 * log_res_59654;
                    
                    klu_res_59652 = zt_res_59655;
                }
                
                double zp_res_58329 = klu_res_59644 + redout_88607;
                double zp_res_58366 = klu_res_59652 + redout_88608;
                double zp_res_58380 = zt_res_59640 + redout_88609;
                double zp_res_58373 = zt_res_59640 + redout_88610;
                double zp_res_58343 = zt_res_59640 + redout_88611;
                double zp_res_58336 = zt_res_59640 + redout_88612;
                double zp_res_58307 = zt_res_59640 + redout_88613;
                double zp_res_58300 = zt_res_59640 + redout_88614;
                
                ((double *) mem_89430)[i_88633 * m_33638 + i_88616] = zt_res_59640;
                
                double redout_tmp_91265 = zp_res_58329;
                double redout_tmp_91266 = zp_res_58366;
                double redout_tmp_91267 = zp_res_58380;
                double redout_tmp_91268 = zp_res_58373;
                double redout_tmp_91269 = zp_res_58343;
                double redout_tmp_91270 = zp_res_58336;
                double redout_tmp_91271 = zp_res_58307;
                double redout_tmp_91272 = zp_res_58300;
                
                redout_88607 = redout_tmp_91265;
                redout_88608 = redout_tmp_91266;
                redout_88609 = redout_tmp_91267;
                redout_88610 = redout_tmp_91268;
                redout_88611 = redout_tmp_91269;
                redout_88612 = redout_tmp_91270;
                redout_88613 = redout_tmp_91271;
                redout_88614 = redout_tmp_91272;
            }
            defunc_res_83332 = redout_88607;
            defunc_res_83333 = redout_88608;
            defunc_res_83334 = redout_88609;
            defunc_res_83335 = redout_88610;
            defunc_res_83336 = redout_88611;
            defunc_res_83337 = redout_88612;
            defunc_res_83338 = redout_88613;
            defunc_res_83339 = redout_88614;
            
            bool zeze_res_58309 = defunc_res_83338 == 0.0;
            double klu_res_58310;
            
            if (zeze_res_58309) {
                klu_res_58310 = 0.0;
            } else {
                double zs_res_58311 = defunc_res_83338 / x_58285;
                double log_res_58312 = futrts_log64(zs_res_58311);
                double zt_res_58313 = log_res_58312 * defunc_res_83338;
                
                klu_res_58310 = zt_res_58313;
            }
            
            bool zeze_res_58345 = defunc_res_83336 == 0.0;
            double klu_res_58346;
            
            if (zeze_res_58345) {
                klu_res_58346 = 0.0;
            } else {
                double zs_res_58347 = defunc_res_83336 / x_58285;
                double log_res_58348 = futrts_log64(zs_res_58347);
                double zt_res_58349 = log_res_58348 * defunc_res_83336;
                
                klu_res_58346 = zt_res_58349;
            }
            
            double zp_res_49471 = defunc_res_83339 + redout_88621;
            double zp_res_49595 = klu_res_58310 + redout_88622;
            double zp_res_49639 = defunc_res_83332 + redout_88623;
            double zp_res_49673 = defunc_res_83337 + redout_88624;
            double zp_res_50276 = klu_res_58346 + redout_88625;
            double zp_res_50233 = defunc_res_83336 + redout_88626;
            double zp_res_50262 = defunc_res_83333 + redout_88627;
            double zp_res_50304 = x_58285 + redout_88628;
            double zp_res_52465 = x_58285 + redout_88629;
            
            ((double *) mem_89425)[i_88633] = defunc_res_83334;
            ((double *) mem_89427)[i_88633] = defunc_res_83335;
            
            double redout_tmp_91253 = zp_res_49471;
            double redout_tmp_91254 = zp_res_49595;
            double redout_tmp_91255 = zp_res_49639;
            double redout_tmp_91256 = zp_res_49673;
            double redout_tmp_91257 = zp_res_50276;
            double redout_tmp_91258 = zp_res_50233;
            double redout_tmp_91259 = zp_res_50262;
            double redout_tmp_91260 = zp_res_50304;
            double redout_tmp_91261 = zp_res_52465;
            
            redout_88621 = redout_tmp_91253;
            redout_88622 = redout_tmp_91254;
            redout_88623 = redout_tmp_91255;
            redout_88624 = redout_tmp_91256;
            redout_88625 = redout_tmp_91257;
            redout_88626 = redout_tmp_91258;
            redout_88627 = redout_tmp_91259;
            redout_88628 = redout_tmp_91260;
            redout_88629 = redout_tmp_91261;
        }
        defunc_res_84755 = redout_88621;
        defunc_res_84756 = redout_88622;
        defunc_res_84757 = redout_88623;
        defunc_res_84758 = redout_88624;
        defunc_res_84759 = redout_88625;
        defunc_res_84760 = redout_88626;
        defunc_res_84761 = redout_88627;
        defunc_res_84762 = redout_88628;
        defunc_res_84763 = redout_88629;
        
        double zt_res_49475 = eps_33641 * defunc_res_84755;
        double defunc_res_84767;
        double defunc_res_84768;
        double defunc_res_84769;
        double defunc_res_84770;
        double redout_88645;
        double redout_88646;
        double redout_88647;
        double redout_88648;
        
        redout_88645 = 0.0;
        redout_88646 = 0.0;
        redout_88647 = 0.0;
        redout_88648 = 0.0;
        for (int64_t i_88652 = 0; i_88652 < m_33638; i_88652++) {
            double x_72053 = ((double *) distrs_mem_89412.mem)[eta_p_49442 * m_33638 + i_88652];
            double log_res_72056 = futrts_log64(x_72053);
            double zt_res_72057 = zt_res_49475 * log_res_72056;
            double defunc_res_83341;
            double defunc_res_83342;
            double defunc_res_83343;
            double defunc_res_83344;
            double redout_88637;
            double redout_88638;
            double redout_88639;
            double redout_88640;
            
            redout_88637 = 0.0;
            redout_88638 = 0.0;
            redout_88639 = 0.0;
            redout_88640 = 0.0;
            for (int64_t i_88641 = 0; i_88641 < m_33638; i_88641++) {
                double x_72110 = ((double *) mem_89430)[i_88641 * m_33638 + i_88652];
                double zp_res_72063 = x_72110 + redout_88637;
                double zp_res_72066 = x_72110 + redout_88638;
                double zp_res_72083 = x_72110 + redout_88639;
                double zp_res_72086 = x_72110 + redout_88640;
                double redout_tmp_91281 = zp_res_72063;
                double redout_tmp_91282 = zp_res_72066;
                double redout_tmp_91283 = zp_res_72083;
                double redout_tmp_91284 = zp_res_72086;
                
                redout_88637 = redout_tmp_91281;
                redout_88638 = redout_tmp_91282;
                redout_88639 = redout_tmp_91283;
                redout_88640 = redout_tmp_91284;
            }
            defunc_res_83341 = redout_88637;
            defunc_res_83342 = redout_88638;
            defunc_res_83343 = redout_88639;
            defunc_res_83344 = redout_88640;
            
            bool zeze_res_72067 = defunc_res_83341 == 0.0;
            double klu_res_72068;
            
            if (zeze_res_72067) {
                klu_res_72068 = 0.0;
            } else {
                double zs_res_72069 = defunc_res_83341 / x_72053;
                double log_res_72070 = futrts_log64(zs_res_72069);
                double zt_res_72071 = log_res_72070 * defunc_res_83341;
                
                klu_res_72068 = zt_res_72071;
            }
            
            bool zeze_res_72072 = defunc_res_83342 == 0.0;
            double klu_res_72073;
            
            if (zeze_res_72072) {
                klu_res_72073 = 0.0;
            } else {
                double zs_res_72074 = defunc_res_83342 / x_72053;
                double log_res_72075 = futrts_log64(zs_res_72074);
                double zt_res_72076 = log_res_72075 * defunc_res_83342;
                
                klu_res_72073 = zt_res_72076;
            }
            
            double zp_res_49616 = klu_res_72068 + redout_88645;
            double zp_res_50290 = klu_res_72073 + redout_88646;
            double zp_res_50309 = x_72053 + redout_88647;
            double zp_res_52470 = x_72053 + redout_88648;
            
            ((double *) mem_89460)[i_88652] = defunc_res_83344;
            ((double *) mem_89462)[i_88652] = defunc_res_83343;
            ((double *) mem_89464)[i_88652] = zt_res_72057;
            
            double redout_tmp_91274 = zp_res_49616;
            double redout_tmp_91275 = zp_res_50290;
            double redout_tmp_91276 = zp_res_50309;
            double redout_tmp_91277 = zp_res_52470;
            
            redout_88645 = redout_tmp_91274;
            redout_88646 = redout_tmp_91275;
            redout_88647 = redout_tmp_91276;
            redout_88648 = redout_tmp_91277;
        }
        defunc_res_84767 = redout_88645;
        defunc_res_84768 = redout_88646;
        defunc_res_84769 = redout_88647;
        defunc_res_84770 = redout_88648;
        
        double zt_res_49617 = rho2_33640 * defunc_res_84767;
        double zt_res_49596 = rho1_33639 * defunc_res_84756;
        double zp_res_49641 = zt_res_49596 + zt_res_49617;
        double zt_res_49640 = eps_33641 * defunc_res_84757;
        double zp_res_49642 = zt_res_49640 + zp_res_49641;
        double defunc_0_reduce_res_84774;
        double redout_88660 = 0.0;
        
        for (int64_t i_88662 = 0; i_88662 < m_33638; i_88662++) {
            double eta_p_58811 = ((double *) mem_89460)[i_88662];
            double defunc_0_reduce_res_83345;
            double defunc_0_reduce_res_83346;
            double redout_88656;
            double redout_88657;
            
            redout_88656 = 0.0;
            redout_88657 = 0.0;
            for (int64_t i_88658 = 0; i_88658 < m_33638; i_88658++) {
                double eta_p_60043 = ((double *) A_mem_89411.mem)[eta_p_49442 * (m_33638 * m_33638) + i_88662 * m_33638 + i_88658];
                double eta_p_60044 = ((double *) mem_89460)[i_88658];
                double eta_p_60045 = ((double *) mem_89462)[i_88658];
                double zt_res_60048 = eta_p_60043 * eta_p_60043;
                double zt_res_60050 = eta_p_60045 * zt_res_60048;
                double zt_res_60055 = eta_p_60044 * zt_res_60048;
                double zp_res_58825 = zt_res_60050 + redout_88656;
                double zp_res_58839 = zt_res_60055 + redout_88657;
                double redout_tmp_91287 = zp_res_58825;
                double redout_tmp_91288 = zp_res_58839;
                
                redout_88656 = redout_tmp_91287;
                redout_88657 = redout_tmp_91288;
            }
            defunc_0_reduce_res_83345 = redout_88656;
            defunc_0_reduce_res_83346 = redout_88657;
            
            double zt_res_58841 = eta_p_58811 * defunc_0_reduce_res_83346;
            double zp_res_50175 = zt_res_58841 + redout_88660;
            
            ((double *) mem_89484)[i_88662] = defunc_0_reduce_res_83345;
            
            double redout_tmp_91285 = zp_res_50175;
            
            redout_88660 = redout_tmp_91285;
        }
        defunc_0_reduce_res_84774 = redout_88660;
        
        double defunc_0_reduce_res_84776;
        double defunc_res_84777;
        double redout_88692;
        double redout_88693;
        
        redout_88692 = 0.0;
        redout_88693 = 0.0;
        for (int64_t i_88696 = 0; i_88696 < m_33638; i_88696++) {
            double eta_p_58508 = ((double *) mem_89427)[i_88696];
            double eta_p_58509 = ((double *) distrs_mem_89412.mem)[eta_p_49441 * m_33638 + i_88696];
            double log_res_58514 = futrts_log64(eta_p_58509);
            double zt_res_58516 = zt_res_49475 * log_res_58514;
            double defunc_0_reduce_res_83351;
            double defunc_0_reduce_res_83352;
            double redout_88664;
            double redout_88665;
            
            redout_88664 = 0.0;
            redout_88665 = 0.0;
            for (int64_t i_88666 = 0; i_88666 < m_33638; i_88666++) {
                double eta_p_59868 = ((double *) A_mem_89411.mem)[eta_p_49441 * (m_33638 * m_33638) + i_88696 * m_33638 + i_88666];
                double eta_p_59869 = ((double *) mem_89427)[i_88666];
                double eta_p_59870 = ((double *) mem_89425)[i_88666];
                double zt_res_59873 = eta_p_59868 * eta_p_59868;
                double zt_res_59875 = eta_p_59870 * zt_res_59873;
                double zt_res_59880 = eta_p_59869 * zt_res_59873;
                double zp_res_58531 = zt_res_59875 + redout_88664;
                double zp_res_58618 = zt_res_59880 + redout_88665;
                double redout_tmp_91293 = zp_res_58531;
                double redout_tmp_91294 = zp_res_58618;
                
                redout_88664 = redout_tmp_91293;
                redout_88665 = redout_tmp_91294;
            }
            defunc_0_reduce_res_83351 = redout_88664;
            defunc_0_reduce_res_83352 = redout_88665;
            for (int64_t i_88674 = 0; i_88674 < m_33638; i_88674++) {
                double defunc_0_reduce_res_83347;
                double defunc_0_reduce_res_83348;
                double redout_88667;
                double redout_88668;
                
                redout_88667 = 0.0;
                redout_88668 = 0.0;
                for (int64_t i_88669 = 0; i_88669 < m_33638; i_88669++) {
                    double eta_p_59963 = ((double *) A_mem_89411.mem)[eta_p_49441 * (m_33638 * m_33638) + i_88696 * m_33638 + i_88669];
                    double eta_p_59964 = ((double *) mem_89430)[i_88669 * m_33638 + i_88674];
                    double zt_res_59967 = eta_p_59963 * eta_p_59964;
                    double zp_res_59893 = zt_res_59967 + redout_88667;
                    double zp_res_59903 = zt_res_59967 + redout_88668;
                    double redout_tmp_91297 = zp_res_59893;
                    double redout_tmp_91298 = zp_res_59903;
                    
                    redout_88667 = redout_tmp_91297;
                    redout_88668 = redout_tmp_91298;
                }
                defunc_0_reduce_res_83347 = redout_88667;
                defunc_0_reduce_res_83348 = redout_88668;
                ((double *) mem_89504)[i_88674] = defunc_0_reduce_res_83348;
                ((double *) mem_89506)[i_88674] = defunc_0_reduce_res_83347;
            }
            
            double defunc_0_reduce_res_83355;
            double defunc_0_reduce_res_83356;
            double redout_88681;
            double redout_88682;
            
            redout_88681 = INFINITY;
            redout_88682 = 0.0;
            for (int64_t i_88684 = 0; i_88684 < m_33638; i_88684++) {
                double eta_p_59907 = ((double *) mem_89430)[i_88696 * m_33638 + i_88684];
                double eta_p_wasfree_59908 = ((double *) mem_89484)[i_88684];
                double eta_p_wasfree_59909 = ((double *) mem_89464)[i_88684];
                double defunc_0_reduce_res_83349;
                double defunc_0_reduce_res_83350;
                double redout_88677;
                double redout_88678;
                
                redout_88677 = 0.0;
                redout_88678 = 0.0;
                for (int64_t i_88679 = 0; i_88679 < m_33638; i_88679++) {
                    double eta_p_59984 = ((double *) mem_89504)[i_88679];
                    double eta_p_59985 = ((double *) A_mem_89411.mem)[eta_p_49442 * (m_33638 * m_33638) + i_88679 * m_33638 + i_88684];
                    double eta_p_59986 = ((double *) mem_89506)[i_88679];
                    double zt_res_59988 = eta_p_59985 * eta_p_59986;
                    double zt_res_59990 = eta_p_59984 * eta_p_59985;
                    double zp_res_59919 = zt_res_59988 + redout_88677;
                    double zp_res_59948 = zt_res_59990 + redout_88678;
                    double redout_tmp_91302 = zp_res_59919;
                    double redout_tmp_91303 = zp_res_59948;
                    
                    redout_88677 = redout_tmp_91302;
                    redout_88678 = redout_tmp_91303;
                }
                defunc_0_reduce_res_83349 = redout_88677;
                defunc_0_reduce_res_83350 = redout_88678;
                
                double zt_res_59921 = -2.0 * defunc_0_reduce_res_83349;
                double zp_res_59923 = zt_res_59921 + defunc_0_reduce_res_83351;
                double zp_res_59925 = eta_p_wasfree_59908 + zp_res_59923;
                double zp_res_59927 = zp_res_49642 + zp_res_59925;
                double zm_res_59929 = zp_res_59927 - zt_res_58516;
                double zm_res_59931 = zm_res_59929 - eta_p_wasfree_59909;
                double zs_res_59933 = zm_res_59931 / defunc_res_84758;
                double zs_res_59935 = zs_res_59933 / neg_res_49428;
                double zm_res_59937 = safe_for_exp_33645 - zs_res_59935;
                double zt_res_59950 = eta_p_59907 * defunc_0_reduce_res_83350;
                double min_res_58599 = fmin64(zm_res_59937, redout_88681);
                double zp_res_58656 = zt_res_59950 + redout_88682;
                
                ((double *) mem_89520)[i_88684] = zs_res_59935;
                
                double redout_tmp_91299 = min_res_58599;
                double redout_tmp_91300 = zp_res_58656;
                
                redout_88681 = redout_tmp_91299;
                redout_88682 = redout_tmp_91300;
            }
            defunc_0_reduce_res_83355 = redout_88681;
            defunc_0_reduce_res_83356 = redout_88682;
            for (int64_t i_88688 = 0; i_88688 < m_33638; i_88688++) {
                double eta_p_58602 = ((double *) mem_89520)[i_88688];
                double zp_res_58603 = eta_p_58602 + defunc_0_reduce_res_83355;
                
                ((double *) mem_89493)[i_88696 * m_33638 + i_88688] = zp_res_58603;
            }
            
            double zt_res_58620 = eta_p_58508 * defunc_0_reduce_res_83352;
            double zp_res_50151 = zt_res_58620 + redout_88692;
            double zp_res_50218 = defunc_0_reduce_res_83356 + redout_88693;
            
            ((double *) mem_89495.mem)[i_88696] = defunc_0_reduce_res_83355;
            
            double redout_tmp_91289 = zp_res_50151;
            double redout_tmp_91290 = zp_res_50218;
            
            redout_88692 = redout_tmp_91289;
            redout_88693 = redout_tmp_91290;
        }
        defunc_0_reduce_res_84776 = redout_88692;
        defunc_res_84777 = redout_88693;
        for (int64_t i_88703 = 0; i_88703 < m_33638; i_88703++) {
            double defunc_0_reduce_res_83359;
            double redout_88699 = INFINITY;
            
            for (int64_t i_88700 = 0; i_88700 < m_33638; i_88700++) {
                double eta_p_60060 = ((double *) mem_89493)[i_88700 * m_33638 + i_88703];
                double zm_res_60061 = safe_for_exp_33645 - eta_p_60060;
                double min_res_49710 = fmin64(zm_res_60061, redout_88699);
                double redout_tmp_91306 = min_res_49710;
                
                redout_88699 = redout_tmp_91306;
            }
            defunc_0_reduce_res_83359 = redout_88699;
            ((double *) mem_89543.mem)[i_88703] = defunc_0_reduce_res_83359;
        }
        for (int64_t i_88714 = 0; i_88714 < m_33638; i_88714++) {
            double eta_p_56828 = ((double *) distrs_mem_89412.mem)[eta_p_49441 * m_33638 + i_88714];
            double eta_p_56829 = ((double *) mem_89495.mem)[i_88714];
            double defunc_0_reduce_res_83360;
            double redout_88706 = 0.0;
            
            for (int64_t i_88708 = 0; i_88708 < m_33638; i_88708++) {
                double eta_p_60069 = ((double *) mem_89493)[i_88714 * m_33638 + i_88708];
                double eta_p_wasfree_60070 = ((double *) mem_89543.mem)[i_88708];
                double zp_res_60071 = eta_p_60069 + eta_p_wasfree_60070;
                double exp_res_60073 = futrts_exp64(zp_res_60071);
                double zp_res_56845 = exp_res_60073 + redout_88706;
                
                ((double *) mem_89554.mem)[i_88714 * m_33638 + i_88708] = exp_res_60073;
                
                double redout_tmp_91309 = zp_res_56845;
                
                redout_88706 = redout_tmp_91309;
            }
            defunc_0_reduce_res_83360 = redout_88706;
            
            double zs_res_56847 = defunc_0_reduce_res_83360 / eta_p_56828;
            double ztzt_res_56849 = fpow64(zs_res_56847, zs_res_49432);
            double zt_res_56851 = zs_res_49433 * eta_p_56829;
            double exp_res_56853 = futrts_exp64(zt_res_56851);
            double zt_res_56855 = ztzt_res_56849 * exp_res_56853;
            
            ((double *) mem_89551)[i_88714] = zt_res_56855;
        }
        
        bool defunc_0_reduce_res_84786;
        bool redout_88720 = 0;
        
        for (int64_t i_88722 = 0; i_88722 < m_33638; i_88722++) {
            double eta_p_56721 = ((double *) distrs_mem_89412.mem)[eta_p_49442 * m_33638 + i_88722];
            double eta_p_56722 = ((double *) mem_89543.mem)[i_88722];
            double defunc_0_reduce_res_83362;
            double redout_88717 = 0.0;
            
            for (int64_t i_88718 = 0; i_88718 < m_33638; i_88718++) {
                double eta_p_60078 = ((double *) mem_89551)[i_88718];
                double eta_p_60079 = ((double *) mem_89554.mem)[i_88718 * m_33638 + i_88722];
                double zt_res_60080 = eta_p_60078 * eta_p_60079;
                double zp_res_56731 = zt_res_60080 + redout_88717;
                double redout_tmp_91313 = zp_res_56731;
                
                redout_88717 = redout_tmp_91313;
            }
            defunc_0_reduce_res_83362 = redout_88717;
            
            double zs_res_56733 = defunc_0_reduce_res_83362 / eta_p_56721;
            double ztzt_res_56735 = fpow64(zs_res_56733, zs_res_49436);
            double zt_res_56737 = zs_res_49437 * eta_p_56722;
            double exp_res_56739 = futrts_exp64(zt_res_56737);
            double zt_res_56741 = ztzt_res_56735 * exp_res_56739;
            bool zgze_res_56743 = exp_absorb_cutoff_33644 <= zt_res_56741;
            bool defunc_0_op_res_49854 = zgze_res_56743 || redout_88720;
            
            ((double *) mem_89578.mem)[i_88722] = zt_res_56741;
            
            bool redout_tmp_91311 = defunc_0_op_res_49854;
            
            redout_88720 = redout_tmp_91311;
        }
        defunc_0_reduce_res_84786 = redout_88720;
        
        bool defunc_0_reduce_res_84789;
        bool redout_88727 = 0;
        
        for (int64_t i_88729 = 0; i_88729 < m_33638; i_88729++) {
            double eta_p_56639 = ((double *) distrs_mem_89412.mem)[eta_p_49441 * m_33638 + i_88729];
            double eta_p_56640 = ((double *) mem_89495.mem)[i_88729];
            double defunc_0_reduce_res_83363;
            double redout_88724 = 0.0;
            
            for (int64_t i_88725 = 0; i_88725 < m_33638; i_88725++) {
                double eta_p_60084 = ((double *) mem_89578.mem)[i_88725];
                double eta_p_60085 = ((double *) mem_89554.mem)[i_88729 * m_33638 + i_88725];
                double zt_res_60086 = eta_p_60084 * eta_p_60085;
                double zp_res_56649 = zt_res_60086 + redout_88724;
                double redout_tmp_91316 = zp_res_56649;
                
                redout_88724 = redout_tmp_91316;
            }
            defunc_0_reduce_res_83363 = redout_88724;
            
            double zs_res_56651 = defunc_0_reduce_res_83363 / eta_p_56639;
            double ztzt_res_56653 = fpow64(zs_res_56651, zs_res_49432);
            double zt_res_56655 = zs_res_49433 * eta_p_56640;
            double exp_res_56657 = futrts_exp64(zt_res_56655);
            double zt_res_56659 = ztzt_res_56653 * exp_res_56657;
            bool zgze_res_56661 = exp_absorb_cutoff_33644 <= zt_res_56659;
            bool defunc_0_op_res_49811 = zgze_res_56661 || redout_88727;
            
            ((double *) mem_89586.mem)[i_88729] = zt_res_56659;
            
            bool redout_tmp_91314 = defunc_0_op_res_49811;
            
            redout_88727 = redout_tmp_91314;
        }
        defunc_0_reduce_res_84789 = redout_88727;
        
        bool x_91032 = !defunc_0_reduce_res_84789;
        bool defunc_0_reduce_res_83364;
        
        if (x_91032) {
            bool x_91034;
            bool redout_88731 = 0;
            
            for (int64_t i_88732 = 0; i_88732 < m_33638; i_88732++) {
                double eta_p_60090 = ((double *) mem_89586.mem)[i_88732];
                bool zlze_res_60091 = eta_p_60090 <= zs_res_49813;
                bool defunc_0_op_res_49821 = zlze_res_60091 || redout_88731;
                bool redout_tmp_91317 = defunc_0_op_res_49821;
                
                redout_88731 = redout_tmp_91317;
            }
            x_91034 = redout_88731;
            defunc_0_reduce_res_83364 = x_91034;
        } else {
            defunc_0_reduce_res_83364 = 0;
        }
        
        bool cond_49812 = defunc_0_reduce_res_83364 || defunc_0_reduce_res_84789;
        
        if (cond_49812) {
            if (memblock_alloc(ctx, &mem_89594, bytes_89415, "mem_89594")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc(ctx, &mem_89596, bytes_89415, "mem_89596")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc(ctx, &mem_89599, bytes_89429, "mem_89599")) {
                err = 1;
                goto cleanup;
            }
            for (int64_t i_88743 = 0; i_88743 < m_33638; i_88743++) {
                double eta_p_83381 = ((double *) mem_89586.mem)[i_88743];
                double eta_p_83382 = ((double *) mem_89495.mem)[i_88743];
                bool zgze_res_83384 = exp_absorb_cutoff_33644 <= eta_p_83381;
                bool zl_res_83385 = eta_p_83381 < zs_res_49813;
                bool x_83386 = !zgze_res_83384;
                bool y_83387 = zl_res_83385 && x_83386;
                bool cond_83388 = zgze_res_83384 || y_83387;
                int64_t binop_y_89618 = m_33638 * i_88743;
                int64_t ext_89621;
                
                if (cond_83388) {
                    ext_89621 = (int64_t) 0;
                } else {
                    ext_89621 = binop_y_89618;
                }
                
                double rescale_res_83389;
                double rescale_res_83390;
                
                if (cond_83388) {
                    double log_res_83392 = futrts_log64(eta_p_83381);
                    double sqrt_res_83393 = futrts_sqrt64(eta_p_83381);
                    double zs_res_83394 = log_res_83392 / 2.0;
                    double zp_res_83395 = eta_p_83382 + zs_res_83394;
                    
                    if (memblock_alloc(ctx, &mem_89611, bytes_89415, "mem_89611")) {
                        err = 1;
                        goto cleanup;
                    }
                    for (int64_t i_88735 = 0; i_88735 < m_33638; i_88735++) {
                        double eta_p_83397 = ((double *) mem_89554.mem)[i_88743 * m_33638 + i_88735];
                        double zt_res_83398 = sqrt_res_83393 * eta_p_83397;
                        
                        ((double *) mem_89611.mem)[i_88735] = zt_res_83398;
                    }
                    if (memblock_set(ctx, &ext_mem_89622, &mem_89611, "mem_89611") != 0)
                        return 1;
                    rescale_res_83389 = sqrt_res_83393;
                    rescale_res_83390 = zp_res_83395;
                } else {
                    if (memblock_set(ctx, &ext_mem_89622, &mem_89554, "mem_89554") != 0)
                        return 1;
                    rescale_res_83389 = eta_p_83381;
                    rescale_res_83390 = eta_p_83382;
                }
                ((double *) mem_89594.mem)[i_88743] = rescale_res_83389;
                ((double *) mem_89596.mem)[i_88743] = rescale_res_83390;
                lmad_copy_8b(ctx, 1, (uint64_t *) mem_89599.mem, i_88743 * m_33638, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_89622.mem, ext_89621, (int64_t []) {(int64_t) 1}, (int64_t []) {m_33638});
                if (memblock_unref(ctx, &ext_mem_89622, "ext_mem_89622") != 0)
                    return 1;
            }
            if (memblock_set(ctx, &ext_mem_89642, &mem_89594, "mem_89594") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_89639, &mem_89596, "mem_89596") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_89636, &mem_89599, "mem_89599") != 0)
                return 1;
        } else {
            if (memblock_set(ctx, &ext_mem_89642, &mem_89586, "mem_89586") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_89639, &mem_89495, "mem_89495") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_89636, &mem_89554, "mem_89554") != 0)
                return 1;
        }
        
        bool x_91028 = !defunc_0_reduce_res_84786;
        bool defunc_0_reduce_res_83403;
        
        if (x_91028) {
            bool x_91030;
            bool redout_88747 = 0;
            
            for (int64_t i_88748 = 0; i_88748 < m_33638; i_88748++) {
                double eta_p_60133 = ((double *) mem_89578.mem)[i_88748];
                bool zlze_res_60134 = eta_p_60133 <= zs_res_49813;
                bool defunc_0_op_res_49864 = zlze_res_60134 || redout_88747;
                bool redout_tmp_91322 = defunc_0_op_res_49864;
                
                redout_88747 = redout_tmp_91322;
            }
            x_91030 = redout_88747;
            defunc_0_reduce_res_83403 = x_91030;
        } else {
            defunc_0_reduce_res_83403 = 0;
        }
        
        bool cond_49855 = defunc_0_reduce_res_83403 || defunc_0_reduce_res_84786;
        int64_t ext_89684;
        
        if (cond_49855) {
            ext_89684 = (int64_t) 1;
        } else {
            ext_89684 = m_33638;
        }
        
        int64_t ext_89683;
        
        if (cond_49855) {
            ext_89683 = m_33638;
        } else {
            ext_89683 = (int64_t) 1;
        }
        if (cond_49855) {
            if (memblock_alloc(ctx, &mem_89644, bytes_89415, "mem_89644")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc(ctx, &mem_89646, bytes_89415, "mem_89646")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc(ctx, &mem_89649, bytes_89429, "mem_89649")) {
                err = 1;
                goto cleanup;
            }
            for (int64_t i_88759 = 0; i_88759 < m_33638; i_88759++) {
                double eta_p_83422 = ((double *) mem_89578.mem)[i_88759];
                double eta_p_83423 = ((double *) mem_89543.mem)[i_88759];
                bool zgze_res_83425 = exp_absorb_cutoff_33644 <= eta_p_83422;
                bool zl_res_83426 = eta_p_83422 < zs_res_49813;
                bool x_83427 = !zgze_res_83425;
                bool y_83428 = zl_res_83426 && x_83427;
                bool cond_83429 = zgze_res_83425 || y_83428;
                int64_t ext_89671;
                
                if (cond_83429) {
                    ext_89671 = (int64_t) 0;
                } else {
                    ext_89671 = i_88759;
                }
                
                int64_t ext_89670;
                
                if (cond_83429) {
                    ext_89670 = (int64_t) 1;
                } else {
                    ext_89670 = m_33638;
                }
                
                double rescale_res_83430;
                double rescale_res_83431;
                
                if (cond_83429) {
                    double log_res_83433 = futrts_log64(eta_p_83422);
                    double sqrt_res_83434 = futrts_sqrt64(eta_p_83422);
                    double zs_res_83435 = log_res_83433 / 2.0;
                    double zp_res_83436 = eta_p_83423 + zs_res_83435;
                    
                    if (memblock_alloc(ctx, &mem_89661, bytes_89415, "mem_89661")) {
                        err = 1;
                        goto cleanup;
                    }
                    for (int64_t i_88751 = 0; i_88751 < m_33638; i_88751++) {
                        double eta_p_83438 = ((double *) ext_mem_89636.mem)[i_88751 * m_33638 + i_88759];
                        double zt_res_83439 = sqrt_res_83434 * eta_p_83438;
                        
                        ((double *) mem_89661.mem)[i_88751] = zt_res_83439;
                    }
                    if (memblock_set(ctx, &ext_mem_89672, &mem_89661, "mem_89661") != 0)
                        return 1;
                    rescale_res_83430 = sqrt_res_83434;
                    rescale_res_83431 = zp_res_83436;
                } else {
                    if (memblock_set(ctx, &ext_mem_89672, &ext_mem_89636, "ext_mem_89636") != 0)
                        return 1;
                    rescale_res_83430 = eta_p_83422;
                    rescale_res_83431 = eta_p_83423;
                }
                ((double *) mem_89644.mem)[i_88759] = rescale_res_83430;
                ((double *) mem_89646.mem)[i_88759] = rescale_res_83431;
                lmad_copy_8b(ctx, 1, (uint64_t *) mem_89649.mem, i_88759 * m_33638, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_89672.mem, ext_89671, (int64_t []) {ext_89670}, (int64_t []) {m_33638});
                if (memblock_unref(ctx, &ext_mem_89672, "ext_mem_89672") != 0)
                    return 1;
            }
            if (memblock_set(ctx, &ext_mem_89692, &mem_89644, "mem_89644") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_89689, &mem_89646, "mem_89646") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_89686, &mem_89649, "mem_89649") != 0)
                return 1;
        } else {
            if (memblock_set(ctx, &ext_mem_89692, &mem_89578, "mem_89578") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_89689, &mem_89543, "mem_89543") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_89686, &ext_mem_89636, "ext_mem_89636") != 0)
                return 1;
        }
        if (memblock_unref(ctx, &ext_mem_89636, "ext_mem_89636") != 0)
            return 1;
        
        double defunc_0_reduce_res_84791;
        double redout_88763 = 0.0;
        
        for (int64_t i_88764 = 0; i_88764 < m_33638; i_88764++) {
            double eta_p_56565 = ((double *) mem_89551)[i_88764];
            double eta_p_56566 = ((double *) ext_mem_89642.mem)[i_88764];
            double zs_res_56567 = eta_p_56565 / eta_p_56566;
            double zm_res_56569 = zs_res_56567 - 1.0;
            double abs_res_56571 = fabs64(zm_res_56569);
            double max_res_49906 = fmax64(abs_res_56571, redout_88763);
            double redout_tmp_91327 = max_res_49906;
            
            redout_88763 = redout_tmp_91327;
        }
        defunc_0_reduce_res_84791 = redout_88763;
        
        bool zgze_res_49907 = tol_sinkhorn_33646 <= defunc_0_reduce_res_84791;
        int64_t ext_89835;
        int64_t ext_89834;
        int64_t ext_89833;
        bool algo3_core_loop_res_49908;
        bool loop_while_49914;
        int64_t ctx_param_ext_89693;
        int64_t ctx_param_ext_89694;
        int64_t ctx_param_ext_89695;
        
        if (memblock_set(ctx, &mem_param_89696, &ext_mem_89686, "ext_mem_89686") != 0)
            return 1;
        if (memblock_set(ctx, &mem_param_89699, &ext_mem_89642, "ext_mem_89642") != 0)
            return 1;
        if (memblock_set(ctx, &mem_param_89702, &ext_mem_89692, "ext_mem_89692") != 0)
            return 1;
        if (memblock_set(ctx, &mem_param_89705, &ext_mem_89639, "ext_mem_89639") != 0)
            return 1;
        if (memblock_set(ctx, &mem_param_89708, &ext_mem_89689, "ext_mem_89689") != 0)
            return 1;
        ctx_param_ext_89693 = (int64_t) 0;
        ctx_param_ext_89694 = ext_89684;
        ctx_param_ext_89695 = ext_89683;
        loop_while_49914 = zgze_res_49907;
        while (loop_while_49914) {
            if (memblock_alloc(ctx, &mem_89710, bytes_89415, "mem_89710")) {
                err = 1;
                goto cleanup;
            }
            
            bool defunc_0_reduce_res_83528;
            bool redout_88768 = 0;
            
            for (int64_t i_88770 = 0; i_88770 < m_33638; i_88770++) {
                double eta_p_60345 = ((double *) distrs_mem_89412.mem)[eta_p_49442 * m_33638 + i_88770];
                double eta_p_60346 = ((double *) mem_param_89708.mem)[i_88770];
                double defunc_0_reduce_res_83445;
                double redout_88765 = 0.0;
                
                for (int64_t i_88766 = 0; i_88766 < m_33638; i_88766++) {
                    double eta_p_60370 = ((double *) mem_param_89699.mem)[i_88766];
                    double eta_p_60371 = ((double *) mem_param_89696.mem)[ctx_param_ext_89693 + (i_88766 * ctx_param_ext_89694 + i_88770 * ctx_param_ext_89695)];
                    double zt_res_60372 = eta_p_60370 * eta_p_60371;
                    double zp_res_60355 = zt_res_60372 + redout_88765;
                    double redout_tmp_91344 = zp_res_60355;
                    
                    redout_88765 = redout_tmp_91344;
                }
                defunc_0_reduce_res_83445 = redout_88765;
                
                double zs_res_60357 = defunc_0_reduce_res_83445 / eta_p_60345;
                double ztzt_res_60359 = fpow64(zs_res_60357, zs_res_49436);
                double zt_res_60361 = zs_res_49437 * eta_p_60346;
                double exp_res_60363 = futrts_exp64(zt_res_60361);
                double zt_res_60365 = ztzt_res_60359 * exp_res_60363;
                bool zgze_res_60367 = exp_absorb_cutoff_33644 <= zt_res_60365;
                bool defunc_0_op_res_50027 = zgze_res_60367 || redout_88768;
                
                ((double *) mem_89710.mem)[i_88770] = zt_res_60365;
                
                bool redout_tmp_91342 = defunc_0_op_res_50027;
                
                redout_88768 = redout_tmp_91342;
            }
            defunc_0_reduce_res_83528 = redout_88768;
            if (memblock_alloc(ctx, &mem_89718, bytes_89415, "mem_89718")) {
                err = 1;
                goto cleanup;
            }
            
            bool defunc_0_reduce_res_83531;
            bool redout_88775 = 0;
            
            for (int64_t i_88777 = 0; i_88777 < m_33638; i_88777++) {
                double eta_p_60263 = ((double *) distrs_mem_89412.mem)[eta_p_49441 * m_33638 + i_88777];
                double eta_p_60264 = ((double *) mem_param_89705.mem)[i_88777];
                double defunc_0_reduce_res_83446;
                double redout_88772 = 0.0;
                
                for (int64_t i_88773 = 0; i_88773 < m_33638; i_88773++) {
                    double eta_p_60376 = ((double *) mem_89710.mem)[i_88773];
                    double eta_p_60377 = ((double *) mem_param_89696.mem)[ctx_param_ext_89693 + (i_88777 * ctx_param_ext_89694 + i_88773 * ctx_param_ext_89695)];
                    double zt_res_60378 = eta_p_60376 * eta_p_60377;
                    double zp_res_60273 = zt_res_60378 + redout_88772;
                    double redout_tmp_91347 = zp_res_60273;
                    
                    redout_88772 = redout_tmp_91347;
                }
                defunc_0_reduce_res_83446 = redout_88772;
                
                double zs_res_60275 = defunc_0_reduce_res_83446 / eta_p_60263;
                double ztzt_res_60277 = fpow64(zs_res_60275, zs_res_49432);
                double zt_res_60279 = zs_res_49433 * eta_p_60264;
                double exp_res_60281 = futrts_exp64(zt_res_60279);
                double zt_res_60283 = ztzt_res_60277 * exp_res_60281;
                bool zgze_res_60285 = exp_absorb_cutoff_33644 <= zt_res_60283;
                bool defunc_0_op_res_49984 = zgze_res_60285 || redout_88775;
                
                ((double *) mem_89718.mem)[i_88777] = zt_res_60283;
                
                bool redout_tmp_91345 = defunc_0_op_res_49984;
                
                redout_88775 = redout_tmp_91345;
            }
            defunc_0_reduce_res_83531 = redout_88775;
            
            bool x_91024 = !defunc_0_reduce_res_83531;
            bool defunc_0_reduce_res_83447;
            
            if (x_91024) {
                bool x_91026;
                bool redout_88779 = 0;
                
                for (int64_t i_88780 = 0; i_88780 < m_33638; i_88780++) {
                    double eta_p_60382 = ((double *) mem_89718.mem)[i_88780];
                    bool zlze_res_60383 = eta_p_60382 <= zs_res_49813;
                    bool defunc_0_op_res_49994 = zlze_res_60383 || redout_88779;
                    bool redout_tmp_91348 = defunc_0_op_res_49994;
                    
                    redout_88779 = redout_tmp_91348;
                }
                x_91026 = redout_88779;
                defunc_0_reduce_res_83447 = x_91026;
            } else {
                defunc_0_reduce_res_83447 = 0;
            }
            
            bool cond_49985 = defunc_0_reduce_res_83447 || defunc_0_reduce_res_83531;
            int64_t ext_89767;
            
            if (cond_49985) {
                ext_89767 = (int64_t) 0;
            } else {
                ext_89767 = ctx_param_ext_89693;
            }
            
            int64_t ext_89766;
            
            if (cond_49985) {
                ext_89766 = m_33638;
            } else {
                ext_89766 = ctx_param_ext_89694;
            }
            
            int64_t ext_89765;
            
            if (cond_49985) {
                ext_89765 = (int64_t) 1;
            } else {
                ext_89765 = ctx_param_ext_89695;
            }
            if (cond_49985) {
                if (memblock_alloc(ctx, &mem_89726, bytes_89415, "mem_89726")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_89728, bytes_89415, "mem_89728")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_89731, bytes_89429, "mem_89731")) {
                    err = 1;
                    goto cleanup;
                }
                for (int64_t i_88791 = 0; i_88791 < m_33638; i_88791++) {
                    double eta_p_83464 = ((double *) mem_89718.mem)[i_88791];
                    double eta_p_83465 = ((double *) mem_param_89705.mem)[i_88791];
                    bool zgze_res_83467 = exp_absorb_cutoff_33644 <= eta_p_83464;
                    bool zl_res_83468 = eta_p_83464 < zs_res_49813;
                    bool x_83469 = !zgze_res_83467;
                    bool y_83470 = zl_res_83468 && x_83469;
                    bool cond_83471 = zgze_res_83467 || y_83470;
                    int64_t binop_y_89750 = i_88791 * ctx_param_ext_89694;
                    int64_t lmad_ext_89751 = ctx_param_ext_89693 + binop_y_89750;
                    int64_t ext_89753;
                    
                    if (cond_83471) {
                        ext_89753 = (int64_t) 0;
                    } else {
                        ext_89753 = lmad_ext_89751;
                    }
                    
                    int64_t ext_89752;
                    
                    if (cond_83471) {
                        ext_89752 = (int64_t) 1;
                    } else {
                        ext_89752 = ctx_param_ext_89695;
                    }
                    
                    double rescale_res_83472;
                    double rescale_res_83473;
                    
                    if (cond_83471) {
                        double log_res_83475 = futrts_log64(eta_p_83464);
                        double sqrt_res_83476 = futrts_sqrt64(eta_p_83464);
                        double zs_res_83477 = log_res_83475 / 2.0;
                        double zp_res_83478 = eta_p_83465 + zs_res_83477;
                        
                        if (memblock_alloc(ctx, &mem_89743, bytes_89415, "mem_89743")) {
                            err = 1;
                            goto cleanup;
                        }
                        for (int64_t i_88783 = 0; i_88783 < m_33638; i_88783++) {
                            double eta_p_83480 = ((double *) mem_param_89696.mem)[ctx_param_ext_89693 + (i_88791 * ctx_param_ext_89694 + i_88783 * ctx_param_ext_89695)];
                            double zt_res_83481 = sqrt_res_83476 * eta_p_83480;
                            
                            ((double *) mem_89743.mem)[i_88783] = zt_res_83481;
                        }
                        if (memblock_set(ctx, &ext_mem_89754, &mem_89743, "mem_89743") != 0)
                            return 1;
                        rescale_res_83472 = sqrt_res_83476;
                        rescale_res_83473 = zp_res_83478;
                    } else {
                        if (memblock_set(ctx, &ext_mem_89754, &mem_param_89696, "mem_param_89696") != 0)
                            return 1;
                        rescale_res_83472 = eta_p_83464;
                        rescale_res_83473 = eta_p_83465;
                    }
                    ((double *) mem_89726.mem)[i_88791] = rescale_res_83472;
                    ((double *) mem_89728.mem)[i_88791] = rescale_res_83473;
                    lmad_copy_8b(ctx, 1, (uint64_t *) mem_89731.mem, i_88791 * m_33638, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_89754.mem, ext_89753, (int64_t []) {ext_89752}, (int64_t []) {m_33638});
                    if (memblock_unref(ctx, &ext_mem_89754, "ext_mem_89754") != 0)
                        return 1;
                }
                if (memblock_set(ctx, &ext_mem_89774, &mem_89726, "mem_89726") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89771, &mem_89728, "mem_89728") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89768, &mem_89731, "mem_89731") != 0)
                    return 1;
            } else {
                if (memblock_set(ctx, &ext_mem_89774, &mem_89718, "mem_89718") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89771, &mem_param_89705, "mem_param_89705") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89768, &mem_param_89696, "mem_param_89696") != 0)
                    return 1;
            }
            if (memblock_unref(ctx, &mem_89718, "mem_89718") != 0)
                return 1;
            
            bool x_91104 = !defunc_0_reduce_res_83528;
            bool defunc_0_reduce_res_83486;
            
            if (x_91104) {
                bool x_91106;
                bool redout_88795 = 0;
                
                for (int64_t i_88796 = 0; i_88796 < m_33638; i_88796++) {
                    double eta_p_60425 = ((double *) mem_89710.mem)[i_88796];
                    bool zlze_res_60426 = eta_p_60425 <= zs_res_49813;
                    bool defunc_0_op_res_50037 = zlze_res_60426 || redout_88795;
                    bool redout_tmp_91353 = defunc_0_op_res_50037;
                    
                    redout_88795 = redout_tmp_91353;
                }
                x_91106 = redout_88795;
                defunc_0_reduce_res_83486 = x_91106;
            } else {
                defunc_0_reduce_res_83486 = 0;
            }
            
            bool cond_50028 = defunc_0_reduce_res_83486 || defunc_0_reduce_res_83528;
            int64_t ext_89817;
            
            if (cond_50028) {
                ext_89817 = (int64_t) 0;
            } else {
                ext_89817 = ext_89767;
            }
            
            int64_t ext_89816;
            
            if (cond_50028) {
                ext_89816 = (int64_t) 1;
            } else {
                ext_89816 = ext_89766;
            }
            
            int64_t ext_89815;
            
            if (cond_50028) {
                ext_89815 = m_33638;
            } else {
                ext_89815 = ext_89765;
            }
            if (cond_50028) {
                if (memblock_alloc(ctx, &mem_89776, bytes_89415, "mem_89776")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_89778, bytes_89415, "mem_89778")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_89781, bytes_89429, "mem_89781")) {
                    err = 1;
                    goto cleanup;
                }
                for (int64_t i_88807 = 0; i_88807 < m_33638; i_88807++) {
                    double eta_p_83505 = ((double *) mem_89710.mem)[i_88807];
                    double eta_p_83506 = ((double *) mem_param_89708.mem)[i_88807];
                    bool zgze_res_83508 = exp_absorb_cutoff_33644 <= eta_p_83505;
                    bool zl_res_83509 = eta_p_83505 < zs_res_49813;
                    bool x_83510 = !zgze_res_83508;
                    bool y_83511 = zl_res_83509 && x_83510;
                    bool cond_83512 = zgze_res_83508 || y_83511;
                    int64_t binop_y_89800 = i_88807 * ext_89765;
                    int64_t lmad_ext_89801 = ext_89767 + binop_y_89800;
                    int64_t ext_89803;
                    
                    if (cond_83512) {
                        ext_89803 = (int64_t) 0;
                    } else {
                        ext_89803 = lmad_ext_89801;
                    }
                    
                    int64_t ext_89802;
                    
                    if (cond_83512) {
                        ext_89802 = (int64_t) 1;
                    } else {
                        ext_89802 = ext_89766;
                    }
                    
                    double rescale_res_83513;
                    double rescale_res_83514;
                    
                    if (cond_83512) {
                        double log_res_83516 = futrts_log64(eta_p_83505);
                        double sqrt_res_83517 = futrts_sqrt64(eta_p_83505);
                        double zs_res_83518 = log_res_83516 / 2.0;
                        double zp_res_83519 = eta_p_83506 + zs_res_83518;
                        
                        if (memblock_alloc(ctx, &mem_89793, bytes_89415, "mem_89793")) {
                            err = 1;
                            goto cleanup;
                        }
                        for (int64_t i_88799 = 0; i_88799 < m_33638; i_88799++) {
                            double eta_p_83521 = ((double *) ext_mem_89768.mem)[ext_89767 + (i_88799 * ext_89766 + i_88807 * ext_89765)];
                            double zt_res_83522 = sqrt_res_83517 * eta_p_83521;
                            
                            ((double *) mem_89793.mem)[i_88799] = zt_res_83522;
                        }
                        if (memblock_set(ctx, &ext_mem_89804, &mem_89793, "mem_89793") != 0)
                            return 1;
                        rescale_res_83513 = sqrt_res_83517;
                        rescale_res_83514 = zp_res_83519;
                    } else {
                        if (memblock_set(ctx, &ext_mem_89804, &ext_mem_89768, "ext_mem_89768") != 0)
                            return 1;
                        rescale_res_83513 = eta_p_83505;
                        rescale_res_83514 = eta_p_83506;
                    }
                    ((double *) mem_89776.mem)[i_88807] = rescale_res_83513;
                    ((double *) mem_89778.mem)[i_88807] = rescale_res_83514;
                    lmad_copy_8b(ctx, 1, (uint64_t *) mem_89781.mem, i_88807 * m_33638, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_89804.mem, ext_89803, (int64_t []) {ext_89802}, (int64_t []) {m_33638});
                    if (memblock_unref(ctx, &ext_mem_89804, "ext_mem_89804") != 0)
                        return 1;
                }
                if (memblock_set(ctx, &ext_mem_89824, &mem_89776, "mem_89776") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89821, &mem_89778, "mem_89778") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89818, &mem_89781, "mem_89781") != 0)
                    return 1;
            } else {
                if (memblock_set(ctx, &ext_mem_89824, &mem_89710, "mem_89710") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89821, &mem_param_89708, "mem_param_89708") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89818, &ext_mem_89768, "ext_mem_89768") != 0)
                    return 1;
            }
            if (memblock_unref(ctx, &mem_89710, "mem_89710") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_89768, "ext_mem_89768") != 0)
                return 1;
            
            double defunc_0_reduce_res_83533;
            double redout_88811 = 0.0;
            
            for (int64_t i_88812 = 0; i_88812 < m_33638; i_88812++) {
                double eta_p_60189 = ((double *) mem_param_89699.mem)[i_88812];
                double eta_p_60190 = ((double *) ext_mem_89774.mem)[i_88812];
                double zs_res_60191 = eta_p_60189 / eta_p_60190;
                double zm_res_60193 = zs_res_60191 - 1.0;
                double abs_res_60195 = fabs64(zm_res_60193);
                double max_res_50079 = fmax64(abs_res_60195, redout_88811);
                double redout_tmp_91358 = max_res_50079;
                
                redout_88811 = redout_tmp_91358;
            }
            defunc_0_reduce_res_83533 = redout_88811;
            
            bool zgze_res_50080 = tol_sinkhorn_33646 <= defunc_0_reduce_res_83533;
            
            if (memblock_set(ctx, &mem_param_tmp_91328, &ext_mem_89818, "ext_mem_89818") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_tmp_91329, &ext_mem_89774, "ext_mem_89774") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_tmp_91330, &ext_mem_89824, "ext_mem_89824") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_tmp_91331, &ext_mem_89771, "ext_mem_89771") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_tmp_91332, &ext_mem_89821, "ext_mem_89821") != 0)
                return 1;
            
            int64_t ctx_param_ext_tmp_91333 = ext_89817;
            int64_t ctx_param_ext_tmp_91334 = ext_89816;
            int64_t ctx_param_ext_tmp_91335 = ext_89815;
            bool loop_while_tmp_91336 = zgze_res_50080;
            
            if (memblock_set(ctx, &mem_param_89696, &mem_param_tmp_91328, "mem_param_tmp_91328") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_89699, &mem_param_tmp_91329, "mem_param_tmp_91329") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_89702, &mem_param_tmp_91330, "mem_param_tmp_91330") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_89705, &mem_param_tmp_91331, "mem_param_tmp_91331") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_89708, &mem_param_tmp_91332, "mem_param_tmp_91332") != 0)
                return 1;
            ctx_param_ext_89693 = ctx_param_ext_tmp_91333;
            ctx_param_ext_89694 = ctx_param_ext_tmp_91334;
            ctx_param_ext_89695 = ctx_param_ext_tmp_91335;
            loop_while_49914 = loop_while_tmp_91336;
        }
        if (memblock_set(ctx, &ext_mem_89840, &mem_param_89696, "mem_param_89696") != 0)
            return 1;
        if (memblock_set(ctx, &ext_mem_89839, &mem_param_89699, "mem_param_89699") != 0)
            return 1;
        if (memblock_set(ctx, &ext_mem_89838, &mem_param_89702, "mem_param_89702") != 0)
            return 1;
        if (memblock_set(ctx, &ext_mem_89837, &mem_param_89705, "mem_param_89705") != 0)
            return 1;
        if (memblock_set(ctx, &ext_mem_89836, &mem_param_89708, "mem_param_89708") != 0)
            return 1;
        ext_89835 = ctx_param_ext_89693;
        ext_89834 = ctx_param_ext_89694;
        ext_89833 = ctx_param_ext_89695;
        algo3_core_loop_res_49908 = loop_while_49914;
        if (memblock_unref(ctx, &ext_mem_89639, "ext_mem_89639") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89642, "ext_mem_89642") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89686, "ext_mem_89686") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89689, "ext_mem_89689") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89692, "ext_mem_89692") != 0)
            return 1;
        
        double defunc_res_84792;
        double redout_88819 = 0.0;
        
        for (int64_t i_88821 = 0; i_88821 < m_33638; i_88821++) {
            double eta_p_78936 = ((double *) ext_mem_89839.mem)[i_88821];
            double defunc_res_83534;
            double redout_88814 = 0.0;
            
            for (int64_t i_88816 = 0; i_88816 < m_33638; i_88816++) {
                double eta_p_79151 = ((double *) ext_mem_89840.mem)[ext_89835 + (i_88821 * ext_89834 + i_88816 * ext_89833)];
                double eta_p_wasfree_79152 = ((double *) ext_mem_89838.mem)[i_88816];
                double zt_res_79153 = eta_p_78936 * eta_p_79151;
                double zt_res_79154 = eta_p_wasfree_79152 * zt_res_79153;
                double zp_res_78947 = zt_res_79154 + redout_88814;
                
                ((double *) mem_89843)[i_88821 * m_33638 + i_88816] = zt_res_79154;
                
                double redout_tmp_91361 = zp_res_78947;
                
                redout_88814 = redout_tmp_91361;
            }
            defunc_res_83534 = redout_88814;
            
            double zp_res_50106 = defunc_res_83534 + redout_88819;
            double redout_tmp_91359 = zp_res_50106;
            
            redout_88819 = redout_tmp_91359;
        }
        defunc_res_84792 = redout_88819;
        if (memblock_unref(ctx, &ext_mem_89838, "ext_mem_89838") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89839, "ext_mem_89839") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89840, "ext_mem_89840") != 0)
            return 1;
        
        double zs_res_50107 = defunc_res_84758 / defunc_res_84792;
        double sqrt_res_50108 = futrts_sqrt64(zs_res_50107);
        bool defunc_0_reduce_comm_res_84794;
        bool redout_88829 = 0;
        
        for (int64_t i_88831 = 0; i_88831 < m_33638; i_88831++) {
            bool defunc_0_reduce_comm_res_83536;
            bool redout_88824 = 0;
            
            for (int64_t i_88826 = 0; i_88826 < m_33638; i_88826++) {
                double eta_p_60584 = ((double *) mem_89843)[i_88831 * m_33638 + i_88826];
                double eta_p_60585 = ((double *) mem_89430)[i_88831 * m_33638 + i_88826];
                double zt_res_60586 = sqrt_res_50108 * eta_p_60584;
                double zt_res_60588 = zp_res_49429 * eta_p_60585;
                bool zgze_res_60589 = zt_res_60586 <= zt_res_60588;
                double zt_res_60590 = zp_res_49429 * zt_res_60586;
                bool zgze_res_60591 = eta_p_60585 <= zt_res_60590;
                bool x_60592 = zgze_res_60589 && zgze_res_60591;
                bool not_res_60593 = !x_60592;
                bool defunc_0_op_res_56529 = not_res_60593 || redout_88824;
                
                ((double *) mem_89862.mem)[i_88831 * m_33638 + i_88826] = zt_res_60586;
                
                bool redout_tmp_91365 = defunc_0_op_res_56529;
                
                redout_88824 = redout_tmp_91365;
            }
            defunc_0_reduce_comm_res_83536 = redout_88824;
            
            bool defunc_0_op_res_50341 = defunc_0_reduce_comm_res_83536 || redout_88829;
            bool redout_tmp_91363 = defunc_0_op_res_50341;
            
            redout_88829 = redout_tmp_91363;
        }
        defunc_0_reduce_comm_res_84794 = redout_88829;
        
        double zt_res_50219 = -2.0 * defunc_res_84777;
        double zp_res_50220 = zt_res_50219 + defunc_0_reduce_res_84776;
        double zp_res_50221 = zp_res_50220 + defunc_0_reduce_res_84774;
        double zt_res_50263 = eps_33641 * defunc_res_84761;
        double zt_res_50277 = rho1_33639 * defunc_res_84759;
        double zt_res_50291 = rho2_33640 * defunc_res_84768;
        double zp_res_50292 = zt_res_50263 + zt_res_50277;
        double zp_res_50293 = zt_res_50291 + zp_res_50292;
        double zt_res_50294 = 2.0 * zp_res_50293;
        double zt_res_50295 = zt_res_50294 * defunc_res_84760;
        double zp_res_50296 = zp_res_50221 + zt_res_50295;
        double zt_res_50297 = defunc_res_84760 * defunc_res_84760;
        double zt_res_50298 = zp_res_49438 * zt_res_50297;
        double zm_res_50299 = zp_res_50296 - zt_res_50298;
        double zt_res_50310 = defunc_res_84762 * defunc_res_84769;
        double zt_res_50311 = rho1_33639 * defunc_res_84762;
        double zt_res_50312 = zt_res_50311 * defunc_res_84762;
        double zt_res_50313 = rho2_33640 * defunc_res_84769;
        double zt_res_50314 = zt_res_50313 * defunc_res_84769;
        double zp_res_50315 = zt_res_50312 + zt_res_50314;
        double zt_res_50316 = eps_33641 * zt_res_50310;
        double zt_res_50317 = zt_res_50310 * zt_res_50316;
        double zp_res_50318 = zp_res_50315 + zt_res_50317;
        double zp_res_50319 = zm_res_50299 + zp_res_50318;
        bool defunc_0_reduce_res_83540;
        
        if (defunc_0_reduce_comm_res_84794) {
            bool x_91018;
            bool redout_88835 = 0;
            
            for (int64_t i_88836 = 0; i_88836 < m_33638; i_88836++) {
                bool defunc_0_reduce_res_83542;
                bool redout_88833 = 0;
                
                for (int64_t i_88834 = 0; i_88834 < m_33638; i_88834++) {
                    double eta_p_83543 = ((double *) mem_89862.mem)[i_88836 * m_33638 + i_88834];
                    bool zg_res_83544 = 0.0 < eta_p_83543;
                    bool defunc_0_op_res_83547 = zg_res_83544 || redout_88833;
                    bool redout_tmp_91368 = defunc_0_op_res_83547;
                    
                    redout_88833 = redout_tmp_91368;
                }
                defunc_0_reduce_res_83542 = redout_88833;
                
                bool defunc_0_op_res_83551 = defunc_0_reduce_res_83542 || redout_88835;
                bool redout_tmp_91367 = defunc_0_op_res_83551;
                
                redout_88835 = redout_tmp_91367;
            }
            x_91018 = redout_88835;
            defunc_0_reduce_res_83540 = x_91018;
        } else {
            defunc_0_reduce_res_83540 = 0;
        }
        
        bool x_91087 = defunc_0_reduce_res_83540 && defunc_0_reduce_comm_res_84794;
        bool final_plan_50358;
        double final_plan_50362;
        bool loop_while_50363;
        double loss_50367;
        
        if (memblock_set(ctx, &mem_param_89881, &ext_mem_89837, "ext_mem_89837") != 0)
            return 1;
        if (memblock_set(ctx, &mem_param_89884, &ext_mem_89836, "ext_mem_89836") != 0)
            return 1;
        if (memblock_set(ctx, &mem_param_89888, &mem_89862, "mem_89862") != 0)
            return 1;
        loop_while_50363 = x_91087;
        loss_50367 = zp_res_50319;
        while (loop_while_50363) {
            double defunc_res_84709;
            double defunc_res_84710;
            double defunc_res_84711;
            double defunc_res_84712;
            double redout_88844;
            double redout_88845;
            double redout_88846;
            double redout_88847;
            
            redout_88844 = 0.0;
            redout_88845 = 0.0;
            redout_88846 = 0.0;
            redout_88847 = 0.0;
            for (int64_t i_88849 = 0; i_88849 < m_33638; i_88849++) {
                double eta_p_62033 = ((double *) distrs_mem_89412.mem)[eta_p_49441 * m_33638 + i_88849];
                double defunc_res_83553;
                double defunc_res_83554;
                double defunc_res_83555;
                double defunc_res_83556;
                double defunc_res_83557;
                double redout_88837;
                double redout_88838;
                double redout_88839;
                double redout_88840;
                double redout_88841;
                
                redout_88837 = 0.0;
                redout_88838 = 0.0;
                redout_88839 = 0.0;
                redout_88840 = 0.0;
                redout_88841 = 0.0;
                for (int64_t i_88842 = 0; i_88842 < m_33638; i_88842++) {
                    double x_62143 = ((double *) mem_param_89888.mem)[i_88849 * m_33638 + i_88842];
                    double eta_p_62144 = ((double *) distrs_mem_89412.mem)[eta_p_49442 * m_33638 + i_88842];
                    double zt_res_62149 = eta_p_62033 * eta_p_62144;
                    bool zeze_res_62150 = x_62143 == 0.0;
                    double klu_res_62151;
                    
                    if (zeze_res_62150) {
                        klu_res_62151 = 0.0;
                    } else {
                        double zs_res_62152 = x_62143 / zt_res_62149;
                        double log_res_62153 = futrts_log64(zs_res_62152);
                        double zt_res_62154 = x_62143 * log_res_62153;
                        
                        klu_res_62151 = zt_res_62154;
                    }
                    
                    double zp_res_62043 = x_62143 + redout_88837;
                    double zp_res_62049 = x_62143 + redout_88838;
                    double zp_res_62055 = x_62143 + redout_88839;
                    double zp_res_62077 = klu_res_62151 + redout_88840;
                    double zp_res_62084 = x_62143 + redout_88841;
                    double redout_tmp_91382 = zp_res_62043;
                    double redout_tmp_91383 = zp_res_62049;
                    double redout_tmp_91384 = zp_res_62055;
                    double redout_tmp_91385 = zp_res_62077;
                    double redout_tmp_91386 = zp_res_62084;
                    
                    redout_88837 = redout_tmp_91382;
                    redout_88838 = redout_tmp_91383;
                    redout_88839 = redout_tmp_91384;
                    redout_88840 = redout_tmp_91385;
                    redout_88841 = redout_tmp_91386;
                }
                defunc_res_83553 = redout_88837;
                defunc_res_83554 = redout_88838;
                defunc_res_83555 = redout_88839;
                defunc_res_83556 = redout_88840;
                defunc_res_83557 = redout_88841;
                
                bool zeze_res_62057 = defunc_res_83555 == 0.0;
                double klu_res_62058;
                
                if (zeze_res_62057) {
                    klu_res_62058 = 0.0;
                } else {
                    double zs_res_62059 = defunc_res_83555 / eta_p_62033;
                    double log_res_62060 = futrts_log64(zs_res_62059);
                    double zt_res_62061 = log_res_62060 * defunc_res_83555;
                    
                    klu_res_62058 = zt_res_62061;
                }
                
                double zp_res_50379 = defunc_res_83553 + redout_88844;
                double zp_res_50502 = klu_res_62058 + redout_88845;
                double zp_res_50546 = defunc_res_83556 + redout_88846;
                double zp_res_50580 = defunc_res_83557 + redout_88847;
                
                ((double *) mem_89890)[i_88849] = defunc_res_83554;
                
                double redout_tmp_91377 = zp_res_50379;
                double redout_tmp_91378 = zp_res_50502;
                double redout_tmp_91379 = zp_res_50546;
                double redout_tmp_91380 = zp_res_50580;
                
                redout_88844 = redout_tmp_91377;
                redout_88845 = redout_tmp_91378;
                redout_88846 = redout_tmp_91379;
                redout_88847 = redout_tmp_91380;
            }
            defunc_res_84709 = redout_88844;
            defunc_res_84710 = redout_88845;
            defunc_res_84711 = redout_88846;
            defunc_res_84712 = redout_88847;
            
            double zt_res_50383 = eps_33641 * defunc_res_84709;
            double defunc_res_84714;
            double redout_88856 = 0.0;
            
            for (int64_t i_88859 = 0; i_88859 < m_33638; i_88859++) {
                double eta_p_68864 = ((double *) distrs_mem_89412.mem)[eta_p_49442 * m_33638 + i_88859];
                double log_res_68866 = futrts_log64(eta_p_68864);
                double zt_res_68867 = zt_res_50383 * log_res_68866;
                double defunc_res_83558;
                double defunc_res_83559;
                double redout_88851;
                double redout_88852;
                
                redout_88851 = 0.0;
                redout_88852 = 0.0;
                for (int64_t i_88853 = 0; i_88853 < m_33638; i_88853++) {
                    double x_68899 = ((double *) mem_param_89888.mem)[i_88853 * m_33638 + i_88859];
                    double zp_res_68872 = x_68899 + redout_88851;
                    double zp_res_68884 = x_68899 + redout_88852;
                    double redout_tmp_91390 = zp_res_68872;
                    double redout_tmp_91391 = zp_res_68884;
                    
                    redout_88851 = redout_tmp_91390;
                    redout_88852 = redout_tmp_91391;
                }
                defunc_res_83558 = redout_88851;
                defunc_res_83559 = redout_88852;
                
                bool zeze_res_68874 = defunc_res_83558 == 0.0;
                double klu_res_68875;
                
                if (zeze_res_68874) {
                    klu_res_68875 = 0.0;
                } else {
                    double zs_res_68876 = defunc_res_83558 / eta_p_68864;
                    double log_res_68877 = futrts_log64(zs_res_68876);
                    double zt_res_68878 = log_res_68877 * defunc_res_83558;
                    
                    klu_res_68875 = zt_res_68878;
                }
                
                double zp_res_50523 = klu_res_68875 + redout_88856;
                
                ((double *) mem_89898)[i_88859] = defunc_res_83559;
                ((double *) mem_89900)[i_88859] = zt_res_68867;
                
                double redout_tmp_91387 = zp_res_50523;
                
                redout_88856 = redout_tmp_91387;
            }
            defunc_res_84714 = redout_88856;
            
            double zt_res_50524 = rho2_33640 * defunc_res_84714;
            double zt_res_50503 = rho1_33639 * defunc_res_84710;
            double zp_res_50548 = zt_res_50503 + zt_res_50524;
            double zt_res_50547 = eps_33641 * defunc_res_84711;
            double zp_res_50549 = zt_res_50547 + zp_res_50548;
            
            for (int64_t i_88866 = 0; i_88866 < m_33638; i_88866++) {
                double defunc_0_reduce_res_83560;
                double redout_88862 = 0.0;
                
                for (int64_t i_88863 = 0; i_88863 < m_33638; i_88863++) {
                    double eta_p_62411 = ((double *) A_mem_89411.mem)[eta_p_49442 * (m_33638 * m_33638) + i_88866 * m_33638 + i_88863];
                    double eta_p_62412 = ((double *) mem_89898)[i_88863];
                    double zt_res_62414 = eta_p_62411 * eta_p_62411;
                    double zt_res_62416 = eta_p_62412 * zt_res_62414;
                    double zp_res_50437 = zt_res_62416 + redout_88862;
                    double redout_tmp_91393 = zp_res_50437;
                    
                    redout_88862 = redout_tmp_91393;
                }
                defunc_0_reduce_res_83560 = redout_88862;
                ((double *) mem_89914)[i_88866] = defunc_0_reduce_res_83560;
            }
            for (int64_t i_88891 = 0; i_88891 < m_33638; i_88891++) {
                double eta_p_61822 = ((double *) distrs_mem_89412.mem)[eta_p_49441 * m_33638 + i_88891];
                double eta_p_61824 = ((double *) mem_param_89881.mem)[i_88891];
                double log_res_61828 = futrts_log64(eta_p_61822);
                double zt_res_61830 = zt_res_50383 * log_res_61828;
                double defunc_0_reduce_res_83563;
                double redout_88868 = 0.0;
                
                for (int64_t i_88869 = 0; i_88869 < m_33638; i_88869++) {
                    double eta_p_62377 = ((double *) A_mem_89411.mem)[eta_p_49441 * (m_33638 * m_33638) + i_88891 * m_33638 + i_88869];
                    double eta_p_62378 = ((double *) mem_89890)[i_88869];
                    double zt_res_62380 = eta_p_62377 * eta_p_62377;
                    double zt_res_62382 = eta_p_62378 * zt_res_62380;
                    double zp_res_61845 = zt_res_62382 + redout_88868;
                    double redout_tmp_91396 = zp_res_61845;
                    
                    redout_88868 = redout_tmp_91396;
                }
                defunc_0_reduce_res_83563 = redout_88868;
                for (int64_t i_88874 = 0; i_88874 < m_33638; i_88874++) {
                    double defunc_0_reduce_res_83561;
                    double redout_88870 = 0.0;
                    
                    for (int64_t i_88871 = 0; i_88871 < m_33638; i_88871++) {
                        double eta_p_62385 = ((double *) A_mem_89411.mem)[eta_p_49441 * (m_33638 * m_33638) + i_88891 * m_33638 + i_88871];
                        double eta_p_62386 = ((double *) mem_param_89888.mem)[i_88871 * m_33638 + i_88874];
                        double zt_res_62387 = eta_p_62385 * eta_p_62386;
                        double zp_res_61857 = zt_res_62387 + redout_88870;
                        double redout_tmp_91398 = zp_res_61857;
                        
                        redout_88870 = redout_tmp_91398;
                    }
                    defunc_0_reduce_res_83561 = redout_88870;
                    ((double *) mem_89934)[i_88874] = defunc_0_reduce_res_83561;
                }
                
                double defunc_0_reduce_res_83565;
                double redout_88879 = INFINITY;
                
                for (int64_t i_88881 = 0; i_88881 < m_33638; i_88881++) {
                    double eta_p_wasfree_62336 = ((double *) mem_89914)[i_88881];
                    double eta_p_wasfree_62337 = ((double *) mem_89900)[i_88881];
                    double eta_p_wasfree_62338 = ((double *) mem_param_89884.mem)[i_88881];
                    double defunc_0_reduce_res_83562;
                    double redout_88876 = 0.0;
                    
                    for (int64_t i_88877 = 0; i_88877 < m_33638; i_88877++) {
                        double eta_p_62391 = ((double *) mem_89934)[i_88877];
                        double eta_p_62392 = ((double *) A_mem_89411.mem)[eta_p_49442 * (m_33638 * m_33638) + i_88877 * m_33638 + i_88881];
                        double zt_res_62393 = eta_p_62391 * eta_p_62392;
                        double zp_res_62347 = zt_res_62393 + redout_88876;
                        double redout_tmp_91401 = zp_res_62347;
                        
                        redout_88876 = redout_tmp_91401;
                    }
                    defunc_0_reduce_res_83562 = redout_88876;
                    
                    double zt_res_62349 = -2.0 * defunc_0_reduce_res_83562;
                    double zp_res_62351 = zt_res_62349 + defunc_0_reduce_res_83563;
                    double zp_res_62353 = eta_p_wasfree_62336 + zp_res_62351;
                    double zp_res_62355 = zp_res_50549 + zp_res_62353;
                    double zm_res_62357 = zp_res_62355 - zt_res_61830;
                    double zm_res_62359 = zm_res_62357 - eta_p_wasfree_62337;
                    double zs_res_62361 = zm_res_62359 / defunc_res_84712;
                    double zs_res_62363 = zs_res_62361 / neg_res_49428;
                    double zp_res_62365 = eta_p_61824 + zs_res_62363;
                    double zp_res_62367 = eta_p_wasfree_62338 + zp_res_62365;
                    double zm_res_62369 = 30.0 - zp_res_62367;
                    double min_res_61922 = fmin64(zm_res_62369, redout_88879);
                    
                    ((double *) mem_89942)[i_88881] = zp_res_62367;
                    
                    double redout_tmp_91399 = min_res_61922;
                    
                    redout_88879 = redout_tmp_91399;
                }
                defunc_0_reduce_res_83565 = redout_88879;
                for (int64_t i_88885 = 0; i_88885 < m_33638; i_88885++) {
                    double eta_p_61925 = ((double *) mem_89942)[i_88885];
                    double zp_res_61926 = eta_p_61925 + defunc_0_reduce_res_83565;
                    
                    ((double *) mem_89923)[i_88891 * m_33638 + i_88885] = zp_res_61926;
                }
                ((double *) mem_89925)[i_88891] = defunc_0_reduce_res_83565;
            }
            
            bool defunc_0_reduce_res_84720;
            bool redout_88904 = 0;
            
            for (int64_t i_88908 = 0; i_88908 < m_33638; i_88908++) {
                double eta_p_79225 = ((double *) mem_param_89884.mem)[i_88908];
                double eta_p_79226 = ((double *) distrs_mem_89412.mem)[eta_p_49442 * m_33638 + i_88908];
                double defunc_0_reduce_res_83568;
                double redout_88894 = INFINITY;
                
                for (int64_t i_88895 = 0; i_88895 < m_33638; i_88895++) {
                    double eta_p_79229 = ((double *) mem_89923)[i_88895 * m_33638 + i_88908];
                    double zm_res_79230 = 30.0 - eta_p_79229;
                    double min_res_79233 = fmin64(zm_res_79230, redout_88894);
                    double redout_tmp_91407 = min_res_79233;
                    
                    redout_88894 = redout_tmp_91407;
                }
                defunc_0_reduce_res_83568 = redout_88894;
                
                double defunc_0_reduce_res_83569;
                double redout_88897 = 0.0;
                
                for (int64_t i_88899 = 0; i_88899 < m_33638; i_88899++) {
                    double eta_p_79269 = ((double *) mem_89923)[i_88899 * m_33638 + i_88908];
                    double zp_res_79270 = eta_p_79269 + defunc_0_reduce_res_83568;
                    double exp_res_79271 = futrts_exp64(zp_res_79270);
                    double zp_res_79246 = exp_res_79271 + redout_88897;
                    
                    ((double *) mem_89970.mem)[i_88908 * m_33638 + i_88899] = exp_res_79271;
                    
                    double redout_tmp_91408 = zp_res_79246;
                    
                    redout_88897 = redout_tmp_91408;
                }
                defunc_0_reduce_res_83569 = redout_88897;
                
                double zp_res_79241 = eta_p_79225 + defunc_0_reduce_res_83568;
                double zs_res_79247 = defunc_0_reduce_res_83569 / eta_p_79226;
                double ztzt_res_79248 = fpow64(zs_res_79247, zs_res_49436);
                double zt_res_79249 = zs_res_49437 * zp_res_79241;
                double exp_res_79250 = futrts_exp64(zt_res_79249);
                double zt_res_79251 = ztzt_res_79248 * exp_res_79250;
                bool zgze_res_79252 = exp_absorb_cutoff_33644 <= zt_res_79251;
                bool defunc_0_op_res_50755 = zgze_res_79252 || redout_88904;
                
                ((double *) mem_89965.mem)[i_88908] = zt_res_79251;
                ((double *) mem_89967.mem)[i_88908] = zp_res_79241;
                
                bool redout_tmp_91403 = defunc_0_op_res_50755;
                
                redout_88904 = redout_tmp_91403;
            }
            defunc_0_reduce_res_84720 = redout_88904;
            
            bool defunc_0_reduce_res_84725;
            bool redout_88916 = 0;
            
            for (int64_t i_88919 = 0; i_88919 < m_33638; i_88919++) {
                double eta_p_60885 = ((double *) mem_param_89881.mem)[i_88919];
                double eta_p_60886 = ((double *) mem_89925)[i_88919];
                double eta_p_60888 = ((double *) distrs_mem_89412.mem)[eta_p_49441 * m_33638 + i_88919];
                double zp_res_60889 = eta_p_60885 + eta_p_60886;
                double defunc_0_reduce_res_83571;
                double redout_88912 = 0.0;
                
                for (int64_t i_88913 = 0; i_88913 < m_33638; i_88913++) {
                    double eta_p_62431 = ((double *) mem_89965.mem)[i_88913];
                    double eta_p_62432 = ((double *) mem_89970.mem)[i_88913 * m_33638 + i_88919];
                    double zt_res_62433 = eta_p_62431 * eta_p_62432;
                    double zp_res_60899 = zt_res_62433 + redout_88912;
                    double redout_tmp_91413 = zp_res_60899;
                    
                    redout_88912 = redout_tmp_91413;
                }
                defunc_0_reduce_res_83571 = redout_88912;
                
                double zs_res_60901 = defunc_0_reduce_res_83571 / eta_p_60888;
                double ztzt_res_60903 = fpow64(zs_res_60901, zs_res_49432);
                double zt_res_60905 = zs_res_49433 * zp_res_60889;
                double exp_res_60907 = futrts_exp64(zt_res_60905);
                double zt_res_60909 = ztzt_res_60903 * exp_res_60907;
                bool zgze_res_60911 = exp_absorb_cutoff_33644 <= zt_res_60909;
                bool defunc_0_op_res_50712 = zgze_res_60911 || redout_88916;
                
                ((double *) mem_90000.mem)[i_88919] = zt_res_60909;
                ((double *) mem_90002.mem)[i_88919] = zp_res_60889;
                
                bool redout_tmp_91410 = defunc_0_op_res_50712;
                
                redout_88916 = redout_tmp_91410;
            }
            defunc_0_reduce_res_84725 = redout_88916;
            
            bool x_90978 = !defunc_0_reduce_res_84725;
            bool defunc_0_reduce_res_83572;
            
            if (x_90978) {
                bool x_90980;
                bool redout_88922 = 0;
                
                for (int64_t i_88923 = 0; i_88923 < m_33638; i_88923++) {
                    double eta_p_62438 = ((double *) mem_90000.mem)[i_88923];
                    bool zlze_res_62439 = eta_p_62438 <= zs_res_49813;
                    bool defunc_0_op_res_50722 = zlze_res_62439 || redout_88922;
                    bool redout_tmp_91414 = defunc_0_op_res_50722;
                    
                    redout_88922 = redout_tmp_91414;
                }
                x_90980 = redout_88922;
                defunc_0_reduce_res_83572 = x_90980;
            } else {
                defunc_0_reduce_res_83572 = 0;
            }
            
            bool cond_50713 = defunc_0_reduce_res_83572 || defunc_0_reduce_res_84725;
            int64_t ext_90056;
            
            if (cond_50713) {
                ext_90056 = m_33638;
            } else {
                ext_90056 = (int64_t) 1;
            }
            
            int64_t ext_90055;
            
            if (cond_50713) {
                ext_90055 = (int64_t) 1;
            } else {
                ext_90055 = m_33638;
            }
            if (cond_50713) {
                if (memblock_alloc(ctx, &mem_90016, bytes_89415, "mem_90016")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_90018, bytes_89415, "mem_90018")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_90021, bytes_89429, "mem_90021")) {
                    err = 1;
                    goto cleanup;
                }
                for (int64_t i_88934 = 0; i_88934 < m_33638; i_88934++) {
                    double eta_p_83589 = ((double *) mem_90000.mem)[i_88934];
                    double eta_p_83590 = ((double *) mem_90002.mem)[i_88934];
                    bool zgze_res_83592 = exp_absorb_cutoff_33644 <= eta_p_83589;
                    bool zl_res_83593 = eta_p_83589 < zs_res_49813;
                    bool x_83594 = !zgze_res_83592;
                    bool y_83595 = zl_res_83593 && x_83594;
                    bool cond_83596 = zgze_res_83592 || y_83595;
                    int64_t ext_90043;
                    
                    if (cond_83596) {
                        ext_90043 = (int64_t) 0;
                    } else {
                        ext_90043 = i_88934;
                    }
                    
                    int64_t ext_90042;
                    
                    if (cond_83596) {
                        ext_90042 = (int64_t) 1;
                    } else {
                        ext_90042 = m_33638;
                    }
                    
                    double rescale_res_83597;
                    double rescale_res_83598;
                    
                    if (cond_83596) {
                        double log_res_83600 = futrts_log64(eta_p_83589);
                        double sqrt_res_83601 = futrts_sqrt64(eta_p_83589);
                        double zs_res_83602 = log_res_83600 / 2.0;
                        double zp_res_83603 = eta_p_83590 + zs_res_83602;
                        
                        if (memblock_alloc(ctx, &mem_90033, bytes_89415, "mem_90033")) {
                            err = 1;
                            goto cleanup;
                        }
                        for (int64_t i_88926 = 0; i_88926 < m_33638; i_88926++) {
                            double eta_p_83605 = ((double *) mem_89970.mem)[i_88926 * m_33638 + i_88934];
                            double zt_res_83606 = sqrt_res_83601 * eta_p_83605;
                            
                            ((double *) mem_90033.mem)[i_88926] = zt_res_83606;
                        }
                        if (memblock_set(ctx, &ext_mem_90044, &mem_90033, "mem_90033") != 0)
                            return 1;
                        rescale_res_83597 = sqrt_res_83601;
                        rescale_res_83598 = zp_res_83603;
                    } else {
                        if (memblock_set(ctx, &ext_mem_90044, &mem_89970, "mem_89970") != 0)
                            return 1;
                        rescale_res_83597 = eta_p_83589;
                        rescale_res_83598 = eta_p_83590;
                    }
                    ((double *) mem_90016.mem)[i_88934] = rescale_res_83597;
                    ((double *) mem_90018.mem)[i_88934] = rescale_res_83598;
                    lmad_copy_8b(ctx, 1, (uint64_t *) mem_90021.mem, i_88934 * m_33638, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90044.mem, ext_90043, (int64_t []) {ext_90042}, (int64_t []) {m_33638});
                    if (memblock_unref(ctx, &ext_mem_90044, "ext_mem_90044") != 0)
                        return 1;
                }
                if (memblock_set(ctx, &ext_mem_90064, &mem_90016, "mem_90016") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90061, &mem_90018, "mem_90018") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90058, &mem_90021, "mem_90021") != 0)
                    return 1;
            } else {
                if (memblock_set(ctx, &ext_mem_90064, &mem_90000, "mem_90000") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90061, &mem_90002, "mem_90002") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90058, &mem_89970, "mem_89970") != 0)
                    return 1;
            }
            
            bool x_90974 = !defunc_0_reduce_res_84720;
            bool defunc_0_reduce_res_83611;
            
            if (x_90974) {
                bool x_90976;
                bool redout_88938 = 0;
                
                for (int64_t i_88939 = 0; i_88939 < m_33638; i_88939++) {
                    double eta_p_62481 = ((double *) mem_89965.mem)[i_88939];
                    bool zlze_res_62482 = eta_p_62481 <= zs_res_49813;
                    bool defunc_0_op_res_50765 = zlze_res_62482 || redout_88938;
                    bool redout_tmp_91419 = defunc_0_op_res_50765;
                    
                    redout_88938 = redout_tmp_91419;
                }
                x_90976 = redout_88938;
                defunc_0_reduce_res_83611 = x_90976;
            } else {
                defunc_0_reduce_res_83611 = 0;
            }
            
            bool cond_50756 = defunc_0_reduce_res_83611 || defunc_0_reduce_res_84720;
            int64_t ext_90106;
            
            if (cond_50756) {
                ext_90106 = (int64_t) 1;
            } else {
                ext_90106 = ext_90056;
            }
            
            int64_t ext_90105;
            
            if (cond_50756) {
                ext_90105 = m_33638;
            } else {
                ext_90105 = ext_90055;
            }
            if (cond_50756) {
                if (memblock_alloc(ctx, &mem_90066, bytes_89415, "mem_90066")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_90068, bytes_89415, "mem_90068")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_90071, bytes_89429, "mem_90071")) {
                    err = 1;
                    goto cleanup;
                }
                for (int64_t i_88950 = 0; i_88950 < m_33638; i_88950++) {
                    double eta_p_83630 = ((double *) mem_89965.mem)[i_88950];
                    double eta_p_83631 = ((double *) mem_89967.mem)[i_88950];
                    bool zgze_res_83633 = exp_absorb_cutoff_33644 <= eta_p_83630;
                    bool zl_res_83634 = eta_p_83630 < zs_res_49813;
                    bool x_83635 = !zgze_res_83633;
                    bool y_83636 = zl_res_83634 && x_83635;
                    bool cond_83637 = zgze_res_83633 || y_83636;
                    int64_t binop_y_90090 = i_88950 * ext_90055;
                    int64_t ext_90093;
                    
                    if (cond_83637) {
                        ext_90093 = (int64_t) 0;
                    } else {
                        ext_90093 = binop_y_90090;
                    }
                    
                    int64_t ext_90092;
                    
                    if (cond_83637) {
                        ext_90092 = (int64_t) 1;
                    } else {
                        ext_90092 = ext_90056;
                    }
                    
                    double rescale_res_83638;
                    double rescale_res_83639;
                    
                    if (cond_83637) {
                        double log_res_83641 = futrts_log64(eta_p_83630);
                        double sqrt_res_83642 = futrts_sqrt64(eta_p_83630);
                        double zs_res_83643 = log_res_83641 / 2.0;
                        double zp_res_83644 = eta_p_83631 + zs_res_83643;
                        
                        if (memblock_alloc(ctx, &mem_90083, bytes_89415, "mem_90083")) {
                            err = 1;
                            goto cleanup;
                        }
                        for (int64_t i_88942 = 0; i_88942 < m_33638; i_88942++) {
                            double eta_p_83646 = ((double *) ext_mem_90058.mem)[i_88942 * ext_90056 + i_88950 * ext_90055];
                            double zt_res_83647 = sqrt_res_83642 * eta_p_83646;
                            
                            ((double *) mem_90083.mem)[i_88942] = zt_res_83647;
                        }
                        if (memblock_set(ctx, &ext_mem_90094, &mem_90083, "mem_90083") != 0)
                            return 1;
                        rescale_res_83638 = sqrt_res_83642;
                        rescale_res_83639 = zp_res_83644;
                    } else {
                        if (memblock_set(ctx, &ext_mem_90094, &ext_mem_90058, "ext_mem_90058") != 0)
                            return 1;
                        rescale_res_83638 = eta_p_83630;
                        rescale_res_83639 = eta_p_83631;
                    }
                    ((double *) mem_90066.mem)[i_88950] = rescale_res_83638;
                    ((double *) mem_90068.mem)[i_88950] = rescale_res_83639;
                    lmad_copy_8b(ctx, 1, (uint64_t *) mem_90071.mem, i_88950 * m_33638, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90094.mem, ext_90093, (int64_t []) {ext_90092}, (int64_t []) {m_33638});
                    if (memblock_unref(ctx, &ext_mem_90094, "ext_mem_90094") != 0)
                        return 1;
                }
                if (memblock_set(ctx, &ext_mem_90114, &mem_90066, "mem_90066") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90111, &mem_90068, "mem_90068") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90108, &mem_90071, "mem_90071") != 0)
                    return 1;
            } else {
                if (memblock_set(ctx, &ext_mem_90114, &mem_89965, "mem_89965") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90111, &mem_89967, "mem_89967") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90108, &ext_mem_90058, "ext_mem_90058") != 0)
                    return 1;
            }
            if (memblock_unref(ctx, &ext_mem_90058, "ext_mem_90058") != 0)
                return 1;
            
            bool defunc_0_reduce_res_84728;
            bool redout_88954 = 1;
            
            for (int64_t i_88955 = 0; i_88955 < m_33638; i_88955++) {
                double eta_p_60687 = ((double *) ext_mem_90064.mem)[i_88955];
                bool isnan_res_60688 = futrts_isnan64(eta_p_60687);
                bool not_res_60689 = !isnan_res_60688;
                bool x_50801 = not_res_60689 && redout_88954;
                bool redout_tmp_91424 = x_50801;
                
                redout_88954 = redout_tmp_91424;
            }
            defunc_0_reduce_res_84728 = redout_88954;
            
            bool defunc_0_reduce_comm_res_83655;
            
            if (defunc_0_reduce_res_84728) {
                bool x_90972;
                bool redout_88956 = 0;
                
                for (int64_t i_88957 = 0; i_88957 < m_33638; i_88957++) {
                    double eta_p_83656 = ((double *) ext_mem_90064.mem)[i_88957];
                    double zt_res_83657 = zp_res_83654 * eta_p_83656;
                    bool zgze_res_83658 = 1.0 <= zt_res_83657;
                    bool zgze_res_83659 = eta_p_83656 <= zp_res_83654;
                    bool x_83660 = zgze_res_83658 && zgze_res_83659;
                    bool not_res_83661 = !x_83660;
                    bool defunc_0_op_res_83664 = not_res_83661 || redout_88956;
                    bool redout_tmp_91425 = defunc_0_op_res_83664;
                    
                    redout_88956 = redout_tmp_91425;
                }
                x_90972 = redout_88956;
                defunc_0_reduce_comm_res_83655 = x_90972;
            } else {
                defunc_0_reduce_comm_res_83655 = 0;
            }
            
            bool x_91090 = defunc_0_reduce_comm_res_83655 && defunc_0_reduce_res_84728;
            int64_t ext_90279;
            int64_t ext_90278;
            int64_t ext_90277;
            int64_t ext_90270;
            int64_t ext_90269;
            int64_t ext_90268;
            bool algo5_core_loop_res_50816;
            bool loop_while_50826;
            int64_t ctx_param_ext_90115;
            int64_t ctx_param_ext_90116;
            int64_t ctx_param_ext_90117;
            int64_t ctx_param_ext_90128;
            int64_t ctx_param_ext_90129;
            int64_t ctx_param_ext_90130;
            
            if (memblock_set(ctx, &mem_param_90118, &mem_89970, "mem_89970") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_90121, &mem_89416, "mem_89416") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_90124, &mem_90002, "mem_90002") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_90127, &mem_89967, "mem_89967") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_90131, &ext_mem_90108, "ext_mem_90108") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_90134, &ext_mem_90064, "ext_mem_90064") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_90137, &ext_mem_90114, "ext_mem_90114") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_90140, &ext_mem_90061, "ext_mem_90061") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_90143, &ext_mem_90111, "ext_mem_90111") != 0)
                return 1;
            ctx_param_ext_90115 = (int64_t) 0;
            ctx_param_ext_90116 = (int64_t) 1;
            ctx_param_ext_90117 = m_33638;
            ctx_param_ext_90128 = (int64_t) 0;
            ctx_param_ext_90129 = ext_90106;
            ctx_param_ext_90130 = ext_90105;
            loop_while_50826 = x_91090;
            while (loop_while_50826) {
                if (memblock_alloc(ctx, &mem_90145, bytes_89415, "mem_90145")) {
                    err = 1;
                    goto cleanup;
                }
                
                bool defunc_0_reduce_res_83764;
                bool redout_88961 = 0;
                
                for (int64_t i_88963 = 0; i_88963 < m_33638; i_88963++) {
                    double eta_p_62700 = ((double *) distrs_mem_89412.mem)[eta_p_49442 * m_33638 + i_88963];
                    double eta_p_62701 = ((double *) mem_param_90143.mem)[i_88963];
                    double defunc_0_reduce_res_83666;
                    double redout_88958 = 0.0;
                    
                    for (int64_t i_88959 = 0; i_88959 < m_33638; i_88959++) {
                        double eta_p_62725 = ((double *) mem_param_90134.mem)[i_88959];
                        double eta_p_62726 = ((double *) mem_param_90131.mem)[ctx_param_ext_90128 + (i_88959 * ctx_param_ext_90129 + i_88963 * ctx_param_ext_90130)];
                        double zt_res_62727 = eta_p_62725 * eta_p_62726;
                        double zp_res_62710 = zt_res_62727 + redout_88958;
                        double redout_tmp_91453 = zp_res_62710;
                        
                        redout_88958 = redout_tmp_91453;
                    }
                    defunc_0_reduce_res_83666 = redout_88958;
                    
                    double zs_res_62712 = defunc_0_reduce_res_83666 / eta_p_62700;
                    double ztzt_res_62714 = fpow64(zs_res_62712, zs_res_49436);
                    double zt_res_62716 = zs_res_49437 * eta_p_62701;
                    double exp_res_62718 = futrts_exp64(zt_res_62716);
                    double zt_res_62720 = ztzt_res_62714 * exp_res_62718;
                    bool zgze_res_62722 = exp_absorb_cutoff_33644 <= zt_res_62720;
                    bool defunc_0_op_res_50943 = zgze_res_62722 || redout_88961;
                    
                    ((double *) mem_90145.mem)[i_88963] = zt_res_62720;
                    
                    bool redout_tmp_91451 = defunc_0_op_res_50943;
                    
                    redout_88961 = redout_tmp_91451;
                }
                defunc_0_reduce_res_83764 = redout_88961;
                if (memblock_alloc(ctx, &mem_90153, bytes_89415, "mem_90153")) {
                    err = 1;
                    goto cleanup;
                }
                
                bool defunc_0_reduce_res_83767;
                bool redout_88968 = 0;
                
                for (int64_t i_88970 = 0; i_88970 < m_33638; i_88970++) {
                    double eta_p_62618 = ((double *) distrs_mem_89412.mem)[eta_p_49441 * m_33638 + i_88970];
                    double eta_p_62619 = ((double *) mem_param_90140.mem)[i_88970];
                    double defunc_0_reduce_res_83667;
                    double redout_88965 = 0.0;
                    
                    for (int64_t i_88966 = 0; i_88966 < m_33638; i_88966++) {
                        double eta_p_62731 = ((double *) mem_90145.mem)[i_88966];
                        double eta_p_62732 = ((double *) mem_param_90131.mem)[ctx_param_ext_90128 + (i_88970 * ctx_param_ext_90129 + i_88966 * ctx_param_ext_90130)];
                        double zt_res_62733 = eta_p_62731 * eta_p_62732;
                        double zp_res_62628 = zt_res_62733 + redout_88965;
                        double redout_tmp_91456 = zp_res_62628;
                        
                        redout_88965 = redout_tmp_91456;
                    }
                    defunc_0_reduce_res_83667 = redout_88965;
                    
                    double zs_res_62630 = defunc_0_reduce_res_83667 / eta_p_62618;
                    double ztzt_res_62632 = fpow64(zs_res_62630, zs_res_49432);
                    double zt_res_62634 = zs_res_49433 * eta_p_62619;
                    double exp_res_62636 = futrts_exp64(zt_res_62634);
                    double zt_res_62638 = ztzt_res_62632 * exp_res_62636;
                    bool zgze_res_62640 = exp_absorb_cutoff_33644 <= zt_res_62638;
                    bool defunc_0_op_res_50900 = zgze_res_62640 || redout_88968;
                    
                    ((double *) mem_90153.mem)[i_88970] = zt_res_62638;
                    
                    bool redout_tmp_91454 = defunc_0_op_res_50900;
                    
                    redout_88968 = redout_tmp_91454;
                }
                defunc_0_reduce_res_83767 = redout_88968;
                
                bool x_90966 = !defunc_0_reduce_res_83767;
                bool defunc_0_reduce_res_83668;
                
                if (x_90966) {
                    bool x_90968;
                    bool redout_88972 = 0;
                    
                    for (int64_t i_88973 = 0; i_88973 < m_33638; i_88973++) {
                        double eta_p_62737 = ((double *) mem_90153.mem)[i_88973];
                        bool zlze_res_62738 = eta_p_62737 <= zs_res_49813;
                        bool defunc_0_op_res_50910 = zlze_res_62738 || redout_88972;
                        bool redout_tmp_91457 = defunc_0_op_res_50910;
                        
                        redout_88972 = redout_tmp_91457;
                    }
                    x_90968 = redout_88972;
                    defunc_0_reduce_res_83668 = x_90968;
                } else {
                    defunc_0_reduce_res_83668 = 0;
                }
                
                bool cond_50901 = defunc_0_reduce_res_83668 || defunc_0_reduce_res_83767;
                int64_t ext_90202;
                
                if (cond_50901) {
                    ext_90202 = (int64_t) 0;
                } else {
                    ext_90202 = ctx_param_ext_90128;
                }
                
                int64_t ext_90201;
                
                if (cond_50901) {
                    ext_90201 = m_33638;
                } else {
                    ext_90201 = ctx_param_ext_90129;
                }
                
                int64_t ext_90200;
                
                if (cond_50901) {
                    ext_90200 = (int64_t) 1;
                } else {
                    ext_90200 = ctx_param_ext_90130;
                }
                if (cond_50901) {
                    if (memblock_alloc(ctx, &mem_90161, bytes_89415, "mem_90161")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_90163, bytes_89415, "mem_90163")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_90166, bytes_89429, "mem_90166")) {
                        err = 1;
                        goto cleanup;
                    }
                    for (int64_t i_88984 = 0; i_88984 < m_33638; i_88984++) {
                        double eta_p_83685 = ((double *) mem_90153.mem)[i_88984];
                        double eta_p_83686 = ((double *) mem_param_90140.mem)[i_88984];
                        bool zgze_res_83688 = exp_absorb_cutoff_33644 <= eta_p_83685;
                        bool zl_res_83689 = eta_p_83685 < zs_res_49813;
                        bool x_83690 = !zgze_res_83688;
                        bool y_83691 = zl_res_83689 && x_83690;
                        bool cond_83692 = zgze_res_83688 || y_83691;
                        int64_t binop_y_90185 = i_88984 * ctx_param_ext_90129;
                        int64_t lmad_ext_90186 = ctx_param_ext_90128 + binop_y_90185;
                        int64_t ext_90188;
                        
                        if (cond_83692) {
                            ext_90188 = (int64_t) 0;
                        } else {
                            ext_90188 = lmad_ext_90186;
                        }
                        
                        int64_t ext_90187;
                        
                        if (cond_83692) {
                            ext_90187 = (int64_t) 1;
                        } else {
                            ext_90187 = ctx_param_ext_90130;
                        }
                        
                        double rescale_res_83693;
                        double rescale_res_83694;
                        
                        if (cond_83692) {
                            double log_res_83696 = futrts_log64(eta_p_83685);
                            double sqrt_res_83697 = futrts_sqrt64(eta_p_83685);
                            double zs_res_83698 = log_res_83696 / 2.0;
                            double zp_res_83699 = eta_p_83686 + zs_res_83698;
                            
                            if (memblock_alloc(ctx, &mem_90178, bytes_89415, "mem_90178")) {
                                err = 1;
                                goto cleanup;
                            }
                            for (int64_t i_88976 = 0; i_88976 < m_33638; i_88976++) {
                                double eta_p_83701 = ((double *) mem_param_90131.mem)[ctx_param_ext_90128 + (i_88984 * ctx_param_ext_90129 + i_88976 * ctx_param_ext_90130)];
                                double zt_res_83702 = sqrt_res_83697 * eta_p_83701;
                                
                                ((double *) mem_90178.mem)[i_88976] = zt_res_83702;
                            }
                            if (memblock_set(ctx, &ext_mem_90189, &mem_90178, "mem_90178") != 0)
                                return 1;
                            rescale_res_83693 = sqrt_res_83697;
                            rescale_res_83694 = zp_res_83699;
                        } else {
                            if (memblock_set(ctx, &ext_mem_90189, &mem_param_90131, "mem_param_90131") != 0)
                                return 1;
                            rescale_res_83693 = eta_p_83685;
                            rescale_res_83694 = eta_p_83686;
                        }
                        ((double *) mem_90161.mem)[i_88984] = rescale_res_83693;
                        ((double *) mem_90163.mem)[i_88984] = rescale_res_83694;
                        lmad_copy_8b(ctx, 1, (uint64_t *) mem_90166.mem, i_88984 * m_33638, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90189.mem, ext_90188, (int64_t []) {ext_90187}, (int64_t []) {m_33638});
                        if (memblock_unref(ctx, &ext_mem_90189, "ext_mem_90189") != 0)
                            return 1;
                    }
                    if (memblock_set(ctx, &ext_mem_90209, &mem_90161, "mem_90161") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90206, &mem_90163, "mem_90163") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90203, &mem_90166, "mem_90166") != 0)
                        return 1;
                } else {
                    if (memblock_set(ctx, &ext_mem_90209, &mem_90153, "mem_90153") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90206, &mem_param_90140, "mem_param_90140") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90203, &mem_param_90131, "mem_param_90131") != 0)
                        return 1;
                }
                if (memblock_unref(ctx, &mem_90153, "mem_90153") != 0)
                    return 1;
                
                bool x_91100 = !defunc_0_reduce_res_83764;
                bool defunc_0_reduce_res_83707;
                
                if (x_91100) {
                    bool x_91102;
                    bool redout_88988 = 0;
                    
                    for (int64_t i_88989 = 0; i_88989 < m_33638; i_88989++) {
                        double eta_p_62780 = ((double *) mem_90145.mem)[i_88989];
                        bool zlze_res_62781 = eta_p_62780 <= zs_res_49813;
                        bool defunc_0_op_res_50953 = zlze_res_62781 || redout_88988;
                        bool redout_tmp_91462 = defunc_0_op_res_50953;
                        
                        redout_88988 = redout_tmp_91462;
                    }
                    x_91102 = redout_88988;
                    defunc_0_reduce_res_83707 = x_91102;
                } else {
                    defunc_0_reduce_res_83707 = 0;
                }
                
                bool cond_50944 = defunc_0_reduce_res_83707 || defunc_0_reduce_res_83764;
                int64_t ext_90252;
                
                if (cond_50944) {
                    ext_90252 = (int64_t) 0;
                } else {
                    ext_90252 = ext_90202;
                }
                
                int64_t ext_90251;
                
                if (cond_50944) {
                    ext_90251 = (int64_t) 1;
                } else {
                    ext_90251 = ext_90201;
                }
                
                int64_t ext_90250;
                
                if (cond_50944) {
                    ext_90250 = m_33638;
                } else {
                    ext_90250 = ext_90200;
                }
                if (cond_50944) {
                    if (memblock_alloc(ctx, &mem_90211, bytes_89415, "mem_90211")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_90213, bytes_89415, "mem_90213")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_90216, bytes_89429, "mem_90216")) {
                        err = 1;
                        goto cleanup;
                    }
                    for (int64_t i_89000 = 0; i_89000 < m_33638; i_89000++) {
                        double eta_p_83726 = ((double *) mem_90145.mem)[i_89000];
                        double eta_p_83727 = ((double *) mem_param_90143.mem)[i_89000];
                        bool zgze_res_83729 = exp_absorb_cutoff_33644 <= eta_p_83726;
                        bool zl_res_83730 = eta_p_83726 < zs_res_49813;
                        bool x_83731 = !zgze_res_83729;
                        bool y_83732 = zl_res_83730 && x_83731;
                        bool cond_83733 = zgze_res_83729 || y_83732;
                        int64_t binop_y_90235 = i_89000 * ext_90200;
                        int64_t lmad_ext_90236 = ext_90202 + binop_y_90235;
                        int64_t ext_90238;
                        
                        if (cond_83733) {
                            ext_90238 = (int64_t) 0;
                        } else {
                            ext_90238 = lmad_ext_90236;
                        }
                        
                        int64_t ext_90237;
                        
                        if (cond_83733) {
                            ext_90237 = (int64_t) 1;
                        } else {
                            ext_90237 = ext_90201;
                        }
                        
                        double rescale_res_83734;
                        double rescale_res_83735;
                        
                        if (cond_83733) {
                            double log_res_83737 = futrts_log64(eta_p_83726);
                            double sqrt_res_83738 = futrts_sqrt64(eta_p_83726);
                            double zs_res_83739 = log_res_83737 / 2.0;
                            double zp_res_83740 = eta_p_83727 + zs_res_83739;
                            
                            if (memblock_alloc(ctx, &mem_90228, bytes_89415, "mem_90228")) {
                                err = 1;
                                goto cleanup;
                            }
                            for (int64_t i_88992 = 0; i_88992 < m_33638; i_88992++) {
                                double eta_p_83742 = ((double *) ext_mem_90203.mem)[ext_90202 + (i_88992 * ext_90201 + i_89000 * ext_90200)];
                                double zt_res_83743 = sqrt_res_83738 * eta_p_83742;
                                
                                ((double *) mem_90228.mem)[i_88992] = zt_res_83743;
                            }
                            if (memblock_set(ctx, &ext_mem_90239, &mem_90228, "mem_90228") != 0)
                                return 1;
                            rescale_res_83734 = sqrt_res_83738;
                            rescale_res_83735 = zp_res_83740;
                        } else {
                            if (memblock_set(ctx, &ext_mem_90239, &ext_mem_90203, "ext_mem_90203") != 0)
                                return 1;
                            rescale_res_83734 = eta_p_83726;
                            rescale_res_83735 = eta_p_83727;
                        }
                        ((double *) mem_90211.mem)[i_89000] = rescale_res_83734;
                        ((double *) mem_90213.mem)[i_89000] = rescale_res_83735;
                        lmad_copy_8b(ctx, 1, (uint64_t *) mem_90216.mem, i_89000 * m_33638, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90239.mem, ext_90238, (int64_t []) {ext_90237}, (int64_t []) {m_33638});
                        if (memblock_unref(ctx, &ext_mem_90239, "ext_mem_90239") != 0)
                            return 1;
                    }
                    if (memblock_set(ctx, &ext_mem_90259, &mem_90211, "mem_90211") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90256, &mem_90213, "mem_90213") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90253, &mem_90216, "mem_90216") != 0)
                        return 1;
                } else {
                    if (memblock_set(ctx, &ext_mem_90259, &mem_90145, "mem_90145") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90256, &mem_param_90143, "mem_param_90143") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90253, &ext_mem_90203, "ext_mem_90203") != 0)
                        return 1;
                }
                if (memblock_unref(ctx, &mem_90145, "mem_90145") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90203, "ext_mem_90203") != 0)
                    return 1;
                
                bool defunc_0_reduce_res_83769;
                bool redout_89004 = 1;
                
                for (int64_t i_89005 = 0; i_89005 < m_33638; i_89005++) {
                    double eta_p_62548 = ((double *) ext_mem_90209.mem)[i_89005];
                    bool isnan_res_62549 = futrts_isnan64(eta_p_62548);
                    bool not_res_62550 = !isnan_res_62549;
                    bool x_50989 = not_res_62550 && redout_89004;
                    bool redout_tmp_91467 = x_50989;
                    
                    redout_89004 = redout_tmp_91467;
                }
                defunc_0_reduce_res_83769 = redout_89004;
                
                bool loop_cond_50990;
                
                if (defunc_0_reduce_res_83769) {
                    bool defunc_0_reduce_comm_res_83751;
                    bool redout_89006 = 0;
                    
                    for (int64_t i_89007 = 0; i_89007 < m_33638; i_89007++) {
                        double eta_p_83752 = ((double *) ext_mem_90209.mem)[i_89007];
                        double eta_p_83753 = ((double *) mem_param_90134.mem)[i_89007];
                        double zt_res_83754 = zp_res_83654 * eta_p_83752;
                        bool zgze_res_83755 = eta_p_83753 <= zt_res_83754;
                        double zt_res_83756 = zp_res_83654 * eta_p_83753;
                        bool zgze_res_83757 = eta_p_83752 <= zt_res_83756;
                        bool x_83758 = zgze_res_83755 && zgze_res_83757;
                        bool not_res_83759 = !x_83758;
                        bool defunc_0_op_res_83762 = not_res_83759 || redout_89006;
                        bool redout_tmp_91468 = defunc_0_op_res_83762;
                        
                        redout_89006 = redout_tmp_91468;
                    }
                    defunc_0_reduce_comm_res_83751 = redout_89006;
                    loop_cond_50990 = defunc_0_reduce_comm_res_83751;
                } else {
                    loop_cond_50990 = 0;
                }
                if (memblock_set(ctx, &mem_param_tmp_91426, &mem_param_90131, "mem_param_90131") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91427, &mem_param_90134, "mem_param_90134") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91428, &mem_param_90140, "mem_param_90140") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91429, &mem_param_90143, "mem_param_90143") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91430, &ext_mem_90253, "ext_mem_90253") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91431, &ext_mem_90209, "ext_mem_90209") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91432, &ext_mem_90259, "ext_mem_90259") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91433, &ext_mem_90206, "ext_mem_90206") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91434, &ext_mem_90256, "ext_mem_90256") != 0)
                    return 1;
                
                int64_t ctx_param_ext_tmp_91435 = ctx_param_ext_90128;
                int64_t ctx_param_ext_tmp_91436 = ctx_param_ext_90129;
                int64_t ctx_param_ext_tmp_91437 = ctx_param_ext_90130;
                int64_t ctx_param_ext_tmp_91438 = ext_90252;
                int64_t ctx_param_ext_tmp_91439 = ext_90251;
                int64_t ctx_param_ext_tmp_91440 = ext_90250;
                bool loop_while_tmp_91441 = loop_cond_50990;
                
                if (memblock_set(ctx, &mem_param_90118, &mem_param_tmp_91426, "mem_param_tmp_91426") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90121, &mem_param_tmp_91427, "mem_param_tmp_91427") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90124, &mem_param_tmp_91428, "mem_param_tmp_91428") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90127, &mem_param_tmp_91429, "mem_param_tmp_91429") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90131, &mem_param_tmp_91430, "mem_param_tmp_91430") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90134, &mem_param_tmp_91431, "mem_param_tmp_91431") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90137, &mem_param_tmp_91432, "mem_param_tmp_91432") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90140, &mem_param_tmp_91433, "mem_param_tmp_91433") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90143, &mem_param_tmp_91434, "mem_param_tmp_91434") != 0)
                    return 1;
                ctx_param_ext_90115 = ctx_param_ext_tmp_91435;
                ctx_param_ext_90116 = ctx_param_ext_tmp_91436;
                ctx_param_ext_90117 = ctx_param_ext_tmp_91437;
                ctx_param_ext_90128 = ctx_param_ext_tmp_91438;
                ctx_param_ext_90129 = ctx_param_ext_tmp_91439;
                ctx_param_ext_90130 = ctx_param_ext_tmp_91440;
                loop_while_50826 = loop_while_tmp_91441;
            }
            if (memblock_set(ctx, &ext_mem_90288, &mem_param_90118, "mem_param_90118") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_90287, &mem_param_90121, "mem_param_90121") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_90286, &mem_param_90124, "mem_param_90124") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_90285, &mem_param_90127, "mem_param_90127") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_90284, &mem_param_90131, "mem_param_90131") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_90283, &mem_param_90134, "mem_param_90134") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_90282, &mem_param_90137, "mem_param_90137") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_90281, &mem_param_90140, "mem_param_90140") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_90280, &mem_param_90143, "mem_param_90143") != 0)
                return 1;
            ext_90279 = ctx_param_ext_90115;
            ext_90278 = ctx_param_ext_90116;
            ext_90277 = ctx_param_ext_90117;
            ext_90270 = ctx_param_ext_90128;
            ext_90269 = ctx_param_ext_90129;
            ext_90268 = ctx_param_ext_90130;
            algo5_core_loop_res_50816 = loop_while_50826;
            if (memblock_unref(ctx, &ext_mem_90061, "ext_mem_90061") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90064, "ext_mem_90064") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90108, "ext_mem_90108") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90111, "ext_mem_90111") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90114, "ext_mem_90114") != 0)
                return 1;
            
            bool defunc_0_reduce_res_84729;
            bool redout_89008 = 1;
            
            for (int64_t i_89009 = 0; i_89009 < m_33638; i_89009++) {
                double eta_p_60682 = ((double *) ext_mem_90283.mem)[i_89009];
                bool isnan_res_60683 = futrts_isnan64(eta_p_60682);
                bool not_res_60684 = !isnan_res_60683;
                bool x_51014 = not_res_60684 && redout_89008;
                bool redout_tmp_91469 = x_51014;
                
                redout_89008 = redout_tmp_91469;
            }
            defunc_0_reduce_res_84729 = redout_89008;
            
            int64_t ext_90567;
            int64_t ext_90566;
            int64_t ext_90565;
            
            if (defunc_0_reduce_res_84729) {
                if (memblock_set(ctx, &ext_mem_90568, &ext_mem_90284, "ext_mem_90284") != 0)
                    return 1;
                ext_90567 = ext_90270;
                ext_90566 = ext_90269;
                ext_90565 = ext_90268;
                if (memblock_set(ctx, &ext_mem_90564, &ext_mem_90283, "ext_mem_90283") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90561, &ext_mem_90282, "ext_mem_90282") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90558, &ext_mem_90281, "ext_mem_90281") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90555, &ext_mem_90280, "ext_mem_90280") != 0)
                    return 1;
            } else {
                if (memblock_alloc(ctx, &mem_90290, bytes_89415, "mem_90290")) {
                    err = 1;
                    goto cleanup;
                }
                
                bool defunc_0_reduce_res_83973;
                bool redout_89013 = 0;
                
                for (int64_t i_89015 = 0; i_89015 < m_33638; i_89015++) {
                    double eta_p_63115 = ((double *) distrs_mem_89412.mem)[eta_p_49442 * m_33638 + i_89015];
                    double eta_p_63116 = ((double *) ext_mem_90285.mem)[i_89015];
                    double defunc_0_reduce_res_83771;
                    double redout_89010 = 0.0;
                    
                    for (int64_t i_89011 = 0; i_89011 < m_33638; i_89011++) {
                        double eta_p_63140 = ((double *) ext_mem_90287.mem)[i_89011];
                        double eta_p_63141 = ((double *) ext_mem_90288.mem)[ext_90279 + (i_89011 * ext_90278 + i_89015 * ext_90277)];
                        double zt_res_63142 = eta_p_63140 * eta_p_63141;
                        double zp_res_63125 = zt_res_63142 + redout_89010;
                        double redout_tmp_91472 = zp_res_63125;
                        
                        redout_89010 = redout_tmp_91472;
                    }
                    defunc_0_reduce_res_83771 = redout_89010;
                    
                    double zs_res_63127 = defunc_0_reduce_res_83771 / eta_p_63115;
                    double ztzt_res_63129 = fpow64(zs_res_63127, zs_res_49436);
                    double zt_res_63131 = zs_res_49437 * eta_p_63116;
                    double exp_res_63133 = futrts_exp64(zt_res_63131);
                    double zt_res_63135 = ztzt_res_63129 * exp_res_63133;
                    bool zgze_res_63137 = exp_absorb_cutoff_33644 <= zt_res_63135;
                    bool defunc_0_op_res_51136 = zgze_res_63137 || redout_89013;
                    
                    ((double *) mem_90290.mem)[i_89015] = zt_res_63135;
                    
                    bool redout_tmp_91470 = defunc_0_op_res_51136;
                    
                    redout_89013 = redout_tmp_91470;
                }
                defunc_0_reduce_res_83973 = redout_89013;
                if (memblock_alloc(ctx, &mem_90298, bytes_89415, "mem_90298")) {
                    err = 1;
                    goto cleanup;
                }
                
                bool defunc_0_reduce_res_83976;
                bool redout_89020 = 0;
                
                for (int64_t i_89022 = 0; i_89022 < m_33638; i_89022++) {
                    double eta_p_63033 = ((double *) distrs_mem_89412.mem)[eta_p_49441 * m_33638 + i_89022];
                    double eta_p_63034 = ((double *) ext_mem_90286.mem)[i_89022];
                    double defunc_0_reduce_res_83772;
                    double redout_89017 = 0.0;
                    
                    for (int64_t i_89018 = 0; i_89018 < m_33638; i_89018++) {
                        double eta_p_63146 = ((double *) mem_90290.mem)[i_89018];
                        double eta_p_63147 = ((double *) ext_mem_90288.mem)[ext_90279 + (i_89022 * ext_90278 + i_89018 * ext_90277)];
                        double zt_res_63148 = eta_p_63146 * eta_p_63147;
                        double zp_res_63043 = zt_res_63148 + redout_89017;
                        double redout_tmp_91475 = zp_res_63043;
                        
                        redout_89017 = redout_tmp_91475;
                    }
                    defunc_0_reduce_res_83772 = redout_89017;
                    
                    double zs_res_63045 = defunc_0_reduce_res_83772 / eta_p_63033;
                    double ztzt_res_63047 = fpow64(zs_res_63045, zs_res_49432);
                    double zt_res_63049 = zs_res_49433 * eta_p_63034;
                    double exp_res_63051 = futrts_exp64(zt_res_63049);
                    double zt_res_63053 = ztzt_res_63047 * exp_res_63051;
                    bool zgze_res_63055 = exp_absorb_cutoff_33644 <= zt_res_63053;
                    bool defunc_0_op_res_51093 = zgze_res_63055 || redout_89020;
                    
                    ((double *) mem_90298.mem)[i_89022] = zt_res_63053;
                    
                    bool redout_tmp_91473 = defunc_0_op_res_51093;
                    
                    redout_89020 = redout_tmp_91473;
                }
                defunc_0_reduce_res_83976 = redout_89020;
                
                bool x_90962 = !defunc_0_reduce_res_83976;
                bool defunc_0_reduce_res_83773;
                
                if (x_90962) {
                    bool x_90964;
                    bool redout_89024 = 0;
                    
                    for (int64_t i_89025 = 0; i_89025 < m_33638; i_89025++) {
                        double eta_p_63152 = ((double *) mem_90298.mem)[i_89025];
                        bool zlze_res_63153 = eta_p_63152 <= zs_res_49813;
                        bool defunc_0_op_res_51103 = zlze_res_63153 || redout_89024;
                        bool redout_tmp_91476 = defunc_0_op_res_51103;
                        
                        redout_89024 = redout_tmp_91476;
                    }
                    x_90964 = redout_89024;
                    defunc_0_reduce_res_83773 = x_90964;
                } else {
                    defunc_0_reduce_res_83773 = 0;
                }
                
                bool cond_51094 = defunc_0_reduce_res_83773 || defunc_0_reduce_res_83976;
                int64_t ext_90347;
                
                if (cond_51094) {
                    ext_90347 = (int64_t) 0;
                } else {
                    ext_90347 = ext_90279;
                }
                
                int64_t ext_90346;
                
                if (cond_51094) {
                    ext_90346 = m_33638;
                } else {
                    ext_90346 = ext_90278;
                }
                
                int64_t ext_90345;
                
                if (cond_51094) {
                    ext_90345 = (int64_t) 1;
                } else {
                    ext_90345 = ext_90277;
                }
                if (cond_51094) {
                    if (memblock_alloc(ctx, &mem_90306, bytes_89415, "mem_90306")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_90308, bytes_89415, "mem_90308")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_90311, bytes_89429, "mem_90311")) {
                        err = 1;
                        goto cleanup;
                    }
                    for (int64_t i_89036 = 0; i_89036 < m_33638; i_89036++) {
                        double eta_p_83790 = ((double *) mem_90298.mem)[i_89036];
                        double eta_p_83791 = ((double *) ext_mem_90286.mem)[i_89036];
                        bool zgze_res_83793 = exp_absorb_cutoff_33644 <= eta_p_83790;
                        bool zl_res_83794 = eta_p_83790 < zs_res_49813;
                        bool x_83795 = !zgze_res_83793;
                        bool y_83796 = zl_res_83794 && x_83795;
                        bool cond_83797 = zgze_res_83793 || y_83796;
                        int64_t binop_y_90330 = i_89036 * ext_90278;
                        int64_t lmad_ext_90331 = ext_90279 + binop_y_90330;
                        int64_t ext_90333;
                        
                        if (cond_83797) {
                            ext_90333 = (int64_t) 0;
                        } else {
                            ext_90333 = lmad_ext_90331;
                        }
                        
                        int64_t ext_90332;
                        
                        if (cond_83797) {
                            ext_90332 = (int64_t) 1;
                        } else {
                            ext_90332 = ext_90277;
                        }
                        
                        double rescale_res_83798;
                        double rescale_res_83799;
                        
                        if (cond_83797) {
                            double log_res_83801 = futrts_log64(eta_p_83790);
                            double sqrt_res_83802 = futrts_sqrt64(eta_p_83790);
                            double zs_res_83803 = log_res_83801 / 2.0;
                            double zp_res_83804 = eta_p_83791 + zs_res_83803;
                            
                            if (memblock_alloc(ctx, &mem_90323, bytes_89415, "mem_90323")) {
                                err = 1;
                                goto cleanup;
                            }
                            for (int64_t i_89028 = 0; i_89028 < m_33638; i_89028++) {
                                double eta_p_83806 = ((double *) ext_mem_90288.mem)[ext_90279 + (i_89036 * ext_90278 + i_89028 * ext_90277)];
                                double zt_res_83807 = sqrt_res_83802 * eta_p_83806;
                                
                                ((double *) mem_90323.mem)[i_89028] = zt_res_83807;
                            }
                            if (memblock_set(ctx, &ext_mem_90334, &mem_90323, "mem_90323") != 0)
                                return 1;
                            rescale_res_83798 = sqrt_res_83802;
                            rescale_res_83799 = zp_res_83804;
                        } else {
                            if (memblock_set(ctx, &ext_mem_90334, &ext_mem_90288, "ext_mem_90288") != 0)
                                return 1;
                            rescale_res_83798 = eta_p_83790;
                            rescale_res_83799 = eta_p_83791;
                        }
                        ((double *) mem_90306.mem)[i_89036] = rescale_res_83798;
                        ((double *) mem_90308.mem)[i_89036] = rescale_res_83799;
                        lmad_copy_8b(ctx, 1, (uint64_t *) mem_90311.mem, i_89036 * m_33638, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90334.mem, ext_90333, (int64_t []) {ext_90332}, (int64_t []) {m_33638});
                        if (memblock_unref(ctx, &ext_mem_90334, "ext_mem_90334") != 0)
                            return 1;
                    }
                    if (memblock_set(ctx, &ext_mem_90354, &mem_90306, "mem_90306") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90351, &mem_90308, "mem_90308") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90348, &mem_90311, "mem_90311") != 0)
                        return 1;
                } else {
                    if (memblock_set(ctx, &ext_mem_90354, &mem_90298, "mem_90298") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90351, &ext_mem_90286, "ext_mem_90286") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90348, &ext_mem_90288, "ext_mem_90288") != 0)
                        return 1;
                }
                if (memblock_unref(ctx, &mem_90298, "mem_90298") != 0)
                    return 1;
                
                bool x_90958 = !defunc_0_reduce_res_83973;
                bool defunc_0_reduce_res_83812;
                
                if (x_90958) {
                    bool x_90960;
                    bool redout_89040 = 0;
                    
                    for (int64_t i_89041 = 0; i_89041 < m_33638; i_89041++) {
                        double eta_p_63195 = ((double *) mem_90290.mem)[i_89041];
                        bool zlze_res_63196 = eta_p_63195 <= zs_res_49813;
                        bool defunc_0_op_res_51146 = zlze_res_63196 || redout_89040;
                        bool redout_tmp_91481 = defunc_0_op_res_51146;
                        
                        redout_89040 = redout_tmp_91481;
                    }
                    x_90960 = redout_89040;
                    defunc_0_reduce_res_83812 = x_90960;
                } else {
                    defunc_0_reduce_res_83812 = 0;
                }
                
                bool cond_51137 = defunc_0_reduce_res_83812 || defunc_0_reduce_res_83973;
                int64_t ext_90397;
                
                if (cond_51137) {
                    ext_90397 = (int64_t) 0;
                } else {
                    ext_90397 = ext_90347;
                }
                
                int64_t ext_90396;
                
                if (cond_51137) {
                    ext_90396 = (int64_t) 1;
                } else {
                    ext_90396 = ext_90346;
                }
                
                int64_t ext_90395;
                
                if (cond_51137) {
                    ext_90395 = m_33638;
                } else {
                    ext_90395 = ext_90345;
                }
                if (cond_51137) {
                    if (memblock_alloc(ctx, &mem_90356, bytes_89415, "mem_90356")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_90358, bytes_89415, "mem_90358")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_90361, bytes_89429, "mem_90361")) {
                        err = 1;
                        goto cleanup;
                    }
                    for (int64_t i_89052 = 0; i_89052 < m_33638; i_89052++) {
                        double eta_p_83831 = ((double *) mem_90290.mem)[i_89052];
                        double eta_p_83832 = ((double *) ext_mem_90285.mem)[i_89052];
                        bool zgze_res_83834 = exp_absorb_cutoff_33644 <= eta_p_83831;
                        bool zl_res_83835 = eta_p_83831 < zs_res_49813;
                        bool x_83836 = !zgze_res_83834;
                        bool y_83837 = zl_res_83835 && x_83836;
                        bool cond_83838 = zgze_res_83834 || y_83837;
                        int64_t binop_y_90380 = i_89052 * ext_90345;
                        int64_t lmad_ext_90381 = ext_90347 + binop_y_90380;
                        int64_t ext_90383;
                        
                        if (cond_83838) {
                            ext_90383 = (int64_t) 0;
                        } else {
                            ext_90383 = lmad_ext_90381;
                        }
                        
                        int64_t ext_90382;
                        
                        if (cond_83838) {
                            ext_90382 = (int64_t) 1;
                        } else {
                            ext_90382 = ext_90346;
                        }
                        
                        double rescale_res_83839;
                        double rescale_res_83840;
                        
                        if (cond_83838) {
                            double log_res_83842 = futrts_log64(eta_p_83831);
                            double sqrt_res_83843 = futrts_sqrt64(eta_p_83831);
                            double zs_res_83844 = log_res_83842 / 2.0;
                            double zp_res_83845 = eta_p_83832 + zs_res_83844;
                            
                            if (memblock_alloc(ctx, &mem_90373, bytes_89415, "mem_90373")) {
                                err = 1;
                                goto cleanup;
                            }
                            for (int64_t i_89044 = 0; i_89044 < m_33638; i_89044++) {
                                double eta_p_83847 = ((double *) ext_mem_90348.mem)[ext_90347 + (i_89044 * ext_90346 + i_89052 * ext_90345)];
                                double zt_res_83848 = sqrt_res_83843 * eta_p_83847;
                                
                                ((double *) mem_90373.mem)[i_89044] = zt_res_83848;
                            }
                            if (memblock_set(ctx, &ext_mem_90384, &mem_90373, "mem_90373") != 0)
                                return 1;
                            rescale_res_83839 = sqrt_res_83843;
                            rescale_res_83840 = zp_res_83845;
                        } else {
                            if (memblock_set(ctx, &ext_mem_90384, &ext_mem_90348, "ext_mem_90348") != 0)
                                return 1;
                            rescale_res_83839 = eta_p_83831;
                            rescale_res_83840 = eta_p_83832;
                        }
                        ((double *) mem_90356.mem)[i_89052] = rescale_res_83839;
                        ((double *) mem_90358.mem)[i_89052] = rescale_res_83840;
                        lmad_copy_8b(ctx, 1, (uint64_t *) mem_90361.mem, i_89052 * m_33638, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90384.mem, ext_90383, (int64_t []) {ext_90382}, (int64_t []) {m_33638});
                        if (memblock_unref(ctx, &ext_mem_90384, "ext_mem_90384") != 0)
                            return 1;
                    }
                    if (memblock_set(ctx, &ext_mem_90404, &mem_90356, "mem_90356") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90401, &mem_90358, "mem_90358") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90398, &mem_90361, "mem_90361") != 0)
                        return 1;
                } else {
                    if (memblock_set(ctx, &ext_mem_90404, &mem_90290, "mem_90290") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90401, &ext_mem_90285, "ext_mem_90285") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90398, &ext_mem_90348, "ext_mem_90348") != 0)
                        return 1;
                }
                if (memblock_unref(ctx, &mem_90290, "mem_90290") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90348, "ext_mem_90348") != 0)
                    return 1;
                
                bool defunc_0_reduce_res_83978;
                bool redout_89056 = 1;
                
                for (int64_t i_89057 = 0; i_89057 < m_33638; i_89057++) {
                    double eta_p_62963 = ((double *) ext_mem_90354.mem)[i_89057];
                    bool isnan_res_62964 = futrts_isnan64(eta_p_62963);
                    bool not_res_62965 = !isnan_res_62964;
                    bool x_51182 = not_res_62965 && redout_89056;
                    bool redout_tmp_91486 = x_51182;
                    
                    redout_89056 = redout_tmp_91486;
                }
                defunc_0_reduce_res_83978 = redout_89056;
                
                bool defunc_0_reduce_comm_res_83856;
                
                if (defunc_0_reduce_res_83978) {
                    bool x_90956;
                    bool redout_89058 = 0;
                    
                    for (int64_t i_89059 = 0; i_89059 < m_33638; i_89059++) {
                        double eta_p_83857 = ((double *) ext_mem_90354.mem)[i_89059];
                        double eta_p_83858 = ((double *) ext_mem_90287.mem)[i_89059];
                        double zt_res_83859 = zp_res_83654 * eta_p_83857;
                        bool zgze_res_83860 = eta_p_83858 <= zt_res_83859;
                        double zt_res_83861 = zp_res_83654 * eta_p_83858;
                        bool zgze_res_83862 = eta_p_83857 <= zt_res_83861;
                        bool x_83863 = zgze_res_83860 && zgze_res_83862;
                        bool not_res_83864 = !x_83863;
                        bool defunc_0_op_res_83867 = not_res_83864 || redout_89058;
                        bool redout_tmp_91487 = defunc_0_op_res_83867;
                        
                        redout_89058 = redout_tmp_91487;
                    }
                    x_90956 = redout_89058;
                    defunc_0_reduce_comm_res_83856 = x_90956;
                } else {
                    defunc_0_reduce_comm_res_83856 = 0;
                }
                
                bool x_91093 = defunc_0_reduce_comm_res_83856 && defunc_0_reduce_res_83978;
                int64_t ext_90547;
                int64_t ext_90546;
                int64_t ext_90545;
                bool algo5_core_loop_res_f_res_51199;
                bool loop_while_51205;
                int64_t ctx_param_ext_90405;
                int64_t ctx_param_ext_90406;
                int64_t ctx_param_ext_90407;
                
                if (memblock_set(ctx, &mem_param_90408, &ext_mem_90398, "ext_mem_90398") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90411, &ext_mem_90354, "ext_mem_90354") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90414, &ext_mem_90404, "ext_mem_90404") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90417, &ext_mem_90351, "ext_mem_90351") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90420, &ext_mem_90401, "ext_mem_90401") != 0)
                    return 1;
                ctx_param_ext_90405 = ext_90397;
                ctx_param_ext_90406 = ext_90396;
                ctx_param_ext_90407 = ext_90395;
                loop_while_51205 = x_91093;
                while (loop_while_51205) {
                    if (memblock_alloc(ctx, &mem_90422, bytes_89415, "mem_90422")) {
                        err = 1;
                        goto cleanup;
                    }
                    
                    bool defunc_0_reduce_res_83967;
                    bool redout_89063 = 0;
                    
                    for (int64_t i_89065 = 0; i_89065 < m_33638; i_89065++) {
                        double eta_p_63418 = ((double *) distrs_mem_89412.mem)[eta_p_49442 * m_33638 + i_89065];
                        double eta_p_63419 = ((double *) mem_param_90420.mem)[i_89065];
                        double defunc_0_reduce_res_83869;
                        double redout_89060 = 0.0;
                        
                        for (int64_t i_89061 = 0; i_89061 < m_33638; i_89061++) {
                            double eta_p_63443 = ((double *) mem_param_90411.mem)[i_89061];
                            double eta_p_63444 = ((double *) mem_param_90408.mem)[ctx_param_ext_90405 + (i_89061 * ctx_param_ext_90406 + i_89065 * ctx_param_ext_90407)];
                            double zt_res_63445 = eta_p_63443 * eta_p_63444;
                            double zp_res_63428 = zt_res_63445 + redout_89060;
                            double redout_tmp_91504 = zp_res_63428;
                            
                            redout_89060 = redout_tmp_91504;
                        }
                        defunc_0_reduce_res_83869 = redout_89060;
                        
                        double zs_res_63430 = defunc_0_reduce_res_83869 / eta_p_63418;
                        double ztzt_res_63432 = fpow64(zs_res_63430, zs_res_49436);
                        double zt_res_63434 = zs_res_49437 * eta_p_63419;
                        double exp_res_63436 = futrts_exp64(zt_res_63434);
                        double zt_res_63438 = ztzt_res_63432 * exp_res_63436;
                        bool zgze_res_63440 = exp_absorb_cutoff_33644 <= zt_res_63438;
                        bool defunc_0_op_res_51318 = zgze_res_63440 || redout_89063;
                        
                        ((double *) mem_90422.mem)[i_89065] = zt_res_63438;
                        
                        bool redout_tmp_91502 = defunc_0_op_res_51318;
                        
                        redout_89063 = redout_tmp_91502;
                    }
                    defunc_0_reduce_res_83967 = redout_89063;
                    if (memblock_alloc(ctx, &mem_90430, bytes_89415, "mem_90430")) {
                        err = 1;
                        goto cleanup;
                    }
                    
                    bool defunc_0_reduce_res_83970;
                    bool redout_89070 = 0;
                    
                    for (int64_t i_89072 = 0; i_89072 < m_33638; i_89072++) {
                        double eta_p_63336 = ((double *) distrs_mem_89412.mem)[eta_p_49441 * m_33638 + i_89072];
                        double eta_p_63337 = ((double *) mem_param_90417.mem)[i_89072];
                        double defunc_0_reduce_res_83870;
                        double redout_89067 = 0.0;
                        
                        for (int64_t i_89068 = 0; i_89068 < m_33638; i_89068++) {
                            double eta_p_63449 = ((double *) mem_90422.mem)[i_89068];
                            double eta_p_63450 = ((double *) mem_param_90408.mem)[ctx_param_ext_90405 + (i_89072 * ctx_param_ext_90406 + i_89068 * ctx_param_ext_90407)];
                            double zt_res_63451 = eta_p_63449 * eta_p_63450;
                            double zp_res_63346 = zt_res_63451 + redout_89067;
                            double redout_tmp_91507 = zp_res_63346;
                            
                            redout_89067 = redout_tmp_91507;
                        }
                        defunc_0_reduce_res_83870 = redout_89067;
                        
                        double zs_res_63348 = defunc_0_reduce_res_83870 / eta_p_63336;
                        double ztzt_res_63350 = fpow64(zs_res_63348, zs_res_49432);
                        double zt_res_63352 = zs_res_49433 * eta_p_63337;
                        double exp_res_63354 = futrts_exp64(zt_res_63352);
                        double zt_res_63356 = ztzt_res_63350 * exp_res_63354;
                        bool zgze_res_63358 = exp_absorb_cutoff_33644 <= zt_res_63356;
                        bool defunc_0_op_res_51275 = zgze_res_63358 || redout_89070;
                        
                        ((double *) mem_90430.mem)[i_89072] = zt_res_63356;
                        
                        bool redout_tmp_91505 = defunc_0_op_res_51275;
                        
                        redout_89070 = redout_tmp_91505;
                    }
                    defunc_0_reduce_res_83970 = redout_89070;
                    
                    bool x_90950 = !defunc_0_reduce_res_83970;
                    bool defunc_0_reduce_res_83871;
                    
                    if (x_90950) {
                        bool x_90952;
                        bool redout_89074 = 0;
                        
                        for (int64_t i_89075 = 0; i_89075 < m_33638; i_89075++) {
                            double eta_p_63455 = ((double *) mem_90430.mem)[i_89075];
                            bool zlze_res_63456 = eta_p_63455 <= zs_res_49813;
                            bool defunc_0_op_res_51285 = zlze_res_63456 || redout_89074;
                            bool redout_tmp_91508 = defunc_0_op_res_51285;
                            
                            redout_89074 = redout_tmp_91508;
                        }
                        x_90952 = redout_89074;
                        defunc_0_reduce_res_83871 = x_90952;
                    } else {
                        defunc_0_reduce_res_83871 = 0;
                    }
                    
                    bool cond_51276 = defunc_0_reduce_res_83871 || defunc_0_reduce_res_83970;
                    int64_t ext_90479;
                    
                    if (cond_51276) {
                        ext_90479 = (int64_t) 0;
                    } else {
                        ext_90479 = ctx_param_ext_90405;
                    }
                    
                    int64_t ext_90478;
                    
                    if (cond_51276) {
                        ext_90478 = m_33638;
                    } else {
                        ext_90478 = ctx_param_ext_90406;
                    }
                    
                    int64_t ext_90477;
                    
                    if (cond_51276) {
                        ext_90477 = (int64_t) 1;
                    } else {
                        ext_90477 = ctx_param_ext_90407;
                    }
                    if (cond_51276) {
                        if (memblock_alloc(ctx, &mem_90438, bytes_89415, "mem_90438")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (memblock_alloc(ctx, &mem_90440, bytes_89415, "mem_90440")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (memblock_alloc(ctx, &mem_90443, bytes_89429, "mem_90443")) {
                            err = 1;
                            goto cleanup;
                        }
                        for (int64_t i_89086 = 0; i_89086 < m_33638; i_89086++) {
                            double eta_p_83888 = ((double *) mem_90430.mem)[i_89086];
                            double eta_p_83889 = ((double *) mem_param_90417.mem)[i_89086];
                            bool zgze_res_83891 = exp_absorb_cutoff_33644 <= eta_p_83888;
                            bool zl_res_83892 = eta_p_83888 < zs_res_49813;
                            bool x_83893 = !zgze_res_83891;
                            bool y_83894 = zl_res_83892 && x_83893;
                            bool cond_83895 = zgze_res_83891 || y_83894;
                            int64_t binop_y_90462 = i_89086 * ctx_param_ext_90406;
                            int64_t lmad_ext_90463 = ctx_param_ext_90405 + binop_y_90462;
                            int64_t ext_90465;
                            
                            if (cond_83895) {
                                ext_90465 = (int64_t) 0;
                            } else {
                                ext_90465 = lmad_ext_90463;
                            }
                            
                            int64_t ext_90464;
                            
                            if (cond_83895) {
                                ext_90464 = (int64_t) 1;
                            } else {
                                ext_90464 = ctx_param_ext_90407;
                            }
                            
                            double rescale_res_83896;
                            double rescale_res_83897;
                            
                            if (cond_83895) {
                                double log_res_83899 = futrts_log64(eta_p_83888);
                                double sqrt_res_83900 = futrts_sqrt64(eta_p_83888);
                                double zs_res_83901 = log_res_83899 / 2.0;
                                double zp_res_83902 = eta_p_83889 + zs_res_83901;
                                
                                if (memblock_alloc(ctx, &mem_90455, bytes_89415, "mem_90455")) {
                                    err = 1;
                                    goto cleanup;
                                }
                                for (int64_t i_89078 = 0; i_89078 < m_33638; i_89078++) {
                                    double eta_p_83904 = ((double *) mem_param_90408.mem)[ctx_param_ext_90405 + (i_89086 * ctx_param_ext_90406 + i_89078 * ctx_param_ext_90407)];
                                    double zt_res_83905 = sqrt_res_83900 * eta_p_83904;
                                    
                                    ((double *) mem_90455.mem)[i_89078] = zt_res_83905;
                                }
                                if (memblock_set(ctx, &ext_mem_90466, &mem_90455, "mem_90455") != 0)
                                    return 1;
                                rescale_res_83896 = sqrt_res_83900;
                                rescale_res_83897 = zp_res_83902;
                            } else {
                                if (memblock_set(ctx, &ext_mem_90466, &mem_param_90408, "mem_param_90408") != 0)
                                    return 1;
                                rescale_res_83896 = eta_p_83888;
                                rescale_res_83897 = eta_p_83889;
                            }
                            ((double *) mem_90438.mem)[i_89086] = rescale_res_83896;
                            ((double *) mem_90440.mem)[i_89086] = rescale_res_83897;
                            lmad_copy_8b(ctx, 1, (uint64_t *) mem_90443.mem, i_89086 * m_33638, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90466.mem, ext_90465, (int64_t []) {ext_90464}, (int64_t []) {m_33638});
                            if (memblock_unref(ctx, &ext_mem_90466, "ext_mem_90466") != 0)
                                return 1;
                        }
                        if (memblock_set(ctx, &ext_mem_90486, &mem_90438, "mem_90438") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90483, &mem_90440, "mem_90440") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90480, &mem_90443, "mem_90443") != 0)
                            return 1;
                    } else {
                        if (memblock_set(ctx, &ext_mem_90486, &mem_90430, "mem_90430") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90483, &mem_param_90417, "mem_param_90417") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90480, &mem_param_90408, "mem_param_90408") != 0)
                            return 1;
                    }
                    if (memblock_unref(ctx, &mem_90430, "mem_90430") != 0)
                        return 1;
                    
                    bool x_91096 = !defunc_0_reduce_res_83967;
                    bool defunc_0_reduce_res_83910;
                    
                    if (x_91096) {
                        bool x_91098;
                        bool redout_89090 = 0;
                        
                        for (int64_t i_89091 = 0; i_89091 < m_33638; i_89091++) {
                            double eta_p_63498 = ((double *) mem_90422.mem)[i_89091];
                            bool zlze_res_63499 = eta_p_63498 <= zs_res_49813;
                            bool defunc_0_op_res_51328 = zlze_res_63499 || redout_89090;
                            bool redout_tmp_91513 = defunc_0_op_res_51328;
                            
                            redout_89090 = redout_tmp_91513;
                        }
                        x_91098 = redout_89090;
                        defunc_0_reduce_res_83910 = x_91098;
                    } else {
                        defunc_0_reduce_res_83910 = 0;
                    }
                    
                    bool cond_51319 = defunc_0_reduce_res_83910 || defunc_0_reduce_res_83967;
                    int64_t ext_90529;
                    
                    if (cond_51319) {
                        ext_90529 = (int64_t) 0;
                    } else {
                        ext_90529 = ext_90479;
                    }
                    
                    int64_t ext_90528;
                    
                    if (cond_51319) {
                        ext_90528 = (int64_t) 1;
                    } else {
                        ext_90528 = ext_90478;
                    }
                    
                    int64_t ext_90527;
                    
                    if (cond_51319) {
                        ext_90527 = m_33638;
                    } else {
                        ext_90527 = ext_90477;
                    }
                    if (cond_51319) {
                        if (memblock_alloc(ctx, &mem_90488, bytes_89415, "mem_90488")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (memblock_alloc(ctx, &mem_90490, bytes_89415, "mem_90490")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (memblock_alloc(ctx, &mem_90493, bytes_89429, "mem_90493")) {
                            err = 1;
                            goto cleanup;
                        }
                        for (int64_t i_89102 = 0; i_89102 < m_33638; i_89102++) {
                            double eta_p_83929 = ((double *) mem_90422.mem)[i_89102];
                            double eta_p_83930 = ((double *) mem_param_90420.mem)[i_89102];
                            bool zgze_res_83932 = exp_absorb_cutoff_33644 <= eta_p_83929;
                            bool zl_res_83933 = eta_p_83929 < zs_res_49813;
                            bool x_83934 = !zgze_res_83932;
                            bool y_83935 = zl_res_83933 && x_83934;
                            bool cond_83936 = zgze_res_83932 || y_83935;
                            int64_t binop_y_90512 = i_89102 * ext_90477;
                            int64_t lmad_ext_90513 = ext_90479 + binop_y_90512;
                            int64_t ext_90515;
                            
                            if (cond_83936) {
                                ext_90515 = (int64_t) 0;
                            } else {
                                ext_90515 = lmad_ext_90513;
                            }
                            
                            int64_t ext_90514;
                            
                            if (cond_83936) {
                                ext_90514 = (int64_t) 1;
                            } else {
                                ext_90514 = ext_90478;
                            }
                            
                            double rescale_res_83937;
                            double rescale_res_83938;
                            
                            if (cond_83936) {
                                double log_res_83940 = futrts_log64(eta_p_83929);
                                double sqrt_res_83941 = futrts_sqrt64(eta_p_83929);
                                double zs_res_83942 = log_res_83940 / 2.0;
                                double zp_res_83943 = eta_p_83930 + zs_res_83942;
                                
                                if (memblock_alloc(ctx, &mem_90505, bytes_89415, "mem_90505")) {
                                    err = 1;
                                    goto cleanup;
                                }
                                for (int64_t i_89094 = 0; i_89094 < m_33638; i_89094++) {
                                    double eta_p_83945 = ((double *) ext_mem_90480.mem)[ext_90479 + (i_89094 * ext_90478 + i_89102 * ext_90477)];
                                    double zt_res_83946 = sqrt_res_83941 * eta_p_83945;
                                    
                                    ((double *) mem_90505.mem)[i_89094] = zt_res_83946;
                                }
                                if (memblock_set(ctx, &ext_mem_90516, &mem_90505, "mem_90505") != 0)
                                    return 1;
                                rescale_res_83937 = sqrt_res_83941;
                                rescale_res_83938 = zp_res_83943;
                            } else {
                                if (memblock_set(ctx, &ext_mem_90516, &ext_mem_90480, "ext_mem_90480") != 0)
                                    return 1;
                                rescale_res_83937 = eta_p_83929;
                                rescale_res_83938 = eta_p_83930;
                            }
                            ((double *) mem_90488.mem)[i_89102] = rescale_res_83937;
                            ((double *) mem_90490.mem)[i_89102] = rescale_res_83938;
                            lmad_copy_8b(ctx, 1, (uint64_t *) mem_90493.mem, i_89102 * m_33638, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90516.mem, ext_90515, (int64_t []) {ext_90514}, (int64_t []) {m_33638});
                            if (memblock_unref(ctx, &ext_mem_90516, "ext_mem_90516") != 0)
                                return 1;
                        }
                        if (memblock_set(ctx, &ext_mem_90536, &mem_90488, "mem_90488") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90533, &mem_90490, "mem_90490") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90530, &mem_90493, "mem_90493") != 0)
                            return 1;
                    } else {
                        if (memblock_set(ctx, &ext_mem_90536, &mem_90422, "mem_90422") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90533, &mem_param_90420, "mem_param_90420") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90530, &ext_mem_90480, "ext_mem_90480") != 0)
                            return 1;
                    }
                    if (memblock_unref(ctx, &mem_90422, "mem_90422") != 0)
                        return 1;
                    if (memblock_unref(ctx, &ext_mem_90480, "ext_mem_90480") != 0)
                        return 1;
                    
                    bool defunc_0_reduce_res_83972;
                    bool redout_89106 = 1;
                    
                    for (int64_t i_89107 = 0; i_89107 < m_33638; i_89107++) {
                        double eta_p_63266 = ((double *) ext_mem_90486.mem)[i_89107];
                        bool isnan_res_63267 = futrts_isnan64(eta_p_63266);
                        bool not_res_63268 = !isnan_res_63267;
                        bool x_51364 = not_res_63268 && redout_89106;
                        bool redout_tmp_91518 = x_51364;
                        
                        redout_89106 = redout_tmp_91518;
                    }
                    defunc_0_reduce_res_83972 = redout_89106;
                    
                    bool loop_cond_51365;
                    
                    if (defunc_0_reduce_res_83972) {
                        bool defunc_0_reduce_comm_res_83954;
                        bool redout_89108 = 0;
                        
                        for (int64_t i_89109 = 0; i_89109 < m_33638; i_89109++) {
                            double eta_p_83955 = ((double *) ext_mem_90486.mem)[i_89109];
                            double eta_p_83956 = ((double *) mem_param_90411.mem)[i_89109];
                            double zt_res_83957 = zp_res_83654 * eta_p_83955;
                            bool zgze_res_83958 = eta_p_83956 <= zt_res_83957;
                            double zt_res_83959 = zp_res_83654 * eta_p_83956;
                            bool zgze_res_83960 = eta_p_83955 <= zt_res_83959;
                            bool x_83961 = zgze_res_83958 && zgze_res_83960;
                            bool not_res_83962 = !x_83961;
                            bool defunc_0_op_res_83965 = not_res_83962 || redout_89108;
                            bool redout_tmp_91519 = defunc_0_op_res_83965;
                            
                            redout_89108 = redout_tmp_91519;
                        }
                        defunc_0_reduce_comm_res_83954 = redout_89108;
                        loop_cond_51365 = defunc_0_reduce_comm_res_83954;
                    } else {
                        loop_cond_51365 = 0;
                    }
                    if (memblock_set(ctx, &mem_param_tmp_91488, &ext_mem_90530, "ext_mem_90530") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_91489, &ext_mem_90486, "ext_mem_90486") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_91490, &ext_mem_90536, "ext_mem_90536") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_91491, &ext_mem_90483, "ext_mem_90483") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_91492, &ext_mem_90533, "ext_mem_90533") != 0)
                        return 1;
                    
                    int64_t ctx_param_ext_tmp_91493 = ext_90529;
                    int64_t ctx_param_ext_tmp_91494 = ext_90528;
                    int64_t ctx_param_ext_tmp_91495 = ext_90527;
                    bool loop_while_tmp_91496 = loop_cond_51365;
                    
                    if (memblock_set(ctx, &mem_param_90408, &mem_param_tmp_91488, "mem_param_tmp_91488") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_90411, &mem_param_tmp_91489, "mem_param_tmp_91489") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_90414, &mem_param_tmp_91490, "mem_param_tmp_91490") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_90417, &mem_param_tmp_91491, "mem_param_tmp_91491") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_90420, &mem_param_tmp_91492, "mem_param_tmp_91492") != 0)
                        return 1;
                    ctx_param_ext_90405 = ctx_param_ext_tmp_91493;
                    ctx_param_ext_90406 = ctx_param_ext_tmp_91494;
                    ctx_param_ext_90407 = ctx_param_ext_tmp_91495;
                    loop_while_51205 = loop_while_tmp_91496;
                }
                if (memblock_set(ctx, &ext_mem_90552, &mem_param_90408, "mem_param_90408") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90551, &mem_param_90411, "mem_param_90411") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90550, &mem_param_90414, "mem_param_90414") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90549, &mem_param_90417, "mem_param_90417") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90548, &mem_param_90420, "mem_param_90420") != 0)
                    return 1;
                ext_90547 = ctx_param_ext_90405;
                ext_90546 = ctx_param_ext_90406;
                ext_90545 = ctx_param_ext_90407;
                algo5_core_loop_res_f_res_51199 = loop_while_51205;
                if (memblock_unref(ctx, &ext_mem_90351, "ext_mem_90351") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90354, "ext_mem_90354") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90398, "ext_mem_90398") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90401, "ext_mem_90401") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90404, "ext_mem_90404") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90568, &ext_mem_90552, "ext_mem_90552") != 0)
                    return 1;
                ext_90567 = ext_90547;
                ext_90566 = ext_90546;
                ext_90565 = ext_90545;
                if (memblock_set(ctx, &ext_mem_90564, &ext_mem_90551, "ext_mem_90551") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90561, &ext_mem_90550, "ext_mem_90550") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90558, &ext_mem_90549, "ext_mem_90549") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90555, &ext_mem_90548, "ext_mem_90548") != 0)
                    return 1;
            }
            if (memblock_unref(ctx, &ext_mem_90280, "ext_mem_90280") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90281, "ext_mem_90281") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90282, "ext_mem_90282") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90283, "ext_mem_90283") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90284, "ext_mem_90284") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90285, "ext_mem_90285") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90286, "ext_mem_90286") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90287, "ext_mem_90287") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90288, "ext_mem_90288") != 0)
                return 1;
            if (memblock_alloc(ctx, &mem_90570, bytes_89415, "mem_90570")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc(ctx, &mem_90575, bytes_89415, "mem_90575")) {
                err = 1;
                goto cleanup;
            }
            
            double defunc_res_84730;
            double redout_89118 = 0.0;
            
            for (int64_t i_89122 = 0; i_89122 < m_33638; i_89122++) {
                double eta_p_79178 = ((double *) ext_mem_90561.mem)[i_89122];
                double eta_p_79179 = ((double *) ext_mem_90555.mem)[i_89122];
                double eta_p_79181 = ((double *) ext_mem_90564.mem)[i_89122];
                double eta_p_79182 = ((double *) ext_mem_90558.mem)[i_89122];
                double log_res_79183 = futrts_log64(eta_p_79181);
                double zp_res_79184 = eta_p_79182 + log_res_79183;
                double defunc_res_83979;
                double redout_89111 = 0.0;
                
                for (int64_t i_89113 = 0; i_89113 < m_33638; i_89113++) {
                    double eta_p_79685 = ((double *) ext_mem_90568.mem)[ext_90567 + (i_89122 * ext_90566 + i_89113 * ext_90565)];
                    double eta_p_wasfree_79686 = ((double *) ext_mem_90561.mem)[i_89113];
                    double zt_res_79687 = eta_p_79181 * eta_p_79685;
                    double zt_res_79688 = eta_p_wasfree_79686 * zt_res_79687;
                    double zp_res_79199 = zt_res_79688 + redout_89111;
                    
                    ((double *) mem_90573)[i_89122 * m_33638 + i_89113] = zt_res_79688;
                    
                    double redout_tmp_91524 = zp_res_79199;
                    
                    redout_89111 = redout_tmp_91524;
                }
                defunc_res_83979 = redout_89111;
                
                double log_res_79190 = futrts_log64(eta_p_79178);
                double zp_res_79191 = eta_p_79179 + log_res_79190;
                double zp_res_51420 = defunc_res_83979 + redout_89118;
                
                ((double *) mem_90570.mem)[i_89122] = zp_res_79191;
                ((double *) mem_90575.mem)[i_89122] = zp_res_79184;
                
                double redout_tmp_91520 = zp_res_51420;
                
                redout_89118 = redout_tmp_91520;
            }
            defunc_res_84730 = redout_89118;
            if (memblock_unref(ctx, &ext_mem_90555, "ext_mem_90555") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90558, "ext_mem_90558") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90561, "ext_mem_90561") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90564, "ext_mem_90564") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90568, "ext_mem_90568") != 0)
                return 1;
            
            bool zg_res_51421 = 0.0 < defunc_res_84730;
            double zs_res_51422 = defunc_res_84712 / defunc_res_84730;
            double sqrt_res_51423 = futrts_sqrt64(zs_res_51422);
            double descent_res_51427;
            
            if (zg_res_51421) {
                if (mem_90610_cached_sizze_91777 < bytes_89415) {
                    err = lexical_realloc(ctx, &mem_90610, &mem_90610_cached_sizze_91777, bytes_89415);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (mem_90612_cached_sizze_91778 < bytes_89415) {
                    err = lexical_realloc(ctx, &mem_90612, &mem_90612_cached_sizze_91778, bytes_89415);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (mem_90614_cached_sizze_91779 < bytes_89415) {
                    err = lexical_realloc(ctx, &mem_90614, &mem_90614_cached_sizze_91779, bytes_89415);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                
                double defunc_res_84078;
                double defunc_res_84079;
                double defunc_res_84080;
                double redout_89133;
                double redout_89134;
                double redout_89135;
                
                redout_89133 = 0.0;
                redout_89134 = 0.0;
                redout_89135 = 0.0;
                for (int64_t i_89139 = 0; i_89139 < m_33638; i_89139++) {
                    double x_84084 = ((double *) distrs_mem_89412.mem)[eta_p_49442 * m_33638 + i_89139];
                    double log_res_84086 = futrts_log64(x_84084);
                    double defunc_res_84087;
                    double defunc_res_84088;
                    double defunc_res_84089;
                    double redout_89126;
                    double redout_89127;
                    double redout_89128;
                    
                    redout_89126 = 0.0;
                    redout_89127 = 0.0;
                    redout_89128 = 0.0;
                    for (int64_t i_89129 = 0; i_89129 < m_33638; i_89129++) {
                        double x_84090 = ((double *) mem_param_89888.mem)[i_89129 * m_33638 + i_89139];
                        double zp_res_84093 = x_84090 + redout_89126;
                        double zp_res_84096 = x_84090 + redout_89127;
                        double zp_res_84099 = x_84090 + redout_89128;
                        double redout_tmp_91532 = zp_res_84093;
                        double redout_tmp_91533 = zp_res_84096;
                        double redout_tmp_91534 = zp_res_84099;
                        
                        redout_89126 = redout_tmp_91532;
                        redout_89127 = redout_tmp_91533;
                        redout_89128 = redout_tmp_91534;
                    }
                    defunc_res_84087 = redout_89126;
                    defunc_res_84088 = redout_89127;
                    defunc_res_84089 = redout_89128;
                    
                    bool zeze_res_84103 = defunc_res_84087 == 0.0;
                    double klu_res_84104;
                    
                    if (zeze_res_84103) {
                        klu_res_84104 = 0.0;
                    } else {
                        double zs_res_84105 = defunc_res_84087 / x_84084;
                        double log_res_84106 = futrts_log64(zs_res_84105);
                        double zt_res_84107 = defunc_res_84087 * log_res_84106;
                        
                        klu_res_84104 = zt_res_84107;
                    }
                    
                    double zp_res_84110 = klu_res_84104 + redout_89133;
                    double zp_res_84113 = x_84084 + redout_89134;
                    double zp_res_84116 = defunc_res_84089 + redout_89135;
                    
                    ((double *) mem_90610)[i_89139] = defunc_res_84088;
                    ((double *) mem_90612)[i_89139] = defunc_res_84087;
                    ((double *) mem_90614)[i_89139] = log_res_84086;
                    
                    double redout_tmp_91526 = zp_res_84110;
                    double redout_tmp_91527 = zp_res_84113;
                    double redout_tmp_91528 = zp_res_84116;
                    
                    redout_89133 = redout_tmp_91526;
                    redout_89134 = redout_tmp_91527;
                    redout_89135 = redout_tmp_91528;
                }
                defunc_res_84078 = redout_89133;
                defunc_res_84079 = redout_89134;
                defunc_res_84080 = redout_89135;
                
                double zm_res_84123 = defunc_res_84078 - defunc_res_84080;
                double zt_res_84124 = 2.0 * zm_res_84123;
                double zt_res_84125 = 2.0 * defunc_res_84080;
                
                if (mem_90635_cached_sizze_91780 < bytes_89429) {
                    err = lexical_realloc(ctx, &mem_90635, &mem_90635_cached_sizze_91780, bytes_89429);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                for (int64_t i_89145 = 0; i_89145 < m_33638; i_89145++) {
                    double eta_p_84127 = ((double *) mem_90612)[i_89145];
                    double eta_p_84128 = ((double *) distrs_mem_89412.mem)[eta_p_49442 * m_33638 + i_89145];
                    double log_res_84129 = futrts_log64(eta_p_84127);
                    double log_res_84130 = futrts_log64(eta_p_84128);
                    double zm_res_84131 = log_res_84129 - log_res_84130;
                    double zp_res_84132 = 1.0 + zm_res_84131;
                    double fma_res_84133 = futrts_fma64(zt_res_84125, zp_res_84132, zt_res_84124);
                    
                    for (int64_t nest_i_91536 = 0; nest_i_91536 < m_33638; nest_i_91536++) {
                        ((double *) mem_90635)[i_89145 * m_33638 + nest_i_91536] = fma_res_84133;
                    }
                }
                if (mem_90647_cached_sizze_91781 < bytes_89415) {
                    err = lexical_realloc(ctx, &mem_90647, &mem_90647_cached_sizze_91781, bytes_89415);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (mem_90649_cached_sizze_91782 < bytes_89415) {
                    err = lexical_realloc(ctx, &mem_90649, &mem_90649_cached_sizze_91782, bytes_89415);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                
                double defunc_res_84136;
                double defunc_res_84137;
                double defunc_res_84138;
                double defunc_res_84139;
                double redout_89155;
                double redout_89156;
                double redout_89157;
                double redout_89158;
                
                redout_89155 = 0.0;
                redout_89156 = 0.0;
                redout_89157 = 0.0;
                redout_89158 = 0.0;
                for (int64_t i_89161 = 0; i_89161 < m_33638; i_89161++) {
                    double eta_p_84143 = ((double *) distrs_mem_89412.mem)[eta_p_49441 * m_33638 + i_89161];
                    double defunc_res_84144;
                    double defunc_res_84145;
                    double defunc_res_84146;
                    double defunc_res_84147;
                    double defunc_res_84148;
                    double redout_89147;
                    double redout_89148;
                    double redout_89149;
                    double redout_89150;
                    double redout_89151;
                    
                    redout_89147 = 0.0;
                    redout_89148 = 0.0;
                    redout_89149 = 0.0;
                    redout_89150 = 0.0;
                    redout_89151 = 0.0;
                    for (int64_t i_89152 = 0; i_89152 < m_33638; i_89152++) {
                        double x_84149 = ((double *) mem_param_89888.mem)[i_89161 * m_33638 + i_89152];
                        double eta_p_84150 = ((double *) distrs_mem_89412.mem)[eta_p_49442 * m_33638 + i_89152];
                        double zt_res_84151 = eta_p_84143 * eta_p_84150;
                        bool zeze_res_84152 = x_84149 == 0.0;
                        double klu_res_84153;
                        
                        if (zeze_res_84152) {
                            klu_res_84153 = 0.0;
                        } else {
                            double zs_res_84154 = x_84149 / zt_res_84151;
                            double log_res_84155 = futrts_log64(zs_res_84154);
                            double zt_res_84156 = x_84149 * log_res_84155;
                            
                            klu_res_84153 = zt_res_84156;
                        }
                        
                        double zp_res_84159 = x_84149 + redout_89147;
                        double zp_res_84162 = klu_res_84153 + redout_89148;
                        double zp_res_84165 = x_84149 + redout_89149;
                        double zp_res_84168 = x_84149 + redout_89150;
                        double zp_res_84171 = x_84149 + redout_89151;
                        double redout_tmp_91543 = zp_res_84159;
                        double redout_tmp_91544 = zp_res_84162;
                        double redout_tmp_91545 = zp_res_84165;
                        double redout_tmp_91546 = zp_res_84168;
                        double redout_tmp_91547 = zp_res_84171;
                        
                        redout_89147 = redout_tmp_91543;
                        redout_89148 = redout_tmp_91544;
                        redout_89149 = redout_tmp_91545;
                        redout_89150 = redout_tmp_91546;
                        redout_89151 = redout_tmp_91547;
                    }
                    defunc_res_84144 = redout_89147;
                    defunc_res_84145 = redout_89148;
                    defunc_res_84146 = redout_89149;
                    defunc_res_84147 = redout_89150;
                    defunc_res_84148 = redout_89151;
                    
                    bool zeze_res_84177 = defunc_res_84148 == 0.0;
                    double klu_res_84178;
                    
                    if (zeze_res_84177) {
                        klu_res_84178 = 0.0;
                    } else {
                        double zs_res_84179 = defunc_res_84148 / eta_p_84143;
                        double log_res_84180 = futrts_log64(zs_res_84179);
                        double zt_res_84181 = defunc_res_84148 * log_res_84180;
                        
                        klu_res_84178 = zt_res_84181;
                    }
                    
                    double zp_res_84184 = defunc_res_84144 + redout_89155;
                    double zp_res_84187 = defunc_res_84145 + redout_89156;
                    double zp_res_84190 = defunc_res_84147 + redout_89157;
                    double zp_res_84193 = klu_res_84178 + redout_89158;
                    
                    ((double *) mem_90647)[i_89161] = defunc_res_84148;
                    ((double *) mem_90649)[i_89161] = defunc_res_84146;
                    
                    double redout_tmp_91537 = zp_res_84184;
                    double redout_tmp_91538 = zp_res_84187;
                    double redout_tmp_91539 = zp_res_84190;
                    double redout_tmp_91540 = zp_res_84193;
                    
                    redout_89155 = redout_tmp_91537;
                    redout_89156 = redout_tmp_91538;
                    redout_89157 = redout_tmp_91539;
                    redout_89158 = redout_tmp_91540;
                }
                defunc_res_84136 = redout_89155;
                defunc_res_84137 = redout_89156;
                defunc_res_84138 = redout_89157;
                defunc_res_84139 = redout_89158;
                
                double zm_res_84200 = defunc_res_84139 - defunc_res_84138;
                double zt_res_84201 = 2.0 * zm_res_84200;
                double zt_res_84202 = 2.0 * defunc_res_84138;
                
                if (mem_90663_cached_sizze_91783 < bytes_89415) {
                    err = lexical_realloc(ctx, &mem_90663, &mem_90663_cached_sizze_91783, bytes_89415);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                for (int64_t i_89168 = 0; i_89168 < m_33638; i_89168++) {
                    double defunc_0_reduce_res_84205;
                    double redout_89164 = 0.0;
                    
                    for (int64_t i_89165 = 0; i_89165 < m_33638; i_89165++) {
                        double eta_p_84206 = ((double *) A_mem_89411.mem)[eta_p_49442 * (m_33638 * m_33638) + i_89168 * m_33638 + i_89165];
                        double eta_p_84207 = ((double *) mem_90610)[i_89165];
                        double zt_res_84208 = eta_p_84206 * eta_p_84206;
                        double zt_res_84209 = eta_p_84207 * zt_res_84208;
                        double zp_res_84212 = zt_res_84209 + redout_89164;
                        double redout_tmp_91549 = zp_res_84212;
                        
                        redout_89164 = redout_tmp_91549;
                    }
                    defunc_0_reduce_res_84205 = redout_89164;
                    ((double *) mem_90663)[i_89168] = defunc_0_reduce_res_84205;
                }
                
                double zt_res_84215 = 2.0 * defunc_res_84136;
                double zt_res_84216 = 2.0 * defunc_res_84137;
                
                if (mem_90671_cached_sizze_91784 < bytes_89415) {
                    err = lexical_realloc(ctx, &mem_90671, &mem_90671_cached_sizze_91784, bytes_89415);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (mem_90674_cached_sizze_91785 < bytes_89429) {
                    err = lexical_realloc(ctx, &mem_90674, &mem_90674_cached_sizze_91785, bytes_89429);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_90677, bytes_89429, "mem_90677")) {
                    err = 1;
                    goto cleanup;
                }
                if (mem_90690_cached_sizze_91786 < bytes_89415) {
                    err = lexical_realloc(ctx, &mem_90690, &mem_90690_cached_sizze_91786, bytes_89415);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                
                double defunc_res_84220;
                double defunc_res_84221;
                double defunc_res_84222;
                double defunc_res_84223;
                double defunc_res_84224;
                double redout_89194;
                double redout_89195;
                double redout_89196;
                double redout_89197;
                double redout_89198;
                
                redout_89194 = 0.0;
                redout_89195 = 0.0;
                redout_89196 = 0.0;
                redout_89197 = 0.0;
                redout_89198 = 0.0;
                for (int64_t i_89202 = 0; i_89202 < m_33638; i_89202++) {
                    double x_84228 = ((double *) distrs_mem_89412.mem)[eta_p_49441 * m_33638 + i_89202];
                    double eta_p_84232 = ((double *) mem_90647)[i_89202];
                    double log_res_84236 = futrts_log64(x_84228);
                    double log_res_84237 = futrts_log64(eta_p_84232);
                    double zm_res_84238 = log_res_84237 - log_res_84236;
                    double zp_res_84239 = 1.0 + zm_res_84238;
                    double fma_res_84240 = futrts_fma64(zt_res_84202, zp_res_84239, zt_res_84201);
                    
                    for (int64_t i_89174 = 0; i_89174 < m_33638; i_89174++) {
                        double defunc_0_reduce_res_84243;
                        double redout_89170 = 0.0;
                        
                        for (int64_t i_89171 = 0; i_89171 < m_33638; i_89171++) {
                            double eta_p_84244 = ((double *) A_mem_89411.mem)[eta_p_49441 * (m_33638 * m_33638) + i_89202 * m_33638 + i_89171];
                            double eta_p_84245 = ((double *) mem_param_89888.mem)[i_89171 * m_33638 + i_89174];
                            double zt_res_84246 = eta_p_84244 * eta_p_84245;
                            double zp_res_84249 = zt_res_84246 + redout_89170;
                            double redout_tmp_91559 = zp_res_84249;
                            
                            redout_89170 = redout_tmp_91559;
                        }
                        defunc_0_reduce_res_84243 = redout_89170;
                        ((double *) mem_90690)[i_89174] = defunc_0_reduce_res_84243;
                    }
                    
                    double defunc_0_reduce_res_84252;
                    double redout_89176 = 0.0;
                    
                    for (int64_t i_89177 = 0; i_89177 < m_33638; i_89177++) {
                        double eta_p_84253 = ((double *) A_mem_89411.mem)[eta_p_49441 * (m_33638 * m_33638) + i_89202 * m_33638 + i_89177];
                        double eta_p_84254 = ((double *) mem_90649)[i_89177];
                        double zt_res_84255 = eta_p_84253 * eta_p_84253;
                        double zt_res_84256 = eta_p_84254 * zt_res_84255;
                        double zp_res_84259 = zt_res_84256 + redout_89176;
                        double redout_tmp_91560 = zp_res_84259;
                        
                        redout_89176 = redout_tmp_91560;
                    }
                    defunc_0_reduce_res_84252 = redout_89176;
                    
                    double defunc_0_reduce_res_84262;
                    double defunc_res_84263;
                    double defunc_res_84264;
                    double defunc_res_84265;
                    double redout_89182;
                    double redout_89183;
                    double redout_89184;
                    double redout_89185;
                    
                    redout_89182 = 0.0;
                    redout_89183 = 0.0;
                    redout_89184 = 0.0;
                    redout_89185 = 0.0;
                    for (int64_t i_89188 = 0; i_89188 < m_33638; i_89188++) {
                        double eta_p_84268 = ((double *) mem_90573)[i_89202 * m_33638 + i_89188];
                        double eta_p_84269 = ((double *) mem_param_89888.mem)[i_89202 * m_33638 + i_89188];
                        double eta_p_84270 = ((double *) distrs_mem_89412.mem)[eta_p_49442 * m_33638 + i_89188];
                        double eta_p_wasfree_84271 = ((double *) mem_90614)[i_89188];
                        double eta_p_wasfree_84273 = ((double *) mem_90663)[i_89188];
                        double eta_p_84274 = ((double *) mem_90635)[i_89188 * m_33638 + i_89202];
                        double zt_res_84275 = sqrt_res_51423 * eta_p_84268;
                        double zm_res_84276 = zt_res_84275 - eta_p_84269;
                        double log_res_84277 = futrts_log64(eta_p_84269);
                        double zm_res_84278 = log_res_84277 - eta_p_wasfree_84271;
                        double zm_res_84279 = zm_res_84278 - log_res_84236;
                        double fma_res_84280 = futrts_fma64(zt_res_84215, zm_res_84279, zt_res_84216);
                        double defunc_0_reduce_res_84281;
                        double redout_89178 = 0.0;
                        
                        for (int64_t i_89179 = 0; i_89179 < m_33638; i_89179++) {
                            double eta_p_84282 = ((double *) mem_90690)[i_89179];
                            double eta_p_84283 = ((double *) A_mem_89411.mem)[eta_p_49442 * (m_33638 * m_33638) + i_89179 * m_33638 + i_89188];
                            double zt_res_84284 = eta_p_84282 * eta_p_84283;
                            double zp_res_84287 = zt_res_84284 + redout_89178;
                            double redout_tmp_91567 = zp_res_84287;
                            
                            redout_89178 = redout_tmp_91567;
                        }
                        defunc_0_reduce_res_84281 = redout_89178;
                        
                        double zt_res_84289 = -2.0 * defunc_0_reduce_res_84281;
                        double zp_res_84290 = defunc_0_reduce_res_84252 + zt_res_84289;
                        double zp_res_84291 = eta_p_wasfree_84273 + zp_res_84290;
                        double zt_res_84292 = 2.0 * zp_res_84291;
                        double fma_res_84293 = futrts_fma64(fma_res_84240, rho1_33639, zt_res_84292);
                        double fma_res_84294 = futrts_fma64(eta_p_84274, rho2_33640, fma_res_84293);
                        double fma_res_84295 = futrts_fma64(fma_res_84280, eps_33641, fma_res_84294);
                        double max_res_84296 = fmax64(-1.0e100, fma_res_84295);
                        double zt_res_84297 = zm_res_84276 * max_res_84296;
                        double zp_res_84298 = eta_p_84269 + zm_res_84276;
                        double zt_res_84299 = x_84228 * eta_p_84270;
                        bool zeze_res_84300 = zp_res_84298 == 0.0;
                        double klu_res_84301;
                        
                        if (zeze_res_84300) {
                            klu_res_84301 = 0.0;
                        } else {
                            double zs_res_84302 = zp_res_84298 / zt_res_84299;
                            double log_res_84303 = futrts_log64(zs_res_84302);
                            double zt_res_84304 = zp_res_84298 * log_res_84303;
                            
                            klu_res_84301 = zt_res_84304;
                        }
                        
                        double zp_res_84307 = zt_res_84297 + redout_89182;
                        double zp_res_84310 = klu_res_84301 + redout_89183;
                        double zp_res_84313 = zp_res_84298 + redout_89184;
                        double zp_res_84316 = zp_res_84298 + redout_89185;
                        
                        ((double *) mem_90674)[i_89202 * m_33638 + i_89188] = zp_res_84298;
                        ((double *) mem_90677.mem)[i_89202 * m_33638 + i_89188] = zm_res_84276;
                        
                        double redout_tmp_91561 = zp_res_84307;
                        double redout_tmp_91562 = zp_res_84310;
                        double redout_tmp_91563 = zp_res_84313;
                        double redout_tmp_91564 = zp_res_84316;
                        
                        redout_89182 = redout_tmp_91561;
                        redout_89183 = redout_tmp_91562;
                        redout_89184 = redout_tmp_91563;
                        redout_89185 = redout_tmp_91564;
                    }
                    defunc_0_reduce_res_84262 = redout_89182;
                    defunc_res_84263 = redout_89183;
                    defunc_res_84264 = redout_89184;
                    defunc_res_84265 = redout_89185;
                    
                    bool zeze_res_84323 = defunc_res_84265 == 0.0;
                    double klu_res_84324;
                    
                    if (zeze_res_84323) {
                        klu_res_84324 = 0.0;
                    } else {
                        double zs_res_84325 = defunc_res_84265 / x_84228;
                        double log_res_84326 = futrts_log64(zs_res_84325);
                        double zt_res_84327 = defunc_res_84265 * log_res_84326;
                        
                        klu_res_84324 = zt_res_84327;
                    }
                    
                    double zp_res_84330 = defunc_0_reduce_res_84262 + redout_89194;
                    double zp_res_84333 = klu_res_84324 + redout_89195;
                    double zp_res_84336 = defunc_res_84265 + redout_89196;
                    double zp_res_84339 = defunc_res_84263 + redout_89197;
                    double zp_res_84342 = x_84228 + redout_89198;
                    
                    ((double *) mem_90671)[i_89202] = defunc_res_84264;
                    
                    double redout_tmp_91550 = zp_res_84330;
                    double redout_tmp_91551 = zp_res_84333;
                    double redout_tmp_91552 = zp_res_84336;
                    double redout_tmp_91553 = zp_res_84339;
                    double redout_tmp_91554 = zp_res_84342;
                    
                    redout_89194 = redout_tmp_91550;
                    redout_89195 = redout_tmp_91551;
                    redout_89196 = redout_tmp_91552;
                    redout_89197 = redout_tmp_91553;
                    redout_89198 = redout_tmp_91554;
                }
                defunc_res_84220 = redout_89194;
                defunc_res_84221 = redout_89195;
                defunc_res_84222 = redout_89196;
                defunc_res_84223 = redout_89197;
                defunc_res_84224 = redout_89198;
                
                bool zl_res_84351 = defunc_res_84220 < 0.0;
                bool assert_c_84352;
                
                if (!zl_res_84351) {
                    set_error(ctx, msgprintf("Error: %s\n\nBacktrace:\n%s", "Assertion is false: M.((gradient) M.< zero)", "-> #0  common.fut:220:7-221:22\n   #1  unbalanced_gw_core.fut:388:48-393:78\n   #2  unbalanced_gw_core.fut:402:7-11\n   #3  unbalanced_gw.fut:163:9-165:83\n   #4  /prelude/functional.fut:9:44-45\n   #5  unbalanced_gw.fut:162:6-165:84\n   #6  unbalanced_gw.fut:160:1-165:84\n"));
                    err = FUTHARK_PROGRAM_ERROR;
                    goto cleanup;
                }
                if (mem_90725_cached_sizze_91787 < bytes_89415) {
                    err = lexical_realloc(ctx, &mem_90725, &mem_90725_cached_sizze_91787, bytes_89415);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                
                double defunc_res_84354;
                double redout_89210 = 0.0;
                
                for (int64_t i_89212 = 0; i_89212 < m_33638; i_89212++) {
                    double eta_p_84357 = ((double *) distrs_mem_89412.mem)[eta_p_49442 * m_33638 + i_89212];
                    double defunc_res_84358;
                    double defunc_res_84359;
                    double redout_89206;
                    double redout_89207;
                    
                    redout_89206 = 0.0;
                    redout_89207 = 0.0;
                    for (int64_t i_89208 = 0; i_89208 < m_33638; i_89208++) {
                        double x_84360 = ((double *) mem_90674)[i_89208 * m_33638 + i_89212];
                        double zp_res_84363 = x_84360 + redout_89206;
                        double zp_res_84366 = x_84360 + redout_89207;
                        double redout_tmp_91570 = zp_res_84363;
                        double redout_tmp_91571 = zp_res_84366;
                        
                        redout_89206 = redout_tmp_91570;
                        redout_89207 = redout_tmp_91571;
                    }
                    defunc_res_84358 = redout_89206;
                    defunc_res_84359 = redout_89207;
                    
                    bool zeze_res_84369 = defunc_res_84359 == 0.0;
                    double klu_res_84370;
                    
                    if (zeze_res_84369) {
                        klu_res_84370 = 0.0;
                    } else {
                        double zs_res_84371 = defunc_res_84359 / eta_p_84357;
                        double log_res_84372 = futrts_log64(zs_res_84371);
                        double zt_res_84373 = defunc_res_84359 * log_res_84372;
                        
                        klu_res_84370 = zt_res_84373;
                    }
                    
                    double zp_res_84376 = klu_res_84370 + redout_89210;
                    
                    ((double *) mem_90725)[i_89212] = defunc_res_84358;
                    
                    double redout_tmp_91568 = zp_res_84376;
                    
                    redout_89210 = redout_tmp_91568;
                }
                defunc_res_84354 = redout_89210;
                if (mem_90733_cached_sizze_91788 < bytes_89415) {
                    err = lexical_realloc(ctx, &mem_90733, &mem_90733_cached_sizze_91788, bytes_89415);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                
                double defunc_0_reduce_res_84379;
                double defunc_res_84380;
                double redout_89226;
                double redout_89227;
                
                redout_89226 = 0.0;
                redout_89227 = 0.0;
                for (int64_t i_89228 = 0; i_89228 < m_33638; i_89228++) {
                    double eta_p_84383 = ((double *) mem_90671)[i_89228];
                    double defunc_0_reduce_res_84384;
                    double redout_89214 = 0.0;
                    
                    for (int64_t i_89215 = 0; i_89215 < m_33638; i_89215++) {
                        double eta_p_84385 = ((double *) A_mem_89411.mem)[eta_p_49441 * (m_33638 * m_33638) + i_89228 * m_33638 + i_89215];
                        double eta_p_84386 = ((double *) mem_90671)[i_89215];
                        double zt_res_84387 = eta_p_84385 * eta_p_84385;
                        double zt_res_84388 = eta_p_84386 * zt_res_84387;
                        double zp_res_84391 = zt_res_84388 + redout_89214;
                        double redout_tmp_91574 = zp_res_84391;
                        
                        redout_89214 = redout_tmp_91574;
                    }
                    defunc_0_reduce_res_84384 = redout_89214;
                    
                    double zt_res_84393 = eta_p_84383 * defunc_0_reduce_res_84384;
                    
                    for (int64_t i_89220 = 0; i_89220 < m_33638; i_89220++) {
                        double defunc_0_reduce_res_84396;
                        double redout_89216 = 0.0;
                        
                        for (int64_t i_89217 = 0; i_89217 < m_33638; i_89217++) {
                            double eta_p_84397 = ((double *) A_mem_89411.mem)[eta_p_49441 * (m_33638 * m_33638) + i_89228 * m_33638 + i_89217];
                            double eta_p_84398 = ((double *) mem_90674)[i_89217 * m_33638 + i_89220];
                            double zt_res_84399 = eta_p_84397 * eta_p_84398;
                            double zp_res_84402 = zt_res_84399 + redout_89216;
                            double redout_tmp_91576 = zp_res_84402;
                            
                            redout_89216 = redout_tmp_91576;
                        }
                        defunc_0_reduce_res_84396 = redout_89216;
                        ((double *) mem_90733)[i_89220] = defunc_0_reduce_res_84396;
                    }
                    
                    double defunc_0_reduce_res_84405;
                    double redout_89224 = 0.0;
                    
                    for (int64_t i_89225 = 0; i_89225 < m_33638; i_89225++) {
                        double eta_p_84407 = ((double *) mem_90674)[i_89228 * m_33638 + i_89225];
                        double defunc_0_reduce_res_84408;
                        double redout_89222 = 0.0;
                        
                        for (int64_t i_89223 = 0; i_89223 < m_33638; i_89223++) {
                            double eta_p_84409 = ((double *) mem_90733)[i_89223];
                            double eta_p_84410 = ((double *) A_mem_89411.mem)[eta_p_49442 * (m_33638 * m_33638) + i_89223 * m_33638 + i_89225];
                            double zt_res_84411 = eta_p_84409 * eta_p_84410;
                            double zp_res_84414 = zt_res_84411 + redout_89222;
                            double redout_tmp_91578 = zp_res_84414;
                            
                            redout_89222 = redout_tmp_91578;
                        }
                        defunc_0_reduce_res_84408 = redout_89222;
                        
                        double zt_res_84416 = eta_p_84407 * defunc_0_reduce_res_84408;
                        double zp_res_84419 = zt_res_84416 + redout_89224;
                        double redout_tmp_91577 = zp_res_84419;
                        
                        redout_89224 = redout_tmp_91577;
                    }
                    defunc_0_reduce_res_84405 = redout_89224;
                    
                    double zp_res_84423 = zt_res_84393 + redout_89226;
                    double zp_res_84426 = defunc_0_reduce_res_84405 + redout_89227;
                    double redout_tmp_91572 = zp_res_84423;
                    double redout_tmp_91573 = zp_res_84426;
                    
                    redout_89226 = redout_tmp_91572;
                    redout_89227 = redout_tmp_91573;
                }
                defunc_0_reduce_res_84379 = redout_89226;
                defunc_res_84380 = redout_89227;
                
                double defunc_0_reduce_res_84429;
                double redout_89231 = 0.0;
                
                for (int64_t i_89232 = 0; i_89232 < m_33638; i_89232++) {
                    double eta_p_84431 = ((double *) mem_90725)[i_89232];
                    double defunc_0_reduce_res_84432;
                    double redout_89229 = 0.0;
                    
                    for (int64_t i_89230 = 0; i_89230 < m_33638; i_89230++) {
                        double eta_p_84433 = ((double *) A_mem_89411.mem)[eta_p_49442 * (m_33638 * m_33638) + i_89232 * m_33638 + i_89230];
                        double eta_p_84434 = ((double *) mem_90725)[i_89230];
                        double zt_res_84435 = eta_p_84433 * eta_p_84433;
                        double zt_res_84436 = eta_p_84434 * zt_res_84435;
                        double zp_res_84439 = zt_res_84436 + redout_89229;
                        double redout_tmp_91580 = zp_res_84439;
                        
                        redout_89229 = redout_tmp_91580;
                    }
                    defunc_0_reduce_res_84432 = redout_89229;
                    
                    double zt_res_84441 = eta_p_84431 * defunc_0_reduce_res_84432;
                    double zp_res_84444 = zt_res_84441 + redout_89231;
                    double redout_tmp_91579 = zp_res_84444;
                    
                    redout_89231 = redout_tmp_91579;
                }
                defunc_0_reduce_res_84429 = redout_89231;
                
                double zt_res_84446 = -2.0 * defunc_res_84380;
                double zp_res_84447 = defunc_0_reduce_res_84379 + zt_res_84446;
                double zp_res_84448 = defunc_0_reduce_res_84429 + zp_res_84447;
                double zt_res_84449 = eps_33641 * defunc_res_84223;
                double zt_res_84450 = rho1_33639 * defunc_res_84221;
                double zt_res_84451 = rho2_33640 * defunc_res_84354;
                double zp_res_84452 = zt_res_84449 + zt_res_84450;
                double zp_res_84453 = zt_res_84451 + zp_res_84452;
                double zt_res_84454 = 2.0 * zp_res_84453;
                double zt_res_84455 = defunc_res_84222 * zt_res_84454;
                double zp_res_84456 = zp_res_84448 + zt_res_84455;
                double zt_res_84457 = defunc_res_84222 * defunc_res_84222;
                double zt_res_84460 = zp_res_49438 * zt_res_84457;
                double zm_res_84461 = zp_res_84456 - zt_res_84460;
                double zt_res_84462 = defunc_res_84079 * defunc_res_84224;
                double zt_res_84463 = rho1_33639 * defunc_res_84224;
                double zt_res_84464 = defunc_res_84224 * zt_res_84463;
                double zt_res_84465 = rho2_33640 * defunc_res_84079;
                double zt_res_84466 = defunc_res_84079 * zt_res_84465;
                double zp_res_84467 = zt_res_84464 + zt_res_84466;
                double zt_res_84468 = eps_33641 * zt_res_84462;
                double zt_res_84469 = zt_res_84462 * zt_res_84468;
                double zp_res_84470 = zp_res_84467 + zt_res_84469;
                double zp_res_84471 = zm_res_84461 + zp_res_84470;
                double zm_res_84472 = zp_res_84471 - loss_50367;
                bool zgze_res_84473 = -1.0 <= zm_res_84472;
                double zs_res_84474 = zm_res_84472 / defunc_res_84220;
                bool zlze_res_84475 = zs_res_84474 <= 0.5;
                bool x_84476 = zgze_res_84473 && zlze_res_84475;
                double defunc_res_84477;
                
                if (x_84476) {
                    double x_84478;
                    double redout_89233 = 0.0;
                    
                    for (int64_t i_89234 = 0; i_89234 < m_33638; i_89234++) {
                        double x_84479 = ((double *) distrs_mem_89412.mem)[eta_p_49441 * m_33638 + i_89234];
                        double zp_res_84482 = x_84479 + redout_89233;
                        double redout_tmp_91581 = zp_res_84482;
                        
                        redout_89233 = redout_tmp_91581;
                    }
                    x_84478 = redout_89233;
                    defunc_res_84477 = x_84478;
                } else {
                    defunc_res_84477 = 0.0;
                }
                
                double defunc_res_84484;
                
                if (x_84476) {
                    double x_84485;
                    double redout_89235 = 0.0;
                    
                    for (int64_t i_89236 = 0; i_89236 < m_33638; i_89236++) {
                        double x_84486 = ((double *) distrs_mem_89412.mem)[eta_p_49442 * m_33638 + i_89236];
                        double zp_res_84489 = x_84486 + redout_89235;
                        double redout_tmp_91582 = zp_res_84489;
                        
                        redout_89235 = redout_tmp_91582;
                    }
                    x_84485 = redout_89235;
                    defunc_res_84484 = x_84485;
                } else {
                    defunc_res_84484 = 0.0;
                }
                
                double zt_res_84491 = defunc_res_84477 * defunc_res_84484;
                double zt_res_84492 = rho1_33639 * defunc_res_84477;
                double zt_res_84493 = defunc_res_84477 * zt_res_84492;
                double zt_res_84494 = rho2_33640 * defunc_res_84484;
                double zt_res_84495 = defunc_res_84484 * zt_res_84494;
                double zp_res_84496 = zt_res_84493 + zt_res_84495;
                double zt_res_84497 = eps_33641 * zt_res_84491;
                double zt_res_84498 = zt_res_84491 * zt_res_84497;
                double zp_res_84499 = zp_res_84496 + zt_res_84498;
                
                if (mem_90745_cached_sizze_91789 < bytes_89415) {
                    err = lexical_realloc(ctx, &mem_90745, &mem_90745_cached_sizze_91789, bytes_89415);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (mem_90748_cached_sizze_91790 < bytes_89429) {
                    err = lexical_realloc(ctx, &mem_90748, &mem_90748_cached_sizze_91790, bytes_89429);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (mem_90791_cached_sizze_91791 < bytes_89415) {
                    err = lexical_realloc(ctx, &mem_90791, &mem_90791_cached_sizze_91791, bytes_89415);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (mem_90799_cached_sizze_91792 < bytes_89415) {
                    err = lexical_realloc(ctx, &mem_90799, &mem_90799_cached_sizze_91792, bytes_89415);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                
                bool defunc_0_armijo_line_search_res_84500;
                double defunc_0_armijo_line_search_res_84502;
                double defunc_0_armijo_line_search_res_84503;
                bool loop_while_84504;
                double current_loss_84506;
                double alpha_84507;
                
                if (memblock_set(ctx, &mem_param_90743, &mem_90677, "mem_90677") != 0)
                    return 1;
                loop_while_84504 = x_84476;
                current_loss_84506 = zp_res_84471;
                alpha_84507 = 1.0;
                while (loop_while_84504) {
                    double zt_res_84508 = 0.5 * alpha_84507;
                    
                    if (memblock_alloc(ctx, &mem_90751, bytes_89429, "mem_90751")) {
                        err = 1;
                        goto cleanup;
                    }
                    
                    double defunc_res_84509;
                    double defunc_res_84510;
                    double defunc_res_84511;
                    double redout_89250;
                    double redout_89251;
                    double redout_89252;
                    
                    redout_89250 = 0.0;
                    redout_89251 = 0.0;
                    redout_89252 = 0.0;
                    for (int64_t i_89256 = 0; i_89256 < m_33638; i_89256++) {
                        double eta_p_84516 = ((double *) distrs_mem_89412.mem)[eta_p_49441 * m_33638 + i_89256];
                        double defunc_res_84518;
                        double defunc_res_84519;
                        double defunc_res_84520;
                        double redout_89239;
                        double redout_89240;
                        double redout_89241;
                        
                        redout_89239 = 0.0;
                        redout_89240 = 0.0;
                        redout_89241 = 0.0;
                        for (int64_t i_89244 = 0; i_89244 < m_33638; i_89244++) {
                            double eta_p_84523 = ((double *) mem_param_90743.mem)[i_89256 * m_33638 + i_89244];
                            double eta_p_84524 = ((double *) mem_param_89888.mem)[i_89256 * m_33638 + i_89244];
                            double eta_p_84525 = ((double *) distrs_mem_89412.mem)[eta_p_49442 * m_33638 + i_89244];
                            double zt_res_84526 = 0.5 * eta_p_84523;
                            double zp_res_84527 = eta_p_84524 + zt_res_84526;
                            double zt_res_84528 = eta_p_84516 * eta_p_84525;
                            bool zeze_res_84529 = zp_res_84527 == 0.0;
                            double klu_res_84530;
                            
                            if (zeze_res_84529) {
                                klu_res_84530 = 0.0;
                            } else {
                                double zs_res_84531 = zp_res_84527 / zt_res_84528;
                                double log_res_84532 = futrts_log64(zs_res_84531);
                                double zt_res_84533 = zp_res_84527 * log_res_84532;
                                
                                klu_res_84530 = zt_res_84533;
                            }
                            
                            double zp_res_84536 = klu_res_84530 + redout_89239;
                            double zp_res_84539 = zp_res_84527 + redout_89240;
                            double zp_res_84542 = zp_res_84527 + redout_89241;
                            
                            ((double *) mem_90748)[i_89256 * m_33638 + i_89244] = zp_res_84527;
                            ((double *) mem_90751.mem)[i_89256 * m_33638 + i_89244] = zt_res_84526;
                            
                            double redout_tmp_91594 = zp_res_84536;
                            double redout_tmp_91595 = zp_res_84539;
                            double redout_tmp_91596 = zp_res_84542;
                            
                            redout_89239 = redout_tmp_91594;
                            redout_89240 = redout_tmp_91595;
                            redout_89241 = redout_tmp_91596;
                        }
                        defunc_res_84518 = redout_89239;
                        defunc_res_84519 = redout_89240;
                        defunc_res_84520 = redout_89241;
                        
                        bool zeze_res_84548 = defunc_res_84520 == 0.0;
                        double klu_res_84549;
                        
                        if (zeze_res_84548) {
                            klu_res_84549 = 0.0;
                        } else {
                            double zs_res_84550 = defunc_res_84520 / eta_p_84516;
                            double log_res_84551 = futrts_log64(zs_res_84550);
                            double zt_res_84552 = defunc_res_84520 * log_res_84551;
                            
                            klu_res_84549 = zt_res_84552;
                        }
                        
                        double zp_res_84555 = klu_res_84549 + redout_89250;
                        double zp_res_84558 = defunc_res_84520 + redout_89251;
                        double zp_res_84561 = defunc_res_84518 + redout_89252;
                        
                        ((double *) mem_90745)[i_89256] = defunc_res_84519;
                        
                        double redout_tmp_91588 = zp_res_84555;
                        double redout_tmp_91589 = zp_res_84558;
                        double redout_tmp_91590 = zp_res_84561;
                        
                        redout_89250 = redout_tmp_91588;
                        redout_89251 = redout_tmp_91589;
                        redout_89252 = redout_tmp_91590;
                    }
                    defunc_res_84509 = redout_89250;
                    defunc_res_84510 = redout_89251;
                    defunc_res_84511 = redout_89252;
                    
                    double defunc_res_84569;
                    double redout_89264 = 0.0;
                    
                    for (int64_t i_89266 = 0; i_89266 < m_33638; i_89266++) {
                        double eta_p_84572 = ((double *) distrs_mem_89412.mem)[eta_p_49442 * m_33638 + i_89266];
                        double defunc_res_84573;
                        double defunc_res_84574;
                        double redout_89260;
                        double redout_89261;
                        
                        redout_89260 = 0.0;
                        redout_89261 = 0.0;
                        for (int64_t i_89262 = 0; i_89262 < m_33638; i_89262++) {
                            double x_84575 = ((double *) mem_90748)[i_89262 * m_33638 + i_89266];
                            double zp_res_84578 = x_84575 + redout_89260;
                            double zp_res_84581 = x_84575 + redout_89261;
                            double redout_tmp_91601 = zp_res_84578;
                            double redout_tmp_91602 = zp_res_84581;
                            
                            redout_89260 = redout_tmp_91601;
                            redout_89261 = redout_tmp_91602;
                        }
                        defunc_res_84573 = redout_89260;
                        defunc_res_84574 = redout_89261;
                        
                        bool zeze_res_84584 = defunc_res_84574 == 0.0;
                        double klu_res_84585;
                        
                        if (zeze_res_84584) {
                            klu_res_84585 = 0.0;
                        } else {
                            double zs_res_84586 = defunc_res_84574 / eta_p_84572;
                            double log_res_84587 = futrts_log64(zs_res_84586);
                            double zt_res_84588 = defunc_res_84574 * log_res_84587;
                            
                            klu_res_84585 = zt_res_84588;
                        }
                        
                        double zp_res_84591 = klu_res_84585 + redout_89264;
                        
                        ((double *) mem_90791)[i_89266] = defunc_res_84573;
                        
                        double redout_tmp_91599 = zp_res_84591;
                        
                        redout_89264 = redout_tmp_91599;
                    }
                    defunc_res_84569 = redout_89264;
                    
                    double defunc_0_reduce_res_84594;
                    double defunc_res_84595;
                    double redout_89280;
                    double redout_89281;
                    
                    redout_89280 = 0.0;
                    redout_89281 = 0.0;
                    for (int64_t i_89282 = 0; i_89282 < m_33638; i_89282++) {
                        double eta_p_84598 = ((double *) mem_90745)[i_89282];
                        double defunc_0_reduce_res_84599;
                        double redout_89268 = 0.0;
                        
                        for (int64_t i_89269 = 0; i_89269 < m_33638; i_89269++) {
                            double eta_p_84600 = ((double *) A_mem_89411.mem)[eta_p_49441 * (m_33638 * m_33638) + i_89282 * m_33638 + i_89269];
                            double eta_p_84601 = ((double *) mem_90745)[i_89269];
                            double zt_res_84602 = eta_p_84600 * eta_p_84600;
                            double zt_res_84603 = eta_p_84601 * zt_res_84602;
                            double zp_res_84606 = zt_res_84603 + redout_89268;
                            double redout_tmp_91605 = zp_res_84606;
                            
                            redout_89268 = redout_tmp_91605;
                        }
                        defunc_0_reduce_res_84599 = redout_89268;
                        
                        double zt_res_84608 = eta_p_84598 * defunc_0_reduce_res_84599;
                        
                        for (int64_t i_89274 = 0; i_89274 < m_33638; i_89274++) {
                            double defunc_0_reduce_res_84611;
                            double redout_89270 = 0.0;
                            
                            for (int64_t i_89271 = 0; i_89271 < m_33638; i_89271++) {
                                double eta_p_84612 = ((double *) A_mem_89411.mem)[eta_p_49441 * (m_33638 * m_33638) + i_89282 * m_33638 + i_89271];
                                double eta_p_84613 = ((double *) mem_90748)[i_89271 * m_33638 + i_89274];
                                double zt_res_84614 = eta_p_84612 * eta_p_84613;
                                double zp_res_84617 = zt_res_84614 + redout_89270;
                                double redout_tmp_91607 = zp_res_84617;
                                
                                redout_89270 = redout_tmp_91607;
                            }
                            defunc_0_reduce_res_84611 = redout_89270;
                            ((double *) mem_90799)[i_89274] = defunc_0_reduce_res_84611;
                        }
                        
                        double defunc_0_reduce_res_84620;
                        double redout_89278 = 0.0;
                        
                        for (int64_t i_89279 = 0; i_89279 < m_33638; i_89279++) {
                            double eta_p_84622 = ((double *) mem_90748)[i_89282 * m_33638 + i_89279];
                            double defunc_0_reduce_res_84623;
                            double redout_89276 = 0.0;
                            
                            for (int64_t i_89277 = 0; i_89277 < m_33638; i_89277++) {
                                double eta_p_84624 = ((double *) mem_90799)[i_89277];
                                double eta_p_84625 = ((double *) A_mem_89411.mem)[eta_p_49442 * (m_33638 * m_33638) + i_89277 * m_33638 + i_89279];
                                double zt_res_84626 = eta_p_84624 * eta_p_84625;
                                double zp_res_84629 = zt_res_84626 + redout_89276;
                                double redout_tmp_91609 = zp_res_84629;
                                
                                redout_89276 = redout_tmp_91609;
                            }
                            defunc_0_reduce_res_84623 = redout_89276;
                            
                            double zt_res_84631 = eta_p_84622 * defunc_0_reduce_res_84623;
                            double zp_res_84634 = zt_res_84631 + redout_89278;
                            double redout_tmp_91608 = zp_res_84634;
                            
                            redout_89278 = redout_tmp_91608;
                        }
                        defunc_0_reduce_res_84620 = redout_89278;
                        
                        double zp_res_84638 = zt_res_84608 + redout_89280;
                        double zp_res_84641 = defunc_0_reduce_res_84620 + redout_89281;
                        double redout_tmp_91603 = zp_res_84638;
                        double redout_tmp_91604 = zp_res_84641;
                        
                        redout_89280 = redout_tmp_91603;
                        redout_89281 = redout_tmp_91604;
                    }
                    defunc_0_reduce_res_84594 = redout_89280;
                    defunc_res_84595 = redout_89281;
                    
                    double defunc_0_reduce_res_84644;
                    double redout_89285 = 0.0;
                    
                    for (int64_t i_89286 = 0; i_89286 < m_33638; i_89286++) {
                        double eta_p_84646 = ((double *) mem_90791)[i_89286];
                        double defunc_0_reduce_res_84647;
                        double redout_89283 = 0.0;
                        
                        for (int64_t i_89284 = 0; i_89284 < m_33638; i_89284++) {
                            double eta_p_84648 = ((double *) A_mem_89411.mem)[eta_p_49442 * (m_33638 * m_33638) + i_89286 * m_33638 + i_89284];
                            double eta_p_84649 = ((double *) mem_90791)[i_89284];
                            double zt_res_84650 = eta_p_84648 * eta_p_84648;
                            double zt_res_84651 = eta_p_84649 * zt_res_84650;
                            double zp_res_84654 = zt_res_84651 + redout_89283;
                            double redout_tmp_91611 = zp_res_84654;
                            
                            redout_89283 = redout_tmp_91611;
                        }
                        defunc_0_reduce_res_84647 = redout_89283;
                        
                        double zt_res_84656 = eta_p_84646 * defunc_0_reduce_res_84647;
                        double zp_res_84659 = zt_res_84656 + redout_89285;
                        double redout_tmp_91610 = zp_res_84659;
                        
                        redout_89285 = redout_tmp_91610;
                    }
                    defunc_0_reduce_res_84644 = redout_89285;
                    
                    double zt_res_84661 = -2.0 * defunc_res_84595;
                    double zp_res_84662 = defunc_0_reduce_res_84594 + zt_res_84661;
                    double zp_res_84663 = defunc_0_reduce_res_84644 + zp_res_84662;
                    double zt_res_84664 = eps_33641 * defunc_res_84511;
                    double zt_res_84665 = rho1_33639 * defunc_res_84509;
                    double zt_res_84666 = rho2_33640 * defunc_res_84569;
                    double zp_res_84667 = zt_res_84664 + zt_res_84665;
                    double zp_res_84668 = zt_res_84666 + zp_res_84667;
                    double zt_res_84669 = 2.0 * zp_res_84668;
                    double zt_res_84670 = defunc_res_84510 * zt_res_84669;
                    double zp_res_84671 = zp_res_84663 + zt_res_84670;
                    double zt_res_84672 = defunc_res_84510 * defunc_res_84510;
                    double zt_res_84673 = zp_res_49438 * zt_res_84672;
                    double zm_res_84674 = zp_res_84671 - zt_res_84673;
                    double zp_res_84675 = zp_res_84499 + zm_res_84674;
                    double zm_res_84676 = zp_res_84675 - loss_50367;
                    bool zgze_res_84677 = -1.0 <= zm_res_84676;
                    double zt_res_84678 = defunc_res_84220 * zt_res_84508;
                    double zs_res_84679 = zm_res_84676 / zt_res_84678;
                    bool zlze_res_84680 = zs_res_84679 <= 0.5;
                    bool zg_res_84681 = 1.0e-50 < zt_res_84508;
                    bool x_84682 = zlze_res_84680 && zg_res_84681;
                    bool x_84683 = zgze_res_84677 && x_84682;
                    
                    if (memblock_set(ctx, &mem_param_tmp_91583, &mem_90751, "mem_90751") != 0)
                        return 1;
                    
                    bool loop_while_tmp_91584 = x_84683;
                    double current_loss_tmp_91586 = zp_res_84675;
                    double alpha_tmp_91587 = zt_res_84508;
                    
                    if (memblock_set(ctx, &mem_param_90743, &mem_param_tmp_91583, "mem_param_tmp_91583") != 0)
                        return 1;
                    loop_while_84504 = loop_while_tmp_91584;
                    current_loss_84506 = current_loss_tmp_91586;
                    alpha_84507 = alpha_tmp_91587;
                }
                if (memblock_set(ctx, &ext_mem_90809, &mem_param_90743, "mem_param_90743") != 0)
                    return 1;
                defunc_0_armijo_line_search_res_84500 = loop_while_84504;
                defunc_0_armijo_line_search_res_84502 = current_loss_84506;
                defunc_0_armijo_line_search_res_84503 = alpha_84507;
                if (memblock_unref(ctx, &mem_90677, "mem_90677") != 0)
                    return 1;
                if (memblock_alloc(ctx, &mem_90812, bytes_89429, "mem_90812")) {
                    err = 1;
                    goto cleanup;
                }
                for (int64_t i_89293 = 0; i_89293 < m_33638; i_89293++) {
                    for (int64_t i_89289 = 0; i_89289 < m_33638; i_89289++) {
                        double eta_p_84688 = ((double *) mem_param_89888.mem)[i_89293 * m_33638 + i_89289];
                        double eta_p_84689 = ((double *) ext_mem_90809.mem)[i_89293 * m_33638 + i_89289];
                        double zp_res_84690 = eta_p_84688 + eta_p_84689;
                        
                        ((double *) mem_90812.mem)[i_89293 * m_33638 + i_89289] = zp_res_84690;
                    }
                }
                if (memblock_unref(ctx, &ext_mem_90809, "ext_mem_90809") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90838, &mem_90575, "mem_90575") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90835, &mem_90570, "mem_90570") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90832, &mem_90812, "mem_90812") != 0)
                    return 1;
                descent_res_51427 = defunc_0_armijo_line_search_res_84502;
            } else {
                if (memblock_alloc(ctx, &mem_90605, bytes_89415, "mem_90605")) {
                    err = 1;
                    goto cleanup;
                }
                for (int64_t nest_i_91614 = 0; nest_i_91614 < m_33638; nest_i_91614++) {
                    ((double *) mem_90605.mem)[nest_i_91614] = 0.0;
                }
                if (memblock_alloc(ctx, &mem_90608, bytes_89429, "mem_90608")) {
                    err = 1;
                    goto cleanup;
                }
                for (int64_t nest_i_91615 = 0; nest_i_91615 < m_33638; nest_i_91615++) {
                    for (int64_t nest_i_91616 = 0; nest_i_91616 < m_33638; nest_i_91616++) {
                        ((double *) mem_90608.mem)[nest_i_91615 * m_33638 + nest_i_91616] = 0.0;
                    }
                }
                if (memblock_set(ctx, &ext_mem_90838, &mem_90605, "mem_90605") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90835, &mem_90605, "mem_90605") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90832, &mem_90608, "mem_90608") != 0)
                    return 1;
                descent_res_51427 = 0.0;
            }
            if (memblock_unref(ctx, &mem_90570, "mem_90570") != 0)
                return 1;
            if (memblock_unref(ctx, &mem_90575, "mem_90575") != 0)
                return 1;
            
            bool defunc_0_reduce_comm_res_84734;
            bool redout_89297 = 0;
            
            for (int64_t i_89298 = 0; i_89298 < m_33638; i_89298++) {
                bool defunc_0_reduce_comm_res_84693;
                bool redout_89295 = 0;
                
                for (int64_t i_89296 = 0; i_89296 < m_33638; i_89296++) {
                    double eta_p_68820 = ((double *) mem_param_89888.mem)[i_89298 * m_33638 + i_89296];
                    double eta_p_68821 = ((double *) ext_mem_90832.mem)[i_89298 * m_33638 + i_89296];
                    double zt_res_68822 = zp_res_49429 * eta_p_68820;
                    bool zgze_res_68823 = eta_p_68821 <= zt_res_68822;
                    double zt_res_68824 = zp_res_49429 * eta_p_68821;
                    bool zgze_res_68825 = eta_p_68820 <= zt_res_68824;
                    bool x_68826 = zgze_res_68823 && zgze_res_68825;
                    bool not_res_68827 = !x_68826;
                    bool defunc_0_op_res_60644 = not_res_68827 || redout_89295;
                    bool redout_tmp_91618 = defunc_0_op_res_60644;
                    
                    redout_89295 = redout_tmp_91618;
                }
                defunc_0_reduce_comm_res_84693 = redout_89295;
                
                bool defunc_0_op_res_52231 = defunc_0_reduce_comm_res_84693 || redout_89297;
                bool redout_tmp_91617 = defunc_0_op_res_52231;
                
                redout_89297 = redout_tmp_91617;
            }
            defunc_0_reduce_comm_res_84734 = redout_89297;
            
            bool loop_cond_52232;
            
            if (defunc_0_reduce_comm_res_84734) {
                bool defunc_0_reduce_res_84696;
                bool redout_89301 = 0;
                
                for (int64_t i_89302 = 0; i_89302 < m_33638; i_89302++) {
                    bool defunc_0_reduce_res_84698;
                    bool redout_89299 = 0;
                    
                    for (int64_t i_89300 = 0; i_89300 < m_33638; i_89300++) {
                        double eta_p_84699 = ((double *) ext_mem_90832.mem)[i_89302 * m_33638 + i_89300];
                        bool zg_res_84700 = 0.0 < eta_p_84699;
                        bool defunc_0_op_res_84703 = zg_res_84700 || redout_89299;
                        bool redout_tmp_91620 = defunc_0_op_res_84703;
                        
                        redout_89299 = redout_tmp_91620;
                    }
                    defunc_0_reduce_res_84698 = redout_89299;
                    
                    bool defunc_0_op_res_84707 = defunc_0_reduce_res_84698 || redout_89301;
                    bool redout_tmp_91619 = defunc_0_op_res_84707;
                    
                    redout_89301 = redout_tmp_91619;
                }
                defunc_0_reduce_res_84696 = redout_89301;
                loop_cond_52232 = defunc_0_reduce_res_84696;
            } else {
                loop_cond_52232 = 0;
            }
            if (memblock_set(ctx, &mem_param_tmp_91369, &ext_mem_90838, "ext_mem_90838") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_tmp_91370, &ext_mem_90835, "ext_mem_90835") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_tmp_91371, &ext_mem_90832, "ext_mem_90832") != 0)
                return 1;
            
            bool loop_while_tmp_91372 = loop_cond_52232;
            double loss_tmp_91376 = descent_res_51427;
            
            if (memblock_set(ctx, &mem_param_89881, &mem_param_tmp_91369, "mem_param_tmp_91369") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_89884, &mem_param_tmp_91370, "mem_param_tmp_91370") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_89888, &mem_param_tmp_91371, "mem_param_tmp_91371") != 0)
                return 1;
            loop_while_50363 = loop_while_tmp_91372;
            loss_50367 = loss_tmp_91376;
        }
        if (memblock_set(ctx, &ext_mem_90848, &mem_param_89881, "mem_param_89881") != 0)
            return 1;
        if (memblock_set(ctx, &ext_mem_90847, &mem_param_89884, "mem_param_89884") != 0)
            return 1;
        if (memblock_set(ctx, &ext_mem_90846, &mem_param_89888, "mem_param_89888") != 0)
            return 1;
        final_plan_50358 = loop_while_50363;
        final_plan_50362 = loss_50367;
        if (memblock_unref(ctx, &ext_mem_89836, "ext_mem_89836") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89837, "ext_mem_89837") != 0)
            return 1;
        
        double defunc_res_84796;
        double defunc_res_84797;
        double defunc_res_84798;
        double defunc_res_84799;
        double defunc_res_84800;
        double redout_89323;
        double redout_89324;
        double redout_89325;
        double redout_89326;
        double redout_89327;
        
        redout_89323 = 0.0;
        redout_89324 = 0.0;
        redout_89325 = 0.0;
        redout_89326 = 0.0;
        redout_89327 = 0.0;
        for (int64_t i_89331 = 0; i_89331 < m_33638; i_89331++) {
            double eta_p_59285 = ((double *) distrs_mem_89412.mem)[eta_p_49441 * m_33638 + i_89331];
            
            for (int64_t i_89307 = 0; i_89307 < m_33638; i_89307++) {
                double defunc_0_reduce_res_84735;
                double redout_89303 = 0.0;
                
                for (int64_t i_89304 = 0; i_89304 < m_33638; i_89304++) {
                    double eta_p_71807 = ((double *) A_mem_89411.mem)[eta_p_49441 * (m_33638 * m_33638) + i_89331 * m_33638 + i_89304];
                    double eta_p_71808 = ((double *) ext_mem_90846.mem)[i_89304 * m_33638 + i_89307];
                    double zt_res_71809 = eta_p_71807 * eta_p_71808;
                    double zp_res_59311 = zt_res_71809 + redout_89303;
                    double redout_tmp_91630 = zp_res_59311;
                    
                    redout_89303 = redout_tmp_91630;
                }
                defunc_0_reduce_res_84735 = redout_89303;
                ((double *) mem_90865)[i_89307] = defunc_0_reduce_res_84735;
            }
            
            double defunc_res_84738;
            double defunc_0_reduce_res_84739;
            double defunc_res_84740;
            double defunc_res_84741;
            double defunc_res_84742;
            double defunc_res_84743;
            double defunc_res_84744;
            double defunc_res_84745;
            double redout_89311;
            double redout_89312;
            double redout_89313;
            double redout_89314;
            double redout_89315;
            double redout_89316;
            double redout_89317;
            double redout_89318;
            
            redout_89311 = 0.0;
            redout_89312 = 0.0;
            redout_89313 = 0.0;
            redout_89314 = 0.0;
            redout_89315 = 0.0;
            redout_89316 = 0.0;
            redout_89317 = 0.0;
            redout_89318 = 0.0;
            for (int64_t i_89319 = 0; i_89319 < m_33638; i_89319++) {
                double x_71763 = ((double *) ext_mem_90846.mem)[i_89331 * m_33638 + i_89319];
                double eta_p_71764 = ((double *) distrs_mem_89412.mem)[eta_p_49442 * m_33638 + i_89319];
                double defunc_0_reduce_res_84736;
                double redout_89309 = 0.0;
                
                for (int64_t i_89310 = 0; i_89310 < m_33638; i_89310++) {
                    double eta_p_71801 = ((double *) mem_90865)[i_89310];
                    double eta_p_71802 = ((double *) A_mem_89411.mem)[eta_p_49442 * (m_33638 * m_33638) + i_89310 * m_33638 + i_89319];
                    double zt_res_71803 = eta_p_71801 * eta_p_71802;
                    double zp_res_71782 = zt_res_71803 + redout_89309;
                    double redout_tmp_91639 = zp_res_71782;
                    
                    redout_89309 = redout_tmp_91639;
                }
                defunc_0_reduce_res_84736 = redout_89309;
                
                double zt_res_71784 = x_71763 * defunc_0_reduce_res_84736;
                double zt_res_71786 = eta_p_59285 * eta_p_71764;
                bool zeze_res_71787 = x_71763 == 0.0;
                double klu_res_71788;
                
                if (zeze_res_71787) {
                    klu_res_71788 = 0.0;
                } else {
                    double zs_res_71789 = x_71763 / zt_res_71786;
                    double log_res_71790 = futrts_log64(zs_res_71789);
                    double zt_res_71791 = x_71763 * log_res_71790;
                    
                    klu_res_71788 = zt_res_71791;
                }
                
                double klu_res_71795;
                
                if (zeze_res_71787) {
                    klu_res_71795 = 0.0;
                } else {
                    double zs_res_71796 = x_71763 / zt_res_71786;
                    double log_res_71797 = futrts_log64(zs_res_71796);
                    double zt_res_71798 = x_71763 * log_res_71797;
                    
                    klu_res_71795 = zt_res_71798;
                }
                
                double zp_res_59299 = x_71763 + redout_89311;
                double zp_res_59333 = zt_res_71784 + redout_89312;
                double zp_res_59340 = x_71763 + redout_89313;
                double zp_res_59347 = x_71763 + redout_89314;
                double zp_res_59355 = x_71763 + redout_89315;
                double zp_res_59372 = klu_res_71788 + redout_89316;
                double zp_res_59389 = klu_res_71795 + redout_89317;
                double zp_res_59397 = x_71763 + redout_89318;
                double redout_tmp_91631 = zp_res_59299;
                double redout_tmp_91632 = zp_res_59333;
                double redout_tmp_91633 = zp_res_59340;
                double redout_tmp_91634 = zp_res_59347;
                double redout_tmp_91635 = zp_res_59355;
                double redout_tmp_91636 = zp_res_59372;
                double redout_tmp_91637 = zp_res_59389;
                double redout_tmp_91638 = zp_res_59397;
                
                redout_89311 = redout_tmp_91631;
                redout_89312 = redout_tmp_91632;
                redout_89313 = redout_tmp_91633;
                redout_89314 = redout_tmp_91634;
                redout_89315 = redout_tmp_91635;
                redout_89316 = redout_tmp_91636;
                redout_89317 = redout_tmp_91637;
                redout_89318 = redout_tmp_91638;
            }
            defunc_res_84738 = redout_89311;
            defunc_0_reduce_res_84739 = redout_89312;
            defunc_res_84740 = redout_89313;
            defunc_res_84741 = redout_89314;
            defunc_res_84742 = redout_89315;
            defunc_res_84743 = redout_89316;
            defunc_res_84744 = redout_89317;
            defunc_res_84745 = redout_89318;
            
            double zp_res_52353 = defunc_0_reduce_res_84739 + redout_89323;
            double zp_res_52448 = defunc_res_84741 + redout_89324;
            double zp_res_52460 = defunc_res_84742 + redout_89325;
            double zp_res_52494 = defunc_res_84743 + redout_89326;
            double zp_res_52517 = defunc_res_84744 + redout_89327;
            
            ((double *) mem_90850)[i_89331] = defunc_res_84745;
            ((double *) mem_90852)[i_89331] = defunc_res_84740;
            ((double *) mem_90854)[i_89331] = defunc_res_84738;
            
            double redout_tmp_91621 = zp_res_52353;
            double redout_tmp_91622 = zp_res_52448;
            double redout_tmp_91623 = zp_res_52460;
            double redout_tmp_91624 = zp_res_52494;
            double redout_tmp_91625 = zp_res_52517;
            
            redout_89323 = redout_tmp_91621;
            redout_89324 = redout_tmp_91622;
            redout_89325 = redout_tmp_91623;
            redout_89326 = redout_tmp_91624;
            redout_89327 = redout_tmp_91625;
        }
        defunc_res_84796 = redout_89323;
        defunc_res_84797 = redout_89324;
        defunc_res_84798 = redout_89325;
        defunc_res_84799 = redout_89326;
        defunc_res_84800 = redout_89327;
        for (int64_t i_89345 = 0; i_89345 < m_33638; i_89345++) {
            double defunc_res_84746;
            double defunc_res_84747;
            double defunc_res_84748;
            double redout_89335;
            double redout_89336;
            double redout_89337;
            
            redout_89335 = 0.0;
            redout_89336 = 0.0;
            redout_89337 = 0.0;
            for (int64_t i_89338 = 0; i_89338 < m_33638; i_89338++) {
                double x_71828 = ((double *) ext_mem_90846.mem)[i_89338 * m_33638 + i_89345];
                double zp_res_59421 = x_71828 + redout_89335;
                double zp_res_59427 = x_71828 + redout_89336;
                double zp_res_59434 = x_71828 + redout_89337;
                double redout_tmp_91643 = zp_res_59421;
                double redout_tmp_91644 = zp_res_59427;
                double redout_tmp_91645 = zp_res_59434;
                
                redout_89335 = redout_tmp_91643;
                redout_89336 = redout_tmp_91644;
                redout_89337 = redout_tmp_91645;
            }
            defunc_res_84746 = redout_89335;
            defunc_res_84747 = redout_89336;
            defunc_res_84748 = redout_89337;
            ((double *) mem_90882)[i_89345] = defunc_res_84748;
            ((double *) mem_90884)[i_89345] = defunc_res_84747;
            ((double *) mem_90886)[i_89345] = defunc_res_84746;
        }
        if (memblock_unref(ctx, &ext_mem_90846, "ext_mem_90846") != 0)
            return 1;
        
        double defunc_0_reduce_res_84807;
        double redout_89351 = 0.0;
        
        for (int64_t i_89352 = 0; i_89352 < m_33638; i_89352++) {
            double eta_p_56268 = ((double *) mem_90854)[i_89352];
            double defunc_0_reduce_res_84749;
            double redout_89349 = 0.0;
            
            for (int64_t i_89350 = 0; i_89350 < m_33638; i_89350++) {
                double eta_p_71840 = ((double *) A_mem_89411.mem)[eta_p_49441 * (m_33638 * m_33638) + i_89352 * m_33638 + i_89350];
                double eta_p_71841 = ((double *) mem_90854)[i_89350];
                double zt_res_71843 = eta_p_71840 * eta_p_71840;
                double zt_res_71845 = eta_p_71841 * zt_res_71843;
                double zp_res_56281 = zt_res_71845 + redout_89349;
                double redout_tmp_91647 = zp_res_56281;
                
                redout_89349 = redout_tmp_91647;
            }
            defunc_0_reduce_res_84749 = redout_89349;
            
            double zt_res_56283 = eta_p_56268 * defunc_0_reduce_res_84749;
            double zp_res_52286 = zt_res_56283 + redout_89351;
            double redout_tmp_91646 = zp_res_52286;
            
            redout_89351 = redout_tmp_91646;
        }
        defunc_0_reduce_res_84807 = redout_89351;
        
        double defunc_0_reduce_res_84808;
        double redout_89355 = 0.0;
        
        for (int64_t i_89356 = 0; i_89356 < m_33638; i_89356++) {
            double eta_p_56244 = ((double *) mem_90886)[i_89356];
            double defunc_0_reduce_res_84750;
            double redout_89353 = 0.0;
            
            for (int64_t i_89354 = 0; i_89354 < m_33638; i_89354++) {
                double eta_p_71854 = ((double *) A_mem_89411.mem)[eta_p_49442 * (m_33638 * m_33638) + i_89356 * m_33638 + i_89354];
                double eta_p_71855 = ((double *) mem_90886)[i_89354];
                double zt_res_71857 = eta_p_71854 * eta_p_71854;
                double zt_res_71859 = eta_p_71855 * zt_res_71857;
                double zp_res_56257 = zt_res_71859 + redout_89353;
                double redout_tmp_91649 = zp_res_56257;
                
                redout_89353 = redout_tmp_91649;
            }
            defunc_0_reduce_res_84750 = redout_89353;
            
            double zt_res_56259 = eta_p_56244 * defunc_0_reduce_res_84750;
            double zp_res_52310 = zt_res_56259 + redout_89355;
            double redout_tmp_91648 = zp_res_52310;
            
            redout_89355 = redout_tmp_91648;
        }
        defunc_0_reduce_res_84808 = redout_89355;
        
        double zt_res_52354 = -2.0 * defunc_res_84796;
        double zp_res_52355 = zt_res_52354 + defunc_0_reduce_res_84807;
        double zp_res_52356 = zp_res_52355 + defunc_0_reduce_res_84808;
        double defunc_res_84809;
        double defunc_res_84810;
        double redout_89360;
        double redout_89361;
        
        redout_89360 = 0.0;
        redout_89361 = 0.0;
        for (int64_t i_89362 = 0; i_89362 < m_33638; i_89362++) {
            double eta_p_56114 = ((double *) mem_90850)[i_89362];
            double eta_p_56115 = ((double *) distrs_mem_89412.mem)[eta_p_49441 * m_33638 + i_89362];
            double eta_p_56116 = ((double *) mem_90852)[i_89362];
            double defunc_res_84751;
            double defunc_res_84752;
            double redout_89357;
            double redout_89358;
            
            redout_89357 = 0.0;
            redout_89358 = 0.0;
            for (int64_t i_89359 = 0; i_89359 < m_33638; i_89359++) {
                double eta_p_71927 = ((double *) mem_90850)[i_89359];
                double eta_p_71928 = ((double *) distrs_mem_89412.mem)[eta_p_49441 * m_33638 + i_89359];
                double eta_p_71929 = ((double *) mem_90852)[i_89359];
                double zt_res_71930 = eta_p_56115 * eta_p_71928;
                double zt_res_71932 = eta_p_56116 * eta_p_71929;
                bool zeze_res_71934 = zt_res_71932 == 0.0;
                double kl_res_71935;
                
                if (zeze_res_71934) {
                    kl_res_71935 = zt_res_71930;
                } else {
                    double zs_res_71936 = zt_res_71932 / zt_res_71930;
                    double log_res_71937 = futrts_log64(zs_res_71936);
                    double zt_res_71938 = zt_res_71932 * log_res_71937;
                    double zm_res_71939 = zt_res_71938 - zt_res_71932;
                    double zp_res_71940 = zt_res_71930 + zm_res_71939;
                    
                    kl_res_71935 = zp_res_71940;
                }
                
                double zt_res_71943 = eta_p_56114 * eta_p_71927;
                bool zeze_res_71945 = zt_res_71943 == 0.0;
                double kl_res_71946;
                
                if (zeze_res_71945) {
                    kl_res_71946 = zt_res_71930;
                } else {
                    double zs_res_71947 = zt_res_71943 / zt_res_71930;
                    double log_res_71948 = futrts_log64(zs_res_71947);
                    double zt_res_71949 = zt_res_71943 * log_res_71948;
                    double zm_res_71950 = zt_res_71949 - zt_res_71943;
                    double zp_res_71951 = zt_res_71930 + zm_res_71950;
                    
                    kl_res_71946 = zp_res_71951;
                }
                
                double zp_res_56139 = kl_res_71935 + redout_89357;
                double zp_res_56160 = kl_res_71946 + redout_89358;
                double redout_tmp_91652 = zp_res_56139;
                double redout_tmp_91653 = zp_res_56160;
                
                redout_89357 = redout_tmp_91652;
                redout_89358 = redout_tmp_91653;
            }
            defunc_res_84751 = redout_89357;
            defunc_res_84752 = redout_89358;
            
            double zp_res_52396 = defunc_res_84751 + redout_89360;
            double zp_res_52557 = defunc_res_84752 + redout_89361;
            double redout_tmp_91650 = zp_res_52396;
            double redout_tmp_91651 = zp_res_52557;
            
            redout_89360 = redout_tmp_91650;
            redout_89361 = redout_tmp_91651;
        }
        defunc_res_84809 = redout_89360;
        defunc_res_84810 = redout_89361;
        
        double defunc_res_84811;
        double defunc_res_84812;
        double redout_89366;
        double redout_89367;
        
        redout_89366 = 0.0;
        redout_89367 = 0.0;
        for (int64_t i_89368 = 0; i_89368 < m_33638; i_89368++) {
            double eta_p_55995 = ((double *) mem_90882)[i_89368];
            double eta_p_55996 = ((double *) distrs_mem_89412.mem)[eta_p_49442 * m_33638 + i_89368];
            double eta_p_55997 = ((double *) mem_90884)[i_89368];
            double defunc_res_84753;
            double defunc_res_84754;
            double redout_89363;
            double redout_89364;
            
            redout_89363 = 0.0;
            redout_89364 = 0.0;
            for (int64_t i_89365 = 0; i_89365 < m_33638; i_89365++) {
                double eta_p_72020 = ((double *) mem_90882)[i_89365];
                double eta_p_72021 = ((double *) distrs_mem_89412.mem)[eta_p_49442 * m_33638 + i_89365];
                double eta_p_72022 = ((double *) mem_90884)[i_89365];
                double zt_res_72023 = eta_p_55996 * eta_p_72021;
                double zt_res_72025 = eta_p_55997 * eta_p_72022;
                bool zeze_res_72027 = zt_res_72025 == 0.0;
                double kl_res_72028;
                
                if (zeze_res_72027) {
                    kl_res_72028 = zt_res_72023;
                } else {
                    double zs_res_72029 = zt_res_72025 / zt_res_72023;
                    double log_res_72030 = futrts_log64(zs_res_72029);
                    double zt_res_72031 = zt_res_72025 * log_res_72030;
                    double zm_res_72032 = zt_res_72031 - zt_res_72025;
                    double zp_res_72033 = zt_res_72023 + zm_res_72032;
                    
                    kl_res_72028 = zp_res_72033;
                }
                
                double zt_res_72036 = eta_p_55995 * eta_p_72020;
                bool zeze_res_72038 = zt_res_72036 == 0.0;
                double kl_res_72039;
                
                if (zeze_res_72038) {
                    kl_res_72039 = zt_res_72023;
                } else {
                    double zs_res_72040 = zt_res_72036 / zt_res_72023;
                    double log_res_72041 = futrts_log64(zs_res_72040);
                    double zt_res_72042 = zt_res_72036 * log_res_72041;
                    double zm_res_72043 = zt_res_72042 - zt_res_72036;
                    double zp_res_72044 = zt_res_72023 + zm_res_72043;
                    
                    kl_res_72039 = zp_res_72044;
                }
                
                double zp_res_56020 = kl_res_72028 + redout_89363;
                double zp_res_56041 = kl_res_72039 + redout_89364;
                double redout_tmp_91656 = zp_res_56020;
                double redout_tmp_91657 = zp_res_56041;
                
                redout_89363 = redout_tmp_91656;
                redout_89364 = redout_tmp_91657;
            }
            defunc_res_84753 = redout_89363;
            defunc_res_84754 = redout_89364;
            
            double zp_res_52436 = defunc_res_84753 + redout_89366;
            double zp_res_52594 = defunc_res_84754 + redout_89367;
            double redout_tmp_91654 = zp_res_52436;
            double redout_tmp_91655 = zp_res_52594;
            
            redout_89366 = redout_tmp_91654;
            redout_89367 = redout_tmp_91655;
        }
        defunc_res_84811 = redout_89366;
        defunc_res_84812 = redout_89367;
        
        double zt_res_52471 = defunc_res_84763 * defunc_res_84770;
        double zt_res_52472 = zt_res_52471 * zt_res_52471;
        double zt_res_52495 = defunc_res_84798 * defunc_res_84799;
        double zt_res_52518 = defunc_res_84797 * defunc_res_84800;
        double zp_res_52519 = zt_res_52495 + zt_res_52518;
        double zp_res_52520 = zt_res_52472 + zp_res_52519;
        double zt_res_52521 = defunc_res_84797 * defunc_res_84798;
        double zm_res_52522 = zp_res_52520 - zt_res_52521;
        double zt_res_52558 = rho1_33639 * defunc_res_84810;
        double zp_res_52559 = zp_res_52356 + zt_res_52558;
        double zt_res_52595 = rho2_33640 * defunc_res_84812;
        double zp_res_52596 = zp_res_52559 + zt_res_52595;
        double fma_res_52597 = futrts_fma64(zm_res_52522, eps_33641, zp_res_52596);
        
        ((double *) mem_89419.mem)[i_89371 * (int64_t) 5] = zp_res_52356;
        ((double *) mem_89419.mem)[i_89371 * (int64_t) 5 + (int64_t) 1] = defunc_res_84809;
        ((double *) mem_89419.mem)[i_89371 * (int64_t) 5 + (int64_t) 2] = defunc_res_84811;
        ((double *) mem_89419.mem)[i_89371 * (int64_t) 5 + (int64_t) 3] = zm_res_52522;
        ((double *) mem_89419.mem)[i_89371 * (int64_t) 5 + (int64_t) 4] = fma_res_52597;
    }
    if (memblock_unref(ctx, &ext_mem_89413, "ext_mem_89413") != 0)
        return 1;
    if (memblock_unref(ctx, &ext_mem_89414, "ext_mem_89414") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89416, "mem_89416") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89495, "mem_89495") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89543, "mem_89543") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89554, "mem_89554") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89578, "mem_89578") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89586, "mem_89586") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89862, "mem_89862") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89965, "mem_89965") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89967, "mem_89967") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89970, "mem_89970") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_90000, "mem_90000") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_90002, "mem_90002") != 0)
        return 1;
    if (memblock_set(ctx, &mem_out_91249, &mem_89419, "mem_89419") != 0)
        return 1;
    prim_out_91250 = zbzg_lhs_49425;
    if (memblock_set(ctx, &*mem_out_p_91753, &mem_out_91249, "mem_out_91249") != 0)
        return 1;
    *out_prim_out_91754 = prim_out_91250;
    
  cleanup:
    {
        free(mem_89425);
        free(mem_89427);
        free(mem_89430);
        free(mem_89460);
        free(mem_89462);
        free(mem_89464);
        free(mem_89484);
        free(mem_89493);
        free(mem_89504);
        free(mem_89506);
        free(mem_89520);
        free(mem_89551);
        free(mem_89843);
        free(mem_89890);
        free(mem_89898);
        free(mem_89900);
        free(mem_89914);
        free(mem_89923);
        free(mem_89925);
        free(mem_89934);
        free(mem_89942);
        free(mem_90573);
        free(mem_90610);
        free(mem_90612);
        free(mem_90614);
        free(mem_90635);
        free(mem_90647);
        free(mem_90649);
        free(mem_90663);
        free(mem_90671);
        free(mem_90674);
        free(mem_90690);
        free(mem_90725);
        free(mem_90733);
        free(mem_90745);
        free(mem_90748);
        free(mem_90791);
        free(mem_90799);
        free(mem_90850);
        free(mem_90852);
        free(mem_90854);
        free(mem_90865);
        free(mem_90882);
        free(mem_90884);
        free(mem_90886);
        if (memblock_unref(ctx, &mem_param_tmp_91371, "mem_param_tmp_91371") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91370, "mem_param_tmp_91370") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91369, "mem_param_tmp_91369") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90608, "mem_90608") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90605, "mem_90605") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90812, "mem_90812") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91583, "mem_param_tmp_91583") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90751, "mem_90751") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90743, "mem_param_90743") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90809, "ext_mem_90809") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90677, "mem_90677") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90832, "ext_mem_90832") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90835, "ext_mem_90835") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90838, "ext_mem_90838") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90575, "mem_90575") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90570, "mem_90570") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91492, "mem_param_tmp_91492") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91491, "mem_param_tmp_91491") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91490, "mem_param_tmp_91490") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91489, "mem_param_tmp_91489") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91488, "mem_param_tmp_91488") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90505, "mem_90505") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90516, "ext_mem_90516") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90493, "mem_90493") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90490, "mem_90490") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90488, "mem_90488") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90530, "ext_mem_90530") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90533, "ext_mem_90533") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90536, "ext_mem_90536") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90455, "mem_90455") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90466, "ext_mem_90466") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90443, "mem_90443") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90440, "mem_90440") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90438, "mem_90438") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90480, "ext_mem_90480") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90483, "ext_mem_90483") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90486, "ext_mem_90486") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90430, "mem_90430") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90422, "mem_90422") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90420, "mem_param_90420") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90417, "mem_param_90417") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90414, "mem_param_90414") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90411, "mem_param_90411") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90408, "mem_param_90408") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90548, "ext_mem_90548") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90549, "ext_mem_90549") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90550, "ext_mem_90550") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90551, "ext_mem_90551") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90552, "ext_mem_90552") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90373, "mem_90373") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90384, "ext_mem_90384") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90361, "mem_90361") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90358, "mem_90358") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90356, "mem_90356") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90398, "ext_mem_90398") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90401, "ext_mem_90401") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90404, "ext_mem_90404") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90323, "mem_90323") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90334, "ext_mem_90334") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90311, "mem_90311") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90308, "mem_90308") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90306, "mem_90306") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90348, "ext_mem_90348") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90351, "ext_mem_90351") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90354, "ext_mem_90354") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90298, "mem_90298") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90290, "mem_90290") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90555, "ext_mem_90555") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90558, "ext_mem_90558") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90561, "ext_mem_90561") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90564, "ext_mem_90564") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90568, "ext_mem_90568") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91434, "mem_param_tmp_91434") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91433, "mem_param_tmp_91433") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91432, "mem_param_tmp_91432") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91431, "mem_param_tmp_91431") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91430, "mem_param_tmp_91430") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91429, "mem_param_tmp_91429") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91428, "mem_param_tmp_91428") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91427, "mem_param_tmp_91427") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91426, "mem_param_tmp_91426") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90228, "mem_90228") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90239, "ext_mem_90239") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90216, "mem_90216") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90213, "mem_90213") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90211, "mem_90211") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90253, "ext_mem_90253") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90256, "ext_mem_90256") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90259, "ext_mem_90259") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90178, "mem_90178") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90189, "ext_mem_90189") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90166, "mem_90166") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90163, "mem_90163") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90161, "mem_90161") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90203, "ext_mem_90203") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90206, "ext_mem_90206") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90209, "ext_mem_90209") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90153, "mem_90153") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90145, "mem_90145") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90143, "mem_param_90143") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90140, "mem_param_90140") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90137, "mem_param_90137") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90134, "mem_param_90134") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90131, "mem_param_90131") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90127, "mem_param_90127") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90124, "mem_param_90124") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90121, "mem_param_90121") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90118, "mem_param_90118") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90280, "ext_mem_90280") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90281, "ext_mem_90281") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90282, "ext_mem_90282") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90283, "ext_mem_90283") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90284, "ext_mem_90284") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90285, "ext_mem_90285") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90286, "ext_mem_90286") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90287, "ext_mem_90287") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90288, "ext_mem_90288") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90083, "mem_90083") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90094, "ext_mem_90094") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90071, "mem_90071") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90068, "mem_90068") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90066, "mem_90066") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90108, "ext_mem_90108") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90111, "ext_mem_90111") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90114, "ext_mem_90114") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90033, "mem_90033") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90044, "ext_mem_90044") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90021, "mem_90021") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90018, "mem_90018") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90016, "mem_90016") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90058, "ext_mem_90058") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90061, "ext_mem_90061") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90064, "ext_mem_90064") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89888, "mem_param_89888") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89884, "mem_param_89884") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89881, "mem_param_89881") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90846, "ext_mem_90846") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90847, "ext_mem_90847") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90848, "ext_mem_90848") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91332, "mem_param_tmp_91332") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91331, "mem_param_tmp_91331") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91330, "mem_param_tmp_91330") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91329, "mem_param_tmp_91329") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91328, "mem_param_tmp_91328") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89793, "mem_89793") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89804, "ext_mem_89804") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89781, "mem_89781") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89778, "mem_89778") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89776, "mem_89776") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89818, "ext_mem_89818") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89821, "ext_mem_89821") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89824, "ext_mem_89824") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89743, "mem_89743") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89754, "ext_mem_89754") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89731, "mem_89731") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89728, "mem_89728") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89726, "mem_89726") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89768, "ext_mem_89768") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89771, "ext_mem_89771") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89774, "ext_mem_89774") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89718, "mem_89718") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89710, "mem_89710") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89708, "mem_param_89708") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89705, "mem_param_89705") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89702, "mem_param_89702") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89699, "mem_param_89699") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89696, "mem_param_89696") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89836, "ext_mem_89836") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89837, "ext_mem_89837") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89838, "ext_mem_89838") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89839, "ext_mem_89839") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89840, "ext_mem_89840") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89661, "mem_89661") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89672, "ext_mem_89672") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89649, "mem_89649") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89646, "mem_89646") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89644, "mem_89644") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89686, "ext_mem_89686") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89689, "ext_mem_89689") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89692, "ext_mem_89692") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89611, "mem_89611") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89622, "ext_mem_89622") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89599, "mem_89599") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89596, "mem_89596") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89594, "mem_89594") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89636, "ext_mem_89636") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89639, "ext_mem_89639") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89642, "ext_mem_89642") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90002, "mem_90002") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90000, "mem_90000") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89970, "mem_89970") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89967, "mem_89967") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89965, "mem_89965") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89862, "mem_89862") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89586, "mem_89586") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89578, "mem_89578") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89554, "mem_89554") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89543, "mem_89543") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89495, "mem_89495") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89419, "mem_89419") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89416, "mem_89416") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89413, "ext_mem_89413") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89414, "ext_mem_89414") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_out_91249, "mem_out_91249") != 0)
            return 1;
    }
    return err;
}
FUTHARK_FUN_ATTR int futrts_entry_ugw_armijo_pairwise_increasing(struct futhark_context *ctx, struct memblock *mem_out_p_91800, int64_t *out_prim_out_91801, struct memblock ugw_dmat_mem_89411, struct memblock A_mem_89412, struct memblock distrs_mem_89413, int64_t dz2080U_34199, int64_t k_34200, int64_t m_34201, double ratio_34203, double rho1_34204, double rho2_34205, double eps_34206, double exp_absorb_cutoff_34209, double safe_for_exp_34210, double tol_sinkhorn_34211, double tol_outerloop_34212)
{
    (void) ctx;
    
    int err = 0;
    int64_t mem_89430_cached_sizze_91802 = 0;
    unsigned char *mem_89430 = NULL;
    int64_t mem_89432_cached_sizze_91803 = 0;
    unsigned char *mem_89432 = NULL;
    int64_t mem_89435_cached_sizze_91804 = 0;
    unsigned char *mem_89435 = NULL;
    int64_t mem_89465_cached_sizze_91805 = 0;
    unsigned char *mem_89465 = NULL;
    int64_t mem_89467_cached_sizze_91806 = 0;
    unsigned char *mem_89467 = NULL;
    int64_t mem_89469_cached_sizze_91807 = 0;
    unsigned char *mem_89469 = NULL;
    int64_t mem_89489_cached_sizze_91808 = 0;
    unsigned char *mem_89489 = NULL;
    int64_t mem_89498_cached_sizze_91809 = 0;
    unsigned char *mem_89498 = NULL;
    int64_t mem_89509_cached_sizze_91810 = 0;
    unsigned char *mem_89509 = NULL;
    int64_t mem_89511_cached_sizze_91811 = 0;
    unsigned char *mem_89511 = NULL;
    int64_t mem_89525_cached_sizze_91812 = 0;
    unsigned char *mem_89525 = NULL;
    int64_t mem_89556_cached_sizze_91813 = 0;
    unsigned char *mem_89556 = NULL;
    int64_t mem_89848_cached_sizze_91814 = 0;
    unsigned char *mem_89848 = NULL;
    int64_t mem_89895_cached_sizze_91815 = 0;
    unsigned char *mem_89895 = NULL;
    int64_t mem_89903_cached_sizze_91816 = 0;
    unsigned char *mem_89903 = NULL;
    int64_t mem_89905_cached_sizze_91817 = 0;
    unsigned char *mem_89905 = NULL;
    int64_t mem_89919_cached_sizze_91818 = 0;
    unsigned char *mem_89919 = NULL;
    int64_t mem_89928_cached_sizze_91819 = 0;
    unsigned char *mem_89928 = NULL;
    int64_t mem_89930_cached_sizze_91820 = 0;
    unsigned char *mem_89930 = NULL;
    int64_t mem_89939_cached_sizze_91821 = 0;
    unsigned char *mem_89939 = NULL;
    int64_t mem_89947_cached_sizze_91822 = 0;
    unsigned char *mem_89947 = NULL;
    int64_t mem_90578_cached_sizze_91823 = 0;
    unsigned char *mem_90578 = NULL;
    int64_t mem_90615_cached_sizze_91824 = 0;
    unsigned char *mem_90615 = NULL;
    int64_t mem_90617_cached_sizze_91825 = 0;
    unsigned char *mem_90617 = NULL;
    int64_t mem_90619_cached_sizze_91826 = 0;
    unsigned char *mem_90619 = NULL;
    int64_t mem_90640_cached_sizze_91827 = 0;
    unsigned char *mem_90640 = NULL;
    int64_t mem_90652_cached_sizze_91828 = 0;
    unsigned char *mem_90652 = NULL;
    int64_t mem_90654_cached_sizze_91829 = 0;
    unsigned char *mem_90654 = NULL;
    int64_t mem_90668_cached_sizze_91830 = 0;
    unsigned char *mem_90668 = NULL;
    int64_t mem_90676_cached_sizze_91831 = 0;
    unsigned char *mem_90676 = NULL;
    int64_t mem_90679_cached_sizze_91832 = 0;
    unsigned char *mem_90679 = NULL;
    int64_t mem_90695_cached_sizze_91833 = 0;
    unsigned char *mem_90695 = NULL;
    int64_t mem_90730_cached_sizze_91834 = 0;
    unsigned char *mem_90730 = NULL;
    int64_t mem_90738_cached_sizze_91835 = 0;
    unsigned char *mem_90738 = NULL;
    int64_t mem_90750_cached_sizze_91836 = 0;
    unsigned char *mem_90750 = NULL;
    int64_t mem_90753_cached_sizze_91837 = 0;
    unsigned char *mem_90753 = NULL;
    int64_t mem_90796_cached_sizze_91838 = 0;
    unsigned char *mem_90796 = NULL;
    int64_t mem_90804_cached_sizze_91839 = 0;
    unsigned char *mem_90804 = NULL;
    int64_t mem_90855_cached_sizze_91840 = 0;
    unsigned char *mem_90855 = NULL;
    int64_t mem_90857_cached_sizze_91841 = 0;
    unsigned char *mem_90857 = NULL;
    int64_t mem_90859_cached_sizze_91842 = 0;
    unsigned char *mem_90859 = NULL;
    int64_t mem_90870_cached_sizze_91843 = 0;
    unsigned char *mem_90870 = NULL;
    int64_t mem_90887_cached_sizze_91844 = 0;
    unsigned char *mem_90887 = NULL;
    int64_t mem_90889_cached_sizze_91845 = 0;
    unsigned char *mem_90889 = NULL;
    int64_t mem_90891_cached_sizze_91846 = 0;
    unsigned char *mem_90891 = NULL;
    struct memblock mem_param_tmp_91253;
    
    mem_param_tmp_91253.references = NULL;
    
    struct memblock mem_90910;
    
    mem_90910.references = NULL;
    
    struct memblock mem_param_tmp_91376;
    
    mem_param_tmp_91376.references = NULL;
    
    struct memblock mem_param_tmp_91375;
    
    mem_param_tmp_91375.references = NULL;
    
    struct memblock mem_param_tmp_91374;
    
    mem_param_tmp_91374.references = NULL;
    
    struct memblock mem_90613;
    
    mem_90613.references = NULL;
    
    struct memblock mem_90610;
    
    mem_90610.references = NULL;
    
    struct memblock mem_90817;
    
    mem_90817.references = NULL;
    
    struct memblock mem_param_tmp_91588;
    
    mem_param_tmp_91588.references = NULL;
    
    struct memblock mem_90756;
    
    mem_90756.references = NULL;
    
    struct memblock mem_param_90748;
    
    mem_param_90748.references = NULL;
    
    struct memblock ext_mem_90814;
    
    ext_mem_90814.references = NULL;
    
    struct memblock mem_90682;
    
    mem_90682.references = NULL;
    
    struct memblock ext_mem_90837;
    
    ext_mem_90837.references = NULL;
    
    struct memblock ext_mem_90840;
    
    ext_mem_90840.references = NULL;
    
    struct memblock ext_mem_90843;
    
    ext_mem_90843.references = NULL;
    
    struct memblock mem_90580;
    
    mem_90580.references = NULL;
    
    struct memblock mem_90575;
    
    mem_90575.references = NULL;
    
    struct memblock mem_param_tmp_91497;
    
    mem_param_tmp_91497.references = NULL;
    
    struct memblock mem_param_tmp_91496;
    
    mem_param_tmp_91496.references = NULL;
    
    struct memblock mem_param_tmp_91495;
    
    mem_param_tmp_91495.references = NULL;
    
    struct memblock mem_param_tmp_91494;
    
    mem_param_tmp_91494.references = NULL;
    
    struct memblock mem_param_tmp_91493;
    
    mem_param_tmp_91493.references = NULL;
    
    struct memblock mem_90510;
    
    mem_90510.references = NULL;
    
    struct memblock ext_mem_90521;
    
    ext_mem_90521.references = NULL;
    
    struct memblock mem_90498;
    
    mem_90498.references = NULL;
    
    struct memblock mem_90495;
    
    mem_90495.references = NULL;
    
    struct memblock mem_90493;
    
    mem_90493.references = NULL;
    
    struct memblock ext_mem_90535;
    
    ext_mem_90535.references = NULL;
    
    struct memblock ext_mem_90538;
    
    ext_mem_90538.references = NULL;
    
    struct memblock ext_mem_90541;
    
    ext_mem_90541.references = NULL;
    
    struct memblock mem_90460;
    
    mem_90460.references = NULL;
    
    struct memblock ext_mem_90471;
    
    ext_mem_90471.references = NULL;
    
    struct memblock mem_90448;
    
    mem_90448.references = NULL;
    
    struct memblock mem_90445;
    
    mem_90445.references = NULL;
    
    struct memblock mem_90443;
    
    mem_90443.references = NULL;
    
    struct memblock ext_mem_90485;
    
    ext_mem_90485.references = NULL;
    
    struct memblock ext_mem_90488;
    
    ext_mem_90488.references = NULL;
    
    struct memblock ext_mem_90491;
    
    ext_mem_90491.references = NULL;
    
    struct memblock mem_90435;
    
    mem_90435.references = NULL;
    
    struct memblock mem_90427;
    
    mem_90427.references = NULL;
    
    struct memblock mem_param_90425;
    
    mem_param_90425.references = NULL;
    
    struct memblock mem_param_90422;
    
    mem_param_90422.references = NULL;
    
    struct memblock mem_param_90419;
    
    mem_param_90419.references = NULL;
    
    struct memblock mem_param_90416;
    
    mem_param_90416.references = NULL;
    
    struct memblock mem_param_90413;
    
    mem_param_90413.references = NULL;
    
    struct memblock ext_mem_90553;
    
    ext_mem_90553.references = NULL;
    
    struct memblock ext_mem_90554;
    
    ext_mem_90554.references = NULL;
    
    struct memblock ext_mem_90555;
    
    ext_mem_90555.references = NULL;
    
    struct memblock ext_mem_90556;
    
    ext_mem_90556.references = NULL;
    
    struct memblock ext_mem_90557;
    
    ext_mem_90557.references = NULL;
    
    struct memblock mem_90378;
    
    mem_90378.references = NULL;
    
    struct memblock ext_mem_90389;
    
    ext_mem_90389.references = NULL;
    
    struct memblock mem_90366;
    
    mem_90366.references = NULL;
    
    struct memblock mem_90363;
    
    mem_90363.references = NULL;
    
    struct memblock mem_90361;
    
    mem_90361.references = NULL;
    
    struct memblock ext_mem_90403;
    
    ext_mem_90403.references = NULL;
    
    struct memblock ext_mem_90406;
    
    ext_mem_90406.references = NULL;
    
    struct memblock ext_mem_90409;
    
    ext_mem_90409.references = NULL;
    
    struct memblock mem_90328;
    
    mem_90328.references = NULL;
    
    struct memblock ext_mem_90339;
    
    ext_mem_90339.references = NULL;
    
    struct memblock mem_90316;
    
    mem_90316.references = NULL;
    
    struct memblock mem_90313;
    
    mem_90313.references = NULL;
    
    struct memblock mem_90311;
    
    mem_90311.references = NULL;
    
    struct memblock ext_mem_90353;
    
    ext_mem_90353.references = NULL;
    
    struct memblock ext_mem_90356;
    
    ext_mem_90356.references = NULL;
    
    struct memblock ext_mem_90359;
    
    ext_mem_90359.references = NULL;
    
    struct memblock mem_90303;
    
    mem_90303.references = NULL;
    
    struct memblock mem_90295;
    
    mem_90295.references = NULL;
    
    struct memblock ext_mem_90560;
    
    ext_mem_90560.references = NULL;
    
    struct memblock ext_mem_90563;
    
    ext_mem_90563.references = NULL;
    
    struct memblock ext_mem_90566;
    
    ext_mem_90566.references = NULL;
    
    struct memblock ext_mem_90569;
    
    ext_mem_90569.references = NULL;
    
    struct memblock ext_mem_90573;
    
    ext_mem_90573.references = NULL;
    
    struct memblock mem_param_tmp_91439;
    
    mem_param_tmp_91439.references = NULL;
    
    struct memblock mem_param_tmp_91438;
    
    mem_param_tmp_91438.references = NULL;
    
    struct memblock mem_param_tmp_91437;
    
    mem_param_tmp_91437.references = NULL;
    
    struct memblock mem_param_tmp_91436;
    
    mem_param_tmp_91436.references = NULL;
    
    struct memblock mem_param_tmp_91435;
    
    mem_param_tmp_91435.references = NULL;
    
    struct memblock mem_param_tmp_91434;
    
    mem_param_tmp_91434.references = NULL;
    
    struct memblock mem_param_tmp_91433;
    
    mem_param_tmp_91433.references = NULL;
    
    struct memblock mem_param_tmp_91432;
    
    mem_param_tmp_91432.references = NULL;
    
    struct memblock mem_param_tmp_91431;
    
    mem_param_tmp_91431.references = NULL;
    
    struct memblock mem_90233;
    
    mem_90233.references = NULL;
    
    struct memblock ext_mem_90244;
    
    ext_mem_90244.references = NULL;
    
    struct memblock mem_90221;
    
    mem_90221.references = NULL;
    
    struct memblock mem_90218;
    
    mem_90218.references = NULL;
    
    struct memblock mem_90216;
    
    mem_90216.references = NULL;
    
    struct memblock ext_mem_90258;
    
    ext_mem_90258.references = NULL;
    
    struct memblock ext_mem_90261;
    
    ext_mem_90261.references = NULL;
    
    struct memblock ext_mem_90264;
    
    ext_mem_90264.references = NULL;
    
    struct memblock mem_90183;
    
    mem_90183.references = NULL;
    
    struct memblock ext_mem_90194;
    
    ext_mem_90194.references = NULL;
    
    struct memblock mem_90171;
    
    mem_90171.references = NULL;
    
    struct memblock mem_90168;
    
    mem_90168.references = NULL;
    
    struct memblock mem_90166;
    
    mem_90166.references = NULL;
    
    struct memblock ext_mem_90208;
    
    ext_mem_90208.references = NULL;
    
    struct memblock ext_mem_90211;
    
    ext_mem_90211.references = NULL;
    
    struct memblock ext_mem_90214;
    
    ext_mem_90214.references = NULL;
    
    struct memblock mem_90158;
    
    mem_90158.references = NULL;
    
    struct memblock mem_90150;
    
    mem_90150.references = NULL;
    
    struct memblock mem_param_90148;
    
    mem_param_90148.references = NULL;
    
    struct memblock mem_param_90145;
    
    mem_param_90145.references = NULL;
    
    struct memblock mem_param_90142;
    
    mem_param_90142.references = NULL;
    
    struct memblock mem_param_90139;
    
    mem_param_90139.references = NULL;
    
    struct memblock mem_param_90136;
    
    mem_param_90136.references = NULL;
    
    struct memblock mem_param_90132;
    
    mem_param_90132.references = NULL;
    
    struct memblock mem_param_90129;
    
    mem_param_90129.references = NULL;
    
    struct memblock mem_param_90126;
    
    mem_param_90126.references = NULL;
    
    struct memblock mem_param_90123;
    
    mem_param_90123.references = NULL;
    
    struct memblock ext_mem_90285;
    
    ext_mem_90285.references = NULL;
    
    struct memblock ext_mem_90286;
    
    ext_mem_90286.references = NULL;
    
    struct memblock ext_mem_90287;
    
    ext_mem_90287.references = NULL;
    
    struct memblock ext_mem_90288;
    
    ext_mem_90288.references = NULL;
    
    struct memblock ext_mem_90289;
    
    ext_mem_90289.references = NULL;
    
    struct memblock ext_mem_90290;
    
    ext_mem_90290.references = NULL;
    
    struct memblock ext_mem_90291;
    
    ext_mem_90291.references = NULL;
    
    struct memblock ext_mem_90292;
    
    ext_mem_90292.references = NULL;
    
    struct memblock ext_mem_90293;
    
    ext_mem_90293.references = NULL;
    
    struct memblock mem_90088;
    
    mem_90088.references = NULL;
    
    struct memblock ext_mem_90099;
    
    ext_mem_90099.references = NULL;
    
    struct memblock mem_90076;
    
    mem_90076.references = NULL;
    
    struct memblock mem_90073;
    
    mem_90073.references = NULL;
    
    struct memblock mem_90071;
    
    mem_90071.references = NULL;
    
    struct memblock ext_mem_90113;
    
    ext_mem_90113.references = NULL;
    
    struct memblock ext_mem_90116;
    
    ext_mem_90116.references = NULL;
    
    struct memblock ext_mem_90119;
    
    ext_mem_90119.references = NULL;
    
    struct memblock mem_90038;
    
    mem_90038.references = NULL;
    
    struct memblock ext_mem_90049;
    
    ext_mem_90049.references = NULL;
    
    struct memblock mem_90026;
    
    mem_90026.references = NULL;
    
    struct memblock mem_90023;
    
    mem_90023.references = NULL;
    
    struct memblock mem_90021;
    
    mem_90021.references = NULL;
    
    struct memblock ext_mem_90063;
    
    ext_mem_90063.references = NULL;
    
    struct memblock ext_mem_90066;
    
    ext_mem_90066.references = NULL;
    
    struct memblock ext_mem_90069;
    
    ext_mem_90069.references = NULL;
    
    struct memblock mem_param_89893;
    
    mem_param_89893.references = NULL;
    
    struct memblock mem_param_89889;
    
    mem_param_89889.references = NULL;
    
    struct memblock mem_param_89886;
    
    mem_param_89886.references = NULL;
    
    struct memblock ext_mem_90851;
    
    ext_mem_90851.references = NULL;
    
    struct memblock ext_mem_90852;
    
    ext_mem_90852.references = NULL;
    
    struct memblock ext_mem_90853;
    
    ext_mem_90853.references = NULL;
    
    struct memblock mem_param_tmp_91337;
    
    mem_param_tmp_91337.references = NULL;
    
    struct memblock mem_param_tmp_91336;
    
    mem_param_tmp_91336.references = NULL;
    
    struct memblock mem_param_tmp_91335;
    
    mem_param_tmp_91335.references = NULL;
    
    struct memblock mem_param_tmp_91334;
    
    mem_param_tmp_91334.references = NULL;
    
    struct memblock mem_param_tmp_91333;
    
    mem_param_tmp_91333.references = NULL;
    
    struct memblock mem_89798;
    
    mem_89798.references = NULL;
    
    struct memblock ext_mem_89809;
    
    ext_mem_89809.references = NULL;
    
    struct memblock mem_89786;
    
    mem_89786.references = NULL;
    
    struct memblock mem_89783;
    
    mem_89783.references = NULL;
    
    struct memblock mem_89781;
    
    mem_89781.references = NULL;
    
    struct memblock ext_mem_89823;
    
    ext_mem_89823.references = NULL;
    
    struct memblock ext_mem_89826;
    
    ext_mem_89826.references = NULL;
    
    struct memblock ext_mem_89829;
    
    ext_mem_89829.references = NULL;
    
    struct memblock mem_89748;
    
    mem_89748.references = NULL;
    
    struct memblock ext_mem_89759;
    
    ext_mem_89759.references = NULL;
    
    struct memblock mem_89736;
    
    mem_89736.references = NULL;
    
    struct memblock mem_89733;
    
    mem_89733.references = NULL;
    
    struct memblock mem_89731;
    
    mem_89731.references = NULL;
    
    struct memblock ext_mem_89773;
    
    ext_mem_89773.references = NULL;
    
    struct memblock ext_mem_89776;
    
    ext_mem_89776.references = NULL;
    
    struct memblock ext_mem_89779;
    
    ext_mem_89779.references = NULL;
    
    struct memblock mem_89723;
    
    mem_89723.references = NULL;
    
    struct memblock mem_89715;
    
    mem_89715.references = NULL;
    
    struct memblock mem_param_89713;
    
    mem_param_89713.references = NULL;
    
    struct memblock mem_param_89710;
    
    mem_param_89710.references = NULL;
    
    struct memblock mem_param_89707;
    
    mem_param_89707.references = NULL;
    
    struct memblock mem_param_89704;
    
    mem_param_89704.references = NULL;
    
    struct memblock mem_param_89701;
    
    mem_param_89701.references = NULL;
    
    struct memblock ext_mem_89841;
    
    ext_mem_89841.references = NULL;
    
    struct memblock ext_mem_89842;
    
    ext_mem_89842.references = NULL;
    
    struct memblock ext_mem_89843;
    
    ext_mem_89843.references = NULL;
    
    struct memblock ext_mem_89844;
    
    ext_mem_89844.references = NULL;
    
    struct memblock ext_mem_89845;
    
    ext_mem_89845.references = NULL;
    
    struct memblock mem_89666;
    
    mem_89666.references = NULL;
    
    struct memblock ext_mem_89677;
    
    ext_mem_89677.references = NULL;
    
    struct memblock mem_89654;
    
    mem_89654.references = NULL;
    
    struct memblock mem_89651;
    
    mem_89651.references = NULL;
    
    struct memblock mem_89649;
    
    mem_89649.references = NULL;
    
    struct memblock ext_mem_89691;
    
    ext_mem_89691.references = NULL;
    
    struct memblock ext_mem_89694;
    
    ext_mem_89694.references = NULL;
    
    struct memblock ext_mem_89697;
    
    ext_mem_89697.references = NULL;
    
    struct memblock mem_89616;
    
    mem_89616.references = NULL;
    
    struct memblock ext_mem_89627;
    
    ext_mem_89627.references = NULL;
    
    struct memblock mem_89604;
    
    mem_89604.references = NULL;
    
    struct memblock mem_89601;
    
    mem_89601.references = NULL;
    
    struct memblock mem_89599;
    
    mem_89599.references = NULL;
    
    struct memblock ext_mem_89641;
    
    ext_mem_89641.references = NULL;
    
    struct memblock ext_mem_89644;
    
    ext_mem_89644.references = NULL;
    
    struct memblock ext_mem_89647;
    
    ext_mem_89647.references = NULL;
    
    struct memblock mem_param_89427;
    
    mem_param_89427.references = NULL;
    
    struct memblock ext_mem_90913;
    
    ext_mem_90913.references = NULL;
    
    struct memblock mem_90007;
    
    mem_90007.references = NULL;
    
    struct memblock mem_90005;
    
    mem_90005.references = NULL;
    
    struct memblock mem_89975;
    
    mem_89975.references = NULL;
    
    struct memblock mem_89972;
    
    mem_89972.references = NULL;
    
    struct memblock mem_89970;
    
    mem_89970.references = NULL;
    
    struct memblock mem_89867;
    
    mem_89867.references = NULL;
    
    struct memblock mem_89591;
    
    mem_89591.references = NULL;
    
    struct memblock mem_89583;
    
    mem_89583.references = NULL;
    
    struct memblock mem_89559;
    
    mem_89559.references = NULL;
    
    struct memblock mem_89548;
    
    mem_89548.references = NULL;
    
    struct memblock mem_89500;
    
    mem_89500.references = NULL;
    
    struct memblock mem_89420;
    
    mem_89420.references = NULL;
    
    struct memblock mem_89417;
    
    mem_89417.references = NULL;
    
    struct memblock ext_mem_89414;
    
    ext_mem_89414.references = NULL;
    
    struct memblock ext_mem_89415;
    
    ext_mem_89415.references = NULL;
    
    struct memblock mem_out_91249;
    
    mem_out_91249.references = NULL;
    
    int64_t prim_out_91250;
    int64_t zbzg_lhs_45640;
    
    if (futrts_pairs_11446(ctx, &ext_mem_89415, &ext_mem_89414, &zbzg_lhs_45640, k_34200) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int64_t bytes_89416 = (int64_t) 8 * m_34201;
    int64_t bytes_89419 = (int64_t) 40 * zbzg_lhs_45640;
    int64_t bytes_89434 = m_34201 * bytes_89416;
    double zp_res_45646 = 1.0 + tol_outerloop_34212;
    double neg_res_46650 = -rho1_34204;
    double neg_res_46691 = -rho2_34205;
    
    if (memblock_alloc(ctx, &mem_89417, bytes_89416, "mem_89417")) {
        err = 1;
        goto cleanup;
    }
    for (int64_t nest_i_91251 = 0; nest_i_91251 < m_34201; nest_i_91251++) {
        ((double *) mem_89417.mem)[nest_i_91251] = 1.0;
    }
    if (memblock_alloc(ctx, &mem_89420, bytes_89419, "mem_89420")) {
        err = 1;
        goto cleanup;
    }
    
    double zs_res_45730 = 1.0 / exp_absorb_cutoff_34209;
    double zp_res_87448 = 1.0 + tol_sinkhorn_34211;
    
    if (mem_89430_cached_sizze_91802 < bytes_89416) {
        err = lexical_realloc(ctx, &mem_89430, &mem_89430_cached_sizze_91802, bytes_89416);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89432_cached_sizze_91803 < bytes_89416) {
        err = lexical_realloc(ctx, &mem_89432, &mem_89432_cached_sizze_91803, bytes_89416);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89435_cached_sizze_91804 < bytes_89434) {
        err = lexical_realloc(ctx, &mem_89435, &mem_89435_cached_sizze_91804, bytes_89434);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89465_cached_sizze_91805 < bytes_89416) {
        err = lexical_realloc(ctx, &mem_89465, &mem_89465_cached_sizze_91805, bytes_89416);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89467_cached_sizze_91806 < bytes_89416) {
        err = lexical_realloc(ctx, &mem_89467, &mem_89467_cached_sizze_91806, bytes_89416);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89469_cached_sizze_91807 < bytes_89416) {
        err = lexical_realloc(ctx, &mem_89469, &mem_89469_cached_sizze_91807, bytes_89416);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89489_cached_sizze_91808 < bytes_89416) {
        err = lexical_realloc(ctx, &mem_89489, &mem_89489_cached_sizze_91808, bytes_89416);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89498_cached_sizze_91809 < bytes_89434) {
        err = lexical_realloc(ctx, &mem_89498, &mem_89498_cached_sizze_91809, bytes_89434);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89500, bytes_89416, "mem_89500")) {
        err = 1;
        goto cleanup;
    }
    if (mem_89509_cached_sizze_91810 < bytes_89416) {
        err = lexical_realloc(ctx, &mem_89509, &mem_89509_cached_sizze_91810, bytes_89416);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89511_cached_sizze_91811 < bytes_89416) {
        err = lexical_realloc(ctx, &mem_89511, &mem_89511_cached_sizze_91811, bytes_89416);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89525_cached_sizze_91812 < bytes_89416) {
        err = lexical_realloc(ctx, &mem_89525, &mem_89525_cached_sizze_91812, bytes_89416);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89548, bytes_89416, "mem_89548")) {
        err = 1;
        goto cleanup;
    }
    if (mem_89556_cached_sizze_91813 < bytes_89416) {
        err = lexical_realloc(ctx, &mem_89556, &mem_89556_cached_sizze_91813, bytes_89416);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89559, bytes_89434, "mem_89559")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89583, bytes_89416, "mem_89583")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89591, bytes_89416, "mem_89591")) {
        err = 1;
        goto cleanup;
    }
    if (mem_89848_cached_sizze_91814 < bytes_89434) {
        err = lexical_realloc(ctx, &mem_89848, &mem_89848_cached_sizze_91814, bytes_89434);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89867, bytes_89434, "mem_89867")) {
        err = 1;
        goto cleanup;
    }
    if (mem_89895_cached_sizze_91815 < bytes_89416) {
        err = lexical_realloc(ctx, &mem_89895, &mem_89895_cached_sizze_91815, bytes_89416);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89903_cached_sizze_91816 < bytes_89416) {
        err = lexical_realloc(ctx, &mem_89903, &mem_89903_cached_sizze_91816, bytes_89416);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89905_cached_sizze_91817 < bytes_89416) {
        err = lexical_realloc(ctx, &mem_89905, &mem_89905_cached_sizze_91817, bytes_89416);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89919_cached_sizze_91818 < bytes_89416) {
        err = lexical_realloc(ctx, &mem_89919, &mem_89919_cached_sizze_91818, bytes_89416);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89928_cached_sizze_91819 < bytes_89434) {
        err = lexical_realloc(ctx, &mem_89928, &mem_89928_cached_sizze_91819, bytes_89434);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89930_cached_sizze_91820 < bytes_89416) {
        err = lexical_realloc(ctx, &mem_89930, &mem_89930_cached_sizze_91820, bytes_89416);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89939_cached_sizze_91821 < bytes_89416) {
        err = lexical_realloc(ctx, &mem_89939, &mem_89939_cached_sizze_91821, bytes_89416);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89947_cached_sizze_91822 < bytes_89416) {
        err = lexical_realloc(ctx, &mem_89947, &mem_89947_cached_sizze_91822, bytes_89416);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89970, bytes_89416, "mem_89970")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89972, bytes_89416, "mem_89972")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89975, bytes_89434, "mem_89975")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_90005, bytes_89416, "mem_90005")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_90007, bytes_89416, "mem_90007")) {
        err = 1;
        goto cleanup;
    }
    if (mem_90578_cached_sizze_91823 < bytes_89434) {
        err = lexical_realloc(ctx, &mem_90578, &mem_90578_cached_sizze_91823, bytes_89434);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_90855_cached_sizze_91840 < bytes_89416) {
        err = lexical_realloc(ctx, &mem_90855, &mem_90855_cached_sizze_91840, bytes_89416);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_90857_cached_sizze_91841 < bytes_89416) {
        err = lexical_realloc(ctx, &mem_90857, &mem_90857_cached_sizze_91841, bytes_89416);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_90859_cached_sizze_91842 < bytes_89416) {
        err = lexical_realloc(ctx, &mem_90859, &mem_90859_cached_sizze_91842, bytes_89416);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_90870_cached_sizze_91843 < bytes_89416) {
        err = lexical_realloc(ctx, &mem_90870, &mem_90870_cached_sizze_91843, bytes_89416);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_90887_cached_sizze_91844 < bytes_89416) {
        err = lexical_realloc(ctx, &mem_90887, &mem_90887_cached_sizze_91844, bytes_89416);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_90889_cached_sizze_91845 < bytes_89416) {
        err = lexical_realloc(ctx, &mem_90889, &mem_90889_cached_sizze_91845, bytes_89416);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_90891_cached_sizze_91846 < bytes_89416) {
        err = lexical_realloc(ctx, &mem_90891, &mem_90891_cached_sizze_91846, bytes_89416);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    for (int64_t i_89371 = 0; i_89371 < zbzg_lhs_45640; i_89371++) {
        int64_t eta_p_45649 = ((int64_t *) ext_mem_89415.mem)[i_89371];
        int64_t eta_p_45650 = ((int64_t *) ext_mem_89414.mem)[i_89371];
        int64_t zt_res_45651 = mul64(k_34200, eta_p_45649);
        int64_t zp_res_45652 = add64((int64_t) 1, eta_p_45649);
        int64_t zt_res_45653 = mul64(eta_p_45649, zp_res_45652);
        int64_t zs_res_45654 = sdiv64(zt_res_45653, (int64_t) 2);
        int64_t zm_res_45655 = sub64(zt_res_45651, zs_res_45654);
        int64_t zm_lhs_45656 = add64(eta_p_45650, zm_res_45655);
        int64_t zm_lhs_45657 = sub64(zm_lhs_45656, eta_p_45649);
        int64_t k_of_i_j_res_45658 = sub64(zm_lhs_45657, (int64_t) 1);
        bool x_45659 = sle64((int64_t) 0, k_of_i_j_res_45658);
        bool y_45660 = slt64(k_of_i_j_res_45658, dz2080U_34199);
        bool bounds_check_45661 = x_45659 && y_45660;
        bool index_certs_45662;
        
        if (!bounds_check_45661) {
            set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) k_of_i_j_res_45658, "] out of bounds for array of shape [", (long long) dz2080U_34199, "].", "-> #0  unbalanced_gw.fut:174:16-175:31\n   #1  /prelude/functional.fut:9:44-45\n   #2  unbalanced_gw.fut:172:6-187:11\n   #3  unbalanced_gw.fut:167:1-187:35\n"));
            err = FUTHARK_PROGRAM_ERROR;
            goto cleanup;
        }
        
        double isnan_arg0_45664 = ((double *) ugw_dmat_mem_89411.mem)[k_of_i_j_res_45658 * (int64_t) 5 + (int64_t) 4];
        bool isnan_res_45665 = futrts_isnan64(isnan_arg0_45664);
        bool x_45666 = sle64((int64_t) 0, eta_p_45650);
        bool y_45667 = slt64(eta_p_45650, k_34200);
        bool bounds_check_45668 = x_45666 && y_45667;
        bool loop_not_taken_45669 = !isnan_res_45665;
        bool protect_assert_disj_45670 = bounds_check_45668 || loop_not_taken_45669;
        bool index_certs_45671;
        
        if (!protect_assert_disj_45670) {
            set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) eta_p_45650, "] out of bounds for array of shape [", (long long) k_34200, "].", "-> #0  unbalanced_gw.fut:182:35-44\n   #1  /prelude/functional.fut:9:44-45\n   #2  unbalanced_gw.fut:172:6-187:11\n   #3  unbalanced_gw.fut:167:1-187:35\n"));
            err = FUTHARK_PROGRAM_ERROR;
            goto cleanup;
        }
        
        bool x_45672 = sle64((int64_t) 0, eta_p_45649);
        bool y_45673 = slt64(eta_p_45649, k_34200);
        bool bounds_check_45674 = x_45672 && y_45673;
        bool protect_assert_disj_45675 = loop_not_taken_45669 || bounds_check_45674;
        bool index_certs_45676;
        
        if (!protect_assert_disj_45675) {
            set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) eta_p_45649, "] out of bounds for array of shape [", (long long) k_34200, "].", "-> #0  unbalanced_gw.fut:182:20-29\n   #1  /prelude/functional.fut:9:44-45\n   #2  unbalanced_gw.fut:172:6-187:11\n   #3  unbalanced_gw.fut:167:1-187:35\n"));
            err = FUTHARK_PROGRAM_ERROR;
            goto cleanup;
        }
        
        int64_t lmad_arg_89428 = (int64_t) 5 * k_of_i_j_res_45658;
        int64_t ext_90912;
        bool lifted_lambda_res_45677;
        double lifted_lambda_res_45679;
        bool loop_while_45680;
        double current_epsilon_45682;
        int64_t ctx_param_ext_89425;
        
        if (memblock_set(ctx, &mem_param_89427, &ugw_dmat_mem_89411, "ugw_dmat_mem_89411") != 0)
            return 1;
        ctx_param_ext_89425 = lmad_arg_89428;
        loop_while_45680 = isnan_res_45665;
        current_epsilon_45682 = eps_34206;
        while (loop_while_45680) {
            double zt_res_45683 = ratio_34203 * current_epsilon_45682;
            double defunc_res_88547;
            double defunc_res_88548;
            double defunc_res_88549;
            double defunc_res_88550;
            double defunc_res_88551;
            double defunc_res_88552;
            double defunc_res_88553;
            double defunc_res_88554;
            double defunc_res_88555;
            double redout_88621;
            double redout_88622;
            double redout_88623;
            double redout_88624;
            double redout_88625;
            double redout_88626;
            double redout_88627;
            double redout_88628;
            double redout_88629;
            
            redout_88621 = 0.0;
            redout_88622 = 0.0;
            redout_88623 = 0.0;
            redout_88624 = 0.0;
            redout_88625 = 0.0;
            redout_88626 = 0.0;
            redout_88627 = 0.0;
            redout_88628 = 0.0;
            redout_88629 = 0.0;
            for (int64_t i_88633 = 0; i_88633 < m_34201; i_88633++) {
                double x_58285 = ((double *) distrs_mem_89413.mem)[eta_p_45649 * m_34201 + i_88633];
                double defunc_res_87126;
                double defunc_res_87127;
                double defunc_res_87128;
                double defunc_res_87129;
                double defunc_res_87130;
                double defunc_res_87131;
                double defunc_res_87132;
                double defunc_res_87133;
                double redout_88607;
                double redout_88608;
                double redout_88609;
                double redout_88610;
                double redout_88611;
                double redout_88612;
                double redout_88613;
                double redout_88614;
                
                redout_88607 = 0.0;
                redout_88608 = 0.0;
                redout_88609 = 0.0;
                redout_88610 = 0.0;
                redout_88611 = 0.0;
                redout_88612 = 0.0;
                redout_88613 = 0.0;
                redout_88614 = 0.0;
                for (int64_t i_88616 = 0; i_88616 < m_34201; i_88616++) {
                    double eta_p_59637 = ((double *) distrs_mem_89413.mem)[eta_p_45650 * m_34201 + i_88616];
                    double zt_res_59640 = x_58285 * eta_p_59637;
                    bool zeze_res_59643 = zt_res_59640 == 0.0;
                    double klu_res_59644;
                    
                    if (zeze_res_59643) {
                        klu_res_59644 = 0.0;
                    } else {
                        double zs_res_59645 = zt_res_59640 / zt_res_59640;
                        double log_res_59646 = futrts_log64(zs_res_59645);
                        double zt_res_59647 = zt_res_59640 * log_res_59646;
                        
                        klu_res_59644 = zt_res_59647;
                    }
                    
                    double klu_res_59652;
                    
                    if (zeze_res_59643) {
                        klu_res_59652 = 0.0;
                    } else {
                        double zs_res_59653 = zt_res_59640 / zt_res_59640;
                        double log_res_59654 = futrts_log64(zs_res_59653);
                        double zt_res_59655 = zt_res_59640 * log_res_59654;
                        
                        klu_res_59652 = zt_res_59655;
                    }
                    
                    double zp_res_58329 = klu_res_59644 + redout_88607;
                    double zp_res_58366 = klu_res_59652 + redout_88608;
                    double zp_res_58380 = zt_res_59640 + redout_88609;
                    double zp_res_58373 = zt_res_59640 + redout_88610;
                    double zp_res_58343 = zt_res_59640 + redout_88611;
                    double zp_res_58336 = zt_res_59640 + redout_88612;
                    double zp_res_58307 = zt_res_59640 + redout_88613;
                    double zp_res_58300 = zt_res_59640 + redout_88614;
                    
                    ((double *) mem_89435)[i_88633 * m_34201 + i_88616] = zt_res_59640;
                    
                    double redout_tmp_91270 = zp_res_58329;
                    double redout_tmp_91271 = zp_res_58366;
                    double redout_tmp_91272 = zp_res_58380;
                    double redout_tmp_91273 = zp_res_58373;
                    double redout_tmp_91274 = zp_res_58343;
                    double redout_tmp_91275 = zp_res_58336;
                    double redout_tmp_91276 = zp_res_58307;
                    double redout_tmp_91277 = zp_res_58300;
                    
                    redout_88607 = redout_tmp_91270;
                    redout_88608 = redout_tmp_91271;
                    redout_88609 = redout_tmp_91272;
                    redout_88610 = redout_tmp_91273;
                    redout_88611 = redout_tmp_91274;
                    redout_88612 = redout_tmp_91275;
                    redout_88613 = redout_tmp_91276;
                    redout_88614 = redout_tmp_91277;
                }
                defunc_res_87126 = redout_88607;
                defunc_res_87127 = redout_88608;
                defunc_res_87128 = redout_88609;
                defunc_res_87129 = redout_88610;
                defunc_res_87130 = redout_88611;
                defunc_res_87131 = redout_88612;
                defunc_res_87132 = redout_88613;
                defunc_res_87133 = redout_88614;
                
                bool zeze_res_58309 = defunc_res_87132 == 0.0;
                double klu_res_58310;
                
                if (zeze_res_58309) {
                    klu_res_58310 = 0.0;
                } else {
                    double zs_res_58311 = defunc_res_87132 / x_58285;
                    double log_res_58312 = futrts_log64(zs_res_58311);
                    double zt_res_58313 = log_res_58312 * defunc_res_87132;
                    
                    klu_res_58310 = zt_res_58313;
                }
                
                bool zeze_res_58345 = defunc_res_87130 == 0.0;
                double klu_res_58346;
                
                if (zeze_res_58345) {
                    klu_res_58346 = 0.0;
                } else {
                    double zs_res_58347 = defunc_res_87130 / x_58285;
                    double log_res_58348 = futrts_log64(zs_res_58347);
                    double zt_res_58349 = log_res_58348 * defunc_res_87130;
                    
                    klu_res_58346 = zt_res_58349;
                }
                
                double zp_res_48245 = defunc_res_87133 + redout_88621;
                double zp_res_48370 = klu_res_58310 + redout_88622;
                double zp_res_48415 = defunc_res_87126 + redout_88623;
                double zp_res_46602 = defunc_res_87131 + redout_88624;
                double zp_res_48614 = klu_res_58346 + redout_88625;
                double zp_res_48570 = defunc_res_87130 + redout_88626;
                double zp_res_48600 = defunc_res_87127 + redout_88627;
                double zp_res_48644 = x_58285 + redout_88628;
                double zp_res_49352 = x_58285 + redout_88629;
                
                ((double *) mem_89430)[i_88633] = defunc_res_87128;
                ((double *) mem_89432)[i_88633] = defunc_res_87129;
                
                double redout_tmp_91258 = zp_res_48245;
                double redout_tmp_91259 = zp_res_48370;
                double redout_tmp_91260 = zp_res_48415;
                double redout_tmp_91261 = zp_res_46602;
                double redout_tmp_91262 = zp_res_48614;
                double redout_tmp_91263 = zp_res_48570;
                double redout_tmp_91264 = zp_res_48600;
                double redout_tmp_91265 = zp_res_48644;
                double redout_tmp_91266 = zp_res_49352;
                
                redout_88621 = redout_tmp_91258;
                redout_88622 = redout_tmp_91259;
                redout_88623 = redout_tmp_91260;
                redout_88624 = redout_tmp_91261;
                redout_88625 = redout_tmp_91262;
                redout_88626 = redout_tmp_91263;
                redout_88627 = redout_tmp_91264;
                redout_88628 = redout_tmp_91265;
                redout_88629 = redout_tmp_91266;
            }
            defunc_res_88547 = redout_88621;
            defunc_res_88548 = redout_88622;
            defunc_res_88549 = redout_88623;
            defunc_res_88550 = redout_88624;
            defunc_res_88551 = redout_88625;
            defunc_res_88552 = redout_88626;
            defunc_res_88553 = redout_88627;
            defunc_res_88554 = redout_88628;
            defunc_res_88555 = redout_88629;
            
            double neg_res_45703 = -zt_res_45683;
            double zt_res_48249 = zt_res_45683 * defunc_res_88547;
            double defunc_res_88559;
            double defunc_res_88560;
            double defunc_res_88561;
            double defunc_res_88562;
            double redout_88645;
            double redout_88646;
            double redout_88647;
            double redout_88648;
            
            redout_88645 = 0.0;
            redout_88646 = 0.0;
            redout_88647 = 0.0;
            redout_88648 = 0.0;
            for (int64_t i_88652 = 0; i_88652 < m_34201; i_88652++) {
                double x_72047 = ((double *) distrs_mem_89413.mem)[eta_p_45650 * m_34201 + i_88652];
                double log_res_72050 = futrts_log64(x_72047);
                double zt_res_72051 = zt_res_48249 * log_res_72050;
                double defunc_res_87135;
                double defunc_res_87136;
                double defunc_res_87137;
                double defunc_res_87138;
                double redout_88637;
                double redout_88638;
                double redout_88639;
                double redout_88640;
                
                redout_88637 = 0.0;
                redout_88638 = 0.0;
                redout_88639 = 0.0;
                redout_88640 = 0.0;
                for (int64_t i_88641 = 0; i_88641 < m_34201; i_88641++) {
                    double x_72104 = ((double *) mem_89435)[i_88641 * m_34201 + i_88652];
                    double zp_res_72057 = x_72104 + redout_88637;
                    double zp_res_72060 = x_72104 + redout_88638;
                    double zp_res_72077 = x_72104 + redout_88639;
                    double zp_res_72080 = x_72104 + redout_88640;
                    double redout_tmp_91286 = zp_res_72057;
                    double redout_tmp_91287 = zp_res_72060;
                    double redout_tmp_91288 = zp_res_72077;
                    double redout_tmp_91289 = zp_res_72080;
                    
                    redout_88637 = redout_tmp_91286;
                    redout_88638 = redout_tmp_91287;
                    redout_88639 = redout_tmp_91288;
                    redout_88640 = redout_tmp_91289;
                }
                defunc_res_87135 = redout_88637;
                defunc_res_87136 = redout_88638;
                defunc_res_87137 = redout_88639;
                defunc_res_87138 = redout_88640;
                
                bool zeze_res_72061 = defunc_res_87135 == 0.0;
                double klu_res_72062;
                
                if (zeze_res_72061) {
                    klu_res_72062 = 0.0;
                } else {
                    double zs_res_72063 = defunc_res_87135 / x_72047;
                    double log_res_72064 = futrts_log64(zs_res_72063);
                    double zt_res_72065 = log_res_72064 * defunc_res_87135;
                    
                    klu_res_72062 = zt_res_72065;
                }
                
                bool zeze_res_72066 = defunc_res_87136 == 0.0;
                double klu_res_72067;
                
                if (zeze_res_72066) {
                    klu_res_72067 = 0.0;
                } else {
                    double zs_res_72068 = defunc_res_87136 / x_72047;
                    double log_res_72069 = futrts_log64(zs_res_72068);
                    double zt_res_72070 = log_res_72069 * defunc_res_87136;
                    
                    klu_res_72067 = zt_res_72070;
                }
                
                double zp_res_48392 = klu_res_72062 + redout_88645;
                double zp_res_48628 = klu_res_72067 + redout_88646;
                double zp_res_48649 = x_72047 + redout_88647;
                double zp_res_49357 = x_72047 + redout_88648;
                
                ((double *) mem_89465)[i_88652] = defunc_res_87138;
                ((double *) mem_89467)[i_88652] = defunc_res_87137;
                ((double *) mem_89469)[i_88652] = zt_res_72051;
                
                double redout_tmp_91279 = zp_res_48392;
                double redout_tmp_91280 = zp_res_48628;
                double redout_tmp_91281 = zp_res_48649;
                double redout_tmp_91282 = zp_res_49357;
                
                redout_88645 = redout_tmp_91279;
                redout_88646 = redout_tmp_91280;
                redout_88647 = redout_tmp_91281;
                redout_88648 = redout_tmp_91282;
            }
            defunc_res_88559 = redout_88645;
            defunc_res_88560 = redout_88646;
            defunc_res_88561 = redout_88647;
            defunc_res_88562 = redout_88648;
            
            double zt_res_48393 = rho2_34205 * defunc_res_88559;
            double zt_res_48371 = rho1_34204 * defunc_res_88548;
            double zp_res_48417 = zt_res_48371 + zt_res_48393;
            double zt_res_48416 = zt_res_45683 * defunc_res_88549;
            double zp_res_48418 = zt_res_48416 + zp_res_48417;
            double defunc_0_reduce_res_88566;
            double redout_88660 = 0.0;
            
            for (int64_t i_88662 = 0; i_88662 < m_34201; i_88662++) {
                double eta_p_58811 = ((double *) mem_89465)[i_88662];
                double defunc_0_reduce_res_87139;
                double defunc_0_reduce_res_87140;
                double redout_88656;
                double redout_88657;
                
                redout_88656 = 0.0;
                redout_88657 = 0.0;
                for (int64_t i_88658 = 0; i_88658 < m_34201; i_88658++) {
                    double eta_p_60043 = ((double *) A_mem_89412.mem)[eta_p_45650 * (m_34201 * m_34201) + i_88662 * m_34201 + i_88658];
                    double eta_p_60044 = ((double *) mem_89465)[i_88658];
                    double eta_p_60045 = ((double *) mem_89467)[i_88658];
                    double zt_res_60048 = eta_p_60043 * eta_p_60043;
                    double zt_res_60050 = eta_p_60045 * zt_res_60048;
                    double zt_res_60055 = eta_p_60044 * zt_res_60048;
                    double zp_res_58825 = zt_res_60050 + redout_88656;
                    double zp_res_58839 = zt_res_60055 + redout_88657;
                    double redout_tmp_91292 = zp_res_58825;
                    double redout_tmp_91293 = zp_res_58839;
                    
                    redout_88656 = redout_tmp_91292;
                    redout_88657 = redout_tmp_91293;
                }
                defunc_0_reduce_res_87139 = redout_88656;
                defunc_0_reduce_res_87140 = redout_88657;
                
                double zt_res_58841 = eta_p_58811 * defunc_0_reduce_res_87140;
                double zp_res_48510 = zt_res_58841 + redout_88660;
                
                ((double *) mem_89489)[i_88662] = defunc_0_reduce_res_87139;
                
                double redout_tmp_91290 = zp_res_48510;
                
                redout_88660 = redout_tmp_91290;
            }
            defunc_0_reduce_res_88566 = redout_88660;
            
            double defunc_0_reduce_res_88568;
            double defunc_res_88569;
            double redout_88692;
            double redout_88693;
            
            redout_88692 = 0.0;
            redout_88693 = 0.0;
            for (int64_t i_88696 = 0; i_88696 < m_34201; i_88696++) {
                double eta_p_58508 = ((double *) mem_89432)[i_88696];
                double eta_p_58509 = ((double *) distrs_mem_89413.mem)[eta_p_45649 * m_34201 + i_88696];
                double log_res_58514 = futrts_log64(eta_p_58509);
                double zt_res_58516 = zt_res_48249 * log_res_58514;
                double defunc_0_reduce_res_87145;
                double defunc_0_reduce_res_87146;
                double redout_88664;
                double redout_88665;
                
                redout_88664 = 0.0;
                redout_88665 = 0.0;
                for (int64_t i_88666 = 0; i_88666 < m_34201; i_88666++) {
                    double eta_p_59868 = ((double *) A_mem_89412.mem)[eta_p_45649 * (m_34201 * m_34201) + i_88696 * m_34201 + i_88666];
                    double eta_p_59869 = ((double *) mem_89432)[i_88666];
                    double eta_p_59870 = ((double *) mem_89430)[i_88666];
                    double zt_res_59873 = eta_p_59868 * eta_p_59868;
                    double zt_res_59875 = eta_p_59870 * zt_res_59873;
                    double zt_res_59880 = eta_p_59869 * zt_res_59873;
                    double zp_res_58531 = zt_res_59875 + redout_88664;
                    double zp_res_58618 = zt_res_59880 + redout_88665;
                    double redout_tmp_91298 = zp_res_58531;
                    double redout_tmp_91299 = zp_res_58618;
                    
                    redout_88664 = redout_tmp_91298;
                    redout_88665 = redout_tmp_91299;
                }
                defunc_0_reduce_res_87145 = redout_88664;
                defunc_0_reduce_res_87146 = redout_88665;
                for (int64_t i_88674 = 0; i_88674 < m_34201; i_88674++) {
                    double defunc_0_reduce_res_87141;
                    double defunc_0_reduce_res_87142;
                    double redout_88667;
                    double redout_88668;
                    
                    redout_88667 = 0.0;
                    redout_88668 = 0.0;
                    for (int64_t i_88669 = 0; i_88669 < m_34201; i_88669++) {
                        double eta_p_59963 = ((double *) A_mem_89412.mem)[eta_p_45649 * (m_34201 * m_34201) + i_88696 * m_34201 + i_88669];
                        double eta_p_59964 = ((double *) mem_89435)[i_88669 * m_34201 + i_88674];
                        double zt_res_59967 = eta_p_59963 * eta_p_59964;
                        double zp_res_59893 = zt_res_59967 + redout_88667;
                        double zp_res_59903 = zt_res_59967 + redout_88668;
                        double redout_tmp_91302 = zp_res_59893;
                        double redout_tmp_91303 = zp_res_59903;
                        
                        redout_88667 = redout_tmp_91302;
                        redout_88668 = redout_tmp_91303;
                    }
                    defunc_0_reduce_res_87141 = redout_88667;
                    defunc_0_reduce_res_87142 = redout_88668;
                    ((double *) mem_89509)[i_88674] = defunc_0_reduce_res_87142;
                    ((double *) mem_89511)[i_88674] = defunc_0_reduce_res_87141;
                }
                
                double defunc_0_reduce_res_87149;
                double defunc_0_reduce_res_87150;
                double redout_88681;
                double redout_88682;
                
                redout_88681 = INFINITY;
                redout_88682 = 0.0;
                for (int64_t i_88684 = 0; i_88684 < m_34201; i_88684++) {
                    double eta_p_59907 = ((double *) mem_89435)[i_88696 * m_34201 + i_88684];
                    double eta_p_wasfree_59908 = ((double *) mem_89489)[i_88684];
                    double eta_p_wasfree_59909 = ((double *) mem_89469)[i_88684];
                    double defunc_0_reduce_res_87143;
                    double defunc_0_reduce_res_87144;
                    double redout_88677;
                    double redout_88678;
                    
                    redout_88677 = 0.0;
                    redout_88678 = 0.0;
                    for (int64_t i_88679 = 0; i_88679 < m_34201; i_88679++) {
                        double eta_p_59984 = ((double *) mem_89509)[i_88679];
                        double eta_p_59985 = ((double *) A_mem_89412.mem)[eta_p_45650 * (m_34201 * m_34201) + i_88679 * m_34201 + i_88684];
                        double eta_p_59986 = ((double *) mem_89511)[i_88679];
                        double zt_res_59988 = eta_p_59985 * eta_p_59986;
                        double zt_res_59990 = eta_p_59984 * eta_p_59985;
                        double zp_res_59919 = zt_res_59988 + redout_88677;
                        double zp_res_59948 = zt_res_59990 + redout_88678;
                        double redout_tmp_91307 = zp_res_59919;
                        double redout_tmp_91308 = zp_res_59948;
                        
                        redout_88677 = redout_tmp_91307;
                        redout_88678 = redout_tmp_91308;
                    }
                    defunc_0_reduce_res_87143 = redout_88677;
                    defunc_0_reduce_res_87144 = redout_88678;
                    
                    double zt_res_59921 = -2.0 * defunc_0_reduce_res_87143;
                    double zp_res_59923 = zt_res_59921 + defunc_0_reduce_res_87145;
                    double zp_res_59925 = eta_p_wasfree_59908 + zp_res_59923;
                    double zp_res_59927 = zp_res_48418 + zp_res_59925;
                    double zm_res_59929 = zp_res_59927 - zt_res_58516;
                    double zm_res_59931 = zm_res_59929 - eta_p_wasfree_59909;
                    double zs_res_59933 = zm_res_59931 / defunc_res_88550;
                    double zs_res_59935 = zs_res_59933 / neg_res_45703;
                    double zm_res_59937 = safe_for_exp_34210 - zs_res_59935;
                    double zt_res_59950 = eta_p_59907 * defunc_0_reduce_res_87144;
                    double min_res_58599 = fmin64(zm_res_59937, redout_88681);
                    double zp_res_58656 = zt_res_59950 + redout_88682;
                    
                    ((double *) mem_89525)[i_88684] = zs_res_59935;
                    
                    double redout_tmp_91304 = min_res_58599;
                    double redout_tmp_91305 = zp_res_58656;
                    
                    redout_88681 = redout_tmp_91304;
                    redout_88682 = redout_tmp_91305;
                }
                defunc_0_reduce_res_87149 = redout_88681;
                defunc_0_reduce_res_87150 = redout_88682;
                for (int64_t i_88688 = 0; i_88688 < m_34201; i_88688++) {
                    double eta_p_58602 = ((double *) mem_89525)[i_88688];
                    double zp_res_58603 = eta_p_58602 + defunc_0_reduce_res_87149;
                    
                    ((double *) mem_89498)[i_88696 * m_34201 + i_88688] = zp_res_58603;
                }
                
                double zt_res_58620 = eta_p_58508 * defunc_0_reduce_res_87146;
                double zp_res_48486 = zt_res_58620 + redout_88692;
                double zp_res_48555 = defunc_0_reduce_res_87150 + redout_88693;
                
                ((double *) mem_89500.mem)[i_88696] = defunc_0_reduce_res_87149;
                
                double redout_tmp_91294 = zp_res_48486;
                double redout_tmp_91295 = zp_res_48555;
                
                redout_88692 = redout_tmp_91294;
                redout_88693 = redout_tmp_91295;
            }
            defunc_0_reduce_res_88568 = redout_88692;
            defunc_res_88569 = redout_88693;
            for (int64_t i_88703 = 0; i_88703 < m_34201; i_88703++) {
                double defunc_0_reduce_res_87153;
                double redout_88699 = INFINITY;
                
                for (int64_t i_88700 = 0; i_88700 < m_34201; i_88700++) {
                    double eta_p_60060 = ((double *) mem_89498)[i_88700 * m_34201 + i_88703];
                    double zm_res_60061 = safe_for_exp_34210 - eta_p_60060;
                    double min_res_46633 = fmin64(zm_res_60061, redout_88699);
                    double redout_tmp_91311 = min_res_46633;
                    
                    redout_88699 = redout_tmp_91311;
                }
                defunc_0_reduce_res_87153 = redout_88699;
                ((double *) mem_89548.mem)[i_88703] = defunc_0_reduce_res_87153;
            }
            
            double zp_res_46651 = rho1_34204 + zt_res_45683;
            double zs_res_46654 = neg_res_45703 / zp_res_46651;
            double zs_res_46652 = neg_res_46650 / zp_res_46651;
            
            for (int64_t i_88714 = 0; i_88714 < m_34201; i_88714++) {
                double eta_p_56828 = ((double *) distrs_mem_89413.mem)[eta_p_45649 * m_34201 + i_88714];
                double eta_p_56829 = ((double *) mem_89500.mem)[i_88714];
                double defunc_0_reduce_res_87154;
                double redout_88706 = 0.0;
                
                for (int64_t i_88708 = 0; i_88708 < m_34201; i_88708++) {
                    double eta_p_60069 = ((double *) mem_89498)[i_88714 * m_34201 + i_88708];
                    double eta_p_wasfree_60070 = ((double *) mem_89548.mem)[i_88708];
                    double zp_res_60071 = eta_p_60069 + eta_p_wasfree_60070;
                    double exp_res_60073 = futrts_exp64(zp_res_60071);
                    double zp_res_56845 = exp_res_60073 + redout_88706;
                    
                    ((double *) mem_89559.mem)[i_88714 * m_34201 + i_88708] = exp_res_60073;
                    
                    double redout_tmp_91314 = zp_res_56845;
                    
                    redout_88706 = redout_tmp_91314;
                }
                defunc_0_reduce_res_87154 = redout_88706;
                
                double zs_res_56847 = defunc_0_reduce_res_87154 / eta_p_56828;
                double ztzt_res_56849 = fpow64(zs_res_56847, zs_res_46652);
                double zt_res_56851 = zs_res_46654 * eta_p_56829;
                double exp_res_56853 = futrts_exp64(zt_res_56851);
                double zt_res_56855 = ztzt_res_56849 * exp_res_56853;
                
                ((double *) mem_89556)[i_88714] = zt_res_56855;
            }
            
            double zp_res_46692 = rho2_34205 + zt_res_45683;
            double zs_res_46695 = neg_res_45703 / zp_res_46692;
            double zs_res_46693 = neg_res_46691 / zp_res_46692;
            bool defunc_0_reduce_res_88578;
            bool redout_88720 = 0;
            
            for (int64_t i_88722 = 0; i_88722 < m_34201; i_88722++) {
                double eta_p_56721 = ((double *) distrs_mem_89413.mem)[eta_p_45650 * m_34201 + i_88722];
                double eta_p_56722 = ((double *) mem_89548.mem)[i_88722];
                double defunc_0_reduce_res_87156;
                double redout_88717 = 0.0;
                
                for (int64_t i_88718 = 0; i_88718 < m_34201; i_88718++) {
                    double eta_p_60078 = ((double *) mem_89556)[i_88718];
                    double eta_p_60079 = ((double *) mem_89559.mem)[i_88718 * m_34201 + i_88722];
                    double zt_res_60080 = eta_p_60078 * eta_p_60079;
                    double zp_res_56731 = zt_res_60080 + redout_88717;
                    double redout_tmp_91318 = zp_res_56731;
                    
                    redout_88717 = redout_tmp_91318;
                }
                defunc_0_reduce_res_87156 = redout_88717;
                
                double zs_res_56733 = defunc_0_reduce_res_87156 / eta_p_56721;
                double ztzt_res_56735 = fpow64(zs_res_56733, zs_res_46693);
                double zt_res_56737 = zs_res_46695 * eta_p_56722;
                double exp_res_56739 = futrts_exp64(zt_res_56737);
                double zt_res_56741 = ztzt_res_56735 * exp_res_56739;
                bool zgze_res_56743 = exp_absorb_cutoff_34209 <= zt_res_56741;
                bool defunc_0_op_res_45753 = zgze_res_56743 || redout_88720;
                
                ((double *) mem_89583.mem)[i_88722] = zt_res_56741;
                
                bool redout_tmp_91316 = defunc_0_op_res_45753;
                
                redout_88720 = redout_tmp_91316;
            }
            defunc_0_reduce_res_88578 = redout_88720;
            
            bool defunc_0_reduce_res_88581;
            bool redout_88727 = 0;
            
            for (int64_t i_88729 = 0; i_88729 < m_34201; i_88729++) {
                double eta_p_56639 = ((double *) distrs_mem_89413.mem)[eta_p_45649 * m_34201 + i_88729];
                double eta_p_56640 = ((double *) mem_89500.mem)[i_88729];
                double defunc_0_reduce_res_87157;
                double redout_88724 = 0.0;
                
                for (int64_t i_88725 = 0; i_88725 < m_34201; i_88725++) {
                    double eta_p_60084 = ((double *) mem_89583.mem)[i_88725];
                    double eta_p_60085 = ((double *) mem_89559.mem)[i_88729 * m_34201 + i_88725];
                    double zt_res_60086 = eta_p_60084 * eta_p_60085;
                    double zp_res_56649 = zt_res_60086 + redout_88724;
                    double redout_tmp_91321 = zp_res_56649;
                    
                    redout_88724 = redout_tmp_91321;
                }
                defunc_0_reduce_res_87157 = redout_88724;
                
                double zs_res_56651 = defunc_0_reduce_res_87157 / eta_p_56639;
                double ztzt_res_56653 = fpow64(zs_res_56651, zs_res_46652);
                double zt_res_56655 = zs_res_46654 * eta_p_56640;
                double exp_res_56657 = futrts_exp64(zt_res_56655);
                double zt_res_56659 = ztzt_res_56653 * exp_res_56657;
                bool zgze_res_56661 = exp_absorb_cutoff_34209 <= zt_res_56659;
                bool defunc_0_op_res_45728 = zgze_res_56661 || redout_88727;
                
                ((double *) mem_89591.mem)[i_88729] = zt_res_56659;
                
                bool redout_tmp_91319 = defunc_0_op_res_45728;
                
                redout_88727 = redout_tmp_91319;
            }
            defunc_0_reduce_res_88581 = redout_88727;
            
            bool x_91032 = !defunc_0_reduce_res_88581;
            bool defunc_0_reduce_res_87158;
            
            if (x_91032) {
                bool x_91034;
                bool redout_88731 = 0;
                
                for (int64_t i_88732 = 0; i_88732 < m_34201; i_88732++) {
                    double eta_p_60090 = ((double *) mem_89591.mem)[i_88732];
                    bool zlze_res_60091 = eta_p_60090 <= zs_res_45730;
                    bool defunc_0_op_res_45738 = zlze_res_60091 || redout_88731;
                    bool redout_tmp_91322 = defunc_0_op_res_45738;
                    
                    redout_88731 = redout_tmp_91322;
                }
                x_91034 = redout_88731;
                defunc_0_reduce_res_87158 = x_91034;
            } else {
                defunc_0_reduce_res_87158 = 0;
            }
            
            bool cond_45729 = defunc_0_reduce_res_87158 || defunc_0_reduce_res_88581;
            
            if (cond_45729) {
                if (memblock_alloc(ctx, &mem_89599, bytes_89416, "mem_89599")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_89601, bytes_89416, "mem_89601")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_89604, bytes_89434, "mem_89604")) {
                    err = 1;
                    goto cleanup;
                }
                for (int64_t i_88743 = 0; i_88743 < m_34201; i_88743++) {
                    double eta_p_87175 = ((double *) mem_89591.mem)[i_88743];
                    double eta_p_87176 = ((double *) mem_89500.mem)[i_88743];
                    bool zgze_res_87178 = exp_absorb_cutoff_34209 <= eta_p_87175;
                    bool zl_res_87179 = eta_p_87175 < zs_res_45730;
                    bool x_87180 = !zgze_res_87178;
                    bool y_87181 = zl_res_87179 && x_87180;
                    bool cond_87182 = zgze_res_87178 || y_87181;
                    int64_t binop_y_89623 = m_34201 * i_88743;
                    int64_t ext_89626;
                    
                    if (cond_87182) {
                        ext_89626 = (int64_t) 0;
                    } else {
                        ext_89626 = binop_y_89623;
                    }
                    
                    double rescale_res_87183;
                    double rescale_res_87184;
                    
                    if (cond_87182) {
                        double log_res_87186 = futrts_log64(eta_p_87175);
                        double sqrt_res_87187 = futrts_sqrt64(eta_p_87175);
                        double zs_res_87188 = log_res_87186 / 2.0;
                        double zp_res_87189 = eta_p_87176 + zs_res_87188;
                        
                        if (memblock_alloc(ctx, &mem_89616, bytes_89416, "mem_89616")) {
                            err = 1;
                            goto cleanup;
                        }
                        for (int64_t i_88735 = 0; i_88735 < m_34201; i_88735++) {
                            double eta_p_87191 = ((double *) mem_89559.mem)[i_88743 * m_34201 + i_88735];
                            double zt_res_87192 = sqrt_res_87187 * eta_p_87191;
                            
                            ((double *) mem_89616.mem)[i_88735] = zt_res_87192;
                        }
                        if (memblock_set(ctx, &ext_mem_89627, &mem_89616, "mem_89616") != 0)
                            return 1;
                        rescale_res_87183 = sqrt_res_87187;
                        rescale_res_87184 = zp_res_87189;
                    } else {
                        if (memblock_set(ctx, &ext_mem_89627, &mem_89559, "mem_89559") != 0)
                            return 1;
                        rescale_res_87183 = eta_p_87175;
                        rescale_res_87184 = eta_p_87176;
                    }
                    ((double *) mem_89599.mem)[i_88743] = rescale_res_87183;
                    ((double *) mem_89601.mem)[i_88743] = rescale_res_87184;
                    lmad_copy_8b(ctx, 1, (uint64_t *) mem_89604.mem, i_88743 * m_34201, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_89627.mem, ext_89626, (int64_t []) {(int64_t) 1}, (int64_t []) {m_34201});
                    if (memblock_unref(ctx, &ext_mem_89627, "ext_mem_89627") != 0)
                        return 1;
                }
                if (memblock_set(ctx, &ext_mem_89647, &mem_89599, "mem_89599") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89644, &mem_89601, "mem_89601") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89641, &mem_89604, "mem_89604") != 0)
                    return 1;
            } else {
                if (memblock_set(ctx, &ext_mem_89647, &mem_89591, "mem_89591") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89644, &mem_89500, "mem_89500") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89641, &mem_89559, "mem_89559") != 0)
                    return 1;
            }
            
            bool x_91028 = !defunc_0_reduce_res_88578;
            bool defunc_0_reduce_res_87197;
            
            if (x_91028) {
                bool x_91030;
                bool redout_88747 = 0;
                
                for (int64_t i_88748 = 0; i_88748 < m_34201; i_88748++) {
                    double eta_p_60133 = ((double *) mem_89583.mem)[i_88748];
                    bool zlze_res_60134 = eta_p_60133 <= zs_res_45730;
                    bool defunc_0_op_res_45763 = zlze_res_60134 || redout_88747;
                    bool redout_tmp_91327 = defunc_0_op_res_45763;
                    
                    redout_88747 = redout_tmp_91327;
                }
                x_91030 = redout_88747;
                defunc_0_reduce_res_87197 = x_91030;
            } else {
                defunc_0_reduce_res_87197 = 0;
            }
            
            bool cond_45754 = defunc_0_reduce_res_87197 || defunc_0_reduce_res_88578;
            int64_t ext_89689;
            
            if (cond_45754) {
                ext_89689 = (int64_t) 1;
            } else {
                ext_89689 = m_34201;
            }
            
            int64_t ext_89688;
            
            if (cond_45754) {
                ext_89688 = m_34201;
            } else {
                ext_89688 = (int64_t) 1;
            }
            if (cond_45754) {
                if (memblock_alloc(ctx, &mem_89649, bytes_89416, "mem_89649")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_89651, bytes_89416, "mem_89651")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_89654, bytes_89434, "mem_89654")) {
                    err = 1;
                    goto cleanup;
                }
                for (int64_t i_88759 = 0; i_88759 < m_34201; i_88759++) {
                    double eta_p_87216 = ((double *) mem_89583.mem)[i_88759];
                    double eta_p_87217 = ((double *) mem_89548.mem)[i_88759];
                    bool zgze_res_87219 = exp_absorb_cutoff_34209 <= eta_p_87216;
                    bool zl_res_87220 = eta_p_87216 < zs_res_45730;
                    bool x_87221 = !zgze_res_87219;
                    bool y_87222 = zl_res_87220 && x_87221;
                    bool cond_87223 = zgze_res_87219 || y_87222;
                    int64_t ext_89676;
                    
                    if (cond_87223) {
                        ext_89676 = (int64_t) 0;
                    } else {
                        ext_89676 = i_88759;
                    }
                    
                    int64_t ext_89675;
                    
                    if (cond_87223) {
                        ext_89675 = (int64_t) 1;
                    } else {
                        ext_89675 = m_34201;
                    }
                    
                    double rescale_res_87224;
                    double rescale_res_87225;
                    
                    if (cond_87223) {
                        double log_res_87227 = futrts_log64(eta_p_87216);
                        double sqrt_res_87228 = futrts_sqrt64(eta_p_87216);
                        double zs_res_87229 = log_res_87227 / 2.0;
                        double zp_res_87230 = eta_p_87217 + zs_res_87229;
                        
                        if (memblock_alloc(ctx, &mem_89666, bytes_89416, "mem_89666")) {
                            err = 1;
                            goto cleanup;
                        }
                        for (int64_t i_88751 = 0; i_88751 < m_34201; i_88751++) {
                            double eta_p_87232 = ((double *) ext_mem_89641.mem)[i_88751 * m_34201 + i_88759];
                            double zt_res_87233 = sqrt_res_87228 * eta_p_87232;
                            
                            ((double *) mem_89666.mem)[i_88751] = zt_res_87233;
                        }
                        if (memblock_set(ctx, &ext_mem_89677, &mem_89666, "mem_89666") != 0)
                            return 1;
                        rescale_res_87224 = sqrt_res_87228;
                        rescale_res_87225 = zp_res_87230;
                    } else {
                        if (memblock_set(ctx, &ext_mem_89677, &ext_mem_89641, "ext_mem_89641") != 0)
                            return 1;
                        rescale_res_87224 = eta_p_87216;
                        rescale_res_87225 = eta_p_87217;
                    }
                    ((double *) mem_89649.mem)[i_88759] = rescale_res_87224;
                    ((double *) mem_89651.mem)[i_88759] = rescale_res_87225;
                    lmad_copy_8b(ctx, 1, (uint64_t *) mem_89654.mem, i_88759 * m_34201, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_89677.mem, ext_89676, (int64_t []) {ext_89675}, (int64_t []) {m_34201});
                    if (memblock_unref(ctx, &ext_mem_89677, "ext_mem_89677") != 0)
                        return 1;
                }
                if (memblock_set(ctx, &ext_mem_89697, &mem_89649, "mem_89649") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89694, &mem_89651, "mem_89651") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89691, &mem_89654, "mem_89654") != 0)
                    return 1;
            } else {
                if (memblock_set(ctx, &ext_mem_89697, &mem_89583, "mem_89583") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89694, &mem_89548, "mem_89548") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89691, &ext_mem_89641, "ext_mem_89641") != 0)
                    return 1;
            }
            if (memblock_unref(ctx, &ext_mem_89641, "ext_mem_89641") != 0)
                return 1;
            
            double defunc_0_reduce_res_88583;
            double redout_88763 = 0.0;
            
            for (int64_t i_88764 = 0; i_88764 < m_34201; i_88764++) {
                double eta_p_56565 = ((double *) mem_89556)[i_88764];
                double eta_p_56566 = ((double *) ext_mem_89647.mem)[i_88764];
                double zs_res_56567 = eta_p_56565 / eta_p_56566;
                double zm_res_56569 = zs_res_56567 - 1.0;
                double abs_res_56571 = fabs64(zm_res_56569);
                double max_res_46838 = fmax64(abs_res_56571, redout_88763);
                double redout_tmp_91332 = max_res_46838;
                
                redout_88763 = redout_tmp_91332;
            }
            defunc_0_reduce_res_88583 = redout_88763;
            
            bool zgze_res_45774 = tol_sinkhorn_34211 <= defunc_0_reduce_res_88583;
            int64_t ext_89840;
            int64_t ext_89839;
            int64_t ext_89838;
            bool algo3_core_loop_res_45775;
            bool loop_while_45781;
            int64_t ctx_param_ext_89698;
            int64_t ctx_param_ext_89699;
            int64_t ctx_param_ext_89700;
            
            if (memblock_set(ctx, &mem_param_89701, &ext_mem_89691, "ext_mem_89691") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_89704, &ext_mem_89647, "ext_mem_89647") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_89707, &ext_mem_89697, "ext_mem_89697") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_89710, &ext_mem_89644, "ext_mem_89644") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_89713, &ext_mem_89694, "ext_mem_89694") != 0)
                return 1;
            ctx_param_ext_89698 = (int64_t) 0;
            ctx_param_ext_89699 = ext_89689;
            ctx_param_ext_89700 = ext_89688;
            loop_while_45781 = zgze_res_45774;
            while (loop_while_45781) {
                if (memblock_alloc(ctx, &mem_89715, bytes_89416, "mem_89715")) {
                    err = 1;
                    goto cleanup;
                }
                
                bool defunc_0_reduce_res_87322;
                bool redout_88768 = 0;
                
                for (int64_t i_88770 = 0; i_88770 < m_34201; i_88770++) {
                    double eta_p_60345 = ((double *) distrs_mem_89413.mem)[eta_p_45650 * m_34201 + i_88770];
                    double eta_p_60346 = ((double *) mem_param_89713.mem)[i_88770];
                    double defunc_0_reduce_res_87239;
                    double redout_88765 = 0.0;
                    
                    for (int64_t i_88766 = 0; i_88766 < m_34201; i_88766++) {
                        double eta_p_60370 = ((double *) mem_param_89704.mem)[i_88766];
                        double eta_p_60371 = ((double *) mem_param_89701.mem)[ctx_param_ext_89698 + (i_88766 * ctx_param_ext_89699 + i_88770 * ctx_param_ext_89700)];
                        double zt_res_60372 = eta_p_60370 * eta_p_60371;
                        double zp_res_60355 = zt_res_60372 + redout_88765;
                        double redout_tmp_91349 = zp_res_60355;
                        
                        redout_88765 = redout_tmp_91349;
                    }
                    defunc_0_reduce_res_87239 = redout_88765;
                    
                    double zs_res_60357 = defunc_0_reduce_res_87239 / eta_p_60345;
                    double ztzt_res_60359 = fpow64(zs_res_60357, zs_res_46693);
                    double zt_res_60361 = zs_res_46695 * eta_p_60346;
                    double exp_res_60363 = futrts_exp64(zt_res_60361);
                    double zt_res_60365 = ztzt_res_60359 * exp_res_60363;
                    bool zgze_res_60367 = exp_absorb_cutoff_34209 <= zt_res_60365;
                    bool defunc_0_op_res_45822 = zgze_res_60367 || redout_88768;
                    
                    ((double *) mem_89715.mem)[i_88770] = zt_res_60365;
                    
                    bool redout_tmp_91347 = defunc_0_op_res_45822;
                    
                    redout_88768 = redout_tmp_91347;
                }
                defunc_0_reduce_res_87322 = redout_88768;
                if (memblock_alloc(ctx, &mem_89723, bytes_89416, "mem_89723")) {
                    err = 1;
                    goto cleanup;
                }
                
                bool defunc_0_reduce_res_87325;
                bool redout_88775 = 0;
                
                for (int64_t i_88777 = 0; i_88777 < m_34201; i_88777++) {
                    double eta_p_60263 = ((double *) distrs_mem_89413.mem)[eta_p_45649 * m_34201 + i_88777];
                    double eta_p_60264 = ((double *) mem_param_89710.mem)[i_88777];
                    double defunc_0_reduce_res_87240;
                    double redout_88772 = 0.0;
                    
                    for (int64_t i_88773 = 0; i_88773 < m_34201; i_88773++) {
                        double eta_p_60376 = ((double *) mem_89715.mem)[i_88773];
                        double eta_p_60377 = ((double *) mem_param_89701.mem)[ctx_param_ext_89698 + (i_88777 * ctx_param_ext_89699 + i_88773 * ctx_param_ext_89700)];
                        double zt_res_60378 = eta_p_60376 * eta_p_60377;
                        double zp_res_60273 = zt_res_60378 + redout_88772;
                        double redout_tmp_91352 = zp_res_60273;
                        
                        redout_88772 = redout_tmp_91352;
                    }
                    defunc_0_reduce_res_87240 = redout_88772;
                    
                    double zs_res_60275 = defunc_0_reduce_res_87240 / eta_p_60263;
                    double ztzt_res_60277 = fpow64(zs_res_60275, zs_res_46652);
                    double zt_res_60279 = zs_res_46654 * eta_p_60264;
                    double exp_res_60281 = futrts_exp64(zt_res_60279);
                    double zt_res_60283 = ztzt_res_60277 * exp_res_60281;
                    bool zgze_res_60285 = exp_absorb_cutoff_34209 <= zt_res_60283;
                    bool defunc_0_op_res_45797 = zgze_res_60285 || redout_88775;
                    
                    ((double *) mem_89723.mem)[i_88777] = zt_res_60283;
                    
                    bool redout_tmp_91350 = defunc_0_op_res_45797;
                    
                    redout_88775 = redout_tmp_91350;
                }
                defunc_0_reduce_res_87325 = redout_88775;
                
                bool x_91024 = !defunc_0_reduce_res_87325;
                bool defunc_0_reduce_res_87241;
                
                if (x_91024) {
                    bool x_91026;
                    bool redout_88779 = 0;
                    
                    for (int64_t i_88780 = 0; i_88780 < m_34201; i_88780++) {
                        double eta_p_60382 = ((double *) mem_89723.mem)[i_88780];
                        bool zlze_res_60383 = eta_p_60382 <= zs_res_45730;
                        bool defunc_0_op_res_45807 = zlze_res_60383 || redout_88779;
                        bool redout_tmp_91353 = defunc_0_op_res_45807;
                        
                        redout_88779 = redout_tmp_91353;
                    }
                    x_91026 = redout_88779;
                    defunc_0_reduce_res_87241 = x_91026;
                } else {
                    defunc_0_reduce_res_87241 = 0;
                }
                
                bool cond_45798 = defunc_0_reduce_res_87241 || defunc_0_reduce_res_87325;
                int64_t ext_89772;
                
                if (cond_45798) {
                    ext_89772 = (int64_t) 0;
                } else {
                    ext_89772 = ctx_param_ext_89698;
                }
                
                int64_t ext_89771;
                
                if (cond_45798) {
                    ext_89771 = m_34201;
                } else {
                    ext_89771 = ctx_param_ext_89699;
                }
                
                int64_t ext_89770;
                
                if (cond_45798) {
                    ext_89770 = (int64_t) 1;
                } else {
                    ext_89770 = ctx_param_ext_89700;
                }
                if (cond_45798) {
                    if (memblock_alloc(ctx, &mem_89731, bytes_89416, "mem_89731")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_89733, bytes_89416, "mem_89733")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_89736, bytes_89434, "mem_89736")) {
                        err = 1;
                        goto cleanup;
                    }
                    for (int64_t i_88791 = 0; i_88791 < m_34201; i_88791++) {
                        double eta_p_87258 = ((double *) mem_89723.mem)[i_88791];
                        double eta_p_87259 = ((double *) mem_param_89710.mem)[i_88791];
                        bool zgze_res_87261 = exp_absorb_cutoff_34209 <= eta_p_87258;
                        bool zl_res_87262 = eta_p_87258 < zs_res_45730;
                        bool x_87263 = !zgze_res_87261;
                        bool y_87264 = zl_res_87262 && x_87263;
                        bool cond_87265 = zgze_res_87261 || y_87264;
                        int64_t binop_y_89755 = i_88791 * ctx_param_ext_89699;
                        int64_t lmad_ext_89756 = ctx_param_ext_89698 + binop_y_89755;
                        int64_t ext_89758;
                        
                        if (cond_87265) {
                            ext_89758 = (int64_t) 0;
                        } else {
                            ext_89758 = lmad_ext_89756;
                        }
                        
                        int64_t ext_89757;
                        
                        if (cond_87265) {
                            ext_89757 = (int64_t) 1;
                        } else {
                            ext_89757 = ctx_param_ext_89700;
                        }
                        
                        double rescale_res_87266;
                        double rescale_res_87267;
                        
                        if (cond_87265) {
                            double log_res_87269 = futrts_log64(eta_p_87258);
                            double sqrt_res_87270 = futrts_sqrt64(eta_p_87258);
                            double zs_res_87271 = log_res_87269 / 2.0;
                            double zp_res_87272 = eta_p_87259 + zs_res_87271;
                            
                            if (memblock_alloc(ctx, &mem_89748, bytes_89416, "mem_89748")) {
                                err = 1;
                                goto cleanup;
                            }
                            for (int64_t i_88783 = 0; i_88783 < m_34201; i_88783++) {
                                double eta_p_87274 = ((double *) mem_param_89701.mem)[ctx_param_ext_89698 + (i_88791 * ctx_param_ext_89699 + i_88783 * ctx_param_ext_89700)];
                                double zt_res_87275 = sqrt_res_87270 * eta_p_87274;
                                
                                ((double *) mem_89748.mem)[i_88783] = zt_res_87275;
                            }
                            if (memblock_set(ctx, &ext_mem_89759, &mem_89748, "mem_89748") != 0)
                                return 1;
                            rescale_res_87266 = sqrt_res_87270;
                            rescale_res_87267 = zp_res_87272;
                        } else {
                            if (memblock_set(ctx, &ext_mem_89759, &mem_param_89701, "mem_param_89701") != 0)
                                return 1;
                            rescale_res_87266 = eta_p_87258;
                            rescale_res_87267 = eta_p_87259;
                        }
                        ((double *) mem_89731.mem)[i_88791] = rescale_res_87266;
                        ((double *) mem_89733.mem)[i_88791] = rescale_res_87267;
                        lmad_copy_8b(ctx, 1, (uint64_t *) mem_89736.mem, i_88791 * m_34201, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_89759.mem, ext_89758, (int64_t []) {ext_89757}, (int64_t []) {m_34201});
                        if (memblock_unref(ctx, &ext_mem_89759, "ext_mem_89759") != 0)
                            return 1;
                    }
                    if (memblock_set(ctx, &ext_mem_89779, &mem_89731, "mem_89731") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_89776, &mem_89733, "mem_89733") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_89773, &mem_89736, "mem_89736") != 0)
                        return 1;
                } else {
                    if (memblock_set(ctx, &ext_mem_89779, &mem_89723, "mem_89723") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_89776, &mem_param_89710, "mem_param_89710") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_89773, &mem_param_89701, "mem_param_89701") != 0)
                        return 1;
                }
                if (memblock_unref(ctx, &mem_89723, "mem_89723") != 0)
                    return 1;
                
                bool x_91102 = !defunc_0_reduce_res_87322;
                bool defunc_0_reduce_res_87280;
                
                if (x_91102) {
                    bool x_91104;
                    bool redout_88795 = 0;
                    
                    for (int64_t i_88796 = 0; i_88796 < m_34201; i_88796++) {
                        double eta_p_60425 = ((double *) mem_89715.mem)[i_88796];
                        bool zlze_res_60426 = eta_p_60425 <= zs_res_45730;
                        bool defunc_0_op_res_45832 = zlze_res_60426 || redout_88795;
                        bool redout_tmp_91358 = defunc_0_op_res_45832;
                        
                        redout_88795 = redout_tmp_91358;
                    }
                    x_91104 = redout_88795;
                    defunc_0_reduce_res_87280 = x_91104;
                } else {
                    defunc_0_reduce_res_87280 = 0;
                }
                
                bool cond_45823 = defunc_0_reduce_res_87280 || defunc_0_reduce_res_87322;
                int64_t ext_89822;
                
                if (cond_45823) {
                    ext_89822 = (int64_t) 0;
                } else {
                    ext_89822 = ext_89772;
                }
                
                int64_t ext_89821;
                
                if (cond_45823) {
                    ext_89821 = (int64_t) 1;
                } else {
                    ext_89821 = ext_89771;
                }
                
                int64_t ext_89820;
                
                if (cond_45823) {
                    ext_89820 = m_34201;
                } else {
                    ext_89820 = ext_89770;
                }
                if (cond_45823) {
                    if (memblock_alloc(ctx, &mem_89781, bytes_89416, "mem_89781")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_89783, bytes_89416, "mem_89783")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_89786, bytes_89434, "mem_89786")) {
                        err = 1;
                        goto cleanup;
                    }
                    for (int64_t i_88807 = 0; i_88807 < m_34201; i_88807++) {
                        double eta_p_87299 = ((double *) mem_89715.mem)[i_88807];
                        double eta_p_87300 = ((double *) mem_param_89713.mem)[i_88807];
                        bool zgze_res_87302 = exp_absorb_cutoff_34209 <= eta_p_87299;
                        bool zl_res_87303 = eta_p_87299 < zs_res_45730;
                        bool x_87304 = !zgze_res_87302;
                        bool y_87305 = zl_res_87303 && x_87304;
                        bool cond_87306 = zgze_res_87302 || y_87305;
                        int64_t binop_y_89805 = i_88807 * ext_89770;
                        int64_t lmad_ext_89806 = ext_89772 + binop_y_89805;
                        int64_t ext_89808;
                        
                        if (cond_87306) {
                            ext_89808 = (int64_t) 0;
                        } else {
                            ext_89808 = lmad_ext_89806;
                        }
                        
                        int64_t ext_89807;
                        
                        if (cond_87306) {
                            ext_89807 = (int64_t) 1;
                        } else {
                            ext_89807 = ext_89771;
                        }
                        
                        double rescale_res_87307;
                        double rescale_res_87308;
                        
                        if (cond_87306) {
                            double log_res_87310 = futrts_log64(eta_p_87299);
                            double sqrt_res_87311 = futrts_sqrt64(eta_p_87299);
                            double zs_res_87312 = log_res_87310 / 2.0;
                            double zp_res_87313 = eta_p_87300 + zs_res_87312;
                            
                            if (memblock_alloc(ctx, &mem_89798, bytes_89416, "mem_89798")) {
                                err = 1;
                                goto cleanup;
                            }
                            for (int64_t i_88799 = 0; i_88799 < m_34201; i_88799++) {
                                double eta_p_87315 = ((double *) ext_mem_89773.mem)[ext_89772 + (i_88799 * ext_89771 + i_88807 * ext_89770)];
                                double zt_res_87316 = sqrt_res_87311 * eta_p_87315;
                                
                                ((double *) mem_89798.mem)[i_88799] = zt_res_87316;
                            }
                            if (memblock_set(ctx, &ext_mem_89809, &mem_89798, "mem_89798") != 0)
                                return 1;
                            rescale_res_87307 = sqrt_res_87311;
                            rescale_res_87308 = zp_res_87313;
                        } else {
                            if (memblock_set(ctx, &ext_mem_89809, &ext_mem_89773, "ext_mem_89773") != 0)
                                return 1;
                            rescale_res_87307 = eta_p_87299;
                            rescale_res_87308 = eta_p_87300;
                        }
                        ((double *) mem_89781.mem)[i_88807] = rescale_res_87307;
                        ((double *) mem_89783.mem)[i_88807] = rescale_res_87308;
                        lmad_copy_8b(ctx, 1, (uint64_t *) mem_89786.mem, i_88807 * m_34201, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_89809.mem, ext_89808, (int64_t []) {ext_89807}, (int64_t []) {m_34201});
                        if (memblock_unref(ctx, &ext_mem_89809, "ext_mem_89809") != 0)
                            return 1;
                    }
                    if (memblock_set(ctx, &ext_mem_89829, &mem_89781, "mem_89781") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_89826, &mem_89783, "mem_89783") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_89823, &mem_89786, "mem_89786") != 0)
                        return 1;
                } else {
                    if (memblock_set(ctx, &ext_mem_89829, &mem_89715, "mem_89715") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_89826, &mem_param_89713, "mem_param_89713") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_89823, &ext_mem_89773, "ext_mem_89773") != 0)
                        return 1;
                }
                if (memblock_unref(ctx, &mem_89715, "mem_89715") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_89773, "ext_mem_89773") != 0)
                    return 1;
                
                double defunc_0_reduce_res_87327;
                double redout_88811 = 0.0;
                
                for (int64_t i_88812 = 0; i_88812 < m_34201; i_88812++) {
                    double eta_p_60189 = ((double *) mem_param_89704.mem)[i_88812];
                    double eta_p_60190 = ((double *) ext_mem_89779.mem)[i_88812];
                    double zs_res_60191 = eta_p_60189 / eta_p_60190;
                    double zm_res_60193 = zs_res_60191 - 1.0;
                    double abs_res_60195 = fabs64(zm_res_60193);
                    double max_res_46994 = fmax64(abs_res_60195, redout_88811);
                    double redout_tmp_91363 = max_res_46994;
                    
                    redout_88811 = redout_tmp_91363;
                }
                defunc_0_reduce_res_87327 = redout_88811;
                
                bool zgze_res_45843 = tol_sinkhorn_34211 <= defunc_0_reduce_res_87327;
                
                if (memblock_set(ctx, &mem_param_tmp_91333, &ext_mem_89823, "ext_mem_89823") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91334, &ext_mem_89779, "ext_mem_89779") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91335, &ext_mem_89829, "ext_mem_89829") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91336, &ext_mem_89776, "ext_mem_89776") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91337, &ext_mem_89826, "ext_mem_89826") != 0)
                    return 1;
                
                int64_t ctx_param_ext_tmp_91338 = ext_89822;
                int64_t ctx_param_ext_tmp_91339 = ext_89821;
                int64_t ctx_param_ext_tmp_91340 = ext_89820;
                bool loop_while_tmp_91341 = zgze_res_45843;
                
                if (memblock_set(ctx, &mem_param_89701, &mem_param_tmp_91333, "mem_param_tmp_91333") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_89704, &mem_param_tmp_91334, "mem_param_tmp_91334") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_89707, &mem_param_tmp_91335, "mem_param_tmp_91335") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_89710, &mem_param_tmp_91336, "mem_param_tmp_91336") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_89713, &mem_param_tmp_91337, "mem_param_tmp_91337") != 0)
                    return 1;
                ctx_param_ext_89698 = ctx_param_ext_tmp_91338;
                ctx_param_ext_89699 = ctx_param_ext_tmp_91339;
                ctx_param_ext_89700 = ctx_param_ext_tmp_91340;
                loop_while_45781 = loop_while_tmp_91341;
            }
            if (memblock_set(ctx, &ext_mem_89845, &mem_param_89701, "mem_param_89701") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_89844, &mem_param_89704, "mem_param_89704") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_89843, &mem_param_89707, "mem_param_89707") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_89842, &mem_param_89710, "mem_param_89710") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_89841, &mem_param_89713, "mem_param_89713") != 0)
                return 1;
            ext_89840 = ctx_param_ext_89698;
            ext_89839 = ctx_param_ext_89699;
            ext_89838 = ctx_param_ext_89700;
            algo3_core_loop_res_45775 = loop_while_45781;
            if (memblock_unref(ctx, &ext_mem_89644, "ext_mem_89644") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_89647, "ext_mem_89647") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_89691, "ext_mem_89691") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_89694, "ext_mem_89694") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_89697, "ext_mem_89697") != 0)
                return 1;
            
            double defunc_res_88584;
            double redout_88819 = 0.0;
            
            for (int64_t i_88821 = 0; i_88821 < m_34201; i_88821++) {
                double eta_p_81015 = ((double *) ext_mem_89844.mem)[i_88821];
                double defunc_res_87328;
                double redout_88814 = 0.0;
                
                for (int64_t i_88816 = 0; i_88816 < m_34201; i_88816++) {
                    double eta_p_81230 = ((double *) ext_mem_89845.mem)[ext_89840 + (i_88821 * ext_89839 + i_88816 * ext_89838)];
                    double eta_p_wasfree_81231 = ((double *) ext_mem_89843.mem)[i_88816];
                    double zt_res_81232 = eta_p_81015 * eta_p_81230;
                    double zt_res_81233 = eta_p_wasfree_81231 * zt_res_81232;
                    double zp_res_81026 = zt_res_81233 + redout_88814;
                    
                    ((double *) mem_89848)[i_88821 * m_34201 + i_88816] = zt_res_81233;
                    
                    double redout_tmp_91366 = zp_res_81026;
                    
                    redout_88814 = redout_tmp_91366;
                }
                defunc_res_87328 = redout_88814;
                
                double zp_res_47008 = defunc_res_87328 + redout_88819;
                double redout_tmp_91364 = zp_res_47008;
                
                redout_88819 = redout_tmp_91364;
            }
            defunc_res_88584 = redout_88819;
            if (memblock_unref(ctx, &ext_mem_89843, "ext_mem_89843") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_89844, "ext_mem_89844") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_89845, "ext_mem_89845") != 0)
                return 1;
            
            double zs_res_45862 = defunc_res_88550 / defunc_res_88584;
            double sqrt_res_45863 = futrts_sqrt64(zs_res_45862);
            bool defunc_0_reduce_comm_res_88586;
            bool redout_88829 = 0;
            
            for (int64_t i_88831 = 0; i_88831 < m_34201; i_88831++) {
                bool defunc_0_reduce_comm_res_87330;
                bool redout_88824 = 0;
                
                for (int64_t i_88826 = 0; i_88826 < m_34201; i_88826++) {
                    double eta_p_60584 = ((double *) mem_89848)[i_88831 * m_34201 + i_88826];
                    double eta_p_60585 = ((double *) mem_89435)[i_88831 * m_34201 + i_88826];
                    double zt_res_60586 = sqrt_res_45863 * eta_p_60584;
                    double zt_res_60588 = zp_res_45646 * eta_p_60585;
                    bool zgze_res_60589 = zt_res_60586 <= zt_res_60588;
                    double zt_res_60590 = zp_res_45646 * zt_res_60586;
                    bool zgze_res_60591 = eta_p_60585 <= zt_res_60590;
                    bool x_60592 = zgze_res_60589 && zgze_res_60591;
                    bool not_res_60593 = !x_60592;
                    bool defunc_0_op_res_56529 = not_res_60593 || redout_88824;
                    
                    ((double *) mem_89867.mem)[i_88831 * m_34201 + i_88826] = zt_res_60586;
                    
                    bool redout_tmp_91370 = defunc_0_op_res_56529;
                    
                    redout_88824 = redout_tmp_91370;
                }
                defunc_0_reduce_comm_res_87330 = redout_88824;
                
                bool defunc_0_op_res_45891 = defunc_0_reduce_comm_res_87330 || redout_88829;
                bool redout_tmp_91368 = defunc_0_op_res_45891;
                
                redout_88829 = redout_tmp_91368;
            }
            defunc_0_reduce_comm_res_88586 = redout_88829;
            
            double zt_res_48556 = -2.0 * defunc_res_88569;
            double zp_res_48557 = zt_res_48556 + defunc_0_reduce_res_88568;
            double zp_res_48558 = zp_res_48557 + defunc_0_reduce_res_88566;
            double zt_res_48601 = zt_res_45683 * defunc_res_88553;
            double zt_res_48615 = rho1_34204 * defunc_res_88551;
            double zt_res_48629 = rho2_34205 * defunc_res_88560;
            double zp_res_48630 = zt_res_48601 + zt_res_48615;
            double zp_res_48631 = zt_res_48629 + zp_res_48630;
            double zt_res_48632 = 2.0 * zp_res_48631;
            double zt_res_48633 = zt_res_48632 * defunc_res_88552;
            double zp_res_48634 = zp_res_48558 + zt_res_48633;
            double zt_res_48635 = defunc_res_88552 * defunc_res_88552;
            double zp_res_48637 = rho2_34205 + zp_res_46651;
            double zt_res_48638 = zt_res_48635 * zp_res_48637;
            double zm_res_48639 = zp_res_48634 - zt_res_48638;
            double zt_res_48650 = defunc_res_88554 * defunc_res_88561;
            double zt_res_48651 = rho1_34204 * defunc_res_88554;
            double zt_res_48652 = zt_res_48651 * defunc_res_88554;
            double zt_res_48653 = rho2_34205 * defunc_res_88561;
            double zt_res_48654 = zt_res_48653 * defunc_res_88561;
            double zp_res_48655 = zt_res_48652 + zt_res_48654;
            double zt_res_48656 = zt_res_45683 * zt_res_48650;
            double zt_res_48657 = zt_res_48650 * zt_res_48656;
            double zp_res_48658 = zp_res_48655 + zt_res_48657;
            double zp_res_48659 = zm_res_48639 + zp_res_48658;
            bool defunc_0_reduce_res_87334;
            
            if (defunc_0_reduce_comm_res_88586) {
                bool x_91018;
                bool redout_88835 = 0;
                
                for (int64_t i_88836 = 0; i_88836 < m_34201; i_88836++) {
                    bool defunc_0_reduce_res_87336;
                    bool redout_88833 = 0;
                    
                    for (int64_t i_88834 = 0; i_88834 < m_34201; i_88834++) {
                        double eta_p_87337 = ((double *) mem_89867.mem)[i_88836 * m_34201 + i_88834];
                        bool zg_res_87338 = 0.0 < eta_p_87337;
                        bool defunc_0_op_res_87341 = zg_res_87338 || redout_88833;
                        bool redout_tmp_91373 = defunc_0_op_res_87341;
                        
                        redout_88833 = redout_tmp_91373;
                    }
                    defunc_0_reduce_res_87336 = redout_88833;
                    
                    bool defunc_0_op_res_87345 = defunc_0_reduce_res_87336 || redout_88835;
                    bool redout_tmp_91372 = defunc_0_op_res_87345;
                    
                    redout_88835 = redout_tmp_91372;
                }
                x_91018 = redout_88835;
                defunc_0_reduce_res_87334 = x_91018;
            } else {
                defunc_0_reduce_res_87334 = 0;
            }
            
            bool x_91085 = defunc_0_reduce_res_87334 && defunc_0_reduce_comm_res_88586;
            bool final_plan_45894;
            double final_plan_45898;
            bool loop_while_45899;
            double loss_45903;
            
            if (memblock_set(ctx, &mem_param_89886, &ext_mem_89842, "ext_mem_89842") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_89889, &ext_mem_89841, "ext_mem_89841") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_89893, &mem_89867, "mem_89867") != 0)
                return 1;
            loop_while_45899 = x_91085;
            loss_45903 = zp_res_48659;
            while (loop_while_45899) {
                double defunc_res_88501;
                double defunc_res_88502;
                double defunc_res_88503;
                double defunc_res_88504;
                double redout_88844;
                double redout_88845;
                double redout_88846;
                double redout_88847;
                
                redout_88844 = 0.0;
                redout_88845 = 0.0;
                redout_88846 = 0.0;
                redout_88847 = 0.0;
                for (int64_t i_88849 = 0; i_88849 < m_34201; i_88849++) {
                    double eta_p_62033 = ((double *) distrs_mem_89413.mem)[eta_p_45649 * m_34201 + i_88849];
                    double defunc_res_87347;
                    double defunc_res_87348;
                    double defunc_res_87349;
                    double defunc_res_87350;
                    double defunc_res_87351;
                    double redout_88837;
                    double redout_88838;
                    double redout_88839;
                    double redout_88840;
                    double redout_88841;
                    
                    redout_88837 = 0.0;
                    redout_88838 = 0.0;
                    redout_88839 = 0.0;
                    redout_88840 = 0.0;
                    redout_88841 = 0.0;
                    for (int64_t i_88842 = 0; i_88842 < m_34201; i_88842++) {
                        double x_62143 = ((double *) mem_param_89893.mem)[i_88849 * m_34201 + i_88842];
                        double eta_p_62144 = ((double *) distrs_mem_89413.mem)[eta_p_45650 * m_34201 + i_88842];
                        double zt_res_62149 = eta_p_62033 * eta_p_62144;
                        bool zeze_res_62150 = x_62143 == 0.0;
                        double klu_res_62151;
                        
                        if (zeze_res_62150) {
                            klu_res_62151 = 0.0;
                        } else {
                            double zs_res_62152 = x_62143 / zt_res_62149;
                            double log_res_62153 = futrts_log64(zs_res_62152);
                            double zt_res_62154 = x_62143 * log_res_62153;
                            
                            klu_res_62151 = zt_res_62154;
                        }
                        
                        double zp_res_62043 = x_62143 + redout_88837;
                        double zp_res_62049 = x_62143 + redout_88838;
                        double zp_res_62055 = x_62143 + redout_88839;
                        double zp_res_62077 = klu_res_62151 + redout_88840;
                        double zp_res_62084 = x_62143 + redout_88841;
                        double redout_tmp_91387 = zp_res_62043;
                        double redout_tmp_91388 = zp_res_62049;
                        double redout_tmp_91389 = zp_res_62055;
                        double redout_tmp_91390 = zp_res_62077;
                        double redout_tmp_91391 = zp_res_62084;
                        
                        redout_88837 = redout_tmp_91387;
                        redout_88838 = redout_tmp_91388;
                        redout_88839 = redout_tmp_91389;
                        redout_88840 = redout_tmp_91390;
                        redout_88841 = redout_tmp_91391;
                    }
                    defunc_res_87347 = redout_88837;
                    defunc_res_87348 = redout_88838;
                    defunc_res_87349 = redout_88839;
                    defunc_res_87350 = redout_88840;
                    defunc_res_87351 = redout_88841;
                    
                    bool zeze_res_62057 = defunc_res_87349 == 0.0;
                    double klu_res_62058;
                    
                    if (zeze_res_62057) {
                        klu_res_62058 = 0.0;
                    } else {
                        double zs_res_62059 = defunc_res_87349 / eta_p_62033;
                        double log_res_62060 = futrts_log64(zs_res_62059);
                        double zt_res_62061 = log_res_62060 * defunc_res_87349;
                        
                        klu_res_62058 = zt_res_62061;
                    }
                    
                    double zp_res_48681 = defunc_res_87347 + redout_88844;
                    double zp_res_48806 = klu_res_62058 + redout_88845;
                    double zp_res_48851 = defunc_res_87350 + redout_88846;
                    double zp_res_47041 = defunc_res_87351 + redout_88847;
                    
                    ((double *) mem_89895)[i_88849] = defunc_res_87348;
                    
                    double redout_tmp_91382 = zp_res_48681;
                    double redout_tmp_91383 = zp_res_48806;
                    double redout_tmp_91384 = zp_res_48851;
                    double redout_tmp_91385 = zp_res_47041;
                    
                    redout_88844 = redout_tmp_91382;
                    redout_88845 = redout_tmp_91383;
                    redout_88846 = redout_tmp_91384;
                    redout_88847 = redout_tmp_91385;
                }
                defunc_res_88501 = redout_88844;
                defunc_res_88502 = redout_88845;
                defunc_res_88503 = redout_88846;
                defunc_res_88504 = redout_88847;
                
                double zt_res_48685 = zt_res_45683 * defunc_res_88501;
                double defunc_res_88506;
                double redout_88856 = 0.0;
                
                for (int64_t i_88859 = 0; i_88859 < m_34201; i_88859++) {
                    double eta_p_68862 = ((double *) distrs_mem_89413.mem)[eta_p_45650 * m_34201 + i_88859];
                    double log_res_68864 = futrts_log64(eta_p_68862);
                    double zt_res_68865 = zt_res_48685 * log_res_68864;
                    double defunc_res_87352;
                    double defunc_res_87353;
                    double redout_88851;
                    double redout_88852;
                    
                    redout_88851 = 0.0;
                    redout_88852 = 0.0;
                    for (int64_t i_88853 = 0; i_88853 < m_34201; i_88853++) {
                        double x_68897 = ((double *) mem_param_89893.mem)[i_88853 * m_34201 + i_88859];
                        double zp_res_68870 = x_68897 + redout_88851;
                        double zp_res_68882 = x_68897 + redout_88852;
                        double redout_tmp_91395 = zp_res_68870;
                        double redout_tmp_91396 = zp_res_68882;
                        
                        redout_88851 = redout_tmp_91395;
                        redout_88852 = redout_tmp_91396;
                    }
                    defunc_res_87352 = redout_88851;
                    defunc_res_87353 = redout_88852;
                    
                    bool zeze_res_68872 = defunc_res_87352 == 0.0;
                    double klu_res_68873;
                    
                    if (zeze_res_68872) {
                        klu_res_68873 = 0.0;
                    } else {
                        double zs_res_68874 = defunc_res_87352 / eta_p_68862;
                        double log_res_68875 = futrts_log64(zs_res_68874);
                        double zt_res_68876 = log_res_68875 * defunc_res_87352;
                        
                        klu_res_68873 = zt_res_68876;
                    }
                    
                    double zp_res_48828 = klu_res_68873 + redout_88856;
                    
                    ((double *) mem_89903)[i_88859] = defunc_res_87353;
                    ((double *) mem_89905)[i_88859] = zt_res_68865;
                    
                    double redout_tmp_91392 = zp_res_48828;
                    
                    redout_88856 = redout_tmp_91392;
                }
                defunc_res_88506 = redout_88856;
                
                double zt_res_48829 = rho2_34205 * defunc_res_88506;
                double zt_res_48807 = rho1_34204 * defunc_res_88502;
                double zp_res_48853 = zt_res_48807 + zt_res_48829;
                double zt_res_48852 = zt_res_45683 * defunc_res_88503;
                double zp_res_48854 = zt_res_48852 + zp_res_48853;
                
                for (int64_t i_88866 = 0; i_88866 < m_34201; i_88866++) {
                    double defunc_0_reduce_res_87354;
                    double redout_88862 = 0.0;
                    
                    for (int64_t i_88863 = 0; i_88863 < m_34201; i_88863++) {
                        double eta_p_62411 = ((double *) A_mem_89412.mem)[eta_p_45650 * (m_34201 * m_34201) + i_88866 * m_34201 + i_88863];
                        double eta_p_62412 = ((double *) mem_89903)[i_88863];
                        double zt_res_62414 = eta_p_62411 * eta_p_62411;
                        double zt_res_62416 = eta_p_62412 * zt_res_62414;
                        double zp_res_48739 = zt_res_62416 + redout_88862;
                        double redout_tmp_91398 = zp_res_48739;
                        
                        redout_88862 = redout_tmp_91398;
                    }
                    defunc_0_reduce_res_87354 = redout_88862;
                    ((double *) mem_89919)[i_88866] = defunc_0_reduce_res_87354;
                }
                for (int64_t i_88891 = 0; i_88891 < m_34201; i_88891++) {
                    double eta_p_61822 = ((double *) distrs_mem_89413.mem)[eta_p_45649 * m_34201 + i_88891];
                    double eta_p_61824 = ((double *) mem_param_89886.mem)[i_88891];
                    double log_res_61828 = futrts_log64(eta_p_61822);
                    double zt_res_61830 = zt_res_48685 * log_res_61828;
                    double defunc_0_reduce_res_87357;
                    double redout_88868 = 0.0;
                    
                    for (int64_t i_88869 = 0; i_88869 < m_34201; i_88869++) {
                        double eta_p_62377 = ((double *) A_mem_89412.mem)[eta_p_45649 * (m_34201 * m_34201) + i_88891 * m_34201 + i_88869];
                        double eta_p_62378 = ((double *) mem_89895)[i_88869];
                        double zt_res_62380 = eta_p_62377 * eta_p_62377;
                        double zt_res_62382 = eta_p_62378 * zt_res_62380;
                        double zp_res_61845 = zt_res_62382 + redout_88868;
                        double redout_tmp_91401 = zp_res_61845;
                        
                        redout_88868 = redout_tmp_91401;
                    }
                    defunc_0_reduce_res_87357 = redout_88868;
                    for (int64_t i_88874 = 0; i_88874 < m_34201; i_88874++) {
                        double defunc_0_reduce_res_87355;
                        double redout_88870 = 0.0;
                        
                        for (int64_t i_88871 = 0; i_88871 < m_34201; i_88871++) {
                            double eta_p_62385 = ((double *) A_mem_89412.mem)[eta_p_45649 * (m_34201 * m_34201) + i_88891 * m_34201 + i_88871];
                            double eta_p_62386 = ((double *) mem_param_89893.mem)[i_88871 * m_34201 + i_88874];
                            double zt_res_62387 = eta_p_62385 * eta_p_62386;
                            double zp_res_61857 = zt_res_62387 + redout_88870;
                            double redout_tmp_91403 = zp_res_61857;
                            
                            redout_88870 = redout_tmp_91403;
                        }
                        defunc_0_reduce_res_87355 = redout_88870;
                        ((double *) mem_89939)[i_88874] = defunc_0_reduce_res_87355;
                    }
                    
                    double defunc_0_reduce_res_87359;
                    double redout_88879 = INFINITY;
                    
                    for (int64_t i_88881 = 0; i_88881 < m_34201; i_88881++) {
                        double eta_p_wasfree_62336 = ((double *) mem_89919)[i_88881];
                        double eta_p_wasfree_62337 = ((double *) mem_89905)[i_88881];
                        double eta_p_wasfree_62338 = ((double *) mem_param_89889.mem)[i_88881];
                        double defunc_0_reduce_res_87356;
                        double redout_88876 = 0.0;
                        
                        for (int64_t i_88877 = 0; i_88877 < m_34201; i_88877++) {
                            double eta_p_62391 = ((double *) mem_89939)[i_88877];
                            double eta_p_62392 = ((double *) A_mem_89412.mem)[eta_p_45650 * (m_34201 * m_34201) + i_88877 * m_34201 + i_88881];
                            double zt_res_62393 = eta_p_62391 * eta_p_62392;
                            double zp_res_62347 = zt_res_62393 + redout_88876;
                            double redout_tmp_91406 = zp_res_62347;
                            
                            redout_88876 = redout_tmp_91406;
                        }
                        defunc_0_reduce_res_87356 = redout_88876;
                        
                        double zt_res_62349 = -2.0 * defunc_0_reduce_res_87356;
                        double zp_res_62351 = zt_res_62349 + defunc_0_reduce_res_87357;
                        double zp_res_62353 = eta_p_wasfree_62336 + zp_res_62351;
                        double zp_res_62355 = zp_res_48854 + zp_res_62353;
                        double zm_res_62357 = zp_res_62355 - zt_res_61830;
                        double zm_res_62359 = zm_res_62357 - eta_p_wasfree_62337;
                        double zs_res_62361 = zm_res_62359 / defunc_res_88504;
                        double zs_res_62363 = zs_res_62361 / neg_res_45703;
                        double zp_res_62365 = eta_p_61824 + zs_res_62363;
                        double zp_res_62367 = eta_p_wasfree_62338 + zp_res_62365;
                        double zm_res_62369 = 30.0 - zp_res_62367;
                        double min_res_61922 = fmin64(zm_res_62369, redout_88879);
                        
                        ((double *) mem_89947)[i_88881] = zp_res_62367;
                        
                        double redout_tmp_91404 = min_res_61922;
                        
                        redout_88879 = redout_tmp_91404;
                    }
                    defunc_0_reduce_res_87359 = redout_88879;
                    for (int64_t i_88885 = 0; i_88885 < m_34201; i_88885++) {
                        double eta_p_61925 = ((double *) mem_89947)[i_88885];
                        double zp_res_61926 = eta_p_61925 + defunc_0_reduce_res_87359;
                        
                        ((double *) mem_89928)[i_88891 * m_34201 + i_88885] = zp_res_61926;
                    }
                    ((double *) mem_89930)[i_88891] = defunc_0_reduce_res_87359;
                }
                
                bool defunc_0_reduce_res_88512;
                bool redout_88904 = 0;
                
                for (int64_t i_88908 = 0; i_88908 < m_34201; i_88908++) {
                    double eta_p_81304 = ((double *) mem_param_89889.mem)[i_88908];
                    double eta_p_81305 = ((double *) distrs_mem_89413.mem)[eta_p_45650 * m_34201 + i_88908];
                    double defunc_0_reduce_res_87362;
                    double redout_88894 = INFINITY;
                    
                    for (int64_t i_88895 = 0; i_88895 < m_34201; i_88895++) {
                        double eta_p_81308 = ((double *) mem_89928)[i_88895 * m_34201 + i_88908];
                        double zm_res_81309 = 30.0 - eta_p_81308;
                        double min_res_81312 = fmin64(zm_res_81309, redout_88894);
                        double redout_tmp_91412 = min_res_81312;
                        
                        redout_88894 = redout_tmp_91412;
                    }
                    defunc_0_reduce_res_87362 = redout_88894;
                    
                    double defunc_0_reduce_res_87363;
                    double redout_88897 = 0.0;
                    
                    for (int64_t i_88899 = 0; i_88899 < m_34201; i_88899++) {
                        double eta_p_81348 = ((double *) mem_89928)[i_88899 * m_34201 + i_88908];
                        double zp_res_81349 = eta_p_81348 + defunc_0_reduce_res_87362;
                        double exp_res_81350 = futrts_exp64(zp_res_81349);
                        double zp_res_81325 = exp_res_81350 + redout_88897;
                        
                        ((double *) mem_89975.mem)[i_88908 * m_34201 + i_88899] = exp_res_81350;
                        
                        double redout_tmp_91413 = zp_res_81325;
                        
                        redout_88897 = redout_tmp_91413;
                    }
                    defunc_0_reduce_res_87363 = redout_88897;
                    
                    double zp_res_81320 = eta_p_81304 + defunc_0_reduce_res_87362;
                    double zs_res_81326 = defunc_0_reduce_res_87363 / eta_p_81305;
                    double ztzt_res_81327 = fpow64(zs_res_81326, zs_res_46693);
                    double zt_res_81328 = zs_res_46695 * zp_res_81320;
                    double exp_res_81329 = futrts_exp64(zt_res_81328);
                    double zt_res_81330 = ztzt_res_81327 * exp_res_81329;
                    bool zgze_res_81331 = exp_absorb_cutoff_34209 <= zt_res_81330;
                    bool defunc_0_op_res_45985 = zgze_res_81331 || redout_88904;
                    
                    ((double *) mem_89970.mem)[i_88908] = zt_res_81330;
                    ((double *) mem_89972.mem)[i_88908] = zp_res_81320;
                    
                    bool redout_tmp_91408 = defunc_0_op_res_45985;
                    
                    redout_88904 = redout_tmp_91408;
                }
                defunc_0_reduce_res_88512 = redout_88904;
                
                bool defunc_0_reduce_res_88517;
                bool redout_88916 = 0;
                
                for (int64_t i_88919 = 0; i_88919 < m_34201; i_88919++) {
                    double eta_p_60885 = ((double *) mem_param_89886.mem)[i_88919];
                    double eta_p_60886 = ((double *) mem_89930)[i_88919];
                    double eta_p_60888 = ((double *) distrs_mem_89413.mem)[eta_p_45649 * m_34201 + i_88919];
                    double zp_res_60889 = eta_p_60885 + eta_p_60886;
                    double defunc_0_reduce_res_87365;
                    double redout_88912 = 0.0;
                    
                    for (int64_t i_88913 = 0; i_88913 < m_34201; i_88913++) {
                        double eta_p_62431 = ((double *) mem_89970.mem)[i_88913];
                        double eta_p_62432 = ((double *) mem_89975.mem)[i_88913 * m_34201 + i_88919];
                        double zt_res_62433 = eta_p_62431 * eta_p_62432;
                        double zp_res_60899 = zt_res_62433 + redout_88912;
                        double redout_tmp_91418 = zp_res_60899;
                        
                        redout_88912 = redout_tmp_91418;
                    }
                    defunc_0_reduce_res_87365 = redout_88912;
                    
                    double zs_res_60901 = defunc_0_reduce_res_87365 / eta_p_60888;
                    double ztzt_res_60903 = fpow64(zs_res_60901, zs_res_46652);
                    double zt_res_60905 = zs_res_46654 * zp_res_60889;
                    double exp_res_60907 = futrts_exp64(zt_res_60905);
                    double zt_res_60909 = ztzt_res_60903 * exp_res_60907;
                    bool zgze_res_60911 = exp_absorb_cutoff_34209 <= zt_res_60909;
                    bool defunc_0_op_res_45960 = zgze_res_60911 || redout_88916;
                    
                    ((double *) mem_90005.mem)[i_88919] = zt_res_60909;
                    ((double *) mem_90007.mem)[i_88919] = zp_res_60889;
                    
                    bool redout_tmp_91415 = defunc_0_op_res_45960;
                    
                    redout_88916 = redout_tmp_91415;
                }
                defunc_0_reduce_res_88517 = redout_88916;
                
                bool x_90978 = !defunc_0_reduce_res_88517;
                bool defunc_0_reduce_res_87366;
                
                if (x_90978) {
                    bool x_90980;
                    bool redout_88922 = 0;
                    
                    for (int64_t i_88923 = 0; i_88923 < m_34201; i_88923++) {
                        double eta_p_62438 = ((double *) mem_90005.mem)[i_88923];
                        bool zlze_res_62439 = eta_p_62438 <= zs_res_45730;
                        bool defunc_0_op_res_45970 = zlze_res_62439 || redout_88922;
                        bool redout_tmp_91419 = defunc_0_op_res_45970;
                        
                        redout_88922 = redout_tmp_91419;
                    }
                    x_90980 = redout_88922;
                    defunc_0_reduce_res_87366 = x_90980;
                } else {
                    defunc_0_reduce_res_87366 = 0;
                }
                
                bool cond_45961 = defunc_0_reduce_res_87366 || defunc_0_reduce_res_88517;
                int64_t ext_90061;
                
                if (cond_45961) {
                    ext_90061 = m_34201;
                } else {
                    ext_90061 = (int64_t) 1;
                }
                
                int64_t ext_90060;
                
                if (cond_45961) {
                    ext_90060 = (int64_t) 1;
                } else {
                    ext_90060 = m_34201;
                }
                if (cond_45961) {
                    if (memblock_alloc(ctx, &mem_90021, bytes_89416, "mem_90021")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_90023, bytes_89416, "mem_90023")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_90026, bytes_89434, "mem_90026")) {
                        err = 1;
                        goto cleanup;
                    }
                    for (int64_t i_88934 = 0; i_88934 < m_34201; i_88934++) {
                        double eta_p_87383 = ((double *) mem_90005.mem)[i_88934];
                        double eta_p_87384 = ((double *) mem_90007.mem)[i_88934];
                        bool zgze_res_87386 = exp_absorb_cutoff_34209 <= eta_p_87383;
                        bool zl_res_87387 = eta_p_87383 < zs_res_45730;
                        bool x_87388 = !zgze_res_87386;
                        bool y_87389 = zl_res_87387 && x_87388;
                        bool cond_87390 = zgze_res_87386 || y_87389;
                        int64_t ext_90048;
                        
                        if (cond_87390) {
                            ext_90048 = (int64_t) 0;
                        } else {
                            ext_90048 = i_88934;
                        }
                        
                        int64_t ext_90047;
                        
                        if (cond_87390) {
                            ext_90047 = (int64_t) 1;
                        } else {
                            ext_90047 = m_34201;
                        }
                        
                        double rescale_res_87391;
                        double rescale_res_87392;
                        
                        if (cond_87390) {
                            double log_res_87394 = futrts_log64(eta_p_87383);
                            double sqrt_res_87395 = futrts_sqrt64(eta_p_87383);
                            double zs_res_87396 = log_res_87394 / 2.0;
                            double zp_res_87397 = eta_p_87384 + zs_res_87396;
                            
                            if (memblock_alloc(ctx, &mem_90038, bytes_89416, "mem_90038")) {
                                err = 1;
                                goto cleanup;
                            }
                            for (int64_t i_88926 = 0; i_88926 < m_34201; i_88926++) {
                                double eta_p_87399 = ((double *) mem_89975.mem)[i_88926 * m_34201 + i_88934];
                                double zt_res_87400 = sqrt_res_87395 * eta_p_87399;
                                
                                ((double *) mem_90038.mem)[i_88926] = zt_res_87400;
                            }
                            if (memblock_set(ctx, &ext_mem_90049, &mem_90038, "mem_90038") != 0)
                                return 1;
                            rescale_res_87391 = sqrt_res_87395;
                            rescale_res_87392 = zp_res_87397;
                        } else {
                            if (memblock_set(ctx, &ext_mem_90049, &mem_89975, "mem_89975") != 0)
                                return 1;
                            rescale_res_87391 = eta_p_87383;
                            rescale_res_87392 = eta_p_87384;
                        }
                        ((double *) mem_90021.mem)[i_88934] = rescale_res_87391;
                        ((double *) mem_90023.mem)[i_88934] = rescale_res_87392;
                        lmad_copy_8b(ctx, 1, (uint64_t *) mem_90026.mem, i_88934 * m_34201, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90049.mem, ext_90048, (int64_t []) {ext_90047}, (int64_t []) {m_34201});
                        if (memblock_unref(ctx, &ext_mem_90049, "ext_mem_90049") != 0)
                            return 1;
                    }
                    if (memblock_set(ctx, &ext_mem_90069, &mem_90021, "mem_90021") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90066, &mem_90023, "mem_90023") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90063, &mem_90026, "mem_90026") != 0)
                        return 1;
                } else {
                    if (memblock_set(ctx, &ext_mem_90069, &mem_90005, "mem_90005") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90066, &mem_90007, "mem_90007") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90063, &mem_89975, "mem_89975") != 0)
                        return 1;
                }
                
                bool x_90974 = !defunc_0_reduce_res_88512;
                bool defunc_0_reduce_res_87405;
                
                if (x_90974) {
                    bool x_90976;
                    bool redout_88938 = 0;
                    
                    for (int64_t i_88939 = 0; i_88939 < m_34201; i_88939++) {
                        double eta_p_62481 = ((double *) mem_89970.mem)[i_88939];
                        bool zlze_res_62482 = eta_p_62481 <= zs_res_45730;
                        bool defunc_0_op_res_45995 = zlze_res_62482 || redout_88938;
                        bool redout_tmp_91424 = defunc_0_op_res_45995;
                        
                        redout_88938 = redout_tmp_91424;
                    }
                    x_90976 = redout_88938;
                    defunc_0_reduce_res_87405 = x_90976;
                } else {
                    defunc_0_reduce_res_87405 = 0;
                }
                
                bool cond_45986 = defunc_0_reduce_res_87405 || defunc_0_reduce_res_88512;
                int64_t ext_90111;
                
                if (cond_45986) {
                    ext_90111 = (int64_t) 1;
                } else {
                    ext_90111 = ext_90061;
                }
                
                int64_t ext_90110;
                
                if (cond_45986) {
                    ext_90110 = m_34201;
                } else {
                    ext_90110 = ext_90060;
                }
                if (cond_45986) {
                    if (memblock_alloc(ctx, &mem_90071, bytes_89416, "mem_90071")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_90073, bytes_89416, "mem_90073")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_90076, bytes_89434, "mem_90076")) {
                        err = 1;
                        goto cleanup;
                    }
                    for (int64_t i_88950 = 0; i_88950 < m_34201; i_88950++) {
                        double eta_p_87424 = ((double *) mem_89970.mem)[i_88950];
                        double eta_p_87425 = ((double *) mem_89972.mem)[i_88950];
                        bool zgze_res_87427 = exp_absorb_cutoff_34209 <= eta_p_87424;
                        bool zl_res_87428 = eta_p_87424 < zs_res_45730;
                        bool x_87429 = !zgze_res_87427;
                        bool y_87430 = zl_res_87428 && x_87429;
                        bool cond_87431 = zgze_res_87427 || y_87430;
                        int64_t binop_y_90095 = i_88950 * ext_90060;
                        int64_t ext_90098;
                        
                        if (cond_87431) {
                            ext_90098 = (int64_t) 0;
                        } else {
                            ext_90098 = binop_y_90095;
                        }
                        
                        int64_t ext_90097;
                        
                        if (cond_87431) {
                            ext_90097 = (int64_t) 1;
                        } else {
                            ext_90097 = ext_90061;
                        }
                        
                        double rescale_res_87432;
                        double rescale_res_87433;
                        
                        if (cond_87431) {
                            double log_res_87435 = futrts_log64(eta_p_87424);
                            double sqrt_res_87436 = futrts_sqrt64(eta_p_87424);
                            double zs_res_87437 = log_res_87435 / 2.0;
                            double zp_res_87438 = eta_p_87425 + zs_res_87437;
                            
                            if (memblock_alloc(ctx, &mem_90088, bytes_89416, "mem_90088")) {
                                err = 1;
                                goto cleanup;
                            }
                            for (int64_t i_88942 = 0; i_88942 < m_34201; i_88942++) {
                                double eta_p_87440 = ((double *) ext_mem_90063.mem)[i_88942 * ext_90061 + i_88950 * ext_90060];
                                double zt_res_87441 = sqrt_res_87436 * eta_p_87440;
                                
                                ((double *) mem_90088.mem)[i_88942] = zt_res_87441;
                            }
                            if (memblock_set(ctx, &ext_mem_90099, &mem_90088, "mem_90088") != 0)
                                return 1;
                            rescale_res_87432 = sqrt_res_87436;
                            rescale_res_87433 = zp_res_87438;
                        } else {
                            if (memblock_set(ctx, &ext_mem_90099, &ext_mem_90063, "ext_mem_90063") != 0)
                                return 1;
                            rescale_res_87432 = eta_p_87424;
                            rescale_res_87433 = eta_p_87425;
                        }
                        ((double *) mem_90071.mem)[i_88950] = rescale_res_87432;
                        ((double *) mem_90073.mem)[i_88950] = rescale_res_87433;
                        lmad_copy_8b(ctx, 1, (uint64_t *) mem_90076.mem, i_88950 * m_34201, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90099.mem, ext_90098, (int64_t []) {ext_90097}, (int64_t []) {m_34201});
                        if (memblock_unref(ctx, &ext_mem_90099, "ext_mem_90099") != 0)
                            return 1;
                    }
                    if (memblock_set(ctx, &ext_mem_90119, &mem_90071, "mem_90071") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90116, &mem_90073, "mem_90073") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90113, &mem_90076, "mem_90076") != 0)
                        return 1;
                } else {
                    if (memblock_set(ctx, &ext_mem_90119, &mem_89970, "mem_89970") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90116, &mem_89972, "mem_89972") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90113, &ext_mem_90063, "ext_mem_90063") != 0)
                        return 1;
                }
                if (memblock_unref(ctx, &ext_mem_90063, "ext_mem_90063") != 0)
                    return 1;
                
                bool defunc_0_reduce_res_88520;
                bool redout_88954 = 1;
                
                for (int64_t i_88955 = 0; i_88955 < m_34201; i_88955++) {
                    double eta_p_60687 = ((double *) ext_mem_90069.mem)[i_88955];
                    bool isnan_res_60688 = futrts_isnan64(eta_p_60687);
                    bool not_res_60689 = !isnan_res_60688;
                    bool x_46013 = not_res_60689 && redout_88954;
                    bool redout_tmp_91429 = x_46013;
                    
                    redout_88954 = redout_tmp_91429;
                }
                defunc_0_reduce_res_88520 = redout_88954;
                
                bool defunc_0_reduce_comm_res_87449;
                
                if (defunc_0_reduce_res_88520) {
                    bool x_90972;
                    bool redout_88956 = 0;
                    
                    for (int64_t i_88957 = 0; i_88957 < m_34201; i_88957++) {
                        double eta_p_87450 = ((double *) ext_mem_90069.mem)[i_88957];
                        double zt_res_87451 = zp_res_87448 * eta_p_87450;
                        bool zgze_res_87452 = 1.0 <= zt_res_87451;
                        bool zgze_res_87453 = eta_p_87450 <= zp_res_87448;
                        bool x_87454 = zgze_res_87452 && zgze_res_87453;
                        bool not_res_87455 = !x_87454;
                        bool defunc_0_op_res_87458 = not_res_87455 || redout_88956;
                        bool redout_tmp_91430 = defunc_0_op_res_87458;
                        
                        redout_88956 = redout_tmp_91430;
                    }
                    x_90972 = redout_88956;
                    defunc_0_reduce_comm_res_87449 = x_90972;
                } else {
                    defunc_0_reduce_comm_res_87449 = 0;
                }
                
                bool x_91088 = defunc_0_reduce_comm_res_87449 && defunc_0_reduce_res_88520;
                int64_t ext_90284;
                int64_t ext_90283;
                int64_t ext_90282;
                int64_t ext_90275;
                int64_t ext_90274;
                int64_t ext_90273;
                bool algo5_core_loop_res_46030;
                bool loop_while_46040;
                int64_t ctx_param_ext_90120;
                int64_t ctx_param_ext_90121;
                int64_t ctx_param_ext_90122;
                int64_t ctx_param_ext_90133;
                int64_t ctx_param_ext_90134;
                int64_t ctx_param_ext_90135;
                
                if (memblock_set(ctx, &mem_param_90123, &mem_89975, "mem_89975") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90126, &mem_89417, "mem_89417") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90129, &mem_90007, "mem_90007") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90132, &mem_89972, "mem_89972") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90136, &ext_mem_90113, "ext_mem_90113") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90139, &ext_mem_90069, "ext_mem_90069") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90142, &ext_mem_90119, "ext_mem_90119") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90145, &ext_mem_90066, "ext_mem_90066") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90148, &ext_mem_90116, "ext_mem_90116") != 0)
                    return 1;
                ctx_param_ext_90120 = (int64_t) 0;
                ctx_param_ext_90121 = (int64_t) 1;
                ctx_param_ext_90122 = m_34201;
                ctx_param_ext_90133 = (int64_t) 0;
                ctx_param_ext_90134 = ext_90111;
                ctx_param_ext_90135 = ext_90110;
                loop_while_46040 = x_91088;
                while (loop_while_46040) {
                    if (memblock_alloc(ctx, &mem_90150, bytes_89416, "mem_90150")) {
                        err = 1;
                        goto cleanup;
                    }
                    
                    bool defunc_0_reduce_res_87558;
                    bool redout_88961 = 0;
                    
                    for (int64_t i_88963 = 0; i_88963 < m_34201; i_88963++) {
                        double eta_p_62700 = ((double *) distrs_mem_89413.mem)[eta_p_45650 * m_34201 + i_88963];
                        double eta_p_62701 = ((double *) mem_param_90148.mem)[i_88963];
                        double defunc_0_reduce_res_87460;
                        double redout_88958 = 0.0;
                        
                        for (int64_t i_88959 = 0; i_88959 < m_34201; i_88959++) {
                            double eta_p_62725 = ((double *) mem_param_90139.mem)[i_88959];
                            double eta_p_62726 = ((double *) mem_param_90136.mem)[ctx_param_ext_90133 + (i_88959 * ctx_param_ext_90134 + i_88963 * ctx_param_ext_90135)];
                            double zt_res_62727 = eta_p_62725 * eta_p_62726;
                            double zp_res_62710 = zt_res_62727 + redout_88958;
                            double redout_tmp_91458 = zp_res_62710;
                            
                            redout_88958 = redout_tmp_91458;
                        }
                        defunc_0_reduce_res_87460 = redout_88958;
                        
                        double zs_res_62712 = defunc_0_reduce_res_87460 / eta_p_62700;
                        double ztzt_res_62714 = fpow64(zs_res_62712, zs_res_46693);
                        double zt_res_62716 = zs_res_46695 * eta_p_62701;
                        double exp_res_62718 = futrts_exp64(zt_res_62716);
                        double zt_res_62720 = ztzt_res_62714 * exp_res_62718;
                        bool zgze_res_62722 = exp_absorb_cutoff_34209 <= zt_res_62720;
                        bool defunc_0_op_res_46085 = zgze_res_62722 || redout_88961;
                        
                        ((double *) mem_90150.mem)[i_88963] = zt_res_62720;
                        
                        bool redout_tmp_91456 = defunc_0_op_res_46085;
                        
                        redout_88961 = redout_tmp_91456;
                    }
                    defunc_0_reduce_res_87558 = redout_88961;
                    if (memblock_alloc(ctx, &mem_90158, bytes_89416, "mem_90158")) {
                        err = 1;
                        goto cleanup;
                    }
                    
                    bool defunc_0_reduce_res_87561;
                    bool redout_88968 = 0;
                    
                    for (int64_t i_88970 = 0; i_88970 < m_34201; i_88970++) {
                        double eta_p_62618 = ((double *) distrs_mem_89413.mem)[eta_p_45649 * m_34201 + i_88970];
                        double eta_p_62619 = ((double *) mem_param_90145.mem)[i_88970];
                        double defunc_0_reduce_res_87461;
                        double redout_88965 = 0.0;
                        
                        for (int64_t i_88966 = 0; i_88966 < m_34201; i_88966++) {
                            double eta_p_62731 = ((double *) mem_90150.mem)[i_88966];
                            double eta_p_62732 = ((double *) mem_param_90136.mem)[ctx_param_ext_90133 + (i_88970 * ctx_param_ext_90134 + i_88966 * ctx_param_ext_90135)];
                            double zt_res_62733 = eta_p_62731 * eta_p_62732;
                            double zp_res_62628 = zt_res_62733 + redout_88965;
                            double redout_tmp_91461 = zp_res_62628;
                            
                            redout_88965 = redout_tmp_91461;
                        }
                        defunc_0_reduce_res_87461 = redout_88965;
                        
                        double zs_res_62630 = defunc_0_reduce_res_87461 / eta_p_62618;
                        double ztzt_res_62632 = fpow64(zs_res_62630, zs_res_46652);
                        double zt_res_62634 = zs_res_46654 * eta_p_62619;
                        double exp_res_62636 = futrts_exp64(zt_res_62634);
                        double zt_res_62638 = ztzt_res_62632 * exp_res_62636;
                        bool zgze_res_62640 = exp_absorb_cutoff_34209 <= zt_res_62638;
                        bool defunc_0_op_res_46060 = zgze_res_62640 || redout_88968;
                        
                        ((double *) mem_90158.mem)[i_88970] = zt_res_62638;
                        
                        bool redout_tmp_91459 = defunc_0_op_res_46060;
                        
                        redout_88968 = redout_tmp_91459;
                    }
                    defunc_0_reduce_res_87561 = redout_88968;
                    
                    bool x_90966 = !defunc_0_reduce_res_87561;
                    bool defunc_0_reduce_res_87462;
                    
                    if (x_90966) {
                        bool x_90968;
                        bool redout_88972 = 0;
                        
                        for (int64_t i_88973 = 0; i_88973 < m_34201; i_88973++) {
                            double eta_p_62737 = ((double *) mem_90158.mem)[i_88973];
                            bool zlze_res_62738 = eta_p_62737 <= zs_res_45730;
                            bool defunc_0_op_res_46070 = zlze_res_62738 || redout_88972;
                            bool redout_tmp_91462 = defunc_0_op_res_46070;
                            
                            redout_88972 = redout_tmp_91462;
                        }
                        x_90968 = redout_88972;
                        defunc_0_reduce_res_87462 = x_90968;
                    } else {
                        defunc_0_reduce_res_87462 = 0;
                    }
                    
                    bool cond_46061 = defunc_0_reduce_res_87462 || defunc_0_reduce_res_87561;
                    int64_t ext_90207;
                    
                    if (cond_46061) {
                        ext_90207 = (int64_t) 0;
                    } else {
                        ext_90207 = ctx_param_ext_90133;
                    }
                    
                    int64_t ext_90206;
                    
                    if (cond_46061) {
                        ext_90206 = m_34201;
                    } else {
                        ext_90206 = ctx_param_ext_90134;
                    }
                    
                    int64_t ext_90205;
                    
                    if (cond_46061) {
                        ext_90205 = (int64_t) 1;
                    } else {
                        ext_90205 = ctx_param_ext_90135;
                    }
                    if (cond_46061) {
                        if (memblock_alloc(ctx, &mem_90166, bytes_89416, "mem_90166")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (memblock_alloc(ctx, &mem_90168, bytes_89416, "mem_90168")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (memblock_alloc(ctx, &mem_90171, bytes_89434, "mem_90171")) {
                            err = 1;
                            goto cleanup;
                        }
                        for (int64_t i_88984 = 0; i_88984 < m_34201; i_88984++) {
                            double eta_p_87479 = ((double *) mem_90158.mem)[i_88984];
                            double eta_p_87480 = ((double *) mem_param_90145.mem)[i_88984];
                            bool zgze_res_87482 = exp_absorb_cutoff_34209 <= eta_p_87479;
                            bool zl_res_87483 = eta_p_87479 < zs_res_45730;
                            bool x_87484 = !zgze_res_87482;
                            bool y_87485 = zl_res_87483 && x_87484;
                            bool cond_87486 = zgze_res_87482 || y_87485;
                            int64_t binop_y_90190 = i_88984 * ctx_param_ext_90134;
                            int64_t lmad_ext_90191 = ctx_param_ext_90133 + binop_y_90190;
                            int64_t ext_90193;
                            
                            if (cond_87486) {
                                ext_90193 = (int64_t) 0;
                            } else {
                                ext_90193 = lmad_ext_90191;
                            }
                            
                            int64_t ext_90192;
                            
                            if (cond_87486) {
                                ext_90192 = (int64_t) 1;
                            } else {
                                ext_90192 = ctx_param_ext_90135;
                            }
                            
                            double rescale_res_87487;
                            double rescale_res_87488;
                            
                            if (cond_87486) {
                                double log_res_87490 = futrts_log64(eta_p_87479);
                                double sqrt_res_87491 = futrts_sqrt64(eta_p_87479);
                                double zs_res_87492 = log_res_87490 / 2.0;
                                double zp_res_87493 = eta_p_87480 + zs_res_87492;
                                
                                if (memblock_alloc(ctx, &mem_90183, bytes_89416, "mem_90183")) {
                                    err = 1;
                                    goto cleanup;
                                }
                                for (int64_t i_88976 = 0; i_88976 < m_34201; i_88976++) {
                                    double eta_p_87495 = ((double *) mem_param_90136.mem)[ctx_param_ext_90133 + (i_88984 * ctx_param_ext_90134 + i_88976 * ctx_param_ext_90135)];
                                    double zt_res_87496 = sqrt_res_87491 * eta_p_87495;
                                    
                                    ((double *) mem_90183.mem)[i_88976] = zt_res_87496;
                                }
                                if (memblock_set(ctx, &ext_mem_90194, &mem_90183, "mem_90183") != 0)
                                    return 1;
                                rescale_res_87487 = sqrt_res_87491;
                                rescale_res_87488 = zp_res_87493;
                            } else {
                                if (memblock_set(ctx, &ext_mem_90194, &mem_param_90136, "mem_param_90136") != 0)
                                    return 1;
                                rescale_res_87487 = eta_p_87479;
                                rescale_res_87488 = eta_p_87480;
                            }
                            ((double *) mem_90166.mem)[i_88984] = rescale_res_87487;
                            ((double *) mem_90168.mem)[i_88984] = rescale_res_87488;
                            lmad_copy_8b(ctx, 1, (uint64_t *) mem_90171.mem, i_88984 * m_34201, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90194.mem, ext_90193, (int64_t []) {ext_90192}, (int64_t []) {m_34201});
                            if (memblock_unref(ctx, &ext_mem_90194, "ext_mem_90194") != 0)
                                return 1;
                        }
                        if (memblock_set(ctx, &ext_mem_90214, &mem_90166, "mem_90166") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90211, &mem_90168, "mem_90168") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90208, &mem_90171, "mem_90171") != 0)
                            return 1;
                    } else {
                        if (memblock_set(ctx, &ext_mem_90214, &mem_90158, "mem_90158") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90211, &mem_param_90145, "mem_param_90145") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90208, &mem_param_90136, "mem_param_90136") != 0)
                            return 1;
                    }
                    if (memblock_unref(ctx, &mem_90158, "mem_90158") != 0)
                        return 1;
                    
                    bool x_91098 = !defunc_0_reduce_res_87558;
                    bool defunc_0_reduce_res_87501;
                    
                    if (x_91098) {
                        bool x_91100;
                        bool redout_88988 = 0;
                        
                        for (int64_t i_88989 = 0; i_88989 < m_34201; i_88989++) {
                            double eta_p_62780 = ((double *) mem_90150.mem)[i_88989];
                            bool zlze_res_62781 = eta_p_62780 <= zs_res_45730;
                            bool defunc_0_op_res_46095 = zlze_res_62781 || redout_88988;
                            bool redout_tmp_91467 = defunc_0_op_res_46095;
                            
                            redout_88988 = redout_tmp_91467;
                        }
                        x_91100 = redout_88988;
                        defunc_0_reduce_res_87501 = x_91100;
                    } else {
                        defunc_0_reduce_res_87501 = 0;
                    }
                    
                    bool cond_46086 = defunc_0_reduce_res_87501 || defunc_0_reduce_res_87558;
                    int64_t ext_90257;
                    
                    if (cond_46086) {
                        ext_90257 = (int64_t) 0;
                    } else {
                        ext_90257 = ext_90207;
                    }
                    
                    int64_t ext_90256;
                    
                    if (cond_46086) {
                        ext_90256 = (int64_t) 1;
                    } else {
                        ext_90256 = ext_90206;
                    }
                    
                    int64_t ext_90255;
                    
                    if (cond_46086) {
                        ext_90255 = m_34201;
                    } else {
                        ext_90255 = ext_90205;
                    }
                    if (cond_46086) {
                        if (memblock_alloc(ctx, &mem_90216, bytes_89416, "mem_90216")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (memblock_alloc(ctx, &mem_90218, bytes_89416, "mem_90218")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (memblock_alloc(ctx, &mem_90221, bytes_89434, "mem_90221")) {
                            err = 1;
                            goto cleanup;
                        }
                        for (int64_t i_89000 = 0; i_89000 < m_34201; i_89000++) {
                            double eta_p_87520 = ((double *) mem_90150.mem)[i_89000];
                            double eta_p_87521 = ((double *) mem_param_90148.mem)[i_89000];
                            bool zgze_res_87523 = exp_absorb_cutoff_34209 <= eta_p_87520;
                            bool zl_res_87524 = eta_p_87520 < zs_res_45730;
                            bool x_87525 = !zgze_res_87523;
                            bool y_87526 = zl_res_87524 && x_87525;
                            bool cond_87527 = zgze_res_87523 || y_87526;
                            int64_t binop_y_90240 = i_89000 * ext_90205;
                            int64_t lmad_ext_90241 = ext_90207 + binop_y_90240;
                            int64_t ext_90243;
                            
                            if (cond_87527) {
                                ext_90243 = (int64_t) 0;
                            } else {
                                ext_90243 = lmad_ext_90241;
                            }
                            
                            int64_t ext_90242;
                            
                            if (cond_87527) {
                                ext_90242 = (int64_t) 1;
                            } else {
                                ext_90242 = ext_90206;
                            }
                            
                            double rescale_res_87528;
                            double rescale_res_87529;
                            
                            if (cond_87527) {
                                double log_res_87531 = futrts_log64(eta_p_87520);
                                double sqrt_res_87532 = futrts_sqrt64(eta_p_87520);
                                double zs_res_87533 = log_res_87531 / 2.0;
                                double zp_res_87534 = eta_p_87521 + zs_res_87533;
                                
                                if (memblock_alloc(ctx, &mem_90233, bytes_89416, "mem_90233")) {
                                    err = 1;
                                    goto cleanup;
                                }
                                for (int64_t i_88992 = 0; i_88992 < m_34201; i_88992++) {
                                    double eta_p_87536 = ((double *) ext_mem_90208.mem)[ext_90207 + (i_88992 * ext_90206 + i_89000 * ext_90205)];
                                    double zt_res_87537 = sqrt_res_87532 * eta_p_87536;
                                    
                                    ((double *) mem_90233.mem)[i_88992] = zt_res_87537;
                                }
                                if (memblock_set(ctx, &ext_mem_90244, &mem_90233, "mem_90233") != 0)
                                    return 1;
                                rescale_res_87528 = sqrt_res_87532;
                                rescale_res_87529 = zp_res_87534;
                            } else {
                                if (memblock_set(ctx, &ext_mem_90244, &ext_mem_90208, "ext_mem_90208") != 0)
                                    return 1;
                                rescale_res_87528 = eta_p_87520;
                                rescale_res_87529 = eta_p_87521;
                            }
                            ((double *) mem_90216.mem)[i_89000] = rescale_res_87528;
                            ((double *) mem_90218.mem)[i_89000] = rescale_res_87529;
                            lmad_copy_8b(ctx, 1, (uint64_t *) mem_90221.mem, i_89000 * m_34201, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90244.mem, ext_90243, (int64_t []) {ext_90242}, (int64_t []) {m_34201});
                            if (memblock_unref(ctx, &ext_mem_90244, "ext_mem_90244") != 0)
                                return 1;
                        }
                        if (memblock_set(ctx, &ext_mem_90264, &mem_90216, "mem_90216") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90261, &mem_90218, "mem_90218") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90258, &mem_90221, "mem_90221") != 0)
                            return 1;
                    } else {
                        if (memblock_set(ctx, &ext_mem_90264, &mem_90150, "mem_90150") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90261, &mem_param_90148, "mem_param_90148") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90258, &ext_mem_90208, "ext_mem_90208") != 0)
                            return 1;
                    }
                    if (memblock_unref(ctx, &mem_90150, "mem_90150") != 0)
                        return 1;
                    if (memblock_unref(ctx, &ext_mem_90208, "ext_mem_90208") != 0)
                        return 1;
                    
                    bool defunc_0_reduce_res_87563;
                    bool redout_89004 = 1;
                    
                    for (int64_t i_89005 = 0; i_89005 < m_34201; i_89005++) {
                        double eta_p_62548 = ((double *) ext_mem_90214.mem)[i_89005];
                        bool isnan_res_62549 = futrts_isnan64(eta_p_62548);
                        bool not_res_62550 = !isnan_res_62549;
                        bool x_46113 = not_res_62550 && redout_89004;
                        bool redout_tmp_91472 = x_46113;
                        
                        redout_89004 = redout_tmp_91472;
                    }
                    defunc_0_reduce_res_87563 = redout_89004;
                    
                    bool loop_cond_46114;
                    
                    if (defunc_0_reduce_res_87563) {
                        bool defunc_0_reduce_comm_res_87545;
                        bool redout_89006 = 0;
                        
                        for (int64_t i_89007 = 0; i_89007 < m_34201; i_89007++) {
                            double eta_p_87546 = ((double *) ext_mem_90214.mem)[i_89007];
                            double eta_p_87547 = ((double *) mem_param_90139.mem)[i_89007];
                            double zt_res_87548 = zp_res_87448 * eta_p_87546;
                            bool zgze_res_87549 = eta_p_87547 <= zt_res_87548;
                            double zt_res_87550 = zp_res_87448 * eta_p_87547;
                            bool zgze_res_87551 = eta_p_87546 <= zt_res_87550;
                            bool x_87552 = zgze_res_87549 && zgze_res_87551;
                            bool not_res_87553 = !x_87552;
                            bool defunc_0_op_res_87556 = not_res_87553 || redout_89006;
                            bool redout_tmp_91473 = defunc_0_op_res_87556;
                            
                            redout_89006 = redout_tmp_91473;
                        }
                        defunc_0_reduce_comm_res_87545 = redout_89006;
                        loop_cond_46114 = defunc_0_reduce_comm_res_87545;
                    } else {
                        loop_cond_46114 = 0;
                    }
                    if (memblock_set(ctx, &mem_param_tmp_91431, &mem_param_90136, "mem_param_90136") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_91432, &mem_param_90139, "mem_param_90139") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_91433, &mem_param_90145, "mem_param_90145") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_91434, &mem_param_90148, "mem_param_90148") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_91435, &ext_mem_90258, "ext_mem_90258") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_91436, &ext_mem_90214, "ext_mem_90214") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_91437, &ext_mem_90264, "ext_mem_90264") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_91438, &ext_mem_90211, "ext_mem_90211") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_91439, &ext_mem_90261, "ext_mem_90261") != 0)
                        return 1;
                    
                    int64_t ctx_param_ext_tmp_91440 = ctx_param_ext_90133;
                    int64_t ctx_param_ext_tmp_91441 = ctx_param_ext_90134;
                    int64_t ctx_param_ext_tmp_91442 = ctx_param_ext_90135;
                    int64_t ctx_param_ext_tmp_91443 = ext_90257;
                    int64_t ctx_param_ext_tmp_91444 = ext_90256;
                    int64_t ctx_param_ext_tmp_91445 = ext_90255;
                    bool loop_while_tmp_91446 = loop_cond_46114;
                    
                    if (memblock_set(ctx, &mem_param_90123, &mem_param_tmp_91431, "mem_param_tmp_91431") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_90126, &mem_param_tmp_91432, "mem_param_tmp_91432") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_90129, &mem_param_tmp_91433, "mem_param_tmp_91433") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_90132, &mem_param_tmp_91434, "mem_param_tmp_91434") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_90136, &mem_param_tmp_91435, "mem_param_tmp_91435") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_90139, &mem_param_tmp_91436, "mem_param_tmp_91436") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_90142, &mem_param_tmp_91437, "mem_param_tmp_91437") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_90145, &mem_param_tmp_91438, "mem_param_tmp_91438") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_90148, &mem_param_tmp_91439, "mem_param_tmp_91439") != 0)
                        return 1;
                    ctx_param_ext_90120 = ctx_param_ext_tmp_91440;
                    ctx_param_ext_90121 = ctx_param_ext_tmp_91441;
                    ctx_param_ext_90122 = ctx_param_ext_tmp_91442;
                    ctx_param_ext_90133 = ctx_param_ext_tmp_91443;
                    ctx_param_ext_90134 = ctx_param_ext_tmp_91444;
                    ctx_param_ext_90135 = ctx_param_ext_tmp_91445;
                    loop_while_46040 = loop_while_tmp_91446;
                }
                if (memblock_set(ctx, &ext_mem_90293, &mem_param_90123, "mem_param_90123") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90292, &mem_param_90126, "mem_param_90126") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90291, &mem_param_90129, "mem_param_90129") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90290, &mem_param_90132, "mem_param_90132") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90289, &mem_param_90136, "mem_param_90136") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90288, &mem_param_90139, "mem_param_90139") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90287, &mem_param_90142, "mem_param_90142") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90286, &mem_param_90145, "mem_param_90145") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90285, &mem_param_90148, "mem_param_90148") != 0)
                    return 1;
                ext_90284 = ctx_param_ext_90120;
                ext_90283 = ctx_param_ext_90121;
                ext_90282 = ctx_param_ext_90122;
                ext_90275 = ctx_param_ext_90133;
                ext_90274 = ctx_param_ext_90134;
                ext_90273 = ctx_param_ext_90135;
                algo5_core_loop_res_46030 = loop_while_46040;
                if (memblock_unref(ctx, &ext_mem_90066, "ext_mem_90066") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90069, "ext_mem_90069") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90113, "ext_mem_90113") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90116, "ext_mem_90116") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90119, "ext_mem_90119") != 0)
                    return 1;
                
                bool defunc_0_reduce_res_88521;
                bool redout_89008 = 1;
                
                for (int64_t i_89009 = 0; i_89009 < m_34201; i_89009++) {
                    double eta_p_60682 = ((double *) ext_mem_90288.mem)[i_89009];
                    bool isnan_res_60683 = futrts_isnan64(eta_p_60682);
                    bool not_res_60684 = !isnan_res_60683;
                    bool x_46138 = not_res_60684 && redout_89008;
                    bool redout_tmp_91474 = x_46138;
                    
                    redout_89008 = redout_tmp_91474;
                }
                defunc_0_reduce_res_88521 = redout_89008;
                
                int64_t ext_90572;
                int64_t ext_90571;
                int64_t ext_90570;
                
                if (defunc_0_reduce_res_88521) {
                    if (memblock_set(ctx, &ext_mem_90573, &ext_mem_90289, "ext_mem_90289") != 0)
                        return 1;
                    ext_90572 = ext_90275;
                    ext_90571 = ext_90274;
                    ext_90570 = ext_90273;
                    if (memblock_set(ctx, &ext_mem_90569, &ext_mem_90288, "ext_mem_90288") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90566, &ext_mem_90287, "ext_mem_90287") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90563, &ext_mem_90286, "ext_mem_90286") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90560, &ext_mem_90285, "ext_mem_90285") != 0)
                        return 1;
                } else {
                    if (memblock_alloc(ctx, &mem_90295, bytes_89416, "mem_90295")) {
                        err = 1;
                        goto cleanup;
                    }
                    
                    bool defunc_0_reduce_res_87767;
                    bool redout_89013 = 0;
                    
                    for (int64_t i_89015 = 0; i_89015 < m_34201; i_89015++) {
                        double eta_p_63115 = ((double *) distrs_mem_89413.mem)[eta_p_45650 * m_34201 + i_89015];
                        double eta_p_63116 = ((double *) ext_mem_90290.mem)[i_89015];
                        double defunc_0_reduce_res_87565;
                        double redout_89010 = 0.0;
                        
                        for (int64_t i_89011 = 0; i_89011 < m_34201; i_89011++) {
                            double eta_p_63140 = ((double *) ext_mem_90292.mem)[i_89011];
                            double eta_p_63141 = ((double *) ext_mem_90293.mem)[ext_90284 + (i_89011 * ext_90283 + i_89015 * ext_90282)];
                            double zt_res_63142 = eta_p_63140 * eta_p_63141;
                            double zp_res_63125 = zt_res_63142 + redout_89010;
                            double redout_tmp_91477 = zp_res_63125;
                            
                            redout_89010 = redout_tmp_91477;
                        }
                        defunc_0_reduce_res_87565 = redout_89010;
                        
                        double zs_res_63127 = defunc_0_reduce_res_87565 / eta_p_63115;
                        double ztzt_res_63129 = fpow64(zs_res_63127, zs_res_46693);
                        double zt_res_63131 = zs_res_46695 * eta_p_63116;
                        double exp_res_63133 = futrts_exp64(zt_res_63131);
                        double zt_res_63135 = ztzt_res_63129 * exp_res_63133;
                        bool zgze_res_63137 = exp_absorb_cutoff_34209 <= zt_res_63135;
                        bool defunc_0_op_res_46179 = zgze_res_63137 || redout_89013;
                        
                        ((double *) mem_90295.mem)[i_89015] = zt_res_63135;
                        
                        bool redout_tmp_91475 = defunc_0_op_res_46179;
                        
                        redout_89013 = redout_tmp_91475;
                    }
                    defunc_0_reduce_res_87767 = redout_89013;
                    if (memblock_alloc(ctx, &mem_90303, bytes_89416, "mem_90303")) {
                        err = 1;
                        goto cleanup;
                    }
                    
                    bool defunc_0_reduce_res_87770;
                    bool redout_89020 = 0;
                    
                    for (int64_t i_89022 = 0; i_89022 < m_34201; i_89022++) {
                        double eta_p_63033 = ((double *) distrs_mem_89413.mem)[eta_p_45649 * m_34201 + i_89022];
                        double eta_p_63034 = ((double *) ext_mem_90291.mem)[i_89022];
                        double defunc_0_reduce_res_87566;
                        double redout_89017 = 0.0;
                        
                        for (int64_t i_89018 = 0; i_89018 < m_34201; i_89018++) {
                            double eta_p_63146 = ((double *) mem_90295.mem)[i_89018];
                            double eta_p_63147 = ((double *) ext_mem_90293.mem)[ext_90284 + (i_89022 * ext_90283 + i_89018 * ext_90282)];
                            double zt_res_63148 = eta_p_63146 * eta_p_63147;
                            double zp_res_63043 = zt_res_63148 + redout_89017;
                            double redout_tmp_91480 = zp_res_63043;
                            
                            redout_89017 = redout_tmp_91480;
                        }
                        defunc_0_reduce_res_87566 = redout_89017;
                        
                        double zs_res_63045 = defunc_0_reduce_res_87566 / eta_p_63033;
                        double ztzt_res_63047 = fpow64(zs_res_63045, zs_res_46652);
                        double zt_res_63049 = zs_res_46654 * eta_p_63034;
                        double exp_res_63051 = futrts_exp64(zt_res_63049);
                        double zt_res_63053 = ztzt_res_63047 * exp_res_63051;
                        bool zgze_res_63055 = exp_absorb_cutoff_34209 <= zt_res_63053;
                        bool defunc_0_op_res_46154 = zgze_res_63055 || redout_89020;
                        
                        ((double *) mem_90303.mem)[i_89022] = zt_res_63053;
                        
                        bool redout_tmp_91478 = defunc_0_op_res_46154;
                        
                        redout_89020 = redout_tmp_91478;
                    }
                    defunc_0_reduce_res_87770 = redout_89020;
                    
                    bool x_90962 = !defunc_0_reduce_res_87770;
                    bool defunc_0_reduce_res_87567;
                    
                    if (x_90962) {
                        bool x_90964;
                        bool redout_89024 = 0;
                        
                        for (int64_t i_89025 = 0; i_89025 < m_34201; i_89025++) {
                            double eta_p_63152 = ((double *) mem_90303.mem)[i_89025];
                            bool zlze_res_63153 = eta_p_63152 <= zs_res_45730;
                            bool defunc_0_op_res_46164 = zlze_res_63153 || redout_89024;
                            bool redout_tmp_91481 = defunc_0_op_res_46164;
                            
                            redout_89024 = redout_tmp_91481;
                        }
                        x_90964 = redout_89024;
                        defunc_0_reduce_res_87567 = x_90964;
                    } else {
                        defunc_0_reduce_res_87567 = 0;
                    }
                    
                    bool cond_46155 = defunc_0_reduce_res_87567 || defunc_0_reduce_res_87770;
                    int64_t ext_90352;
                    
                    if (cond_46155) {
                        ext_90352 = (int64_t) 0;
                    } else {
                        ext_90352 = ext_90284;
                    }
                    
                    int64_t ext_90351;
                    
                    if (cond_46155) {
                        ext_90351 = m_34201;
                    } else {
                        ext_90351 = ext_90283;
                    }
                    
                    int64_t ext_90350;
                    
                    if (cond_46155) {
                        ext_90350 = (int64_t) 1;
                    } else {
                        ext_90350 = ext_90282;
                    }
                    if (cond_46155) {
                        if (memblock_alloc(ctx, &mem_90311, bytes_89416, "mem_90311")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (memblock_alloc(ctx, &mem_90313, bytes_89416, "mem_90313")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (memblock_alloc(ctx, &mem_90316, bytes_89434, "mem_90316")) {
                            err = 1;
                            goto cleanup;
                        }
                        for (int64_t i_89036 = 0; i_89036 < m_34201; i_89036++) {
                            double eta_p_87584 = ((double *) mem_90303.mem)[i_89036];
                            double eta_p_87585 = ((double *) ext_mem_90291.mem)[i_89036];
                            bool zgze_res_87587 = exp_absorb_cutoff_34209 <= eta_p_87584;
                            bool zl_res_87588 = eta_p_87584 < zs_res_45730;
                            bool x_87589 = !zgze_res_87587;
                            bool y_87590 = zl_res_87588 && x_87589;
                            bool cond_87591 = zgze_res_87587 || y_87590;
                            int64_t binop_y_90335 = i_89036 * ext_90283;
                            int64_t lmad_ext_90336 = ext_90284 + binop_y_90335;
                            int64_t ext_90338;
                            
                            if (cond_87591) {
                                ext_90338 = (int64_t) 0;
                            } else {
                                ext_90338 = lmad_ext_90336;
                            }
                            
                            int64_t ext_90337;
                            
                            if (cond_87591) {
                                ext_90337 = (int64_t) 1;
                            } else {
                                ext_90337 = ext_90282;
                            }
                            
                            double rescale_res_87592;
                            double rescale_res_87593;
                            
                            if (cond_87591) {
                                double log_res_87595 = futrts_log64(eta_p_87584);
                                double sqrt_res_87596 = futrts_sqrt64(eta_p_87584);
                                double zs_res_87597 = log_res_87595 / 2.0;
                                double zp_res_87598 = eta_p_87585 + zs_res_87597;
                                
                                if (memblock_alloc(ctx, &mem_90328, bytes_89416, "mem_90328")) {
                                    err = 1;
                                    goto cleanup;
                                }
                                for (int64_t i_89028 = 0; i_89028 < m_34201; i_89028++) {
                                    double eta_p_87600 = ((double *) ext_mem_90293.mem)[ext_90284 + (i_89036 * ext_90283 + i_89028 * ext_90282)];
                                    double zt_res_87601 = sqrt_res_87596 * eta_p_87600;
                                    
                                    ((double *) mem_90328.mem)[i_89028] = zt_res_87601;
                                }
                                if (memblock_set(ctx, &ext_mem_90339, &mem_90328, "mem_90328") != 0)
                                    return 1;
                                rescale_res_87592 = sqrt_res_87596;
                                rescale_res_87593 = zp_res_87598;
                            } else {
                                if (memblock_set(ctx, &ext_mem_90339, &ext_mem_90293, "ext_mem_90293") != 0)
                                    return 1;
                                rescale_res_87592 = eta_p_87584;
                                rescale_res_87593 = eta_p_87585;
                            }
                            ((double *) mem_90311.mem)[i_89036] = rescale_res_87592;
                            ((double *) mem_90313.mem)[i_89036] = rescale_res_87593;
                            lmad_copy_8b(ctx, 1, (uint64_t *) mem_90316.mem, i_89036 * m_34201, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90339.mem, ext_90338, (int64_t []) {ext_90337}, (int64_t []) {m_34201});
                            if (memblock_unref(ctx, &ext_mem_90339, "ext_mem_90339") != 0)
                                return 1;
                        }
                        if (memblock_set(ctx, &ext_mem_90359, &mem_90311, "mem_90311") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90356, &mem_90313, "mem_90313") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90353, &mem_90316, "mem_90316") != 0)
                            return 1;
                    } else {
                        if (memblock_set(ctx, &ext_mem_90359, &mem_90303, "mem_90303") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90356, &ext_mem_90291, "ext_mem_90291") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90353, &ext_mem_90293, "ext_mem_90293") != 0)
                            return 1;
                    }
                    if (memblock_unref(ctx, &mem_90303, "mem_90303") != 0)
                        return 1;
                    
                    bool x_90958 = !defunc_0_reduce_res_87767;
                    bool defunc_0_reduce_res_87606;
                    
                    if (x_90958) {
                        bool x_90960;
                        bool redout_89040 = 0;
                        
                        for (int64_t i_89041 = 0; i_89041 < m_34201; i_89041++) {
                            double eta_p_63195 = ((double *) mem_90295.mem)[i_89041];
                            bool zlze_res_63196 = eta_p_63195 <= zs_res_45730;
                            bool defunc_0_op_res_46189 = zlze_res_63196 || redout_89040;
                            bool redout_tmp_91486 = defunc_0_op_res_46189;
                            
                            redout_89040 = redout_tmp_91486;
                        }
                        x_90960 = redout_89040;
                        defunc_0_reduce_res_87606 = x_90960;
                    } else {
                        defunc_0_reduce_res_87606 = 0;
                    }
                    
                    bool cond_46180 = defunc_0_reduce_res_87606 || defunc_0_reduce_res_87767;
                    int64_t ext_90402;
                    
                    if (cond_46180) {
                        ext_90402 = (int64_t) 0;
                    } else {
                        ext_90402 = ext_90352;
                    }
                    
                    int64_t ext_90401;
                    
                    if (cond_46180) {
                        ext_90401 = (int64_t) 1;
                    } else {
                        ext_90401 = ext_90351;
                    }
                    
                    int64_t ext_90400;
                    
                    if (cond_46180) {
                        ext_90400 = m_34201;
                    } else {
                        ext_90400 = ext_90350;
                    }
                    if (cond_46180) {
                        if (memblock_alloc(ctx, &mem_90361, bytes_89416, "mem_90361")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (memblock_alloc(ctx, &mem_90363, bytes_89416, "mem_90363")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (memblock_alloc(ctx, &mem_90366, bytes_89434, "mem_90366")) {
                            err = 1;
                            goto cleanup;
                        }
                        for (int64_t i_89052 = 0; i_89052 < m_34201; i_89052++) {
                            double eta_p_87625 = ((double *) mem_90295.mem)[i_89052];
                            double eta_p_87626 = ((double *) ext_mem_90290.mem)[i_89052];
                            bool zgze_res_87628 = exp_absorb_cutoff_34209 <= eta_p_87625;
                            bool zl_res_87629 = eta_p_87625 < zs_res_45730;
                            bool x_87630 = !zgze_res_87628;
                            bool y_87631 = zl_res_87629 && x_87630;
                            bool cond_87632 = zgze_res_87628 || y_87631;
                            int64_t binop_y_90385 = i_89052 * ext_90350;
                            int64_t lmad_ext_90386 = ext_90352 + binop_y_90385;
                            int64_t ext_90388;
                            
                            if (cond_87632) {
                                ext_90388 = (int64_t) 0;
                            } else {
                                ext_90388 = lmad_ext_90386;
                            }
                            
                            int64_t ext_90387;
                            
                            if (cond_87632) {
                                ext_90387 = (int64_t) 1;
                            } else {
                                ext_90387 = ext_90351;
                            }
                            
                            double rescale_res_87633;
                            double rescale_res_87634;
                            
                            if (cond_87632) {
                                double log_res_87636 = futrts_log64(eta_p_87625);
                                double sqrt_res_87637 = futrts_sqrt64(eta_p_87625);
                                double zs_res_87638 = log_res_87636 / 2.0;
                                double zp_res_87639 = eta_p_87626 + zs_res_87638;
                                
                                if (memblock_alloc(ctx, &mem_90378, bytes_89416, "mem_90378")) {
                                    err = 1;
                                    goto cleanup;
                                }
                                for (int64_t i_89044 = 0; i_89044 < m_34201; i_89044++) {
                                    double eta_p_87641 = ((double *) ext_mem_90353.mem)[ext_90352 + (i_89044 * ext_90351 + i_89052 * ext_90350)];
                                    double zt_res_87642 = sqrt_res_87637 * eta_p_87641;
                                    
                                    ((double *) mem_90378.mem)[i_89044] = zt_res_87642;
                                }
                                if (memblock_set(ctx, &ext_mem_90389, &mem_90378, "mem_90378") != 0)
                                    return 1;
                                rescale_res_87633 = sqrt_res_87637;
                                rescale_res_87634 = zp_res_87639;
                            } else {
                                if (memblock_set(ctx, &ext_mem_90389, &ext_mem_90353, "ext_mem_90353") != 0)
                                    return 1;
                                rescale_res_87633 = eta_p_87625;
                                rescale_res_87634 = eta_p_87626;
                            }
                            ((double *) mem_90361.mem)[i_89052] = rescale_res_87633;
                            ((double *) mem_90363.mem)[i_89052] = rescale_res_87634;
                            lmad_copy_8b(ctx, 1, (uint64_t *) mem_90366.mem, i_89052 * m_34201, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90389.mem, ext_90388, (int64_t []) {ext_90387}, (int64_t []) {m_34201});
                            if (memblock_unref(ctx, &ext_mem_90389, "ext_mem_90389") != 0)
                                return 1;
                        }
                        if (memblock_set(ctx, &ext_mem_90409, &mem_90361, "mem_90361") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90406, &mem_90363, "mem_90363") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90403, &mem_90366, "mem_90366") != 0)
                            return 1;
                    } else {
                        if (memblock_set(ctx, &ext_mem_90409, &mem_90295, "mem_90295") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90406, &ext_mem_90290, "ext_mem_90290") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90403, &ext_mem_90353, "ext_mem_90353") != 0)
                            return 1;
                    }
                    if (memblock_unref(ctx, &mem_90295, "mem_90295") != 0)
                        return 1;
                    if (memblock_unref(ctx, &ext_mem_90353, "ext_mem_90353") != 0)
                        return 1;
                    
                    bool defunc_0_reduce_res_87772;
                    bool redout_89056 = 1;
                    
                    for (int64_t i_89057 = 0; i_89057 < m_34201; i_89057++) {
                        double eta_p_62963 = ((double *) ext_mem_90359.mem)[i_89057];
                        bool isnan_res_62964 = futrts_isnan64(eta_p_62963);
                        bool not_res_62965 = !isnan_res_62964;
                        bool x_46207 = not_res_62965 && redout_89056;
                        bool redout_tmp_91491 = x_46207;
                        
                        redout_89056 = redout_tmp_91491;
                    }
                    defunc_0_reduce_res_87772 = redout_89056;
                    
                    bool defunc_0_reduce_comm_res_87650;
                    
                    if (defunc_0_reduce_res_87772) {
                        bool x_90956;
                        bool redout_89058 = 0;
                        
                        for (int64_t i_89059 = 0; i_89059 < m_34201; i_89059++) {
                            double eta_p_87651 = ((double *) ext_mem_90359.mem)[i_89059];
                            double eta_p_87652 = ((double *) ext_mem_90292.mem)[i_89059];
                            double zt_res_87653 = zp_res_87448 * eta_p_87651;
                            bool zgze_res_87654 = eta_p_87652 <= zt_res_87653;
                            double zt_res_87655 = zp_res_87448 * eta_p_87652;
                            bool zgze_res_87656 = eta_p_87651 <= zt_res_87655;
                            bool x_87657 = zgze_res_87654 && zgze_res_87656;
                            bool not_res_87658 = !x_87657;
                            bool defunc_0_op_res_87661 = not_res_87658 || redout_89058;
                            bool redout_tmp_91492 = defunc_0_op_res_87661;
                            
                            redout_89058 = redout_tmp_91492;
                        }
                        x_90956 = redout_89058;
                        defunc_0_reduce_comm_res_87650 = x_90956;
                    } else {
                        defunc_0_reduce_comm_res_87650 = 0;
                    }
                    
                    bool x_91091 = defunc_0_reduce_comm_res_87650 && defunc_0_reduce_res_87772;
                    int64_t ext_90552;
                    int64_t ext_90551;
                    int64_t ext_90550;
                    bool algo5_core_loop_res_f_res_46224;
                    bool loop_while_46230;
                    int64_t ctx_param_ext_90410;
                    int64_t ctx_param_ext_90411;
                    int64_t ctx_param_ext_90412;
                    
                    if (memblock_set(ctx, &mem_param_90413, &ext_mem_90403, "ext_mem_90403") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_90416, &ext_mem_90359, "ext_mem_90359") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_90419, &ext_mem_90409, "ext_mem_90409") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_90422, &ext_mem_90356, "ext_mem_90356") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_90425, &ext_mem_90406, "ext_mem_90406") != 0)
                        return 1;
                    ctx_param_ext_90410 = ext_90402;
                    ctx_param_ext_90411 = ext_90401;
                    ctx_param_ext_90412 = ext_90400;
                    loop_while_46230 = x_91091;
                    while (loop_while_46230) {
                        if (memblock_alloc(ctx, &mem_90427, bytes_89416, "mem_90427")) {
                            err = 1;
                            goto cleanup;
                        }
                        
                        bool defunc_0_reduce_res_87761;
                        bool redout_89063 = 0;
                        
                        for (int64_t i_89065 = 0; i_89065 < m_34201; i_89065++) {
                            double eta_p_63418 = ((double *) distrs_mem_89413.mem)[eta_p_45650 * m_34201 + i_89065];
                            double eta_p_63419 = ((double *) mem_param_90425.mem)[i_89065];
                            double defunc_0_reduce_res_87663;
                            double redout_89060 = 0.0;
                            
                            for (int64_t i_89061 = 0; i_89061 < m_34201; i_89061++) {
                                double eta_p_63443 = ((double *) mem_param_90416.mem)[i_89061];
                                double eta_p_63444 = ((double *) mem_param_90413.mem)[ctx_param_ext_90410 + (i_89061 * ctx_param_ext_90411 + i_89065 * ctx_param_ext_90412)];
                                double zt_res_63445 = eta_p_63443 * eta_p_63444;
                                double zp_res_63428 = zt_res_63445 + redout_89060;
                                double redout_tmp_91509 = zp_res_63428;
                                
                                redout_89060 = redout_tmp_91509;
                            }
                            defunc_0_reduce_res_87663 = redout_89060;
                            
                            double zs_res_63430 = defunc_0_reduce_res_87663 / eta_p_63418;
                            double ztzt_res_63432 = fpow64(zs_res_63430, zs_res_46693);
                            double zt_res_63434 = zs_res_46695 * eta_p_63419;
                            double exp_res_63436 = futrts_exp64(zt_res_63434);
                            double zt_res_63438 = ztzt_res_63432 * exp_res_63436;
                            bool zgze_res_63440 = exp_absorb_cutoff_34209 <= zt_res_63438;
                            bool defunc_0_op_res_46271 = zgze_res_63440 || redout_89063;
                            
                            ((double *) mem_90427.mem)[i_89065] = zt_res_63438;
                            
                            bool redout_tmp_91507 = defunc_0_op_res_46271;
                            
                            redout_89063 = redout_tmp_91507;
                        }
                        defunc_0_reduce_res_87761 = redout_89063;
                        if (memblock_alloc(ctx, &mem_90435, bytes_89416, "mem_90435")) {
                            err = 1;
                            goto cleanup;
                        }
                        
                        bool defunc_0_reduce_res_87764;
                        bool redout_89070 = 0;
                        
                        for (int64_t i_89072 = 0; i_89072 < m_34201; i_89072++) {
                            double eta_p_63336 = ((double *) distrs_mem_89413.mem)[eta_p_45649 * m_34201 + i_89072];
                            double eta_p_63337 = ((double *) mem_param_90422.mem)[i_89072];
                            double defunc_0_reduce_res_87664;
                            double redout_89067 = 0.0;
                            
                            for (int64_t i_89068 = 0; i_89068 < m_34201; i_89068++) {
                                double eta_p_63449 = ((double *) mem_90427.mem)[i_89068];
                                double eta_p_63450 = ((double *) mem_param_90413.mem)[ctx_param_ext_90410 + (i_89072 * ctx_param_ext_90411 + i_89068 * ctx_param_ext_90412)];
                                double zt_res_63451 = eta_p_63449 * eta_p_63450;
                                double zp_res_63346 = zt_res_63451 + redout_89067;
                                double redout_tmp_91512 = zp_res_63346;
                                
                                redout_89067 = redout_tmp_91512;
                            }
                            defunc_0_reduce_res_87664 = redout_89067;
                            
                            double zs_res_63348 = defunc_0_reduce_res_87664 / eta_p_63336;
                            double ztzt_res_63350 = fpow64(zs_res_63348, zs_res_46652);
                            double zt_res_63352 = zs_res_46654 * eta_p_63337;
                            double exp_res_63354 = futrts_exp64(zt_res_63352);
                            double zt_res_63356 = ztzt_res_63350 * exp_res_63354;
                            bool zgze_res_63358 = exp_absorb_cutoff_34209 <= zt_res_63356;
                            bool defunc_0_op_res_46246 = zgze_res_63358 || redout_89070;
                            
                            ((double *) mem_90435.mem)[i_89072] = zt_res_63356;
                            
                            bool redout_tmp_91510 = defunc_0_op_res_46246;
                            
                            redout_89070 = redout_tmp_91510;
                        }
                        defunc_0_reduce_res_87764 = redout_89070;
                        
                        bool x_90950 = !defunc_0_reduce_res_87764;
                        bool defunc_0_reduce_res_87665;
                        
                        if (x_90950) {
                            bool x_90952;
                            bool redout_89074 = 0;
                            
                            for (int64_t i_89075 = 0; i_89075 < m_34201; i_89075++) {
                                double eta_p_63455 = ((double *) mem_90435.mem)[i_89075];
                                bool zlze_res_63456 = eta_p_63455 <= zs_res_45730;
                                bool defunc_0_op_res_46256 = zlze_res_63456 || redout_89074;
                                bool redout_tmp_91513 = defunc_0_op_res_46256;
                                
                                redout_89074 = redout_tmp_91513;
                            }
                            x_90952 = redout_89074;
                            defunc_0_reduce_res_87665 = x_90952;
                        } else {
                            defunc_0_reduce_res_87665 = 0;
                        }
                        
                        bool cond_46247 = defunc_0_reduce_res_87665 || defunc_0_reduce_res_87764;
                        int64_t ext_90484;
                        
                        if (cond_46247) {
                            ext_90484 = (int64_t) 0;
                        } else {
                            ext_90484 = ctx_param_ext_90410;
                        }
                        
                        int64_t ext_90483;
                        
                        if (cond_46247) {
                            ext_90483 = m_34201;
                        } else {
                            ext_90483 = ctx_param_ext_90411;
                        }
                        
                        int64_t ext_90482;
                        
                        if (cond_46247) {
                            ext_90482 = (int64_t) 1;
                        } else {
                            ext_90482 = ctx_param_ext_90412;
                        }
                        if (cond_46247) {
                            if (memblock_alloc(ctx, &mem_90443, bytes_89416, "mem_90443")) {
                                err = 1;
                                goto cleanup;
                            }
                            if (memblock_alloc(ctx, &mem_90445, bytes_89416, "mem_90445")) {
                                err = 1;
                                goto cleanup;
                            }
                            if (memblock_alloc(ctx, &mem_90448, bytes_89434, "mem_90448")) {
                                err = 1;
                                goto cleanup;
                            }
                            for (int64_t i_89086 = 0; i_89086 < m_34201; i_89086++) {
                                double eta_p_87682 = ((double *) mem_90435.mem)[i_89086];
                                double eta_p_87683 = ((double *) mem_param_90422.mem)[i_89086];
                                bool zgze_res_87685 = exp_absorb_cutoff_34209 <= eta_p_87682;
                                bool zl_res_87686 = eta_p_87682 < zs_res_45730;
                                bool x_87687 = !zgze_res_87685;
                                bool y_87688 = zl_res_87686 && x_87687;
                                bool cond_87689 = zgze_res_87685 || y_87688;
                                int64_t binop_y_90467 = i_89086 * ctx_param_ext_90411;
                                int64_t lmad_ext_90468 = ctx_param_ext_90410 + binop_y_90467;
                                int64_t ext_90470;
                                
                                if (cond_87689) {
                                    ext_90470 = (int64_t) 0;
                                } else {
                                    ext_90470 = lmad_ext_90468;
                                }
                                
                                int64_t ext_90469;
                                
                                if (cond_87689) {
                                    ext_90469 = (int64_t) 1;
                                } else {
                                    ext_90469 = ctx_param_ext_90412;
                                }
                                
                                double rescale_res_87690;
                                double rescale_res_87691;
                                
                                if (cond_87689) {
                                    double log_res_87693 = futrts_log64(eta_p_87682);
                                    double sqrt_res_87694 = futrts_sqrt64(eta_p_87682);
                                    double zs_res_87695 = log_res_87693 / 2.0;
                                    double zp_res_87696 = eta_p_87683 + zs_res_87695;
                                    
                                    if (memblock_alloc(ctx, &mem_90460, bytes_89416, "mem_90460")) {
                                        err = 1;
                                        goto cleanup;
                                    }
                                    for (int64_t i_89078 = 0; i_89078 < m_34201; i_89078++) {
                                        double eta_p_87698 = ((double *) mem_param_90413.mem)[ctx_param_ext_90410 + (i_89086 * ctx_param_ext_90411 + i_89078 * ctx_param_ext_90412)];
                                        double zt_res_87699 = sqrt_res_87694 * eta_p_87698;
                                        
                                        ((double *) mem_90460.mem)[i_89078] = zt_res_87699;
                                    }
                                    if (memblock_set(ctx, &ext_mem_90471, &mem_90460, "mem_90460") != 0)
                                        return 1;
                                    rescale_res_87690 = sqrt_res_87694;
                                    rescale_res_87691 = zp_res_87696;
                                } else {
                                    if (memblock_set(ctx, &ext_mem_90471, &mem_param_90413, "mem_param_90413") != 0)
                                        return 1;
                                    rescale_res_87690 = eta_p_87682;
                                    rescale_res_87691 = eta_p_87683;
                                }
                                ((double *) mem_90443.mem)[i_89086] = rescale_res_87690;
                                ((double *) mem_90445.mem)[i_89086] = rescale_res_87691;
                                lmad_copy_8b(ctx, 1, (uint64_t *) mem_90448.mem, i_89086 * m_34201, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90471.mem, ext_90470, (int64_t []) {ext_90469}, (int64_t []) {m_34201});
                                if (memblock_unref(ctx, &ext_mem_90471, "ext_mem_90471") != 0)
                                    return 1;
                            }
                            if (memblock_set(ctx, &ext_mem_90491, &mem_90443, "mem_90443") != 0)
                                return 1;
                            if (memblock_set(ctx, &ext_mem_90488, &mem_90445, "mem_90445") != 0)
                                return 1;
                            if (memblock_set(ctx, &ext_mem_90485, &mem_90448, "mem_90448") != 0)
                                return 1;
                        } else {
                            if (memblock_set(ctx, &ext_mem_90491, &mem_90435, "mem_90435") != 0)
                                return 1;
                            if (memblock_set(ctx, &ext_mem_90488, &mem_param_90422, "mem_param_90422") != 0)
                                return 1;
                            if (memblock_set(ctx, &ext_mem_90485, &mem_param_90413, "mem_param_90413") != 0)
                                return 1;
                        }
                        if (memblock_unref(ctx, &mem_90435, "mem_90435") != 0)
                            return 1;
                        
                        bool x_91094 = !defunc_0_reduce_res_87761;
                        bool defunc_0_reduce_res_87704;
                        
                        if (x_91094) {
                            bool x_91096;
                            bool redout_89090 = 0;
                            
                            for (int64_t i_89091 = 0; i_89091 < m_34201; i_89091++) {
                                double eta_p_63498 = ((double *) mem_90427.mem)[i_89091];
                                bool zlze_res_63499 = eta_p_63498 <= zs_res_45730;
                                bool defunc_0_op_res_46281 = zlze_res_63499 || redout_89090;
                                bool redout_tmp_91518 = defunc_0_op_res_46281;
                                
                                redout_89090 = redout_tmp_91518;
                            }
                            x_91096 = redout_89090;
                            defunc_0_reduce_res_87704 = x_91096;
                        } else {
                            defunc_0_reduce_res_87704 = 0;
                        }
                        
                        bool cond_46272 = defunc_0_reduce_res_87704 || defunc_0_reduce_res_87761;
                        int64_t ext_90534;
                        
                        if (cond_46272) {
                            ext_90534 = (int64_t) 0;
                        } else {
                            ext_90534 = ext_90484;
                        }
                        
                        int64_t ext_90533;
                        
                        if (cond_46272) {
                            ext_90533 = (int64_t) 1;
                        } else {
                            ext_90533 = ext_90483;
                        }
                        
                        int64_t ext_90532;
                        
                        if (cond_46272) {
                            ext_90532 = m_34201;
                        } else {
                            ext_90532 = ext_90482;
                        }
                        if (cond_46272) {
                            if (memblock_alloc(ctx, &mem_90493, bytes_89416, "mem_90493")) {
                                err = 1;
                                goto cleanup;
                            }
                            if (memblock_alloc(ctx, &mem_90495, bytes_89416, "mem_90495")) {
                                err = 1;
                                goto cleanup;
                            }
                            if (memblock_alloc(ctx, &mem_90498, bytes_89434, "mem_90498")) {
                                err = 1;
                                goto cleanup;
                            }
                            for (int64_t i_89102 = 0; i_89102 < m_34201; i_89102++) {
                                double eta_p_87723 = ((double *) mem_90427.mem)[i_89102];
                                double eta_p_87724 = ((double *) mem_param_90425.mem)[i_89102];
                                bool zgze_res_87726 = exp_absorb_cutoff_34209 <= eta_p_87723;
                                bool zl_res_87727 = eta_p_87723 < zs_res_45730;
                                bool x_87728 = !zgze_res_87726;
                                bool y_87729 = zl_res_87727 && x_87728;
                                bool cond_87730 = zgze_res_87726 || y_87729;
                                int64_t binop_y_90517 = i_89102 * ext_90482;
                                int64_t lmad_ext_90518 = ext_90484 + binop_y_90517;
                                int64_t ext_90520;
                                
                                if (cond_87730) {
                                    ext_90520 = (int64_t) 0;
                                } else {
                                    ext_90520 = lmad_ext_90518;
                                }
                                
                                int64_t ext_90519;
                                
                                if (cond_87730) {
                                    ext_90519 = (int64_t) 1;
                                } else {
                                    ext_90519 = ext_90483;
                                }
                                
                                double rescale_res_87731;
                                double rescale_res_87732;
                                
                                if (cond_87730) {
                                    double log_res_87734 = futrts_log64(eta_p_87723);
                                    double sqrt_res_87735 = futrts_sqrt64(eta_p_87723);
                                    double zs_res_87736 = log_res_87734 / 2.0;
                                    double zp_res_87737 = eta_p_87724 + zs_res_87736;
                                    
                                    if (memblock_alloc(ctx, &mem_90510, bytes_89416, "mem_90510")) {
                                        err = 1;
                                        goto cleanup;
                                    }
                                    for (int64_t i_89094 = 0; i_89094 < m_34201; i_89094++) {
                                        double eta_p_87739 = ((double *) ext_mem_90485.mem)[ext_90484 + (i_89094 * ext_90483 + i_89102 * ext_90482)];
                                        double zt_res_87740 = sqrt_res_87735 * eta_p_87739;
                                        
                                        ((double *) mem_90510.mem)[i_89094] = zt_res_87740;
                                    }
                                    if (memblock_set(ctx, &ext_mem_90521, &mem_90510, "mem_90510") != 0)
                                        return 1;
                                    rescale_res_87731 = sqrt_res_87735;
                                    rescale_res_87732 = zp_res_87737;
                                } else {
                                    if (memblock_set(ctx, &ext_mem_90521, &ext_mem_90485, "ext_mem_90485") != 0)
                                        return 1;
                                    rescale_res_87731 = eta_p_87723;
                                    rescale_res_87732 = eta_p_87724;
                                }
                                ((double *) mem_90493.mem)[i_89102] = rescale_res_87731;
                                ((double *) mem_90495.mem)[i_89102] = rescale_res_87732;
                                lmad_copy_8b(ctx, 1, (uint64_t *) mem_90498.mem, i_89102 * m_34201, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90521.mem, ext_90520, (int64_t []) {ext_90519}, (int64_t []) {m_34201});
                                if (memblock_unref(ctx, &ext_mem_90521, "ext_mem_90521") != 0)
                                    return 1;
                            }
                            if (memblock_set(ctx, &ext_mem_90541, &mem_90493, "mem_90493") != 0)
                                return 1;
                            if (memblock_set(ctx, &ext_mem_90538, &mem_90495, "mem_90495") != 0)
                                return 1;
                            if (memblock_set(ctx, &ext_mem_90535, &mem_90498, "mem_90498") != 0)
                                return 1;
                        } else {
                            if (memblock_set(ctx, &ext_mem_90541, &mem_90427, "mem_90427") != 0)
                                return 1;
                            if (memblock_set(ctx, &ext_mem_90538, &mem_param_90425, "mem_param_90425") != 0)
                                return 1;
                            if (memblock_set(ctx, &ext_mem_90535, &ext_mem_90485, "ext_mem_90485") != 0)
                                return 1;
                        }
                        if (memblock_unref(ctx, &mem_90427, "mem_90427") != 0)
                            return 1;
                        if (memblock_unref(ctx, &ext_mem_90485, "ext_mem_90485") != 0)
                            return 1;
                        
                        bool defunc_0_reduce_res_87766;
                        bool redout_89106 = 1;
                        
                        for (int64_t i_89107 = 0; i_89107 < m_34201; i_89107++) {
                            double eta_p_63266 = ((double *) ext_mem_90491.mem)[i_89107];
                            bool isnan_res_63267 = futrts_isnan64(eta_p_63266);
                            bool not_res_63268 = !isnan_res_63267;
                            bool x_46299 = not_res_63268 && redout_89106;
                            bool redout_tmp_91523 = x_46299;
                            
                            redout_89106 = redout_tmp_91523;
                        }
                        defunc_0_reduce_res_87766 = redout_89106;
                        
                        bool loop_cond_46300;
                        
                        if (defunc_0_reduce_res_87766) {
                            bool defunc_0_reduce_comm_res_87748;
                            bool redout_89108 = 0;
                            
                            for (int64_t i_89109 = 0; i_89109 < m_34201; i_89109++) {
                                double eta_p_87749 = ((double *) ext_mem_90491.mem)[i_89109];
                                double eta_p_87750 = ((double *) mem_param_90416.mem)[i_89109];
                                double zt_res_87751 = zp_res_87448 * eta_p_87749;
                                bool zgze_res_87752 = eta_p_87750 <= zt_res_87751;
                                double zt_res_87753 = zp_res_87448 * eta_p_87750;
                                bool zgze_res_87754 = eta_p_87749 <= zt_res_87753;
                                bool x_87755 = zgze_res_87752 && zgze_res_87754;
                                bool not_res_87756 = !x_87755;
                                bool defunc_0_op_res_87759 = not_res_87756 || redout_89108;
                                bool redout_tmp_91524 = defunc_0_op_res_87759;
                                
                                redout_89108 = redout_tmp_91524;
                            }
                            defunc_0_reduce_comm_res_87748 = redout_89108;
                            loop_cond_46300 = defunc_0_reduce_comm_res_87748;
                        } else {
                            loop_cond_46300 = 0;
                        }
                        if (memblock_set(ctx, &mem_param_tmp_91493, &ext_mem_90535, "ext_mem_90535") != 0)
                            return 1;
                        if (memblock_set(ctx, &mem_param_tmp_91494, &ext_mem_90491, "ext_mem_90491") != 0)
                            return 1;
                        if (memblock_set(ctx, &mem_param_tmp_91495, &ext_mem_90541, "ext_mem_90541") != 0)
                            return 1;
                        if (memblock_set(ctx, &mem_param_tmp_91496, &ext_mem_90488, "ext_mem_90488") != 0)
                            return 1;
                        if (memblock_set(ctx, &mem_param_tmp_91497, &ext_mem_90538, "ext_mem_90538") != 0)
                            return 1;
                        
                        int64_t ctx_param_ext_tmp_91498 = ext_90534;
                        int64_t ctx_param_ext_tmp_91499 = ext_90533;
                        int64_t ctx_param_ext_tmp_91500 = ext_90532;
                        bool loop_while_tmp_91501 = loop_cond_46300;
                        
                        if (memblock_set(ctx, &mem_param_90413, &mem_param_tmp_91493, "mem_param_tmp_91493") != 0)
                            return 1;
                        if (memblock_set(ctx, &mem_param_90416, &mem_param_tmp_91494, "mem_param_tmp_91494") != 0)
                            return 1;
                        if (memblock_set(ctx, &mem_param_90419, &mem_param_tmp_91495, "mem_param_tmp_91495") != 0)
                            return 1;
                        if (memblock_set(ctx, &mem_param_90422, &mem_param_tmp_91496, "mem_param_tmp_91496") != 0)
                            return 1;
                        if (memblock_set(ctx, &mem_param_90425, &mem_param_tmp_91497, "mem_param_tmp_91497") != 0)
                            return 1;
                        ctx_param_ext_90410 = ctx_param_ext_tmp_91498;
                        ctx_param_ext_90411 = ctx_param_ext_tmp_91499;
                        ctx_param_ext_90412 = ctx_param_ext_tmp_91500;
                        loop_while_46230 = loop_while_tmp_91501;
                    }
                    if (memblock_set(ctx, &ext_mem_90557, &mem_param_90413, "mem_param_90413") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90556, &mem_param_90416, "mem_param_90416") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90555, &mem_param_90419, "mem_param_90419") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90554, &mem_param_90422, "mem_param_90422") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90553, &mem_param_90425, "mem_param_90425") != 0)
                        return 1;
                    ext_90552 = ctx_param_ext_90410;
                    ext_90551 = ctx_param_ext_90411;
                    ext_90550 = ctx_param_ext_90412;
                    algo5_core_loop_res_f_res_46224 = loop_while_46230;
                    if (memblock_unref(ctx, &ext_mem_90356, "ext_mem_90356") != 0)
                        return 1;
                    if (memblock_unref(ctx, &ext_mem_90359, "ext_mem_90359") != 0)
                        return 1;
                    if (memblock_unref(ctx, &ext_mem_90403, "ext_mem_90403") != 0)
                        return 1;
                    if (memblock_unref(ctx, &ext_mem_90406, "ext_mem_90406") != 0)
                        return 1;
                    if (memblock_unref(ctx, &ext_mem_90409, "ext_mem_90409") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90573, &ext_mem_90557, "ext_mem_90557") != 0)
                        return 1;
                    ext_90572 = ext_90552;
                    ext_90571 = ext_90551;
                    ext_90570 = ext_90550;
                    if (memblock_set(ctx, &ext_mem_90569, &ext_mem_90556, "ext_mem_90556") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90566, &ext_mem_90555, "ext_mem_90555") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90563, &ext_mem_90554, "ext_mem_90554") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90560, &ext_mem_90553, "ext_mem_90553") != 0)
                        return 1;
                }
                if (memblock_unref(ctx, &ext_mem_90285, "ext_mem_90285") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90286, "ext_mem_90286") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90287, "ext_mem_90287") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90288, "ext_mem_90288") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90289, "ext_mem_90289") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90290, "ext_mem_90290") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90291, "ext_mem_90291") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90292, "ext_mem_90292") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90293, "ext_mem_90293") != 0)
                    return 1;
                if (memblock_alloc(ctx, &mem_90575, bytes_89416, "mem_90575")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_90580, bytes_89416, "mem_90580")) {
                    err = 1;
                    goto cleanup;
                }
                
                double defunc_res_88522;
                double redout_89118 = 0.0;
                
                for (int64_t i_89122 = 0; i_89122 < m_34201; i_89122++) {
                    double eta_p_81257 = ((double *) ext_mem_90566.mem)[i_89122];
                    double eta_p_81258 = ((double *) ext_mem_90560.mem)[i_89122];
                    double eta_p_81260 = ((double *) ext_mem_90569.mem)[i_89122];
                    double eta_p_81261 = ((double *) ext_mem_90563.mem)[i_89122];
                    double log_res_81262 = futrts_log64(eta_p_81260);
                    double zp_res_81263 = eta_p_81261 + log_res_81262;
                    double defunc_res_87773;
                    double redout_89111 = 0.0;
                    
                    for (int64_t i_89113 = 0; i_89113 < m_34201; i_89113++) {
                        double eta_p_81764 = ((double *) ext_mem_90573.mem)[ext_90572 + (i_89122 * ext_90571 + i_89113 * ext_90570)];
                        double eta_p_wasfree_81765 = ((double *) ext_mem_90566.mem)[i_89113];
                        double zt_res_81766 = eta_p_81260 * eta_p_81764;
                        double zt_res_81767 = eta_p_wasfree_81765 * zt_res_81766;
                        double zp_res_81278 = zt_res_81767 + redout_89111;
                        
                        ((double *) mem_90578)[i_89122 * m_34201 + i_89113] = zt_res_81767;
                        
                        double redout_tmp_91529 = zp_res_81278;
                        
                        redout_89111 = redout_tmp_91529;
                    }
                    defunc_res_87773 = redout_89111;
                    
                    double log_res_81269 = futrts_log64(eta_p_81257);
                    double zp_res_81270 = eta_p_81258 + log_res_81269;
                    double zp_res_47649 = defunc_res_87773 + redout_89118;
                    
                    ((double *) mem_90575.mem)[i_89122] = zp_res_81270;
                    ((double *) mem_90580.mem)[i_89122] = zp_res_81263;
                    
                    double redout_tmp_91525 = zp_res_47649;
                    
                    redout_89118 = redout_tmp_91525;
                }
                defunc_res_88522 = redout_89118;
                if (memblock_unref(ctx, &ext_mem_90560, "ext_mem_90560") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90563, "ext_mem_90563") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90566, "ext_mem_90566") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90569, "ext_mem_90569") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90573, "ext_mem_90573") != 0)
                    return 1;
                
                bool zg_res_46348 = 0.0 < defunc_res_88522;
                double zs_res_46349 = defunc_res_88504 / defunc_res_88522;
                double sqrt_res_46350 = futrts_sqrt64(zs_res_46349);
                double descent_res_46355;
                
                if (zg_res_46348) {
                    if (mem_90615_cached_sizze_91824 < bytes_89416) {
                        err = lexical_realloc(ctx, &mem_90615, &mem_90615_cached_sizze_91824, bytes_89416);
                        if (err != FUTHARK_SUCCESS)
                            goto cleanup;
                    }
                    if (mem_90617_cached_sizze_91825 < bytes_89416) {
                        err = lexical_realloc(ctx, &mem_90617, &mem_90617_cached_sizze_91825, bytes_89416);
                        if (err != FUTHARK_SUCCESS)
                            goto cleanup;
                    }
                    if (mem_90619_cached_sizze_91826 < bytes_89416) {
                        err = lexical_realloc(ctx, &mem_90619, &mem_90619_cached_sizze_91826, bytes_89416);
                        if (err != FUTHARK_SUCCESS)
                            goto cleanup;
                    }
                    
                    double defunc_res_87872;
                    double defunc_res_87873;
                    double defunc_res_87874;
                    double redout_89133;
                    double redout_89134;
                    double redout_89135;
                    
                    redout_89133 = 0.0;
                    redout_89134 = 0.0;
                    redout_89135 = 0.0;
                    for (int64_t i_89139 = 0; i_89139 < m_34201; i_89139++) {
                        double x_87878 = ((double *) distrs_mem_89413.mem)[eta_p_45650 * m_34201 + i_89139];
                        double log_res_87880 = futrts_log64(x_87878);
                        double defunc_res_87881;
                        double defunc_res_87882;
                        double defunc_res_87883;
                        double redout_89126;
                        double redout_89127;
                        double redout_89128;
                        
                        redout_89126 = 0.0;
                        redout_89127 = 0.0;
                        redout_89128 = 0.0;
                        for (int64_t i_89129 = 0; i_89129 < m_34201; i_89129++) {
                            double x_87884 = ((double *) mem_param_89893.mem)[i_89129 * m_34201 + i_89139];
                            double zp_res_87887 = x_87884 + redout_89126;
                            double zp_res_87890 = x_87884 + redout_89127;
                            double zp_res_87893 = x_87884 + redout_89128;
                            double redout_tmp_91537 = zp_res_87887;
                            double redout_tmp_91538 = zp_res_87890;
                            double redout_tmp_91539 = zp_res_87893;
                            
                            redout_89126 = redout_tmp_91537;
                            redout_89127 = redout_tmp_91538;
                            redout_89128 = redout_tmp_91539;
                        }
                        defunc_res_87881 = redout_89126;
                        defunc_res_87882 = redout_89127;
                        defunc_res_87883 = redout_89128;
                        
                        bool zeze_res_87897 = defunc_res_87881 == 0.0;
                        double klu_res_87898;
                        
                        if (zeze_res_87897) {
                            klu_res_87898 = 0.0;
                        } else {
                            double zs_res_87899 = defunc_res_87881 / x_87878;
                            double log_res_87900 = futrts_log64(zs_res_87899);
                            double zt_res_87901 = defunc_res_87881 * log_res_87900;
                            
                            klu_res_87898 = zt_res_87901;
                        }
                        
                        double zp_res_87904 = klu_res_87898 + redout_89133;
                        double zp_res_87907 = x_87878 + redout_89134;
                        double zp_res_87910 = defunc_res_87883 + redout_89135;
                        
                        ((double *) mem_90615)[i_89139] = defunc_res_87882;
                        ((double *) mem_90617)[i_89139] = defunc_res_87881;
                        ((double *) mem_90619)[i_89139] = log_res_87880;
                        
                        double redout_tmp_91531 = zp_res_87904;
                        double redout_tmp_91532 = zp_res_87907;
                        double redout_tmp_91533 = zp_res_87910;
                        
                        redout_89133 = redout_tmp_91531;
                        redout_89134 = redout_tmp_91532;
                        redout_89135 = redout_tmp_91533;
                    }
                    defunc_res_87872 = redout_89133;
                    defunc_res_87873 = redout_89134;
                    defunc_res_87874 = redout_89135;
                    
                    double zm_res_87917 = defunc_res_87872 - defunc_res_87874;
                    double zt_res_87918 = 2.0 * zm_res_87917;
                    double zt_res_87919 = 2.0 * defunc_res_87874;
                    
                    if (mem_90640_cached_sizze_91827 < bytes_89434) {
                        err = lexical_realloc(ctx, &mem_90640, &mem_90640_cached_sizze_91827, bytes_89434);
                        if (err != FUTHARK_SUCCESS)
                            goto cleanup;
                    }
                    for (int64_t i_89145 = 0; i_89145 < m_34201; i_89145++) {
                        double eta_p_87921 = ((double *) mem_90617)[i_89145];
                        double eta_p_87922 = ((double *) distrs_mem_89413.mem)[eta_p_45650 * m_34201 + i_89145];
                        double log_res_87923 = futrts_log64(eta_p_87921);
                        double log_res_87924 = futrts_log64(eta_p_87922);
                        double zm_res_87925 = log_res_87923 - log_res_87924;
                        double zp_res_87926 = 1.0 + zm_res_87925;
                        double fma_res_87927 = futrts_fma64(zt_res_87919, zp_res_87926, zt_res_87918);
                        
                        for (int64_t nest_i_91541 = 0; nest_i_91541 < m_34201; nest_i_91541++) {
                            ((double *) mem_90640)[i_89145 * m_34201 + nest_i_91541] = fma_res_87927;
                        }
                    }
                    if (mem_90652_cached_sizze_91828 < bytes_89416) {
                        err = lexical_realloc(ctx, &mem_90652, &mem_90652_cached_sizze_91828, bytes_89416);
                        if (err != FUTHARK_SUCCESS)
                            goto cleanup;
                    }
                    if (mem_90654_cached_sizze_91829 < bytes_89416) {
                        err = lexical_realloc(ctx, &mem_90654, &mem_90654_cached_sizze_91829, bytes_89416);
                        if (err != FUTHARK_SUCCESS)
                            goto cleanup;
                    }
                    
                    double defunc_res_87930;
                    double defunc_res_87931;
                    double defunc_res_87932;
                    double defunc_res_87933;
                    double redout_89155;
                    double redout_89156;
                    double redout_89157;
                    double redout_89158;
                    
                    redout_89155 = 0.0;
                    redout_89156 = 0.0;
                    redout_89157 = 0.0;
                    redout_89158 = 0.0;
                    for (int64_t i_89161 = 0; i_89161 < m_34201; i_89161++) {
                        double eta_p_87937 = ((double *) distrs_mem_89413.mem)[eta_p_45649 * m_34201 + i_89161];
                        double defunc_res_87938;
                        double defunc_res_87939;
                        double defunc_res_87940;
                        double defunc_res_87941;
                        double defunc_res_87942;
                        double redout_89147;
                        double redout_89148;
                        double redout_89149;
                        double redout_89150;
                        double redout_89151;
                        
                        redout_89147 = 0.0;
                        redout_89148 = 0.0;
                        redout_89149 = 0.0;
                        redout_89150 = 0.0;
                        redout_89151 = 0.0;
                        for (int64_t i_89152 = 0; i_89152 < m_34201; i_89152++) {
                            double x_87943 = ((double *) mem_param_89893.mem)[i_89161 * m_34201 + i_89152];
                            double eta_p_87944 = ((double *) distrs_mem_89413.mem)[eta_p_45650 * m_34201 + i_89152];
                            double zt_res_87945 = eta_p_87937 * eta_p_87944;
                            bool zeze_res_87946 = x_87943 == 0.0;
                            double klu_res_87947;
                            
                            if (zeze_res_87946) {
                                klu_res_87947 = 0.0;
                            } else {
                                double zs_res_87948 = x_87943 / zt_res_87945;
                                double log_res_87949 = futrts_log64(zs_res_87948);
                                double zt_res_87950 = x_87943 * log_res_87949;
                                
                                klu_res_87947 = zt_res_87950;
                            }
                            
                            double zp_res_87953 = x_87943 + redout_89147;
                            double zp_res_87956 = klu_res_87947 + redout_89148;
                            double zp_res_87959 = x_87943 + redout_89149;
                            double zp_res_87962 = x_87943 + redout_89150;
                            double zp_res_87965 = x_87943 + redout_89151;
                            double redout_tmp_91548 = zp_res_87953;
                            double redout_tmp_91549 = zp_res_87956;
                            double redout_tmp_91550 = zp_res_87959;
                            double redout_tmp_91551 = zp_res_87962;
                            double redout_tmp_91552 = zp_res_87965;
                            
                            redout_89147 = redout_tmp_91548;
                            redout_89148 = redout_tmp_91549;
                            redout_89149 = redout_tmp_91550;
                            redout_89150 = redout_tmp_91551;
                            redout_89151 = redout_tmp_91552;
                        }
                        defunc_res_87938 = redout_89147;
                        defunc_res_87939 = redout_89148;
                        defunc_res_87940 = redout_89149;
                        defunc_res_87941 = redout_89150;
                        defunc_res_87942 = redout_89151;
                        
                        bool zeze_res_87971 = defunc_res_87942 == 0.0;
                        double klu_res_87972;
                        
                        if (zeze_res_87971) {
                            klu_res_87972 = 0.0;
                        } else {
                            double zs_res_87973 = defunc_res_87942 / eta_p_87937;
                            double log_res_87974 = futrts_log64(zs_res_87973);
                            double zt_res_87975 = defunc_res_87942 * log_res_87974;
                            
                            klu_res_87972 = zt_res_87975;
                        }
                        
                        double zp_res_87978 = defunc_res_87938 + redout_89155;
                        double zp_res_87981 = defunc_res_87939 + redout_89156;
                        double zp_res_87984 = defunc_res_87941 + redout_89157;
                        double zp_res_87987 = klu_res_87972 + redout_89158;
                        
                        ((double *) mem_90652)[i_89161] = defunc_res_87942;
                        ((double *) mem_90654)[i_89161] = defunc_res_87940;
                        
                        double redout_tmp_91542 = zp_res_87978;
                        double redout_tmp_91543 = zp_res_87981;
                        double redout_tmp_91544 = zp_res_87984;
                        double redout_tmp_91545 = zp_res_87987;
                        
                        redout_89155 = redout_tmp_91542;
                        redout_89156 = redout_tmp_91543;
                        redout_89157 = redout_tmp_91544;
                        redout_89158 = redout_tmp_91545;
                    }
                    defunc_res_87930 = redout_89155;
                    defunc_res_87931 = redout_89156;
                    defunc_res_87932 = redout_89157;
                    defunc_res_87933 = redout_89158;
                    
                    double zm_res_87994 = defunc_res_87933 - defunc_res_87932;
                    double zt_res_87995 = 2.0 * zm_res_87994;
                    double zt_res_87996 = 2.0 * defunc_res_87932;
                    
                    if (mem_90668_cached_sizze_91830 < bytes_89416) {
                        err = lexical_realloc(ctx, &mem_90668, &mem_90668_cached_sizze_91830, bytes_89416);
                        if (err != FUTHARK_SUCCESS)
                            goto cleanup;
                    }
                    for (int64_t i_89168 = 0; i_89168 < m_34201; i_89168++) {
                        double defunc_0_reduce_res_87999;
                        double redout_89164 = 0.0;
                        
                        for (int64_t i_89165 = 0; i_89165 < m_34201; i_89165++) {
                            double eta_p_88000 = ((double *) A_mem_89412.mem)[eta_p_45650 * (m_34201 * m_34201) + i_89168 * m_34201 + i_89165];
                            double eta_p_88001 = ((double *) mem_90615)[i_89165];
                            double zt_res_88002 = eta_p_88000 * eta_p_88000;
                            double zt_res_88003 = eta_p_88001 * zt_res_88002;
                            double zp_res_88006 = zt_res_88003 + redout_89164;
                            double redout_tmp_91554 = zp_res_88006;
                            
                            redout_89164 = redout_tmp_91554;
                        }
                        defunc_0_reduce_res_87999 = redout_89164;
                        ((double *) mem_90668)[i_89168] = defunc_0_reduce_res_87999;
                    }
                    
                    double zt_res_88009 = 2.0 * defunc_res_87930;
                    double zt_res_88010 = 2.0 * defunc_res_87931;
                    
                    if (mem_90676_cached_sizze_91831 < bytes_89416) {
                        err = lexical_realloc(ctx, &mem_90676, &mem_90676_cached_sizze_91831, bytes_89416);
                        if (err != FUTHARK_SUCCESS)
                            goto cleanup;
                    }
                    if (mem_90679_cached_sizze_91832 < bytes_89434) {
                        err = lexical_realloc(ctx, &mem_90679, &mem_90679_cached_sizze_91832, bytes_89434);
                        if (err != FUTHARK_SUCCESS)
                            goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_90682, bytes_89434, "mem_90682")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (mem_90695_cached_sizze_91833 < bytes_89416) {
                        err = lexical_realloc(ctx, &mem_90695, &mem_90695_cached_sizze_91833, bytes_89416);
                        if (err != FUTHARK_SUCCESS)
                            goto cleanup;
                    }
                    
                    double defunc_res_88014;
                    double defunc_res_88015;
                    double defunc_res_88016;
                    double defunc_res_88017;
                    double defunc_res_88018;
                    double redout_89194;
                    double redout_89195;
                    double redout_89196;
                    double redout_89197;
                    double redout_89198;
                    
                    redout_89194 = 0.0;
                    redout_89195 = 0.0;
                    redout_89196 = 0.0;
                    redout_89197 = 0.0;
                    redout_89198 = 0.0;
                    for (int64_t i_89202 = 0; i_89202 < m_34201; i_89202++) {
                        double x_88022 = ((double *) distrs_mem_89413.mem)[eta_p_45649 * m_34201 + i_89202];
                        double eta_p_88026 = ((double *) mem_90652)[i_89202];
                        double log_res_88030 = futrts_log64(x_88022);
                        double log_res_88031 = futrts_log64(eta_p_88026);
                        double zm_res_88032 = log_res_88031 - log_res_88030;
                        double zp_res_88033 = 1.0 + zm_res_88032;
                        double fma_res_88034 = futrts_fma64(zt_res_87996, zp_res_88033, zt_res_87995);
                        
                        for (int64_t i_89174 = 0; i_89174 < m_34201; i_89174++) {
                            double defunc_0_reduce_res_88037;
                            double redout_89170 = 0.0;
                            
                            for (int64_t i_89171 = 0; i_89171 < m_34201; i_89171++) {
                                double eta_p_88038 = ((double *) A_mem_89412.mem)[eta_p_45649 * (m_34201 * m_34201) + i_89202 * m_34201 + i_89171];
                                double eta_p_88039 = ((double *) mem_param_89893.mem)[i_89171 * m_34201 + i_89174];
                                double zt_res_88040 = eta_p_88038 * eta_p_88039;
                                double zp_res_88043 = zt_res_88040 + redout_89170;
                                double redout_tmp_91564 = zp_res_88043;
                                
                                redout_89170 = redout_tmp_91564;
                            }
                            defunc_0_reduce_res_88037 = redout_89170;
                            ((double *) mem_90695)[i_89174] = defunc_0_reduce_res_88037;
                        }
                        
                        double defunc_0_reduce_res_88046;
                        double redout_89176 = 0.0;
                        
                        for (int64_t i_89177 = 0; i_89177 < m_34201; i_89177++) {
                            double eta_p_88047 = ((double *) A_mem_89412.mem)[eta_p_45649 * (m_34201 * m_34201) + i_89202 * m_34201 + i_89177];
                            double eta_p_88048 = ((double *) mem_90654)[i_89177];
                            double zt_res_88049 = eta_p_88047 * eta_p_88047;
                            double zt_res_88050 = eta_p_88048 * zt_res_88049;
                            double zp_res_88053 = zt_res_88050 + redout_89176;
                            double redout_tmp_91565 = zp_res_88053;
                            
                            redout_89176 = redout_tmp_91565;
                        }
                        defunc_0_reduce_res_88046 = redout_89176;
                        
                        double defunc_0_reduce_res_88056;
                        double defunc_res_88057;
                        double defunc_res_88058;
                        double defunc_res_88059;
                        double redout_89182;
                        double redout_89183;
                        double redout_89184;
                        double redout_89185;
                        
                        redout_89182 = 0.0;
                        redout_89183 = 0.0;
                        redout_89184 = 0.0;
                        redout_89185 = 0.0;
                        for (int64_t i_89188 = 0; i_89188 < m_34201; i_89188++) {
                            double eta_p_88062 = ((double *) mem_90578)[i_89202 * m_34201 + i_89188];
                            double eta_p_88063 = ((double *) mem_param_89893.mem)[i_89202 * m_34201 + i_89188];
                            double eta_p_88064 = ((double *) distrs_mem_89413.mem)[eta_p_45650 * m_34201 + i_89188];
                            double eta_p_wasfree_88065 = ((double *) mem_90619)[i_89188];
                            double eta_p_wasfree_88067 = ((double *) mem_90668)[i_89188];
                            double eta_p_88068 = ((double *) mem_90640)[i_89188 * m_34201 + i_89202];
                            double zt_res_88069 = sqrt_res_46350 * eta_p_88062;
                            double zm_res_88070 = zt_res_88069 - eta_p_88063;
                            double log_res_88071 = futrts_log64(eta_p_88063);
                            double zm_res_88072 = log_res_88071 - eta_p_wasfree_88065;
                            double zm_res_88073 = zm_res_88072 - log_res_88030;
                            double fma_res_88074 = futrts_fma64(zt_res_88009, zm_res_88073, zt_res_88010);
                            double defunc_0_reduce_res_88075;
                            double redout_89178 = 0.0;
                            
                            for (int64_t i_89179 = 0; i_89179 < m_34201; i_89179++) {
                                double eta_p_88076 = ((double *) mem_90695)[i_89179];
                                double eta_p_88077 = ((double *) A_mem_89412.mem)[eta_p_45650 * (m_34201 * m_34201) + i_89179 * m_34201 + i_89188];
                                double zt_res_88078 = eta_p_88076 * eta_p_88077;
                                double zp_res_88081 = zt_res_88078 + redout_89178;
                                double redout_tmp_91572 = zp_res_88081;
                                
                                redout_89178 = redout_tmp_91572;
                            }
                            defunc_0_reduce_res_88075 = redout_89178;
                            
                            double zt_res_88083 = -2.0 * defunc_0_reduce_res_88075;
                            double zp_res_88084 = defunc_0_reduce_res_88046 + zt_res_88083;
                            double zp_res_88085 = eta_p_wasfree_88067 + zp_res_88084;
                            double zt_res_88086 = 2.0 * zp_res_88085;
                            double fma_res_88087 = futrts_fma64(fma_res_88034, rho1_34204, zt_res_88086);
                            double fma_res_88088 = futrts_fma64(eta_p_88068, rho2_34205, fma_res_88087);
                            double fma_res_88089 = futrts_fma64(fma_res_88074, zt_res_45683, fma_res_88088);
                            double max_res_88090 = fmax64(-1.0e100, fma_res_88089);
                            double zt_res_88091 = zm_res_88070 * max_res_88090;
                            double zp_res_88092 = eta_p_88063 + zm_res_88070;
                            double zt_res_88093 = x_88022 * eta_p_88064;
                            bool zeze_res_88094 = zp_res_88092 == 0.0;
                            double klu_res_88095;
                            
                            if (zeze_res_88094) {
                                klu_res_88095 = 0.0;
                            } else {
                                double zs_res_88096 = zp_res_88092 / zt_res_88093;
                                double log_res_88097 = futrts_log64(zs_res_88096);
                                double zt_res_88098 = zp_res_88092 * log_res_88097;
                                
                                klu_res_88095 = zt_res_88098;
                            }
                            
                            double zp_res_88101 = zt_res_88091 + redout_89182;
                            double zp_res_88104 = klu_res_88095 + redout_89183;
                            double zp_res_88107 = zp_res_88092 + redout_89184;
                            double zp_res_88110 = zp_res_88092 + redout_89185;
                            
                            ((double *) mem_90679)[i_89202 * m_34201 + i_89188] = zp_res_88092;
                            ((double *) mem_90682.mem)[i_89202 * m_34201 + i_89188] = zm_res_88070;
                            
                            double redout_tmp_91566 = zp_res_88101;
                            double redout_tmp_91567 = zp_res_88104;
                            double redout_tmp_91568 = zp_res_88107;
                            double redout_tmp_91569 = zp_res_88110;
                            
                            redout_89182 = redout_tmp_91566;
                            redout_89183 = redout_tmp_91567;
                            redout_89184 = redout_tmp_91568;
                            redout_89185 = redout_tmp_91569;
                        }
                        defunc_0_reduce_res_88056 = redout_89182;
                        defunc_res_88057 = redout_89183;
                        defunc_res_88058 = redout_89184;
                        defunc_res_88059 = redout_89185;
                        
                        bool zeze_res_88117 = defunc_res_88059 == 0.0;
                        double klu_res_88118;
                        
                        if (zeze_res_88117) {
                            klu_res_88118 = 0.0;
                        } else {
                            double zs_res_88119 = defunc_res_88059 / x_88022;
                            double log_res_88120 = futrts_log64(zs_res_88119);
                            double zt_res_88121 = defunc_res_88059 * log_res_88120;
                            
                            klu_res_88118 = zt_res_88121;
                        }
                        
                        double zp_res_88124 = defunc_0_reduce_res_88056 + redout_89194;
                        double zp_res_88127 = klu_res_88118 + redout_89195;
                        double zp_res_88130 = defunc_res_88059 + redout_89196;
                        double zp_res_88133 = defunc_res_88057 + redout_89197;
                        double zp_res_88136 = x_88022 + redout_89198;
                        
                        ((double *) mem_90676)[i_89202] = defunc_res_88058;
                        
                        double redout_tmp_91555 = zp_res_88124;
                        double redout_tmp_91556 = zp_res_88127;
                        double redout_tmp_91557 = zp_res_88130;
                        double redout_tmp_91558 = zp_res_88133;
                        double redout_tmp_91559 = zp_res_88136;
                        
                        redout_89194 = redout_tmp_91555;
                        redout_89195 = redout_tmp_91556;
                        redout_89196 = redout_tmp_91557;
                        redout_89197 = redout_tmp_91558;
                        redout_89198 = redout_tmp_91559;
                    }
                    defunc_res_88014 = redout_89194;
                    defunc_res_88015 = redout_89195;
                    defunc_res_88016 = redout_89196;
                    defunc_res_88017 = redout_89197;
                    defunc_res_88018 = redout_89198;
                    
                    bool zl_res_88145 = defunc_res_88014 < 0.0;
                    bool assert_c_88146;
                    
                    if (!zl_res_88145) {
                        set_error(ctx, msgprintf("Error: %s\n\nBacktrace:\n%s", "Assertion is false: M.((gradient) M.< zero)", "-> #0  common.fut:220:7-221:22\n   #1  unbalanced_gw_core.fut:388:48-393:78\n   #2  unbalanced_gw_core.fut:402:7-11\n   #3  unbalanced_gw.fut:180:15-184:28\n   #4  /prelude/functional.fut:9:44-45\n   #5  unbalanced_gw.fut:172:6-187:11\n   #6  unbalanced_gw.fut:167:1-187:35\n"));
                        err = FUTHARK_PROGRAM_ERROR;
                        goto cleanup;
                    }
                    if (mem_90730_cached_sizze_91834 < bytes_89416) {
                        err = lexical_realloc(ctx, &mem_90730, &mem_90730_cached_sizze_91834, bytes_89416);
                        if (err != FUTHARK_SUCCESS)
                            goto cleanup;
                    }
                    
                    double defunc_res_88148;
                    double redout_89210 = 0.0;
                    
                    for (int64_t i_89212 = 0; i_89212 < m_34201; i_89212++) {
                        double eta_p_88151 = ((double *) distrs_mem_89413.mem)[eta_p_45650 * m_34201 + i_89212];
                        double defunc_res_88152;
                        double defunc_res_88153;
                        double redout_89206;
                        double redout_89207;
                        
                        redout_89206 = 0.0;
                        redout_89207 = 0.0;
                        for (int64_t i_89208 = 0; i_89208 < m_34201; i_89208++) {
                            double x_88154 = ((double *) mem_90679)[i_89208 * m_34201 + i_89212];
                            double zp_res_88157 = x_88154 + redout_89206;
                            double zp_res_88160 = x_88154 + redout_89207;
                            double redout_tmp_91575 = zp_res_88157;
                            double redout_tmp_91576 = zp_res_88160;
                            
                            redout_89206 = redout_tmp_91575;
                            redout_89207 = redout_tmp_91576;
                        }
                        defunc_res_88152 = redout_89206;
                        defunc_res_88153 = redout_89207;
                        
                        bool zeze_res_88163 = defunc_res_88153 == 0.0;
                        double klu_res_88164;
                        
                        if (zeze_res_88163) {
                            klu_res_88164 = 0.0;
                        } else {
                            double zs_res_88165 = defunc_res_88153 / eta_p_88151;
                            double log_res_88166 = futrts_log64(zs_res_88165);
                            double zt_res_88167 = defunc_res_88153 * log_res_88166;
                            
                            klu_res_88164 = zt_res_88167;
                        }
                        
                        double zp_res_88170 = klu_res_88164 + redout_89210;
                        
                        ((double *) mem_90730)[i_89212] = defunc_res_88152;
                        
                        double redout_tmp_91573 = zp_res_88170;
                        
                        redout_89210 = redout_tmp_91573;
                    }
                    defunc_res_88148 = redout_89210;
                    if (mem_90738_cached_sizze_91835 < bytes_89416) {
                        err = lexical_realloc(ctx, &mem_90738, &mem_90738_cached_sizze_91835, bytes_89416);
                        if (err != FUTHARK_SUCCESS)
                            goto cleanup;
                    }
                    
                    double defunc_0_reduce_res_88173;
                    double defunc_res_88174;
                    double redout_89226;
                    double redout_89227;
                    
                    redout_89226 = 0.0;
                    redout_89227 = 0.0;
                    for (int64_t i_89228 = 0; i_89228 < m_34201; i_89228++) {
                        double eta_p_88177 = ((double *) mem_90676)[i_89228];
                        double defunc_0_reduce_res_88178;
                        double redout_89214 = 0.0;
                        
                        for (int64_t i_89215 = 0; i_89215 < m_34201; i_89215++) {
                            double eta_p_88179 = ((double *) A_mem_89412.mem)[eta_p_45649 * (m_34201 * m_34201) + i_89228 * m_34201 + i_89215];
                            double eta_p_88180 = ((double *) mem_90676)[i_89215];
                            double zt_res_88181 = eta_p_88179 * eta_p_88179;
                            double zt_res_88182 = eta_p_88180 * zt_res_88181;
                            double zp_res_88185 = zt_res_88182 + redout_89214;
                            double redout_tmp_91579 = zp_res_88185;
                            
                            redout_89214 = redout_tmp_91579;
                        }
                        defunc_0_reduce_res_88178 = redout_89214;
                        
                        double zt_res_88187 = eta_p_88177 * defunc_0_reduce_res_88178;
                        
                        for (int64_t i_89220 = 0; i_89220 < m_34201; i_89220++) {
                            double defunc_0_reduce_res_88190;
                            double redout_89216 = 0.0;
                            
                            for (int64_t i_89217 = 0; i_89217 < m_34201; i_89217++) {
                                double eta_p_88191 = ((double *) A_mem_89412.mem)[eta_p_45649 * (m_34201 * m_34201) + i_89228 * m_34201 + i_89217];
                                double eta_p_88192 = ((double *) mem_90679)[i_89217 * m_34201 + i_89220];
                                double zt_res_88193 = eta_p_88191 * eta_p_88192;
                                double zp_res_88196 = zt_res_88193 + redout_89216;
                                double redout_tmp_91581 = zp_res_88196;
                                
                                redout_89216 = redout_tmp_91581;
                            }
                            defunc_0_reduce_res_88190 = redout_89216;
                            ((double *) mem_90738)[i_89220] = defunc_0_reduce_res_88190;
                        }
                        
                        double defunc_0_reduce_res_88199;
                        double redout_89224 = 0.0;
                        
                        for (int64_t i_89225 = 0; i_89225 < m_34201; i_89225++) {
                            double eta_p_88201 = ((double *) mem_90679)[i_89228 * m_34201 + i_89225];
                            double defunc_0_reduce_res_88202;
                            double redout_89222 = 0.0;
                            
                            for (int64_t i_89223 = 0; i_89223 < m_34201; i_89223++) {
                                double eta_p_88203 = ((double *) mem_90738)[i_89223];
                                double eta_p_88204 = ((double *) A_mem_89412.mem)[eta_p_45650 * (m_34201 * m_34201) + i_89223 * m_34201 + i_89225];
                                double zt_res_88205 = eta_p_88203 * eta_p_88204;
                                double zp_res_88208 = zt_res_88205 + redout_89222;
                                double redout_tmp_91583 = zp_res_88208;
                                
                                redout_89222 = redout_tmp_91583;
                            }
                            defunc_0_reduce_res_88202 = redout_89222;
                            
                            double zt_res_88210 = eta_p_88201 * defunc_0_reduce_res_88202;
                            double zp_res_88213 = zt_res_88210 + redout_89224;
                            double redout_tmp_91582 = zp_res_88213;
                            
                            redout_89224 = redout_tmp_91582;
                        }
                        defunc_0_reduce_res_88199 = redout_89224;
                        
                        double zp_res_88217 = zt_res_88187 + redout_89226;
                        double zp_res_88220 = defunc_0_reduce_res_88199 + redout_89227;
                        double redout_tmp_91577 = zp_res_88217;
                        double redout_tmp_91578 = zp_res_88220;
                        
                        redout_89226 = redout_tmp_91577;
                        redout_89227 = redout_tmp_91578;
                    }
                    defunc_0_reduce_res_88173 = redout_89226;
                    defunc_res_88174 = redout_89227;
                    
                    double defunc_0_reduce_res_88223;
                    double redout_89231 = 0.0;
                    
                    for (int64_t i_89232 = 0; i_89232 < m_34201; i_89232++) {
                        double eta_p_88225 = ((double *) mem_90730)[i_89232];
                        double defunc_0_reduce_res_88226;
                        double redout_89229 = 0.0;
                        
                        for (int64_t i_89230 = 0; i_89230 < m_34201; i_89230++) {
                            double eta_p_88227 = ((double *) A_mem_89412.mem)[eta_p_45650 * (m_34201 * m_34201) + i_89232 * m_34201 + i_89230];
                            double eta_p_88228 = ((double *) mem_90730)[i_89230];
                            double zt_res_88229 = eta_p_88227 * eta_p_88227;
                            double zt_res_88230 = eta_p_88228 * zt_res_88229;
                            double zp_res_88233 = zt_res_88230 + redout_89229;
                            double redout_tmp_91585 = zp_res_88233;
                            
                            redout_89229 = redout_tmp_91585;
                        }
                        defunc_0_reduce_res_88226 = redout_89229;
                        
                        double zt_res_88235 = eta_p_88225 * defunc_0_reduce_res_88226;
                        double zp_res_88238 = zt_res_88235 + redout_89231;
                        double redout_tmp_91584 = zp_res_88238;
                        
                        redout_89231 = redout_tmp_91584;
                    }
                    defunc_0_reduce_res_88223 = redout_89231;
                    
                    double zt_res_88240 = -2.0 * defunc_res_88174;
                    double zp_res_88241 = defunc_0_reduce_res_88173 + zt_res_88240;
                    double zp_res_88242 = defunc_0_reduce_res_88223 + zp_res_88241;
                    double zt_res_88243 = zt_res_45683 * defunc_res_88017;
                    double zt_res_88244 = rho1_34204 * defunc_res_88015;
                    double zt_res_88245 = rho2_34205 * defunc_res_88148;
                    double zp_res_88246 = zt_res_88243 + zt_res_88244;
                    double zp_res_88247 = zt_res_88245 + zp_res_88246;
                    double zt_res_88248 = 2.0 * zp_res_88247;
                    double zt_res_88249 = defunc_res_88016 * zt_res_88248;
                    double zp_res_88250 = zp_res_88242 + zt_res_88249;
                    double zt_res_88251 = defunc_res_88016 * defunc_res_88016;
                    double zt_res_88252 = zp_res_48637 * zt_res_88251;
                    double zm_res_88253 = zp_res_88250 - zt_res_88252;
                    double zt_res_88254 = defunc_res_87873 * defunc_res_88018;
                    double zt_res_88255 = rho1_34204 * defunc_res_88018;
                    double zt_res_88256 = defunc_res_88018 * zt_res_88255;
                    double zt_res_88257 = rho2_34205 * defunc_res_87873;
                    double zt_res_88258 = defunc_res_87873 * zt_res_88257;
                    double zp_res_88259 = zt_res_88256 + zt_res_88258;
                    double zt_res_88260 = zt_res_45683 * zt_res_88254;
                    double zt_res_88261 = zt_res_88254 * zt_res_88260;
                    double zp_res_88262 = zp_res_88259 + zt_res_88261;
                    double zp_res_88263 = zm_res_88253 + zp_res_88262;
                    double zm_res_88264 = zp_res_88263 - loss_45903;
                    bool zgze_res_88265 = -1.0 <= zm_res_88264;
                    double zs_res_88266 = zm_res_88264 / defunc_res_88014;
                    bool zlze_res_88267 = zs_res_88266 <= 0.5;
                    bool x_88268 = zgze_res_88265 && zlze_res_88267;
                    double defunc_res_88269;
                    
                    if (x_88268) {
                        double x_88270;
                        double redout_89233 = 0.0;
                        
                        for (int64_t i_89234 = 0; i_89234 < m_34201; i_89234++) {
                            double x_88271 = ((double *) distrs_mem_89413.mem)[eta_p_45649 * m_34201 + i_89234];
                            double zp_res_88274 = x_88271 + redout_89233;
                            double redout_tmp_91586 = zp_res_88274;
                            
                            redout_89233 = redout_tmp_91586;
                        }
                        x_88270 = redout_89233;
                        defunc_res_88269 = x_88270;
                    } else {
                        defunc_res_88269 = 0.0;
                    }
                    
                    double defunc_res_88276;
                    
                    if (x_88268) {
                        double x_88277;
                        double redout_89235 = 0.0;
                        
                        for (int64_t i_89236 = 0; i_89236 < m_34201; i_89236++) {
                            double x_88278 = ((double *) distrs_mem_89413.mem)[eta_p_45650 * m_34201 + i_89236];
                            double zp_res_88281 = x_88278 + redout_89235;
                            double redout_tmp_91587 = zp_res_88281;
                            
                            redout_89235 = redout_tmp_91587;
                        }
                        x_88277 = redout_89235;
                        defunc_res_88276 = x_88277;
                    } else {
                        defunc_res_88276 = 0.0;
                    }
                    
                    double zt_res_88283 = defunc_res_88269 * defunc_res_88276;
                    double zt_res_88284 = rho1_34204 * defunc_res_88269;
                    double zt_res_88285 = defunc_res_88269 * zt_res_88284;
                    double zt_res_88286 = rho2_34205 * defunc_res_88276;
                    double zt_res_88287 = defunc_res_88276 * zt_res_88286;
                    double zp_res_88288 = zt_res_88285 + zt_res_88287;
                    double zt_res_88289 = zt_res_45683 * zt_res_88283;
                    double zt_res_88290 = zt_res_88283 * zt_res_88289;
                    double zp_res_88291 = zp_res_88288 + zt_res_88290;
                    
                    if (mem_90750_cached_sizze_91836 < bytes_89416) {
                        err = lexical_realloc(ctx, &mem_90750, &mem_90750_cached_sizze_91836, bytes_89416);
                        if (err != FUTHARK_SUCCESS)
                            goto cleanup;
                    }
                    if (mem_90753_cached_sizze_91837 < bytes_89434) {
                        err = lexical_realloc(ctx, &mem_90753, &mem_90753_cached_sizze_91837, bytes_89434);
                        if (err != FUTHARK_SUCCESS)
                            goto cleanup;
                    }
                    if (mem_90796_cached_sizze_91838 < bytes_89416) {
                        err = lexical_realloc(ctx, &mem_90796, &mem_90796_cached_sizze_91838, bytes_89416);
                        if (err != FUTHARK_SUCCESS)
                            goto cleanup;
                    }
                    if (mem_90804_cached_sizze_91839 < bytes_89416) {
                        err = lexical_realloc(ctx, &mem_90804, &mem_90804_cached_sizze_91839, bytes_89416);
                        if (err != FUTHARK_SUCCESS)
                            goto cleanup;
                    }
                    
                    bool defunc_0_armijo_line_search_res_88292;
                    double defunc_0_armijo_line_search_res_88294;
                    double defunc_0_armijo_line_search_res_88295;
                    bool loop_while_88296;
                    double current_loss_88298;
                    double alpha_88299;
                    
                    if (memblock_set(ctx, &mem_param_90748, &mem_90682, "mem_90682") != 0)
                        return 1;
                    loop_while_88296 = x_88268;
                    current_loss_88298 = zp_res_88263;
                    alpha_88299 = 1.0;
                    while (loop_while_88296) {
                        double zt_res_88300 = 0.5 * alpha_88299;
                        
                        if (memblock_alloc(ctx, &mem_90756, bytes_89434, "mem_90756")) {
                            err = 1;
                            goto cleanup;
                        }
                        
                        double defunc_res_88301;
                        double defunc_res_88302;
                        double defunc_res_88303;
                        double redout_89250;
                        double redout_89251;
                        double redout_89252;
                        
                        redout_89250 = 0.0;
                        redout_89251 = 0.0;
                        redout_89252 = 0.0;
                        for (int64_t i_89256 = 0; i_89256 < m_34201; i_89256++) {
                            double eta_p_88308 = ((double *) distrs_mem_89413.mem)[eta_p_45649 * m_34201 + i_89256];
                            double defunc_res_88310;
                            double defunc_res_88311;
                            double defunc_res_88312;
                            double redout_89239;
                            double redout_89240;
                            double redout_89241;
                            
                            redout_89239 = 0.0;
                            redout_89240 = 0.0;
                            redout_89241 = 0.0;
                            for (int64_t i_89244 = 0; i_89244 < m_34201; i_89244++) {
                                double eta_p_88315 = ((double *) mem_param_90748.mem)[i_89256 * m_34201 + i_89244];
                                double eta_p_88316 = ((double *) mem_param_89893.mem)[i_89256 * m_34201 + i_89244];
                                double eta_p_88317 = ((double *) distrs_mem_89413.mem)[eta_p_45650 * m_34201 + i_89244];
                                double zt_res_88318 = 0.5 * eta_p_88315;
                                double zp_res_88319 = eta_p_88316 + zt_res_88318;
                                double zt_res_88320 = eta_p_88308 * eta_p_88317;
                                bool zeze_res_88321 = zp_res_88319 == 0.0;
                                double klu_res_88322;
                                
                                if (zeze_res_88321) {
                                    klu_res_88322 = 0.0;
                                } else {
                                    double zs_res_88323 = zp_res_88319 / zt_res_88320;
                                    double log_res_88324 = futrts_log64(zs_res_88323);
                                    double zt_res_88325 = zp_res_88319 * log_res_88324;
                                    
                                    klu_res_88322 = zt_res_88325;
                                }
                                
                                double zp_res_88328 = klu_res_88322 + redout_89239;
                                double zp_res_88331 = zp_res_88319 + redout_89240;
                                double zp_res_88334 = zp_res_88319 + redout_89241;
                                
                                ((double *) mem_90753)[i_89256 * m_34201 + i_89244] = zp_res_88319;
                                ((double *) mem_90756.mem)[i_89256 * m_34201 + i_89244] = zt_res_88318;
                                
                                double redout_tmp_91599 = zp_res_88328;
                                double redout_tmp_91600 = zp_res_88331;
                                double redout_tmp_91601 = zp_res_88334;
                                
                                redout_89239 = redout_tmp_91599;
                                redout_89240 = redout_tmp_91600;
                                redout_89241 = redout_tmp_91601;
                            }
                            defunc_res_88310 = redout_89239;
                            defunc_res_88311 = redout_89240;
                            defunc_res_88312 = redout_89241;
                            
                            bool zeze_res_88340 = defunc_res_88312 == 0.0;
                            double klu_res_88341;
                            
                            if (zeze_res_88340) {
                                klu_res_88341 = 0.0;
                            } else {
                                double zs_res_88342 = defunc_res_88312 / eta_p_88308;
                                double log_res_88343 = futrts_log64(zs_res_88342);
                                double zt_res_88344 = defunc_res_88312 * log_res_88343;
                                
                                klu_res_88341 = zt_res_88344;
                            }
                            
                            double zp_res_88347 = klu_res_88341 + redout_89250;
                            double zp_res_88350 = defunc_res_88312 + redout_89251;
                            double zp_res_88353 = defunc_res_88310 + redout_89252;
                            
                            ((double *) mem_90750)[i_89256] = defunc_res_88311;
                            
                            double redout_tmp_91593 = zp_res_88347;
                            double redout_tmp_91594 = zp_res_88350;
                            double redout_tmp_91595 = zp_res_88353;
                            
                            redout_89250 = redout_tmp_91593;
                            redout_89251 = redout_tmp_91594;
                            redout_89252 = redout_tmp_91595;
                        }
                        defunc_res_88301 = redout_89250;
                        defunc_res_88302 = redout_89251;
                        defunc_res_88303 = redout_89252;
                        
                        double defunc_res_88361;
                        double redout_89264 = 0.0;
                        
                        for (int64_t i_89266 = 0; i_89266 < m_34201; i_89266++) {
                            double eta_p_88364 = ((double *) distrs_mem_89413.mem)[eta_p_45650 * m_34201 + i_89266];
                            double defunc_res_88365;
                            double defunc_res_88366;
                            double redout_89260;
                            double redout_89261;
                            
                            redout_89260 = 0.0;
                            redout_89261 = 0.0;
                            for (int64_t i_89262 = 0; i_89262 < m_34201; i_89262++) {
                                double x_88367 = ((double *) mem_90753)[i_89262 * m_34201 + i_89266];
                                double zp_res_88370 = x_88367 + redout_89260;
                                double zp_res_88373 = x_88367 + redout_89261;
                                double redout_tmp_91606 = zp_res_88370;
                                double redout_tmp_91607 = zp_res_88373;
                                
                                redout_89260 = redout_tmp_91606;
                                redout_89261 = redout_tmp_91607;
                            }
                            defunc_res_88365 = redout_89260;
                            defunc_res_88366 = redout_89261;
                            
                            bool zeze_res_88376 = defunc_res_88366 == 0.0;
                            double klu_res_88377;
                            
                            if (zeze_res_88376) {
                                klu_res_88377 = 0.0;
                            } else {
                                double zs_res_88378 = defunc_res_88366 / eta_p_88364;
                                double log_res_88379 = futrts_log64(zs_res_88378);
                                double zt_res_88380 = defunc_res_88366 * log_res_88379;
                                
                                klu_res_88377 = zt_res_88380;
                            }
                            
                            double zp_res_88383 = klu_res_88377 + redout_89264;
                            
                            ((double *) mem_90796)[i_89266] = defunc_res_88365;
                            
                            double redout_tmp_91604 = zp_res_88383;
                            
                            redout_89264 = redout_tmp_91604;
                        }
                        defunc_res_88361 = redout_89264;
                        
                        double defunc_0_reduce_res_88386;
                        double defunc_res_88387;
                        double redout_89280;
                        double redout_89281;
                        
                        redout_89280 = 0.0;
                        redout_89281 = 0.0;
                        for (int64_t i_89282 = 0; i_89282 < m_34201; i_89282++) {
                            double eta_p_88390 = ((double *) mem_90750)[i_89282];
                            double defunc_0_reduce_res_88391;
                            double redout_89268 = 0.0;
                            
                            for (int64_t i_89269 = 0; i_89269 < m_34201; i_89269++) {
                                double eta_p_88392 = ((double *) A_mem_89412.mem)[eta_p_45649 * (m_34201 * m_34201) + i_89282 * m_34201 + i_89269];
                                double eta_p_88393 = ((double *) mem_90750)[i_89269];
                                double zt_res_88394 = eta_p_88392 * eta_p_88392;
                                double zt_res_88395 = eta_p_88393 * zt_res_88394;
                                double zp_res_88398 = zt_res_88395 + redout_89268;
                                double redout_tmp_91610 = zp_res_88398;
                                
                                redout_89268 = redout_tmp_91610;
                            }
                            defunc_0_reduce_res_88391 = redout_89268;
                            
                            double zt_res_88400 = eta_p_88390 * defunc_0_reduce_res_88391;
                            
                            for (int64_t i_89274 = 0; i_89274 < m_34201; i_89274++) {
                                double defunc_0_reduce_res_88403;
                                double redout_89270 = 0.0;
                                
                                for (int64_t i_89271 = 0; i_89271 < m_34201; i_89271++) {
                                    double eta_p_88404 = ((double *) A_mem_89412.mem)[eta_p_45649 * (m_34201 * m_34201) + i_89282 * m_34201 + i_89271];
                                    double eta_p_88405 = ((double *) mem_90753)[i_89271 * m_34201 + i_89274];
                                    double zt_res_88406 = eta_p_88404 * eta_p_88405;
                                    double zp_res_88409 = zt_res_88406 + redout_89270;
                                    double redout_tmp_91612 = zp_res_88409;
                                    
                                    redout_89270 = redout_tmp_91612;
                                }
                                defunc_0_reduce_res_88403 = redout_89270;
                                ((double *) mem_90804)[i_89274] = defunc_0_reduce_res_88403;
                            }
                            
                            double defunc_0_reduce_res_88412;
                            double redout_89278 = 0.0;
                            
                            for (int64_t i_89279 = 0; i_89279 < m_34201; i_89279++) {
                                double eta_p_88414 = ((double *) mem_90753)[i_89282 * m_34201 + i_89279];
                                double defunc_0_reduce_res_88415;
                                double redout_89276 = 0.0;
                                
                                for (int64_t i_89277 = 0; i_89277 < m_34201; i_89277++) {
                                    double eta_p_88416 = ((double *) mem_90804)[i_89277];
                                    double eta_p_88417 = ((double *) A_mem_89412.mem)[eta_p_45650 * (m_34201 * m_34201) + i_89277 * m_34201 + i_89279];
                                    double zt_res_88418 = eta_p_88416 * eta_p_88417;
                                    double zp_res_88421 = zt_res_88418 + redout_89276;
                                    double redout_tmp_91614 = zp_res_88421;
                                    
                                    redout_89276 = redout_tmp_91614;
                                }
                                defunc_0_reduce_res_88415 = redout_89276;
                                
                                double zt_res_88423 = eta_p_88414 * defunc_0_reduce_res_88415;
                                double zp_res_88426 = zt_res_88423 + redout_89278;
                                double redout_tmp_91613 = zp_res_88426;
                                
                                redout_89278 = redout_tmp_91613;
                            }
                            defunc_0_reduce_res_88412 = redout_89278;
                            
                            double zp_res_88430 = zt_res_88400 + redout_89280;
                            double zp_res_88433 = defunc_0_reduce_res_88412 + redout_89281;
                            double redout_tmp_91608 = zp_res_88430;
                            double redout_tmp_91609 = zp_res_88433;
                            
                            redout_89280 = redout_tmp_91608;
                            redout_89281 = redout_tmp_91609;
                        }
                        defunc_0_reduce_res_88386 = redout_89280;
                        defunc_res_88387 = redout_89281;
                        
                        double defunc_0_reduce_res_88436;
                        double redout_89285 = 0.0;
                        
                        for (int64_t i_89286 = 0; i_89286 < m_34201; i_89286++) {
                            double eta_p_88438 = ((double *) mem_90796)[i_89286];
                            double defunc_0_reduce_res_88439;
                            double redout_89283 = 0.0;
                            
                            for (int64_t i_89284 = 0; i_89284 < m_34201; i_89284++) {
                                double eta_p_88440 = ((double *) A_mem_89412.mem)[eta_p_45650 * (m_34201 * m_34201) + i_89286 * m_34201 + i_89284];
                                double eta_p_88441 = ((double *) mem_90796)[i_89284];
                                double zt_res_88442 = eta_p_88440 * eta_p_88440;
                                double zt_res_88443 = eta_p_88441 * zt_res_88442;
                                double zp_res_88446 = zt_res_88443 + redout_89283;
                                double redout_tmp_91616 = zp_res_88446;
                                
                                redout_89283 = redout_tmp_91616;
                            }
                            defunc_0_reduce_res_88439 = redout_89283;
                            
                            double zt_res_88448 = eta_p_88438 * defunc_0_reduce_res_88439;
                            double zp_res_88451 = zt_res_88448 + redout_89285;
                            double redout_tmp_91615 = zp_res_88451;
                            
                            redout_89285 = redout_tmp_91615;
                        }
                        defunc_0_reduce_res_88436 = redout_89285;
                        
                        double zt_res_88453 = -2.0 * defunc_res_88387;
                        double zp_res_88454 = defunc_0_reduce_res_88386 + zt_res_88453;
                        double zp_res_88455 = defunc_0_reduce_res_88436 + zp_res_88454;
                        double zt_res_88456 = zt_res_45683 * defunc_res_88303;
                        double zt_res_88457 = rho1_34204 * defunc_res_88301;
                        double zt_res_88458 = rho2_34205 * defunc_res_88361;
                        double zp_res_88459 = zt_res_88456 + zt_res_88457;
                        double zp_res_88460 = zt_res_88458 + zp_res_88459;
                        double zt_res_88461 = 2.0 * zp_res_88460;
                        double zt_res_88462 = defunc_res_88302 * zt_res_88461;
                        double zp_res_88463 = zp_res_88455 + zt_res_88462;
                        double zt_res_88464 = defunc_res_88302 * defunc_res_88302;
                        double zt_res_88465 = zp_res_48637 * zt_res_88464;
                        double zm_res_88466 = zp_res_88463 - zt_res_88465;
                        double zp_res_88467 = zp_res_88291 + zm_res_88466;
                        double zm_res_88468 = zp_res_88467 - loss_45903;
                        bool zgze_res_88469 = -1.0 <= zm_res_88468;
                        double zt_res_88470 = defunc_res_88014 * zt_res_88300;
                        double zs_res_88471 = zm_res_88468 / zt_res_88470;
                        bool zlze_res_88472 = zs_res_88471 <= 0.5;
                        bool zg_res_88473 = 1.0e-50 < zt_res_88300;
                        bool x_88474 = zlze_res_88472 && zg_res_88473;
                        bool x_88475 = zgze_res_88469 && x_88474;
                        
                        if (memblock_set(ctx, &mem_param_tmp_91588, &mem_90756, "mem_90756") != 0)
                            return 1;
                        
                        bool loop_while_tmp_91589 = x_88475;
                        double current_loss_tmp_91591 = zp_res_88467;
                        double alpha_tmp_91592 = zt_res_88300;
                        
                        if (memblock_set(ctx, &mem_param_90748, &mem_param_tmp_91588, "mem_param_tmp_91588") != 0)
                            return 1;
                        loop_while_88296 = loop_while_tmp_91589;
                        current_loss_88298 = current_loss_tmp_91591;
                        alpha_88299 = alpha_tmp_91592;
                    }
                    if (memblock_set(ctx, &ext_mem_90814, &mem_param_90748, "mem_param_90748") != 0)
                        return 1;
                    defunc_0_armijo_line_search_res_88292 = loop_while_88296;
                    defunc_0_armijo_line_search_res_88294 = current_loss_88298;
                    defunc_0_armijo_line_search_res_88295 = alpha_88299;
                    if (memblock_unref(ctx, &mem_90682, "mem_90682") != 0)
                        return 1;
                    if (memblock_alloc(ctx, &mem_90817, bytes_89434, "mem_90817")) {
                        err = 1;
                        goto cleanup;
                    }
                    for (int64_t i_89293 = 0; i_89293 < m_34201; i_89293++) {
                        for (int64_t i_89289 = 0; i_89289 < m_34201; i_89289++) {
                            double eta_p_88480 = ((double *) mem_param_89893.mem)[i_89293 * m_34201 + i_89289];
                            double eta_p_88481 = ((double *) ext_mem_90814.mem)[i_89293 * m_34201 + i_89289];
                            double zp_res_88482 = eta_p_88480 + eta_p_88481;
                            
                            ((double *) mem_90817.mem)[i_89293 * m_34201 + i_89289] = zp_res_88482;
                        }
                    }
                    if (memblock_unref(ctx, &ext_mem_90814, "ext_mem_90814") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90843, &mem_90580, "mem_90580") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90840, &mem_90575, "mem_90575") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90837, &mem_90817, "mem_90817") != 0)
                        return 1;
                    descent_res_46355 = defunc_0_armijo_line_search_res_88294;
                } else {
                    if (memblock_alloc(ctx, &mem_90610, bytes_89416, "mem_90610")) {
                        err = 1;
                        goto cleanup;
                    }
                    for (int64_t nest_i_91619 = 0; nest_i_91619 < m_34201; nest_i_91619++) {
                        ((double *) mem_90610.mem)[nest_i_91619] = 0.0;
                    }
                    if (memblock_alloc(ctx, &mem_90613, bytes_89434, "mem_90613")) {
                        err = 1;
                        goto cleanup;
                    }
                    for (int64_t nest_i_91620 = 0; nest_i_91620 < m_34201; nest_i_91620++) {
                        for (int64_t nest_i_91621 = 0; nest_i_91621 < m_34201; nest_i_91621++) {
                            ((double *) mem_90613.mem)[nest_i_91620 * m_34201 + nest_i_91621] = 0.0;
                        }
                    }
                    if (memblock_set(ctx, &ext_mem_90843, &mem_90610, "mem_90610") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90840, &mem_90610, "mem_90610") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90837, &mem_90613, "mem_90613") != 0)
                        return 1;
                    descent_res_46355 = 0.0;
                }
                if (memblock_unref(ctx, &mem_90575, "mem_90575") != 0)
                    return 1;
                if (memblock_unref(ctx, &mem_90580, "mem_90580") != 0)
                    return 1;
                
                bool defunc_0_reduce_comm_res_88526;
                bool redout_89297 = 0;
                
                for (int64_t i_89298 = 0; i_89298 < m_34201; i_89298++) {
                    bool defunc_0_reduce_comm_res_88485;
                    bool redout_89295 = 0;
                    
                    for (int64_t i_89296 = 0; i_89296 < m_34201; i_89296++) {
                        double eta_p_68818 = ((double *) mem_param_89893.mem)[i_89298 * m_34201 + i_89296];
                        double eta_p_68819 = ((double *) ext_mem_90837.mem)[i_89298 * m_34201 + i_89296];
                        double zt_res_68820 = zp_res_45646 * eta_p_68818;
                        bool zgze_res_68821 = eta_p_68819 <= zt_res_68820;
                        double zt_res_68822 = zp_res_45646 * eta_p_68819;
                        bool zgze_res_68823 = eta_p_68818 <= zt_res_68822;
                        bool x_68824 = zgze_res_68821 && zgze_res_68823;
                        bool not_res_68825 = !x_68824;
                        bool defunc_0_op_res_60644 = not_res_68825 || redout_89295;
                        bool redout_tmp_91623 = defunc_0_op_res_60644;
                        
                        redout_89295 = redout_tmp_91623;
                    }
                    defunc_0_reduce_comm_res_88485 = redout_89295;
                    
                    bool defunc_0_op_res_46528 = defunc_0_reduce_comm_res_88485 || redout_89297;
                    bool redout_tmp_91622 = defunc_0_op_res_46528;
                    
                    redout_89297 = redout_tmp_91622;
                }
                defunc_0_reduce_comm_res_88526 = redout_89297;
                
                bool loop_cond_46529;
                
                if (defunc_0_reduce_comm_res_88526) {
                    bool defunc_0_reduce_res_88488;
                    bool redout_89301 = 0;
                    
                    for (int64_t i_89302 = 0; i_89302 < m_34201; i_89302++) {
                        bool defunc_0_reduce_res_88490;
                        bool redout_89299 = 0;
                        
                        for (int64_t i_89300 = 0; i_89300 < m_34201; i_89300++) {
                            double eta_p_88491 = ((double *) ext_mem_90837.mem)[i_89302 * m_34201 + i_89300];
                            bool zg_res_88492 = 0.0 < eta_p_88491;
                            bool defunc_0_op_res_88495 = zg_res_88492 || redout_89299;
                            bool redout_tmp_91625 = defunc_0_op_res_88495;
                            
                            redout_89299 = redout_tmp_91625;
                        }
                        defunc_0_reduce_res_88490 = redout_89299;
                        
                        bool defunc_0_op_res_88499 = defunc_0_reduce_res_88490 || redout_89301;
                        bool redout_tmp_91624 = defunc_0_op_res_88499;
                        
                        redout_89301 = redout_tmp_91624;
                    }
                    defunc_0_reduce_res_88488 = redout_89301;
                    loop_cond_46529 = defunc_0_reduce_res_88488;
                } else {
                    loop_cond_46529 = 0;
                }
                if (memblock_set(ctx, &mem_param_tmp_91374, &ext_mem_90843, "ext_mem_90843") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91375, &ext_mem_90840, "ext_mem_90840") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91376, &ext_mem_90837, "ext_mem_90837") != 0)
                    return 1;
                
                bool loop_while_tmp_91377 = loop_cond_46529;
                double loss_tmp_91381 = descent_res_46355;
                
                if (memblock_set(ctx, &mem_param_89886, &mem_param_tmp_91374, "mem_param_tmp_91374") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_89889, &mem_param_tmp_91375, "mem_param_tmp_91375") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_89893, &mem_param_tmp_91376, "mem_param_tmp_91376") != 0)
                    return 1;
                loop_while_45899 = loop_while_tmp_91377;
                loss_45903 = loss_tmp_91381;
            }
            if (memblock_set(ctx, &ext_mem_90853, &mem_param_89886, "mem_param_89886") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_90852, &mem_param_89889, "mem_param_89889") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_90851, &mem_param_89893, "mem_param_89893") != 0)
                return 1;
            final_plan_45894 = loop_while_45899;
            final_plan_45898 = loss_45903;
            if (memblock_unref(ctx, &ext_mem_89841, "ext_mem_89841") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_89842, "ext_mem_89842") != 0)
                return 1;
            
            double defunc_res_88588;
            double defunc_res_88589;
            double defunc_res_88590;
            double defunc_res_88591;
            double defunc_res_88592;
            double redout_89323;
            double redout_89324;
            double redout_89325;
            double redout_89326;
            double redout_89327;
            
            redout_89323 = 0.0;
            redout_89324 = 0.0;
            redout_89325 = 0.0;
            redout_89326 = 0.0;
            redout_89327 = 0.0;
            for (int64_t i_89331 = 0; i_89331 < m_34201; i_89331++) {
                double eta_p_59285 = ((double *) distrs_mem_89413.mem)[eta_p_45649 * m_34201 + i_89331];
                
                for (int64_t i_89307 = 0; i_89307 < m_34201; i_89307++) {
                    double defunc_0_reduce_res_88527;
                    double redout_89303 = 0.0;
                    
                    for (int64_t i_89304 = 0; i_89304 < m_34201; i_89304++) {
                        double eta_p_71801 = ((double *) A_mem_89412.mem)[eta_p_45649 * (m_34201 * m_34201) + i_89331 * m_34201 + i_89304];
                        double eta_p_71802 = ((double *) ext_mem_90851.mem)[i_89304 * m_34201 + i_89307];
                        double zt_res_71803 = eta_p_71801 * eta_p_71802;
                        double zp_res_59311 = zt_res_71803 + redout_89303;
                        double redout_tmp_91635 = zp_res_59311;
                        
                        redout_89303 = redout_tmp_91635;
                    }
                    defunc_0_reduce_res_88527 = redout_89303;
                    ((double *) mem_90870)[i_89307] = defunc_0_reduce_res_88527;
                }
                
                double defunc_res_88530;
                double defunc_0_reduce_res_88531;
                double defunc_res_88532;
                double defunc_res_88533;
                double defunc_res_88534;
                double defunc_res_88535;
                double defunc_res_88536;
                double defunc_res_88537;
                double redout_89311;
                double redout_89312;
                double redout_89313;
                double redout_89314;
                double redout_89315;
                double redout_89316;
                double redout_89317;
                double redout_89318;
                
                redout_89311 = 0.0;
                redout_89312 = 0.0;
                redout_89313 = 0.0;
                redout_89314 = 0.0;
                redout_89315 = 0.0;
                redout_89316 = 0.0;
                redout_89317 = 0.0;
                redout_89318 = 0.0;
                for (int64_t i_89319 = 0; i_89319 < m_34201; i_89319++) {
                    double x_71757 = ((double *) ext_mem_90851.mem)[i_89331 * m_34201 + i_89319];
                    double eta_p_71758 = ((double *) distrs_mem_89413.mem)[eta_p_45650 * m_34201 + i_89319];
                    double defunc_0_reduce_res_88528;
                    double redout_89309 = 0.0;
                    
                    for (int64_t i_89310 = 0; i_89310 < m_34201; i_89310++) {
                        double eta_p_71795 = ((double *) mem_90870)[i_89310];
                        double eta_p_71796 = ((double *) A_mem_89412.mem)[eta_p_45650 * (m_34201 * m_34201) + i_89310 * m_34201 + i_89319];
                        double zt_res_71797 = eta_p_71795 * eta_p_71796;
                        double zp_res_71776 = zt_res_71797 + redout_89309;
                        double redout_tmp_91644 = zp_res_71776;
                        
                        redout_89309 = redout_tmp_91644;
                    }
                    defunc_0_reduce_res_88528 = redout_89309;
                    
                    double zt_res_71778 = x_71757 * defunc_0_reduce_res_88528;
                    double zt_res_71780 = eta_p_59285 * eta_p_71758;
                    bool zeze_res_71781 = x_71757 == 0.0;
                    double klu_res_71782;
                    
                    if (zeze_res_71781) {
                        klu_res_71782 = 0.0;
                    } else {
                        double zs_res_71783 = x_71757 / zt_res_71780;
                        double log_res_71784 = futrts_log64(zs_res_71783);
                        double zt_res_71785 = x_71757 * log_res_71784;
                        
                        klu_res_71782 = zt_res_71785;
                    }
                    
                    double klu_res_71789;
                    
                    if (zeze_res_71781) {
                        klu_res_71789 = 0.0;
                    } else {
                        double zs_res_71790 = x_71757 / zt_res_71780;
                        double log_res_71791 = futrts_log64(zs_res_71790);
                        double zt_res_71792 = x_71757 * log_res_71791;
                        
                        klu_res_71789 = zt_res_71792;
                    }
                    
                    double zp_res_59299 = x_71757 + redout_89311;
                    double zp_res_59333 = zt_res_71778 + redout_89312;
                    double zp_res_59340 = x_71757 + redout_89313;
                    double zp_res_59347 = x_71757 + redout_89314;
                    double zp_res_59355 = x_71757 + redout_89315;
                    double zp_res_59372 = klu_res_71782 + redout_89316;
                    double zp_res_59389 = klu_res_71789 + redout_89317;
                    double zp_res_59397 = x_71757 + redout_89318;
                    double redout_tmp_91636 = zp_res_59299;
                    double redout_tmp_91637 = zp_res_59333;
                    double redout_tmp_91638 = zp_res_59340;
                    double redout_tmp_91639 = zp_res_59347;
                    double redout_tmp_91640 = zp_res_59355;
                    double redout_tmp_91641 = zp_res_59372;
                    double redout_tmp_91642 = zp_res_59389;
                    double redout_tmp_91643 = zp_res_59397;
                    
                    redout_89311 = redout_tmp_91636;
                    redout_89312 = redout_tmp_91637;
                    redout_89313 = redout_tmp_91638;
                    redout_89314 = redout_tmp_91639;
                    redout_89315 = redout_tmp_91640;
                    redout_89316 = redout_tmp_91641;
                    redout_89317 = redout_tmp_91642;
                    redout_89318 = redout_tmp_91643;
                }
                defunc_res_88530 = redout_89311;
                defunc_0_reduce_res_88531 = redout_89312;
                defunc_res_88532 = redout_89313;
                defunc_res_88533 = redout_89314;
                defunc_res_88534 = redout_89315;
                defunc_res_88535 = redout_89316;
                defunc_res_88536 = redout_89317;
                defunc_res_88537 = redout_89318;
                
                double zp_res_48112 = defunc_0_reduce_res_88531 + redout_89323;
                double zp_res_49335 = defunc_res_88533 + redout_89324;
                double zp_res_49347 = defunc_res_88534 + redout_89325;
                double zp_res_49381 = defunc_res_88535 + redout_89326;
                double zp_res_49404 = defunc_res_88536 + redout_89327;
                
                ((double *) mem_90855)[i_89331] = defunc_res_88537;
                ((double *) mem_90857)[i_89331] = defunc_res_88532;
                ((double *) mem_90859)[i_89331] = defunc_res_88530;
                
                double redout_tmp_91626 = zp_res_48112;
                double redout_tmp_91627 = zp_res_49335;
                double redout_tmp_91628 = zp_res_49347;
                double redout_tmp_91629 = zp_res_49381;
                double redout_tmp_91630 = zp_res_49404;
                
                redout_89323 = redout_tmp_91626;
                redout_89324 = redout_tmp_91627;
                redout_89325 = redout_tmp_91628;
                redout_89326 = redout_tmp_91629;
                redout_89327 = redout_tmp_91630;
            }
            defunc_res_88588 = redout_89323;
            defunc_res_88589 = redout_89324;
            defunc_res_88590 = redout_89325;
            defunc_res_88591 = redout_89326;
            defunc_res_88592 = redout_89327;
            for (int64_t i_89345 = 0; i_89345 < m_34201; i_89345++) {
                double defunc_res_88538;
                double defunc_res_88539;
                double defunc_res_88540;
                double redout_89335;
                double redout_89336;
                double redout_89337;
                
                redout_89335 = 0.0;
                redout_89336 = 0.0;
                redout_89337 = 0.0;
                for (int64_t i_89338 = 0; i_89338 < m_34201; i_89338++) {
                    double x_71822 = ((double *) ext_mem_90851.mem)[i_89338 * m_34201 + i_89345];
                    double zp_res_59421 = x_71822 + redout_89335;
                    double zp_res_59427 = x_71822 + redout_89336;
                    double zp_res_59434 = x_71822 + redout_89337;
                    double redout_tmp_91648 = zp_res_59421;
                    double redout_tmp_91649 = zp_res_59427;
                    double redout_tmp_91650 = zp_res_59434;
                    
                    redout_89335 = redout_tmp_91648;
                    redout_89336 = redout_tmp_91649;
                    redout_89337 = redout_tmp_91650;
                }
                defunc_res_88538 = redout_89335;
                defunc_res_88539 = redout_89336;
                defunc_res_88540 = redout_89337;
                ((double *) mem_90887)[i_89345] = defunc_res_88540;
                ((double *) mem_90889)[i_89345] = defunc_res_88539;
                ((double *) mem_90891)[i_89345] = defunc_res_88538;
            }
            if (memblock_unref(ctx, &ext_mem_90851, "ext_mem_90851") != 0)
                return 1;
            
            double defunc_0_reduce_res_88599;
            double redout_89351 = 0.0;
            
            for (int64_t i_89352 = 0; i_89352 < m_34201; i_89352++) {
                double eta_p_56268 = ((double *) mem_90859)[i_89352];
                double defunc_0_reduce_res_88541;
                double redout_89349 = 0.0;
                
                for (int64_t i_89350 = 0; i_89350 < m_34201; i_89350++) {
                    double eta_p_71834 = ((double *) A_mem_89412.mem)[eta_p_45649 * (m_34201 * m_34201) + i_89352 * m_34201 + i_89350];
                    double eta_p_71835 = ((double *) mem_90859)[i_89350];
                    double zt_res_71837 = eta_p_71834 * eta_p_71834;
                    double zt_res_71839 = eta_p_71835 * zt_res_71837;
                    double zp_res_56281 = zt_res_71839 + redout_89349;
                    double redout_tmp_91652 = zp_res_56281;
                    
                    redout_89349 = redout_tmp_91652;
                }
                defunc_0_reduce_res_88541 = redout_89349;
                
                double zt_res_56283 = eta_p_56268 * defunc_0_reduce_res_88541;
                double zp_res_48043 = zt_res_56283 + redout_89351;
                double redout_tmp_91651 = zp_res_48043;
                
                redout_89351 = redout_tmp_91651;
            }
            defunc_0_reduce_res_88599 = redout_89351;
            
            double defunc_0_reduce_res_88600;
            double redout_89355 = 0.0;
            
            for (int64_t i_89356 = 0; i_89356 < m_34201; i_89356++) {
                double eta_p_56244 = ((double *) mem_90891)[i_89356];
                double defunc_0_reduce_res_88542;
                double redout_89353 = 0.0;
                
                for (int64_t i_89354 = 0; i_89354 < m_34201; i_89354++) {
                    double eta_p_71848 = ((double *) A_mem_89412.mem)[eta_p_45650 * (m_34201 * m_34201) + i_89356 * m_34201 + i_89354];
                    double eta_p_71849 = ((double *) mem_90891)[i_89354];
                    double zt_res_71851 = eta_p_71848 * eta_p_71848;
                    double zt_res_71853 = eta_p_71849 * zt_res_71851;
                    double zp_res_56257 = zt_res_71853 + redout_89353;
                    double redout_tmp_91654 = zp_res_56257;
                    
                    redout_89353 = redout_tmp_91654;
                }
                defunc_0_reduce_res_88542 = redout_89353;
                
                double zt_res_56259 = eta_p_56244 * defunc_0_reduce_res_88542;
                double zp_res_48067 = zt_res_56259 + redout_89355;
                double redout_tmp_91653 = zp_res_48067;
                
                redout_89355 = redout_tmp_91653;
            }
            defunc_0_reduce_res_88600 = redout_89355;
            
            double zt_res_48113 = -2.0 * defunc_res_88588;
            double zp_res_48114 = zt_res_48113 + defunc_0_reduce_res_88599;
            double zp_res_48115 = zp_res_48114 + defunc_0_reduce_res_88600;
            double defunc_res_88601;
            double defunc_res_88602;
            double redout_89360;
            double redout_89361;
            
            redout_89360 = 0.0;
            redout_89361 = 0.0;
            for (int64_t i_89362 = 0; i_89362 < m_34201; i_89362++) {
                double eta_p_56114 = ((double *) mem_90855)[i_89362];
                double eta_p_56115 = ((double *) distrs_mem_89413.mem)[eta_p_45649 * m_34201 + i_89362];
                double eta_p_56116 = ((double *) mem_90857)[i_89362];
                double defunc_res_88543;
                double defunc_res_88544;
                double redout_89357;
                double redout_89358;
                
                redout_89357 = 0.0;
                redout_89358 = 0.0;
                for (int64_t i_89359 = 0; i_89359 < m_34201; i_89359++) {
                    double eta_p_71921 = ((double *) mem_90855)[i_89359];
                    double eta_p_71922 = ((double *) distrs_mem_89413.mem)[eta_p_45649 * m_34201 + i_89359];
                    double eta_p_71923 = ((double *) mem_90857)[i_89359];
                    double zt_res_71924 = eta_p_56115 * eta_p_71922;
                    double zt_res_71926 = eta_p_56116 * eta_p_71923;
                    bool zeze_res_71928 = zt_res_71926 == 0.0;
                    double kl_res_71929;
                    
                    if (zeze_res_71928) {
                        kl_res_71929 = zt_res_71924;
                    } else {
                        double zs_res_71930 = zt_res_71926 / zt_res_71924;
                        double log_res_71931 = futrts_log64(zs_res_71930);
                        double zt_res_71932 = zt_res_71926 * log_res_71931;
                        double zm_res_71933 = zt_res_71932 - zt_res_71926;
                        double zp_res_71934 = zt_res_71924 + zm_res_71933;
                        
                        kl_res_71929 = zp_res_71934;
                    }
                    
                    double zt_res_71937 = eta_p_56114 * eta_p_71921;
                    bool zeze_res_71939 = zt_res_71937 == 0.0;
                    double kl_res_71940;
                    
                    if (zeze_res_71939) {
                        kl_res_71940 = zt_res_71924;
                    } else {
                        double zs_res_71941 = zt_res_71937 / zt_res_71924;
                        double log_res_71942 = futrts_log64(zs_res_71941);
                        double zt_res_71943 = zt_res_71937 * log_res_71942;
                        double zm_res_71944 = zt_res_71943 - zt_res_71937;
                        double zp_res_71945 = zt_res_71924 + zm_res_71944;
                        
                        kl_res_71940 = zp_res_71945;
                    }
                    
                    double zp_res_56139 = kl_res_71929 + redout_89357;
                    double zp_res_56160 = kl_res_71940 + redout_89358;
                    double redout_tmp_91657 = zp_res_56139;
                    double redout_tmp_91658 = zp_res_56160;
                    
                    redout_89357 = redout_tmp_91657;
                    redout_89358 = redout_tmp_91658;
                }
                defunc_res_88543 = redout_89357;
                defunc_res_88544 = redout_89358;
                
                double zp_res_48142 = defunc_res_88543 + redout_89360;
                double zp_res_48196 = defunc_res_88544 + redout_89361;
                double redout_tmp_91655 = zp_res_48142;
                double redout_tmp_91656 = zp_res_48196;
                
                redout_89360 = redout_tmp_91655;
                redout_89361 = redout_tmp_91656;
            }
            defunc_res_88601 = redout_89360;
            defunc_res_88602 = redout_89361;
            
            double defunc_res_88603;
            double defunc_res_88604;
            double redout_89366;
            double redout_89367;
            
            redout_89366 = 0.0;
            redout_89367 = 0.0;
            for (int64_t i_89368 = 0; i_89368 < m_34201; i_89368++) {
                double eta_p_55995 = ((double *) mem_90887)[i_89368];
                double eta_p_55996 = ((double *) distrs_mem_89413.mem)[eta_p_45650 * m_34201 + i_89368];
                double eta_p_55997 = ((double *) mem_90889)[i_89368];
                double defunc_res_88545;
                double defunc_res_88546;
                double redout_89363;
                double redout_89364;
                
                redout_89363 = 0.0;
                redout_89364 = 0.0;
                for (int64_t i_89365 = 0; i_89365 < m_34201; i_89365++) {
                    double eta_p_72014 = ((double *) mem_90887)[i_89365];
                    double eta_p_72015 = ((double *) distrs_mem_89413.mem)[eta_p_45650 * m_34201 + i_89365];
                    double eta_p_72016 = ((double *) mem_90889)[i_89365];
                    double zt_res_72017 = eta_p_55996 * eta_p_72015;
                    double zt_res_72019 = eta_p_55997 * eta_p_72016;
                    bool zeze_res_72021 = zt_res_72019 == 0.0;
                    double kl_res_72022;
                    
                    if (zeze_res_72021) {
                        kl_res_72022 = zt_res_72017;
                    } else {
                        double zs_res_72023 = zt_res_72019 / zt_res_72017;
                        double log_res_72024 = futrts_log64(zs_res_72023);
                        double zt_res_72025 = zt_res_72019 * log_res_72024;
                        double zm_res_72026 = zt_res_72025 - zt_res_72019;
                        double zp_res_72027 = zt_res_72017 + zm_res_72026;
                        
                        kl_res_72022 = zp_res_72027;
                    }
                    
                    double zt_res_72030 = eta_p_55995 * eta_p_72014;
                    bool zeze_res_72032 = zt_res_72030 == 0.0;
                    double kl_res_72033;
                    
                    if (zeze_res_72032) {
                        kl_res_72033 = zt_res_72017;
                    } else {
                        double zs_res_72034 = zt_res_72030 / zt_res_72017;
                        double log_res_72035 = futrts_log64(zs_res_72034);
                        double zt_res_72036 = zt_res_72030 * log_res_72035;
                        double zm_res_72037 = zt_res_72036 - zt_res_72030;
                        double zp_res_72038 = zt_res_72017 + zm_res_72037;
                        
                        kl_res_72033 = zp_res_72038;
                    }
                    
                    double zp_res_56020 = kl_res_72022 + redout_89363;
                    double zp_res_56041 = kl_res_72033 + redout_89364;
                    double redout_tmp_91661 = zp_res_56020;
                    double redout_tmp_91662 = zp_res_56041;
                    
                    redout_89363 = redout_tmp_91661;
                    redout_89364 = redout_tmp_91662;
                }
                defunc_res_88545 = redout_89363;
                defunc_res_88546 = redout_89364;
                
                double zp_res_48169 = defunc_res_88545 + redout_89366;
                double zp_res_48223 = defunc_res_88546 + redout_89367;
                double redout_tmp_91659 = zp_res_48169;
                double redout_tmp_91660 = zp_res_48223;
                
                redout_89366 = redout_tmp_91659;
                redout_89367 = redout_tmp_91660;
            }
            defunc_res_88603 = redout_89366;
            defunc_res_88604 = redout_89367;
            
            double zt_res_49358 = defunc_res_88555 * defunc_res_88562;
            double zt_res_49359 = zt_res_49358 * zt_res_49358;
            double zt_res_49382 = defunc_res_88590 * defunc_res_88591;
            double zt_res_49405 = defunc_res_88589 * defunc_res_88592;
            double zp_res_49406 = zt_res_49382 + zt_res_49405;
            double zp_res_49407 = zt_res_49359 + zp_res_49406;
            double zt_res_49408 = defunc_res_88589 * defunc_res_88590;
            double zm_res_49409 = zp_res_49407 - zt_res_49408;
            double zt_res_46551 = rho1_34204 * defunc_res_88602;
            double zp_res_46552 = zt_res_46551 + zp_res_48115;
            double zt_res_46558 = rho2_34205 * defunc_res_88604;
            double zp_res_46559 = zp_res_46552 + zt_res_46558;
            double fma_res_46560 = futrts_fma64(zm_res_49409, zt_res_45683, zp_res_46559);
            
            if (memblock_alloc(ctx, &mem_90910, (int64_t) 40, "mem_90910")) {
                err = 1;
                goto cleanup;
            }
            ((double *) mem_90910.mem)[(int64_t) 0] = zp_res_48115;
            ((double *) mem_90910.mem)[(int64_t) 1] = defunc_res_88601;
            ((double *) mem_90910.mem)[(int64_t) 2] = defunc_res_88603;
            ((double *) mem_90910.mem)[(int64_t) 3] = zm_res_49409;
            ((double *) mem_90910.mem)[(int64_t) 4] = fma_res_46560;
            
            bool isnan_res_46562 = futrts_isnan64(fma_res_46560);
            
            if (memblock_set(ctx, &mem_param_tmp_91253, &mem_90910, "mem_90910") != 0)
                return 1;
            
            int64_t ctx_param_ext_tmp_91254 = (int64_t) 0;
            bool loop_while_tmp_91255 = isnan_res_46562;
            double current_epsilon_tmp_91257 = zt_res_45683;
            
            if (memblock_set(ctx, &mem_param_89427, &mem_param_tmp_91253, "mem_param_tmp_91253") != 0)
                return 1;
            ctx_param_ext_89425 = ctx_param_ext_tmp_91254;
            loop_while_45680 = loop_while_tmp_91255;
            current_epsilon_45682 = current_epsilon_tmp_91257;
        }
        if (memblock_set(ctx, &ext_mem_90913, &mem_param_89427, "mem_param_89427") != 0)
            return 1;
        ext_90912 = ctx_param_ext_89425;
        lifted_lambda_res_45677 = loop_while_45680;
        lifted_lambda_res_45679 = current_epsilon_45682;
        lmad_copy_8b(ctx, 1, (uint64_t *) mem_89420.mem, i_89371 * (int64_t) 5, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90913.mem, ext_90912, (int64_t []) {(int64_t) 1}, (int64_t []) {(int64_t) 5});
        if (memblock_unref(ctx, &ext_mem_90913, "ext_mem_90913") != 0)
            return 1;
    }
    if (memblock_unref(ctx, &ext_mem_89414, "ext_mem_89414") != 0)
        return 1;
    if (memblock_unref(ctx, &ext_mem_89415, "ext_mem_89415") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89417, "mem_89417") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89500, "mem_89500") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89548, "mem_89548") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89559, "mem_89559") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89583, "mem_89583") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89591, "mem_89591") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89867, "mem_89867") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89970, "mem_89970") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89972, "mem_89972") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89975, "mem_89975") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_90005, "mem_90005") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_90007, "mem_90007") != 0)
        return 1;
    if (memblock_set(ctx, &mem_out_91249, &mem_89420, "mem_89420") != 0)
        return 1;
    prim_out_91250 = zbzg_lhs_45640;
    if (memblock_set(ctx, &*mem_out_p_91800, &mem_out_91249, "mem_out_91249") != 0)
        return 1;
    *out_prim_out_91801 = prim_out_91250;
    
  cleanup:
    {
        free(mem_89430);
        free(mem_89432);
        free(mem_89435);
        free(mem_89465);
        free(mem_89467);
        free(mem_89469);
        free(mem_89489);
        free(mem_89498);
        free(mem_89509);
        free(mem_89511);
        free(mem_89525);
        free(mem_89556);
        free(mem_89848);
        free(mem_89895);
        free(mem_89903);
        free(mem_89905);
        free(mem_89919);
        free(mem_89928);
        free(mem_89930);
        free(mem_89939);
        free(mem_89947);
        free(mem_90578);
        free(mem_90615);
        free(mem_90617);
        free(mem_90619);
        free(mem_90640);
        free(mem_90652);
        free(mem_90654);
        free(mem_90668);
        free(mem_90676);
        free(mem_90679);
        free(mem_90695);
        free(mem_90730);
        free(mem_90738);
        free(mem_90750);
        free(mem_90753);
        free(mem_90796);
        free(mem_90804);
        free(mem_90855);
        free(mem_90857);
        free(mem_90859);
        free(mem_90870);
        free(mem_90887);
        free(mem_90889);
        free(mem_90891);
        if (memblock_unref(ctx, &mem_param_tmp_91253, "mem_param_tmp_91253") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90910, "mem_90910") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91376, "mem_param_tmp_91376") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91375, "mem_param_tmp_91375") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91374, "mem_param_tmp_91374") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90613, "mem_90613") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90610, "mem_90610") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90817, "mem_90817") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91588, "mem_param_tmp_91588") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90756, "mem_90756") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90748, "mem_param_90748") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90814, "ext_mem_90814") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90682, "mem_90682") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90837, "ext_mem_90837") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90840, "ext_mem_90840") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90843, "ext_mem_90843") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90580, "mem_90580") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90575, "mem_90575") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91497, "mem_param_tmp_91497") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91496, "mem_param_tmp_91496") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91495, "mem_param_tmp_91495") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91494, "mem_param_tmp_91494") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91493, "mem_param_tmp_91493") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90510, "mem_90510") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90521, "ext_mem_90521") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90498, "mem_90498") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90495, "mem_90495") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90493, "mem_90493") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90535, "ext_mem_90535") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90538, "ext_mem_90538") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90541, "ext_mem_90541") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90460, "mem_90460") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90471, "ext_mem_90471") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90448, "mem_90448") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90445, "mem_90445") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90443, "mem_90443") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90485, "ext_mem_90485") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90488, "ext_mem_90488") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90491, "ext_mem_90491") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90435, "mem_90435") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90427, "mem_90427") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90425, "mem_param_90425") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90422, "mem_param_90422") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90419, "mem_param_90419") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90416, "mem_param_90416") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90413, "mem_param_90413") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90553, "ext_mem_90553") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90554, "ext_mem_90554") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90555, "ext_mem_90555") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90556, "ext_mem_90556") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90557, "ext_mem_90557") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90378, "mem_90378") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90389, "ext_mem_90389") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90366, "mem_90366") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90363, "mem_90363") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90361, "mem_90361") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90403, "ext_mem_90403") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90406, "ext_mem_90406") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90409, "ext_mem_90409") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90328, "mem_90328") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90339, "ext_mem_90339") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90316, "mem_90316") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90313, "mem_90313") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90311, "mem_90311") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90353, "ext_mem_90353") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90356, "ext_mem_90356") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90359, "ext_mem_90359") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90303, "mem_90303") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90295, "mem_90295") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90560, "ext_mem_90560") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90563, "ext_mem_90563") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90566, "ext_mem_90566") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90569, "ext_mem_90569") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90573, "ext_mem_90573") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91439, "mem_param_tmp_91439") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91438, "mem_param_tmp_91438") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91437, "mem_param_tmp_91437") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91436, "mem_param_tmp_91436") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91435, "mem_param_tmp_91435") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91434, "mem_param_tmp_91434") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91433, "mem_param_tmp_91433") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91432, "mem_param_tmp_91432") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91431, "mem_param_tmp_91431") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90233, "mem_90233") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90244, "ext_mem_90244") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90221, "mem_90221") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90218, "mem_90218") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90216, "mem_90216") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90258, "ext_mem_90258") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90261, "ext_mem_90261") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90264, "ext_mem_90264") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90183, "mem_90183") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90194, "ext_mem_90194") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90171, "mem_90171") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90168, "mem_90168") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90166, "mem_90166") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90208, "ext_mem_90208") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90211, "ext_mem_90211") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90214, "ext_mem_90214") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90158, "mem_90158") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90150, "mem_90150") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90148, "mem_param_90148") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90145, "mem_param_90145") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90142, "mem_param_90142") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90139, "mem_param_90139") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90136, "mem_param_90136") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90132, "mem_param_90132") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90129, "mem_param_90129") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90126, "mem_param_90126") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90123, "mem_param_90123") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90285, "ext_mem_90285") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90286, "ext_mem_90286") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90287, "ext_mem_90287") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90288, "ext_mem_90288") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90289, "ext_mem_90289") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90290, "ext_mem_90290") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90291, "ext_mem_90291") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90292, "ext_mem_90292") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90293, "ext_mem_90293") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90088, "mem_90088") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90099, "ext_mem_90099") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90076, "mem_90076") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90073, "mem_90073") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90071, "mem_90071") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90113, "ext_mem_90113") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90116, "ext_mem_90116") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90119, "ext_mem_90119") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90038, "mem_90038") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90049, "ext_mem_90049") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90026, "mem_90026") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90023, "mem_90023") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90021, "mem_90021") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90063, "ext_mem_90063") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90066, "ext_mem_90066") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90069, "ext_mem_90069") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89893, "mem_param_89893") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89889, "mem_param_89889") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89886, "mem_param_89886") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90851, "ext_mem_90851") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90852, "ext_mem_90852") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90853, "ext_mem_90853") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91337, "mem_param_tmp_91337") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91336, "mem_param_tmp_91336") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91335, "mem_param_tmp_91335") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91334, "mem_param_tmp_91334") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91333, "mem_param_tmp_91333") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89798, "mem_89798") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89809, "ext_mem_89809") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89786, "mem_89786") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89783, "mem_89783") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89781, "mem_89781") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89823, "ext_mem_89823") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89826, "ext_mem_89826") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89829, "ext_mem_89829") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89748, "mem_89748") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89759, "ext_mem_89759") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89736, "mem_89736") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89733, "mem_89733") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89731, "mem_89731") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89773, "ext_mem_89773") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89776, "ext_mem_89776") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89779, "ext_mem_89779") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89723, "mem_89723") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89715, "mem_89715") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89713, "mem_param_89713") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89710, "mem_param_89710") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89707, "mem_param_89707") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89704, "mem_param_89704") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89701, "mem_param_89701") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89841, "ext_mem_89841") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89842, "ext_mem_89842") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89843, "ext_mem_89843") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89844, "ext_mem_89844") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89845, "ext_mem_89845") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89666, "mem_89666") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89677, "ext_mem_89677") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89654, "mem_89654") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89651, "mem_89651") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89649, "mem_89649") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89691, "ext_mem_89691") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89694, "ext_mem_89694") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89697, "ext_mem_89697") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89616, "mem_89616") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89627, "ext_mem_89627") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89604, "mem_89604") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89601, "mem_89601") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89599, "mem_89599") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89641, "ext_mem_89641") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89644, "ext_mem_89644") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89647, "ext_mem_89647") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89427, "mem_param_89427") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90913, "ext_mem_90913") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90007, "mem_90007") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90005, "mem_90005") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89975, "mem_89975") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89972, "mem_89972") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89970, "mem_89970") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89867, "mem_89867") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89591, "mem_89591") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89583, "mem_89583") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89559, "mem_89559") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89548, "mem_89548") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89500, "mem_89500") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89420, "mem_89420") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89417, "mem_89417") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89414, "ext_mem_89414") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89415, "ext_mem_89415") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_out_91249, "mem_out_91249") != 0)
            return 1;
    }
    return err;
}
FUTHARK_FUN_ATTR int futrts_entry_ugw_armijo_pairwise_unif(struct futhark_context *ctx, struct memblock *mem_out_p_91847, int64_t *out_prim_out_91848, struct memblock A_mem_89411, int64_t k_34472, int64_t m_34473, double rho1_34474, double rho2_34475, double eps_34476, double exp_absorb_cutoff_34478, double safe_for_exp_34479, double tol_sinkhorn_34480, double tol_outerloop_34481)
{
    (void) ctx;
    
    int err = 0;
    int64_t mem_89424_cached_sizze_91849 = 0;
    unsigned char *mem_89424 = NULL;
    int64_t mem_89426_cached_sizze_91850 = 0;
    unsigned char *mem_89426 = NULL;
    int64_t mem_89440_cached_sizze_91851 = 0;
    unsigned char *mem_89440 = NULL;
    int64_t mem_89449_cached_sizze_91852 = 0;
    unsigned char *mem_89449 = NULL;
    int64_t mem_89460_cached_sizze_91853 = 0;
    unsigned char *mem_89460 = NULL;
    int64_t mem_89462_cached_sizze_91854 = 0;
    unsigned char *mem_89462 = NULL;
    int64_t mem_89476_cached_sizze_91855 = 0;
    unsigned char *mem_89476 = NULL;
    int64_t mem_89507_cached_sizze_91856 = 0;
    unsigned char *mem_89507 = NULL;
    int64_t mem_89799_cached_sizze_91857 = 0;
    unsigned char *mem_89799 = NULL;
    int64_t mem_89846_cached_sizze_91858 = 0;
    unsigned char *mem_89846 = NULL;
    int64_t mem_89854_cached_sizze_91859 = 0;
    unsigned char *mem_89854 = NULL;
    int64_t mem_89862_cached_sizze_91860 = 0;
    unsigned char *mem_89862 = NULL;
    int64_t mem_89871_cached_sizze_91861 = 0;
    unsigned char *mem_89871 = NULL;
    int64_t mem_89873_cached_sizze_91862 = 0;
    unsigned char *mem_89873 = NULL;
    int64_t mem_89882_cached_sizze_91863 = 0;
    unsigned char *mem_89882 = NULL;
    int64_t mem_89890_cached_sizze_91864 = 0;
    unsigned char *mem_89890 = NULL;
    int64_t mem_90521_cached_sizze_91865 = 0;
    unsigned char *mem_90521 = NULL;
    int64_t mem_90558_cached_sizze_91866 = 0;
    unsigned char *mem_90558 = NULL;
    int64_t mem_90560_cached_sizze_91867 = 0;
    unsigned char *mem_90560 = NULL;
    int64_t mem_90575_cached_sizze_91868 = 0;
    unsigned char *mem_90575 = NULL;
    int64_t mem_90587_cached_sizze_91869 = 0;
    unsigned char *mem_90587 = NULL;
    int64_t mem_90589_cached_sizze_91870 = 0;
    unsigned char *mem_90589 = NULL;
    int64_t mem_90603_cached_sizze_91871 = 0;
    unsigned char *mem_90603 = NULL;
    int64_t mem_90611_cached_sizze_91872 = 0;
    unsigned char *mem_90611 = NULL;
    int64_t mem_90614_cached_sizze_91873 = 0;
    unsigned char *mem_90614 = NULL;
    int64_t mem_90630_cached_sizze_91874 = 0;
    unsigned char *mem_90630 = NULL;
    int64_t mem_90638_cached_sizze_91875 = 0;
    unsigned char *mem_90638 = NULL;
    int64_t mem_90665_cached_sizze_91876 = 0;
    unsigned char *mem_90665 = NULL;
    int64_t mem_90673_cached_sizze_91877 = 0;
    unsigned char *mem_90673 = NULL;
    int64_t mem_90685_cached_sizze_91878 = 0;
    unsigned char *mem_90685 = NULL;
    int64_t mem_90688_cached_sizze_91879 = 0;
    unsigned char *mem_90688 = NULL;
    int64_t mem_90731_cached_sizze_91880 = 0;
    unsigned char *mem_90731 = NULL;
    int64_t mem_90739_cached_sizze_91881 = 0;
    unsigned char *mem_90739 = NULL;
    int64_t mem_90790_cached_sizze_91882 = 0;
    unsigned char *mem_90790 = NULL;
    int64_t mem_90792_cached_sizze_91883 = 0;
    unsigned char *mem_90792 = NULL;
    int64_t mem_90794_cached_sizze_91884 = 0;
    unsigned char *mem_90794 = NULL;
    int64_t mem_90805_cached_sizze_91885 = 0;
    unsigned char *mem_90805 = NULL;
    int64_t mem_90822_cached_sizze_91886 = 0;
    unsigned char *mem_90822 = NULL;
    int64_t mem_90824_cached_sizze_91887 = 0;
    unsigned char *mem_90824 = NULL;
    int64_t mem_90826_cached_sizze_91888 = 0;
    unsigned char *mem_90826 = NULL;
    struct memblock mem_param_tmp_91370;
    
    mem_param_tmp_91370.references = NULL;
    
    struct memblock mem_param_tmp_91369;
    
    mem_param_tmp_91369.references = NULL;
    
    struct memblock mem_param_tmp_91368;
    
    mem_param_tmp_91368.references = NULL;
    
    struct memblock mem_90556;
    
    mem_90556.references = NULL;
    
    struct memblock mem_90553;
    
    mem_90553.references = NULL;
    
    struct memblock mem_90752;
    
    mem_90752.references = NULL;
    
    struct memblock mem_param_tmp_91576;
    
    mem_param_tmp_91576.references = NULL;
    
    struct memblock mem_90691;
    
    mem_90691.references = NULL;
    
    struct memblock mem_param_90683;
    
    mem_param_90683.references = NULL;
    
    struct memblock ext_mem_90749;
    
    ext_mem_90749.references = NULL;
    
    struct memblock mem_90617;
    
    mem_90617.references = NULL;
    
    struct memblock ext_mem_90772;
    
    ext_mem_90772.references = NULL;
    
    struct memblock ext_mem_90775;
    
    ext_mem_90775.references = NULL;
    
    struct memblock ext_mem_90778;
    
    ext_mem_90778.references = NULL;
    
    struct memblock mem_90523;
    
    mem_90523.references = NULL;
    
    struct memblock mem_90518;
    
    mem_90518.references = NULL;
    
    struct memblock mem_param_tmp_91490;
    
    mem_param_tmp_91490.references = NULL;
    
    struct memblock mem_param_tmp_91489;
    
    mem_param_tmp_91489.references = NULL;
    
    struct memblock mem_param_tmp_91488;
    
    mem_param_tmp_91488.references = NULL;
    
    struct memblock mem_param_tmp_91487;
    
    mem_param_tmp_91487.references = NULL;
    
    struct memblock mem_param_tmp_91486;
    
    mem_param_tmp_91486.references = NULL;
    
    struct memblock mem_90453;
    
    mem_90453.references = NULL;
    
    struct memblock ext_mem_90464;
    
    ext_mem_90464.references = NULL;
    
    struct memblock mem_90441;
    
    mem_90441.references = NULL;
    
    struct memblock mem_90438;
    
    mem_90438.references = NULL;
    
    struct memblock mem_90436;
    
    mem_90436.references = NULL;
    
    struct memblock ext_mem_90478;
    
    ext_mem_90478.references = NULL;
    
    struct memblock ext_mem_90481;
    
    ext_mem_90481.references = NULL;
    
    struct memblock ext_mem_90484;
    
    ext_mem_90484.references = NULL;
    
    struct memblock mem_90403;
    
    mem_90403.references = NULL;
    
    struct memblock ext_mem_90414;
    
    ext_mem_90414.references = NULL;
    
    struct memblock mem_90391;
    
    mem_90391.references = NULL;
    
    struct memblock mem_90388;
    
    mem_90388.references = NULL;
    
    struct memblock mem_90386;
    
    mem_90386.references = NULL;
    
    struct memblock ext_mem_90428;
    
    ext_mem_90428.references = NULL;
    
    struct memblock ext_mem_90431;
    
    ext_mem_90431.references = NULL;
    
    struct memblock ext_mem_90434;
    
    ext_mem_90434.references = NULL;
    
    struct memblock mem_90378;
    
    mem_90378.references = NULL;
    
    struct memblock mem_90370;
    
    mem_90370.references = NULL;
    
    struct memblock mem_param_90368;
    
    mem_param_90368.references = NULL;
    
    struct memblock mem_param_90365;
    
    mem_param_90365.references = NULL;
    
    struct memblock mem_param_90362;
    
    mem_param_90362.references = NULL;
    
    struct memblock mem_param_90359;
    
    mem_param_90359.references = NULL;
    
    struct memblock mem_param_90356;
    
    mem_param_90356.references = NULL;
    
    struct memblock ext_mem_90496;
    
    ext_mem_90496.references = NULL;
    
    struct memblock ext_mem_90497;
    
    ext_mem_90497.references = NULL;
    
    struct memblock ext_mem_90498;
    
    ext_mem_90498.references = NULL;
    
    struct memblock ext_mem_90499;
    
    ext_mem_90499.references = NULL;
    
    struct memblock ext_mem_90500;
    
    ext_mem_90500.references = NULL;
    
    struct memblock mem_90321;
    
    mem_90321.references = NULL;
    
    struct memblock ext_mem_90332;
    
    ext_mem_90332.references = NULL;
    
    struct memblock mem_90309;
    
    mem_90309.references = NULL;
    
    struct memblock mem_90306;
    
    mem_90306.references = NULL;
    
    struct memblock mem_90304;
    
    mem_90304.references = NULL;
    
    struct memblock ext_mem_90346;
    
    ext_mem_90346.references = NULL;
    
    struct memblock ext_mem_90349;
    
    ext_mem_90349.references = NULL;
    
    struct memblock ext_mem_90352;
    
    ext_mem_90352.references = NULL;
    
    struct memblock mem_90271;
    
    mem_90271.references = NULL;
    
    struct memblock ext_mem_90282;
    
    ext_mem_90282.references = NULL;
    
    struct memblock mem_90259;
    
    mem_90259.references = NULL;
    
    struct memblock mem_90256;
    
    mem_90256.references = NULL;
    
    struct memblock mem_90254;
    
    mem_90254.references = NULL;
    
    struct memblock ext_mem_90296;
    
    ext_mem_90296.references = NULL;
    
    struct memblock ext_mem_90299;
    
    ext_mem_90299.references = NULL;
    
    struct memblock ext_mem_90302;
    
    ext_mem_90302.references = NULL;
    
    struct memblock mem_90246;
    
    mem_90246.references = NULL;
    
    struct memblock mem_90238;
    
    mem_90238.references = NULL;
    
    struct memblock ext_mem_90503;
    
    ext_mem_90503.references = NULL;
    
    struct memblock ext_mem_90506;
    
    ext_mem_90506.references = NULL;
    
    struct memblock ext_mem_90509;
    
    ext_mem_90509.references = NULL;
    
    struct memblock ext_mem_90512;
    
    ext_mem_90512.references = NULL;
    
    struct memblock ext_mem_90516;
    
    ext_mem_90516.references = NULL;
    
    struct memblock mem_param_tmp_91432;
    
    mem_param_tmp_91432.references = NULL;
    
    struct memblock mem_param_tmp_91431;
    
    mem_param_tmp_91431.references = NULL;
    
    struct memblock mem_param_tmp_91430;
    
    mem_param_tmp_91430.references = NULL;
    
    struct memblock mem_param_tmp_91429;
    
    mem_param_tmp_91429.references = NULL;
    
    struct memblock mem_param_tmp_91428;
    
    mem_param_tmp_91428.references = NULL;
    
    struct memblock mem_param_tmp_91427;
    
    mem_param_tmp_91427.references = NULL;
    
    struct memblock mem_param_tmp_91426;
    
    mem_param_tmp_91426.references = NULL;
    
    struct memblock mem_param_tmp_91425;
    
    mem_param_tmp_91425.references = NULL;
    
    struct memblock mem_param_tmp_91424;
    
    mem_param_tmp_91424.references = NULL;
    
    struct memblock mem_90176;
    
    mem_90176.references = NULL;
    
    struct memblock ext_mem_90187;
    
    ext_mem_90187.references = NULL;
    
    struct memblock mem_90164;
    
    mem_90164.references = NULL;
    
    struct memblock mem_90161;
    
    mem_90161.references = NULL;
    
    struct memblock mem_90159;
    
    mem_90159.references = NULL;
    
    struct memblock ext_mem_90201;
    
    ext_mem_90201.references = NULL;
    
    struct memblock ext_mem_90204;
    
    ext_mem_90204.references = NULL;
    
    struct memblock ext_mem_90207;
    
    ext_mem_90207.references = NULL;
    
    struct memblock mem_90126;
    
    mem_90126.references = NULL;
    
    struct memblock ext_mem_90137;
    
    ext_mem_90137.references = NULL;
    
    struct memblock mem_90114;
    
    mem_90114.references = NULL;
    
    struct memblock mem_90111;
    
    mem_90111.references = NULL;
    
    struct memblock mem_90109;
    
    mem_90109.references = NULL;
    
    struct memblock ext_mem_90151;
    
    ext_mem_90151.references = NULL;
    
    struct memblock ext_mem_90154;
    
    ext_mem_90154.references = NULL;
    
    struct memblock ext_mem_90157;
    
    ext_mem_90157.references = NULL;
    
    struct memblock mem_90101;
    
    mem_90101.references = NULL;
    
    struct memblock mem_90093;
    
    mem_90093.references = NULL;
    
    struct memblock mem_param_90091;
    
    mem_param_90091.references = NULL;
    
    struct memblock mem_param_90088;
    
    mem_param_90088.references = NULL;
    
    struct memblock mem_param_90085;
    
    mem_param_90085.references = NULL;
    
    struct memblock mem_param_90082;
    
    mem_param_90082.references = NULL;
    
    struct memblock mem_param_90079;
    
    mem_param_90079.references = NULL;
    
    struct memblock mem_param_90075;
    
    mem_param_90075.references = NULL;
    
    struct memblock mem_param_90072;
    
    mem_param_90072.references = NULL;
    
    struct memblock mem_param_90069;
    
    mem_param_90069.references = NULL;
    
    struct memblock mem_param_90066;
    
    mem_param_90066.references = NULL;
    
    struct memblock ext_mem_90228;
    
    ext_mem_90228.references = NULL;
    
    struct memblock ext_mem_90229;
    
    ext_mem_90229.references = NULL;
    
    struct memblock ext_mem_90230;
    
    ext_mem_90230.references = NULL;
    
    struct memblock ext_mem_90231;
    
    ext_mem_90231.references = NULL;
    
    struct memblock ext_mem_90232;
    
    ext_mem_90232.references = NULL;
    
    struct memblock ext_mem_90233;
    
    ext_mem_90233.references = NULL;
    
    struct memblock ext_mem_90234;
    
    ext_mem_90234.references = NULL;
    
    struct memblock ext_mem_90235;
    
    ext_mem_90235.references = NULL;
    
    struct memblock ext_mem_90236;
    
    ext_mem_90236.references = NULL;
    
    struct memblock mem_90031;
    
    mem_90031.references = NULL;
    
    struct memblock ext_mem_90042;
    
    ext_mem_90042.references = NULL;
    
    struct memblock mem_90019;
    
    mem_90019.references = NULL;
    
    struct memblock mem_90016;
    
    mem_90016.references = NULL;
    
    struct memblock mem_90014;
    
    mem_90014.references = NULL;
    
    struct memblock ext_mem_90056;
    
    ext_mem_90056.references = NULL;
    
    struct memblock ext_mem_90059;
    
    ext_mem_90059.references = NULL;
    
    struct memblock ext_mem_90062;
    
    ext_mem_90062.references = NULL;
    
    struct memblock mem_89981;
    
    mem_89981.references = NULL;
    
    struct memblock ext_mem_89992;
    
    ext_mem_89992.references = NULL;
    
    struct memblock mem_89969;
    
    mem_89969.references = NULL;
    
    struct memblock mem_89966;
    
    mem_89966.references = NULL;
    
    struct memblock mem_89964;
    
    mem_89964.references = NULL;
    
    struct memblock ext_mem_90006;
    
    ext_mem_90006.references = NULL;
    
    struct memblock ext_mem_90009;
    
    ext_mem_90009.references = NULL;
    
    struct memblock ext_mem_90012;
    
    ext_mem_90012.references = NULL;
    
    struct memblock mem_param_89844;
    
    mem_param_89844.references = NULL;
    
    struct memblock mem_param_89840;
    
    mem_param_89840.references = NULL;
    
    struct memblock mem_param_89837;
    
    mem_param_89837.references = NULL;
    
    struct memblock ext_mem_90786;
    
    ext_mem_90786.references = NULL;
    
    struct memblock ext_mem_90787;
    
    ext_mem_90787.references = NULL;
    
    struct memblock ext_mem_90788;
    
    ext_mem_90788.references = NULL;
    
    struct memblock mem_param_tmp_91319;
    
    mem_param_tmp_91319.references = NULL;
    
    struct memblock mem_param_tmp_91318;
    
    mem_param_tmp_91318.references = NULL;
    
    struct memblock mem_param_tmp_91317;
    
    mem_param_tmp_91317.references = NULL;
    
    struct memblock mem_param_tmp_91316;
    
    mem_param_tmp_91316.references = NULL;
    
    struct memblock mem_param_tmp_91315;
    
    mem_param_tmp_91315.references = NULL;
    
    struct memblock mem_89749;
    
    mem_89749.references = NULL;
    
    struct memblock ext_mem_89760;
    
    ext_mem_89760.references = NULL;
    
    struct memblock mem_89737;
    
    mem_89737.references = NULL;
    
    struct memblock mem_89734;
    
    mem_89734.references = NULL;
    
    struct memblock mem_89732;
    
    mem_89732.references = NULL;
    
    struct memblock ext_mem_89774;
    
    ext_mem_89774.references = NULL;
    
    struct memblock ext_mem_89777;
    
    ext_mem_89777.references = NULL;
    
    struct memblock ext_mem_89780;
    
    ext_mem_89780.references = NULL;
    
    struct memblock mem_89699;
    
    mem_89699.references = NULL;
    
    struct memblock ext_mem_89710;
    
    ext_mem_89710.references = NULL;
    
    struct memblock mem_89687;
    
    mem_89687.references = NULL;
    
    struct memblock mem_89684;
    
    mem_89684.references = NULL;
    
    struct memblock mem_89682;
    
    mem_89682.references = NULL;
    
    struct memblock ext_mem_89724;
    
    ext_mem_89724.references = NULL;
    
    struct memblock ext_mem_89727;
    
    ext_mem_89727.references = NULL;
    
    struct memblock ext_mem_89730;
    
    ext_mem_89730.references = NULL;
    
    struct memblock mem_89674;
    
    mem_89674.references = NULL;
    
    struct memblock mem_89666;
    
    mem_89666.references = NULL;
    
    struct memblock mem_param_89664;
    
    mem_param_89664.references = NULL;
    
    struct memblock mem_param_89661;
    
    mem_param_89661.references = NULL;
    
    struct memblock mem_param_89658;
    
    mem_param_89658.references = NULL;
    
    struct memblock mem_param_89655;
    
    mem_param_89655.references = NULL;
    
    struct memblock mem_param_89652;
    
    mem_param_89652.references = NULL;
    
    struct memblock ext_mem_89792;
    
    ext_mem_89792.references = NULL;
    
    struct memblock ext_mem_89793;
    
    ext_mem_89793.references = NULL;
    
    struct memblock ext_mem_89794;
    
    ext_mem_89794.references = NULL;
    
    struct memblock ext_mem_89795;
    
    ext_mem_89795.references = NULL;
    
    struct memblock ext_mem_89796;
    
    ext_mem_89796.references = NULL;
    
    struct memblock mem_89617;
    
    mem_89617.references = NULL;
    
    struct memblock ext_mem_89628;
    
    ext_mem_89628.references = NULL;
    
    struct memblock mem_89605;
    
    mem_89605.references = NULL;
    
    struct memblock mem_89602;
    
    mem_89602.references = NULL;
    
    struct memblock mem_89600;
    
    mem_89600.references = NULL;
    
    struct memblock ext_mem_89642;
    
    ext_mem_89642.references = NULL;
    
    struct memblock ext_mem_89645;
    
    ext_mem_89645.references = NULL;
    
    struct memblock ext_mem_89648;
    
    ext_mem_89648.references = NULL;
    
    struct memblock mem_89567;
    
    mem_89567.references = NULL;
    
    struct memblock ext_mem_89578;
    
    ext_mem_89578.references = NULL;
    
    struct memblock mem_89555;
    
    mem_89555.references = NULL;
    
    struct memblock mem_89552;
    
    mem_89552.references = NULL;
    
    struct memblock mem_89550;
    
    mem_89550.references = NULL;
    
    struct memblock ext_mem_89592;
    
    ext_mem_89592.references = NULL;
    
    struct memblock ext_mem_89595;
    
    ext_mem_89595.references = NULL;
    
    struct memblock ext_mem_89598;
    
    ext_mem_89598.references = NULL;
    
    struct memblock mem_89950;
    
    mem_89950.references = NULL;
    
    struct memblock mem_89948;
    
    mem_89948.references = NULL;
    
    struct memblock mem_89918;
    
    mem_89918.references = NULL;
    
    struct memblock mem_89915;
    
    mem_89915.references = NULL;
    
    struct memblock mem_89913;
    
    mem_89913.references = NULL;
    
    struct memblock mem_89818;
    
    mem_89818.references = NULL;
    
    struct memblock mem_89542;
    
    mem_89542.references = NULL;
    
    struct memblock mem_89534;
    
    mem_89534.references = NULL;
    
    struct memblock mem_89510;
    
    mem_89510.references = NULL;
    
    struct memblock mem_89499;
    
    mem_89499.references = NULL;
    
    struct memblock mem_89451;
    
    mem_89451.references = NULL;
    
    struct memblock mem_89418;
    
    mem_89418.references = NULL;
    
    struct memblock mem_89415;
    
    mem_89415.references = NULL;
    
    struct memblock ext_mem_89412;
    
    ext_mem_89412.references = NULL;
    
    struct memblock ext_mem_89413;
    
    ext_mem_89413.references = NULL;
    
    struct memblock mem_out_91249;
    
    mem_out_91249.references = NULL;
    
    int64_t prim_out_91250;
    int64_t zbzg_lhs_52612;
    
    if (futrts_pairs_11446(ctx, &ext_mem_89413, &ext_mem_89412, &zbzg_lhs_52612, k_34472) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int64_t bytes_89414 = (int64_t) 8 * m_34473;
    int64_t bytes_89417 = (int64_t) 40 * zbzg_lhs_52612;
    int64_t bytes_89448 = m_34473 * bytes_89414;
    double i64_res_52609 = sitofp_i64_f64(m_34473);
    double replicate_arg1_52610 = 1.0 / i64_res_52609;
    double neg_res_52615 = -eps_34476;
    double zp_res_52616 = 1.0 + tol_outerloop_34481;
    double neg_res_52617 = -rho1_34474;
    double zp_res_52618 = rho1_34474 + eps_34476;
    double zs_res_52619 = neg_res_52617 / zp_res_52618;
    double zs_res_52620 = neg_res_52615 / zp_res_52618;
    double neg_res_52621 = -rho2_34475;
    double zp_res_52622 = rho2_34475 + eps_34476;
    double zs_res_52623 = neg_res_52621 / zp_res_52622;
    double zs_res_52624 = neg_res_52615 / zp_res_52622;
    double zp_res_52625 = rho2_34475 + zp_res_52618;
    
    if (memblock_alloc(ctx, &mem_89415, bytes_89414, "mem_89415")) {
        err = 1;
        goto cleanup;
    }
    for (int64_t nest_i_91251 = 0; nest_i_91251 < m_34473; nest_i_91251++) {
        ((double *) mem_89415.mem)[nest_i_91251] = 1.0;
    }
    if (memblock_alloc(ctx, &mem_89418, bytes_89417, "mem_89418")) {
        err = 1;
        goto cleanup;
    }
    
    bool loop_nonempty_89380 = slt64((int64_t) 0, m_34473);
    double zs_res_53000 = 1.0 / exp_absorb_cutoff_34478;
    double zp_res_79079 = 1.0 + tol_sinkhorn_34480;
    
    if (mem_89424_cached_sizze_91849 < bytes_89414) {
        err = lexical_realloc(ctx, &mem_89424, &mem_89424_cached_sizze_91849, bytes_89414);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89426_cached_sizze_91850 < bytes_89414) {
        err = lexical_realloc(ctx, &mem_89426, &mem_89426_cached_sizze_91850, bytes_89414);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89440_cached_sizze_91851 < bytes_89414) {
        err = lexical_realloc(ctx, &mem_89440, &mem_89440_cached_sizze_91851, bytes_89414);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89449_cached_sizze_91852 < bytes_89448) {
        err = lexical_realloc(ctx, &mem_89449, &mem_89449_cached_sizze_91852, bytes_89448);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89451, bytes_89414, "mem_89451")) {
        err = 1;
        goto cleanup;
    }
    if (mem_89460_cached_sizze_91853 < bytes_89414) {
        err = lexical_realloc(ctx, &mem_89460, &mem_89460_cached_sizze_91853, bytes_89414);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89462_cached_sizze_91854 < bytes_89414) {
        err = lexical_realloc(ctx, &mem_89462, &mem_89462_cached_sizze_91854, bytes_89414);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89476_cached_sizze_91855 < bytes_89414) {
        err = lexical_realloc(ctx, &mem_89476, &mem_89476_cached_sizze_91855, bytes_89414);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89499, bytes_89414, "mem_89499")) {
        err = 1;
        goto cleanup;
    }
    if (mem_89507_cached_sizze_91856 < bytes_89414) {
        err = lexical_realloc(ctx, &mem_89507, &mem_89507_cached_sizze_91856, bytes_89414);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89510, bytes_89448, "mem_89510")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89534, bytes_89414, "mem_89534")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89542, bytes_89414, "mem_89542")) {
        err = 1;
        goto cleanup;
    }
    if (mem_89799_cached_sizze_91857 < bytes_89448) {
        err = lexical_realloc(ctx, &mem_89799, &mem_89799_cached_sizze_91857, bytes_89448);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89818, bytes_89448, "mem_89818")) {
        err = 1;
        goto cleanup;
    }
    if (mem_89846_cached_sizze_91858 < bytes_89414) {
        err = lexical_realloc(ctx, &mem_89846, &mem_89846_cached_sizze_91858, bytes_89414);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89854_cached_sizze_91859 < bytes_89414) {
        err = lexical_realloc(ctx, &mem_89854, &mem_89854_cached_sizze_91859, bytes_89414);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89862_cached_sizze_91860 < bytes_89414) {
        err = lexical_realloc(ctx, &mem_89862, &mem_89862_cached_sizze_91860, bytes_89414);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89871_cached_sizze_91861 < bytes_89448) {
        err = lexical_realloc(ctx, &mem_89871, &mem_89871_cached_sizze_91861, bytes_89448);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89873_cached_sizze_91862 < bytes_89414) {
        err = lexical_realloc(ctx, &mem_89873, &mem_89873_cached_sizze_91862, bytes_89414);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89882_cached_sizze_91863 < bytes_89414) {
        err = lexical_realloc(ctx, &mem_89882, &mem_89882_cached_sizze_91863, bytes_89414);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_89890_cached_sizze_91864 < bytes_89414) {
        err = lexical_realloc(ctx, &mem_89890, &mem_89890_cached_sizze_91864, bytes_89414);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89913, bytes_89414, "mem_89913")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89915, bytes_89414, "mem_89915")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89918, bytes_89448, "mem_89918")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89948, bytes_89414, "mem_89948")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc(ctx, &mem_89950, bytes_89414, "mem_89950")) {
        err = 1;
        goto cleanup;
    }
    if (mem_90521_cached_sizze_91865 < bytes_89448) {
        err = lexical_realloc(ctx, &mem_90521, &mem_90521_cached_sizze_91865, bytes_89448);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_90790_cached_sizze_91882 < bytes_89414) {
        err = lexical_realloc(ctx, &mem_90790, &mem_90790_cached_sizze_91882, bytes_89414);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_90792_cached_sizze_91883 < bytes_89414) {
        err = lexical_realloc(ctx, &mem_90792, &mem_90792_cached_sizze_91883, bytes_89414);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_90794_cached_sizze_91884 < bytes_89414) {
        err = lexical_realloc(ctx, &mem_90794, &mem_90794_cached_sizze_91884, bytes_89414);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_90805_cached_sizze_91885 < bytes_89414) {
        err = lexical_realloc(ctx, &mem_90805, &mem_90805_cached_sizze_91885, bytes_89414);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_90822_cached_sizze_91886 < bytes_89414) {
        err = lexical_realloc(ctx, &mem_90822, &mem_90822_cached_sizze_91886, bytes_89414);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_90824_cached_sizze_91887 < bytes_89414) {
        err = lexical_realloc(ctx, &mem_90824, &mem_90824_cached_sizze_91887, bytes_89414);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (mem_90826_cached_sizze_91888 < bytes_89414) {
        err = lexical_realloc(ctx, &mem_90826, &mem_90826_cached_sizze_91888, bytes_89414);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    for (int64_t i_89364 = 0; i_89364 < zbzg_lhs_52612; i_89364++) {
        int64_t eta_p_52628 = ((int64_t *) ext_mem_89413.mem)[i_89364];
        int64_t eta_p_52629 = ((int64_t *) ext_mem_89412.mem)[i_89364];
        bool x_52630 = sle64((int64_t) 0, eta_p_52629);
        bool y_52631 = slt64(eta_p_52629, k_34472);
        bool bounds_check_52632 = x_52630 && y_52631;
        bool index_certs_52633;
        
        if (!bounds_check_52632) {
            set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) eta_p_52629, "] out of bounds for array of shape [", (long long) k_34472, "].", "-> #0  unbalanced_gw.fut:164:43-52\n   #1  /prelude/functional.fut:9:44-45\n   #2  unbalanced_gw.fut:162:6-165:84\n   #3  unbalanced_gw.fut:194:1-197:45\n"));
            err = FUTHARK_PROGRAM_ERROR;
            goto cleanup;
        }
        
        bool x_52636 = sle64((int64_t) 0, eta_p_52628);
        bool y_52637 = slt64(eta_p_52628, k_34472);
        bool bounds_check_52638 = x_52636 && y_52637;
        bool index_certs_52639;
        
        if (!bounds_check_52638) {
            set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) eta_p_52628, "] out of bounds for array of shape [", (long long) k_34472, "].", "-> #0  unbalanced_gw.fut:164:28-37\n   #1  /prelude/functional.fut:9:44-45\n   #2  unbalanced_gw.fut:162:6-165:84\n   #3  unbalanced_gw.fut:194:1-197:45\n"));
            err = FUTHARK_PROGRAM_ERROR;
            goto cleanup;
        }
        
        double zt_res_52646 = replicate_arg1_52610 * replicate_arg1_52610;
        double defunc_res_80156;
        double defunc_res_80157;
        double defunc_res_80158;
        double defunc_res_80159;
        double defunc_res_80160;
        double defunc_res_80161;
        double redout_88606;
        double redout_88607;
        double redout_88608;
        double redout_88609;
        double redout_88610;
        double redout_88611;
        
        redout_88606 = 0.0;
        redout_88607 = 0.0;
        redout_88608 = 0.0;
        redout_88609 = 0.0;
        redout_88610 = 0.0;
        redout_88611 = 0.0;
        for (int64_t i_88612 = 0; i_88612 < m_34473; i_88612++) {
            double zp_res_52653 = zt_res_52646 + redout_88606;
            double zp_res_52678 = zt_res_52646 + redout_88607;
            double zp_res_52769 = zt_res_52646 + redout_88608;
            double zp_res_52855 = zt_res_52646 + redout_88609;
            double zp_res_53307 = zt_res_52646 + redout_88610;
            double zp_res_53415 = zt_res_52646 + redout_88611;
            double redout_tmp_91253 = zp_res_52653;
            double redout_tmp_91254 = zp_res_52678;
            double redout_tmp_91255 = zp_res_52769;
            double redout_tmp_91256 = zp_res_52855;
            double redout_tmp_91257 = zp_res_53307;
            double redout_tmp_91258 = zp_res_53415;
            
            redout_88606 = redout_tmp_91253;
            redout_88607 = redout_tmp_91254;
            redout_88608 = redout_tmp_91255;
            redout_88609 = redout_tmp_91256;
            redout_88610 = redout_tmp_91257;
            redout_88611 = redout_tmp_91258;
        }
        defunc_res_80156 = redout_88606;
        defunc_res_80157 = redout_88607;
        defunc_res_80158 = redout_88608;
        defunc_res_80159 = redout_88609;
        defunc_res_80160 = redout_88610;
        defunc_res_80161 = redout_88611;
        
        double defunc_res_80163;
        double redout_88613 = 0.0;
        
        for (int64_t i_88614 = 0; i_88614 < m_34473; i_88614++) {
            double zp_res_52658 = defunc_res_80156 + redout_88613;
            double redout_tmp_91259 = zp_res_52658;
            
            redout_88613 = redout_tmp_91259;
        }
        defunc_res_80163 = redout_88613;
        
        double log_res_52661 = futrts_log64(replicate_arg1_52610);
        double zt_res_52662 = eps_34476 * defunc_res_80163;
        double zt_res_52665 = log_res_52661 * zt_res_52662;
        double defunc_res_78766;
        double defunc_res_78767;
        double defunc_res_78768;
        double defunc_res_78769;
        double redout_88615;
        double redout_88616;
        double redout_88617;
        double redout_88618;
        
        redout_88615 = 0.0;
        redout_88616 = 0.0;
        redout_88617 = 0.0;
        redout_88618 = 0.0;
        for (int64_t i_88619 = 0; i_88619 < m_34473; i_88619++) {
            double zp_res_57228 = zt_res_52646 + redout_88615;
            double zp_res_57234 = zt_res_52646 + redout_88616;
            double zp_res_57247 = zt_res_52646 + redout_88617;
            double zp_res_57254 = zt_res_52646 + redout_88618;
            double redout_tmp_91260 = zp_res_57228;
            double redout_tmp_91261 = zp_res_57234;
            double redout_tmp_91262 = zp_res_57247;
            double redout_tmp_91263 = zp_res_57254;
            
            redout_88615 = redout_tmp_91260;
            redout_88616 = redout_tmp_91261;
            redout_88617 = redout_tmp_91262;
            redout_88618 = redout_tmp_91263;
        }
        defunc_res_78766 = redout_88615;
        defunc_res_78767 = redout_88616;
        defunc_res_78768 = redout_88617;
        defunc_res_78769 = redout_88618;
        
        bool zeze_res_57236 = defunc_res_78767 == 0.0;
        double zs_res_57238 = defunc_res_78767 / replicate_arg1_52610;
        double log_res_57239 = futrts_log64(zs_res_57238);
        double zt_res_57240 = log_res_57239 * defunc_res_78767;
        double klu_res_57237;
        
        if (zeze_res_57236) {
            klu_res_57237 = 0.0;
        } else {
            klu_res_57237 = zt_res_57240;
        }
        
        bool zeze_res_57256 = defunc_res_78769 == 0.0;
        double zs_res_57258 = defunc_res_78769 / replicate_arg1_52610;
        double log_res_57259 = futrts_log64(zs_res_57258);
        double zt_res_57260 = log_res_57259 * defunc_res_78769;
        double klu_res_57257;
        
        if (zeze_res_57256) {
            klu_res_57257 = 0.0;
        } else {
            klu_res_57257 = zt_res_57260;
        }
        
        double defunc_res_80165;
        double defunc_res_80166;
        double redout_88622;
        double redout_88623;
        
        redout_88622 = 0.0;
        redout_88623 = 0.0;
        for (int64_t i_88626 = 0; i_88626 < m_34473; i_88626++) {
            double zp_res_52803 = klu_res_57237 + redout_88622;
            double zp_res_53477 = klu_res_57257 + redout_88623;
            
            ((double *) mem_89424)[i_88626] = defunc_res_78768;
            ((double *) mem_89426)[i_88626] = defunc_res_78766;
            
            double redout_tmp_91264 = zp_res_52803;
            double redout_tmp_91265 = zp_res_53477;
            
            redout_88622 = redout_tmp_91264;
            redout_88623 = redout_tmp_91265;
        }
        defunc_res_80165 = redout_88622;
        defunc_res_80166 = redout_88623;
        
        double defunc_res_80169;
        double redout_88629 = 0.0;
        
        for (int64_t i_88630 = 0; i_88630 < m_34473; i_88630++) {
            double zp_res_52860 = defunc_res_80159 + redout_88629;
            double redout_tmp_91268 = zp_res_52860;
            
            redout_88629 = redout_tmp_91268;
        }
        defunc_res_80169 = redout_88629;
        
        double zt_res_52804 = rho2_34475 * defunc_res_80165;
        bool zeze_res_52773 = defunc_res_80158 == 0.0;
        double zs_res_52775 = defunc_res_80158 / replicate_arg1_52610;
        double log_res_52776 = futrts_log64(zs_res_52775);
        double zt_res_52777 = log_res_52776 * defunc_res_80158;
        double klu_res_52774;
        
        if (zeze_res_52773) {
            klu_res_52774 = 0.0;
        } else {
            klu_res_52774 = zt_res_52777;
        }
        
        double defunc_res_80171;
        double redout_88631 = 0.0;
        
        for (int64_t i_88632 = 0; i_88632 < m_34473; i_88632++) {
            double zp_res_52782 = klu_res_52774 + redout_88631;
            double redout_tmp_91269 = zp_res_52782;
            
            redout_88631 = redout_tmp_91269;
        }
        defunc_res_80171 = redout_88631;
        
        double zt_res_52783 = rho1_34474 * defunc_res_80171;
        double zp_res_52828 = zt_res_52783 + zt_res_52804;
        bool zeze_res_52812 = zt_res_52646 == 0.0;
        double zs_res_52814 = zt_res_52646 / zt_res_52646;
        double log_res_52815 = futrts_log64(zs_res_52814);
        double zt_res_52816 = zt_res_52646 * log_res_52815;
        double klu_res_52813;
        
        if (zeze_res_52812) {
            klu_res_52813 = 0.0;
        } else {
            klu_res_52813 = zt_res_52816;
        }
        
        double defunc_res_80173;
        double redout_88633 = 0.0;
        
        for (int64_t i_88634 = 0; i_88634 < m_34473; i_88634++) {
            double zp_res_52821 = klu_res_52813 + redout_88633;
            double redout_tmp_91270 = zp_res_52821;
            
            redout_88633 = redout_tmp_91270;
        }
        defunc_res_80173 = redout_88633;
        
        double defunc_res_80175;
        double redout_88635 = 0.0;
        
        for (int64_t i_88636 = 0; i_88636 < m_34473; i_88636++) {
            double zp_res_52826 = defunc_res_80173 + redout_88635;
            double redout_tmp_91271 = zp_res_52826;
            
            redout_88635 = redout_tmp_91271;
        }
        defunc_res_80175 = redout_88635;
        
        double zt_res_52827 = eps_34476 * defunc_res_80175;
        double zp_res_52829 = zt_res_52827 + zp_res_52828;
        double defunc_0_reduce_res_80177;
        double redout_88641 = 0.0;
        
        for (int64_t i_88643 = 0; i_88643 < m_34473; i_88643++) {
            double eta_p_57513 = ((double *) mem_89424)[i_88643];
            double defunc_0_reduce_res_78770;
            double defunc_0_reduce_res_78771;
            double redout_88637;
            double redout_88638;
            
            redout_88637 = 0.0;
            redout_88638 = 0.0;
            for (int64_t i_88639 = 0; i_88639 < m_34473; i_88639++) {
                double eta_p_58500 = ((double *) A_mem_89411.mem)[eta_p_52629 * (m_34473 * m_34473) + i_88643 * m_34473 + i_88639];
                double eta_p_58501 = ((double *) mem_89424)[i_88639];
                double eta_p_58502 = ((double *) mem_89426)[i_88639];
                double zt_res_58505 = eta_p_58500 * eta_p_58500;
                double zt_res_58507 = eta_p_58502 * zt_res_58505;
                double zt_res_58512 = eta_p_58501 * zt_res_58505;
                double zp_res_57527 = zt_res_58507 + redout_88637;
                double zp_res_57541 = zt_res_58512 + redout_88638;
                double redout_tmp_91274 = zp_res_57527;
                double redout_tmp_91275 = zp_res_57541;
                
                redout_88637 = redout_tmp_91274;
                redout_88638 = redout_tmp_91275;
            }
            defunc_0_reduce_res_78770 = redout_88637;
            defunc_0_reduce_res_78771 = redout_88638;
            
            double zt_res_57543 = eta_p_57513 * defunc_0_reduce_res_78771;
            double zp_res_53362 = zt_res_57543 + redout_88641;
            
            ((double *) mem_89440)[i_88643] = defunc_0_reduce_res_78770;
            
            double redout_tmp_91272 = zp_res_53362;
            
            redout_88641 = redout_tmp_91272;
        }
        defunc_0_reduce_res_80177 = redout_88641;
        
        double defunc_0_reduce_res_80179;
        double defunc_res_80180;
        double redout_88673;
        double redout_88674;
        
        redout_88673 = 0.0;
        redout_88674 = 0.0;
        for (int64_t i_88677 = 0; i_88677 < m_34473; i_88677++) {
            double defunc_0_reduce_res_78776;
            double defunc_0_reduce_res_78777;
            double redout_88645;
            double redout_88646;
            
            redout_88645 = 0.0;
            redout_88646 = 0.0;
            for (int64_t i_88647 = 0; i_88647 < m_34473; i_88647++) {
                double eta_p_58339 = ((double *) A_mem_89411.mem)[eta_p_52628 * (m_34473 * m_34473) + i_88677 * m_34473 + i_88647];
                double zt_res_58342 = eta_p_58339 * eta_p_58339;
                double zt_res_58344 = zt_res_58342 * defunc_res_80157;
                double zt_res_58349 = zt_res_58342 * defunc_res_80160;
                double zp_res_57387 = zt_res_58344 + redout_88645;
                double zp_res_57472 = zt_res_58349 + redout_88646;
                double redout_tmp_91280 = zp_res_57387;
                double redout_tmp_91281 = zp_res_57472;
                
                redout_88645 = redout_tmp_91280;
                redout_88646 = redout_tmp_91281;
            }
            defunc_0_reduce_res_78776 = redout_88645;
            defunc_0_reduce_res_78777 = redout_88646;
            
            double defunc_0_reduce_res_78772;
            double defunc_0_reduce_res_78773;
            
            if (loop_nonempty_89380) {
                double x_89381;
                double x_89382;
                double redout_88648;
                double redout_88649;
                
                redout_88648 = 0.0;
                redout_88649 = 0.0;
                for (int64_t i_88650 = 0; i_88650 < m_34473; i_88650++) {
                    double eta_p_58430 = ((double *) A_mem_89411.mem)[eta_p_52628 * (m_34473 * m_34473) + i_88677 * m_34473 + i_88650];
                    double zt_res_58434 = zt_res_52646 * eta_p_58430;
                    double zp_res_58362 = zt_res_58434 + redout_88648;
                    double zp_res_58372 = zt_res_58434 + redout_88649;
                    double redout_tmp_91282 = zp_res_58362;
                    double redout_tmp_91283 = zp_res_58372;
                    
                    redout_88648 = redout_tmp_91282;
                    redout_88649 = redout_tmp_91283;
                }
                x_89381 = redout_88648;
                x_89382 = redout_88649;
                defunc_0_reduce_res_78772 = x_89381;
                defunc_0_reduce_res_78773 = x_89382;
            } else {
                defunc_0_reduce_res_78772 = 0.0;
                defunc_0_reduce_res_78773 = 0.0;
            }
            for (int64_t i_88655 = 0; i_88655 < m_34473; i_88655++) {
                ((double *) mem_89460)[i_88655] = defunc_0_reduce_res_78773;
                ((double *) mem_89462)[i_88655] = defunc_0_reduce_res_78772;
            }
            
            double defunc_0_reduce_res_78780;
            double defunc_0_reduce_res_78781;
            double redout_88662;
            double redout_88663;
            
            redout_88662 = INFINITY;
            redout_88663 = 0.0;
            for (int64_t i_88665 = 0; i_88665 < m_34473; i_88665++) {
                double eta_p_wasfree_58376 = ((double *) mem_89440)[i_88665];
                double defunc_0_reduce_res_78774;
                double defunc_0_reduce_res_78775;
                double redout_88658;
                double redout_88659;
                
                redout_88658 = 0.0;
                redout_88659 = 0.0;
                for (int64_t i_88660 = 0; i_88660 < m_34473; i_88660++) {
                    double eta_p_58451 = ((double *) mem_89460)[i_88660];
                    double eta_p_58452 = ((double *) A_mem_89411.mem)[eta_p_52629 * (m_34473 * m_34473) + i_88660 * m_34473 + i_88665];
                    double eta_p_58453 = ((double *) mem_89462)[i_88660];
                    double zt_res_58455 = eta_p_58452 * eta_p_58453;
                    double zt_res_58457 = eta_p_58451 * eta_p_58452;
                    double zp_res_58386 = zt_res_58455 + redout_88658;
                    double zp_res_58415 = zt_res_58457 + redout_88659;
                    double redout_tmp_91289 = zp_res_58386;
                    double redout_tmp_91290 = zp_res_58415;
                    
                    redout_88658 = redout_tmp_91289;
                    redout_88659 = redout_tmp_91290;
                }
                defunc_0_reduce_res_78774 = redout_88658;
                defunc_0_reduce_res_78775 = redout_88659;
                
                double zt_res_58388 = -2.0 * defunc_0_reduce_res_78774;
                double zp_res_58390 = zt_res_58388 + defunc_0_reduce_res_78776;
                double zp_res_58392 = eta_p_wasfree_58376 + zp_res_58390;
                double zp_res_58394 = zp_res_52829 + zp_res_58392;
                double zm_res_58396 = zp_res_58394 - zt_res_52665;
                double zm_res_58398 = zm_res_58396 - zt_res_52665;
                double zs_res_58400 = zm_res_58398 / defunc_res_80169;
                double zs_res_58402 = zs_res_58400 / neg_res_52615;
                double zm_res_58404 = safe_for_exp_34479 - zs_res_58402;
                double zt_res_58417 = zt_res_52646 * defunc_0_reduce_res_78775;
                double min_res_57454 = fmin64(zm_res_58404, redout_88662);
                double zp_res_57509 = zt_res_58417 + redout_88663;
                
                ((double *) mem_89476)[i_88665] = zs_res_58402;
                
                double redout_tmp_91286 = min_res_57454;
                double redout_tmp_91287 = zp_res_57509;
                
                redout_88662 = redout_tmp_91286;
                redout_88663 = redout_tmp_91287;
            }
            defunc_0_reduce_res_78780 = redout_88662;
            defunc_0_reduce_res_78781 = redout_88663;
            for (int64_t i_88669 = 0; i_88669 < m_34473; i_88669++) {
                double eta_p_57457 = ((double *) mem_89476)[i_88669];
                double zp_res_57458 = eta_p_57457 + defunc_0_reduce_res_78780;
                
                ((double *) mem_89449)[i_88677 * m_34473 + i_88669] = zp_res_57458;
            }
            
            double zt_res_57474 = defunc_0_reduce_res_78777 * defunc_res_80160;
            double zp_res_53338 = zt_res_57474 + redout_88673;
            double zp_res_53405 = defunc_0_reduce_res_78781 + redout_88674;
            
            ((double *) mem_89451.mem)[i_88677] = defunc_0_reduce_res_78780;
            
            double redout_tmp_91276 = zp_res_53338;
            double redout_tmp_91277 = zp_res_53405;
            
            redout_88673 = redout_tmp_91276;
            redout_88674 = redout_tmp_91277;
        }
        defunc_0_reduce_res_80179 = redout_88673;
        defunc_res_80180 = redout_88674;
        for (int64_t i_88684 = 0; i_88684 < m_34473; i_88684++) {
            double defunc_0_reduce_res_78784;
            double redout_88680 = INFINITY;
            
            for (int64_t i_88681 = 0; i_88681 < m_34473; i_88681++) {
                double eta_p_58517 = ((double *) mem_89449)[i_88681 * m_34473 + i_88684];
                double zm_res_58518 = safe_for_exp_34479 - eta_p_58517;
                double min_res_52897 = fmin64(zm_res_58518, redout_88680);
                double redout_tmp_91293 = min_res_52897;
                
                redout_88680 = redout_tmp_91293;
            }
            defunc_0_reduce_res_78784 = redout_88680;
            ((double *) mem_89499.mem)[i_88684] = defunc_0_reduce_res_78784;
        }
        for (int64_t i_88695 = 0; i_88695 < m_34473; i_88695++) {
            double eta_p_56569 = ((double *) mem_89451.mem)[i_88695];
            double defunc_0_reduce_res_78785;
            double redout_88687 = 0.0;
            
            for (int64_t i_88689 = 0; i_88689 < m_34473; i_88689++) {
                double eta_p_58526 = ((double *) mem_89449)[i_88695 * m_34473 + i_88689];
                double eta_p_wasfree_58527 = ((double *) mem_89499.mem)[i_88689];
                double zp_res_58528 = eta_p_58526 + eta_p_wasfree_58527;
                double exp_res_58530 = futrts_exp64(zp_res_58528);
                double zp_res_56585 = exp_res_58530 + redout_88687;
                
                ((double *) mem_89510.mem)[i_88695 * m_34473 + i_88689] = exp_res_58530;
                
                double redout_tmp_91296 = zp_res_56585;
                
                redout_88687 = redout_tmp_91296;
            }
            defunc_0_reduce_res_78785 = redout_88687;
            
            double zs_res_56587 = defunc_0_reduce_res_78785 / replicate_arg1_52610;
            double ztzt_res_56589 = fpow64(zs_res_56587, zs_res_52619);
            double zt_res_56591 = zs_res_52620 * eta_p_56569;
            double exp_res_56593 = futrts_exp64(zt_res_56591);
            double zt_res_56595 = ztzt_res_56589 * exp_res_56593;
            
            ((double *) mem_89507)[i_88695] = zt_res_56595;
        }
        
        bool defunc_0_reduce_res_80188;
        bool redout_88701 = 0;
        
        for (int64_t i_88703 = 0; i_88703 < m_34473; i_88703++) {
            double eta_p_56466 = ((double *) mem_89499.mem)[i_88703];
            double defunc_0_reduce_res_78787;
            double redout_88698 = 0.0;
            
            for (int64_t i_88699 = 0; i_88699 < m_34473; i_88699++) {
                double eta_p_58535 = ((double *) mem_89507)[i_88699];
                double eta_p_58536 = ((double *) mem_89510.mem)[i_88699 * m_34473 + i_88703];
                double zt_res_58537 = eta_p_58535 * eta_p_58536;
                double zp_res_56475 = zt_res_58537 + redout_88698;
                double redout_tmp_91300 = zp_res_56475;
                
                redout_88698 = redout_tmp_91300;
            }
            defunc_0_reduce_res_78787 = redout_88698;
            
            double zs_res_56477 = defunc_0_reduce_res_78787 / replicate_arg1_52610;
            double ztzt_res_56479 = fpow64(zs_res_56477, zs_res_52623);
            double zt_res_56481 = zs_res_52624 * eta_p_56466;
            double exp_res_56483 = futrts_exp64(zt_res_56481);
            double zt_res_56485 = ztzt_res_56479 * exp_res_56483;
            bool zgze_res_56487 = exp_absorb_cutoff_34478 <= zt_res_56485;
            bool defunc_0_op_res_53041 = zgze_res_56487 || redout_88701;
            
            ((double *) mem_89534.mem)[i_88703] = zt_res_56485;
            
            bool redout_tmp_91298 = defunc_0_op_res_53041;
            
            redout_88701 = redout_tmp_91298;
        }
        defunc_0_reduce_res_80188 = redout_88701;
        
        bool defunc_0_reduce_res_80191;
        bool redout_88708 = 0;
        
        for (int64_t i_88710 = 0; i_88710 < m_34473; i_88710++) {
            double eta_p_56386 = ((double *) mem_89451.mem)[i_88710];
            double defunc_0_reduce_res_78788;
            double redout_88705 = 0.0;
            
            for (int64_t i_88706 = 0; i_88706 < m_34473; i_88706++) {
                double eta_p_58541 = ((double *) mem_89534.mem)[i_88706];
                double eta_p_58542 = ((double *) mem_89510.mem)[i_88710 * m_34473 + i_88706];
                double zt_res_58543 = eta_p_58541 * eta_p_58542;
                double zp_res_56395 = zt_res_58543 + redout_88705;
                double redout_tmp_91303 = zp_res_56395;
                
                redout_88705 = redout_tmp_91303;
            }
            defunc_0_reduce_res_78788 = redout_88705;
            
            double zs_res_56397 = defunc_0_reduce_res_78788 / replicate_arg1_52610;
            double ztzt_res_56399 = fpow64(zs_res_56397, zs_res_52619);
            double zt_res_56401 = zs_res_52620 * eta_p_56386;
            double exp_res_56403 = futrts_exp64(zt_res_56401);
            double zt_res_56405 = ztzt_res_56399 * exp_res_56403;
            bool zgze_res_56407 = exp_absorb_cutoff_34478 <= zt_res_56405;
            bool defunc_0_op_res_52998 = zgze_res_56407 || redout_88708;
            
            ((double *) mem_89542.mem)[i_88710] = zt_res_56405;
            
            bool redout_tmp_91301 = defunc_0_op_res_52998;
            
            redout_88708 = redout_tmp_91301;
        }
        defunc_0_reduce_res_80191 = redout_88708;
        
        bool x_91031 = !defunc_0_reduce_res_80191;
        bool defunc_0_reduce_res_78789;
        
        if (x_91031) {
            bool x_91033;
            bool redout_88712 = 0;
            
            for (int64_t i_88713 = 0; i_88713 < m_34473; i_88713++) {
                double eta_p_58547 = ((double *) mem_89542.mem)[i_88713];
                bool zlze_res_58548 = eta_p_58547 <= zs_res_53000;
                bool defunc_0_op_res_53008 = zlze_res_58548 || redout_88712;
                bool redout_tmp_91304 = defunc_0_op_res_53008;
                
                redout_88712 = redout_tmp_91304;
            }
            x_91033 = redout_88712;
            defunc_0_reduce_res_78789 = x_91033;
        } else {
            defunc_0_reduce_res_78789 = 0;
        }
        
        bool cond_52999 = defunc_0_reduce_res_78789 || defunc_0_reduce_res_80191;
        
        if (cond_52999) {
            if (memblock_alloc(ctx, &mem_89550, bytes_89414, "mem_89550")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc(ctx, &mem_89552, bytes_89414, "mem_89552")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc(ctx, &mem_89555, bytes_89448, "mem_89555")) {
                err = 1;
                goto cleanup;
            }
            for (int64_t i_88724 = 0; i_88724 < m_34473; i_88724++) {
                double eta_p_78806 = ((double *) mem_89542.mem)[i_88724];
                double eta_p_78807 = ((double *) mem_89451.mem)[i_88724];
                bool zgze_res_78809 = exp_absorb_cutoff_34478 <= eta_p_78806;
                bool zl_res_78810 = eta_p_78806 < zs_res_53000;
                bool x_78811 = !zgze_res_78809;
                bool y_78812 = zl_res_78810 && x_78811;
                bool cond_78813 = zgze_res_78809 || y_78812;
                int64_t binop_y_89574 = m_34473 * i_88724;
                int64_t ext_89577;
                
                if (cond_78813) {
                    ext_89577 = (int64_t) 0;
                } else {
                    ext_89577 = binop_y_89574;
                }
                
                double rescale_res_78814;
                double rescale_res_78815;
                
                if (cond_78813) {
                    double log_res_78817 = futrts_log64(eta_p_78806);
                    double sqrt_res_78818 = futrts_sqrt64(eta_p_78806);
                    double zs_res_78819 = log_res_78817 / 2.0;
                    double zp_res_78820 = eta_p_78807 + zs_res_78819;
                    
                    if (memblock_alloc(ctx, &mem_89567, bytes_89414, "mem_89567")) {
                        err = 1;
                        goto cleanup;
                    }
                    for (int64_t i_88716 = 0; i_88716 < m_34473; i_88716++) {
                        double eta_p_78822 = ((double *) mem_89510.mem)[i_88724 * m_34473 + i_88716];
                        double zt_res_78823 = sqrt_res_78818 * eta_p_78822;
                        
                        ((double *) mem_89567.mem)[i_88716] = zt_res_78823;
                    }
                    if (memblock_set(ctx, &ext_mem_89578, &mem_89567, "mem_89567") != 0)
                        return 1;
                    rescale_res_78814 = sqrt_res_78818;
                    rescale_res_78815 = zp_res_78820;
                } else {
                    if (memblock_set(ctx, &ext_mem_89578, &mem_89510, "mem_89510") != 0)
                        return 1;
                    rescale_res_78814 = eta_p_78806;
                    rescale_res_78815 = eta_p_78807;
                }
                ((double *) mem_89550.mem)[i_88724] = rescale_res_78814;
                ((double *) mem_89552.mem)[i_88724] = rescale_res_78815;
                lmad_copy_8b(ctx, 1, (uint64_t *) mem_89555.mem, i_88724 * m_34473, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_89578.mem, ext_89577, (int64_t []) {(int64_t) 1}, (int64_t []) {m_34473});
                if (memblock_unref(ctx, &ext_mem_89578, "ext_mem_89578") != 0)
                    return 1;
            }
            if (memblock_set(ctx, &ext_mem_89598, &mem_89550, "mem_89550") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_89595, &mem_89552, "mem_89552") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_89592, &mem_89555, "mem_89555") != 0)
                return 1;
        } else {
            if (memblock_set(ctx, &ext_mem_89598, &mem_89542, "mem_89542") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_89595, &mem_89451, "mem_89451") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_89592, &mem_89510, "mem_89510") != 0)
                return 1;
        }
        
        bool x_91027 = !defunc_0_reduce_res_80188;
        bool defunc_0_reduce_res_78828;
        
        if (x_91027) {
            bool x_91029;
            bool redout_88728 = 0;
            
            for (int64_t i_88729 = 0; i_88729 < m_34473; i_88729++) {
                double eta_p_58590 = ((double *) mem_89534.mem)[i_88729];
                bool zlze_res_58591 = eta_p_58590 <= zs_res_53000;
                bool defunc_0_op_res_53051 = zlze_res_58591 || redout_88728;
                bool redout_tmp_91309 = defunc_0_op_res_53051;
                
                redout_88728 = redout_tmp_91309;
            }
            x_91029 = redout_88728;
            defunc_0_reduce_res_78828 = x_91029;
        } else {
            defunc_0_reduce_res_78828 = 0;
        }
        
        bool cond_53042 = defunc_0_reduce_res_78828 || defunc_0_reduce_res_80188;
        int64_t ext_89640;
        
        if (cond_53042) {
            ext_89640 = (int64_t) 1;
        } else {
            ext_89640 = m_34473;
        }
        
        int64_t ext_89639;
        
        if (cond_53042) {
            ext_89639 = m_34473;
        } else {
            ext_89639 = (int64_t) 1;
        }
        if (cond_53042) {
            if (memblock_alloc(ctx, &mem_89600, bytes_89414, "mem_89600")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc(ctx, &mem_89602, bytes_89414, "mem_89602")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc(ctx, &mem_89605, bytes_89448, "mem_89605")) {
                err = 1;
                goto cleanup;
            }
            for (int64_t i_88740 = 0; i_88740 < m_34473; i_88740++) {
                double eta_p_78847 = ((double *) mem_89534.mem)[i_88740];
                double eta_p_78848 = ((double *) mem_89499.mem)[i_88740];
                bool zgze_res_78850 = exp_absorb_cutoff_34478 <= eta_p_78847;
                bool zl_res_78851 = eta_p_78847 < zs_res_53000;
                bool x_78852 = !zgze_res_78850;
                bool y_78853 = zl_res_78851 && x_78852;
                bool cond_78854 = zgze_res_78850 || y_78853;
                int64_t ext_89627;
                
                if (cond_78854) {
                    ext_89627 = (int64_t) 0;
                } else {
                    ext_89627 = i_88740;
                }
                
                int64_t ext_89626;
                
                if (cond_78854) {
                    ext_89626 = (int64_t) 1;
                } else {
                    ext_89626 = m_34473;
                }
                
                double rescale_res_78855;
                double rescale_res_78856;
                
                if (cond_78854) {
                    double log_res_78858 = futrts_log64(eta_p_78847);
                    double sqrt_res_78859 = futrts_sqrt64(eta_p_78847);
                    double zs_res_78860 = log_res_78858 / 2.0;
                    double zp_res_78861 = eta_p_78848 + zs_res_78860;
                    
                    if (memblock_alloc(ctx, &mem_89617, bytes_89414, "mem_89617")) {
                        err = 1;
                        goto cleanup;
                    }
                    for (int64_t i_88732 = 0; i_88732 < m_34473; i_88732++) {
                        double eta_p_78863 = ((double *) ext_mem_89592.mem)[i_88732 * m_34473 + i_88740];
                        double zt_res_78864 = sqrt_res_78859 * eta_p_78863;
                        
                        ((double *) mem_89617.mem)[i_88732] = zt_res_78864;
                    }
                    if (memblock_set(ctx, &ext_mem_89628, &mem_89617, "mem_89617") != 0)
                        return 1;
                    rescale_res_78855 = sqrt_res_78859;
                    rescale_res_78856 = zp_res_78861;
                } else {
                    if (memblock_set(ctx, &ext_mem_89628, &ext_mem_89592, "ext_mem_89592") != 0)
                        return 1;
                    rescale_res_78855 = eta_p_78847;
                    rescale_res_78856 = eta_p_78848;
                }
                ((double *) mem_89600.mem)[i_88740] = rescale_res_78855;
                ((double *) mem_89602.mem)[i_88740] = rescale_res_78856;
                lmad_copy_8b(ctx, 1, (uint64_t *) mem_89605.mem, i_88740 * m_34473, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_89628.mem, ext_89627, (int64_t []) {ext_89626}, (int64_t []) {m_34473});
                if (memblock_unref(ctx, &ext_mem_89628, "ext_mem_89628") != 0)
                    return 1;
            }
            if (memblock_set(ctx, &ext_mem_89648, &mem_89600, "mem_89600") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_89645, &mem_89602, "mem_89602") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_89642, &mem_89605, "mem_89605") != 0)
                return 1;
        } else {
            if (memblock_set(ctx, &ext_mem_89648, &mem_89534, "mem_89534") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_89645, &mem_89499, "mem_89499") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_89642, &ext_mem_89592, "ext_mem_89592") != 0)
                return 1;
        }
        if (memblock_unref(ctx, &ext_mem_89592, "ext_mem_89592") != 0)
            return 1;
        
        double defunc_0_reduce_res_80193;
        double redout_88744 = 0.0;
        
        for (int64_t i_88745 = 0; i_88745 < m_34473; i_88745++) {
            double eta_p_56313 = ((double *) mem_89507)[i_88745];
            double eta_p_56314 = ((double *) ext_mem_89598.mem)[i_88745];
            double zs_res_56315 = eta_p_56313 / eta_p_56314;
            double zm_res_56317 = zs_res_56315 - 1.0;
            double abs_res_56319 = fabs64(zm_res_56317);
            double max_res_53093 = fmax64(abs_res_56319, redout_88744);
            double redout_tmp_91314 = max_res_53093;
            
            redout_88744 = redout_tmp_91314;
        }
        defunc_0_reduce_res_80193 = redout_88744;
        
        bool zgze_res_53094 = tol_sinkhorn_34480 <= defunc_0_reduce_res_80193;
        int64_t ext_89791;
        int64_t ext_89790;
        int64_t ext_89789;
        bool algo3_core_loop_res_53095;
        bool loop_while_53101;
        int64_t ctx_param_ext_89649;
        int64_t ctx_param_ext_89650;
        int64_t ctx_param_ext_89651;
        
        if (memblock_set(ctx, &mem_param_89652, &ext_mem_89642, "ext_mem_89642") != 0)
            return 1;
        if (memblock_set(ctx, &mem_param_89655, &ext_mem_89598, "ext_mem_89598") != 0)
            return 1;
        if (memblock_set(ctx, &mem_param_89658, &ext_mem_89648, "ext_mem_89648") != 0)
            return 1;
        if (memblock_set(ctx, &mem_param_89661, &ext_mem_89595, "ext_mem_89595") != 0)
            return 1;
        if (memblock_set(ctx, &mem_param_89664, &ext_mem_89645, "ext_mem_89645") != 0)
            return 1;
        ctx_param_ext_89649 = (int64_t) 0;
        ctx_param_ext_89650 = ext_89640;
        ctx_param_ext_89651 = ext_89639;
        loop_while_53101 = zgze_res_53094;
        while (loop_while_53101) {
            if (memblock_alloc(ctx, &mem_89666, bytes_89414, "mem_89666")) {
                err = 1;
                goto cleanup;
            }
            
            bool defunc_0_reduce_res_78953;
            bool redout_88749 = 0;
            
            for (int64_t i_88751 = 0; i_88751 < m_34473; i_88751++) {
                double eta_p_58799 = ((double *) mem_param_89664.mem)[i_88751];
                double defunc_0_reduce_res_78870;
                double redout_88746 = 0.0;
                
                for (int64_t i_88747 = 0; i_88747 < m_34473; i_88747++) {
                    double eta_p_58823 = ((double *) mem_param_89655.mem)[i_88747];
                    double eta_p_58824 = ((double *) mem_param_89652.mem)[ctx_param_ext_89649 + (i_88747 * ctx_param_ext_89650 + i_88751 * ctx_param_ext_89651)];
                    double zt_res_58825 = eta_p_58823 * eta_p_58824;
                    double zp_res_58808 = zt_res_58825 + redout_88746;
                    double redout_tmp_91331 = zp_res_58808;
                    
                    redout_88746 = redout_tmp_91331;
                }
                defunc_0_reduce_res_78870 = redout_88746;
                
                double zs_res_58810 = defunc_0_reduce_res_78870 / replicate_arg1_52610;
                double ztzt_res_58812 = fpow64(zs_res_58810, zs_res_52623);
                double zt_res_58814 = zs_res_52624 * eta_p_58799;
                double exp_res_58816 = futrts_exp64(zt_res_58814);
                double zt_res_58818 = ztzt_res_58812 * exp_res_58816;
                bool zgze_res_58820 = exp_absorb_cutoff_34478 <= zt_res_58818;
                bool defunc_0_op_res_53214 = zgze_res_58820 || redout_88749;
                
                ((double *) mem_89666.mem)[i_88751] = zt_res_58818;
                
                bool redout_tmp_91329 = defunc_0_op_res_53214;
                
                redout_88749 = redout_tmp_91329;
            }
            defunc_0_reduce_res_78953 = redout_88749;
            if (memblock_alloc(ctx, &mem_89674, bytes_89414, "mem_89674")) {
                err = 1;
                goto cleanup;
            }
            
            bool defunc_0_reduce_res_78956;
            bool redout_88756 = 0;
            
            for (int64_t i_88758 = 0; i_88758 < m_34473; i_88758++) {
                double eta_p_58719 = ((double *) mem_param_89661.mem)[i_88758];
                double defunc_0_reduce_res_78871;
                double redout_88753 = 0.0;
                
                for (int64_t i_88754 = 0; i_88754 < m_34473; i_88754++) {
                    double eta_p_58829 = ((double *) mem_89666.mem)[i_88754];
                    double eta_p_58830 = ((double *) mem_param_89652.mem)[ctx_param_ext_89649 + (i_88758 * ctx_param_ext_89650 + i_88754 * ctx_param_ext_89651)];
                    double zt_res_58831 = eta_p_58829 * eta_p_58830;
                    double zp_res_58728 = zt_res_58831 + redout_88753;
                    double redout_tmp_91334 = zp_res_58728;
                    
                    redout_88753 = redout_tmp_91334;
                }
                defunc_0_reduce_res_78871 = redout_88753;
                
                double zs_res_58730 = defunc_0_reduce_res_78871 / replicate_arg1_52610;
                double ztzt_res_58732 = fpow64(zs_res_58730, zs_res_52619);
                double zt_res_58734 = zs_res_52620 * eta_p_58719;
                double exp_res_58736 = futrts_exp64(zt_res_58734);
                double zt_res_58738 = ztzt_res_58732 * exp_res_58736;
                bool zgze_res_58740 = exp_absorb_cutoff_34478 <= zt_res_58738;
                bool defunc_0_op_res_53171 = zgze_res_58740 || redout_88756;
                
                ((double *) mem_89674.mem)[i_88758] = zt_res_58738;
                
                bool redout_tmp_91332 = defunc_0_op_res_53171;
                
                redout_88756 = redout_tmp_91332;
            }
            defunc_0_reduce_res_78956 = redout_88756;
            
            bool x_91023 = !defunc_0_reduce_res_78956;
            bool defunc_0_reduce_res_78872;
            
            if (x_91023) {
                bool x_91025;
                bool redout_88760 = 0;
                
                for (int64_t i_88761 = 0; i_88761 < m_34473; i_88761++) {
                    double eta_p_58835 = ((double *) mem_89674.mem)[i_88761];
                    bool zlze_res_58836 = eta_p_58835 <= zs_res_53000;
                    bool defunc_0_op_res_53181 = zlze_res_58836 || redout_88760;
                    bool redout_tmp_91335 = defunc_0_op_res_53181;
                    
                    redout_88760 = redout_tmp_91335;
                }
                x_91025 = redout_88760;
                defunc_0_reduce_res_78872 = x_91025;
            } else {
                defunc_0_reduce_res_78872 = 0;
            }
            
            bool cond_53172 = defunc_0_reduce_res_78872 || defunc_0_reduce_res_78956;
            int64_t ext_89723;
            
            if (cond_53172) {
                ext_89723 = (int64_t) 0;
            } else {
                ext_89723 = ctx_param_ext_89649;
            }
            
            int64_t ext_89722;
            
            if (cond_53172) {
                ext_89722 = m_34473;
            } else {
                ext_89722 = ctx_param_ext_89650;
            }
            
            int64_t ext_89721;
            
            if (cond_53172) {
                ext_89721 = (int64_t) 1;
            } else {
                ext_89721 = ctx_param_ext_89651;
            }
            if (cond_53172) {
                if (memblock_alloc(ctx, &mem_89682, bytes_89414, "mem_89682")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_89684, bytes_89414, "mem_89684")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_89687, bytes_89448, "mem_89687")) {
                    err = 1;
                    goto cleanup;
                }
                for (int64_t i_88772 = 0; i_88772 < m_34473; i_88772++) {
                    double eta_p_78889 = ((double *) mem_89674.mem)[i_88772];
                    double eta_p_78890 = ((double *) mem_param_89661.mem)[i_88772];
                    bool zgze_res_78892 = exp_absorb_cutoff_34478 <= eta_p_78889;
                    bool zl_res_78893 = eta_p_78889 < zs_res_53000;
                    bool x_78894 = !zgze_res_78892;
                    bool y_78895 = zl_res_78893 && x_78894;
                    bool cond_78896 = zgze_res_78892 || y_78895;
                    int64_t binop_y_89706 = i_88772 * ctx_param_ext_89650;
                    int64_t lmad_ext_89707 = ctx_param_ext_89649 + binop_y_89706;
                    int64_t ext_89709;
                    
                    if (cond_78896) {
                        ext_89709 = (int64_t) 0;
                    } else {
                        ext_89709 = lmad_ext_89707;
                    }
                    
                    int64_t ext_89708;
                    
                    if (cond_78896) {
                        ext_89708 = (int64_t) 1;
                    } else {
                        ext_89708 = ctx_param_ext_89651;
                    }
                    
                    double rescale_res_78897;
                    double rescale_res_78898;
                    
                    if (cond_78896) {
                        double log_res_78900 = futrts_log64(eta_p_78889);
                        double sqrt_res_78901 = futrts_sqrt64(eta_p_78889);
                        double zs_res_78902 = log_res_78900 / 2.0;
                        double zp_res_78903 = eta_p_78890 + zs_res_78902;
                        
                        if (memblock_alloc(ctx, &mem_89699, bytes_89414, "mem_89699")) {
                            err = 1;
                            goto cleanup;
                        }
                        for (int64_t i_88764 = 0; i_88764 < m_34473; i_88764++) {
                            double eta_p_78905 = ((double *) mem_param_89652.mem)[ctx_param_ext_89649 + (i_88772 * ctx_param_ext_89650 + i_88764 * ctx_param_ext_89651)];
                            double zt_res_78906 = sqrt_res_78901 * eta_p_78905;
                            
                            ((double *) mem_89699.mem)[i_88764] = zt_res_78906;
                        }
                        if (memblock_set(ctx, &ext_mem_89710, &mem_89699, "mem_89699") != 0)
                            return 1;
                        rescale_res_78897 = sqrt_res_78901;
                        rescale_res_78898 = zp_res_78903;
                    } else {
                        if (memblock_set(ctx, &ext_mem_89710, &mem_param_89652, "mem_param_89652") != 0)
                            return 1;
                        rescale_res_78897 = eta_p_78889;
                        rescale_res_78898 = eta_p_78890;
                    }
                    ((double *) mem_89682.mem)[i_88772] = rescale_res_78897;
                    ((double *) mem_89684.mem)[i_88772] = rescale_res_78898;
                    lmad_copy_8b(ctx, 1, (uint64_t *) mem_89687.mem, i_88772 * m_34473, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_89710.mem, ext_89709, (int64_t []) {ext_89708}, (int64_t []) {m_34473});
                    if (memblock_unref(ctx, &ext_mem_89710, "ext_mem_89710") != 0)
                        return 1;
                }
                if (memblock_set(ctx, &ext_mem_89730, &mem_89682, "mem_89682") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89727, &mem_89684, "mem_89684") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89724, &mem_89687, "mem_89687") != 0)
                    return 1;
            } else {
                if (memblock_set(ctx, &ext_mem_89730, &mem_89674, "mem_89674") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89727, &mem_param_89661, "mem_param_89661") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89724, &mem_param_89652, "mem_param_89652") != 0)
                    return 1;
            }
            if (memblock_unref(ctx, &mem_89674, "mem_89674") != 0)
                return 1;
            
            bool x_91095 = !defunc_0_reduce_res_78953;
            bool defunc_0_reduce_res_78911;
            
            if (x_91095) {
                bool x_91097;
                bool redout_88776 = 0;
                
                for (int64_t i_88777 = 0; i_88777 < m_34473; i_88777++) {
                    double eta_p_58878 = ((double *) mem_89666.mem)[i_88777];
                    bool zlze_res_58879 = eta_p_58878 <= zs_res_53000;
                    bool defunc_0_op_res_53224 = zlze_res_58879 || redout_88776;
                    bool redout_tmp_91340 = defunc_0_op_res_53224;
                    
                    redout_88776 = redout_tmp_91340;
                }
                x_91097 = redout_88776;
                defunc_0_reduce_res_78911 = x_91097;
            } else {
                defunc_0_reduce_res_78911 = 0;
            }
            
            bool cond_53215 = defunc_0_reduce_res_78911 || defunc_0_reduce_res_78953;
            int64_t ext_89773;
            
            if (cond_53215) {
                ext_89773 = (int64_t) 0;
            } else {
                ext_89773 = ext_89723;
            }
            
            int64_t ext_89772;
            
            if (cond_53215) {
                ext_89772 = (int64_t) 1;
            } else {
                ext_89772 = ext_89722;
            }
            
            int64_t ext_89771;
            
            if (cond_53215) {
                ext_89771 = m_34473;
            } else {
                ext_89771 = ext_89721;
            }
            if (cond_53215) {
                if (memblock_alloc(ctx, &mem_89732, bytes_89414, "mem_89732")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_89734, bytes_89414, "mem_89734")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_89737, bytes_89448, "mem_89737")) {
                    err = 1;
                    goto cleanup;
                }
                for (int64_t i_88788 = 0; i_88788 < m_34473; i_88788++) {
                    double eta_p_78930 = ((double *) mem_89666.mem)[i_88788];
                    double eta_p_78931 = ((double *) mem_param_89664.mem)[i_88788];
                    bool zgze_res_78933 = exp_absorb_cutoff_34478 <= eta_p_78930;
                    bool zl_res_78934 = eta_p_78930 < zs_res_53000;
                    bool x_78935 = !zgze_res_78933;
                    bool y_78936 = zl_res_78934 && x_78935;
                    bool cond_78937 = zgze_res_78933 || y_78936;
                    int64_t binop_y_89756 = i_88788 * ext_89721;
                    int64_t lmad_ext_89757 = ext_89723 + binop_y_89756;
                    int64_t ext_89759;
                    
                    if (cond_78937) {
                        ext_89759 = (int64_t) 0;
                    } else {
                        ext_89759 = lmad_ext_89757;
                    }
                    
                    int64_t ext_89758;
                    
                    if (cond_78937) {
                        ext_89758 = (int64_t) 1;
                    } else {
                        ext_89758 = ext_89722;
                    }
                    
                    double rescale_res_78938;
                    double rescale_res_78939;
                    
                    if (cond_78937) {
                        double log_res_78941 = futrts_log64(eta_p_78930);
                        double sqrt_res_78942 = futrts_sqrt64(eta_p_78930);
                        double zs_res_78943 = log_res_78941 / 2.0;
                        double zp_res_78944 = eta_p_78931 + zs_res_78943;
                        
                        if (memblock_alloc(ctx, &mem_89749, bytes_89414, "mem_89749")) {
                            err = 1;
                            goto cleanup;
                        }
                        for (int64_t i_88780 = 0; i_88780 < m_34473; i_88780++) {
                            double eta_p_78946 = ((double *) ext_mem_89724.mem)[ext_89723 + (i_88780 * ext_89722 + i_88788 * ext_89721)];
                            double zt_res_78947 = sqrt_res_78942 * eta_p_78946;
                            
                            ((double *) mem_89749.mem)[i_88780] = zt_res_78947;
                        }
                        if (memblock_set(ctx, &ext_mem_89760, &mem_89749, "mem_89749") != 0)
                            return 1;
                        rescale_res_78938 = sqrt_res_78942;
                        rescale_res_78939 = zp_res_78944;
                    } else {
                        if (memblock_set(ctx, &ext_mem_89760, &ext_mem_89724, "ext_mem_89724") != 0)
                            return 1;
                        rescale_res_78938 = eta_p_78930;
                        rescale_res_78939 = eta_p_78931;
                    }
                    ((double *) mem_89732.mem)[i_88788] = rescale_res_78938;
                    ((double *) mem_89734.mem)[i_88788] = rescale_res_78939;
                    lmad_copy_8b(ctx, 1, (uint64_t *) mem_89737.mem, i_88788 * m_34473, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_89760.mem, ext_89759, (int64_t []) {ext_89758}, (int64_t []) {m_34473});
                    if (memblock_unref(ctx, &ext_mem_89760, "ext_mem_89760") != 0)
                        return 1;
                }
                if (memblock_set(ctx, &ext_mem_89780, &mem_89732, "mem_89732") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89777, &mem_89734, "mem_89734") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89774, &mem_89737, "mem_89737") != 0)
                    return 1;
            } else {
                if (memblock_set(ctx, &ext_mem_89780, &mem_89666, "mem_89666") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89777, &mem_param_89664, "mem_param_89664") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_89774, &ext_mem_89724, "ext_mem_89724") != 0)
                    return 1;
            }
            if (memblock_unref(ctx, &mem_89666, "mem_89666") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_89724, "ext_mem_89724") != 0)
                return 1;
            
            double defunc_0_reduce_res_78958;
            double redout_88792 = 0.0;
            
            for (int64_t i_88793 = 0; i_88793 < m_34473; i_88793++) {
                double eta_p_58646 = ((double *) mem_param_89655.mem)[i_88793];
                double eta_p_58647 = ((double *) ext_mem_89730.mem)[i_88793];
                double zs_res_58648 = eta_p_58646 / eta_p_58647;
                double zm_res_58650 = zs_res_58648 - 1.0;
                double abs_res_58652 = fabs64(zm_res_58650);
                double max_res_53266 = fmax64(abs_res_58652, redout_88792);
                double redout_tmp_91345 = max_res_53266;
                
                redout_88792 = redout_tmp_91345;
            }
            defunc_0_reduce_res_78958 = redout_88792;
            
            bool zgze_res_53267 = tol_sinkhorn_34480 <= defunc_0_reduce_res_78958;
            
            if (memblock_set(ctx, &mem_param_tmp_91315, &ext_mem_89774, "ext_mem_89774") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_tmp_91316, &ext_mem_89730, "ext_mem_89730") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_tmp_91317, &ext_mem_89780, "ext_mem_89780") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_tmp_91318, &ext_mem_89727, "ext_mem_89727") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_tmp_91319, &ext_mem_89777, "ext_mem_89777") != 0)
                return 1;
            
            int64_t ctx_param_ext_tmp_91320 = ext_89773;
            int64_t ctx_param_ext_tmp_91321 = ext_89772;
            int64_t ctx_param_ext_tmp_91322 = ext_89771;
            bool loop_while_tmp_91323 = zgze_res_53267;
            
            if (memblock_set(ctx, &mem_param_89652, &mem_param_tmp_91315, "mem_param_tmp_91315") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_89655, &mem_param_tmp_91316, "mem_param_tmp_91316") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_89658, &mem_param_tmp_91317, "mem_param_tmp_91317") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_89661, &mem_param_tmp_91318, "mem_param_tmp_91318") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_89664, &mem_param_tmp_91319, "mem_param_tmp_91319") != 0)
                return 1;
            ctx_param_ext_89649 = ctx_param_ext_tmp_91320;
            ctx_param_ext_89650 = ctx_param_ext_tmp_91321;
            ctx_param_ext_89651 = ctx_param_ext_tmp_91322;
            loop_while_53101 = loop_while_tmp_91323;
        }
        if (memblock_set(ctx, &ext_mem_89796, &mem_param_89652, "mem_param_89652") != 0)
            return 1;
        if (memblock_set(ctx, &ext_mem_89795, &mem_param_89655, "mem_param_89655") != 0)
            return 1;
        if (memblock_set(ctx, &ext_mem_89794, &mem_param_89658, "mem_param_89658") != 0)
            return 1;
        if (memblock_set(ctx, &ext_mem_89793, &mem_param_89661, "mem_param_89661") != 0)
            return 1;
        if (memblock_set(ctx, &ext_mem_89792, &mem_param_89664, "mem_param_89664") != 0)
            return 1;
        ext_89791 = ctx_param_ext_89649;
        ext_89790 = ctx_param_ext_89650;
        ext_89789 = ctx_param_ext_89651;
        algo3_core_loop_res_53095 = loop_while_53101;
        if (memblock_unref(ctx, &ext_mem_89595, "ext_mem_89595") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89598, "ext_mem_89598") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89642, "ext_mem_89642") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89645, "ext_mem_89645") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89648, "ext_mem_89648") != 0)
            return 1;
        
        double defunc_res_80194;
        double redout_88800 = 0.0;
        
        for (int64_t i_88802 = 0; i_88802 < m_34473; i_88802++) {
            double eta_p_74451 = ((double *) ext_mem_89795.mem)[i_88802];
            double defunc_res_78959;
            double redout_88795 = 0.0;
            
            for (int64_t i_88797 = 0; i_88797 < m_34473; i_88797++) {
                double eta_p_74657 = ((double *) ext_mem_89796.mem)[ext_89791 + (i_88802 * ext_89790 + i_88797 * ext_89789)];
                double eta_p_wasfree_74658 = ((double *) ext_mem_89794.mem)[i_88797];
                double zt_res_74659 = eta_p_74451 * eta_p_74657;
                double zt_res_74660 = eta_p_wasfree_74658 * zt_res_74659;
                double zp_res_74462 = zt_res_74660 + redout_88795;
                
                ((double *) mem_89799)[i_88802 * m_34473 + i_88797] = zt_res_74660;
                
                double redout_tmp_91348 = zp_res_74462;
                
                redout_88795 = redout_tmp_91348;
            }
            defunc_res_78959 = redout_88795;
            
            double zp_res_53293 = defunc_res_78959 + redout_88800;
            double redout_tmp_91346 = zp_res_53293;
            
            redout_88800 = redout_tmp_91346;
        }
        defunc_res_80194 = redout_88800;
        if (memblock_unref(ctx, &ext_mem_89794, "ext_mem_89794") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89795, "ext_mem_89795") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89796, "ext_mem_89796") != 0)
            return 1;
        
        double zs_res_53294 = defunc_res_80169 / defunc_res_80194;
        double sqrt_res_53295 = futrts_sqrt64(zs_res_53294);
        double zt_res_53513 = zp_res_52616 * zt_res_52646;
        bool defunc_0_reduce_comm_res_80196;
        bool redout_88810 = 0;
        
        for (int64_t i_88812 = 0; i_88812 < m_34473; i_88812++) {
            bool defunc_0_reduce_comm_res_78961;
            bool redout_88805 = 0;
            
            for (int64_t i_88807 = 0; i_88807 < m_34473; i_88807++) {
                double eta_p_59035 = ((double *) mem_89799)[i_88812 * m_34473 + i_88807];
                double zt_res_59036 = sqrt_res_53295 * eta_p_59035;
                bool zgze_res_59038 = zt_res_59036 <= zt_res_53513;
                double zt_res_59039 = zp_res_52616 * zt_res_59036;
                bool zgze_res_59040 = zt_res_52646 <= zt_res_59039;
                bool x_59041 = zgze_res_59038 && zgze_res_59040;
                bool not_res_59042 = !x_59041;
                bool defunc_0_op_res_56277 = not_res_59042 || redout_88805;
                
                ((double *) mem_89818.mem)[i_88812 * m_34473 + i_88807] = zt_res_59036;
                
                bool redout_tmp_91352 = defunc_0_op_res_56277;
                
                redout_88805 = redout_tmp_91352;
            }
            defunc_0_reduce_comm_res_78961 = redout_88805;
            
            bool defunc_0_op_res_53528 = defunc_0_reduce_comm_res_78961 || redout_88810;
            bool redout_tmp_91350 = defunc_0_op_res_53528;
            
            redout_88810 = redout_tmp_91350;
        }
        defunc_0_reduce_comm_res_80196 = redout_88810;
        
        double zt_res_53406 = -2.0 * defunc_res_80180;
        double zp_res_53407 = zt_res_53406 + defunc_0_reduce_res_80179;
        double zp_res_53408 = zp_res_53407 + defunc_0_reduce_res_80177;
        double defunc_res_80198;
        double redout_88814 = 0.0;
        
        for (int64_t i_88815 = 0; i_88815 < m_34473; i_88815++) {
            double zp_res_53420 = defunc_res_80161 + redout_88814;
            double redout_tmp_91354 = zp_res_53420;
            
            redout_88814 = redout_tmp_91354;
        }
        defunc_res_80198 = redout_88814;
        
        double klu_res_53436;
        
        if (zeze_res_52812) {
            klu_res_53436 = 0.0;
        } else {
            klu_res_53436 = zt_res_52816;
        }
        
        double defunc_res_80200;
        double redout_88816 = 0.0;
        
        for (int64_t i_88817 = 0; i_88817 < m_34473; i_88817++) {
            double zp_res_53444 = klu_res_53436 + redout_88816;
            double redout_tmp_91355 = zp_res_53444;
            
            redout_88816 = redout_tmp_91355;
        }
        defunc_res_80200 = redout_88816;
        
        double defunc_res_80202;
        double redout_88818 = 0.0;
        
        for (int64_t i_88819 = 0; i_88819 < m_34473; i_88819++) {
            double zp_res_53449 = defunc_res_80200 + redout_88818;
            double redout_tmp_91356 = zp_res_53449;
            
            redout_88818 = redout_tmp_91356;
        }
        defunc_res_80202 = redout_88818;
        
        double zt_res_53450 = eps_34476 * defunc_res_80202;
        bool zeze_res_53454 = defunc_res_80161 == 0.0;
        double klu_res_53455;
        
        if (zeze_res_53454) {
            klu_res_53455 = 0.0;
        } else {
            double zs_res_53456 = defunc_res_80161 / replicate_arg1_52610;
            double log_res_53457 = futrts_log64(zs_res_53456);
            double zt_res_53458 = log_res_53457 * defunc_res_80161;
            
            klu_res_53455 = zt_res_53458;
        }
        
        double defunc_res_80204;
        double redout_88820 = 0.0;
        
        for (int64_t i_88821 = 0; i_88821 < m_34473; i_88821++) {
            double zp_res_53463 = klu_res_53455 + redout_88820;
            double redout_tmp_91357 = zp_res_53463;
            
            redout_88820 = redout_tmp_91357;
        }
        defunc_res_80204 = redout_88820;
        
        double zt_res_53464 = rho1_34474 * defunc_res_80204;
        double zt_res_53478 = rho2_34475 * defunc_res_80166;
        double zp_res_53479 = zt_res_53450 + zt_res_53464;
        double zp_res_53480 = zt_res_53478 + zp_res_53479;
        double zt_res_53481 = 2.0 * zp_res_53480;
        double zt_res_53482 = zt_res_53481 * defunc_res_80198;
        double zp_res_53483 = zp_res_53408 + zt_res_53482;
        double zt_res_53484 = defunc_res_80198 * defunc_res_80198;
        double zt_res_53485 = zp_res_52625 * zt_res_53484;
        double zm_res_53486 = zp_res_53483 - zt_res_53485;
        double defunc_res_80206;
        double defunc_res_80207;
        double defunc_res_80208;
        double defunc_res_80209;
        double redout_88822;
        double redout_88823;
        double redout_88824;
        double redout_88825;
        
        redout_88822 = 0.0;
        redout_88823 = 0.0;
        redout_88824 = 0.0;
        redout_88825 = 0.0;
        for (int64_t i_88826 = 0; i_88826 < m_34473; i_88826++) {
            double zp_res_53491 = replicate_arg1_52610 + redout_88822;
            double zp_res_53496 = replicate_arg1_52610 + redout_88823;
            double zp_res_55652 = replicate_arg1_52610 + redout_88824;
            double zp_res_55657 = replicate_arg1_52610 + redout_88825;
            double redout_tmp_91358 = zp_res_53491;
            double redout_tmp_91359 = zp_res_53496;
            double redout_tmp_91360 = zp_res_55652;
            double redout_tmp_91361 = zp_res_55657;
            
            redout_88822 = redout_tmp_91358;
            redout_88823 = redout_tmp_91359;
            redout_88824 = redout_tmp_91360;
            redout_88825 = redout_tmp_91361;
        }
        defunc_res_80206 = redout_88822;
        defunc_res_80207 = redout_88823;
        defunc_res_80208 = redout_88824;
        defunc_res_80209 = redout_88825;
        
        double zt_res_53497 = defunc_res_80206 * defunc_res_80207;
        double zt_res_53498 = rho1_34474 * defunc_res_80206;
        double zt_res_53499 = zt_res_53498 * defunc_res_80206;
        double zt_res_53500 = rho2_34475 * defunc_res_80207;
        double zt_res_53501 = zt_res_53500 * defunc_res_80207;
        double zp_res_53502 = zt_res_53499 + zt_res_53501;
        double zt_res_53503 = eps_34476 * zt_res_53497;
        double zt_res_53504 = zt_res_53497 * zt_res_53503;
        double zp_res_53505 = zp_res_53502 + zt_res_53504;
        double zp_res_53506 = zm_res_53486 + zp_res_53505;
        bool defunc_0_reduce_res_78965;
        
        if (defunc_0_reduce_comm_res_80196) {
            bool x_91017;
            bool redout_88829 = 0;
            
            for (int64_t i_88830 = 0; i_88830 < m_34473; i_88830++) {
                bool defunc_0_reduce_res_78967;
                bool redout_88827 = 0;
                
                for (int64_t i_88828 = 0; i_88828 < m_34473; i_88828++) {
                    double eta_p_78968 = ((double *) mem_89818.mem)[i_88830 * m_34473 + i_88828];
                    bool zg_res_78969 = 0.0 < eta_p_78968;
                    bool defunc_0_op_res_78972 = zg_res_78969 || redout_88827;
                    bool redout_tmp_91363 = defunc_0_op_res_78972;
                    
                    redout_88827 = redout_tmp_91363;
                }
                defunc_0_reduce_res_78967 = redout_88827;
                
                bool defunc_0_op_res_78976 = defunc_0_reduce_res_78967 || redout_88829;
                bool redout_tmp_91362 = defunc_0_op_res_78976;
                
                redout_88829 = redout_tmp_91362;
            }
            x_91017 = redout_88829;
            defunc_0_reduce_res_78965 = x_91017;
        } else {
            defunc_0_reduce_res_78965 = 0;
        }
        
        bool x_91078 = defunc_0_reduce_res_78965 && defunc_0_reduce_comm_res_80196;
        double defunc_res_79857;
        double defunc_res_79858;
        double redout_89219;
        double redout_89220;
        
        redout_89219 = 0.0;
        redout_89220 = 0.0;
        for (int64_t i_89221 = 0; i_89221 < m_34473; i_89221++) {
            double zp_res_79862 = replicate_arg1_52610 + redout_89219;
            double zp_res_79865 = replicate_arg1_52610 + redout_89220;
            double redout_tmp_91364 = zp_res_79862;
            double redout_tmp_91365 = zp_res_79865;
            
            redout_89219 = redout_tmp_91364;
            redout_89220 = redout_tmp_91365;
        }
        defunc_res_79857 = redout_89219;
        defunc_res_79858 = redout_89220;
        
        double zt_res_79868 = defunc_res_79857 * defunc_res_79858;
        double zt_res_79869 = rho1_34474 * defunc_res_79857;
        double zt_res_79870 = defunc_res_79857 * zt_res_79869;
        double zt_res_79871 = rho2_34475 * defunc_res_79858;
        double zt_res_79872 = defunc_res_79858 * zt_res_79871;
        double zp_res_79873 = zt_res_79870 + zt_res_79872;
        double zt_res_79874 = eps_34476 * zt_res_79868;
        double zt_res_79875 = zt_res_79868 * zt_res_79874;
        double zp_res_79876 = zp_res_79873 + zt_res_79875;
        double x_79884;
        double redout_89222 = 0.0;
        
        for (int64_t i_89223 = 0; i_89223 < m_34473; i_89223++) {
            double zp_res_79888 = replicate_arg1_52610 + redout_89222;
            double redout_tmp_91366 = zp_res_79888;
            
            redout_89222 = redout_tmp_91366;
        }
        x_79884 = redout_89222;
        
        double x_79891;
        double redout_89224 = 0.0;
        
        for (int64_t i_89225 = 0; i_89225 < m_34473; i_89225++) {
            double zp_res_79895 = replicate_arg1_52610 + redout_89224;
            double redout_tmp_91367 = zp_res_79895;
            
            redout_89224 = redout_tmp_91367;
        }
        x_79891 = redout_89224;
        
        double zt_res_79897 = x_79884 * x_79891;
        double zt_res_79898 = rho1_34474 * x_79884;
        double zt_res_79899 = x_79884 * zt_res_79898;
        double zt_res_79900 = rho2_34475 * x_79891;
        double zt_res_79901 = x_79891 * zt_res_79900;
        double zp_res_79902 = zt_res_79899 + zt_res_79901;
        double zt_res_79903 = eps_34476 * zt_res_79897;
        double zt_res_79904 = zt_res_79897 * zt_res_79903;
        double zp_res_79905 = zp_res_79902 + zt_res_79904;
        bool final_plan_53545;
        double final_plan_53549;
        bool loop_while_53550;
        double loss_53554;
        
        if (memblock_set(ctx, &mem_param_89837, &ext_mem_89793, "ext_mem_89793") != 0)
            return 1;
        if (memblock_set(ctx, &mem_param_89840, &ext_mem_89792, "ext_mem_89792") != 0)
            return 1;
        if (memblock_set(ctx, &mem_param_89844, &mem_89818, "mem_89818") != 0)
            return 1;
        loop_while_53550 = x_91078;
        loss_53554 = zp_res_53506;
        while (loop_while_53550) {
            double defunc_res_80111;
            double defunc_res_80112;
            double defunc_res_80113;
            double defunc_res_80114;
            double redout_88838;
            double redout_88839;
            double redout_88840;
            double redout_88841;
            
            redout_88838 = 0.0;
            redout_88839 = 0.0;
            redout_88840 = 0.0;
            redout_88841 = 0.0;
            for (int64_t i_88843 = 0; i_88843 < m_34473; i_88843++) {
                double defunc_res_78978;
                double defunc_res_78979;
                double defunc_res_78980;
                double defunc_res_78981;
                double defunc_res_78982;
                double redout_88831;
                double redout_88832;
                double redout_88833;
                double redout_88834;
                double redout_88835;
                
                redout_88831 = 0.0;
                redout_88832 = 0.0;
                redout_88833 = 0.0;
                redout_88834 = 0.0;
                redout_88835 = 0.0;
                for (int64_t i_88836 = 0; i_88836 < m_34473; i_88836++) {
                    double x_60324 = ((double *) mem_param_89844.mem)[i_88843 * m_34473 + i_88836];
                    bool zeze_res_60329 = x_60324 == 0.0;
                    double klu_res_60330;
                    
                    if (zeze_res_60329) {
                        klu_res_60330 = 0.0;
                    } else {
                        double zs_res_60331 = x_60324 / zt_res_52646;
                        double log_res_60332 = futrts_log64(zs_res_60331);
                        double zt_res_60333 = x_60324 * log_res_60332;
                        
                        klu_res_60330 = zt_res_60333;
                    }
                    
                    double zp_res_60229 = x_60324 + redout_88831;
                    double zp_res_60235 = x_60324 + redout_88832;
                    double zp_res_60241 = x_60324 + redout_88833;
                    double zp_res_60261 = klu_res_60330 + redout_88834;
                    double zp_res_60268 = x_60324 + redout_88835;
                    double redout_tmp_91381 = zp_res_60229;
                    double redout_tmp_91382 = zp_res_60235;
                    double redout_tmp_91383 = zp_res_60241;
                    double redout_tmp_91384 = zp_res_60261;
                    double redout_tmp_91385 = zp_res_60268;
                    
                    redout_88831 = redout_tmp_91381;
                    redout_88832 = redout_tmp_91382;
                    redout_88833 = redout_tmp_91383;
                    redout_88834 = redout_tmp_91384;
                    redout_88835 = redout_tmp_91385;
                }
                defunc_res_78978 = redout_88831;
                defunc_res_78979 = redout_88832;
                defunc_res_78980 = redout_88833;
                defunc_res_78981 = redout_88834;
                defunc_res_78982 = redout_88835;
                
                bool zeze_res_60243 = defunc_res_78980 == 0.0;
                double klu_res_60244;
                
                if (zeze_res_60243) {
                    klu_res_60244 = 0.0;
                } else {
                    double zs_res_60245 = defunc_res_78980 / replicate_arg1_52610;
                    double log_res_60246 = futrts_log64(zs_res_60245);
                    double zt_res_60247 = log_res_60246 * defunc_res_78980;
                    
                    klu_res_60244 = zt_res_60247;
                }
                
                double zp_res_53566 = defunc_res_78978 + redout_88838;
                double zp_res_53689 = klu_res_60244 + redout_88839;
                double zp_res_53733 = defunc_res_78981 + redout_88840;
                double zp_res_53767 = defunc_res_78982 + redout_88841;
                
                ((double *) mem_89846)[i_88843] = defunc_res_78979;
                
                double redout_tmp_91376 = zp_res_53566;
                double redout_tmp_91377 = zp_res_53689;
                double redout_tmp_91378 = zp_res_53733;
                double redout_tmp_91379 = zp_res_53767;
                
                redout_88838 = redout_tmp_91376;
                redout_88839 = redout_tmp_91377;
                redout_88840 = redout_tmp_91378;
                redout_88841 = redout_tmp_91379;
            }
            defunc_res_80111 = redout_88838;
            defunc_res_80112 = redout_88839;
            defunc_res_80113 = redout_88840;
            defunc_res_80114 = redout_88841;
            
            double zt_res_53570 = eps_34476 * defunc_res_80111;
            double zt_res_53573 = log_res_52661 * zt_res_53570;
            double defunc_res_80116;
            double redout_88849 = 0.0;
            
            for (int64_t i_88851 = 0; i_88851 < m_34473; i_88851++) {
                double defunc_res_78983;
                double defunc_res_78984;
                double redout_88845;
                double redout_88846;
                
                redout_88845 = 0.0;
                redout_88846 = 0.0;
                for (int64_t i_88847 = 0; i_88847 < m_34473; i_88847++) {
                    double x_60341 = ((double *) mem_param_89844.mem)[i_88847 * m_34473 + i_88851];
                    double zp_res_60277 = x_60341 + redout_88845;
                    double zp_res_60283 = x_60341 + redout_88846;
                    double redout_tmp_91388 = zp_res_60277;
                    double redout_tmp_91389 = zp_res_60283;
                    
                    redout_88845 = redout_tmp_91388;
                    redout_88846 = redout_tmp_91389;
                }
                defunc_res_78983 = redout_88845;
                defunc_res_78984 = redout_88846;
                
                bool zeze_res_60285 = defunc_res_78984 == 0.0;
                double klu_res_60286;
                
                if (zeze_res_60285) {
                    klu_res_60286 = 0.0;
                } else {
                    double zs_res_60287 = defunc_res_78984 / replicate_arg1_52610;
                    double log_res_60288 = futrts_log64(zs_res_60287);
                    double zt_res_60289 = log_res_60288 * defunc_res_78984;
                    
                    klu_res_60286 = zt_res_60289;
                }
                
                double zp_res_53710 = klu_res_60286 + redout_88849;
                
                ((double *) mem_89854)[i_88851] = defunc_res_78983;
                
                double redout_tmp_91386 = zp_res_53710;
                
                redout_88849 = redout_tmp_91386;
            }
            defunc_res_80116 = redout_88849;
            
            double zt_res_53711 = rho2_34475 * defunc_res_80116;
            double zt_res_53690 = rho1_34474 * defunc_res_80112;
            double zp_res_53735 = zt_res_53690 + zt_res_53711;
            double zt_res_53734 = eps_34476 * defunc_res_80113;
            double zp_res_53736 = zt_res_53734 + zp_res_53735;
            
            for (int64_t i_88857 = 0; i_88857 < m_34473; i_88857++) {
                double defunc_0_reduce_res_78985;
                double redout_88853 = 0.0;
                
                for (int64_t i_88854 = 0; i_88854 < m_34473; i_88854++) {
                    double eta_p_60586 = ((double *) A_mem_89411.mem)[eta_p_52629 * (m_34473 * m_34473) + i_88857 * m_34473 + i_88854];
                    double eta_p_60587 = ((double *) mem_89854)[i_88854];
                    double zt_res_60589 = eta_p_60586 * eta_p_60586;
                    double zt_res_60591 = eta_p_60587 * zt_res_60589;
                    double zp_res_53624 = zt_res_60591 + redout_88853;
                    double redout_tmp_91391 = zp_res_53624;
                    
                    redout_88853 = redout_tmp_91391;
                }
                defunc_0_reduce_res_78985 = redout_88853;
                ((double *) mem_89862)[i_88857] = defunc_0_reduce_res_78985;
            }
            for (int64_t i_88882 = 0; i_88882 < m_34473; i_88882++) {
                double eta_p_60023 = ((double *) mem_param_89837.mem)[i_88882];
                double defunc_0_reduce_res_78988;
                double redout_88859 = 0.0;
                
                for (int64_t i_88860 = 0; i_88860 < m_34473; i_88860++) {
                    double eta_p_60554 = ((double *) A_mem_89411.mem)[eta_p_52628 * (m_34473 * m_34473) + i_88882 * m_34473 + i_88860];
                    double eta_p_60555 = ((double *) mem_89846)[i_88860];
                    double zt_res_60557 = eta_p_60554 * eta_p_60554;
                    double zt_res_60559 = eta_p_60555 * zt_res_60557;
                    double zp_res_60039 = zt_res_60559 + redout_88859;
                    double redout_tmp_91394 = zp_res_60039;
                    
                    redout_88859 = redout_tmp_91394;
                }
                defunc_0_reduce_res_78988 = redout_88859;
                for (int64_t i_88865 = 0; i_88865 < m_34473; i_88865++) {
                    double defunc_0_reduce_res_78986;
                    double redout_88861 = 0.0;
                    
                    for (int64_t i_88862 = 0; i_88862 < m_34473; i_88862++) {
                        double eta_p_60562 = ((double *) A_mem_89411.mem)[eta_p_52628 * (m_34473 * m_34473) + i_88882 * m_34473 + i_88862];
                        double eta_p_60563 = ((double *) mem_param_89844.mem)[i_88862 * m_34473 + i_88865];
                        double zt_res_60564 = eta_p_60562 * eta_p_60563;
                        double zp_res_60051 = zt_res_60564 + redout_88861;
                        double redout_tmp_91396 = zp_res_60051;
                        
                        redout_88861 = redout_tmp_91396;
                    }
                    defunc_0_reduce_res_78986 = redout_88861;
                    ((double *) mem_89882)[i_88865] = defunc_0_reduce_res_78986;
                }
                
                double defunc_0_reduce_res_78990;
                double redout_88870 = INFINITY;
                
                for (int64_t i_88872 = 0; i_88872 < m_34473; i_88872++) {
                    double eta_p_wasfree_60514 = ((double *) mem_89862)[i_88872];
                    double eta_p_wasfree_60515 = ((double *) mem_param_89840.mem)[i_88872];
                    double defunc_0_reduce_res_78987;
                    double redout_88867 = 0.0;
                    
                    for (int64_t i_88868 = 0; i_88868 < m_34473; i_88868++) {
                        double eta_p_60568 = ((double *) mem_89882)[i_88868];
                        double eta_p_60569 = ((double *) A_mem_89411.mem)[eta_p_52629 * (m_34473 * m_34473) + i_88868 * m_34473 + i_88872];
                        double zt_res_60570 = eta_p_60568 * eta_p_60569;
                        double zp_res_60524 = zt_res_60570 + redout_88867;
                        double redout_tmp_91399 = zp_res_60524;
                        
                        redout_88867 = redout_tmp_91399;
                    }
                    defunc_0_reduce_res_78987 = redout_88867;
                    
                    double zt_res_60526 = -2.0 * defunc_0_reduce_res_78987;
                    double zp_res_60528 = zt_res_60526 + defunc_0_reduce_res_78988;
                    double zp_res_60530 = eta_p_wasfree_60514 + zp_res_60528;
                    double zp_res_60532 = zp_res_53736 + zp_res_60530;
                    double zm_res_60534 = zp_res_60532 - zt_res_53573;
                    double zm_res_60536 = zm_res_60534 - zt_res_53573;
                    double zs_res_60538 = zm_res_60536 / defunc_res_80114;
                    double zs_res_60540 = zs_res_60538 / neg_res_52615;
                    double zp_res_60542 = eta_p_60023 + zs_res_60540;
                    double zp_res_60544 = eta_p_wasfree_60515 + zp_res_60542;
                    double zm_res_60546 = 30.0 - zp_res_60544;
                    double min_res_60115 = fmin64(zm_res_60546, redout_88870);
                    
                    ((double *) mem_89890)[i_88872] = zp_res_60544;
                    
                    double redout_tmp_91397 = min_res_60115;
                    
                    redout_88870 = redout_tmp_91397;
                }
                defunc_0_reduce_res_78990 = redout_88870;
                for (int64_t i_88876 = 0; i_88876 < m_34473; i_88876++) {
                    double eta_p_60118 = ((double *) mem_89890)[i_88876];
                    double zp_res_60119 = eta_p_60118 + defunc_0_reduce_res_78990;
                    
                    ((double *) mem_89871)[i_88882 * m_34473 + i_88876] = zp_res_60119;
                }
                ((double *) mem_89873)[i_88882] = defunc_0_reduce_res_78990;
            }
            
            bool defunc_0_reduce_res_80121;
            bool redout_88895 = 0;
            
            for (int64_t i_88899 = 0; i_88899 < m_34473; i_88899++) {
                double eta_p_74730 = ((double *) mem_param_89840.mem)[i_88899];
                double defunc_0_reduce_res_78993;
                double redout_88885 = INFINITY;
                
                for (int64_t i_88886 = 0; i_88886 < m_34473; i_88886++) {
                    double eta_p_74733 = ((double *) mem_89871)[i_88886 * m_34473 + i_88899];
                    double zm_res_74734 = 30.0 - eta_p_74733;
                    double min_res_74737 = fmin64(zm_res_74734, redout_88885);
                    double redout_tmp_91405 = min_res_74737;
                    
                    redout_88885 = redout_tmp_91405;
                }
                defunc_0_reduce_res_78993 = redout_88885;
                
                double defunc_0_reduce_res_78994;
                double redout_88888 = 0.0;
                
                for (int64_t i_88890 = 0; i_88890 < m_34473; i_88890++) {
                    double eta_p_74773 = ((double *) mem_89871)[i_88890 * m_34473 + i_88899];
                    double zp_res_74774 = eta_p_74773 + defunc_0_reduce_res_78993;
                    double exp_res_74775 = futrts_exp64(zp_res_74774);
                    double zp_res_74750 = exp_res_74775 + redout_88888;
                    
                    ((double *) mem_89918.mem)[i_88899 * m_34473 + i_88890] = exp_res_74775;
                    
                    double redout_tmp_91406 = zp_res_74750;
                    
                    redout_88888 = redout_tmp_91406;
                }
                defunc_0_reduce_res_78994 = redout_88888;
                
                double zp_res_74745 = eta_p_74730 + defunc_0_reduce_res_78993;
                double zs_res_74751 = defunc_0_reduce_res_78994 / replicate_arg1_52610;
                double ztzt_res_74752 = fpow64(zs_res_74751, zs_res_52623);
                double zt_res_74753 = zs_res_52624 * zp_res_74745;
                double exp_res_74754 = futrts_exp64(zt_res_74753);
                double zt_res_74755 = ztzt_res_74752 * exp_res_74754;
                bool zgze_res_74756 = exp_absorb_cutoff_34478 <= zt_res_74755;
                bool defunc_0_op_res_53942 = zgze_res_74756 || redout_88895;
                
                ((double *) mem_89913.mem)[i_88899] = zt_res_74755;
                ((double *) mem_89915.mem)[i_88899] = zp_res_74745;
                
                bool redout_tmp_91401 = defunc_0_op_res_53942;
                
                redout_88895 = redout_tmp_91401;
            }
            defunc_0_reduce_res_80121 = redout_88895;
            
            bool defunc_0_reduce_res_80126;
            bool redout_88907 = 0;
            
            for (int64_t i_88910 = 0; i_88910 < m_34473; i_88910++) {
                double eta_p_59329 = ((double *) mem_param_89837.mem)[i_88910];
                double eta_p_59330 = ((double *) mem_89873)[i_88910];
                double zp_res_59332 = eta_p_59329 + eta_p_59330;
                double defunc_0_reduce_res_78996;
                double redout_88903 = 0.0;
                
                for (int64_t i_88904 = 0; i_88904 < m_34473; i_88904++) {
                    double eta_p_60606 = ((double *) mem_89913.mem)[i_88904];
                    double eta_p_60607 = ((double *) mem_89918.mem)[i_88904 * m_34473 + i_88910];
                    double zt_res_60608 = eta_p_60606 * eta_p_60607;
                    double zp_res_59342 = zt_res_60608 + redout_88903;
                    double redout_tmp_91411 = zp_res_59342;
                    
                    redout_88903 = redout_tmp_91411;
                }
                defunc_0_reduce_res_78996 = redout_88903;
                
                double zs_res_59344 = defunc_0_reduce_res_78996 / replicate_arg1_52610;
                double ztzt_res_59346 = fpow64(zs_res_59344, zs_res_52619);
                double zt_res_59348 = zs_res_52620 * zp_res_59332;
                double exp_res_59350 = futrts_exp64(zt_res_59348);
                double zt_res_59352 = ztzt_res_59346 * exp_res_59350;
                bool zgze_res_59354 = exp_absorb_cutoff_34478 <= zt_res_59352;
                bool defunc_0_op_res_53899 = zgze_res_59354 || redout_88907;
                
                ((double *) mem_89948.mem)[i_88910] = zt_res_59352;
                ((double *) mem_89950.mem)[i_88910] = zp_res_59332;
                
                bool redout_tmp_91408 = defunc_0_op_res_53899;
                
                redout_88907 = redout_tmp_91408;
            }
            defunc_0_reduce_res_80126 = redout_88907;
            
            bool x_90978 = !defunc_0_reduce_res_80126;
            bool defunc_0_reduce_res_78997;
            
            if (x_90978) {
                bool x_90980;
                bool redout_88913 = 0;
                
                for (int64_t i_88914 = 0; i_88914 < m_34473; i_88914++) {
                    double eta_p_60613 = ((double *) mem_89948.mem)[i_88914];
                    bool zlze_res_60614 = eta_p_60613 <= zs_res_53000;
                    bool defunc_0_op_res_53909 = zlze_res_60614 || redout_88913;
                    bool redout_tmp_91412 = defunc_0_op_res_53909;
                    
                    redout_88913 = redout_tmp_91412;
                }
                x_90980 = redout_88913;
                defunc_0_reduce_res_78997 = x_90980;
            } else {
                defunc_0_reduce_res_78997 = 0;
            }
            
            bool cond_53900 = defunc_0_reduce_res_78997 || defunc_0_reduce_res_80126;
            int64_t ext_90004;
            
            if (cond_53900) {
                ext_90004 = m_34473;
            } else {
                ext_90004 = (int64_t) 1;
            }
            
            int64_t ext_90003;
            
            if (cond_53900) {
                ext_90003 = (int64_t) 1;
            } else {
                ext_90003 = m_34473;
            }
            if (cond_53900) {
                if (memblock_alloc(ctx, &mem_89964, bytes_89414, "mem_89964")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_89966, bytes_89414, "mem_89966")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_89969, bytes_89448, "mem_89969")) {
                    err = 1;
                    goto cleanup;
                }
                for (int64_t i_88925 = 0; i_88925 < m_34473; i_88925++) {
                    double eta_p_79014 = ((double *) mem_89948.mem)[i_88925];
                    double eta_p_79015 = ((double *) mem_89950.mem)[i_88925];
                    bool zgze_res_79017 = exp_absorb_cutoff_34478 <= eta_p_79014;
                    bool zl_res_79018 = eta_p_79014 < zs_res_53000;
                    bool x_79019 = !zgze_res_79017;
                    bool y_79020 = zl_res_79018 && x_79019;
                    bool cond_79021 = zgze_res_79017 || y_79020;
                    int64_t ext_89991;
                    
                    if (cond_79021) {
                        ext_89991 = (int64_t) 0;
                    } else {
                        ext_89991 = i_88925;
                    }
                    
                    int64_t ext_89990;
                    
                    if (cond_79021) {
                        ext_89990 = (int64_t) 1;
                    } else {
                        ext_89990 = m_34473;
                    }
                    
                    double rescale_res_79022;
                    double rescale_res_79023;
                    
                    if (cond_79021) {
                        double log_res_79025 = futrts_log64(eta_p_79014);
                        double sqrt_res_79026 = futrts_sqrt64(eta_p_79014);
                        double zs_res_79027 = log_res_79025 / 2.0;
                        double zp_res_79028 = eta_p_79015 + zs_res_79027;
                        
                        if (memblock_alloc(ctx, &mem_89981, bytes_89414, "mem_89981")) {
                            err = 1;
                            goto cleanup;
                        }
                        for (int64_t i_88917 = 0; i_88917 < m_34473; i_88917++) {
                            double eta_p_79030 = ((double *) mem_89918.mem)[i_88917 * m_34473 + i_88925];
                            double zt_res_79031 = sqrt_res_79026 * eta_p_79030;
                            
                            ((double *) mem_89981.mem)[i_88917] = zt_res_79031;
                        }
                        if (memblock_set(ctx, &ext_mem_89992, &mem_89981, "mem_89981") != 0)
                            return 1;
                        rescale_res_79022 = sqrt_res_79026;
                        rescale_res_79023 = zp_res_79028;
                    } else {
                        if (memblock_set(ctx, &ext_mem_89992, &mem_89918, "mem_89918") != 0)
                            return 1;
                        rescale_res_79022 = eta_p_79014;
                        rescale_res_79023 = eta_p_79015;
                    }
                    ((double *) mem_89964.mem)[i_88925] = rescale_res_79022;
                    ((double *) mem_89966.mem)[i_88925] = rescale_res_79023;
                    lmad_copy_8b(ctx, 1, (uint64_t *) mem_89969.mem, i_88925 * m_34473, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_89992.mem, ext_89991, (int64_t []) {ext_89990}, (int64_t []) {m_34473});
                    if (memblock_unref(ctx, &ext_mem_89992, "ext_mem_89992") != 0)
                        return 1;
                }
                if (memblock_set(ctx, &ext_mem_90012, &mem_89964, "mem_89964") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90009, &mem_89966, "mem_89966") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90006, &mem_89969, "mem_89969") != 0)
                    return 1;
            } else {
                if (memblock_set(ctx, &ext_mem_90012, &mem_89948, "mem_89948") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90009, &mem_89950, "mem_89950") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90006, &mem_89918, "mem_89918") != 0)
                    return 1;
            }
            
            bool x_90974 = !defunc_0_reduce_res_80121;
            bool defunc_0_reduce_res_79036;
            
            if (x_90974) {
                bool x_90976;
                bool redout_88929 = 0;
                
                for (int64_t i_88930 = 0; i_88930 < m_34473; i_88930++) {
                    double eta_p_60656 = ((double *) mem_89913.mem)[i_88930];
                    bool zlze_res_60657 = eta_p_60656 <= zs_res_53000;
                    bool defunc_0_op_res_53952 = zlze_res_60657 || redout_88929;
                    bool redout_tmp_91417 = defunc_0_op_res_53952;
                    
                    redout_88929 = redout_tmp_91417;
                }
                x_90976 = redout_88929;
                defunc_0_reduce_res_79036 = x_90976;
            } else {
                defunc_0_reduce_res_79036 = 0;
            }
            
            bool cond_53943 = defunc_0_reduce_res_79036 || defunc_0_reduce_res_80121;
            int64_t ext_90054;
            
            if (cond_53943) {
                ext_90054 = (int64_t) 1;
            } else {
                ext_90054 = ext_90004;
            }
            
            int64_t ext_90053;
            
            if (cond_53943) {
                ext_90053 = m_34473;
            } else {
                ext_90053 = ext_90003;
            }
            if (cond_53943) {
                if (memblock_alloc(ctx, &mem_90014, bytes_89414, "mem_90014")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_90016, bytes_89414, "mem_90016")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_90019, bytes_89448, "mem_90019")) {
                    err = 1;
                    goto cleanup;
                }
                for (int64_t i_88941 = 0; i_88941 < m_34473; i_88941++) {
                    double eta_p_79055 = ((double *) mem_89913.mem)[i_88941];
                    double eta_p_79056 = ((double *) mem_89915.mem)[i_88941];
                    bool zgze_res_79058 = exp_absorb_cutoff_34478 <= eta_p_79055;
                    bool zl_res_79059 = eta_p_79055 < zs_res_53000;
                    bool x_79060 = !zgze_res_79058;
                    bool y_79061 = zl_res_79059 && x_79060;
                    bool cond_79062 = zgze_res_79058 || y_79061;
                    int64_t binop_y_90038 = i_88941 * ext_90003;
                    int64_t ext_90041;
                    
                    if (cond_79062) {
                        ext_90041 = (int64_t) 0;
                    } else {
                        ext_90041 = binop_y_90038;
                    }
                    
                    int64_t ext_90040;
                    
                    if (cond_79062) {
                        ext_90040 = (int64_t) 1;
                    } else {
                        ext_90040 = ext_90004;
                    }
                    
                    double rescale_res_79063;
                    double rescale_res_79064;
                    
                    if (cond_79062) {
                        double log_res_79066 = futrts_log64(eta_p_79055);
                        double sqrt_res_79067 = futrts_sqrt64(eta_p_79055);
                        double zs_res_79068 = log_res_79066 / 2.0;
                        double zp_res_79069 = eta_p_79056 + zs_res_79068;
                        
                        if (memblock_alloc(ctx, &mem_90031, bytes_89414, "mem_90031")) {
                            err = 1;
                            goto cleanup;
                        }
                        for (int64_t i_88933 = 0; i_88933 < m_34473; i_88933++) {
                            double eta_p_79071 = ((double *) ext_mem_90006.mem)[i_88933 * ext_90004 + i_88941 * ext_90003];
                            double zt_res_79072 = sqrt_res_79067 * eta_p_79071;
                            
                            ((double *) mem_90031.mem)[i_88933] = zt_res_79072;
                        }
                        if (memblock_set(ctx, &ext_mem_90042, &mem_90031, "mem_90031") != 0)
                            return 1;
                        rescale_res_79063 = sqrt_res_79067;
                        rescale_res_79064 = zp_res_79069;
                    } else {
                        if (memblock_set(ctx, &ext_mem_90042, &ext_mem_90006, "ext_mem_90006") != 0)
                            return 1;
                        rescale_res_79063 = eta_p_79055;
                        rescale_res_79064 = eta_p_79056;
                    }
                    ((double *) mem_90014.mem)[i_88941] = rescale_res_79063;
                    ((double *) mem_90016.mem)[i_88941] = rescale_res_79064;
                    lmad_copy_8b(ctx, 1, (uint64_t *) mem_90019.mem, i_88941 * m_34473, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90042.mem, ext_90041, (int64_t []) {ext_90040}, (int64_t []) {m_34473});
                    if (memblock_unref(ctx, &ext_mem_90042, "ext_mem_90042") != 0)
                        return 1;
                }
                if (memblock_set(ctx, &ext_mem_90062, &mem_90014, "mem_90014") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90059, &mem_90016, "mem_90016") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90056, &mem_90019, "mem_90019") != 0)
                    return 1;
            } else {
                if (memblock_set(ctx, &ext_mem_90062, &mem_89913, "mem_89913") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90059, &mem_89915, "mem_89915") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90056, &ext_mem_90006, "ext_mem_90006") != 0)
                    return 1;
            }
            if (memblock_unref(ctx, &ext_mem_90006, "ext_mem_90006") != 0)
                return 1;
            
            bool defunc_0_reduce_res_80129;
            bool redout_88945 = 1;
            
            for (int64_t i_88946 = 0; i_88946 < m_34473; i_88946++) {
                double eta_p_59136 = ((double *) ext_mem_90012.mem)[i_88946];
                bool isnan_res_59137 = futrts_isnan64(eta_p_59136);
                bool not_res_59138 = !isnan_res_59137;
                bool x_53988 = not_res_59138 && redout_88945;
                bool redout_tmp_91422 = x_53988;
                
                redout_88945 = redout_tmp_91422;
            }
            defunc_0_reduce_res_80129 = redout_88945;
            
            bool defunc_0_reduce_comm_res_79080;
            
            if (defunc_0_reduce_res_80129) {
                bool x_90972;
                bool redout_88947 = 0;
                
                for (int64_t i_88948 = 0; i_88948 < m_34473; i_88948++) {
                    double eta_p_79081 = ((double *) ext_mem_90012.mem)[i_88948];
                    double zt_res_79082 = zp_res_79079 * eta_p_79081;
                    bool zgze_res_79083 = 1.0 <= zt_res_79082;
                    bool zgze_res_79084 = eta_p_79081 <= zp_res_79079;
                    bool x_79085 = zgze_res_79083 && zgze_res_79084;
                    bool not_res_79086 = !x_79085;
                    bool defunc_0_op_res_79089 = not_res_79086 || redout_88947;
                    bool redout_tmp_91423 = defunc_0_op_res_79089;
                    
                    redout_88947 = redout_tmp_91423;
                }
                x_90972 = redout_88947;
                defunc_0_reduce_comm_res_79080 = x_90972;
            } else {
                defunc_0_reduce_comm_res_79080 = 0;
            }
            
            bool x_91081 = defunc_0_reduce_comm_res_79080 && defunc_0_reduce_res_80129;
            int64_t ext_90227;
            int64_t ext_90226;
            int64_t ext_90225;
            int64_t ext_90218;
            int64_t ext_90217;
            int64_t ext_90216;
            bool algo5_core_loop_res_54003;
            bool loop_while_54013;
            int64_t ctx_param_ext_90063;
            int64_t ctx_param_ext_90064;
            int64_t ctx_param_ext_90065;
            int64_t ctx_param_ext_90076;
            int64_t ctx_param_ext_90077;
            int64_t ctx_param_ext_90078;
            
            if (memblock_set(ctx, &mem_param_90066, &mem_89918, "mem_89918") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_90069, &mem_89415, "mem_89415") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_90072, &mem_89950, "mem_89950") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_90075, &mem_89915, "mem_89915") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_90079, &ext_mem_90056, "ext_mem_90056") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_90082, &ext_mem_90012, "ext_mem_90012") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_90085, &ext_mem_90062, "ext_mem_90062") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_90088, &ext_mem_90009, "ext_mem_90009") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_90091, &ext_mem_90059, "ext_mem_90059") != 0)
                return 1;
            ctx_param_ext_90063 = (int64_t) 0;
            ctx_param_ext_90064 = (int64_t) 1;
            ctx_param_ext_90065 = m_34473;
            ctx_param_ext_90076 = (int64_t) 0;
            ctx_param_ext_90077 = ext_90054;
            ctx_param_ext_90078 = ext_90053;
            loop_while_54013 = x_91081;
            while (loop_while_54013) {
                if (memblock_alloc(ctx, &mem_90093, bytes_89414, "mem_90093")) {
                    err = 1;
                    goto cleanup;
                }
                
                bool defunc_0_reduce_res_79189;
                bool redout_88952 = 0;
                
                for (int64_t i_88954 = 0; i_88954 < m_34473; i_88954++) {
                    double eta_p_60872 = ((double *) mem_param_90091.mem)[i_88954];
                    double defunc_0_reduce_res_79091;
                    double redout_88949 = 0.0;
                    
                    for (int64_t i_88950 = 0; i_88950 < m_34473; i_88950++) {
                        double eta_p_60896 = ((double *) mem_param_90082.mem)[i_88950];
                        double eta_p_60897 = ((double *) mem_param_90079.mem)[ctx_param_ext_90076 + (i_88950 * ctx_param_ext_90077 + i_88954 * ctx_param_ext_90078)];
                        double zt_res_60898 = eta_p_60896 * eta_p_60897;
                        double zp_res_60881 = zt_res_60898 + redout_88949;
                        double redout_tmp_91451 = zp_res_60881;
                        
                        redout_88949 = redout_tmp_91451;
                    }
                    defunc_0_reduce_res_79091 = redout_88949;
                    
                    double zs_res_60883 = defunc_0_reduce_res_79091 / replicate_arg1_52610;
                    double ztzt_res_60885 = fpow64(zs_res_60883, zs_res_52623);
                    double zt_res_60887 = zs_res_52624 * eta_p_60872;
                    double exp_res_60889 = futrts_exp64(zt_res_60887);
                    double zt_res_60891 = ztzt_res_60885 * exp_res_60889;
                    bool zgze_res_60893 = exp_absorb_cutoff_34478 <= zt_res_60891;
                    bool defunc_0_op_res_54130 = zgze_res_60893 || redout_88952;
                    
                    ((double *) mem_90093.mem)[i_88954] = zt_res_60891;
                    
                    bool redout_tmp_91449 = defunc_0_op_res_54130;
                    
                    redout_88952 = redout_tmp_91449;
                }
                defunc_0_reduce_res_79189 = redout_88952;
                if (memblock_alloc(ctx, &mem_90101, bytes_89414, "mem_90101")) {
                    err = 1;
                    goto cleanup;
                }
                
                bool defunc_0_reduce_res_79192;
                bool redout_88959 = 0;
                
                for (int64_t i_88961 = 0; i_88961 < m_34473; i_88961++) {
                    double eta_p_60792 = ((double *) mem_param_90088.mem)[i_88961];
                    double defunc_0_reduce_res_79092;
                    double redout_88956 = 0.0;
                    
                    for (int64_t i_88957 = 0; i_88957 < m_34473; i_88957++) {
                        double eta_p_60902 = ((double *) mem_90093.mem)[i_88957];
                        double eta_p_60903 = ((double *) mem_param_90079.mem)[ctx_param_ext_90076 + (i_88961 * ctx_param_ext_90077 + i_88957 * ctx_param_ext_90078)];
                        double zt_res_60904 = eta_p_60902 * eta_p_60903;
                        double zp_res_60801 = zt_res_60904 + redout_88956;
                        double redout_tmp_91454 = zp_res_60801;
                        
                        redout_88956 = redout_tmp_91454;
                    }
                    defunc_0_reduce_res_79092 = redout_88956;
                    
                    double zs_res_60803 = defunc_0_reduce_res_79092 / replicate_arg1_52610;
                    double ztzt_res_60805 = fpow64(zs_res_60803, zs_res_52619);
                    double zt_res_60807 = zs_res_52620 * eta_p_60792;
                    double exp_res_60809 = futrts_exp64(zt_res_60807);
                    double zt_res_60811 = ztzt_res_60805 * exp_res_60809;
                    bool zgze_res_60813 = exp_absorb_cutoff_34478 <= zt_res_60811;
                    bool defunc_0_op_res_54087 = zgze_res_60813 || redout_88959;
                    
                    ((double *) mem_90101.mem)[i_88961] = zt_res_60811;
                    
                    bool redout_tmp_91452 = defunc_0_op_res_54087;
                    
                    redout_88959 = redout_tmp_91452;
                }
                defunc_0_reduce_res_79192 = redout_88959;
                
                bool x_90966 = !defunc_0_reduce_res_79192;
                bool defunc_0_reduce_res_79093;
                
                if (x_90966) {
                    bool x_90968;
                    bool redout_88963 = 0;
                    
                    for (int64_t i_88964 = 0; i_88964 < m_34473; i_88964++) {
                        double eta_p_60908 = ((double *) mem_90101.mem)[i_88964];
                        bool zlze_res_60909 = eta_p_60908 <= zs_res_53000;
                        bool defunc_0_op_res_54097 = zlze_res_60909 || redout_88963;
                        bool redout_tmp_91455 = defunc_0_op_res_54097;
                        
                        redout_88963 = redout_tmp_91455;
                    }
                    x_90968 = redout_88963;
                    defunc_0_reduce_res_79093 = x_90968;
                } else {
                    defunc_0_reduce_res_79093 = 0;
                }
                
                bool cond_54088 = defunc_0_reduce_res_79093 || defunc_0_reduce_res_79192;
                int64_t ext_90150;
                
                if (cond_54088) {
                    ext_90150 = (int64_t) 0;
                } else {
                    ext_90150 = ctx_param_ext_90076;
                }
                
                int64_t ext_90149;
                
                if (cond_54088) {
                    ext_90149 = m_34473;
                } else {
                    ext_90149 = ctx_param_ext_90077;
                }
                
                int64_t ext_90148;
                
                if (cond_54088) {
                    ext_90148 = (int64_t) 1;
                } else {
                    ext_90148 = ctx_param_ext_90078;
                }
                if (cond_54088) {
                    if (memblock_alloc(ctx, &mem_90109, bytes_89414, "mem_90109")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_90111, bytes_89414, "mem_90111")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_90114, bytes_89448, "mem_90114")) {
                        err = 1;
                        goto cleanup;
                    }
                    for (int64_t i_88975 = 0; i_88975 < m_34473; i_88975++) {
                        double eta_p_79110 = ((double *) mem_90101.mem)[i_88975];
                        double eta_p_79111 = ((double *) mem_param_90088.mem)[i_88975];
                        bool zgze_res_79113 = exp_absorb_cutoff_34478 <= eta_p_79110;
                        bool zl_res_79114 = eta_p_79110 < zs_res_53000;
                        bool x_79115 = !zgze_res_79113;
                        bool y_79116 = zl_res_79114 && x_79115;
                        bool cond_79117 = zgze_res_79113 || y_79116;
                        int64_t binop_y_90133 = i_88975 * ctx_param_ext_90077;
                        int64_t lmad_ext_90134 = ctx_param_ext_90076 + binop_y_90133;
                        int64_t ext_90136;
                        
                        if (cond_79117) {
                            ext_90136 = (int64_t) 0;
                        } else {
                            ext_90136 = lmad_ext_90134;
                        }
                        
                        int64_t ext_90135;
                        
                        if (cond_79117) {
                            ext_90135 = (int64_t) 1;
                        } else {
                            ext_90135 = ctx_param_ext_90078;
                        }
                        
                        double rescale_res_79118;
                        double rescale_res_79119;
                        
                        if (cond_79117) {
                            double log_res_79121 = futrts_log64(eta_p_79110);
                            double sqrt_res_79122 = futrts_sqrt64(eta_p_79110);
                            double zs_res_79123 = log_res_79121 / 2.0;
                            double zp_res_79124 = eta_p_79111 + zs_res_79123;
                            
                            if (memblock_alloc(ctx, &mem_90126, bytes_89414, "mem_90126")) {
                                err = 1;
                                goto cleanup;
                            }
                            for (int64_t i_88967 = 0; i_88967 < m_34473; i_88967++) {
                                double eta_p_79126 = ((double *) mem_param_90079.mem)[ctx_param_ext_90076 + (i_88975 * ctx_param_ext_90077 + i_88967 * ctx_param_ext_90078)];
                                double zt_res_79127 = sqrt_res_79122 * eta_p_79126;
                                
                                ((double *) mem_90126.mem)[i_88967] = zt_res_79127;
                            }
                            if (memblock_set(ctx, &ext_mem_90137, &mem_90126, "mem_90126") != 0)
                                return 1;
                            rescale_res_79118 = sqrt_res_79122;
                            rescale_res_79119 = zp_res_79124;
                        } else {
                            if (memblock_set(ctx, &ext_mem_90137, &mem_param_90079, "mem_param_90079") != 0)
                                return 1;
                            rescale_res_79118 = eta_p_79110;
                            rescale_res_79119 = eta_p_79111;
                        }
                        ((double *) mem_90109.mem)[i_88975] = rescale_res_79118;
                        ((double *) mem_90111.mem)[i_88975] = rescale_res_79119;
                        lmad_copy_8b(ctx, 1, (uint64_t *) mem_90114.mem, i_88975 * m_34473, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90137.mem, ext_90136, (int64_t []) {ext_90135}, (int64_t []) {m_34473});
                        if (memblock_unref(ctx, &ext_mem_90137, "ext_mem_90137") != 0)
                            return 1;
                    }
                    if (memblock_set(ctx, &ext_mem_90157, &mem_90109, "mem_90109") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90154, &mem_90111, "mem_90111") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90151, &mem_90114, "mem_90114") != 0)
                        return 1;
                } else {
                    if (memblock_set(ctx, &ext_mem_90157, &mem_90101, "mem_90101") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90154, &mem_param_90088, "mem_param_90088") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90151, &mem_param_90079, "mem_param_90079") != 0)
                        return 1;
                }
                if (memblock_unref(ctx, &mem_90101, "mem_90101") != 0)
                    return 1;
                
                bool x_91091 = !defunc_0_reduce_res_79189;
                bool defunc_0_reduce_res_79132;
                
                if (x_91091) {
                    bool x_91093;
                    bool redout_88979 = 0;
                    
                    for (int64_t i_88980 = 0; i_88980 < m_34473; i_88980++) {
                        double eta_p_60951 = ((double *) mem_90093.mem)[i_88980];
                        bool zlze_res_60952 = eta_p_60951 <= zs_res_53000;
                        bool defunc_0_op_res_54140 = zlze_res_60952 || redout_88979;
                        bool redout_tmp_91460 = defunc_0_op_res_54140;
                        
                        redout_88979 = redout_tmp_91460;
                    }
                    x_91093 = redout_88979;
                    defunc_0_reduce_res_79132 = x_91093;
                } else {
                    defunc_0_reduce_res_79132 = 0;
                }
                
                bool cond_54131 = defunc_0_reduce_res_79132 || defunc_0_reduce_res_79189;
                int64_t ext_90200;
                
                if (cond_54131) {
                    ext_90200 = (int64_t) 0;
                } else {
                    ext_90200 = ext_90150;
                }
                
                int64_t ext_90199;
                
                if (cond_54131) {
                    ext_90199 = (int64_t) 1;
                } else {
                    ext_90199 = ext_90149;
                }
                
                int64_t ext_90198;
                
                if (cond_54131) {
                    ext_90198 = m_34473;
                } else {
                    ext_90198 = ext_90148;
                }
                if (cond_54131) {
                    if (memblock_alloc(ctx, &mem_90159, bytes_89414, "mem_90159")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_90161, bytes_89414, "mem_90161")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_90164, bytes_89448, "mem_90164")) {
                        err = 1;
                        goto cleanup;
                    }
                    for (int64_t i_88991 = 0; i_88991 < m_34473; i_88991++) {
                        double eta_p_79151 = ((double *) mem_90093.mem)[i_88991];
                        double eta_p_79152 = ((double *) mem_param_90091.mem)[i_88991];
                        bool zgze_res_79154 = exp_absorb_cutoff_34478 <= eta_p_79151;
                        bool zl_res_79155 = eta_p_79151 < zs_res_53000;
                        bool x_79156 = !zgze_res_79154;
                        bool y_79157 = zl_res_79155 && x_79156;
                        bool cond_79158 = zgze_res_79154 || y_79157;
                        int64_t binop_y_90183 = i_88991 * ext_90148;
                        int64_t lmad_ext_90184 = ext_90150 + binop_y_90183;
                        int64_t ext_90186;
                        
                        if (cond_79158) {
                            ext_90186 = (int64_t) 0;
                        } else {
                            ext_90186 = lmad_ext_90184;
                        }
                        
                        int64_t ext_90185;
                        
                        if (cond_79158) {
                            ext_90185 = (int64_t) 1;
                        } else {
                            ext_90185 = ext_90149;
                        }
                        
                        double rescale_res_79159;
                        double rescale_res_79160;
                        
                        if (cond_79158) {
                            double log_res_79162 = futrts_log64(eta_p_79151);
                            double sqrt_res_79163 = futrts_sqrt64(eta_p_79151);
                            double zs_res_79164 = log_res_79162 / 2.0;
                            double zp_res_79165 = eta_p_79152 + zs_res_79164;
                            
                            if (memblock_alloc(ctx, &mem_90176, bytes_89414, "mem_90176")) {
                                err = 1;
                                goto cleanup;
                            }
                            for (int64_t i_88983 = 0; i_88983 < m_34473; i_88983++) {
                                double eta_p_79167 = ((double *) ext_mem_90151.mem)[ext_90150 + (i_88983 * ext_90149 + i_88991 * ext_90148)];
                                double zt_res_79168 = sqrt_res_79163 * eta_p_79167;
                                
                                ((double *) mem_90176.mem)[i_88983] = zt_res_79168;
                            }
                            if (memblock_set(ctx, &ext_mem_90187, &mem_90176, "mem_90176") != 0)
                                return 1;
                            rescale_res_79159 = sqrt_res_79163;
                            rescale_res_79160 = zp_res_79165;
                        } else {
                            if (memblock_set(ctx, &ext_mem_90187, &ext_mem_90151, "ext_mem_90151") != 0)
                                return 1;
                            rescale_res_79159 = eta_p_79151;
                            rescale_res_79160 = eta_p_79152;
                        }
                        ((double *) mem_90159.mem)[i_88991] = rescale_res_79159;
                        ((double *) mem_90161.mem)[i_88991] = rescale_res_79160;
                        lmad_copy_8b(ctx, 1, (uint64_t *) mem_90164.mem, i_88991 * m_34473, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90187.mem, ext_90186, (int64_t []) {ext_90185}, (int64_t []) {m_34473});
                        if (memblock_unref(ctx, &ext_mem_90187, "ext_mem_90187") != 0)
                            return 1;
                    }
                    if (memblock_set(ctx, &ext_mem_90207, &mem_90159, "mem_90159") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90204, &mem_90161, "mem_90161") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90201, &mem_90164, "mem_90164") != 0)
                        return 1;
                } else {
                    if (memblock_set(ctx, &ext_mem_90207, &mem_90093, "mem_90093") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90204, &mem_param_90091, "mem_param_90091") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90201, &ext_mem_90151, "ext_mem_90151") != 0)
                        return 1;
                }
                if (memblock_unref(ctx, &mem_90093, "mem_90093") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90151, "ext_mem_90151") != 0)
                    return 1;
                
                bool defunc_0_reduce_res_79194;
                bool redout_88995 = 1;
                
                for (int64_t i_88996 = 0; i_88996 < m_34473; i_88996++) {
                    double eta_p_60723 = ((double *) ext_mem_90157.mem)[i_88996];
                    bool isnan_res_60724 = futrts_isnan64(eta_p_60723);
                    bool not_res_60725 = !isnan_res_60724;
                    bool x_54176 = not_res_60725 && redout_88995;
                    bool redout_tmp_91465 = x_54176;
                    
                    redout_88995 = redout_tmp_91465;
                }
                defunc_0_reduce_res_79194 = redout_88995;
                
                bool loop_cond_54177;
                
                if (defunc_0_reduce_res_79194) {
                    bool defunc_0_reduce_comm_res_79176;
                    bool redout_88997 = 0;
                    
                    for (int64_t i_88998 = 0; i_88998 < m_34473; i_88998++) {
                        double eta_p_79177 = ((double *) ext_mem_90157.mem)[i_88998];
                        double eta_p_79178 = ((double *) mem_param_90082.mem)[i_88998];
                        double zt_res_79179 = zp_res_79079 * eta_p_79177;
                        bool zgze_res_79180 = eta_p_79178 <= zt_res_79179;
                        double zt_res_79181 = zp_res_79079 * eta_p_79178;
                        bool zgze_res_79182 = eta_p_79177 <= zt_res_79181;
                        bool x_79183 = zgze_res_79180 && zgze_res_79182;
                        bool not_res_79184 = !x_79183;
                        bool defunc_0_op_res_79187 = not_res_79184 || redout_88997;
                        bool redout_tmp_91466 = defunc_0_op_res_79187;
                        
                        redout_88997 = redout_tmp_91466;
                    }
                    defunc_0_reduce_comm_res_79176 = redout_88997;
                    loop_cond_54177 = defunc_0_reduce_comm_res_79176;
                } else {
                    loop_cond_54177 = 0;
                }
                if (memblock_set(ctx, &mem_param_tmp_91424, &mem_param_90079, "mem_param_90079") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91425, &mem_param_90082, "mem_param_90082") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91426, &mem_param_90088, "mem_param_90088") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91427, &mem_param_90091, "mem_param_90091") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91428, &ext_mem_90201, "ext_mem_90201") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91429, &ext_mem_90157, "ext_mem_90157") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91430, &ext_mem_90207, "ext_mem_90207") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91431, &ext_mem_90154, "ext_mem_90154") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_tmp_91432, &ext_mem_90204, "ext_mem_90204") != 0)
                    return 1;
                
                int64_t ctx_param_ext_tmp_91433 = ctx_param_ext_90076;
                int64_t ctx_param_ext_tmp_91434 = ctx_param_ext_90077;
                int64_t ctx_param_ext_tmp_91435 = ctx_param_ext_90078;
                int64_t ctx_param_ext_tmp_91436 = ext_90200;
                int64_t ctx_param_ext_tmp_91437 = ext_90199;
                int64_t ctx_param_ext_tmp_91438 = ext_90198;
                bool loop_while_tmp_91439 = loop_cond_54177;
                
                if (memblock_set(ctx, &mem_param_90066, &mem_param_tmp_91424, "mem_param_tmp_91424") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90069, &mem_param_tmp_91425, "mem_param_tmp_91425") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90072, &mem_param_tmp_91426, "mem_param_tmp_91426") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90075, &mem_param_tmp_91427, "mem_param_tmp_91427") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90079, &mem_param_tmp_91428, "mem_param_tmp_91428") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90082, &mem_param_tmp_91429, "mem_param_tmp_91429") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90085, &mem_param_tmp_91430, "mem_param_tmp_91430") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90088, &mem_param_tmp_91431, "mem_param_tmp_91431") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90091, &mem_param_tmp_91432, "mem_param_tmp_91432") != 0)
                    return 1;
                ctx_param_ext_90063 = ctx_param_ext_tmp_91433;
                ctx_param_ext_90064 = ctx_param_ext_tmp_91434;
                ctx_param_ext_90065 = ctx_param_ext_tmp_91435;
                ctx_param_ext_90076 = ctx_param_ext_tmp_91436;
                ctx_param_ext_90077 = ctx_param_ext_tmp_91437;
                ctx_param_ext_90078 = ctx_param_ext_tmp_91438;
                loop_while_54013 = loop_while_tmp_91439;
            }
            if (memblock_set(ctx, &ext_mem_90236, &mem_param_90066, "mem_param_90066") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_90235, &mem_param_90069, "mem_param_90069") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_90234, &mem_param_90072, "mem_param_90072") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_90233, &mem_param_90075, "mem_param_90075") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_90232, &mem_param_90079, "mem_param_90079") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_90231, &mem_param_90082, "mem_param_90082") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_90230, &mem_param_90085, "mem_param_90085") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_90229, &mem_param_90088, "mem_param_90088") != 0)
                return 1;
            if (memblock_set(ctx, &ext_mem_90228, &mem_param_90091, "mem_param_90091") != 0)
                return 1;
            ext_90227 = ctx_param_ext_90063;
            ext_90226 = ctx_param_ext_90064;
            ext_90225 = ctx_param_ext_90065;
            ext_90218 = ctx_param_ext_90076;
            ext_90217 = ctx_param_ext_90077;
            ext_90216 = ctx_param_ext_90078;
            algo5_core_loop_res_54003 = loop_while_54013;
            if (memblock_unref(ctx, &ext_mem_90009, "ext_mem_90009") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90012, "ext_mem_90012") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90056, "ext_mem_90056") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90059, "ext_mem_90059") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90062, "ext_mem_90062") != 0)
                return 1;
            
            bool defunc_0_reduce_res_80130;
            bool redout_88999 = 1;
            
            for (int64_t i_89000 = 0; i_89000 < m_34473; i_89000++) {
                double eta_p_59131 = ((double *) ext_mem_90231.mem)[i_89000];
                bool isnan_res_59132 = futrts_isnan64(eta_p_59131);
                bool not_res_59133 = !isnan_res_59132;
                bool x_54201 = not_res_59133 && redout_88999;
                bool redout_tmp_91467 = x_54201;
                
                redout_88999 = redout_tmp_91467;
            }
            defunc_0_reduce_res_80130 = redout_88999;
            
            int64_t ext_90515;
            int64_t ext_90514;
            int64_t ext_90513;
            
            if (defunc_0_reduce_res_80130) {
                if (memblock_set(ctx, &ext_mem_90516, &ext_mem_90232, "ext_mem_90232") != 0)
                    return 1;
                ext_90515 = ext_90218;
                ext_90514 = ext_90217;
                ext_90513 = ext_90216;
                if (memblock_set(ctx, &ext_mem_90512, &ext_mem_90231, "ext_mem_90231") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90509, &ext_mem_90230, "ext_mem_90230") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90506, &ext_mem_90229, "ext_mem_90229") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90503, &ext_mem_90228, "ext_mem_90228") != 0)
                    return 1;
            } else {
                if (memblock_alloc(ctx, &mem_90238, bytes_89414, "mem_90238")) {
                    err = 1;
                    goto cleanup;
                }
                
                bool defunc_0_reduce_res_79398;
                bool redout_89004 = 0;
                
                for (int64_t i_89006 = 0; i_89006 < m_34473; i_89006++) {
                    double eta_p_61283 = ((double *) ext_mem_90233.mem)[i_89006];
                    double defunc_0_reduce_res_79196;
                    double redout_89001 = 0.0;
                    
                    for (int64_t i_89002 = 0; i_89002 < m_34473; i_89002++) {
                        double eta_p_61307 = ((double *) ext_mem_90235.mem)[i_89002];
                        double eta_p_61308 = ((double *) ext_mem_90236.mem)[ext_90227 + (i_89002 * ext_90226 + i_89006 * ext_90225)];
                        double zt_res_61309 = eta_p_61307 * eta_p_61308;
                        double zp_res_61292 = zt_res_61309 + redout_89001;
                        double redout_tmp_91470 = zp_res_61292;
                        
                        redout_89001 = redout_tmp_91470;
                    }
                    defunc_0_reduce_res_79196 = redout_89001;
                    
                    double zs_res_61294 = defunc_0_reduce_res_79196 / replicate_arg1_52610;
                    double ztzt_res_61296 = fpow64(zs_res_61294, zs_res_52623);
                    double zt_res_61298 = zs_res_52624 * eta_p_61283;
                    double exp_res_61300 = futrts_exp64(zt_res_61298);
                    double zt_res_61302 = ztzt_res_61296 * exp_res_61300;
                    bool zgze_res_61304 = exp_absorb_cutoff_34478 <= zt_res_61302;
                    bool defunc_0_op_res_54323 = zgze_res_61304 || redout_89004;
                    
                    ((double *) mem_90238.mem)[i_89006] = zt_res_61302;
                    
                    bool redout_tmp_91468 = defunc_0_op_res_54323;
                    
                    redout_89004 = redout_tmp_91468;
                }
                defunc_0_reduce_res_79398 = redout_89004;
                if (memblock_alloc(ctx, &mem_90246, bytes_89414, "mem_90246")) {
                    err = 1;
                    goto cleanup;
                }
                
                bool defunc_0_reduce_res_79401;
                bool redout_89011 = 0;
                
                for (int64_t i_89013 = 0; i_89013 < m_34473; i_89013++) {
                    double eta_p_61203 = ((double *) ext_mem_90234.mem)[i_89013];
                    double defunc_0_reduce_res_79197;
                    double redout_89008 = 0.0;
                    
                    for (int64_t i_89009 = 0; i_89009 < m_34473; i_89009++) {
                        double eta_p_61313 = ((double *) mem_90238.mem)[i_89009];
                        double eta_p_61314 = ((double *) ext_mem_90236.mem)[ext_90227 + (i_89013 * ext_90226 + i_89009 * ext_90225)];
                        double zt_res_61315 = eta_p_61313 * eta_p_61314;
                        double zp_res_61212 = zt_res_61315 + redout_89008;
                        double redout_tmp_91473 = zp_res_61212;
                        
                        redout_89008 = redout_tmp_91473;
                    }
                    defunc_0_reduce_res_79197 = redout_89008;
                    
                    double zs_res_61214 = defunc_0_reduce_res_79197 / replicate_arg1_52610;
                    double ztzt_res_61216 = fpow64(zs_res_61214, zs_res_52619);
                    double zt_res_61218 = zs_res_52620 * eta_p_61203;
                    double exp_res_61220 = futrts_exp64(zt_res_61218);
                    double zt_res_61222 = ztzt_res_61216 * exp_res_61220;
                    bool zgze_res_61224 = exp_absorb_cutoff_34478 <= zt_res_61222;
                    bool defunc_0_op_res_54280 = zgze_res_61224 || redout_89011;
                    
                    ((double *) mem_90246.mem)[i_89013] = zt_res_61222;
                    
                    bool redout_tmp_91471 = defunc_0_op_res_54280;
                    
                    redout_89011 = redout_tmp_91471;
                }
                defunc_0_reduce_res_79401 = redout_89011;
                
                bool x_90962 = !defunc_0_reduce_res_79401;
                bool defunc_0_reduce_res_79198;
                
                if (x_90962) {
                    bool x_90964;
                    bool redout_89015 = 0;
                    
                    for (int64_t i_89016 = 0; i_89016 < m_34473; i_89016++) {
                        double eta_p_61319 = ((double *) mem_90246.mem)[i_89016];
                        bool zlze_res_61320 = eta_p_61319 <= zs_res_53000;
                        bool defunc_0_op_res_54290 = zlze_res_61320 || redout_89015;
                        bool redout_tmp_91474 = defunc_0_op_res_54290;
                        
                        redout_89015 = redout_tmp_91474;
                    }
                    x_90964 = redout_89015;
                    defunc_0_reduce_res_79198 = x_90964;
                } else {
                    defunc_0_reduce_res_79198 = 0;
                }
                
                bool cond_54281 = defunc_0_reduce_res_79198 || defunc_0_reduce_res_79401;
                int64_t ext_90295;
                
                if (cond_54281) {
                    ext_90295 = (int64_t) 0;
                } else {
                    ext_90295 = ext_90227;
                }
                
                int64_t ext_90294;
                
                if (cond_54281) {
                    ext_90294 = m_34473;
                } else {
                    ext_90294 = ext_90226;
                }
                
                int64_t ext_90293;
                
                if (cond_54281) {
                    ext_90293 = (int64_t) 1;
                } else {
                    ext_90293 = ext_90225;
                }
                if (cond_54281) {
                    if (memblock_alloc(ctx, &mem_90254, bytes_89414, "mem_90254")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_90256, bytes_89414, "mem_90256")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_90259, bytes_89448, "mem_90259")) {
                        err = 1;
                        goto cleanup;
                    }
                    for (int64_t i_89027 = 0; i_89027 < m_34473; i_89027++) {
                        double eta_p_79215 = ((double *) mem_90246.mem)[i_89027];
                        double eta_p_79216 = ((double *) ext_mem_90234.mem)[i_89027];
                        bool zgze_res_79218 = exp_absorb_cutoff_34478 <= eta_p_79215;
                        bool zl_res_79219 = eta_p_79215 < zs_res_53000;
                        bool x_79220 = !zgze_res_79218;
                        bool y_79221 = zl_res_79219 && x_79220;
                        bool cond_79222 = zgze_res_79218 || y_79221;
                        int64_t binop_y_90278 = i_89027 * ext_90226;
                        int64_t lmad_ext_90279 = ext_90227 + binop_y_90278;
                        int64_t ext_90281;
                        
                        if (cond_79222) {
                            ext_90281 = (int64_t) 0;
                        } else {
                            ext_90281 = lmad_ext_90279;
                        }
                        
                        int64_t ext_90280;
                        
                        if (cond_79222) {
                            ext_90280 = (int64_t) 1;
                        } else {
                            ext_90280 = ext_90225;
                        }
                        
                        double rescale_res_79223;
                        double rescale_res_79224;
                        
                        if (cond_79222) {
                            double log_res_79226 = futrts_log64(eta_p_79215);
                            double sqrt_res_79227 = futrts_sqrt64(eta_p_79215);
                            double zs_res_79228 = log_res_79226 / 2.0;
                            double zp_res_79229 = eta_p_79216 + zs_res_79228;
                            
                            if (memblock_alloc(ctx, &mem_90271, bytes_89414, "mem_90271")) {
                                err = 1;
                                goto cleanup;
                            }
                            for (int64_t i_89019 = 0; i_89019 < m_34473; i_89019++) {
                                double eta_p_79231 = ((double *) ext_mem_90236.mem)[ext_90227 + (i_89027 * ext_90226 + i_89019 * ext_90225)];
                                double zt_res_79232 = sqrt_res_79227 * eta_p_79231;
                                
                                ((double *) mem_90271.mem)[i_89019] = zt_res_79232;
                            }
                            if (memblock_set(ctx, &ext_mem_90282, &mem_90271, "mem_90271") != 0)
                                return 1;
                            rescale_res_79223 = sqrt_res_79227;
                            rescale_res_79224 = zp_res_79229;
                        } else {
                            if (memblock_set(ctx, &ext_mem_90282, &ext_mem_90236, "ext_mem_90236") != 0)
                                return 1;
                            rescale_res_79223 = eta_p_79215;
                            rescale_res_79224 = eta_p_79216;
                        }
                        ((double *) mem_90254.mem)[i_89027] = rescale_res_79223;
                        ((double *) mem_90256.mem)[i_89027] = rescale_res_79224;
                        lmad_copy_8b(ctx, 1, (uint64_t *) mem_90259.mem, i_89027 * m_34473, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90282.mem, ext_90281, (int64_t []) {ext_90280}, (int64_t []) {m_34473});
                        if (memblock_unref(ctx, &ext_mem_90282, "ext_mem_90282") != 0)
                            return 1;
                    }
                    if (memblock_set(ctx, &ext_mem_90302, &mem_90254, "mem_90254") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90299, &mem_90256, "mem_90256") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90296, &mem_90259, "mem_90259") != 0)
                        return 1;
                } else {
                    if (memblock_set(ctx, &ext_mem_90302, &mem_90246, "mem_90246") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90299, &ext_mem_90234, "ext_mem_90234") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90296, &ext_mem_90236, "ext_mem_90236") != 0)
                        return 1;
                }
                if (memblock_unref(ctx, &mem_90246, "mem_90246") != 0)
                    return 1;
                
                bool x_90958 = !defunc_0_reduce_res_79398;
                bool defunc_0_reduce_res_79237;
                
                if (x_90958) {
                    bool x_90960;
                    bool redout_89031 = 0;
                    
                    for (int64_t i_89032 = 0; i_89032 < m_34473; i_89032++) {
                        double eta_p_61362 = ((double *) mem_90238.mem)[i_89032];
                        bool zlze_res_61363 = eta_p_61362 <= zs_res_53000;
                        bool defunc_0_op_res_54333 = zlze_res_61363 || redout_89031;
                        bool redout_tmp_91479 = defunc_0_op_res_54333;
                        
                        redout_89031 = redout_tmp_91479;
                    }
                    x_90960 = redout_89031;
                    defunc_0_reduce_res_79237 = x_90960;
                } else {
                    defunc_0_reduce_res_79237 = 0;
                }
                
                bool cond_54324 = defunc_0_reduce_res_79237 || defunc_0_reduce_res_79398;
                int64_t ext_90345;
                
                if (cond_54324) {
                    ext_90345 = (int64_t) 0;
                } else {
                    ext_90345 = ext_90295;
                }
                
                int64_t ext_90344;
                
                if (cond_54324) {
                    ext_90344 = (int64_t) 1;
                } else {
                    ext_90344 = ext_90294;
                }
                
                int64_t ext_90343;
                
                if (cond_54324) {
                    ext_90343 = m_34473;
                } else {
                    ext_90343 = ext_90293;
                }
                if (cond_54324) {
                    if (memblock_alloc(ctx, &mem_90304, bytes_89414, "mem_90304")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_90306, bytes_89414, "mem_90306")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc(ctx, &mem_90309, bytes_89448, "mem_90309")) {
                        err = 1;
                        goto cleanup;
                    }
                    for (int64_t i_89043 = 0; i_89043 < m_34473; i_89043++) {
                        double eta_p_79256 = ((double *) mem_90238.mem)[i_89043];
                        double eta_p_79257 = ((double *) ext_mem_90233.mem)[i_89043];
                        bool zgze_res_79259 = exp_absorb_cutoff_34478 <= eta_p_79256;
                        bool zl_res_79260 = eta_p_79256 < zs_res_53000;
                        bool x_79261 = !zgze_res_79259;
                        bool y_79262 = zl_res_79260 && x_79261;
                        bool cond_79263 = zgze_res_79259 || y_79262;
                        int64_t binop_y_90328 = i_89043 * ext_90293;
                        int64_t lmad_ext_90329 = ext_90295 + binop_y_90328;
                        int64_t ext_90331;
                        
                        if (cond_79263) {
                            ext_90331 = (int64_t) 0;
                        } else {
                            ext_90331 = lmad_ext_90329;
                        }
                        
                        int64_t ext_90330;
                        
                        if (cond_79263) {
                            ext_90330 = (int64_t) 1;
                        } else {
                            ext_90330 = ext_90294;
                        }
                        
                        double rescale_res_79264;
                        double rescale_res_79265;
                        
                        if (cond_79263) {
                            double log_res_79267 = futrts_log64(eta_p_79256);
                            double sqrt_res_79268 = futrts_sqrt64(eta_p_79256);
                            double zs_res_79269 = log_res_79267 / 2.0;
                            double zp_res_79270 = eta_p_79257 + zs_res_79269;
                            
                            if (memblock_alloc(ctx, &mem_90321, bytes_89414, "mem_90321")) {
                                err = 1;
                                goto cleanup;
                            }
                            for (int64_t i_89035 = 0; i_89035 < m_34473; i_89035++) {
                                double eta_p_79272 = ((double *) ext_mem_90296.mem)[ext_90295 + (i_89035 * ext_90294 + i_89043 * ext_90293)];
                                double zt_res_79273 = sqrt_res_79268 * eta_p_79272;
                                
                                ((double *) mem_90321.mem)[i_89035] = zt_res_79273;
                            }
                            if (memblock_set(ctx, &ext_mem_90332, &mem_90321, "mem_90321") != 0)
                                return 1;
                            rescale_res_79264 = sqrt_res_79268;
                            rescale_res_79265 = zp_res_79270;
                        } else {
                            if (memblock_set(ctx, &ext_mem_90332, &ext_mem_90296, "ext_mem_90296") != 0)
                                return 1;
                            rescale_res_79264 = eta_p_79256;
                            rescale_res_79265 = eta_p_79257;
                        }
                        ((double *) mem_90304.mem)[i_89043] = rescale_res_79264;
                        ((double *) mem_90306.mem)[i_89043] = rescale_res_79265;
                        lmad_copy_8b(ctx, 1, (uint64_t *) mem_90309.mem, i_89043 * m_34473, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90332.mem, ext_90331, (int64_t []) {ext_90330}, (int64_t []) {m_34473});
                        if (memblock_unref(ctx, &ext_mem_90332, "ext_mem_90332") != 0)
                            return 1;
                    }
                    if (memblock_set(ctx, &ext_mem_90352, &mem_90304, "mem_90304") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90349, &mem_90306, "mem_90306") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90346, &mem_90309, "mem_90309") != 0)
                        return 1;
                } else {
                    if (memblock_set(ctx, &ext_mem_90352, &mem_90238, "mem_90238") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90349, &ext_mem_90233, "ext_mem_90233") != 0)
                        return 1;
                    if (memblock_set(ctx, &ext_mem_90346, &ext_mem_90296, "ext_mem_90296") != 0)
                        return 1;
                }
                if (memblock_unref(ctx, &mem_90238, "mem_90238") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90296, "ext_mem_90296") != 0)
                    return 1;
                
                bool defunc_0_reduce_res_79403;
                bool redout_89047 = 1;
                
                for (int64_t i_89048 = 0; i_89048 < m_34473; i_89048++) {
                    double eta_p_61134 = ((double *) ext_mem_90302.mem)[i_89048];
                    bool isnan_res_61135 = futrts_isnan64(eta_p_61134);
                    bool not_res_61136 = !isnan_res_61135;
                    bool x_54369 = not_res_61136 && redout_89047;
                    bool redout_tmp_91484 = x_54369;
                    
                    redout_89047 = redout_tmp_91484;
                }
                defunc_0_reduce_res_79403 = redout_89047;
                
                bool defunc_0_reduce_comm_res_79281;
                
                if (defunc_0_reduce_res_79403) {
                    bool x_90956;
                    bool redout_89049 = 0;
                    
                    for (int64_t i_89050 = 0; i_89050 < m_34473; i_89050++) {
                        double eta_p_79282 = ((double *) ext_mem_90302.mem)[i_89050];
                        double eta_p_79283 = ((double *) ext_mem_90235.mem)[i_89050];
                        double zt_res_79284 = zp_res_79079 * eta_p_79282;
                        bool zgze_res_79285 = eta_p_79283 <= zt_res_79284;
                        double zt_res_79286 = zp_res_79079 * eta_p_79283;
                        bool zgze_res_79287 = eta_p_79282 <= zt_res_79286;
                        bool x_79288 = zgze_res_79285 && zgze_res_79287;
                        bool not_res_79289 = !x_79288;
                        bool defunc_0_op_res_79292 = not_res_79289 || redout_89049;
                        bool redout_tmp_91485 = defunc_0_op_res_79292;
                        
                        redout_89049 = redout_tmp_91485;
                    }
                    x_90956 = redout_89049;
                    defunc_0_reduce_comm_res_79281 = x_90956;
                } else {
                    defunc_0_reduce_comm_res_79281 = 0;
                }
                
                bool x_91084 = defunc_0_reduce_comm_res_79281 && defunc_0_reduce_res_79403;
                int64_t ext_90495;
                int64_t ext_90494;
                int64_t ext_90493;
                bool algo5_core_loop_res_f_res_54386;
                bool loop_while_54392;
                int64_t ctx_param_ext_90353;
                int64_t ctx_param_ext_90354;
                int64_t ctx_param_ext_90355;
                
                if (memblock_set(ctx, &mem_param_90356, &ext_mem_90346, "ext_mem_90346") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90359, &ext_mem_90302, "ext_mem_90302") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90362, &ext_mem_90352, "ext_mem_90352") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90365, &ext_mem_90299, "ext_mem_90299") != 0)
                    return 1;
                if (memblock_set(ctx, &mem_param_90368, &ext_mem_90349, "ext_mem_90349") != 0)
                    return 1;
                ctx_param_ext_90353 = ext_90345;
                ctx_param_ext_90354 = ext_90344;
                ctx_param_ext_90355 = ext_90343;
                loop_while_54392 = x_91084;
                while (loop_while_54392) {
                    if (memblock_alloc(ctx, &mem_90370, bytes_89414, "mem_90370")) {
                        err = 1;
                        goto cleanup;
                    }
                    
                    bool defunc_0_reduce_res_79392;
                    bool redout_89054 = 0;
                    
                    for (int64_t i_89056 = 0; i_89056 < m_34473; i_89056++) {
                        double eta_p_61582 = ((double *) mem_param_90368.mem)[i_89056];
                        double defunc_0_reduce_res_79294;
                        double redout_89051 = 0.0;
                        
                        for (int64_t i_89052 = 0; i_89052 < m_34473; i_89052++) {
                            double eta_p_61606 = ((double *) mem_param_90359.mem)[i_89052];
                            double eta_p_61607 = ((double *) mem_param_90356.mem)[ctx_param_ext_90353 + (i_89052 * ctx_param_ext_90354 + i_89056 * ctx_param_ext_90355)];
                            double zt_res_61608 = eta_p_61606 * eta_p_61607;
                            double zp_res_61591 = zt_res_61608 + redout_89051;
                            double redout_tmp_91502 = zp_res_61591;
                            
                            redout_89051 = redout_tmp_91502;
                        }
                        defunc_0_reduce_res_79294 = redout_89051;
                        
                        double zs_res_61593 = defunc_0_reduce_res_79294 / replicate_arg1_52610;
                        double ztzt_res_61595 = fpow64(zs_res_61593, zs_res_52623);
                        double zt_res_61597 = zs_res_52624 * eta_p_61582;
                        double exp_res_61599 = futrts_exp64(zt_res_61597);
                        double zt_res_61601 = ztzt_res_61595 * exp_res_61599;
                        bool zgze_res_61603 = exp_absorb_cutoff_34478 <= zt_res_61601;
                        bool defunc_0_op_res_54505 = zgze_res_61603 || redout_89054;
                        
                        ((double *) mem_90370.mem)[i_89056] = zt_res_61601;
                        
                        bool redout_tmp_91500 = defunc_0_op_res_54505;
                        
                        redout_89054 = redout_tmp_91500;
                    }
                    defunc_0_reduce_res_79392 = redout_89054;
                    if (memblock_alloc(ctx, &mem_90378, bytes_89414, "mem_90378")) {
                        err = 1;
                        goto cleanup;
                    }
                    
                    bool defunc_0_reduce_res_79395;
                    bool redout_89061 = 0;
                    
                    for (int64_t i_89063 = 0; i_89063 < m_34473; i_89063++) {
                        double eta_p_61502 = ((double *) mem_param_90365.mem)[i_89063];
                        double defunc_0_reduce_res_79295;
                        double redout_89058 = 0.0;
                        
                        for (int64_t i_89059 = 0; i_89059 < m_34473; i_89059++) {
                            double eta_p_61612 = ((double *) mem_90370.mem)[i_89059];
                            double eta_p_61613 = ((double *) mem_param_90356.mem)[ctx_param_ext_90353 + (i_89063 * ctx_param_ext_90354 + i_89059 * ctx_param_ext_90355)];
                            double zt_res_61614 = eta_p_61612 * eta_p_61613;
                            double zp_res_61511 = zt_res_61614 + redout_89058;
                            double redout_tmp_91505 = zp_res_61511;
                            
                            redout_89058 = redout_tmp_91505;
                        }
                        defunc_0_reduce_res_79295 = redout_89058;
                        
                        double zs_res_61513 = defunc_0_reduce_res_79295 / replicate_arg1_52610;
                        double ztzt_res_61515 = fpow64(zs_res_61513, zs_res_52619);
                        double zt_res_61517 = zs_res_52620 * eta_p_61502;
                        double exp_res_61519 = futrts_exp64(zt_res_61517);
                        double zt_res_61521 = ztzt_res_61515 * exp_res_61519;
                        bool zgze_res_61523 = exp_absorb_cutoff_34478 <= zt_res_61521;
                        bool defunc_0_op_res_54462 = zgze_res_61523 || redout_89061;
                        
                        ((double *) mem_90378.mem)[i_89063] = zt_res_61521;
                        
                        bool redout_tmp_91503 = defunc_0_op_res_54462;
                        
                        redout_89061 = redout_tmp_91503;
                    }
                    defunc_0_reduce_res_79395 = redout_89061;
                    
                    bool x_90950 = !defunc_0_reduce_res_79395;
                    bool defunc_0_reduce_res_79296;
                    
                    if (x_90950) {
                        bool x_90952;
                        bool redout_89065 = 0;
                        
                        for (int64_t i_89066 = 0; i_89066 < m_34473; i_89066++) {
                            double eta_p_61618 = ((double *) mem_90378.mem)[i_89066];
                            bool zlze_res_61619 = eta_p_61618 <= zs_res_53000;
                            bool defunc_0_op_res_54472 = zlze_res_61619 || redout_89065;
                            bool redout_tmp_91506 = defunc_0_op_res_54472;
                            
                            redout_89065 = redout_tmp_91506;
                        }
                        x_90952 = redout_89065;
                        defunc_0_reduce_res_79296 = x_90952;
                    } else {
                        defunc_0_reduce_res_79296 = 0;
                    }
                    
                    bool cond_54463 = defunc_0_reduce_res_79296 || defunc_0_reduce_res_79395;
                    int64_t ext_90427;
                    
                    if (cond_54463) {
                        ext_90427 = (int64_t) 0;
                    } else {
                        ext_90427 = ctx_param_ext_90353;
                    }
                    
                    int64_t ext_90426;
                    
                    if (cond_54463) {
                        ext_90426 = m_34473;
                    } else {
                        ext_90426 = ctx_param_ext_90354;
                    }
                    
                    int64_t ext_90425;
                    
                    if (cond_54463) {
                        ext_90425 = (int64_t) 1;
                    } else {
                        ext_90425 = ctx_param_ext_90355;
                    }
                    if (cond_54463) {
                        if (memblock_alloc(ctx, &mem_90386, bytes_89414, "mem_90386")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (memblock_alloc(ctx, &mem_90388, bytes_89414, "mem_90388")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (memblock_alloc(ctx, &mem_90391, bytes_89448, "mem_90391")) {
                            err = 1;
                            goto cleanup;
                        }
                        for (int64_t i_89077 = 0; i_89077 < m_34473; i_89077++) {
                            double eta_p_79313 = ((double *) mem_90378.mem)[i_89077];
                            double eta_p_79314 = ((double *) mem_param_90365.mem)[i_89077];
                            bool zgze_res_79316 = exp_absorb_cutoff_34478 <= eta_p_79313;
                            bool zl_res_79317 = eta_p_79313 < zs_res_53000;
                            bool x_79318 = !zgze_res_79316;
                            bool y_79319 = zl_res_79317 && x_79318;
                            bool cond_79320 = zgze_res_79316 || y_79319;
                            int64_t binop_y_90410 = i_89077 * ctx_param_ext_90354;
                            int64_t lmad_ext_90411 = ctx_param_ext_90353 + binop_y_90410;
                            int64_t ext_90413;
                            
                            if (cond_79320) {
                                ext_90413 = (int64_t) 0;
                            } else {
                                ext_90413 = lmad_ext_90411;
                            }
                            
                            int64_t ext_90412;
                            
                            if (cond_79320) {
                                ext_90412 = (int64_t) 1;
                            } else {
                                ext_90412 = ctx_param_ext_90355;
                            }
                            
                            double rescale_res_79321;
                            double rescale_res_79322;
                            
                            if (cond_79320) {
                                double log_res_79324 = futrts_log64(eta_p_79313);
                                double sqrt_res_79325 = futrts_sqrt64(eta_p_79313);
                                double zs_res_79326 = log_res_79324 / 2.0;
                                double zp_res_79327 = eta_p_79314 + zs_res_79326;
                                
                                if (memblock_alloc(ctx, &mem_90403, bytes_89414, "mem_90403")) {
                                    err = 1;
                                    goto cleanup;
                                }
                                for (int64_t i_89069 = 0; i_89069 < m_34473; i_89069++) {
                                    double eta_p_79329 = ((double *) mem_param_90356.mem)[ctx_param_ext_90353 + (i_89077 * ctx_param_ext_90354 + i_89069 * ctx_param_ext_90355)];
                                    double zt_res_79330 = sqrt_res_79325 * eta_p_79329;
                                    
                                    ((double *) mem_90403.mem)[i_89069] = zt_res_79330;
                                }
                                if (memblock_set(ctx, &ext_mem_90414, &mem_90403, "mem_90403") != 0)
                                    return 1;
                                rescale_res_79321 = sqrt_res_79325;
                                rescale_res_79322 = zp_res_79327;
                            } else {
                                if (memblock_set(ctx, &ext_mem_90414, &mem_param_90356, "mem_param_90356") != 0)
                                    return 1;
                                rescale_res_79321 = eta_p_79313;
                                rescale_res_79322 = eta_p_79314;
                            }
                            ((double *) mem_90386.mem)[i_89077] = rescale_res_79321;
                            ((double *) mem_90388.mem)[i_89077] = rescale_res_79322;
                            lmad_copy_8b(ctx, 1, (uint64_t *) mem_90391.mem, i_89077 * m_34473, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90414.mem, ext_90413, (int64_t []) {ext_90412}, (int64_t []) {m_34473});
                            if (memblock_unref(ctx, &ext_mem_90414, "ext_mem_90414") != 0)
                                return 1;
                        }
                        if (memblock_set(ctx, &ext_mem_90434, &mem_90386, "mem_90386") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90431, &mem_90388, "mem_90388") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90428, &mem_90391, "mem_90391") != 0)
                            return 1;
                    } else {
                        if (memblock_set(ctx, &ext_mem_90434, &mem_90378, "mem_90378") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90431, &mem_param_90365, "mem_param_90365") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90428, &mem_param_90356, "mem_param_90356") != 0)
                            return 1;
                    }
                    if (memblock_unref(ctx, &mem_90378, "mem_90378") != 0)
                        return 1;
                    
                    bool x_91087 = !defunc_0_reduce_res_79392;
                    bool defunc_0_reduce_res_79335;
                    
                    if (x_91087) {
                        bool x_91089;
                        bool redout_89081 = 0;
                        
                        for (int64_t i_89082 = 0; i_89082 < m_34473; i_89082++) {
                            double eta_p_61661 = ((double *) mem_90370.mem)[i_89082];
                            bool zlze_res_61662 = eta_p_61661 <= zs_res_53000;
                            bool defunc_0_op_res_54515 = zlze_res_61662 || redout_89081;
                            bool redout_tmp_91511 = defunc_0_op_res_54515;
                            
                            redout_89081 = redout_tmp_91511;
                        }
                        x_91089 = redout_89081;
                        defunc_0_reduce_res_79335 = x_91089;
                    } else {
                        defunc_0_reduce_res_79335 = 0;
                    }
                    
                    bool cond_54506 = defunc_0_reduce_res_79335 || defunc_0_reduce_res_79392;
                    int64_t ext_90477;
                    
                    if (cond_54506) {
                        ext_90477 = (int64_t) 0;
                    } else {
                        ext_90477 = ext_90427;
                    }
                    
                    int64_t ext_90476;
                    
                    if (cond_54506) {
                        ext_90476 = (int64_t) 1;
                    } else {
                        ext_90476 = ext_90426;
                    }
                    
                    int64_t ext_90475;
                    
                    if (cond_54506) {
                        ext_90475 = m_34473;
                    } else {
                        ext_90475 = ext_90425;
                    }
                    if (cond_54506) {
                        if (memblock_alloc(ctx, &mem_90436, bytes_89414, "mem_90436")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (memblock_alloc(ctx, &mem_90438, bytes_89414, "mem_90438")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (memblock_alloc(ctx, &mem_90441, bytes_89448, "mem_90441")) {
                            err = 1;
                            goto cleanup;
                        }
                        for (int64_t i_89093 = 0; i_89093 < m_34473; i_89093++) {
                            double eta_p_79354 = ((double *) mem_90370.mem)[i_89093];
                            double eta_p_79355 = ((double *) mem_param_90368.mem)[i_89093];
                            bool zgze_res_79357 = exp_absorb_cutoff_34478 <= eta_p_79354;
                            bool zl_res_79358 = eta_p_79354 < zs_res_53000;
                            bool x_79359 = !zgze_res_79357;
                            bool y_79360 = zl_res_79358 && x_79359;
                            bool cond_79361 = zgze_res_79357 || y_79360;
                            int64_t binop_y_90460 = i_89093 * ext_90425;
                            int64_t lmad_ext_90461 = ext_90427 + binop_y_90460;
                            int64_t ext_90463;
                            
                            if (cond_79361) {
                                ext_90463 = (int64_t) 0;
                            } else {
                                ext_90463 = lmad_ext_90461;
                            }
                            
                            int64_t ext_90462;
                            
                            if (cond_79361) {
                                ext_90462 = (int64_t) 1;
                            } else {
                                ext_90462 = ext_90426;
                            }
                            
                            double rescale_res_79362;
                            double rescale_res_79363;
                            
                            if (cond_79361) {
                                double log_res_79365 = futrts_log64(eta_p_79354);
                                double sqrt_res_79366 = futrts_sqrt64(eta_p_79354);
                                double zs_res_79367 = log_res_79365 / 2.0;
                                double zp_res_79368 = eta_p_79355 + zs_res_79367;
                                
                                if (memblock_alloc(ctx, &mem_90453, bytes_89414, "mem_90453")) {
                                    err = 1;
                                    goto cleanup;
                                }
                                for (int64_t i_89085 = 0; i_89085 < m_34473; i_89085++) {
                                    double eta_p_79370 = ((double *) ext_mem_90428.mem)[ext_90427 + (i_89085 * ext_90426 + i_89093 * ext_90425)];
                                    double zt_res_79371 = sqrt_res_79366 * eta_p_79370;
                                    
                                    ((double *) mem_90453.mem)[i_89085] = zt_res_79371;
                                }
                                if (memblock_set(ctx, &ext_mem_90464, &mem_90453, "mem_90453") != 0)
                                    return 1;
                                rescale_res_79362 = sqrt_res_79366;
                                rescale_res_79363 = zp_res_79368;
                            } else {
                                if (memblock_set(ctx, &ext_mem_90464, &ext_mem_90428, "ext_mem_90428") != 0)
                                    return 1;
                                rescale_res_79362 = eta_p_79354;
                                rescale_res_79363 = eta_p_79355;
                            }
                            ((double *) mem_90436.mem)[i_89093] = rescale_res_79362;
                            ((double *) mem_90438.mem)[i_89093] = rescale_res_79363;
                            lmad_copy_8b(ctx, 1, (uint64_t *) mem_90441.mem, i_89093 * m_34473, (int64_t []) {(int64_t) 1}, (uint64_t *) ext_mem_90464.mem, ext_90463, (int64_t []) {ext_90462}, (int64_t []) {m_34473});
                            if (memblock_unref(ctx, &ext_mem_90464, "ext_mem_90464") != 0)
                                return 1;
                        }
                        if (memblock_set(ctx, &ext_mem_90484, &mem_90436, "mem_90436") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90481, &mem_90438, "mem_90438") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90478, &mem_90441, "mem_90441") != 0)
                            return 1;
                    } else {
                        if (memblock_set(ctx, &ext_mem_90484, &mem_90370, "mem_90370") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90481, &mem_param_90368, "mem_param_90368") != 0)
                            return 1;
                        if (memblock_set(ctx, &ext_mem_90478, &ext_mem_90428, "ext_mem_90428") != 0)
                            return 1;
                    }
                    if (memblock_unref(ctx, &mem_90370, "mem_90370") != 0)
                        return 1;
                    if (memblock_unref(ctx, &ext_mem_90428, "ext_mem_90428") != 0)
                        return 1;
                    
                    bool defunc_0_reduce_res_79397;
                    bool redout_89097 = 1;
                    
                    for (int64_t i_89098 = 0; i_89098 < m_34473; i_89098++) {
                        double eta_p_61433 = ((double *) ext_mem_90434.mem)[i_89098];
                        bool isnan_res_61434 = futrts_isnan64(eta_p_61433);
                        bool not_res_61435 = !isnan_res_61434;
                        bool x_54551 = not_res_61435 && redout_89097;
                        bool redout_tmp_91516 = x_54551;
                        
                        redout_89097 = redout_tmp_91516;
                    }
                    defunc_0_reduce_res_79397 = redout_89097;
                    
                    bool loop_cond_54552;
                    
                    if (defunc_0_reduce_res_79397) {
                        bool defunc_0_reduce_comm_res_79379;
                        bool redout_89099 = 0;
                        
                        for (int64_t i_89100 = 0; i_89100 < m_34473; i_89100++) {
                            double eta_p_79380 = ((double *) ext_mem_90434.mem)[i_89100];
                            double eta_p_79381 = ((double *) mem_param_90359.mem)[i_89100];
                            double zt_res_79382 = zp_res_79079 * eta_p_79380;
                            bool zgze_res_79383 = eta_p_79381 <= zt_res_79382;
                            double zt_res_79384 = zp_res_79079 * eta_p_79381;
                            bool zgze_res_79385 = eta_p_79380 <= zt_res_79384;
                            bool x_79386 = zgze_res_79383 && zgze_res_79385;
                            bool not_res_79387 = !x_79386;
                            bool defunc_0_op_res_79390 = not_res_79387 || redout_89099;
                            bool redout_tmp_91517 = defunc_0_op_res_79390;
                            
                            redout_89099 = redout_tmp_91517;
                        }
                        defunc_0_reduce_comm_res_79379 = redout_89099;
                        loop_cond_54552 = defunc_0_reduce_comm_res_79379;
                    } else {
                        loop_cond_54552 = 0;
                    }
                    if (memblock_set(ctx, &mem_param_tmp_91486, &ext_mem_90478, "ext_mem_90478") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_91487, &ext_mem_90434, "ext_mem_90434") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_91488, &ext_mem_90484, "ext_mem_90484") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_91489, &ext_mem_90431, "ext_mem_90431") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_tmp_91490, &ext_mem_90481, "ext_mem_90481") != 0)
                        return 1;
                    
                    int64_t ctx_param_ext_tmp_91491 = ext_90477;
                    int64_t ctx_param_ext_tmp_91492 = ext_90476;
                    int64_t ctx_param_ext_tmp_91493 = ext_90475;
                    bool loop_while_tmp_91494 = loop_cond_54552;
                    
                    if (memblock_set(ctx, &mem_param_90356, &mem_param_tmp_91486, "mem_param_tmp_91486") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_90359, &mem_param_tmp_91487, "mem_param_tmp_91487") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_90362, &mem_param_tmp_91488, "mem_param_tmp_91488") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_90365, &mem_param_tmp_91489, "mem_param_tmp_91489") != 0)
                        return 1;
                    if (memblock_set(ctx, &mem_param_90368, &mem_param_tmp_91490, "mem_param_tmp_91490") != 0)
                        return 1;
                    ctx_param_ext_90353 = ctx_param_ext_tmp_91491;
                    ctx_param_ext_90354 = ctx_param_ext_tmp_91492;
                    ctx_param_ext_90355 = ctx_param_ext_tmp_91493;
                    loop_while_54392 = loop_while_tmp_91494;
                }
                if (memblock_set(ctx, &ext_mem_90500, &mem_param_90356, "mem_param_90356") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90499, &mem_param_90359, "mem_param_90359") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90498, &mem_param_90362, "mem_param_90362") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90497, &mem_param_90365, "mem_param_90365") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90496, &mem_param_90368, "mem_param_90368") != 0)
                    return 1;
                ext_90495 = ctx_param_ext_90353;
                ext_90494 = ctx_param_ext_90354;
                ext_90493 = ctx_param_ext_90355;
                algo5_core_loop_res_f_res_54386 = loop_while_54392;
                if (memblock_unref(ctx, &ext_mem_90299, "ext_mem_90299") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90302, "ext_mem_90302") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90346, "ext_mem_90346") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90349, "ext_mem_90349") != 0)
                    return 1;
                if (memblock_unref(ctx, &ext_mem_90352, "ext_mem_90352") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90516, &ext_mem_90500, "ext_mem_90500") != 0)
                    return 1;
                ext_90515 = ext_90495;
                ext_90514 = ext_90494;
                ext_90513 = ext_90493;
                if (memblock_set(ctx, &ext_mem_90512, &ext_mem_90499, "ext_mem_90499") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90509, &ext_mem_90498, "ext_mem_90498") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90506, &ext_mem_90497, "ext_mem_90497") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90503, &ext_mem_90496, "ext_mem_90496") != 0)
                    return 1;
            }
            if (memblock_unref(ctx, &ext_mem_90228, "ext_mem_90228") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90229, "ext_mem_90229") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90230, "ext_mem_90230") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90231, "ext_mem_90231") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90232, "ext_mem_90232") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90233, "ext_mem_90233") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90234, "ext_mem_90234") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90235, "ext_mem_90235") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90236, "ext_mem_90236") != 0)
                return 1;
            if (memblock_alloc(ctx, &mem_90518, bytes_89414, "mem_90518")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc(ctx, &mem_90523, bytes_89414, "mem_90523")) {
                err = 1;
                goto cleanup;
            }
            
            double defunc_res_80131;
            double redout_89109 = 0.0;
            
            for (int64_t i_89113 = 0; i_89113 < m_34473; i_89113++) {
                double eta_p_74684 = ((double *) ext_mem_90509.mem)[i_89113];
                double eta_p_74685 = ((double *) ext_mem_90503.mem)[i_89113];
                double eta_p_74687 = ((double *) ext_mem_90512.mem)[i_89113];
                double eta_p_74688 = ((double *) ext_mem_90506.mem)[i_89113];
                double log_res_74689 = futrts_log64(eta_p_74687);
                double zp_res_74690 = eta_p_74688 + log_res_74689;
                double defunc_res_79404;
                double redout_89102 = 0.0;
                
                for (int64_t i_89104 = 0; i_89104 < m_34473; i_89104++) {
                    double eta_p_75189 = ((double *) ext_mem_90516.mem)[ext_90515 + (i_89113 * ext_90514 + i_89104 * ext_90513)];
                    double eta_p_wasfree_75190 = ((double *) ext_mem_90509.mem)[i_89104];
                    double zt_res_75191 = eta_p_74687 * eta_p_75189;
                    double zt_res_75192 = eta_p_wasfree_75190 * zt_res_75191;
                    double zp_res_74705 = zt_res_75192 + redout_89102;
                    
                    ((double *) mem_90521)[i_89113 * m_34473 + i_89104] = zt_res_75192;
                    
                    double redout_tmp_91522 = zp_res_74705;
                    
                    redout_89102 = redout_tmp_91522;
                }
                defunc_res_79404 = redout_89102;
                
                double log_res_74696 = futrts_log64(eta_p_74684);
                double zp_res_74697 = eta_p_74685 + log_res_74696;
                double zp_res_54607 = defunc_res_79404 + redout_89109;
                
                ((double *) mem_90518.mem)[i_89113] = zp_res_74697;
                ((double *) mem_90523.mem)[i_89113] = zp_res_74690;
                
                double redout_tmp_91518 = zp_res_54607;
                
                redout_89109 = redout_tmp_91518;
            }
            defunc_res_80131 = redout_89109;
            if (memblock_unref(ctx, &ext_mem_90503, "ext_mem_90503") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90506, "ext_mem_90506") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90509, "ext_mem_90509") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90512, "ext_mem_90512") != 0)
                return 1;
            if (memblock_unref(ctx, &ext_mem_90516, "ext_mem_90516") != 0)
                return 1;
            
            bool zg_res_54608 = 0.0 < defunc_res_80131;
            double zs_res_54609 = defunc_res_80114 / defunc_res_80131;
            double sqrt_res_54610 = futrts_sqrt64(zs_res_54609);
            double descent_res_54614;
            
            if (zg_res_54608) {
                if (mem_90558_cached_sizze_91866 < bytes_89414) {
                    err = lexical_realloc(ctx, &mem_90558, &mem_90558_cached_sizze_91866, bytes_89414);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (mem_90560_cached_sizze_91867 < bytes_89414) {
                    err = lexical_realloc(ctx, &mem_90560, &mem_90560_cached_sizze_91867, bytes_89414);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                
                double defunc_res_79501;
                double defunc_res_79502;
                double redout_89123;
                double redout_89124;
                
                redout_89123 = 0.0;
                redout_89124 = 0.0;
                for (int64_t i_89127 = 0; i_89127 < m_34473; i_89127++) {
                    double defunc_res_79506;
                    double defunc_res_79507;
                    double defunc_res_79508;
                    double redout_89117;
                    double redout_89118;
                    double redout_89119;
                    
                    redout_89117 = 0.0;
                    redout_89118 = 0.0;
                    redout_89119 = 0.0;
                    for (int64_t i_89120 = 0; i_89120 < m_34473; i_89120++) {
                        double x_79509 = ((double *) mem_param_89844.mem)[i_89120 * m_34473 + i_89127];
                        double zp_res_79512 = x_79509 + redout_89117;
                        double zp_res_79515 = x_79509 + redout_89118;
                        double zp_res_79518 = x_79509 + redout_89119;
                        double redout_tmp_91528 = zp_res_79512;
                        double redout_tmp_91529 = zp_res_79515;
                        double redout_tmp_91530 = zp_res_79518;
                        
                        redout_89117 = redout_tmp_91528;
                        redout_89118 = redout_tmp_91529;
                        redout_89119 = redout_tmp_91530;
                    }
                    defunc_res_79506 = redout_89117;
                    defunc_res_79507 = redout_89118;
                    defunc_res_79508 = redout_89119;
                    
                    bool zeze_res_79522 = defunc_res_79508 == 0.0;
                    double klu_res_79523;
                    
                    if (zeze_res_79522) {
                        klu_res_79523 = 0.0;
                    } else {
                        double zs_res_79524 = defunc_res_79508 / replicate_arg1_52610;
                        double log_res_79525 = futrts_log64(zs_res_79524);
                        double zt_res_79526 = defunc_res_79508 * log_res_79525;
                        
                        klu_res_79523 = zt_res_79526;
                    }
                    
                    double zp_res_79529 = defunc_res_79507 + redout_89123;
                    double zp_res_79532 = klu_res_79523 + redout_89124;
                    
                    ((double *) mem_90558)[i_89127] = defunc_res_79508;
                    ((double *) mem_90560)[i_89127] = defunc_res_79506;
                    
                    double redout_tmp_91524 = zp_res_79529;
                    double redout_tmp_91525 = zp_res_79532;
                    
                    redout_89123 = redout_tmp_91524;
                    redout_89124 = redout_tmp_91525;
                }
                defunc_res_79501 = redout_89123;
                defunc_res_79502 = redout_89124;
                
                double zm_res_79537 = defunc_res_79502 - defunc_res_79501;
                double zt_res_79538 = 2.0 * zm_res_79537;
                double zt_res_79539 = 2.0 * defunc_res_79501;
                
                if (mem_90575_cached_sizze_91868 < bytes_89448) {
                    err = lexical_realloc(ctx, &mem_90575, &mem_90575_cached_sizze_91868, bytes_89448);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                for (int64_t i_89132 = 0; i_89132 < m_34473; i_89132++) {
                    double eta_p_79541 = ((double *) mem_90558)[i_89132];
                    double log_res_79542 = futrts_log64(eta_p_79541);
                    double zm_res_79543 = log_res_79542 - log_res_52661;
                    double zp_res_79544 = 1.0 + zm_res_79543;
                    double fma_res_79545 = futrts_fma64(zt_res_79539, zp_res_79544, zt_res_79538);
                    
                    for (int64_t nest_i_91532 = 0; nest_i_91532 < m_34473; nest_i_91532++) {
                        ((double *) mem_90575)[i_89132 * m_34473 + nest_i_91532] = fma_res_79545;
                    }
                }
                if (mem_90587_cached_sizze_91869 < bytes_89414) {
                    err = lexical_realloc(ctx, &mem_90587, &mem_90587_cached_sizze_91869, bytes_89414);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (mem_90589_cached_sizze_91870 < bytes_89414) {
                    err = lexical_realloc(ctx, &mem_90589, &mem_90589_cached_sizze_91870, bytes_89414);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                
                double defunc_res_79548;
                double defunc_res_79549;
                double defunc_res_79550;
                double defunc_res_79551;
                double redout_89142;
                double redout_89143;
                double redout_89144;
                double redout_89145;
                
                redout_89142 = 0.0;
                redout_89143 = 0.0;
                redout_89144 = 0.0;
                redout_89145 = 0.0;
                for (int64_t i_89148 = 0; i_89148 < m_34473; i_89148++) {
                    double defunc_res_79555;
                    double defunc_res_79556;
                    double defunc_res_79557;
                    double defunc_res_79558;
                    double defunc_res_79559;
                    double redout_89134;
                    double redout_89135;
                    double redout_89136;
                    double redout_89137;
                    double redout_89138;
                    
                    redout_89134 = 0.0;
                    redout_89135 = 0.0;
                    redout_89136 = 0.0;
                    redout_89137 = 0.0;
                    redout_89138 = 0.0;
                    for (int64_t i_89139 = 0; i_89139 < m_34473; i_89139++) {
                        double x_79560 = ((double *) mem_param_89844.mem)[i_89148 * m_34473 + i_89139];
                        bool zeze_res_79561 = x_79560 == 0.0;
                        double klu_res_79562;
                        
                        if (zeze_res_79561) {
                            klu_res_79562 = 0.0;
                        } else {
                            double zs_res_79563 = x_79560 / zt_res_52646;
                            double log_res_79564 = futrts_log64(zs_res_79563);
                            double zt_res_79565 = x_79560 * log_res_79564;
                            
                            klu_res_79562 = zt_res_79565;
                        }
                        
                        double zp_res_79568 = x_79560 + redout_89134;
                        double zp_res_79571 = klu_res_79562 + redout_89135;
                        double zp_res_79574 = x_79560 + redout_89136;
                        double zp_res_79577 = x_79560 + redout_89137;
                        double zp_res_79580 = x_79560 + redout_89138;
                        double redout_tmp_91539 = zp_res_79568;
                        double redout_tmp_91540 = zp_res_79571;
                        double redout_tmp_91541 = zp_res_79574;
                        double redout_tmp_91542 = zp_res_79577;
                        double redout_tmp_91543 = zp_res_79580;
                        
                        redout_89134 = redout_tmp_91539;
                        redout_89135 = redout_tmp_91540;
                        redout_89136 = redout_tmp_91541;
                        redout_89137 = redout_tmp_91542;
                        redout_89138 = redout_tmp_91543;
                    }
                    defunc_res_79555 = redout_89134;
                    defunc_res_79556 = redout_89135;
                    defunc_res_79557 = redout_89136;
                    defunc_res_79558 = redout_89137;
                    defunc_res_79559 = redout_89138;
                    
                    bool zeze_res_79586 = defunc_res_79559 == 0.0;
                    double klu_res_79587;
                    
                    if (zeze_res_79586) {
                        klu_res_79587 = 0.0;
                    } else {
                        double zs_res_79588 = defunc_res_79559 / replicate_arg1_52610;
                        double log_res_79589 = futrts_log64(zs_res_79588);
                        double zt_res_79590 = defunc_res_79559 * log_res_79589;
                        
                        klu_res_79587 = zt_res_79590;
                    }
                    
                    double zp_res_79593 = defunc_res_79555 + redout_89142;
                    double zp_res_79596 = defunc_res_79556 + redout_89143;
                    double zp_res_79599 = defunc_res_79558 + redout_89144;
                    double zp_res_79602 = klu_res_79587 + redout_89145;
                    
                    ((double *) mem_90587)[i_89148] = defunc_res_79559;
                    ((double *) mem_90589)[i_89148] = defunc_res_79557;
                    
                    double redout_tmp_91533 = zp_res_79593;
                    double redout_tmp_91534 = zp_res_79596;
                    double redout_tmp_91535 = zp_res_79599;
                    double redout_tmp_91536 = zp_res_79602;
                    
                    redout_89142 = redout_tmp_91533;
                    redout_89143 = redout_tmp_91534;
                    redout_89144 = redout_tmp_91535;
                    redout_89145 = redout_tmp_91536;
                }
                defunc_res_79548 = redout_89142;
                defunc_res_79549 = redout_89143;
                defunc_res_79550 = redout_89144;
                defunc_res_79551 = redout_89145;
                
                double zm_res_79609 = defunc_res_79551 - defunc_res_79550;
                double zt_res_79610 = 2.0 * zm_res_79609;
                double zt_res_79611 = 2.0 * defunc_res_79550;
                
                if (mem_90603_cached_sizze_91871 < bytes_89414) {
                    err = lexical_realloc(ctx, &mem_90603, &mem_90603_cached_sizze_91871, bytes_89414);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                for (int64_t i_89155 = 0; i_89155 < m_34473; i_89155++) {
                    double defunc_0_reduce_res_79614;
                    double redout_89151 = 0.0;
                    
                    for (int64_t i_89152 = 0; i_89152 < m_34473; i_89152++) {
                        double eta_p_79615 = ((double *) A_mem_89411.mem)[eta_p_52629 * (m_34473 * m_34473) + i_89155 * m_34473 + i_89152];
                        double eta_p_79616 = ((double *) mem_90560)[i_89152];
                        double zt_res_79617 = eta_p_79615 * eta_p_79615;
                        double zt_res_79618 = eta_p_79616 * zt_res_79617;
                        double zp_res_79621 = zt_res_79618 + redout_89151;
                        double redout_tmp_91545 = zp_res_79621;
                        
                        redout_89151 = redout_tmp_91545;
                    }
                    defunc_0_reduce_res_79614 = redout_89151;
                    ((double *) mem_90603)[i_89155] = defunc_0_reduce_res_79614;
                }
                
                double zt_res_79624 = 2.0 * defunc_res_79548;
                double zt_res_79625 = 2.0 * defunc_res_79549;
                
                if (mem_90611_cached_sizze_91872 < bytes_89414) {
                    err = lexical_realloc(ctx, &mem_90611, &mem_90611_cached_sizze_91872, bytes_89414);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (mem_90614_cached_sizze_91873 < bytes_89448) {
                    err = lexical_realloc(ctx, &mem_90614, &mem_90614_cached_sizze_91873, bytes_89448);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (memblock_alloc(ctx, &mem_90617, bytes_89448, "mem_90617")) {
                    err = 1;
                    goto cleanup;
                }
                if (mem_90630_cached_sizze_91874 < bytes_89414) {
                    err = lexical_realloc(ctx, &mem_90630, &mem_90630_cached_sizze_91874, bytes_89414);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (mem_90638_cached_sizze_91875 < bytes_89414) {
                    err = lexical_realloc(ctx, &mem_90638, &mem_90638_cached_sizze_91875, bytes_89414);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                
                double defunc_res_79628;
                double defunc_res_79629;
                double defunc_res_79630;
                double defunc_res_79631;
                double redout_89181;
                double redout_89182;
                double redout_89183;
                double redout_89184;
                
                redout_89181 = 0.0;
                redout_89182 = 0.0;
                redout_89183 = 0.0;
                redout_89184 = 0.0;
                for (int64_t i_89188 = 0; i_89188 < m_34473; i_89188++) {
                    double eta_p_79638 = ((double *) mem_90587)[i_89188];
                    double log_res_79641 = futrts_log64(eta_p_79638);
                    double zm_res_79642 = log_res_79641 - log_res_52661;
                    double zp_res_79643 = 1.0 + zm_res_79642;
                    double fma_res_79644 = futrts_fma64(zt_res_79611, zp_res_79643, zt_res_79610);
                    
                    for (int64_t i_89161 = 0; i_89161 < m_34473; i_89161++) {
                        double defunc_0_reduce_res_79647;
                        double redout_89157 = 0.0;
                        
                        for (int64_t i_89158 = 0; i_89158 < m_34473; i_89158++) {
                            double eta_p_79648 = ((double *) A_mem_89411.mem)[eta_p_52628 * (m_34473 * m_34473) + i_89188 * m_34473 + i_89158];
                            double eta_p_79649 = ((double *) mem_param_89844.mem)[i_89158 * m_34473 + i_89161];
                            double zt_res_79650 = eta_p_79648 * eta_p_79649;
                            double zp_res_79653 = zt_res_79650 + redout_89157;
                            double redout_tmp_91554 = zp_res_79653;
                            
                            redout_89157 = redout_tmp_91554;
                        }
                        defunc_0_reduce_res_79647 = redout_89157;
                        ((double *) mem_90630)[i_89161] = defunc_0_reduce_res_79647;
                    }
                    
                    double defunc_0_reduce_res_79656;
                    double redout_89163 = 0.0;
                    
                    for (int64_t i_89164 = 0; i_89164 < m_34473; i_89164++) {
                        double eta_p_79657 = ((double *) A_mem_89411.mem)[eta_p_52628 * (m_34473 * m_34473) + i_89188 * m_34473 + i_89164];
                        double eta_p_79658 = ((double *) mem_90589)[i_89164];
                        double zt_res_79659 = eta_p_79657 * eta_p_79657;
                        double zt_res_79660 = eta_p_79658 * zt_res_79659;
                        double zp_res_79663 = zt_res_79660 + redout_89163;
                        double redout_tmp_91555 = zp_res_79663;
                        
                        redout_89163 = redout_tmp_91555;
                    }
                    defunc_0_reduce_res_79656 = redout_89163;
                    
                    double defunc_0_reduce_res_79665;
                    double defunc_res_79666;
                    double defunc_res_79667;
                    double defunc_res_79668;
                    double redout_89169;
                    double redout_89170;
                    double redout_89171;
                    double redout_89172;
                    
                    redout_89169 = 0.0;
                    redout_89170 = 0.0;
                    redout_89171 = 0.0;
                    redout_89172 = 0.0;
                    for (int64_t i_89175 = 0; i_89175 < m_34473; i_89175++) {
                        double eta_p_79671 = ((double *) mem_90521)[i_89188 * m_34473 + i_89175];
                        double eta_p_79672 = ((double *) mem_param_89844.mem)[i_89188 * m_34473 + i_89175];
                        double eta_p_wasfree_79674 = ((double *) mem_90603)[i_89175];
                        double eta_p_79675 = ((double *) mem_90575)[i_89175 * m_34473 + i_89188];
                        double zt_res_79676 = sqrt_res_54610 * eta_p_79671;
                        double zm_res_79677 = zt_res_79676 - eta_p_79672;
                        double log_res_79678 = futrts_log64(eta_p_79672);
                        double zm_res_79679 = log_res_79678 - log_res_52661;
                        double zm_res_79680 = zm_res_79679 - log_res_52661;
                        double fma_res_79681 = futrts_fma64(zt_res_79624, zm_res_79680, zt_res_79625);
                        double defunc_0_reduce_res_79682;
                        double redout_89165 = 0.0;
                        
                        for (int64_t i_89166 = 0; i_89166 < m_34473; i_89166++) {
                            double eta_p_79683 = ((double *) mem_90630)[i_89166];
                            double eta_p_79684 = ((double *) A_mem_89411.mem)[eta_p_52629 * (m_34473 * m_34473) + i_89166 * m_34473 + i_89175];
                            double zt_res_79685 = eta_p_79683 * eta_p_79684;
                            double zp_res_79688 = zt_res_79685 + redout_89165;
                            double redout_tmp_91562 = zp_res_79688;
                            
                            redout_89165 = redout_tmp_91562;
                        }
                        defunc_0_reduce_res_79682 = redout_89165;
                        
                        double zt_res_79690 = -2.0 * defunc_0_reduce_res_79682;
                        double zp_res_79691 = defunc_0_reduce_res_79656 + zt_res_79690;
                        double zp_res_79692 = eta_p_wasfree_79674 + zp_res_79691;
                        double zt_res_79693 = 2.0 * zp_res_79692;
                        double fma_res_79694 = futrts_fma64(fma_res_79644, rho1_34474, zt_res_79693);
                        double fma_res_79695 = futrts_fma64(eta_p_79675, rho2_34475, fma_res_79694);
                        double fma_res_79696 = futrts_fma64(fma_res_79681, eps_34476, fma_res_79695);
                        double max_res_79697 = fmax64(-1.0e100, fma_res_79696);
                        double zt_res_79698 = zm_res_79677 * max_res_79697;
                        double zp_res_79699 = eta_p_79672 + zm_res_79677;
                        bool zeze_res_79700 = zp_res_79699 == 0.0;
                        double klu_res_79701;
                        
                        if (zeze_res_79700) {
                            klu_res_79701 = 0.0;
                        } else {
                            double zs_res_79702 = zp_res_79699 / zt_res_52646;
                            double log_res_79703 = futrts_log64(zs_res_79702);
                            double zt_res_79704 = zp_res_79699 * log_res_79703;
                            
                            klu_res_79701 = zt_res_79704;
                        }
                        
                        double zp_res_79707 = zt_res_79698 + redout_89169;
                        double zp_res_79710 = klu_res_79701 + redout_89170;
                        double zp_res_79713 = zp_res_79699 + redout_89171;
                        double zp_res_79716 = zp_res_79699 + redout_89172;
                        
                        ((double *) mem_90638)[i_89175] = zp_res_79699;
                        ((double *) mem_90617.mem)[i_89188 * m_34473 + i_89175] = zm_res_79677;
                        
                        double redout_tmp_91556 = zp_res_79707;
                        double redout_tmp_91557 = zp_res_79710;
                        double redout_tmp_91558 = zp_res_79713;
                        double redout_tmp_91559 = zp_res_79716;
                        
                        redout_89169 = redout_tmp_91556;
                        redout_89170 = redout_tmp_91557;
                        redout_89171 = redout_tmp_91558;
                        redout_89172 = redout_tmp_91559;
                    }
                    defunc_0_reduce_res_79665 = redout_89169;
                    defunc_res_79666 = redout_89170;
                    defunc_res_79667 = redout_89171;
                    defunc_res_79668 = redout_89172;
                    
                    bool zeze_res_79723 = defunc_res_79668 == 0.0;
                    double klu_res_79724;
                    
                    if (zeze_res_79723) {
                        klu_res_79724 = 0.0;
                    } else {
                        double zs_res_79725 = defunc_res_79668 / replicate_arg1_52610;
                        double log_res_79726 = futrts_log64(zs_res_79725);
                        double zt_res_79727 = defunc_res_79668 * log_res_79726;
                        
                        klu_res_79724 = zt_res_79727;
                    }
                    
                    double zp_res_79730 = defunc_0_reduce_res_79665 + redout_89181;
                    double zp_res_79733 = klu_res_79724 + redout_89182;
                    double zp_res_79736 = defunc_res_79668 + redout_89183;
                    double zp_res_79739 = defunc_res_79666 + redout_89184;
                    
                    ((double *) mem_90611)[i_89188] = defunc_res_79667;
                    lmad_copy_8b(ctx, 1, (uint64_t *) mem_90614, i_89188 * m_34473, (int64_t []) {(int64_t) 1}, (uint64_t *) mem_90638, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_34473});
                    
                    double redout_tmp_91546 = zp_res_79730;
                    double redout_tmp_91547 = zp_res_79733;
                    double redout_tmp_91548 = zp_res_79736;
                    double redout_tmp_91549 = zp_res_79739;
                    
                    redout_89181 = redout_tmp_91546;
                    redout_89182 = redout_tmp_91547;
                    redout_89183 = redout_tmp_91548;
                    redout_89184 = redout_tmp_91549;
                }
                defunc_res_79628 = redout_89181;
                defunc_res_79629 = redout_89182;
                defunc_res_79630 = redout_89183;
                defunc_res_79631 = redout_89184;
                
                bool zl_res_79747 = defunc_res_79628 < 0.0;
                bool assert_c_79748;
                
                if (!zl_res_79747) {
                    set_error(ctx, msgprintf("Error: %s\n\nBacktrace:\n%s", "Assertion is false: M.((gradient) M.< zero)", "-> #0  common.fut:220:7-221:22\n   #1  unbalanced_gw_core.fut:388:48-393:78\n   #2  unbalanced_gw_core.fut:402:7-11\n   #3  unbalanced_gw.fut:163:9-165:83\n   #4  /prelude/functional.fut:9:44-45\n   #5  unbalanced_gw.fut:162:6-165:84\n   #6  unbalanced_gw.fut:194:1-197:45\n"));
                    err = FUTHARK_PROGRAM_ERROR;
                    goto cleanup;
                }
                if (mem_90665_cached_sizze_91876 < bytes_89414) {
                    err = lexical_realloc(ctx, &mem_90665, &mem_90665_cached_sizze_91876, bytes_89414);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                
                double defunc_res_79750;
                double redout_89196 = 0.0;
                
                for (int64_t i_89198 = 0; i_89198 < m_34473; i_89198++) {
                    double defunc_res_79753;
                    double defunc_res_79754;
                    double redout_89192;
                    double redout_89193;
                    
                    redout_89192 = 0.0;
                    redout_89193 = 0.0;
                    for (int64_t i_89194 = 0; i_89194 < m_34473; i_89194++) {
                        double x_79755 = ((double *) mem_90614)[i_89194 * m_34473 + i_89198];
                        double zp_res_79758 = x_79755 + redout_89192;
                        double zp_res_79761 = x_79755 + redout_89193;
                        double redout_tmp_91565 = zp_res_79758;
                        double redout_tmp_91566 = zp_res_79761;
                        
                        redout_89192 = redout_tmp_91565;
                        redout_89193 = redout_tmp_91566;
                    }
                    defunc_res_79753 = redout_89192;
                    defunc_res_79754 = redout_89193;
                    
                    bool zeze_res_79764 = defunc_res_79754 == 0.0;
                    double klu_res_79765;
                    
                    if (zeze_res_79764) {
                        klu_res_79765 = 0.0;
                    } else {
                        double zs_res_79766 = defunc_res_79754 / replicate_arg1_52610;
                        double log_res_79767 = futrts_log64(zs_res_79766);
                        double zt_res_79768 = defunc_res_79754 * log_res_79767;
                        
                        klu_res_79765 = zt_res_79768;
                    }
                    
                    double zp_res_79771 = klu_res_79765 + redout_89196;
                    
                    ((double *) mem_90665)[i_89198] = defunc_res_79753;
                    
                    double redout_tmp_91563 = zp_res_79771;
                    
                    redout_89196 = redout_tmp_91563;
                }
                defunc_res_79750 = redout_89196;
                if (mem_90673_cached_sizze_91877 < bytes_89414) {
                    err = lexical_realloc(ctx, &mem_90673, &mem_90673_cached_sizze_91877, bytes_89414);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                
                double defunc_0_reduce_res_79774;
                double defunc_res_79775;
                double redout_89212;
                double redout_89213;
                
                redout_89212 = 0.0;
                redout_89213 = 0.0;
                for (int64_t i_89214 = 0; i_89214 < m_34473; i_89214++) {
                    double eta_p_79778 = ((double *) mem_90611)[i_89214];
                    double defunc_0_reduce_res_79779;
                    double redout_89200 = 0.0;
                    
                    for (int64_t i_89201 = 0; i_89201 < m_34473; i_89201++) {
                        double eta_p_79780 = ((double *) A_mem_89411.mem)[eta_p_52628 * (m_34473 * m_34473) + i_89214 * m_34473 + i_89201];
                        double eta_p_79781 = ((double *) mem_90611)[i_89201];
                        double zt_res_79782 = eta_p_79780 * eta_p_79780;
                        double zt_res_79783 = eta_p_79781 * zt_res_79782;
                        double zp_res_79786 = zt_res_79783 + redout_89200;
                        double redout_tmp_91569 = zp_res_79786;
                        
                        redout_89200 = redout_tmp_91569;
                    }
                    defunc_0_reduce_res_79779 = redout_89200;
                    
                    double zt_res_79788 = eta_p_79778 * defunc_0_reduce_res_79779;
                    
                    for (int64_t i_89206 = 0; i_89206 < m_34473; i_89206++) {
                        double defunc_0_reduce_res_79791;
                        double redout_89202 = 0.0;
                        
                        for (int64_t i_89203 = 0; i_89203 < m_34473; i_89203++) {
                            double eta_p_79792 = ((double *) A_mem_89411.mem)[eta_p_52628 * (m_34473 * m_34473) + i_89214 * m_34473 + i_89203];
                            double eta_p_79793 = ((double *) mem_90614)[i_89203 * m_34473 + i_89206];
                            double zt_res_79794 = eta_p_79792 * eta_p_79793;
                            double zp_res_79797 = zt_res_79794 + redout_89202;
                            double redout_tmp_91571 = zp_res_79797;
                            
                            redout_89202 = redout_tmp_91571;
                        }
                        defunc_0_reduce_res_79791 = redout_89202;
                        ((double *) mem_90673)[i_89206] = defunc_0_reduce_res_79791;
                    }
                    
                    double defunc_0_reduce_res_79800;
                    double redout_89210 = 0.0;
                    
                    for (int64_t i_89211 = 0; i_89211 < m_34473; i_89211++) {
                        double eta_p_79802 = ((double *) mem_90614)[i_89214 * m_34473 + i_89211];
                        double defunc_0_reduce_res_79803;
                        double redout_89208 = 0.0;
                        
                        for (int64_t i_89209 = 0; i_89209 < m_34473; i_89209++) {
                            double eta_p_79804 = ((double *) mem_90673)[i_89209];
                            double eta_p_79805 = ((double *) A_mem_89411.mem)[eta_p_52629 * (m_34473 * m_34473) + i_89209 * m_34473 + i_89211];
                            double zt_res_79806 = eta_p_79804 * eta_p_79805;
                            double zp_res_79809 = zt_res_79806 + redout_89208;
                            double redout_tmp_91573 = zp_res_79809;
                            
                            redout_89208 = redout_tmp_91573;
                        }
                        defunc_0_reduce_res_79803 = redout_89208;
                        
                        double zt_res_79811 = eta_p_79802 * defunc_0_reduce_res_79803;
                        double zp_res_79814 = zt_res_79811 + redout_89210;
                        double redout_tmp_91572 = zp_res_79814;
                        
                        redout_89210 = redout_tmp_91572;
                    }
                    defunc_0_reduce_res_79800 = redout_89210;
                    
                    double zp_res_79818 = zt_res_79788 + redout_89212;
                    double zp_res_79821 = defunc_0_reduce_res_79800 + redout_89213;
                    double redout_tmp_91567 = zp_res_79818;
                    double redout_tmp_91568 = zp_res_79821;
                    
                    redout_89212 = redout_tmp_91567;
                    redout_89213 = redout_tmp_91568;
                }
                defunc_0_reduce_res_79774 = redout_89212;
                defunc_res_79775 = redout_89213;
                
                double defunc_0_reduce_res_79824;
                double redout_89217 = 0.0;
                
                for (int64_t i_89218 = 0; i_89218 < m_34473; i_89218++) {
                    double eta_p_79826 = ((double *) mem_90665)[i_89218];
                    double defunc_0_reduce_res_79827;
                    double redout_89215 = 0.0;
                    
                    for (int64_t i_89216 = 0; i_89216 < m_34473; i_89216++) {
                        double eta_p_79828 = ((double *) A_mem_89411.mem)[eta_p_52629 * (m_34473 * m_34473) + i_89218 * m_34473 + i_89216];
                        double eta_p_79829 = ((double *) mem_90665)[i_89216];
                        double zt_res_79830 = eta_p_79828 * eta_p_79828;
                        double zt_res_79831 = eta_p_79829 * zt_res_79830;
                        double zp_res_79834 = zt_res_79831 + redout_89215;
                        double redout_tmp_91575 = zp_res_79834;
                        
                        redout_89215 = redout_tmp_91575;
                    }
                    defunc_0_reduce_res_79827 = redout_89215;
                    
                    double zt_res_79836 = eta_p_79826 * defunc_0_reduce_res_79827;
                    double zp_res_79839 = zt_res_79836 + redout_89217;
                    double redout_tmp_91574 = zp_res_79839;
                    
                    redout_89217 = redout_tmp_91574;
                }
                defunc_0_reduce_res_79824 = redout_89217;
                
                double zt_res_79841 = -2.0 * defunc_res_79775;
                double zp_res_79842 = defunc_0_reduce_res_79774 + zt_res_79841;
                double zp_res_79843 = defunc_0_reduce_res_79824 + zp_res_79842;
                double zt_res_79844 = eps_34476 * defunc_res_79631;
                double zt_res_79845 = rho1_34474 * defunc_res_79629;
                double zt_res_79846 = rho2_34475 * defunc_res_79750;
                double zp_res_79847 = zt_res_79844 + zt_res_79845;
                double zp_res_79848 = zt_res_79846 + zp_res_79847;
                double zt_res_79849 = 2.0 * zp_res_79848;
                double zt_res_79850 = defunc_res_79630 * zt_res_79849;
                double zp_res_79851 = zp_res_79843 + zt_res_79850;
                double zt_res_79852 = defunc_res_79630 * defunc_res_79630;
                double zt_res_79855 = zp_res_52625 * zt_res_79852;
                double zm_res_79856 = zp_res_79851 - zt_res_79855;
                double zp_res_79877 = zm_res_79856 + zp_res_79876;
                double zm_res_79878 = zp_res_79877 - loss_53554;
                bool zgze_res_79879 = -1.0 <= zm_res_79878;
                double zs_res_79880 = zm_res_79878 / defunc_res_79628;
                bool zlze_res_79881 = zs_res_79880 <= 0.5;
                bool x_79882 = zgze_res_79879 && zlze_res_79881;
                
                if (mem_90685_cached_sizze_91878 < bytes_89414) {
                    err = lexical_realloc(ctx, &mem_90685, &mem_90685_cached_sizze_91878, bytes_89414);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (mem_90688_cached_sizze_91879 < bytes_89448) {
                    err = lexical_realloc(ctx, &mem_90688, &mem_90688_cached_sizze_91879, bytes_89448);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (mem_90731_cached_sizze_91880 < bytes_89414) {
                    err = lexical_realloc(ctx, &mem_90731, &mem_90731_cached_sizze_91880, bytes_89414);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (mem_90739_cached_sizze_91881 < bytes_89414) {
                    err = lexical_realloc(ctx, &mem_90739, &mem_90739_cached_sizze_91881, bytes_89414);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                
                bool defunc_0_armijo_line_search_res_79906;
                double defunc_0_armijo_line_search_res_79908;
                double defunc_0_armijo_line_search_res_79909;
                bool loop_while_79910;
                double current_loss_79912;
                double alpha_79913;
                
                if (memblock_set(ctx, &mem_param_90683, &mem_90617, "mem_90617") != 0)
                    return 1;
                loop_while_79910 = x_79882;
                current_loss_79912 = zp_res_79877;
                alpha_79913 = 1.0;
                while (loop_while_79910) {
                    double zt_res_79914 = 0.5 * alpha_79913;
                    
                    if (memblock_alloc(ctx, &mem_90691, bytes_89448, "mem_90691")) {
                        err = 1;
                        goto cleanup;
                    }
                    
                    double defunc_res_79915;
                    double defunc_res_79916;
                    double defunc_res_79917;
                    double redout_89239;
                    double redout_89240;
                    double redout_89241;
                    
                    redout_89239 = 0.0;
                    redout_89240 = 0.0;
                    redout_89241 = 0.0;
                    for (int64_t i_89245 = 0; i_89245 < m_34473; i_89245++) {
                        double defunc_res_79923;
                        double defunc_res_79924;
                        double defunc_res_79925;
                        double redout_89228;
                        double redout_89229;
                        double redout_89230;
                        
                        redout_89228 = 0.0;
                        redout_89229 = 0.0;
                        redout_89230 = 0.0;
                        for (int64_t i_89233 = 0; i_89233 < m_34473; i_89233++) {
                            double eta_p_79928 = ((double *) mem_param_90683.mem)[i_89245 * m_34473 + i_89233];
                            double eta_p_79929 = ((double *) mem_param_89844.mem)[i_89245 * m_34473 + i_89233];
                            double zt_res_79930 = 0.5 * eta_p_79928;
                            double zp_res_79931 = eta_p_79929 + zt_res_79930;
                            bool zeze_res_79932 = zp_res_79931 == 0.0;
                            double klu_res_79933;
                            
                            if (zeze_res_79932) {
                                klu_res_79933 = 0.0;
                            } else {
                                double zs_res_79934 = zp_res_79931 / zt_res_52646;
                                double log_res_79935 = futrts_log64(zs_res_79934);
                                double zt_res_79936 = zp_res_79931 * log_res_79935;
                                
                                klu_res_79933 = zt_res_79936;
                            }
                            
                            double zp_res_79939 = klu_res_79933 + redout_89228;
                            double zp_res_79942 = zp_res_79931 + redout_89229;
                            double zp_res_79945 = zp_res_79931 + redout_89230;
                            
                            ((double *) mem_90688)[i_89245 * m_34473 + i_89233] = zp_res_79931;
                            ((double *) mem_90691.mem)[i_89245 * m_34473 + i_89233] = zt_res_79930;
                            
                            double redout_tmp_91587 = zp_res_79939;
                            double redout_tmp_91588 = zp_res_79942;
                            double redout_tmp_91589 = zp_res_79945;
                            
                            redout_89228 = redout_tmp_91587;
                            redout_89229 = redout_tmp_91588;
                            redout_89230 = redout_tmp_91589;
                        }
                        defunc_res_79923 = redout_89228;
                        defunc_res_79924 = redout_89229;
                        defunc_res_79925 = redout_89230;
                        
                        bool zeze_res_79951 = defunc_res_79925 == 0.0;
                        double klu_res_79952;
                        
                        if (zeze_res_79951) {
                            klu_res_79952 = 0.0;
                        } else {
                            double zs_res_79953 = defunc_res_79925 / replicate_arg1_52610;
                            double log_res_79954 = futrts_log64(zs_res_79953);
                            double zt_res_79955 = defunc_res_79925 * log_res_79954;
                            
                            klu_res_79952 = zt_res_79955;
                        }
                        
                        double zp_res_79958 = klu_res_79952 + redout_89239;
                        double zp_res_79961 = defunc_res_79925 + redout_89240;
                        double zp_res_79964 = defunc_res_79923 + redout_89241;
                        
                        ((double *) mem_90685)[i_89245] = defunc_res_79924;
                        
                        double redout_tmp_91581 = zp_res_79958;
                        double redout_tmp_91582 = zp_res_79961;
                        double redout_tmp_91583 = zp_res_79964;
                        
                        redout_89239 = redout_tmp_91581;
                        redout_89240 = redout_tmp_91582;
                        redout_89241 = redout_tmp_91583;
                    }
                    defunc_res_79915 = redout_89239;
                    defunc_res_79916 = redout_89240;
                    defunc_res_79917 = redout_89241;
                    
                    double defunc_res_79972;
                    double redout_89253 = 0.0;
                    
                    for (int64_t i_89255 = 0; i_89255 < m_34473; i_89255++) {
                        double defunc_res_79975;
                        double defunc_res_79976;
                        double redout_89249;
                        double redout_89250;
                        
                        redout_89249 = 0.0;
                        redout_89250 = 0.0;
                        for (int64_t i_89251 = 0; i_89251 < m_34473; i_89251++) {
                            double x_79977 = ((double *) mem_90688)[i_89251 * m_34473 + i_89255];
                            double zp_res_79980 = x_79977 + redout_89249;
                            double zp_res_79983 = x_79977 + redout_89250;
                            double redout_tmp_91594 = zp_res_79980;
                            double redout_tmp_91595 = zp_res_79983;
                            
                            redout_89249 = redout_tmp_91594;
                            redout_89250 = redout_tmp_91595;
                        }
                        defunc_res_79975 = redout_89249;
                        defunc_res_79976 = redout_89250;
                        
                        bool zeze_res_79986 = defunc_res_79976 == 0.0;
                        double klu_res_79987;
                        
                        if (zeze_res_79986) {
                            klu_res_79987 = 0.0;
                        } else {
                            double zs_res_79988 = defunc_res_79976 / replicate_arg1_52610;
                            double log_res_79989 = futrts_log64(zs_res_79988);
                            double zt_res_79990 = defunc_res_79976 * log_res_79989;
                            
                            klu_res_79987 = zt_res_79990;
                        }
                        
                        double zp_res_79993 = klu_res_79987 + redout_89253;
                        
                        ((double *) mem_90731)[i_89255] = defunc_res_79975;
                        
                        double redout_tmp_91592 = zp_res_79993;
                        
                        redout_89253 = redout_tmp_91592;
                    }
                    defunc_res_79972 = redout_89253;
                    
                    double defunc_0_reduce_res_79996;
                    double defunc_res_79997;
                    double redout_89269;
                    double redout_89270;
                    
                    redout_89269 = 0.0;
                    redout_89270 = 0.0;
                    for (int64_t i_89271 = 0; i_89271 < m_34473; i_89271++) {
                        double eta_p_80000 = ((double *) mem_90685)[i_89271];
                        double defunc_0_reduce_res_80001;
                        double redout_89257 = 0.0;
                        
                        for (int64_t i_89258 = 0; i_89258 < m_34473; i_89258++) {
                            double eta_p_80002 = ((double *) A_mem_89411.mem)[eta_p_52628 * (m_34473 * m_34473) + i_89271 * m_34473 + i_89258];
                            double eta_p_80003 = ((double *) mem_90685)[i_89258];
                            double zt_res_80004 = eta_p_80002 * eta_p_80002;
                            double zt_res_80005 = eta_p_80003 * zt_res_80004;
                            double zp_res_80008 = zt_res_80005 + redout_89257;
                            double redout_tmp_91598 = zp_res_80008;
                            
                            redout_89257 = redout_tmp_91598;
                        }
                        defunc_0_reduce_res_80001 = redout_89257;
                        
                        double zt_res_80010 = eta_p_80000 * defunc_0_reduce_res_80001;
                        
                        for (int64_t i_89263 = 0; i_89263 < m_34473; i_89263++) {
                            double defunc_0_reduce_res_80013;
                            double redout_89259 = 0.0;
                            
                            for (int64_t i_89260 = 0; i_89260 < m_34473; i_89260++) {
                                double eta_p_80014 = ((double *) A_mem_89411.mem)[eta_p_52628 * (m_34473 * m_34473) + i_89271 * m_34473 + i_89260];
                                double eta_p_80015 = ((double *) mem_90688)[i_89260 * m_34473 + i_89263];
                                double zt_res_80016 = eta_p_80014 * eta_p_80015;
                                double zp_res_80019 = zt_res_80016 + redout_89259;
                                double redout_tmp_91600 = zp_res_80019;
                                
                                redout_89259 = redout_tmp_91600;
                            }
                            defunc_0_reduce_res_80013 = redout_89259;
                            ((double *) mem_90739)[i_89263] = defunc_0_reduce_res_80013;
                        }
                        
                        double defunc_0_reduce_res_80022;
                        double redout_89267 = 0.0;
                        
                        for (int64_t i_89268 = 0; i_89268 < m_34473; i_89268++) {
                            double eta_p_80024 = ((double *) mem_90688)[i_89271 * m_34473 + i_89268];
                            double defunc_0_reduce_res_80025;
                            double redout_89265 = 0.0;
                            
                            for (int64_t i_89266 = 0; i_89266 < m_34473; i_89266++) {
                                double eta_p_80026 = ((double *) mem_90739)[i_89266];
                                double eta_p_80027 = ((double *) A_mem_89411.mem)[eta_p_52629 * (m_34473 * m_34473) + i_89266 * m_34473 + i_89268];
                                double zt_res_80028 = eta_p_80026 * eta_p_80027;
                                double zp_res_80031 = zt_res_80028 + redout_89265;
                                double redout_tmp_91602 = zp_res_80031;
                                
                                redout_89265 = redout_tmp_91602;
                            }
                            defunc_0_reduce_res_80025 = redout_89265;
                            
                            double zt_res_80033 = eta_p_80024 * defunc_0_reduce_res_80025;
                            double zp_res_80036 = zt_res_80033 + redout_89267;
                            double redout_tmp_91601 = zp_res_80036;
                            
                            redout_89267 = redout_tmp_91601;
                        }
                        defunc_0_reduce_res_80022 = redout_89267;
                        
                        double zp_res_80040 = zt_res_80010 + redout_89269;
                        double zp_res_80043 = defunc_0_reduce_res_80022 + redout_89270;
                        double redout_tmp_91596 = zp_res_80040;
                        double redout_tmp_91597 = zp_res_80043;
                        
                        redout_89269 = redout_tmp_91596;
                        redout_89270 = redout_tmp_91597;
                    }
                    defunc_0_reduce_res_79996 = redout_89269;
                    defunc_res_79997 = redout_89270;
                    
                    double defunc_0_reduce_res_80046;
                    double redout_89274 = 0.0;
                    
                    for (int64_t i_89275 = 0; i_89275 < m_34473; i_89275++) {
                        double eta_p_80048 = ((double *) mem_90731)[i_89275];
                        double defunc_0_reduce_res_80049;
                        double redout_89272 = 0.0;
                        
                        for (int64_t i_89273 = 0; i_89273 < m_34473; i_89273++) {
                            double eta_p_80050 = ((double *) A_mem_89411.mem)[eta_p_52629 * (m_34473 * m_34473) + i_89275 * m_34473 + i_89273];
                            double eta_p_80051 = ((double *) mem_90731)[i_89273];
                            double zt_res_80052 = eta_p_80050 * eta_p_80050;
                            double zt_res_80053 = eta_p_80051 * zt_res_80052;
                            double zp_res_80056 = zt_res_80053 + redout_89272;
                            double redout_tmp_91604 = zp_res_80056;
                            
                            redout_89272 = redout_tmp_91604;
                        }
                        defunc_0_reduce_res_80049 = redout_89272;
                        
                        double zt_res_80058 = eta_p_80048 * defunc_0_reduce_res_80049;
                        double zp_res_80061 = zt_res_80058 + redout_89274;
                        double redout_tmp_91603 = zp_res_80061;
                        
                        redout_89274 = redout_tmp_91603;
                    }
                    defunc_0_reduce_res_80046 = redout_89274;
                    
                    double zt_res_80063 = -2.0 * defunc_res_79997;
                    double zp_res_80064 = defunc_0_reduce_res_79996 + zt_res_80063;
                    double zp_res_80065 = defunc_0_reduce_res_80046 + zp_res_80064;
                    double zt_res_80066 = eps_34476 * defunc_res_79917;
                    double zt_res_80067 = rho1_34474 * defunc_res_79915;
                    double zt_res_80068 = rho2_34475 * defunc_res_79972;
                    double zp_res_80069 = zt_res_80066 + zt_res_80067;
                    double zp_res_80070 = zt_res_80068 + zp_res_80069;
                    double zt_res_80071 = 2.0 * zp_res_80070;
                    double zt_res_80072 = defunc_res_79916 * zt_res_80071;
                    double zp_res_80073 = zp_res_80065 + zt_res_80072;
                    double zt_res_80074 = defunc_res_79916 * defunc_res_79916;
                    double zt_res_80075 = zp_res_52625 * zt_res_80074;
                    double zm_res_80076 = zp_res_80073 - zt_res_80075;
                    double zp_res_80077 = zp_res_79905 + zm_res_80076;
                    double zm_res_80078 = zp_res_80077 - loss_53554;
                    bool zgze_res_80079 = -1.0 <= zm_res_80078;
                    double zt_res_80080 = defunc_res_79628 * zt_res_79914;
                    double zs_res_80081 = zm_res_80078 / zt_res_80080;
                    bool zlze_res_80082 = zs_res_80081 <= 0.5;
                    bool zg_res_80083 = 1.0e-50 < zt_res_79914;
                    bool x_80084 = zlze_res_80082 && zg_res_80083;
                    bool x_80085 = zgze_res_80079 && x_80084;
                    
                    if (memblock_set(ctx, &mem_param_tmp_91576, &mem_90691, "mem_90691") != 0)
                        return 1;
                    
                    bool loop_while_tmp_91577 = x_80085;
                    double current_loss_tmp_91579 = zp_res_80077;
                    double alpha_tmp_91580 = zt_res_79914;
                    
                    if (memblock_set(ctx, &mem_param_90683, &mem_param_tmp_91576, "mem_param_tmp_91576") != 0)
                        return 1;
                    loop_while_79910 = loop_while_tmp_91577;
                    current_loss_79912 = current_loss_tmp_91579;
                    alpha_79913 = alpha_tmp_91580;
                }
                if (memblock_set(ctx, &ext_mem_90749, &mem_param_90683, "mem_param_90683") != 0)
                    return 1;
                defunc_0_armijo_line_search_res_79906 = loop_while_79910;
                defunc_0_armijo_line_search_res_79908 = current_loss_79912;
                defunc_0_armijo_line_search_res_79909 = alpha_79913;
                if (memblock_unref(ctx, &mem_90617, "mem_90617") != 0)
                    return 1;
                if (memblock_alloc(ctx, &mem_90752, bytes_89448, "mem_90752")) {
                    err = 1;
                    goto cleanup;
                }
                for (int64_t i_89282 = 0; i_89282 < m_34473; i_89282++) {
                    for (int64_t i_89278 = 0; i_89278 < m_34473; i_89278++) {
                        double eta_p_80090 = ((double *) mem_param_89844.mem)[i_89282 * m_34473 + i_89278];
                        double eta_p_80091 = ((double *) ext_mem_90749.mem)[i_89282 * m_34473 + i_89278];
                        double zp_res_80092 = eta_p_80090 + eta_p_80091;
                        
                        ((double *) mem_90752.mem)[i_89282 * m_34473 + i_89278] = zp_res_80092;
                    }
                }
                if (memblock_unref(ctx, &ext_mem_90749, "ext_mem_90749") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90778, &mem_90523, "mem_90523") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90775, &mem_90518, "mem_90518") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90772, &mem_90752, "mem_90752") != 0)
                    return 1;
                descent_res_54614 = defunc_0_armijo_line_search_res_79908;
            } else {
                if (memblock_alloc(ctx, &mem_90553, bytes_89414, "mem_90553")) {
                    err = 1;
                    goto cleanup;
                }
                for (int64_t nest_i_91607 = 0; nest_i_91607 < m_34473; nest_i_91607++) {
                    ((double *) mem_90553.mem)[nest_i_91607] = 0.0;
                }
                if (memblock_alloc(ctx, &mem_90556, bytes_89448, "mem_90556")) {
                    err = 1;
                    goto cleanup;
                }
                for (int64_t nest_i_91608 = 0; nest_i_91608 < m_34473; nest_i_91608++) {
                    for (int64_t nest_i_91609 = 0; nest_i_91609 < m_34473; nest_i_91609++) {
                        ((double *) mem_90556.mem)[nest_i_91608 * m_34473 + nest_i_91609] = 0.0;
                    }
                }
                if (memblock_set(ctx, &ext_mem_90778, &mem_90553, "mem_90553") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90775, &mem_90553, "mem_90553") != 0)
                    return 1;
                if (memblock_set(ctx, &ext_mem_90772, &mem_90556, "mem_90556") != 0)
                    return 1;
                descent_res_54614 = 0.0;
            }
            if (memblock_unref(ctx, &mem_90518, "mem_90518") != 0)
                return 1;
            if (memblock_unref(ctx, &mem_90523, "mem_90523") != 0)
                return 1;
            
            bool defunc_0_reduce_comm_res_80135;
            bool redout_89286 = 0;
            
            for (int64_t i_89287 = 0; i_89287 < m_34473; i_89287++) {
                bool defunc_0_reduce_comm_res_80095;
                bool redout_89284 = 0;
                
                for (int64_t i_89285 = 0; i_89285 < m_34473; i_89285++) {
                    double eta_p_66376 = ((double *) mem_param_89844.mem)[i_89287 * m_34473 + i_89285];
                    double eta_p_66377 = ((double *) ext_mem_90772.mem)[i_89287 * m_34473 + i_89285];
                    double zt_res_66378 = zp_res_52616 * eta_p_66376;
                    bool zgze_res_66379 = eta_p_66377 <= zt_res_66378;
                    double zt_res_66380 = zp_res_52616 * eta_p_66377;
                    bool zgze_res_66381 = eta_p_66376 <= zt_res_66380;
                    bool x_66382 = zgze_res_66379 && zgze_res_66381;
                    bool not_res_66383 = !x_66382;
                    bool defunc_0_op_res_59093 = not_res_66383 || redout_89284;
                    bool redout_tmp_91611 = defunc_0_op_res_59093;
                    
                    redout_89284 = redout_tmp_91611;
                }
                defunc_0_reduce_comm_res_80095 = redout_89284;
                
                bool defunc_0_op_res_55418 = defunc_0_reduce_comm_res_80095 || redout_89286;
                bool redout_tmp_91610 = defunc_0_op_res_55418;
                
                redout_89286 = redout_tmp_91610;
            }
            defunc_0_reduce_comm_res_80135 = redout_89286;
            
            bool loop_cond_55419;
            
            if (defunc_0_reduce_comm_res_80135) {
                bool defunc_0_reduce_res_80098;
                bool redout_89290 = 0;
                
                for (int64_t i_89291 = 0; i_89291 < m_34473; i_89291++) {
                    bool defunc_0_reduce_res_80100;
                    bool redout_89288 = 0;
                    
                    for (int64_t i_89289 = 0; i_89289 < m_34473; i_89289++) {
                        double eta_p_80101 = ((double *) ext_mem_90772.mem)[i_89291 * m_34473 + i_89289];
                        bool zg_res_80102 = 0.0 < eta_p_80101;
                        bool defunc_0_op_res_80105 = zg_res_80102 || redout_89288;
                        bool redout_tmp_91613 = defunc_0_op_res_80105;
                        
                        redout_89288 = redout_tmp_91613;
                    }
                    defunc_0_reduce_res_80100 = redout_89288;
                    
                    bool defunc_0_op_res_80109 = defunc_0_reduce_res_80100 || redout_89290;
                    bool redout_tmp_91612 = defunc_0_op_res_80109;
                    
                    redout_89290 = redout_tmp_91612;
                }
                defunc_0_reduce_res_80098 = redout_89290;
                loop_cond_55419 = defunc_0_reduce_res_80098;
            } else {
                loop_cond_55419 = 0;
            }
            if (memblock_set(ctx, &mem_param_tmp_91368, &ext_mem_90778, "ext_mem_90778") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_tmp_91369, &ext_mem_90775, "ext_mem_90775") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_tmp_91370, &ext_mem_90772, "ext_mem_90772") != 0)
                return 1;
            
            bool loop_while_tmp_91371 = loop_cond_55419;
            double loss_tmp_91375 = descent_res_54614;
            
            if (memblock_set(ctx, &mem_param_89837, &mem_param_tmp_91368, "mem_param_tmp_91368") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_89840, &mem_param_tmp_91369, "mem_param_tmp_91369") != 0)
                return 1;
            if (memblock_set(ctx, &mem_param_89844, &mem_param_tmp_91370, "mem_param_tmp_91370") != 0)
                return 1;
            loop_while_53550 = loop_while_tmp_91371;
            loss_53554 = loss_tmp_91375;
        }
        if (memblock_set(ctx, &ext_mem_90788, &mem_param_89837, "mem_param_89837") != 0)
            return 1;
        if (memblock_set(ctx, &ext_mem_90787, &mem_param_89840, "mem_param_89840") != 0)
            return 1;
        if (memblock_set(ctx, &ext_mem_90786, &mem_param_89844, "mem_param_89844") != 0)
            return 1;
        final_plan_53545 = loop_while_53550;
        final_plan_53549 = loss_53554;
        if (memblock_unref(ctx, &ext_mem_89792, "ext_mem_89792") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89793, "ext_mem_89793") != 0)
            return 1;
        
        double defunc_res_80210;
        double defunc_res_80211;
        double defunc_res_80212;
        double defunc_res_80213;
        double defunc_res_80214;
        double redout_89312;
        double redout_89313;
        double redout_89314;
        double redout_89315;
        double redout_89316;
        
        redout_89312 = 0.0;
        redout_89313 = 0.0;
        redout_89314 = 0.0;
        redout_89315 = 0.0;
        redout_89316 = 0.0;
        for (int64_t i_89320 = 0; i_89320 < m_34473; i_89320++) {
            for (int64_t i_89296 = 0; i_89296 < m_34473; i_89296++) {
                double defunc_0_reduce_res_80136;
                double redout_89292 = 0.0;
                
                for (int64_t i_89293 = 0; i_89293 < m_34473; i_89293++) {
                    double eta_p_67922 = ((double *) A_mem_89411.mem)[eta_p_52628 * (m_34473 * m_34473) + i_89320 * m_34473 + i_89293];
                    double eta_p_67923 = ((double *) ext_mem_90786.mem)[i_89293 * m_34473 + i_89296];
                    double zt_res_67924 = eta_p_67922 * eta_p_67923;
                    double zp_res_58017 = zt_res_67924 + redout_89292;
                    double redout_tmp_91623 = zp_res_58017;
                    
                    redout_89292 = redout_tmp_91623;
                }
                defunc_0_reduce_res_80136 = redout_89292;
                ((double *) mem_90805)[i_89296] = defunc_0_reduce_res_80136;
            }
            
            double defunc_res_80139;
            double defunc_0_reduce_res_80140;
            double defunc_res_80141;
            double defunc_res_80142;
            double defunc_res_80143;
            double defunc_res_80144;
            double defunc_res_80145;
            double defunc_res_80146;
            double redout_89300;
            double redout_89301;
            double redout_89302;
            double redout_89303;
            double redout_89304;
            double redout_89305;
            double redout_89306;
            double redout_89307;
            
            redout_89300 = 0.0;
            redout_89301 = 0.0;
            redout_89302 = 0.0;
            redout_89303 = 0.0;
            redout_89304 = 0.0;
            redout_89305 = 0.0;
            redout_89306 = 0.0;
            redout_89307 = 0.0;
            for (int64_t i_89308 = 0; i_89308 < m_34473; i_89308++) {
                double x_67882 = ((double *) ext_mem_90786.mem)[i_89320 * m_34473 + i_89308];
                double defunc_0_reduce_res_80137;
                double redout_89298 = 0.0;
                
                for (int64_t i_89299 = 0; i_89299 < m_34473; i_89299++) {
                    double eta_p_67916 = ((double *) mem_90805)[i_89299];
                    double eta_p_67917 = ((double *) A_mem_89411.mem)[eta_p_52629 * (m_34473 * m_34473) + i_89299 * m_34473 + i_89308];
                    double zt_res_67918 = eta_p_67916 * eta_p_67917;
                    double zp_res_67899 = zt_res_67918 + redout_89298;
                    double redout_tmp_91632 = zp_res_67899;
                    
                    redout_89298 = redout_tmp_91632;
                }
                defunc_0_reduce_res_80137 = redout_89298;
                
                double zt_res_67901 = x_67882 * defunc_0_reduce_res_80137;
                bool zeze_res_67903 = x_67882 == 0.0;
                double klu_res_67904;
                
                if (zeze_res_67903) {
                    klu_res_67904 = 0.0;
                } else {
                    double zs_res_67905 = x_67882 / zt_res_52646;
                    double log_res_67906 = futrts_log64(zs_res_67905);
                    double zt_res_67907 = x_67882 * log_res_67906;
                    
                    klu_res_67904 = zt_res_67907;
                }
                
                double klu_res_67910;
                
                if (zeze_res_67903) {
                    klu_res_67910 = 0.0;
                } else {
                    double zs_res_67911 = x_67882 / zt_res_52646;
                    double log_res_67912 = futrts_log64(zs_res_67911);
                    double zt_res_67913 = x_67882 * log_res_67912;
                    
                    klu_res_67910 = zt_res_67913;
                }
                
                double zp_res_58005 = x_67882 + redout_89300;
                double zp_res_58039 = zt_res_67901 + redout_89301;
                double zp_res_58046 = x_67882 + redout_89302;
                double zp_res_58053 = x_67882 + redout_89303;
                double zp_res_58061 = x_67882 + redout_89304;
                double zp_res_58076 = klu_res_67904 + redout_89305;
                double zp_res_58091 = klu_res_67910 + redout_89306;
                double zp_res_58099 = x_67882 + redout_89307;
                double redout_tmp_91624 = zp_res_58005;
                double redout_tmp_91625 = zp_res_58039;
                double redout_tmp_91626 = zp_res_58046;
                double redout_tmp_91627 = zp_res_58053;
                double redout_tmp_91628 = zp_res_58061;
                double redout_tmp_91629 = zp_res_58076;
                double redout_tmp_91630 = zp_res_58091;
                double redout_tmp_91631 = zp_res_58099;
                
                redout_89300 = redout_tmp_91624;
                redout_89301 = redout_tmp_91625;
                redout_89302 = redout_tmp_91626;
                redout_89303 = redout_tmp_91627;
                redout_89304 = redout_tmp_91628;
                redout_89305 = redout_tmp_91629;
                redout_89306 = redout_tmp_91630;
                redout_89307 = redout_tmp_91631;
            }
            defunc_res_80139 = redout_89300;
            defunc_0_reduce_res_80140 = redout_89301;
            defunc_res_80141 = redout_89302;
            defunc_res_80142 = redout_89303;
            defunc_res_80143 = redout_89304;
            defunc_res_80144 = redout_89305;
            defunc_res_80145 = redout_89306;
            defunc_res_80146 = redout_89307;
            
            double zp_res_55540 = defunc_0_reduce_res_80140 + redout_89312;
            double zp_res_55635 = defunc_res_80142 + redout_89313;
            double zp_res_55647 = defunc_res_80143 + redout_89314;
            double zp_res_55681 = defunc_res_80144 + redout_89315;
            double zp_res_55704 = defunc_res_80145 + redout_89316;
            
            ((double *) mem_90790)[i_89320] = defunc_res_80146;
            ((double *) mem_90792)[i_89320] = defunc_res_80141;
            ((double *) mem_90794)[i_89320] = defunc_res_80139;
            
            double redout_tmp_91614 = zp_res_55540;
            double redout_tmp_91615 = zp_res_55635;
            double redout_tmp_91616 = zp_res_55647;
            double redout_tmp_91617 = zp_res_55681;
            double redout_tmp_91618 = zp_res_55704;
            
            redout_89312 = redout_tmp_91614;
            redout_89313 = redout_tmp_91615;
            redout_89314 = redout_tmp_91616;
            redout_89315 = redout_tmp_91617;
            redout_89316 = redout_tmp_91618;
        }
        defunc_res_80210 = redout_89312;
        defunc_res_80211 = redout_89313;
        defunc_res_80212 = redout_89314;
        defunc_res_80213 = redout_89315;
        defunc_res_80214 = redout_89316;
        for (int64_t i_89334 = 0; i_89334 < m_34473; i_89334++) {
            double defunc_res_80147;
            double defunc_res_80148;
            double defunc_res_80149;
            double redout_89324;
            double redout_89325;
            double redout_89326;
            
            redout_89324 = 0.0;
            redout_89325 = 0.0;
            redout_89326 = 0.0;
            for (int64_t i_89327 = 0; i_89327 < m_34473; i_89327++) {
                double x_67943 = ((double *) ext_mem_90786.mem)[i_89327 * m_34473 + i_89334];
                double zp_res_58123 = x_67943 + redout_89324;
                double zp_res_58129 = x_67943 + redout_89325;
                double zp_res_58136 = x_67943 + redout_89326;
                double redout_tmp_91636 = zp_res_58123;
                double redout_tmp_91637 = zp_res_58129;
                double redout_tmp_91638 = zp_res_58136;
                
                redout_89324 = redout_tmp_91636;
                redout_89325 = redout_tmp_91637;
                redout_89326 = redout_tmp_91638;
            }
            defunc_res_80147 = redout_89324;
            defunc_res_80148 = redout_89325;
            defunc_res_80149 = redout_89326;
            ((double *) mem_90822)[i_89334] = defunc_res_80149;
            ((double *) mem_90824)[i_89334] = defunc_res_80148;
            ((double *) mem_90826)[i_89334] = defunc_res_80147;
        }
        if (memblock_unref(ctx, &ext_mem_90786, "ext_mem_90786") != 0)
            return 1;
        
        double defunc_0_reduce_res_80221;
        double redout_89340 = 0.0;
        
        for (int64_t i_89341 = 0; i_89341 < m_34473; i_89341++) {
            double eta_p_56092 = ((double *) mem_90794)[i_89341];
            double defunc_0_reduce_res_80150;
            double redout_89338 = 0.0;
            
            for (int64_t i_89339 = 0; i_89339 < m_34473; i_89339++) {
                double eta_p_67955 = ((double *) A_mem_89411.mem)[eta_p_52628 * (m_34473 * m_34473) + i_89341 * m_34473 + i_89339];
                double eta_p_67956 = ((double *) mem_90794)[i_89339];
                double zt_res_67958 = eta_p_67955 * eta_p_67955;
                double zt_res_67960 = eta_p_67956 * zt_res_67958;
                double zp_res_56105 = zt_res_67960 + redout_89338;
                double redout_tmp_91640 = zp_res_56105;
                
                redout_89338 = redout_tmp_91640;
            }
            defunc_0_reduce_res_80150 = redout_89338;
            
            double zt_res_56107 = eta_p_56092 * defunc_0_reduce_res_80150;
            double zp_res_55473 = zt_res_56107 + redout_89340;
            double redout_tmp_91639 = zp_res_55473;
            
            redout_89340 = redout_tmp_91639;
        }
        defunc_0_reduce_res_80221 = redout_89340;
        
        double defunc_0_reduce_res_80222;
        double redout_89344 = 0.0;
        
        for (int64_t i_89345 = 0; i_89345 < m_34473; i_89345++) {
            double eta_p_56068 = ((double *) mem_90826)[i_89345];
            double defunc_0_reduce_res_80151;
            double redout_89342 = 0.0;
            
            for (int64_t i_89343 = 0; i_89343 < m_34473; i_89343++) {
                double eta_p_67969 = ((double *) A_mem_89411.mem)[eta_p_52629 * (m_34473 * m_34473) + i_89345 * m_34473 + i_89343];
                double eta_p_67970 = ((double *) mem_90826)[i_89343];
                double zt_res_67972 = eta_p_67969 * eta_p_67969;
                double zt_res_67974 = eta_p_67970 * zt_res_67972;
                double zp_res_56081 = zt_res_67974 + redout_89342;
                double redout_tmp_91642 = zp_res_56081;
                
                redout_89342 = redout_tmp_91642;
            }
            defunc_0_reduce_res_80151 = redout_89342;
            
            double zt_res_56083 = eta_p_56068 * defunc_0_reduce_res_80151;
            double zp_res_55497 = zt_res_56083 + redout_89344;
            double redout_tmp_91641 = zp_res_55497;
            
            redout_89344 = redout_tmp_91641;
        }
        defunc_0_reduce_res_80222 = redout_89344;
        
        double zt_res_55541 = -2.0 * defunc_res_80210;
        double zp_res_55542 = zt_res_55541 + defunc_0_reduce_res_80221;
        double zp_res_55543 = zp_res_55542 + defunc_0_reduce_res_80222;
        double defunc_res_80223;
        double redout_89348 = 0.0;
        
        for (int64_t i_89349 = 0; i_89349 < m_34473; i_89349++) {
            double eta_p_55966 = ((double *) mem_90792)[i_89349];
            double defunc_res_80152;
            double redout_89346 = 0.0;
            
            for (int64_t i_89347 = 0; i_89347 < m_34473; i_89347++) {
                double eta_p_67988 = ((double *) mem_90792)[i_89347];
                double zt_res_67989 = eta_p_55966 * eta_p_67988;
                bool zeze_res_67991 = zt_res_67989 == 0.0;
                double kl_res_67992;
                
                if (zeze_res_67991) {
                    kl_res_67992 = zt_res_52646;
                } else {
                    double zs_res_67993 = zt_res_67989 / zt_res_52646;
                    double log_res_67994 = futrts_log64(zs_res_67993);
                    double zt_res_67995 = zt_res_67989 * log_res_67994;
                    double zm_res_67996 = zt_res_67995 - zt_res_67989;
                    double zp_res_67997 = zt_res_52646 + zm_res_67996;
                    
                    kl_res_67992 = zp_res_67997;
                }
                
                double zp_res_55984 = kl_res_67992 + redout_89346;
                double redout_tmp_91644 = zp_res_55984;
                
                redout_89346 = redout_tmp_91644;
            }
            defunc_res_80152 = redout_89346;
            
            double zp_res_55583 = defunc_res_80152 + redout_89348;
            double redout_tmp_91643 = zp_res_55583;
            
            redout_89348 = redout_tmp_91643;
        }
        defunc_res_80223 = redout_89348;
        
        double defunc_res_80224;
        double redout_89352 = 0.0;
        
        for (int64_t i_89353 = 0; i_89353 < m_34473; i_89353++) {
            double eta_p_55928 = ((double *) mem_90824)[i_89353];
            double defunc_res_80153;
            double redout_89350 = 0.0;
            
            for (int64_t i_89351 = 0; i_89351 < m_34473; i_89351++) {
                double eta_p_68011 = ((double *) mem_90824)[i_89351];
                double zt_res_68012 = eta_p_55928 * eta_p_68011;
                bool zeze_res_68014 = zt_res_68012 == 0.0;
                double kl_res_68015;
                
                if (zeze_res_68014) {
                    kl_res_68015 = zt_res_52646;
                } else {
                    double zs_res_68016 = zt_res_68012 / zt_res_52646;
                    double log_res_68017 = futrts_log64(zs_res_68016);
                    double zt_res_68018 = zt_res_68012 * log_res_68017;
                    double zm_res_68019 = zt_res_68018 - zt_res_68012;
                    double zp_res_68020 = zt_res_52646 + zm_res_68019;
                    
                    kl_res_68015 = zp_res_68020;
                }
                
                double zp_res_55946 = kl_res_68015 + redout_89350;
                double redout_tmp_91646 = zp_res_55946;
                
                redout_89350 = redout_tmp_91646;
            }
            defunc_res_80153 = redout_89350;
            
            double zp_res_55623 = defunc_res_80153 + redout_89352;
            double redout_tmp_91645 = zp_res_55623;
            
            redout_89352 = redout_tmp_91645;
        }
        defunc_res_80224 = redout_89352;
        
        double zt_res_55658 = defunc_res_80208 * defunc_res_80209;
        double zt_res_55659 = zt_res_55658 * zt_res_55658;
        double zt_res_55682 = defunc_res_80212 * defunc_res_80213;
        double zt_res_55705 = defunc_res_80211 * defunc_res_80214;
        double zp_res_55706 = zt_res_55682 + zt_res_55705;
        double zp_res_55707 = zt_res_55659 + zp_res_55706;
        double zt_res_55708 = defunc_res_80211 * defunc_res_80212;
        double zm_res_55709 = zp_res_55707 - zt_res_55708;
        double defunc_res_80225;
        double redout_89356 = 0.0;
        
        for (int64_t i_89357 = 0; i_89357 < m_34473; i_89357++) {
            double eta_p_55844 = ((double *) mem_90790)[i_89357];
            double defunc_res_80154;
            double redout_89354 = 0.0;
            
            for (int64_t i_89355 = 0; i_89355 < m_34473; i_89355++) {
                double eta_p_68034 = ((double *) mem_90790)[i_89355];
                double zt_res_68035 = eta_p_55844 * eta_p_68034;
                bool zeze_res_68037 = zt_res_68035 == 0.0;
                double kl_res_68038;
                
                if (zeze_res_68037) {
                    kl_res_68038 = zt_res_52646;
                } else {
                    double zs_res_68039 = zt_res_68035 / zt_res_52646;
                    double log_res_68040 = futrts_log64(zs_res_68039);
                    double zt_res_68041 = zt_res_68035 * log_res_68040;
                    double zm_res_68042 = zt_res_68041 - zt_res_68035;
                    double zp_res_68043 = zt_res_52646 + zm_res_68042;
                    
                    kl_res_68038 = zp_res_68043;
                }
                
                double zp_res_55862 = kl_res_68038 + redout_89354;
                double redout_tmp_91648 = zp_res_55862;
                
                redout_89354 = redout_tmp_91648;
            }
            defunc_res_80154 = redout_89354;
            
            double zp_res_55744 = defunc_res_80154 + redout_89356;
            double redout_tmp_91647 = zp_res_55744;
            
            redout_89356 = redout_tmp_91647;
        }
        defunc_res_80225 = redout_89356;
        
        double zt_res_55745 = rho1_34474 * defunc_res_80225;
        double zp_res_55746 = zp_res_55543 + zt_res_55745;
        double defunc_res_80226;
        double redout_89360 = 0.0;
        
        for (int64_t i_89361 = 0; i_89361 < m_34473; i_89361++) {
            double eta_p_55806 = ((double *) mem_90822)[i_89361];
            double defunc_res_80155;
            double redout_89358 = 0.0;
            
            for (int64_t i_89359 = 0; i_89359 < m_34473; i_89359++) {
                double eta_p_68057 = ((double *) mem_90822)[i_89359];
                double zt_res_68058 = eta_p_55806 * eta_p_68057;
                bool zeze_res_68060 = zt_res_68058 == 0.0;
                double kl_res_68061;
                
                if (zeze_res_68060) {
                    kl_res_68061 = zt_res_52646;
                } else {
                    double zs_res_68062 = zt_res_68058 / zt_res_52646;
                    double log_res_68063 = futrts_log64(zs_res_68062);
                    double zt_res_68064 = zt_res_68058 * log_res_68063;
                    double zm_res_68065 = zt_res_68064 - zt_res_68058;
                    double zp_res_68066 = zt_res_52646 + zm_res_68065;
                    
                    kl_res_68061 = zp_res_68066;
                }
                
                double zp_res_55824 = kl_res_68061 + redout_89358;
                double redout_tmp_91650 = zp_res_55824;
                
                redout_89358 = redout_tmp_91650;
            }
            defunc_res_80155 = redout_89358;
            
            double zp_res_55781 = defunc_res_80155 + redout_89360;
            double redout_tmp_91649 = zp_res_55781;
            
            redout_89360 = redout_tmp_91649;
        }
        defunc_res_80226 = redout_89360;
        
        double zt_res_55782 = rho2_34475 * defunc_res_80226;
        double zp_res_55783 = zp_res_55746 + zt_res_55782;
        double fma_res_55784 = futrts_fma64(zm_res_55709, eps_34476, zp_res_55783);
        
        ((double *) mem_89418.mem)[i_89364 * (int64_t) 5] = zp_res_55543;
        ((double *) mem_89418.mem)[i_89364 * (int64_t) 5 + (int64_t) 1] = defunc_res_80223;
        ((double *) mem_89418.mem)[i_89364 * (int64_t) 5 + (int64_t) 2] = defunc_res_80224;
        ((double *) mem_89418.mem)[i_89364 * (int64_t) 5 + (int64_t) 3] = zm_res_55709;
        ((double *) mem_89418.mem)[i_89364 * (int64_t) 5 + (int64_t) 4] = fma_res_55784;
    }
    if (memblock_unref(ctx, &ext_mem_89412, "ext_mem_89412") != 0)
        return 1;
    if (memblock_unref(ctx, &ext_mem_89413, "ext_mem_89413") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89415, "mem_89415") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89451, "mem_89451") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89499, "mem_89499") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89510, "mem_89510") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89534, "mem_89534") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89542, "mem_89542") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89818, "mem_89818") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89913, "mem_89913") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89915, "mem_89915") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89918, "mem_89918") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89948, "mem_89948") != 0)
        return 1;
    if (memblock_unref(ctx, &mem_89950, "mem_89950") != 0)
        return 1;
    if (memblock_set(ctx, &mem_out_91249, &mem_89418, "mem_89418") != 0)
        return 1;
    prim_out_91250 = zbzg_lhs_52612;
    if (memblock_set(ctx, &*mem_out_p_91847, &mem_out_91249, "mem_out_91249") != 0)
        return 1;
    *out_prim_out_91848 = prim_out_91250;
    
  cleanup:
    {
        free(mem_89424);
        free(mem_89426);
        free(mem_89440);
        free(mem_89449);
        free(mem_89460);
        free(mem_89462);
        free(mem_89476);
        free(mem_89507);
        free(mem_89799);
        free(mem_89846);
        free(mem_89854);
        free(mem_89862);
        free(mem_89871);
        free(mem_89873);
        free(mem_89882);
        free(mem_89890);
        free(mem_90521);
        free(mem_90558);
        free(mem_90560);
        free(mem_90575);
        free(mem_90587);
        free(mem_90589);
        free(mem_90603);
        free(mem_90611);
        free(mem_90614);
        free(mem_90630);
        free(mem_90638);
        free(mem_90665);
        free(mem_90673);
        free(mem_90685);
        free(mem_90688);
        free(mem_90731);
        free(mem_90739);
        free(mem_90790);
        free(mem_90792);
        free(mem_90794);
        free(mem_90805);
        free(mem_90822);
        free(mem_90824);
        free(mem_90826);
        if (memblock_unref(ctx, &mem_param_tmp_91370, "mem_param_tmp_91370") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91369, "mem_param_tmp_91369") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91368, "mem_param_tmp_91368") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90556, "mem_90556") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90553, "mem_90553") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90752, "mem_90752") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91576, "mem_param_tmp_91576") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90691, "mem_90691") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90683, "mem_param_90683") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90749, "ext_mem_90749") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90617, "mem_90617") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90772, "ext_mem_90772") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90775, "ext_mem_90775") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90778, "ext_mem_90778") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90523, "mem_90523") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90518, "mem_90518") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91490, "mem_param_tmp_91490") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91489, "mem_param_tmp_91489") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91488, "mem_param_tmp_91488") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91487, "mem_param_tmp_91487") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91486, "mem_param_tmp_91486") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90453, "mem_90453") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90464, "ext_mem_90464") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90441, "mem_90441") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90438, "mem_90438") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90436, "mem_90436") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90478, "ext_mem_90478") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90481, "ext_mem_90481") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90484, "ext_mem_90484") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90403, "mem_90403") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90414, "ext_mem_90414") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90391, "mem_90391") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90388, "mem_90388") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90386, "mem_90386") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90428, "ext_mem_90428") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90431, "ext_mem_90431") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90434, "ext_mem_90434") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90378, "mem_90378") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90370, "mem_90370") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90368, "mem_param_90368") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90365, "mem_param_90365") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90362, "mem_param_90362") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90359, "mem_param_90359") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90356, "mem_param_90356") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90496, "ext_mem_90496") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90497, "ext_mem_90497") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90498, "ext_mem_90498") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90499, "ext_mem_90499") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90500, "ext_mem_90500") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90321, "mem_90321") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90332, "ext_mem_90332") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90309, "mem_90309") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90306, "mem_90306") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90304, "mem_90304") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90346, "ext_mem_90346") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90349, "ext_mem_90349") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90352, "ext_mem_90352") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90271, "mem_90271") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90282, "ext_mem_90282") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90259, "mem_90259") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90256, "mem_90256") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90254, "mem_90254") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90296, "ext_mem_90296") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90299, "ext_mem_90299") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90302, "ext_mem_90302") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90246, "mem_90246") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90238, "mem_90238") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90503, "ext_mem_90503") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90506, "ext_mem_90506") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90509, "ext_mem_90509") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90512, "ext_mem_90512") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90516, "ext_mem_90516") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91432, "mem_param_tmp_91432") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91431, "mem_param_tmp_91431") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91430, "mem_param_tmp_91430") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91429, "mem_param_tmp_91429") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91428, "mem_param_tmp_91428") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91427, "mem_param_tmp_91427") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91426, "mem_param_tmp_91426") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91425, "mem_param_tmp_91425") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91424, "mem_param_tmp_91424") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90176, "mem_90176") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90187, "ext_mem_90187") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90164, "mem_90164") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90161, "mem_90161") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90159, "mem_90159") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90201, "ext_mem_90201") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90204, "ext_mem_90204") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90207, "ext_mem_90207") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90126, "mem_90126") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90137, "ext_mem_90137") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90114, "mem_90114") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90111, "mem_90111") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90109, "mem_90109") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90151, "ext_mem_90151") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90154, "ext_mem_90154") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90157, "ext_mem_90157") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90101, "mem_90101") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90093, "mem_90093") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90091, "mem_param_90091") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90088, "mem_param_90088") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90085, "mem_param_90085") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90082, "mem_param_90082") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90079, "mem_param_90079") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90075, "mem_param_90075") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90072, "mem_param_90072") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90069, "mem_param_90069") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_90066, "mem_param_90066") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90228, "ext_mem_90228") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90229, "ext_mem_90229") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90230, "ext_mem_90230") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90231, "ext_mem_90231") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90232, "ext_mem_90232") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90233, "ext_mem_90233") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90234, "ext_mem_90234") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90235, "ext_mem_90235") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90236, "ext_mem_90236") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90031, "mem_90031") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90042, "ext_mem_90042") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90019, "mem_90019") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90016, "mem_90016") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_90014, "mem_90014") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90056, "ext_mem_90056") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90059, "ext_mem_90059") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90062, "ext_mem_90062") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89981, "mem_89981") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89992, "ext_mem_89992") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89969, "mem_89969") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89966, "mem_89966") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89964, "mem_89964") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90006, "ext_mem_90006") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90009, "ext_mem_90009") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90012, "ext_mem_90012") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89844, "mem_param_89844") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89840, "mem_param_89840") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89837, "mem_param_89837") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90786, "ext_mem_90786") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90787, "ext_mem_90787") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_90788, "ext_mem_90788") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91319, "mem_param_tmp_91319") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91318, "mem_param_tmp_91318") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91317, "mem_param_tmp_91317") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91316, "mem_param_tmp_91316") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_tmp_91315, "mem_param_tmp_91315") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89749, "mem_89749") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89760, "ext_mem_89760") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89737, "mem_89737") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89734, "mem_89734") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89732, "mem_89732") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89774, "ext_mem_89774") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89777, "ext_mem_89777") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89780, "ext_mem_89780") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89699, "mem_89699") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89710, "ext_mem_89710") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89687, "mem_89687") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89684, "mem_89684") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89682, "mem_89682") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89724, "ext_mem_89724") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89727, "ext_mem_89727") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89730, "ext_mem_89730") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89674, "mem_89674") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89666, "mem_89666") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89664, "mem_param_89664") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89661, "mem_param_89661") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89658, "mem_param_89658") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89655, "mem_param_89655") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_param_89652, "mem_param_89652") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89792, "ext_mem_89792") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89793, "ext_mem_89793") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89794, "ext_mem_89794") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89795, "ext_mem_89795") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89796, "ext_mem_89796") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89617, "mem_89617") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89628, "ext_mem_89628") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89605, "mem_89605") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89602, "mem_89602") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89600, "mem_89600") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89642, "ext_mem_89642") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89645, "ext_mem_89645") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89648, "ext_mem_89648") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89567, "mem_89567") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89578, "ext_mem_89578") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89555, "mem_89555") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89552, "mem_89552") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89550, "mem_89550") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89592, "ext_mem_89592") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89595, "ext_mem_89595") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89598, "ext_mem_89598") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89950, "mem_89950") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89948, "mem_89948") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89918, "mem_89918") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89915, "mem_89915") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89913, "mem_89913") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89818, "mem_89818") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89542, "mem_89542") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89534, "mem_89534") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89510, "mem_89510") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89499, "mem_89499") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89451, "mem_89451") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89418, "mem_89418") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89415, "mem_89415") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89412, "ext_mem_89412") != 0)
            return 1;
        if (memblock_unref(ctx, &ext_mem_89413, "ext_mem_89413") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_out_91249, "mem_out_91249") != 0)
            return 1;
    }
    return err;
}
FUTHARK_FUN_ATTR int futrts_pairs_11446(struct futhark_context *ctx, struct memblock *mem_out_p_91889, struct memblock *mem_out_p_91890, int64_t *out_prim_out_91891, int64_t n_23839)
{
    (void) ctx;
    
    int err = 0;
    int64_t mem_89412_cached_sizze_91892 = 0;
    unsigned char *mem_89412 = NULL;
    int64_t mem_89420_cached_sizze_91893 = 0;
    unsigned char *mem_89420 = NULL;
    int64_t mem_89429_cached_sizze_91894 = 0;
    unsigned char *mem_89429 = NULL;
    struct memblock mem_89443;
    
    mem_89443.references = NULL;
    
    struct memblock mem_89428;
    
    mem_89428.references = NULL;
    
    struct memblock mem_out_91250;
    
    mem_out_91250.references = NULL;
    
    struct memblock mem_out_91249;
    
    mem_out_91249.references = NULL;
    
    int64_t prim_out_91251;
    bool bounds_invalid_upwards_34903 = slt64(n_23839, (int64_t) 0);
    bool valid_34904 = !bounds_invalid_upwards_34903;
    bool range_valid_c_34905;
    
    if (!valid_34904) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Range ", (long long) (int64_t) 0, "..", (long long) (int64_t) 1, "..<", (long long) n_23839, " is invalid.", "-> #0  /prelude/array.fut:94:3-11\n   #1  unbalanced_gw.fut:11:41-47\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t zm_lhs_35218 = sub64(n_23839, (int64_t) 1);
    int64_t bytes_89411 = (int64_t) 8 * n_23839;
    
    if (mem_89412_cached_sizze_91892 < bytes_89411) {
        err = lexical_realloc(ctx, &mem_89412, &mem_89412_cached_sizze_91892, bytes_89411);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    int64_t discard_88612;
    int64_t defunc_0_reduce_res_55938;
    int64_t scanacc_88607;
    int64_t redout_88609;
    
    scanacc_88607 = (int64_t) 0;
    redout_88609 = (int64_t) 0;
    for (int64_t i_88610 = 0; i_88610 < n_23839; i_88610++) {
        int64_t lifted_lambda_res_55918 = sub64(zm_lhs_35218, i_88610);
        int64_t defunc_0_op_res_35197 = add64(lifted_lambda_res_55918, scanacc_88607);
        int64_t defunc_0_op_res_35188 = add64(lifted_lambda_res_55918, redout_88609);
        
        ((int64_t *) mem_89412)[i_88610] = defunc_0_op_res_35197;
        
        int64_t scanacc_tmp_91252 = defunc_0_op_res_35197;
        int64_t redout_tmp_91254 = defunc_0_op_res_35188;
        
        scanacc_88607 = scanacc_tmp_91252;
        redout_88609 = redout_tmp_91254;
    }
    discard_88612 = scanacc_88607;
    defunc_0_reduce_res_55938 = redout_88609;
    
    int64_t bytes_89419 = (int64_t) 8 * defunc_0_reduce_res_55938;
    
    if (mem_89420_cached_sizze_91893 < bytes_89419) {
        err = lexical_realloc(ctx, &mem_89420, &mem_89420_cached_sizze_91893, bytes_89419);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    for (int64_t nest_i_91255 = 0; nest_i_91255 < defunc_0_reduce_res_55938; nest_i_91255++) {
        ((int64_t *) mem_89420)[nest_i_91255] = (int64_t) 0;
    }
    for (int64_t write_iter_88613 = 0; write_iter_88613 < n_23839; write_iter_88613++) {
        bool cond_55902 = write_iter_88613 == (int64_t) 0;
        int64_t lifted_lambda_res_55903;
        
        if (cond_55902) {
            lifted_lambda_res_55903 = (int64_t) 0;
        } else {
            int64_t tmp_55904 = sub64(write_iter_88613, (int64_t) 1);
            bool x_55905 = sle64((int64_t) 0, tmp_55904);
            bool y_55906 = slt64(tmp_55904, n_23839);
            bool bounds_check_55907 = x_55905 && y_55906;
            bool index_certs_55908;
            
            if (!bounds_check_55907) {
                set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) tmp_55904, "] out of bounds for array of shape [", (long long) n_23839, "].", "-> #0  unbalanced_gw.fut:13:45-52\n   #1  unbalanced_gw.fut:13:55-61\n"));
                err = FUTHARK_PROGRAM_ERROR;
                goto cleanup;
            }
            
            int64_t lifted_lambda_res_f_res_55909 = ((int64_t *) mem_89412)[tmp_55904];
            
            lifted_lambda_res_55903 = lifted_lambda_res_f_res_55909;
        }
        if (sle64((int64_t) 0, lifted_lambda_res_55903) && slt64(lifted_lambda_res_55903, defunc_0_reduce_res_55938)) {
            ((int64_t *) mem_89420)[lifted_lambda_res_55903] = write_iter_88613;
        }
    }
    if (memblock_alloc(ctx, &mem_89428, bytes_89419, "mem_89428")) {
        err = 1;
        goto cleanup;
    }
    if (mem_89429_cached_sizze_91894 < defunc_0_reduce_res_55938) {
        err = lexical_realloc(ctx, &mem_89429, &mem_89429_cached_sizze_91894, defunc_0_reduce_res_55938);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    int64_t discard_88630;
    int64_t scanacc_88621 = (int64_t) 0;
    
    for (int64_t i_88625 = 0; i_88625 < defunc_0_reduce_res_55938; i_88625++) {
        int64_t eta_p_55895 = ((int64_t *) mem_89420)[i_88625];
        bool lifted_lambda_res_55897 = slt64((int64_t) 0, eta_p_55895);
        int64_t tmp_35266;
        
        if (lifted_lambda_res_55897) {
            tmp_35266 = eta_p_55895;
        } else {
            int64_t defunc_0_op_res_35267 = add64(eta_p_55895, scanacc_88621);
            
            tmp_35266 = defunc_0_op_res_35267;
        }
        ((int64_t *) mem_89428.mem)[i_88625] = tmp_35266;
        ((bool *) mem_89429)[i_88625] = lifted_lambda_res_55897;
        
        int64_t scanacc_tmp_91257 = tmp_35266;
        
        scanacc_88621 = scanacc_tmp_91257;
    }
    discard_88630 = scanacc_88621;
    if (memblock_alloc(ctx, &mem_89443, bytes_89419, "mem_89443")) {
        err = 1;
        goto cleanup;
    }
    
    int64_t inpacc_55944;
    int64_t inpacc_55848 = (int64_t) 0;
    
    for (int64_t i_88648 = 0; i_88648 < defunc_0_reduce_res_55938; i_88648++) {
        bool x_89385 = ((bool *) mem_89429)[i_88648];
        int64_t eta_p_89400 = ((int64_t *) mem_89428.mem)[i_88648];
        int64_t tmp_89401;
        
        if (x_89385) {
            tmp_89401 = (int64_t) 1;
        } else {
            int64_t defunc_0_op_res_89402 = add64((int64_t) 1, inpacc_55848);
            
            tmp_89401 = defunc_0_op_res_89402;
        }
        
        int64_t lifted_lambda_res_89403 = sub64(tmp_89401, (int64_t) 1);
        int64_t zp_lhs_89404 = add64(eta_p_89400, lifted_lambda_res_89403);
        int64_t lifted_lambda_res_89405 = add64((int64_t) 1, zp_lhs_89404);
        int64_t tmp_55883;
        
        if (x_89385) {
            tmp_55883 = (int64_t) 1;
        } else {
            int64_t defunc_0_op_res_55884 = add64((int64_t) 1, inpacc_55848);
            
            tmp_55883 = defunc_0_op_res_55884;
        }
        ((int64_t *) mem_89443.mem)[i_88648] = lifted_lambda_res_89405;
        
        int64_t inpacc_tmp_91260 = tmp_55883;
        
        inpacc_55848 = inpacc_tmp_91260;
    }
    inpacc_55944 = inpacc_55848;
    if (memblock_set(ctx, &mem_out_91249, &mem_89428, "mem_89428") != 0)
        return 1;
    if (memblock_set(ctx, &mem_out_91250, &mem_89443, "mem_89443") != 0)
        return 1;
    prim_out_91251 = defunc_0_reduce_res_55938;
    if (memblock_set(ctx, &*mem_out_p_91889, &mem_out_91249, "mem_out_91249") != 0)
        return 1;
    if (memblock_set(ctx, &*mem_out_p_91890, &mem_out_91250, "mem_out_91250") != 0)
        return 1;
    *out_prim_out_91891 = prim_out_91251;
    
  cleanup:
    {
        free(mem_89412);
        free(mem_89420);
        free(mem_89429);
        if (memblock_unref(ctx, &mem_89443, "mem_89443") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_89428, "mem_89428") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_out_91250, "mem_out_91250") != 0)
            return 1;
        if (memblock_unref(ctx, &mem_out_91249, "mem_out_91249") != 0)
            return 1;
    }
    return err;
}

int futhark_entry_ugw_armijo(struct futhark_context *ctx, struct futhark_f64_1d **out0, const double in0, const double in1, const double in2, const struct futhark_f64_2d *in3, const struct futhark_f64_1d *in4, const struct futhark_f64_2d *in5, const struct futhark_f64_1d *in6, const double in7, const double in8, const double in9, const double in10)
{
    int64_t mz2081Uz2084U_34268 = (int64_t) 0;
    double rho1_34269 = 0.0;
    double rho2_34270 = 0.0;
    double eps_34271 = 0.0;
    double exp_absorb_cutoff_34276 = 0.0;
    double safe_for_exp_34277 = 0.0;
    double tol_sinkhorn_34278 = 0.0;
    double tol_outerloop_34279 = 0.0;
    int ret = 0;
    
    lock_lock(&ctx->lock);
    
    struct memblock mem_out_91249;
    
    mem_out_91249.references = NULL;
    
    struct memblock nu_mem_89414;
    
    nu_mem_89414.references = NULL;
    
    struct memblock B_mem_89413;
    
    B_mem_89413.references = NULL;
    
    struct memblock mu_mem_89412;
    
    mu_mem_89412.references = NULL;
    
    struct memblock A_mem_89411;
    
    A_mem_89411.references = NULL;
    rho1_34269 = in0;
    rho2_34270 = in1;
    eps_34271 = in2;
    A_mem_89411 = in3->mem;
    mz2081Uz2084U_34268 = in3->shape[0];
    mz2081Uz2084U_34268 = in3->shape[1];
    mu_mem_89412 = in4->mem;
    mz2081Uz2084U_34268 = in4->shape[0];
    B_mem_89413 = in5->mem;
    mz2081Uz2084U_34268 = in5->shape[0];
    mz2081Uz2084U_34268 = in5->shape[1];
    nu_mem_89414 = in6->mem;
    mz2081Uz2084U_34268 = in6->shape[0];
    exp_absorb_cutoff_34276 = in7;
    safe_for_exp_34277 = in8;
    tol_sinkhorn_34278 = in9;
    tol_outerloop_34279 = in10;
    if (!((mz2081Uz2084U_34268 == in3->shape[0] && mz2081Uz2084U_34268 == in3->shape[1]) && (mz2081Uz2084U_34268 == in4->shape[0] && ((mz2081Uz2084U_34268 == in5->shape[0] && mz2081Uz2084U_34268 == in5->shape[1]) && mz2081Uz2084U_34268 == in6->shape[0])))) {
        ret = 1;
        set_error(ctx, msgprintf("Error: entry point arguments have invalid sizes.\n"));
    }
    if (ret == 0) {
        ret = futrts_entry_ugw_armijo(ctx, &mem_out_91249, A_mem_89411, mu_mem_89412, B_mem_89413, nu_mem_89414, mz2081Uz2084U_34268, rho1_34269, rho2_34270, eps_34271, exp_absorb_cutoff_34276, safe_for_exp_34277, tol_sinkhorn_34278, tol_outerloop_34279);
        if (ret == 0) {
            assert((*out0 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->mem = mem_out_91249;
            (*out0)->shape[0] = (int64_t) 5;
        }
    }
    lock_unlock(&ctx->lock);
    return ret;
}
int futhark_entry_ugw_armijo_euclidean(struct futhark_context *ctx, struct futhark_f64_2d **out0, const double in0, const double in1, const double in2, const struct futhark_f64_3d *in3, const double in4, const double in5, const double in6, const double in7)
{
    int64_t k_34814 = (int64_t) 0;
    int64_t m_34815 = (int64_t) 0;
    int64_t d_34816 = (int64_t) 0;
    double rho1_34817 = 0.0;
    double rho2_34818 = 0.0;
    double eps_34819 = 0.0;
    double exp_absorb_cutoff_34821 = 0.0;
    double safe_for_exp_34822 = 0.0;
    double tol_sinkhorn_34823 = 0.0;
    double tol_outerloop_34824 = 0.0;
    int64_t prim_out_91250 = (int64_t) 0;
    int ret = 0;
    
    lock_lock(&ctx->lock);
    
    struct memblock mem_out_91249;
    
    mem_out_91249.references = NULL;
    
    struct memblock pt_clouds_mem_89411;
    
    pt_clouds_mem_89411.references = NULL;
    rho1_34817 = in0;
    rho2_34818 = in1;
    eps_34819 = in2;
    pt_clouds_mem_89411 = in3->mem;
    k_34814 = in3->shape[0];
    m_34815 = in3->shape[1];
    d_34816 = in3->shape[2];
    exp_absorb_cutoff_34821 = in4;
    safe_for_exp_34822 = in5;
    tol_sinkhorn_34823 = in6;
    tol_outerloop_34824 = in7;
    if (!(k_34814 == in3->shape[0] && (m_34815 == in3->shape[1] && d_34816 == in3->shape[2]))) {
        ret = 1;
        set_error(ctx, msgprintf("Error: entry point arguments have invalid sizes.\n"));
    }
    if (ret == 0) {
        ret = futrts_entry_ugw_armijo_euclidean(ctx, &mem_out_91249, &prim_out_91250, pt_clouds_mem_89411, k_34814, m_34815, d_34816, rho1_34817, rho2_34818, eps_34819, exp_absorb_cutoff_34821, safe_for_exp_34822, tol_sinkhorn_34823, tol_outerloop_34824);
        if (ret == 0) {
            assert((*out0 = (struct futhark_f64_2d *) malloc(sizeof(struct futhark_f64_2d))) != NULL);
            (*out0)->mem = mem_out_91249;
            (*out0)->shape[0] = prim_out_91250;
            (*out0)->shape[1] = (int64_t) 5;
        }
    }
    lock_unlock(&ctx->lock);
    return ret;
}
int futhark_entry_ugw_armijo_pairwise(struct futhark_context *ctx, struct futhark_f64_2d **out0, const double in0, const double in1, const double in2, const struct futhark_f64_3d *in3, const struct futhark_f64_2d *in4, const double in5, const double in6, const double in7, const double in8)
{
    int64_t k_33637 = (int64_t) 0;
    int64_t m_33638 = (int64_t) 0;
    double rho1_33639 = 0.0;
    double rho2_33640 = 0.0;
    double eps_33641 = 0.0;
    double exp_absorb_cutoff_33644 = 0.0;
    double safe_for_exp_33645 = 0.0;
    double tol_sinkhorn_33646 = 0.0;
    double tol_outerloop_33647 = 0.0;
    int64_t prim_out_91250 = (int64_t) 0;
    int ret = 0;
    
    lock_lock(&ctx->lock);
    
    struct memblock mem_out_91249;
    
    mem_out_91249.references = NULL;
    
    struct memblock distrs_mem_89412;
    
    distrs_mem_89412.references = NULL;
    
    struct memblock A_mem_89411;
    
    A_mem_89411.references = NULL;
    rho1_33639 = in0;
    rho2_33640 = in1;
    eps_33641 = in2;
    A_mem_89411 = in3->mem;
    k_33637 = in3->shape[0];
    m_33638 = in3->shape[1];
    m_33638 = in3->shape[2];
    distrs_mem_89412 = in4->mem;
    k_33637 = in4->shape[0];
    m_33638 = in4->shape[1];
    exp_absorb_cutoff_33644 = in5;
    safe_for_exp_33645 = in6;
    tol_sinkhorn_33646 = in7;
    tol_outerloop_33647 = in8;
    if (!((k_33637 == in3->shape[0] && (m_33638 == in3->shape[1] && m_33638 == in3->shape[2])) && (k_33637 == in4->shape[0] && m_33638 == in4->shape[1]))) {
        ret = 1;
        set_error(ctx, msgprintf("Error: entry point arguments have invalid sizes.\n"));
    }
    if (ret == 0) {
        ret = futrts_entry_ugw_armijo_pairwise(ctx, &mem_out_91249, &prim_out_91250, A_mem_89411, distrs_mem_89412, k_33637, m_33638, rho1_33639, rho2_33640, eps_33641, exp_absorb_cutoff_33644, safe_for_exp_33645, tol_sinkhorn_33646, tol_outerloop_33647);
        if (ret == 0) {
            assert((*out0 = (struct futhark_f64_2d *) malloc(sizeof(struct futhark_f64_2d))) != NULL);
            (*out0)->mem = mem_out_91249;
            (*out0)->shape[0] = prim_out_91250;
            (*out0)->shape[1] = (int64_t) 5;
        }
    }
    lock_unlock(&ctx->lock);
    return ret;
}
int futhark_entry_ugw_armijo_pairwise_increasing(struct futhark_context *ctx, struct futhark_f64_2d **out0, const struct futhark_f64_2d *in0, const double in1, const double in2, const double in3, const double in4, const struct futhark_f64_3d *in5, const struct futhark_f64_2d *in6, const double in7, const double in8, const double in9, const double in10)
{
    int64_t dz2080U_34199 = (int64_t) 0;
    int64_t k_34200 = (int64_t) 0;
    int64_t m_34201 = (int64_t) 0;
    double ratio_34203 = 0.0;
    double rho1_34204 = 0.0;
    double rho2_34205 = 0.0;
    double eps_34206 = 0.0;
    double exp_absorb_cutoff_34209 = 0.0;
    double safe_for_exp_34210 = 0.0;
    double tol_sinkhorn_34211 = 0.0;
    double tol_outerloop_34212 = 0.0;
    int64_t prim_out_91250 = (int64_t) 0;
    int ret = 0;
    
    lock_lock(&ctx->lock);
    
    struct memblock mem_out_91249;
    
    mem_out_91249.references = NULL;
    
    struct memblock distrs_mem_89413;
    
    distrs_mem_89413.references = NULL;
    
    struct memblock A_mem_89412;
    
    A_mem_89412.references = NULL;
    
    struct memblock ugw_dmat_mem_89411;
    
    ugw_dmat_mem_89411.references = NULL;
    ugw_dmat_mem_89411 = in0->mem;
    dz2080U_34199 = in0->shape[0];
    ratio_34203 = in1;
    rho1_34204 = in2;
    rho2_34205 = in3;
    eps_34206 = in4;
    A_mem_89412 = in5->mem;
    k_34200 = in5->shape[0];
    m_34201 = in5->shape[1];
    m_34201 = in5->shape[2];
    distrs_mem_89413 = in6->mem;
    k_34200 = in6->shape[0];
    m_34201 = in6->shape[1];
    exp_absorb_cutoff_34209 = in7;
    safe_for_exp_34210 = in8;
    tol_sinkhorn_34211 = in9;
    tol_outerloop_34212 = in10;
    if (!((dz2080U_34199 == in0->shape[0] && (int64_t) 5 == in0->shape[1]) && ((k_34200 == in5->shape[0] && (m_34201 == in5->shape[1] && m_34201 == in5->shape[2])) && (k_34200 == in6->shape[0] && m_34201 == in6->shape[1])))) {
        ret = 1;
        set_error(ctx, msgprintf("Error: entry point arguments have invalid sizes.\n"));
    }
    if (ret == 0) {
        ret = futrts_entry_ugw_armijo_pairwise_increasing(ctx, &mem_out_91249, &prim_out_91250, ugw_dmat_mem_89411, A_mem_89412, distrs_mem_89413, dz2080U_34199, k_34200, m_34201, ratio_34203, rho1_34204, rho2_34205, eps_34206, exp_absorb_cutoff_34209, safe_for_exp_34210, tol_sinkhorn_34211, tol_outerloop_34212);
        if (ret == 0) {
            assert((*out0 = (struct futhark_f64_2d *) malloc(sizeof(struct futhark_f64_2d))) != NULL);
            (*out0)->mem = mem_out_91249;
            (*out0)->shape[0] = prim_out_91250;
            (*out0)->shape[1] = (int64_t) 5;
        }
    }
    lock_unlock(&ctx->lock);
    return ret;
}
int futhark_entry_ugw_armijo_pairwise_unif(struct futhark_context *ctx, struct futhark_f64_2d **out0, const double in0, const double in1, const double in2, const struct futhark_f64_3d *in3, const double in4, const double in5, const double in6, const double in7)
{
    int64_t k_34472 = (int64_t) 0;
    int64_t m_34473 = (int64_t) 0;
    double rho1_34474 = 0.0;
    double rho2_34475 = 0.0;
    double eps_34476 = 0.0;
    double exp_absorb_cutoff_34478 = 0.0;
    double safe_for_exp_34479 = 0.0;
    double tol_sinkhorn_34480 = 0.0;
    double tol_outerloop_34481 = 0.0;
    int64_t prim_out_91250 = (int64_t) 0;
    int ret = 0;
    
    lock_lock(&ctx->lock);
    
    struct memblock mem_out_91249;
    
    mem_out_91249.references = NULL;
    
    struct memblock A_mem_89411;
    
    A_mem_89411.references = NULL;
    rho1_34474 = in0;
    rho2_34475 = in1;
    eps_34476 = in2;
    A_mem_89411 = in3->mem;
    k_34472 = in3->shape[0];
    m_34473 = in3->shape[1];
    m_34473 = in3->shape[2];
    exp_absorb_cutoff_34478 = in4;
    safe_for_exp_34479 = in5;
    tol_sinkhorn_34480 = in6;
    tol_outerloop_34481 = in7;
    if (!(k_34472 == in3->shape[0] && (m_34473 == in3->shape[1] && m_34473 == in3->shape[2]))) {
        ret = 1;
        set_error(ctx, msgprintf("Error: entry point arguments have invalid sizes.\n"));
    }
    if (ret == 0) {
        ret = futrts_entry_ugw_armijo_pairwise_unif(ctx, &mem_out_91249, &prim_out_91250, A_mem_89411, k_34472, m_34473, rho1_34474, rho2_34475, eps_34476, exp_absorb_cutoff_34478, safe_for_exp_34479, tol_sinkhorn_34480, tol_outerloop_34481);
        if (ret == 0) {
            assert((*out0 = (struct futhark_f64_2d *) malloc(sizeof(struct futhark_f64_2d))) != NULL);
            (*out0)->mem = mem_out_91249;
            (*out0)->shape[0] = prim_out_91250;
            (*out0)->shape[1] = (int64_t) 5;
        }
    }
    lock_unlock(&ctx->lock);
    return ret;
}
  
